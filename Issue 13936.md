# Issue 13936: Reorganization of set partitions

Issue created by migration from https://trac.sagemath.org/ticket/14140

Original creator: stumpc5

Original creation time: 2013-02-16 12:31:28

Assignee: sage-combinat

CC:  vivianepons hivert chapoton chrisjamesberg saliola ghseeli

Keywords: set partitions

Set partitions need to be completely reorganized. In particular, there is no element class, and it is not possible to construct a set partition

```
sage: SetPartition([[1,3],[2,4]])
```

It would be great to have in order to provide statistics on set partitions.


---

Comment by chrisjamesberg created at 2013-02-27 21:52:13

Also, right now there are 9 different classes of set partitions, hopefully this could all be merged into a single class.


---

Comment by tscrim created at 2013-02-28 15:50:51

I don't know how possible it will be to get it into 1 class, but maybe 2: one for ordered, one for unordered. I'll see what I can do since I also want to remove instances of `CombinatorialClass`.


---

Comment by chrisjamesberg created at 2013-03-01 04:17:49

I'm cc'ing Franco on this too because he implemented NCSYM and must have come across this problem at some point. Perhaps he already has his own nice implementation for set partitions.


---

Comment by saliola created at 2013-03-01 05:27:30

Here are the relevant patches on the sage-combinat queue:

- set-partition-fs.patch (currently guarded)
- hopf_algebra_of_supercharacters-fs.patch
- scha-cleanup-fs.patch

Feel free to extract whatever you find useful!


---

Comment by tscrim created at 2013-03-04 15:34:00

Changing status from new to needs_review.


---

Comment by stumpc5 created at 2013-03-04 16:33:26

Replying to [comment:6 tscrim]:

The patch has several nontrivial rejects, please check!


---

Comment by chrisjamesberg created at 2013-03-04 16:56:23

Looks like it just needs rebasing.


---

Comment by tscrim created at 2013-03-04 17:01:15

The partition options patch touches this, added that to the dependencies.


---

Comment by chrisjamesberg created at 2013-03-05 17:04:59

Looks like the patch has many doctest errors. If you fix these, I will review it.


---

Comment by chrisjamesberg created at 2013-03-05 17:08:37

Also, I'd like to see some of the trivial doctests, such as:


```
sage: SetPartition([])
{}
```


etc...


---

Comment by chrisjamesberg created at 2013-03-05 17:15:15

Also, I would like to see a method like to_partition which takes a set partition to the underlying partition. Ideally this method would have the decorator `@`combinatorial_map.


---

Comment by ghseeli created at 2013-03-05 17:38:55

I have been doing some work on diagram / partition algebras, which make extensive use of SetPartitions in their implementation. I think these modifications are definitely helpful. I would like to point out though that there is actually already a method within Sage to convert a list to a set partition, contained under sage.combinat.partition_algebra called "to_set_partition." That being said, this reorganization is definitely needed because the current SetPartitions class is a pain to work with when you only want specific ones.

Also, Chris, what are the 9 different classes of set partitions currently in Sage? Are all of these encompassed by this patch, or do they need more work? I am almost done with some code that would implement structures such as "SetPartitionsAk" as an algebra, since they are better understood and used that way.


---

Comment by tscrim created at 2013-03-06 03:45:54

Right now this just groups `OrderedSetPartitions` and `SetPartitions` under one abstract base class (with common code factored out). There are different classes depending upon what type of input since they iterate differently and some have cardinality shortcuts. There are two big things this patch does, first is remove `CombinatorialClass`, the second is a proper element is implemented for each of these parent objects.

I'm going to look into `partition_algebra` next chance I get since there are currently multiple doctest failures in there. Is there anything in particular besides a `to_partition()` method that you'd want from this?


---

Comment by chrisjamesberg created at 2013-03-06 05:02:15

I'm naive as to why there are so many of them, but when I tab complete `SetPartition` I get:


```
SetPartitions     
SetPartitionsIk   
SetPartitionsRk   
SetPartitionsAk   
SetPartitionsPRk  
SetPartitionsSk   
SetPartitionsBk   
SetPartitionsPk   
SetPartitionsTk
```



---

Comment by ghseeli created at 2013-03-06 05:25:31

Travis, I have been working on some code to refine partition_algebra since Sage Days 38 last summer. I have just posted it to trac so that you can view it (#14234). There is still some work to be done (doctests are not perfect, although it did pass when I ran it today.) My code, however, would be refined greatly by some of your implementations in this patch.

Chris, all the SetPartitions with a letter and k after them are from partition_algebra. It seems to me that these structures, while represented by set partitions, are better understood as algebras, as explained in the ticket.


---

Comment by tscrim created at 2013-03-06 16:08:33

I've uploaded the new version of the patch which fixes `partition_algebra.py` and the other misc doctests. I also made `to_partition` an alias for `shape` and added the combinatorial map decorators.

I would like to have the classes `SetPartitionsXk` removed from the global namespace and instead created through one unified interface/`UniqueFactory` (if even necessary) such as in `CartanType`. However I don't feel like taking care of that here.


---

Comment by chrisjamesberg created at 2013-03-06 17:15:39

`SetPartition({{1,3}, {2}})` returns an error. You should be able to use the _repr_ to recreate the object, no?


---

Comment by tscrim created at 2013-03-06 21:34:00

I've fixed the last doctests. As for the `{{1,3},{2}}`, that is a shortcoming of python and what you would need is a change to the sage preparser. There's also many instances in sage in which the repr is not something you can feed it back in (ex. any parent or particular roots).


---

Comment by stumpc5 created at 2013-03-08 08:12:34

I would appreciate if we could make the string representation of a set that is totally ordered to be ordered the same way. This is, each part is ordered increasingly, as are the sets by their first element:

Currently, I get

```
sage: SetPartition([[1,2,4],[3,5]])    
{{3, 5}, {1, 2, 4}}
```

but I would prefer to get

```
{{1, 2, 4}, {3, 5}}
```

Does that sound reasonable?


---

Comment by tscrim created at 2013-03-18 19:44:34

Should be fixed now.


---

Comment by tscrim created at 2013-03-19 15:49:15

Fixed failing doctests.


---

Comment by stumpc5 created at 2013-03-19 18:31:27

Replying to [comment:22 tscrim]:
> Fixed failing doctests.

This is a long patch, thanks Travis! I'd prefer if someone else could review it -- but I could also give it a quick review and let further complaints be solved in other tickets...


---

Comment by chrisjamesberg created at 2013-03-20 19:23:34

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-03-22 10:12:08

This should be rebased to #12415.


---

Comment by jdemeyer created at 2013-03-22 10:12:08

Changing status from positive_review to needs_work.


---

Attachment


---

Comment by tscrim created at 2013-03-27 11:55:06

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2013-03-27 11:55:06

Rebased.


---

Comment by tscrim created at 2013-03-27 22:49:23

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-04-01 10:39:30

Resolution: fixed
