# Issue 11780: Fix conversion Python -> PARI

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2011-10-25 11:45:16

Assignee: was

Conversion of a Python `complex` to PARI fails:

```
sage: pari(complex(I))
  ***   Warning: unused characters: j.
1
```


Moreover, the conversion of other Python types to PARI can be improved by adding special code instead of using strings.


---

Comment by jdemeyer created at 2011-10-25 11:49:51

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2011-10-25 15:13:40

Doctest failures in `lseries_ell.py`:

```
sage -t -long -force_lib "devel/sage/sage/schemes/elliptic_curves/lseries_ell.py"
  ***   Warning: new stack size = 1001728 (0.955 Mbytes).
  ***   Warning: new stack size = 1002624 (0.956 Mbytes).
  ***   Warning: new stack size = 1010736 (0.964 Mbytes).
  ***   Warning: new stack size = 1114144 (1.063 Mbytes).
  ***   Warning: new stack size = 1028720 (0.981 Mbytes).
  ***   Warning: new stack size = 1033680 (0.986 Mbytes).
**********************************************************************
File "/usr/local/src/sage-4.7.2.alpha2/devel/sage/sage/schemes/elliptic_curves/lseries_ell.py", line 459:
    sage: E.lseries().deriv_at1()
Expected:
    (0.305986660899342, 0.000800351433106958)
Got:
    (0.305986660898516, 0.000800351433106958)
**********************************************************************
File "/usr/local/src/sage-4.7.2.alpha2/devel/sage/sage/schemes/elliptic_curves/lseries_ell.py", line 461:
    sage: E.lseries().deriv_at1(100)
Expected:
    (0.305999773834879, 1.52437502288740e-45)
Got:
    (0.305999773834052, 1.52437502288740e-45)
**********************************************************************
File "/usr/local/src/sage-4.7.2.alpha2/devel/sage/sage/schemes/elliptic_curves/lseries_ell.py", line 463:
    sage: E.lseries().deriv_at1(1000)
Expected:
    (0.305999773834879, 0.000000000000000)
Got:
    (0.305999773834052, 0.000000000000000)
**********************************************************************
```



---

Comment by jdemeyer created at 2011-10-25 15:13:40

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2011-10-25 15:36:48

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2011-10-30 20:37:20

Conversion from `int` can be done without MPIR.


---

Comment by jdemeyer created at 2011-10-30 20:37:20

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2011-10-30 21:09:40

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2011-11-03 16:14:43

Milestone sage-4.7.3 deleted


---

Comment by robertwb created at 2011-11-15 09:07:39

Looks good to me (pending all doctests passing) and much cleaner. I checked the derivatives in lseries_ell.py to higher precision, the new values are correct. 

Nit:


```
if PyBool_Check(s):
    return self.PARI_ONE if s else self.PARI_ZERO
```



---

Comment by robertwb created at 2011-11-15 09:07:39

Changing status from needs_review to positive_review.


---

Attachment

Replying to [comment:13 robertwb]:
> {{{
> if PyBool_Check(s):
>     return self.PARI_ONE if s else self.PARI_ZERO
> }}}
I made this small change.


---

Comment by jdemeyer created at 2011-11-16 13:46:06

Resolution: fixed
