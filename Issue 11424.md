# Issue 11424: Cached eigenstuff is mutable

Issue created by migration from Trac.

Original creator: rbeezer

Original creation time: 2011-07-14 05:03:31

Assignee: jason, was

CC:  jason simonking

Ooops.


```
sage: A = matrix(QQ, 2, 2, range(4))
sage: ev = A.eigenvalues()          
sage: ev
[-0.5615528128088302?, 3.561552812808830?]
sage: ev[0]=300                     
sage: A.eigenvalues()                
[300, 3.561552812808830?]
```


I suspect eigenspaces and eigenmatrices might also need a look.


---

Comment by jason created at 2011-12-04 00:50:40

Change this in the def eigenvalues():


```
        x = self.fetch('eigenvalues')
        if not x is None:
            if not extend:
                x1=Sequence([])
                for i in x:
                    if i in self.base_ring():
                        x1.append(i)
                x=x1
            return x
```


to this (add an else...)


```
        x = self.fetch('eigenvalues')
        if not x is None:
            if not extend:
                x1=Sequence([])
                for i in x:
                    if i in self.base_ring():
                        x1.append(i)
                x=x1
            else:
                x = copy(x)
            return x
```



---

Comment by jason created at 2011-12-04 00:50:57

(that's in matrix/matrix2.pyx)


---

Comment by jason created at 2011-12-04 00:51:56

And also change at the bottom of the function to return a copy of ``V``


---

Attachment

Not tested; definitely needs work


---

Comment by jason created at 2011-12-04 01:03:17

Changing status from new to needs_review.


---

Comment by jason created at 2011-12-04 01:03:22

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2011-12-04 01:18:42

I just noticed this ticket, too.  Here's my version of a patch.  Maybe we can combine the best of the two of them to get a single patch.


---

Attachment

a different take


---

Comment by jhpalmieri created at 2011-12-04 01:20:53

(I searched for cached information in `matrix2.pyx` and tried to fix anything which was not already immutable.)


---

Comment by jason created at 2011-12-04 03:00:04

Ah, I forgot that you can have an immutable sequence.  Nice.

Also, I wonder if we can use Simon King's work on cached methods?  CCing him to get his thoughts.
