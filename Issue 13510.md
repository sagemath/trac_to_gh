# Issue 13510: multi_polynomial.lift(...) affects libsingular internal state; makes ideal.complete_primary_decomposition() fail

Issue created by migration from https://trac.sagemath.org/ticket/13714

Original creator: Bouillaguet

Original creation time: 2012-11-15 14:58:22

Assignee: malb

CC:  malb mstreng

Keywords: libsingular

On sage 5.4:

```
sage: R.<x1,x2> = QQ[]
sage: I = R.ideal(x2**2 + x1 - 2, x1**2 - 1)
sage: R.one().lift(I)
[0, 0]
sage: I.complete_primary_decomposition()
// ** char_series returns 0 x 0 matrix from 3 input polys (0)
I[1,1]=x2^2+x1-2
I[1,2]=x1^2-1
```

and hangs forever (on sage 5.3 it just SEGFAULTs).

The key in this case is the *failing* call to `lift`, _i.e._, evaluating `f.lift(I)` while `f` is not in `I`. What happens in these case is changed by #13671 (but the problem in this ticket is independent). It was found while fixing #13671 that when computing `f.lift(I)`, then if `f` is not in `I` an error is raised by singular, by setting a global variable. Before #13671, this variable was not reset, and subsequent calls to lift would return junk. After #13671, the global variable is reset and ``lift`` works correctly. However, it was apparently not the end of the story.


---

Comment by Bouillaguet created at 2013-01-31 09:31:57

The patch fixes the bug. Thanks Hans !


---

Comment by Bouillaguet created at 2013-01-31 09:31:57

Changing status from new to needs_review.


---

Comment by malb created at 2013-01-31 16:34:32

Looks good but what's up with that matrix2.pyx bit?


---

Comment by Bouillaguet created at 2013-01-31 16:52:11

It's nothing but a mistake (bad MQ management queue). I updated the patch


---

Comment by mstreng created at 2013-02-04 14:21:25

why the duplicate "cdef int errorreported" in /sage/libs/singular/singular-cdefs.pxi?


---

Comment by Bouillaguet created at 2013-02-04 18:23:40

I have no idea :) I'm updating the patch right now.


---

Attachment

looks good, fixes the problem, and all tests pass


---

Comment by mstreng created at 2013-02-06 14:31:28

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-02-09 12:14:14

Resolution: fixed
