# Issue 17348: Implement element_ring() for free module elements

Issue created by migration from https://trac.sagemath.org/ticket/17585

Original creator: jdemeyer

Original creation time: 2015-01-05 14:54:51

See https://groups.google.com/forum/#!topic/sage-devel/7n5xtT9Dw2g

We add a method `element_ring` to `FreeModule` and `FreeModuleElement` indicating the ring from which the entries `v[i]` come. Example:

```
sage: M = (ZZ^2) * (1/2)
sage: v = M([0,1/2])
sage: v.base_ring()
Integer Ring
sage: v.element_ring()
Rational Field
```



---

Comment by jdemeyer created at 2015-01-07 19:45:38

Last 10 new commits:


---

Comment by git created at 2015-01-08 10:59:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2015-01-08 11:29:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-01-08 15:28:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-01-21 16:30:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by nbruin created at 2015-02-10 17:34:56

I noticed this in one of the commits:

```diff
- from sage.categories.all import FreeModules
- category = FreeModules(base_ring.category())
+ from sage.categories.all import Fields, FreeModules, VectorSpaces
+ if base_ring in Fields():
+    category = VectorSpaces(base_ring)
+ else:
+    category = FreeModules(base_ring)
```

It's important for performance and and memory-leaking that categories do *not* refer to their base rings. This information is already stored in the parent. Thus, the `FreeModules(base_ring.category())` is quite intentional. Please keep it in.

Furthermore:

```
sage: FreeModules(Fields())
Category of vector spaces with basis over fields
```

so the category code does the fields check already. No need to do it twice.


---

Comment by jdemeyer created at 2015-02-11 09:20:50

Nils, I agree that it's a mistake (probably by merging, since I didn't intentionally make that change).

But currently I'm waiting for #17584 to be reviewed before continuing with this ticket.

I'm also wondering whether I should wait or not for #10513: if I wait, then this ticket might never get finished.


---

Comment by git created at 2015-02-17 10:26:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2015-02-18 15:39:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-02-18 15:47:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-02-19 01:16:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-02-19 10:22:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2015-02-19 11:10:05

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-02-20 15:30:01

Hi Jeroen,

Did you saw the weirdness in #13304 that I mentioned related to #11751? Could we get rid of the `.basis()` in the initialization of free module elements here?

Vincent


---

Comment by jdemeyer created at 2015-02-20 16:06:45

Replying to [comment:20 vdelecroix]:
> Hi Jeroen,
> 
> Did you saw the weirdness in #13304 that I mentioned related to #11751?
No, but this ticket _does_ fix one of the issues mentioned in #13304.


---

Comment by vdelecroix created at 2015-02-20 16:39:17

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2015-02-20 16:39:17

1. Do we really want to allow `non exact` coordinate rings with `exact` base ring? You replaced a test about exactness of the base ring with exactness of the coordinate ring.

2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.

3. Do we really need the method `coordinate_ring`/`base_ring` defined on vectors? These are methods of the parent (and are implemented as such). I do not see the point of that much duplication.


---

Comment by jdemeyer created at 2015-02-20 16:57:44

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2015-02-20 16:57:44

Replying to [comment:22 vdelecroix]:
> 1. Do we really want to allow `non exact` coordinate rings with `exact` base ring? You replaced a test about exactness of the base ring with exactness of the coordinate ring.
No, mixing exact and non-exact doesn't really work anyway. I replaced the test because it does a computation with the coordinates. If we ever want to support non-exact coordinate rings with exact base rings, the modification is the right thing to do.

> 2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.
At one point during development of this ticket, I needed an explicit ring to work-around #16399. Instead, #16399 got fixed, so this work-around was no longer needed. I did keep the change to `basis_matrix()`. Does this extra argument really hurt? I could remove it if you want. The implementation is correct though: I think you are confusing the `base_ring` of the matrix with the `coordinate_ring` of the module.

> 3. Do we really need the method `coordinate_ring`/`base_ring` defined on vectors? These are methods of the parent (and are implemented as such). I do not see the point of that much duplication.
Well, we already have `base_ring()` on both the module and the vectors. If you want to change that, please do it on a new ticket. Given that we have `base_ring()` for modules and vectors, it makes a lot of sense to do the same for `coordinate_ring()`. Besides, the `coordinate_ring()` method could really be seen as a method on the vectors: it gives the parent of the entries of the vector.


---

Comment by vdelecroix created at 2015-02-22 10:40:28

Replying to [comment:23 jdemeyer]:
> Replying to [comment:22 vdelecroix]:
> > 2. What is the point of the `ring` argument of `basis_matrix`? Moreover the implementation looks wrong since it returns the matrix `A` (defined over the `coordinate_ring`) as soon as `ring`  is the `base_ring`.
> At one point during development of this ticket, I needed an explicit ring to work-around #16399. Instead, #16399 got fixed, so this work-around was no longer needed. I did keep the change to `basis_matrix()`. Does this extra argument really hurt? I could remove it if you want. The implementation is correct though: I think you are confusing the `base_ring` of the matrix with the `coordinate_ring` of the module.

Could you at least include an example in the documentation?


---

Comment by git created at 2015-02-22 20:33:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-02-22 22:13:13

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-02-24 00:39:23

Resolution: fixed
