# Issue 18357: Add additional mutation options for clusters

Issue created by migration from Trac.

Original creator: aram.dermenjian

Original creation time: 2015-06-02 22:19:57

CC:  egunawan etn40ff




---

Comment by aram.dermenjian created at 2015-06-02 22:22:05

Changing keywords from "" to "SageDays64.5, clusters, mutation, seeds, quiver".


---

Comment by aram.dermenjian created at 2015-06-02 22:22:48

Changing priority from major to trivial.


---

Comment by aram.dermenjian created at 2015-06-02 22:22:48

Changing type from PLEASE CHANGE to enhancement.


---

Comment by aram.dermenjian created at 2015-06-02 22:22:48

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by git created at 2015-06-03 16:23:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2015-06-03 16:28:54

Changing status from new to needs_review.


---

Comment by VivianePons created at 2015-06-03 21:04:56

Changing status from needs_review to needs_work.


---

Comment by VivianePons created at 2015-06-03 21:04:56

I have looked at the documentation and fixed a few things. Here are some Todos:

* Please fill the output section of mutation_analysis 
* Please document the new behavior of the mutate method of a quiver (accepts string) and add examples and tests

After this is done, I can finish reviewing the documentation. I would still need someone who knows more about quivers and cluster algebras to check the mathematical content of the methods (especially mutation_analysis in cluster_seed.py and number_of_edges in quiver.py).


---

Comment by VivianePons created at 2015-06-03 21:06:14

New commits:


---

Comment by git created at 2015-06-04 23:20:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-05 20:47:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-11 03:05:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2015-06-11 03:08:56

Changing priority from trivial to major.


---

Comment by git created at 2015-06-11 17:15:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-12 14:27:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-04 11:27:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2015-07-04 11:29:15

Changing status from needs_work to needs_review.


---

Comment by stumpc5 created at 2015-07-05 00:26:21

Hi,

here are a few first comments quickly glancing through the file, no proper review:

 * please update the author field here appropriately (using full names)
 * update #18615 to duplicate / needs review.
 * update the authors according to http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files
 * update the doc strings according to http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings
 * `_sanitize_init_vars` is not documented. In general, all methods, even internals, needs proper docstrings and doctests. For that, please run `sage --coverage <file>` to see the coverage of methods there.

Cheers, Christian


---

Comment by git created at 2015-07-05 02:58:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2015-07-05 03:01:13

All the fields have been updated as you wanted. For the author field, I didn't know when you and Gregg did the original version and so I didn't put a date for that and instead wrote initial version. If you want, I can go ahead and add it if you provide the date? (Or Gregg provides the date)


---

Comment by stumpc5 created at 2015-07-10 16:33:00

Some more comments:

* Looking at the diff's

  `git diff develop src/sage/combinat/cluster_algebra_quiver/quiver.py`

  I see that you introduce tons of trailing whitespaces (both in `quiver.py` and in `cluster_seed.py`)

* `quiver.py` has changed without acknowledgements in the author fields.

* all tests pass, great!

* 100% coverage, great!

* How do you ensure that `first_sink` and `first_source` actually find the *first*, and what is the **first** (since the vertices are not necessarily labelled by something in a total order)? Do you mean to use `a_sink` and `a_source`?

I don't have the time these days to actually play with the code, but I hope (and expect) that you provided well explained and good doctests! (That at least seems to be the case in the few examples I looked at.) So from my side, this is ready to go.

On the other hand, I would like to have Salvatore and/or Dylan to also look at it again, since they will be modifying the mutation methods afterwards...

Cheers, Christian


---

Comment by stumpc5 created at 2015-07-27 15:47:34

Okay, Salvatore and Dylan had their chance. Once you treated my suggestions above, I will give it a positive review.


---

Comment by etn40ff created at 2015-07-28 16:28:20

`@`Christian
I just got to this after dealing with some other stuff. Are you in a hurry to give a positive review or do I still have some time? It will take me few days to go over all the changes being proposed
S.


---

Comment by stumpc5 created at 2015-07-28 16:33:32

I am not in a hurry -- it's only that Gregg and me are at the same conference, and Gregg would like it to be done soon...


---

Comment by etn40ff created at 2015-07-28 16:35:42

I cant promise I'll be quick but I'll try my best. Shoud the two of you feel I
am taking too long just drop me an e-mail.


---

Comment by gmoose05 created at 2015-07-30 12:15:49

Hi Salvatore, take your time since I'm busy with the conference this week.  But if possible I would like this ticket to be closed next week or so, so that others from the Sage Days will feel more free to post their tickets (since there might be lots of rebases otherwise).

Also several people said they'd be able to contribute more to sage once clusters can have any labels.


---

Comment by gmoose05 created at 2015-07-30 12:17:00

Additionally, I was wondering what the status of your ticket with Dylan for adding g-vectors to cluster seed.  We tried to design this ticket to play nicely with yours based on our discussions and code sharing at sage days.

Cheers, Gregg


---

Comment by gmoose05 created at 2015-07-30 12:17:22

sorry not "adding g-vectors" but the functionalities you demoed


---

Comment by chapoton created at 2015-07-30 12:50:57

i have corrected some problems in the doc
----
New commits:


---

Comment by git created at 2015-08-21 05:39:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gmoose05 created at 2015-08-21 05:42:35

I just uploaded a new version:

1) the boolean flags that were at the end of __init__ are now instead handled by the 'use' commands that were already coded.  

This required other changes to the __init__ command and examples accordingly.

2) Based on Salvatore Stella's feedback, the argument of set_c_matrix() has a new name and the command mutations() has been rewritten to give an error message instead of nothing when mutations aren't being tracked.

Let me know if there are other big changes that should be made before a positive review.

Gregg


---

Comment by git created at 2015-08-21 11:12:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-03 16:11:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2015-09-03 18:33:08

If everyone agrees that the discussed problems with the stuff implemented here can and will be fixed within finite time, I will give this ticket a positive review in order to enable the SageDays participants to submit further work.


---

Comment by stumpc5 created at 2015-09-03 18:35:10

I actually would also be in favour of adding a list of the raised issues concerning this tickets in order to have it written down for future references.


---

Comment by git created at 2015-09-08 04:44:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gmoose05 created at 2015-09-15 20:16:24

For posterity, here is a list of concerns that were raised by Salvatore Stella and Christian Stump regarding the cluster_seed.py file.

These should be taken care of in a future ticket:


* There is a lot of duplicated information in the data structures for
  ClusterSeed. For example, the mutable part of the B matrix is stored at least
  in _M, _B, _BC, and as part of the data structure of _quiver. Similarly
  c-vectors are stored both in _BC and in _C. 

  NOTE: This is currently done to ensure backwards compatibility.  In a future ticket warnings will be set-up and then the old data structures will be phased out.


* In the initialization code there is a jungle of if statements. For example
  the lines in the __init__ command where self._G is defined could instead be

  try:
      self._G = data.g_matrix()
  except:
      pass

  while data.g_matrix() should take care of failing gracefully when the g-matrix
  can't be computed. 

* Did you test how much slower and how much more space-demanding it is, for example, 
  to keep track of c-matrices and g-matrices vs not keeping track of them? If the difference is not noticeable (and we think it will not be) it may be just better to always keep track of them,
  simplify the code and spare the user few boolean flags.

  NOTE: To be able to test whether or not this would speed up computations or free up space, this ticket implemented boolean flags as internal data that allow the user to keep track of less data as one mutates.  After this is successfully merged into sage, we will keep track of whether this improves users' flexibility and computational speed.  If it does not, we can revert to a version with less control and less overhead where all data is kept track of as we mutate.

* Similarly the various use_* functions (and few other bits and pieces) should
  never allow for inconsistent data.  On the one hand it would not be mathematically correct, on the other it  saves a lot of coding time and execution time because one can assume that the
  data structure is consistent and avoid all the checks that are repeatedly done
  right now.

  NOTE: This is currently done to ensure backwards compatibility with commands like reset_cluster and set_cluster.  In these commands, the user can set cluster variables directly but in the new improved data structure, sage keeps track of g-vectors and F-polynomials instead.  This is computationally better because Sage works faster with polynomials than rational functions.  But at the moment, it would be difficult for the user to set F-polynomials directly or to have sage parse a user-chosen cluster into F-polynomials and g-vectors.

  NOTE: A future ticket by Salvatore Stella and Dylan Rupel will work directly with g-vectors and F-polynomials and would allow this parsing to occur.


* Is _sanitize_init_vars the same as (or similar to) sage.structure.parent.normalize_names ?
  If so it might be better to remove redundant code.

  NOTE: I checked this, and I do not believe they are since _sanitize_init_vars would also allow more complicated names like allowing [1,2,5] as a variable name which would be common in cluster algebra theory where Plucker coordinates are cluster variables and have such names.

* cluster_index should take as input a cluster variable not a string and it
  should actually raise an error if the input can't be cast to the right type
  automatically.


Gregg


---

Comment by stumpc5 created at 2015-09-17 09:48:52

Changing status from needs_review to positive_review.


---

Comment by stumpc5 created at 2015-09-17 09:48:52

We gonna move forward!


---

Comment by vbraun created at 2015-09-18 13:03:20

Resolution: fixed
