# Issue 11140: Speed up the computation of the Hilbert basis of a cone

Issue created by migration from https://trac.sagemath.org/ticket/11312

Original creator: vbraun

Original creation time: 2011-05-08 11:27:47

Assignee: mhampton

CC:  novoselt zaf

My first implementation of the Hilbert basis eventually uses PALP to compute the points in the parallelotope spanned by the rays of a simplicial cone. This can be done much faster with just the Smith normal form of the ray matrix.

This makes it easy to compute the points in the semi-open parallelotope, so the actual number of semigroup generators is sometimes less than the PALP version (which computed the integral points in the closure).


---

Comment by vbraun created at 2011-05-08 11:32:58

Changing status from new to needs_review.


---

Comment by novoselt created at 2011-05-21 01:29:07

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2011-05-21 01:29:07

The speed-up looks impressive! About 20x on trivial examples (no surprise here since we are avoiding system calls to both cdd and PALP), on a "complicated" 6-d example that I picked the new version worked for 15sec and the old one didn't finish before my patience ran out ;-) Am I right that this speed is partially due to taking into account the special structure of the polytopes in which you are computing integral points?

There are, however, issues with non-full-dimensional cones::

```
sage: Cone([(1,1), (-1,1)], check=False).Hilbert_basis()
(N(1, 1), N(-1, 1), N(0, 1))
sage: Cone([(1,1,0), (-1,1,0)], check=False).Hilbert_basis()
(N(1, 1, 0), N(-1, 1, 0))
```



---

Comment by vbraun created at 2011-05-21 02:15:51

I think I'm just implementing the same algorithm as PALP would use to enumerate the points in the parallelotope spanned by the rays, though I'm not sure. Essentially you have to compute the Smith form to enumerate the points, the rest is a simple loop. I'll try to get some more info about Palp's inner workings out of Harald Skarke at the Kreuzer Memorial conference. 

And thanks for catching the non-full dimensional cone bug, I should have thought about that but didn't.


---

Comment by vbraun created at 2011-06-03 21:59:15

Fixed:

```
sage: Cone([(1,1), (-1,1)], check=False).Hilbert_basis()
(N(1, 1), N(-1, 1), N(0, 1))
sage: Cone([(1,1,0), (-1,1,0)], check=False).Hilbert_basis()
(N(1, 1, 0), N(-1, 1, 0), N(0, 1, 0))
```



---

Comment by vbraun created at 2011-06-03 21:59:15

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2011-06-04 22:22:10

On further thought, I think its better to also remove non-primitive vectors from the semigroup generators. The new version of the patch saves a few generators, which should speed up the Hilbert basis a little bit.


---

Comment by vbraun created at 2011-06-05 19:34:18

New version of the patch breaks out the `parallelotope_points()` function so it can be reused in #11429


---

Comment by novoselt created at 2011-06-14 21:45:43

Changing keywords from "" to "sd31".


---

Comment by novoselt created at 2011-06-14 21:45:43

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2011-06-16 20:07:07

As the patch has to be adjusted one more time anyway - what do you think about creating some kind of `sage.geometry.misc` module for "helper functions"? Names and rays normalization functions are also natural candidates to go there. This will reduce the potential for circular imports and clarify the structure. `cone.parallelotope_points` seems a bit strange ;-)


---

Comment by novoselt created at 2011-06-16 20:14:46

Ah, this particular function is moved to another place in the next patch anyway!


---

Comment by vbraun created at 2011-06-17 03:19:58

Updated patch


---

Comment by vbraun created at 2011-06-17 03:21:04

Changing status from needs_work to needs_review.


---

Attachment

Good catch! I fixed the offending doctest. Up to the ordering the Hilbert bases before and after the patch are the same, of course.


---

Comment by novoselt created at 2011-06-17 06:59:48

All works now!


---

Comment by novoselt created at 2011-06-17 06:59:48

Changing status from needs_review to positive_review.


---

Comment by novoselt created at 2011-06-17 18:24:11

Two corrections to REST formatting


---

Attachment

I have made tiny adjustments to the patch to make the documentation compile without warnings, I'll leave it at positive review. (Added one column and replaced a quote with a backward one.)

Volker: subsequent patches may need to be rebased.


---

Comment by jdemeyer created at 2011-07-22 12:51:45

Resolution: fixed
