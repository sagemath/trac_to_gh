# Issue 11140: Speed up the computation of the Hilbert basis of a cone

archive/issues_011140.json:
```json
{
    "body": "Assignee: mhampton\n\nCC:  @novoselt @zafeirakopoulos\n\nMy first implementation of the Hilbert basis eventually uses PALP to compute the points in the parallelotope spanned by the rays of a simplicial cone. This can be done much faster with just the Smith normal form of the ray matrix.\n\nThis makes it easy to compute the points in the semi-open parallelotope, so the actual number of semigroup generators is sometimes less than the PALP version (which computed the integral points in the closure).\n\nIssue created by migration from https://trac.sagemath.org/ticket/11312\n\n",
    "created_at": "2011-05-08T11:27:47Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Speed up the computation of the Hilbert basis of a cone",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11140",
    "user": "https://github.com/vbraun"
}
```
Assignee: mhampton

CC:  @novoselt @zafeirakopoulos

My first implementation of the Hilbert basis eventually uses PALP to compute the points in the parallelotope spanned by the rays of a simplicial cone. This can be done much faster with just the Smith normal form of the ray matrix.

This makes it easy to compute the points in the semi-open parallelotope, so the actual number of semigroup generators is sometimes less than the PALP version (which computed the integral points in the closure).

Issue created by migration from https://trac.sagemath.org/ticket/11312





---

archive/issue_comments_121790.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-08T11:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121790",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_121791.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-21T01:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121791",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_121792.json:
```json
{
    "body": "The speed-up looks impressive! About 20x on trivial examples (no surprise here since we are avoiding system calls to both cdd and PALP), on a \"complicated\" 6-d example that I picked the new version worked for 15sec and the old one didn't finish before my patience ran out ;-) Am I right that this speed is partially due to taking into account the special structure of the polytopes in which you are computing integral points?\n\nThere are, however, issues with non-full-dimensional cones::\n\n```\nsage: Cone([(1,1), (-1,1)], check=False).Hilbert_basis()\n(N(1, 1), N(-1, 1), N(0, 1))\nsage: Cone([(1,1,0), (-1,1,0)], check=False).Hilbert_basis()\n(N(1, 1, 0), N(-1, 1, 0))\n```\n",
    "created_at": "2011-05-21T01:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121792",
    "user": "https://github.com/novoselt"
}
```

The speed-up looks impressive! About 20x on trivial examples (no surprise here since we are avoiding system calls to both cdd and PALP), on a "complicated" 6-d example that I picked the new version worked for 15sec and the old one didn't finish before my patience ran out ;-) Am I right that this speed is partially due to taking into account the special structure of the polytopes in which you are computing integral points?

There are, however, issues with non-full-dimensional cones::

```
sage: Cone([(1,1), (-1,1)], check=False).Hilbert_basis()
(N(1, 1), N(-1, 1), N(0, 1))
sage: Cone([(1,1,0), (-1,1,0)], check=False).Hilbert_basis()
(N(1, 1, 0), N(-1, 1, 0))
```




---

archive/issue_comments_121793.json:
```json
{
    "body": "I think I'm just implementing the same algorithm as PALP would use to enumerate the points in the parallelotope spanned by the rays, though I'm not sure. Essentially you have to compute the Smith form to enumerate the points, the rest is a simple loop. I'll try to get some more info about Palp's inner workings out of Harald Skarke at the Kreuzer Memorial conference. \n\nAnd thanks for catching the non-full dimensional cone bug, I should have thought about that but didn't.",
    "created_at": "2011-05-21T02:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121793",
    "user": "https://github.com/vbraun"
}
```

I think I'm just implementing the same algorithm as PALP would use to enumerate the points in the parallelotope spanned by the rays, though I'm not sure. Essentially you have to compute the Smith form to enumerate the points, the rest is a simple loop. I'll try to get some more info about Palp's inner workings out of Harald Skarke at the Kreuzer Memorial conference. 

And thanks for catching the non-full dimensional cone bug, I should have thought about that but didn't.



---

archive/issue_comments_121794.json:
```json
{
    "body": "Fixed:\n\n```\nsage: Cone([(1,1), (-1,1)], check=False).Hilbert_basis()\n(N(1, 1), N(-1, 1), N(0, 1))\nsage: Cone([(1,1,0), (-1,1,0)], check=False).Hilbert_basis()\n(N(1, 1, 0), N(-1, 1, 0), N(0, 1, 0))\n```\n",
    "created_at": "2011-06-03T21:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121794",
    "user": "https://github.com/vbraun"
}
```

Fixed:

```
sage: Cone([(1,1), (-1,1)], check=False).Hilbert_basis()
(N(1, 1), N(-1, 1), N(0, 1))
sage: Cone([(1,1,0), (-1,1,0)], check=False).Hilbert_basis()
(N(1, 1, 0), N(-1, 1, 0), N(0, 1, 0))
```




---

archive/issue_comments_121795.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-03T21:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121795",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_121796.json:
```json
{
    "body": "On further thought, I think its better to also remove non-primitive vectors from the semigroup generators. The new version of the patch saves a few generators, which should speed up the Hilbert basis a little bit.",
    "created_at": "2011-06-04T22:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121796",
    "user": "https://github.com/vbraun"
}
```

On further thought, I think its better to also remove non-primitive vectors from the semigroup generators. The new version of the patch saves a few generators, which should speed up the Hilbert basis a little bit.



---

archive/issue_comments_121797.json:
```json
{
    "body": "New version of the patch breaks out the `parallelotope_points()` function so it can be reused in #11429",
    "created_at": "2011-06-05T19:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121797",
    "user": "https://github.com/vbraun"
}
```

New version of the patch breaks out the `parallelotope_points()` function so it can be reused in #11429



---

archive/issue_comments_121798.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd31\".",
    "created_at": "2011-06-14T21:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121798",
    "user": "https://github.com/novoselt"
}
```

Changing keywords from "" to "sd31".



---

archive/issue_comments_121799.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-14T21:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121799",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_121800.json:
```json
{
    "body": "As the patch has to be adjusted one more time anyway - what do you think about creating some kind of `sage.geometry.misc` module for \"helper functions\"? Names and rays normalization functions are also natural candidates to go there. This will reduce the potential for circular imports and clarify the structure. `cone.parallelotope_points` seems a bit strange ;-)",
    "created_at": "2011-06-16T20:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121800",
    "user": "https://github.com/novoselt"
}
```

As the patch has to be adjusted one more time anyway - what do you think about creating some kind of `sage.geometry.misc` module for "helper functions"? Names and rays normalization functions are also natural candidates to go there. This will reduce the potential for circular imports and clarify the structure. `cone.parallelotope_points` seems a bit strange ;-)



---

archive/issue_comments_121801.json:
```json
{
    "body": "Ah, this particular function is moved to another place in the next patch anyway!",
    "created_at": "2011-06-16T20:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121801",
    "user": "https://github.com/novoselt"
}
```

Ah, this particular function is moved to another place in the next patch anyway!



---

archive/issue_comments_121802.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-06-17T03:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121802",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_121803.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-17T03:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121803",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_121804.json:
```json
{
    "body": "Attachment [trac_11312_speed_up_Hilbert_cone.patch](tarball://root/attachments/some-uuid/ticket11312/trac_11312_speed_up_Hilbert_cone.patch) by @vbraun created at 2011-06-17 03:21:04\n\nGood catch! I fixed the offending doctest. Up to the ordering the Hilbert bases before and after the patch are the same, of course.",
    "created_at": "2011-06-17T03:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121804",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11312_speed_up_Hilbert_cone.patch](tarball://root/attachments/some-uuid/ticket11312/trac_11312_speed_up_Hilbert_cone.patch) by @vbraun created at 2011-06-17 03:21:04

Good catch! I fixed the offending doctest. Up to the ordering the Hilbert bases before and after the patch are the same, of course.



---

archive/issue_comments_121805.json:
```json
{
    "body": "All works now!",
    "created_at": "2011-06-17T06:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121805",
    "user": "https://github.com/novoselt"
}
```

All works now!



---

archive/issue_comments_121806.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-17T06:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121806",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_121807.json:
```json
{
    "body": "Two corrections to REST formatting",
    "created_at": "2011-06-17T18:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121807",
    "user": "https://github.com/novoselt"
}
```

Two corrections to REST formatting



---

archive/issue_comments_121808.json:
```json
{
    "body": "Attachment [trac_11312_speed_up_Hilbert_cone.2.patch](tarball://root/attachments/some-uuid/ticket11312/trac_11312_speed_up_Hilbert_cone.2.patch) by @novoselt created at 2011-06-17 18:31:12\n\nI have made tiny adjustments to the patch to make the documentation compile without warnings, I'll leave it at positive review. (Added one column and replaced a quote with a backward one.)\n\nVolker: subsequent patches may need to be rebased.",
    "created_at": "2011-06-17T18:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121808",
    "user": "https://github.com/novoselt"
}
```

Attachment [trac_11312_speed_up_Hilbert_cone.2.patch](tarball://root/attachments/some-uuid/ticket11312/trac_11312_speed_up_Hilbert_cone.2.patch) by @novoselt created at 2011-06-17 18:31:12

I have made tiny adjustments to the patch to make the documentation compile without warnings, I'll leave it at positive review. (Added one column and replaced a quote with a backward one.)

Volker: subsequent patches may need to be rebased.



---

archive/issue_comments_121809.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-07-22T12:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11140#issuecomment-121809",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_011242.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-22T12:51:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11140",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11140#event-11242"
}
```
