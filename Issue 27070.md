# Issue 27070: incorrect usage of sig_on()/sig_off() in integer_mod.lucas

Issue created by migration from https://trac.sagemath.org/ticket/27307

Original creator: mmezzarobba

Original creation time: 2019-02-17 11:28:27

leading to random failures like

```
File "src/sage/rings/finite_rings/integer_mod.pyx", line 4066, in sage.rings.finite_rings.integer_mod.lucas
Failed example:
    all([lucas(k,p,q,n)[0] == Mod(lucas_number2(k,p,q),n)
         for k in Integers(20)])
Exception raised:
    Traceback (most recent call last):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.finite_rings.integer_mod.lucas[4]>", line 2, in <module>
        for k in Integers(Integer(20))])
      File "sage/rings/finite_rings/integer_mod.pyx", line 4117, in sage.rings.finite_rings.integer_mod.lucas (build/cythonized/sage/rings/finite_rings/integer_mod.c:38600)
        sig_on()
    SystemError: calling remove_from_pari_stack() inside sig_on()
```



---

Comment by mmezzarobba created at 2019-02-17 12:29:11

Changing type from PLEASE CHANGE to defect.


---

Comment by mmezzarobba created at 2019-02-17 12:29:11

New commits:


---

Comment by mmezzarobba created at 2019-02-17 12:29:11

Changing component from PLEASE CHANGE to finite rings.


---

Comment by mmezzarobba created at 2019-02-17 12:29:11

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2019-02-17 12:29:11

Changing priority from major to minor.


---

Comment by chapoton created at 2019-02-17 16:25:36

duplicate of #27282 ?


---

Comment by mmezzarobba created at 2019-02-17 18:15:15

Indeed, thanks!


---

Comment by mmezzarobba created at 2019-02-17 18:15:15

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2019-02-18 06:56:15

Resolution: duplicate
