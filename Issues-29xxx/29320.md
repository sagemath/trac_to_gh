# Issue 29320: downgrade various sagenb deps to optional

archive/issues_029083.json:
```json
{
    "body": "This includes `twisted` and `flask*` packages.\n\n**CC:**  @slel @kiwifb\n\n**Keywords:** sagenb, dependencies, optional\n\n**Branch:** [d93d9d17eaff16185b810af629d65e78d17aad5d](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, John Palmieri\n\nIssue created by migration from https://trac.sagemath.org/ticket/29320\n\n",
    "closed_at": "2020-03-18T22:40:42Z",
    "created_at": "2020-03-12T18:22:28Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "downgrade various sagenb deps to optional",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/29320",
    "user": "https://github.com/dimpase"
}
```
This includes `twisted` and `flask*` packages.

**CC:**  @slel @kiwifb

**Keywords:** sagenb, dependencies, optional

**Branch:** [d93d9d17eaff16185b810af629d65e78d17aad5d](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)

**Reviewer:** Dima Pasechnik

**Author:** Frédéric Chapoton, John Palmieri

Issue created by migration from https://trac.sagemath.org/ticket/29320





---

archive/issue_events_260848.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-03-12T21:41:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260848"
}
```



---

archive/issue_comments_462723.json:
```json
{
    "body": "**Commit:** [89d2a99c96a7197de4b15818692519939d5639f3](https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3)",
    "created_at": "2020-03-12T21:41:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462723",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [89d2a99c96a7197de4b15818692519939d5639f3](https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3)



---

archive/issue_comments_462724.json:
```json
{
    "body": "<a id='comment:1'></a>\nhere is a branch (not tested)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3\">89d2a99</a></td><td><code>change twisted and flask_* to optional packages</code></td></tr></table>\n",
    "created_at": "2020-03-12T21:41:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462724",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
here is a branch (not tested)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3">89d2a99</a></td><td><code>change twisted and flask_* to optional packages</code></td></tr></table>




---

archive/issue_comments_462725.json:
```json
{
    "body": "**Branch:** [u/chapoton/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/29320)",
    "created_at": "2020-03-12T21:41:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462725",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/29320)



---

archive/issue_comments_462726.json:
```json
{
    "body": "**Changing author** from \"Dima Pasechnik\" to \"\".",
    "created_at": "2020-03-12T21:49:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462726",
    "user": "https://github.com/dimpase"
}
```

**Changing author** from "Dima Pasechnik" to "".



---

archive/issue_events_260849.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-12T21:49:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260849"
}
```



---

archive/issue_events_260850.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-12T21:49:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260850"
}
```



---

archive/issue_comments_462727.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-03-12T21:49:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462727",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_462728.json:
```json
{
    "body": "<a id='comment:2'></a>\nYou beat me by 5 minutes :-) \nBut I've tested that this works.",
    "created_at": "2020-03-12T21:49:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462728",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
You beat me by 5 minutes :-) 
But I've tested that this works.



---

archive/issue_comments_462729.json:
```json
{
    "body": "**Author:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2020-03-12T21:50:58Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462729",
    "user": "https://github.com/dimpase"
}
```

**Author:** Frédéric Chapoton



---

archive/issue_comments_462730.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-this inculdes `twisted` and `flask*` packages\n+This includes `twisted` and `flask*` packages.\n``````\n",
    "created_at": "2020-03-13T18:12:00Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462730",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-this inculdes `twisted` and `flask*` packages
+This includes `twisted` and `flask*` packages.
``````




---

archive/issue_comments_462731.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sagenb, dependencies, optional\".",
    "created_at": "2020-03-13T18:12:00Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462731",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "" to "sagenb, dependencies, optional".



---

archive/issue_comments_462732.json:
```json
{
    "body": "<a id='comment:5'></a>\n@kiwifb told me that terminado uses twisted, so maybe twisted should be kept as standard. (Also, it should be listed in terminado's dependencies file, if this is accurate.) Can anyone confirm?",
    "created_at": "2020-03-13T20:14:09Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462732",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
@kiwifb told me that terminado uses twisted, so maybe twisted should be kept as standard. (Also, it should be listed in terminado's dependencies file, if this is accurate.) Can anyone confirm?



---

archive/issue_events_260851.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-13T20:14:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260851"
}
```



---

archive/issue_events_260852.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-13T20:14:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260852"
}
```



---

archive/issue_comments_462733.json:
```json
{
    "body": "<a id='comment:6'></a>\nI should have said tornado, I misread the output of my dependency query in gentoo.  That being said terminado depends on tornado.",
    "created_at": "2020-03-13T20:20:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462733",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
I should have said tornado, I misread the output of my dependency query in gentoo.  That being said terminado depends on tornado.



---

archive/issue_comments_462734.json:
```json
{
    "body": "<a id='comment:7'></a>\nthe tests pass, and I manually checked dependencies to make sure that this change  leads to no standard packages missing deps. If there are undeclared deps of untested standard packages, it is a bug.",
    "created_at": "2020-03-13T20:31:47Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462734",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
the tests pass, and I manually checked dependencies to make sure that this change  leads to no standard packages missing deps. If there are undeclared deps of untested standard packages, it is a bug.



---

archive/issue_comments_462735.json:
```json
{
    "body": "<a id='comment:8'></a>\nOther candidates for downgrade: python_openid, speaklater",
    "created_at": "2020-03-13T20:32:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462735",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:8'></a>
Other candidates for downgrade: python_openid, speaklater



---

archive/issue_comments_462736.json:
```json
{
    "body": "<a id='comment:9'></a>\nI think we can downgrade tornado and terminado etc. I don't know who is using them.",
    "created_at": "2020-03-13T20:50:25Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462736",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
I think we can downgrade tornado and terminado etc. I don't know who is using them.



---

archive/issue_comments_462737.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe Jupyter notebook may use these if they are available, but I don't know any details.",
    "created_at": "2020-03-13T21:00:43Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462737",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
The Jupyter notebook may use these if they are available, but I don't know any details.



---

archive/issue_comments_462738.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [@jhpalmieri](#comment%3A10):\n> The Jupyter notebook may use these if they are available, but I don't know any details.\n\nThey are actually mandatory https://github.com/jupyter/notebook/blob/master/setup.py#L99",
    "created_at": "2020-03-13T21:03:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462738",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:11'></a>
Replying to [@jhpalmieri](#comment%3A10):
> The Jupyter notebook may use these if they are available, but I don't know any details.

They are actually mandatory https://github.com/jupyter/notebook/blob/master/setup.py#L99



---

archive/issue_comments_462739.json:
```json
{
    "body": "<a id='comment:12'></a>\nTwisted, on the other hand, looks optional: see \"Prerequisites\" in https://www.tornadoweb.org/. Twisted is only used in `tornado.platform.twisted`: \"This module lets you run applications and libraries written for Twisted in a Tornado application.\"",
    "created_at": "2020-03-13T21:06:04Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462739",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Twisted, on the other hand, looks optional: see "Prerequisites" in https://www.tornadoweb.org/. Twisted is only used in `tornado.platform.twisted`: "This module lets you run applications and libraries written for Twisted in a Tornado application."



---

archive/issue_comments_462740.json:
```json
{
    "body": "<a id='comment:13'></a>\nSo it looks to me like `python_openid`, `speaklater`, and `twisted` could all be removed. Re `twisted` especially, we should not only build and run tests, but also make sure the Jupyter notebook works.",
    "created_at": "2020-03-13T21:08:13Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462740",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
So it looks to me like `python_openid`, `speaklater`, and `twisted` could all be removed. Re `twisted` especially, we should not only build and run tests, but also make sure the Jupyter notebook works.



---

archive/issue_comments_462741.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@dimpase](#comment%3A7):\n> the tests pass\n\nNot for me:\n\n```\n$ ./sage -t src/sage/combinat/root_system/cartan_type.py\nRunning doctests with ID 2020-03-13-16-27-46-31297653.\nGit branch: t/29320/29320\nUsing --optional=build,dochtml,sage\nDoctesting 1 file.\nsage -t --warn-long 69.1 src/sage/combinat/root_system/cartan_type.py\n**********************************************************************\nFile \"src/sage/combinat/root_system/cartan_type.py\", line 3069, in sage.combinat.root_system.cartan_type.CartanType_simple_finite.__setstate__\nFailed example:\n    pg_unpickleModule = unpickle_global('twisted.persisted.styles', 'unpickleModule')\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/persist.pyx\", line 548, in sage.misc.persist.unpickle_global (build/cythonized/sage/misc/persist.c:5033)\n        __import__(module)\n    ModuleNotFoundError: No module named 'twisted'\n\n...\n```",
    "created_at": "2020-03-13T23:29:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462741",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
Replying to [@dimpase](#comment%3A7):
> the tests pass

Not for me:

```
$ ./sage -t src/sage/combinat/root_system/cartan_type.py
Running doctests with ID 2020-03-13-16-27-46-31297653.
Git branch: t/29320/29320
Using --optional=build,dochtml,sage
Doctesting 1 file.
sage -t --warn-long 69.1 src/sage/combinat/root_system/cartan_type.py
**********************************************************************
File "src/sage/combinat/root_system/cartan_type.py", line 3069, in sage.combinat.root_system.cartan_type.CartanType_simple_finite.__setstate__
Failed example:
    pg_unpickleModule = unpickle_global('twisted.persisted.styles', 'unpickleModule')
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/persist.pyx", line 548, in sage.misc.persist.unpickle_global (build/cythonized/sage/misc/persist.c:5033)
        __import__(module)
    ModuleNotFoundError: No module named 'twisted'

...
```



---

archive/issue_comments_462742.json:
```json
{
    "body": "<a id='comment:15'></a>\nIn brief testing, though, the Jupyter notebook looks okay.",
    "created_at": "2020-03-13T23:32:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462742",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
In brief testing, though, the Jupyter notebook looks okay.



---

archive/issue_comments_462743.json:
```json
{
    "body": "<a id='comment:16'></a>\nI propose these changes:\n\n```diff\ndiff --git a/build/pkgs/python_openid/type b/build/pkgs/python_openid/type\nindex a6a7b9cd72..134d9bc32d 100644\n--- a/build/pkgs/python_openid/type\n+++ b/build/pkgs/python_openid/type\n@@ -1 +1 @@\n-standard\n+optional\ndiff --git a/build/pkgs/speaklater/type b/build/pkgs/speaklater/type\nindex a6a7b9cd72..134d9bc32d 100644\n--- a/build/pkgs/speaklater/type\n+++ b/build/pkgs/speaklater/type\n@@ -1 +1 @@\n-standard\n+optional\ndiff --git a/build/pkgs/twisted/type b/build/pkgs/twisted/type\nindex 134d9bc32d..a6a7b9cd72 100644\n--- a/build/pkgs/twisted/type\n+++ b/build/pkgs/twisted/type\n@@ -1 +1 @@\n-optional\n+standard\n```",
    "created_at": "2020-03-13T23:33:35Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462743",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
I propose these changes:

```diff
diff --git a/build/pkgs/python_openid/type b/build/pkgs/python_openid/type
index a6a7b9cd72..134d9bc32d 100644
--- a/build/pkgs/python_openid/type
+++ b/build/pkgs/python_openid/type
@@ -1 +1 @@
-standard
+optional
diff --git a/build/pkgs/speaklater/type b/build/pkgs/speaklater/type
index a6a7b9cd72..134d9bc32d 100644
--- a/build/pkgs/speaklater/type
+++ b/build/pkgs/speaklater/type
@@ -1 +1 @@
-standard
+optional
diff --git a/build/pkgs/twisted/type b/build/pkgs/twisted/type
index 134d9bc32d..a6a7b9cd72 100644
--- a/build/pkgs/twisted/type
+++ b/build/pkgs/twisted/type
@@ -1 +1 @@
-optional
+standard
```



---

archive/issue_comments_462744.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [@jhpalmieri](#comment%3A14):\n> Replying to [@dimpase](#comment%3A7):\n> > the tests pass\n\n> \n> Not for me:\n> \n> ```\n> $ ./sage -t src/sage/combinat/root_system/cartan_type.py\n> ...\n> ```\n\nAdmittedly, this is a doctest for a sort of stupid function: \"Implements the unpickling of Cartan types pickled by Sage <= 4.0.\"",
    "created_at": "2020-03-13T23:36:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462744",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
Replying to [@jhpalmieri](#comment%3A14):
> Replying to [@dimpase](#comment%3A7):
> > the tests pass

> 
> Not for me:
> 
> ```
> $ ./sage -t src/sage/combinat/root_system/cartan_type.py
> ...
> ```

Admittedly, this is a doctest for a sort of stupid function: "Implements the unpickling of Cartan types pickled by Sage <= 4.0."



---

archive/issue_comments_462745.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [@jhpalmieri](#comment%3A17):\n> Replying to [@jhpalmieri](#comment%3A14):\n> > Replying to [@dimpase](#comment%3A7):\n> > > the tests pass\n\n> > \n> > Not for me:\n> > \n> > ```\n> > $ ./sage -t src/sage/combinat/root_system/cartan_type.py\n> > ...\n> > ```\n\n> \n> Admittedly, this is a doctest for a sort of stupid function: \"Implements the unpickling of Cartan types pickled by Sage <= 4.0.\"\n\nOops, I overlooked this, I thought that this must be irrelevant.\n\nLet's just tag it `# optional - twisted`. I don't see a need to keep `twisted` standard just cause of this.",
    "created_at": "2020-03-13T23:41:10Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462745",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Replying to [@jhpalmieri](#comment%3A17):
> Replying to [@jhpalmieri](#comment%3A14):
> > Replying to [@dimpase](#comment%3A7):
> > > the tests pass

> > 
> > Not for me:
> > 
> > ```
> > $ ./sage -t src/sage/combinat/root_system/cartan_type.py
> > ...
> > ```

> 
> Admittedly, this is a doctest for a sort of stupid function: "Implements the unpickling of Cartan types pickled by Sage <= 4.0."

Oops, I overlooked this, I thought that this must be irrelevant.

Let's just tag it `# optional - twisted`. I don't see a need to keep `twisted` standard just cause of this.



---

archive/issue_comments_462746.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/29320)\" to \"[u/jhpalmieri/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/29320)\".",
    "created_at": "2020-03-14T01:02:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462746",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing branch** from "[u/chapoton/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/29320)" to "[u/jhpalmieri/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/29320)".



---

archive/issue_comments_462747.json:
```json
{
    "body": "<a id='comment:20'></a>\nOkay, ready for review. Please check the functionality of the Jupyter notebook; do we lose anything when we build without twisted?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d\">d93d9d1</a></td><td><code>trac 29320: make python_openid and speaklater optional.</code></td></tr></table>\n",
    "created_at": "2020-03-14T01:03:00Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462747",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>
Okay, ready for review. Please check the functionality of the Jupyter notebook; do we lose anything when we build without twisted?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d">d93d9d1</a></td><td><code>trac 29320: make python_openid and speaklater optional.</code></td></tr></table>




---

archive/issue_comments_462748.json:
```json
{
    "body": "**Changing commit** from \"[89d2a99c96a7197de4b15818692519939d5639f3](https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3)\" to \"[d93d9d17eaff16185b810af629d65e78d17aad5d](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)\".",
    "created_at": "2020-03-14T01:03:00Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462748",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing commit** from "[89d2a99c96a7197de4b15818692519939d5639f3](https://github.com/sagemath/sagetrac-mirror/commit/89d2a99c96a7197de4b15818692519939d5639f3)" to "[d93d9d17eaff16185b810af629d65e78d17aad5d](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)".



---

archive/issue_events_260853.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-14T01:03:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260853"
}
```



---

archive/issue_events_260854.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-14T01:03:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260854"
}
```



---

archive/issue_comments_462749.json:
```json
{
    "body": "<a id='comment:22'></a>\nLooking at:\n\n```\n$ cat build/pkgs/sagenb/dependencies \n$(STARTED) | pip babel flask flask_autoindex flask_babel flask_oldsessions flask_openid mathjax twisted sphinx\n\n----------\nAll lines of this file are ignored except the first.\nIt is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.\n```\n\nAre there other dependencies to be removed from being standard? like babel ?",
    "created_at": "2020-03-15T08:23:13Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462749",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:22'></a>
Looking at:

```
$ cat build/pkgs/sagenb/dependencies 
$(STARTED) | pip babel flask flask_autoindex flask_babel flask_oldsessions flask_openid mathjax twisted sphinx

----------
All lines of this file are ignored except the first.
It is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.
```

Are there other dependencies to be removed from being standard? like babel ?



---

archive/issue_comments_462750.json:
```json
{
    "body": "<a id='comment:23'></a>\n`babel` should actually be in the list removed from standard I believe. Thanks for bringing it up. `twisted` seems a bit ambiguous but `mathjax` and `sphinx` should definitely stay standard.",
    "created_at": "2020-03-15T08:57:41Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462750",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
`babel` should actually be in the list removed from standard I believe. Thanks for bringing it up. `twisted` seems a bit ambiguous but `mathjax` and `sphinx` should definitely stay standard.



---

archive/issue_comments_462751.json:
```json
{
    "body": "<a id='comment:24'></a>\n`babel` is listed as a dependency of Sphinx, so it should be kept.",
    "created_at": "2020-03-15T18:06:42Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462751",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>
`babel` is listed as a dependency of Sphinx, so it should be kept.



---

archive/issue_comments_462752.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [@jhpalmieri](#comment%3A24):\n> `babel` is listed as a dependency of Sphinx, so it should be kept.\n\nAh! Sorry, my mistake.",
    "created_at": "2020-03-15T18:57:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462752",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
Replying to [@jhpalmieri](#comment%3A24):
> `babel` is listed as a dependency of Sphinx, so it should be kept.

Ah! Sorry, my mistake.



---

archive/issue_comments_462753.json:
```json
{
    "body": "<a id='comment:26'></a>\nLooks good, but we need to take care of the dependency of that pickle on twisted (on a followup ticket).",
    "created_at": "2020-03-16T16:08:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462753",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>
Looks good, but we need to take care of the dependency of that pickle on twisted (on a followup ticket).



---

archive/issue_comments_462754.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, John Palmieri\".",
    "created_at": "2020-03-16T16:08:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462754",
    "user": "https://github.com/dimpase"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, John Palmieri".



---

archive/issue_events_260855.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-16T16:08:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260855"
}
```



---

archive/issue_events_260856.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-16T16:08:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260856"
}
```



---

archive/issue_comments_462755.json:
```json
{
    "body": "<a id='comment:27'></a>\nI don't understand pickling, but I am tempted to make this change:\n\n```diff\ndiff --git a/src/sage/combinat/root_system/cartan_type.py b/src/sage/combinat/root_system/cartan_type.py\nindex 202e1abe11..3cac952462 100644\n--- a/src/sage/combinat/root_system/cartan_type.py\n+++ b/src/sage/combinat/root_system/cartan_type.py\n@@ -3066,10 +3066,10 @@ class CartanType_simple_finite(object):\n \n             sage: pg_CartanType_simple_finite = unpickle_global('sage.combinat.root_system.cartan_type', 'CartanType_simple_finite')\n             sage: si1 = unpickle_newobj(pg_CartanType_simple_finite, ())\n-            sage: pg_unpickleModule = unpickle_global('twisted.persisted.styles', 'unpickleModule')\n+            sage: from sage.misc.fpickle import unpickleModule\n             sage: pg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')\n             sage: si2 = pg_make_integer('4')\n-            sage: unpickle_build(si1, {'tools':pg_unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})\n+            sage: unpickle_build(si1, {'tools':unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})\n \n             sage: si1\n             ['A', 4]\n```\nI'm building and running tests now.",
    "created_at": "2020-03-16T21:11:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462755",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'></a>
I don't understand pickling, but I am tempted to make this change:

```diff
diff --git a/src/sage/combinat/root_system/cartan_type.py b/src/sage/combinat/root_system/cartan_type.py
index 202e1abe11..3cac952462 100644
--- a/src/sage/combinat/root_system/cartan_type.py
+++ b/src/sage/combinat/root_system/cartan_type.py
@@ -3066,10 +3066,10 @@ class CartanType_simple_finite(object):
 
             sage: pg_CartanType_simple_finite = unpickle_global('sage.combinat.root_system.cartan_type', 'CartanType_simple_finite')
             sage: si1 = unpickle_newobj(pg_CartanType_simple_finite, ())
-            sage: pg_unpickleModule = unpickle_global('twisted.persisted.styles', 'unpickleModule')
+            sage: from sage.misc.fpickle import unpickleModule
             sage: pg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')
             sage: si2 = pg_make_integer('4')
-            sage: unpickle_build(si1, {'tools':pg_unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})
+            sage: unpickle_build(si1, {'tools':unpickleModule('sage.combinat.root_system.type_A'), 't':['A', si2], 'letter':'A', 'n':si2})
 
             sage: si1
             ['A', 4]
```
I'm building and running tests now.



---

archive/issue_comments_462756.json:
```json
{
    "body": "<a id='comment:28'></a>\nSee #29348 for the pickling issue.",
    "created_at": "2020-03-16T22:19:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462756",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>
See #29348 for the pickling issue.



---

archive/issue_events_260857.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-18T22:40:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260857"
}
```



---

archive/issue_events_260858.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a0ee3398205e4d646a56387f74628b9bcc2c22a6",
    "created_at": "2020-03-18T22:40:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29320#event-260858"
}
```



---

archive/issue_comments_462757.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/29320)\" to \"[d93d9d17eaff16185b810af629d65e78d17aad5d](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)\".",
    "created_at": "2020-03-18T22:40:42Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462757",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jhpalmieri/29320](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/29320)" to "[d93d9d17eaff16185b810af629d65e78d17aad5d](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)".



---

archive/issue_comments_462758.json:
```json
{
    "body": "**Changing commit** from \"[d93d9d17eaff16185b810af629d65e78d17aad5d](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)\" to \"\".",
    "created_at": "2020-05-28T17:20:48Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462758",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing commit** from "[d93d9d17eaff16185b810af629d65e78d17aad5d](https://github.com/sagemath/sagetrac-mirror/commit/d93d9d17eaff16185b810af629d65e78d17aad5d)" to "".



---

archive/issue_comments_462759.json:
```json
{
    "body": "<a id='comment:30'></a>\nFollowup at #29752: werkzeug can be optional, too.",
    "created_at": "2020-05-28T17:20:48Z",
    "issue": "https://github.com/sagemath/sage/issues/29320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29320#issuecomment-462759",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>
Followup at #29752: werkzeug can be optional, too.
