# Issue 29471: Failing doctest in R interface due to missing lattice library

archive/issues_029234.json:
```json
{
    "assignees": [],
    "body": "During automated testing with [GitHub](../wiki/GitHub) actions we get the following error on many debian and ubuntu distros:\n\n```\nsage -t src/sage/interfaces/r.py\n**********************************************************************\nFile \"src/sage/interfaces/r.py\", line 1318, in sage.interfaces.r.R.plot\nFailed example:\n    r.library(\"lattice\")\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.r.R.plot[5]>\", line 1, in <module>\n        r.library(\"lattice\")\n      File \"/sage/local/lib/python2.7/site-packages/sage/interfaces/r.py\", line 863, in library\n        raise ImportError(\"R library {} not installed\".format(library_name))\n    ImportError: R library lattice not installed\n```\n\nsee e.g. [https://github.com/mkoeppe/sage/runs/542655815](https://github.com/mkoeppe/sage/runs/542655815).\n\nWe fix this by adding the package `r-cran-lattice` to `build/pkgs/r/distros/debian.txt`.\n\nIn general this is expected behavior. If you skip the recommended packages of R (on your system) then your R interface in sage will not have all features. The error message is meaningful and the user should know what to do about it.\n\nCC:  tmonteil @kiwifb @isuruf @EmmanuelCharpentier @embray @dimpase\n\nKeywords: **R, spkg-configure, lattice library**\n\nBranch/Commit: **[65a3101](https://github.com/sagemath/sagetrac-mirror/commit/65a31019a4af6a39b89ad903b378fa19ea303edb)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Jonathan Kliem**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29471_\n\n",
    "closed_at": "2020-04-12T15:34:20Z",
    "created_at": "2020-04-06T09:05:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Failing doctest in R interface due to missing lattice library",
    "type": "issue",
    "updated_at": "2020-04-12T15:34:20Z",
    "url": "https://github.com/sagemath/sage/issues/29471",
    "user": "https://github.com/kliem"
}
```
During automated testing with [GitHub](../wiki/GitHub) actions we get the following error on many debian and ubuntu distros:

```
sage -t src/sage/interfaces/r.py
**********************************************************************
File "src/sage/interfaces/r.py", line 1318, in sage.interfaces.r.R.plot
Failed example:
    r.library("lattice")
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.r.R.plot[5]>", line 1, in <module>
        r.library("lattice")
      File "/sage/local/lib/python2.7/site-packages/sage/interfaces/r.py", line 863, in library
        raise ImportError("R library {} not installed".format(library_name))
    ImportError: R library lattice not installed
```

see e.g. [https://github.com/mkoeppe/sage/runs/542655815](https://github.com/mkoeppe/sage/runs/542655815).

We fix this by adding the package `r-cran-lattice` to `build/pkgs/r/distros/debian.txt`.

In general this is expected behavior. If you skip the recommended packages of R (on your system) then your R interface in sage will not have all features. The error message is meaningful and the user should know what to do about it.

CC:  tmonteil @kiwifb @isuruf @EmmanuelCharpentier @embray @dimpase

Keywords: **R, spkg-configure, lattice library**

Branch/Commit: **[65a3101](https://github.com/sagemath/sagetrac-mirror/commit/65a31019a4af6a39b89ad903b378fa19ea303edb)**

Reviewer: **Matthias Koeppe**

Author: **Jonathan Kliem**

_Issue created by migration from https://trac.sagemath.org/ticket/29471_





---

archive/issue_events_373620.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-06T09:05:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373620"
}
```



---

archive/issue_events_373621.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-06T09:05:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373621"
}
```



---

archive/issue_events_373622.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-06T09:05:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373622"
}
```



---

archive/issue_events_373623.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-06T09:05:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373623"
}
```



---

archive/issue_comments_466146.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nThat is very interesting, and could only have happened as we allows system R now in some circumstances.  I would be willing to bet there are other standard libraries that not every system R has that we configured to build in \"our\" R - maybe this ticket should be to ensure that system R has *all* of them.  (They are really very standard so it's not a big burden, and if someone really wants to use a system R without them, then they just get failing doctests.)\n\nIn any case, don't do this as `not tested`, though - we would still want to test that Sage-the-library built from scratch passes its own doctests.",
    "created_at": "2020-04-06T13:10:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466146",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'>Comment 1:</a>
That is very interesting, and could only have happened as we allows system R now in some circumstances.  I would be willing to bet there are other standard libraries that not every system R has that we configured to build in "our" R - maybe this ticket should be to ensure that system R has *all* of them.  (They are really very standard so it's not a big burden, and if someone really wants to use a system R without them, then they just get failing doctests.)

In any case, don't do this as `not tested`, though - we would still want to test that Sage-the-library built from scratch passes its own doctests.



---

archive/issue_comments_466147.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nOn Debian and Ubuntu r-cran-lattice is a recommended package for r-base-core https://packages.debian.org/buster/r-recommended (part of r-recommended).\n\nIf we require those packages in order to use the system R, we should do so at configure.\n\nIf we want this to be optional and still want to keep the doctest, I think we would need some flag like `# optional -- r-recommended`. I don't know if this is even possible.",
    "created_at": "2020-04-06T14:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466147",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'>Comment 2:</a>
On Debian and Ubuntu r-cran-lattice is a recommended package for r-base-core https://packages.debian.org/buster/r-recommended (part of r-recommended).

If we require those packages in order to use the system R, we should do so at configure.

If we want this to be optional and still want to keep the doctest, I think we would need some flag like `# optional -- r-recommended`. I don't know if this is even possible.



---

archive/issue_comments_466148.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nFor context, in the automatic tests defined by `tox.ini` and `build/bin/write-dockerfile.sh` (which is what is run on [GitHub](../wiki/GitHub) Actions), packages are installed on Debian distributions using `apt-get install --no-install-recommends`. \n\nIf the `lattice` package is important (I don't know as I don't use R), we can certainly add `r-cran-lattice` to `build/pkgs/r/distros/debian.txt`.",
    "created_at": "2020-04-06T16:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466148",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'>Comment 3:</a>
For context, in the automatic tests defined by `tox.ini` and `build/bin/write-dockerfile.sh` (which is what is run on [GitHub](../wiki/GitHub) Actions), packages are installed on Debian distributions using `apt-get install --no-install-recommends`. 

If the `lattice` package is important (I don't know as I don't use R), we can certainly add `r-cran-lattice` to `build/pkgs/r/distros/debian.txt`.



---

archive/issue_comments_466149.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nThanks for clarifying. Then this is almost expected behavior. If you use a system `R` which doesn't have all recommended packages than you will have limited functionality. I would add that line just to make the [GitHub](../wiki/GitHub) actions pass. This is a small package (only around 1 MB if you already install r-base-core, which we do).",
    "created_at": "2020-04-06T17:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466149",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'>Comment 4:</a>
Thanks for clarifying. Then this is almost expected behavior. If you use a system `R` which doesn't have all recommended packages than you will have limited functionality. I would add that line just to make the [GitHub](../wiki/GitHub) actions pass. This is a small package (only around 1 MB if you already install r-base-core, which we do).



---

archive/issue_comments_466150.json:
```json
{
    "body": "Branch: **[public/29471](https://github.com/sagemath/sagetrac-mirror/tree/public/29471)**",
    "created_at": "2020-04-06T17:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466150",
    "user": "https://github.com/kliem"
}
```

Branch: **[public/29471](https://github.com/sagemath/sagetrac-mirror/tree/public/29471)**



---

archive/issue_events_373624.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-06T17:25:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373624"
}
```



---

archive/issue_comments_466151.json:
```json
{
    "body": "Commit: **[6a45805](https://github.com/sagemath/sagetrac-mirror/commit/6a4580546f25fa62f38b3490e2d0120975371379)**",
    "created_at": "2020-04-06T17:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466151",
    "user": "https://github.com/kliem"
}
```

Commit: **[6a45805](https://github.com/sagemath/sagetrac-mirror/commit/6a4580546f25fa62f38b3490e2d0120975371379)**



---

archive/issue_comments_466152.json:
```json
{
    "body": "Author: **Jonathan Kliem**",
    "created_at": "2020-04-06T17:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466152",
    "user": "https://github.com/kliem"
}
```

Author: **Jonathan Kliem**



---

archive/issue_comments_466153.json:
```json
{
    "body": "Changed commit from **[6a45805](https://github.com/sagemath/sagetrac-mirror/commit/6a4580546f25fa62f38b3490e2d0120975371379)** to **[65a3101](https://github.com/sagemath/sagetrac-mirror/commit/65a31019a4af6a39b89ad903b378fa19ea303edb)**",
    "created_at": "2020-04-06T17:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466153",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6a45805](https://github.com/sagemath/sagetrac-mirror/commit/6a4580546f25fa62f38b3490e2d0120975371379)** to **[65a3101](https://github.com/sagemath/sagetrac-mirror/commit/65a31019a4af6a39b89ad903b378fa19ea303edb)**



---

archive/issue_comments_466154.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65a31019a4af6a39b89ad903b378fa19ea303edb\">65a3101</a></td><td><code>add r-cran-lattice for github workflows</code></td></tr></table>\n",
    "created_at": "2020-04-06T17:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466154",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65a31019a4af6a39b89ad903b378fa19ea303edb">65a3101</a></td><td><code>add r-cran-lattice for github workflows</code></td></tr></table>




---

archive/issue_comments_466155.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThis seems to work:\n\nhttps://github.com/kliem/sage-test-27122/actions/runs/72102779",
    "created_at": "2020-04-07T09:04:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466155",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'>Comment 7:</a>
This seems to work:

https://github.com/kliem/sage-test-27122/actions/runs/72102779



---

archive/issue_comments_466156.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+During automated testing with [GitHub](../wiki/GitHub) actions we get the following error on many debian and ubuntu distros:\n \n ```\n sage -t src/sage/interfaces/r.py\n@@ -20,4 +21,6 @@\n \n see e.g. [https://github.com/mkoeppe/sage/runs/542655815](https://github.com/mkoeppe/sage/runs/542655815).\n \n-Either we should require the lattice library to be installed for using the system R or we should mark this doctest as `# not tested`.\n+We fix this by adding the package `r-cran-lattice` to `build/pkgs/r/distros/debian.txt`.\n+\n+In general this is expected behavior. If you skip the recommended packages of R (on your system) then your R interface in sage will not have all features. The error message is meaningful and the user should know what to do about it.\n``````\n",
    "created_at": "2020-04-07T09:17:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466156",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+During automated testing with [GitHub](../wiki/GitHub) actions we get the following error on many debian and ubuntu distros:
 
 ```
 sage -t src/sage/interfaces/r.py
@@ -20,4 +21,6 @@
 
 see e.g. [https://github.com/mkoeppe/sage/runs/542655815](https://github.com/mkoeppe/sage/runs/542655815).
 
-Either we should require the lattice library to be installed for using the system R or we should mark this doctest as `# not tested`.
+We fix this by adding the package `r-cran-lattice` to `build/pkgs/r/distros/debian.txt`.
+
+In general this is expected behavior. If you skip the recommended packages of R (on your system) then your R interface in sage will not have all features. The error message is meaningful and the user should know what to do about it.
``````




---

archive/issue_events_373625.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-08T01:13:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373625"
}
```



---

archive/issue_events_373626.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-08T01:13:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373626"
}
```



---

archive/issue_comments_466157.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2020-04-08T01:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466157",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_comments_466158.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nLGTM",
    "created_at": "2020-04-08T01:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466158",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
LGTM



---

archive/issue_comments_466159.json:
```json
{
    "body": "Changed branch from **[public/29471](https://github.com/sagemath/sagetrac-mirror/tree/public/29471)** to **[65a3101](https://github.com/sagemath/sagetrac-mirror/commit/65a31019a4af6a39b89ad903b378fa19ea303edb)**",
    "created_at": "2020-04-12T15:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29471#issuecomment-466159",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/29471](https://github.com/sagemath/sagetrac-mirror/tree/public/29471)** to **[65a3101](https://github.com/sagemath/sagetrac-mirror/commit/65a31019a4af6a39b89ad903b378fa19ea303edb)**



---

archive/issue_events_373627.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-12T15:34:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373627"
}
```



---

archive/issue_events_373628.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "002aaa0be7f295d74dae1ce459e11df4c5ad5188",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-04-12T15:34:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29471",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29471#event-373628"
}
```
