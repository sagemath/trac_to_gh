# Issue 29777: xgcd for polynomials over padic rings

archive/issues_029540.json:
```json
{
    "body": "Currently, padic rings do not support xgcd. In this ticket we add code to implement the (currently mathematically incorrect) padic gcd for padic rings via `_xgcd_univariate_polynomial`, with a warning stating that xgcd could be incorrect.\n\nCC:  @bhutz @pfili @saraedum @roed314\n\nKeywords: gsoc20\n\nBranch/Commit: 8c47b6ef7ce72dd43b6cba6a4d00ebddf48298d6\n\nReviewer: Ben Hutz\n\nAuthor: Alex Galarraga\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29777\n\n",
    "closed_at": "2020-07-28T22:31:49Z",
    "created_at": "2020-06-01T16:15:12Z",
    "labels": [
        "component: padics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "xgcd for polynomials over padic rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29777",
    "user": "https://github.com/EnderWannabe"
}
```
Currently, padic rings do not support xgcd. In this ticket we add code to implement the (currently mathematically incorrect) padic gcd for padic rings via `_xgcd_univariate_polynomial`, with a warning stating that xgcd could be incorrect.

CC:  @bhutz @pfili @saraedum @roed314

Keywords: gsoc20

Branch/Commit: 8c47b6ef7ce72dd43b6cba6a4d00ebddf48298d6

Reviewer: Ben Hutz

Author: Alex Galarraga

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29777





---

archive/issue_comments_447031.json:
```json
{
    "body": "Attachment [Untitled.ipynb](tarball://root/attachments/some-uuid/ticket29777/Untitled.ipynb) by @EnderWannabe created at 2020-06-01 16:15:52",
    "created_at": "2020-06-01T16:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447031",
    "user": "https://github.com/EnderWannabe"
}
```

Attachment [Untitled.ipynb](tarball://root/attachments/some-uuid/ticket29777/Untitled.ipynb) by @EnderWannabe created at 2020-06-01 16:15:52



---

archive/issue_comments_447032.json:
```json
{
    "body": "<a id='comment:2'></a>if it's ready, you need to change the status to \"needs review\" and to fill the Authors field (above here) to your full name\n\n---\nNew commits:",
    "created_at": "2020-06-01T19:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447032",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>if it's ready, you need to change the status to "needs review" and to fill the Authors field (above here) to your full name

---
New commits:



---

archive/issue_comments_447033.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-01T19:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447033",
    "user": "https://github.com/EnderWannabe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_447034.json:
```json
{
    "body": "<a id='comment:4'></a>I would check that the precision behavior works as expected, and make sure that it works over `Zp` not just `Qp`.",
    "created_at": "2020-06-01T19:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447034",
    "user": "https://github.com/roed314"
}
```

<a id='comment:4'></a>I would check that the precision behavior works as expected, and make sure that it works over `Zp` not just `Qp`.



---

archive/issue_comments_447035.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T23:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447036.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:4 roed]:\n> I would check that the precision behavior works as expected, and make sure that it works over `Zp` not just `Qp`.\n\n\nPrecision behavior works as expect, however low precision computations break over `Zp`:\n\n```\nsage: R.<x> = Zp(3,1)[]\nsage: f = 3*x + 7\nsage: g = 2*x + 3\nsage: f.gcd(f*g).is_one()\nTrue\n```\n\nTo fix this, we pass to Qp to do the computation and then clear denominators. This is done in the _xgcd_univariate_polynomial function under pAdicRingGeneric. Incidentally, this also implements xgcd for pAdic rings.\n\nAlso, the old gcd function in polynomial_padic_capped_relative_dense is removed, as it is no longer needed.",
    "created_at": "2020-06-02T23:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447036",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:7'></a>Replying to [comment:4 roed]:
> I would check that the precision behavior works as expected, and make sure that it works over `Zp` not just `Qp`.


Precision behavior works as expect, however low precision computations break over `Zp`:

```
sage: R.<x> = Zp(3,1)[]
sage: f = 3*x + 7
sage: g = 2*x + 3
sage: f.gcd(f*g).is_one()
True
```

To fix this, we pass to Qp to do the computation and then clear denominators. This is done in the _xgcd_univariate_polynomial function under pAdicRingGeneric. Incidentally, this also implements xgcd for pAdic rings.

Also, the old gcd function in polynomial_padic_capped_relative_dense is removed, as it is no longer needed.



---

archive/issue_comments_447037.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-16T16:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447037",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447038.json:
```json
{
    "body": "<a id='comment:8'></a>I've been running of few of the examples in 13439 to see if those work now. For the most part I'm getting the correct answers. However, this seems weird\n\n```\nsage: R.<t> = ZpCA(7,20)[]\nsage: (t^3).gcd( t^5 )\n(1 + O(7^20))*t^3 + O(7^20)*t^2 + O(7^20)*t + O(7^20)\n```\n\n```\nsage: R.<t> = Zp(7,20)[]\nsage: (t^3).gcd( t^5 )\n(1 + O(7^20))*t^3\n```\n\n\nA few other minor things\n\n- you need INPUT and OUTPUT blocks\n\n- why do you need args and kwds   (also note the standard spelling of kwds)\n\n- you can use self instead of arg[0]\n\n- first line description of function should end in a period.",
    "created_at": "2020-06-16T16:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447038",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'></a>I've been running of few of the examples in 13439 to see if those work now. For the most part I'm getting the correct answers. However, this seems weird

```
sage: R.<t> = ZpCA(7,20)[]
sage: (t^3).gcd( t^5 )
(1 + O(7^20))*t^3 + O(7^20)*t^2 + O(7^20)*t + O(7^20)
```

```
sage: R.<t> = Zp(7,20)[]
sage: (t^3).gcd( t^5 )
(1 + O(7^20))*t^3
```


A few other minor things

- you need INPUT and OUTPUT blocks

- why do you need args and kwds   (also note the standard spelling of kwds)

- you can use self instead of arg[0]

- first line description of function should end in a period.



---

archive/issue_comments_447039.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-17T19:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447039",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447040.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:8 bhutz]:\n>However, this seems weird\n> \n> {{{\n> sage: R.<t> = ZpCA(7,20)[]\n> sage: (t^3).gcd( t^5 )\n> (1 + O(7<sup>20))*t</sup>3 + O(7<sup>20)*t</sup>2 + O(7^20)*t + O(7^20)\n> }}}\n\n\nApparently that is t^3:\n\n```\nsage: (t^3).gcd( t^5 ) == t^3\nTrue\n```\n\n> - you need INPUT and OUTPUT blocks\n\n\nDone!\n\n> - why do you need args and kwds   (also note the standard spelling of kwds)\n\n\nRemoved!\n\n> - first line description of function should end in a period.\n\n\nDone!",
    "created_at": "2020-06-17T19:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447040",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:10'></a>Replying to [comment:8 bhutz]:
>However, this seems weird
> 
> {{{
> sage: R.<t> = ZpCA(7,20)[]
> sage: (t^3).gcd( t^5 )
> (1 + O(7<sup>20))*t</sup>3 + O(7<sup>20)*t</sup>2 + O(7^20)*t + O(7^20)
> }}}


Apparently that is t^3:

```
sage: (t^3).gcd( t^5 ) == t^3
True
```

> - you need INPUT and OUTPUT blocks


Done!

> - why do you need args and kwds   (also note the standard spelling of kwds)


Removed!

> - first line description of function should end in a period.


Done!



---

archive/issue_comments_447041.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-19T19:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447041",
    "user": "https://github.com/EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447042.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-22T18:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447042",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447043.json:
```json
{
    "body": "<a id='comment:13'></a>I've pushed a branch with two minor doc fixes. However, I'm getting some doctest errors\n\n```\nFile \"src/sage/rings/padics/generic_nodes.py\", line 776, in sage.rings.padics.generic_nodes.pAdicRingGeneric._xgcd_univariate_polynomial\nFailed example:\n    f.xgcd(f*g)\nExpected:\n    ((3 + O(3^4))*x + 1 + 2*3 + O(3^3), 0, 1 + O(3^3))\nGot:\n    ((3 + O(3^4))*x + 1 + 2*3 + O(3^3), 1 + O(3^3), 0)\n```\n\n```\nFile \"src/sage/rings/padics/generic_nodes.py\", line 782, in sage.rings.padics.generic_nodes.pAdicRingGeneric._xgcd_univariate_polynomial\nFailed example:\n    f.xgcd(f*g)\nExpected:\n    ((3^9 + O(3^29))*x + 2 + 2*3 + 3^2 + 2*3^5 + 3^6 + 3^7 + 3^8 + 3^10 + 3^11 + 2*3^13 + 3^14 + 3^16 + 2*3^19 + O(3^20), 0, 1 + 2*3^2 + 3^4 + 2*3^5 + 3^6 + 3^7 + 2*3^8 + 2*3^10 + 2*3^12 + 3^13 + 3^14 + 3^15 + 2*3^17 + 3^18 + O(3^20))\nGot:\n    ((3^9 + O(3^29))*x + 2 + 2*3 + 3^2 + 2*3^5 + 3^6 + 3^7 + 3^8 + 3^10 + 3^11 + 2*3^13 + 3^14 + 3^16 + 2*3^19 + O(3^20),\n     1 + 2*3^2 + 3^4 + 2*3^5 + 3^6 + 3^7 + 2*3^8 + 2*3^10 + 2*3^12 + 3^13 + 3^14 + 3^15 + 2*3^17 + 3^18 + O(3^20),\n     0)\n```\n\n---\nNew commits:",
    "created_at": "2020-06-22T18:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447043",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:13'></a>I've pushed a branch with two minor doc fixes. However, I'm getting some doctest errors

```
File "src/sage/rings/padics/generic_nodes.py", line 776, in sage.rings.padics.generic_nodes.pAdicRingGeneric._xgcd_univariate_polynomial
Failed example:
    f.xgcd(f*g)
Expected:
    ((3 + O(3^4))*x + 1 + 2*3 + O(3^3), 0, 1 + O(3^3))
Got:
    ((3 + O(3^4))*x + 1 + 2*3 + O(3^3), 1 + O(3^3), 0)
```

```
File "src/sage/rings/padics/generic_nodes.py", line 782, in sage.rings.padics.generic_nodes.pAdicRingGeneric._xgcd_univariate_polynomial
Failed example:
    f.xgcd(f*g)
Expected:
    ((3^9 + O(3^29))*x + 2 + 2*3 + 3^2 + 2*3^5 + 3^6 + 3^7 + 3^8 + 3^10 + 3^11 + 2*3^13 + 3^14 + 3^16 + 2*3^19 + O(3^20), 0, 1 + 2*3^2 + 3^4 + 2*3^5 + 3^6 + 3^7 + 2*3^8 + 2*3^10 + 2*3^12 + 3^13 + 3^14 + 3^15 + 2*3^17 + 3^18 + O(3^20))
Got:
    ((3^9 + O(3^29))*x + 2 + 2*3 + 3^2 + 2*3^5 + 3^6 + 3^7 + 3^8 + 3^10 + 3^11 + 2*3^13 + 3^14 + 3^16 + 2*3^19 + O(3^20),
     1 + 2*3^2 + 3^4 + 2*3^5 + 3^6 + 3^7 + 2*3^8 + 2*3^10 + 2*3^12 + 3^13 + 3^14 + 3^15 + 2*3^17 + 3^18 + O(3^20),
     0)
```

---
New commits:



---

archive/issue_comments_447044.json:
```json
{
    "body": "<a id='comment:15'></a>As saraedum has kindly pointed out, xgcd is still broken. So, we change the scope of the ticket to implementing the (broken) xgcd for padic rings, and re add the warning.\n\n---\nNew commits:",
    "created_at": "2020-06-26T20:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447044",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:15'></a>As saraedum has kindly pointed out, xgcd is still broken. So, we change the scope of the ticket to implementing the (broken) xgcd for padic rings, and re add the warning.

---
New commits:



---

archive/issue_comments_447045.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-01T18:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447045",
    "user": "https://github.com/EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447046.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-08T17:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447046",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447047.json:
```json
{
    "body": "<a id='comment:17'></a>Functionality wise, this ticket is fine with the adjusted scope.\n\nI'm marking it as needs-works just to have you update the title/description to match the new scope.",
    "created_at": "2020-07-08T17:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447047",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:17'></a>Functionality wise, this ticket is fine with the adjusted scope.

I'm marking it as needs-works just to have you update the title/description to match the new scope.



---

archive/issue_comments_447048.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,23 +1,4 @@\n-Ticket #13439 states that xgcd is incorrect for padic polynomials. However, it appears that the issues in #13439 have been solved:\n-\n-```\n-sage: R.<x> = Qp(3,3)[]\n-sage: f = 3*x + 7\n-sage: g = 5*x + 9\n-sage: f.xgcd(f*g)[0].is_one()\n-False\n-\n-\n-sage: R.<x> = Qp(3)[]\n-sage: f = 490473657*x + 257392844/729\n-sage: g = 225227399/59049*x - 8669753175\n-sage: f.xgcd(f*g)[0].is_one()\n-False\n-```\n-\n-Testing on 100,000 random polynomials gives the same results if the gcd is computed over QQ or Qp(5), see attached.\n-\n-We therefore remove the warning.\n+Currently, padic rings do not support xgcd. In this ticket we add code to implement the (currently mathematically incorrect) padic gcd for padic rings, with an error stating that xgcd is incorrect.\n \n Summary: xgcd correct for padic polynomials\n \n``````\n",
    "created_at": "2020-07-13T20:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447048",
    "user": "https://github.com/EnderWannabe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,23 +1,4 @@
-Ticket #13439 states that xgcd is incorrect for padic polynomials. However, it appears that the issues in #13439 have been solved:
-
-```
-sage: R.<x> = Qp(3,3)[]
-sage: f = 3*x + 7
-sage: g = 5*x + 9
-sage: f.xgcd(f*g)[0].is_one()
-False
-
-
-sage: R.<x> = Qp(3)[]
-sage: f = 490473657*x + 257392844/729
-sage: g = 225227399/59049*x - 8669753175
-sage: f.xgcd(f*g)[0].is_one()
-False
-```
-
-Testing on 100,000 random polynomials gives the same results if the gcd is computed over QQ or Qp(5), see attached.
-
-We therefore remove the warning.
+Currently, padic rings do not support xgcd. In this ticket we add code to implement the (currently mathematically incorrect) padic gcd for padic rings, with an error stating that xgcd is incorrect.
 
 Summary: xgcd correct for padic polynomials
 
``````




---

archive/issue_comments_447049.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-13T20:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447049",
    "user": "https://github.com/EnderWannabe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447050.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+Currently, padic rings do not support xgcd. In this ticket we add code to implement the (currently mathematically incorrect) padic gcd for padic rings via ``_xgcd_univariate_polynomial``, with a warning stating that xgcd could be incorrect.\n \n Summary: xgcd correct for padic polynomials\n \n``````\n",
    "created_at": "2020-07-14T18:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447050",
    "user": "https://github.com/bhutz"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+Currently, padic rings do not support xgcd. In this ticket we add code to implement the (currently mathematically incorrect) padic gcd for padic rings via ``_xgcd_univariate_polynomial``, with a warning stating that xgcd could be incorrect.
 
 Summary: xgcd correct for padic polynomials
 
``````




---

archive/issue_comments_447051.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-14T18:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447051",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447052.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+Currently, padic rings do not support xgcd. In this ticket we add code to implement the (currently mathematically incorrect) padic gcd for padic rings via `_xgcd_univariate_polynomial`, with a warning stating that xgcd could be incorrect.\n \n Summary: xgcd correct for padic polynomials\n \n``````\n",
    "created_at": "2020-07-14T18:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447052",
    "user": "https://github.com/bhutz"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+Currently, padic rings do not support xgcd. In this ticket we add code to implement the (currently mathematically incorrect) padic gcd for padic rings via `_xgcd_univariate_polynomial`, with a warning stating that xgcd could be incorrect.
 
 Summary: xgcd correct for padic polynomials
 
``````




---

archive/issue_events_076223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-28T22:31:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29777#event-76223"
}
```



---

archive/issue_comments_447053.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-28T22:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29777#issuecomment-447053",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
