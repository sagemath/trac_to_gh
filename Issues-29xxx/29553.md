# Issue 29553: add a method to test whether a polynomial is symmetric

archive/issues_029316.json:
```json
{
    "assignees": [],
    "body": "As mentioned in [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/Z9YS7Hh146I) it is desirable to have a simple check to test whether a given polynomial is symmetric (with respect to a given permutation group).\n\nThis ticket aims to implement a generic `is_symmetric(self, group=None)` on multivariate polynomials (where the default group is the full symmetric group).\n\nWe also update the check of symmetry in `SymmetricFunctions` so that construction from polynomials get faster. The computation time for\n\n```\nsage: n = 10\nsage: f = x / (1-exp(-x))\nsage: Sym = SymmetricFunctions(QQ)\nsage: P = PolynomialRing(QQ, 'x', n)\nsage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())\nsage: sage: inp = [(var, 0) for var in P.gens()]\nsage: seq_taylor = seq.taylor(*inp, n // 2)\nsage: Sym.e().from_polynomial(P(seq_taylor))\n```\nwent down from a minute to half a second.\n\nCC:  @nbruin @tscrim\n\nBranch/Commit: **[c53ac9b](https://github.com/sagemath/sagetrac-mirror/commit/c53ac9b2267e586bbefd81af5dca9df8d51f9f3c)**\n\nReviewer: **Travis Scrimshaw, Markus Wageringel**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29553_\n\n",
    "closed_at": "2020-05-04T06:40:58Z",
    "created_at": "2020-04-23T10:04:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "add a method to test whether a polynomial is symmetric",
    "type": "issue",
    "updated_at": "2020-05-04T20:06:59Z",
    "url": "https://github.com/sagemath/sage/issues/29553",
    "user": "https://github.com/videlec"
}
```
As mentioned in [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/Z9YS7Hh146I) it is desirable to have a simple check to test whether a given polynomial is symmetric (with respect to a given permutation group).

This ticket aims to implement a generic `is_symmetric(self, group=None)` on multivariate polynomials (where the default group is the full symmetric group).

We also update the check of symmetry in `SymmetricFunctions` so that construction from polynomials get faster. The computation time for

```
sage: n = 10
sage: f = x / (1-exp(-x))
sage: Sym = SymmetricFunctions(QQ)
sage: P = PolynomialRing(QQ, 'x', n)
sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())
sage: sage: inp = [(var, 0) for var in P.gens()]
sage: seq_taylor = seq.taylor(*inp, n // 2)
sage: Sym.e().from_polynomial(P(seq_taylor))
```
went down from a minute to half a second.

CC:  @nbruin @tscrim

Branch/Commit: **[c53ac9b](https://github.com/sagemath/sagetrac-mirror/commit/c53ac9b2267e586bbefd81af5dca9df8d51f9f3c)**

Reviewer: **Travis Scrimshaw, Markus Wageringel**

Author: **Vincent Delecroix**

Component: **algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/29553_





---

archive/issue_events_406503.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-04-23T10:04:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406503"
}
```



---

archive/issue_events_406504.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-04-23T10:04:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406504"
}
```



---

archive/issue_events_406505.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-04-23T10:04:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406505"
}
```



---

archive/issue_events_406506.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-04-23T10:04:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406506"
}
```



---

archive/issue_comments_464954.json:
```json
{
    "body": "Commit: **[41faa3e](https://github.com/sagemath/sagetrac-mirror/commit/41faa3e05669b3d34dfee751a0d32b2712ae60be)**",
    "created_at": "2020-04-23T11:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464954",
    "user": "https://github.com/videlec"
}
```

Commit: **[41faa3e](https://github.com/sagemath/sagetrac-mirror/commit/41faa3e05669b3d34dfee751a0d32b2712ae60be)**



---

archive/issue_comments_464955.json:
```json
{
    "body": "Branch: **[u/vdelecroix/29553](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/29553)**",
    "created_at": "2020-04-23T11:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464955",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/29553](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/29553)**



---

archive/issue_comments_464956.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2020-04-23T11:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464956",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_464957.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41faa3e05669b3d34dfee751a0d32b2712ae60be\">41faa3e</a></td><td><code>is_symmetric for multivariate polynomials</code></td></tr></table>\n",
    "created_at": "2020-04-23T11:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464957",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41faa3e05669b3d34dfee751a0d32b2712ae60be">41faa3e</a></td><td><code>is_symmetric for multivariate polynomials</code></td></tr></table>




---

archive/issue_events_406507.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-04-23T11:46:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406507"
}
```



---

archive/issue_comments_464958.json:
```json
{
    "body": "Changed commit from **[41faa3e](https://github.com/sagemath/sagetrac-mirror/commit/41faa3e05669b3d34dfee751a0d32b2712ae60be)** to **[98db2ca](https://github.com/sagemath/sagetrac-mirror/commit/98db2ca5786f927fe7fa667b66318ef7c9a85880)**",
    "created_at": "2020-04-23T11:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464958",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[41faa3e](https://github.com/sagemath/sagetrac-mirror/commit/41faa3e05669b3d34dfee751a0d32b2712ae60be)** to **[98db2ca](https://github.com/sagemath/sagetrac-mirror/commit/98db2ca5786f927fe7fa667b66318ef7c9a85880)**



---

archive/issue_comments_464959.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98db2ca5786f927fe7fa667b66318ef7c9a85880\">98db2ca</a></td><td><code>documentation fix</code></td></tr></table>\n",
    "created_at": "2020-04-23T11:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464959",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98db2ca5786f927fe7fa667b66318ef7c9a85880">98db2ca</a></td><td><code>documentation fix</code></td></tr></table>




---

archive/issue_comments_464960.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c79429faa8e074989bc407b5dff3ad374a8a513\">7c79429</a></td><td><code>fix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cabb5797586b617e176bcf35678e961cca01cd9\">4cabb57</a></td><td><code>speed up check in SymmetricFunctions</code></td></tr></table>\n",
    "created_at": "2020-04-23T16:31:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464960",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c79429faa8e074989bc407b5dff3ad374a8a513">7c79429</a></td><td><code>fix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cabb5797586b617e176bcf35678e961cca01cd9">4cabb57</a></td><td><code>speed up check in SymmetricFunctions</code></td></tr></table>




---

archive/issue_comments_464961.json:
```json
{
    "body": "Changed commit from **[98db2ca](https://github.com/sagemath/sagetrac-mirror/commit/98db2ca5786f927fe7fa667b66318ef7c9a85880)** to **[4cabb57](https://github.com/sagemath/sagetrac-mirror/commit/4cabb5797586b617e176bcf35678e961cca01cd9)**",
    "created_at": "2020-04-23T16:31:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464961",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[98db2ca](https://github.com/sagemath/sagetrac-mirror/commit/98db2ca5786f927fe7fa667b66318ef7c9a85880)** to **[4cabb57](https://github.com/sagemath/sagetrac-mirror/commit/4cabb5797586b617e176bcf35678e961cca01cd9)**



---

archive/issue_comments_464962.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n As mentioned in [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/Z9YS7Hh146I) it is desirable to have a simple check to test whether a given polynomial is symmetric (with respect to a given permutation group).\n \n This ticket aims to implement a generic `is_symmetric(self, group=None)` on multivariate polynomials (where the default group is the full symmetric group).\n+\n+We also update the check of symmetry in `SymmetricFunctions` so that construction from polynomials get faster. The computation time for\n+\n+```\n+sage: sage: n = 10\n+sage: sage: f = x / (1-exp(-x))\n+sage: sage: Sym = SymmetricFunctions(QQ)\n+sage: sage: P = PolynomialRing(QQ, 'x', n)\n+sage: sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())\n+sage: sage: inp = [(var, 0) for var in P.gens()]\n+sage: seq_taylor = seq.taylor(*inp, n // 2)\n+sage: Sym.e().from_polynomial(P(seq_taylor))\n+```\n+went down from a minute to half a second.\n``````\n",
    "created_at": "2020-04-23T16:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464962",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,17 @@
 As mentioned in [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/Z9YS7Hh146I) it is desirable to have a simple check to test whether a given polynomial is symmetric (with respect to a given permutation group).
 
 This ticket aims to implement a generic `is_symmetric(self, group=None)` on multivariate polynomials (where the default group is the full symmetric group).
+
+We also update the check of symmetry in `SymmetricFunctions` so that construction from polynomials get faster. The computation time for
+
+```
+sage: sage: n = 10
+sage: sage: f = x / (1-exp(-x))
+sage: sage: Sym = SymmetricFunctions(QQ)
+sage: sage: P = PolynomialRing(QQ, 'x', n)
+sage: sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())
+sage: sage: inp = [(var, 0) for var in P.gens()]
+sage: seq_taylor = seq.taylor(*inp, n // 2)
+sage: Sym.e().from_polynomial(P(seq_taylor))
+```
+went down from a minute to half a second.
``````




---

archive/issue_comments_464963.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,11 +5,11 @@\n We also update the check of symmetry in `SymmetricFunctions` so that construction from polynomials get faster. The computation time for\n \n ```\n-sage: sage: n = 10\n-sage: sage: f = x / (1-exp(-x))\n-sage: sage: Sym = SymmetricFunctions(QQ)\n-sage: sage: P = PolynomialRing(QQ, 'x', n)\n-sage: sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())\n+sage: n = 10\n+sage: f = x / (1-exp(-x))\n+sage: Sym = SymmetricFunctions(QQ)\n+sage: P = PolynomialRing(QQ, 'x', n)\n+sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())\n sage: sage: inp = [(var, 0) for var in P.gens()]\n sage: seq_taylor = seq.taylor(*inp, n // 2)\n sage: Sym.e().from_polynomial(P(seq_taylor))\n``````\n",
    "created_at": "2020-04-23T16:36:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464963",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,11 +5,11 @@
 We also update the check of symmetry in `SymmetricFunctions` so that construction from polynomials get faster. The computation time for
 
 ```
-sage: sage: n = 10
-sage: sage: f = x / (1-exp(-x))
-sage: sage: Sym = SymmetricFunctions(QQ)
-sage: sage: P = PolynomialRing(QQ, 'x', n)
-sage: sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())
+sage: n = 10
+sage: f = x / (1-exp(-x))
+sage: Sym = SymmetricFunctions(QQ)
+sage: P = PolynomialRing(QQ, 'x', n)
+sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())
 sage: sage: inp = [(var, 0) for var in P.gens()]
 sage: seq_taylor = seq.taylor(*inp, n // 2)
 sage: Sym.e().from_polynomial(P(seq_taylor))
``````




---

archive/issue_comments_464964.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIt might be good to convert the polynomial to a dictionary first in order to speed up the looking up of coefficients, e.g.:\n\n```diff\n-        for e in self.exponents():\n-            coeff = self[e]\n-            for g in gens:\n-                if self[e.permuted(g)] != coeff:\n-                    return False\n-        return True\n+        pd = self.dict()\n+        return all(pd[e.permuted(g)] == c for e, c in pd.items() for g in gens)\n```\n\nFor the example at hand, this is noticeably faster:\n\n```\nsage: sage: n = 12\n....: sage: f = x / (1-exp(-x))\n....: sage: Sym = SymmetricFunctions(QQ)\n....: sage: P = PolynomialRing(QQ, 'x', n)\n....: sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())\n....: sage: sage: inp = [(var, 0) for var in P.gens()]\n....: sage: seq_taylor = seq.taylor(*inp, n // 2)\n....: sage: g = (P(seq_taylor))\n....: %time g.is_symmetric()\n....:\nCPU times: user 2.48 s, sys: 5.07 ms, total: 2.48 s\nWall time: 2.49 s                                       # before\nCPU times: user 121 ms, sys: 2.11 ms, total: 123 ms\nWall time: 123 ms                                       # after\nTrue\n```\nand even for small polynomials this seems to be at least as fast:\n\n```\nsage: R.<x,y,z> = QQ[]\n....: f = (1 + x^2 + y^2 + z^2)^2\n....: %timeit f.is_symmetric()\n....:\n10000 loops, best of 5: 177 \u00b5s per loop    # before\n10000 loops, best of 5: 64.3 \u00b5s per loop   # after\n```\n\nSecondly, in `permgroup_element.pyx`, there are methods `_act_on_list_on_position` and `_act_on_array_on_position`. Do you think it would be more consistent to add a `PermutationGroupElement._act_on_etuple_on_position`, rather than `ETuple.permuted`?\n\nAlso, you will want to merge #29540.",
    "created_at": "2020-04-23T18:52:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464964",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:6" align="right">comment:6</div>

It might be good to convert the polynomial to a dictionary first in order to speed up the looking up of coefficients, e.g.:

```diff
-        for e in self.exponents():
-            coeff = self[e]
-            for g in gens:
-                if self[e.permuted(g)] != coeff:
-                    return False
-        return True
+        pd = self.dict()
+        return all(pd[e.permuted(g)] == c for e, c in pd.items() for g in gens)
```

For the example at hand, this is noticeably faster:

```
sage: sage: n = 12
....: sage: f = x / (1-exp(-x))
....: sage: Sym = SymmetricFunctions(QQ)
....: sage: P = PolynomialRing(QQ, 'x', n)
....: sage: seq = prod(f.subs({f.default_variable(): var}) for var in P.gens())
....: sage: sage: inp = [(var, 0) for var in P.gens()]
....: sage: seq_taylor = seq.taylor(*inp, n // 2)
....: sage: g = (P(seq_taylor))
....: %time g.is_symmetric()
....:
CPU times: user 2.48 s, sys: 5.07 ms, total: 2.48 s
Wall time: 2.49 s                                       # before
CPU times: user 121 ms, sys: 2.11 ms, total: 123 ms
Wall time: 123 ms                                       # after
True
```
and even for small polynomials this seems to be at least as fast:

```
sage: R.<x,y,z> = QQ[]
....: f = (1 + x^2 + y^2 + z^2)^2
....: %timeit f.is_symmetric()
....:
10000 loops, best of 5: 177 µs per loop    # before
10000 loops, best of 5: 64.3 µs per loop   # after
```

Secondly, in `permgroup_element.pyx`, there are methods `_act_on_list_on_position` and `_act_on_array_on_position`. Do you think it would be more consistent to add a `PermutationGroupElement._act_on_etuple_on_position`, rather than `ETuple.permuted`?

Also, you will want to merge #29540.



---

archive/issue_events_406508.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-23T18:55:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406508"
}
```



---

archive/issue_events_406509.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-23T18:55:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406509"
}
```



---

archive/issue_comments_464965.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@mwageringel](#comment:6):\n> It might be good to convert the polynomial to a dictionary first in order to speed up the looking up of coefficients, e.g.:\n\nIt is sad this is the case. The polynomial datastructure is supposed to be fast in accessing coefficients... I believe it strongly depends on the base ring. But given the time difference I agree that it makes sense.\n\n>\n> <SNIP\n>\n> Secondly, in `permgroup_element.pyx`, there are methods `_act_on_list_on_position` and `_act_on_array_on_position`. Do you think it would be more consistent to add a `PermutationGroupElement._act_on_etuple_on_position`, rather than `ETuple.permuted`?\n\nSure. That will also be convenient for action of permutations on polynomials.\n \n> Also, you will want to merge #29540.\n\nIndeed.",
    "created_at": "2020-04-23T19:13:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464965",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@mwageringel](#comment:6):
> It might be good to convert the polynomial to a dictionary first in order to speed up the looking up of coefficients, e.g.:

It is sad this is the case. The polynomial datastructure is supposed to be fast in accessing coefficients... I believe it strongly depends on the base ring. But given the time difference I agree that it makes sense.

>
> <SNIP
>
> Secondly, in `permgroup_element.pyx`, there are methods `_act_on_list_on_position` and `_act_on_array_on_position`. Do you think it would be more consistent to add a `PermutationGroupElement._act_on_etuple_on_position`, rather than `ETuple.permuted`?

Sure. That will also be convenient for action of permutations on polynomials.
 
> Also, you will want to merge #29540.

Indeed.



---

archive/issue_comments_464966.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@videlec](#comment:8):\n> Replying to [@mwageringel](#comment:6):\n> > It might be good to convert the polynomial to a dictionary first in order to speed up the looking up of coefficients, e.g.:\n\n> \n> It is sad this is the case. The polynomial datastructure is supposed to be fast in accessing coefficients... I believe it strongly depends on the base ring. But given the time difference I agree that it makes sense.\n\nThe `MPolynomial_libsignular.__getitem__` code looks like this:\n\n```python\n        m = p_ISet(1,r)\n        i = 1\n        for e in x:\n            overflow_check(e, r)\n            p_SetExp(m, i, int(e), r)\n            i += 1\n        p_Setm(m, r)\n\n        while(p):\n            if p_ExpVectorEqual(p, m, r) == 1:\n                p_Delete(&m,r)\n                return si2sa(p_GetCoeff(p, r), r, self._parent._base)\n            p = pNext(p)\n```\nSo it looks more like it is going through a list rather than a dict. I don't know how singular does this, but it looks like a very different data structure than the na\u00efve implementation. IIRC, their data structure is solely to be efficient at computing Gr\u00f6bner bases.\n\nTL;DR Converting to a dict is definitely the best option with the current implementation.\n\nAs a more broader question, it might be worthwhile to consider reimplementing generic multivariate polynomials in Cython and only convert to (lib)singular when wanting a Gr\u00f6bner basis.",
    "created_at": "2020-04-23T23:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464966",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@videlec](#comment:8):
> Replying to [@mwageringel](#comment:6):
> > It might be good to convert the polynomial to a dictionary first in order to speed up the looking up of coefficients, e.g.:

> 
> It is sad this is the case. The polynomial datastructure is supposed to be fast in accessing coefficients... I believe it strongly depends on the base ring. But given the time difference I agree that it makes sense.

The `MPolynomial_libsignular.__getitem__` code looks like this:

```python
        m = p_ISet(1,r)
        i = 1
        for e in x:
            overflow_check(e, r)
            p_SetExp(m, i, int(e), r)
            i += 1
        p_Setm(m, r)

        while(p):
            if p_ExpVectorEqual(p, m, r) == 1:
                p_Delete(&m,r)
                return si2sa(p_GetCoeff(p, r), r, self._parent._base)
            p = pNext(p)
```
So it looks more like it is going through a list rather than a dict. I don't know how singular does this, but it looks like a very different data structure than the naïve implementation. IIRC, their data structure is solely to be efficient at computing Gröbner bases.

TL;DR Converting to a dict is definitely the best option with the current implementation.

As a more broader question, it might be worthwhile to consider reimplementing generic multivariate polynomials in Cython and only convert to (lib)singular when wanting a Gröbner basis.



---

archive/issue_comments_464967.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHow about generalising it to computing actions of linear group elements and of linear groups on polynomials?\n\nIt seems to be a bit restrictive to only have methods for fixed point computation, whereas it's only slightly less general, and you compute the action anyway!",
    "created_at": "2020-04-24T01:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464967",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

How about generalising it to computing actions of linear group elements and of linear groups on polynomials?

It seems to be a bit restrictive to only have methods for fixed point computation, whereas it's only slightly less general, and you compute the action anyway!



---

archive/issue_comments_464968.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@dimpase](#comment:10):\n> How about generalising it to computing actions of linear group elements and of linear groups on polynomials?\n\n>\n> It seems to be a bit restrictive to only have methods for fixed point computation, whereas it's only slightly less general, and you compute the action anyway!\n\nFeel free to open a ticket for that. The code here is permuting exponents and do not touch the coefficients. The linear action might better be done via a proper action.",
    "created_at": "2020-04-24T07:37:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464968",
    "user": "https://github.com/videlec"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@dimpase](#comment:10):
> How about generalising it to computing actions of linear group elements and of linear groups on polynomials?

>
> It seems to be a bit restrictive to only have methods for fixed point computation, whereas it's only slightly less general, and you compute the action anyway!

Feel free to open a ticket for that. The code here is permuting exponents and do not touch the coefficients. The linear action might better be done via a proper action.



---

archive/issue_comments_464969.json:
```json
{
    "body": "Changed commit from **[4cabb57](https://github.com/sagemath/sagetrac-mirror/commit/4cabb5797586b617e176bcf35678e961cca01cd9)** to **[4e3cffe](https://github.com/sagemath/sagetrac-mirror/commit/4e3cffe5db6f141bc155eacaab9c024a50021f3a)**",
    "created_at": "2020-04-24T08:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464969",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4cabb57](https://github.com/sagemath/sagetrac-mirror/commit/4cabb5797586b617e176bcf35678e961cca01cd9)** to **[4e3cffe](https://github.com/sagemath/sagetrac-mirror/commit/4e3cffe5db6f141bc155eacaab9c024a50021f3a)**



---

archive/issue_comments_464970.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccdd618a94089bdd82fe596920c4b27f25a3a9a9\">ccdd618</a></td><td><code>is_symmetric for multivariate polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e3cffe5db6f141bc155eacaab9c024a50021f3a\">4e3cffe</a></td><td><code>speed up check in SymmetricFunctions</code></td></tr></table>\n",
    "created_at": "2020-04-24T08:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464970",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccdd618a94089bdd82fe596920c4b27f25a3a9a9">ccdd618</a></td><td><code>is_symmetric for multivariate polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e3cffe5db6f141bc155eacaab9c024a50021f3a">4e3cffe</a></td><td><code>speed up check in SymmetricFunctions</code></td></tr></table>




---

archive/issue_comments_464971.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nImplementation changed to go via action of `PermutationGroupElement` on `ETuple`.",
    "created_at": "2020-04-24T08:36:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464971",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

Implementation changed to go via action of `PermutationGroupElement` on `ETuple`.



---

archive/issue_comments_464972.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14701316de88ab004348729731b7c641b5582670\">1470131</a></td><td><code>don't call exponents + force conversion to SymmetricGroup(n)</code></td></tr></table>\n",
    "created_at": "2020-04-24T08:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464972",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14701316de88ab004348729731b7c641b5582670">1470131</a></td><td><code>don't call exponents + force conversion to SymmetricGroup(n)</code></td></tr></table>




---

archive/issue_comments_464973.json:
```json
{
    "body": "Changed commit from **[4e3cffe](https://github.com/sagemath/sagetrac-mirror/commit/4e3cffe5db6f141bc155eacaab9c024a50021f3a)** to **[1470131](https://github.com/sagemath/sagetrac-mirror/commit/14701316de88ab004348729731b7c641b5582670)**",
    "created_at": "2020-04-24T08:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464973",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4e3cffe](https://github.com/sagemath/sagetrac-mirror/commit/4e3cffe5db6f141bc155eacaab9c024a50021f3a)** to **[1470131](https://github.com/sagemath/sagetrac-mirror/commit/14701316de88ab004348729731b7c641b5582670)**



---

archive/issue_comments_464974.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nDoes it work for Laurent polynomials?",
    "created_at": "2020-04-25T02:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464974",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

Does it work for Laurent polynomials?



---

archive/issue_comments_464975.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n\n```\nresult._data = <int*> sig_malloc(sizeof(int)*result._nonzero*2)\n```\nlooks like a memory leak, as I don't see a matching `sig_free()` call.",
    "created_at": "2020-04-25T02:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464975",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>


```
result._data = <int*> sig_malloc(sizeof(int)*result._nonzero*2)
```
looks like a memory leak, as I don't see a matching `sig_free()` call.



---

archive/issue_events_406510.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-25T02:11:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406510"
}
```



---

archive/issue_events_406511.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-25T02:11:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406511"
}
```



---

archive/issue_comments_464976.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@dimpase](#comment:16):\n> \n> ```\n> result._data = <int*> sig_malloc(sizeof(int)*result._nonzero*2)\n> ```\n> looks like a memory leak, as I don't see a matching `sig_free()` call.\n\nWhy would there be a `sig_free()`? `result` is the return value of the function, and it would be the job of the `ETuple` to handle freeing that in its deallocation I believe.\n\nI also have a few comments:\n\n```diff\n-        - ``group`` (optional) - if set, test whether the polynomial is\n-          symmetric with respect to the given permutation group.\n+        - ``group`` (default: symmetric group) -- if set, test whether the\n+          polynomial is invariant with respect to the given permutation group\n```\n\nThis error message doesn't make sense to me `raise ValueError(\"wrong argument 'group'\")`.\n\n```diff\n-        for e, coeff in coeffs.items():\n-            for g in gens:\n-                if coeffs.get(g._act_on_etuple_on_position(e, True), zero) != coeff:\n-                    return False\n-        return True\n+        return all(coeffs.get(g._act_on_etuple_on_position(e, True), zero) == coeff\n+                   for e, coeff in coeffs.items() for g in gens)\n```\n\nIn `monomial.py`:\n\n```diff\n-from sage.combinat.partition import Partition\n+from sage.combinat.partition import Partition, _Partitions\n```\n\n```diff\n-        out = self.sum_of_terms((Partition(e), c)\n-                                for (e,c) in f.dict().items()\n-                                if all(e[i+1] <= e[i] for i in range(len(e) - 1)))\n+        R = self.base_ring()\n+        out = self._from_dict({_Partitions(e): R(c)\n+                                for (e,c) in f.dict().items()\n+                                if all(e[i+1] <= e[i] for i in range(len(e)-1))})\n```",
    "created_at": "2020-04-25T03:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464976",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@dimpase](#comment:16):
> 
> ```
> result._data = <int*> sig_malloc(sizeof(int)*result._nonzero*2)
> ```
> looks like a memory leak, as I don't see a matching `sig_free()` call.

Why would there be a `sig_free()`? `result` is the return value of the function, and it would be the job of the `ETuple` to handle freeing that in its deallocation I believe.

I also have a few comments:

```diff
-        - ``group`` (optional) - if set, test whether the polynomial is
-          symmetric with respect to the given permutation group.
+        - ``group`` (default: symmetric group) -- if set, test whether the
+          polynomial is invariant with respect to the given permutation group
```

This error message doesn't make sense to me `raise ValueError("wrong argument 'group'")`.

```diff
-        for e, coeff in coeffs.items():
-            for g in gens:
-                if coeffs.get(g._act_on_etuple_on_position(e, True), zero) != coeff:
-                    return False
-        return True
+        return all(coeffs.get(g._act_on_etuple_on_position(e, True), zero) == coeff
+                   for e, coeff in coeffs.items() for g in gens)
```

In `monomial.py`:

```diff
-from sage.combinat.partition import Partition
+from sage.combinat.partition import Partition, _Partitions
```

```diff
-        out = self.sum_of_terms((Partition(e), c)
-                                for (e,c) in f.dict().items()
-                                if all(e[i+1] <= e[i] for i in range(len(e) - 1)))
+        R = self.base_ring()
+        out = self._from_dict({_Partitions(e): R(c)
+                                for (e,c) in f.dict().items()
+                                if all(e[i+1] <= e[i] for i in range(len(e)-1))})
```



---

archive/issue_comments_464977.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n`sig_malloc` is a thin wrapper around C `malloc()`. There is no garbage collection in Cython that would magically call `sig_free()` on what `result._data` points to - unless I seriously misunderstand something.",
    "created_at": "2020-04-25T04:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464977",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

`sig_malloc` is a thin wrapper around C `malloc()`. There is no garbage collection in Cython that would magically call `sig_free()` on what `result._data` points to - unless I seriously misunderstand something.



---

archive/issue_comments_464978.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIn `ETuple`:\n\n```python\n    def __dealloc__(self):\n        if self._data != <int*>0:\n            sig_free(self._data)\n```\nSo whenever `result` (which is an `ETuple`) is destroyed, then that memory is freed.",
    "created_at": "2020-04-25T05:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464978",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

In `ETuple`:

```python
    def __dealloc__(self):
        if self._data != <int*>0:
            sig_free(self._data)
```
So whenever `result` (which is an `ETuple`) is destroyed, then that memory is freed.



---

archive/issue_events_406512.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-25T05:54:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406512"
}
```



---

archive/issue_events_406513.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-25T05:54:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406513"
}
```



---

archive/issue_comments_464979.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOK, I see, thanks for an explanation.",
    "created_at": "2020-04-25T05:54:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464979",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

OK, I see, thanks for an explanation.



---

archive/issue_comments_464980.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@tscrim](#comment:17):\n> Replying to [@dimpase](#comment:16):\n> > \n> > ```\n> > result._data = <int*> sig_malloc(sizeof(int)*result._nonzero*2)\n> > ```\n> > looks like a memory leak, as I don't see a matching `sig_free()` call.\n\n> \n> Why would there be a `sig_free()`? `result` is the return value of the function, and it would be the job of the `ETuple` to handle freeing that in its deallocation I believe.\n\nIndeed. That is exactly what is happening.",
    "created_at": "2020-04-25T05:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464980",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@tscrim](#comment:17):
> Replying to [@dimpase](#comment:16):
> > 
> > ```
> > result._data = <int*> sig_malloc(sizeof(int)*result._nonzero*2)
> > ```
> > looks like a memory leak, as I don't see a matching `sig_free()` call.

> 
> Why would there be a `sig_free()`? `result` is the return value of the function, and it would be the job of the `ETuple` to handle freeing that in its deallocation I believe.

Indeed. That is exactly what is happening.



---

archive/issue_comments_464981.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d72df33c5d93306d8843a07721f81938f2af325\">0d72df3</a></td><td><code>some details</code></td></tr></table>\n",
    "created_at": "2020-04-25T06:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464981",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d72df33c5d93306d8843a07721f81938f2af325">0d72df3</a></td><td><code>some details</code></td></tr></table>




---

archive/issue_comments_464982.json:
```json
{
    "body": "Changed commit from **[1470131](https://github.com/sagemath/sagetrac-mirror/commit/14701316de88ab004348729731b7c641b5582670)** to **[0d72df3](https://github.com/sagemath/sagetrac-mirror/commit/0d72df33c5d93306d8843a07721f81938f2af325)**",
    "created_at": "2020-04-25T06:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464982",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1470131](https://github.com/sagemath/sagetrac-mirror/commit/14701316de88ab004348729731b7c641b5582670)** to **[0d72df3](https://github.com/sagemath/sagetrac-mirror/commit/0d72df33c5d93306d8843a07721f81938f2af325)**



---

archive/issue_comments_464983.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nbeware that monomial.py has been modified recently, in #29540",
    "created_at": "2020-04-25T06:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464983",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

beware that monomial.py has been modified recently, in #29540



---

archive/issue_comments_464984.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nTo me the naming \"on position\" suggests a certain way a permutation acts on lists, independently from the notion of left and right (although this action does satisfy the properties of a left action). So I think either the `_on_position` or the `self_on_left` should be removed, as these terms are at odds with each other.\n\nI would probably drop the `self_on_left` as it is simple enough to call the method on the inverse permutation instead when necessary, but your current implementation does the opposite of what `_act_on_list_on_position` does. I had not considered this before - sorry. Since you mentioned the action on polynomials, I can see why the current implementation might be preferable. In that case, you could just rename the method to `_act_on_etuple`.\n\nIn any case, left and right seem to be mixed up currently:\n\n```\nsage: S = SymmetricGroup(6)\nsage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')\nsage: from sage.rings.polynomial.polydict import ETuple\nsage: e = ETuple([10..15])\nsage: right = lambda x, p: p._act_on_etuple_on_position(x, self_on_left=False)\nsage: right(e, p * q) == right(right(e, p), q)  # should be True\nFalse\n```",
    "created_at": "2020-04-25T12:54:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464984",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:24" align="right">comment:24</div>

To me the naming "on position" suggests a certain way a permutation acts on lists, independently from the notion of left and right (although this action does satisfy the properties of a left action). So I think either the `_on_position` or the `self_on_left` should be removed, as these terms are at odds with each other.

I would probably drop the `self_on_left` as it is simple enough to call the method on the inverse permutation instead when necessary, but your current implementation does the opposite of what `_act_on_list_on_position` does. I had not considered this before - sorry. Since you mentioned the action on polynomials, I can see why the current implementation might be preferable. In that case, you could just rename the method to `_act_on_etuple`.

In any case, left and right seem to be mixed up currently:

```
sage: S = SymmetricGroup(6)
sage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')
sage: from sage.rings.polynomial.polydict import ETuple
sage: e = ETuple([10..15])
sage: right = lambda x, p: p._act_on_etuple_on_position(x, self_on_left=False)
sage: right(e, p * q) == right(right(e, p), q)  # should be True
False
```



---

archive/issue_comments_464985.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@tscrim](#comment:9):\n> As a more broader question, it might be worthwhile to consider reimplementing generic multivariate polynomials in Cython and only convert to (lib)singular when wanting a Gr\u00f6bner basis.\n\nThis is exactly what the polydict implementation of polynomials does, no? You can construct a polynomial ring via `PolynomialRing(..., implementation='generic')` to use it, and when you want a Gr\u00f6bner basis, only then it will convert to Singular (the conversion to libsingular does not seem to be supported).\n\nOn the other hand, I cannot think of many operations on polynomials for which random access to arbitrary coefficients is important.",
    "created_at": "2020-04-25T13:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464985",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@tscrim](#comment:9):
> As a more broader question, it might be worthwhile to consider reimplementing generic multivariate polynomials in Cython and only convert to (lib)singular when wanting a Gröbner basis.

This is exactly what the polydict implementation of polynomials does, no? You can construct a polynomial ring via `PolynomialRing(..., implementation='generic')` to use it, and when you want a Gröbner basis, only then it will convert to Singular (the conversion to libsingular does not seem to be supported).

On the other hand, I cannot think of many operations on polynomials for which random access to arbitrary coefficients is important.



---

archive/issue_comments_464986.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@mwageringel](#comment:24):\n> To me the naming \"on position\" suggests a certain way a permutation acts on lists, independently from the notion of left and right (although this action does satisfy the properties of a left action). So I think either the `_on_position` or the `self_on_left` should be removed, as these terms are at odds with each other.\n> \n> I would probably drop the `self_on_left` as it is simple enough to call the method on the inverse permutation instead when necessary, but your current implementation does the opposite of what `_act_on_list_on_position` does. I had not considered this before - sorry. Since you mentioned the action on polynomials, I can see why the current implementation might be preferable. In that case, you could just rename the method to `_act_on_etuple`.\n> \n> In any case, left and right seem to be mixed up currently:\n> \n> ```\n> sage: S = SymmetricGroup(6)\n> sage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')\n> sage: from sage.rings.polynomial.polydict import ETuple\n> sage: e = ETuple([10..15])\n> sage: right = lambda x, p: p._act_on_etuple_on_position(x, self_on_left=False)\n> sage: right(e, p * q) == right(right(e, p), q)  # should be True\n> False\n> ```\n\nI just copied what is in `_act_on_list_on_position` which claims to be a right action. Same behaviour\n\n```\nsage: S = SymmetricGroup(6)\nsage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')\nsage: right = lambda x,p: p._act_on_list_on_position(x)\nsage: e = [10..15]\nsage: right(e, p * q) == right(right(e, p), q)\nFalse\nsage: right(e, p * q) == right(right(e, q), p)\nTrue\n```",
    "created_at": "2020-04-25T18:32:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464986",
    "user": "https://github.com/videlec"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@mwageringel](#comment:24):
> To me the naming "on position" suggests a certain way a permutation acts on lists, independently from the notion of left and right (although this action does satisfy the properties of a left action). So I think either the `_on_position` or the `self_on_left` should be removed, as these terms are at odds with each other.
> 
> I would probably drop the `self_on_left` as it is simple enough to call the method on the inverse permutation instead when necessary, but your current implementation does the opposite of what `_act_on_list_on_position` does. I had not considered this before - sorry. Since you mentioned the action on polynomials, I can see why the current implementation might be preferable. In that case, you could just rename the method to `_act_on_etuple`.
> 
> In any case, left and right seem to be mixed up currently:
> 
> ```
> sage: S = SymmetricGroup(6)
> sage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')
> sage: from sage.rings.polynomial.polydict import ETuple
> sage: e = ETuple([10..15])
> sage: right = lambda x, p: p._act_on_etuple_on_position(x, self_on_left=False)
> sage: right(e, p * q) == right(right(e, p), q)  # should be True
> False
> ```

I just copied what is in `_act_on_list_on_position` which claims to be a right action. Same behaviour

```
sage: S = SymmetricGroup(6)
sage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')
sage: right = lambda x,p: p._act_on_list_on_position(x)
sage: e = [10..15]
sage: right(e, p * q) == right(right(e, p), q)
False
sage: right(e, p * q) == right(right(e, q), p)
True
```



---

archive/issue_comments_464987.json:
```json
{
    "body": "Changed commit from **[0d72df3](https://github.com/sagemath/sagetrac-mirror/commit/0d72df33c5d93306d8843a07721f81938f2af325)** to **[989716c](https://github.com/sagemath/sagetrac-mirror/commit/989716c15303df8d3c22e6f3e1fe3a73158f116d)**",
    "created_at": "2020-04-25T18:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464987",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0d72df3](https://github.com/sagemath/sagetrac-mirror/commit/0d72df33c5d93306d8843a07721f81938f2af325)** to **[989716c](https://github.com/sagemath/sagetrac-mirror/commit/989716c15303df8d3c22e6f3e1fe3a73158f116d)**



---

archive/issue_comments_464988.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f299fae76271acdac14eb5e7715a0560c6e689a\">6f299fa</a></td><td><code>drop self_on_left</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1199382b04332249fc9f201bdd22b516aea7c28\">e119938</a></td><td><code>spring cleanup in sf/monomial (pep, code, doc details)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9570e17149e4158ce7c306de943338db547be6fd\">9570e17</a></td><td><code>trac 29540 still better code in monomial.py, other details there</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7381eadda977a74b9dfb4c315268550d89acc17\">f7381ea</a></td><td><code>trac 29540 fix import of _Partitions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/989716c15303df8d3c22e6f3e1fe3a73158f116d\">989716c</a></td><td><code>Merge changes from ticket #29540</code></td></tr></table>\n",
    "created_at": "2020-04-25T18:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464988",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f299fae76271acdac14eb5e7715a0560c6e689a">6f299fa</a></td><td><code>drop self_on_left</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1199382b04332249fc9f201bdd22b516aea7c28">e119938</a></td><td><code>spring cleanup in sf/monomial (pep, code, doc details)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9570e17149e4158ce7c306de943338db547be6fd">9570e17</a></td><td><code>trac 29540 still better code in monomial.py, other details there</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7381eadda977a74b9dfb4c315268550d89acc17">f7381ea</a></td><td><code>trac 29540 fix import of _Partitions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/989716c15303df8d3c22e6f3e1fe3a73158f116d">989716c</a></td><td><code>Merge changes from ticket #29540</code></td></tr></table>




---

archive/issue_comments_464989.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@videlec](#comment:26):\n> I just copied what is in `_act_on_list_on_position` which claims to be a right action. Same behaviour\n\nThe action of permutations on matrices implemented in `_act_on_` also has it the other way around, but for polynomials it works as expected:\n\n```\nsage: S = SymmetricGroup(6)\nsage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')\nsage: M = matrix.diagonal([1..6])\nsage: (M * p) * q == M * (p * q)\nFalse\nsage: R = PolynomialRing(QQ, 'x', 6)\nsage: (R.0 * p) * q == R.0 * (p * q)\nTrue\n```\nAm I misunderstanding something about left and right actions in Sage?",
    "created_at": "2020-04-25T19:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464989",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@videlec](#comment:26):
> I just copied what is in `_act_on_list_on_position` which claims to be a right action. Same behaviour

The action of permutations on matrices implemented in `_act_on_` also has it the other way around, but for polynomials it works as expected:

```
sage: S = SymmetricGroup(6)
sage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')
sage: M = matrix.diagonal([1..6])
sage: (M * p) * q == M * (p * q)
False
sage: R = PolynomialRing(QQ, 'x', 6)
sage: (R.0 * p) * q == R.0 * (p * q)
True
```
Am I misunderstanding something about left and right actions in Sage?



---

archive/issue_comments_464990.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@mwageringel](#comment:25):\n> Replying to [@tscrim](#comment:9):\n> > As a more broader question, it might be worthwhile to consider reimplementing generic multivariate polynomials in Cython and only convert to (lib)singular when wanting a Gr\u00f6bner basis.\n\n> \n> This is exactly what the polydict implementation of polynomials does, no? You can construct a polynomial ring via `PolynomialRing(..., implementation='generic')` to use it, and when you want a Gr\u00f6bner basis, only then it will convert to Singular (the conversion to libsingular does not seem to be supported).\n\nSorry, I forgot generic is an overloaded word here and probably not the best word. What I meant was more universally shall we do this for rings that can be converted to (lib)singular, like those over **Z**.\n\n> On the other hand, I cannot think of many operations on polynomials for which random access to arbitrary coefficients is important.\n\nPerhaps you're right. I can think of a number of things where you want to iterate over the pairs of coefficients and exponents. I don't think we have a method to do that (the default iterator is quite bad, getting the list of coefficients and list of monomials and zipping them together). I will open a ticket tomorrow or the next day to try and improve the iteration.",
    "created_at": "2020-04-25T22:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464990",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@mwageringel](#comment:25):
> Replying to [@tscrim](#comment:9):
> > As a more broader question, it might be worthwhile to consider reimplementing generic multivariate polynomials in Cython and only convert to (lib)singular when wanting a Gröbner basis.

> 
> This is exactly what the polydict implementation of polynomials does, no? You can construct a polynomial ring via `PolynomialRing(..., implementation='generic')` to use it, and when you want a Gröbner basis, only then it will convert to Singular (the conversion to libsingular does not seem to be supported).

Sorry, I forgot generic is an overloaded word here and probably not the best word. What I meant was more universally shall we do this for rings that can be converted to (lib)singular, like those over **Z**.

> On the other hand, I cannot think of many operations on polynomials for which random access to arbitrary coefficients is important.

Perhaps you're right. I can think of a number of things where you want to iterate over the pairs of coefficients and exponents. I don't think we have a method to do that (the default iterator is quite bad, getting the list of coefficients and list of monomials and zipping them together). I will open a ticket tomorrow or the next day to try and improve the iteration.



---

archive/issue_comments_464991.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@mwageringel](#comment:28):\n> The action of permutations on matrices implemented in `_act_on_` also has it the other way around, but for polynomials it works as expected:\n> \n> ```\n> sage: S = SymmetricGroup(6)\n> sage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')\n> sage: M = matrix.diagonal([1..6])\n> sage: (M * p) * q == M * (p * q)\n> False\n> sage: R = PolynomialRing(QQ, 'x', 6)\n> sage: (R.0 * p) * q == R.0 * (p * q)\n> True\n> ```\n> Am I misunderstanding something about left and right actions in Sage?\n\nHere is where it comes from I think:\n\n```\nsage: (M * p.matrix()) * q.matrix() == M * (p.matrix() * q.matrix())\nTrue\nsage: (M * p.matrix()) * q.matrix() == M * (p*q).matrix()\nTrue\nsage: p.matrix() * q.matrix() == (p*q).matrix()\nTrue\nsage: p.matrix() * M == M * p\nTrue\n```\n(An oddity that needs fixing: `p.matrix()` works but `p.to_matrix()` is a `NotImplemented`.)\nAlso Sage only knows it has a right action:\n\n```\nsage: (q * p) * M == q * (p * M)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<snip>\nTypeError: unsupported operand parent(s) for *: 'Symmetric group of order 6! as a permutation group' and 'Full MatrixSpace of 6 by 6 sparse matrices over Integer Ring'\n```\nSo I think the thing that needs to change in the perm group element `_act_on_` is\n\n```diff\n             elif is_Matrix(left):\n+               return left.with_permuted_columns(~self)\n+        else:\n+            if is_Matrix(left):\n                return left.with_permuted_rows(self)\n```\nAddendum: Because of this:\n\n```\nsage: M * p.matrix()\n[0 1 0 0 0 0]\n[0 0 2 0 0 0]\n[0 0 0 3 0 0]\n[0 0 0 0 4 0]\n[0 0 0 0 0 5]\n[6 0 0 0 0 0]\nsage: M.with_permuted_columns(~p)\n[0 1 0 0 0 0]\n[0 0 2 0 0 0]\n[0 0 0 3 0 0]\n[0 0 0 0 4 0]\n[0 0 0 0 0 5]\n[6 0 0 0 0 0]\n```",
    "created_at": "2020-04-25T23:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464991",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@mwageringel](#comment:28):
> The action of permutations on matrices implemented in `_act_on_` also has it the other way around, but for polynomials it works as expected:
> 
> ```
> sage: S = SymmetricGroup(6)
> sage: p, q = S('(1,2,3,4,5,6)'), S('(1,2)(3,4)(5,6)')
> sage: M = matrix.diagonal([1..6])
> sage: (M * p) * q == M * (p * q)
> False
> sage: R = PolynomialRing(QQ, 'x', 6)
> sage: (R.0 * p) * q == R.0 * (p * q)
> True
> ```
> Am I misunderstanding something about left and right actions in Sage?

Here is where it comes from I think:

```
sage: (M * p.matrix()) * q.matrix() == M * (p.matrix() * q.matrix())
True
sage: (M * p.matrix()) * q.matrix() == M * (p*q).matrix()
True
sage: p.matrix() * q.matrix() == (p*q).matrix()
True
sage: p.matrix() * M == M * p
True
```
(An oddity that needs fixing: `p.matrix()` works but `p.to_matrix()` is a `NotImplemented`.)
Also Sage only knows it has a right action:

```
sage: (q * p) * M == q * (p * M)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<snip>
TypeError: unsupported operand parent(s) for *: 'Symmetric group of order 6! as a permutation group' and 'Full MatrixSpace of 6 by 6 sparse matrices over Integer Ring'
```
So I think the thing that needs to change in the perm group element `_act_on_` is

```diff
             elif is_Matrix(left):
+               return left.with_permuted_columns(~self)
+        else:
+            if is_Matrix(left):
                return left.with_permuted_rows(self)
```
Addendum: Because of this:

```
sage: M * p.matrix()
[0 1 0 0 0 0]
[0 0 2 0 0 0]
[0 0 0 3 0 0]
[0 0 0 0 4 0]
[0 0 0 0 0 5]
[6 0 0 0 0 0]
sage: M.with_permuted_columns(~p)
[0 1 0 0 0 0]
[0 0 2 0 0 0]
[0 0 0 3 0 0]
[0 0 0 0 4 0]
[0 0 0 0 0 5]
[6 0 0 0 0 0]
```



---

archive/issue_comments_464992.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Markus Wageringel**",
    "created_at": "2020-04-26T10:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464992",
    "user": "https://github.com/mwageringel"
}
```

Reviewer: **Travis Scrimshaw, Markus Wageringel**



---

archive/issue_comments_464993.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@tscrim](#comment:29):\n> Sorry, I forgot generic is an overloaded word here and probably not the best word. What I meant was more universally shall we do this for rings that can be converted to (lib)singular, like those over **Z**.\n\nSo you are suggesting to make the `generic` implementation the default? This implementation is not usually faster than the Singular backend I think, but it depends on the use case of course.\n\n> Perhaps you're right. I can think of a number of things where you want to iterate over the pairs of coefficients and exponents. I don't think we have a method to do that (the default iterator is quite bad, getting the list of coefficients and list of monomials and zipping them together). I will open a ticket tomorrow or the next day to try and improve the iteration.\n\nThat would indeed be nice to have, as it is such a common operation. I did not know the `__iter__` method was implemented for polynomials and have always been zipping coefficients and monomials (or exponents), but it always felt odd to me, especially since this pattern fails for `CombinatorialFreeModule` elements if one does not pay attention to the sorting.\n\n\nRegarding the action on matrices, we could handle that on a new ticket, as it alters existing behavior and is not really related to the aim of this ticket.\n\nI am happy with this ticket as it is now. Except maybe there is one little detail from Travis' suggestion:\n\n```\n        out = self._from_dict({_Partitions.element_class(_Partitions, list(e)): R(c)\n                               for (e,c) in f.dict().items()\n```\n\nThe conversion `R(c)` should not be necessary here, as the coefficients should already be elements of the base ring.",
    "created_at": "2020-04-26T10:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464993",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@tscrim](#comment:29):
> Sorry, I forgot generic is an overloaded word here and probably not the best word. What I meant was more universally shall we do this for rings that can be converted to (lib)singular, like those over **Z**.

So you are suggesting to make the `generic` implementation the default? This implementation is not usually faster than the Singular backend I think, but it depends on the use case of course.

> Perhaps you're right. I can think of a number of things where you want to iterate over the pairs of coefficients and exponents. I don't think we have a method to do that (the default iterator is quite bad, getting the list of coefficients and list of monomials and zipping them together). I will open a ticket tomorrow or the next day to try and improve the iteration.

That would indeed be nice to have, as it is such a common operation. I did not know the `__iter__` method was implemented for polynomials and have always been zipping coefficients and monomials (or exponents), but it always felt odd to me, especially since this pattern fails for `CombinatorialFreeModule` elements if one does not pay attention to the sorting.


Regarding the action on matrices, we could handle that on a new ticket, as it alters existing behavior and is not really related to the aim of this ticket.

I am happy with this ticket as it is now. Except maybe there is one little detail from Travis' suggestion:

```
        out = self._from_dict({_Partitions.element_class(_Partitions, list(e)): R(c)
                               for (e,c) in f.dict().items()
```

The conversion `R(c)` should not be necessary here, as the coefficients should already be elements of the base ring.



---

archive/issue_comments_464994.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@tscrim](#comment:30):\n> (An oddity that needs fixing: `p.matrix()` works but `p.to_matrix()` is a `NotImplemented`.)\n\nDo you know where this `to_matrix` comes from? I stumbled upon this a few days ago, but could not figure out where it was defined.",
    "created_at": "2020-04-26T10:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464994",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@tscrim](#comment:30):
> (An oddity that needs fixing: `p.matrix()` works but `p.to_matrix()` is a `NotImplemented`.)

Do you know where this `to_matrix` comes from? I stumbled upon this a few days ago, but could not figure out where it was defined.



---

archive/issue_comments_464995.json:
```json
{
    "body": "Changed commit from **[989716c](https://github.com/sagemath/sagetrac-mirror/commit/989716c15303df8d3c22e6f3e1fe3a73158f116d)** to **[c53ac9b](https://github.com/sagemath/sagetrac-mirror/commit/c53ac9b2267e586bbefd81af5dca9df8d51f9f3c)**",
    "created_at": "2020-04-26T13:22:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464995",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[989716c](https://github.com/sagemath/sagetrac-mirror/commit/989716c15303df8d3c22e6f3e1fe3a73158f116d)** to **[c53ac9b](https://github.com/sagemath/sagetrac-mirror/commit/c53ac9b2267e586bbefd81af5dca9df8d51f9f3c)**



---

archive/issue_comments_464996.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c53ac9b2267e586bbefd81af5dca9df8d51f9f3c\">c53ac9b</a></td><td><code>don't convert since base ring is already correct</code></td></tr></table>\n",
    "created_at": "2020-04-26T13:22:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464996",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c53ac9b2267e586bbefd81af5dca9df8d51f9f3c">c53ac9b</a></td><td><code>don't convert since base ring is already correct</code></td></tr></table>




---

archive/issue_comments_464997.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@mwageringel](#comment:31):\n> Replying to [@tscrim](#comment:29):\n> > Sorry, I forgot generic is an overloaded word here and probably not the best word. What I meant was more universally shall we do this for rings that can be converted to (lib)singular, like those over **Z**.\n\n> \n> So you are suggesting to make the `generic` implementation the default? This implementation is not usually faster than the Singular backend I think, but it depends on the use case of course.\n\nYes, although I am not sure if this will be a good option. However, IIRC things like multiplying polynomials is really slow and could use another library to speed that up.\n\n> > Perhaps you're right. I can think of a number of things where you want to iterate over the pairs of coefficients and exponents. I don't think we have a method to do that (the default iterator is quite bad, getting the list of coefficients and list of monomials and zipping them together). I will open a ticket tomorrow or the next day to try and improve the iteration.\n\n> \n> That would indeed be nice to have, as it is such a common operation. I did not know the `__iter__` method was implemented for polynomials and have always been zipping coefficients and monomials (or exponents), but it always felt odd to me, especially since this pattern fails for `CombinatorialFreeModule` elements if one does not pay attention to the sorting.\n\nThis is now #29595.\n\n> Regarding the action on matrices, we could handle that on a new ticket, as it alters existing behavior and is not really related to the aim of this ticket.\n\nI agree that it should be a separate ticket.\n\n> I am happy with this ticket as it is now. Except maybe there is one little detail from Travis' suggestion:\n> \n> ```\n>         out = self._from_dict({_Partitions.element_class(_Partitions, list(e)): R(c)\n>                                for (e,c) in f.dict().items()\n> ```\n> \n> The conversion `R(c)` should not be necessary here, as the coefficients should already be elements of the base ring.\n\nIf we add that conversion, then we can remove the\n\n```\nassert self.base_ring() == f.base_ring()\n```\nwhich I think is not a good thing to enforce.",
    "created_at": "2020-04-27T03:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464997",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@mwageringel](#comment:31):
> Replying to [@tscrim](#comment:29):
> > Sorry, I forgot generic is an overloaded word here and probably not the best word. What I meant was more universally shall we do this for rings that can be converted to (lib)singular, like those over **Z**.

> 
> So you are suggesting to make the `generic` implementation the default? This implementation is not usually faster than the Singular backend I think, but it depends on the use case of course.

Yes, although I am not sure if this will be a good option. However, IIRC things like multiplying polynomials is really slow and could use another library to speed that up.

> > Perhaps you're right. I can think of a number of things where you want to iterate over the pairs of coefficients and exponents. I don't think we have a method to do that (the default iterator is quite bad, getting the list of coefficients and list of monomials and zipping them together). I will open a ticket tomorrow or the next day to try and improve the iteration.

> 
> That would indeed be nice to have, as it is such a common operation. I did not know the `__iter__` method was implemented for polynomials and have always been zipping coefficients and monomials (or exponents), but it always felt odd to me, especially since this pattern fails for `CombinatorialFreeModule` elements if one does not pay attention to the sorting.

This is now #29595.

> Regarding the action on matrices, we could handle that on a new ticket, as it alters existing behavior and is not really related to the aim of this ticket.

I agree that it should be a separate ticket.

> I am happy with this ticket as it is now. Except maybe there is one little detail from Travis' suggestion:
> 
> ```
>         out = self._from_dict({_Partitions.element_class(_Partitions, list(e)): R(c)
>                                for (e,c) in f.dict().items()
> ```
> 
> The conversion `R(c)` should not be necessary here, as the coefficients should already be elements of the base ring.

If we add that conversion, then we can remove the

```
assert self.base_ring() == f.base_ring()
```
which I think is not a good thing to enforce.



---

archive/issue_comments_464998.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@mwageringel](#comment:32):\n> Replying to [@tscrim](#comment:30):\n> > (An oddity that needs fixing: `p.matrix()` works but `p.to_matrix()` is a `NotImplemented`.)\n\n> \n> Do you know where this `to_matrix` comes from? I stumbled upon this a few days ago, but could not figure out where it was defined.\n\nIt comes from the finite Complex reflection group category. This can be easily fixed with an alias in the (finite) Coxeter group category (using the method `canonical_matrix`) and/or for the specific implementation of permutation groups.",
    "created_at": "2020-04-27T03:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464998",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@mwageringel](#comment:32):
> Replying to [@tscrim](#comment:30):
> > (An oddity that needs fixing: `p.matrix()` works but `p.to_matrix()` is a `NotImplemented`.)

> 
> Do you know where this `to_matrix` comes from? I stumbled upon this a few days ago, but could not figure out where it was defined.

It comes from the finite Complex reflection group category. This can be easily fixed with an alias in the (finite) Coxeter group category (using the method `canonical_matrix`) and/or for the specific implementation of permutation groups.



---

archive/issue_comments_464999.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@tscrim](#comment:34):\n> Replying to [@mwageringel](#comment:31):\n> > Replying to [@tscrim](#comment:29):\n> > I am happy with this ticket as it is now. Except maybe there is one little detail from Travis' suggestion:\n> > \n> > ```\n> >         out = self._from_dict({_Partitions.element_class(_Partitions, list(e)): R(c)\n> >                                for (e,c) in f.dict().items()\n> > ```\n> > \n> > The conversion `R(c)` should not be necessary here, as the coefficients should already be elements of the base ring.\n\n> \n> If we add that conversion, then we can remove the\n> \n> ```\n> assert self.base_ring() == f.base_ring()\n> ```\n> which I think is not a good thing to enforce.\n\nIndeed, I found this line a bit weird. Though I did not touch since it was beyond the scope of the ticket.",
    "created_at": "2020-04-27T16:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-464999",
    "user": "https://github.com/videlec"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@tscrim](#comment:34):
> Replying to [@mwageringel](#comment:31):
> > Replying to [@tscrim](#comment:29):
> > I am happy with this ticket as it is now. Except maybe there is one little detail from Travis' suggestion:
> > 
> > ```
> >         out = self._from_dict({_Partitions.element_class(_Partitions, list(e)): R(c)
> >                                for (e,c) in f.dict().items()
> > ```
> > 
> > The conversion `R(c)` should not be necessary here, as the coefficients should already be elements of the base ring.

> 
> If we add that conversion, then we can remove the
> 
> ```
> assert self.base_ring() == f.base_ring()
> ```
> which I think is not a good thing to enforce.

Indeed, I found this line a bit weird. Though I did not touch since it was beyond the scope of the ticket.



---

archive/issue_events_406514.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-04-30T19:25:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406514"
}
```



---

archive/issue_events_406515.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-04-30T19:25:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406515"
}
```



---

archive/issue_comments_465000.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nOk, it seems this is ready to be merged then? Let me set this ticket to positive, but please undo if you disagree.",
    "created_at": "2020-04-30T19:25:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-465000",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:37" align="right">comment:37</div>

Ok, it seems this is ready to be merged then? Let me set this ticket to positive, but please undo if you disagree.



---

archive/issue_comments_465001.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/29553](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/29553)** to **[c53ac9b](https://github.com/sagemath/sagetrac-mirror/commit/c53ac9b2267e586bbefd81af5dca9df8d51f9f3c)**",
    "created_at": "2020-05-04T06:40:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29553#issuecomment-465001",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/29553](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/29553)** to **[c53ac9b](https://github.com/sagemath/sagetrac-mirror/commit/c53ac9b2267e586bbefd81af5dca9df8d51f9f3c)**



---

archive/issue_events_406516.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-04T06:40:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406516"
}
```



---

archive/issue_events_406517.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "951a41f7b3ac7cd64386c7310d6ea9218e722fca",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-05-04T06:40:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406517"
}
```



---

archive/issue_events_406518.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-04T20:06:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406518"
}
```



---

archive/issue_events_406519.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-04T20:06:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29553",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29553#event-406519"
}
```
