# Issue 29595: Improve iteration of multivariate polynomials

archive/issues_029358.json:
```json
{
    "assignees": [],
    "body": "We should take advantage of methods being able to now use `yield` in Cython and add a method to iterate over `(coefficient, exponent)` pairs as this can be useful (instead of monomials).\n\n---\n\nThis also improves the iteration speed over multivariate polynomials:\n\n```\nsage: RR.<x,y> = ZZ[]\nsage: pR = R.sum(x^i*y^j for i in range(100) for j in range(100))\nsage: %timeit for _ in pR: pass\n100 loops, best of 5: 5.75 ms per loop\n\nsage: S.<x,y> = QQbar[]\nsage: pS = S.sum(x^i*y^j for i in range(100) for j in range(100))\nsage: %timeit for _ in pS: pass\n100 loops, best of 5: 11.1 ms per loop\n\nsage: L.<w,z> = LaurentPolynomialRing(R)\nsage: pL = L.sum(w^i*z^j for i in range(50) for j in range(50))\nsage: %timeit for _ in pL: pass\n100 loops, best of 5: 13 ms per loop\n```\nvs before:\n\n```\nsage: %timeit for _ in pR: pass\n100 loops, best of 5: 6.42 ms per loop\n\nsage: %timeit for _ in pS: pass\n100 loops, best of 5: 11.3 ms per loop\n\nsage: %timeit for _ in pL: pass\n10 loops, best of 5: 81.8 ms per loop\n```\nThere won't be really any improvement in the generic implementation in terms of speed. However, the memory usage for all of these methods has been cut.\n\n---\n\nThis improves the speed of a number of auxiliary methods:\n\n```\nsage: %timeit pS.is_constant()\n1000000 loops, best of 5: 258 ns per loop\nsage: %timeit pS.is_monomial()\n1000000 loops, best of 5: 286 ns per loop\nsage: %timeit pS.is_generator()\n1000000 loops, best of 5: 273 ns per loop\nsage: %timeit S.zero().is_constant()\n1000000 loops, best of 5: 326 ns per loop\n\nsage: %timeit pL.is_monomial()\n1000000 loops, best of 5: 307 ns per loop\nsage: %timeit pL[5,5]\n1000000 loops, best of 5: 611 ns per loop\nsage: %timeit ~pL\n100 loops, best of 5: 9.03 ms per loop\n\nsage: M.<w,z> = LaurentPolynomialRing(ZZ)\nsage: pM = M.sum(w^i*z^j for i in range(50) for j in range(50))\nsage: %timeit hash(pM)\n1000 loops, best of 5: 1.84 ms per loop\n```\nvs before\n\n```\nsage: %timeit pS.is_constant()\n10000 loops, best of 5: 83.2 \u00b5s per loop\nsage: %timeit pS.is_monomial()\n10000 loops, best of 5: 81 \u00b5s per loop\nsage: %timeit pS.is_generator()\n10000 loops, best of 5: 82.8 \u00b5s per loop\nsage: %timeit S.zero().is_constant()\n1000000 loops, best of 5: 1.41 \u00b5s per loop\n\nsage: %timeit pL.is_monomial()\n100000 loops, best of 5: 15.2 \u00b5s per loop\nsage: %timeit pL[5,5]\n100000 loops, best of 5: 17.5 \u00b5s per loop\nsage: %timeit ~pL\n100 loops, best of 5: 9.46 ms per loop\n\nsage: %timeit hash(pM)\n100 loops, best of 5: 2.13 ms per loop\n```\n\n---\n\nWe add `is_term`, which was missing from libsingular multivariate polynomials. We also fix a bug that claims the 0 polynomial was a monomial:\n\n```\nsage: P.<x,y,z> = PolynomialRing(QQ)\nsage: P.zero().is_monomial()\nTrue\n```\n\n---\n\nAnother bug-fix is that exponents of generic MPolys were mutable and cached:\n\n```\nsage: pS.exponents().pop()\n(0, 0)\nsage: _ in pS.exponents()\nFalse\n```\n\n\nCC:  @mwageringel @fchapoton\n\nKeywords: **multivariate polynomial iteration**\n\nBranch/Commit: **[931f345](https://github.com/sagemath/sagetrac-mirror/commit/931f345c1199c876335b200b503547f5ee67f571)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29595_\n\n",
    "closed_at": "2020-05-31T08:49:07Z",
    "created_at": "2020-04-27T03:15:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve iteration of multivariate polynomials",
    "type": "issue",
    "updated_at": "2020-05-31T08:49:07Z",
    "url": "https://github.com/sagemath/sage/issues/29595",
    "user": "https://github.com/tscrim"
}
```
We should take advantage of methods being able to now use `yield` in Cython and add a method to iterate over `(coefficient, exponent)` pairs as this can be useful (instead of monomials).

---

This also improves the iteration speed over multivariate polynomials:

```
sage: RR.<x,y> = ZZ[]
sage: pR = R.sum(x^i*y^j for i in range(100) for j in range(100))
sage: %timeit for _ in pR: pass
100 loops, best of 5: 5.75 ms per loop

sage: S.<x,y> = QQbar[]
sage: pS = S.sum(x^i*y^j for i in range(100) for j in range(100))
sage: %timeit for _ in pS: pass
100 loops, best of 5: 11.1 ms per loop

sage: L.<w,z> = LaurentPolynomialRing(R)
sage: pL = L.sum(w^i*z^j for i in range(50) for j in range(50))
sage: %timeit for _ in pL: pass
100 loops, best of 5: 13 ms per loop
```
vs before:

```
sage: %timeit for _ in pR: pass
100 loops, best of 5: 6.42 ms per loop

sage: %timeit for _ in pS: pass
100 loops, best of 5: 11.3 ms per loop

sage: %timeit for _ in pL: pass
10 loops, best of 5: 81.8 ms per loop
```
There won't be really any improvement in the generic implementation in terms of speed. However, the memory usage for all of these methods has been cut.

---

This improves the speed of a number of auxiliary methods:

```
sage: %timeit pS.is_constant()
1000000 loops, best of 5: 258 ns per loop
sage: %timeit pS.is_monomial()
1000000 loops, best of 5: 286 ns per loop
sage: %timeit pS.is_generator()
1000000 loops, best of 5: 273 ns per loop
sage: %timeit S.zero().is_constant()
1000000 loops, best of 5: 326 ns per loop

sage: %timeit pL.is_monomial()
1000000 loops, best of 5: 307 ns per loop
sage: %timeit pL[5,5]
1000000 loops, best of 5: 611 ns per loop
sage: %timeit ~pL
100 loops, best of 5: 9.03 ms per loop

sage: M.<w,z> = LaurentPolynomialRing(ZZ)
sage: pM = M.sum(w^i*z^j for i in range(50) for j in range(50))
sage: %timeit hash(pM)
1000 loops, best of 5: 1.84 ms per loop
```
vs before

```
sage: %timeit pS.is_constant()
10000 loops, best of 5: 83.2 µs per loop
sage: %timeit pS.is_monomial()
10000 loops, best of 5: 81 µs per loop
sage: %timeit pS.is_generator()
10000 loops, best of 5: 82.8 µs per loop
sage: %timeit S.zero().is_constant()
1000000 loops, best of 5: 1.41 µs per loop

sage: %timeit pL.is_monomial()
100000 loops, best of 5: 15.2 µs per loop
sage: %timeit pL[5,5]
100000 loops, best of 5: 17.5 µs per loop
sage: %timeit ~pL
100 loops, best of 5: 9.46 ms per loop

sage: %timeit hash(pM)
100 loops, best of 5: 2.13 ms per loop
```

---

We add `is_term`, which was missing from libsingular multivariate polynomials. We also fix a bug that claims the 0 polynomial was a monomial:

```
sage: P.<x,y,z> = PolynomialRing(QQ)
sage: P.zero().is_monomial()
True
```

---

Another bug-fix is that exponents of generic MPolys were mutable and cached:

```
sage: pS.exponents().pop()
(0, 0)
sage: _ in pS.exponents()
False
```


CC:  @mwageringel @fchapoton

Keywords: **multivariate polynomial iteration**

Branch/Commit: **[931f345](https://github.com/sagemath/sagetrac-mirror/commit/931f345c1199c876335b200b503547f5ee67f571)**

Reviewer: **Frédéric Chapoton**

Author: **Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/29595_





---

archive/issue_events_375360.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-04-27T03:15:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375360"
}
```



---

archive/issue_events_375361.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-04-27T03:15:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375361"
}
```



---

archive/issue_events_375362.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-04-27T03:15:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375362"
}
```



---

archive/issue_events_375363.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-04-27T03:15:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375363"
}
```



---

archive/issue_comments_468735.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,106 @@\n We should take advantage of methods being able to now use `yield` in Cython and add a method to iterate over `(coefficient, exponent)` pairs as this can be useful (instead of monomials).\n+\n+---\n+\n+This also improves the iteration speed over multivariate polynomials:\n+\n+```\n+sage: RR.<x,y> = ZZ[]\n+sage: pR = R.sum(x^i*y^j for i in range(100) for j in range(100))\n+sage: %timeit for _ in pR: pass\n+100 loops, best of 5: 5.75 ms per loop\n+\n+sage: S.<x,y> = QQbar[]\n+sage: pS = S.sum(x^i*y^j for i in range(100) for j in range(100))\n+sage: %timeit for _ in pS: pass\n+100 loops, best of 5: 11.1 ms per loop\n+\n+sage: L.<w,z> = LaurentPolynomialRing(R)\n+sage: pL = L.sum(w^i*z^j for i in range(50) for j in range(50))\n+sage: %timeit for _ in pL: pass\n+100 loops, best of 5: 13 ms per loop\n+```\n+vs before:\n+\n+```\n+sage: %timeit for _ in pR: pass\n+100 loops, best of 5: 6.42 ms per loop\n+\n+sage: %timeit for _ in pS: pass\n+100 loops, best of 5: 11.3 ms per loop\n+\n+sage: %timeit for _ in pL: pass\n+10 loops, best of 5: 81.8 ms per loop\n+```\n+There won't be really any improvement in the generic implementation in terms of speed. However, the memory usage for all of these methods has been cut.\n+\n+---\n+\n+This improves the speed of a number of auxiliary methods:\n+\n+```\n+sage: %timeit pS.is_constant()\n+1000000 loops, best of 5: 258 ns per loop\n+sage: %timeit pS.is_monomial()\n+1000000 loops, best of 5: 286 ns per loop\n+sage: %timeit pS.is_generator()\n+1000000 loops, best of 5: 273 ns per loop\n+sage: %timeit S.zero().is_constant()\n+1000000 loops, best of 5: 326 ns per loop\n+\n+sage: %timeit pL.is_monomial()\n+1000000 loops, best of 5: 307 ns per loop\n+sage: %timeit pL[5,5]\n+1000000 loops, best of 5: 611 ns per loop\n+sage: %timeit ~pL\n+100 loops, best of 5: 9.03 ms per loop\n+\n+sage: M.<w,z> = LaurentPolynomialRing(ZZ)\n+sage: pM = M.sum(w^i*z^j for i in range(50) for j in range(50))\n+sage: %timeit hash(pM)\n+1000 loops, best of 5: 1.84 ms per loop\n+```\n+vs before\n+\n+```\n+sage: %timeit pS.is_constant()\n+10000 loops, best of 5: 83.2 \u00b5s per loop\n+sage: %timeit pS.is_monomial()\n+10000 loops, best of 5: 81 \u00b5s per loop\n+sage: %timeit pS.is_generator()\n+10000 loops, best of 5: 82.8 \u00b5s per loop\n+sage: %timeit S.zero().is_constant()\n+1000000 loops, best of 5: 1.41 \u00b5s per loop\n+\n+sage: %timeit pL.is_monomial()\n+100000 loops, best of 5: 15.2 \u00b5s per loop\n+sage: %timeit pL[5,5]\n+100000 loops, best of 5: 17.5 \u00b5s per loop\n+sage: %timeit ~pL\n+100 loops, best of 5: 9.46 ms per loop\n+\n+sage: %timeit hash(pM)\n+100 loops, best of 5: 2.13 ms per loop\n+```\n+\n+---\n+\n+We add `is_term`, which was missing from libsingular multivariate polynomials. We also fix a bug that claims the 0 polynomial was a monomial:\n+\n+```\n+sage: P.<x,y,z> = PolynomialRing(QQ)\n+sage: P.zero().is_monomial()\n+True\n+```\n+\n+---\n+\n+Another bug-fix is that exponents of generic MPolys were mutable and cached:\n+\n+```\n+sage: pS.exponents().pop()\n+(0, 0)\n+sage: _ in pS.exponents()\n+False\n+```\n+\n``````\n",
    "created_at": "2020-05-16T05:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468735",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,106 @@
 We should take advantage of methods being able to now use `yield` in Cython and add a method to iterate over `(coefficient, exponent)` pairs as this can be useful (instead of monomials).
+
+---
+
+This also improves the iteration speed over multivariate polynomials:
+
+```
+sage: RR.<x,y> = ZZ[]
+sage: pR = R.sum(x^i*y^j for i in range(100) for j in range(100))
+sage: %timeit for _ in pR: pass
+100 loops, best of 5: 5.75 ms per loop
+
+sage: S.<x,y> = QQbar[]
+sage: pS = S.sum(x^i*y^j for i in range(100) for j in range(100))
+sage: %timeit for _ in pS: pass
+100 loops, best of 5: 11.1 ms per loop
+
+sage: L.<w,z> = LaurentPolynomialRing(R)
+sage: pL = L.sum(w^i*z^j for i in range(50) for j in range(50))
+sage: %timeit for _ in pL: pass
+100 loops, best of 5: 13 ms per loop
+```
+vs before:
+
+```
+sage: %timeit for _ in pR: pass
+100 loops, best of 5: 6.42 ms per loop
+
+sage: %timeit for _ in pS: pass
+100 loops, best of 5: 11.3 ms per loop
+
+sage: %timeit for _ in pL: pass
+10 loops, best of 5: 81.8 ms per loop
+```
+There won't be really any improvement in the generic implementation in terms of speed. However, the memory usage for all of these methods has been cut.
+
+---
+
+This improves the speed of a number of auxiliary methods:
+
+```
+sage: %timeit pS.is_constant()
+1000000 loops, best of 5: 258 ns per loop
+sage: %timeit pS.is_monomial()
+1000000 loops, best of 5: 286 ns per loop
+sage: %timeit pS.is_generator()
+1000000 loops, best of 5: 273 ns per loop
+sage: %timeit S.zero().is_constant()
+1000000 loops, best of 5: 326 ns per loop
+
+sage: %timeit pL.is_monomial()
+1000000 loops, best of 5: 307 ns per loop
+sage: %timeit pL[5,5]
+1000000 loops, best of 5: 611 ns per loop
+sage: %timeit ~pL
+100 loops, best of 5: 9.03 ms per loop
+
+sage: M.<w,z> = LaurentPolynomialRing(ZZ)
+sage: pM = M.sum(w^i*z^j for i in range(50) for j in range(50))
+sage: %timeit hash(pM)
+1000 loops, best of 5: 1.84 ms per loop
+```
+vs before
+
+```
+sage: %timeit pS.is_constant()
+10000 loops, best of 5: 83.2 µs per loop
+sage: %timeit pS.is_monomial()
+10000 loops, best of 5: 81 µs per loop
+sage: %timeit pS.is_generator()
+10000 loops, best of 5: 82.8 µs per loop
+sage: %timeit S.zero().is_constant()
+1000000 loops, best of 5: 1.41 µs per loop
+
+sage: %timeit pL.is_monomial()
+100000 loops, best of 5: 15.2 µs per loop
+sage: %timeit pL[5,5]
+100000 loops, best of 5: 17.5 µs per loop
+sage: %timeit ~pL
+100 loops, best of 5: 9.46 ms per loop
+
+sage: %timeit hash(pM)
+100 loops, best of 5: 2.13 ms per loop
+```
+
+---
+
+We add `is_term`, which was missing from libsingular multivariate polynomials. We also fix a bug that claims the 0 polynomial was a monomial:
+
+```
+sage: P.<x,y,z> = PolynomialRing(QQ)
+sage: P.zero().is_monomial()
+True
+```
+
+---
+
+Another bug-fix is that exponents of generic MPolys were mutable and cached:
+
+```
+sage: pS.exponents().pop()
+(0, 0)
+sage: _ in pS.exponents()
+False
+```
+
``````




---

archive/issue_comments_468736.json:
```json
{
    "body": "Commit: **[df935f0](https://github.com/sagemath/sagetrac-mirror/commit/df935f01c72aed5e027bfa9c1d27e1f6fde18cb2)**",
    "created_at": "2020-05-16T05:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468736",
    "user": "https://github.com/tscrim"
}
```

Commit: **[df935f0](https://github.com/sagemath/sagetrac-mirror/commit/df935f01c72aed5e027bfa9c1d27e1f6fde18cb2)**



---

archive/issue_events_375364.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-05-16T05:40:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375364"
}
```



---

archive/issue_comments_468737.json:
```json
{
    "body": "Branch: **[public/polynomials/improve_multivariate_iteration-29595](https://github.com/sagemath/sagetrac-mirror/tree/public/polynomials/improve_multivariate_iteration-29595)**",
    "created_at": "2020-05-16T05:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468737",
    "user": "https://github.com/tscrim"
}
```

Branch: **[public/polynomials/improve_multivariate_iteration-29595](https://github.com/sagemath/sagetrac-mirror/tree/public/polynomials/improve_multivariate_iteration-29595)**



---

archive/issue_events_375365.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-05-16T05:40:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375365"
}
```



---

archive/issue_events_375366.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-05-16T05:40:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375366"
}
```



---

archive/issue_comments_468738.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nOkay, I might have gone a bit overboard at the end. However, some of these little methods get some major speedups. There might be some other places to optimize. Definitely converting the generic multivariate polynomials to Cython will help and/or pushing more stuff to the polydict backend.\n\nI was actually expecting a bit more of a speedup from the libsingular iterator, but I guess that just goes to show the speed of the builtin Python iterators. However, it still gets about a ~10% speedup, which is nice, beyond the memory savings.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a57ddea1e8ed2966573d14b977cf920543fa147\">9a57dde</a></td><td><code>Improve the iterator, monomial, and exponents of libsingular MPolys.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ede384712ab4fd6bd68d71a965591ed37531e2d3\">ede3847</a></td><td><code>Improving generic MPoly iterator, monomials, and exponents.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c6e84a4cd7872590025c7c9578e3be7b9d4997f\">9c6e84a</a></td><td><code>Improving some is_* methods of generic MPolys.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56312bea9a2122b3d607cfcd75ae32f764252823\">56312be</a></td><td><code>Implementing an iterator_exp_coeff method for MPolys as a helper method.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a245839c427727192b073b4b1859137ef6778e93\">a245839</a></td><td><code>Using old-style loop syntax to get good C code (and hence speed).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e85d0f4ab98d0afb0e528a7a5c54985319ade0b4\">e85d0f4</a></td><td><code>Adding is_term and fixing bug with is_monomial of MPoly libsingular.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e40f5ce6e560a2db785c2961baa6f1da0ce966e\">6e40f5c</a></td><td><code>Improving Laurent MPolys and the 0 polynomial is not a term.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08a2b7100ef8838ecc6c5681fdd154faf721f6c8\">08a2b71</a></td><td><code>Doing some cleanup and some reverts from timing and looking at the C code.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df935f01c72aed5e027bfa9c1d27e1f6fde18cb2\">df935f0</a></td><td><code>Declaring one more variable type.</code></td></tr></table>\n",
    "created_at": "2020-05-16T05:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468738",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'>Comment 1:</a>
Okay, I might have gone a bit overboard at the end. However, some of these little methods get some major speedups. There might be some other places to optimize. Definitely converting the generic multivariate polynomials to Cython will help and/or pushing more stuff to the polydict backend.

I was actually expecting a bit more of a speedup from the libsingular iterator, but I guess that just goes to show the speed of the builtin Python iterators. However, it still gets about a ~10% speedup, which is nice, beyond the memory savings.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a57ddea1e8ed2966573d14b977cf920543fa147">9a57dde</a></td><td><code>Improve the iterator, monomial, and exponents of libsingular MPolys.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ede384712ab4fd6bd68d71a965591ed37531e2d3">ede3847</a></td><td><code>Improving generic MPoly iterator, monomials, and exponents.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c6e84a4cd7872590025c7c9578e3be7b9d4997f">9c6e84a</a></td><td><code>Improving some is_* methods of generic MPolys.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56312bea9a2122b3d607cfcd75ae32f764252823">56312be</a></td><td><code>Implementing an iterator_exp_coeff method for MPolys as a helper method.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a245839c427727192b073b4b1859137ef6778e93">a245839</a></td><td><code>Using old-style loop syntax to get good C code (and hence speed).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e85d0f4ab98d0afb0e528a7a5c54985319ade0b4">e85d0f4</a></td><td><code>Adding is_term and fixing bug with is_monomial of MPoly libsingular.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e40f5ce6e560a2db785c2961baa6f1da0ce966e">6e40f5c</a></td><td><code>Improving Laurent MPolys and the 0 polynomial is not a term.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08a2b7100ef8838ecc6c5681fdd154faf721f6c8">08a2b71</a></td><td><code>Doing some cleanup and some reverts from timing and looking at the C code.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df935f01c72aed5e027bfa9c1d27e1f6fde18cb2">df935f0</a></td><td><code>Declaring one more variable type.</code></td></tr></table>




---

archive/issue_comments_468739.json:
```json
{
    "body": "Author: **Travis Scrimshaw**",
    "created_at": "2020-05-16T05:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468739",
    "user": "https://github.com/tscrim"
}
```

Author: **Travis Scrimshaw**



---

archive/issue_comments_468740.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\none failing doctest\n\n```\nFile \"src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 3186, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.__iter__\nFailed example:\n    list(R.zero())\nExpected nothing\nGot:\n    []\n```",
    "created_at": "2020-05-16T07:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468740",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'>Comment 2:</a>
one failing doctest

```
File "src/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 3186, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.__iter__
Failed example:
    list(R.zero())
Expected nothing
Got:
    []
```



---

archive/issue_comments_468741.json:
```json
{
    "body": "Changed commit from **[df935f0](https://github.com/sagemath/sagetrac-mirror/commit/df935f01c72aed5e027bfa9c1d27e1f6fde18cb2)** to **[4c8424e](https://github.com/sagemath/sagetrac-mirror/commit/4c8424ee3759d00e548d341b775dce40b919091d)**",
    "created_at": "2020-05-16T07:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468741",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[df935f0](https://github.com/sagemath/sagetrac-mirror/commit/df935f01c72aed5e027bfa9c1d27e1f6fde18cb2)** to **[4c8424e](https://github.com/sagemath/sagetrac-mirror/commit/4c8424ee3759d00e548d341b775dce40b919091d)**



---

archive/issue_comments_468742.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c8424ee3759d00e548d341b775dce40b919091d\">4c8424e</a></td><td><code>Fixing a doctest.</code></td></tr></table>\n",
    "created_at": "2020-05-16T07:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468742",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c8424ee3759d00e548d341b775dce40b919091d">4c8424e</a></td><td><code>Fixing a doctest.</code></td></tr></table>




---

archive/issue_comments_468743.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nWhoops; fixed.",
    "created_at": "2020-05-16T07:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468743",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'>Comment 4:</a>
Whoops; fixed.



---

archive/issue_comments_468744.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nLooks good. There remains \n\n```\n+        one = ring.base_ring()(1)\n```\nthat maybe could use `.one()` ?",
    "created_at": "2020-05-17T06:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468744",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'>Comment 5:</a>
Looks good. There remains 

```
+        one = ring.base_ring()(1)
```
that maybe could use `.one()` ?



---

archive/issue_comments_468745.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2020-05-17T06:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468745",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_comments_468746.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@fchapoton](#comment%3A5):\n> Looks good. There remains \n> \n> ```\n> +        one = ring.base_ring()(1)\n> ```\n> that maybe could use `.one()` ?\n\nI saw that and I was a little hesitant about changing it as I couldn't remember if we could create polynomials with coefficients in Python types, such as `int`. However, from looking at it a bit more, it seems like this cannot happen, so I will change it.",
    "created_at": "2020-05-17T06:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468746",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@fchapoton](#comment%3A5):
> Looks good. There remains 
> 
> ```
> +        one = ring.base_ring()(1)
> ```
> that maybe could use `.one()` ?

I saw that and I was a little hesitant about changing it as I couldn't remember if we could create polynomials with coefficients in Python types, such as `int`. However, from looking at it a bit more, it seems like this cannot happen, so I will change it.



---

archive/issue_comments_468747.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7fdccb1f2a0022e483d7e23f7f0dedca9a94ef7\">b7fdccb</a></td><td><code>A few other micro-optimizations.</code></td></tr></table>\n",
    "created_at": "2020-05-18T01:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468747",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7fdccb1f2a0022e483d7e23f7f0dedca9a94ef7">b7fdccb</a></td><td><code>A few other micro-optimizations.</code></td></tr></table>




---

archive/issue_comments_468748.json:
```json
{
    "body": "Changed commit from **[4c8424e](https://github.com/sagemath/sagetrac-mirror/commit/4c8424ee3759d00e548d341b775dce40b919091d)** to **[b7fdccb](https://github.com/sagemath/sagetrac-mirror/commit/b7fdccb1f2a0022e483d7e23f7f0dedca9a94ef7)**",
    "created_at": "2020-05-18T01:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468748",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4c8424e](https://github.com/sagemath/sagetrac-mirror/commit/4c8424ee3759d00e548d341b775dce40b919091d)** to **[b7fdccb](https://github.com/sagemath/sagetrac-mirror/commit/b7fdccb1f2a0022e483d7e23f7f0dedca9a94ef7)**



---

archive/issue_comments_468749.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee73868072306af56350a288d1b2fee12457e26c\">ee73868</a></td><td><code>Some last minute details to clean the generic MPoly file.</code></td></tr></table>\n",
    "created_at": "2020-05-18T01:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468749",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee73868072306af56350a288d1b2fee12457e26c">ee73868</a></td><td><code>Some last minute details to clean the generic MPoly file.</code></td></tr></table>




---

archive/issue_comments_468750.json:
```json
{
    "body": "Changed commit from **[b7fdccb](https://github.com/sagemath/sagetrac-mirror/commit/b7fdccb1f2a0022e483d7e23f7f0dedca9a94ef7)** to **[ee73868](https://github.com/sagemath/sagetrac-mirror/commit/ee73868072306af56350a288d1b2fee12457e26c)**",
    "created_at": "2020-05-18T01:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468750",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b7fdccb](https://github.com/sagemath/sagetrac-mirror/commit/b7fdccb1f2a0022e483d7e23f7f0dedca9a94ef7)** to **[ee73868](https://github.com/sagemath/sagetrac-mirror/commit/ee73868072306af56350a288d1b2fee12457e26c)**



---

archive/issue_comments_468751.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nDone with some little bit of other cleanup/micro-optimizations.",
    "created_at": "2020-05-18T01:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468751",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'>Comment 10:</a>
Done with some little bit of other cleanup/micro-optimizations.



---

archive/issue_events_375367.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-05-18T07:50:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375367"
}
```



---

archive/issue_events_375368.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-05-18T07:50:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375368"
}
```



---

archive/issue_comments_468752.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nok, looks good. Nice improvement",
    "created_at": "2020-05-18T07:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468752",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'>Comment 11:</a>
ok, looks good. Nice improvement



---

archive/issue_comments_468753.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@fchapoton](#comment%3A11):\n> ok, looks good. Nice improvement\n\nThank you.",
    "created_at": "2020-05-19T00:44:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468753",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@fchapoton](#comment%3A11):
> ok, looks good. Nice improvement

Thank you.



---

archive/issue_events_375369.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-21T17:55:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375369"
}
```



---

archive/issue_events_375370.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-21T17:55:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375370"
}
```



---

archive/issue_comments_468754.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nmerge conflict",
    "created_at": "2020-05-21T17:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468754",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'>Comment 13:</a>
merge conflict



---

archive/issue_comments_468755.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/931f345c1199c876335b200b503547f5ee67f571\">931f345</a></td><td><code>Merge branch 'public/polynomials/improve_multivariate_iteration-29595' of git://trac.sagemath.org/sage into public/polynomials/improve_multivariate_iteration-29595</code></td></tr></table>\n",
    "created_at": "2020-05-29T01:08:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468755",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/931f345c1199c876335b200b503547f5ee67f571">931f345</a></td><td><code>Merge branch 'public/polynomials/improve_multivariate_iteration-29595' of git://trac.sagemath.org/sage into public/polynomials/improve_multivariate_iteration-29595</code></td></tr></table>




---

archive/issue_comments_468756.json:
```json
{
    "body": "Changed commit from **[ee73868](https://github.com/sagemath/sagetrac-mirror/commit/ee73868072306af56350a288d1b2fee12457e26c)** to **[931f345](https://github.com/sagemath/sagetrac-mirror/commit/931f345c1199c876335b200b503547f5ee67f571)**",
    "created_at": "2020-05-29T01:08:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468756",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ee73868](https://github.com/sagemath/sagetrac-mirror/commit/ee73868072306af56350a288d1b2fee12457e26c)** to **[931f345](https://github.com/sagemath/sagetrac-mirror/commit/931f345c1199c876335b200b503547f5ee67f571)**



---

archive/issue_events_375371.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-05-29T01:08:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375371"
}
```



---

archive/issue_events_375372.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-05-29T01:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375372"
}
```



---

archive/issue_comments_468757.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nTrivial rebase.",
    "created_at": "2020-05-29T01:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468757",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'>Comment 15:</a>
Trivial rebase.



---

archive/issue_events_375373.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-31T08:49:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375373"
}
```



---

archive/issue_events_375374.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0c5cf79598ebaaefc805e472b4e220503d9c1935",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-05-31T08:49:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29595#event-375374"
}
```



---

archive/issue_comments_468758.json:
```json
{
    "body": "Changed branch from **[public/polynomials/improve_multivariate_iteration-29595](https://github.com/sagemath/sagetrac-mirror/tree/public/polynomials/improve_multivariate_iteration-29595)** to **[931f345](https://github.com/sagemath/sagetrac-mirror/commit/931f345c1199c876335b200b503547f5ee67f571)**",
    "created_at": "2020-05-31T08:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29595#issuecomment-468758",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/polynomials/improve_multivariate_iteration-29595](https://github.com/sagemath/sagetrac-mirror/tree/public/polynomials/improve_multivariate_iteration-29595)** to **[931f345](https://github.com/sagemath/sagetrac-mirror/commit/931f345c1199c876335b200b503547f5ee67f571)**
