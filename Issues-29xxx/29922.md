# Issue 29922: sage.doctest: Make imports more specific; make global environment for tests customizable

archive/issues_029685.json:
```json
{
    "body": "We prepare the Sage doctesting module for running in environments where `sage.all` is not available (#29705).\n\n1. An explicit import in `sage.doctest.parsing`:\n\n```\n# We need to import from sage.all to avoid circular imports.\nfrom sage.all import RealIntervalField\nRIFtol = RealIntervalField(1044)\n```\n\n\n2. We make the global environment for tests customizable in `sage.doctest.forker`: in `init_sage`:\n\n```\n    import sage.repl.ipython_kernel.all_jupyter\n```\n   and again in `DocTestTask._run`:\n\n```\n            # Import Jupyter globals to doctest the Jupyter\n            # implementation of widgets and interacts\n            import sage.repl.ipython_kernel.all_jupyter as sage_all\n```\n... which is\n\n```\n\"\"\"\nAll imports for Jupyter\n\"\"\"\n\nfrom sage.all_cmdline import *\n\nfrom .widgets_sagenb import (input_box, text_control, slider,\n        range_slider, checkbox, selector, input_grid, color_selector)\nfrom .interact import interact\n```\n\n   This is exposed by the new `sage-runtest` option `--environment`.\n\n   For example, #29865 defines modules such as `sage.all__sage_objects`. We would invoke `sage -t --environment=sage.all__sage_objects` to test against this global environment.\n\n\n3. We ignore errors importing `sage.interfaces`.\n\n\n\nCC:  @tscrim @fchapoton @orlitzky @kliem @kiwifb\n\nBranch/Commit: 2a602df11ae0e6d3b8d8d964636c75063b51df43\n\nReviewer: Jonathan Kliem\n\nAuthor: Matthias Koeppe\n\nDependencies: #29940\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29922\n\n",
    "closed_at": "2020-07-25T22:51:09Z",
    "created_at": "2020-06-20T21:29:57Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "sage.doctest: Make imports more specific; make global environment for tests customizable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29922",
    "user": "https://github.com/mkoeppe"
}
```
We prepare the Sage doctesting module for running in environments where `sage.all` is not available (#29705).

1. An explicit import in `sage.doctest.parsing`:

```
# We need to import from sage.all to avoid circular imports.
from sage.all import RealIntervalField
RIFtol = RealIntervalField(1044)
```


2. We make the global environment for tests customizable in `sage.doctest.forker`: in `init_sage`:

```
    import sage.repl.ipython_kernel.all_jupyter
```
   and again in `DocTestTask._run`:

```
            # Import Jupyter globals to doctest the Jupyter
            # implementation of widgets and interacts
            import sage.repl.ipython_kernel.all_jupyter as sage_all
```
... which is

```
"""
All imports for Jupyter
"""

from sage.all_cmdline import *

from .widgets_sagenb import (input_box, text_control, slider,
        range_slider, checkbox, selector, input_grid, color_selector)
from .interact import interact
```

   This is exposed by the new `sage-runtest` option `--environment`.

   For example, #29865 defines modules such as `sage.all__sage_objects`. We would invoke `sage -t --environment=sage.all__sage_objects` to test against this global environment.


3. We ignore errors importing `sage.interfaces`.



CC:  @tscrim @fchapoton @orlitzky @kliem @kiwifb

Branch/Commit: 2a602df11ae0e6d3b8d8d964636c75063b51df43

Reviewer: Jonathan Kliem

Author: Matthias Koeppe

Dependencies: #29940

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29922





---

archive/issue_comments_579949.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,8 @@\n+In `sage.doctest.parsing`:\n \n+```\n+# We need to import from sage.all to avoid circular imports.\n+from sage.all import RealIntervalField\n+RIFtol = RealIntervalField(1044)\n+```\n+\n``````\n",
    "created_at": "2020-06-20T21:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579949",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,8 @@
+In `sage.doctest.parsing`:
 
+```
+# We need to import from sage.all to avoid circular imports.
+from sage.all import RealIntervalField
+RIFtol = RealIntervalField(1044)
+```
+
``````




---

archive/issue_comments_579950.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-In `sage.doctest.parsing`:\n+We prepare the Sage doctesting module for running in environments where `sage.all` is not available (#29705).\n+\n+1. A rather disturbing, graphic import in `sage.doctest.parsing`:\n \n ```\n # We need to import from sage.all to avoid circular imports.\n@@ -6,3 +8,26 @@\n RIFtol = RealIntervalField(1044)\n ```\n \n+\n+2. We need to make the global environment for tests customizable in `sage.doctest.forker`:\n+\n+```\n+            # Import Jupyter globals to doctest the Jupyter\n+            # implementation of widgets and interacts\n+            import sage.repl.ipython_kernel.all_jupyter as sage_all\n+```\n+... which is\n+\n+```\n+\"\"\"\n+All imports for Jupyter\n+\"\"\"\n+\n+from sage.all_cmdline import *\n+\n+from .widgets_sagenb import (input_box, text_control, slider,\n+        range_slider, checkbox, selector, input_grid, color_selector)\n+from .interact import interact\n+```\n+\n+\n``````\n",
    "created_at": "2020-06-20T21:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579950",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-In `sage.doctest.parsing`:
+We prepare the Sage doctesting module for running in environments where `sage.all` is not available (#29705).
+
+1. A rather disturbing, graphic import in `sage.doctest.parsing`:
 
 ```
 # We need to import from sage.all to avoid circular imports.
@@ -6,3 +8,26 @@
 RIFtol = RealIntervalField(1044)
 ```
 
+
+2. We need to make the global environment for tests customizable in `sage.doctest.forker`:
+
+```
+            # Import Jupyter globals to doctest the Jupyter
+            # implementation of widgets and interacts
+            import sage.repl.ipython_kernel.all_jupyter as sage_all
+```
+... which is
+
+```
+"""
+All imports for Jupyter
+"""
+
+from sage.all_cmdline import *
+
+from .widgets_sagenb import (input_box, text_control, slider,
+        range_slider, checkbox, selector, input_grid, color_selector)
+from .interact import interact
+```
+
+
``````




---

archive/issue_events_094476.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "rename": {
        "from": "sage.doctest: Make imports more specific",
        "to": "sage.doctest: Make imports more specific; make global environment for tests customizable"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29922#event-94476"
}
```



---

archive/issue_comments_579951.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,12 @@\n ```\n \n \n-2. We need to make the global environment for tests customizable in `sage.doctest.forker`:\n+2. We need to make the global environment for tests customizable in `sage.doctest.forker`: in `init_sage`:\n+\n+```\n+    import sage.repl.ipython_kernel.all_jupyter\n+```\n+   and again in `DocTestTask._run`:\n \n ```\n             # Import Jupyter globals to doctest the Jupyter\n``````\n",
    "created_at": "2020-06-20T21:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579951",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,12 @@
 ```
 
 
-2. We need to make the global environment for tests customizable in `sage.doctest.forker`:
+2. We need to make the global environment for tests customizable in `sage.doctest.forker`: in `init_sage`:
+
+```
+    import sage.repl.ipython_kernel.all_jupyter
+```
+   and again in `DocTestTask._run`:
 
 ```
             # Import Jupyter globals to doctest the Jupyter
``````




---

archive/issue_comments_579952.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -35,4 +35,7 @@\n from .interact import interact\n ```\n \n+For example, #29865 defines modules such as `sage.all__sage_objects`. We would invoke `sage -t --environment=sage.all__sage_objects` to test against this global environment.\n \n+\n+\n``````\n",
    "created_at": "2020-06-21T02:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579952",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -35,4 +35,7 @@
 from .interact import interact
 ```
 
+For example, #29865 defines modules such as `sage.all__sage_objects`. We would invoke `sage -t --environment=sage.all__sage_objects` to test against this global environment.
 
+
+
``````




---

archive/issue_comments_579953.json:
```json
{
    "body": "<a id='comment:6'></a>\nProbably we will need to disable the real tolerance feature when we want to test the lowest layers such as `sage-objects` to avoid having to pull in the whole numeric tower.",
    "created_at": "2020-06-22T18:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579953",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Probably we will need to disable the real tolerance feature when we want to test the lowest layers such as `sage-objects` to avoid having to pull in the whole numeric tower.



---

archive/issue_comments_579954.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/sage_doctest__make_imports_more_specific__make_global_environment_for_tests_customizable\"",
    "created_at": "2020-06-22T20:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579954",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/sage_doctest__make_imports_more_specific__make_global_environment_for_tests_customizable"



---

archive/issue_comments_579955.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|\n|[7d86833](https://github.com/sagemath/sagetrac-mirror/commit/7d86833b96726e0a631aaea217c85be593f96bf8)|`sage.doctest.forker: Do not fail if sage.interfaces.quit cannot be imported`|",
    "created_at": "2020-06-22T20:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579955",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
|[7d86833](https://github.com/sagemath/sagetrac-mirror/commit/7d86833b96726e0a631aaea217c85be593f96bf8)|`sage.doctest.forker: Do not fail if sage.interfaces.quit cannot be imported`|



---

archive/issue_comments_579956.json:
```json
{
    "body": "Changing commit from \"\" to \"7d86833b96726e0a631aaea217c85be593f96bf8\"",
    "created_at": "2020-06-22T20:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "7d86833b96726e0a631aaea217c85be593f96bf8"



---

archive/issue_comments_579957.json:
```json
{
    "body": "<a id='comment:10'></a>\nCc'ing you because this ticket is touching the same files that will need to be modified if you want to implement the option for #29935",
    "created_at": "2020-06-22T20:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579957",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Cc'ing you because this ticket is touching the same files that will need to be modified if you want to implement the option for #29935



---

archive/issue_comments_579958.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[b3ab1c1](https://github.com/sagemath/sagetrac-mirror/commit/b3ab1c1efcf1870340afba7a965cf60044addac2)|`src/bin/sage-runtests: Add --environment option`|",
    "created_at": "2020-06-22T20:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[b3ab1c1](https://github.com/sagemath/sagetrac-mirror/commit/b3ab1c1efcf1870340afba7a965cf60044addac2)|`src/bin/sage-runtests: Add --environment option`|



---

archive/issue_comments_579959.json:
```json
{
    "body": "Changing commit from \"7d86833b96726e0a631aaea217c85be593f96bf8\" to \"b3ab1c1efcf1870340afba7a965cf60044addac2\"",
    "created_at": "2020-06-22T20:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7d86833b96726e0a631aaea217c85be593f96bf8" to "b3ab1c1efcf1870340afba7a965cf60044addac2"



---

archive/issue_comments_579960.json:
```json
{
    "body": "Changing commit from \"b3ab1c1efcf1870340afba7a965cf60044addac2\" to \"66572cdecde05cd7fafe3f229169f96e2b697956\"",
    "created_at": "2020-06-22T21:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b3ab1c1efcf1870340afba7a965cf60044addac2" to "66572cdecde05cd7fafe3f229169f96e2b697956"



---

archive/issue_comments_579961.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|\n|[9757019](https://github.com/sagemath/sagetrac-mirror/commit/97570190f143f2ecf7f3a8d3c27101c89d49fc84)|`sage.doctest.forker.DocTestTask._run: Remove special support for sagenb`|\n|[66572cd](https://github.com/sagemath/sagetrac-mirror/commit/66572cdecde05cd7fafe3f229169f96e2b697956)|`WIP`|",
    "created_at": "2020-06-22T21:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579961",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|[9757019](https://github.com/sagemath/sagetrac-mirror/commit/97570190f143f2ecf7f3a8d3c27101c89d49fc84)|`sage.doctest.forker.DocTestTask._run: Remove special support for sagenb`|
|[66572cd](https://github.com/sagemath/sagetrac-mirror/commit/66572cdecde05cd7fafe3f229169f96e2b697956)|`WIP`|



---

archive/issue_comments_579962.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29940\"",
    "created_at": "2020-06-22T21:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579962",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29940"



---

archive/issue_comments_579963.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|\n|[6bec225](https://github.com/sagemath/sagetrac-mirror/commit/6bec2253f4afc94fb23ff032f40f6ec348e887f2)|`sage.doctest.forker.DocTestTask._run: Remove special support for sagenb`|\n|[ad00b40](https://github.com/sagemath/sagetrac-mirror/commit/ad00b401f49d2e6b0afbb216fad845b563cf73bc)|`sage.doctest, src/bin/sage-runtests: Remove handling of sagenb`|\n|[faef943](https://github.com/sagemath/sagetrac-mirror/commit/faef9434904c7e0aabd41d572b33c595256cbf14)|`Merge branch 't/29940/sage_doctest__remove_handling_of_sagenb' into t/29922/sage_doctest__make_imports_more_specific__make_global_environment_for_tests_customizable`|\n|[67db00f](https://github.com/sagemath/sagetrac-mirror/commit/67db00f1d9432739a6849aded2428c835795ae6b)|`src/bin/sage-runtests, sage.doctest: Handle option --environment`|",
    "created_at": "2020-06-22T21:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579963",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|[6bec225](https://github.com/sagemath/sagetrac-mirror/commit/6bec2253f4afc94fb23ff032f40f6ec348e887f2)|`sage.doctest.forker.DocTestTask._run: Remove special support for sagenb`|
|[ad00b40](https://github.com/sagemath/sagetrac-mirror/commit/ad00b401f49d2e6b0afbb216fad845b563cf73bc)|`sage.doctest, src/bin/sage-runtests: Remove handling of sagenb`|
|[faef943](https://github.com/sagemath/sagetrac-mirror/commit/faef9434904c7e0aabd41d572b33c595256cbf14)|`Merge branch 't/29940/sage_doctest__remove_handling_of_sagenb' into t/29922/sage_doctest__make_imports_more_specific__make_global_environment_for_tests_customizable`|
|[67db00f](https://github.com/sagemath/sagetrac-mirror/commit/67db00f1d9432739a6849aded2428c835795ae6b)|`src/bin/sage-runtests, sage.doctest: Handle option --environment`|



---

archive/issue_comments_579964.json:
```json
{
    "body": "Changing commit from \"66572cdecde05cd7fafe3f229169f96e2b697956\" to \"67db00f1d9432739a6849aded2428c835795ae6b\"",
    "created_at": "2020-06-22T21:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579964",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "66572cdecde05cd7fafe3f229169f96e2b697956" to "67db00f1d9432739a6849aded2428c835795ae6b"



---

archive/issue_comments_579965.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-22T21:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579965",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_579966.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-06-22T21:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579966",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_579967.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n We prepare the Sage doctesting module for running in environments where `sage.all` is not available (#29705).\n \n-1. A rather disturbing, graphic import in `sage.doctest.parsing`:\n+1. An explicit import in `sage.doctest.parsing`:\n \n ```\n # We need to import from sage.all to avoid circular imports.\n@@ -9,7 +9,7 @@\n ```\n \n \n-2. We need to make the global environment for tests customizable in `sage.doctest.forker`: in `init_sage`:\n+2. We make the global environment for tests customizable in `sage.doctest.forker`: in `init_sage`:\n \n ```\n     import sage.repl.ipython_kernel.all_jupyter\n@@ -35,7 +35,11 @@\n from .interact import interact\n ```\n \n-For example, #29865 defines modules such as `sage.all__sage_objects`. We would invoke `sage -t --environment=sage.all__sage_objects` to test against this global environment.\n+   This is exposed by the new `sage-runtest` option `--environment`.\n+\n+   For example, #29865 defines modules such as `sage.all__sage_objects`. We would invoke `sage -t --environment=sage.all__sage_objects` to test against this global environment.\n \n \n+3. We ignore errors importing `sage.interfaces`.\n \n+\n``````\n",
    "created_at": "2020-06-22T21:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579967",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 We prepare the Sage doctesting module for running in environments where `sage.all` is not available (#29705).
 
-1. A rather disturbing, graphic import in `sage.doctest.parsing`:
+1. An explicit import in `sage.doctest.parsing`:
 
 ```
 # We need to import from sage.all to avoid circular imports.
@@ -9,7 +9,7 @@
 ```
 
 
-2. We need to make the global environment for tests customizable in `sage.doctest.forker`: in `init_sage`:
+2. We make the global environment for tests customizable in `sage.doctest.forker`: in `init_sage`:
 
 ```
     import sage.repl.ipython_kernel.all_jupyter
@@ -35,7 +35,11 @@
 from .interact import interact
 ```
 
-For example, #29865 defines modules such as `sage.all__sage_objects`. We would invoke `sage -t --environment=sage.all__sage_objects` to test against this global environment.
+   This is exposed by the new `sage-runtest` option `--environment`.
+
+   For example, #29865 defines modules such as `sage.all__sage_objects`. We would invoke `sage -t --environment=sage.all__sage_objects` to test against this global environment.
 
 
+3. We ignore errors importing `sage.interfaces`.
 
+
``````




---

archive/issue_comments_579968.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-22T22:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579968",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_579969.json:
```json
{
    "body": "Changing commit from \"67db00f1d9432739a6849aded2428c835795ae6b\" to \"2a602df11ae0e6d3b8d8d964636c75063b51df43\"",
    "created_at": "2020-06-22T23:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579969",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "67db00f1d9432739a6849aded2428c835795ae6b" to "2a602df11ae0e6d3b8d8d964636c75063b51df43"



---

archive/issue_comments_579970.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[9bf6f88](https://github.com/sagemath/sagetrac-mirror/commit/9bf6f88c6d3f684c329e6487ed871b4975475830)|`sage.doctest.control: Remove unused import`|\n|[89988cf](https://github.com/sagemath/sagetrac-mirror/commit/89988cfffd9221a0dcd9cfdc15b1243d6378bb5e)|`sage.doctest.forker.init_sage: Actually handle the optional arg`|\n|[2664865](https://github.com/sagemath/sagetrac-mirror/commit/266486561293b03d084a1d610b2119aca2885f85)|`sage.misc.package: Do not fail if SAGE_PKGS, SAGE_SPKG_INST do not exist`|\n|[2a602df](https://github.com/sagemath/sagetrac-mirror/commit/2a602df11ae0e6d3b8d8d964636c75063b51df43)|`sage.repl.display.fancy_repr: Do not fail if sage.matrix.matrix1 canno be imported`|",
    "created_at": "2020-06-22T23:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579970",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[9bf6f88](https://github.com/sagemath/sagetrac-mirror/commit/9bf6f88c6d3f684c329e6487ed871b4975475830)|`sage.doctest.control: Remove unused import`|
|[89988cf](https://github.com/sagemath/sagetrac-mirror/commit/89988cfffd9221a0dcd9cfdc15b1243d6378bb5e)|`sage.doctest.forker.init_sage: Actually handle the optional arg`|
|[2664865](https://github.com/sagemath/sagetrac-mirror/commit/266486561293b03d084a1d610b2119aca2885f85)|`sage.misc.package: Do not fail if SAGE_PKGS, SAGE_SPKG_INST do not exist`|
|[2a602df](https://github.com/sagemath/sagetrac-mirror/commit/2a602df11ae0e6d3b8d8d964636c75063b51df43)|`sage.repl.display.fancy_repr: Do not fail if sage.matrix.matrix1 canno be imported`|



---

archive/issue_comments_579971.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-22T23:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579971",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_579972.json:
```json
{
    "body": "<a id='comment:19'></a>\nReady for review",
    "created_at": "2020-07-02T22:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579972",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Ready for review



---

archive/issue_comments_579973.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jonathan Kliem\"",
    "created_at": "2020-07-17T20:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579973",
    "user": "https://github.com/kliem"
}
```

Changing reviewer from "" to "Jonathan Kliem"



---

archive/issue_comments_579974.json:
```json
{
    "body": "<a id='comment:21'></a>\nThis looks reasonable, it does not break the doctesting framework and the added doctests pass.",
    "created_at": "2020-07-17T20:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579974",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>
This looks reasonable, it does not break the doctesting framework and the added doctests pass.



---

archive/issue_comments_579975.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-17T20:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579975",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_579976.json:
```json
{
    "body": "<a id='comment:22'></a>\nThank you.",
    "created_at": "2020-07-17T20:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579976",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Thank you.



---

archive/issue_events_094477.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-25T22:51:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29922#event-94477"
}
```



---

archive/issue_comments_579977.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/sage_doctest__make_imports_more_specific__make_global_environment_for_tests_customizable\" to \"2a602df11ae0e6d3b8d8d964636c75063b51df43\"",
    "created_at": "2020-07-25T22:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579977",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/sage_doctest__make_imports_more_specific__make_global_environment_for_tests_customizable" to "2a602df11ae0e6d3b8d8d964636c75063b51df43"



---

archive/issue_comments_579978.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-25T22:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29922#issuecomment-579978",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
