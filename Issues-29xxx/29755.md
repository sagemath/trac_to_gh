# Issue 29755: Multiprocessing in tensor computations does not work under macOS

archive/issues_029518.json:
```json
{
    "assignees": [],
    "body": "Multiprocessing, as implemented in differential geometry computations via\n\n```\nsage: Parallelism().set(nproc=8)\n```\ndoes not work under macOS. This has been reported by many users, a recent report being https://groups.google.com/d/msg/sage-support/0RsGgb3lmZg/zNTMFLH9AQAJ\n\nNote there is no issue within the doctest framework, i.e. the doctests involving parallel computations implemented in `src/sage/manifolds/differentiable` and `src/sage/tensor/modules` are passed on macOS machines.\n\nKeywords: **multiprocessing, parallelization, macOS**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29755_\n\n",
    "closed_at": "2020-06-14T13:24:55Z",
    "created_at": "2020-05-29T13:03:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/invalid",
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/worksforme"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Multiprocessing in tensor computations does not work under macOS",
    "type": "issue",
    "updated_at": "2020-06-14T13:24:55Z",
    "url": "https://github.com/sagemath/sage/issues/29755",
    "user": "https://github.com/egourgoulhon"
}
```
Multiprocessing, as implemented in differential geometry computations via

```
sage: Parallelism().set(nproc=8)
```
does not work under macOS. This has been reported by many users, a recent report being https://groups.google.com/d/msg/sage-support/0RsGgb3lmZg/zNTMFLH9AQAJ

Note there is no issue within the doctest framework, i.e. the doctests involving parallel computations implemented in `src/sage/manifolds/differentiable` and `src/sage/tensor/modules` are passed on macOS machines.

Keywords: **multiprocessing, parallelization, macOS**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/29755_





---

archive/issue_events_391202.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-05-29T13:03:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391202"
}
```



---

archive/issue_events_391203.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-05-29T13:03:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391203"
}
```



---

archive/issue_events_391204.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-05-29T13:03:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391204"
}
```



---

archive/issue_events_391205.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-05-29T13:03:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391205"
}
```



---

archive/issue_comments_472511.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nit is not clear how to see that it is broken. Could you point at a doctest that doesn't work at the Sage prompt?",
    "created_at": "2020-05-29T13:25:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29755#issuecomment-472511",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'>Comment 1:</a>
it is not clear how to see that it is broken. Could you point at a doctest that doesn't work at the Sage prompt?



---

archive/issue_comments_472512.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nReplying to [@dimpase](#comment%3A1):\n> it is not clear how to see that it is broken. Could you point at a doctest that doesn't work at the Sage prompt?\n\nFor instance, the doctest about the [parallelization of the Lie derivative](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/tensorfield_paral.html#sage.manifolds.differentiable.tensorfield_paral.TensorFieldParal.lie_derivative), a short version of which is\n\n```\nsage: M = Manifold(2, 'M')\nsage: X.<x,y> = M.chart()\nsage: v = M.vector_field(-y, x)\nsage: w = M.one_form(y^2*sin(x), x^3*cos(y))\nsage: Parallelism().set(nproc=2)\nsage: w.lie_derivative(v).display()\n(-y^3*cos(x) + x^3*cos(y) + 2*x*y*sin(x)) dx \n + (-x^4*sin(y) - 3*x^2*y*cos(y) - y^2*sin(x)) dy\n```",
    "created_at": "2020-05-29T17:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29755#issuecomment-472512",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:2'>Comment 2:</a>
Replying to [@dimpase](#comment%3A1):
> it is not clear how to see that it is broken. Could you point at a doctest that doesn't work at the Sage prompt?

For instance, the doctest about the [parallelization of the Lie derivative](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/tensorfield_paral.html#sage.manifolds.differentiable.tensorfield_paral.TensorFieldParal.lie_derivative), a short version of which is

```
sage: M = Manifold(2, 'M')
sage: X.<x,y> = M.chart()
sage: v = M.vector_field(-y, x)
sage: w = M.one_form(y^2*sin(x), x^3*cos(y))
sage: Parallelism().set(nproc=2)
sage: w.lie_derivative(v).display()
(-y^3*cos(x) + x^3*cos(y) + 2*x*y*sin(x)) dx 
 + (-x^4*sin(y) - 3*x^2*y*cos(y) - y^2*sin(x)) dy
```



---

archive/issue_comments_472513.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThe OP at https://groups.google.com/d/msg/sage-support/0RsGgb3lmZg/WNxT_rzNAwAJ says that the problem is fixed in Sage 9.1. Dima, can you confirm this? (sorry I don't have any macOS computer at hand...). If yes, we may close this ticket.",
    "created_at": "2020-06-02T06:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29755#issuecomment-472513",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:3'>Comment 3:</a>
The OP at https://groups.google.com/d/msg/sage-support/0RsGgb3lmZg/WNxT_rzNAwAJ says that the problem is fixed in Sage 9.1. Dima, can you confirm this? (sorry I don't have any macOS computer at hand...). If yes, we may close this ticket.



---

archive/issue_comments_472514.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-06-07T17:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29755#issuecomment-472514",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_391206.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-07T17:09:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391206"
}
```



---

archive/issue_comments_472515.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nworks for me on macOS and Sage 9.2.beta0",
    "created_at": "2020-06-07T17:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29755#issuecomment-472515",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'>Comment 4:</a>
works for me on macOS and Sage 9.2.beta0



---

archive/issue_events_391207.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-07T17:09:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391207"
}
```



---

archive/issue_events_391208.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-07T17:09:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391208"
}
```



---

archive/issue_events_391209.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-07T17:09:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391209"
}
```



---

archive/issue_events_391210.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-07T17:09:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391210"
}
```



---

archive/issue_events_391211.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-06-07T17:09:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391211"
}
```



---

archive/issue_comments_472516.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@dimpase](#comment%3A4):\n> works for me on macOS and Sage 9.2.beta0\n\nThank you Dima!",
    "created_at": "2020-06-08T07:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29755#issuecomment-472516",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@dimpase](#comment%3A4):
> works for me on macOS and Sage 9.2.beta0

Thank you Dima!



---

archive/issue_events_391212.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-06-14T13:24:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/worksforme",
    "label_color": "a6a6a6",
    "label_name": "worksforme",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391212"
}
```



---

archive/issue_events_391213.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-06-14T13:24:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391213"
}
```



---

archive/issue_events_391214.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-06-14T13:24:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29755",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29755#event-391214"
}
```
