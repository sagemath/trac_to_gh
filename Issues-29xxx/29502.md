# Issue 29502: spkg-configure for suitesparse

archive/issues_029265.json:
```json
{
    "body": "Different distos use different subsets of SuiteSparse,\nbut this is needed to be done. Apparently all we need is CHOLMOD (with its dependencies),UMFRACK and suitesparseconfig.\n\n\n\nCC:  @mkoeppe @orlitzky @thierry-freebsd @kiwifb\n\nReviewer: Michael Orlitzky\n\nAuthor: Dima Pasechnik\n\nBranch: f2cc5b457f4945d15970bf823f5046d62564522a\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29502\n\n",
    "closed_at": "2020-05-26T21:44:06Z",
    "created_at": "2020-04-13T03:33:31Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "spkg-configure for suitesparse",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29502",
    "user": "https://github.com/dimpase"
}
```
Different distos use different subsets of SuiteSparse,
but this is needed to be done. Apparently all we need is CHOLMOD (with its dependencies),UMFRACK and suitesparseconfig.



CC:  @mkoeppe @orlitzky @thierry-freebsd @kiwifb

Reviewer: Michael Orlitzky

Author: Dima Pasechnik

Branch: f2cc5b457f4945d15970bf823f5046d62564522a

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29502





---

archive/issue_comments_441724.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n I guess that different distos use different subsets of SuiteSparse,\n-but this is needed to be done.\n+but this is needed to be done. Apparently all we need is CHOLMOD (with its dependencies).\n \n Comment: 1\n \n```\n",
    "created_at": "2020-04-13T08:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441724",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,5 +1,5 @@
 I guess that different distos use different subsets of SuiteSparse,
-but this is needed to be done.
+but this is needed to be done. Apparently all we need is CHOLMOD (with its dependencies).
 
 Comment: 1
 
```




---

archive/issue_comments_441725.json:
```json
{
    "body": "Attachment [umfpack.m4](tarball://root/attachments/some-uuid/ticket29502/umfpack.m4) by @thierry-FreeBSD created at 2020-04-13 09:05:50",
    "created_at": "2020-04-13T09:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441725",
    "user": "https://github.com/thierry-FreeBSD"
}
```

Attachment [umfpack.m4](tarball://root/attachments/some-uuid/ticket29502/umfpack.m4) by @thierry-FreeBSD created at 2020-04-13 09:05:50



---

archive/issue_comments_441726.json:
```json
{
    "body": "<a id='comment:3'></a>Thanks! I do not know anything about macro m4 and autotools, but I already tried to work on this. For that, I borrowed a file umfpack.m4 from the Dune project, before they switched to cmake. It is released under a GPL license. Please see the attachment if it could help.",
    "created_at": "2020-04-13T09:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441726",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:3'></a>Thanks! I do not know anything about macro m4 and autotools, but I already tried to work on this. For that, I borrowed a file umfpack.m4 from the Dune project, before they switched to cmake. It is released under a GPL license. Please see the attachment if it could help.



---

archive/issue_comments_441727.json:
```json
{
    "body": "<a id='comment:4'></a>please try this branch (not tested much, though)\n\n---\nNew commits:",
    "created_at": "2020-04-13T10:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441727",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>please try this branch (not tested much, though)

---
New commits:



---

archive/issue_comments_441728.json:
```json
{
    "body": "<a id='comment:5'></a>Configure is OK for iml and suitesparse:\n\n---\n\nChecking whether [SageMath](SageMath) should install SPKG iml...\n\nchecking whether any of gmp mpir openblas is installed or will be installed as SPKG... no\n\nchecking for iml.h... yes\n\nchecking for library containing nonsingSolvLlhsMM... -liml\n\nconfigure: will use system package and not install SPKG iml\n\n---\n\n...\n\n---\n\nChecking whether [SageMath](SageMath) should install SPKG suitesparse...\n\nchecking whether any of openblas is installed or will be installed as SPKG... no\n\nchecking suitesparse/SuiteSparse_config.h usability... yes\n\nchecking suitesparse/SuiteSparse_config.h presence... yes\n\nchecking for suitesparse/SuiteSparse_config.h... yes\n\nchecking for library containing cholmod_speye... -lcholmod\n\nconfigure: will use system package and not install SPKG suitesparse\n\n---\n\n...\n\niml-1.0.4p1.p2:                              using system package; SPKG will not be installed\n\n...\n\nsuitesparse-5.6.0:                           using system package; SPKG will not be installed\n\n\nBut now cvxopt fails:\n\n[cvxopt-1.2.3]     src/C/umfpack.c:23:10: fatal error: 'umfpack.h' file not found\n\n[cvxopt-1.2.3]     #include \"umfpack.h\"\n\nNote: on FreeBSD umfpack.h is located under /usr/local/include/suitesparse/umfpack.h. Just let me know if I fix it for FreeBSD or if the same failure could occur on other systems.",
    "created_at": "2020-04-13T12:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441728",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:5'></a>Configure is OK for iml and suitesparse:

---

Checking whether [SageMath](SageMath) should install SPKG iml...

checking whether any of gmp mpir openblas is installed or will be installed as SPKG... no

checking for iml.h... yes

checking for library containing nonsingSolvLlhsMM... -liml

configure: will use system package and not install SPKG iml

---

...

---

Checking whether [SageMath](SageMath) should install SPKG suitesparse...

checking whether any of openblas is installed or will be installed as SPKG... no

checking suitesparse/SuiteSparse_config.h usability... yes

checking suitesparse/SuiteSparse_config.h presence... yes

checking for suitesparse/SuiteSparse_config.h... yes

checking for library containing cholmod_speye... -lcholmod

configure: will use system package and not install SPKG suitesparse

---

...

iml-1.0.4p1.p2:                              using system package; SPKG will not be installed

...

suitesparse-5.6.0:                           using system package; SPKG will not be installed


But now cvxopt fails:

[cvxopt-1.2.3]     src/C/umfpack.c:23:10: fatal error: 'umfpack.h' file not found

[cvxopt-1.2.3]     #include "umfpack.h"

Note: on FreeBSD umfpack.h is located under /usr/local/include/suitesparse/umfpack.h. Just let me know if I fix it for FreeBSD or if the same failure could occur on other systems.



---

archive/issue_comments_441729.json:
```json
{
    "body": "<a id='comment:6'></a>On Debian the location of the header is also prefixed.\nProbably this is a cvxopt bug.\nOne might try to find out how Debian works around this.",
    "created_at": "2020-04-13T12:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441729",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>On Debian the location of the header is also prefixed.
Probably this is a cvxopt bug.
One might try to find out how Debian works around this.



---

archive/issue_comments_441730.json:
```json
{
    "body": "<a id='comment:7'></a>On Debian, the following hack makes things work:\n\n```diff\n--- a/build/pkgs/cvxopt/spkg-install.in\n+++ b/build/pkgs/cvxopt/spkg-install.in\n@@ -21,8 +21,8 @@ export CVXOPT_BLAS_LIB=\"$(pkg_libs blas)\"\n export CVXOPT_BLAS_LIB_DIR=\"$(pkg-config --variable=libdir blas)\"\n export CVXOPT_LAPACK_LIB=\"$(pkg_libs lapack)\"\n \n-export CVXOPT_SUITESPARSE_LIB_DIR=\"${SAGE_LOCAL}\"\n-export CVXOPT_SUITESPARSE_INC_DIR=\"${SAGE_LOCAL}/include\"\n+# export CVXOPT_SUITESPARSE_LIB_DIR=\"${SAGE_LOCAL}\"\n+# export CVXOPT_SUITESPARSE_INC_DIR=\"${SAGE_LOCAL}/include\"\n \n export CVXOPT_BUILD_GLPK=1\n export CVXOPT_GLPK_LIB_DIR=\"${SAGE_LOCAL}\"\n```\nI'll do a proper fix later, but this should get one",
    "created_at": "2020-04-13T15:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441730",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>On Debian, the following hack makes things work:

```diff
--- a/build/pkgs/cvxopt/spkg-install.in
+++ b/build/pkgs/cvxopt/spkg-install.in
@@ -21,8 +21,8 @@ export CVXOPT_BLAS_LIB="$(pkg_libs blas)"
 export CVXOPT_BLAS_LIB_DIR="$(pkg-config --variable=libdir blas)"
 export CVXOPT_LAPACK_LIB="$(pkg_libs lapack)"
 
-export CVXOPT_SUITESPARSE_LIB_DIR="${SAGE_LOCAL}"
-export CVXOPT_SUITESPARSE_INC_DIR="${SAGE_LOCAL}/include"
+# export CVXOPT_SUITESPARSE_LIB_DIR="${SAGE_LOCAL}"
+# export CVXOPT_SUITESPARSE_INC_DIR="${SAGE_LOCAL}/include"
 
 export CVXOPT_BUILD_GLPK=1
 export CVXOPT_GLPK_LIB_DIR="${SAGE_LOCAL}"
```
I'll do a proper fix later, but this should get one



---

archive/issue_comments_441731.json:
```json
{
    "body": "<a id='comment:8'></a>A naive work-around (just adding -I /usr/local/include/suitesparse) was sufficient to build everything.\n\nI'm going to test your patch to check if it works for me.\n\nNote about u/dimpase/packages/suitesparseconf: actually cvxopt produces 3 python libraries, site-packages/cvxopt/amd.so, site-packages/cvxopt/cholmod.so and site-packages/cvxopt/umfpack.so, and they are linked to libamd.so.2, libsuitesparseconfig.so.5 and libumfpack.so.5 from suitesparse; maybe you would check if they are available in its spkg-configure.m4?",
    "created_at": "2020-04-13T15:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441731",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:8'></a>A naive work-around (just adding -I /usr/local/include/suitesparse) was sufficient to build everything.

I'm going to test your patch to check if it works for me.

Note about u/dimpase/packages/suitesparseconf: actually cvxopt produces 3 python libraries, site-packages/cvxopt/amd.so, site-packages/cvxopt/cholmod.so and site-packages/cvxopt/umfpack.so, and they are linked to libamd.so.2, libsuitesparseconfig.so.5 and libumfpack.so.5 from suitesparse; maybe you would check if they are available in its spkg-configure.m4?



---

archive/issue_comments_441732.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 gh-thierry-FreeBSD]:\n\n> Note about u/dimpase/packages/suitesparseconf: actually cvxopt produces 3 python libraries, site-packages/cvxopt/amd.so, site-packages/cvxopt/cholmod.so and site-packages/cvxopt/umfpack.so, and they are linked to libamd.so.2, libsuitesparseconfig.so.5 and libumfpack.so.5 from suitesparse; maybe you would check if they are available in its spkg-configure.m4?\n\n\nAMD, COLAMD, CCOLAMD are dependencies of CHOLMOD in  SuiteSparse, so it apparently suffices to add a check for UMFPACK (and suitesparseconfig - which presumably is always there, but OK).",
    "created_at": "2020-04-13T17:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441732",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Replying to [comment:8 gh-thierry-FreeBSD]:

> Note about u/dimpase/packages/suitesparseconf: actually cvxopt produces 3 python libraries, site-packages/cvxopt/amd.so, site-packages/cvxopt/cholmod.so and site-packages/cvxopt/umfpack.so, and they are linked to libamd.so.2, libsuitesparseconfig.so.5 and libumfpack.so.5 from suitesparse; maybe you would check if they are available in its spkg-configure.m4?


AMD, COLAMD, CCOLAMD are dependencies of CHOLMOD in  SuiteSparse, so it apparently suffices to add a check for UMFPACK (and suitesparseconfig - which presumably is always there, but OK).



---

archive/issue_comments_441733.json:
```json
{
    "body": "<a id='comment:10'></a>Same error on FreeBSD with the Debian's patch of build/pkgs/cvxopt/spkg-install.in : umfpack.h is not found.\n\nI would set something like:\n\nexport CVXOPT_SUITESPARSE_INC_DIR=\"${LOCALBASE}/suitesparse/include\"\n\nbut $LOCALBASE is not set!\n\nWould it be possible to modify build/pkgs/suitesparse/spkg-configure.m4 so that it sets a variable of the include path where SuiteSparse_config.h has been found?",
    "created_at": "2020-04-13T17:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441733",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:10'></a>Same error on FreeBSD with the Debian's patch of build/pkgs/cvxopt/spkg-install.in : umfpack.h is not found.

I would set something like:

export CVXOPT_SUITESPARSE_INC_DIR="${LOCALBASE}/suitesparse/include"

but $LOCALBASE is not set!

Would it be possible to modify build/pkgs/suitesparse/spkg-configure.m4 so that it sets a variable of the include path where SuiteSparse_config.h has been found?



---

archive/issue_comments_441734.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 gh-thierry-FreeBSD]:\n> Same error on FreeBSD with the Debian's patch of build/pkgs/cvxopt/spkg-install.in : umfpack.h is not found.\n> \n> I would set something like:\n> \n> export CVXOPT_SUITESPARSE_INC_DIR=\"${LOCALBASE}/suitesparse/include\"\n> \n> but $LOCALBASE is not set!\n> \n> Would it be possible to modify build/pkgs/suitesparse/spkg-configure.m4 so that it sets a variable of the include path where SuiteSparse_config.h has been found?\n\n\ngetting a full include path is always a pain, and should not be needed as long as it is in the default compiler path for headers. Doesn't FreeBSD's clang look in `/usr/local/include/` by default (which is always the case on every Linux  I know, and on MacOS) ? Apparently it does not (which is insane, IMHO) - otherwise I don't understand this error on FreeBSD.",
    "created_at": "2020-04-14T02:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441734",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Replying to [comment:10 gh-thierry-FreeBSD]:
> Same error on FreeBSD with the Debian's patch of build/pkgs/cvxopt/spkg-install.in : umfpack.h is not found.
> 
> I would set something like:
> 
> export CVXOPT_SUITESPARSE_INC_DIR="${LOCALBASE}/suitesparse/include"
> 
> but $LOCALBASE is not set!
> 
> Would it be possible to modify build/pkgs/suitesparse/spkg-configure.m4 so that it sets a variable of the include path where SuiteSparse_config.h has been found?


getting a full include path is always a pain, and should not be needed as long as it is in the default compiler path for headers. Doesn't FreeBSD's clang look in `/usr/local/include/` by default (which is always the case on every Linux  I know, and on MacOS) ? Apparently it does not (which is insane, IMHO) - otherwise I don't understand this error on FreeBSD.



---

archive/issue_comments_441735.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-14T03:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_441736.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n+I guess that different distos use different subsets of SuiteSparse,\n+but this is needed to be done. Apparently all we need is CHOLMOD (with its dependencies),UMFRACK and suitesparseconfig.\n \n+We assume that the headers are prefixed with \\`suitesparse/\\`\n \n Comment: 1\n \n```\n",
    "created_at": "2020-04-14T03:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441736",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,7 @@
+I guess that different distos use different subsets of SuiteSparse,
+but this is needed to be done. Apparently all we need is CHOLMOD (with its dependencies),UMFRACK and suitesparseconfig.
 
+We assume that the headers are prefixed with \`suitesparse/\`
 
 Comment: 1
 
```




---

archive/issue_comments_441737.json:
```json
{
    "body": "<a id='comment:14'></a>So the FreeBSD question is whether adding `-I /usr/local/include/` to `CFLAGS` and comment:7 allow the thing to build.",
    "created_at": "2020-04-14T03:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441737",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>So the FreeBSD question is whether adding `-I /usr/local/include/` to `CFLAGS` and comment:7 allow the thing to build.



---

archive/issue_comments_441738.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-14T05:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441738",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_441739.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-14T05:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441739",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_441740.json:
```json
{
    "body": "<a id='comment:17'></a>Great! The missing part was SAGE_SUITESPARSE_PREFIX.",
    "created_at": "2020-04-14T07:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441740",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:17'></a>Great! The missing part was SAGE_SUITESPARSE_PREFIX.



---

archive/issue_comments_441741.json:
```json
{
    "body": "<a id='comment:18'></a>tests being run here: https://github.com/dimpase/sage/actions?query=workflow%3A%22Run+SAGE_ROOT%2Ftox.ini%22\n\nlooks good (modulo unrelated things, e.g. problems with brial on Fedora, etc)",
    "created_at": "2020-04-14T15:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441741",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>tests being run here: https://github.com/dimpase/sage/actions?query=workflow%3A%22Run+SAGE_ROOT%2Ftox.ini%22

looks good (modulo unrelated things, e.g. problems with brial on Fedora, etc)



---

archive/issue_comments_441742.json:
```json
{
    "body": "<a id='comment:19'></a>perhaps this can make it into 9.1?",
    "created_at": "2020-04-19T04:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441742",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>perhaps this can make it into 9.1?



---

archive/issue_events_075237.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-19T04:51:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29502#event-75237"
}
```



---

archive/issue_comments_441743.json:
```json
{
    "body": "<a id='comment:20'></a>Needs rebasing on top of #29492 or something like that",
    "created_at": "2020-04-19T06:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441743",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Needs rebasing on top of #29492 or something like that



---

archive/issue_comments_441744.json:
```json
{
    "body": "<a id='comment:21'></a>I can't seem to get the branch of #29492  for some reason.",
    "created_at": "2020-04-19T06:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441744",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>I can't seem to get the branch of #29492  for some reason.



---

archive/issue_comments_441745.json:
```json
{
    "body": "<a id='comment:22'></a>On Gentoo, I think users only need to install\n\n* sci-libs/cholmod\n* sci-libs/suitesparseconfig\n* sci-libs/umfpack\n\nwhich is a bit less than the whole suitesparse. But currently it doesn't work anyway because the check is looking for the header in the wrong place. Unless they moved it in v5.6.0, upstream SuiteSparse_config installs the header *without* the `suitesparse/` prefix.\n\nCVXOPT however checks both `/usr/include` and `/usr/include/suitesparse`, and nobody else looks for that header, so I think it would be fine to just add the un-prefixed path as an option to that header check.",
    "created_at": "2020-04-19T19:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441745",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:22'></a>On Gentoo, I think users only need to install

* sci-libs/cholmod
* sci-libs/suitesparseconfig
* sci-libs/umfpack

which is a bit less than the whole suitesparse. But currently it doesn't work anyway because the check is looking for the header in the wrong place. Unless they moved it in v5.6.0, upstream SuiteSparse_config installs the header *without* the `suitesparse/` prefix.

CVXOPT however checks both `/usr/include` and `/usr/include/suitesparse`, and nobody else looks for that header, so I think it would be fine to just add the un-prefixed path as an option to that header check.



---

archive/issue_comments_441746.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-19T19:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441746",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_441747.json:
```json
{
    "body": "<a id='comment:23'></a>Looking at CVXOPT's setup.py,\n\nhttps://github.com/cvxopt/cvxopt/blob/master/setup.py\n\nI also see \"amd\" (sci-libs/amd) and \"colamd\" (sci-libs/colamd) make an appearance. I don't pretend to understand what's going on in there, but it's worth a look to see if we need to check for those libraries too.",
    "created_at": "2020-04-19T21:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441747",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:23'></a>Looking at CVXOPT's setup.py,

https://github.com/cvxopt/cvxopt/blob/master/setup.py

I also see "amd" (sci-libs/amd) and "colamd" (sci-libs/colamd) make an appearance. I don't pretend to understand what's going on in there, but it's worth a look to see if we need to check for those libraries too.



---

archive/issue_comments_441748.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 mjo]:\n> Looking at CVXOPT's setup.py,\n> \n> https://github.com/cvxopt/cvxopt/blob/master/setup.py\n> \n> I also see \"amd\" (sci-libs/amd) and \"colamd\" (sci-libs/colamd) make an appearance. I don't pretend to understand what's going on in there, but it's worth a look to see if we need to check for those libraries too.\n> \n\n\nThose two and even suitesparseconfig should be pulled in as dependency of cholmod. However, if we need dev packages for those as well then we need to check for them.",
    "created_at": "2020-04-19T21:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441748",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>Replying to [comment:23 mjo]:
> Looking at CVXOPT's setup.py,
> 
> https://github.com/cvxopt/cvxopt/blob/master/setup.py
> 
> I also see "amd" (sci-libs/amd) and "colamd" (sci-libs/colamd) make an appearance. I don't pretend to understand what's going on in there, but it's worth a look to see if we need to check for those libraries too.
> 


Those two and even suitesparseconfig should be pulled in as dependency of cholmod. However, if we need dev packages for those as well then we need to check for them.



---

archive/issue_comments_441749.json:
```json
{
    "body": "<a id='comment:25'></a>Yup, I can at least see `amd.h` in cvxopt sources. So we need to check dev packages for those. Haven't seen colamd, but that cannot hurt.",
    "created_at": "2020-04-19T21:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441749",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>Yup, I can at least see `amd.h` in cvxopt sources. So we need to check dev packages for those. Haven't seen colamd, but that cannot hurt.



---

archive/issue_comments_441750.json:
```json
{
    "body": "<a id='comment:26'></a>amd is a dependency of cholmod.\n\nas to the headers location, unprefixed 3-letter filenames for headers as upstream does are silly. Is Gentoo the only distro that does not prefix it?",
    "created_at": "2020-04-19T23:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441750",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>amd is a dependency of cholmod.

as to the headers location, unprefixed 3-letter filenames for headers as upstream does are silly. Is Gentoo the only distro that does not prefix it?



---

archive/issue_comments_441751.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-23T13:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441751",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_441752.json:
```json
{
    "body": "<a id='comment:28'></a>rebased over 9.1.rc1 - needs review",
    "created_at": "2020-04-23T13:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441752",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>rebased over 9.1.rc1 - needs review



---

archive/issue_comments_441753.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-23T13:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441753",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_441754.json:
```json
{
    "body": "<a id='comment:29'></a>Sorry, I've been missing trac notifications again.\n\nIf `amd.h` is used by cvxopt, we should check for it, because users will probably need to install a `-dev` package on the binary distros to get it. If we don't check here, the ./configure script might think everything's OK with only e.g. `amd` installed and not `amd-dev` until the cvxopt build system crashes much later on.\n\nI agree that not prefixing the headers upstream shows a lack of foresight, but renaming other people's headers as a workaround is a dick move. Gentoo can't prefix them for the same reason no one else should prefix them: other software needs to know where to find them. If we move the headers, every consumer of the library fails to build. Renaming the headers completely changes a package's public API. It's on the same level as changing all of a library's function names to swahili to avoid symbol collisions and then packaging it up with the same name. It can work on a binary distro, but only if you're OK with supporting only pre-built binary software forever. When *every* binary distro does it, you wind up with `n*m` different cases in the `n` packages looking for the `m` places that someone decided to put them.\n\nSlackware, nix, conda, and homebrew are also likely to have them unprefixed for that reason. Not to mention people who just go the website, download the tarball, and install to `/usr/local`.",
    "created_at": "2020-04-25T22:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441754",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:29'></a>Sorry, I've been missing trac notifications again.

If `amd.h` is used by cvxopt, we should check for it, because users will probably need to install a `-dev` package on the binary distros to get it. If we don't check here, the ./configure script might think everything's OK with only e.g. `amd` installed and not `amd-dev` until the cvxopt build system crashes much later on.

I agree that not prefixing the headers upstream shows a lack of foresight, but renaming other people's headers as a workaround is a dick move. Gentoo can't prefix them for the same reason no one else should prefix them: other software needs to know where to find them. If we move the headers, every consumer of the library fails to build. Renaming the headers completely changes a package's public API. It's on the same level as changing all of a library's function names to swahili to avoid symbol collisions and then packaging it up with the same name. It can work on a binary distro, but only if you're OK with supporting only pre-built binary software forever. When *every* binary distro does it, you wind up with `n*m` different cases in the `n` packages looking for the `m` places that someone decided to put them.

Slackware, nix, conda, and homebrew are also likely to have them unprefixed for that reason. Not to mention people who just go the website, download the tarball, and install to `/usr/local`.



---

archive/issue_comments_441755.json:
```json
{
    "body": "<a id='comment:30'></a>Am I correst that cvxopt is able to work with suitesparse headers anywhere, so it's just a matter of checking for headers at another location too, right?",
    "created_at": "2020-04-26T00:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441755",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>Am I correst that cvxopt is able to work with suitesparse headers anywhere, so it's just a matter of checking for headers at another location too, right?



---

archive/issue_comments_441756.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 dimpase]:\n> Am I correst that cvxopt is able to work with suitesparse headers anywhere, so it's just a matter of checking for headers at another location too, right?\n\n\nRight. As `n=1` here, you can see the `1*m` cases attempted in the setup.py I linked earlier.",
    "created_at": "2020-04-26T00:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441756",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:31'></a>Replying to [comment:30 dimpase]:
> Am I correst that cvxopt is able to work with suitesparse headers anywhere, so it's just a matter of checking for headers at another location too, right?


Right. As `n=1` here, you can see the `1*m` cases attempted in the setup.py I linked earlier.



---

archive/issue_comments_441757.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-26T09:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441757",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_441758.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-26T09:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_441759.json:
```json
{
    "body": "<a id='comment:34'></a>test run here: https://github.com/dimpase/sage/actions/runs/88161668\n\n---\nNew commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[b8c8308](https://git.sagemath.org/sage.git/commit?id=b8c83088cff21aec5c26866435f18bf10d1300f4)|`check for amd.h too`|\n---\nNew commits:",
    "created_at": "2020-04-26T10:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441759",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>test run here: https://github.com/dimpase/sage/actions/runs/88161668

---
New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[b8c8308](https://git.sagemath.org/sage.git/commit?id=b8c83088cff21aec5c26866435f18bf10d1300f4)|`check for amd.h too`|
---
New commits:



---

archive/issue_comments_441760.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n+Different distos use different subsets of SuiteSparse,\n+but this is needed to be done. Apparently all we need is CHOLMOD (with its dependencies),UMFRACK and suitesparseconfig.\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-04-26T10:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441760",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,6 @@
+Different distos use different subsets of SuiteSparse,
+but this is needed to be done. Apparently all we need is CHOLMOD (with its dependencies),UMFRACK and suitesparseconfig.
+
 
 
 Comment: 1
```




---

archive/issue_comments_441761.json:
```json
{
    "body": "<a id='comment:36'></a>My system copy is detected now, thanks. In gentoo.txt, I think we should have only\n\n```\nsci-libs/amd sci-libs/cholmod sci-libs/suitesparseconfig sci-libs/umfpack\n```\n\nThe `sci-libs/suitesparse` in there right now is a metapackage that pulls in everything. I'm still not sure about \"colamd\", but we're safe in any case so long as it remains a dependency of cholmod.",
    "created_at": "2020-04-26T19:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441761",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:36'></a>My system copy is detected now, thanks. In gentoo.txt, I think we should have only

```
sci-libs/amd sci-libs/cholmod sci-libs/suitesparseconfig sci-libs/umfpack
```

The `sci-libs/suitesparse` in there right now is a metapackage that pulls in everything. I'm still not sure about "colamd", but we're safe in any case so long as it remains a dependency of cholmod.



---

archive/issue_comments_441762.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-27T04:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_441763.json:
```json
{
    "body": "<a id='comment:38'></a>I was going to test this with the suitesparse-5.4.0 in gentoo (to see if we need version bounds), but I can't figure out which part of sage (if any) actually uses suitesparse. It's listed as a standard package, so it should be used *somewhere*. Does anyone have any ideas?",
    "created_at": "2020-04-28T18:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441763",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:38'></a>I was going to test this with the suitesparse-5.4.0 in gentoo (to see if we need version bounds), but I can't figure out which part of sage (if any) actually uses suitesparse. It's listed as a standard package, so it should be used *somewhere*. Does anyone have any ideas?



---

archive/issue_comments_441764.json:
```json
{
    "body": "<a id='comment:39'></a>It is exclusively a dependency of cvxopt. Nothing else uses it - although we could unbundle some bit of glpk to use it. That's about it.",
    "created_at": "2020-04-28T19:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441764",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>It is exclusively a dependency of cvxopt. Nothing else uses it - although we could unbundle some bit of glpk to use it. That's about it.



---

archive/issue_comments_441765.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-28T21:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441765",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_441766.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:39 fbissey]:\n> It is exclusively a dependency of cvxopt. Nothing else uses it - although we could unbundle some bit of glpk to use it. That's about it.\n\n\nOh, I could have sworn that cvxopt was an optional package. That makes sense, then.\n\nThis test,\n\n```\nAC_CHECK_HEADERS([SuiteSparse_config.h amd.h],\n                 [suispa_header_found=yes])\n```\n\nis intended to set `suispa_header_found` to \"yes\" if both headers are found, but the docs for `AC_CHECK_HEADERS` say \"If action-if-found is given, it is additional shell code to execute when one of the header files is found.\"",
    "created_at": "2020-04-28T21:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441766",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:40'></a>Replying to [comment:39 fbissey]:
> It is exclusively a dependency of cvxopt. Nothing else uses it - although we could unbundle some bit of glpk to use it. That's about it.


Oh, I could have sworn that cvxopt was an optional package. That makes sense, then.

This test,

```
AC_CHECK_HEADERS([SuiteSparse_config.h amd.h],
                 [suispa_header_found=yes])
```

is intended to set `suispa_header_found` to "yes" if both headers are found, but the docs for `AC_CHECK_HEADERS` say "If action-if-found is given, it is additional shell code to execute when one of the header files is found."



---

archive/issue_comments_441767.json:
```json
{
    "body": "<a id='comment:41'></a>Works for me on OS X, for what it's worth.",
    "created_at": "2020-04-28T21:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441767",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'></a>Works for me on OS X, for what it's worth.



---

archive/issue_comments_441768.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:40 mjo]:\n> Replying to [comment:39 fbissey]:\n> > It is exclusively a dependency of cvxopt. Nothing else uses it - although we could unbundle some bit of glpk to use it. That's about it.\n\n> \n> Oh, I could have sworn that cvxopt was an optional package. That makes sense, then.\n> \n> This test,\n> \n> \n> ```\n> AC_CHECK_HEADERS([SuiteSparse_config.h amd.h],\n>                  [suispa_header_found=yes])\n> ```\n> \n> is intended to set `suispa_header_found` to \"yes\" if both headers are found, but the docs for `AC_CHECK_HEADERS` say \"If action-if-found is given, it is additional shell code to execute when one of the header files is found.\"\n\n\nYes, you don't want to do that. That code would be executed if either of the headers were to be found, so the variable would be defined even if one is missing. You would be better to check for `ac_cv_header_suitesparse_config_h` and `ac_cv_header_amd_h` (are those name correct?) in a shell test after the call to `AC_CHECK_HEADERS`.",
    "created_at": "2020-04-28T21:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441768",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>Replying to [comment:40 mjo]:
> Replying to [comment:39 fbissey]:
> > It is exclusively a dependency of cvxopt. Nothing else uses it - although we could unbundle some bit of glpk to use it. That's about it.

> 
> Oh, I could have sworn that cvxopt was an optional package. That makes sense, then.
> 
> This test,
> 
> 
> ```
> AC_CHECK_HEADERS([SuiteSparse_config.h amd.h],
>                  [suispa_header_found=yes])
> ```
> 
> is intended to set `suispa_header_found` to "yes" if both headers are found, but the docs for `AC_CHECK_HEADERS` say "If action-if-found is given, it is additional shell code to execute when one of the header files is found."


Yes, you don't want to do that. That code would be executed if either of the headers were to be found, so the variable would be defined even if one is missing. You would be better to check for `ac_cv_header_suitesparse_config_h` and `ac_cv_header_amd_h` (are those name correct?) in a shell test after the call to `AC_CHECK_HEADERS`.



---

archive/issue_comments_441769.json:
```json
{
    "body": "<a id='comment:43'></a>Another option is to set the \"headers found\" variable to \"yes\" by default, and then use the *action-if-not-found* branch of `AC_CHECK_HEADERS` to set it to \"no\" if some header is not found. You'd have to reset the variable between the prefixed and unprefixed checks, but it looks like it would work anyway.",
    "created_at": "2020-04-28T22:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441769",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:43'></a>Another option is to set the "headers found" variable to "yes" by default, and then use the *action-if-not-found* branch of `AC_CHECK_HEADERS` to set it to "no" if some header is not found. You'd have to reset the variable between the prefixed and unprefixed checks, but it looks like it would work anyway.



---

archive/issue_comments_441770.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:43 mjo]:\n> Another option is to set the \"headers found\" variable to \"yes\" by default, and then use the *action-if-not-found* branch of `AC_CHECK_HEADERS` to set it to \"no\" if some header is not found. You'd have to reset the variable between the prefixed and unprefixed checks, but it looks like it would work anyway.\n\n\nSounds valid.",
    "created_at": "2020-04-28T22:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441770",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>Replying to [comment:43 mjo]:
> Another option is to set the "headers found" variable to "yes" by default, and then use the *action-if-not-found* branch of `AC_CHECK_HEADERS` to set it to "no" if some header is not found. You'd have to reset the variable between the prefixed and unprefixed checks, but it looks like it would work anyway.


Sounds valid.



---

archive/issue_comments_441771.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-29T13:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_441772.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-29T13:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441772",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_441773.json:
```json
{
    "body": "<a id='comment:46'></a>this appears to fix the use of AC_CHECK_HEADERS - thanks for catching this.",
    "created_at": "2020-04-29T13:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441773",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:46'></a>this appears to fix the use of AC_CHECK_HEADERS - thanks for catching this.



---

archive/issue_comments_441774.json:
```json
{
    "body": "<a id='comment:47'></a>Looks good now. One last nitpick; you should add quotes here for the people who have spaces in their sage path:\n\n```\nif test x$SAGE_SUITESPARSE_PREFIX != x; then\n   export CVXOPT_SUITESPARSE_LIB_DIR=\"${SAGE_LOCAL}\"\n   export CVXOPT_SUITESPARSE_INC_DIR=\"${SAGE_LOCAL}/include\"\nfi\n```\n\nAnd while the two are equivalent, I think using `SAGE_SUITESPARSE_PREFIX` instead of `SAGE_LOCAL`...\n\n```\nif test \"x$SAGE_SUITESPARSE_PREFIX\" != \"x\"; then\n   export CVXOPT_SUITESPARSE_LIB_DIR=\"${SAGE_SUITESPARSE_PREFIX}\"\n   export CVXOPT_SUITESPARSE_INC_DIR=\"${SAGE_SUITESPARSE_PREFIX}/include\"\nfi\n```\n\navoids some duplication and uses the `SAGE_SUITESPARSE_PREFIX` variable the way you intended it?",
    "created_at": "2020-04-29T13:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441774",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:47'></a>Looks good now. One last nitpick; you should add quotes here for the people who have spaces in their sage path:

```
if test x$SAGE_SUITESPARSE_PREFIX != x; then
   export CVXOPT_SUITESPARSE_LIB_DIR="${SAGE_LOCAL}"
   export CVXOPT_SUITESPARSE_INC_DIR="${SAGE_LOCAL}/include"
fi
```

And while the two are equivalent, I think using `SAGE_SUITESPARSE_PREFIX` instead of `SAGE_LOCAL`...

```
if test "x$SAGE_SUITESPARSE_PREFIX" != "x"; then
   export CVXOPT_SUITESPARSE_LIB_DIR="${SAGE_SUITESPARSE_PREFIX}"
   export CVXOPT_SUITESPARSE_INC_DIR="${SAGE_SUITESPARSE_PREFIX}/include"
fi
```

avoids some duplication and uses the `SAGE_SUITESPARSE_PREFIX` variable the way you intended it?



---

archive/issue_comments_441775.json:
```json
{
    "body": "<a id='comment:48'></a>I am not trying to compute and pass the prefix of the installation of suitesparse.\nSo it is probably a misnaming.",
    "created_at": "2020-04-29T16:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441775",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>I am not trying to compute and pass the prefix of the installation of suitesparse.
So it is probably a misnaming.



---

archive/issue_comments_441776.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-29T18:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_441777.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:48 dimpase]:\n> I am not trying to compute and pass the prefix of the installation of suitesparse.\n> So it is probably a misnaming.\n\n\nIs it just supposed to be a boolean? I guess what I'm asking is, why define `SAGE_SUITESPARSE_LOCALINSTALL` to either `$SAGE_LOCAL` or the empty string if it's only used as a flag?",
    "created_at": "2020-04-29T18:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441777",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:50'></a>Replying to [comment:48 dimpase]:
> I am not trying to compute and pass the prefix of the installation of suitesparse.
> So it is probably a misnaming.


Is it just supposed to be a boolean? I guess what I'm asking is, why define `SAGE_SUITESPARSE_LOCALINSTALL` to either `$SAGE_LOCAL` or the empty string if it's only used as a flag?



---

archive/issue_comments_441778.json:
```json
{
    "body": "<a id='comment:51'></a>yes, it is a boolean",
    "created_at": "2020-04-29T20:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441778",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'></a>yes, it is a boolean



---

archive/issue_comments_441779.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:51 dimpase]:\n> yes, it is a boolean\n\n\nIt think it would make more sense to set it to \"yes\" rather than \"$SAGE_LOCAL\" in that case?\n\nEither way, it works fine on Gentoo with suitesparse-5.4.0. Should we merge it and cross our fingers, or run it though github first to make sure all of the other distros have usable versions of suitesparse?",
    "created_at": "2020-04-30T00:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441779",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:52'></a>Replying to [comment:51 dimpase]:
> yes, it is a boolean


It think it would make more sense to set it to "yes" rather than "$SAGE_LOCAL" in that case?

Either way, it works fine on Gentoo with suitesparse-5.4.0. Should we merge it and cross our fingers, or run it though github first to make sure all of the other distros have usable versions of suitesparse?



---

archive/issue_comments_441780.json:
```json
{
    "body": "<a id='comment:53'></a>I would suggest to defer this to 9.2",
    "created_at": "2020-04-30T02:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441780",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>I would suggest to defer this to 9.2



---

archive/issue_comments_441781.json:
```json
{
    "body": "<a id='comment:54'></a>Replying to [comment:52 mjo]:\n> run it though github first to make sure all of the other distros have usable versions of suitesparse?\n\n\nYes please",
    "created_at": "2020-04-30T02:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441781",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>Replying to [comment:52 mjo]:
> run it though github first to make sure all of the other distros have usable versions of suitesparse?


Yes please



---

archive/issue_comments_441782.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:54 mkoeppe]:\n> Replying to [comment:52 mjo]:\n> > run it though github first to make sure all of the other distros have usable versions of suitesparse?\n\n> \n> Yes please\n\nI did this https://github.com/dimpase/sage/actions/runs/88161666\nbefore commits starting at comment:45 and have not found any problems.\n(apart from the trivial absense of useful system openblas implying no suitesparse,\neither)",
    "created_at": "2020-04-30T07:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441782",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:55'></a>Replying to [comment:54 mkoeppe]:
> Replying to [comment:52 mjo]:
> > run it though github first to make sure all of the other distros have usable versions of suitesparse?

> 
> Yes please

I did this https://github.com/dimpase/sage/actions/runs/88161666
before commits starting at comment:45 and have not found any problems.
(apart from the trivial absense of useful system openblas implying no suitesparse,
either)



---

archive/issue_events_075238.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-04T20:06:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29502#event-75238"
}
```



---

archive/issue_events_075239.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-04T20:06:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29502#event-75239"
}
```



---

archive/issue_comments_441783.json:
```json
{
    "body": "<a id='comment:57'></a>The spkg-install for cvxopt is doing some weird stuff, but I can't find any immediate problems (and don't think we need to fix them here, in any case). For example,\n\n```\nexport CVXOPT_GLPK_LIB_DIR=\"${SAGE_LOCAL}\"\nexport CVXOPT_GLPK_INC_DIR=\"${SAGE_LOCAL}/include\"\n```\n\nis unconditionally adding those two library/include paths to the command line as `-L` and `-I` flags, even when we're using system packages. This doesn't cause an immediate problem because `--with-system-foo=yes` and `--with-system-foo=force` get ignored if the foo SPKG is installed, and that's the only way the extra dirs on the command-line could cause a problem. So for example if I install the suitesparse SPKG manually and attempt to use the system suitesparse, there's no risk of the SPKG being accidentally linked into cvxopt via the lines above, because there's no way to avoid using the SPKG in favor of the system copy in the first place.\n\nThese calls to pkg-config share the same risk,\n\n```\nexport CVXOPT_GSL_LIB_DIR=\"$(pkg-config --variable=libdir gsl)\"\nexport CVXOPT_GSL_INC_DIR=\"$(pkg-config --variable=includedir gsl)\"\n```\n\nbut so long as any SPKG that is installed and provides a *.pc file *must* be used (ignoring `--with-system` flags), they won't hurt.",
    "created_at": "2020-05-19T13:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441783",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:57'></a>The spkg-install for cvxopt is doing some weird stuff, but I can't find any immediate problems (and don't think we need to fix them here, in any case). For example,

```
export CVXOPT_GLPK_LIB_DIR="${SAGE_LOCAL}"
export CVXOPT_GLPK_INC_DIR="${SAGE_LOCAL}/include"
```

is unconditionally adding those two library/include paths to the command line as `-L` and `-I` flags, even when we're using system packages. This doesn't cause an immediate problem because `--with-system-foo=yes` and `--with-system-foo=force` get ignored if the foo SPKG is installed, and that's the only way the extra dirs on the command-line could cause a problem. So for example if I install the suitesparse SPKG manually and attempt to use the system suitesparse, there's no risk of the SPKG being accidentally linked into cvxopt via the lines above, because there's no way to avoid using the SPKG in favor of the system copy in the first place.

These calls to pkg-config share the same risk,

```
export CVXOPT_GSL_LIB_DIR="$(pkg-config --variable=libdir gsl)"
export CVXOPT_GSL_INC_DIR="$(pkg-config --variable=includedir gsl)"
```

but so long as any SPKG that is installed and provides a *.pc file *must* be used (ignoring `--with-system` flags), they won't hurt.



---

archive/issue_comments_441784.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-19T13:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441784",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_441785.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-26T21:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441785",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_075240.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-26T21:44:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29502#event-75240"
}
```



---

archive/issue_comments_441786.json:
```json
{
    "body": "<a id='comment:59'></a>Follow-up: #30052 ubuntu-eoan-i386: cvxopt build fails",
    "created_at": "2020-07-03T04:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29502#issuecomment-441786",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>Follow-up: #30052 ubuntu-eoan-i386: cvxopt build fails
