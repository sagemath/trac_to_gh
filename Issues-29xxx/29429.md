# Issue 29429: Upgrade numpy to 1.16.6 (last release supporting py2)  to fix numpy build error on local-conda-forge-macos-standard

archive/issues_029192.json:
```json
{
    "body": "numpy build fails on macOS with conda-forge (https://github.com/mkoeppe/sage/runs/542501526)\n\n```\nTraceback (most recent call last):\n  File \"numpy/core/setup_common.py\", line 241, in check_long_double_representation\n    ltype = long_double_representation(pyod(obj))\n  File \"numpy/core/setup_common.py\", line 401, in long_double_representation\n    raise ValueError(\"Could not lock sequences (%s)\" % saw)\nValueError: Could not lock sequences (None)\n```\n\nThis comes from the depth of NumPy's code that tries to determine ABI by inspecting some compiled code (https://github.com/numpy/numpy/blob/master/numpy/core/setup_common.py).\n\nAn upgrade to 1.16.6 fixes the build error and works well on other platforms.\n\nThis can be tested with #29415:\n\n```\n  tox -e local-conda-forge-macos-standard\n```\n\nFollow-up: #29425 - newer version, py3 only\n\n\nCC:  @isuruf @dimpase @kiwifb @embray\n\nBranch/Commit: [b0c7df6570aad9e485a7de0bd0ea5782fdf054e9](https://github.com/sagemath/sagetrac-mirror/commit/b0c7df6570aad9e485a7de0bd0ea5782fdf054e9)\n\nReviewer: Isuru Fernando\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29429\n\n",
    "closed_at": "2020-04-12T15:34:32Z",
    "created_at": "2020-03-30T12:42:01Z",
    "labels": [
        "component: packages: standard",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Upgrade numpy to 1.16.6 (last release supporting py2)  to fix numpy build error on local-conda-forge-macos-standard",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29429",
    "user": "https://github.com/mkoeppe"
}
```
numpy build fails on macOS with conda-forge (https://github.com/mkoeppe/sage/runs/542501526)

```
Traceback (most recent call last):
  File "numpy/core/setup_common.py", line 241, in check_long_double_representation
    ltype = long_double_representation(pyod(obj))
  File "numpy/core/setup_common.py", line 401, in long_double_representation
    raise ValueError("Could not lock sequences (%s)" % saw)
ValueError: Could not lock sequences (None)
```

This comes from the depth of NumPy's code that tries to determine ABI by inspecting some compiled code (https://github.com/numpy/numpy/blob/master/numpy/core/setup_common.py).

An upgrade to 1.16.6 fixes the build error and works well on other platforms.

This can be tested with #29415:

```
  tox -e local-conda-forge-macos-standard
```

Follow-up: #29425 - newer version, py3 only


CC:  @isuruf @dimpase @kiwifb @embray

Branch/Commit: [b0c7df6570aad9e485a7de0bd0ea5782fdf054e9](https://github.com/sagemath/sagetrac-mirror/commit/b0c7df6570aad9e485a7de0bd0ea5782fdf054e9)

Reviewer: Isuru Fernando

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29429





---

archive/issue_comments_575805.json:
```json
{
    "body": "Branch: [u/mkoeppe/upgrade_numpy_to_0_16_6__last_release_supporting_py2_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_numpy_to_0_16_6__last_release_supporting_py2_)",
    "created_at": "2020-03-30T19:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575805",
    "user": "https://github.com/mkoeppe"
}
```

Branch: [u/mkoeppe/upgrade_numpy_to_0_16_6__last_release_supporting_py2_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_numpy_to_0_16_6__last_release_supporting_py2_)



---

archive/issue_comments_575806.json:
```json
{
    "body": "Commit: [b0c7df6570aad9e485a7de0bd0ea5782fdf054e9](https://github.com/sagemath/sagetrac-mirror/commit/b0c7df6570aad9e485a7de0bd0ea5782fdf054e9)",
    "created_at": "2020-03-30T22:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575806",
    "user": "https://github.com/DaveWitteMorris"
}
```

Commit: [b0c7df6570aad9e485a7de0bd0ea5782fdf054e9](https://github.com/sagemath/sagetrac-mirror/commit/b0c7df6570aad9e485a7de0bd0ea5782fdf054e9)



---

archive/issue_comments_575807.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n|[b0c7df6](https://github.com/sagemath/sagetrac-mirror/commit/b0c7df6570aad9e485a7de0bd0ea5782fdf054e9)|`Update numpy to 1.16.6`|",
    "created_at": "2020-03-30T22:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575807",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
|[b0c7df6](https://github.com/sagemath/sagetrac-mirror/commit/b0c7df6570aad9e485a7de0bd0ea5782fdf054e9)|`Update numpy to 1.16.6`|



---

archive/issue_events_084664.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "rename": {
        "from": "Upgrade numpy to 0.16.6 (last release supporting py2)",
        "to": "Upgrade numpy to 1.16.6 (last release supporting py2)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29429#event-84664"
}
```



---

archive/issue_comments_575808.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks - off by one",
    "created_at": "2020-03-30T22:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575808",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Thanks - off by one



---

archive/issue_comments_575809.json:
```json
{
    "body": "<a id='comment:4'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/66814284, in particular to check whether this update fixes the problem reported on #29425",
    "created_at": "2020-03-30T22:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575809",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/66814284, in particular to check whether this update fixes the problem reported on #29425



---

archive/issue_events_084665.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "rename": {
        "from": "Upgrade numpy to 1.16.6 (last release supporting py2)",
        "to": "Upgrade numpy to 1.16.6 (last release supporting py2)  to fix numpy build error on local-conda-forge-macos-standard"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29429#event-84665"
}
```



---

archive/issue_comments_575810.json:
```json
{
    "body": "Author: Matthias Koeppe",
    "created_at": "2020-03-31T13:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575810",
    "user": "https://github.com/mkoeppe"
}
```

Author: Matthias Koeppe



---

archive/issue_comments_575811.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-31T13:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575811",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_575812.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,23 @@\n+numpy build fails on macOS with conda-forge (https://github.com/mkoeppe/sage/runs/542501526)\n \n+```\n+Traceback (most recent call last):\n+  File \"numpy/core/setup_common.py\", line 241, in check_long_double_representation\n+    ltype = long_double_representation(pyod(obj))\n+  File \"numpy/core/setup_common.py\", line 401, in long_double_representation\n+    raise ValueError(\"Could not lock sequences (%s)\" % saw)\n+ValueError: Could not lock sequences (None)\n+```\n+\n+This comes from the depth of NumPy's code that tries to determine ABI by inspecting some compiled code (https://github.com/numpy/numpy/blob/master/numpy/core/setup_common.py).\n+\n+An upgrade to 1.16.6 fixes the build error and works well on other platforms.\n+\n+This can be tested with #29415:\n+\n+```\n+  tox -e local-conda-forge-macos-standard\n+```\n+\n+Follow-up: #29425 - newer version, py3 only\n+\n``````\n",
    "created_at": "2020-03-31T13:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575812",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,23 @@
+numpy build fails on macOS with conda-forge (https://github.com/mkoeppe/sage/runs/542501526)
 
+```
+Traceback (most recent call last):
+  File "numpy/core/setup_common.py", line 241, in check_long_double_representation
+    ltype = long_double_representation(pyod(obj))
+  File "numpy/core/setup_common.py", line 401, in long_double_representation
+    raise ValueError("Could not lock sequences (%s)" % saw)
+ValueError: Could not lock sequences (None)
+```
+
+This comes from the depth of NumPy's code that tries to determine ABI by inspecting some compiled code (https://github.com/numpy/numpy/blob/master/numpy/core/setup_common.py).
+
+An upgrade to 1.16.6 fixes the build error and works well on other platforms.
+
+This can be tested with #29415:
+
+```
+  tox -e local-conda-forge-macos-standard
+```
+
+Follow-up: #29425 - newer version, py3 only
+
``````




---

archive/issue_comments_575813.json:
```json
{
    "body": "<a id='comment:7'></a>\nReady for review",
    "created_at": "2020-03-31T16:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575813",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Ready for review



---

archive/issue_comments_575814.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-31T16:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575814",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_575815.json:
```json
{
    "body": "Reviewer: Isuru Fernando",
    "created_at": "2020-03-31T16:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575815",
    "user": "https://github.com/isuruf"
}
```

Reviewer: Isuru Fernando



---

archive/issue_comments_575816.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks!",
    "created_at": "2020-03-31T17:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575816",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Thanks!



---

archive/issue_comments_575817.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis seems to cause matplotlib build to fail on Cygwin - https://github.com/mkoeppe/sage/runs/550935268",
    "created_at": "2020-04-01T14:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575817",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
This seems to cause matplotlib build to fail on Cygwin - https://github.com/mkoeppe/sage/runs/550935268



---

archive/issue_comments_575818.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-04-01T14:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575818",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_575819.json:
```json
{
    "body": "<a id='comment:11'></a>\nTrying if a matplotlib update fixes it (#29444)",
    "created_at": "2020-04-01T14:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575819",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Trying if a matplotlib update fixes it (#29444)



---

archive/issue_comments_575820.json:
```json
{
    "body": "<a id='comment:12'></a>\nTest running at https://github.com/mkoeppe/sage/actions/runs/68777489",
    "created_at": "2020-04-02T13:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575820",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Test running at https://github.com/mkoeppe/sage/actions/runs/68777489



---

archive/issue_comments_575821.json:
```json
{
    "body": "<a id='comment:13'></a>\nLet's worry about Cygwin later. Hopefully the maintainer of the Cygwin port finds some time before the 9.1 release",
    "created_at": "2020-04-08T01:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575821",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Let's worry about Cygwin later. Hopefully the maintainer of the Cygwin port finds some time before the 9.1 release



---

archive/issue_comments_575822.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-04-08T01:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575822",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_084666.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-12T15:34:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29429#event-84666"
}
```



---

archive/issue_comments_575823.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-12T15:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575823",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_575824.json:
```json
{
    "body": "Changing branch from \"[u/mkoeppe/upgrade_numpy_to_0_16_6__last_release_supporting_py2_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_numpy_to_0_16_6__last_release_supporting_py2_)\" to \"[b0c7df6570aad9e485a7de0bd0ea5782fdf054e9](https://github.com/sagemath/sagetrac-mirror/commit/b0c7df6570aad9e485a7de0bd0ea5782fdf054e9)\"",
    "created_at": "2020-04-12T15:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29429#issuecomment-575824",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/mkoeppe/upgrade_numpy_to_0_16_6__last_release_supporting_py2_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_numpy_to_0_16_6__last_release_supporting_py2_)" to "[b0c7df6570aad9e485a7de0bd0ea5782fdf054e9](https://github.com/sagemath/sagetrac-mirror/commit/b0c7df6570aad9e485a7de0bd0ea5782fdf054e9)"
