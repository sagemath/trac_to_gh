# Issue 29307: gfortran: build-gcc: Don't hardcode bash as /bin/bash

archive/issues_029070.json:
```json
{
    "assignees": [],
    "body": "Causes errors on nix (#29130)\n\nCC:  @timokau\n\nComponent: **packages: standard**\n\nAuthor: **Matthias Koeppe**\n\nBranch/Commit: **[`e1f0788`](https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516)**\n\nReviewer: **Timo Kaufmann, John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29307_\n\n",
    "closed_at": "2020-03-11T23:46:01Z",
    "created_at": "2020-03-10T03:17:09Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "gfortran: build-gcc: Don't hardcode bash as /bin/bash",
    "type": "issue",
    "updated_at": "2020-03-11T23:46:01Z",
    "url": "https://github.com/sagemath/sage/issues/29307",
    "user": "https://github.com/mkoeppe"
}
```
Causes errors on nix (#29130)

CC:  @timokau

Component: **packages: standard**

Author: **Matthias Koeppe**

Branch/Commit: **[`e1f0788`](https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516)**

Reviewer: **Timo Kaufmann, John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/29307_





---

archive/issue_events_399877.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-10T03:17:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399877"
}
```



---

archive/issue_events_399878.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-10T03:17:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399878"
}
```



---

archive/issue_events_399879.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-10T03:17:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399879"
}
```



---

archive/issue_events_399880.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-10T03:17:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399880"
}
```



---

archive/issue_comments_459526.json:
```json
{
    "body": "Branch: **[u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash)**",
    "created_at": "2020-03-10T03:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459526",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash)**



---

archive/issue_comments_459527.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash)** to none",
    "created_at": "2020-03-10T03:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459527",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash)** to none



---

archive/issue_events_399881.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-10T03:20:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399881"
}
```



---

archive/issue_comments_459528.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-03-10T03:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459528",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_459529.json:
```json
{
    "body": "Branch: **[u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash)**",
    "created_at": "2020-03-10T03:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459529",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash)**



---

archive/issue_comments_459530.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHow about these changes?\n\n```diff\ndiff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc\nindex 3773a22552..1b3c72b129 100755\n--- a/build/pkgs/gcc/build-gcc\n+++ b/build/pkgs/gcc/build-gcc\n@@ -1,4 +1,4 @@\n-#! /usr/bin/env bash\n+#!/usr/bin/env bash\n #\n # Wrapper script for building GCC used for both the gcc and gfortran SPKGs\n # Usage:\ndiff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build\nindex 2c07c4ea98..441c9774b4 100644\n--- a/build/pkgs/gcc/spkg-build\n+++ b/build/pkgs/gcc/spkg-build\n@@ -9,7 +9,7 @@ if { uname -sr | grep 'Darwin [0-9]\\.' ;} &>/dev/null; then\n     mkdir -p bin/\n     LD=`which \"${LD:-ld}\"`\n \n-    echo '#!/bin/bash' >>\"bin/ld\"\n+    echo '#!/usr/bin/env bash' >>\"bin/ld\"\n     echo '# ld wrapper generated by the GCC spkg' >>\"bin/ld\"\n     echo >>\"bin/ld\"\n     # Hardcode the path to the \"real\" ld.\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d9c5dad9bc1597e370e873dd68ed117bab92057\"><code>2d9c5da</code></a></td><td><code>build/pkgs/gcc/build-gcc: Use /usr/bin/env bash instead of /bin/bash</code></td></tr></table>\n",
    "created_at": "2020-03-10T03:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459530",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

How about these changes?

```diff
diff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc
index 3773a22552..1b3c72b129 100755
--- a/build/pkgs/gcc/build-gcc
+++ b/build/pkgs/gcc/build-gcc
@@ -1,4 +1,4 @@
-#! /usr/bin/env bash
+#!/usr/bin/env bash
 #
 # Wrapper script for building GCC used for both the gcc and gfortran SPKGs
 # Usage:
diff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build
index 2c07c4ea98..441c9774b4 100644
--- a/build/pkgs/gcc/spkg-build
+++ b/build/pkgs/gcc/spkg-build
@@ -9,7 +9,7 @@ if { uname -sr | grep 'Darwin [0-9]\.' ;} &>/dev/null; then
     mkdir -p bin/
     LD=`which "${LD:-ld}"`
 
-    echo '#!/bin/bash' >>"bin/ld"
+    echo '#!/usr/bin/env bash' >>"bin/ld"
     echo '# ld wrapper generated by the GCC spkg' >>"bin/ld"
     echo >>"bin/ld"
     # Hardcode the path to the "real" ld.
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d9c5dad9bc1597e370e873dd68ed117bab92057"><code>2d9c5da</code></a></td><td><code>build/pkgs/gcc/build-gcc: Use /usr/bin/env bash instead of /bin/bash</code></td></tr></table>




---

archive/issue_comments_459531.json:
```json
{
    "body": "Commit: **[`2d9c5da`](https://github.com/sagemath/sagetrac-mirror/commit/2d9c5dad9bc1597e370e873dd68ed117bab92057)**",
    "created_at": "2020-03-10T03:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459531",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[`2d9c5da`](https://github.com/sagemath/sagetrac-mirror/commit/2d9c5dad9bc1597e370e873dd68ed117bab92057)**



---

archive/issue_comments_459532.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nLooks good to me. It has been a while since I tried to compile sage-the-distribution on nix, but I'm glad to see you're looking into this.",
    "created_at": "2020-03-10T12:52:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459532",
    "user": "https://github.com/timokau"
}
```

<div id="comment:5" align="right">comment:5</div>

Looks good to me. It has been a while since I tried to compile sage-the-distribution on nix, but I'm glad to see you're looking into this.



---

archive/issue_comments_459533.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516\"><code>e1f0788</code></a></td><td><code>No space after shebang</code></td></tr></table>\n",
    "created_at": "2020-03-10T22:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459533",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516"><code>e1f0788</code></a></td><td><code>No space after shebang</code></td></tr></table>




---

archive/issue_comments_459534.json:
```json
{
    "body": "Changed commit from **[`2d9c5da`](https://github.com/sagemath/sagetrac-mirror/commit/2d9c5dad9bc1597e370e873dd68ed117bab92057)** to **[`e1f0788`](https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516)**",
    "created_at": "2020-03-10T22:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459534",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2d9c5da`](https://github.com/sagemath/sagetrac-mirror/commit/2d9c5dad9bc1597e370e873dd68ed117bab92057)** to **[`e1f0788`](https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516)**



---

archive/issue_comments_459535.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@jhpalmieri](#comment%3A4):\n> How about these changes?\n> \n> ```\n> diff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc\n> ```\n\nOK, done.\n\n> ```\n> diff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build\n> index 2c07c4ea98..441c9774b4 100644\n> --- a/build/pkgs/gcc/spkg-build\n> +++ b/build/pkgs/gcc/spkg-build\n> @@ -9,7 +9,7 @@ if { uname -sr | grep 'Darwin [0-9]\\.' ;} &>/dev/null; then\n>      mkdir -p bin/\n>      LD=`which \"${LD:-ld}\"`\n>  \n> -    echo '#!/bin/bash' >>\"bin/ld\"\n> +    echo '#!/usr/bin/env bash' >>\"bin/ld\"\n>      echo '# ld wrapper generated by the GCC spkg' >>\"bin/ld\"\n>      echo >>\"bin/ld\"\n>      # Hardcode the path to the \"real\" ld.\n> ```\n\nThis is code for ancient macOS versions that I would be unable to test. Best to leave it alone.",
    "created_at": "2020-03-10T22:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459535",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@jhpalmieri](#comment%3A4):
> How about these changes?
> 
> ```
> diff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc
> ```

OK, done.

> ```
> diff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build
> index 2c07c4ea98..441c9774b4 100644
> --- a/build/pkgs/gcc/spkg-build
> +++ b/build/pkgs/gcc/spkg-build
> @@ -9,7 +9,7 @@ if { uname -sr | grep 'Darwin [0-9]\.' ;} &>/dev/null; then
>      mkdir -p bin/
>      LD=`which "${LD:-ld}"`
>  
> -    echo '#!/bin/bash' >>"bin/ld"
> +    echo '#!/usr/bin/env bash' >>"bin/ld"
>      echo '# ld wrapper generated by the GCC spkg' >>"bin/ld"
>      echo >>"bin/ld"
>      # Hardcode the path to the "real" ld.
> ```

This is code for ancient macOS versions that I would be unable to test. Best to leave it alone.



---

archive/issue_events_399882.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-10T22:39:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399882"
}
```



---

archive/issue_events_399883.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-10T22:39:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399883"
}
```



---

archive/issue_comments_459536.json:
```json
{
    "body": "Reviewer: **Timo Kaufmann, John Palmieri**",
    "created_at": "2020-03-10T22:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459536",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **Timo Kaufmann, John Palmieri**



---

archive/issue_comments_459537.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOkay",
    "created_at": "2020-03-10T22:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459537",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Okay



---

archive/issue_comments_459538.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks!",
    "created_at": "2020-03-10T23:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459538",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks!



---

archive/issue_comments_459539.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash)** to **[`e1f0788`](https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516)**",
    "created_at": "2020-03-11T23:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29307#issuecomment-459539",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash)** to **[`e1f0788`](https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516)**



---

archive/issue_events_399884.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-11T23:46:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399884"
}
```



---

archive/issue_events_399885.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f8064fd0bababd8f8d0cb31209b46bb43a43ea57",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-03-11T23:46:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29307",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29307#event-399885"
}
```
