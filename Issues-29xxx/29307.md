# Issue 29307: gfortran: build-gcc: Don't hardcode bash as /bin/bash

archive/issues_029070.json:
```json
{
    "body": "Causes errors on nix (#29130)\n\nCC:  @timokau\n\nBranch/Commit: e1f078878466b415880fbe1bb17d230557d7c516\n\nReviewer: Timo Kaufmann, John Palmieri\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29307\n\n",
    "closed_at": "2020-03-11T23:46:01Z",
    "created_at": "2020-03-10T03:17:09Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "gfortran: build-gcc: Don't hardcode bash as /bin/bash",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29307",
    "user": "https://github.com/mkoeppe"
}
```
Causes errors on nix (#29130)

CC:  @timokau

Branch/Commit: e1f078878466b415880fbe1bb17d230557d7c516

Reviewer: Timo Kaufmann, John Palmieri

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29307





---

archive/issue_comments_572517.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash\"",
    "created_at": "2020-03-10T03:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572517",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash"



---

archive/issue_comments_572518.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash\" to \"\"",
    "created_at": "2020-03-10T03:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572518",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash" to ""



---

archive/issue_comments_572519.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-10T03:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572519",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_572520.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-03-10T03:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572520",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_572521.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash\"",
    "created_at": "2020-03-10T03:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572521",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash"



---

archive/issue_comments_572522.json:
```json
{
    "body": "<a id='comment:4'></a>\nHow about these changes?\n\n```diff\ndiff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc\nindex 3773a22552..1b3c72b129 100755\n--- a/build/pkgs/gcc/build-gcc\n+++ b/build/pkgs/gcc/build-gcc\n@@ -1,4 +1,4 @@\n-#! /usr/bin/env bash\n+#!/usr/bin/env bash\n #\n # Wrapper script for building GCC used for both the gcc and gfortran SPKGs\n # Usage:\ndiff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build\nindex 2c07c4ea98..441c9774b4 100644\n--- a/build/pkgs/gcc/spkg-build\n+++ b/build/pkgs/gcc/spkg-build\n@@ -9,7 +9,7 @@ if { uname -sr | grep 'Darwin [0-9]\\.' ;} &>/dev/null; then\n     mkdir -p bin/\n     LD=`which \"${LD:-ld}\"`\n \n-    echo '#!/bin/bash' >>\"bin/ld\"\n+    echo '#!/usr/bin/env bash' >>\"bin/ld\"\n     echo '# ld wrapper generated by the GCC spkg' >>\"bin/ld\"\n     echo >>\"bin/ld\"\n     # Hardcode the path to the \"real\" ld.\n```\n\n---\nNew commits:\n|                                                                                                                                          |                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[2d9c5da](https://github.com/sagemath/sagetrac-mirror/commit/2d9c5dad9bc1597e370e873dd68ed117bab92057)|`build/pkgs/gcc/build-gcc: Use /usr/bin/env bash instead of /bin/bash`|",
    "created_at": "2020-03-10T03:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572522",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
How about these changes?

```diff
diff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc
index 3773a22552..1b3c72b129 100755
--- a/build/pkgs/gcc/build-gcc
+++ b/build/pkgs/gcc/build-gcc
@@ -1,4 +1,4 @@
-#! /usr/bin/env bash
+#!/usr/bin/env bash
 #
 # Wrapper script for building GCC used for both the gcc and gfortran SPKGs
 # Usage:
diff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build
index 2c07c4ea98..441c9774b4 100644
--- a/build/pkgs/gcc/spkg-build
+++ b/build/pkgs/gcc/spkg-build
@@ -9,7 +9,7 @@ if { uname -sr | grep 'Darwin [0-9]\.' ;} &>/dev/null; then
     mkdir -p bin/
     LD=`which "${LD:-ld}"`
 
-    echo '#!/bin/bash' >>"bin/ld"
+    echo '#!/usr/bin/env bash' >>"bin/ld"
     echo '# ld wrapper generated by the GCC spkg' >>"bin/ld"
     echo >>"bin/ld"
     # Hardcode the path to the "real" ld.
```

---
New commits:
|                                                                                                                                          |                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[2d9c5da](https://github.com/sagemath/sagetrac-mirror/commit/2d9c5dad9bc1597e370e873dd68ed117bab92057)|`build/pkgs/gcc/build-gcc: Use /usr/bin/env bash instead of /bin/bash`|



---

archive/issue_comments_572523.json:
```json
{
    "body": "Changing commit from \"\" to \"2d9c5dad9bc1597e370e873dd68ed117bab92057\"",
    "created_at": "2020-03-10T03:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572523",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "" to "2d9c5dad9bc1597e370e873dd68ed117bab92057"



---

archive/issue_comments_572524.json:
```json
{
    "body": "<a id='comment:5'></a>\nLooks good to me. It has been a while since I tried to compile sage-the-distribution on nix, but I'm glad to see you're looking into this.",
    "created_at": "2020-03-10T12:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572524",
    "user": "https://github.com/timokau"
}
```

<a id='comment:5'></a>
Looks good to me. It has been a while since I tried to compile sage-the-distribution on nix, but I'm glad to see you're looking into this.



---

archive/issue_comments_572525.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n|[e1f0788](https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516)|`No space after shebang`|",
    "created_at": "2020-03-10T22:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
|[e1f0788](https://github.com/sagemath/sagetrac-mirror/commit/e1f078878466b415880fbe1bb17d230557d7c516)|`No space after shebang`|



---

archive/issue_comments_572526.json:
```json
{
    "body": "Changing commit from \"2d9c5dad9bc1597e370e873dd68ed117bab92057\" to \"e1f078878466b415880fbe1bb17d230557d7c516\"",
    "created_at": "2020-03-10T22:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572526",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2d9c5dad9bc1597e370e873dd68ed117bab92057" to "e1f078878466b415880fbe1bb17d230557d7c516"



---

archive/issue_comments_572527.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> How about these changes?\n> \n> ```\n> diff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc\n> ```\n\n\nOK, done.\n\n> {{{\n> diff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build\n> index 2c07c4ea98..441c9774b4 100644\n> --- a/build/pkgs/gcc/spkg-build\n> +++ b/build/pkgs/gcc/spkg-build\n> `@``@` -9,7 +9,7 `@``@` if { uname -sr | grep 'Darwin [0-9]\\.' ;} &>/dev/null; then\n>      mkdir -p bin/\n>      LD=`which \"${LD:-ld}\"`\n>  \n> -    echo '#!/bin/bash' >>\"bin/ld\"\n> +    echo '#!/usr/bin/env bash' >>\"bin/ld\"\n>      echo '# ld wrapper generated by the GCC spkg' >>\"bin/ld\"\n>      echo >>\"bin/ld\"\n>      # Hardcode the path to the \"real\" ld.\n> }}}\n\n\nThis is code for ancient macOS versions that I would be unable to test. Best to leave it alone.",
    "created_at": "2020-03-10T22:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572527",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Replying to [jhpalmieri](#comment%3A4):
> How about these changes?
> 
> ```
> diff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc
> ```


OK, done.

> {{{
> diff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build
> index 2c07c4ea98..441c9774b4 100644
> --- a/build/pkgs/gcc/spkg-build
> +++ b/build/pkgs/gcc/spkg-build
> `@``@` -9,7 +9,7 `@``@` if { uname -sr | grep 'Darwin [0-9]\.' ;} &>/dev/null; then
>      mkdir -p bin/
>      LD=`which "${LD:-ld}"`
>  
> -    echo '#!/bin/bash' >>"bin/ld"
> +    echo '#!/usr/bin/env bash' >>"bin/ld"
>      echo '# ld wrapper generated by the GCC spkg' >>"bin/ld"
>      echo >>"bin/ld"
>      # Hardcode the path to the "real" ld.
> }}}


This is code for ancient macOS versions that I would be unable to test. Best to leave it alone.



---

archive/issue_comments_572528.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-10T22:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572528",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_572529.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Timo Kaufmann, John Palmieri\"",
    "created_at": "2020-03-10T22:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572529",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "Timo Kaufmann, John Palmieri"



---

archive/issue_comments_572530.json:
```json
{
    "body": "<a id='comment:8'></a>\nOkay",
    "created_at": "2020-03-10T22:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572530",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
Okay



---

archive/issue_comments_572531.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks!",
    "created_at": "2020-03-10T23:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572531",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Thanks!



---

archive/issue_comments_572532.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash\" to \"e1f078878466b415880fbe1bb17d230557d7c516\"",
    "created_at": "2020-03-11T23:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572532",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/gfortran__build_gcc__don_t_hardcode_bash_as__bin_bash" to "e1f078878466b415880fbe1bb17d230557d7c516"



---

archive/issue_comments_572533.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-11T23:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29307#issuecomment-572533",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_084142.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-11T23:46:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29307",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29307#event-84142"
}
```
