# Issue 29158: Allow binary distributions to prevent rebuilding of sagelib

archive/issues_028921.json:
```json
{
    "body": "This slightly odd ticket is needed for the Windows version of Sage, and might be useful in other binary distributions (e.g. Docker?) in which the `src/build` directory has been stripped out.\n\nAt issue here is the fact that, if you install an optional package with `sage -i`, after the optional package is installed it runs:\n\n```\ntouch \"$SAGE_ROOT/configure\" && $MAKE all-build\n```\n\nIf `src/build` has been stripped out, this means that *all* of sagelib gets rebuilt, even if it isn't necessary.\n\nThis solution is not perfect, however, because sagelib does have some \"optional extensions\", such that when installing certain optional packages it is necessary to rebuild at least part of sagelib.\n\nSo I'm open to better ideas on this, but I do need it right now for the Windows distribution.\n\n**CC:**  @vbraun @dimpase @jdemeyer\n\n**Branch:** [u/embray/disable-force-rebuild-on-spkg-install](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/disable-force-rebuild-on-spkg-install)\n\n**Commit:** [c2173096eee85975cbb0708ece03586438796135](https://github.com/sagemath/sagetrac-mirror/commit/c2173096eee85975cbb0708ece03586438796135)\n\n**Reviewer:** Dima Pasechnik\n\n**Dependencies:** #33131\n\nIssue created by migration from https://trac.sagemath.org/ticket/29158\n\n",
    "closed_at": "2022-02-12T18:02:50Z",
    "created_at": "2020-02-06T11:51:24Z",
    "labels": [
        "component: build",
        "critical",
        "enhancement",
        "invalid"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Allow binary distributions to prevent rebuilding of sagelib",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29158",
    "user": "https://github.com/embray"
}
```
This slightly odd ticket is needed for the Windows version of Sage, and might be useful in other binary distributions (e.g. Docker?) in which the `src/build` directory has been stripped out.

At issue here is the fact that, if you install an optional package with `sage -i`, after the optional package is installed it runs:

```
touch "$SAGE_ROOT/configure" && $MAKE all-build
```

If `src/build` has been stripped out, this means that *all* of sagelib gets rebuilt, even if it isn't necessary.

This solution is not perfect, however, because sagelib does have some "optional extensions", such that when installing certain optional packages it is necessary to rebuild at least part of sagelib.

So I'm open to better ideas on this, but I do need it right now for the Windows distribution.

**CC:**  @vbraun @dimpase @jdemeyer

**Branch:** [u/embray/disable-force-rebuild-on-spkg-install](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/disable-force-rebuild-on-spkg-install)

**Commit:** [c2173096eee85975cbb0708ece03586438796135](https://github.com/sagemath/sagetrac-mirror/commit/c2173096eee85975cbb0708ece03586438796135)

**Reviewer:** Dima Pasechnik

**Dependencies:** #33131

Issue created by migration from https://trac.sagemath.org/ticket/29158





---

archive/issue_comments_542633.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-02-06T11:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542633",
    "user": "https://github.com/embray"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_542634.json:
```json
{
    "body": "<a id='comment:2'></a>\n(dup of #29055)",
    "created_at": "2020-02-17T01:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542634",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
(dup of #29055)



---

archive/issue_comments_542635.json:
```json
{
    "body": "<a id='comment:3'></a>\nIn the CI test of `sage-numerical-backends-coin`, I just patch this away using `sed`:\nhttps://github.com/mkoeppe/sage-numerical-backends-coin/blob/master/Dockerfile-sage_binary#L39",
    "created_at": "2020-02-17T01:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542635",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
In the CI test of `sage-numerical-backends-coin`, I just patch this away using `sed`:
https://github.com/mkoeppe/sage-numerical-backends-coin/blob/master/Dockerfile-sage_binary#L39



---

archive/issue_comments_542636.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2020-03-29T15:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542636",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_events_083908.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-20T23:12:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83908"
}
```



---

archive/issue_events_083909.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-08T17:31:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83909"
}
```



---

archive/issue_events_083910.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-08T17:31:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83910"
}
```



---

archive/issue_comments_542637.json:
```json
{
    "body": "<a id='comment:8'></a>\nMoving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542637",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_083911.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83911"
}
```



---

archive/issue_events_083912.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83912"
}
```



---

archive/issue_events_083913.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83913"
}
```



---

archive/issue_events_083914.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83914"
}
```



---

archive/issue_comments_542638.json:
```json
{
    "body": "<a id='comment:10'></a>\nWork on improving the binary distribution is clearly not happening; we can close it as outdated - depending on #33131.",
    "created_at": "2022-01-08T19:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542638",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Work on improving the binary distribution is clearly not happening; we can close it as outdated - depending on #33131.



---

archive/issue_comments_542639.json:
```json
{
    "body": "**Dependencies:** #33131",
    "created_at": "2022-01-08T19:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542639",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #33131



---

archive/issue_events_083915.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-08T19:19:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83915"
}
```



---

archive/issue_events_083916.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-08T19:19:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83916"
}
```



---

archive/issue_comments_542640.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2022-01-08T19:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542640",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_542641.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2022-01-13T16:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542641",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_542642.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2022-01-13T16:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29158#issuecomment-542642",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_083917.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-12T18:02:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29158",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29158#event-83917"
}
```
