# Issue 29116: affine_basis does not always work when used with orthogonal or orthonormal

archive/issues_028879.json:
```json
{
    "body": "When using `affine_basis` of `Polyhedron` with `orthogonal` or `orthonormal` we get the following errors.\n\n```\nsage: V =[\n....:    [1, 0, -1, 0, 0],\n....:    [1, 0, 0, -1, 0],\n....:    [1, 0, 0, 0, -1],\n....:    [1, 0, 0, +1, 0],\n....:    [1, 0, 0, 0, +1],\n....:    [1, +1, 0, 0, 0]\n....:     ]\nsage: P = Polyhedron(V)\nsage: P.affine_hull()\nA 4-dimensional polyhedron in ZZ^4 defined as the convex hull of 6 vertices\n```\n\n```\nsage: P.affine_hull(orthogonal=True) \n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: V-representation data requires a list of length ambient_dim\n```\n\n```\nsage: P.affine_hull(orthonormal=True, extend=True)\nA 4-dimensional polyhedron in AA^4 defined as the convex hull of 5 vertices and 1 line\n```\n\n\nThis happens because the method for computing an affine basis depends on the order of the vertices. We fix that by computing an affine basis of the polyhedron in the right way.\n\nCC:  @jplab @kliem\n\nKeywords: polytopes, affine_hull\n\nBranch/Commit: 7d2171786b439fd246ae097b5ffc050bba74c39e\n\nReviewer: Laith Rastanawi\n\nAuthor: Jonathan Kliem\n\nDependencies: #29127\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29116\n\n",
    "closed_at": "2020-03-01T23:46:00Z",
    "created_at": "2020-01-31T09:27:38Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "affine_basis does not always work when used with orthogonal or orthonormal",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29116",
    "user": "https://github.com/LaisRast"
}
```
When using `affine_basis` of `Polyhedron` with `orthogonal` or `orthonormal` we get the following errors.

```
sage: V =[
....:    [1, 0, -1, 0, 0],
....:    [1, 0, 0, -1, 0],
....:    [1, 0, 0, 0, -1],
....:    [1, 0, 0, +1, 0],
....:    [1, 0, 0, 0, +1],
....:    [1, +1, 0, 0, 0]
....:     ]
sage: P = Polyhedron(V)
sage: P.affine_hull()
A 4-dimensional polyhedron in ZZ^4 defined as the convex hull of 6 vertices
```

```
sage: P.affine_hull(orthogonal=True) 
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: V-representation data requires a list of length ambient_dim
```

```
sage: P.affine_hull(orthonormal=True, extend=True)
A 4-dimensional polyhedron in AA^4 defined as the convex hull of 5 vertices and 1 line
```


This happens because the method for computing an affine basis depends on the order of the vertices. We fix that by computing an affine basis of the polyhedron in the right way.

CC:  @jplab @kliem

Keywords: polytopes, affine_hull

Branch/Commit: 7d2171786b439fd246ae097b5ffc050bba74c39e

Reviewer: Laith Rastanawi

Author: Jonathan Kliem

Dependencies: #29127

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29116





---

archive/issue_comments_567498.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29127\"",
    "created_at": "2020-01-31T20:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567498",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "" to "#29127"



---

archive/issue_comments_567499.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[a8359e0](https://git.sagemath.org/sage.git/commit?id=a8359e0ffa390eac98d9b14597b7f9ceb8fe1cbd)|`implement `a_maximal_chain` for combinatorial polyhedron`|\n|[6c4c1c0](https://git.sagemath.org/sage.git/commit?id=6c4c1c052fa7c0da97b08b886301efbe8423c4a5)|`implement `an_affine_basis` for polytopes`|\n|[3d87ccf](https://git.sagemath.org/sage.git/commit?id=3d87ccf0db20c70748ac19c60a23d38b5e881049)|`more description in the docs`|\n|[1b78e87](https://git.sagemath.org/sage.git/commit?id=1b78e87b1883322024aec755a2fe98c6cd8c3765)|`used an_affine_basis to simplify is_inscribed`|\n|[5e547b3](https://git.sagemath.org/sage.git/commit?id=5e547b3632428da4dd0e8b1e80ee450924d04990)|`check sign of circumcenter using all vertices of simplex`|\n|[231c16f](https://git.sagemath.org/sage.git/commit?id=231c16f3a948591183cf21bfff83226997201fea)|`apply change to 29125`|\n|[4fb0f6b](https://git.sagemath.org/sage.git/commit?id=4fb0f6ba4cfd36da8f5f41a499c78aa82cccca4b)|`handling small-dimensional cases`|\n|[3f6013b](https://git.sagemath.org/sage.git/commit?id=3f6013b3fa37510be72ee965351f6a4cf446b3f8)|`temporary fix`|\n|[df7ec00](https://git.sagemath.org/sage.git/commit?id=df7ec00c4ae9ba37900ba59ef3f3903f5000d5ca)|`get correct affine basis for affine hull with orthogonal/orthonormal`|",
    "created_at": "2020-01-31T22:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567499",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[a8359e0](https://git.sagemath.org/sage.git/commit?id=a8359e0ffa390eac98d9b14597b7f9ceb8fe1cbd)|`implement `a_maximal_chain` for combinatorial polyhedron`|
|[6c4c1c0](https://git.sagemath.org/sage.git/commit?id=6c4c1c052fa7c0da97b08b886301efbe8423c4a5)|`implement `an_affine_basis` for polytopes`|
|[3d87ccf](https://git.sagemath.org/sage.git/commit?id=3d87ccf0db20c70748ac19c60a23d38b5e881049)|`more description in the docs`|
|[1b78e87](https://git.sagemath.org/sage.git/commit?id=1b78e87b1883322024aec755a2fe98c6cd8c3765)|`used an_affine_basis to simplify is_inscribed`|
|[5e547b3](https://git.sagemath.org/sage.git/commit?id=5e547b3632428da4dd0e8b1e80ee450924d04990)|`check sign of circumcenter using all vertices of simplex`|
|[231c16f](https://git.sagemath.org/sage.git/commit?id=231c16f3a948591183cf21bfff83226997201fea)|`apply change to 29125`|
|[4fb0f6b](https://git.sagemath.org/sage.git/commit?id=4fb0f6ba4cfd36da8f5f41a499c78aa82cccca4b)|`handling small-dimensional cases`|
|[3f6013b](https://git.sagemath.org/sage.git/commit?id=3f6013b3fa37510be72ee965351f6a4cf446b3f8)|`temporary fix`|
|[df7ec00](https://git.sagemath.org/sage.git/commit?id=df7ec00c4ae9ba37900ba59ef3f3903f5000d5ca)|`get correct affine basis for affine hull with orthogonal/orthonormal`|



---

archive/issue_comments_567500.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Kliem\"",
    "created_at": "2020-01-31T22:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567500",
    "user": "https://github.com/kliem"
}
```

Changing author from "" to "Jonathan Kliem"



---

archive/issue_comments_567501.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-31T22:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567501",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_567502.json:
```json
{
    "body": "Changing commit from \"\" to \"df7ec00c4ae9ba37900ba59ef3f3903f5000d5ca\"",
    "created_at": "2020-01-31T22:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567502",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "df7ec00c4ae9ba37900ba59ef3f3903f5000d5ca"



---

archive/issue_comments_567503.json:
```json
{
    "body": "Changing branch from \"\" to \"public/29116\"",
    "created_at": "2020-01-31T22:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567503",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/29116"



---

archive/issue_comments_567504.json:
```json
{
    "body": "Changing commit from \"df7ec00c4ae9ba37900ba59ef3f3903f5000d5ca\" to \"8b2709ef8514b374255b87da8838e190e6c64e3e\"",
    "created_at": "2020-02-19T08:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567504",
    "user": "https://github.com/kliem"
}
```

Changing commit from "df7ec00c4ae9ba37900ba59ef3f3903f5000d5ca" to "8b2709ef8514b374255b87da8838e190e6c64e3e"



---

archive/issue_comments_567505.json:
```json
{
    "body": "Changing branch from \"public/29116\" to \"public/29116-reb\"",
    "created_at": "2020-02-19T08:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567505",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29116" to "public/29116-reb"



---

archive/issue_comments_567506.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[61dd4a5](https://git.sagemath.org/sage.git/commit?id=61dd4a5a9f9a79161b2cae15d55829743cb80982)|`implement `a_maximal_chain` for combinatorial polyhedron`|\n|[a18011f](https://git.sagemath.org/sage.git/commit?id=a18011f03f6e13c8955dbaea80efc9b58ee4ef83)|`improved documentation`|\n|[2e9f25f](https://git.sagemath.org/sage.git/commit?id=2e9f25f044932e8e1ce5c9f9623893b6d2d2b23a)|`exposed a_maximal_chain to polyhedron_base`|\n|[0315652](https://git.sagemath.org/sage.git/commit?id=0315652fe8ac935524a4f4bc8093a4d46abe8715)|`implement `an_affine_basis` for polytopes`|\n|[554556d](https://git.sagemath.org/sage.git/commit?id=554556de8182d5d3010a2e89051071abb22dc435)|`more description in the docs`|\n|[aa30035](https://git.sagemath.org/sage.git/commit?id=aa30035881734330e014c521993294909e2f37da)|`used an_affine_basis to simplify is_inscribed`|\n|[08b263e](https://git.sagemath.org/sage.git/commit?id=08b263e83fd32e5f15405d8dac380f4a456aba0b)|`apply change to 29125`|\n|[d2d2a8a](https://git.sagemath.org/sage.git/commit?id=d2d2a8a4ebc544f986cb38744eee91047371bca6)|`handling small-dimensional cases`|\n|[ba48b17](https://git.sagemath.org/sage.git/commit?id=ba48b175d0f834c04632dfb91b8a65c84104ceea)|`get correct affine basis for affine hull with orthogonal/orthonormal`|\n|[8b2709e](https://git.sagemath.org/sage.git/commit?id=8b2709ef8514b374255b87da8838e190e6c64e3e)|`temporary fix`|",
    "created_at": "2020-02-19T08:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567506",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[61dd4a5](https://git.sagemath.org/sage.git/commit?id=61dd4a5a9f9a79161b2cae15d55829743cb80982)|`implement `a_maximal_chain` for combinatorial polyhedron`|
|[a18011f](https://git.sagemath.org/sage.git/commit?id=a18011f03f6e13c8955dbaea80efc9b58ee4ef83)|`improved documentation`|
|[2e9f25f](https://git.sagemath.org/sage.git/commit?id=2e9f25f044932e8e1ce5c9f9623893b6d2d2b23a)|`exposed a_maximal_chain to polyhedron_base`|
|[0315652](https://git.sagemath.org/sage.git/commit?id=0315652fe8ac935524a4f4bc8093a4d46abe8715)|`implement `an_affine_basis` for polytopes`|
|[554556d](https://git.sagemath.org/sage.git/commit?id=554556de8182d5d3010a2e89051071abb22dc435)|`more description in the docs`|
|[aa30035](https://git.sagemath.org/sage.git/commit?id=aa30035881734330e014c521993294909e2f37da)|`used an_affine_basis to simplify is_inscribed`|
|[08b263e](https://git.sagemath.org/sage.git/commit?id=08b263e83fd32e5f15405d8dac380f4a456aba0b)|`apply change to 29125`|
|[d2d2a8a](https://git.sagemath.org/sage.git/commit?id=d2d2a8a4ebc544f986cb38744eee91047371bca6)|`handling small-dimensional cases`|
|[ba48b17](https://git.sagemath.org/sage.git/commit?id=ba48b175d0f834c04632dfb91b8a65c84104ceea)|`get correct affine basis for affine hull with orthogonal/orthonormal`|
|[8b2709e](https://git.sagemath.org/sage.git/commit?id=8b2709ef8514b374255b87da8838e190e6c64e3e)|`temporary fix`|



---

archive/issue_comments_567507.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-28T10:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567507",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_567508.json:
```json
{
    "body": "<a id='comment:4'></a>\nSince #29127 is on \"positive review\", I think this one also should be on \"positive review\".\nIt looks good to me.\n(pycodestyle warnings are not sourced from her)",
    "created_at": "2020-02-28T10:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567508",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:4'></a>
Since #29127 is on "positive review", I think this one also should be on "positive review".
It looks good to me.
(pycodestyle warnings are not sourced from her)



---

archive/issue_comments_567509.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Laith Rastanawi\"",
    "created_at": "2020-02-28T10:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567509",
    "user": "https://github.com/LaisRast"
}
```

Changing reviewer from "" to "Laith Rastanawi"



---

archive/issue_comments_567510.json:
```json
{
    "body": "<a id='comment:5'></a>\nI forgot to mention:\n\n```diff\n-            # We implicitely translate the first vertex of the affine basis to zero.\n+            # We implicitly translate the first vertex of the affine basis to zero.\n```",
    "created_at": "2020-02-28T10:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567510",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:5'></a>
I forgot to mention:

```diff
-            # We implicitely translate the first vertex of the affine basis to zero.
+            # We implicitly translate the first vertex of the affine basis to zero.
```



---

archive/issue_comments_567511.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                           |      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------|\n|[7d21717](https://git.sagemath.org/sage.git/commit/?id=7d2171786b439fd246ae097b5ffc050bba74c39e)|`typo`|",
    "created_at": "2020-02-28T10:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                           |      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------|
|[7d21717](https://git.sagemath.org/sage.git/commit/?id=7d2171786b439fd246ae097b5ffc050bba74c39e)|`typo`|



---

archive/issue_comments_567512.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-02-28T10:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567512",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_567513.json:
```json
{
    "body": "Changing commit from \"8b2709ef8514b374255b87da8838e190e6c64e3e\" to \"7d2171786b439fd246ae097b5ffc050bba74c39e\"",
    "created_at": "2020-02-28T10:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567513",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8b2709ef8514b374255b87da8838e190e6c64e3e" to "7d2171786b439fd246ae097b5ffc050bba74c39e"



---

archive/issue_comments_567514.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-28T14:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567514",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_073851.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-01T23:46:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29116#event-73851"
}
```



---

archive/issue_comments_567515.json:
```json
{
    "body": "Changing branch from \"public/29116-reb\" to \"7d2171786b439fd246ae097b5ffc050bba74c39e\"",
    "created_at": "2020-03-01T23:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567515",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/29116-reb" to "7d2171786b439fd246ae097b5ffc050bba74c39e"



---

archive/issue_comments_567516.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-01T23:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29116#issuecomment-567516",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
