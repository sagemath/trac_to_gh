# Issue 29102: fflas_ffpack installation error on new CPUs with old compilers

archive/issues_028865.json:
```json
{
    "body": "As observed in #29084, \u200bfflas_ffpack compilation fails on a processor that supports AVX512 extensions with the default compiler on Ubuntu Trusty - gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.4).\n\nSee `ubuntu-trusty-minimal` run at \u200bhttps://github.com/mkoeppe/sage/runs/414021553\n\nAs noted in \u200bhttps://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on other major platforms: `ubuntu-trusty-standard`, `debian-jessie-standard`, `centos-7-minimal/standard`.\n\n\nIn this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. (Because of bugs in fflas_ffpack's configuration scripts, the flags for individual AVX512 variants are not handled individually.)\n\n(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)\n\nRelated upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184\n\n\n\nCC:  @dimpase @antonio-rojas @timokau @kiwifb @vbraun tmonteil\n\nBranch/Commit: d2f726ab38d4a737112d49ea35a743328afb73b7\n\nReviewer: Volker Braun, Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29102\n\n",
    "closed_at": "2020-03-25T22:48:53Z",
    "created_at": "2020-01-29T15:18:33Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "fflas_ffpack installation error on new CPUs with old compilers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29102",
    "user": "https://github.com/mkoeppe"
}
```
As observed in #29084, ​fflas_ffpack compilation fails on a processor that supports AVX512 extensions with the default compiler on Ubuntu Trusty - gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.4).

See `ubuntu-trusty-minimal` run at ​https://github.com/mkoeppe/sage/runs/414021553

As noted in ​https://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on other major platforms: `ubuntu-trusty-standard`, `debian-jessie-standard`, `centos-7-minimal/standard`.


In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. (Because of bugs in fflas_ffpack's configuration scripts, the flags for individual AVX512 variants are not handled individually.)

(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)

Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184



CC:  @dimpase @antonio-rojas @timokau @kiwifb @vbraun tmonteil

Branch/Commit: d2f726ab38d4a737112d49ea35a743328afb73b7

Reviewer: Volker Braun, Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29102





---

archive/issue_comments_559700.json:
```json
{
    "body": "<a id='comment:1'></a>\nSee also this thread on [sage-release](https://groups.google.com/d/msg/sage-release/x13Ug2AXNdE/0thZC21OFAAJ).",
    "created_at": "2020-01-29T17:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559700",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>
See also this thread on [sage-release](https://groups.google.com/d/msg/sage-release/x13Ug2AXNdE/0thZC21OFAAJ).



---

archive/issue_comments_559701.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-02-06T20:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559701",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_559702.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29052\"",
    "created_at": "2020-02-06T20:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559702",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29052"



---

archive/issue_comments_559703.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers\"",
    "created_at": "2020-02-06T20:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559703",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers"



---

archive/issue_comments_559704.json:
```json
{
    "body": "Changing commit from \"\" to \"1cce764e78fccc709ce14d8702e9519a032e372c\"",
    "created_at": "2020-02-06T21:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559704",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "1cce764e78fccc709ce14d8702e9519a032e372c"



---

archive/issue_comments_559705.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-06T21:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559705",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_559706.json:
```json
{
    "body": "<a id='comment:4'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/35630769\n\n---\nNew commits:\n|                                                                                                                                          |                                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[5244060](https://github.com/sagemath/sagetrac-mirror/commit/52440602fe014c55523938a588abf7e37489764a)|`Split out build/bin/sage-build-env-config from sage-env-config`|\n|[96b6c58](https://github.com/sagemath/sagetrac-mirror/commit/96b6c58635566e4fb9ad44f47b1466adfd9eb624)|`src/bin/sage: Add -buildsh`|\n|[3491a9d](https://github.com/sagemath/sagetrac-mirror/commit/3491a9dfd0064de56abd0d552cfac6da8b6c9777)|`build/make/deps, build/make.Makefile.in: Source build/bin/sage-build-env-config for building sagelib and for script packages`|\n|[11f6797](https://github.com/sagemath/sagetrac-mirror/commit/11f67970eed56fc77743a26013bfcd4905f9c965)|`Document 'sage -buildsh' in the output of 'sage -advanced'`|\n|[ecb6a8b](https://github.com/sagemath/sagetrac-mirror/commit/ecb6a8bf9050f079f743b8bb826450a12d5f75d3)|`src/doc/en/reference/repl/options.rst: Document sage --buildsh`|\n|[1cce764](https://github.com/sagemath/sagetrac-mirror/commit/1cce764e78fccc709ce14d8702e9519a032e372c)|`build/pkgs/fflas_ffpack: Disable arch flags that are not supported by the compiler`|",
    "created_at": "2020-02-06T21:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559706",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/35630769

---
New commits:
|                                                                                                                                          |                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[5244060](https://github.com/sagemath/sagetrac-mirror/commit/52440602fe014c55523938a588abf7e37489764a)|`Split out build/bin/sage-build-env-config from sage-env-config`|
|[96b6c58](https://github.com/sagemath/sagetrac-mirror/commit/96b6c58635566e4fb9ad44f47b1466adfd9eb624)|`src/bin/sage: Add -buildsh`|
|[3491a9d](https://github.com/sagemath/sagetrac-mirror/commit/3491a9dfd0064de56abd0d552cfac6da8b6c9777)|`build/make/deps, build/make.Makefile.in: Source build/bin/sage-build-env-config for building sagelib and for script packages`|
|[11f6797](https://github.com/sagemath/sagetrac-mirror/commit/11f67970eed56fc77743a26013bfcd4905f9c965)|`Document 'sage -buildsh' in the output of 'sage -advanced'`|
|[ecb6a8b](https://github.com/sagemath/sagetrac-mirror/commit/ecb6a8bf9050f079f743b8bb826450a12d5f75d3)|`src/doc/en/reference/repl/options.rst: Document sage --buildsh`|
|[1cce764](https://github.com/sagemath/sagetrac-mirror/commit/1cce764e78fccc709ce14d8702e9519a032e372c)|`build/pkgs/fflas_ffpack: Disable arch flags that are not supported by the compiler`|



---

archive/issue_comments_559707.json:
```json
{
    "body": "<a id='comment:5'></a>\nAre those the only options not supported by gcc-4.8.2? My first thought was testing only those flags, and not stuff like `sse4`.",
    "created_at": "2020-02-06T21:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559707",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Are those the only options not supported by gcc-4.8.2? My first thought was testing only those flags, and not stuff like `sse4`.



---

archive/issue_comments_559708.json:
```json
{
    "body": "<a id='comment:6'></a>\nI only took care of the `-mavx512*` flags because I knew that gcc-4.8.4 (as on Ubuntu trusty) does not have them. I threw in -mfma, -mfma4 because I was not familiar with them (though 4.8.4 supports them). All other flags are ancient and they are supported by 4.8.4.",
    "created_at": "2020-02-06T21:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559708",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
I only took care of the `-mavx512*` flags because I knew that gcc-4.8.4 (as on Ubuntu trusty) does not have them. I threw in -mfma, -mfma4 because I was not familiar with them (though 4.8.4 supports them). All other flags are ancient and they are supported by 4.8.4.



---

archive/issue_comments_559709.json:
```json
{
    "body": "<a id='comment:7'></a>\nLooks good to me then, but I cannot review the commits from the dependencies. If they are OK, I agree with the stuff that specifically is here.",
    "created_at": "2020-02-06T21:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559709",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Looks good to me then, but I cannot review the commits from the dependencies. If they are OK, I agree with the stuff that specifically is here.



---

archive/issue_comments_559710.json:
```json
{
    "body": "Changing commit from \"1cce764e78fccc709ce14d8702e9519a032e372c\" to \"82509d123567c0d653b17cbb1878585222c3b3d8\"",
    "created_at": "2020-02-06T21:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1cce764e78fccc709ce14d8702e9519a032e372c" to "82509d123567c0d653b17cbb1878585222c3b3d8"



---

archive/issue_comments_559711.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|\n|[82509d1](https://github.com/sagemath/sagetrac-mirror/commit/82509d123567c0d653b17cbb1878585222c3b3d8)|`Add AC_SUBST`|",
    "created_at": "2020-02-06T21:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|
|[82509d1](https://github.com/sagemath/sagetrac-mirror/commit/82509d123567c0d653b17cbb1878585222c3b3d8)|`Add AC_SUBST`|



---

archive/issue_comments_559712.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,5 +5,8 @@\n `fflas_ffpack` configuration should check that the compiler actually supports the architecture flags that it wants to use.\n \n It should be checked whether upstream has a fix for this.\n-Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284\n+Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).\n \n+Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184\n+\n+\n``````\n",
    "created_at": "2020-02-06T22:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559712",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,5 +5,8 @@
 `fflas_ffpack` configuration should check that the compiler actually supports the architecture flags that it wants to use.
 
 It should be checked whether upstream has a fix for this.
-Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284
+Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).
 
+Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184
+
+
``````




---

archive/issue_comments_559713.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------|\n|[e0b620e](https://github.com/sagemath/sagetrac-mirror/commit/e0b620e43858a1af3eb4d67a80daeaaa7703b686)|`fixup`|",
    "created_at": "2020-02-07T03:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------|
|[e0b620e](https://github.com/sagemath/sagetrac-mirror/commit/e0b620e43858a1af3eb4d67a80daeaaa7703b686)|`fixup`|



---

archive/issue_comments_559714.json:
```json
{
    "body": "Changing commit from \"82509d123567c0d653b17cbb1878585222c3b3d8\" to \"e0b620e43858a1af3eb4d67a80daeaaa7703b686\"",
    "created_at": "2020-02-07T03:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "82509d123567c0d653b17cbb1878585222c3b3d8" to "e0b620e43858a1af3eb4d67a80daeaaa7703b686"



---

archive/issue_comments_559715.json:
```json
{
    "body": "Changing commit from \"e0b620e43858a1af3eb4d67a80daeaaa7703b686\" to \"946a321a4e738e64453aec8d81d6da98e4f792d1\"",
    "created_at": "2020-02-08T03:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e0b620e43858a1af3eb4d67a80daeaaa7703b686" to "946a321a4e738e64453aec8d81d6da98e4f792d1"



---

archive/issue_comments_559716.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[946a321](https://github.com/sagemath/sagetrac-mirror/commit/946a321a4e738e64453aec8d81d6da98e4f792d1)|`Fixup quoting`|",
    "created_at": "2020-02-08T03:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[946a321](https://github.com/sagemath/sagetrac-mirror/commit/946a321a4e738e64453aec8d81d6da98e4f792d1)|`Fixup quoting`|



---

archive/issue_comments_559717.json:
```json
{
    "body": "<a id='comment:12'></a>\nThis now actually works and fixes installation on `ubuntu-trusty-minimal` (https://github.com/mkoeppe/sage/runs/432608426?check_suite_focus=true).\n\nBut with this fix there's an error on `debian-jessie-standard` https://github.com/mkoeppe/sage/runs/432608838?check_suite_focus=true\nHere the compiler supports only one of the avx512 flags.",
    "created_at": "2020-02-08T04:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559717",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
This now actually works and fixes installation on `ubuntu-trusty-minimal` (https://github.com/mkoeppe/sage/runs/432608426?check_suite_focus=true).

But with this fix there's an error on `debian-jessie-standard` https://github.com/mkoeppe/sage/runs/432608838?check_suite_focus=true
Here the compiler supports only one of the avx512 flags.



---

archive/issue_comments_559718.json:
```json
{
    "body": "<a id='comment:13'></a>\nI'd just drop jessie, it's too much hassle to go to for something with EOL in 5 months\nhttps://wiki.debian.org/LTS/Jessie",
    "created_at": "2020-02-08T09:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559718",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
I'd just drop jessie, it's too much hassle to go to for something with EOL in 5 months
https://wiki.debian.org/LTS/Jessie



---

archive/issue_comments_559719.json:
```json
{
    "body": "<a id='comment:14'></a>\nI don't think this is how we should think about it. Shouldn't we rather be increasing the minimum accepted gcc version, and install our own gcc if too old?",
    "created_at": "2020-02-08T22:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559719",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
I don't think this is how we should think about it. Shouldn't we rather be increasing the minimum accepted gcc version, and install our own gcc if too old?



---

archive/issue_comments_559720.json:
```json
{
    "body": "<a id='comment:15'></a>\nWell, it's possible, but newer gcc might not even get built with that old gcc.",
    "created_at": "2020-02-08T23:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559720",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Well, it's possible, but newer gcc might not even get built with that old gcc.



---

archive/issue_comments_559721.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[a0c3c59](https://github.com/sagemath/sagetrac-mirror/commit/a0c3c5965b51f473a8a16c58ee3431505d05efa8)|`Fix \"--build-sh\" -> \"--buildsh\" in a comment`|\n|[c1f0e62](https://github.com/sagemath/sagetrac-mirror/commit/c1f0e62472de3abb98300503cb588b127d181f42)|`Merge tag '9.1.beta4' into t/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh`|\n|[0dc97db](https://github.com/sagemath/sagetrac-mirror/commit/0dc97dbb12fcde2981cc0a4ef4bbd4938b5e74dc)|`Clean src/doc/en/installation/*.txt in bootstrap-clean, not misc-clean`|\n|[8bd4f53](https://github.com/sagemath/sagetrac-mirror/commit/8bd4f532a5b42fdcb9f809c570d85b7c61c03910)|`Merge branch 't/29233/bootstrap____make_distclean_broken' into t/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh`|\n|[5d47aae](https://github.com/sagemath/sagetrac-mirror/commit/5d47aae3431f711b3ccba0bdfddf198acf18dc19)|`Merge branch 't/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|\n|[e17c0a5](https://github.com/sagemath/sagetrac-mirror/commit/e17c0a5ee7d801c560657430480822fa8db47537)|`build/pkgs/fflas_ffpack/spkg-configure.m4: Disable all avx512 variants if the compiler does not support all of them`|",
    "created_at": "2020-02-24T07:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[a0c3c59](https://github.com/sagemath/sagetrac-mirror/commit/a0c3c5965b51f473a8a16c58ee3431505d05efa8)|`Fix "--build-sh" -> "--buildsh" in a comment`|
|[c1f0e62](https://github.com/sagemath/sagetrac-mirror/commit/c1f0e62472de3abb98300503cb588b127d181f42)|`Merge tag '9.1.beta4' into t/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh`|
|[0dc97db](https://github.com/sagemath/sagetrac-mirror/commit/0dc97dbb12fcde2981cc0a4ef4bbd4938b5e74dc)|`Clean src/doc/en/installation/*.txt in bootstrap-clean, not misc-clean`|
|[8bd4f53](https://github.com/sagemath/sagetrac-mirror/commit/8bd4f532a5b42fdcb9f809c570d85b7c61c03910)|`Merge branch 't/29233/bootstrap____make_distclean_broken' into t/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh`|
|[5d47aae](https://github.com/sagemath/sagetrac-mirror/commit/5d47aae3431f711b3ccba0bdfddf198acf18dc19)|`Merge branch 't/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|
|[e17c0a5](https://github.com/sagemath/sagetrac-mirror/commit/e17c0a5ee7d801c560657430480822fa8db47537)|`build/pkgs/fflas_ffpack/spkg-configure.m4: Disable all avx512 variants if the compiler does not support all of them`|



---

archive/issue_comments_559722.json:
```json
{
    "body": "Changing commit from \"946a321a4e738e64453aec8d81d6da98e4f792d1\" to \"e17c0a5ee7d801c560657430480822fa8db47537\"",
    "created_at": "2020-02-24T07:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "946a321a4e738e64453aec8d81d6da98e4f792d1" to "e17c0a5ee7d801c560657430480822fa8db47537"



---

archive/issue_comments_559723.json:
```json
{
    "body": "<a id='comment:17'></a>\nNow this is more robust and also works on `debian-jessie-standard`.\n\nSee https://github.com/mkoeppe/sage/actions/runs/44043380",
    "created_at": "2020-02-24T07:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559723",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Now this is more robust and also works on `debian-jessie-standard`.

See https://github.com/mkoeppe/sage/actions/runs/44043380



---

archive/issue_comments_559724.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,10 +2,9 @@\n \n See `ubuntu-trusty-minimal` run at \u200bhttps://github.com/mkoeppe/sage/runs/414021553\n \n-`fflas_ffpack` configuration should check that the compiler actually supports the architecture flags that it wants to use.\n+In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. \n \n-It should be checked whether upstream has a fix for this.\n-Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).\n+(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)\n \n Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184\n \n``````\n",
    "created_at": "2020-02-24T07:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559724",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,10 +2,9 @@
 
 See `ubuntu-trusty-minimal` run at ​https://github.com/mkoeppe/sage/runs/414021553
 
-`fflas_ffpack` configuration should check that the compiler actually supports the architecture flags that it wants to use.
+In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. 
 
-It should be checked whether upstream has a fix for this.
-Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).
+(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)
 
 Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184
 
``````




---

archive/issue_comments_559725.json:
```json
{
    "body": "Changing commit from \"e17c0a5ee7d801c560657430480822fa8db47537\" to \"5ead72fc3369b85f03445593732c103c363f811b\"",
    "created_at": "2020-02-27T04:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559725",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e17c0a5ee7d801c560657430480822fa8db47537" to "5ead72fc3369b85f03445593732c103c363f811b"



---

archive/issue_comments_559726.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|\n|[2ab9b09](https://github.com/sagemath/sagetrac-mirror/commit/2ab9b09b39a4b5f8e73e88aba24aad78c2ff31d5)|`Move SAGE_PKG_CONFIG_PATH, SAGE_NAUTY_BINS_PREFIX back to src/bin/sage-env-config.in`|\n|[5ead72f](https://github.com/sagemath/sagetrac-mirror/commit/5ead72fc3369b85f03445593732c103c363f811b)|`Merge branch 't/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|",
    "created_at": "2020-02-27T04:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559726",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
|[2ab9b09](https://github.com/sagemath/sagetrac-mirror/commit/2ab9b09b39a4b5f8e73e88aba24aad78c2ff31d5)|`Move SAGE_PKG_CONFIG_PATH, SAGE_NAUTY_BINS_PREFIX back to src/bin/sage-env-config.in`|
|[5ead72f](https://github.com/sagemath/sagetrac-mirror/commit/5ead72fc3369b85f03445593732c103c363f811b)|`Merge branch 't/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|



---

archive/issue_comments_559727.json:
```json
{
    "body": "<a id='comment:21'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|\n|[f6870ed](https://github.com/sagemath/sagetrac-mirror/commit/f6870ed273ec12224f3dcb34f273ce2b2fe5097e)|`Merge tag '9.1.beta6' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|",
    "created_at": "2020-03-02T01:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559727",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
|[f6870ed](https://github.com/sagemath/sagetrac-mirror/commit/f6870ed273ec12224f3dcb34f273ce2b2fe5097e)|`Merge tag '9.1.beta6' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|



---

archive/issue_comments_559728.json:
```json
{
    "body": "Changing commit from \"5ead72fc3369b85f03445593732c103c363f811b\" to \"f6870ed273ec12224f3dcb34f273ce2b2fe5097e\"",
    "created_at": "2020-03-02T01:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5ead72fc3369b85f03445593732c103c363f811b" to "f6870ed273ec12224f3dcb34f273ce2b2fe5097e"



---

archive/issue_comments_559729.json:
```json
{
    "body": "Changing dependencies from \"#29052\" to \"\"",
    "created_at": "2020-03-02T01:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559729",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29052" to ""



---

archive/issue_comments_559730.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Volker Braun\"",
    "created_at": "2020-03-02T23:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559730",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Volker Braun"



---

archive/issue_comments_559731.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-02T23:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559731",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_559732.json:
```json
{
    "body": "<a id='comment:24'></a>\nThanks!",
    "created_at": "2020-03-02T23:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559732",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Thanks!



---

archive/issue_comments_559733.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-03T23:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559733",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_091216.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-03T23:21:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29102#event-91216"
}
```



---

archive/issue_comments_559734.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers\" to \"f6870ed273ec12224f3dcb34f273ce2b2fe5097e\"",
    "created_at": "2020-03-03T23:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559734",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers" to "f6870ed273ec12224f3dcb34f273ce2b2fe5097e"



---

archive/issue_comments_559735.json:
```json
{
    "body": "<a id='comment:26'></a>\nThis breaks linbox on fresh builds:\n\n```\n-----------------------------------------------\nDefault path = /var/lib/buildbot/slave/sage2_git/build/local /usr /usr/local \nchecking whether to compile the drivers... no\n-----------------------------------------------\nchecking for pkg-config... /var/lib/buildbot/slave/sage2_git/build/local/bin/pkg-config\nchecking pkg-config is at least version 0.9.0... yes\nchecking for FFLAS_FFPACK... no\nconfigure: error: Package requirements (fflas-ffpack >= 2.4.0) were not met:\nPackage fflas-ffpack was not found in the pkg-config search path.\nPerhaps you should add the directory containing `fflas-ffpack.pc'\nto the PKG_CONFIG_PATH environment variable\nPackage 'fflas-ffpack', required by 'world', not found\nConsider adjusting the PKG_CONFIG_PATH environment variable if you\ninstalled software in a non-standard prefix.\nAlternatively, you may set the environment variables FFLAS_FFPACK_CFLAGS\nand FFLAS_FFPACK_LIBS to avoid the need to call pkg-config.\nSee the pkg-config man page for more details.\n********************************************************************************\n```",
    "created_at": "2020-03-07T21:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559735",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>
This breaks linbox on fresh builds:

```
-----------------------------------------------
Default path = /var/lib/buildbot/slave/sage2_git/build/local /usr /usr/local 
checking whether to compile the drivers... no
-----------------------------------------------
checking for pkg-config... /var/lib/buildbot/slave/sage2_git/build/local/bin/pkg-config
checking pkg-config is at least version 0.9.0... yes
checking for FFLAS_FFPACK... no
configure: error: Package requirements (fflas-ffpack >= 2.4.0) were not met:
Package fflas-ffpack was not found in the pkg-config search path.
Perhaps you should add the directory containing `fflas-ffpack.pc'
to the PKG_CONFIG_PATH environment variable
Package 'fflas-ffpack', required by 'world', not found
Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.
Alternatively, you may set the environment variables FFLAS_FFPACK_CFLAGS
and FFLAS_FFPACK_LIBS to avoid the need to call pkg-config.
See the pkg-config man page for more details.
********************************************************************************
```



---

archive/issue_comments_559736.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-03-07T21:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559736",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_091217.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-07T21:18:21Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29102#event-91217"
}
```



---

archive/issue_comments_559737.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2020-03-07T21:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559737",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_559738.json:
```json
{
    "body": "Changing commit from \"f6870ed273ec12224f3dcb34f273ce2b2fe5097e\" to \"\"",
    "created_at": "2020-03-07T21:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559738",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "f6870ed273ec12224f3dcb34f273ce2b2fe5097e" to ""



---

archive/issue_comments_559739.json:
```json
{
    "body": "<a id='comment:27'></a>\nOn what system?",
    "created_at": "2020-03-07T21:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559739",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
On what system?



---

archive/issue_comments_559740.json:
```json
{
    "body": "<a id='comment:28'></a>\nFull log please",
    "created_at": "2020-03-07T21:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559740",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Full log please



---

archive/issue_comments_559741.json:
```json
{
    "body": "Changing branch from \"f6870ed273ec12224f3dcb34f273ce2b2fe5097e\" to \"u/mkoeppe/f6870ed273ec12224f3dcb34f273ce2b2fe5097e\"",
    "created_at": "2020-03-09T01:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559741",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "f6870ed273ec12224f3dcb34f273ce2b2fe5097e" to "u/mkoeppe/f6870ed273ec12224f3dcb34f273ce2b2fe5097e"



---

archive/issue_comments_559742.json:
```json
{
    "body": "Changing commit from \"\" to \"24192eb55748a6b70d68d13552bcdbe0f20dab28\"",
    "created_at": "2020-03-09T01:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559742",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "24192eb55748a6b70d68d13552bcdbe0f20dab28"



---

archive/issue_comments_559743.json:
```json
{
    "body": "<a id='comment:30'></a>\nTests at https://github.com/mkoeppe/sage/actions/runs/51973394\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|\n|[1cce764](https://github.com/sagemath/sagetrac-mirror/commit/1cce764e78fccc709ce14d8702e9519a032e372c)|`build/pkgs/fflas_ffpack: Disable arch flags that are not supported by the compiler`|\n|[82509d1](https://github.com/sagemath/sagetrac-mirror/commit/82509d123567c0d653b17cbb1878585222c3b3d8)|`Add AC_SUBST`|\n|[e0b620e](https://github.com/sagemath/sagetrac-mirror/commit/e0b620e43858a1af3eb4d67a80daeaaa7703b686)|`fixup`|\n|[946a321](https://github.com/sagemath/sagetrac-mirror/commit/946a321a4e738e64453aec8d81d6da98e4f792d1)|`Fixup quoting`|\n|[5d47aae](https://github.com/sagemath/sagetrac-mirror/commit/5d47aae3431f711b3ccba0bdfddf198acf18dc19)|`Merge branch 't/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|\n|[e17c0a5](https://github.com/sagemath/sagetrac-mirror/commit/e17c0a5ee7d801c560657430480822fa8db47537)|`build/pkgs/fflas_ffpack/spkg-configure.m4: Disable all avx512 variants if the compiler does not support all of them`|\n|[5ead72f](https://github.com/sagemath/sagetrac-mirror/commit/5ead72fc3369b85f03445593732c103c363f811b)|`Merge branch 't/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|\n|[f6870ed](https://github.com/sagemath/sagetrac-mirror/commit/f6870ed273ec12224f3dcb34f273ce2b2fe5097e)|`Merge tag '9.1.beta6' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|\n|[24192eb](https://github.com/sagemath/sagetrac-mirror/commit/24192eb55748a6b70d68d13552bcdbe0f20dab28)|`Merge tag '9.1.beta7' into t/29102/f6870ed273ec12224f3dcb34f273ce2b2fe5097e`|",
    "created_at": "2020-03-09T01:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559743",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Tests at https://github.com/mkoeppe/sage/actions/runs/51973394

---
New commits:
|                                                                                                                                          |                                                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|
|[1cce764](https://github.com/sagemath/sagetrac-mirror/commit/1cce764e78fccc709ce14d8702e9519a032e372c)|`build/pkgs/fflas_ffpack: Disable arch flags that are not supported by the compiler`|
|[82509d1](https://github.com/sagemath/sagetrac-mirror/commit/82509d123567c0d653b17cbb1878585222c3b3d8)|`Add AC_SUBST`|
|[e0b620e](https://github.com/sagemath/sagetrac-mirror/commit/e0b620e43858a1af3eb4d67a80daeaaa7703b686)|`fixup`|
|[946a321](https://github.com/sagemath/sagetrac-mirror/commit/946a321a4e738e64453aec8d81d6da98e4f792d1)|`Fixup quoting`|
|[5d47aae](https://github.com/sagemath/sagetrac-mirror/commit/5d47aae3431f711b3ccba0bdfddf198acf18dc19)|`Merge branch 't/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|
|[e17c0a5](https://github.com/sagemath/sagetrac-mirror/commit/e17c0a5ee7d801c560657430480822fa8db47537)|`build/pkgs/fflas_ffpack/spkg-configure.m4: Disable all avx512 variants if the compiler does not support all of them`|
|[5ead72f](https://github.com/sagemath/sagetrac-mirror/commit/5ead72fc3369b85f03445593732c103c363f811b)|`Merge branch 't/29052/create_build_bin_sage_build_env_and_call_it_from_build_make_deps__add_sage___buildsh' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|
|[f6870ed](https://github.com/sagemath/sagetrac-mirror/commit/f6870ed273ec12224f3dcb34f273ce2b2fe5097e)|`Merge tag '9.1.beta6' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|
|[24192eb](https://github.com/sagemath/sagetrac-mirror/commit/24192eb55748a6b70d68d13552bcdbe0f20dab28)|`Merge tag '9.1.beta7' into t/29102/f6870ed273ec12224f3dcb34f273ce2b2fe5097e`|



---

archive/issue_comments_559744.json:
```json
{
    "body": "<a id='comment:31'></a>\nOK, I can reproduce the build error on `centos-8-standard`(https://github.com/mkoeppe/sage/runs/494058924, https://github.com/mkoeppe/sage/suites/507443973/artifacts/2680774)",
    "created_at": "2020-03-09T15:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559744",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
OK, I can reproduce the build error on `centos-8-standard`(https://github.com/mkoeppe/sage/runs/494058924, https://github.com/mkoeppe/sage/suites/507443973/artifacts/2680774)



---

archive/issue_comments_559745.json:
```json
{
    "body": "Changing commit from \"24192eb55748a6b70d68d13552bcdbe0f20dab28\" to \"d0ac900e817536744a756dea0f08ddbdb0e38e5a\"",
    "created_at": "2020-03-09T19:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "24192eb55748a6b70d68d13552bcdbe0f20dab28" to "d0ac900e817536744a756dea0f08ddbdb0e38e5a"



---

archive/issue_comments_559746.json:
```json
{
    "body": "<a id='comment:32'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|\n|[3863984](https://github.com/sagemath/sagetrac-mirror/commit/3863984ea963b4101583659999498e43748cddbb)|`build/pkgs/fflas_ffpack/spkg-configure.m4: Set sage_spkg_install_fflas_ffpack=yes`|\n|[d0ac900](https://github.com/sagemath/sagetrac-mirror/commit/d0ac900e817536744a756dea0f08ddbdb0e38e5a)|`Merge tag '9.1.beta7' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|",
    "created_at": "2020-03-09T19:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559746",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
|[3863984](https://github.com/sagemath/sagetrac-mirror/commit/3863984ea963b4101583659999498e43748cddbb)|`build/pkgs/fflas_ffpack/spkg-configure.m4: Set sage_spkg_install_fflas_ffpack=yes`|
|[d0ac900](https://github.com/sagemath/sagetrac-mirror/commit/d0ac900e817536744a756dea0f08ddbdb0e38e5a)|`Merge tag '9.1.beta7' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|



---

archive/issue_comments_559747.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-09T19:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559747",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_559748.json:
```json
{
    "body": "<a id='comment:34'></a>\n`@`vbraun Let's get this into the next beta please",
    "created_at": "2020-03-12T00:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559748",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
`@`vbraun Let's get this into the next beta please



---

archive/issue_comments_559749.json:
```json
{
    "body": "<a id='comment:35'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[be3c581](https://github.com/sagemath/sagetrac-mirror/commit/be3c581869e78a31f51d44511461f06d5aafe1d8)|`Configure ARB_LIBRARY through sage_conf`|\n|[dcd755a](https://github.com/sagemath/sagetrac-mirror/commit/dcd755a741a2edc46683cfedb67de54cffec880f)|`cosmetic change`|\n|[d141b19](https://github.com/sagemath/sagetrac-mirror/commit/d141b1961b46c9f0ab671e4049e199a6a0196e5f)|`Merge branch 't/29305/move_arb_library_back_from_sage_build_env_config_to_sage_env_config' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|",
    "created_at": "2020-03-15T23:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[be3c581](https://github.com/sagemath/sagetrac-mirror/commit/be3c581869e78a31f51d44511461f06d5aafe1d8)|`Configure ARB_LIBRARY through sage_conf`|
|[dcd755a](https://github.com/sagemath/sagetrac-mirror/commit/dcd755a741a2edc46683cfedb67de54cffec880f)|`cosmetic change`|
|[d141b19](https://github.com/sagemath/sagetrac-mirror/commit/d141b1961b46c9f0ab671e4049e199a6a0196e5f)|`Merge branch 't/29305/move_arb_library_back_from_sage_build_env_config_to_sage_env_config' into t/29102/fflas_ffpack_installation_error_on_new_cpus_with_old_compilers`|



---

archive/issue_comments_559750.json:
```json
{
    "body": "Changing commit from \"d0ac900e817536744a756dea0f08ddbdb0e38e5a\" to \"d141b1961b46c9f0ab671e4049e199a6a0196e5f\"",
    "created_at": "2020-03-15T23:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559750",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d0ac900e817536744a756dea0f08ddbdb0e38e5a" to "d141b1961b46c9f0ab671e4049e199a6a0196e5f"



---

archive/issue_comments_559751.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29305\"",
    "created_at": "2020-03-15T23:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559751",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29305"



---

archive/issue_comments_559752.json:
```json
{
    "body": "<a id='comment:37'></a>\nMerged #29305 to resolve a potential merge conflict",
    "created_at": "2020-03-15T23:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559752",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
Merged #29305 to resolve a potential merge conflict



---

archive/issue_comments_559753.json:
```json
{
    "body": "Changing commit from \"d141b1961b46c9f0ab671e4049e199a6a0196e5f\" to \"d2f726ab38d4a737112d49ea35a743328afb73b7\"",
    "created_at": "2020-03-19T00:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d141b1961b46c9f0ab671e4049e199a6a0196e5f" to "d2f726ab38d4a737112d49ea35a743328afb73b7"



---

archive/issue_comments_559754.json:
```json
{
    "body": "<a id='comment:38'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|\n|[d2f726a](https://github.com/sagemath/sagetrac-mirror/commit/d2f726ab38d4a737112d49ea35a743328afb73b7)|`build/pkgs/fflas_ffpack: Disable arch flags that are not supported by the compiler`|",
    "created_at": "2020-03-19T00:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|
|[d2f726a](https://github.com/sagemath/sagetrac-mirror/commit/d2f726ab38d4a737112d49ea35a743328afb73b7)|`build/pkgs/fflas_ffpack: Disable arch flags that are not supported by the compiler`|



---

archive/issue_comments_559755.json:
```json
{
    "body": "Changing dependencies from \"#29305\" to \"\"",
    "created_at": "2020-03-19T00:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559755",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29305" to ""



---

archive/issue_comments_559756.json:
```json
{
    "body": "<a id='comment:39'></a>\nRebased/squashed on 9.1.beta8, needs review",
    "created_at": "2020-03-19T00:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559756",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
Rebased/squashed on 9.1.beta8, needs review



---

archive/issue_comments_559757.json:
```json
{
    "body": "<a id='comment:41'></a>\nAnyone interested in completing the review of this ticket? As noted many times in sage-release, most recently in https://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on major platforms: ubuntu-trusty-minimal/standard, debian-jessie-standard, centos-7-minimal/standard.",
    "created_at": "2020-03-21T13:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559757",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Anyone interested in completing the review of this ticket? As noted many times in sage-release, most recently in https://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on major platforms: ubuntu-trusty-minimal/standard, debian-jessie-standard, centos-7-minimal/standard.



---

archive/issue_comments_559758.json:
```json
{
    "body": "<a id='comment:42'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/60291174",
    "created_at": "2020-03-21T13:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559758",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/60291174



---

archive/issue_comments_559759.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,10 @@\n \n See `ubuntu-trusty-minimal` run at \u200bhttps://github.com/mkoeppe/sage/runs/414021553\n \n-In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. \n+As noted in \u200bhttps://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on other major platforms: `ubuntu-trusty-standard`, `debian-jessie-standard`, `centos-7-minimal/standard`.\n+\n+\n+In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. (Because of bugs in fflas_ffpack's configuration scripts, the flags for individual AVX512 variants are not handled individually.)\n \n (Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)\n \n``````\n",
    "created_at": "2020-03-21T13:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559759",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,10 @@
 
 See `ubuntu-trusty-minimal` run at ​https://github.com/mkoeppe/sage/runs/414021553
 
-In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. 
+As noted in ​https://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on other major platforms: `ubuntu-trusty-standard`, `debian-jessie-standard`, `centos-7-minimal/standard`.
+
+
+In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. (Because of bugs in fflas_ffpack's configuration scripts, the flags for individual AVX512 variants are not handled individually.)
 
 (Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)
 
``````




---

archive/issue_comments_559760.json:
```json
{
    "body": "<a id='comment:43'></a>\nThe tests are done. Needs review.",
    "created_at": "2020-03-22T02:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559760",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
The tests are done. Needs review.



---

archive/issue_comments_559761.json:
```json
{
    "body": "<a id='comment:44'></a>\nAll tests fail. E.g. Debian tests fail due to `cannot find -larb` thing - perhaps this should be rebased on top of the corresponding ticket? \n\nFedora builds fail due to the inability to build numpy, probably related to *blas.pc issue.",
    "created_at": "2020-03-22T02:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559761",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>
All tests fail. E.g. Debian tests fail due to `cannot find -larb` thing - perhaps this should be rebased on top of the corresponding ticket? 

Fedora builds fail due to the inability to build numpy, probably related to *blas.pc issue.



---

archive/issue_comments_559762.json:
```json
{
    "body": "<a id='comment:45'></a>\nYes, they fail - because of unrelated issues. What is important is that the fflas_ffpack failures are gone!",
    "created_at": "2020-03-22T03:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559762",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
Yes, they fail - because of unrelated issues. What is important is that the fflas_ffpack failures are gone!



---

archive/issue_comments_559763.json:
```json
{
    "body": "<a id='comment:46'></a>\nFor example, if you look at `ubuntu-trusty-minimal`, which had an fflas_ffpack failure, this now builds Sage correctly (https://github.com/mkoeppe/sage/runs/524022952) and runs its test suite:\n\n```\nsage -t src/sage/manifolds/differentiable/degenerate_submanifold.py  # Timed out\nsage -t src/sage/manifolds/differentiable/euclidean.py  # Timed out\nsage -t src/sage/manifolds/differentiable/metric.py  # Timed out\nsage -t src/sage/manifolds/differentiable/tensorfield.py  # Timed out\nsage -t src/sage/plot/plot.py  # Timed out\nsage -t src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed\nsage -t src/sage/rings/function_field/function_field.py  # Timed out\nsage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out\n```",
    "created_at": "2020-03-22T03:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559763",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>
For example, if you look at `ubuntu-trusty-minimal`, which had an fflas_ffpack failure, this now builds Sage correctly (https://github.com/mkoeppe/sage/runs/524022952) and runs its test suite:

```
sage -t src/sage/manifolds/differentiable/degenerate_submanifold.py  # Timed out
sage -t src/sage/manifolds/differentiable/euclidean.py  # Timed out
sage -t src/sage/manifolds/differentiable/metric.py  # Timed out
sage -t src/sage/manifolds/differentiable/tensorfield.py  # Timed out
sage -t src/sage/plot/plot.py  # Timed out
sage -t src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed
sage -t src/sage/rings/function_field/function_field.py  # Timed out
sage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out
```



---

archive/issue_comments_559764.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-22T06:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559764",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_559765.json:
```json
{
    "body": "Changing reviewer from \"Volker Braun\" to \"Volker Braun, Dima Pasechnik\"",
    "created_at": "2020-03-22T06:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559765",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "Volker Braun" to "Volker Braun, Dima Pasechnik"



---

archive/issue_comments_559766.json:
```json
{
    "body": "<a id='comment:48'></a>\nThank you!",
    "created_at": "2020-03-22T09:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559766",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
Thank you!



---

archive/issue_comments_559767.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/f6870ed273ec12224f3dcb34f273ce2b2fe5097e\" to \"d2f726ab38d4a737112d49ea35a743328afb73b7\"",
    "created_at": "2020-03-25T22:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559767",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/f6870ed273ec12224f3dcb34f273ce2b2fe5097e" to "d2f726ab38d4a737112d49ea35a743328afb73b7"



---

archive/issue_events_091218.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-25T22:48:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29102#event-91218"
}
```



---

archive/issue_comments_559768.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-25T22:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-559768",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
