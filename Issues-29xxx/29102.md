# Issue 29102: fflas_ffpack installation error on new CPUs with old compilers

archive/issues_028865.json:
```json
{
    "body": "As observed in #29084, \u200bfflas_ffpack compilation fails on a processor that supports AVX512 extensions with the default compiler on Ubuntu Trusty - gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.4).\n\nSee `ubuntu-trusty-minimal` run at \u200bhttps://github.com/mkoeppe/sage/runs/414021553\n\nAs noted in \u200bhttps://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on other major platforms: `ubuntu-trusty-standard`, `debian-jessie-standard`, `centos-7-minimal/standard`.\n\n\nIn this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. (Because of bugs in fflas_ffpack's configuration scripts, the flags for individual AVX512 variants are not handled individually.)\n\n(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)\n\nRelated upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184\n\n\n\nCC:  @dimpase @antonio-rojas @timokau @kiwifb @vbraun tmonteil\n\nBranch/Commit: d2f726ab38d4a737112d49ea35a743328afb73b7\n\nReviewer: Volker Braun, Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29102\n\n",
    "closed_at": "2020-03-25T22:48:53Z",
    "created_at": "2020-01-29T15:18:33Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "fflas_ffpack installation error on new CPUs with old compilers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29102",
    "user": "https://github.com/mkoeppe"
}
```
As observed in #29084, ​fflas_ffpack compilation fails on a processor that supports AVX512 extensions with the default compiler on Ubuntu Trusty - gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.4).

See `ubuntu-trusty-minimal` run at ​https://github.com/mkoeppe/sage/runs/414021553

As noted in ​https://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on other major platforms: `ubuntu-trusty-standard`, `debian-jessie-standard`, `centos-7-minimal/standard`.


In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the `configure` script of `fflas_ffpack`. (Because of bugs in fflas_ffpack's configuration scripts, the flags for individual AVX512 variants are not handled individually.)

(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)

Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184



CC:  @dimpase @antonio-rojas @timokau @kiwifb @vbraun tmonteil

Branch/Commit: d2f726ab38d4a737112d49ea35a743328afb73b7

Reviewer: Volker Braun, Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29102





---

archive/issue_comments_434736.json:
```json
{
    "body": "<a id='comment:1'></a>See also this thread on [sage-release](https://groups.google.com/d/msg/sage-release/x13Ug2AXNdE/0thZC21OFAAJ).",
    "created_at": "2020-01-29T17:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434736",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>See also this thread on [sage-release](https://groups.google.com/d/msg/sage-release/x13Ug2AXNdE/0thZC21OFAAJ).



---

archive/issue_comments_434737.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-06T21:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434737",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_434738.json:
```json
{
    "body": "<a id='comment:4'></a>Tests run at https://github.com/mkoeppe/sage/actions/runs/35630769\n\n---\nNew commits:",
    "created_at": "2020-02-06T21:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434738",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Tests run at https://github.com/mkoeppe/sage/actions/runs/35630769

---
New commits:



---

archive/issue_comments_434739.json:
```json
{
    "body": "<a id='comment:5'></a>Are those the only options not supported by gcc-4.8.2? My first thought was testing only those flags, and not stuff like `sse4`.",
    "created_at": "2020-02-06T21:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434739",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Are those the only options not supported by gcc-4.8.2? My first thought was testing only those flags, and not stuff like `sse4`.



---

archive/issue_comments_434740.json:
```json
{
    "body": "<a id='comment:6'></a>I only took care of the `-mavx512*` flags because I knew that gcc-4.8.4 (as on Ubuntu trusty) does not have them. I threw in -mfma, -mfma4 because I was not familiar with them (though 4.8.4 supports them). All other flags are ancient and they are supported by 4.8.4.",
    "created_at": "2020-02-06T21:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434740",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>I only took care of the `-mavx512*` flags because I knew that gcc-4.8.4 (as on Ubuntu trusty) does not have them. I threw in -mfma, -mfma4 because I was not familiar with them (though 4.8.4 supports them). All other flags are ancient and they are supported by 4.8.4.



---

archive/issue_comments_434741.json:
```json
{
    "body": "<a id='comment:7'></a>Looks good to me then, but I cannot review the commits from the dependencies. If they are OK, I agree with the stuff that specifically is here.",
    "created_at": "2020-02-06T21:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434741",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>Looks good to me then, but I cannot review the commits from the dependencies. If they are OK, I agree with the stuff that specifically is here.



---

archive/issue_comments_434742.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-06T21:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434742",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434743.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -5,7 +5,11 @@\n \\`fflas_ffpack\\` configuration should check that the compiler actually supports the architecture flags that it wants to use.\n \n It should be checked whether upstream has a fix for this.\n-Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284\n+Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).\n+\n+Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184\n+\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2020-02-06T22:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434743",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -5,7 +5,11 @@
 \`fflas_ffpack\` configuration should check that the compiler actually supports the architecture flags that it wants to use.
 
 It should be checked whether upstream has a fix for this.
-Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284
+Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).
+
+Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184
+
+
 
 Comment: 1
 
```




---

archive/issue_comments_434744.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-07T03:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434744",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434745.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-08T03:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434746.json:
```json
{
    "body": "<a id='comment:12'></a>This now actually works and fixes installation on `ubuntu-trusty-minimal` (https://github.com/mkoeppe/sage/runs/432608426?check_suite_focus=true).\n\nBut with this fix there's an error on `debian-jessie-standard` https://github.com/mkoeppe/sage/runs/432608838?check_suite_focus=true\nHere the compiler supports only one of the avx512 flags.",
    "created_at": "2020-02-08T04:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434746",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>This now actually works and fixes installation on `ubuntu-trusty-minimal` (https://github.com/mkoeppe/sage/runs/432608426?check_suite_focus=true).

But with this fix there's an error on `debian-jessie-standard` https://github.com/mkoeppe/sage/runs/432608838?check_suite_focus=true
Here the compiler supports only one of the avx512 flags.



---

archive/issue_comments_434747.json:
```json
{
    "body": "<a id='comment:13'></a>I'd just drop jessie, it's too much hassle to go to for something with EOL in 5 months\nhttps://wiki.debian.org/LTS/Jessie",
    "created_at": "2020-02-08T09:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434747",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>I'd just drop jessie, it's too much hassle to go to for something with EOL in 5 months
https://wiki.debian.org/LTS/Jessie



---

archive/issue_comments_434748.json:
```json
{
    "body": "<a id='comment:14'></a>I don't think this is how we should think about it. Shouldn't we rather be increasing the minimum accepted gcc version, and install our own gcc if too old?",
    "created_at": "2020-02-08T22:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434748",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>I don't think this is how we should think about it. Shouldn't we rather be increasing the minimum accepted gcc version, and install our own gcc if too old?



---

archive/issue_comments_434749.json:
```json
{
    "body": "<a id='comment:15'></a>Well, it's possible, but newer gcc might not even get built with that old gcc.",
    "created_at": "2020-02-08T23:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434749",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>Well, it's possible, but newer gcc might not even get built with that old gcc.



---

archive/issue_comments_434750.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-24T07:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434750",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434751.json:
```json
{
    "body": "<a id='comment:17'></a>Now this is more robust and also works on `debian-jessie-standard`.\n\nSee https://github.com/mkoeppe/sage/actions/runs/44043380",
    "created_at": "2020-02-24T07:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434751",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Now this is more robust and also works on `debian-jessie-standard`.

See https://github.com/mkoeppe/sage/actions/runs/44043380



---

archive/issue_comments_434752.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+As observed in #29084, \u200bfflas_ffpack compilation fails on a processor that supports AVX512 extensions with the default compiler on Ubuntu Trusty - gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.4).\n+\n+See \\`ubuntu-trusty-minimal\\` run at \u200bhttps://github.com/mkoeppe/sage/runs/414021553\n+\n+In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the \\`configure\\` script of \\`fflas_ffpack\\`. \n+\n+(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)\n+\n+Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-02-24T07:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434752",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,13 @@
+As observed in #29084, ​fflas_ffpack compilation fails on a processor that supports AVX512 extensions with the default compiler on Ubuntu Trusty - gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.4).
+
+See \`ubuntu-trusty-minimal\` run at ​https://github.com/mkoeppe/sage/runs/414021553
+
+In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the \`configure\` script of \`fflas_ffpack\`. 
+
+(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)
+
+Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184
+
 
 
 Comment: 1
```




---

archive/issue_comments_434753.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-27T04:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434754.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-02T01:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434755.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-02T23:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434755",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_434756.json:
```json
{
    "body": "<a id='comment:24'></a>Thanks!",
    "created_at": "2020-03-02T23:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434756",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Thanks!



---

archive/issue_comments_434757.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-03T23:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434757",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_073812.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-03T23:21:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29102#event-73812"
}
```



---

archive/issue_comments_434758.json:
```json
{
    "body": "<a id='comment:26'></a>This breaks linbox on fresh builds:\n\n```\n-----------------------------------------------\nDefault path = /var/lib/buildbot/slave/sage2_git/build/local /usr /usr/local \nchecking whether to compile the drivers... no\n-----------------------------------------------\nchecking for pkg-config... /var/lib/buildbot/slave/sage2_git/build/local/bin/pkg-config\nchecking pkg-config is at least version 0.9.0... yes\nchecking for FFLAS_FFPACK... no\nconfigure: error: Package requirements (fflas-ffpack >= 2.4.0) were not met:\nPackage fflas-ffpack was not found in the pkg-config search path.\nPerhaps you should add the directory containing `fflas-ffpack.pc'\nto the PKG_CONFIG_PATH environment variable\nPackage 'fflas-ffpack', required by 'world', not found\nConsider adjusting the PKG_CONFIG_PATH environment variable if you\ninstalled software in a non-standard prefix.\nAlternatively, you may set the environment variables FFLAS_FFPACK_CFLAGS\nand FFLAS_FFPACK_LIBS to avoid the need to call pkg-config.\nSee the pkg-config man page for more details.\n********************************************************************************\n```",
    "created_at": "2020-03-07T21:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434758",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>This breaks linbox on fresh builds:

```
-----------------------------------------------
Default path = /var/lib/buildbot/slave/sage2_git/build/local /usr /usr/local 
checking whether to compile the drivers... no
-----------------------------------------------
checking for pkg-config... /var/lib/buildbot/slave/sage2_git/build/local/bin/pkg-config
checking pkg-config is at least version 0.9.0... yes
checking for FFLAS_FFPACK... no
configure: error: Package requirements (fflas-ffpack >= 2.4.0) were not met:
Package fflas-ffpack was not found in the pkg-config search path.
Perhaps you should add the directory containing `fflas-ffpack.pc'
to the PKG_CONFIG_PATH environment variable
Package 'fflas-ffpack', required by 'world', not found
Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.
Alternatively, you may set the environment variables FFLAS_FFPACK_CFLAGS
and FFLAS_FFPACK_LIBS to avoid the need to call pkg-config.
See the pkg-config man page for more details.
********************************************************************************
```



---

archive/issue_comments_434759.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-03-07T21:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434759",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_073813.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-07T21:18:21Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29102#event-73813"
}
```



---

archive/issue_comments_434760.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2020-03-07T21:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434760",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_434761.json:
```json
{
    "body": "<a id='comment:27'></a>On what system?",
    "created_at": "2020-03-07T21:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434761",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>On what system?



---

archive/issue_comments_434762.json:
```json
{
    "body": "<a id='comment:28'></a>Full log please",
    "created_at": "2020-03-07T21:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434762",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Full log please



---

archive/issue_comments_434763.json:
```json
{
    "body": "<a id='comment:30'></a>Tests at https://github.com/mkoeppe/sage/actions/runs/51973394\n\n---\nNew commits:",
    "created_at": "2020-03-09T01:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434763",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>Tests at https://github.com/mkoeppe/sage/actions/runs/51973394

---
New commits:



---

archive/issue_comments_434764.json:
```json
{
    "body": "<a id='comment:31'></a>OK, I can reproduce the build error on `centos-8-standard`(https://github.com/mkoeppe/sage/runs/494058924, https://github.com/mkoeppe/sage/suites/507443973/artifacts/2680774)",
    "created_at": "2020-03-09T15:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434764",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>OK, I can reproduce the build error on `centos-8-standard`(https://github.com/mkoeppe/sage/runs/494058924, https://github.com/mkoeppe/sage/suites/507443973/artifacts/2680774)



---

archive/issue_comments_434765.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-09T19:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434765",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_434766.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-09T19:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434766",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_434767.json:
```json
{
    "body": "<a id='comment:34'></a>`@`vbraun Let's get this into the next beta please",
    "created_at": "2020-03-12T00:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434767",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>`@`vbraun Let's get this into the next beta please



---

archive/issue_comments_434768.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T23:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434769.json:
```json
{
    "body": "<a id='comment:37'></a>Merged #29305 to resolve a potential merge conflict",
    "created_at": "2020-03-15T23:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434769",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>Merged #29305 to resolve a potential merge conflict



---

archive/issue_comments_434770.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-19T00:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_434771.json:
```json
{
    "body": "<a id='comment:39'></a>Rebased/squashed on 9.1.beta8, needs review",
    "created_at": "2020-03-19T00:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434771",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>Rebased/squashed on 9.1.beta8, needs review



---

archive/issue_comments_434772.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-03-21T13:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434772",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_434773.json:
```json
{
    "body": "<a id='comment:41'></a>Anyone interested in completing the review of this ticket? As noted many times in sage-release, most recently in https://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on major platforms: ubuntu-trusty-minimal/standard, debian-jessie-standard, centos-7-minimal/standard.",
    "created_at": "2020-03-21T13:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434773",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>Anyone interested in completing the review of this ticket? As noted many times in sage-release, most recently in https://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on major platforms: ubuntu-trusty-minimal/standard, debian-jessie-standard, centos-7-minimal/standard.



---

archive/issue_comments_434774.json:
```json
{
    "body": "<a id='comment:42'></a>Tests run at https://github.com/mkoeppe/sage/actions/runs/60291174",
    "created_at": "2020-03-21T13:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434774",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>Tests run at https://github.com/mkoeppe/sage/actions/runs/60291174



---

archive/issue_comments_434775.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,16 @@\n+As observed in #29084, \u200bfflas_ffpack compilation fails on a processor that supports AVX512 extensions with the default compiler on Ubuntu Trusty - gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.4).\n+\n+See \\`ubuntu-trusty-minimal\\` run at \u200bhttps://github.com/mkoeppe/sage/runs/414021553\n+\n+As noted in \u200bhttps://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on other major platforms: \\`ubuntu-trusty-standard\\`, \\`debian-jessie-standard\\`, \\`centos-7-minimal/standard\\`.\n+\n+\n+In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the \\`configure\\` script of \\`fflas_ffpack\\`. (Because of bugs in fflas_ffpack's configuration scripts, the flags for individual AVX512 variants are not handled individually.)\n+\n+(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)\n+\n+Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-03-21T13:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434775",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,16 @@
+As observed in #29084, ​fflas_ffpack compilation fails on a processor that supports AVX512 extensions with the default compiler on Ubuntu Trusty - gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.4).
+
+See \`ubuntu-trusty-minimal\` run at ​https://github.com/mkoeppe/sage/runs/414021553
+
+As noted in ​https://groups.google.com/d/msg/sage-release/eMQIlhglN98/bTwDGD9HBQAJ, this problem prevents Sage from build on other major platforms: \`ubuntu-trusty-standard\`, \`debian-jessie-standard\`, \`centos-7-minimal/standard\`.
+
+
+In this ticket, we check which architecture flags are supported by the compiler, and disable the unsupported ones by passing options to the \`configure\` script of \`fflas_ffpack\`. (Because of bugs in fflas_ffpack's configuration scripts, the flags for individual AVX512 variants are not handled individually.)
+
+(Upstream indicates that they plan configuration changes in the longer term to address similar issues. Not the same upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/284 (that's #29161).)
+
+Related upstream issue: https://github.com/linbox-team/fflas-ffpack/issues/184
+
 
 
 Comment: 1
```




---

archive/issue_comments_434776.json:
```json
{
    "body": "<a id='comment:43'></a>The tests are done. Needs review.",
    "created_at": "2020-03-22T02:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434776",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>The tests are done. Needs review.



---

archive/issue_comments_434777.json:
```json
{
    "body": "<a id='comment:44'></a>All tests fail. E.g. Debian tests fail due to `cannot find -larb` thing - perhaps this should be rebased on top of the corresponding ticket? \n\nFedora builds fail due to the inability to build numpy, probably related to *blas.pc issue.",
    "created_at": "2020-03-22T02:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434777",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>All tests fail. E.g. Debian tests fail due to `cannot find -larb` thing - perhaps this should be rebased on top of the corresponding ticket? 

Fedora builds fail due to the inability to build numpy, probably related to *blas.pc issue.



---

archive/issue_comments_434778.json:
```json
{
    "body": "<a id='comment:45'></a>Yes, they fail - because of unrelated issues. What is important is that the fflas_ffpack failures are gone!",
    "created_at": "2020-03-22T03:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434778",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>Yes, they fail - because of unrelated issues. What is important is that the fflas_ffpack failures are gone!



---

archive/issue_comments_434779.json:
```json
{
    "body": "<a id='comment:46'></a>For example, if you look at `ubuntu-trusty-minimal`, which had an fflas_ffpack failure, this now builds Sage correctly (https://github.com/mkoeppe/sage/runs/524022952) and runs its test suite:\n\n```\nsage -t src/sage/manifolds/differentiable/degenerate_submanifold.py  # Timed out\nsage -t src/sage/manifolds/differentiable/euclidean.py  # Timed out\nsage -t src/sage/manifolds/differentiable/metric.py  # Timed out\nsage -t src/sage/manifolds/differentiable/tensorfield.py  # Timed out\nsage -t src/sage/plot/plot.py  # Timed out\nsage -t src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed\nsage -t src/sage/rings/function_field/function_field.py  # Timed out\nsage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out\n```",
    "created_at": "2020-03-22T03:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434779",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>For example, if you look at `ubuntu-trusty-minimal`, which had an fflas_ffpack failure, this now builds Sage correctly (https://github.com/mkoeppe/sage/runs/524022952) and runs its test suite:

```
sage -t src/sage/manifolds/differentiable/degenerate_submanifold.py  # Timed out
sage -t src/sage/manifolds/differentiable/euclidean.py  # Timed out
sage -t src/sage/manifolds/differentiable/metric.py  # Timed out
sage -t src/sage/manifolds/differentiable/tensorfield.py  # Timed out
sage -t src/sage/plot/plot.py  # Timed out
sage -t src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed
sage -t src/sage/rings/function_field/function_field.py  # Timed out
sage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out
```



---

archive/issue_comments_434780.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-22T06:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434780",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_434781.json:
```json
{
    "body": "<a id='comment:48'></a>Thank you!",
    "created_at": "2020-03-22T09:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434781",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>Thank you!



---

archive/issue_events_073814.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-25T22:48:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29102#event-73814"
}
```



---

archive/issue_comments_434782.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-25T22:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29102#issuecomment-434782",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
