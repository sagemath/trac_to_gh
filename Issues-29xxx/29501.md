# Issue 29501: spkg-check.in: Do not use sdh_make to do 'make check', to avoid misleading messages

archive/issues_029264.json:
```json
{
    "body": "CC:  @dimpase @jhpalmieri @embray\n\n`sdh_make`, even when used for `make check`, prints the misleading message \"Error building $PKG_NAME\"\n\n```\n$ grep sdh_make build/pkgs/*/spkg-check.in\nbuild/pkgs/awali/spkg-check.in:sdh_make check\nbuild/pkgs/barvinok/spkg-check.in:sdh_make check\nbuild/pkgs/cocoalib/spkg-check.in:sdh_make check\nbuild/pkgs/e_antic/spkg-check.in:sdh_make check\nbuild/pkgs/fflas_ffpack/spkg-check.in:sdh_make check\nbuild/pkgs/isl/spkg-check.in:sdh_make check\nbuild/pkgs/openblas/spkg-check.in:sdh_make tests $OPENBLAS_CONFIGURE\nbuild/pkgs/openblas/spkg-check.in:        sdh_make tests $OPENBLAS_CONFIGURE\nbuild/pkgs/polylib/spkg-check.in:sdh_make check\nbuild/pkgs/polymake/spkg-check.in:sdh_make test\nbuild/pkgs/symengine/spkg-check.in:sdh_make test\nbuild/pkgs/tides/spkg-check.in:sdh_make check AM_CFLAGS=\"\" AM_FFLAGS=\"\"\n```\nIn the present ticket, we fix this. \n\n\n\nWe note that when `sdh_make` is used for building in `spkg-install.in`, there is duplication with a message printed by `sage-spkg` afterwards. For example in https://github.com/mkoeppe/sage/runs/581877049:\n\n```\n  [python3-3.7.3.p1]   TypeError: can only concatenate str (not \"NoneType\") to str\n  [python3-3.7.3.p1]   make[2]: *** [Makefile:626: sharedmods] Error 1\n  [python3-3.7.3.p1]   make[2]: Target 'all' not remade because of errors.\n  [python3-3.7.3.p1]   make[2]: Leaving directory '/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-minimal/local/var/tmp/sage/build/python3-3.7.3.p1/src'\n  [python3-3.7.3.p1]   ********************************************************************************\n  [python3-3.7.3.p1]   Error building python3-3.7.3.p1\n  [python3-3.7.3.p1]   ********************************************************************************\n  [python3-3.7.3.p1]   \n  [python3-3.7.3.p1]   real\t3m37.614s\n  [python3-3.7.3.p1]   user\t1m37.298s\n  [python3-3.7.3.p1]   sys\t0m11.320s\n  [python3-3.7.3.p1]   ************************************************************************\n  [python3-3.7.3.p1]   Error building package python3-3.7.3.p1\n  [python3-3.7.3.p1]   ************************************************************************\n  [python3-3.7.3.p1] Full log file: /home/runner/work/sage/sage/logs/pkgs/python3-3.7.3.p1.log\n```\nHowever, as this does not have the potential to mislead, we will take care of this on another ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29501\n\n",
    "closed_at": "2020-04-22T20:52:19Z",
    "created_at": "2020-04-13T02:57:50Z",
    "labels": [
        "component: build",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "spkg-check.in: Do not use sdh_make to do 'make check', to avoid misleading messages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29501",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @jhpalmieri @embray

`sdh_make`, even when used for `make check`, prints the misleading message "Error building $PKG_NAME"

```
$ grep sdh_make build/pkgs/*/spkg-check.in
build/pkgs/awali/spkg-check.in:sdh_make check
build/pkgs/barvinok/spkg-check.in:sdh_make check
build/pkgs/cocoalib/spkg-check.in:sdh_make check
build/pkgs/e_antic/spkg-check.in:sdh_make check
build/pkgs/fflas_ffpack/spkg-check.in:sdh_make check
build/pkgs/isl/spkg-check.in:sdh_make check
build/pkgs/openblas/spkg-check.in:sdh_make tests $OPENBLAS_CONFIGURE
build/pkgs/openblas/spkg-check.in:        sdh_make tests $OPENBLAS_CONFIGURE
build/pkgs/polylib/spkg-check.in:sdh_make check
build/pkgs/polymake/spkg-check.in:sdh_make test
build/pkgs/symengine/spkg-check.in:sdh_make test
build/pkgs/tides/spkg-check.in:sdh_make check AM_CFLAGS="" AM_FFLAGS=""
```
In the present ticket, we fix this. 



We note that when `sdh_make` is used for building in `spkg-install.in`, there is duplication with a message printed by `sage-spkg` afterwards. For example in https://github.com/mkoeppe/sage/runs/581877049:

```
  [python3-3.7.3.p1]   TypeError: can only concatenate str (not "NoneType") to str
  [python3-3.7.3.p1]   make[2]: *** [Makefile:626: sharedmods] Error 1
  [python3-3.7.3.p1]   make[2]: Target 'all' not remade because of errors.
  [python3-3.7.3.p1]   make[2]: Leaving directory '/home/runner/work/sage/sage/.tox/local-conda-forge-ubuntu-minimal/local/var/tmp/sage/build/python3-3.7.3.p1/src'
  [python3-3.7.3.p1]   ********************************************************************************
  [python3-3.7.3.p1]   Error building python3-3.7.3.p1
  [python3-3.7.3.p1]   ********************************************************************************
  [python3-3.7.3.p1]   
  [python3-3.7.3.p1]   real	3m37.614s
  [python3-3.7.3.p1]   user	1m37.298s
  [python3-3.7.3.p1]   sys	0m11.320s
  [python3-3.7.3.p1]   ************************************************************************
  [python3-3.7.3.p1]   Error building package python3-3.7.3.p1
  [python3-3.7.3.p1]   ************************************************************************
  [python3-3.7.3.p1] Full log file: /home/runner/work/sage/sage/logs/pkgs/python3-3.7.3.p1.log
```
However, as this does not have the potential to mislead, we will take care of this on another ticket.

Issue created by migration from https://trac.sagemath.org/ticket/29501





---

archive/issue_comments_414344.json:
```json
{
    "body": "Maybe just create a new function called `sdh_make_check` which is exactly the same as `sdh_make` but has a different error message. Or allow `sdh_make` to have an optional second argument, which defaults to \"building\".",
    "created_at": "2020-04-13T04:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414344",
    "user": "https://github.com/jhpalmieri"
}
```

Maybe just create a new function called `sdh_make_check` which is exactly the same as `sdh_make` but has a different error message. Or allow `sdh_make` to have an optional second argument, which defaults to "building".



---

archive/issue_comments_414345.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-04-13T17:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414345",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_414346.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-14T00:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414346",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_414347.json:
```json
{
    "body": "maybe, for uniformity, not `\"Failures checking $PKG_NAME\"`, but `\"Error checking $PKG_NAME\"`",
    "created_at": "2020-04-14T02:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414347",
    "user": "https://github.com/dimpase"
}
```

maybe, for uniformity, not `"Failures checking $PKG_NAME"`, but `"Error checking $PKG_NAME"`



---

archive/issue_comments_414348.json:
```json
{
    "body": "I worded it like this because if SAGE_CHECK=warn, then it is not an error but only a warning.",
    "created_at": "2020-04-15T19:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414348",
    "user": "https://github.com/mkoeppe"
}
```

I worded it like this because if SAGE_CHECK=warn, then it is not an error but only a warning.



---

archive/issue_comments_414349.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-18T05:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414350.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-18T18:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414350",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_414351.json:
```json
{
    "body": "rebased on top of #29510 to remove a merge conflict",
    "created_at": "2020-04-18T18:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414351",
    "user": "https://github.com/mkoeppe"
}
```

rebased on top of #29510 to remove a merge conflict



---

archive/issue_comments_414352.json:
```json
{
    "body": "needs review",
    "created_at": "2020-04-18T18:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414352",
    "user": "https://github.com/mkoeppe"
}
```

needs review



---

archive/issue_comments_414353.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-18T21:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414353",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414354.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2020-04-18T21:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414354",
    "user": "https://github.com/jhpalmieri"
}
```

Looks good to me.



---

archive/issue_comments_414355.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-04-18T21:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414355",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_comments_414356.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-22T20:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-414356",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_075236.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-22T20:52:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29501#event-75236"
}
```
