# Issue 29084: Make fflas_ffpack detect and use system openblas on Arch

archive/issues_028847.json:
```json
{
    "assignees": [],
    "body": "The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.\n\nDepends on #29051\nDepends on #29071\n\nCC:  @dimpase @videlec\n\nBranch/Commit: **[06f46eb](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**\n\nReviewer: **Dima Pasechnik, Matthias Koeppe**\n\nAuthor: **Antonio Rojas**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29084_\n\n",
    "closed_at": "2020-01-31T23:49:27Z",
    "created_at": "2020-01-26T18:18:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make fflas_ffpack detect and use system openblas on Arch",
    "type": "issue",
    "updated_at": "2020-01-31T23:49:27Z",
    "url": "https://github.com/sagemath/sage/issues/29084",
    "user": "https://github.com/antonio-rojas"
}
```
The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.

Depends on #29051
Depends on #29071

CC:  @dimpase @videlec

Branch/Commit: **[06f46eb](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**

Reviewer: **Dima Pasechnik, Matthias Koeppe**

Author: **Antonio Rojas**

_Issue created by migration from https://trac.sagemath.org/ticket/29084_





---

archive/issue_events_381456.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:18:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381456"
}
```



---

archive/issue_events_381457.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:18:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381457"
}
```



---

archive/issue_comments_458140.json:
```json
{
    "body": "Branch: **[u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch)**",
    "created_at": "2020-01-26T18:19:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458140",
    "user": "https://github.com/antonio-rojas"
}
```

Branch: **[u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch)**



---

archive/issue_comments_458141.json:
```json
{
    "body": "Dependencies: **#29071**",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458141",
    "user": "https://github.com/antonio-rojas"
}
```

Dependencies: **#29071**



---

archive/issue_events_381458.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:25:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381458"
}
```



---

archive/issue_comments_458142.json:
```json
{
    "body": "Commit: **[06f46eb](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458142",
    "user": "https://github.com/antonio-rojas"
}
```

Commit: **[06f46eb](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**



---

archive/issue_events_381459.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:25:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381459"
}
```



---

archive/issue_comments_458143.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0\">06f46eb</a></td><td><code>Add blas to fflas_ffpack linked libraries so that openblas is picked up on Arch</code></td></tr></table>\n",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458143",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0">06f46eb</a></td><td><code>Add blas to fflas_ffpack linked libraries so that openblas is picked up on Arch</code></td></tr></table>




---

archive/issue_comments_458144.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.\n``````\n",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458144",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.
``````




---

archive/issue_comments_458145.json:
```json
{
    "body": "Author: **Antonio Rojas**",
    "created_at": "2020-01-26T18:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458145",
    "user": "https://github.com/antonio-rojas"
}
```

Author: **Antonio Rojas**



---

archive/issue_events_381460.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-26T18:25:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381460"
}
```



---

archive/issue_comments_458146.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nlooks good to me.",
    "created_at": "2020-01-28T09:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458146",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'>Comment 3:</a>
looks good to me.



---

archive/issue_comments_458147.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-01-28T09:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458147",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_381461.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T09:52:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381461"
}
```



---

archive/issue_events_381462.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T09:52:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381462"
}
```



---

archive/issue_comments_458148.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nplesase also see [#29088 comment:13](https://github.com/sagemath/sage/issues/29088#comment:13) - it might be relevant to Arch in particular.",
    "created_at": "2020-01-28T10:02:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458148",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'>Comment 4:</a>
plesase also see [#29088 comment:13](https://github.com/sagemath/sage/issues/29088#comment:13) - it might be relevant to Arch in particular.



---

archive/issue_events_381463.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T16:26:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381463"
}
```



---

archive/issue_events_381464.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T16:26:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381464"
}
```



---

archive/issue_comments_458149.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nIs this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.",
    "created_at": "2020-01-28T16:26:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458149",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>Comment 5:</a>
Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.



---

archive/issue_comments_458150.json:
```json
{
    "body": "Changed dependencies from **#29071** to **#29051, #29071**",
    "created_at": "2020-01-28T16:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458150",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29071** to **#29051, #29071**



---

archive/issue_events_381465.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-28T16:35:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381465"
}
```



---

archive/issue_events_381466.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2020-01-28T16:35:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381466"
}
```



---

archive/issue_comments_458151.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@mkoeppe](#comment%3A5):\n> Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.\n\nYes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.",
    "created_at": "2020-01-28T16:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458151",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@mkoeppe](#comment%3A5):
> Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.

Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.



---

archive/issue_comments_458152.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@antonio-rojas](#comment%3A7):\n> Replying to [@mkoeppe](#comment%3A5):\n> > Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.\n\n> \n> Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.\n\nThanks for the explanation. How does one recognize this situation in the logs? \n\nIn https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n\nPart of the fflas configure log:\n\n```\n-----------------------------------------------\n     START  FFLAS-FFPACK CONFIG                \n-----------------------------------------------\nchecking for OpenMP... yes\nDetecting SIMD instruction set\nSSE enabled\nSSE2 enabled\nSSE3 enabled\nSSSE3 enabled\nSSE4.1 enabled\nSSE4.2 enabled\nAVX enabled\nAVX2 enabled\nAVX512F enabled\nAVX512VL enabled\nAVX512DQ enabled\nFMA3 enabled\nFMA4 disabled\n-----------------------------------------------\n...\nchecking for GIVARO usability... yes\nchecking for use of MKL... no \nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... yes (lapack)\nchecking if this is OpenBLAS... yes\nchecking for OPENBLAS numthreads... none specified (using default value 1)\n```",
    "created_at": "2020-01-28T21:51:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458152",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@antonio-rojas](#comment%3A7):
> Replying to [@mkoeppe](#comment%3A5):
> > Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.

> 
> Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.

Thanks for the explanation. How does one recognize this situation in the logs? 

In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949

Part of the fflas configure log:

```
-----------------------------------------------
     START  FFLAS-FFPACK CONFIG                
-----------------------------------------------
checking for OpenMP... yes
Detecting SIMD instruction set
SSE enabled
SSE2 enabled
SSE3 enabled
SSSE3 enabled
SSE4.1 enabled
SSE4.2 enabled
AVX enabled
AVX2 enabled
AVX512F enabled
AVX512VL enabled
AVX512DQ enabled
FMA3 enabled
FMA4 disabled
-----------------------------------------------
...
checking for GIVARO usability... yes
checking for use of MKL... no 
checking for BLAS... found CBLAS
checking for USER LAPACK... yes (lapack)
checking if this is OpenBLAS... yes
checking for OPENBLAS numthreads... none specified (using default value 1)
```



---

archive/issue_comments_458153.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@mkoeppe](#comment%3A8):\n\n> In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n\nThat build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.\n\nIf you have Arch openblas, lapack and cblas packages installed, without this patch fflas-ffpack configure should print\n\n`checking if this is OpenBLAS... no`\n\nand with this patch it should print\n\n`checking if this is OpenBLAS... yes`",
    "created_at": "2020-01-28T22:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458153",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@mkoeppe](#comment%3A8):

> In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949

That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.

If you have Arch openblas, lapack and cblas packages installed, without this patch fflas-ffpack configure should print

`checking if this is OpenBLAS... no`

and with this patch it should print

`checking if this is OpenBLAS... yes`



---

archive/issue_comments_458154.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nThank you!",
    "created_at": "2020-01-28T23:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458154",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>Comment 10:</a>
Thank you!



---

archive/issue_comments_458155.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@antonio-rojas](#comment%3A9):\n> Replying to [@mkoeppe](#comment%3A8):\n> \n> > In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n\n> \n> That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.\n> \n> If you have Arch openblas, lapack and cblas packages installed, ...\n\nThanks. I have added these packages now to the \"standard\" configuration by https://github.com/sagemath/sagetrac-mirror/commit/23c6334cf2927a4d917a27b3963471e8242d86a3 in #29053/#29087. Running my GH Actions test runner\non the branch of this ticket (on top of #29051, #29071): https://github.com/mkoeppe/sage/actions/runs/32381825, \n`archlinux-latest-standard` no longer decides to build openblas.\n\nNow I see in `fflas-ffpack` config:\n\n```\nchecking for use of MKL... no \nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... no \nchecking if this is OpenBLAS... yes\n```\n\nWithout the branch of this ticket, i.e., only using #29051, #29071, I indeed see (at https://github.com/mkoeppe/sage/actions/runs/32381466)\n\n```\nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... no \nchecking if this is OpenBLAS... no\n```\n-- like you said. Great!",
    "created_at": "2020-01-29T02:40:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458155",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@antonio-rojas](#comment%3A9):
> Replying to [@mkoeppe](#comment%3A8):
> 
> > In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949

> 
> That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.
> 
> If you have Arch openblas, lapack and cblas packages installed, ...

Thanks. I have added these packages now to the "standard" configuration by https://github.com/sagemath/sagetrac-mirror/commit/23c6334cf2927a4d917a27b3963471e8242d86a3 in #29053/#29087. Running my GH Actions test runner
on the branch of this ticket (on top of #29051, #29071): https://github.com/mkoeppe/sage/actions/runs/32381825, 
`archlinux-latest-standard` no longer decides to build openblas.

Now I see in `fflas-ffpack` config:

```
checking for use of MKL... no 
checking for BLAS... found CBLAS
checking for USER LAPACK... no 
checking if this is OpenBLAS... yes
```

Without the branch of this ticket, i.e., only using #29051, #29071, I indeed see (at https://github.com/mkoeppe/sage/actions/runs/32381466)

```
checking for BLAS... found CBLAS
checking for USER LAPACK... no 
checking if this is OpenBLAS... no
```
-- like you said. Great!



---

archive/issue_events_381467.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-29T02:46:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381467"
}
```



---

archive/issue_events_381468.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-29T02:46:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381468"
}
```



---

archive/issue_comments_458156.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nHowever, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket.",
    "created_at": "2020-01-29T02:46:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458156",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'>Comment 12:</a>
However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket.



---

archive/issue_comments_458157.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nWhich run are you referring to?",
    "created_at": "2020-01-29T07:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458157",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'>Comment 13:</a>
Which run are you referring to?



---

archive/issue_comments_458158.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@mkoeppe](#comment%3A12):\n> However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket. \n\nThe error is caused by having a too old GCC, I don't see how those could be related to this ticket. Where can I see the fflas-ffpack log of the successful build?",
    "created_at": "2020-01-29T07:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458158",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@mkoeppe](#comment%3A12):
> However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket. 

The error is caused by having a too old GCC, I don't see how those could be related to this ticket. Where can I see the fflas-ffpack log of the successful build?



---

archive/issue_comments_458159.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nWithout the ticket: https://github.com/mkoeppe/sage/actions/runs/32381466, \n- ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414019480?check_suite_focus=true \n\nWith the ticket: https://github.com/mkoeppe/sage/actions/runs/32381825, \n- `ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414021553?check_suite_focus=true",
    "created_at": "2020-01-29T14:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458159",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'>Comment 15:</a>
Without the ticket: https://github.com/mkoeppe/sage/actions/runs/32381466, 
- ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414019480?check_suite_focus=true 

With the ticket: https://github.com/mkoeppe/sage/actions/runs/32381825, 
- `ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414021553?check_suite_focus=true



---

archive/issue_comments_458160.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nMy guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.\nWould using `pkg-config --cflags-only-I ` be enough to take care of archlinux?",
    "created_at": "2020-01-29T14:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458160",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'>Comment 16:</a>
My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.
Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?



---

archive/issue_comments_458161.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@mkoeppe](#comment%3A16):\n> My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.\n> Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?\n\nThat's not the case, the output of pkg-config --cflags can be seen in the logs:\n\n```\nUsing --with-blas-libs='-L/sage/local/lib -lopenblas  ' '--with-blas-cflags=-I/sage/local/include  '\n```\n\nThat being said, the --cflags change is not needed at all, that change was made simply to be consistent with the --libs line.",
    "created_at": "2020-01-29T14:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458161",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@mkoeppe](#comment%3A16):
> My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.
> Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?

That's not the case, the output of pkg-config --cflags can be seen in the logs:

```
Using --with-blas-libs='-L/sage/local/lib -lopenblas  ' '--with-blas-cflags=-I/sage/local/include  '
```

That being said, the --cflags change is not needed at all, that change was made simply to be consistent with the --libs line.



---

archive/issue_comments_458162.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nI think \n\n```\n2020-01-29T01:30:39.8971740Z g++: error: unrecognized command line option '-mavx512f'\n2020-01-29T01:30:39.8972021Z g++: error: unrecognized command line option '-mavx512vl'\n2020-01-29T01:30:39.8972319Z g++: error: unrecognized command line option '-mavx512dq'\n```\nin the log is an indication that fflas_ffpack's configure emits these flags, but compiler, gcc 4.8.4, does not understand them, it's too old. So that's a bug in fflas_ffpack - or, if you prefer, a case to bump up the minimal compiler version for Sage",
    "created_at": "2020-01-29T14:56:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458162",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'>Comment 18:</a>
I think 

```
2020-01-29T01:30:39.8971740Z g++: error: unrecognized command line option '-mavx512f'
2020-01-29T01:30:39.8972021Z g++: error: unrecognized command line option '-mavx512vl'
2020-01-29T01:30:39.8972319Z g++: error: unrecognized command line option '-mavx512dq'
```
in the log is an indication that fflas_ffpack's configure emits these flags, but compiler, gcc 4.8.4, does not understand them, it's too old. So that's a bug in fflas_ffpack - or, if you prefer, a case to bump up the minimal compiler version for Sage



---

archive/issue_comments_458163.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nIt's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud.",
    "created_at": "2020-01-29T14:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458163",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>Comment 19:</a>
It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud.



---

archive/issue_comments_458164.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@mkoeppe](#comment%3A19):\n> It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud. \n\nabsolutely.",
    "created_at": "2020-01-29T15:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458164",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@mkoeppe](#comment%3A19):
> It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud. 

absolutely.



---

archive/issue_comments_458165.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nI'm setting this ticket back to \"positive review\" and will open a separate issue for this.",
    "created_at": "2020-01-29T15:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458165",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
I'm setting this ticket back to "positive review" and will open a separate issue for this.



---

archive/issue_events_381469.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-29T15:04:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381469"
}
```



---

archive/issue_events_381470.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-29T15:04:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381470"
}
```



---

archive/issue_comments_458166.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nThanks everyone for your patience!",
    "created_at": "2020-01-29T15:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458166",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>Comment 22:</a>
Thanks everyone for your patience!



---

archive/issue_comments_458167.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@mkoeppe](#comment%3A21):\n> I'm setting this ticket back to \"positive review\" and will open a separate issue for this.\n\nThis is now #29102: fflas_ffpack installation error on new CPUs with old compilers",
    "created_at": "2020-01-29T15:19:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458167",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@mkoeppe](#comment%3A21):
> I'm setting this ticket back to "positive review" and will open a separate issue for this.

This is now #29102: fflas_ffpack installation error on new CPUs with old compilers



---

archive/issue_comments_458168.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Matthias Koeppe**",
    "created_at": "2020-01-29T15:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458168",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, Matthias Koeppe**



---

archive/issue_comments_458169.json:
```json
{
    "body": "Changed branch from **[u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch)** to **[06f46eb](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**",
    "created_at": "2020-01-31T23:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29084#issuecomment-458169",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch)** to **[06f46eb](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)**



---

archive/issue_events_381471.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381471"
}
```



---

archive/issue_events_381472.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b38e091a96610f8a13d00959c8d56f924b08ca39",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-31T23:49:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29084",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29084#event-381472"
}
```
