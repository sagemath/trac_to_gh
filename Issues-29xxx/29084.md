# Issue 29084: Make fflas_ffpack detect and use system openblas on Arch

archive/issues_028847.json:
```json
{
    "body": "The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.\n\nCC:  @dimpase @videlec\n\nBranch/Commit: 06f46ebaa41a620016d8e04c8c27045acbcd3ae0\n\nReviewer: Dima Pasechnik, Matthias Koeppe\n\nAuthor: Antonio Rojas\n\nDependencies: #29051, #29071\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29084\n\n",
    "closed_at": "2020-01-31T23:49:27Z",
    "created_at": "2020-01-26T18:18:10Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Make fflas_ffpack detect and use system openblas on Arch",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29084",
    "user": "https://github.com/antonio-rojas"
}
```
The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.

CC:  @dimpase @videlec

Branch/Commit: 06f46ebaa41a620016d8e04c8c27045acbcd3ae0

Reviewer: Dima Pasechnik, Matthias Koeppe

Author: Antonio Rojas

Dependencies: #29051, #29071

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29084





---

archive/issue_comments_559144.json:
```json
{
    "body": "Changing branch from \"\" to \"u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch\"",
    "created_at": "2020-01-26T18:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559144",
    "user": "https://github.com/antonio-rojas"
}
```

Changing branch from "" to "u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch"



---

archive/issue_comments_559145.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29071\"",
    "created_at": "2020-01-26T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559145",
    "user": "https://github.com/antonio-rojas"
}
```

Changing dependencies from "" to "#29071"



---

archive/issue_comments_559146.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-26T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559146",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_559147.json:
```json
{
    "body": "Changing commit from \"\" to \"06f46ebaa41a620016d8e04c8c27045acbcd3ae0\"",
    "created_at": "2020-01-26T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559147",
    "user": "https://github.com/antonio-rojas"
}
```

Changing commit from "" to "06f46ebaa41a620016d8e04c8c27045acbcd3ae0"



---

archive/issue_comments_559148.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|\n|[06f46eb](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)|`Add blas to fflas_ffpack linked libraries so that openblas is picked up on Arch`|",
    "created_at": "2020-01-26T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559148",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
|[06f46eb](https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0)|`Add blas to fflas_ffpack linked libraries so that openblas is picked up on Arch`|



---

archive/issue_comments_559149.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.\n``````\n",
    "created_at": "2020-01-26T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559149",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+The fflas-ffpack spkg-install passes the output of `pkg-config --libs cblas` as link flags. The fflas-ffpack uses these flags in its configure script to detect whether openblas is being used, by testing for the openblas_set_num_threads function. This doesn't work on Arch when using system openblas, since cblas is not provided by openblas. We fix this by also adding the output of `pkg-config --libs blas` to the link flags.
``````




---

archive/issue_comments_559150.json:
```json
{
    "body": "Changing author from \"\" to \"Antonio Rojas\"",
    "created_at": "2020-01-26T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559150",
    "user": "https://github.com/antonio-rojas"
}
```

Changing author from "" to "Antonio Rojas"



---

archive/issue_comments_559151.json:
```json
{
    "body": "<a id='comment:3'></a>\nlooks good to me.",
    "created_at": "2020-01-28T09:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559151",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
looks good to me.



---

archive/issue_comments_559152.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2020-01-28T09:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559152",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_559153.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-28T09:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559153",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_559154.json:
```json
{
    "body": "<a id='comment:4'></a>\nplesase also see #29088#comment:13 - it might be relevant to Arch in particular.",
    "created_at": "2020-01-28T10:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559154",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
plesase also see #29088#comment:13 - it might be relevant to Arch in particular.



---

archive/issue_comments_559155.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2020-01-28T16:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559155",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_559156.json:
```json
{
    "body": "<a id='comment:5'></a>\nIs this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.",
    "created_at": "2020-01-28T16:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559156",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.



---

archive/issue_comments_559157.json:
```json
{
    "body": "Changing dependencies from \"#29071\" to \"#29051, #29071\"",
    "created_at": "2020-01-28T16:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559157",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29071" to "#29051, #29071"



---

archive/issue_comments_559158.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2020-01-28T16:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559158",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_559159.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mkoeppe](#comment%3A5):\n> Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.\n\n\nYes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.",
    "created_at": "2020-01-28T16:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559159",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:7'></a>
Replying to [mkoeppe](#comment%3A5):
> Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.


Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.



---

archive/issue_comments_559160.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [arojas](#comment%3A7):\n> Replying to [mkoeppe](#comment%3A5):\n> > Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.\n\n> \n> Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.\n\n\nThanks for the explanation. How does one recognize this situation in the logs? \n\nIn https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n\nPart of the fflas configure log:\n\n```\n-----------------------------------------------\n     START  FFLAS-FFPACK CONFIG                \n-----------------------------------------------\nchecking for OpenMP... yes\nDetecting SIMD instruction set\nSSE enabled\nSSE2 enabled\nSSE3 enabled\nSSSE3 enabled\nSSE4.1 enabled\nSSE4.2 enabled\nAVX enabled\nAVX2 enabled\nAVX512F enabled\nAVX512VL enabled\nAVX512DQ enabled\nFMA3 enabled\nFMA4 disabled\n-----------------------------------------------\n...\nchecking for GIVARO usability... yes\nchecking for use of MKL... no \nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... yes (lapack)\nchecking if this is OpenBLAS... yes\nchecking for OPENBLAS numthreads... none specified (using default value 1)\n```",
    "created_at": "2020-01-28T21:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559160",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Replying to [arojas](#comment%3A7):
> Replying to [mkoeppe](#comment%3A5):
> > Is this ticket needed? Also the current branch on #29071 seems to do the job for Arch Linux.

> 
> Yes, this is a different issue. #29071 fixes fflas-ffpack building when using system openblas, but fflas-ffpack configure script still doesn't detect openblas being used (so the generic blas code is compiled, without specific openblas optimizations). This is what this ticket fixes.


Thanks for the explanation. How does one recognize this situation in the logs? 

In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949

Part of the fflas configure log:

```
-----------------------------------------------
     START  FFLAS-FFPACK CONFIG                
-----------------------------------------------
checking for OpenMP... yes
Detecting SIMD instruction set
SSE enabled
SSE2 enabled
SSE3 enabled
SSSE3 enabled
SSE4.1 enabled
SSE4.2 enabled
AVX enabled
AVX2 enabled
AVX512F enabled
AVX512VL enabled
AVX512DQ enabled
FMA3 enabled
FMA4 disabled
-----------------------------------------------
...
checking for GIVARO usability... yes
checking for use of MKL... no 
checking for BLAS... found CBLAS
checking for USER LAPACK... yes (lapack)
checking if this is OpenBLAS... yes
checking for OPENBLAS numthreads... none specified (using default value 1)
```



---

archive/issue_comments_559161.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [mkoeppe](#comment%3A8):\n\n> In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n\n\nThat build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.\n\nIf you have Arch openblas, lapack and cblas packages installed, without this patch fflas-ffpack configure should print\n\n`checking if this is OpenBLAS... no`\n\nand with this patch it should print\n\n`checking if this is OpenBLAS... yes`",
    "created_at": "2020-01-28T22:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559161",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:9'></a>
Replying to [mkoeppe](#comment%3A8):

> In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949


That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.

If you have Arch openblas, lapack and cblas packages installed, without this patch fflas-ffpack configure should print

`checking if this is OpenBLAS... no`

and with this patch it should print

`checking if this is OpenBLAS... yes`



---

archive/issue_comments_559162.json:
```json
{
    "body": "<a id='comment:10'></a>\nThank you!",
    "created_at": "2020-01-28T23:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559162",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Thank you!



---

archive/issue_comments_559163.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [arojas](#comment%3A9):\n> Replying to [mkoeppe](#comment%3A8):\n> \n> > In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949\n\n> \n> That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.\n> \n> If you have Arch openblas, lapack and cblas packages installed, ...\n\n\nThanks. I have added these packages now to the \"standard\" configuration by https://github.com/sagemath/sagetrac-mirror/commit/23c6334cf2927a4d917a27b3963471e8242d86a3 in #29053/#29087. Running my GH Actions test runner\non the branch of this ticket (on top of #29051, #29071): https://github.com/mkoeppe/sage/actions/runs/32381825, \n`archlinux-latest-standard` no longer decides to build openblas.\n\nNow I see in `fflas-ffpack` config:\n\n```\nchecking for use of MKL... no \nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... no \nchecking if this is OpenBLAS... yes\n```\n\nWithout the branch of this ticket, i.e., only using #29051, #29071, I indeed see (at https://github.com/mkoeppe/sage/actions/runs/32381466)\n\n```\nchecking for BLAS... found CBLAS\nchecking for USER LAPACK... no \nchecking if this is OpenBLAS... no\n```\n-- like you said. Great!",
    "created_at": "2020-01-29T02:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559163",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Replying to [arojas](#comment%3A9):
> Replying to [mkoeppe](#comment%3A8):
> 
> > In https://github.com/mkoeppe/sage/actions/runs/32186055 I ran the branch of #29071. See archlinux logs at https://github.com/mkoeppe/sage/suites/424292952/artifacts/1395949

> 
> That build is not using system openblas, because you don't have the Arch cblas package installed - so Sage's openblas is being compiled, in which case this patch doesn't make any difference.
> 
> If you have Arch openblas, lapack and cblas packages installed, ...


Thanks. I have added these packages now to the "standard" configuration by https://github.com/sagemath/sagetrac-mirror/commit/23c6334cf2927a4d917a27b3963471e8242d86a3 in #29053/#29087. Running my GH Actions test runner
on the branch of this ticket (on top of #29051, #29071): https://github.com/mkoeppe/sage/actions/runs/32381825, 
`archlinux-latest-standard` no longer decides to build openblas.

Now I see in `fflas-ffpack` config:

```
checking for use of MKL... no 
checking for BLAS... found CBLAS
checking for USER LAPACK... no 
checking if this is OpenBLAS... yes
```

Without the branch of this ticket, i.e., only using #29051, #29071, I indeed see (at https://github.com/mkoeppe/sage/actions/runs/32381466)

```
checking for BLAS... found CBLAS
checking for USER LAPACK... no 
checking if this is OpenBLAS... no
```
-- like you said. Great!



---

archive/issue_comments_559164.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2020-01-29T02:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559164",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_559165.json:
```json
{
    "body": "<a id='comment:12'></a>\nHowever, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket.",
    "created_at": "2020-01-29T02:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559165",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket.



---

archive/issue_comments_559166.json:
```json
{
    "body": "<a id='comment:13'></a>\nWhich run are you referring to?",
    "created_at": "2020-01-29T07:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559166",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
Which run are you referring to?



---

archive/issue_comments_559167.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [mkoeppe](#comment%3A12):\n> However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket. \n\n\nThe error is caused by having a too old GCC, I don't see how those could be related to this ticket. Where can I see the fflas-ffpack log of the successful build?",
    "created_at": "2020-01-29T07:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559167",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:14'></a>
Replying to [mkoeppe](#comment%3A12):
> However, there's some trouble with `ubuntu-trusty-minimal` in fflas_ffpack. It installs correctly in the run without this ticket, but has a build error with this ticket. 


The error is caused by having a too old GCC, I don't see how those could be related to this ticket. Where can I see the fflas-ffpack log of the successful build?



---

archive/issue_comments_559168.json:
```json
{
    "body": "<a id='comment:15'></a>\nWithout the ticket: https://github.com/mkoeppe/sage/actions/runs/32381466, \n- ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414019480?check_suite_focus=true \n\nWith the ticket: https://github.com/mkoeppe/sage/actions/runs/32381825, \n- `ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414021553?check_suite_focus=true",
    "created_at": "2020-01-29T14:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559168",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Without the ticket: https://github.com/mkoeppe/sage/actions/runs/32381466, 
- ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414019480?check_suite_focus=true 

With the ticket: https://github.com/mkoeppe/sage/actions/runs/32381825, 
- `ubuntu-trusty-minimal` run at https://github.com/mkoeppe/sage/runs/414021553?check_suite_focus=true



---

archive/issue_comments_559169.json:
```json
{
    "body": "<a id='comment:16'></a>\nMy guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.\nWould using `pkg-config --cflags-only-I ` be enough to take care of archlinux?",
    "created_at": "2020-01-29T14:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559169",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.
Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?



---

archive/issue_comments_559170.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mkoeppe](#comment%3A16):\n> My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.\n> Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?\n\n\nThat's not the case, the output of pkg-config --cflags can be seen in the logs:\n\n```\nUsing --with-blas-libs='-L/sage/local/lib -lopenblas  ' '--with-blas-cflags=-I/sage/local/include  '\n```\n\nThat being said, the --cflags change is not needed at all, that change was made simply to be consistent with the --libs line.",
    "created_at": "2020-01-29T14:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559170",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:17'></a>
Replying to [mkoeppe](#comment%3A16):
> My guess is that `pkg-config --cflags` is injecting the compiler flags that the system gcc does not understand.
> Would using `pkg-config --cflags-only-I ` be enough to take care of archlinux?


That's not the case, the output of pkg-config --cflags can be seen in the logs:

```
Using --with-blas-libs='-L/sage/local/lib -lopenblas  ' '--with-blas-cflags=-I/sage/local/include  '
```

That being said, the --cflags change is not needed at all, that change was made simply to be consistent with the --libs line.



---

archive/issue_comments_559171.json:
```json
{
    "body": "<a id='comment:18'></a>\nI think \n\n```\n2020-01-29T01:30:39.8971740Z g++: error: unrecognized command line option '-mavx512f'\n2020-01-29T01:30:39.8972021Z g++: error: unrecognized command line option '-mavx512vl'\n2020-01-29T01:30:39.8972319Z g++: error: unrecognized command line option '-mavx512dq'\n```\nin the log is an indication that fflas_ffpack's configure emits these flags, but compiler, gcc 4.8.4, does not understand them, it's too old. So that's a bug in fflas_ffpack - or, if you prefer, a case to bump up the minimal compiler version for Sage",
    "created_at": "2020-01-29T14:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559171",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
I think 

```
2020-01-29T01:30:39.8971740Z g++: error: unrecognized command line option '-mavx512f'
2020-01-29T01:30:39.8972021Z g++: error: unrecognized command line option '-mavx512vl'
2020-01-29T01:30:39.8972319Z g++: error: unrecognized command line option '-mavx512dq'
```
in the log is an indication that fflas_ffpack's configure emits these flags, but compiler, gcc 4.8.4, does not understand them, it's too old. So that's a bug in fflas_ffpack - or, if you prefer, a case to bump up the minimal compiler version for Sage



---

archive/issue_comments_559172.json:
```json
{
    "body": "<a id='comment:19'></a>\nIt's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud.",
    "created_at": "2020-01-29T14:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559172",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud.



---

archive/issue_comments_559173.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A19):\n> It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud. \n\n\nabsolutely.",
    "created_at": "2020-01-29T15:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559173",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A19):
> It's conceivable that this error only shows up depending on what specific processor it gets to run. This can probably vary from run to run on the cloud. 


absolutely.



---

archive/issue_comments_559174.json:
```json
{
    "body": "<a id='comment:21'></a>\nI'm setting this ticket back to \"positive review\" and will open a separate issue for this.",
    "created_at": "2020-01-29T15:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559174",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
I'm setting this ticket back to "positive review" and will open a separate issue for this.



---

archive/issue_comments_559175.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2020-01-29T15:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559175",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_559176.json:
```json
{
    "body": "<a id='comment:22'></a>\nThanks everyone for your patience!",
    "created_at": "2020-01-29T15:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559176",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Thanks everyone for your patience!



---

archive/issue_comments_559177.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [mkoeppe](#comment%3A21):\n> I'm setting this ticket back to \"positive review\" and will open a separate issue for this.\n\nThis is now #29102: fflas_ffpack installation error on new CPUs with old compilers",
    "created_at": "2020-01-29T15:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559177",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Replying to [mkoeppe](#comment%3A21):
> I'm setting this ticket back to "positive review" and will open a separate issue for this.

This is now #29102: fflas_ffpack installation error on new CPUs with old compilers



---

archive/issue_comments_559178.json:
```json
{
    "body": "Changing reviewer from \"Dima Pasechnik\" to \"Dima Pasechnik, Matthias Koeppe\"",
    "created_at": "2020-01-29T15:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559178",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "Dima Pasechnik" to "Dima Pasechnik, Matthias Koeppe"



---

archive/issue_comments_559179.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-31T23:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559179",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_559180.json:
```json
{
    "body": "Changing branch from \"u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch\" to \"06f46ebaa41a620016d8e04c8c27045acbcd3ae0\"",
    "created_at": "2020-01-31T23:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29084#issuecomment-559180",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch" to "06f46ebaa41a620016d8e04c8c27045acbcd3ae0"



---

archive/issue_events_091141.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29084",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29084#event-91141"
}
```
