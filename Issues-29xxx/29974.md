# Issue 29974: Make combinat doctests ready for random seeds

archive/issues_029737.json:
```json
{
    "assignees": [],
    "body": "Part of #29935.\n\nThis ticket makes\n\n```\nsage -t --long --random-seed=n src/sage/combinat/\n```\npass for `n` more general than just `0`.\n\nSee also:\n- #30186 containment check for standard bracketed Lyndon words does not work.\n\nAlong the way we fix a tiny but annoying bug, where random derangements could fail.\n\nThat was because `randint(0, n)` has range `range(0, n + 1)`,\nwhich had caused confusion.\n\nDepends on #29962\n\nComponent: **doctest framework**\n\nAuthor: **Jonathan Kliem**\n\nBranch: **[`928863f`](https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d)**\n\nReviewer: **S\u00e9bastien Labb\u00e9**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29974_\n\n",
    "closed_at": "2020-08-16T22:33:01Z",
    "created_at": "2020-06-24T21:22:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make combinat doctests ready for random seeds",
    "type": "issue",
    "updated_at": "2021-04-29T22:02:45Z",
    "url": "https://github.com/sagemath/sage/issues/29974",
    "user": "https://github.com/kliem"
}
```
Part of #29935.

This ticket makes

```
sage -t --long --random-seed=n src/sage/combinat/
```
pass for `n` more general than just `0`.

See also:
- #30186 containment check for standard bracketed Lyndon words does not work.

Along the way we fix a tiny but annoying bug, where random derangements could fail.

That was because `randint(0, n)` has range `range(0, n + 1)`,
which had caused confusion.

Depends on #29962

Component: **doctest framework**

Author: **Jonathan Kliem**

Branch: **[`928863f`](https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d)**

Reviewer: **Sébastien Labbé**

_Issue created by migration from https://trac.sagemath.org/ticket/29974_





---

archive/issue_events_409599.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-24T21:22:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409599"
}
```



---

archive/issue_events_409600.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-24T21:22:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "0000b0",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409600"
}
```



---

archive/issue_events_409601.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-24T21:22:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409601"
}
```



---

archive/issue_events_409602.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-24T21:22:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409602"
}
```



---

archive/issue_comments_474193.json:
```json
{
    "body": "Branch: **[public/29974](https://github.com/sagemath/sagetrac-mirror/tree/public/29974)**",
    "created_at": "2020-06-24T21:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474193",
    "user": "https://github.com/kliem"
}
```

Branch: **[public/29974](https://github.com/sagemath/sagetrac-mirror/tree/public/29974)**



---

archive/issue_comments_474194.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da1c6beec7d0bb6b972d88ecf9fb4eccbdf285a5\"><code>da1c6be</code></a></td><td><code>start from a \"random\" random seed for doctesting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7b836d789e034433d62f331f33fbc1821c0deaa\"><code>b7b836d</code></a></td><td><code>make random seed reproducible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eedbe5ebea9c2b9da79404013c566fe17d0a3e20\"><code>eedbe5e</code></a></td><td><code>document random_seed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/998b1b94ce1289ea92451a86e5f6191c37eaeb5a\"><code>998b1b9</code></a></td><td><code>default random seed 0 for now</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d7b00e3fc2ebc1dc9982a2df91d15e3f12e9432\"><code>1d7b00e</code></a></td><td><code>dash instead of underscore for command line options</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0e572ecc138a306d52a80cee2cf9acb299c1508\"><code>e0e572e</code></a></td><td><code>make combinat fuzz ready</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c3a1ffc46f13b77a8ca0b78696b6b433c40295c\"><code>7c3a1ff</code></a></td><td><code>another file for combinat</code></td></tr></table>\n",
    "created_at": "2020-06-24T21:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474194",
    "user": "https://github.com/kliem"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da1c6beec7d0bb6b972d88ecf9fb4eccbdf285a5"><code>da1c6be</code></a></td><td><code>start from a "random" random seed for doctesting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7b836d789e034433d62f331f33fbc1821c0deaa"><code>b7b836d</code></a></td><td><code>make random seed reproducible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eedbe5ebea9c2b9da79404013c566fe17d0a3e20"><code>eedbe5e</code></a></td><td><code>document random_seed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/998b1b94ce1289ea92451a86e5f6191c37eaeb5a"><code>998b1b9</code></a></td><td><code>default random seed 0 for now</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d7b00e3fc2ebc1dc9982a2df91d15e3f12e9432"><code>1d7b00e</code></a></td><td><code>dash instead of underscore for command line options</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0e572ecc138a306d52a80cee2cf9acb299c1508"><code>e0e572e</code></a></td><td><code>make combinat fuzz ready</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c3a1ffc46f13b77a8ca0b78696b6b433c40295c"><code>7c3a1ff</code></a></td><td><code>another file for combinat</code></td></tr></table>




---

archive/issue_comments_474195.json:
```json
{
    "body": "Commit: **[`7c3a1ff`](https://github.com/sagemath/sagetrac-mirror/commit/7c3a1ffc46f13b77a8ca0b78696b6b433c40295c)**",
    "created_at": "2020-06-24T21:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474195",
    "user": "https://github.com/kliem"
}
```

Commit: **[`7c3a1ff`](https://github.com/sagemath/sagetrac-mirror/commit/7c3a1ffc46f13b77a8ca0b78696b6b433c40295c)**



---

archive/issue_events_409603.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-24T21:38:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409603"
}
```



---

archive/issue_comments_474196.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMerge conflict.\n\nI also need to go through it again and check I respected the design decision in #29935.",
    "created_at": "2020-07-12T18:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474196",
    "user": "https://github.com/kliem"
}
```

<div id="comment:2" align="right">comment:2</div>

Merge conflict.

I also need to go through it again and check I respected the design decision in #29935.



---

archive/issue_events_409604.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-07-12T18:16:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409604"
}
```



---

archive/issue_events_409605.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-07-12T18:16:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409605"
}
```



---

archive/issue_comments_474197.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nNote that elements of `g = GelfandTsetlinPatterns(4, 5)` have the wrong parent.",
    "created_at": "2020-07-20T05:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474197",
    "user": "https://github.com/kliem"
}
```

<div id="comment:3" align="right">comment:3</div>

Note that elements of `g = GelfandTsetlinPatterns(4, 5)` have the wrong parent.



---

archive/issue_comments_474198.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,5 @@\n sage -t --long --random-seed=n src/sage/combinat/\n ```\n pass for different values `n` than just `0`.\n+\n+See also: #30186 containment check for standard bracketed lyndon words does not work \n``````\n",
    "created_at": "2020-07-21T07:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474198",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,5 @@
 sage -t --long --random-seed=n src/sage/combinat/
 ```
 pass for different values `n` than just `0`.
+
+See also: #30186 containment check for standard bracketed lyndon words does not work 
``````




---

archive/issue_comments_474199.json:
```json
{
    "body": "Changed commit from **[`7c3a1ff`](https://github.com/sagemath/sagetrac-mirror/commit/7c3a1ffc46f13b77a8ca0b78696b6b433c40295c)** to none",
    "created_at": "2020-07-21T07:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474199",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`7c3a1ff`](https://github.com/sagemath/sagetrac-mirror/commit/7c3a1ffc46f13b77a8ca0b78696b6b433c40295c)** to none



---

archive/issue_comments_474200.json:
```json
{
    "body": "Changed branch from **[public/29974](https://github.com/sagemath/sagetrac-mirror/tree/public/29974)** to **[public/29974-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/29974-reb)**",
    "created_at": "2020-07-21T07:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474200",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[public/29974](https://github.com/sagemath/sagetrac-mirror/tree/public/29974)** to **[public/29974-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/29974-reb)**



---

archive/issue_comments_474201.json:
```json
{
    "body": "Commit: **[`a914b8d`](https://github.com/sagemath/sagetrac-mirror/commit/a914b8db0373ab16bf24fafa3775fbfd3a1c32f9)**",
    "created_at": "2020-07-21T07:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474201",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`a914b8d`](https://github.com/sagemath/sagetrac-mirror/commit/a914b8db0373ab16bf24fafa3775fbfd3a1c32f9)**



---

archive/issue_comments_474202.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eedbe5ebea9c2b9da79404013c566fe17d0a3e20\"><code>eedbe5e</code></a></td><td><code>document random_seed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/998b1b94ce1289ea92451a86e5f6191c37eaeb5a\"><code>998b1b9</code></a></td><td><code>default random seed 0 for now</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d7b00e3fc2ebc1dc9982a2df91d15e3f12e9432\"><code>1d7b00e</code></a></td><td><code>dash instead of underscore for command line options</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b31e2d5dba166fdb4d8f9f6730df8cdb065ccae7\"><code>b31e2d5</code></a></td><td><code>Merge branch 'public/29962' of git://trac.sagemath.org/sage into public/29962-reb</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f30dd9b9e13cb8134b85a1165375ac8bdd1f683\"><code>2f30dd9</code></a></td><td><code>small fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b62f781647851a3f27ecc95ea4b98b53838da112\"><code>b62f781</code></a></td><td><code>doctests do not start from a random seed by default yet</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d99129f26f4a065f9f9e5e13c3d5120a029e89f\"><code>1d99129</code></a></td><td><code>fix merge conflict</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d40d8266d04a661fa038c2765a5dd1891aaf7ae2\"><code>d40d826</code></a></td><td><code>make combinat fuzz ready</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9f88cf8673e9fcaf4e0ec1e199a755dc52ca416\"><code>b9f88cf</code></a></td><td><code>another file for combinat</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a914b8db0373ab16bf24fafa3775fbfd3a1c32f9\"><code>a914b8d</code></a></td><td><code>modify doctests according to decisions in 29935</code></td></tr></table>\n",
    "created_at": "2020-07-21T07:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474202",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eedbe5ebea9c2b9da79404013c566fe17d0a3e20"><code>eedbe5e</code></a></td><td><code>document random_seed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/998b1b94ce1289ea92451a86e5f6191c37eaeb5a"><code>998b1b9</code></a></td><td><code>default random seed 0 for now</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d7b00e3fc2ebc1dc9982a2df91d15e3f12e9432"><code>1d7b00e</code></a></td><td><code>dash instead of underscore for command line options</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b31e2d5dba166fdb4d8f9f6730df8cdb065ccae7"><code>b31e2d5</code></a></td><td><code>Merge branch 'public/29962' of git://trac.sagemath.org/sage into public/29962-reb</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f30dd9b9e13cb8134b85a1165375ac8bdd1f683"><code>2f30dd9</code></a></td><td><code>small fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b62f781647851a3f27ecc95ea4b98b53838da112"><code>b62f781</code></a></td><td><code>doctests do not start from a random seed by default yet</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d99129f26f4a065f9f9e5e13c3d5120a029e89f"><code>1d99129</code></a></td><td><code>fix merge conflict</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d40d8266d04a661fa038c2765a5dd1891aaf7ae2"><code>d40d826</code></a></td><td><code>make combinat fuzz ready</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9f88cf8673e9fcaf4e0ec1e199a755dc52ca416"><code>b9f88cf</code></a></td><td><code>another file for combinat</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a914b8db0373ab16bf24fafa3775fbfd3a1c32f9"><code>a914b8d</code></a></td><td><code>modify doctests according to decisions in 29935</code></td></tr></table>




---

archive/issue_events_409606.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-07-21T07:30:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409606"
}
```



---

archive/issue_events_409607.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-07-21T07:30:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409607"
}
```



---

archive/issue_comments_474203.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI get one failure in combinat:\n\n```\n----------------------------------------------------------------------\nsage -t --long --random-seed=2 src/sage/combinat/derangements.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nCan you reproduce it?\n\n```\nsage -t --long --random-seed=2 src/sage/combinat/derangements.py\n**********************************************************************\nFile \"src/sage/combinat/derangements.py\", line 129, in sage.combinat.derangements.Derangements\nFailed example:\n    D2.random_element() # random\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 715, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1139, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.derangements.Derangements[7]>\", line 1, in <module>\n        D2.random_element() # random\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/combinat/derangements.py\", line 504, in random_element\n        return L[i]\n    IndexError: list index out of range\n**********************************************************************\n1 item had failures:\n   1 of   9 in sage.combinat.derangements.Derangements\n    [85 tests, 1 failure, 0.10 s]\n```",
    "created_at": "2020-08-14T13:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474203",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:8" align="right">comment:8</div>

I get one failure in combinat:

```
----------------------------------------------------------------------
sage -t --long --random-seed=2 src/sage/combinat/derangements.py  # 1 doctest failed
----------------------------------------------------------------------
```

Can you reproduce it?

```
sage -t --long --random-seed=2 src/sage/combinat/derangements.py
**********************************************************************
File "src/sage/combinat/derangements.py", line 129, in sage.combinat.derangements.Derangements
Failed example:
    D2.random_element() # random
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 715, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1139, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.derangements.Derangements[7]>", line 1, in <module>
        D2.random_element() # random
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/combinat/derangements.py", line 504, in random_element
        return L[i]
    IndexError: list index out of range
**********************************************************************
1 item had failures:
   1 of   9 in sage.combinat.derangements.Derangements
    [85 tests, 1 failure, 0.10 s]
```



---

archive/issue_events_409608.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-08-14T13:56:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409608"
}
```



---

archive/issue_events_409609.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-08-14T13:56:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409609"
}
```



---

archive/issue_comments_474204.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nYes, I can confirm the problem.",
    "created_at": "2020-08-14T14:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474204",
    "user": "https://github.com/kliem"
}
```

<div id="comment:9" align="right">comment:9</div>

Yes, I can confirm the problem.



---

archive/issue_comments_474205.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2020-08-14T14:30:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474205",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_comments_474206.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nBut it works for `--random-seed=0`, `--random-seed=1`, `--random-seed=3`, `--random-seed=4`.",
    "created_at": "2020-08-14T14:30:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474206",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:10" align="right">comment:10</div>

But it works for `--random-seed=0`, `--random-seed=1`, `--random-seed=3`, `--random-seed=4`.



---

archive/issue_comments_474207.json:
```json
{
    "body": "Changed branch from **[public/29974-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/29974-reb)** to **[public/29974-reb2](https://github.com/sagemath/sagetrac-mirror/tree/public/29974-reb2)**",
    "created_at": "2020-08-15T07:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474207",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[public/29974-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/29974-reb)** to **[public/29974-reb2](https://github.com/sagemath/sagetrac-mirror/tree/public/29974-reb2)**



---

archive/issue_events_409610.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-15T07:53:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409610"
}
```



---

archive/issue_events_409611.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-15T07:53:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409611"
}
```



---

archive/issue_comments_474208.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nTiny mistake that the range of `randint(0,n)` is actually `range(0,n+1)`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48bd40e1d975d00681060992ee3ad818c1b626e0\"><code>48bd40e</code></a></td><td><code>Merge branch 'public/29974-reb' of git://trac.sagemath.org/sage into test_29974</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39f94e67e1630a9a021dc4f1ec46152384a1c50c\"><code>39f94e6</code></a></td><td><code>fix index error with random derangements</code></td></tr></table>\n",
    "created_at": "2020-08-15T07:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474208",
    "user": "https://github.com/kliem"
}
```

<div id="comment:11" align="right">comment:11</div>

Tiny mistake that the range of `randint(0,n)` is actually `range(0,n+1)`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48bd40e1d975d00681060992ee3ad818c1b626e0"><code>48bd40e</code></a></td><td><code>Merge branch 'public/29974-reb' of git://trac.sagemath.org/sage into test_29974</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39f94e67e1630a9a021dc4f1ec46152384a1c50c"><code>39f94e6</code></a></td><td><code>fix index error with random derangements</code></td></tr></table>




---

archive/issue_comments_474209.json:
```json
{
    "body": "Changed commit from **[`a914b8d`](https://github.com/sagemath/sagetrac-mirror/commit/a914b8db0373ab16bf24fafa3775fbfd3a1c32f9)** to **[`39f94e6`](https://github.com/sagemath/sagetrac-mirror/commit/39f94e67e1630a9a021dc4f1ec46152384a1c50c)**",
    "created_at": "2020-08-15T07:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474209",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`a914b8d`](https://github.com/sagemath/sagetrac-mirror/commit/a914b8db0373ab16bf24fafa3775fbfd3a1c32f9)** to **[`39f94e6`](https://github.com/sagemath/sagetrac-mirror/commit/39f94e67e1630a9a021dc4f1ec46152384a1c50c)**



---

archive/issue_comments_474210.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,4 +5,6 @@\n ```\n pass for different values `n` than just `0`.\n \n-See also: #30186 containment check for standard bracketed lyndon words does not work \n+See also: #30186 containment check for standard bracketed lyndon words does not work.\n+\n+Along the way we fix a tiny but annoying bug, where random dearangments could fail, because `randint(0,n)` has range `range(0,n+1)`. \n``````\n",
    "created_at": "2020-08-15T07:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474210",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,4 +5,6 @@
 ```
 pass for different values `n` than just `0`.
 
-See also: #30186 containment check for standard bracketed lyndon words does not work 
+See also: #30186 containment check for standard bracketed lyndon words does not work.
+
+Along the way we fix a tiny but annoying bug, where random dearangments could fail, because `randint(0,n)` has range `range(0,n+1)`. 
``````




---

archive/issue_comments_474211.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThere is \n\n```\nfrom random import randrange\n```\nfor that. Do you mind to change to the lesser known `randrange`?",
    "created_at": "2020-08-15T08:16:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474211",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:12" align="right">comment:12</div>

There is 

```
from random import randrange
```
for that. Do you mind to change to the lesser known `randrange`?



---

archive/issue_comments_474212.json:
```json
{
    "body": "Changed commit from **[`39f94e6`](https://github.com/sagemath/sagetrac-mirror/commit/39f94e67e1630a9a021dc4f1ec46152384a1c50c)** to **[`a391a3e`](https://github.com/sagemath/sagetrac-mirror/commit/a391a3ebe2be270302b55f2360aeb53390d02492)**",
    "created_at": "2020-08-15T08:24:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474212",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`39f94e6`](https://github.com/sagemath/sagetrac-mirror/commit/39f94e67e1630a9a021dc4f1ec46152384a1c50c)** to **[`a391a3e`](https://github.com/sagemath/sagetrac-mirror/commit/a391a3ebe2be270302b55f2360aeb53390d02492)**



---

archive/issue_comments_474213.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a391a3ebe2be270302b55f2360aeb53390d02492\"><code>a391a3e</code></a></td><td><code>use randrange instead of randint</code></td></tr></table>\n",
    "created_at": "2020-08-15T08:24:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474213",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a391a3ebe2be270302b55f2360aeb53390d02492"><code>a391a3e</code></a></td><td><code>use randrange instead of randint</code></td></tr></table>




---

archive/issue_comments_474214.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI like `randrange` much better. It is much more intuitive if you are used to `range`. (But reading the very short docstring that was exactly the point of introducing it.)",
    "created_at": "2020-08-15T08:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474214",
    "user": "https://github.com/kliem"
}
```

<div id="comment:14" align="right">comment:14</div>

I like `randrange` much better. It is much more intuitive if you are used to `range`. (But reading the very short docstring that was exactly the point of introducing it.)



---

archive/issue_comments_474215.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIn fact, I think we want to import it from prandom\n\n```\nfrom sage.misc.prandom import randrange  \n```\nin order for it to depend on the `--random-seed`.",
    "created_at": "2020-08-15T08:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474215",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:15" align="right">comment:15</div>

In fact, I think we want to import it from prandom

```
from sage.misc.prandom import randrange  
```
in order for it to depend on the `--random-seed`.



---

archive/issue_comments_474216.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI was wondering about what the point was of duplicating that thing.",
    "created_at": "2020-08-15T08:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474216",
    "user": "https://github.com/kliem"
}
```

<div id="comment:16" align="right">comment:16</div>

I was wondering about what the point was of duplicating that thing.



---

archive/issue_comments_474217.json:
```json
{
    "body": "Changed commit from **[`a391a3e`](https://github.com/sagemath/sagetrac-mirror/commit/a391a3ebe2be270302b55f2360aeb53390d02492)** to **[`928863f`](https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d)**",
    "created_at": "2020-08-15T08:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474217",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a391a3e`](https://github.com/sagemath/sagetrac-mirror/commit/a391a3ebe2be270302b55f2360aeb53390d02492)** to **[`928863f`](https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d)**



---

archive/issue_comments_474218.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d\"><code>928863f</code></a></td><td><code>import randrange from the correct place</code></td></tr></table>\n",
    "created_at": "2020-08-15T08:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474218",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d"><code>928863f</code></a></td><td><code>import randrange from the correct place</code></td></tr></table>




---

archive/issue_events_409612.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-08-15T08:59:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409612"
}
```



---

archive/issue_events_409613.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-08-15T08:59:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409613"
}
```



---

archive/issue_comments_474219.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThank you.",
    "created_at": "2020-08-15T10:18:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474219",
    "user": "https://github.com/kliem"
}
```

<div id="comment:19" align="right">comment:19</div>

Thank you.



---

archive/issue_events_409614.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-16T22:33:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409614"
}
```



---

archive/issue_events_409615.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "842a6866f12dc8ed96cc9f10f828c872dfb8e73a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-08-16T22:33:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29974#event-409615"
}
```



---

archive/issue_comments_474220.json:
```json
{
    "body": "Changed branch from **[public/29974-reb2](https://github.com/sagemath/sagetrac-mirror/tree/public/29974-reb2)** to **[`928863f`](https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d)**",
    "created_at": "2020-08-16T22:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474220",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/29974-reb2](https://github.com/sagemath/sagetrac-mirror/tree/public/29974-reb2)** to **[`928863f`](https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d)**



---

archive/issue_comments_474221.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,16 @@\n+Part of #29935.\n+\n This ticket makes\n \n ```\n sage -t --long --random-seed=n src/sage/combinat/\n ```\n-pass for different values `n` than just `0`.\n+pass for `n` more general than just `0`.\n \n-See also: #30186 containment check for standard bracketed lyndon words does not work.\n+See also:\n+- #30186 containment check for standard bracketed Lyndon words does not work.\n \n-Along the way we fix a tiny but annoying bug, where random dearangments could fail, because `randint(0,n)` has range `range(0,n+1)`. \n+Along the way we fix a tiny but annoying bug, where random derangements could fail.\n+\n+That was because `randint(0, n)` has range `range(0, n + 1)`,\n+which had caused confusion.\n``````\n",
    "created_at": "2021-04-29T22:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474221",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,16 @@
+Part of #29935.
+
 This ticket makes
 
 ```
 sage -t --long --random-seed=n src/sage/combinat/
 ```
-pass for different values `n` than just `0`.
+pass for `n` more general than just `0`.
 
-See also: #30186 containment check for standard bracketed lyndon words does not work.
+See also:
+- #30186 containment check for standard bracketed Lyndon words does not work.
 
-Along the way we fix a tiny but annoying bug, where random dearangments could fail, because `randint(0,n)` has range `range(0,n+1)`. 
+Along the way we fix a tiny but annoying bug, where random derangements could fail.
+
+That was because `randint(0, n)` has range `range(0, n + 1)`,
+which had caused confusion.
``````




---

archive/issue_comments_474222.json:
```json
{
    "body": "Changed commit from **[`928863f`](https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d)** to none",
    "created_at": "2021-04-29T22:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29974",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29974#issuecomment-474222",
    "user": "https://github.com/slel"
}
```

Changed commit from **[`928863f`](https://github.com/sagemath/sagetrac-mirror/commit/928863f09ef7659221ca42d5038cf19f1e690d9d)** to none
