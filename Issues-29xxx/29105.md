# Issue 29105: tox.ini, build/bin/write-dockerfile.sh: Add gentoo linux, add more gentoo packages

archive/issues_028868.json:
```json
{
    "assignees": [],
    "body": "As a followup to #29053 and #29273, we\n- extend `build/bin/write-dockerfile.sh` to generate a Dockerfile using https://hub.docker.com/r/sheerluck/sage-on-gentoo-stage4\n- add `build/pkgs/gentoo*.txt`\n- extend `bin/sage-print-system-package-command` to handle gentoo\n- add gentoo to the platforms tested in [GitHub](../wiki/GitHub) CI.\n\nTo test: `tox -e docker-gentoo-standard`\n\nThis is a part of:\n- #29060: Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n\n---\n\nResources:\n- https://forums.gentoo.org/viewtopic-t-969278-start-0.html\n- cschwan/sage-on-gentoo: (Unofficial) Gentoo Overlay for Sage- and Sage-related ebuilds: https://github.com/cschwan/sage-on-gentoo\n- Project:Overlays/Old User Guide - Gentoo Wiki: https://wiki.gentoo.org/wiki/Project:Overlays/Old_User_Guide\n- Layman - Gentoo Wiki: https://wiki.gentoo.org/wiki/Layman\n\n\nDepends on #29273\n\n**CC:**  @orlitzky @kiwifb @dimpase @sheerluck\n\n**Branch:** [9959ee996823a796140a70e6b3ee16d45d7b1314](https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314)\n\n**Reviewer:** Matthias Koeppe\n\n**Author:** Andrey Belgorodski\n\nIssue created by migration from https://trac.sagemath.org/ticket/29105\n\n",
    "closed_at": "2020-06-27T09:26:45Z",
    "created_at": "2020-01-30T02:29:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20porting",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "tox.ini, build/bin/write-dockerfile.sh: Add gentoo linux, add more gentoo packages",
    "type": "issue",
    "updated_at": "2021-10-12T11:53:13Z",
    "url": "https://github.com/sagemath/sage/issues/29105",
    "user": "https://github.com/mkoeppe"
}
```
As a followup to #29053 and #29273, we
- extend `build/bin/write-dockerfile.sh` to generate a Dockerfile using https://hub.docker.com/r/sheerluck/sage-on-gentoo-stage4
- add `build/pkgs/gentoo*.txt`
- extend `bin/sage-print-system-package-command` to handle gentoo
- add gentoo to the platforms tested in [GitHub](../wiki/GitHub) CI.

To test: `tox -e docker-gentoo-standard`

This is a part of:
- #29060: Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages

---

Resources:
- https://forums.gentoo.org/viewtopic-t-969278-start-0.html
- cschwan/sage-on-gentoo: (Unofficial) Gentoo Overlay for Sage- and Sage-related ebuilds: https://github.com/cschwan/sage-on-gentoo
- Project:Overlays/Old User Guide - Gentoo Wiki: https://wiki.gentoo.org/wiki/Project:Overlays/Old_User_Guide
- Layman - Gentoo Wiki: https://wiki.gentoo.org/wiki/Layman


Depends on #29273

**CC:**  @orlitzky @kiwifb @dimpase @sheerluck

**Branch:** [9959ee996823a796140a70e6b3ee16d45d7b1314](https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314)

**Reviewer:** Matthias Koeppe

**Author:** Andrey Belgorodski

Issue created by migration from https://trac.sagemath.org/ticket/29105





---

archive/issue_events_350817.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-30T02:29:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350817"
}
```



---

archive/issue_events_350818.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-30T02:29:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting",
    "label_color": "08517b",
    "label_name": "component: porting",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350818"
}
```



---

archive/issue_events_350819.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-30T02:29:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350819"
}
```



---

archive/issue_comments_458679.json:
```json
{
    "body": "<a id='comment:1'></a>\nCreating a dockerfile for setting up sage prerequisites on a Gentoo \"prefix\" was previously discussed in #28905.\n\nAn attempt (incomplete) is at https://github.com/sagemath/sage/files/ticket28905/Dockerfile-sage_gentoo.gz and would need help from Gentoo experts.",
    "created_at": "2020-01-30T02:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458679",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
Creating a dockerfile for setting up sage prerequisites on a Gentoo "prefix" was previously discussed in #28905.

An attempt (incomplete) is at https://github.com/sagemath/sage/files/ticket28905/Dockerfile-sage_gentoo.gz and would need help from Gentoo experts.



---

archive/issue_comments_458680.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we\n - add files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages\n-- extend `build/bin/write-dockerfile` to generate a Dockerfile for a gentoo \"prefix\" build.\n+- extend `build/bin/write-dockerfile` to generate a Dockerfile for a gentoo \"prefix\" build - for rigorous multi-platform testing.\n \n This is a part of:\n - #29060: Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n``````\n",
    "created_at": "2020-01-30T02:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458680",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we
 - add files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages
-- extend `build/bin/write-dockerfile` to generate a Dockerfile for a gentoo "prefix" build.
+- extend `build/bin/write-dockerfile` to generate a Dockerfile for a gentoo "prefix" build - for rigorous multi-platform testing.
 
 This is a part of:
 - #29060: Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages
``````




---

archive/issue_comments_458681.json:
```json
{
    "body": "<a id='comment:2'></a>\n`compiler can't create executables` in a configure phase of gcc typically means the compiler can't find libgmp and al. Do you have a log for me to review? Prefix on ubuntu is definitely supported. The only thing I can think of is that the bootstrap usually object being run as root.",
    "created_at": "2020-01-30T03:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458681",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
`compiler can't create executables` in a configure phase of gcc typically means the compiler can't find libgmp and al. Do you have a log for me to review? Prefix on ubuntu is definitely supported. The only thing I can think of is that the bootstrap usually object being run as root.



---

archive/issue_comments_458682.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks, yes, turns out this was not specific to the gentoo prefix installer. I had to add some more packages. Let me see how far I get with this.",
    "created_at": "2020-01-30T03:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458682",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Thanks, yes, turns out this was not specific to the gentoo prefix installer. I had to add some more packages. Let me see how far I get with this.



---

archive/issue_comments_458683.json:
```json
{
    "body": "**Attachment:** [gentoo-log-2.txt](https://github.com/sagemath/sage/files/ticket29105/gentoo-log-2.txt)",
    "created_at": "2020-01-30T04:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458683",
    "user": "https://github.com/mkoeppe"
}
```

**Attachment:** [gentoo-log-2.txt](https://github.com/sagemath/sage/files/ticket29105/gentoo-log-2.txt)



---

archive/issue_comments_458684.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Attachment:** [Dockerfile-sage_gentoo.gz](https://github.com/sagemath/sage/files/ticket29105/Dockerfile-sage_gentoo.gz)\n\nOK... this is where I got now. The `./bootstrap-prefix.sh` script was claiming to bootstrap some packages - such as xz and patch - and succeeded with that; but then it was missing \"xz\" to unpack the Python sources. I think something is wrong there, but I added xz&patch in ubuntu. This is attached Dockerfile-sage_gentoo and log from 'docker build' with that. \n\nAs you can see in the log, now it's complaining about a module missing in the Python that it just built:\n\n```\n  File \"/gentoo/var/tmp/python-3.6.10/Python-3.6.10/Lib/xml/parsers/expat.py\", line 4, in <module>\n    from pyexpat import *\nModuleNotFoundError: No module named 'pyexpat'\nmake: *** [install] Error 1\nMakefile:1102: recipe for target 'install' failed\n??? Python failed to install *sigh* continuing anyway\n* Python bootstrapped\nhttp://distfiles.gentoo.org/snapshots\n```\nand then dies with:\n\n```\n* Compiling prefix-portage\n./configure --host=x86_64-pc-linux-gnu --prefix=/gentoo/tmp/usr --mandir=/gentoo/tmp/usr/share/man --infodir=/gentoo/tmp/usr/share/info --datadir=/gentoo/tmp/usr/share --sysconfdir=/gentoo/tmp/etc --localstatedir=/gentoo/tmp/var/lib --build=x86_64-pc-linux-gnu --with-offset-prefix=/gentoo/tmp --with-portage-user=root --with-portage-group=root --with-extra-path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nchecking build system type... x86_64-pc-linux-gnu\nchecking host system type... x86_64-pc-linux-gnu\nchecking target system type... x86_64-pc-linux-gnu\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... no\nchecking for mawk... mawk\n....\nchecking whether /usr/bin/id is good enough... yes\nchecking for python... no\nconfigure: error: no python found in your path\n```",
    "created_at": "2020-01-30T04:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458684",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
**Attachment:** [Dockerfile-sage_gentoo.gz](https://github.com/sagemath/sage/files/ticket29105/Dockerfile-sage_gentoo.gz)

OK... this is where I got now. The `./bootstrap-prefix.sh` script was claiming to bootstrap some packages - such as xz and patch - and succeeded with that; but then it was missing "xz" to unpack the Python sources. I think something is wrong there, but I added xz&patch in ubuntu. This is attached Dockerfile-sage_gentoo and log from 'docker build' with that. 

As you can see in the log, now it's complaining about a module missing in the Python that it just built:

```
  File "/gentoo/var/tmp/python-3.6.10/Python-3.6.10/Lib/xml/parsers/expat.py", line 4, in <module>
    from pyexpat import *
ModuleNotFoundError: No module named 'pyexpat'
make: *** [install] Error 1
Makefile:1102: recipe for target 'install' failed
??? Python failed to install *sigh* continuing anyway
* Python bootstrapped
http://distfiles.gentoo.org/snapshots
```
and then dies with:

```
* Compiling prefix-portage
./configure --host=x86_64-pc-linux-gnu --prefix=/gentoo/tmp/usr --mandir=/gentoo/tmp/usr/share/man --infodir=/gentoo/tmp/usr/share/info --datadir=/gentoo/tmp/usr/share --sysconfdir=/gentoo/tmp/etc --localstatedir=/gentoo/tmp/var/lib --build=x86_64-pc-linux-gnu --with-offset-prefix=/gentoo/tmp --with-portage-user=root --with-portage-group=root --with-extra-path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
checking build system type... x86_64-pc-linux-gnu
checking host system type... x86_64-pc-linux-gnu
checking target system type... x86_64-pc-linux-gnu
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... no
checking for mawk... mawk
....
checking whether /usr/bin/id is good enough... yes
checking for python... no
configure: error: no python found in your path
```



---

archive/issue_comments_458685.json:
```json
{
    "body": "<a id='comment:5'></a>\n`xz` is rearing up its head again. Yes it should be an early one. Because many more sources are in .xz I am not shocked that it should be a pre-requisite along with patch. The pyexpat stuff is weird. I'll do some experimenting later. I haven't really touched prefix since ppc64 was retired (because I didn't want or could maintain it long term).",
    "created_at": "2020-01-30T04:22:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458685",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
`xz` is rearing up its head again. Yes it should be an early one. Because many more sources are in .xz I am not shocked that it should be a pre-requisite along with patch. The pyexpat stuff is weird. I'll do some experimenting later. I haven't really touched prefix since ppc64 was retired (because I didn't want or could maintain it long term).



---

archive/issue_comments_458686.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,18 @@\n As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we\n - add files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages\n-- extend `build/bin/write-dockerfile` to generate a Dockerfile for a gentoo \"prefix\" build - for rigorous multi-platform testing.\n+- extend `build/bin/write-dockerfile` to \n+   - generate a Dockerfile using https://hub.docker.com/r/gentoo/stage3-amd64/tags\n+   - generate a Dockerfile for a gentoo \"prefix\" build on top of some Linux distribution\n+  for rigorous multi-platform testing.\n \n This is a part of:\n - #29060: Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n+\n+---\n+\n+Resources:\n+- https://forums.gentoo.org/viewtopic-t-969278-start-0.html\n+- cschwan/sage-on-gentoo: (Unofficial) Gentoo Overlay for Sage- and Sage-related ebuilds: https://github.com/cschwan/sage-on-gentoo\n+- Project:Overlays/Old User Guide - Gentoo Wiki: https://wiki.gentoo.org/wiki/Project:Overlays/Old_User_Guide\n+- Layman - Gentoo Wiki: https://wiki.gentoo.org/wiki/Layman\n+\n``````\n",
    "created_at": "2020-02-12T03:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458686",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,18 @@
 As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we
 - add files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages
-- extend `build/bin/write-dockerfile` to generate a Dockerfile for a gentoo "prefix" build - for rigorous multi-platform testing.
+- extend `build/bin/write-dockerfile` to 
+   - generate a Dockerfile using https://hub.docker.com/r/gentoo/stage3-amd64/tags
+   - generate a Dockerfile for a gentoo "prefix" build on top of some Linux distribution
+  for rigorous multi-platform testing.
 
 This is a part of:
 - #29060: Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages
+
+---
+
+Resources:
+- https://forums.gentoo.org/viewtopic-t-969278-start-0.html
+- cschwan/sage-on-gentoo: (Unofficial) Gentoo Overlay for Sage- and Sage-related ebuilds: https://github.com/cschwan/sage-on-gentoo
+- Project:Overlays/Old User Guide - Gentoo Wiki: https://wiki.gentoo.org/wiki/Project:Overlays/Old_User_Guide
+- Layman - Gentoo Wiki: https://wiki.gentoo.org/wiki/Layman
+
``````




---

archive/issue_comments_458687.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n-As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we\n-- add files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages\n-- extend `build/bin/write-dockerfile` to \n+As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we are adding files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages in #29273.\n+\n+In this ticket, \n+- we extend `build/bin/write-dockerfile` to \n    - generate a Dockerfile using https://hub.docker.com/r/gentoo/stage3-amd64/tags\n    - generate a Dockerfile for a gentoo \"prefix\" build on top of some Linux distribution\n   for rigorous multi-platform testing.\n``````\n",
    "created_at": "2020-03-04T00:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458687",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
-As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we
-- add files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages
-- extend `build/bin/write-dockerfile` to 
+As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we are adding files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages in #29273.
+
+In this ticket, 
+- we extend `build/bin/write-dockerfile` to 
    - generate a Dockerfile using https://hub.docker.com/r/gentoo/stage3-amd64/tags
    - generate a Dockerfile for a gentoo "prefix" build on top of some Linux distribution
   for rigorous multi-platform testing.
``````




---

archive/issue_events_350820.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-04T00:52:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "rename": {
        "from": "Add gentoo package information, extend dockerfile generator to gentoo",
        "to": "Extend dockerfile generator to gentoo"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350820"
}
```



---

archive/issue_comments_458688.json:
```json
{
    "body": "**Dependencies:** #29273",
    "created_at": "2020-03-04T00:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458688",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #29273



---

archive/issue_comments_458689.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis tickets needs help from someone who actually uses Gentoo. I found the instructions for installing stuff inadequate.",
    "created_at": "2020-03-04T00:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458689",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
This tickets needs help from someone who actually uses Gentoo. I found the instructions for installing stuff inadequate.



---

archive/issue_comments_458690.json:
```json
{
    "body": "<a id='comment:10'></a>\nI use Gentoo, but neither prefix, not docker.",
    "created_at": "2020-03-04T01:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458690",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
I use Gentoo, but neither prefix, not docker.



---

archive/issue_comments_458691.json:
```json
{
    "body": "<a id='comment:11'></a>\nI need to make time for this. I cannot give you a time frame.",
    "created_at": "2020-03-04T01:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458691",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
I need to make time for this. I cannot give you a time frame.



---

archive/issue_comments_458692.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@dimpase](#comment%3A10):\n> I use Gentoo, but [...] not docker.\n\nAfter installing a docker client, it only takes \n\n```\ndocker run -it gentoo/stage3-amd64\n```\nThis gives you root prompt. I would need instructions on what to do next to install relevant gentoo packages here.",
    "created_at": "2020-03-04T01:19:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458692",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Replying to [@dimpase](#comment%3A10):
> I use Gentoo, but [...] not docker.

After installing a docker client, it only takes 

```
docker run -it gentoo/stage3-amd64
```
This gives you root prompt. I would need instructions on what to do next to install relevant gentoo packages here.



---

archive/issue_comments_458693.json:
```json
{
    "body": "<a id='comment:13'></a>\nIf I understand well you have a minimal gentoo image running now. What do you want to install? Do you have a list somewhere?",
    "created_at": "2020-03-04T01:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458693",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
If I understand well you have a minimal gentoo image running now. What do you want to install? Do you have a list somewhere?



---

archive/issue_comments_458694.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@kiwifb](#comment%3A13):\n> If I understand well you have a minimal gentoo image running now. What do you want to install? Do you have a list somewhere?\n\nThe equivalent of the lists in  build/pkgs/debian-bootstrap.txt and build/pkgs/debian.txt (minimal requirements for bootstrapping and building) -- which would be added in #29273 as well since gentoo packages are being added there.",
    "created_at": "2020-03-04T01:45:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458694",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Replying to [@kiwifb](#comment%3A13):
> If I understand well you have a minimal gentoo image running now. What do you want to install? Do you have a list somewhere?

The equivalent of the lists in  build/pkgs/debian-bootstrap.txt and build/pkgs/debian.txt (minimal requirements for bootstrapping and building) -- which would be added in #29273 as well since gentoo packages are being added there.



---

archive/issue_comments_458695.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@mkoeppe](#comment%3A12):\n> Replying to [@dimpase](#comment%3A10):\n> > I use Gentoo, but [...] not docker.\n\n> \n> After installing a docker client, it only takes \n> \n> ```\n> docker run -it gentoo/stage3-amd64\n> ```\n> This gives you root prompt. I would need instructions on what to do next to install relevant gentoo packages here. \n\nI can try either this or Gentoo in lxc container, if such a thing exists somewhere.",
    "created_at": "2020-03-05T20:26:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458695",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Replying to [@mkoeppe](#comment%3A12):
> Replying to [@dimpase](#comment%3A10):
> > I use Gentoo, but [...] not docker.

> 
> After installing a docker client, it only takes 
> 
> ```
> docker run -it gentoo/stage3-amd64
> ```
> This gives you root prompt. I would need instructions on what to do next to install relevant gentoo packages here. 

I can try either this or Gentoo in lxc container, if such a thing exists somewhere.



---

archive/issue_comments_458696.json:
```json
{
    "body": "<a id='comment:16'></a>\nDocker please because that's what my tox.ini infrastructure uses.\nIf we want to do the same with lxc instead of docker, why not, but perhaps one step at a time?",
    "created_at": "2020-03-05T20:31:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458696",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Docker please because that's what my tox.ini infrastructure uses.
If we want to do the same with lxc instead of docker, why not, but perhaps one step at a time?



---

archive/issue_comments_458697.json:
```json
{
    "body": "<a id='comment:17'></a>\nI have created ticket #29283 for the goal of lxc containers for testing, in case someone wants to work on that.",
    "created_at": "2020-03-18T03:13:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458697",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
I have created ticket #29283 for the goal of lxc containers for testing, in case someone wants to work on that.



---

archive/issue_events_350821.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-18T03:15:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "rename": {
        "from": "Extend dockerfile generator to gentoo",
        "to": "Extend dockerfile generator to gentoo, add more gentoo packages"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350821"
}
```



---

archive/issue_events_350822.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T06:20:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350822"
}
```



---

archive/issue_events_350823.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T06:20:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350823"
}
```



---

archive/issue_comments_458698.json:
```json
{
    "body": "<a id='comment:21'></a>\nStarting points for people who want to help with this:\n- https://doc.sagemath.org/html/en/developer/portability_testing.html \n- https://researchseminars.org/talk/SageDays109/7/",
    "created_at": "2020-06-14T12:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458698",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Starting points for people who want to help with this:
- https://doc.sagemath.org/html/en/developer/portability_testing.html 
- https://researchseminars.org/talk/SageDays109/7/



---

archive/issue_comments_458699.json:
```json
{
    "body": "<a id='comment:22'></a>\nWhen I run `tox -e docker-gentoo` I get half-baked `sage/.tox/docker-gentoo/Dockerfile`, I need a way to shove the hand-crafted `Dockerfile` instead (for debugging purposes). What is the best way to do it?",
    "created_at": "2020-06-15T17:34:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458699",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:22'></a>
When I run `tox -e docker-gentoo` I get half-baked `sage/.tox/docker-gentoo/Dockerfile`, I need a way to shove the hand-crafted `Dockerfile` instead (for debugging purposes). What is the best way to do it?



---

archive/issue_comments_458700.json:
```json
{
    "body": "<a id='comment:23'></a>\nDoes your handcrafted Dockerfile work with `docker build` already?",
    "created_at": "2020-06-15T17:45:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458700",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Does your handcrafted Dockerfile work with `docker build` already?



---

archive/issue_comments_458701.json:
```json
{
    "body": "<a id='comment:24'></a>\nYou could insert a line before `    # From https://hub.docker.com/r/multiarch/ubuntu-core/\n`\nthat says\n\n```\n    docker-gentoo:  bash -c 'whatever command to create a handcrafted {envdir}/Dockerfile'    \n\n```",
    "created_at": "2020-06-15T17:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458701",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
You could insert a line before `    # From https://hub.docker.com/r/multiarch/ubuntu-core/
`
that says

```
    docker-gentoo:  bash -c 'whatever command to create a handcrafted {envdir}/Dockerfile'    

```



---

archive/issue_comments_458702.json:
```json
{
    "body": "<a id='comment:25'></a>\nSo right after\n\n```\ndocker:        bash -c 'build/bin/write-dockerfile.sh  ... > {envdir}/Dockerfile'\n```\nThank you!",
    "created_at": "2020-06-15T17:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458702",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:25'></a>
So right after

```
docker:        bash -c 'build/bin/write-dockerfile.sh  ... > {envdir}/Dockerfile'
```
Thank you!



---

archive/issue_comments_458703.json:
```json
{
    "body": "**Attachment:** [docker-gentoo-installed.txt](https://github.com/sagemath/sage/files/ticket29105/docker-gentoo-installed.txt)\n\ndocker-gentoo-installed.txt",
    "created_at": "2020-06-15T21:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458703",
    "user": "https://github.com/sheerluck"
}
```

**Attachment:** [docker-gentoo-installed.txt](https://github.com/sagemath/sage/files/ticket29105/docker-gentoo-installed.txt)

docker-gentoo-installed.txt



---

archive/issue_comments_458704.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe work is still in progress.\nI managed to install 555 packages.",
    "created_at": "2020-06-15T21:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458704",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:26'></a>
The work is still in progress.
I managed to install 555 packages.



---

archive/issue_comments_458705.json:
```json
{
    "body": "<a id='comment:27'></a>\nNice",
    "created_at": "2020-06-15T21:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458705",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Nice



---

archive/issue_comments_458706.json:
```json
{
    "body": "<a id='comment:28'></a>\n\n```\nreal    14m14.888s\nuser    98m59.353s\nsys     3m4.286s\nSAGE_CHECK=warn, so scanning the log files. This may take a few seconds.\nSage build/upgrade complete!\nmake[1]: Leaving directory '/sage'\nRemoving intermediate container e0e5bbfb22ea\n ---> 14316b24894b\n[Warning] One or more build-args [TARGETS_OPTIONAL] were not consumed\nSuccessfully built 14316b24894b\nSuccessfully tagged sage-docker-gentoo-standard-with-targets:9.2.beta1-dirty\n_________________________ summary __________________________\n  docker-gentoo-standard: commands succeeded\n  congratulations :)\n```\n\n1) run `docker build -t fbissey/sage-on-gentoo-stage4:20.6 -t fbissey/sage-on-gentoo-stage4:latest -f Dockerfile_gentoo-20.06-gcc9-py37 .`  \n\n2) patch `tox.ini` and `write-dockerfile.sh`",
    "created_at": "2020-06-16T16:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458706",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:28'></a>

```
real    14m14.888s
user    98m59.353s
sys     3m4.286s
SAGE_CHECK=warn, so scanning the log files. This may take a few seconds.
Sage build/upgrade complete!
make[1]: Leaving directory '/sage'
Removing intermediate container e0e5bbfb22ea
 ---> 14316b24894b
[Warning] One or more build-args [TARGETS_OPTIONAL] were not consumed
Successfully built 14316b24894b
Successfully tagged sage-docker-gentoo-standard-with-targets:9.2.beta1-dirty
_________________________ summary __________________________
  docker-gentoo-standard: commands succeeded
  congratulations :)
```

1) run `docker build -t fbissey/sage-on-gentoo-stage4:20.6 -t fbissey/sage-on-gentoo-stage4:latest -f Dockerfile_gentoo-20.06-gcc9-py37 .`  

2) patch `tox.ini` and `write-dockerfile.sh`



---

archive/issue_comments_458707.json:
```json
{
    "body": "**Attachment:** [tox.ini.patch.gz](https://github.com/sagemath/sage/files/ticket29105/tox.ini.patch.gz)",
    "created_at": "2020-06-16T16:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458707",
    "user": "https://github.com/sheerluck"
}
```

**Attachment:** [tox.ini.patch.gz](https://github.com/sagemath/sage/files/ticket29105/tox.ini.patch.gz)



---

archive/issue_comments_458708.json:
```json
{
    "body": "**Attachment:** [write-dockerfile.sh.patch.gz](https://github.com/sagemath/sage/files/ticket29105/write-dockerfile.sh.patch.gz)",
    "created_at": "2020-06-16T16:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458708",
    "user": "https://github.com/sheerluck"
}
```

**Attachment:** [write-dockerfile.sh.patch.gz](https://github.com/sagemath/sage/files/ticket29105/write-dockerfile.sh.patch.gz)



---

archive/issue_comments_458709.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Attachment:** [Dockerfile_gentoo-20.06-gcc9-py37.gz](https://github.com/sagemath/sage/files/ticket29105/Dockerfile_gentoo-20.06-gcc9-py37.gz)\n\nhttps://hub.docker.com/r/fbissey/sage-on-gentoo-stage/tags ... this does not seem to exist yet?",
    "created_at": "2020-06-16T16:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458709",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
**Attachment:** [Dockerfile_gentoo-20.06-gcc9-py37.gz](https://github.com/sagemath/sage/files/ticket29105/Dockerfile_gentoo-20.06-gcc9-py37.gz)

https://hub.docker.com/r/fbissey/sage-on-gentoo-stage/tags ... this does not seem to exist yet?



---

archive/issue_comments_458710.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [@mkoeppe](#comment%3A29):\n> https://hub.docker.com/r/fbissey/sage-on-gentoo-stage/tags ... this does not seem to exist yet?\n\nIt does not exist. Someone have to decide where to store an image. I have no idea, my docker-fu is weak.",
    "created_at": "2020-06-16T16:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458710",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:30'></a>
Replying to [@mkoeppe](#comment%3A29):
> https://hub.docker.com/r/fbissey/sage-on-gentoo-stage/tags ... this does not seem to exist yet?

It does not exist. Someone have to decide where to store an image. I have no idea, my docker-fu is weak.



---

archive/issue_comments_458711.json:
```json
{
    "body": "<a id='comment:31'></a>\nWhy not create an account on docker hub? Next step: https://docs.docker.com/docker-hub/builds/",
    "created_at": "2020-06-16T17:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458711",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Why not create an account on docker hub? Next step: https://docs.docker.com/docker-hub/builds/



---

archive/issue_comments_458712.json:
```json
{
    "body": "<a id='comment:32'></a>\nI am working on `Dockerfile_gentoo-20.06-gcc9-py37`\u200b to make image size much much smaller :(",
    "created_at": "2020-06-17T04:47:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458712",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:32'></a>
I am working on `Dockerfile_gentoo-20.06-gcc9-py37`â€‹ to make image size much much smaller :(



---

archive/issue_comments_458713.json:
```json
{
    "body": "<a id='comment:33'></a>\n`docker pull sheerluck/sage-on-gentoo-stage4:latest`",
    "created_at": "2020-06-17T12:07:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458713",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:33'></a>
`docker pull sheerluck/sage-on-gentoo-stage4:latest`



---

archive/issue_comments_458714.json:
```json
{
    "body": "<a id='comment:34'></a>\n\n```\n$ docker run -it sheerluck/sage-on-gentoo-stage4 /bin/bash\ncf6f39e01c4a / # ipython --no-banner\n\nIn [1]: from os import walk\n   ...: pth, ext = \"/var/db/pkg\", \".ebuild\"\n   ...: lex, res = len(ext), []\n   ...: for _, _, u in walk(pth):\n   ...:     res += [x[:-lex] for x in u if x.endswith(ext)]\n   ...: for  pkg  in sorted(res): print(pkg)\nAlnuth-3.1.1\nApp-pwhich-1.150.0\nAuthen-SASL-2.160.0-r1\n...\nzn_poly-0.9.2\nzope-interface-4.7.1\nzstd-1.4.4-r4\nzziplib-0.13.69-r1\n```",
    "created_at": "2020-06-17T12:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458714",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:34'></a>

```
$ docker run -it sheerluck/sage-on-gentoo-stage4 /bin/bash
cf6f39e01c4a / # ipython --no-banner

In [1]: from os import walk
   ...: pth, ext = "/var/db/pkg", ".ebuild"
   ...: lex, res = len(ext), []
   ...: for _, _, u in walk(pth):
   ...:     res += [x[:-lex] for x in u if x.endswith(ext)]
   ...: for  pkg  in sorted(res): print(pkg)
Alnuth-3.1.1
App-pwhich-1.150.0
Authen-SASL-2.160.0-r1
...
zn_poly-0.9.2
zope-interface-4.7.1
zstd-1.4.4-r4
zziplib-0.13.69-r1
```



---

archive/issue_comments_458715.json:
```json
{
    "body": "<a id='comment:35'></a>\nAwesome!",
    "created_at": "2020-06-17T15:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458715",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Awesome!



---

archive/issue_comments_458716.json:
```json
{
    "body": "<a id='comment:36'></a>\nCould you put the changes to the sage scripts on a git branch please?",
    "created_at": "2020-06-18T19:48:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458716",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Could you put the changes to the sage scripts on a git branch please?



---

archive/issue_comments_458717.json:
```json
{
    "body": "<a id='comment:37'></a>\n\n```\n$ git push trac HEAD:u/gh-sheerluck/gentoo\n...\nTo trac.sagemath.org:sage.git\n * [new branch]            HEAD -> u/gh-sheerluck/gentoo\n```",
    "created_at": "2020-06-18T20:45:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458717",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:37'></a>

```
$ git push trac HEAD:u/gh-sheerluck/gentoo
...
To trac.sagemath.org:sage.git
 * [new branch]            HEAD -> u/gh-sheerluck/gentoo
```



---

archive/issue_comments_458718.json:
```json
{
    "body": "**Branch:** [u/gh-sheerluck/gentoo](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-sheerluck/gentoo)",
    "created_at": "2020-06-18T21:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458718",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/gh-sheerluck/gentoo](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-sheerluck/gentoo)



---

archive/issue_comments_458719.json:
```json
{
    "body": "<a id='comment:38'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25d05792b7d44103de445e2e591393f3e5ef3862\">25d0579</a></td><td><code>write-dockerfile.sh is extended to support gentoo</code></td></tr></table>\n",
    "created_at": "2020-06-18T21:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458719",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25d05792b7d44103de445e2e591393f3e5ef3862">25d0579</a></td><td><code>write-dockerfile.sh is extended to support gentoo</code></td></tr></table>




---

archive/issue_comments_458720.json:
```json
{
    "body": "**Commit:** [25d05792b7d44103de445e2e591393f3e5ef3862](https://github.com/sagemath/sagetrac-mirror/commit/25d05792b7d44103de445e2e591393f3e5ef3862)",
    "created_at": "2020-06-18T21:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458720",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [25d05792b7d44103de445e2e591393f3e5ef3862](https://github.com/sagemath/sagetrac-mirror/commit/25d05792b7d44103de445e2e591393f3e5ef3862)



---

archive/issue_comments_458721.json:
```json
{
    "body": "<a id='comment:39'></a>\n\n```\nsed: ./build/pkgs/gentoo.txt: No such file or directory\nsed: ./build/pkgs/gentoo-bootstrap.txt: No such file or directory\n```",
    "created_at": "2020-06-18T22:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458721",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>

```
sed: ./build/pkgs/gentoo.txt: No such file or directory
sed: ./build/pkgs/gentoo-bootstrap.txt: No such file or directory
```



---

archive/issue_comments_458722.json:
```json
{
    "body": "<a id='comment:40'></a>\nAlso, at the end of `configure`, I see:\n\n```\nconfigure: notice: the following SPKGs did not find equivalent system packages: cbc eclib gp2c isl lcalc libsemigroups pandoc pari pari_elldata pari_galdata pari_galpol pari_nftables pari_seadata pari_seadata_small perl_cpan_polymake_prereq perl_term_readline_gnu r yasm\nchecking for the package system in use... gentoo\nconfigure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:\nconfigure: # install the following packages: sci-mathematics/eclib[flint] sci-mathematics/gp2c dev-libs/isl app-text/pandoc sci-mathematics/pari sci-mathematics/pari-data XML-Writer XML-LibXML XML-LibXSLT File-Slurp dev-perl/Term-ReadLine-Gnu JSON SVG dev-perl/MongoDB dev-perl/Term-ReadLine-Gnu dev-lang/R\n```\nCould you update `build/bin/sage-print-system-package-command` so that an actual installation command is displayed?",
    "created_at": "2020-06-18T22:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458722",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
Also, at the end of `configure`, I see:

```
configure: notice: the following SPKGs did not find equivalent system packages: cbc eclib gp2c isl lcalc libsemigroups pandoc pari pari_elldata pari_galdata pari_galpol pari_nftables pari_seadata pari_seadata_small perl_cpan_polymake_prereq perl_term_readline_gnu r yasm
checking for the package system in use... gentoo
configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:
configure: # install the following packages: sci-mathematics/eclib[flint] sci-mathematics/gp2c dev-libs/isl app-text/pandoc sci-mathematics/pari sci-mathematics/pari-data XML-Writer XML-LibXML XML-LibXSLT File-Slurp dev-perl/Term-ReadLine-Gnu JSON SVG dev-perl/MongoDB dev-perl/Term-ReadLine-Gnu dev-lang/R
```
Could you update `build/bin/sage-print-system-package-command` so that an actual installation command is displayed?



---

archive/issue_comments_458723.json:
```json
{
    "body": "<a id='comment:41'></a>\nI added `gentoo.txt` and `gentoo-bootstrap.txt` and updated `sage-print-system-package-command` and I am going to refresh `sheerluck/sage-on-gentoo-stage4:latest` with additional packages (except `pandoc`) and after testing I will push in `u/gh-sheerluck/gentoo` branch",
    "created_at": "2020-06-19T06:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458723",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:41'></a>
I added `gentoo.txt` and `gentoo-bootstrap.txt` and updated `sage-print-system-package-command` and I am going to refresh `sheerluck/sage-on-gentoo-stage4:latest` with additional packages (except `pandoc`) and after testing I will push in `u/gh-sheerluck/gentoo` branch



---

archive/issue_comments_458724.json:
```json
{
    "body": "**Changing commit** from \"[25d05792b7d44103de445e2e591393f3e5ef3862](https://github.com/sagemath/sagetrac-mirror/commit/25d05792b7d44103de445e2e591393f3e5ef3862)\" to \"[c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf](https://github.com/sagemath/sagetrac-mirror/commit/c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf)\".",
    "created_at": "2020-06-19T12:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458724",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[25d05792b7d44103de445e2e591393f3e5ef3862](https://github.com/sagemath/sagetrac-mirror/commit/25d05792b7d44103de445e2e591393f3e5ef3862)" to "[c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf](https://github.com/sagemath/sagetrac-mirror/commit/c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf)".



---

archive/issue_comments_458725.json:
```json
{
    "body": "<a id='comment:42'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf\">c55cfa9</a></td><td><code>sage-print-system-package-command updated</code></td></tr></table>\n",
    "created_at": "2020-06-19T12:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458725",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:42'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf">c55cfa9</a></td><td><code>sage-print-system-package-command updated</code></td></tr></table>




---

archive/issue_comments_458726.json:
```json
{
    "body": "<a id='comment:43'></a>\nNow `configure` says \"configure:   $ sudo emerge sci-mathematics/eclib[flint] sci-mathematics/gp2c app-text/pandoc sci-mathematics/pari sci-mathematics/pari-data XML-Writer XML-LibXML XML-LibXSLT File-Slurp dev-perl/Term-ReadLine-Gnu JSON SVG dev-perl/MongoDB dev-lang/R\" although everything is installed in `sheerluck/sage-on-gentoo-stage4:latest` (except `pandoc`)",
    "created_at": "2020-06-19T12:54:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458726",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:43'></a>
Now `configure` says "configure:   $ sudo emerge sci-mathematics/eclib[flint] sci-mathematics/gp2c app-text/pandoc sci-mathematics/pari sci-mathematics/pari-data XML-Writer XML-LibXML XML-LibXSLT File-Slurp dev-perl/Term-ReadLine-Gnu JSON SVG dev-perl/MongoDB dev-lang/R" although everything is installed in `sheerluck/sage-on-gentoo-stage4:latest` (except `pandoc`)



---

archive/issue_comments_458727.json:
```json
{
    "body": "<a id='comment:44'></a>\nFor `sci-mathematics/eclib[flint]`, please check whether this syntax does whatever was intended there. See previous discussion in #29273.\n\n`config.log` should give information on why a particular package was rejected by `configure`.",
    "created_at": "2020-06-19T15:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458727",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
For `sci-mathematics/eclib[flint]`, please check whether this syntax does whatever was intended there. See previous discussion in #29273.

`config.log` should give information on why a particular package was rejected by `configure`.



---

archive/issue_comments_458728.json:
```json
{
    "body": "<a id='comment:45'></a>\nReading `config.log` is fascinating.\n\nFor example,  \"cbc >= 2.9.4\" might refer to `sci-libs/coinor-cbc-2.10.5` (https://github.com/coin-or/Cbc)\n\nWIP",
    "created_at": "2020-06-19T17:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458728",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:45'></a>
Reading `config.log` is fascinating.

For example,  "cbc >= 2.9.4" might refer to `sci-libs/coinor-cbc-2.10.5` (https://github.com/coin-or/Cbc)

WIP



---

archive/issue_comments_458729.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [@sheerluck](#comment%3A43):\n> Now `configure` says \"configure:   $ sudo emerge sci-mathematics/eclib[flint] sci-mathematics/gp2c app-text/pandoc sci-mathematics/pari sci-mathematics/pari-data XML-Writer XML-LibXML XML-LibXSLT File-Slurp dev-perl/Term-ReadLine-Gnu JSON SVG dev-perl/MongoDB dev-lang/R\" although everything is installed in `sheerluck/sage-on-gentoo-stage4:latest` (except `pandoc`)\n> \n\n`USE=flint sudo emerge sci-mathematics/eclib`? I am not completely sure `USE` is passed to the `sudo` environment that way. I am not sure how many people use `sudo` on their Gentoo system either. It is not quite the default. I would go\n\n```\nUSE=flint su -c \"emerge sci-mathematics/eclib\"\n```",
    "created_at": "2020-06-19T20:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458729",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:46'></a>
Replying to [@sheerluck](#comment%3A43):
> Now `configure` says "configure:   $ sudo emerge sci-mathematics/eclib[flint] sci-mathematics/gp2c app-text/pandoc sci-mathematics/pari sci-mathematics/pari-data XML-Writer XML-LibXML XML-LibXSLT File-Slurp dev-perl/Term-ReadLine-Gnu JSON SVG dev-perl/MongoDB dev-lang/R" although everything is installed in `sheerluck/sage-on-gentoo-stage4:latest` (except `pandoc`)
> 

`USE=flint sudo emerge sci-mathematics/eclib`? I am not completely sure `USE` is passed to the `sudo` environment that way. I am not sure how many people use `sudo` on their Gentoo system either. It is not quite the default. I would go

```
USE=flint su -c "emerge sci-mathematics/eclib"
```



---

archive/issue_comments_458730.json:
```json
{
    "body": "<a id='comment:47'></a>\nYou can leave off the sudo/su command. It's understood that you should have root privileges to use it, and if not, emerge itself will tell you.\n\nThe `emerge a[foo] b[bar]` syntax isn't right but there is no one-line command that does what we want. The closest thing is `USE=\"foo bar\" emerge a b`, but the next time the user updates his system those `USE` flags will be lost. It also has the side effect of enabling `USE=foo` for `b` and `USE=bar` for `a`, which may not work. What should really be done is to place\n\n```\na foo\nb bar\n```\n\nin `/etc/portage/package.use`, or whatever is equivalent for pkgcore (the other Gentoo package manager). Pkgcore has its own, different, installation commands too.\n\nThe `a[foo]` syntax does make sense in users' heads, so to keep things simple, we could probably just have it say \"install the following packages: a[foo] b[bar]\", or something like that.",
    "created_at": "2020-06-19T20:42:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458730",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:47'></a>
You can leave off the sudo/su command. It's understood that you should have root privileges to use it, and if not, emerge itself will tell you.

The `emerge a[foo] b[bar]` syntax isn't right but there is no one-line command that does what we want. The closest thing is `USE="foo bar" emerge a b`, but the next time the user updates his system those `USE` flags will be lost. It also has the side effect of enabling `USE=foo` for `b` and `USE=bar` for `a`, which may not work. What should really be done is to place

```
a foo
b bar
```

in `/etc/portage/package.use`, or whatever is equivalent for pkgcore (the other Gentoo package manager). Pkgcore has its own, different, installation commands too.

The `a[foo]` syntax does make sense in users' heads, so to keep things simple, we could probably just have it say "install the following packages: a[foo] b[bar]", or something like that.



---

archive/issue_comments_458731.json:
```json
{
    "body": "<a id='comment:48'></a>\nDo not worry about USE flags. Every USE flag in `sheerluck/sage-on-gentoo-stage4:latest` already is correct, because Dockerfile uses \"sage-on-gentoo\" overlay. If suddenly we need `sys-devel/bc[foo]` I will go to https://github.com/cschwan/sage-on-gentoo/issues, wait for @kiwifb and then refresh latest image. There is no need to have two conflicting places for USE flags, overlay is enough",
    "created_at": "2020-06-19T21:06:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458731",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:48'></a>
Do not worry about USE flags. Every USE flag in `sheerluck/sage-on-gentoo-stage4:latest` already is correct, because Dockerfile uses "sage-on-gentoo" overlay. If suddenly we need `sys-devel/bc[foo]` I will go to https://github.com/cschwan/sage-on-gentoo/issues, wait for @kiwifb and then refresh latest image. There is no need to have two conflicting places for USE flags, overlay is enough



---

archive/issue_comments_458732.json:
```json
{
    "body": "<a id='comment:49'></a>\nI was referring only to,\n\n> Now configure says \"configure: $ sudo emerge sci-mathematics/eclib[flint]\n\nwhich won't work =)",
    "created_at": "2020-06-19T21:09:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458732",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:49'></a>
I was referring only to,

> Now configure says "configure: $ sudo emerge sci-mathematics/eclib[flint]

which won't work =)



---

archive/issue_comments_458733.json:
```json
{
    "body": "<a id='comment:50'></a>\nI also thought it won't work but I tried and it works. Maybe there's a bug in portage =)",
    "created_at": "2020-06-19T21:16:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458733",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:50'></a>
I also thought it won't work but I tried and it works. Maybe there's a bug in portage =)



---

archive/issue_comments_458734.json:
```json
{
    "body": "<a id='comment:51'></a>\nOk, you got me, I had no idea that worked!\n\nIt still won't automatically enable the USE flag if it's not set, you get something like\n\n```\n$ emerge -pv1 sci-mathematics/eclib[flint]\n...\nThe following USE changes are necessary to proceed:\n (see \"package.use\" in the portage(5) man page for more details)\n# required by sci-mathematics/eclib[flint] (argument)\n>=sci-mathematics/eclib-20190909 flint\n```\n\nbut that's fine. It's telling you to do the right thing.",
    "created_at": "2020-06-19T21:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458734",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:51'></a>
Ok, you got me, I had no idea that worked!

It still won't automatically enable the USE flag if it's not set, you get something like

```
$ emerge -pv1 sci-mathematics/eclib[flint]
...
The following USE changes are necessary to proceed:
 (see "package.use" in the portage(5) man page for more details)
# required by sci-mathematics/eclib[flint] (argument)
>=sci-mathematics/eclib-20190909 flint
```

but that's fine. It's telling you to do the right thing.



---

archive/issue_comments_458735.json:
```json
{
    "body": "<a id='comment:52'></a>\nThat's interesting it is basically processed like an atom dependency from an ebuild. It is probably designed so the dependency list can be feed as is to emerge.",
    "created_at": "2020-06-20T01:19:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458735",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:52'></a>
That's interesting it is basically processed like an atom dependency from an ebuild. It is probably designed so the dependency list can be feed as is to emerge.



---

archive/issue_comments_458736.json:
```json
{
    "body": "<a id='comment:53'></a>\nhttps://github.com/cschwan/sage-on-gentoo/pull/591\n\nThanks to @kiwifb, today I used the `repoman` for the first time in my life.",
    "created_at": "2020-06-20T12:02:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458736",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:53'></a>
https://github.com/cschwan/sage-on-gentoo/pull/591

Thanks to @kiwifb, today I used the `repoman` for the first time in my life.



---

archive/issue_comments_458737.json:
```json
{
    "body": "<a id='comment:54'></a>\n\n```\n will be installed as an SPKG      already installed in latest image\n===============================================================================\n alabaster-0.7.12                  dev-python/alabaster-0.7.12\n appnope-0.1.0.p0                  \n babel-2.6.0                       dev-python/Babel-2.8.0-r1\n backports_abc-0.5                 \n backports_functools_lru_cache-1.5 \n backports_shutil_get_terminal_size\n backports_ssl_match_hostname-3.5.0\n bleach-3.1.0                      dev-python/bleach-3.1.4-r1\n brial-1.2.8                       sci-libs/brial-1.2.8\n certifi-2019.3.9                  dev-python/certifi-2020.4.5.1\n combinatorial_designs-20140630.p0 sci-mathematics/sage-data-combinatorial_designs-20140630\n configparser-3.7.4                \n conway_polynomials-0.5            sci-mathematics/sage-data-conway_polynomials-0.5\n cvxopt-1.2.3                      dev-python/cvxopt-1.2.5-r1\n cycler-0.10.0.p0                  dev-python/cycler-0.10.0-r1\n cypari-2.1.1                      dev-python/cypari2-2.1.1\n cysignals-1.10.2                  dev-python/cysignals-1.10.2\n cython-0.29.17                    dev-python/cython-0.29.19\n dateutil-2.8.1                    \n decorator-4.4.0                   dev-python/decorator-4.4.2\n defusedxml-0.6.0                  \n docutils-0.14                     dev-python/docutils-0.16\n ecl-16.1.2.p5                     dev-lisp/ecls-16.1.2-r1\n elliptic_curves-0.8.1             sci-mathematics/sage-data-elliptic_curves-0.8\n entrypoints-0.3                   dev-python/entrypoints-0.3-r1\n enum34-1.1.6                      \n fpylll-0.5.1dev                   dev-python/fpylll-0.5.1\n functools32-3.2.3-2.p0            \n future-0.17.1                     dev-python/future-0.18.2\n gap-4.10.2.p1                     sci-mathematics/gap-4.10.2-r1\n gc-8.0.4                          \n giac-1.5.0.63-p0                  sci-mathematics/giac-1.5.0.87\n gmpy2-2.1.0b1                     dev-python/gmpy-2.1.0_beta1-r1\n graphs-20161026.p0                sci-mathematics/sage-data-graphs-20161026\n html5lib-1.0.1                    dev-python/html5lib-1.0.1-r2\n imagesize-1.1.0                   dev-python/imagesize-1.1.0\n ipaddress-1.0.22                  \n ipykernel-4.8.2                   dev-python/ipykernel-5.1.4\n ipython-5.8.0                     dev-python/ipython-7.5.0\n ipython_genutils-0.2.0            dev-python/ipython_genutils-0.2.0\n ipywidgets-7.4.2                  dev-python/ipywidgets-7.4.2-r1\n itsdangerous-1.1.0                \n jinja2-2.10                       dev-python/jinja-2.11.1\n jmol-14.29.52                     \n jsonschema-2.6.0                  dev-python/jsonschema-3.0.1\n jupyter_client-5.2.4              dev-python/jupyter_client-5.2.3-r1\n jupyter_core-4.4.0                dev-python/jupyter_core-4.6.1-r1\n kiwisolver-1.0.1                  dev-python/kiwisolver-1.0.1\n libhomfly-1.02r4.p0               sci-libs/libhomfly-1.02.5\n linbox-1.6.3.p0                   sci-libs/linbox-1.6.3\n markupsafe-1.1.0                  dev-python/markupsafe-1.1.1\n mathjax-2.7.4.p0                  dev-libs/mathjax-2.7.7\n matplotlib-3.2.1                  dev-python/matplotlib-3.1.2  (3.2.1 available)\n maxima-5.42.2                     sci-mathematics/maxima-5.42.2\n mistune-0.8.4                     dev-python/mistune-0.8.4\n mpmath-1.1.0                      dev-python/mpmath-1.1.0\n nbconvert-5.4.0                   dev-python/nbconvert-5.2.1 (5.6.1 available)\n nbformat-4.4.0                    dev-python/nbformat-4.4.0-r1\n networkx-2.2                      dev-python/networkx-2.4-r2\n nose-1.3.7                        \n notebook-5.7.6.p0                 dev-python/notebook-5.7.8\n numpy-1.16.6                      dev-python/numpy-1.17.4-r3\n packaging-18.0                    dev-python/packaging-20.3\n palp-2.1.p2                       sci-mathematics/palp-2.11-r1\n pandocfilters-1.4.2               dev-python/pandocfilters-1.4.2-r1\n pathlib2-2.3.3                    \n pathpy-7.1.p0                     dev-python/path-py-12.0.2-r2\n pexpect-4.6.0.p0                  dev-python/pexpect-4.6.0\n pickleshare-0.7.5                 dev-python/pickleshare-0.7.4-r1\n pillow-5.3.0.p0                   dev-python/pillow-7.0.0\n pip-18.1                          \n pkgconfig-1.5.1                   dev-python/pkgconfig-1.5.1\n polytopes_db-20170220.p0          sci-mathematics/sage-data-polytopes_db-20170220\n pplpy-0.8.4                       dev-python/pplpy-0.8.4-r2\n prometheus_client-0.5.0           dev-python/prometheus_client-0.7.1-r1\n prompt_toolkit-1.0.15             dev-python/prompt_toolkit-2.0.10\n psutil-5.2.0.p2                   dev-python/psutil-5.7.0\n ptyprocess-0.5.1.p0               dev-python/ptyprocess-0.6.0\n pycygwin-0.1                      \n pygments-2.3.1.p0                 dev-python/pygments-2.6.1\n pynac-0.7.26.sage-2020-04-03      sci-libs/pynac-0.7.26\n pyparsing-2.3.0                   dev-python/pyparsing-2.4.6\n pytz-2018.7                       dev-python/pytz-2019.3\n pyzmq-19.0.0                      dev-python/pyzmq-19.0.0\n ratpoints-2.1.3.p5                sci-mathematics/ratpoints-2.1.3-r4\n requests-2.13.0                   dev-python/requests-2.23.0\n rpy2-2.8.2.p1                     dev-python/rpy-2.9.0\n rubiks-20070912.p21               \n sage_brial-1.2.8                  dev-python/sage-brial-1.2.8\n sage_conf-none                    \n sagenb_export-3.3                 sci-mathematics/ExportSageNB-3.3\n sagetex-3.4                       \n scandir-1.9.0                     \n scipy-1.2.3                       sci-libs/scipy-1.4.1\n send2trash-1.5.0                  \n setuptools-40.6.3                 dev-python/send2trash-1.5.0-r1\n setuptools_scm-3.1.0              dev-python/setuptools_scm-3.5.0\n simplegeneric-0.8.1.p0            \n singledispatch-3.4.0.3.p0         \n singular-4.1.1p2.p0               sci-mathematics/singular-4.1.1_p2-r2\n six-1.12.0                        dev-python/six-1.14.0\n snowballstemmer-1.2.1.p0          dev-python/snowballstemmer-2.0.0\n sphinx-1.8.5.p0                   dev-python/sphinx-3.0.4\n sphinxcontrib_websupport-1.1.0    \n subprocess32-3.5.3                \n sympy-1.5                         dev-python/sympy-1.5.1-r1\n terminado-0.8.1                   dev-python/terminado-0.8.3\n testpath-0.4.2                    dev-python/testpath-0.3.1\n thebe-9624e0a0.p0                 www-misc/thebe-20160525\n threejs-r110                      media-gfx/threejs-sage-extension-110\n tornado-4.5.2                     www-servers/tornado-6.0.4\n traitlets-4.3.3                   dev-python/traitlets-4.3.2\n typing-3.6.6                      \n vcversioner-2.16.0.0.p0           dev-python/vcversioner-2.16.0.0\n wcwidth-0.1.7.p0                  dev-python/wcwidth-0.1.9\n webencodings-0.5.1                dev-python/webencodings-0.5.1-r1\n werkzeug-0.14.1                   \n widgetsnbextension-3.4.2          dev-python/widgetsnbextension-3.4.2\n zn_poly-0.9.1.p0                  sci-libs/zn_poly-0.9.2\n zope_interface-4.6.0              dev-python/zope-interface-4.7.1     \n\n```",
    "created_at": "2020-06-21T18:52:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458737",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:54'></a>

```
 will be installed as an SPKG      already installed in latest image
===============================================================================
 alabaster-0.7.12                  dev-python/alabaster-0.7.12
 appnope-0.1.0.p0                  
 babel-2.6.0                       dev-python/Babel-2.8.0-r1
 backports_abc-0.5                 
 backports_functools_lru_cache-1.5 
 backports_shutil_get_terminal_size
 backports_ssl_match_hostname-3.5.0
 bleach-3.1.0                      dev-python/bleach-3.1.4-r1
 brial-1.2.8                       sci-libs/brial-1.2.8
 certifi-2019.3.9                  dev-python/certifi-2020.4.5.1
 combinatorial_designs-20140630.p0 sci-mathematics/sage-data-combinatorial_designs-20140630
 configparser-3.7.4                
 conway_polynomials-0.5            sci-mathematics/sage-data-conway_polynomials-0.5
 cvxopt-1.2.3                      dev-python/cvxopt-1.2.5-r1
 cycler-0.10.0.p0                  dev-python/cycler-0.10.0-r1
 cypari-2.1.1                      dev-python/cypari2-2.1.1
 cysignals-1.10.2                  dev-python/cysignals-1.10.2
 cython-0.29.17                    dev-python/cython-0.29.19
 dateutil-2.8.1                    
 decorator-4.4.0                   dev-python/decorator-4.4.2
 defusedxml-0.6.0                  
 docutils-0.14                     dev-python/docutils-0.16
 ecl-16.1.2.p5                     dev-lisp/ecls-16.1.2-r1
 elliptic_curves-0.8.1             sci-mathematics/sage-data-elliptic_curves-0.8
 entrypoints-0.3                   dev-python/entrypoints-0.3-r1
 enum34-1.1.6                      
 fpylll-0.5.1dev                   dev-python/fpylll-0.5.1
 functools32-3.2.3-2.p0            
 future-0.17.1                     dev-python/future-0.18.2
 gap-4.10.2.p1                     sci-mathematics/gap-4.10.2-r1
 gc-8.0.4                          
 giac-1.5.0.63-p0                  sci-mathematics/giac-1.5.0.87
 gmpy2-2.1.0b1                     dev-python/gmpy-2.1.0_beta1-r1
 graphs-20161026.p0                sci-mathematics/sage-data-graphs-20161026
 html5lib-1.0.1                    dev-python/html5lib-1.0.1-r2
 imagesize-1.1.0                   dev-python/imagesize-1.1.0
 ipaddress-1.0.22                  
 ipykernel-4.8.2                   dev-python/ipykernel-5.1.4
 ipython-5.8.0                     dev-python/ipython-7.5.0
 ipython_genutils-0.2.0            dev-python/ipython_genutils-0.2.0
 ipywidgets-7.4.2                  dev-python/ipywidgets-7.4.2-r1
 itsdangerous-1.1.0                
 jinja2-2.10                       dev-python/jinja-2.11.1
 jmol-14.29.52                     
 jsonschema-2.6.0                  dev-python/jsonschema-3.0.1
 jupyter_client-5.2.4              dev-python/jupyter_client-5.2.3-r1
 jupyter_core-4.4.0                dev-python/jupyter_core-4.6.1-r1
 kiwisolver-1.0.1                  dev-python/kiwisolver-1.0.1
 libhomfly-1.02r4.p0               sci-libs/libhomfly-1.02.5
 linbox-1.6.3.p0                   sci-libs/linbox-1.6.3
 markupsafe-1.1.0                  dev-python/markupsafe-1.1.1
 mathjax-2.7.4.p0                  dev-libs/mathjax-2.7.7
 matplotlib-3.2.1                  dev-python/matplotlib-3.1.2  (3.2.1 available)
 maxima-5.42.2                     sci-mathematics/maxima-5.42.2
 mistune-0.8.4                     dev-python/mistune-0.8.4
 mpmath-1.1.0                      dev-python/mpmath-1.1.0
 nbconvert-5.4.0                   dev-python/nbconvert-5.2.1 (5.6.1 available)
 nbformat-4.4.0                    dev-python/nbformat-4.4.0-r1
 networkx-2.2                      dev-python/networkx-2.4-r2
 nose-1.3.7                        
 notebook-5.7.6.p0                 dev-python/notebook-5.7.8
 numpy-1.16.6                      dev-python/numpy-1.17.4-r3
 packaging-18.0                    dev-python/packaging-20.3
 palp-2.1.p2                       sci-mathematics/palp-2.11-r1
 pandocfilters-1.4.2               dev-python/pandocfilters-1.4.2-r1
 pathlib2-2.3.3                    
 pathpy-7.1.p0                     dev-python/path-py-12.0.2-r2
 pexpect-4.6.0.p0                  dev-python/pexpect-4.6.0
 pickleshare-0.7.5                 dev-python/pickleshare-0.7.4-r1
 pillow-5.3.0.p0                   dev-python/pillow-7.0.0
 pip-18.1                          
 pkgconfig-1.5.1                   dev-python/pkgconfig-1.5.1
 polytopes_db-20170220.p0          sci-mathematics/sage-data-polytopes_db-20170220
 pplpy-0.8.4                       dev-python/pplpy-0.8.4-r2
 prometheus_client-0.5.0           dev-python/prometheus_client-0.7.1-r1
 prompt_toolkit-1.0.15             dev-python/prompt_toolkit-2.0.10
 psutil-5.2.0.p2                   dev-python/psutil-5.7.0
 ptyprocess-0.5.1.p0               dev-python/ptyprocess-0.6.0
 pycygwin-0.1                      
 pygments-2.3.1.p0                 dev-python/pygments-2.6.1
 pynac-0.7.26.sage-2020-04-03      sci-libs/pynac-0.7.26
 pyparsing-2.3.0                   dev-python/pyparsing-2.4.6
 pytz-2018.7                       dev-python/pytz-2019.3
 pyzmq-19.0.0                      dev-python/pyzmq-19.0.0
 ratpoints-2.1.3.p5                sci-mathematics/ratpoints-2.1.3-r4
 requests-2.13.0                   dev-python/requests-2.23.0
 rpy2-2.8.2.p1                     dev-python/rpy-2.9.0
 rubiks-20070912.p21               
 sage_brial-1.2.8                  dev-python/sage-brial-1.2.8
 sage_conf-none                    
 sagenb_export-3.3                 sci-mathematics/ExportSageNB-3.3
 sagetex-3.4                       
 scandir-1.9.0                     
 scipy-1.2.3                       sci-libs/scipy-1.4.1
 send2trash-1.5.0                  
 setuptools-40.6.3                 dev-python/send2trash-1.5.0-r1
 setuptools_scm-3.1.0              dev-python/setuptools_scm-3.5.0
 simplegeneric-0.8.1.p0            
 singledispatch-3.4.0.3.p0         
 singular-4.1.1p2.p0               sci-mathematics/singular-4.1.1_p2-r2
 six-1.12.0                        dev-python/six-1.14.0
 snowballstemmer-1.2.1.p0          dev-python/snowballstemmer-2.0.0
 sphinx-1.8.5.p0                   dev-python/sphinx-3.0.4
 sphinxcontrib_websupport-1.1.0    
 subprocess32-3.5.3                
 sympy-1.5                         dev-python/sympy-1.5.1-r1
 terminado-0.8.1                   dev-python/terminado-0.8.3
 testpath-0.4.2                    dev-python/testpath-0.3.1
 thebe-9624e0a0.p0                 www-misc/thebe-20160525
 threejs-r110                      media-gfx/threejs-sage-extension-110
 tornado-4.5.2                     www-servers/tornado-6.0.4
 traitlets-4.3.3                   dev-python/traitlets-4.3.2
 typing-3.6.6                      
 vcversioner-2.16.0.0.p0           dev-python/vcversioner-2.16.0.0
 wcwidth-0.1.7.p0                  dev-python/wcwidth-0.1.9
 webencodings-0.5.1                dev-python/webencodings-0.5.1-r1
 werkzeug-0.14.1                   
 widgetsnbextension-3.4.2          dev-python/widgetsnbextension-3.4.2
 zn_poly-0.9.1.p0                  sci-libs/zn_poly-0.9.2
 zope_interface-4.6.0              dev-python/zope-interface-4.7.1     

```



---

archive/issue_comments_458738.json:
```json
{
    "body": "<a id='comment:55'></a>\n\n```\n$ docker run -it sheerluck/sage-on-gentoo-stage4 /bin/bash\n# python -c 'import sys, pkgutil; sys.exit(0 if pkgutil.find_loader(\"notinstalled\") else 1)'\n# echo $?\n1\n# python -c 'import sys, pkgutil; sys.exit(0 if pkgutil.find_loader(\"fpylll\") else 1)'\n# echo $?\n0\n# python -c 'import sys, pkgutil; sys.exit(0 if pkgutil.find_loader(\"numpy\") else 1)'\n# echo $?\n0\n```",
    "created_at": "2020-06-22T07:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458738",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:55'></a>

```
$ docker run -it sheerluck/sage-on-gentoo-stage4 /bin/bash
# python -c 'import sys, pkgutil; sys.exit(0 if pkgutil.find_loader("notinstalled") else 1)'
# echo $?
1
# python -c 'import sys, pkgutil; sys.exit(0 if pkgutil.find_loader("fpylll") else 1)'
# echo $?
0
# python -c 'import sys, pkgutil; sys.exit(0 if pkgutil.find_loader("numpy") else 1)'
# echo $?
0
```



---

archive/issue_comments_458739.json:
```json
{
    "body": "<a id='comment:56'></a>\nI read `m4/sage_spkg_configure.m4` and created `build/pkgs/numpy/spkg-configure.m4`\n\n```\nSAGE_SPKG_CONFIGURE([numpy], [\n    if build/bin/sage-system-python -c 'import pkgutil; exit(not pkgutil.find_loader(\"numpy\"))'; then\n      sage_spkg_install_numpy=no\n    else\n      sage_spkg_install_numpy=yes\n    fi  \n    if test x$sage_spkg_install_numpy = xyes; then\n      AC_MSG_RESULT([using Sage's numpy SPKG])\n    else\n      AC_MSG_RESULT([using numpy library from the system])\n    fi  \n])\n```\nand `tox -e docker-gentoo-standard` shows\n\n```\n-----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG numpy...\nusing numpy library from the system\nconfigure: will use system package and not install SPKG numpy\n-----------------------------------------------------------------------------\n...\nnumpy-1.16.6:                using system package; SPKG will not be installed\n```\n\nI can copy and paste that `spkg-configure.m4` for all `dev-python/*` packages\nfrom the list above. What do you think? Should I proceed?",
    "created_at": "2020-06-22T15:59:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458739",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:56'></a>
I read `m4/sage_spkg_configure.m4` and created `build/pkgs/numpy/spkg-configure.m4`

```
SAGE_SPKG_CONFIGURE([numpy], [
    if build/bin/sage-system-python -c 'import pkgutil; exit(not pkgutil.find_loader("numpy"))'; then
      sage_spkg_install_numpy=no
    else
      sage_spkg_install_numpy=yes
    fi  
    if test x$sage_spkg_install_numpy = xyes; then
      AC_MSG_RESULT([using Sage's numpy SPKG])
    else
      AC_MSG_RESULT([using numpy library from the system])
    fi  
])
```
and `tox -e docker-gentoo-standard` shows

```
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG numpy...
using numpy library from the system
configure: will use system package and not install SPKG numpy
-----------------------------------------------------------------------------
...
numpy-1.16.6:                using system package; SPKG will not be installed
```

I can copy and paste that `spkg-configure.m4` for all `dev-python/*` packages
from the list above. What do you think? Should I proceed?



---

archive/issue_comments_458740.json:
```json
{
    "body": "<a id='comment:57'></a>\nPlease don't. Sage-the-distribution does not use the system Python's site packages. We have a ticket for future work on that: #29023. It will definitely NOT go through spkg-configure.m4.",
    "created_at": "2020-06-22T16:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458740",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>
Please don't. Sage-the-distribution does not use the system Python's site packages. We have a ticket for future work on that: #29023. It will definitely NOT go through spkg-configure.m4.



---

archive/issue_comments_458741.json:
```json
{
    "body": "<a id='comment:58'></a>\nWhat's the status of the current branch? Is it ready for testing?",
    "created_at": "2020-06-22T16:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458741",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
What's the status of the current branch? Is it ready for testing?



---

archive/issue_comments_458742.json:
```json
{
    "body": "<a id='comment:59'></a>\nIt is ready",
    "created_at": "2020-06-22T16:25:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458742",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:59'></a>
It is ready



---

archive/issue_comments_458743.json:
```json
{
    "body": "<a id='comment:60'></a>\nAdd author name please and set to \"needs_review\" then",
    "created_at": "2020-06-22T17:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458743",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>
Add author name please and set to "needs_review" then



---

archive/issue_comments_458744.json:
```json
{
    "body": "<a id='comment:61'></a>\nAlso, could you edit `.github/workflows/tox.yml` and `tox-optional.yml`, adding `gentoo` to the list of tested systems?",
    "created_at": "2020-06-22T17:40:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458744",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'></a>
Also, could you edit `.github/workflows/tox.yml` and `tox-optional.yml`, adding `gentoo` to the list of tested systems?



---

archive/issue_comments_458745.json:
```json
{
    "body": "<a id='comment:62'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314\">9959ee9</a></td><td><code>tox_system_factor: gentoo</code></td></tr></table>\n",
    "created_at": "2020-06-22T18:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458745",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:62'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314">9959ee9</a></td><td><code>tox_system_factor: gentoo</code></td></tr></table>




---

archive/issue_comments_458746.json:
```json
{
    "body": "**Changing commit** from \"[c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf](https://github.com/sagemath/sagetrac-mirror/commit/c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf)\" to \"[9959ee996823a796140a70e6b3ee16d45d7b1314](https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314)\".",
    "created_at": "2020-06-22T18:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458746",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf](https://github.com/sagemath/sagetrac-mirror/commit/c55cfa9bd2d0d29df3cd5cc24be5b743eee8aadf)" to "[9959ee996823a796140a70e6b3ee16d45d7b1314](https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314)".



---

archive/issue_events_350824.json:
```json
{
    "actor": "https://github.com/sheerluck",
    "created_at": "2020-06-22T18:43:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350824"
}
```



---

archive/issue_comments_458747.json:
```json
{
    "body": "**Author:** gh-sheerluck",
    "created_at": "2020-06-22T18:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458747",
    "user": "https://github.com/sheerluck"
}
```

**Author:** gh-sheerluck



---

archive/issue_comments_458748.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe",
    "created_at": "2020-06-22T18:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458748",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe



---

archive/issue_comments_458749.json:
```json
{
    "body": "<a id='comment:65'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/144060041\nand https://github.com/mkoeppe/sage/actions/runs/144060039",
    "created_at": "2020-06-22T20:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458749",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/144060041
and https://github.com/mkoeppe/sage/actions/runs/144060039



---

archive/issue_comments_458750.json:
```json
{
    "body": "<a id='comment:66'></a>\nCould you update the ticket description so that it matches what is implemented?",
    "created_at": "2020-06-22T20:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458750",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>
Could you update the ticket description so that it matches what is implemented?



---

archive/issue_comments_458751.json:
```json
{
    "body": "<a id='comment:67'></a>\nI have hard time describing `git diff 9.2.beta1..u/gh-sheerluck/gentoo` , not much was implemented, most of the work is in https://github.com/sheerluck/sage-on-gentoo-stage4",
    "created_at": "2020-06-22T20:55:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458751",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:67'></a>
I have hard time describing `git diff 9.2.beta1..u/gh-sheerluck/gentoo` , not much was implemented, most of the work is in https://github.com/sheerluck/sage-on-gentoo-stage4



---

archive/issue_comments_458752.json:
```json
{
    "body": "<a id='comment:68'></a>\nIt would be enough to just update the sentence starting with \"In this ticket,\"",
    "created_at": "2020-06-22T20:57:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458752",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>
It would be enough to just update the sentence starting with "In this ticket,"



---

archive/issue_comments_458753.json:
```json
{
    "body": "<a id='comment:69'></a>\nMy mistake was I tried only `tox -e docker-gentoo-standard`\n\nI never tried \n\n`tox -e docker-gentoo-minimal -- build doc-html ptest`\n\n`tox -e docker-gentoo-standard -- build doc-html ptest`\n\n`tox -e docker-gentoo-maximal -- build doc-html ptest`\n\nI'm working on it",
    "created_at": "2020-06-23T09:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458753",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:69'></a>
My mistake was I tried only `tox -e docker-gentoo-standard`

I never tried 

`tox -e docker-gentoo-minimal -- build doc-html ptest`

`tox -e docker-gentoo-standard -- build doc-html ptest`

`tox -e docker-gentoo-maximal -- build doc-html ptest`

I'm working on it



---

archive/issue_events_350825.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-23T17:29:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350825"
}
```



---

archive/issue_events_350826.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-23T17:29:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350826"
}
```



---

archive/issue_comments_458754.json:
```json
{
    "body": "<a id='comment:71'></a>\nPrevious error was due `tachyon` package, latest image is fixed: SPKG version will be used.\n\nBoth `docker-gentoo-minimal` and `docker-gentoo-maximal` commands failed same way:\n\n```\nsage -t src/sage/lfunctions/dokchitser.py  # 2 doctests failed\nsage -t src/sage/lfunctions/pari.py  # 1 doctest failed\nsage -t src/sage/libs/glpk/error.pyx  # 1 doctest failed\nsage -t src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed\nsage -t src/sage/rings/number_field/number_field_element.pyx  # 1 doctest failed\nsage -t src/sage/rings/number_field/number_field_ideal.py  # 2 doctests failed\nsage -t src/sage/rings/number_field/number_field.py  # 7 doctests failed\nsage -t src/sage/rings/number_field/unit_group.py  # 1 doctest failed\nsage -t src/sage/rings/polynomial/polynomial_quotient_ring.py  # 2 doctests failed\nsage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # 2 doctests failed\n```",
    "created_at": "2020-06-24T13:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458754",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:71'></a>
Previous error was due `tachyon` package, latest image is fixed: SPKG version will be used.

Both `docker-gentoo-minimal` and `docker-gentoo-maximal` commands failed same way:

```
sage -t src/sage/lfunctions/dokchitser.py  # 2 doctests failed
sage -t src/sage/lfunctions/pari.py  # 1 doctest failed
sage -t src/sage/libs/glpk/error.pyx  # 1 doctest failed
sage -t src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed
sage -t src/sage/rings/number_field/number_field_element.pyx  # 1 doctest failed
sage -t src/sage/rings/number_field/number_field_ideal.py  # 2 doctests failed
sage -t src/sage/rings/number_field/number_field.py  # 7 doctests failed
sage -t src/sage/rings/number_field/unit_group.py  # 1 doctest failed
sage -t src/sage/rings/polynomial/polynomial_quotient_ring.py  # 2 doctests failed
sage -t src/sage/schemes/elliptic_curves/ell_number_field.py  # 2 doctests failed
```



---

archive/issue_events_350827.json:
```json
{
    "actor": "https://github.com/sheerluck",
    "created_at": "2020-06-24T13:19:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350827"
}
```



---

archive/issue_events_350828.json:
```json
{
    "actor": "https://github.com/sheerluck",
    "created_at": "2020-06-24T13:19:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350828"
}
```



---

archive/issue_comments_458755.json:
```json
{
    "body": "<a id='comment:73'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/146222291 and https://github.com/mkoeppe/sage/actions/runs/146222283",
    "created_at": "2020-06-24T18:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458755",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/146222291 and https://github.com/mkoeppe/sage/actions/runs/146222283



---

archive/issue_comments_458756.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n-As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we are adding files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages in #29273.\n+As a followup to #29053 and #29273, we\n+- extend `build/bin/write-dockerfile` to generate a Dockerfile using https://hub.docker.com/r/sheerluck/sage-on-gentoo-stage4\n+- add `build/pkgs/gentoo*.txt`\n+- extend `bin/sage-print-system-package-command` to handle gentoo\n+- add gentoo to the platforms tested in [GitHub](../wiki/GitHub) CI.\n \n-In this ticket, \n-- we extend `build/bin/write-dockerfile` to \n-   - generate a Dockerfile using https://hub.docker.com/r/gentoo/stage3-amd64/tags\n-   - generate a Dockerfile for a gentoo \"prefix\" build on top of some Linux distribution\n-  for rigorous multi-platform testing.\n+To test: `tox -e docker-gentoo-standard`\n \n This is a part of:\n - #29060: Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n``````\n",
    "created_at": "2020-06-24T19:01:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458756",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
-As a followup to #29053, in analogy to the work done for debian/fedora/arch/conda, we are adding files `build/pkgs/SPKG/distros/gentoo.txt` to keep track of equivalent distribution packages in #29273.
+As a followup to #29053 and #29273, we
+- extend `build/bin/write-dockerfile` to generate a Dockerfile using https://hub.docker.com/r/sheerluck/sage-on-gentoo-stage4
+- add `build/pkgs/gentoo*.txt`
+- extend `bin/sage-print-system-package-command` to handle gentoo
+- add gentoo to the platforms tested in [GitHub](../wiki/GitHub) CI.
 
-In this ticket, 
-- we extend `build/bin/write-dockerfile` to 
-   - generate a Dockerfile using https://hub.docker.com/r/gentoo/stage3-amd64/tags
-   - generate a Dockerfile for a gentoo "prefix" build on top of some Linux distribution
-  for rigorous multi-platform testing.
+To test: `tox -e docker-gentoo-standard`
 
 This is a part of:
 - #29060: Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages
``````




---

archive/issue_comments_458757.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n As a followup to #29053 and #29273, we\n-- extend `build/bin/write-dockerfile` to generate a Dockerfile using https://hub.docker.com/r/sheerluck/sage-on-gentoo-stage4\n+- extend `build/bin/write-dockerfile.sh` to generate a Dockerfile using https://hub.docker.com/r/sheerluck/sage-on-gentoo-stage4\n - add `build/pkgs/gentoo*.txt`\n - extend `bin/sage-print-system-package-command` to handle gentoo\n - add gentoo to the platforms tested in [GitHub](../wiki/GitHub) CI.\n``````\n",
    "created_at": "2020-06-24T19:03:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458757",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 As a followup to #29053 and #29273, we
-- extend `build/bin/write-dockerfile` to generate a Dockerfile using https://hub.docker.com/r/sheerluck/sage-on-gentoo-stage4
+- extend `build/bin/write-dockerfile.sh` to generate a Dockerfile using https://hub.docker.com/r/sheerluck/sage-on-gentoo-stage4
 - add `build/pkgs/gentoo*.txt`
 - extend `bin/sage-print-system-package-command` to handle gentoo
 - add gentoo to the platforms tested in [GitHub](../wiki/GitHub) CI.
``````




---

archive/issue_events_350829.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-24T19:03:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "rename": {
        "from": "Extend dockerfile generator to gentoo, add more gentoo packages",
        "to": "tox.ini, build/bin/write-dockerfile.sh: Add gentoo linux, add more gentoo packages"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350829"
}
```



---

archive/issue_events_350830.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-25T05:58:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350830"
}
```



---

archive/issue_events_350831.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-25T05:58:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350831"
}
```



---

archive/issue_comments_458758.json:
```json
{
    "body": "<a id='comment:76'></a>\nLooking great, thanks for this contribution. Would you mind setting \"Authors\" to a real name?",
    "created_at": "2020-06-25T05:58:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458758",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'></a>
Looking great, thanks for this contribution. Would you mind setting "Authors" to a real name?



---

archive/issue_comments_458759.json:
```json
{
    "body": "<a id='comment:77'></a>\nNext week in addition to existing `Dockerfile_gentoo-20.06-gcc9-py37`\n\nI plan to make\n\n`Dockerfile_gentoo-20.07-gcc9-py37` (with tags `20.07` and `latest`)\n\n`Dockerfile_gentoo-20.07-gcc9-py38` (with tags `py38-20.07` and `py38-latest`)\n\nAnd maybe even\n\n`Dockerfile_gentoo-20.07-clang10-py37`\n\n`Dockerfile_gentoo-20.07-clang10-py38`\n\ngcc-10 is not ready for this kind of fun yet",
    "created_at": "2020-06-25T06:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458759",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:77'></a>
Next week in addition to existing `Dockerfile_gentoo-20.06-gcc9-py37`

I plan to make

`Dockerfile_gentoo-20.07-gcc9-py37` (with tags `20.07` and `latest`)

`Dockerfile_gentoo-20.07-gcc9-py38` (with tags `py38-20.07` and `py38-latest`)

And maybe even

`Dockerfile_gentoo-20.07-clang10-py37`

`Dockerfile_gentoo-20.07-clang10-py38`

gcc-10 is not ready for this kind of fun yet



---

archive/issue_comments_458760.json:
```json
{
    "body": "<a id='comment:78'></a>\nauthor name should be Full Real Name, please !",
    "created_at": "2020-06-25T13:43:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458760",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:78'></a>
author name should be Full Real Name, please !



---

archive/issue_comments_458761.json:
```json
{
    "body": "**Changing author** from \"gh-sheerluck\" to \"Fran\u00e7ois Bissey\".",
    "created_at": "2020-06-25T18:15:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458761",
    "user": "https://github.com/sheerluck"
}
```

**Changing author** from "gh-sheerluck" to "FranÃ§ois Bissey".



---

archive/issue_comments_458762.json:
```json
{
    "body": "<a id='comment:80'></a>\nplot twist?",
    "created_at": "2020-06-25T18:27:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458762",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'></a>
plot twist?



---

archive/issue_comments_458763.json:
```json
{
    "body": "<a id='comment:81'></a>\nI didn't author any of these. I cannot claim responsibility. If you don't want your name to be published, say so and we may find something.",
    "created_at": "2020-06-25T20:08:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458763",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:81'></a>
I didn't author any of these. I cannot claim responsibility. If you don't want your name to be published, say so and we may find something.



---

archive/issue_comments_458764.json:
```json
{
    "body": "<a id='comment:82'></a>\nI don't want my name to be published",
    "created_at": "2020-06-25T20:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458764",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:82'></a>
I don't want my name to be published



---

archive/issue_comments_458765.json:
```json
{
    "body": "<a id='comment:83'></a>\nIn github, your are \"Andrew\" from Belgorod, Russia. What's your exact problem with our rule that contributors should give their full real name ?",
    "created_at": "2020-06-25T20:22:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458765",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:83'></a>
In github, your are "Andrew" from Belgorod, Russia. What's your exact problem with our rule that contributors should give their full real name ?



---

archive/issue_comments_458766.json:
```json
{
    "body": "**Changing author** from \"Fran\u00e7ois Bissey\" to \"Andrey Belgorodski\".",
    "created_at": "2020-06-25T22:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458766",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "FranÃ§ois Bissey" to "Andrey Belgorodski".



---

archive/issue_events_350832.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-06-27T09:26:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350832"
}
```



---

archive/issue_events_350833.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4896a87888023a5d7b7a9908eb619cfe20b59567",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-06-27T09:26:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29105#event-350833"
}
```



---

archive/issue_comments_458767.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-sheerluck/gentoo](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-sheerluck/gentoo)\" to \"[9959ee996823a796140a70e6b3ee16d45d7b1314](https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314)\".",
    "created_at": "2020-06-27T09:26:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458767",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-sheerluck/gentoo](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-sheerluck/gentoo)" to "[9959ee996823a796140a70e6b3ee16d45d7b1314](https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314)".



---

archive/issue_comments_458768.json:
```json
{
    "body": "<a id='comment:86'></a>\nWhat\u2019s New in `sheerluck/sage-on-gentoo-stage4:20.7`\n\n```\n1) base image:\n   FROM gentoo/portage:20200701 as portage\n   FROM gentoo/stage3-amd64:20200701\n\n2) python compiled with sqlite support\n   (fixes ModuleNotFoundError: No module named 'sqlite3')\n\n3) updates:\n   pandoc             2.9.2.1 -> 2.10 \n   sci-libs/amd       2.3.1   -> 2.4.6\n   sci-libs/cholmod   2.1.2   -> 3.0.13\n   sci-libs/colamd    2.8.0   -> 2.9.6\n   sci-libs/openblas  0.3.9   -> 0.3.9-r1\n   dev-lang/perl      5.30.1  -> 5.30.3\n   dev-lang/R         4.0.0   -> 4.0.2\n   sci-libs/umfpack   5.6.2   -> 5.7.9 \n```\nwith `latest` image only 1 doctest failed: combinat/cluster_algebra_quiver/quiver.py",
    "created_at": "2020-07-02T17:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458768",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:86'></a>
Whatâ€™s New in `sheerluck/sage-on-gentoo-stage4:20.7`

```
1) base image:
   FROM gentoo/portage:20200701 as portage
   FROM gentoo/stage3-amd64:20200701

2) python compiled with sqlite support
   (fixes ModuleNotFoundError: No module named 'sqlite3')

3) updates:
   pandoc             2.9.2.1 -> 2.10 
   sci-libs/amd       2.3.1   -> 2.4.6
   sci-libs/cholmod   2.1.2   -> 3.0.13
   sci-libs/colamd    2.8.0   -> 2.9.6
   sci-libs/openblas  0.3.9   -> 0.3.9-r1
   dev-lang/perl      5.30.1  -> 5.30.3
   dev-lang/R         4.0.0   -> 4.0.2
   sci-libs/umfpack   5.6.2   -> 5.7.9 
```
with `latest` image only 1 doctest failed: combinat/cluster_algebra_quiver/quiver.py



---

archive/issue_comments_458769.json:
```json
{
    "body": "**Changing commit** from \"[9959ee996823a796140a70e6b3ee16d45d7b1314](https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314)\" to \"\".",
    "created_at": "2020-07-02T17:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458769",
    "user": "https://github.com/sheerluck"
}
```

**Changing commit** from "[9959ee996823a796140a70e6b3ee16d45d7b1314](https://github.com/sagemath/sagetrac-mirror/commit/9959ee996823a796140a70e6b3ee16d45d7b1314)" to "".



---

archive/issue_comments_458770.json:
```json
{
    "body": "<a id='comment:87'></a>\nGreat! I am assuming no change to tox.ini is required?",
    "created_at": "2020-07-02T22:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458770",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:87'></a>
Great! I am assuming no change to tox.ini is required?



---

archive/issue_comments_458771.json:
```json
{
    "body": "<a id='comment:88'></a>\nno changes",
    "created_at": "2020-07-03T05:32:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458771",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:88'></a>
no changes



---

archive/issue_comments_458772.json:
```json
{
    "body": "<a id='comment:89'></a>\nLast error from https://github.com/mkoeppe/sage/actions, namely this one: \n\n```\nIt might be possible to solve this slot collision\nby applying all of the following changes:\n   - sci-libs/m4ri-20200125 (Change USE: +png)\n   - sci-libs/brial-1.2.8 (Change USE: +png)\n\nThe following USE changes are necessary to proceed:\n (see \"package.use\" in the portage(5) man page for more details)\n# required by sci-libs/brial-1.2.8::sage-on-gentoo\n# required by sci-libs/brial (argument)\n>=sci-libs/m4ri-20200125 -png \n```\nis solved with `png` for `sci-libs/brial` in `latest` image\n\n(checked on `u/mkoeppe/fix_tox_docker_builds_broken_by__29884`)",
    "created_at": "2020-07-06T11:02:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458772",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:89'></a>
Last error from https://github.com/mkoeppe/sage/actions, namely this one: 

```
It might be possible to solve this slot collision
by applying all of the following changes:
   - sci-libs/m4ri-20200125 (Change USE: +png)
   - sci-libs/brial-1.2.8 (Change USE: +png)

The following USE changes are necessary to proceed:
 (see "package.use" in the portage(5) man page for more details)
# required by sci-libs/brial-1.2.8::sage-on-gentoo
# required by sci-libs/brial (argument)
>=sci-libs/m4ri-20200125 -png 
```
is solved with `png` for `sci-libs/brial` in `latest` image

(checked on `u/mkoeppe/fix_tox_docker_builds_broken_by__29884`)



---

archive/issue_comments_458773.json:
```json
{
    "body": "<a id='comment:90'></a>\n\n```\n-----------------\nAll tests passed!\n-----------------\n____ summary ____\ndocker-gentoo-standard: commands succeeded\ncongratulations :)\n```",
    "created_at": "2020-07-06T19:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458773",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:90'></a>

```
-----------------
All tests passed!
-----------------
____ summary ____
docker-gentoo-standard: commands succeeded
congratulations :)
```



---

archive/issue_comments_458774.json:
```json
{
    "body": "<a id='comment:91'></a>\nI've created `latest-gcc10` in addition to\u2002`latest`. For fun. \n\n```\n version in            latest         latest-gcc10\n====================================================\n sys-devel/gcc         9.3.0          10.1.0-r2\n sci-libs/arpack       3.1.5          3.5.0\n sci-mathematics/gp2c  0.0.11.2-r1    0.0.11.3\n app-misc/rlwrap       0.42           0.43\n```\n\nBut `tox -e docker-gentoo-gcc10-maximal -- build doc-html doc-pdf ptest` says \n\n```\nchecking gcc version... 10.1.0\nchecking g++ version... 10.1.0\nconfigure: Installing GCC because g++ -std=gnu++11 is g++ version 10.1.0, which is too recent for this version of Sage \nconfigure: no suitable system package found for SPKG gcc\n```\n\nSage is not ready for gcc10 yet...\n\nbut if anyone wants to play with `latest-gcc10` it's available on hub.docker.com",
    "created_at": "2020-07-12T10:16:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458774",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:91'></a>
I've created `latest-gcc10` in addition toâ€‚`latest`. For fun. 

```
 version in            latest         latest-gcc10
====================================================
 sys-devel/gcc         9.3.0          10.1.0-r2
 sci-libs/arpack       3.1.5          3.5.0
 sci-mathematics/gp2c  0.0.11.2-r1    0.0.11.3
 app-misc/rlwrap       0.42           0.43
```

But `tox -e docker-gentoo-gcc10-maximal -- build doc-html doc-pdf ptest` says 

```
checking gcc version... 10.1.0
checking g++ version... 10.1.0
configure: Installing GCC because g++ -std=gnu++11 is g++ version 10.1.0, which is too recent for this version of Sage 
configure: no suitable system package found for SPKG gcc
```

Sage is not ready for gcc10 yet...

but if anyone wants to play with `latest-gcc10` it's available on hub.docker.com



---

archive/issue_comments_458775.json:
```json
{
    "body": "<a id='comment:92'></a>\nThanks. A related latest annoyance is that on macOS Homebrew provides gcc package, which is gcc-10, and this breaks things (even though only gfortran is used, not gcc).",
    "created_at": "2020-07-12T10:22:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458775",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:92'></a>
Thanks. A related latest annoyance is that on macOS Homebrew provides gcc package, which is gcc-10, and this breaks things (even though only gfortran is used, not gcc).



---

archive/issue_comments_458776.json:
```json
{
    "body": "<a id='comment:93'></a>\nWhat\u2019s New in `sheerluck/sage-on-gentoo-stage4:20.8`\n\n```\n1) base image:\n   FROM gentoo/portage:20200801 as portage\n   FROM gentoo/stage3-amd64:20200801\n\n2) updates:\n   arb                2.16.0  -> 2.18.0\n   arpack             3.1.5   -> 3.5.0\n   cython             0.29.19 -> 0.29.21 \n   flint              2.5.2   -> 2.6.0\n   fplll              5.3.2   -> 5.3.3\n   gp2c               0.11.2  -> 0.11.3\n   ipython            7.5.0   -> 7.16.1\n   matplotlib         3.1.2   -> 3.2.2\n   numpy              1.17.4  -> 1.19.1\n   pandas             1.0.1   -> 1.0.5\n   pandoc             2.10    -> 2.10.1\n   pillow             7.0.0   -> 7.1.2\n   python             3.7.7   -> 3.7.8\n   scipy              1.4.1   -> 1.5.2 \n   sqlite             3.31.1  -> 3.32.3\n```\nno changes to tox.ini is required",
    "created_at": "2020-08-01T19:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458776",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:93'></a>
Whatâ€™s New in `sheerluck/sage-on-gentoo-stage4:20.8`

```
1) base image:
   FROM gentoo/portage:20200801 as portage
   FROM gentoo/stage3-amd64:20200801

2) updates:
   arb                2.16.0  -> 2.18.0
   arpack             3.1.5   -> 3.5.0
   cython             0.29.19 -> 0.29.21 
   flint              2.5.2   -> 2.6.0
   fplll              5.3.2   -> 5.3.3
   gp2c               0.11.2  -> 0.11.3
   ipython            7.5.0   -> 7.16.1
   matplotlib         3.1.2   -> 3.2.2
   numpy              1.17.4  -> 1.19.1
   pandas             1.0.1   -> 1.0.5
   pandoc             2.10    -> 2.10.1
   pillow             7.0.0   -> 7.1.2
   python             3.7.7   -> 3.7.8
   scipy              1.4.1   -> 1.5.2 
   sqlite             3.31.1  -> 3.32.3
```
no changes to tox.ini is required



---

archive/issue_comments_458777.json:
```json
{
    "body": "<a id='comment:94'></a>\nGood news, everyone!\nWe used one `latest` image, now we have two images:\n* `latest` with python-3.8.5\n* `latest-py37` with python-3.7.8\n\n\n```\nchecking ... whether /usr/bin/python3 is good... no, Python 3.8.5 is too recent\n```\n\nno changes to tox.ini is required, unless we want to be prepared for #29023 when most of installed packages would be used, in that case we can have both \"gentoo\" and \"gentoo-py37\" in tox.ini",
    "created_at": "2020-08-04T17:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458777",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:94'></a>
Good news, everyone!
We used one `latest` image, now we have two images:
* `latest` with python-3.8.5
* `latest-py37` with python-3.7.8


```
checking ... whether /usr/bin/python3 is good... no, Python 3.8.5 is too recent
```

no changes to tox.ini is required, unless we want to be prepared for #29023 when most of installed packages would be used, in that case we can have both "gentoo" and "gentoo-py37" in tox.ini



---

archive/issue_comments_458778.json:
```json
{
    "body": "<a id='comment:95'></a>\nGreat! You may want to test with #27754, which aims for Python 3.8 compatibility",
    "created_at": "2020-08-04T17:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458778",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:95'></a>
Great! You may want to test with #27754, which aims for Python 3.8 compatibility



---

archive/issue_comments_458779.json:
```json
{
    "body": "<a id='comment:96'></a>\nFor the record sage-on-gentoo enables building with python 3.8 since 9.2.beta7. Building of the documentation with it may currently be failing though (but I managed a build between beta6 and beta7 somehow).",
    "created_at": "2020-08-04T21:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458779",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:96'></a>
For the record sage-on-gentoo enables building with python 3.8 since 9.2.beta7. Building of the documentation with it may currently be failing though (but I managed a build between beta6 and beta7 somehow).



---

archive/issue_comments_458780.json:
```json
{
    "body": "<a id='comment:97'></a>\nSage is ready for gcc-10, so...\n\nWhat\u2019s New in `sheerluck/sage-on-gentoo-stage4:20.9`\n\n```\n1) base image:\n   FROM gentoo/portage:20200901 as portage\n   FROM gentoo/stage3-amd64:20200901\n\n2) gcc-10 + python-3.8.5\n\n3) updates:\n   arb                2.18.0  -> 2.18.1\n   flint              2.6.0   -> 2.6.3\n   glibc              2.30-r8 -> 2.31-r6\n   libhomfly          1.02.5  -> 1.02.6\n   matplotlib         3.2.2   -> 3.3.1\n   mpfr               4.0.2   -> 4.1.0\n   sphinx             3.1.2   -> 3.2.1\n```\nno changes to tox.ini are required",
    "created_at": "2020-09-01T18:12:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458780",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:97'></a>
Sage is ready for gcc-10, so...

Whatâ€™s New in `sheerluck/sage-on-gentoo-stage4:20.9`

```
1) base image:
   FROM gentoo/portage:20200901 as portage
   FROM gentoo/stage3-amd64:20200901

2) gcc-10 + python-3.8.5

3) updates:
   arb                2.18.0  -> 2.18.1
   flint              2.6.0   -> 2.6.3
   glibc              2.30-r8 -> 2.31-r6
   libhomfly          1.02.5  -> 1.02.6
   matplotlib         3.2.2   -> 3.3.1
   mpfr               4.0.2   -> 4.1.0
   sphinx             3.1.2   -> 3.2.1
```
no changes to tox.ini are required



---

archive/issue_comments_458781.json:
```json
{
    "body": "<a id='comment:98'></a>\nWhat\u2019s New in `sheerluck/sage-on-gentoo-stage4:20.10`\n\n```\n1) base image:\n   FROM gentoo/portage:20201001 as portage\n   FROM gentoo/stage3:20201001\n\n2) gcc-10 + python-3.8.6\n\n3) updates:\n   arpack-3.7.0       new\n   tox-3.19.0         new\n   brial              1.2.8   -> 1.2.9\n   gmpy-2.1.0         b1-r1   -> b5\n   guile              2.2.4   -> 2.2.6\n   ipython            7.16.1  -> 7.17.0\n   sqlite             3.32.3  -> 3.33.0\n   swig               3.0.12  -> 4.0.0\n```\n\n`sheerluck/sage-on-gentoo-stage4:20.10-py37` is the same, only \n\n```\n2) gcc-9 + python-3.7.9\n```",
    "created_at": "2020-10-02T07:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458781",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:98'></a>
Whatâ€™s New in `sheerluck/sage-on-gentoo-stage4:20.10`

```
1) base image:
   FROM gentoo/portage:20201001 as portage
   FROM gentoo/stage3:20201001

2) gcc-10 + python-3.8.6

3) updates:
   arpack-3.7.0       new
   tox-3.19.0         new
   brial              1.2.8   -> 1.2.9
   gmpy-2.1.0         b1-r1   -> b5
   guile              2.2.4   -> 2.2.6
   ipython            7.16.1  -> 7.17.0
   sqlite             3.32.3  -> 3.33.0
   swig               3.0.12  -> 4.0.0
```

`sheerluck/sage-on-gentoo-stage4:20.10-py37` is the same, only 

```
2) gcc-9 + python-3.7.9
```



---

archive/issue_comments_458782.json:
```json
{
    "body": "<a id='comment:99'></a>\nPlease mask `brial-1.2.9` there are issues with it and it will be replaced by 1.2.10 in short order.",
    "created_at": "2020-10-02T07:38:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458782",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:99'></a>
Please mask `brial-1.2.9` there are issues with it and it will be replaced by 1.2.10 in short order.



---

archive/issue_comments_458783.json:
```json
{
    "body": "<a id='comment:0'></a>\nmasked, downgraded, squashed, tested, pushed",
    "created_at": "2020-10-02T11:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458783",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:0'></a>
masked, downgraded, squashed, tested, pushed



---

archive/issue_comments_458784.json:
```json
{
    "body": "<a id='comment:1'></a>\n\n```\nchecking for python3 >= 3.6.0, < 3.10.0 with modules ...  \nchecking ... whether /usr/bin/python3 is good... yes\n```\n\nAlthough overlay `cschwan/sage-on-gentoo` is not ready for `python-3.9` yet, \n`develop` branch of `sagemath/sage` accepts `python-3.9`.\n\nSo as if two images weren't enough, I used some ugly hacks to create third image -- `latest-py39`\n\nIf someone finds it usefull to play with python-3.9, tox.ini may be changed this way: \n\n```\n--- a/tox.ini\n+++ b/tox.ini\n@@ -208,6 +208,7 @@ setenv =\n     gentoo:      SYSTEM=gentoo\n     gentoo:      BASE_IMAGE=sheerluck/sage-on-gentoo-stage4\n     gentoo-python3.7: BASE_TAG=latest-py37\n+    gentoo-python3.9: BASE_TAG=latest-py39\n     #    \n     # https://hub.docker.com/_/archlinux/\n     #    \n```",
    "created_at": "2020-10-17T20:00:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458784",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:1'></a>

```
checking for python3 >= 3.6.0, < 3.10.0 with modules ...  
checking ... whether /usr/bin/python3 is good... yes
```

Although overlay `cschwan/sage-on-gentoo` is not ready for `python-3.9` yet, 
`develop` branch of `sagemath/sage` accepts `python-3.9`.

So as if two images weren't enough, I used some ugly hacks to create third image -- `latest-py39`

If someone finds it usefull to play with python-3.9, tox.ini may be changed this way: 

```
--- a/tox.ini
+++ b/tox.ini
@@ -208,6 +208,7 @@ setenv =
     gentoo:      SYSTEM=gentoo
     gentoo:      BASE_IMAGE=sheerluck/sage-on-gentoo-stage4
     gentoo-python3.7: BASE_TAG=latest-py37
+    gentoo-python3.9: BASE_TAG=latest-py39
     #    
     # https://hub.docker.com/_/archlinux/
     #    
```



---

archive/issue_comments_458785.json:
```json
{
    "body": "<a id='comment:2'></a>\nI have created #30785 for this",
    "created_at": "2020-10-17T20:19:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458785",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
I have created #30785 for this



---

archive/issue_comments_458786.json:
```json
{
    "body": "<a id='comment:3'></a>\nI was under impression that something is not right with my images until I saw #31395\nThat bug has ruined monthful of latest https://github.com/mkoeppe/sage/actions/ :(",
    "created_at": "2021-03-17T07:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458786",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:3'></a>
I was under impression that something is not right with my images until I saw #31395
That bug has ruined monthful of latest https://github.com/mkoeppe/sage/actions/ :(



---

archive/issue_comments_458787.json:
```json
{
    "body": "<a id='comment:104'></a>\nReplying to [@sheerluck](#comment%3A103):\n> I was under impression that something is not right with my images until I saw #31395\n> That bug has ruined monthful of latest https://github.com/mkoeppe/sage/actions/ :(\n\nI'm going to post a branch that removes the memlimit and then turn off my computer for a month while people yell at me.",
    "created_at": "2021-03-17T11:38:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458787",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:104'></a>
Replying to [@sheerluck](#comment%3A103):
> I was under impression that something is not right with my images until I saw #31395
> That bug has ruined monthful of latest https://github.com/mkoeppe/sage/actions/ :(

I'm going to post a branch that removes the memlimit and then turn off my computer for a month while people yell at me.



---

archive/issue_comments_458788.json:
```json
{
    "body": "<a id='comment:105'></a>\nReplying to [@orlitzky](#comment%3A104):\n> Replying to [@sheerluck](#comment%3A103):\n> > I was under impression that something is not right with my images until I saw #31395\n> > That bug has ruined monthful of latest https://github.com/mkoeppe/sage/actions/ :(\n\n> \n> I'm going to post a branch that removes the memlimit and then turn off my computer for a month while people yell at me.\n\nsee, #31395 got in :-)",
    "created_at": "2021-04-12T11:33:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458788",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:105'></a>
Replying to [@orlitzky](#comment%3A104):
> Replying to [@sheerluck](#comment%3A103):
> > I was under impression that something is not right with my images until I saw #31395
> > That bug has ruined monthful of latest https://github.com/mkoeppe/sage/actions/ :(

> 
> I'm going to post a branch that removes the memlimit and then turn off my computer for a month while people yell at me.

see, #31395 got in :-)



---

archive/issue_comments_458789.json:
```json
{
    "body": "<a id='comment:6'></a>\n`latest` image contains `clang-12.0.1` for `tox -e docker-gentoo-maximal`",
    "created_at": "2021-09-02T08:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458789",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:6'></a>
`latest` image contains `clang-12.0.1` for `tox -e docker-gentoo-maximal`



---

archive/issue_comments_458790.json:
```json
{
    "body": "<a id='comment:7'></a>\nAt https://github.com/orlitzky/sage/runs/3851208039?check_suite_focus=true#step:7:11493 I see **Pytest is not installed, skip checking tests that rely on it.**\n\nWell, that is not true, `latest` image got `/usr/bin/py.test` and `/usr/bin/pytest`",
    "created_at": "2021-10-12T09:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458790",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:7'></a>
At https://github.com/orlitzky/sage/runs/3851208039?check_suite_focus=true#step:7:11493 I see **Pytest is not installed, skip checking tests that rely on it.**

Well, that is not true, `latest` image got `/usr/bin/py.test` and `/usr/bin/pytest`



---

archive/issue_comments_458791.json:
```json
{
    "body": "<a id='comment:8'></a>\nyou need pytest in sage's venv.\n\ne.g.\n\n```\nmake pytest\n```\nwill do the trick",
    "created_at": "2021-10-12T11:53:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29105#issuecomment-458791",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
you need pytest in sage's venv.

e.g.

```
make pytest
```
will do the trick
