# Issue 29756: Meta-ticket: Review of Python 3 features that sagelib should use systematically

archive/issues_029519.json:
```json
{
    "body": "**For Sage 9.7, all of the following features can be used:**\n\n\nPython 3.6 features (https://docs.python.org/3.10/whatsnew/3.6.html):\n\n- [pathlib](https://docs.python.org/3/library/pathlib.html)\n- static typing\n  - #32058 add typing annotations in permutations\n  - #32067 Developer manual: Section on typing annotations\n  - #29775 Add a bit of typing to manifold code\n  - #30381 Python 3 typing/protocols/ABCs\n  - #30511 Type hints (`__annotations__`) and coercion/Cython\n- native namespace packages - #28925\n- `yield from` - #29857\n- f-strings (formatted strings)\n- keyword-only parameters (#16607, #31309)\n- new import machinery - #27074\t(Make `.sage` modules importable)\n- `__matmul__` (infix ``@`` operator) - #22760\n- `from ..a import b`\n- ...?\n\nPython 3.7 features (https://docs.python.org/3.10/whatsnew/3.7.html):\n\n- [importlib.resources](https://docs.python.org/3/library/importlib.html#module-importlib.resources) (#31306)\n\n- `from __future__ import annotations` (#31006)\n\n- https://docs.python.org/3/library/dataclasses.html\n\n\nPython 3.8 features (https://docs.python.org/3.10/whatsnew/3.8.html) can be used as soon as #32937 is merged:\n\n- assignment expressions `:=` (https://docs.python.org/3.10/whatsnew/3.8.html#assignment-expressions)\n- positional-only parameters ([PEP 570](https://www.python.org/dev/peps/pep-0570/))\n- `f'{expr=}'` https://docs.python.org/3.10/whatsnew/3.8.html#f-strings-support-for-self-documenting-expressions-and-debugging\n- PEP 590: Vectorcall: a fast calling protocol for CPython https://docs.python.org/3.10/whatsnew/3.8.html#pep-590-vectorcall-a-fast-calling-protocol-for-cpython\n- `functools.cached_property()` https://docs.python.org/3.10/whatsnew/3.8.html#functools\n- `pprint(sort_dicts=False)`\n- `shutil.copytree(dirs_exist_ok=True)` https://docs.python.org/3.10/whatsnew/3.8.html#shutil\n- `as_integer_ratio`, `__index__` special method (https://docs.python.org/3.10/whatsnew/3.8.html#other-language-changes)\n- `math.dist`, `hypot`, `prod`, `perm`, `comb`, `isqrt` https://docs.python.org/3.10/whatsnew/3.8.html#math\n- `typing.TypedDict`, `typing.Literal`, `Final`, `Protocol` https://docs.python.org/3.10/whatsnew/3.8.html#typing\n\n\n**Features introduced in Python 3.9 or later cannot be used in Sage yet because we support system Python 3.8.x.**\n\n\nPython 3.9 features (https://docs.python.org/3.10/whatsnew/3.9.html):\n\nPython 3.10 features (https://docs.python.org/3.10/whatsnew/3.10.html):\n- #34678: `match ... case`\n\n\nPython 3.11 features (https://docs.python.org/3.11/whatsnew/3.11.html):\n\n\nSee also:\n\n- #29728: Meta-ticket: improve compatibility with the Python library\n- #30384: Adopt the \u201ctime window-based\u201d policy for support of Python versions from NEP 29\n- #30551 Drop Python 3.6 support\n\n\nCC:  @fchapoton @dimpase @jhpalmieri @tobiasdiez @tscrim @nthiery @slel @nbruin\n\nKeywords: sd109\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/29756\n\n",
    "created_at": "2020-05-29T15:15:20Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Review of Python 3 features that sagelib should use systematically",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29756",
    "user": "https://github.com/mkoeppe"
}
```
**For Sage 9.7, all of the following features can be used:**


Python 3.6 features (https://docs.python.org/3.10/whatsnew/3.6.html):

- [pathlib](https://docs.python.org/3/library/pathlib.html)
- static typing
  - #32058 add typing annotations in permutations
  - #32067 Developer manual: Section on typing annotations
  - #29775 Add a bit of typing to manifold code
  - #30381 Python 3 typing/protocols/ABCs
  - #30511 Type hints (`__annotations__`) and coercion/Cython
- native namespace packages - #28925
- `yield from` - #29857
- f-strings (formatted strings)
- keyword-only parameters (#16607, #31309)
- new import machinery - #27074	(Make `.sage` modules importable)
- `__matmul__` (infix ``@`` operator) - #22760
- `from ..a import b`
- ...?

Python 3.7 features (https://docs.python.org/3.10/whatsnew/3.7.html):

- [importlib.resources](https://docs.python.org/3/library/importlib.html#module-importlib.resources) (#31306)

- `from __future__ import annotations` (#31006)

- https://docs.python.org/3/library/dataclasses.html


Python 3.8 features (https://docs.python.org/3.10/whatsnew/3.8.html) can be used as soon as #32937 is merged:

- assignment expressions `:=` (https://docs.python.org/3.10/whatsnew/3.8.html#assignment-expressions)
- positional-only parameters ([PEP 570](https://www.python.org/dev/peps/pep-0570/))
- `f'{expr=}'` https://docs.python.org/3.10/whatsnew/3.8.html#f-strings-support-for-self-documenting-expressions-and-debugging
- PEP 590: Vectorcall: a fast calling protocol for CPython https://docs.python.org/3.10/whatsnew/3.8.html#pep-590-vectorcall-a-fast-calling-protocol-for-cpython
- `functools.cached_property()` https://docs.python.org/3.10/whatsnew/3.8.html#functools
- `pprint(sort_dicts=False)`
- `shutil.copytree(dirs_exist_ok=True)` https://docs.python.org/3.10/whatsnew/3.8.html#shutil
- `as_integer_ratio`, `__index__` special method (https://docs.python.org/3.10/whatsnew/3.8.html#other-language-changes)
- `math.dist`, `hypot`, `prod`, `perm`, `comb`, `isqrt` https://docs.python.org/3.10/whatsnew/3.8.html#math
- `typing.TypedDict`, `typing.Literal`, `Final`, `Protocol` https://docs.python.org/3.10/whatsnew/3.8.html#typing


**Features introduced in Python 3.9 or later cannot be used in Sage yet because we support system Python 3.8.x.**


Python 3.9 features (https://docs.python.org/3.10/whatsnew/3.9.html):

Python 3.10 features (https://docs.python.org/3.10/whatsnew/3.10.html):
- #34678: `match ... case`


Python 3.11 features (https://docs.python.org/3.11/whatsnew/3.11.html):


See also:

- #29728: Meta-ticket: improve compatibility with the Python library
- #30384: Adopt the “time window-based” policy for support of Python versions from NEP 29
- #30551 Drop Python 3.6 support


CC:  @fchapoton @dimpase @jhpalmieri @tobiasdiez @tscrim @nthiery @slel @nbruin

Keywords: sd109

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/29756





---

archive/issue_comments_418627.json:
```json
{
    "body": "<a id='comment:2'></a>About types, has a general policy been discussed on sage-devel?",
    "created_at": "2020-06-02T10:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29756#issuecomment-418627",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:2'></a>About types, has a general policy been discussed on sage-devel?



---

archive/issue_comments_418628.json:
```json
{
    "body": "<a id='comment:3'></a>`typing` is a standard Python 3 module, and it allows one to catch more errors.. Why would one have anything against it?",
    "created_at": "2020-06-02T14:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29756#issuecomment-418628",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>`typing` is a standard Python 3 module, and it allows one to catch more errors.. Why would one have anything against it?



---

archive/issue_comments_418629.json:
```json
{
    "body": "<a id='comment:4'></a>> `typing` is a standard Python 3 module, and it allows one to catch more errors.. Why would one have anything against it?\n\n\nAre there reasons (e.g. performance) not to use it in certain circumstances?",
    "created_at": "2020-06-03T02:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29756#issuecomment-418629",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>> `typing` is a standard Python 3 module, and it allows one to catch more errors.. Why would one have anything against it?


Are there reasons (e.g. performance) not to use it in certain circumstances?



---

archive/issue_comments_418630.json:
```json
{
    "body": "<a id='comment:5'></a>I created this ticket as a place for discussions of these new features to make sure that we use them systematically in the Sage library, rather than in an ad-hoc way.\n\nFor example, for typing, I think there are opportunities to integrate it with the various dynamically generated classes that come in from the category system, as I noted in #29775.",
    "created_at": "2020-06-03T02:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29756#issuecomment-418630",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>I created this ticket as a place for discussions of these new features to make sure that we use them systematically in the Sage library, rather than in an ad-hoc way.

For example, for typing, I think there are opportunities to integrate it with the various dynamically generated classes that come in from the category system, as I noted in #29775.



---

archive/issue_comments_418631.json:
```json
{
    "body": "<a id='comment:6'></a>There shouldn't be any performance issues with typing as it is deactivated on runtime (the only additional overhead is the import of the `typing` package).\nSee also the discussion here https://realpython.com/python-type-checking/#pros-and-cons",
    "created_at": "2020-06-03T11:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29756#issuecomment-418631",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'></a>There shouldn't be any performance issues with typing as it is deactivated on runtime (the only additional overhead is the import of the `typing` package).
See also the discussion here https://realpython.com/python-type-checking/#pros-and-cons



---

archive/issue_comments_418632.json:
```json
{
    "body": "<a id='comment:11'></a>Regarding f-strings, see this comment:\n\n- #30107#comment:19",
    "created_at": "2020-07-13T10:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29756#issuecomment-418632",
    "user": "https://github.com/slel"
}
```

<a id='comment:11'></a>Regarding f-strings, see this comment:

- #30107#comment:19



---

archive/issue_comments_418633.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:2 egourgoulhon]:\n> About types, has a general policy been discussed on sage-devel?\n\n\n+1 for using typing. Return types in particular are useful for tab-completion on the result of function calls. For example\n\n```\nsage: \"hello\".upper().lower().upper()\n```\nthis tab-completes without evaluating the code (i.e. without setting IPython's `IPCompleter.greedy` config option).",
    "created_at": "2020-09-03T07:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29756#issuecomment-418633",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:18'></a>Replying to [comment:2 egourgoulhon]:
> About types, has a general policy been discussed on sage-devel?


+1 for using typing. Return types in particular are useful for tab-completion on the result of function calls. For example

```
sage: "hello".upper().lower().upper()
```
this tab-completes without evaluating the code (i.e. without setting IPython's `IPCompleter.greedy` config option).



---

archive/issue_events_076129.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76129"
}
```



---

archive/issue_events_076130.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76130"
}
```



---

archive/issue_events_076131.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76131"
}
```



---

archive/issue_comments_418634.json:
```json
{
    "body": "<a id='comment:29'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29756#issuecomment-418634",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_076132.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76132"
}
```



---

archive/issue_events_076133.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76133"
}
```



---

archive/issue_events_076134.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76134"
}
```



---

archive/issue_events_076135.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76135"
}
```



---

archive/issue_events_076136.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76136"
}
```



---

archive/issue_events_076137.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76137"
}
```



---

archive/issue_events_076138.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76138"
}
```



---

archive/issue_events_076139.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29756",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29756#event-76139"
}
```
