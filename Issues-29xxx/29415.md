# Issue 29415: tox.ini: Add environment local-conda

archive/issues_029178.json:
```json
{
    "body": "This environment creates an isolated conda installation within the tox environment directory,\nsimilar to `local-homebrew`.\n\nTo run:\n\n```\n   MAKE=\"make -j8\" tox -e local-conda-forge-standard\n   MAKE=\"make -j8\" tox -e local-conda-forge-minimal\n```\n\nCC:  @dimpase @jhpalmieri @isuruf @saraedum @kliem\n\nReviewer: Isuru Fernando\n\nAuthor: Matthias Koeppe\n\nBranch: a61c48e04b0c463b02fb47903454a94133b3a560\n\nDependencies: #29087\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29415\n\n",
    "closed_at": "2020-04-09T22:44:44Z",
    "created_at": "2020-03-27T15:24:09Z",
    "labels": [
        "component: porting"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "tox.ini: Add environment local-conda",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29415",
    "user": "https://github.com/mkoeppe"
}
```
This environment creates an isolated conda installation within the tox environment directory,
similar to `local-homebrew`.

To run:

```
   MAKE="make -j8" tox -e local-conda-forge-standard
   MAKE="make -j8" tox -e local-conda-forge-minimal
```

CC:  @dimpase @jhpalmieri @isuruf @saraedum @kliem

Reviewer: Isuru Fernando

Author: Matthias Koeppe

Branch: a61c48e04b0c463b02fb47903454a94133b3a560

Dependencies: #29087

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29415





---

archive/issue_comments_574382.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/tox_ini__add_environment_local_conda\"",
    "created_at": "2020-03-28T21:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574382",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/tox_ini__add_environment_local_conda"



---

archive/issue_comments_574383.json:
```json
{
    "body": "<a id='comment:2'></a>Last 10 new commits:",
    "created_at": "2020-03-28T21:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574383",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Last 10 new commits:



---

archive/issue_comments_574384.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,7 @@\n-This environment would create and use an isolated conda installation within the tox environment directory,\n+This environment creates an isolated conda installation within the tox environment directory,\n similar to `local-homebrew`.\n+\n+\n \n Dependencies: #29104\n \n``````\n",
    "created_at": "2020-03-28T21:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574384",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,7 @@
-This environment would create and use an isolated conda installation within the tox environment directory,
+This environment creates an isolated conda installation within the tox environment directory,
 similar to `local-homebrew`.
+
+
 
 Dependencies: #29104
 
``````




---

archive/issue_comments_574385.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-28T21:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574385",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_574386.json:
```json
{
    "body": "Changing commit from \"\" to \"36e1c9afe2379c243d02bd348adb75c720247f78\"",
    "created_at": "2020-03-28T21:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574386",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "36e1c9afe2379c243d02bd348adb75c720247f78"



---

archive/issue_comments_574387.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-03-28T21:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574387",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_574388.json:
```json
{
    "body": "Changing dependencies from \"#29104\" to \"#29087\"",
    "created_at": "2020-03-28T21:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574388",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29104" to "#29087"



---

archive/issue_comments_574389.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+This environment creates an isolated conda installation within the tox environment directory,\n+similar to `local-homebrew`.\n \n+To run:\n+\n+```\n+   MAKE=\"make -j8\" tox -e local-conda-forge-standard\n+   MAKE=\"make -j8\" tox -e local-conda-forge-minimal\n+```\n \n Dependencies: #29104\n \n``````\n",
    "created_at": "2020-03-29T01:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574389",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+This environment creates an isolated conda installation within the tox environment directory,
+similar to `local-homebrew`.
 
+To run:
+
+```
+   MAKE="make -j8" tox -e local-conda-forge-standard
+   MAKE="make -j8" tox -e local-conda-forge-minimal
+```
 
 Dependencies: #29104
 
``````




---

archive/issue_comments_574390.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-29T02:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_574391.json:
```json
{
    "body": "Changing commit from \"36e1c9afe2379c243d02bd348adb75c720247f78\" to \"a71ec3fd7bb082a8f6006ff542da34d46fa846fd\"",
    "created_at": "2020-03-29T02:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "36e1c9afe2379c243d02bd348adb75c720247f78" to "a71ec3fd7bb082a8f6006ff542da34d46fa846fd"



---

archive/issue_comments_574392.json:
```json
{
    "body": "Changing commit from \"a71ec3fd7bb082a8f6006ff542da34d46fa846fd\" to \"354cf90635e94587435c75e237a3d6ef8c806e06\"",
    "created_at": "2020-03-29T03:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a71ec3fd7bb082a8f6006ff542da34d46fa846fd" to "354cf90635e94587435c75e237a3d6ef8c806e06"



---

archive/issue_comments_574393.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-29T03:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_574394.json:
```json
{
    "body": "<a id='comment:7'></a>Rebased on 9.1.beta9+#29087",
    "created_at": "2020-03-29T03:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574394",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Rebased on 9.1.beta9+#29087



---

archive/issue_comments_574395.json:
```json
{
    "body": "<a id='comment:8'></a>Needs testing, in particular on Linux",
    "created_at": "2020-03-30T18:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574395",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Needs testing, in particular on Linux



---

archive/issue_comments_574396.json:
```json
{
    "body": "<a id='comment:9'></a>I end up with a C++ error in Singular\n\n```\nlibtool: compile:  /home/dimpase/sage/.tox/local-conda-forge-standard/conda/bin/x86_64-conda_cos6-linux-gnu-c++ -DHAVE_CONFIG_H -I. -I.\n./../.. -I. -I../../.. -I../../.. -I../../../libpolys -I../../../libpolys -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src/factory/include -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -pthread -DDYNAMIC_VERSION -DGMPRATIONAL -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/dimpase/sage/.tox/local-conda-forge-standard/conda/include -O2 -g -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/dimpase/sage/.tox/local-conda-forge-standard/conda/include -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-delete-null-pointer-checks -fno-rtti -fexceptions -frtti -c groebnerCone.cc  -fPIC -DPIC -o .libs/gfanlib_la-groebnerCone.o\ngroebnerCone.cc:428:58: error: no 'bool groebnerCone::pointsOutwards(gfan::ZVector) const' member function declared in class 'groebnerCone'\n bool groebnerCone::pointsOutwards(const gfan::ZVector w) const\n                                                          ^~~~~\ngroebnerCone.cc: In member function 'groebnerCones groebnerCone::tropicalNeighbours() const':\ngroebnerCone.cc:449:13: error: 'pointsOutwards' was not declared in this scope\n         if (pointsOutwards(ray[j]))\n             ^~~~~~~~~~~~~~\nmake[9]: *** [Makefile:726: gfanlib_la-groebnerCone.lo] Error 1\n```\n\nthis is on Debian, and might be due to using gfan from the system.",
    "created_at": "2020-03-31T04:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574396",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>I end up with a C++ error in Singular

```
libtool: compile:  /home/dimpase/sage/.tox/local-conda-forge-standard/conda/bin/x86_64-conda_cos6-linux-gnu-c++ -DHAVE_CONFIG_H -I. -I.
./../.. -I. -I../../.. -I../../.. -I../../../libpolys -I../../../libpolys -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src/factory/include -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -I/home/dimpase/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0/src -pthread -DDYNAMIC_VERSION -DGMPRATIONAL -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/dimpase/sage/.tox/local-conda-forge-standard/conda/include -O2 -g -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/dimpase/sage/.tox/local-conda-forge-standard/conda/include -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-delete-null-pointer-checks -fno-rtti -fexceptions -frtti -c groebnerCone.cc  -fPIC -DPIC -o .libs/gfanlib_la-groebnerCone.o
groebnerCone.cc:428:58: error: no 'bool groebnerCone::pointsOutwards(gfan::ZVector) const' member function declared in class 'groebnerCone'
 bool groebnerCone::pointsOutwards(const gfan::ZVector w) const
                                                          ^~~~~
groebnerCone.cc: In member function 'groebnerCones groebnerCone::tropicalNeighbours() const':
groebnerCone.cc:449:13: error: 'pointsOutwards' was not declared in this scope
         if (pointsOutwards(ray[j]))
             ^~~~~~~~~~~~~~
make[9]: *** [Makefile:726: gfanlib_la-groebnerCone.lo] Error 1
```

this is on Debian, and might be due to using gfan from the system.



---

archive/issue_comments_574397.json:
```json
{
    "body": "<a id='comment:10'></a>This is fixed in singular 4.1.2. https://github.com/Singular/Sources/commit/80a9ffc773542e3329935e5377f6906628be16e6\n\nA workaround is to do `export CPPFLAGS=\"$CPPFLAGS -UNDEBUG\"` in Singular build script.",
    "created_at": "2020-03-31T04:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574397",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:10'></a>This is fixed in singular 4.1.2. https://github.com/Singular/Sources/commit/80a9ffc773542e3329935e5377f6906628be16e6

A workaround is to do `export CPPFLAGS="$CPPFLAGS -UNDEBUG"` in Singular build script.



---

archive/issue_comments_574398.json:
```json
{
    "body": "<a id='comment:11'></a>should we upgrade Sage's singular?",
    "created_at": "2020-03-31T07:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574398",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>should we upgrade Sage's singular?



---

archive/issue_comments_574399.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 dimpase]:\n> should we upgrade Sage's singular?\n\nThat's #25993.",
    "created_at": "2020-03-31T11:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574399",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Replying to [comment:11 dimpase]:
> should we upgrade Sage's singular?

That's #25993.



---

archive/issue_comments_574400.json:
```json
{
    "body": "<a id='comment:13'></a>I also see a failure (testing with #29417):\n\n- `local-conda-forge-macos-standard`: \n\n```\n  [dochtml]       from sage.symbolic.all   import *\n  [dochtml]     File \"/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/all.py\", line 3, in <module>\n  [dochtml]       from sage.libs.pynac.pynac import I\n  [dochtml]     File \"sage/symbolic/expression.pxd\", line 4, in init sage.libs.pynac.pynac (build/cythonized/sage/libs/pynac/pynac.cpp:30411)\n   [dochtml]     File \"sage/symbolic/expression.pyx\", line 160, in init sage.symbolic.expression (build/cythonized/sage/symbolic/expression.cpp:75349)\n  [dochtml]   ImportError: dlopen(/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so, 2): Symbol not found: __ZN5GiNaC9containerINSt3__16vectorEEC2ERKNS2_INS_2exENS1_9allocatorIS4_EEEEb\n  [dochtml]     Referenced from: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so\n  [dochtml]     Expected in: flat namespace\n  [dochtml]    in /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so\n```\n(this is with #29404 -- should take another look)",
    "created_at": "2020-03-31T11:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574400",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>I also see a failure (testing with #29417):

- `local-conda-forge-macos-standard`: 

```
  [dochtml]       from sage.symbolic.all   import *
  [dochtml]     File "/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/all.py", line 3, in <module>
  [dochtml]       from sage.libs.pynac.pynac import I
  [dochtml]     File "sage/symbolic/expression.pxd", line 4, in init sage.libs.pynac.pynac (build/cythonized/sage/libs/pynac/pynac.cpp:30411)
   [dochtml]     File "sage/symbolic/expression.pyx", line 160, in init sage.symbolic.expression (build/cythonized/sage/symbolic/expression.cpp:75349)
  [dochtml]   ImportError: dlopen(/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so, 2): Symbol not found: __ZN5GiNaC9containerINSt3__16vectorEEC2ERKNS2_INS_2exENS1_9allocatorIS4_EEEEb
  [dochtml]     Referenced from: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so
  [dochtml]     Expected in: flat namespace
  [dochtml]    in /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so
```
(this is with #29404 -- should take another look)



---

archive/issue_comments_574401.json:
```json
{
    "body": "<a id='comment:14'></a>In any case, the present ticket is about adding the testing framework for local-conda, which appears to work. Needs review.",
    "created_at": "2020-03-31T12:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574401",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>In any case, the present ticket is about adding the testing framework for local-conda, which appears to work. Needs review.



---

archive/issue_comments_574402.json:
```json
{
    "body": "<a id='comment:16'></a>Shameless plug. Use miniforge instead of miniconda?",
    "created_at": "2020-03-31T16:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574402",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:16'></a>Shameless plug. Use miniforge instead of miniconda?



---

archive/issue_comments_574403.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 isuruf]:\n> Shameless plug. Use miniforge instead of miniconda?\n\nJust tried it and it behaves a bit different from miniconda:\n\n```\nlocal-macos-conda-forge-standard-python2 run-test-pre: commands[6] | bash -c '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-macos-conda-forge-standard-python2/conda/bin/conda update -n base --yes conda'\nTraceback (most recent call last):\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-macos-conda-forge-standard-python2/conda/bin/conda\", line 12, in <module>\n    from conda.cli import main\nModuleNotFoundError: No module named 'conda'\n```\nDo I need to activate the environment before using that?",
    "created_at": "2020-03-31T17:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574403",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Replying to [comment:16 isuruf]:
> Shameless plug. Use miniforge instead of miniconda?

Just tried it and it behaves a bit different from miniconda:

```
local-macos-conda-forge-standard-python2 run-test-pre: commands[6] | bash -c '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-macos-conda-forge-standard-python2/conda/bin/conda update -n base --yes conda'
Traceback (most recent call last):
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-macos-conda-forge-standard-python2/conda/bin/conda", line 12, in <module>
    from conda.cli import main
ModuleNotFoundError: No module named 'conda'
```
Do I need to activate the environment before using that?



---

archive/issue_comments_574404.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:10 isuruf]:\n> This is fixed in singular 4.1.2. https://github.com/Singular/Sources/commit/80a9ffc773542e3329935e5377f6906628be16e6\n> \n> A workaround is to do `export CPPFLAGS=\"$CPPFLAGS -UNDEBUG\"` in Singular build script.\n\n\nBecause the singular upgrade (#25993) will not be ready for 9.1, I have opened #29438 for this",
    "created_at": "2020-03-31T17:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574404",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Replying to [comment:10 isuruf]:
> This is fixed in singular 4.1.2. https://github.com/Singular/Sources/commit/80a9ffc773542e3329935e5377f6906628be16e6
> 
> A workaround is to do `export CPPFLAGS="$CPPFLAGS -UNDEBUG"` in Singular build script.


Because the singular upgrade (#25993) will not be ready for 9.1, I have opened #29438 for this



---

archive/issue_comments_574405.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:17 mkoeppe]:\n> Do I need to activate the environment before using that?\n\n\nYes, but even miniconda needs activation.",
    "created_at": "2020-03-31T17:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574405",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:19'></a>Replying to [comment:17 mkoeppe]:
> Do I need to activate the environment before using that?


Yes, but even miniconda needs activation.



---

archive/issue_comments_574406.json:
```json
{
    "body": "Changing commit from \"354cf90635e94587435c75e237a3d6ef8c806e06\" to \"a61c48e04b0c463b02fb47903454a94133b3a560\"",
    "created_at": "2020-03-31T17:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "354cf90635e94587435c75e237a3d6ef8c806e06" to "a61c48e04b0c463b02fb47903454a94133b3a560"



---

archive/issue_comments_574407.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-31T17:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_574408.json:
```json
{
    "body": "Attachment [openblas.log](tarball://root/attachments/some-uuid/ticket29415/openblas.log) by @kliem created at 2020-04-01 09:19:02",
    "created_at": "2020-04-01T09:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574408",
    "user": "https://github.com/kliem"
}
```

Attachment [openblas.log](tarball://root/attachments/some-uuid/ticket29415/openblas.log) by @kliem created at 2020-04-01 09:19:02



---

archive/issue_comments_574409.json:
```json
{
    "body": "<a id='comment:21'></a>I guess it works in the way that it doesn't work.\n\n```\n* package:         openblas-0.3.6.p0\n  last build time: Apr 1 10:54\n  log file:        /srv/public/kliem/sage/logs/pkgs/openblas-0.3.6.p0.log\n  build directory: /srv/public/kliem/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/openblas-0.3.6.p0                                                               \n\n* package:         singular-4.1.1p2.p0\n  last build time: Apr 1 11:00\n  log file:        /srv/public/kliem/sage/logs/pkgs/singular-4.1.1p2.p0.log\n  build directory: /srv/public/kliem/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0                                                             \n\n```\n\nI attached the logs.",
    "created_at": "2020-04-01T09:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574409",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>I guess it works in the way that it doesn't work.

```
* package:         openblas-0.3.6.p0
  last build time: Apr 1 10:54
  log file:        /srv/public/kliem/sage/logs/pkgs/openblas-0.3.6.p0.log
  build directory: /srv/public/kliem/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/openblas-0.3.6.p0                                                               

* package:         singular-4.1.1p2.p0
  last build time: Apr 1 11:00
  log file:        /srv/public/kliem/sage/logs/pkgs/singular-4.1.1p2.p0.log
  build directory: /srv/public/kliem/sage/.tox/local-conda-forge-standard/local/var/tmp/sage/build/singular-4.1.1p2.p0                                                             

```

I attached the logs.



---

archive/issue_comments_574410.json:
```json
{
    "body": "<a id='comment:22'></a>Singular might need the fix proposed by Isuru above",
    "created_at": "2020-04-01T09:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574410",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>Singular might need the fix proposed by Isuru above



---

archive/issue_comments_574411.json:
```json
{
    "body": "<a id='comment:23'></a>I'm not sure that I understand.\n\nAt least this here did not fix the problem.\n\n```\n+++ b/build/pkgs/singular/spkg-install.in\n@@ -19,6 +19,7 @@ else\n fi\n \n export CFLAGS CXXFLAGS\n+export CPPFLAGS=\"$CPPFLAGS -UNDEBUG\"\n \n \n remove_old_version()\n```\n\nNow openblas, tachyon, m4ri, givaro, ecm, python3, giac, singular fail to install.",
    "created_at": "2020-04-01T12:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574411",
    "user": "https://github.com/kliem"
}
```

<a id='comment:23'></a>I'm not sure that I understand.

At least this here did not fix the problem.

```
+++ b/build/pkgs/singular/spkg-install.in
@@ -19,6 +19,7 @@ else
 fi
 
 export CFLAGS CXXFLAGS
+export CPPFLAGS="$CPPFLAGS -UNDEBUG"
 
 
 remove_old_version()
```

Now openblas, tachyon, m4ri, givaro, ecm, python3, giac, singular fail to install.



---

archive/issue_comments_574412.json:
```json
{
    "body": "<a id='comment:24'></a>Singular fixes - please on  #29438, not here",
    "created_at": "2020-04-01T13:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574412",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Singular fixes - please on  #29438, not here



---

archive/issue_comments_574413.json:
```json
{
    "body": "<a id='comment:25'></a>This ticket is about adding the testing environment for conda, not fixing everything that may be broken in the conda build",
    "created_at": "2020-04-01T13:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574413",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>This ticket is about adding the testing environment for conda, not fixing everything that may be broken in the conda build



---

archive/issue_comments_574414.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Isuru Fernando\"",
    "created_at": "2020-04-03T16:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574414",
    "user": "https://github.com/isuruf"
}
```

Changing reviewer from "" to "Isuru Fernando"



---

archive/issue_comments_574415.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-03T16:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574415",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_574416.json:
```json
{
    "body": "<a id='comment:27'></a>Thank you.",
    "created_at": "2020-04-03T16:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574416",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Thank you.



---

archive/issue_comments_574417.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-09T22:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574417",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_074972.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-09T22:44:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29415#event-74972"
}
```



---

archive/issue_comments_574418.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/tox_ini__add_environment_local_conda\" to \"a61c48e04b0c463b02fb47903454a94133b3a560\"",
    "created_at": "2020-04-09T22:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574418",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/tox_ini__add_environment_local_conda" to "a61c48e04b0c463b02fb47903454a94133b3a560"



---

archive/issue_comments_574419.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:13 mkoeppe]:\n> I also see a failure (testing with #29417):\n> \n> - `local-conda-forge-macos-standard`: \n> \n> ```\n>   [dochtml]       from sage.symbolic.all   import *\n>   [dochtml]     File \"/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/all.py\", line 3, in <module>\n>   [dochtml]       from sage.libs.pynac.pynac import I\n>   [dochtml]     File \"sage/symbolic/expression.pxd\", line 4, in init sage.libs.pynac.pynac (build/cythonized/sage/libs/pynac/pynac.cpp:30411)\n>    [dochtml]     File \"sage/symbolic/expression.pyx\", line 160, in init sage.symbolic.expression (build/cythonized/sage/symbolic/expression.cpp:75349)\n>   [dochtml]   ImportError: dlopen(/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so, 2): Symbol not found: __ZN5GiNaC9containerINSt3__16vectorEEC2ERKNS2_INS_2exENS1_9allocatorIS4_EEEEb\n>   [dochtml]     Referenced from: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so\n>   [dochtml]     Expected in: flat namespace\n>   [dochtml]    in /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so\n> ```\n> (this is with #29404 -- should take another look)\n\n\nThis is now #29574",
    "created_at": "2020-04-25T03:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574419",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Replying to [comment:13 mkoeppe]:
> I also see a failure (testing with #29417):
> 
> - `local-conda-forge-macos-standard`: 
> 
> ```
>   [dochtml]       from sage.symbolic.all   import *
>   [dochtml]     File "/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/all.py", line 3, in <module>
>   [dochtml]       from sage.libs.pynac.pynac import I
>   [dochtml]     File "sage/symbolic/expression.pxd", line 4, in init sage.libs.pynac.pynac (build/cythonized/sage/libs/pynac/pynac.cpp:30411)
>    [dochtml]     File "sage/symbolic/expression.pyx", line 160, in init sage.symbolic.expression (build/cythonized/sage/symbolic/expression.cpp:75349)
>   [dochtml]   ImportError: dlopen(/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so, 2): Symbol not found: __ZN5GiNaC9containerINSt3__16vectorEEC2ERKNS2_INS_2exENS1_9allocatorIS4_EEEEb
>   [dochtml]     Referenced from: /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so
>   [dochtml]     Expected in: flat namespace
>   [dochtml]    in /Users/runner/runners/2.165.2/work/sage/sage/.tox/local-conda-forge-macos-standard/local/lib/python3.7/site-packages/sage/symbolic/ring.cpython-37m-darwin.so
> ```
> (this is with #29404 -- should take another look)


This is now #29574



---

archive/issue_comments_574420.json:
```json
{
    "body": "Changing commit from \"a61c48e04b0c463b02fb47903454a94133b3a560\" to \"\"",
    "created_at": "2020-04-25T03:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29415#issuecomment-574420",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "a61c48e04b0c463b02fb47903454a94133b3a560" to ""
