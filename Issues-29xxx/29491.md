# Issue 29491: gp2c spkg-configure.m4 cleanup

archive/issues_029254.json:
```json
{
    "assignees": [],
    "body": "Thanks to some other improvements, the spkg-configure check for gp2c can be cleaned up a bit:\n\n* We can use DEPCHECK instead of manually checking if the pari SPKG will be installed\n* We don't need to suggest to the user that she install gp2c from the system\n\nAnd there's one huge annoyance that I need to fix but I'm not sure how yet:\n\n* The `find /usr -name pari.cfg` call takes forever, because it searches through a million files.\n\n\nCC:  @mkoeppe @antonio-rojas @isuruf @dimpase @embray\n\nComponent: **build: configure**\n\nAuthor: **Michael Orlitzky**\n\nBranch: **[`b5d16d9`](https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1)**\n\nReviewer: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29491_\n\n",
    "closed_at": "2020-04-16T22:33:12Z",
    "created_at": "2020-04-09T21:59:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "gp2c spkg-configure.m4 cleanup",
    "type": "issue",
    "updated_at": "2021-08-10T19:50:18Z",
    "url": "https://github.com/sagemath/sage/issues/29491",
    "user": "https://github.com/orlitzky"
}
```
Thanks to some other improvements, the spkg-configure check for gp2c can be cleaned up a bit:

* We can use DEPCHECK instead of manually checking if the pari SPKG will be installed
* We don't need to suggest to the user that she install gp2c from the system

And there's one huge annoyance that I need to fix but I'm not sure how yet:

* The `find /usr -name pari.cfg` call takes forever, because it searches through a million files.


CC:  @mkoeppe @antonio-rojas @isuruf @dimpase @embray

Component: **build: configure**

Author: **Michael Orlitzky**

Branch: **[`b5d16d9`](https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1)**

Reviewer: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/29491_





---

archive/issue_events_402546.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-09T21:59:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402546"
}
```



---

archive/issue_events_402547.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-09T21:59:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402547"
}
```



---

archive/issue_events_402548.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-09T21:59:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402548"
}
```



---

archive/issue_events_402549.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-09T21:59:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402549"
}
```



---

archive/issue_comments_463400.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nCan we collect a list of places that pari.cfg is installed by the pari system package? I think we should just loop through them all. Gentoo is `/usr/share/pari/pari.cfg`, so I have that one. I still need to know where pari.cfg winds up on,\n\n* Debian\n* Fedora\n* Arch\n* Conda\n* Homebrew\n\nThen I can turn that `find` into a loop (I know this will be something weird on Conda, the spkg-configure in reality uses a relative path).",
    "created_at": "2020-04-09T23:00:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463400",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:1" align="right">comment:1</div>

Can we collect a list of places that pari.cfg is installed by the pari system package? I think we should just loop through them all. Gentoo is `/usr/share/pari/pari.cfg`, so I have that one. I still need to know where pari.cfg winds up on,

* Debian
* Fedora
* Arch
* Conda
* Homebrew

Then I can turn that `find` into a loop (I know this will be something weird on Conda, the spkg-configure in reality uses a relative path).



---

archive/issue_comments_463401.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nOn Conda, it's `<PREFIX>/lib/pari/pari.cfg`. (`gp` executable is `<PREFIX>/bin/gp`)\n\nOn Debian, it's at `/usr/lib/x86_64-linux-gnu/pari/pari.cfg` for `x86_64`",
    "created_at": "2020-04-09T23:08:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463401",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:2" align="right">comment:2</div>

On Conda, it's `<PREFIX>/lib/pari/pari.cfg`. (`gp` executable is `<PREFIX>/bin/gp`)

On Debian, it's at `/usr/lib/x86_64-linux-gnu/pari/pari.cfg` for `x86_64`



---

archive/issue_comments_463402.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks, I added the i386, arm64, and sparc debian arches from https://wiki.debian.org/Multiarch/Tuples as well. (It would be easy to add more if more than zero users are observed.)",
    "created_at": "2020-04-09T23:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463402",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks, I added the i386, arm64, and sparc debian arches from https://wiki.debian.org/Multiarch/Tuples as well. (It would be easy to add more if more than zero users are observed.)



---

archive/issue_comments_463403.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n`dpkg-architecture -qDEB_BUILD_MULTIARCH` will give you the native debian architecture.",
    "created_at": "2020-04-09T23:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463403",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:4" align="right">comment:4</div>

`dpkg-architecture -qDEB_BUILD_MULTIARCH` will give you the native debian architecture.



---

archive/issue_comments_463404.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@orlitzky](#comment%3A3):\n> Thanks, I added the i386, arm64, and sparc debian arches from https://wiki.debian.org/Multiarch/Tuples as well. (It would be easy to add more if more than zero users are observed.)\n\nAt least we're testing some of them -- see tox.ini",
    "created_at": "2020-04-09T23:27:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463404",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@orlitzky](#comment%3A3):
> Thanks, I added the i386, arm64, and sparc debian arches from https://wiki.debian.org/Multiarch/Tuples as well. (It would be easy to add more if more than zero users are observed.)

At least we're testing some of them -- see tox.ini



---

archive/issue_comments_463405.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@mkoeppe](#comment%3A5):\n> At least we're testing some of them -- see tox.ini\n\nOk, I added the whole list of \"released\" arch tuples. Are we testing any systems that use something other than those? (Some are obvious, but I can't guess what tuple e.g. arm32v5 in tox.ini corresponds to.)",
    "created_at": "2020-04-09T23:42:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463405",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@mkoeppe](#comment%3A5):
> At least we're testing some of them -- see tox.ini

Ok, I added the whole list of "released" arch tuples. Are we testing any systems that use something other than those? (Some are obvious, but I can't guess what tuple e.g. arm32v5 in tox.ini corresponds to.)



---

archive/issue_comments_463406.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI don't know the details about the various ARM arch variants beyond what I have gathered in tox.ini",
    "created_at": "2020-04-09T23:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463406",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

I don't know the details about the various ARM arch variants beyond what I have gathered in tox.ini



---

archive/issue_comments_463407.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOn second thought, I can just write a shell script to mimic `dpkg-architecture -qDEB_BUILD_MULTIARCH` while I test, and use that if it produces non-null output.",
    "created_at": "2020-04-09T23:55:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463407",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:8" align="right">comment:8</div>

On second thought, I can just write a shell script to mimic `dpkg-architecture -qDEB_BUILD_MULTIARCH` while I test, and use that if it produces non-null output.



---

archive/issue_comments_463408.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAnd it looks like the homebrew recipe does nothing special with it, so it winds up in the sysdatadir, whose default is `$prefix/lib/pari`.",
    "created_at": "2020-04-10T00:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463408",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:9" align="right">comment:9</div>

And it looks like the homebrew recipe does nothing special with it, so it winds up in the sysdatadir, whose default is `$prefix/lib/pari`.



---

archive/issue_events_402550.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-10T00:28:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402550"
}
```



---

archive/issue_comments_463409.json:
```json
{
    "body": "Branch: **[u/mjo/ticket/29491](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29491)**",
    "created_at": "2020-04-10T00:28:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463409",
    "user": "https://github.com/orlitzky"
}
```

Branch: **[u/mjo/ticket/29491](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29491)**



---

archive/issue_comments_463410.json:
```json
{
    "body": "Commit: **[`e291c39`](https://github.com/sagemath/sagetrac-mirror/commit/e291c395c045bf9c33ea6be900682545520faf02)**",
    "created_at": "2020-04-10T00:28:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463410",
    "user": "https://github.com/orlitzky"
}
```

Commit: **[`e291c39`](https://github.com/sagemath/sagetrac-mirror/commit/e291c395c045bf9c33ea6be900682545520faf02)**



---

archive/issue_comments_463411.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI can't promise that it works, but it's a lot faster.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e291c395c045bf9c33ea6be900682545520faf02\"><code>e291c39</code></a></td><td><code>Trac #29491: refactor gp2c's spkg-configure.m4.</code></td></tr></table>\n",
    "created_at": "2020-04-10T00:28:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463411",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:10" align="right">comment:10</div>

I can't promise that it works, but it's a lot faster.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e291c395c045bf9c33ea6be900682545520faf02"><code>e291c39</code></a></td><td><code>Trac #29491: refactor gp2c's spkg-configure.m4.</code></td></tr></table>




---

archive/issue_comments_463412.json:
```json
{
    "body": "Author: **Michael Orlitzky**",
    "created_at": "2020-04-10T00:28:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463412",
    "user": "https://github.com/orlitzky"
}
```

Author: **Michael Orlitzky**



---

archive/issue_comments_463413.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nTests ran at https://github.com/mkoeppe/sage/actions/runs/74977564\n\nFailures see e.g. https://github.com/mkoeppe/sage/runs/575982350\n\n```\nChecking whether SageMath should install SPKG gp2c...\nchecking whether any of pari is installed as or will be installed as SPKG... yes; install gp2c as well\nconfigure: no suitable system package found for SPKG gp2c\nconfigure: gp prefix is .\nconfigure: error: unable to locate pari.cfg\n```\n\nWhatever is happening in this test, it should definitely not terminate configure with an error...",
    "created_at": "2020-04-10T15:03:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463413",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Tests ran at https://github.com/mkoeppe/sage/actions/runs/74977564

Failures see e.g. https://github.com/mkoeppe/sage/runs/575982350

```
Checking whether SageMath should install SPKG gp2c...
checking whether any of pari is installed as or will be installed as SPKG... yes; install gp2c as well
configure: no suitable system package found for SPKG gp2c
configure: gp prefix is .
configure: error: unable to locate pari.cfg
```

Whatever is happening in this test, it should definitely not terminate configure with an error...



---

archive/issue_events_402551.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-10T15:04:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402551"
}
```



---

archive/issue_events_402552.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-10T15:04:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402552"
}
```



---

archive/issue_comments_463414.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mkoeppe](#comment%3A11):\n> \n> Whatever is happening in this test, it should definitely not terminate configure with an error...\n\nTo build the gp2c SPKG, we need to know where pari.cfg (installed by pari) lives. If not, you'll just get a build failure later on.",
    "created_at": "2020-04-10T15:07:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463414",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mkoeppe](#comment%3A11):
> 
> Whatever is happening in this test, it should definitely not terminate configure with an error...

To build the gp2c SPKG, we need to know where pari.cfg (installed by pari) lives. If not, you'll just get a build failure later on.



---

archive/issue_comments_463415.json:
```json
{
    "body": "Changed commit from **[`e291c39`](https://github.com/sagemath/sagetrac-mirror/commit/e291c395c045bf9c33ea6be900682545520faf02)** to **[`07c6f9d`](https://github.com/sagemath/sagetrac-mirror/commit/07c6f9deca09cb243642e1095ddfe11ebd931f2f)**",
    "created_at": "2020-04-10T15:36:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463415",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e291c39`](https://github.com/sagemath/sagetrac-mirror/commit/e291c395c045bf9c33ea6be900682545520faf02)** to **[`07c6f9d`](https://github.com/sagemath/sagetrac-mirror/commit/07c6f9deca09cb243642e1095ddfe11ebd931f2f)**



---

archive/issue_comments_463416.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07c6f9deca09cb243642e1095ddfe11ebd931f2f\"><code>07c6f9d</code></a></td><td><code>Trac #29491: refactor gp2c's spkg-configure.m4.</code></td></tr></table>\n",
    "created_at": "2020-04-10T15:36:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463416",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07c6f9deca09cb243642e1095ddfe11ebd931f2f"><code>07c6f9d</code></a></td><td><code>Trac #29491: refactor gp2c's spkg-configure.m4.</code></td></tr></table>




---

archive/issue_comments_463417.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe nonexistent failure/success/whatever branch of SAGE_SPKG_DEPCHECK was being ignored, who would've thought. I wonder how many times I've copy/pasted that broken code...",
    "created_at": "2020-04-10T15:38:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463417",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:15" align="right">comment:15</div>

The nonexistent failure/success/whatever branch of SAGE_SPKG_DEPCHECK was being ignored, who would've thought. I wonder how many times I've copy/pasted that broken code...



---

archive/issue_events_402553.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-10T15:38:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402553"
}
```



---

archive/issue_events_402554.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-10T15:38:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402554"
}
```



---

archive/issue_comments_463418.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOK, I'll run a new round of tests soon",
    "created_at": "2020-04-10T16:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463418",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

OK, I'll run a new round of tests soon



---

archive/issue_comments_463419.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nStill failing. https://github.com/mkoeppe/sage/runs/577560337\n\nReally shouldn't be using AC_MSG_ERROR at all here.\nIf gp2c spkg-configure can't find the needed bits of pari, then we have to build our own pari.",
    "created_at": "2020-04-10T18:36:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463419",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Still failing. https://github.com/mkoeppe/sage/runs/577560337

Really shouldn't be using AC_MSG_ERROR at all here.
If gp2c spkg-configure can't find the needed bits of pari, then we have to build our own pari.



---

archive/issue_events_402555.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-10T18:36:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402555"
}
```



---

archive/issue_events_402556.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-10T18:36:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402556"
}
```



---

archive/issue_comments_463420.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1\"><code>b5d16d9</code></a></td><td><code>Trac #29491: refactor gp2c's spkg-configure.m4.</code></td></tr></table>\n",
    "created_at": "2020-04-10T18:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463420",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1"><code>b5d16d9</code></a></td><td><code>Trac #29491: refactor gp2c's spkg-configure.m4.</code></td></tr></table>




---

archive/issue_comments_463421.json:
```json
{
    "body": "Changed commit from **[`07c6f9d`](https://github.com/sagemath/sagetrac-mirror/commit/07c6f9deca09cb243642e1095ddfe11ebd931f2f)** to **[`b5d16d9`](https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1)**",
    "created_at": "2020-04-10T18:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463421",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`07c6f9d`](https://github.com/sagemath/sagetrac-mirror/commit/07c6f9deca09cb243642e1095ddfe11ebd931f2f)** to **[`b5d16d9`](https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1)**



---

archive/issue_comments_463422.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@mkoeppe](#comment%3A17):\n> Still failing. https://github.com/mkoeppe/sage/runs/577560337\n\nForgot to `git add` before `git commit --amend`, ugh.\n\n\n> Really shouldn't be using AC_MSG_ERROR at all here.\n> If gp2c spkg-configure can't find the needed bits of pari, then we have to build our own pari.\n\nThe existing check already fails if it can't find pari.cfg, it just takes longer. We've already decided to use the system pari at this point, and I'm not sure we can retroactively decide not to (what about all of the other packages that have already run DEPCHECK?). In any case, failures should be extremely rare, and when they do happen, we should add the new location to the list rather than silently rebuilding pari for people who probably don't even want gp2c. Related: is there some way to detect if --enable-gp2c was passed? We shouldn't have to run this code at all, by default.",
    "created_at": "2020-04-10T18:57:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463422",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@mkoeppe](#comment%3A17):
> Still failing. https://github.com/mkoeppe/sage/runs/577560337

Forgot to `git add` before `git commit --amend`, ugh.


> Really shouldn't be using AC_MSG_ERROR at all here.
> If gp2c spkg-configure can't find the needed bits of pari, then we have to build our own pari.

The existing check already fails if it can't find pari.cfg, it just takes longer. We've already decided to use the system pari at this point, and I'm not sure we can retroactively decide not to (what about all of the other packages that have already run DEPCHECK?). In any case, failures should be extremely rare, and when they do happen, we should add the new location to the list rather than silently rebuilding pari for people who probably don't even want gp2c. Related: is there some way to detect if --enable-gp2c was passed? We shouldn't have to run this code at all, by default.



---

archive/issue_events_402557.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-10T18:57:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402557"
}
```



---

archive/issue_events_402558.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-04-10T18:57:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402558"
}
```



---

archive/issue_comments_463423.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@orlitzky](#comment%3A19):\n> Replying to [@mkoeppe](#comment%3A17):\n> > Still failing. https://github.com/mkoeppe/sage/runs/577560337\n\n> \n> Forgot to `git add` before `git commit --amend`, ugh.\n> \n> \n> > Really shouldn't be using AC_MSG_ERROR at all here.\n> > If gp2c spkg-configure can't find the needed bits of pari, then we have to build our own pari.\n\n> \n> The existing check already fails if it can't find pari.cfg, it just takes longer. We've already decided to use the system pari at this point, and I'm not sure we can retroactively decide not to (what about all of the other packages that have already run DEPCHECK?). In any case, failures should be extremely rare, and when they do happen, we should add the new location to the list rather than silently rebuilding pari for people who probably don't even want gp2c. \n\nAh ok, I did not remember that gp2c is an optional package. That makes it more complicated. I have a similar problem with nauty vs. libnauty in #27952.\n\n> Related: is there some way to detect if --enable-gp2c was passed? We shouldn't have to run this code at all, by default.\n\nUnfortunately at this point the SAGE_SPKG_ENABLE calls are emitted after the SAGE_SPKG_CONFIGURE_* calls.\nThis could be changed easily, of course. Related: #29363",
    "created_at": "2020-04-10T19:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463423",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@orlitzky](#comment%3A19):
> Replying to [@mkoeppe](#comment%3A17):
> > Still failing. https://github.com/mkoeppe/sage/runs/577560337

> 
> Forgot to `git add` before `git commit --amend`, ugh.
> 
> 
> > Really shouldn't be using AC_MSG_ERROR at all here.
> > If gp2c spkg-configure can't find the needed bits of pari, then we have to build our own pari.

> 
> The existing check already fails if it can't find pari.cfg, it just takes longer. We've already decided to use the system pari at this point, and I'm not sure we can retroactively decide not to (what about all of the other packages that have already run DEPCHECK?). In any case, failures should be extremely rare, and when they do happen, we should add the new location to the list rather than silently rebuilding pari for people who probably don't even want gp2c. 

Ah ok, I did not remember that gp2c is an optional package. That makes it more complicated. I have a similar problem with nauty vs. libnauty in #27952.

> Related: is there some way to detect if --enable-gp2c was passed? We shouldn't have to run this code at all, by default.

Unfortunately at this point the SAGE_SPKG_ENABLE calls are emitted after the SAGE_SPKG_CONFIGURE_* calls.
This could be changed easily, of course. Related: #29363



---

archive/issue_comments_463424.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mkoeppe](#comment%3A21):\n> Unfortunately at this point the SAGE_SPKG_ENABLE calls are emitted after the SAGE_SPKG_CONFIGURE_* calls.\n> This could be changed easily, of course. Related: #29363\n\nI have this change on the (unfinished) branch of #29054",
    "created_at": "2020-04-10T20:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463424",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mkoeppe](#comment%3A21):
> Unfortunately at this point the SAGE_SPKG_ENABLE calls are emitted after the SAGE_SPKG_CONFIGURE_* calls.
> This could be changed easily, of course. Related: #29363

I have this change on the (unfinished) branch of #29054



---

archive/issue_comments_463425.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI have created #29498 (Do not check for system packages of disabled optional packages) for this",
    "created_at": "2020-04-11T17:21:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463425",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

I have created #29498 (Do not check for system packages of disabled optional packages) for this



---

archive/issue_comments_463426.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis looks fine and seems to work well on Debian (https://github.com/mkoeppe/sage/actions/runs/78581820).",
    "created_at": "2020-04-15T19:39:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463426",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

This looks fine and seems to work well on Debian (https://github.com/mkoeppe/sage/actions/runs/78581820).



---

archive/issue_comments_463427.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2020-04-15T19:39:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463427",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_402559.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-15T19:39:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402559"
}
```



---

archive/issue_events_402560.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-15T19:39:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402560"
}
```



---

archive/issue_comments_463428.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/29491](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29491)** to **[`b5d16d9`](https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1)**",
    "created_at": "2020-04-16T22:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463428",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mjo/ticket/29491](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29491)** to **[`b5d16d9`](https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1)**



---

archive/issue_events_402561.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-16T22:33:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402561"
}
```



---

archive/issue_events_402562.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5408226897ff482d650b76b742dc2ae1db52e68c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-04-16T22:33:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29491#event-402562"
}
```



---

archive/issue_comments_463429.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@mkoeppe](#comment%3A17):\n> Still failing. https://github.com/mkoeppe/sage/runs/577560337\n> \n> Really shouldn't be using AC_MSG_ERROR at all here.\n> If gp2c spkg-configure can't find the needed bits of pari, then we have to build our own pari.\n\nFollow-up = #32359",
    "created_at": "2021-08-10T16:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463429",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@mkoeppe](#comment%3A17):
> Still failing. https://github.com/mkoeppe/sage/runs/577560337
> 
> Really shouldn't be using AC_MSG_ERROR at all here.
> If gp2c spkg-configure can't find the needed bits of pari, then we have to build our own pari.

Follow-up = #32359



---

archive/issue_comments_463430.json:
```json
{
    "body": "Changed commit from **[`b5d16d9`](https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1)** to none",
    "created_at": "2021-08-10T16:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463430",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`b5d16d9`](https://github.com/sagemath/sagetrac-mirror/commit/b5d16d9927a1879a011f3a725636b027cabbe5a1)** to none



---

archive/issue_comments_463431.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\ngp2c is optional, so in some cases it is ok...",
    "created_at": "2021-08-10T19:50:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29491#issuecomment-463431",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

gp2c is optional, so in some cases it is ok...
