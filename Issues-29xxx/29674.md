# Issue 29674: fedora-32:  If gcc 10 is found, install gcc spkg; fix building gcc (9.2.0) spkg with gcc 10

archive/issues_029437.json:
```json
{
    "body": "To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), \nwe reject system gcc 10 and build the gcc spkg instead.\n\nThat itself requires patches, which we get from https://bugs.gentoo.org/708346, for the following error:\n\n```\nlibtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o\nIn file included from ../../../../src/libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.cc:193:\n../../../../src/libsanitizer/sanitizer_common/sanitizer_internal_defs.h:339:72: error: narrowing conversion of '-1' from 'int' to 'long unsigned int' [-Wnarrowing]\n  339 |     typedef char IMPL_PASTE(assertion_failed_##_, line)[2*(int)(pred)-1]\n      |                                                                        ^\n```\n\nTo reproduce:\n\n```\n  tox -e docker-fedora-32-standard-gcc_spkg\n```\n\nSee also:\n- https://bugzilla.redhat.com/show_bug.cgi?id=1774798\n\n\n\n\n**CC:**  @dimpase @kiwifb @orlitzky @vbraun @enriqueartal\n\n**Branch/Commit:** [ca0d8a4198517a8d6e019a8704a8de48f8e45ef8](https://github.com/sagemath/sagetrac-mirror/commit/ca0d8a4198517a8d6e019a8704a8de48f8e45ef8)\n\n**Reviewer:** Michael Orlitzky\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/29674\n\n",
    "closed_at": "2020-05-13T19:17:23Z",
    "created_at": "2020-05-10T21:20:18Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "fedora-32:  If gcc 10 is found, install gcc spkg; fix building gcc (9.2.0) spkg with gcc 10",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29674",
    "user": "https://github.com/mkoeppe"
}
```
To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), 
we reject system gcc 10 and build the gcc spkg instead.

That itself requires patches, which we get from https://bugs.gentoo.org/708346, for the following error:

```
libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o
In file included from ../../../../src/libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.cc:193:
../../../../src/libsanitizer/sanitizer_common/sanitizer_internal_defs.h:339:72: error: narrowing conversion of '-1' from 'int' to 'long unsigned int' [-Wnarrowing]
  339 |     typedef char IMPL_PASTE(assertion_failed_##_, line)[2*(int)(pred)-1]
      |                                                                        ^
```

To reproduce:

```
  tox -e docker-fedora-32-standard-gcc_spkg
```

See also:
- https://bugzilla.redhat.com/show_bug.cgi?id=1774798




**CC:**  @dimpase @kiwifb @orlitzky @vbraun @enriqueartal

**Branch/Commit:** [ca0d8a4198517a8d6e019a8704a8de48f8e45ef8](https://github.com/sagemath/sagetrac-mirror/commit/ca0d8a4198517a8d6e019a8704a8de48f8e45ef8)

**Reviewer:** Michael Orlitzky

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/29674





---

archive/issue_comments_471902.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,3 +14,8 @@\n   tox -e docker-fedora-32-standard-gcc_spkg\n ```\n \n+See:\n+- https://bugs.gentoo.org/708346\n+- https://bugzilla.redhat.com/show_bug.cgi?id=1774798\n+\n+\n``````\n",
    "created_at": "2020-05-10T21:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471902",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,3 +14,8 @@
   tox -e docker-fedora-32-standard-gcc_spkg
 ```
 
+See:
+- https://bugs.gentoo.org/708346
+- https://bugzilla.redhat.com/show_bug.cgi?id=1774798
+
+
``````




---

archive/issue_comments_471903.json:
```json
{
    "body": "<a id='comment:2'></a>\nLet's add the patches from gentoo",
    "created_at": "2020-05-10T21:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Let's add the patches from gentoo



---

archive/issue_events_269053.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-10T21:29:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269053"
}
```



---

archive/issue_events_269054.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-10T21:29:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269054"
}
```



---

archive/issue_comments_471904.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-05-10T21:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471904",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_471905.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10)",
    "created_at": "2020-05-10T22:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471905",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10)



---

archive/issue_comments_471906.json:
```json
{
    "body": "**Commit:** [fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22](https://github.com/sagemath/sagetrac-mirror/commit/fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22)",
    "created_at": "2020-05-10T22:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471906",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22](https://github.com/sagemath/sagetrac-mirror/commit/fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22)



---

archive/issue_comments_471907.json:
```json
{
    "body": "<a id='comment:6'></a>\nTests of `-gcc_spkg` run at https://github.com/mkoeppe/sage/actions/runs/100892171\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/790d1b6a4eb184f8ced7d04410161de10327ac23\">790d1b6</a></td><td><code>build/pkgs/gcc: Add gentoo patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22\">fb71dc0</a></td><td><code>build/pkgs/gcc: Remove gentoo-specific part of gentoo patch</code></td></tr></table>\n",
    "created_at": "2020-05-10T22:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471907",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Tests of `-gcc_spkg` run at https://github.com/mkoeppe/sage/actions/runs/100892171

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/790d1b6a4eb184f8ced7d04410161de10327ac23">790d1b6</a></td><td><code>build/pkgs/gcc: Add gentoo patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22">fb71dc0</a></td><td><code>build/pkgs/gcc: Remove gentoo-specific part of gentoo patch</code></td></tr></table>




---

archive/issue_comments_471908.json:
```json
{
    "body": "**Changing commit** from \"[fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22](https://github.com/sagemath/sagetrac-mirror/commit/fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22)\" to \"[d5033ef989e54c89b4e5484900f283bd4246b892](https://github.com/sagemath/sagetrac-mirror/commit/d5033ef989e54c89b4e5484900f283bd4246b892)\".",
    "created_at": "2020-05-10T23:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471908",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22](https://github.com/sagemath/sagetrac-mirror/commit/fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22)" to "[d5033ef989e54c89b4e5484900f283bd4246b892](https://github.com/sagemath/sagetrac-mirror/commit/d5033ef989e54c89b4e5484900f283bd4246b892)".



---

archive/issue_comments_471909.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52146410b53e8f33dbf032f94eaf9f678f94c2be\">5214641</a></td><td><code>.github/workflows/tox-gcc_spkg.yml: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5033ef989e54c89b4e5484900f283bd4246b892\">d5033ef</a></td><td><code>build/pkgs/gcc/spkg-configure.m4: Reject gcc (gnu) >= 10</code></td></tr></table>\n",
    "created_at": "2020-05-10T23:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52146410b53e8f33dbf032f94eaf9f678f94c2be">5214641</a></td><td><code>.github/workflows/tox-gcc_spkg.yml: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5033ef989e54c89b4e5484900f283bd4246b892">d5033ef</a></td><td><code>build/pkgs/gcc/spkg-configure.m4: Reject gcc (gnu) >= 10</code></td></tr></table>




---

archive/issue_events_269055.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-10T23:50:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "rename": {
        "from": "fedora-32: Building gcc (9.2.0) spkg fails with gcc 10",
        "to": "fedora-32:  If gcc 10 is found, install gcc spkg; fix building gcc (9.2.0) spkg with gcc 10"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269055"
}
```



---

archive/issue_comments_471910.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), \n+we reject system gcc 10 and build the gcc spkg instead.\n+\n+That itself requires patches, whuch we get from https://bugs.gentoo.org/708346, for the following error:\n \n ```\n libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o\n@@ -7,15 +11,14 @@\n       |                                                                        ^\n ```\n \n-\n To reproduce:\n \n ```\n   tox -e docker-fedora-32-standard-gcc_spkg\n ```\n \n-See:\n-- https://bugs.gentoo.org/708346\n+See also:\n - https://bugzilla.redhat.com/show_bug.cgi?id=1774798\n \n \n+\n``````\n",
    "created_at": "2020-05-10T23:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471910",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
+To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), 
+we reject system gcc 10 and build the gcc spkg instead.
+
+That itself requires patches, whuch we get from https://bugs.gentoo.org/708346, for the following error:
 
 ```
 libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o
@@ -7,15 +11,14 @@
       |                                                                        ^
 ```
 
-
 To reproduce:
 
 ```
   tox -e docker-fedora-32-standard-gcc_spkg
 ```
 
-See:
-- https://bugs.gentoo.org/708346
+See also:
 - https://bugzilla.redhat.com/show_bug.cgi?id=1774798
 
 
+
``````




---

archive/issue_events_269056.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-10T23:51:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269056"
}
```



---

archive/issue_comments_471911.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe test for IS_REALLY_GCC had bitrotted away and as a result the version check actually didn't run. Fixed.",
    "created_at": "2020-05-10T23:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471911",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
The test for IS_REALLY_GCC had bitrotted away and as a result the version check actually didn't run. Fixed.



---

archive/issue_events_269057.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-11T01:09:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269057"
}
```



---

archive/issue_events_269058.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-11T01:09:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269058"
}
```



---

archive/issue_comments_471912.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76dcef3e539aae28a2d74ef2fbd59eed1530bf64\">76dcef3</a></td><td><code>build/pkgs/gcc: Add gentoo patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a13e5e93328a944a5e2f14ff403c42828a90b988\">a13e5e9</a></td><td><code>.github/workflows/tox-gcc_spkg.yml: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca0d8a4198517a8d6e019a8704a8de48f8e45ef8\">ca0d8a4</a></td><td><code>build/pkgs/gcc/spkg-configure.m4: Reject gcc (gnu) >= 10</code></td></tr></table>\n",
    "created_at": "2020-05-11T01:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471912",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76dcef3e539aae28a2d74ef2fbd59eed1530bf64">76dcef3</a></td><td><code>build/pkgs/gcc: Add gentoo patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a13e5e93328a944a5e2f14ff403c42828a90b988">a13e5e9</a></td><td><code>.github/workflows/tox-gcc_spkg.yml: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca0d8a4198517a8d6e019a8704a8de48f8e45ef8">ca0d8a4</a></td><td><code>build/pkgs/gcc/spkg-configure.m4: Reject gcc (gnu) >= 10</code></td></tr></table>




---

archive/issue_comments_471913.json:
```json
{
    "body": "**Changing commit** from \"[d5033ef989e54c89b4e5484900f283bd4246b892](https://github.com/sagemath/sagetrac-mirror/commit/d5033ef989e54c89b4e5484900f283bd4246b892)\" to \"[ca0d8a4198517a8d6e019a8704a8de48f8e45ef8](https://github.com/sagemath/sagetrac-mirror/commit/ca0d8a4198517a8d6e019a8704a8de48f8e45ef8)\".",
    "created_at": "2020-05-11T01:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d5033ef989e54c89b4e5484900f283bd4246b892](https://github.com/sagemath/sagetrac-mirror/commit/d5033ef989e54c89b4e5484900f283bd4246b892)" to "[ca0d8a4198517a8d6e019a8704a8de48f8e45ef8](https://github.com/sagemath/sagetrac-mirror/commit/ca0d8a4198517a8d6e019a8704a8de48f8e45ef8)".



---

archive/issue_comments_471914.json:
```json
{
    "body": "<a id='comment:14'></a>\nNew tests running at https://github.com/mkoeppe/sage/actions",
    "created_at": "2020-05-11T01:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471914",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
New tests running at https://github.com/mkoeppe/sage/actions



---

archive/issue_events_269059.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-11T01:35:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269059"
}
```



---

archive/issue_events_269060.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-11T01:35:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269060"
}
```



---

archive/issue_comments_471915.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), \n we reject system gcc 10 and build the gcc spkg instead.\n \n-That itself requires patches, whuch we get from https://bugs.gentoo.org/708346, for the following error:\n+That itself requires patches, which we get from https://bugs.gentoo.org/708346, for the following error:\n \n ```\n libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o\n``````\n",
    "created_at": "2020-05-11T03:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471915",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), 
 we reject system gcc 10 and build the gcc spkg instead.
 
-That itself requires patches, whuch we get from https://bugs.gentoo.org/708346, for the following error:
+That itself requires patches, which we get from https://bugs.gentoo.org/708346, for the following error:
 
 ```
 libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o
``````




---

archive/issue_comments_471916.json:
```json
{
    "body": "<a id='comment:17'></a>\nSome of the new tests for `-gcc_spkg` at https://github.com/mkoeppe/sage/runs/661787493?check_suite_focus=true have unrelated failures, for which I have opened #29675. These are not important to fix.",
    "created_at": "2020-05-11T05:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471916",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Some of the new tests for `-gcc_spkg` at https://github.com/mkoeppe/sage/runs/661787493?check_suite_focus=true have unrelated failures, for which I have opened #29675. These are not important to fix.



---

archive/issue_comments_471917.json:
```json
{
    "body": "<a id='comment:18'></a>\n`fedora-32-standard-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787882), `fedora-32-standard-python2-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787887) work correctly with this fix. \n\n`fedora-32-minimal-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787878) is clean too but times out.",
    "created_at": "2020-05-11T14:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471917",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
`fedora-32-standard-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787882), `fedora-32-standard-python2-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787887) work correctly with this fix. 

`fedora-32-minimal-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787878) is clean too but times out.



---

archive/issue_comments_471918.json:
```json
{
    "body": "<a id='comment:19'></a>\nAnd `fedora-32-standard` (https://github.com/mkoeppe/sage/runs/661788407) shows the changes to the spkg-configure:\n\n```\nhecking whether SageMath should install SPKG gcc...\nchecking for C compiler vendor... gnu\nchecking whether g++ supports C++11 features with -std=gnu++11... yes\nchecking for gcc option to accept ISO C99... none needed\nchecking if gcc accepts -dumpversion option... yes\nchecking gcc version... 10\nchecking if g++ accepts -dumpversion option... yes\nchecking g++ version... 10\nconfigure: Installing GCC because g++ -std=gnu++11 is g++ version 10, which is too recent for this version of Sage\nconfigure: no suitable system package found for SPKG gcc\n```\nThe runs on systems other than `fedora-32` are unchanged (https://github.com/mkoeppe/sage/actions/runs/100987613).\n\n\nReady for review",
    "created_at": "2020-05-12T05:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471918",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
And `fedora-32-standard` (https://github.com/mkoeppe/sage/runs/661788407) shows the changes to the spkg-configure:

```
hecking whether SageMath should install SPKG gcc...
checking for C compiler vendor... gnu
checking whether g++ supports C++11 features with -std=gnu++11... yes
checking for gcc option to accept ISO C99... none needed
checking if gcc accepts -dumpversion option... yes
checking gcc version... 10
checking if g++ accepts -dumpversion option... yes
checking g++ version... 10
configure: Installing GCC because g++ -std=gnu++11 is g++ version 10, which is too recent for this version of Sage
configure: no suitable system package found for SPKG gcc
```
The runs on systems other than `fedora-32` are unchanged (https://github.com/mkoeppe/sage/actions/runs/100987613).


Ready for review



---

archive/issue_comments_471919.json:
```json
{
    "body": "**Reviewer:** Michael Orlitzky",
    "created_at": "2020-05-12T12:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471919",
    "user": "https://github.com/orlitzky"
}
```

**Reviewer:** Michael Orlitzky



---

archive/issue_events_269061.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-05-12T12:42:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269061"
}
```



---

archive/issue_events_269062.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-05-12T12:42:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269062"
}
```



---

archive/issue_comments_471920.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A11):\n> The test for IS_REALLY_GCC had bitrotted away and as a result the version check actually didn't run. Fixed.\n\n\nI'm skeptical that this worked in the first place (that's a shell pipe, not a regex):\n\n```\nAS_CASE([\"$GXX_VERSION.0\"],\n                [[[0-3]].*|4.[[0-7]].*], [\n```\n\nI can't really test this but the changes are reasonable. The main risk with something like this is that the patches would break something with older glibc, but the fact that upstream backported these two patches to the 9.3 branch suggests that they wouldn't. The CI checks confirm that, and everyone else will be using their system GCC anyway, so let's try it.",
    "created_at": "2020-05-12T12:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471920",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A11):
> The test for IS_REALLY_GCC had bitrotted away and as a result the version check actually didn't run. Fixed.


I'm skeptical that this worked in the first place (that's a shell pipe, not a regex):

```
AS_CASE(["$GXX_VERSION.0"],
                [[[0-3]].*|4.[[0-7]].*], [
```

I can't really test this but the changes are reasonable. The main risk with something like this is that the patches would break something with older glibc, but the fact that upstream backported these two patches to the 9.3 branch suggests that they wouldn't. The CI checks confirm that, and everyone else will be using their system GCC anyway, so let's try it.



---

archive/issue_comments_471921.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mjo](#comment%3A20):\n> \n> I'm skeptical that this worked in the first place (that's a shell pipe, not a regex):\n> \n> ```\n> AS_CASE([\"$GXX_VERSION.0\"],\n>                 [[[0-3]].*|4.[[0-7]].*], [\n> ```\n> \n\n\nApparently it does, even without bash's extglob. TIL.",
    "created_at": "2020-05-12T12:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471921",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'></a>
Replying to [mjo](#comment%3A20):
> 
> I'm skeptical that this worked in the first place (that's a shell pipe, not a regex):
> 
> ```
> AS_CASE(["$GXX_VERSION.0"],
>                 [[[0-3]].*|4.[[0-7]].*], [
> ```
> 


Apparently it does, even without bash's extglob. TIL.



---

archive/issue_comments_471922.json:
```json
{
    "body": "<a id='comment:22'></a>\nThanks!",
    "created_at": "2020-05-12T15:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471922",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Thanks!



---

archive/issue_events_269063.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-13T19:17:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269063"
}
```



---

archive/issue_events_269064.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-13T19:17:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-269064"
}
```



---

archive/issue_comments_471923.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10)\" to \"[ca0d8a4198517a8d6e019a8704a8de48f8e45ef8](https://github.com/sagemath/sagetrac-mirror/commit/ca0d8a4198517a8d6e019a8704a8de48f8e45ef8)\".",
    "created_at": "2020-05-13T19:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-471923",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10)" to "[ca0d8a4198517a8d6e019a8704a8de48f8e45ef8](https://github.com/sagemath/sagetrac-mirror/commit/ca0d8a4198517a8d6e019a8704a8de48f8e45ef8)".
