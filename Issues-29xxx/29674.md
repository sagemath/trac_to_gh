# Issue 29674: fedora-32:  If gcc 10 is found, install gcc spkg; fix building gcc (9.2.0) spkg with gcc 10

archive/issues_029437.json:
```json
{
    "body": "To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), \nwe reject system gcc 10 and build the gcc spkg instead.\n\nThat itself requires patches, which we get from https://bugs.gentoo.org/708346, for the following error:\n\n```\nlibtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o\nIn file included from ../../../../src/libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.cc:193:\n../../../../src/libsanitizer/sanitizer_common/sanitizer_internal_defs.h:339:72: error: narrowing conversion of '-1' from 'int' to 'long unsigned int' [-Wnarrowing]\n  339 |     typedef char IMPL_PASTE(assertion_failed_##_, line)[2*(int)(pred)-1]\n      |                                                                        ^\n```\n\nTo reproduce:\n\n```\n  tox -e docker-fedora-32-standard-gcc_spkg\n```\n\nSee also:\n- https://bugzilla.redhat.com/show_bug.cgi?id=1774798\n\n\n\n\nCC:  @dimpase @kiwifb @orlitzky @vbraun @enriqueartal\n\nBranch/Commit: ca0d8a4198517a8d6e019a8704a8de48f8e45ef8\n\nReviewer: Michael Orlitzky\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29674\n\n",
    "closed_at": "2020-05-13T19:17:23Z",
    "created_at": "2020-05-10T21:20:18Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "fedora-32:  If gcc 10 is found, install gcc spkg; fix building gcc (9.2.0) spkg with gcc 10",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29674",
    "user": "https://github.com/mkoeppe"
}
```
To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), 
we reject system gcc 10 and build the gcc spkg instead.

That itself requires patches, which we get from https://bugs.gentoo.org/708346, for the following error:

```
libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o
In file included from ../../../../src/libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.cc:193:
../../../../src/libsanitizer/sanitizer_common/sanitizer_internal_defs.h:339:72: error: narrowing conversion of '-1' from 'int' to 'long unsigned int' [-Wnarrowing]
  339 |     typedef char IMPL_PASTE(assertion_failed_##_, line)[2*(int)(pred)-1]
      |                                                                        ^
```

To reproduce:

```
  tox -e docker-fedora-32-standard-gcc_spkg
```

See also:
- https://bugzilla.redhat.com/show_bug.cgi?id=1774798




CC:  @dimpase @kiwifb @orlitzky @vbraun @enriqueartal

Branch/Commit: ca0d8a4198517a8d6e019a8704a8de48f8e45ef8

Reviewer: Michael Orlitzky

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29674





---

archive/issue_comments_580902.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,8 @@\n   tox -e docker-fedora-32-standard-gcc_spkg\n ```\n \n+See:\n+- https://bugs.gentoo.org/708346\n+- https://bugzilla.redhat.com/show_bug.cgi?id=1774798\n+\n+\n``````\n",
    "created_at": "2020-05-10T21:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580902",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,8 @@
   tox -e docker-fedora-32-standard-gcc_spkg
 ```
 
+See:
+- https://bugs.gentoo.org/708346
+- https://bugzilla.redhat.com/show_bug.cgi?id=1774798
+
+
``````




---

archive/issue_comments_580903.json:
```json
{
    "body": "<a id='comment:2'></a>\nLet's add the patches from gentoo",
    "created_at": "2020-05-10T21:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Let's add the patches from gentoo



---

archive/issue_comments_580904.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2020-05-10T21:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580904",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_580905.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-05-10T21:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580905",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_580906.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10\"",
    "created_at": "2020-05-10T22:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580906",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10"



---

archive/issue_comments_580907.json:
```json
{
    "body": "Changing commit from \"\" to \"fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22\"",
    "created_at": "2020-05-10T22:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580907",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22"



---

archive/issue_comments_580908.json:
```json
{
    "body": "<a id='comment:6'></a>\nTests of `-gcc_spkg` run at https://github.com/mkoeppe/sage/actions/runs/100892171\n\n---\nNew commits:\n|                                                                                                                                          |                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[790d1b6](https://git.sagemath.org/sage.git/commit?id=790d1b6a4eb184f8ced7d04410161de10327ac23)|`build/pkgs/gcc: Add gentoo patch`|\n|[fb71dc0](https://git.sagemath.org/sage.git/commit?id=fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22)|`build/pkgs/gcc: Remove gentoo-specific part of gentoo patch`|",
    "created_at": "2020-05-10T22:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580908",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Tests of `-gcc_spkg` run at https://github.com/mkoeppe/sage/actions/runs/100892171

---
New commits:
|                                                                                                                                          |                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[790d1b6](https://git.sagemath.org/sage.git/commit?id=790d1b6a4eb184f8ced7d04410161de10327ac23)|`build/pkgs/gcc: Add gentoo patch`|
|[fb71dc0](https://git.sagemath.org/sage.git/commit?id=fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22)|`build/pkgs/gcc: Remove gentoo-specific part of gentoo patch`|



---

archive/issue_comments_580909.json:
```json
{
    "body": "Changing commit from \"fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22\" to \"d5033ef989e54c89b4e5484900f283bd4246b892\"",
    "created_at": "2020-05-10T23:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fb71dc08e9cbaaf2f841da8c23d1dd623c61ea22" to "d5033ef989e54c89b4e5484900f283bd4246b892"



---

archive/issue_comments_580910.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[5214641](https://git.sagemath.org/sage.git/commit/?id=52146410b53e8f33dbf032f94eaf9f678f94c2be)|`.github/workflows/tox-gcc_spkg.yml: New`|\n|[d5033ef](https://git.sagemath.org/sage.git/commit/?id=d5033ef989e54c89b4e5484900f283bd4246b892)|`build/pkgs/gcc/spkg-configure.m4: Reject gcc (gnu) >= 10`|",
    "created_at": "2020-05-10T23:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[5214641](https://git.sagemath.org/sage.git/commit/?id=52146410b53e8f33dbf032f94eaf9f678f94c2be)|`.github/workflows/tox-gcc_spkg.yml: New`|
|[d5033ef](https://git.sagemath.org/sage.git/commit/?id=d5033ef989e54c89b4e5484900f283bd4246b892)|`build/pkgs/gcc/spkg-configure.m4: Reject gcc (gnu) >= 10`|



---

archive/issue_comments_580911.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), \n+we reject system gcc 10 and build the gcc spkg instead.\n+\n+That itself requires patches, whuch we get from https://bugs.gentoo.org/708346, for the following error:\n \n ```\n libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o\n@@ -7,15 +11,14 @@\n       |                                                                        ^\n ```\n \n-\n To reproduce:\n \n ```\n   tox -e docker-fedora-32-standard-gcc_spkg\n ```\n \n-See:\n-- https://bugs.gentoo.org/708346\n+See also:\n - https://bugzilla.redhat.com/show_bug.cgi?id=1774798\n \n \n+\n``````\n",
    "created_at": "2020-05-10T23:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580911",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
+To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), 
+we reject system gcc 10 and build the gcc spkg instead.
+
+That itself requires patches, whuch we get from https://bugs.gentoo.org/708346, for the following error:
 
 ```
 libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o
@@ -7,15 +11,14 @@
       |                                                                        ^
 ```
 
-
 To reproduce:
 
 ```
   tox -e docker-fedora-32-standard-gcc_spkg
 ```
 
-See:
-- https://bugs.gentoo.org/708346
+See also:
 - https://bugzilla.redhat.com/show_bug.cgi?id=1774798
 
 
+
``````




---

archive/issue_comments_580912.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-10T23:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580912",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_580913.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe test for IS_REALLY_GCC had bitrotted away and as a result the version check actually didn't run. Fixed.",
    "created_at": "2020-05-10T23:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580913",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
The test for IS_REALLY_GCC had bitrotted away and as a result the version check actually didn't run. Fixed.



---

archive/issue_comments_580914.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-05-11T01:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580914",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_580915.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[76dcef3](https://git.sagemath.org/sage.git/commit/?id=76dcef3e539aae28a2d74ef2fbd59eed1530bf64)|`build/pkgs/gcc: Add gentoo patch`|\n|[a13e5e9](https://git.sagemath.org/sage.git/commit/?id=a13e5e93328a944a5e2f14ff403c42828a90b988)|`.github/workflows/tox-gcc_spkg.yml: New`|\n|[ca0d8a4](https://git.sagemath.org/sage.git/commit/?id=ca0d8a4198517a8d6e019a8704a8de48f8e45ef8)|`build/pkgs/gcc/spkg-configure.m4: Reject gcc (gnu) >= 10`|",
    "created_at": "2020-05-11T01:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580915",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[76dcef3](https://git.sagemath.org/sage.git/commit/?id=76dcef3e539aae28a2d74ef2fbd59eed1530bf64)|`build/pkgs/gcc: Add gentoo patch`|
|[a13e5e9](https://git.sagemath.org/sage.git/commit/?id=a13e5e93328a944a5e2f14ff403c42828a90b988)|`.github/workflows/tox-gcc_spkg.yml: New`|
|[ca0d8a4](https://git.sagemath.org/sage.git/commit/?id=ca0d8a4198517a8d6e019a8704a8de48f8e45ef8)|`build/pkgs/gcc/spkg-configure.m4: Reject gcc (gnu) >= 10`|



---

archive/issue_comments_580916.json:
```json
{
    "body": "Changing commit from \"d5033ef989e54c89b4e5484900f283bd4246b892\" to \"ca0d8a4198517a8d6e019a8704a8de48f8e45ef8\"",
    "created_at": "2020-05-11T01:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580916",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d5033ef989e54c89b4e5484900f283bd4246b892" to "ca0d8a4198517a8d6e019a8704a8de48f8e45ef8"



---

archive/issue_comments_580917.json:
```json
{
    "body": "<a id='comment:14'></a>\nNew tests running at https://github.com/mkoeppe/sage/actions",
    "created_at": "2020-05-11T01:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580917",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
New tests running at https://github.com/mkoeppe/sage/actions



---

archive/issue_comments_580918.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-05-11T01:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580918",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_580919.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), \n we reject system gcc 10 and build the gcc spkg instead.\n \n-That itself requires patches, whuch we get from https://bugs.gentoo.org/708346, for the following error:\n+That itself requires patches, which we get from https://bugs.gentoo.org/708346, for the following error:\n \n ```\n libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o\n``````\n",
    "created_at": "2020-05-11T03:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580919",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 To work around build failures of some SPKGs with gcc 10, in particular on fedora-32 (#29456), 
 we reject system gcc 10 and build the gcc spkg instead.
 
-That itself requires patches, whuch we get from https://bugs.gentoo.org/708346, for the following error:
+That itself requires patches, which we get from https://bugs.gentoo.org/708346, for the following error:
 
 ```
 libtool: compile:  /sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc/xgcc -shared-libgcc -B/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/./gcc -nostdinc++ -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/src/.libs -L/sage/local/var/tmp/sage/build/gcc-9.2.0/gcc-build/x86_64-pc-linux-gnu/libstdc++-v3/libsupc++/.libs -B/sage/local/x86_64-pc-linux-gnu/bin/ -B/sage/local/x86_64-pc-linux-gnu/lib/ -isystem /sage/local/x86_64-pc-linux-gnu/include -isystem /sage/local/x86_64-pc-linux-gnu/sys-include -D_GNU_SOURCE -D_DEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -DHAVE_RPC_XDR_H=0 -DHAVE_TIRPC_RPC_XDR_H=0 -I. -I../../../../src/libsanitizer/sanitizer_common -I.. -I ../../../../src/libsanitizer/include -isystem ../../../../src/libsanitizer/include/system -Wall -W -Wno-unused-parameter -Wwrite-strings -pedantic -Wno-long-long -fPIC -fno-builtin -fno-exceptions -fno-rtti -fomit-frame-pointer -funwind-tables -fvisibility=hidden -Wno-variadic-macros -I../../libstdc++-v3/include -I../../libstdc++-v3/include/x86_64-pc-linux-gnu -I../../../../src/libsanitizer/../libstdc++-v3/libsupc++ -std=gnu++11 -DSANITIZER_LIBBACKTRACE -DSANITIZER_CP_DEMANGLE -I ../../../../src/libsanitizer/../libbacktrace -I ../libbacktrace -I ../../../../src/libsanitizer/../include -include ../../../../src/libsanitizer/libbacktrace/backtrace-rename.h -g -O2 -D_GNU_SOURCE -MT sanitizer_posix.lo -MD -MP -MF .deps/sanitizer_posix.Tpo -c ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc  -fPIC -DPIC -o .libs/sanitizer_posix.o
``````




---

archive/issue_comments_580920.json:
```json
{
    "body": "<a id='comment:17'></a>\nSome of the new tests for `-gcc_spkg` at https://github.com/mkoeppe/sage/runs/661787493?check_suite_focus=true have unrelated failures, for which I have opened #29675. These are not important to fix.",
    "created_at": "2020-05-11T05:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580920",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Some of the new tests for `-gcc_spkg` at https://github.com/mkoeppe/sage/runs/661787493?check_suite_focus=true have unrelated failures, for which I have opened #29675. These are not important to fix.



---

archive/issue_comments_580921.json:
```json
{
    "body": "<a id='comment:18'></a>\n`fedora-32-standard-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787882), `fedora-32-standard-python2-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787887) work correctly with this fix. \n\n`fedora-32-minimal-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787878) is clean too but times out.",
    "created_at": "2020-05-11T14:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580921",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
`fedora-32-standard-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787882), `fedora-32-standard-python2-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787887) work correctly with this fix. 

`fedora-32-minimal-gcc_spkg` (https://github.com/mkoeppe/sage/runs/661787878) is clean too but times out.



---

archive/issue_comments_580922.json:
```json
{
    "body": "<a id='comment:19'></a>\nAnd `fedora-32-standard` (https://github.com/mkoeppe/sage/runs/661788407) shows the changes to the spkg-configure:\n\n```\nhecking whether SageMath should install SPKG gcc...\nchecking for C compiler vendor... gnu\nchecking whether g++ supports C++11 features with -std=gnu++11... yes\nchecking for gcc option to accept ISO C99... none needed\nchecking if gcc accepts -dumpversion option... yes\nchecking gcc version... 10\nchecking if g++ accepts -dumpversion option... yes\nchecking g++ version... 10\nconfigure: Installing GCC because g++ -std=gnu++11 is g++ version 10, which is too recent for this version of Sage\nconfigure: no suitable system package found for SPKG gcc\n```\nThe runs on systems other than `fedora-32` are unchanged (https://github.com/mkoeppe/sage/actions/runs/100987613).\n\n\nReady for review",
    "created_at": "2020-05-12T05:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580922",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
And `fedora-32-standard` (https://github.com/mkoeppe/sage/runs/661788407) shows the changes to the spkg-configure:

```
hecking whether SageMath should install SPKG gcc...
checking for C compiler vendor... gnu
checking whether g++ supports C++11 features with -std=gnu++11... yes
checking for gcc option to accept ISO C99... none needed
checking if gcc accepts -dumpversion option... yes
checking gcc version... 10
checking if g++ accepts -dumpversion option... yes
checking g++ version... 10
configure: Installing GCC because g++ -std=gnu++11 is g++ version 10, which is too recent for this version of Sage
configure: no suitable system package found for SPKG gcc
```
The runs on systems other than `fedora-32` are unchanged (https://github.com/mkoeppe/sage/actions/runs/100987613).


Ready for review



---

archive/issue_comments_580923.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Michael Orlitzky\"",
    "created_at": "2020-05-12T12:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580923",
    "user": "https://github.com/orlitzky"
}
```

Changing reviewer from "" to "Michael Orlitzky"



---

archive/issue_comments_580924.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-12T12:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580924",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_580925.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A11):\n> The test for IS_REALLY_GCC had bitrotted away and as a result the version check actually didn't run. Fixed.\n\n\nI'm skeptical that this worked in the first place (that's a shell pipe, not a regex):\n\n```\nAS_CASE([\"$GXX_VERSION.0\"],\n                [[[0-3]].*|4.[[0-7]].*], [\n```\n\nI can't really test this but the changes are reasonable. The main risk with something like this is that the patches would break something with older glibc, but the fact that upstream backported these two patches to the 9.3 branch suggests that they wouldn't. The CI checks confirm that, and everyone else will be using their system GCC anyway, so let's try it.",
    "created_at": "2020-05-12T12:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580925",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A11):
> The test for IS_REALLY_GCC had bitrotted away and as a result the version check actually didn't run. Fixed.


I'm skeptical that this worked in the first place (that's a shell pipe, not a regex):

```
AS_CASE(["$GXX_VERSION.0"],
                [[[0-3]].*|4.[[0-7]].*], [
```

I can't really test this but the changes are reasonable. The main risk with something like this is that the patches would break something with older glibc, but the fact that upstream backported these two patches to the 9.3 branch suggests that they wouldn't. The CI checks confirm that, and everyone else will be using their system GCC anyway, so let's try it.



---

archive/issue_comments_580926.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mjo](#comment%3A20):\n> \n> I'm skeptical that this worked in the first place (that's a shell pipe, not a regex):\n> \n> \n> ```\n> AS_CASE([\"$GXX_VERSION.0\"],\n>                 [[[0-3]].*|4.[[0-7]].*], [\n> ```\n> \n\n\nApparently it does, even without bash's extglob. TIL.",
    "created_at": "2020-05-12T12:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580926",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'></a>
Replying to [mjo](#comment%3A20):
> 
> I'm skeptical that this worked in the first place (that's a shell pipe, not a regex):
> 
> 
> ```
> AS_CASE(["$GXX_VERSION.0"],
>                 [[[0-3]].*|4.[[0-7]].*], [
> ```
> 


Apparently it does, even without bash's extglob. TIL.



---

archive/issue_comments_580927.json:
```json
{
    "body": "<a id='comment:22'></a>\nThanks!",
    "created_at": "2020-05-12T15:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580927",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Thanks!



---

archive/issue_comments_580928.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-13T19:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580928",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_075869.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-13T19:17:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29674#event-75869"
}
```



---

archive/issue_comments_580929.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10\" to \"ca0d8a4198517a8d6e019a8704a8de48f8e45ef8\"",
    "created_at": "2020-05-13T19:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29674#issuecomment-580929",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/fedora_32__building_gcc__9_2_0__spkg_fails_with_gcc_10" to "ca0d8a4198517a8d6e019a8704a8de48f8e45ef8"
