# Issue 29837: Improvement for incidence matrix of polyhedra

archive/issues_029600.json:
```json
{
    "body": "This ticket collects some improvements for obtaining incidence matrices:\n\n- The method `self._is_zero` is called many times and we can save plenty of time by obtaining it beforehand.\n- We can obtain the slack matrix by multiplying the Vrepresentation matrix with the homogenous Vrepresentation. From this we can obtain the incidence matrix (strangely this last step takes up most of the time).\n\n  Unfortunately, matrix multiplication for algebraic fields isn't very efficient. So we need to keep the old method in this case.\n\nBefore this ticket:\n\n```\nsage: P = polytopes.permutahedron(7)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 751 ms, sys: 7.95 ms, total: 759 ms\nWall time: 758 ms\nsage: P = polytopes.associahedron(['A', 9])\nsage: %time _ = P.incidence_matrix()\nCPU times: user 1.94 s, sys: 4.03 ms, total: 1.94 s\nWall time: 1.94 s\nsage: P = polytopes.hypercube(14)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 670 ms, sys: 0 ns, total: 670 ms\nWall time: 669 ms\nsage: K.<sqrt2> = QuadraticField(2)\nsage: P = polytopes.permutahedron(7).dilation(sqrt2)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 3.82 s, sys: 0 ns, total: 3.82 s\nWall time: 3.82 s\n```\n\nWith this ticket:\n\n```\nsage: P = polytopes.permutahedron(7)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 64.4 ms, sys: 7 \u00b5s, total: 64.4 ms\nWall time: 63.6 ms\nsage: P = polytopes.associahedron(['A', 9])\nsage: %time _ = P.incidence_matrix()\nCPU times: user 325 ms, sys: 12.1 ms, total: 337 ms\nWall time: 335 ms\nsage: P = polytopes.hypercube(14)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 139 ms, sys: 12 ms, total: 151 ms\nWall time: 149 ms\nsage: K.<sqrt2> = QuadraticField(2)\nsage: P = polytopes.permutahedron(7).dilation(sqrt2)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 3.69 s, sys: 3.69 ms, total: 3.69 s\nWall time: 3.69 s\n```\n\nCC:  @jplab @laisrast\n\nKeywords: polyhedra, incidence matrix\n\nBranch/Commit: 955f12baa3ecf69aac9e7c6fb7773993f3eb9e80\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jonathan Kliem\n\nDependencies: #29838, #29839\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29837\n\n",
    "closed_at": "2020-07-10T19:34:05Z",
    "created_at": "2020-06-10T10:09:27Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Improvement for incidence matrix of polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29837",
    "user": "https://github.com/kliem"
}
```
This ticket collects some improvements for obtaining incidence matrices:

- The method `self._is_zero` is called many times and we can save plenty of time by obtaining it beforehand.
- We can obtain the slack matrix by multiplying the Vrepresentation matrix with the homogenous Vrepresentation. From this we can obtain the incidence matrix (strangely this last step takes up most of the time).

  Unfortunately, matrix multiplication for algebraic fields isn't very efficient. So we need to keep the old method in this case.

Before this ticket:

```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 751 ms, sys: 7.95 ms, total: 759 ms
Wall time: 758 ms
sage: P = polytopes.associahedron(['A', 9])
sage: %time _ = P.incidence_matrix()
CPU times: user 1.94 s, sys: 4.03 ms, total: 1.94 s
Wall time: 1.94 s
sage: P = polytopes.hypercube(14)
sage: %time _ = P.incidence_matrix()
CPU times: user 670 ms, sys: 0 ns, total: 670 ms
Wall time: 669 ms
sage: K.<sqrt2> = QuadraticField(2)
sage: P = polytopes.permutahedron(7).dilation(sqrt2)
sage: %time _ = P.incidence_matrix()
CPU times: user 3.82 s, sys: 0 ns, total: 3.82 s
Wall time: 3.82 s
```

With this ticket:

```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 64.4 ms, sys: 7 Âµs, total: 64.4 ms
Wall time: 63.6 ms
sage: P = polytopes.associahedron(['A', 9])
sage: %time _ = P.incidence_matrix()
CPU times: user 325 ms, sys: 12.1 ms, total: 337 ms
Wall time: 335 ms
sage: P = polytopes.hypercube(14)
sage: %time _ = P.incidence_matrix()
CPU times: user 139 ms, sys: 12 ms, total: 151 ms
Wall time: 149 ms
sage: K.<sqrt2> = QuadraticField(2)
sage: P = polytopes.permutahedron(7).dilation(sqrt2)
sage: %time _ = P.incidence_matrix()
CPU times: user 3.69 s, sys: 3.69 ms, total: 3.69 s
Wall time: 3.69 s
```

CC:  @jplab @laisrast

Keywords: polyhedra, incidence matrix

Branch/Commit: 955f12baa3ecf69aac9e7c6fb7773993f3eb9e80

Reviewer: Travis Scrimshaw

Author: Jonathan Kliem

Dependencies: #29838, #29839

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29837





---

archive/issue_comments_585001.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2020-06-10T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585001",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_585002.json:
```json
{
    "body": "Changing commit from \"\" to \"6dbe5d24132b62c38a1e77c09a471510d9ab1776\"",
    "created_at": "2020-06-10T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585002",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "6dbe5d24132b62c38a1e77c09a471510d9ab1776"



---

archive/issue_comments_585003.json:
```json
{
    "body": "Changing branch from \"\" to \"public/29837\"",
    "created_at": "2020-06-10T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585003",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/29837"



---

archive/issue_comments_585004.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-10T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585004",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_585005.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2020-06-10T10:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585005",
    "user": "https://github.com/kliem"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_585006.json:
```json
{
    "body": "<a id='comment:2'></a>This should be rebased on #29838 and another ticket that speeds up getting the incidence matrix from the slack matrix.",
    "created_at": "2020-06-10T12:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585006",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>This should be rebased on #29838 and another ticket that speeds up getting the incidence matrix from the slack matrix.



---

archive/issue_comments_585007.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-10T12:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585007",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_585008.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29838\"",
    "created_at": "2020-06-10T12:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585008",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "" to "#29838"



---

archive/issue_comments_585009.json:
```json
{
    "body": "Changing dependencies from \"#29838\" to \"#29838, #29839\"",
    "created_at": "2020-06-10T13:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585009",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "#29838" to "#29838, #29839"



---

archive/issue_comments_585010.json:
```json
{
    "body": "Changing dependencies from \"#29838, #29839\" to \"#29838, #29839, #29840\"",
    "created_at": "2020-06-10T13:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585010",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "#29838, #29839" to "#29838, #29839, #29840"



---

archive/issue_comments_585011.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,21 +32,21 @@\n ```\n sage: P = polytopes.permutahedron(7)\n sage: %time _ = P.incidence_matrix()\n-CPU times: user 236 ms, sys: 15.8 ms, total: 252 ms\n-Wall time: 251 ms\n+CPU times: user 77.5 ms, sys: 11.9 ms, total: 89.3 ms\n+Wall time: 88.3 ms\n sage: P = polytopes.associahedron(['A', 9])\n sage: %time _ = P.incidence_matrix()\n-CPU times: user 1.21 s, sys: 52.1 ms, total: 1.27 s\n-Wall time: 1.27 s\n+CPU times: user 390 ms, sys: 3.98 ms, total: 394 ms\n+Wall time: 393 ms\n sage: P = polytopes.hypercube(14)\n sage: %time _ = P.incidence_matrix()\n-CPU times: user 247 ms, sys: 8.1 ms, total: 256 ms\n-Wall time: 255 ms\n+CPU times: user 138 ms, sys: 7.84 ms, total: 146 ms\n+Wall time: 144 ms\n sage: K.<sqrt2> = QuadraticField(2)\n sage: P = polytopes.permutahedron(7).dilation(sqrt2)\n sage: %time _ = P.incidence_matrix()\n-CPU times: user 3.77 s, sys: 3.81 ms, total: 3.77 s\n-Wall time: 3.77 s\n+CPU times: user 3.85 s, sys: 59 \u00b5s, total: 3.85 s\n+Wall time: 3.85 s\n ```\n \n Possible follow up: Set up incidence matrix etc. with base ring `GF(2)`.\n``````\n",
    "created_at": "2020-06-10T13:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585011",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,21 +32,21 @@
 ```
 sage: P = polytopes.permutahedron(7)
 sage: %time _ = P.incidence_matrix()
-CPU times: user 236 ms, sys: 15.8 ms, total: 252 ms
-Wall time: 251 ms
+CPU times: user 77.5 ms, sys: 11.9 ms, total: 89.3 ms
+Wall time: 88.3 ms
 sage: P = polytopes.associahedron(['A', 9])
 sage: %time _ = P.incidence_matrix()
-CPU times: user 1.21 s, sys: 52.1 ms, total: 1.27 s
-Wall time: 1.27 s
+CPU times: user 390 ms, sys: 3.98 ms, total: 394 ms
+Wall time: 393 ms
 sage: P = polytopes.hypercube(14)
 sage: %time _ = P.incidence_matrix()
-CPU times: user 247 ms, sys: 8.1 ms, total: 256 ms
-Wall time: 255 ms
+CPU times: user 138 ms, sys: 7.84 ms, total: 146 ms
+Wall time: 144 ms
 sage: K.<sqrt2> = QuadraticField(2)
 sage: P = polytopes.permutahedron(7).dilation(sqrt2)
 sage: %time _ = P.incidence_matrix()
-CPU times: user 3.77 s, sys: 3.81 ms, total: 3.77 s
-Wall time: 3.77 s
+CPU times: user 3.85 s, sys: 59 Âµs, total: 3.85 s
+Wall time: 3.85 s
 ```
 
 Possible follow up: Set up incidence matrix etc. with base ring `GF(2)`.
``````




---

archive/issue_comments_585012.json:
```json
{
    "body": "Changing commit from \"6dbe5d24132b62c38a1e77c09a471510d9ab1776\" to \"89aeab39856360ffe80a8e62a0e4886aa3d8d622\"",
    "created_at": "2020-06-10T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585012",
    "user": "https://github.com/kliem"
}
```

Changing commit from "6dbe5d24132b62c38a1e77c09a471510d9ab1776" to "89aeab39856360ffe80a8e62a0e4886aa3d8d622"



---

archive/issue_comments_585013.json:
```json
{
    "body": "Changing branch from \"public/29837\" to \"public/29837-reb\"",
    "created_at": "2020-06-10T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585013",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29837" to "public/29837-reb"



---

archive/issue_comments_585014.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-10T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585014",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_585015.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,53 @@\n+This ticket collects some improvements for obtaining incidence matrices:\n \n+- The method `self._is_zero` is called many times and we can save plenty of time by obtaining it beforehand.\n+- We can obtain the slack matrix by multiplying the Vrepresentation matrix with the homogenous Vrepresentation. From this we can obtain the incidence matrix (strangely this last step takes up most of the time).\n+\n+  Unfortunately, matrix multiplication for algebraic fields isn't very efficient. So we need to keep the old method in this case.\n+\n+Before this ticket:\n+\n+```\n+sage: P = polytopes.permutahedron(7)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 751 ms, sys: 7.95 ms, total: 759 ms\n+Wall time: 758 ms\n+sage: P = polytopes.associahedron(['A', 9])\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 1.94 s, sys: 4.03 ms, total: 1.94 s\n+Wall time: 1.94 s\n+sage: P = polytopes.hypercube(14)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 670 ms, sys: 0 ns, total: 670 ms\n+Wall time: 669 ms\n+sage: K.<sqrt2> = QuadraticField(2)\n+sage: P = polytopes.permutahedron(7).dilation(sqrt2)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 4.1 s, sys: 0 ns, total: 4.1 s\n+Wall time: 4.1 s\n+```\n+\n+With this ticket:\n+\n+```\n+sage: P = polytopes.permutahedron(7)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 64.4 ms, sys: 7 \u00b5s, total: 64.4 ms\n+Wall time: 63.6 ms\n+sage: P = polytopes.associahedron(['A', 9])\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 325 ms, sys: 12.1 ms, total: 337 ms\n+Wall time: 335 ms\n+sage: P = polytopes.hypercube(14)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 139 ms, sys: 12 ms, total: 151 ms\n+Wall time: 149 ms\n+sage: K.<sqrt2> = QuadraticField(2)\n+sage: P = polytopes.permutahedron(7).dilation(sqrt2)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 4.41 s, sys: 7.9 ms, total: 4.42 s\n+Wall time: 4.42 s\n+```\n \n Author: Jonathan Kliem\n \n``````\n",
    "created_at": "2020-06-10T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585015",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,53 @@
+This ticket collects some improvements for obtaining incidence matrices:
 
+- The method `self._is_zero` is called many times and we can save plenty of time by obtaining it beforehand.
+- We can obtain the slack matrix by multiplying the Vrepresentation matrix with the homogenous Vrepresentation. From this we can obtain the incidence matrix (strangely this last step takes up most of the time).
+
+  Unfortunately, matrix multiplication for algebraic fields isn't very efficient. So we need to keep the old method in this case.
+
+Before this ticket:
+
+```
+sage: P = polytopes.permutahedron(7)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 751 ms, sys: 7.95 ms, total: 759 ms
+Wall time: 758 ms
+sage: P = polytopes.associahedron(['A', 9])
+sage: %time _ = P.incidence_matrix()
+CPU times: user 1.94 s, sys: 4.03 ms, total: 1.94 s
+Wall time: 1.94 s
+sage: P = polytopes.hypercube(14)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 670 ms, sys: 0 ns, total: 670 ms
+Wall time: 669 ms
+sage: K.<sqrt2> = QuadraticField(2)
+sage: P = polytopes.permutahedron(7).dilation(sqrt2)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 4.1 s, sys: 0 ns, total: 4.1 s
+Wall time: 4.1 s
+```
+
+With this ticket:
+
+```
+sage: P = polytopes.permutahedron(7)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 64.4 ms, sys: 7 Âµs, total: 64.4 ms
+Wall time: 63.6 ms
+sage: P = polytopes.associahedron(['A', 9])
+sage: %time _ = P.incidence_matrix()
+CPU times: user 325 ms, sys: 12.1 ms, total: 337 ms
+Wall time: 335 ms
+sage: P = polytopes.hypercube(14)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 139 ms, sys: 12 ms, total: 151 ms
+Wall time: 149 ms
+sage: K.<sqrt2> = QuadraticField(2)
+sage: P = polytopes.permutahedron(7).dilation(sqrt2)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 4.41 s, sys: 7.9 ms, total: 4.42 s
+Wall time: 4.42 s
+```
 
 Author: Jonathan Kliem
 
``````




---

archive/issue_comments_585016.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2020-06-10T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585016",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_585017.json:
```json
{
    "body": "<a id='comment:7'></a>I don't think changing the interface so that GF(2) matrices are returned is a good idea. How about leaving it as ZZ by default, and using a keyword argument for the base ring so it can be overridden.",
    "created_at": "2020-06-10T19:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585017",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>I don't think changing the interface so that GF(2) matrices are returned is a good idea. How about leaving it as ZZ by default, and using a keyword argument for the base ring so it can be overridden.



---

archive/issue_comments_585018.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:\n> I don't think changing the interface so that GF(2) matrices are returned is a good idea. How about leaving it as ZZ by default, and using a keyword argument for the base ring so it can be overridden.\n> \n\n\nI don't think the change to `GF(2)` was needed to make things better. So I can rewrite some stuff and remove #29839, that would also do it, I think. `sage.matrix.matrix_integer_dense` is probably just as fast or faster than the other one.\n\nI really only thought that this is the more natural thing for a 0/1 matrix. If the more natural thing is base ring integer or `GF(2)` really performs awful, I can just revert that decision.",
    "created_at": "2020-06-10T20:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585018",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:
> I don't think changing the interface so that GF(2) matrices are returned is a good idea. How about leaving it as ZZ by default, and using a keyword argument for the base ring so it can be overridden.
> 


I don't think the change to `GF(2)` was needed to make things better. So I can rewrite some stuff and remove #29839, that would also do it, I think. `sage.matrix.matrix_integer_dense` is probably just as fast or faster than the other one.

I really only thought that this is the more natural thing for a 0/1 matrix. If the more natural thing is base ring integer or `GF(2)` really performs awful, I can just revert that decision.



---

archive/issue_comments_585019.json:
```json
{
    "body": "<a id='comment:9'></a>See my comment in #29840",
    "created_at": "2020-06-10T20:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585019",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>See my comment in #29840



---

archive/issue_comments_585020.json:
```json
{
    "body": "<a id='comment:10'></a>Changing the base ring of incidence matrices was rejected in #29340.",
    "created_at": "2020-06-10T20:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585020",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>Changing the base ring of incidence matrices was rejected in #29340.



---

archive/issue_comments_585021.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-10T20:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585021",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_585022.json:
```json
{
    "body": "Changing dependencies from \"#29838, #29839, #29840\" to \"#29838, #29839\"",
    "created_at": "2020-06-10T20:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585022",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "#29838, #29839, #29840" to "#29838, #29839"



---

archive/issue_comments_585023.json:
```json
{
    "body": "<a id='comment:11'></a>I wish this was implemented using numpy matrices (knows as arrays), which provide faster linear algebra and have built-in methods to manipulate zero patterns of their matrices.",
    "created_at": "2020-06-10T21:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585023",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>I wish this was implemented using numpy matrices (knows as arrays), which provide faster linear algebra and have built-in methods to manipulate zero patterns of their matrices.



---

archive/issue_comments_585024.json:
```json
{
    "body": "<a id='comment:12'></a>I don't know how fast conversion back and forth works. It is true, that numpy is a bit faster, but that doesn't help me if I cannot convert things.\n\nE.g.\n\n```\nsage: P = polytopes.associahedron(['A', 9])\nsage: %time a = np.array(P.Vrepresentation())\nCPU times: user 383 ms, sys: 0 ns, total: 383 ms\nWall time: 382 ms\n```\n\nThis is already longer than it takes to obtain the entire incidence matrix. Of course this is most likely not an ideal way to convert, but I don't know any better way at the moment.\n\nAnd conversion back is also slow.\n\nReplying to [comment:11 dimpase]:\n> I wish this was implemented using numpy matrices (knows as arrays), which provide faster linear algebra and have built-in methods to manipulate zero patterns of their matrices.",
    "created_at": "2020-06-10T22:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585024",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'></a>I don't know how fast conversion back and forth works. It is true, that numpy is a bit faster, but that doesn't help me if I cannot convert things.

E.g.

```
sage: P = polytopes.associahedron(['A', 9])
sage: %time a = np.array(P.Vrepresentation())
CPU times: user 383 ms, sys: 0 ns, total: 383 ms
Wall time: 382 ms
```

This is already longer than it takes to obtain the entire incidence matrix. Of course this is most likely not an ideal way to convert, but I don't know any better way at the moment.

And conversion back is also slow.

Replying to [comment:11 dimpase]:
> I wish this was implemented using numpy matrices (knows as arrays), which provide faster linear algebra and have built-in methods to manipulate zero patterns of their matrices.



---

archive/issue_comments_585025.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-10T22:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585025",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_585026.json:
```json
{
    "body": "Changing commit from \"89aeab39856360ffe80a8e62a0e4886aa3d8d622\" to \"3d28d09c5c74cdc8cb79f3b17ef50b1bff8b828d\"",
    "created_at": "2020-06-10T22:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585026",
    "user": "https://github.com/kliem"
}
```

Changing commit from "89aeab39856360ffe80a8e62a0e4886aa3d8d622" to "3d28d09c5c74cdc8cb79f3b17ef50b1bff8b828d"



---

archive/issue_comments_585027.json:
```json
{
    "body": "<a id='comment:13'></a>New commits:",
    "created_at": "2020-06-10T22:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585027",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>New commits:



---

archive/issue_comments_585028.json:
```json
{
    "body": "Changing branch from \"public/29837-reb\" to \"public/29837-reb2\"",
    "created_at": "2020-06-10T22:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585028",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29837-reb" to "public/29837-reb2"



---

archive/issue_comments_585029.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-10T22:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_585030.json:
```json
{
    "body": "Changing commit from \"3d28d09c5c74cdc8cb79f3b17ef50b1bff8b828d\" to \"7ef6a111bf70637a01b6789819b87dde647bdc4c\"",
    "created_at": "2020-06-10T22:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3d28d09c5c74cdc8cb79f3b17ef50b1bff8b828d" to "7ef6a111bf70637a01b6789819b87dde647bdc4c"



---

archive/issue_comments_585031.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T09:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585031",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_585032.json:
```json
{
    "body": "Changing commit from \"7ef6a111bf70637a01b6789819b87dde647bdc4c\" to \"759d1f20427b7a213789e1c114e427824f0884c2\"",
    "created_at": "2020-06-11T09:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585032",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7ef6a111bf70637a01b6789819b87dde647bdc4c" to "759d1f20427b7a213789e1c114e427824f0884c2"



---

archive/issue_comments_585033.json:
```json
{
    "body": "Changing branch from \"public/29837-reb2\" to \"public/29837-reb3\"",
    "created_at": "2020-06-17T09:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585033",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29837-reb2" to "public/29837-reb3"



---

archive/issue_comments_585034.json:
```json
{
    "body": "<a id='comment:16'></a>Last 10 new commits:",
    "created_at": "2020-06-17T09:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585034",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>Last 10 new commits:



---

archive/issue_comments_585035.json:
```json
{
    "body": "Changing commit from \"759d1f20427b7a213789e1c114e427824f0884c2\" to \"764a99b9a8c476f1d73e120f90b68652ff230eae\"",
    "created_at": "2020-06-17T09:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585035",
    "user": "https://github.com/kliem"
}
```

Changing commit from "759d1f20427b7a213789e1c114e427824f0884c2" to "764a99b9a8c476f1d73e120f90b68652ff230eae"



---

archive/issue_comments_585036.json:
```json
{
    "body": "<a id='comment:17'></a>Needs review.\n\nThe the ticket itself is only 3 commits on top of #29838 and #29839, which are both closed now.",
    "created_at": "2020-06-30T05:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585036",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>Needs review.

The the ticket itself is only 3 commits on top of #29838 and #29839, which are both closed now.



---

archive/issue_comments_585037.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,53 @@\n+This ticket collects some improvements for obtaining incidence matrices:\n \n+- The method `self._is_zero` is called many times and we can save plenty of time by obtaining it beforehand.\n+- We can obtain the slack matrix by multiplying the Vrepresentation matrix with the homogenous Vrepresentation. From this we can obtain the incidence matrix (strangely this last step takes up most of the time).\n+\n+  Unfortunately, matrix multiplication for algebraic fields isn't very efficient. So we need to keep the old method in this case.\n+\n+Before this ticket:\n+\n+```\n+sage: P = polytopes.permutahedron(7)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 751 ms, sys: 7.95 ms, total: 759 ms\n+Wall time: 758 ms\n+sage: P = polytopes.associahedron(['A', 9])\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 1.94 s, sys: 4.03 ms, total: 1.94 s\n+Wall time: 1.94 s\n+sage: P = polytopes.hypercube(14)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 670 ms, sys: 0 ns, total: 670 ms\n+Wall time: 669 ms\n+sage: K.<sqrt2> = QuadraticField(2)\n+sage: P = polytopes.permutahedron(7).dilation(sqrt2)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 3.82 s, sys: 0 ns, total: 3.82 s\n+Wall time: 3.82 s\n+```\n+\n+With this ticket:\n+\n+```\n+sage: P = polytopes.permutahedron(7)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 64.4 ms, sys: 7 \u00b5s, total: 64.4 ms\n+Wall time: 63.6 ms\n+sage: P = polytopes.associahedron(['A', 9])\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 325 ms, sys: 12.1 ms, total: 337 ms\n+Wall time: 335 ms\n+sage: P = polytopes.hypercube(14)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 139 ms, sys: 12 ms, total: 151 ms\n+Wall time: 149 ms\n+sage: K.<sqrt2> = QuadraticField(2)\n+sage: P = polytopes.permutahedron(7).dilation(sqrt2)\n+sage: %time _ = P.incidence_matrix()\n+CPU times: user 3.69 s, sys: 3.69 ms, total: 3.69 s\n+Wall time: 3.69 s\n+```\n \n Author: Jonathan Kliem\n \n``````\n",
    "created_at": "2020-06-30T06:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585037",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,53 @@
+This ticket collects some improvements for obtaining incidence matrices:
 
+- The method `self._is_zero` is called many times and we can save plenty of time by obtaining it beforehand.
+- We can obtain the slack matrix by multiplying the Vrepresentation matrix with the homogenous Vrepresentation. From this we can obtain the incidence matrix (strangely this last step takes up most of the time).
+
+  Unfortunately, matrix multiplication for algebraic fields isn't very efficient. So we need to keep the old method in this case.
+
+Before this ticket:
+
+```
+sage: P = polytopes.permutahedron(7)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 751 ms, sys: 7.95 ms, total: 759 ms
+Wall time: 758 ms
+sage: P = polytopes.associahedron(['A', 9])
+sage: %time _ = P.incidence_matrix()
+CPU times: user 1.94 s, sys: 4.03 ms, total: 1.94 s
+Wall time: 1.94 s
+sage: P = polytopes.hypercube(14)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 670 ms, sys: 0 ns, total: 670 ms
+Wall time: 669 ms
+sage: K.<sqrt2> = QuadraticField(2)
+sage: P = polytopes.permutahedron(7).dilation(sqrt2)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 3.82 s, sys: 0 ns, total: 3.82 s
+Wall time: 3.82 s
+```
+
+With this ticket:
+
+```
+sage: P = polytopes.permutahedron(7)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 64.4 ms, sys: 7 Âµs, total: 64.4 ms
+Wall time: 63.6 ms
+sage: P = polytopes.associahedron(['A', 9])
+sage: %time _ = P.incidence_matrix()
+CPU times: user 325 ms, sys: 12.1 ms, total: 337 ms
+Wall time: 335 ms
+sage: P = polytopes.hypercube(14)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 139 ms, sys: 12 ms, total: 151 ms
+Wall time: 149 ms
+sage: K.<sqrt2> = QuadraticField(2)
+sage: P = polytopes.permutahedron(7).dilation(sqrt2)
+sage: %time _ = P.incidence_matrix()
+CPU times: user 3.69 s, sys: 3.69 ms, total: 3.69 s
+Wall time: 3.69 s
+```
 
 Author: Jonathan Kliem
 
``````




---

archive/issue_comments_585038.json:
```json
{
    "body": "<a id='comment:19'></a>You might be able to get a little more speed out by doing\n\n```diff\n-return x == 0\n+return (not x)\n```",
    "created_at": "2020-07-01T02:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585038",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>You might be able to get a little more speed out by doing

```diff
-return x == 0
+return (not x)
```



---

archive/issue_comments_585039.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2020-07-01T02:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585039",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_585040.json:
```json
{
    "body": "<a id='comment:20'></a>However, whether you make that change or not, you can set a positive review on my behalf.",
    "created_at": "2020-07-01T02:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585040",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>However, whether you make that change or not, you can set a positive review on my behalf.



---

archive/issue_comments_585041.json:
```json
{
    "body": "<a id='comment:21'></a>About three percent for `P = polytopes.permutahedron(7).dilation(sqrt2)`.\n\nThank you.",
    "created_at": "2020-07-01T04:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585041",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>About three percent for `P = polytopes.permutahedron(7).dilation(sqrt2)`.

Thank you.



---

archive/issue_comments_585042.json:
```json
{
    "body": "Changing commit from \"764a99b9a8c476f1d73e120f90b68652ff230eae\" to \"f70e1c5d22c28afd9d3145ce43f26a4eb8b98504\"",
    "created_at": "2020-07-01T04:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585042",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "764a99b9a8c476f1d73e120f90b68652ff230eae" to "f70e1c5d22c28afd9d3145ce43f26a4eb8b98504"



---

archive/issue_comments_585043.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-01T04:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585043",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_585044.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-01T04:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585044",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_585045.json:
```json
{
    "body": "<a id='comment:24'></a>I am getting this with this ticket in sage-on-gentoo\n\n```\nsage -t --long --warn-long 101.0 /usr/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py\", line 508, in sage.geometry.polyhedron.backend_cdd.Polyhedron_RDF_cdd.__init__\nFailed example:\n    TestSuite(p).run()\nExpected nothing\nGot:\n    Failure in _test_an_affine_basis:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/misc/sage_unittest.py\", line 296, in run\n        test_method(tester=tester)\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 2122, in _test_an_affine_basis\n        b = self.an_affine_basis()\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 2085, in an_affine_basis\n        chain = self.a_maximal_chain()[1:]  # we exclude the empty face\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 3098, in a_maximal_chain\n        comb_chain = self.combinatorial_polyhedron().a_maximal_chain()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/misc/cachefunc.c:12875)\n        self.cache = f(self._instance)\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 3362, in combinatorial_polyhedron\n        return CombinatorialPolyhedron(self)\n      File \"sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\", line 367, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__init__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/base.c:6786)\n        data = data.incidence_matrix()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/misc/cachefunc.c:12875)\n        self.cache = f(self._instance)\n      File \"/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 2749, in incidence_matrix\n        is_zero == self._is_zero\n    UnboundLocalError: local variable 'is_zero' referenced before assignment\n    ------------------------------------------------------------\n    The following tests failed: _test_an_affine_basis\n**********************************************************************\n```\nseems circular.",
    "created_at": "2020-07-05T02:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585045",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>I am getting this with this ticket in sage-on-gentoo

```
sage -t --long --warn-long 101.0 /usr/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py", line 508, in sage.geometry.polyhedron.backend_cdd.Polyhedron_RDF_cdd.__init__
Failed example:
    TestSuite(p).run()
Expected nothing
Got:
    Failure in _test_an_affine_basis:
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/misc/sage_unittest.py", line 296, in run
        test_method(tester=tester)
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 2122, in _test_an_affine_basis
        b = self.an_affine_basis()
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 2085, in an_affine_basis
        chain = self.a_maximal_chain()[1:]  # we exclude the empty face
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 3098, in a_maximal_chain
        comb_chain = self.combinatorial_polyhedron().a_maximal_chain()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/misc/cachefunc.c:12875)
        self.cache = f(self._instance)
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 3362, in combinatorial_polyhedron
        return CombinatorialPolyhedron(self)
      File "sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx", line 367, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__init__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/base.c:6786)
        data = data.incidence_matrix()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_7/build/cythonized/sage/misc/cachefunc.c:12875)
        self.cache = f(self._instance)
      File "/usr/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 2749, in incidence_matrix
        is_zero == self._is_zero
    UnboundLocalError: local variable 'is_zero' referenced before assignment
    ------------------------------------------------------------
    The following tests failed: _test_an_affine_basis
**********************************************************************
```
seems circular.



---

archive/issue_comments_585046.json:
```json
{
    "body": "<a id='comment:25'></a>\n```diff\n-is_zero == self._is_zero\n+is_zero = self._is_zero\n```",
    "created_at": "2020-07-05T03:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585046",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:25'></a>
```diff
-is_zero == self._is_zero
+is_zero = self._is_zero
```



---

archive/issue_comments_585047.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-07-05T03:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585047",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_585048.json:
```json
{
    "body": "<a id='comment:26'></a>The problem is that usually the cdd backend figures out the incidence matrix itself for inexact polyhedra. So you don't notice, because `incidence_matrix` is never run (except for the empty polyhedron, hence the error). I should add a doctest for this.",
    "created_at": "2020-07-05T06:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585048",
    "user": "https://github.com/kliem"
}
```

<a id='comment:26'></a>The problem is that usually the cdd backend figures out the incidence matrix itself for inexact polyhedra. So you don't notice, because `incidence_matrix` is never run (except for the empty polyhedron, hence the error). I should add a doctest for this.



---

archive/issue_comments_585049.json:
```json
{
    "body": "Changing branch from \"public/29837-reb3\" to \"public/29837-reb4\"",
    "created_at": "2020-07-05T07:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585049",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29837-reb3" to "public/29837-reb4"



---

archive/issue_comments_585050.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-05T07:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585050",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_585051.json:
```json
{
    "body": "Changing commit from \"f70e1c5d22c28afd9d3145ce43f26a4eb8b98504\" to \"da9ec61583cd63e246b8bbd326c3958f4679d12d\"",
    "created_at": "2020-07-05T07:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585051",
    "user": "https://github.com/kliem"
}
```

Changing commit from "f70e1c5d22c28afd9d3145ce43f26a4eb8b98504" to "da9ec61583cd63e246b8bbd326c3958f4679d12d"



---

archive/issue_comments_585052.json:
```json
{
    "body": "<a id='comment:27'></a>I rebased as well.\n\n---\nNew commits:",
    "created_at": "2020-07-05T07:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585052",
    "user": "https://github.com/kliem"
}
```

<a id='comment:27'></a>I rebased as well.

---
New commits:



---

archive/issue_comments_585053.json:
```json
{
    "body": "<a id='comment:28'></a>Trivial tweak, but the formatting is better:\n\n```diff\n         Test that this method works for inexact base ring\n-        (`cdd` sets the cache already)::\n+        (``cdd`` sets the cache already)::\n```",
    "created_at": "2020-07-05T07:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585053",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>Trivial tweak, but the formatting is better:

```diff
         Test that this method works for inexact base ring
-        (`cdd` sets the cache already)::
+        (``cdd`` sets the cache already)::
```



---

archive/issue_comments_585054.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-05T07:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_585055.json:
```json
{
    "body": "Changing commit from \"da9ec61583cd63e246b8bbd326c3958f4679d12d\" to \"955f12baa3ecf69aac9e7c6fb7773993f3eb9e80\"",
    "created_at": "2020-07-05T07:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585055",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "da9ec61583cd63e246b8bbd326c3958f4679d12d" to "955f12baa3ecf69aac9e7c6fb7773993f3eb9e80"



---

archive/issue_comments_585056.json:
```json
{
    "body": "<a id='comment:30'></a>Done.\n\nReplying to [comment:28 tscrim]:\n> Trivial tweak, but the formatting is better:\n> \n> ```diff\n>          Test that this method works for inexact base ring\n> -        (`cdd` sets the cache already)::\n> +        (``cdd`` sets the cache already)::\n> ```",
    "created_at": "2020-07-05T07:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585056",
    "user": "https://github.com/kliem"
}
```

<a id='comment:30'></a>Done.

Replying to [comment:28 tscrim]:
> Trivial tweak, but the formatting is better:
> 
> ```diff
>          Test that this method works for inexact base ring
> -        (`cdd` sets the cache already)::
> +        (``cdd`` sets the cache already)::
> ```



---

archive/issue_comments_585057.json:
```json
{
    "body": "<a id='comment:31'></a>Thanks.",
    "created_at": "2020-07-05T09:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585057",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>Thanks.



---

archive/issue_comments_585058.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-05T09:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585058",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_076415.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-10T19:34:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29837#event-76415"
}
```



---

archive/issue_comments_585059.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-10T19:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585059",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_585060.json:
```json
{
    "body": "Changing branch from \"public/29837-reb4\" to \"955f12baa3ecf69aac9e7c6fb7773993f3eb9e80\"",
    "created_at": "2020-07-10T19:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29837#issuecomment-585060",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/29837-reb4" to "955f12baa3ecf69aac9e7c6fb7773993f3eb9e80"
