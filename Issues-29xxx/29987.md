# Issue 29987: build/make/install: Do not depend on src/bin/sage-version.sh

archive/issues_029750.json:
```json
{
    "body": "CC:  @jhpalmieri @videlec @kliem\n\nAfter #29411, we can simplify `build/make/install` a bit, no longer setting SAGE_VERSION via `src/bin/sage-version.sh`.\n\nThis also makes the generated `Dockerfile`s a little bit simpler.\n\n```\nfind build -type f -exec fgrep  -nH -e sage-version.sh \\{\\} +\nbuild/bin/sage-starts:12:. src/bin/sage-version.sh\nbuild/bin/write-dockerfile.sh:160:ADD src/bin/sage-version.sh src/bin/sage-version.sh\nbuild/make/install:22:. \"$SAGE_SRC\"/bin/sage-version.sh\n\nfind build -type f -exec grep  -nH -e SAGE_VERSION \\{\\} +\nbuild/bin/sage-starts:13:echo \"[`date +'%Y-%m-%d %H:%M:%S'`] $SAGE_VERSION_BANNER\" | tee -a logs/start.log\nbuild/make/install:23:export SAGE_VERSION\n\nfind src -type f -exec fgrep  -nH -e -version.sh \\{\\} +\nsrc/bin/sage-update-version:48:# Update Sage version file for shell scripts in SAGE_SRC/bin/sage-version.sh\nsrc/bin/sage-update-version:49:cat <<EOF > \"$SAGE_SRC/bin/sage-version.sh\"\nsrc/bin/sage-update-version:67:    \"$SAGE_SRC/bin/sage-version.sh\" \\\nsrc/bin/sage-sdist:40:source \"$SAGE_SRC/bin/sage-version.sh\"\nsrc/bin/sage:7:    if [ -f \"$0-version.sh\" ]; then\nsrc/bin/sage:8:        . \"$0-version.sh\"\nsrc/bin/sage:10:        . \"$SAGE_ROOT/src/bin/sage-version.sh\"\nsrc/doc/en/developer/portability_testing.rst:349:  ADD src/bin/sage-version.sh src/bin/sage-version.sh\nsrc/mac-app/Makefile:23:    SAGE_VERSION:=$(shell source ../bin/sage-version.sh && echo $$SAGE_VERSION)\n```\n\nPrevious tickets:\n- #25150 (Eliminate dependence on `VERSION.txt` within Sage)\n- #17857 (enhanced `sage -version` script)\n\nIssue created by migration from https://trac.sagemath.org/ticket/29987\n\n",
    "closed_at": "2020-07-08T19:33:16Z",
    "created_at": "2020-06-24T22:23:31Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "build/make/install: Do not depend on src/bin/sage-version.sh",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29987",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jhpalmieri @videlec @kliem

After #29411, we can simplify `build/make/install` a bit, no longer setting SAGE_VERSION via `src/bin/sage-version.sh`.

This also makes the generated `Dockerfile`s a little bit simpler.

```
find build -type f -exec fgrep  -nH -e sage-version.sh \{\} +
build/bin/sage-starts:12:. src/bin/sage-version.sh
build/bin/write-dockerfile.sh:160:ADD src/bin/sage-version.sh src/bin/sage-version.sh
build/make/install:22:. "$SAGE_SRC"/bin/sage-version.sh

find build -type f -exec grep  -nH -e SAGE_VERSION \{\} +
build/bin/sage-starts:13:echo "[`date +'%Y-%m-%d %H:%M:%S'`] $SAGE_VERSION_BANNER" | tee -a logs/start.log
build/make/install:23:export SAGE_VERSION

find src -type f -exec fgrep  -nH -e -version.sh \{\} +
src/bin/sage-update-version:48:# Update Sage version file for shell scripts in SAGE_SRC/bin/sage-version.sh
src/bin/sage-update-version:49:cat <<EOF > "$SAGE_SRC/bin/sage-version.sh"
src/bin/sage-update-version:67:    "$SAGE_SRC/bin/sage-version.sh" \
src/bin/sage-sdist:40:source "$SAGE_SRC/bin/sage-version.sh"
src/bin/sage:7:    if [ -f "$0-version.sh" ]; then
src/bin/sage:8:        . "$0-version.sh"
src/bin/sage:10:        . "$SAGE_ROOT/src/bin/sage-version.sh"
src/doc/en/developer/portability_testing.rst:349:  ADD src/bin/sage-version.sh src/bin/sage-version.sh
src/mac-app/Makefile:23:    SAGE_VERSION:=$(shell source ../bin/sage-version.sh && echo $$SAGE_VERSION)
```

Previous tickets:
- #25150 (Eliminate dependence on `VERSION.txt` within Sage)
- #17857 (enhanced `sage -version` script)

Issue created by migration from https://trac.sagemath.org/ticket/29987





---

archive/issue_comments_422165.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-25T07:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29987#issuecomment-422165",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_422166.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-06-25T07:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29987#issuecomment-422166",
    "user": "https://github.com/mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_422167.json:
```json
{
    "body": "Branch is 1 commit on top of #29411. Tests run at https://github.com/mkoeppe/sage/actions/runs/147135221",
    "created_at": "2020-06-25T07:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29987#issuecomment-422167",
    "user": "https://github.com/mkoeppe"
}
```

Branch is 1 commit on top of #29411. Tests run at https://github.com/mkoeppe/sage/actions/runs/147135221



---

archive/issue_comments_422168.json:
```json
{
    "body": "Looks good.",
    "created_at": "2020-06-30T01:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29987#issuecomment-422168",
    "user": "https://github.com/jhpalmieri"
}
```

Looks good.



---

archive/issue_comments_422169.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-30T01:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29987#issuecomment-422169",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_422170.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-06-30T01:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29987#issuecomment-422170",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_events_077020.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-08T19:33:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29987",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29987#event-77020"
}
```



---

archive/issue_comments_422171.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T19:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29987#issuecomment-422171",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
