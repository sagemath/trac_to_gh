# Issue 29118: Please roll back #29038

archive/issues_028881.json:
```json
{
    "assignees": [],
    "body": "With respect, I think it adds much additional complication without justifying itself or what concrete problems it's trying to solve.\n\nI had to work on other things for a while so I stepped away from the discussion, but I never would have approved it.\n\nLet's please roll this back and stop making major changes to the build system until we can get some clarity on what the overall goals of these changes are.\n\nPlease consider this an alternative to #29114 which is adding still more complications to work around a regression introduced by #29038.  I think it would be simpler for now to roll back #29038 until we can re-assess.\n\nIn the meantime, please see #29119 which offers an alternative approach which I believe is more in the spirit of making sagelib buildable independently of sage-the-distribution without any non-standard external scripts.\n\nCC:  @kiwifb @antonio-rojas @isuruf @embray @infinity0 @timokau @jdemeyer @dimpase @jhpalmieri @vbraun\n\nComponent: **build**\n\nBranch/Commit: **[u/embray/ticket-29118](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-29118) @ [`b9d6cac`](https://github.com/sagemath/sagetrac-mirror/commit/b9d6cacb68902d30d10bc743c2398b2eed3a3840)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29118_\n\n",
    "closed_at": "2021-06-24T20:15:37Z",
    "created_at": "2020-01-31T11:35:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Please roll back #29038",
    "type": "issue",
    "updated_at": "2021-06-24T20:15:37Z",
    "url": "https://github.com/sagemath/sage/issues/29118",
    "user": "https://github.com/embray"
}
```
With respect, I think it adds much additional complication without justifying itself or what concrete problems it's trying to solve.

I had to work on other things for a while so I stepped away from the discussion, but I never would have approved it.

Let's please roll this back and stop making major changes to the build system until we can get some clarity on what the overall goals of these changes are.

Please consider this an alternative to #29114 which is adding still more complications to work around a regression introduced by #29038.  I think it would be simpler for now to roll back #29038 until we can re-assess.

In the meantime, please see #29119 which offers an alternative approach which I believe is more in the spirit of making sagelib buildable independently of sage-the-distribution without any non-standard external scripts.

CC:  @kiwifb @antonio-rojas @isuruf @embray @infinity0 @timokau @jdemeyer @dimpase @jhpalmieri @vbraun

Component: **build**

Branch/Commit: **[u/embray/ticket-29118](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-29118) @ [`b9d6cac`](https://github.com/sagemath/sagetrac-mirror/commit/b9d6cacb68902d30d10bc743c2398b2eed3a3840)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/29118_





---

archive/issue_events_397207.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-31T11:35:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397207"
}
```



---

archive/issue_events_397208.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-31T11:35:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397208"
}
```



---

archive/issue_events_397209.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-31T11:35:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397209"
}
```



---

archive/issue_events_397210.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-31T11:35:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397210"
}
```



---

archive/issue_comments_456276.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI think we should progress rather than revert, as Matthias has a clear and mostly ready path towards making sagelib runnable in venv of a system Python, something that is close to pip installability. \n\nNoone else is close to this, and simplifications may happen later.\n\nBesides, there are no regressions introduced in  #29038 - a way to implement something that you don't like, but it works, is not a regression, it is a design choice that you make or may not like.",
    "created_at": "2020-01-31T11:45:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456276",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

I think we should progress rather than revert, as Matthias has a clear and mostly ready path towards making sagelib runnable in venv of a system Python, something that is close to pip installability. 

Noone else is close to this, and simplifications may happen later.

Besides, there are no regressions introduced in  #29038 - a way to implement something that you don't like, but it works, is not a regression, it is a design choice that you make or may not like.



---

archive/issue_comments_456277.json:
```json
{
    "body": "Commit: **[`b9d6cac`](https://github.com/sagemath/sagetrac-mirror/commit/b9d6cacb68902d30d10bc743c2398b2eed3a3840)**",
    "created_at": "2020-01-31T11:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456277",
    "user": "https://github.com/embray"
}
```

Commit: **[`b9d6cac`](https://github.com/sagemath/sagetrac-mirror/commit/b9d6cacb68902d30d10bc743c2398b2eed3a3840)**



---

archive/issue_comments_456278.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI hate to be so strongly negative about this because I respect Matthias's effort and I think we have shared goals overall.  But I wouldn't be bothered if I weren't strongly convinced that there were a better way, and that this approach does not fully solve the problems it purports to solve.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9d6cacb68902d30d10bc743c2398b2eed3a3840\"><code>b9d6cac</code></a></td><td><code>Revert \"Trac #29038: Python package sage_conf: Provides optional configuration information for sagelib\"</code></td></tr></table>\n",
    "created_at": "2020-01-31T11:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456278",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

I hate to be so strongly negative about this because I respect Matthias's effort and I think we have shared goals overall.  But I wouldn't be bothered if I weren't strongly convinced that there were a better way, and that this approach does not fully solve the problems it purports to solve.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9d6cacb68902d30d10bc743c2398b2eed3a3840"><code>b9d6cac</code></a></td><td><code>Revert "Trac #29038: Python package sage_conf: Provides optional configuration information for sagelib"</code></td></tr></table>




---

archive/issue_events_397211.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-31T11:45:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397211"
}
```



---

archive/issue_comments_456279.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2020-01-31T11:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456279",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_456280.json:
```json
{
    "body": "Branch: **[u/embray/ticket-29118](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-29118)**",
    "created_at": "2020-01-31T11:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456280",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/ticket-29118](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-29118)**



---

archive/issue_comments_456281.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n> runnable in venv of a system Python\n\nThe virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.\n\nThis was part of the point of my approach in #29032 which I believe accomplishes the same goals with far less intervention.  I could be wrong about that, but no one has suggested otherwise yet.",
    "created_at": "2020-01-31T11:48:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456281",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

> runnable in venv of a system Python

The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.

This was part of the point of my approach in #29032 which I believe accomplishes the same goals with far less intervention.  I could be wrong about that, but no one has suggested otherwise yet.



---

archive/issue_comments_456282.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@embray](#comment%3A3):\n> > runnable in venv of a system Python\n\n> \n> The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.\n> \n\nI don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.\n\nInstalling sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.\nYou don't want to trash your system python every time things go wrong.\n\n\n> This was part of the point of my approach in #29032 which I believe accomplishes the same goals with far less intervention.  I could be wrong about that, but no one has suggested otherwise yet.",
    "created_at": "2020-01-31T11:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456282",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@embray](#comment%3A3):
> > runnable in venv of a system Python

> 
> The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.
> 

I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.

Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.
You don't want to trash your system python every time things go wrong.


> This was part of the point of my approach in #29032 which I believe accomplishes the same goals with far less intervention.  I could be wrong about that, but no one has suggested otherwise yet.



---

archive/issue_comments_456283.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis is too disruptive to revert now, IMHO, as there is too much stuff in the works that depends or might depend upon it.",
    "created_at": "2020-01-31T12:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456283",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

This is too disruptive to revert now, IMHO, as there is too much stuff in the works that depends or might depend upon it.



---

archive/issue_comments_456284.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@dimpase](#comment%3A4):\n> Replying to [@embray](#comment%3A3):\n> > > runnable in venv of a system Python\n\n> > \n> > The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.\n> > \n\n> I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.\n> \n> Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.\n\nNo we're not.  Distro packagers already do it.  When it comes down to it it's just another Python package, with some variables in `sage.env` you have to configure (the problem we are trying to solve is that that part is currently too difficult to configure, which is why packagers often just replace `sage.env` with their own hard-coded one).\n\n> You don't want to trash your system python every time things go wrong.\n\nYes, that's what virtualenvs are for.  But there's nothing special about it otherwise.  `$SAGE_LOCAL` is no different in function from a virtualenv--it's just an alternate install prefix, like `/usr/local`.",
    "created_at": "2020-01-31T12:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456284",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@dimpase](#comment%3A4):
> Replying to [@embray](#comment%3A3):
> > > runnable in venv of a system Python

> > 
> > The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.
> > 

> I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.
> 
> Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.

No we're not.  Distro packagers already do it.  When it comes down to it it's just another Python package, with some variables in `sage.env` you have to configure (the problem we are trying to solve is that that part is currently too difficult to configure, which is why packagers often just replace `sage.env` with their own hard-coded one).

> You don't want to trash your system python every time things go wrong.

Yes, that's what virtualenvs are for.  But there's nothing special about it otherwise.  `$SAGE_LOCAL` is no different in function from a virtualenv--it's just an alternate install prefix, like `/usr/local`.



---

archive/issue_comments_456285.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@dimpase](#comment%3A5):\n> This is too disruptive to revert now, IMHO, as there is too much stuff in the works that depends or might depend upon it.\n\nThis was already disruptive by definition as it caused at least one regression.  What's in the works that depends or might depend on it, and why are those things necessary?  And how?  None of this has been explained.",
    "created_at": "2020-01-31T12:03:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456285",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@dimpase](#comment%3A5):
> This is too disruptive to revert now, IMHO, as there is too much stuff in the works that depends or might depend upon it.

This was already disruptive by definition as it caused at least one regression.  What's in the works that depends or might depend on it, and why are those things necessary?  And how?  None of this has been explained.



---

archive/issue_comments_456286.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@embray](#comment%3A6):\n> Replying to [@dimpase](#comment%3A4):\n> > Replying to [@embray](#comment%3A3):\n> > > > runnable in venv of a system Python\n\n> > > \n> > > The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.\n> > > \n\n> > I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.\n> > \n> > Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.\n\n> \n> No we're not.  Distro packagers already do it. \n\nSo? You get something that you can only change is you have root.\nAre you seriosly proposing that Sage developent should be done as root?\n\n\n> When it comes down to it it's just another Python package, with some variables in `sage.env` you have to configure (the problem we are trying to solve is that that part is currently too difficult to configure, which is why packagers often just replace `sage.env` with their own hard-coded one).\n> \n> > You don't want to trash your system python every time things go wrong.\n\n> \n> Yes, that's what virtualenvs are for.  But there's nothing special about it otherwise.  `$SAGE_LOCAL` is no different in function from a virtualenv--it's just an alternate install prefix, like `/usr/local`.\n\nSage with its`SAGE_LOCAL` is not a Python virtual environment, it's more Conda-like virtual environment. I think it's agreed that we don't want to be another Conda, but rather try to undo this. By continuing to do custom things to `SAGE_LOCAL` instead of using correct Python tools, e.g. Python modules, Python venv, we work against the latter goal.",
    "created_at": "2020-01-31T12:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456286",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@embray](#comment%3A6):
> Replying to [@dimpase](#comment%3A4):
> > Replying to [@embray](#comment%3A3):
> > > > runnable in venv of a system Python

> > > 
> > > The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.
> > > 

> > I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.
> > 
> > Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.

> 
> No we're not.  Distro packagers already do it. 

So? You get something that you can only change is you have root.
Are you seriosly proposing that Sage developent should be done as root?


> When it comes down to it it's just another Python package, with some variables in `sage.env` you have to configure (the problem we are trying to solve is that that part is currently too difficult to configure, which is why packagers often just replace `sage.env` with their own hard-coded one).
> 
> > You don't want to trash your system python every time things go wrong.

> 
> Yes, that's what virtualenvs are for.  But there's nothing special about it otherwise.  `$SAGE_LOCAL` is no different in function from a virtualenv--it's just an alternate install prefix, like `/usr/local`.

Sage with its`SAGE_LOCAL` is not a Python virtual environment, it's more Conda-like virtual environment. I think it's agreed that we don't want to be another Conda, but rather try to undo this. By continuing to do custom things to `SAGE_LOCAL` instead of using correct Python tools, e.g. Python modules, Python venv, we work against the latter goal.



---

archive/issue_comments_456287.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@embray](#comment%3A7):\n> Replying to [@dimpase](#comment%3A5):\n> > This is too disruptive to revert now, IMHO, as there is too much stuff in the works that depends or might depend upon it.\n\n> \n> This was already disruptive by definition as it caused at least one regression.  What's in the works that depends or might depend on it, and why are those things necessary?  And how?  None of this has been explained.\n\nWrapping some of Sage's spaghetti configuration into a Python module --- that's what #29038 mostly does and why it is welcome, cause it's a move in the right direction, from a place where much feet-dragging has taken place (so yes indeed, disruptive, in the positive sense).",
    "created_at": "2020-01-31T12:41:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456287",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@embray](#comment%3A7):
> Replying to [@dimpase](#comment%3A5):
> > This is too disruptive to revert now, IMHO, as there is too much stuff in the works that depends or might depend upon it.

> 
> This was already disruptive by definition as it caused at least one regression.  What's in the works that depends or might depend on it, and why are those things necessary?  And how?  None of this has been explained.

Wrapping some of Sage's spaghetti configuration into a Python module --- that's what #29038 mostly does and why it is welcome, cause it's a move in the right direction, from a place where much feet-dragging has taken place (so yes indeed, disruptive, in the positive sense).



---

archive/issue_comments_456288.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSee #29119 for an alternative proposal which I think meets the same needs.",
    "created_at": "2020-01-31T13:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456288",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

See #29119 for an alternative proposal which I think meets the same needs.



---

archive/issue_comments_456289.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@dimpase](#comment%3A8):\n> Replying to [@embray](#comment%3A6):\n> > Yes, that's what virtualenvs are for.  But there's nothing special about it otherwise.  `$SAGE_LOCAL` is no different in function from a virtualenv--it's just an alternate install prefix, like `/usr/local`.\n\n> \n> Sage with its`SAGE_LOCAL` is not a Python virtual environment, it's more Conda-like virtual environment. I think it's agreed that we don't want to be another Conda, but rather try to undo this. By continuing to do custom things to `SAGE_LOCAL` instead of using correct Python tools, e.g. Python modules, Python venv, we work against the latter goal.\n\nI'm sorry, but this is meaningless.\n\nCan you please explain to me exactly what you think a virtualenv/venv is in Python?  Because I think you ascribe a lot more depth and complexity to it than it actually is.\n\nIn practice there's little distinction between a virtualenv and a Conda env.  In fact, Conda started out originally as part of the build system for Anaconda's spiritual predecessor, Canopy.  Back then it was just a virtualenv plus some additional bells-and-whistles (such as setting the correct environment variables) to be able to install non-Python packages into it.  The main difference with Conda envs--where they went beyond the original concept--was to not be tied to a specific Python interpreter--but in fact allow installing different Pythons into the environment as well.\n\nI don't see where you get the idea that this discussion has anything to do with \"custom things to `SAGE_LOCAL`\".  If anything it's the opposite.  I am trying to treat SAGE_LOCAL as *less* special.",
    "created_at": "2020-01-31T13:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456289",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@dimpase](#comment%3A8):
> Replying to [@embray](#comment%3A6):
> > Yes, that's what virtualenvs are for.  But there's nothing special about it otherwise.  `$SAGE_LOCAL` is no different in function from a virtualenv--it's just an alternate install prefix, like `/usr/local`.

> 
> Sage with its`SAGE_LOCAL` is not a Python virtual environment, it's more Conda-like virtual environment. I think it's agreed that we don't want to be another Conda, but rather try to undo this. By continuing to do custom things to `SAGE_LOCAL` instead of using correct Python tools, e.g. Python modules, Python venv, we work against the latter goal.

I'm sorry, but this is meaningless.

Can you please explain to me exactly what you think a virtualenv/venv is in Python?  Because I think you ascribe a lot more depth and complexity to it than it actually is.

In practice there's little distinction between a virtualenv and a Conda env.  In fact, Conda started out originally as part of the build system for Anaconda's spiritual predecessor, Canopy.  Back then it was just a virtualenv plus some additional bells-and-whistles (such as setting the correct environment variables) to be able to install non-Python packages into it.  The main difference with Conda envs--where they went beyond the original concept--was to not be tied to a specific Python interpreter--but in fact allow installing different Pythons into the environment as well.

I don't see where you get the idea that this discussion has anything to do with "custom things to `SAGE_LOCAL`".  If anything it's the opposite.  I am trying to treat SAGE_LOCAL as *less* special.



---

archive/issue_comments_456290.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI would suggest to close the discussion about the python3-spkg-configure-venv proposals on this ticket. The discussion should take place on the technical tickets regarding that (#29013, #27824, #29023, #29032).\n\n#29038 has nothing to with it.",
    "created_at": "2020-01-31T13:58:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456290",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

I would suggest to close the discussion about the python3-spkg-configure-venv proposals on this ticket. The discussion should take place on the technical tickets regarding that (#29013, #27824, #29023, #29032).

#29038 has nothing to with it.



---

archive/issue_comments_456291.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nPlease review #29120 - One-line fix for \"./configure is too sensitive to stray files/subdirectories\".",
    "created_at": "2020-01-31T14:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456291",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

Please review #29120 - One-line fix for "./configure is too sensitive to stray files/subdirectories".



---

archive/issue_events_397212.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-31T14:56:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397212"
}
```



---

archive/issue_comments_456292.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@dimpase](#comment%3A8):\n> Replying to [@embray](#comment%3A6):\n> > Replying to [@dimpase](#comment%3A4):\n> > > Replying to [@embray](#comment%3A3):\n> > > > > runnable in venv of a system Python\n\n> > > > \n> > > > The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.\n> > > > \n\n> > > I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.\n> > > \n> > > Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.\n\n> > \n> > No we're not.  Distro packagers already do it. \n\n> \n> So? You get something that you can only change is you have root.\n> Are you seriosly proposing that Sage developent should be done as root?\n> \n\nI and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.",
    "created_at": "2020-01-31T19:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456292",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@dimpase](#comment%3A8):
> Replying to [@embray](#comment%3A6):
> > Replying to [@dimpase](#comment%3A4):
> > > Replying to [@embray](#comment%3A3):
> > > > > runnable in venv of a system Python

> > > > 
> > > > The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.
> > > > 

> > > I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.
> > > 
> > > Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.

> > 
> > No we're not.  Distro packagers already do it. 

> 
> So? You get something that you can only change is you have root.
> Are you seriosly proposing that Sage developent should be done as root?
> 

I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.



---

archive/issue_comments_456293.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@kiwifb](#comment%3A15):\n> Replying to [@dimpase](#comment%3A8):\n> > So? You get something that you can only change is you have root.\n> > Are you seriosly proposing that Sage developent should be done as root?\n> > \n\n> \n> I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.\n\n+1\n\nAdditionally, nix doesn't even need root at all. It would be a perfectly viable replacement to sage's own build system for sage-development purposes. I already thought about suggesting that in the past, but I didn't since I don't have the time to work on it / convince people myself.\n\nEdit: Now that I think about it I think I did suggest it once. One downside was that there would be no cygwin support, just WSL. Or someone would have to work on reviving nix on cygwin, not sure what it's current state is.\n\nI agree with Erik and Fran\u00e7ois that adding a package juts for configuration makes things a bit more difficult, at least for packagers. Instead of patching a file, we now have to add another python package and essentially re-write it.\n\nI haven't looked at the details of the implementation though, I'm mostly commenting on what I understand from the title and the description.\n\nIn any case, thank you for your work @mkoeppe. It definitely has the right intention.",
    "created_at": "2020-01-31T23:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456293",
    "user": "https://github.com/timokau"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@kiwifb](#comment%3A15):
> Replying to [@dimpase](#comment%3A8):
> > So? You get something that you can only change is you have root.
> > Are you seriosly proposing that Sage developent should be done as root?
> > 

> 
> I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.

+1

Additionally, nix doesn't even need root at all. It would be a perfectly viable replacement to sage's own build system for sage-development purposes. I already thought about suggesting that in the past, but I didn't since I don't have the time to work on it / convince people myself.

Edit: Now that I think about it I think I did suggest it once. One downside was that there would be no cygwin support, just WSL. Or someone would have to work on reviving nix on cygwin, not sure what it's current state is.

I agree with Erik and Fran√ßois that adding a package juts for configuration makes things a bit more difficult, at least for packagers. Instead of patching a file, we now have to add another python package and essentially re-write it.

I haven't looked at the details of the implementation though, I'm mostly commenting on what I understand from the title and the description.

In any case, thank you for your work @mkoeppe. It definitely has the right intention.



---

archive/issue_comments_456294.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@kiwifb](#comment%3A15):\n> Replying to [@dimpase](#comment%3A8):\n> > Replying to [@embray](#comment%3A6):\n> > > Replying to [@dimpase](#comment%3A4):\n> > > > Replying to [@embray](#comment%3A3):\n> > > > > > runnable in venv of a system Python\n\n> > > > > \n> > > > > The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.\n> > > > > \n\n> > > > I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.\n> > > > \n> > > > Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.\n\n> > > \n> > > No we're not.  Distro packagers already do it. \n\n> > \n> > So? You get something that you can only change is you have root.\n> > Are you seriosly proposing that Sage developent should be done as root?\n> > \n\n> \n> I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.\n\nWhile I made that comment, I had in mind tasks of Sage development rather than Sage's packaging. Developers don't have or don't know how to use these distro-specific tools,\ne.g. I hate to think of the sort of hoops one has to jump through to uninstall a system-wide Python package on MacOS.\n\nThat's why venv comes quite handy.",
    "created_at": "2020-01-31T23:10:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456294",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@kiwifb](#comment%3A15):
> Replying to [@dimpase](#comment%3A8):
> > Replying to [@embray](#comment%3A6):
> > > Replying to [@dimpase](#comment%3A4):
> > > > Replying to [@embray](#comment%3A3):
> > > > > > runnable in venv of a system Python

> > > > > 
> > > > > The virtualenv stuff is also a red herring.  It should be pip-installable directly into a system Python's site-packages too.  If that's possible then installing into a virtualenv also works more-or-less trivially.  If we have to do much anything special in the case of a virtualenv then we're probably doing someting wrong.
> > > > > 

> > > > I don't think you are right here. Having sagelib working in venv of a system python is almost as good as direct pip-installing, as it allows to get away from endlessly rebuilding python system packages.
> > > > 
> > > > Installing sagelib directly into system python packages is useless from development point of view. It's good as a final goal, but we're far from it.

> > > 
> > > No we're not.  Distro packagers already do it. 

> > 
> > So? You get something that you can only change is you have root.
> > Are you seriosly proposing that Sage developent should be done as root?
> > 

> 
> I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.

While I made that comment, I had in mind tasks of Sage development rather than Sage's packaging. Developers don't have or don't know how to use these distro-specific tools,
e.g. I hate to think of the sort of hoops one has to jump through to uninstall a system-wide Python package on MacOS.

That's why venv comes quite handy.



---

archive/issue_comments_456295.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAnd venv and Python package (sage_conf, in this case) are standard Python tools, whereas Sage distro with its SAGE_LOCAL\nand spaghetti text files for configuration are not.\n\nLet me take the liberty to positively review this as won't fix.",
    "created_at": "2020-01-31T23:16:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456295",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

And venv and Python package (sage_conf, in this case) are standard Python tools, whereas Sage distro with its SAGE_LOCAL
and spaghetti text files for configuration are not.

Let me take the liberty to positively review this as won't fix.



---

archive/issue_events_397213.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-31T23:16:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397213"
}
```



---

archive/issue_events_397214.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-31T23:16:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397214"
}
```



---

archive/issue_events_397215.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-01T15:35:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397215"
}
```



---

archive/issue_events_397216.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-01T15:35:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
    "label_color": "fff9e5",
    "label_name": "p: trivial / 5",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397216"
}
```



---

archive/issue_comments_456296.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI disagree, since this would be a prerequisite of #29119 which makes this sage_conf script unnecessary.",
    "created_at": "2020-02-05T10:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456296",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

I disagree, since this would be a prerequisite of #29119 which makes this sage_conf script unnecessary.



---

archive/issue_events_397217.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-02-05T10:35:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397217"
}
```



---

archive/issue_events_397218.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-02-05T10:35:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397218"
}
```



---

archive/issue_events_397219.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-02-05T10:35:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397219"
}
```



---

archive/issue_comments_456297.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@timokau](#comment%3A16):\n> Replying to [@kiwifb](#comment%3A15):\n> > Replying to [@dimpase](#comment%3A8):\n> > > So? You get something that you can only change is you have root.\n> > > Are you seriosly proposing that Sage developent should be done as root?\n> > > \n\n> > \n> > I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.\n\n> \n> +1\n> \n> Additionally, nix doesn't even need root at all. It would be a perfectly viable replacement to sage's own build system for sage-development purposes. I already thought about suggesting that in the past, but I didn't since I don't have the time to work on it / convince people myself.\n\nYeah, I don't have any idea where this idea of having to use root came from.  Installing into the site-packages of any Python in any prefix (virtualenv or no virtualenv) is exactly the same process.  virtualenv doesn't even enter into it.  I cannot stress this enough, but you (Dima and Matthias) seem to be **very confused** about what the purpose and functionality of virtualenv is.  It's just a tool to create a new install prefix under user control that can also link to an existing system Python without having to completely reinstall Python.  That's it.  That's all it is.",
    "created_at": "2020-02-05T10:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456297",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@timokau](#comment%3A16):
> Replying to [@kiwifb](#comment%3A15):
> > Replying to [@dimpase](#comment%3A8):
> > > So? You get something that you can only change is you have root.
> > > Are you seriosly proposing that Sage developent should be done as root?
> > > 

> > 
> > I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.

> 
> +1
> 
> Additionally, nix doesn't even need root at all. It would be a perfectly viable replacement to sage's own build system for sage-development purposes. I already thought about suggesting that in the past, but I didn't since I don't have the time to work on it / convince people myself.

Yeah, I don't have any idea where this idea of having to use root came from.  Installing into the site-packages of any Python in any prefix (virtualenv or no virtualenv) is exactly the same process.  virtualenv doesn't even enter into it.  I cannot stress this enough, but you (Dima and Matthias) seem to be **very confused** about what the purpose and functionality of virtualenv is.  It's just a tool to create a new install prefix under user control that can also link to an existing system Python without having to completely reinstall Python.  That's it.  That's all it is.



---

archive/issue_comments_456298.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nWhatever is needed on #29119 can be handled there.",
    "created_at": "2020-02-05T10:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456298",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

Whatever is needed on #29119 can be handled there.



---

archive/issue_comments_456299.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@embray](#comment%3A21):\n> Replying to [@timokau](#comment%3A16):\n> > Replying to [@kiwifb](#comment%3A15):\n> > > Replying to [@dimpase](#comment%3A8):\n> > > > So? You get something that you can only change is you have root.\n> > > > Are you seriosly proposing that Sage developent should be done as root?\n> > > > \n\n> > > \n> > > I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.\n\n> > \n> > +1\n> > \n> > Additionally, nix doesn't even need root at all. It would be a perfectly viable replacement to sage's own build system for sage-development purposes. I already thought about suggesting that in the past, but I didn't since I don't have the time to work on it / convince people myself.\n\n> \n> Yeah, I don't have any idea where this idea of having to use root came from.  Installing into the site-packages of any Python in any prefix (virtualenv or no virtualenv) is exactly the same process.  virtualenv doesn't even enter into it.  I cannot stress this enough, but you (Dima and Matthias) seem to be **very confused** about what the purpose and functionality of virtualenv is.  It's just a tool to create a new install prefix under user control that can also link to an existing system Python without having to completely reinstall Python.  That's it.  That's all it is.\n\nyes, venv is a tool. It's already there, it's standard. Use it, don't re-invent the wheel with textfiles you need to parse...",
    "created_at": "2020-02-05T10:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456299",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@embray](#comment%3A21):
> Replying to [@timokau](#comment%3A16):
> > Replying to [@kiwifb](#comment%3A15):
> > > Replying to [@dimpase](#comment%3A8):
> > > > So? You get something that you can only change is you have root.
> > > > Are you seriosly proposing that Sage developent should be done as root?
> > > > 

> > > 
> > > I and other distro maintainers have tools to build (and normally to run package testsuite in most case) without having to install the full package or needing root access. I even can do it with a given git branch. Of course we still need to install the dependencies but that's a given.

> > 
> > +1
> > 
> > Additionally, nix doesn't even need root at all. It would be a perfectly viable replacement to sage's own build system for sage-development purposes. I already thought about suggesting that in the past, but I didn't since I don't have the time to work on it / convince people myself.

> 
> Yeah, I don't have any idea where this idea of having to use root came from.  Installing into the site-packages of any Python in any prefix (virtualenv or no virtualenv) is exactly the same process.  virtualenv doesn't even enter into it.  I cannot stress this enough, but you (Dima and Matthias) seem to be **very confused** about what the purpose and functionality of virtualenv is.  It's just a tool to create a new install prefix under user control that can also link to an existing system Python without having to completely reinstall Python.  That's it.  That's all it is.

yes, venv is a tool. It's already there, it's standard. Use it, don't re-invent the wheel with textfiles you need to parse...



---

archive/issue_comments_456300.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis would still be a prerequisite and there's already a branch so why not.\n\nI had a thought that might elucidate the issue about virtualenvs / install prefixes, etc.\n\nPython also supports something even more basic called USER_BASE--this predates virtualenv and venv by quite a long time.  It's just another notion of an alternate install prefix--the difference is it doesn't even link to an existing python interpreter or change the interpreter's `sys.prefix`.  It's just an alternate prefix (like `/usr/local`) which goes to the front of the path, but that can live in individual users' home directories; on *NIX systems it is `~/.local`: https://docs.python.org/3/library/site.html#site.USER_BASE\n\nBy default (unless it's disabled, which you can control with some environment variables, a usercustomize.py, etc.) it is enabled, and if `~/.local/lib/pythonX.Y/site-packages` exists it supersedes the system site-packages on `sys.path`.  Of course, since this is a full root prefix, you can also have a `~/.local/bin` and such.  So when you run `pip install --user` on a package, for example, any files it installs go into the `~/.local/` prefix, including scripts, share data, etc.  Of course, it's the user's responsibly to add `~/.local/bin` to their `PATH` if they want to use it.\n\nThis scheme is used by other tools as well I believe; for example I always install ruby gems into my `~/.local`.\n\nThis is again to emphasize that virtualenv is not special and not the only context in which you'd want to install a Python package into a prefix that has nothing to with virtualenv, `/usr`, `$SAGE_LOCAL`, or any of that (`$SAGE_LOCAL` is sort of like a special case of `~/.local` but specific to sage-the-distribution.  When you run Sage's `./configure` you can even do something like `./configure --prefix=$HOME/.local`, and `$SAGE_LOCAL` is just a fancy synonym for `$prefix`.  This is just discouraged for *development* in sage-the-distribution in order to keep it isolated from other install prefixes so that problems are easier to track down.",
    "created_at": "2020-02-05T10:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456300",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

This would still be a prerequisite and there's already a branch so why not.

I had a thought that might elucidate the issue about virtualenvs / install prefixes, etc.

Python also supports something even more basic called USER_BASE--this predates virtualenv and venv by quite a long time.  It's just another notion of an alternate install prefix--the difference is it doesn't even link to an existing python interpreter or change the interpreter's `sys.prefix`.  It's just an alternate prefix (like `/usr/local`) which goes to the front of the path, but that can live in individual users' home directories; on *NIX systems it is `~/.local`: https://docs.python.org/3/library/site.html#site.USER_BASE

By default (unless it's disabled, which you can control with some environment variables, a usercustomize.py, etc.) it is enabled, and if `~/.local/lib/pythonX.Y/site-packages` exists it supersedes the system site-packages on `sys.path`.  Of course, since this is a full root prefix, you can also have a `~/.local/bin` and such.  So when you run `pip install --user` on a package, for example, any files it installs go into the `~/.local/` prefix, including scripts, share data, etc.  Of course, it's the user's responsibly to add `~/.local/bin` to their `PATH` if they want to use it.

This scheme is used by other tools as well I believe; for example I always install ruby gems into my `~/.local`.

This is again to emphasize that virtualenv is not special and not the only context in which you'd want to install a Python package into a prefix that has nothing to with virtualenv, `/usr`, `$SAGE_LOCAL`, or any of that (`$SAGE_LOCAL` is sort of like a special case of `~/.local` but specific to sage-the-distribution.  When you run Sage's `./configure` you can even do something like `./configure --prefix=$HOME/.local`, and `$SAGE_LOCAL` is just a fancy synonym for `$prefix`.  This is just discouraged for *development* in sage-the-distribution in order to keep it isolated from other install prefixes so that problems are easier to track down.



---

archive/issue_comments_456301.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n> yes, venv is a tool. It's already there, it's standard. Use it, don't re-invent the wheel with textfiles you need to parse...\n\nI have literally no idea what you're talking about at this point.",
    "created_at": "2020-02-05T10:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456301",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

> yes, venv is a tool. It's already there, it's standard. Use it, don't re-invent the wheel with textfiles you need to parse...

I have literally no idea what you're talking about at this point.



---

archive/issue_comments_456302.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-02-05T10:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456302",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_397220.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-02-05T10:55:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397220"
}
```



---

archive/issue_comments_456303.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nWe may revert this when the replacement, #29119, is ready, and the revert is carefully tested. But now it should stay.",
    "created_at": "2020-02-05T10:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456303",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

We may revert this when the replacement, #29119, is ready, and the revert is carefully tested. But now it should stay.



---

archive/issue_events_397221.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-02-05T10:55:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397221"
}
```



---

archive/issue_events_397222.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-02-05T10:55:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397222"
}
```



---

archive/issue_events_397223.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-02-05T11:18:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397223"
}
```



---

archive/issue_events_397224.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-02-05T11:18:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397224"
}
```



---

archive/issue_events_397225.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-02-05T11:18:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397225"
}
```



---

archive/issue_comments_456304.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nHow about this?  Leave it open but I'll remove the milestone.  There's no reason to close this yet.",
    "created_at": "2020-02-05T11:18:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456304",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

How about this?  Leave it open but I'll remove the milestone.  There's no reason to close this yet.



---

archive/issue_comments_456305.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n Let's please roll this back and stop making major changes to the build system until we can get some clarity on what the overall goals of these changes are.\n \n Please consider this an alternative to #29114 which is adding still more complications to work around a regression introduced by #29038.  I think it would be simpler for now to roll back #29038 until we can re-assess.\n+\n+In the meantime, please see #29119 which offers an alternative approach which I believe is more in the spirit of making sagelib buildable independently of sage-the-distribution without any non-standard external scripts.\n``````\n",
    "created_at": "2020-02-05T11:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456305",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 Let's please roll this back and stop making major changes to the build system until we can get some clarity on what the overall goals of these changes are.
 
 Please consider this an alternative to #29114 which is adding still more complications to work around a regression introduced by #29038.  I think it would be simpler for now to roll back #29038 until we can re-assess.
+
+In the meantime, please see #29119 which offers an alternative approach which I believe is more in the spirit of making sagelib buildable independently of sage-the-distribution without any non-standard external scripts.
``````




---

archive/issue_comments_456306.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nMaybe [this line](https://gitlab.com/sagemath/sage/-/blob/1d465c7e3c82110d39034f3ca7d9d120f435511e/configure.ac#L91) from Sage's own configure.ac can help elucidate the fact that FUD about \"SAGE_LOCAL\" is a red herring.\n\nIt's still just an install prefix.  All the scripts related to SAGE_LOCAL are just about setting the prefix.  When building SPKGs this also means setting things like header and library paths, and setting the rpath on binaries; tasks which need to be done for installing software in any non-default path.  It's not all that complicated.",
    "created_at": "2020-02-05T11:27:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456306",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

Maybe [this line](https://gitlab.com/sagemath/sage/-/blob/1d465c7e3c82110d39034f3ca7d9d120f435511e/configure.ac#L91) from Sage's own configure.ac can help elucidate the fact that FUD about "SAGE_LOCAL" is a red herring.

It's still just an install prefix.  All the scripts related to SAGE_LOCAL are just about setting the prefix.  When building SPKGs this also means setting things like header and library paths, and setting the rpath on binaries; tasks which need to be done for installing software in any non-default path.  It's not all that complicated.



---

archive/issue_comments_456307.json:
```json
{
    "body": "Changed author from **Erik Bray** to none",
    "created_at": "2020-10-20T16:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456307",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Erik Bray** to none



---

archive/issue_events_397226.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-20T16:19:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397226"
}
```



---

archive/issue_comments_456308.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nTime to close it.",
    "created_at": "2020-10-20T16:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29118#issuecomment-456308",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

Time to close it.



---

archive/issue_events_397227.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-22T09:03:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397227"
}
```



---

archive/issue_events_397228.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-22T09:03:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397228"
}
```



---

archive/issue_events_397229.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-24T20:15:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397229"
}
```



---

archive/issue_events_397230.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-24T20:15:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29118",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29118#event-397230"
}
```
