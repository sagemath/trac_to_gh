# Issue 29607: homebrew-standard: Fix several problems with library search paths

archive/issues_029370.json:
```json
{
    "assignees": [],
    "body": "#29562  broke the `gfortran` build in `homebrew-macos-minimal` (https://github.com/mkoeppe/sage/runs/624417033):\n\n```\nChecking LIBRARY_PATH variable... contains current directory\nconfigure: error: \n*** LIBRARY_PATH shouldn't contain the current directory when\n*** building gcc. Please change the environment variable\n*** and run configure again.\n```\n\n\n#29562 also broke `flint`/`singular` on `homebrew` when conflicting versions of libraries are in `/usr/local`, leading to doctest errors and segfaults such as this one:\n\n```\nFile \"src/sage/combinat/posets/posets.py\", line 3816, in sage.combinat.posets.posets.FinitePoset.coxeter_smith_form\nFailed example:\n    prod(P.coxeter_smith_form()) == P.coxeter_polynomial()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.posets.posets.FinitePoset.coxeter_smith_form[3]>\", line 1, in <module>\n        prod(P.coxeter_smith_form()) == P.coxeter_polynomial()\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/combinat/posets/posets.py\", line 3846, in coxeter_smith_form\n        L = sing_m.smith().sage().diagonal()\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 1087, in sage\n        return self._sage_(*args, **kwds)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py\", line 1949, in _sage_\n        typ = self.type()\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py\", line 2107, in type\n        m = p.match(self.parent().eval(\"type(%s)\"%self.name()))\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py\", line 659, in eval\n        raise SingularError('Singular error:\\n%s'%s)\n    sage.interfaces.singular.SingularError: Singular error:\n           GCDL[j,i]=-STDM[j,j]/G;<<\n    Segment fault/Bus error occurred (r:0)\n    please inform the authors\n    trying to restart...\n    Singular : signal 11 (v: 4112):\n    current line:>\n**********************************************************************\n```\n\n\nDepends on #29562\n\nCC:  @jhpalmieri @dimpase @slel @kiwifb @isuruf @antonio-rojas @mwageringel @thierry-FreeBSD @vbraun\n\nBranch/Commit: **[`fcfbc10`](https://github.com/sagemath/sagetrac-mirror/commit/fcfbc100625b2888ccca539e2f19304a9c2b6776)**\n\nReviewer: **John Palmieri, Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29607_\n\n",
    "closed_at": "2020-05-04T06:41:28Z",
    "created_at": "2020-04-28T04:00:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "homebrew-standard: Fix several problems with library search paths",
    "type": "issue",
    "updated_at": "2020-05-04T06:41:28Z",
    "url": "https://github.com/sagemath/sage/issues/29607",
    "user": "https://github.com/mkoeppe"
}
```
#29562  broke the `gfortran` build in `homebrew-macos-minimal` (https://github.com/mkoeppe/sage/runs/624417033):

```
Checking LIBRARY_PATH variable... contains current directory
configure: error: 
*** LIBRARY_PATH shouldn't contain the current directory when
*** building gcc. Please change the environment variable
*** and run configure again.
```


#29562 also broke `flint`/`singular` on `homebrew` when conflicting versions of libraries are in `/usr/local`, leading to doctest errors and segfaults such as this one:

```
File "src/sage/combinat/posets/posets.py", line 3816, in sage.combinat.posets.posets.FinitePoset.coxeter_smith_form
Failed example:
    prod(P.coxeter_smith_form()) == P.coxeter_polynomial()
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.posets.posets.FinitePoset.coxeter_smith_form[3]>", line 1, in <module>
        prod(P.coxeter_smith_form()) == P.coxeter_polynomial()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/combinat/posets/posets.py", line 3846, in coxeter_smith_form
        L = sing_m.smith().sage().diagonal()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 1087, in sage
        return self._sage_(*args, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py", line 1949, in _sage_
        typ = self.type()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py", line 2107, in type
        m = p.match(self.parent().eval("type(%s)"%self.name()))
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py", line 659, in eval
        raise SingularError('Singular error:\n%s'%s)
    sage.interfaces.singular.SingularError: Singular error:
           GCDL[j,i]=-STDM[j,j]/G;<<
    Segment fault/Bus error occurred (r:0)
    please inform the authors
    trying to restart...
    Singular : signal 11 (v: 4112):
    current line:>
**********************************************************************
```


Depends on #29562

CC:  @jhpalmieri @dimpase @slel @kiwifb @isuruf @antonio-rojas @mwageringel @thierry-FreeBSD @vbraun

Branch/Commit: **[`fcfbc10`](https://github.com/sagemath/sagetrac-mirror/commit/fcfbc100625b2888ccca539e2f19304a9c2b6776)**

Reviewer: **John Palmieri, Dima Pasechnik**

Author: **Matthias Koeppe**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/29607_





---

archive/issue_events_404196.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-28T04:00:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404196"
}
```



---

archive/issue_events_404197.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-28T04:00:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404197"
}
```



---

archive/issue_events_404198.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-28T04:00:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404198"
}
```



---

archive/issue_events_404199.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-28T04:00:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404199"
}
```



---

archive/issue_events_404200.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-28T04:03:18Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "title_is": "Another fixup for .homebrew-build-env setting CPATH, LIBRARY_PATH",
    "title_was": "Fixup for \".homebrew-build-env: Set CPATH, LIBRARY_PATH instead of CPPFLAGS, LDFLAGS\"",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404200"
}
```



---

archive/issue_comments_465826.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,10 @@\n+This broke `homebrew-macos-minimal`, `gfortran`:\n \n+```\n+Checking LIBRARY_PATH variable... contains current directory\n+configure: error: \n+*** LIBRARY_PATH shouldn't contain the current directory when\n+*** building gcc. Please change the environment variable\n+*** and run configure again.\n+```\n+\n``````\n",
    "created_at": "2020-04-28T04:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465826",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,10 @@
+This broke `homebrew-macos-minimal`, `gfortran`:
 
+```
+Checking LIBRARY_PATH variable... contains current directory
+configure: error: 
+*** LIBRARY_PATH shouldn't contain the current directory when
+*** building gcc. Please change the environment variable
+*** and run configure again.
+```
+
``````




---

archive/issue_comments_465827.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This broke `homebrew-macos-minimal`, `gfortran`:\n+#29562  broke `homebrew-macos-minimal`, `gfortran`:\n \n ```\n Checking LIBRARY_PATH variable... contains current directory\n``````\n",
    "created_at": "2020-04-28T04:03:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465827",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This broke `homebrew-macos-minimal`, `gfortran`:
+#29562  broke `homebrew-macos-minimal`, `gfortran`:
 
 ```
 Checking LIBRARY_PATH variable... contains current directory
``````




---

archive/issue_comments_465828.json:
```json
{
    "body": "Dependencies: **#29562**",
    "created_at": "2020-04-28T04:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465828",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29562**



---

archive/issue_comments_465829.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-#29562  broke `homebrew-macos-minimal`, `gfortran`:\n+#29562  broke the `gfortran` build in `homebrew-macos-minimal` (https://github.com/mkoeppe/sage/runs/624417033):\n \n ```\n Checking LIBRARY_PATH variable... contains current directory\n``````\n",
    "created_at": "2020-04-28T04:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465829",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-#29562  broke `homebrew-macos-minimal`, `gfortran`:
+#29562  broke the `gfortran` build in `homebrew-macos-minimal` (https://github.com/mkoeppe/sage/runs/624417033):
 
 ```
 Checking LIBRARY_PATH variable... contains current directory
``````




---

archive/issue_comments_465830.json:
```json
{
    "body": "Branch: **[u/mkoeppe/another_fixup_for__homebrew_build_env_setting_cpath__library_path](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/another_fixup_for__homebrew_build_env_setting_cpath__library_path)**",
    "created_at": "2020-04-28T04:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465830",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/another_fixup_for__homebrew_build_env_setting_cpath__library_path](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/another_fixup_for__homebrew_build_env_setting_cpath__library_path)**



---

archive/issue_events_404201.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-28T04:10:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404201"
}
```



---

archive/issue_comments_465831.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-04-28T04:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465831",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_465832.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e74c6c29a877eff08a8e4949b20f14157350b6f9\"><code>e74c6c2</code></a></td><td><code>.homebrew-build-env: Set CPATH, LIBRARY_PATH instead of CPPFLAGS, LDFLAGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33714650eeda193ed5a05a7dd7d0250ae09ccf0c\"><code>3371465</code></a></td><td><code>Merge branch 't/29562/_homebrew_build_env__set_cpath_instead_of_cppflags' into t/29607/another_fixup_for__homebrew_build_env_setting_cpath__library_path</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1002b626c28e7e819b19b4037af5b70d76ba936\"><code>c1002b6</code></a></td><td><code>.homebrew-build-env: Do not accidentally put the current directory in CPATH, LIBRARY_PATH</code></td></tr></table>\n",
    "created_at": "2020-04-28T04:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465832",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e74c6c29a877eff08a8e4949b20f14157350b6f9"><code>e74c6c2</code></a></td><td><code>.homebrew-build-env: Set CPATH, LIBRARY_PATH instead of CPPFLAGS, LDFLAGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33714650eeda193ed5a05a7dd7d0250ae09ccf0c"><code>3371465</code></a></td><td><code>Merge branch 't/29562/_homebrew_build_env__set_cpath_instead_of_cppflags' into t/29607/another_fixup_for__homebrew_build_env_setting_cpath__library_path</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1002b626c28e7e819b19b4037af5b70d76ba936"><code>c1002b6</code></a></td><td><code>.homebrew-build-env: Do not accidentally put the current directory in CPATH, LIBRARY_PATH</code></td></tr></table>




---

archive/issue_comments_465833.json:
```json
{
    "body": "Commit: **[`c1002b6`](https://github.com/sagemath/sagetrac-mirror/commit/c1002b626c28e7e819b19b4037af5b70d76ba936)**",
    "created_at": "2020-04-28T04:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465833",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`c1002b6`](https://github.com/sagemath/sagetrac-mirror/commit/c1002b626c28e7e819b19b4037af5b70d76ba936)**



---

archive/issue_comments_465834.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nTests at https://github.com/mkoeppe/sage/actions/runs/89771836",
    "created_at": "2020-04-28T04:25:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465834",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

Tests at https://github.com/mkoeppe/sage/actions/runs/89771836



---

archive/issue_events_404202.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-04-28T16:43:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404202"
}
```



---

archive/issue_events_404203.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-04-28T16:43:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404203"
}
```



---

archive/issue_comments_465835.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis works for me, with or without `gfortran`. With just #29562, `gfortran` does indeed fail. This branch doesn't apply cleanly on top of #29562, I think, but I don't know if that matters.",
    "created_at": "2020-04-28T16:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465835",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

This works for me, with or without `gfortran`. With just #29562, `gfortran` does indeed fail. This branch doesn't apply cleanly on top of #29562, I think, but I don't know if that matters.



---

archive/issue_comments_465836.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2020-04-28T16:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465836",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_465837.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks! Actually this is fast-forward from #29562",
    "created_at": "2020-04-28T16:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465837",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks! Actually this is fast-forward from #29562



---

archive/issue_events_404204.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T07:23:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404204"
}
```



---

archive/issue_events_404205.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T07:23:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404205"
}
```



---

archive/issue_comments_465838.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSeems to need more work, to fix a problem with singular on homebrew.",
    "created_at": "2020-04-29T07:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465838",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Seems to need more work, to fix a problem with singular on homebrew.



---

archive/issue_comments_465839.json:
```json
{
    "body": "Changed commit from **[`c1002b6`](https://github.com/sagemath/sagetrac-mirror/commit/c1002b626c28e7e819b19b4037af5b70d76ba936)** to **[`f593e66`](https://github.com/sagemath/sagetrac-mirror/commit/f593e6657376e143647331ed4e73c555578b9884)**",
    "created_at": "2020-04-29T16:00:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465839",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c1002b6`](https://github.com/sagemath/sagetrac-mirror/commit/c1002b626c28e7e819b19b4037af5b70d76ba936)** to **[`f593e66`](https://github.com/sagemath/sagetrac-mirror/commit/f593e6657376e143647331ed4e73c555578b9884)**



---

archive/issue_comments_465840.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f593e6657376e143647331ed4e73c555578b9884\"><code>f593e66</code></a></td><td><code>src/bin/sage-env: Add to beginning, not end of CPATH, LIBRARY_PATH</code></td></tr></table>\n",
    "created_at": "2020-04-29T16:00:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465840",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f593e6657376e143647331ed4e73c555578b9884"><code>f593e66</code></a></td><td><code>src/bin/sage-env: Add to beginning, not end of CPATH, LIBRARY_PATH</code></td></tr></table>




---

archive/issue_events_404206.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T16:04:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "title_is": "src/bin/sage-env: Add to the front of CPATH, LIBRARY_PATH; , .homebrew-build-env: Do not add current dir",
    "title_was": "Another fixup for .homebrew-build-env setting CPATH, LIBRARY_PATH",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404206"
}
```



---

archive/issue_comments_465841.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,6 @@\n *** and run configure again.\n ```\n \n+\n+#29562 also broke `singular` on `homebrew`, leading to doctest errors and segfaults\n+\n``````\n",
    "created_at": "2020-04-29T16:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465841",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,6 @@
 *** and run configure again.
 ```
 
+
+#29562 also broke `singular` on `homebrew`, leading to doctest errors and segfaults
+
``````




---

archive/issue_events_404207.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T16:04:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404207"
}
```



---

archive/issue_events_404208.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T16:04:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404208"
}
```



---

archive/issue_events_404209.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T17:30:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404209"
}
```



---

archive/issue_events_404210.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T17:30:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404210"
}
```



---

archive/issue_comments_465842.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,5 +9,37 @@\n ```\n \n \n-#29562 also broke `singular` on `homebrew`, leading to doctest errors and segfaults\n+#29562 also broke `singular` on `homebrew`, leading to doctest errors and segfaults such as this one:\n \n+```\n+File \"src/sage/combinat/posets/posets.py\", line 3816, in sage.combinat.posets.posets.FinitePoset.coxeter_smith_form\n+Failed example:\n+    prod(P.coxeter_smith_form()) == P.coxeter_polynomial()\n+Exception raised:\n+    Traceback (most recent call last):\n+      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n+        self.compile_and_execute(example, compiler, test.globs)\n+      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n+        exec(compiled, globs)\n+      File \"<doctest sage.combinat.posets.posets.FinitePoset.coxeter_smith_form[3]>\", line 1, in <module>\n+        prod(P.coxeter_smith_form()) == P.coxeter_polynomial()\n+      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/combinat/posets/posets.py\", line 3846, in coxeter_smith_form\n+        L = sing_m.smith().sage().diagonal()\n+      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/interface.py\", line 1087, in sage\n+        return self._sage_(*args, **kwds)\n+      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py\", line 1949, in _sage_\n+        typ = self.type()\n+      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py\", line 2107, in type\n+        m = p.match(self.parent().eval(\"type(%s)\"%self.name()))\n+      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py\", line 659, in eval\n+        raise SingularError('Singular error:\\n%s'%s)\n+    sage.interfaces.singular.SingularError: Singular error:\n+           GCDL[j,i]=-STDM[j,j]/G;<<\n+    Segment fault/Bus error occurred (r:0)\n+    please inform the authors\n+    trying to restart...\n+    Singular : signal 11 (v: 4112):\n+    current line:>\n+**********************************************************************\n+```\n+\n``````\n",
    "created_at": "2020-04-29T18:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465842",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,5 +9,37 @@
 ```
 
 
-#29562 also broke `singular` on `homebrew`, leading to doctest errors and segfaults
+#29562 also broke `singular` on `homebrew`, leading to doctest errors and segfaults such as this one:
 
+```
+File "src/sage/combinat/posets/posets.py", line 3816, in sage.combinat.posets.posets.FinitePoset.coxeter_smith_form
+Failed example:
+    prod(P.coxeter_smith_form()) == P.coxeter_polynomial()
+Exception raised:
+    Traceback (most recent call last):
+      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
+        self.compile_and_execute(example, compiler, test.globs)
+      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
+        exec(compiled, globs)
+      File "<doctest sage.combinat.posets.posets.FinitePoset.coxeter_smith_form[3]>", line 1, in <module>
+        prod(P.coxeter_smith_form()) == P.coxeter_polynomial()
+      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/combinat/posets/posets.py", line 3846, in coxeter_smith_form
+        L = sing_m.smith().sage().diagonal()
+      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/interface.py", line 1087, in sage
+        return self._sage_(*args, **kwds)
+      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py", line 1949, in _sage_
+        typ = self.type()
+      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py", line 2107, in type
+        m = p.match(self.parent().eval("type(%s)"%self.name()))
+      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib/python3.7/site-packages/sage/interfaces/singular.py", line 659, in eval
+        raise SingularError('Singular error:\n%s'%s)
+    sage.interfaces.singular.SingularError: Singular error:
+           GCDL[j,i]=-STDM[j,j]/G;<<
+    Segment fault/Bus error occurred (r:0)
+    please inform the authors
+    trying to restart...
+    Singular : signal 11 (v: 4112):
+    current line:>
+**********************************************************************
+```
+
``````




---

archive/issue_comments_465843.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\ncc'ing some of our singular experts",
    "created_at": "2020-04-29T18:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465843",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

cc'ing some of our singular experts



---

archive/issue_events_404211.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T18:41:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "title_is": "homebrew-standard: Fix segfaults with singular (src/bin/sage-env: Add to the front of CPATH, LIBRARY_PATH; .homebrew-build-env: Do not add current dir)",
    "title_was": "src/bin/sage-env: Add to the front of CPATH, LIBRARY_PATH; , .homebrew-build-env: Do not add current dir",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404211"
}
```



---

archive/issue_comments_465844.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nBut Sage doesn't use the system's Singular. I don't understand.",
    "created_at": "2020-04-29T18:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465844",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

But Sage doesn't use the system's Singular. I don't understand.



---

archive/issue_comments_465845.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nNo, but some dependencies of Singular are coming from the system.",
    "created_at": "2020-04-29T19:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465845",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

No, but some dependencies of Singular are coming from the system.



---

archive/issue_comments_465846.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nDo you know which packages? I haven't seen these doctest failures, but I could install more homebrew packages to try to reproduce them.",
    "created_at": "2020-04-29T19:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465846",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

Do you know which packages? I haven't seen these doctest failures, but I could install more homebrew packages to try to reproduce them.



---

archive/issue_comments_465847.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe error can be reproduced in the standard homebrew environment set up by `tox -e local-homebrew-macos-standard -- ptest`.\n\nI am now trying with ` EXTRA_CONFIGURE_ARGS=\"--with-mp=mpir\" tox -e local-homebrew-macos-standard -- ptest` to disable use of homebrew's GMP.\n\nAny help with debugging this would be very welcome!",
    "created_at": "2020-04-29T19:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465847",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

The error can be reproduced in the standard homebrew environment set up by `tox -e local-homebrew-macos-standard -- ptest`.

I am now trying with ` EXTRA_CONFIGURE_ARGS="--with-mp=mpir" tox -e local-homebrew-macos-standard -- ptest` to disable use of homebrew's GMP.

Any help with debugging this would be very welcome!



---

archive/issue_comments_465848.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe failures can be seen, for example, in https://github.com/mkoeppe/sage/runs/628776278",
    "created_at": "2020-04-29T19:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465848",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

The failures can be seen, for example, in https://github.com/mkoeppe/sage/runs/628776278



---

archive/issue_comments_465849.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nLooks like failures in the pexpect interface to singular if I read those logs correctly and I haven't missed anything. This make `readline` the number one suspect amongst `singular`'s dependencies (`ntl`, `gmp`, `cddlib`, `flint`).",
    "created_at": "2020-04-29T20:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465849",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:21" align="right">comment:21</div>

Looks like failures in the pexpect interface to singular if I read those logs correctly and I haven't missed anything. This make `readline` the number one suspect amongst `singular`'s dependencies (`ntl`, `gmp`, `cddlib`, `flint`).



---

archive/issue_comments_465850.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI'll try `tox -e local-homebrew-macos-standard -- ptest`. In my current setup (in which I don't see any failures), the hints at the end of running `./configure` only suggest installing `cmake`, which implies (?) that I have everything in `homebrew-macos-standard` already. (The comment in `tox.ini` says \"Install all known system packages equivalent to standard packages that have spkg-configure.m4\", but it must actually require both an spkg-configure.m4 and distros/homebrew.txt, right?)",
    "created_at": "2020-04-29T20:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465850",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

I'll try `tox -e local-homebrew-macos-standard -- ptest`. In my current setup (in which I don't see any failures), the hints at the end of running `./configure` only suggest installing `cmake`, which implies (?) that I have everything in `homebrew-macos-standard` already. (The comment in `tox.ini` says "Install all known system packages equivalent to standard packages that have spkg-configure.m4", but it must actually require both an spkg-configure.m4 and distros/homebrew.txt, right?)



---

archive/issue_comments_465851.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jhpalmieri](#comment:22):\n> I'll try `tox -e local-homebrew-macos-standard -- ptest`. In my current setup (in which I don't see any failures), the hints at the end of running `./configure` only suggest installing `cmake`, which implies (?) that I have everything in `homebrew-macos-standard` already. \n\nNote that tox installs its own copy of homebrew, independent of the one in /usr/local.\n\n> (The comment in `tox.ini` says \"Install all known system packages equivalent to standard packages that have spkg-configure.m4\", but it must actually require both an spkg-configure.m4 and distros/homebrew.txt, right?)\n\nRight, with this clarification it describes correctly the behavior for the `docker-....` environments. For `local-homebrew`, however, the implementation cheats a little bit (fixing this is one of the tasks of #29146). See line 323 of `tox.ini` to see how the system package list is determined:\n\n```\n    homebrew-standard:   bash -c 'PACKAGES=`sed \"s/#.*//;\" build/pkgs/*/distros/homebrew.txt`; {env:HOMEBREW}/bin/brew install $PACKAGES; {env:HOMEBREW}/bin/brew upgrade $PACKAGES'\n```\nSo it really just installs every package listed in any `homebrew.txt`",
    "created_at": "2020-04-29T21:10:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465851",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jhpalmieri](#comment:22):
> I'll try `tox -e local-homebrew-macos-standard -- ptest`. In my current setup (in which I don't see any failures), the hints at the end of running `./configure` only suggest installing `cmake`, which implies (?) that I have everything in `homebrew-macos-standard` already. 

Note that tox installs its own copy of homebrew, independent of the one in /usr/local.

> (The comment in `tox.ini` says "Install all known system packages equivalent to standard packages that have spkg-configure.m4", but it must actually require both an spkg-configure.m4 and distros/homebrew.txt, right?)

Right, with this clarification it describes correctly the behavior for the `docker-....` environments. For `local-homebrew`, however, the implementation cheats a little bit (fixing this is one of the tasks of #29146). See line 323 of `tox.ini` to see how the system package list is determined:

```
    homebrew-standard:   bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/homebrew.txt`; {env:HOMEBREW}/bin/brew install $PACKAGES; {env:HOMEBREW}/bin/brew upgrade $PACKAGES'
```
So it really just installs every package listed in any `homebrew.txt`



---

archive/issue_comments_465852.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@kiwifb](#comment:21):\n> Looks like failures in the pexpect interface to singular if I read those logs correctly and I haven't missed anything. This make `readline` the number one suspect amongst `singular`'s dependencies (`ntl`, `gmp`, `cddlib`, `flint`).\n\nThanks, yes, that should be the top suspect!",
    "created_at": "2020-04-29T21:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465852",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@kiwifb](#comment:21):
> Looks like failures in the pexpect interface to singular if I read those logs correctly and I haven't missed anything. This make `readline` the number one suspect amongst `singular`'s dependencies (`ntl`, `gmp`, `cddlib`, `flint`).

Thanks, yes, that should be the top suspect!



---

archive/issue_comments_465853.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jhpalmieri](#comment:22):\n> In my current setup (in which I don't see any failures), the hints at the end of running `./configure` only suggest installing `cmake`, which implies (?) that I have everything in `homebrew-macos-standard` already. \n\nYes, I think so",
    "created_at": "2020-04-29T21:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465853",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jhpalmieri](#comment:22):
> In my current setup (in which I don't see any failures), the hints at the end of running `./configure` only suggest installing `cmake`, which implies (?) that I have everything in `homebrew-macos-standard` already. 

Yes, I think so



---

archive/issue_comments_465854.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@mkoeppe](#comment:19):\n> The error can be reproduced in the standard homebrew environment set up by `tox -e local-homebrew-macos-standard -- ptest`.\n\nThe error also shows in `local-homebrew-macos-python2-standard`.\n\nOn the other hand: `local-homebrew-macos-python3_pythonorg-minimal` (https://github.com/mkoeppe/sage/runs/628776310) and  `local-homebrew-macos-python2-minimal` are clean.",
    "created_at": "2020-04-29T23:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465854",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@mkoeppe](#comment:19):
> The error can be reproduced in the standard homebrew environment set up by `tox -e local-homebrew-macos-standard -- ptest`.

The error also shows in `local-homebrew-macos-python2-standard`.

On the other hand: `local-homebrew-macos-python3_pythonorg-minimal` (https://github.com/mkoeppe/sage/runs/628776310) and  `local-homebrew-macos-python2-minimal` are clean.



---

archive/issue_comments_465855.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@mkoeppe](#comment:19):\n> I am now trying with ` EXTRA_CONFIGURE_ARGS=\"--with-mp=mpir\" tox -e local-homebrew-macos-standard -- ptest` to disable use of homebrew's GMP.\n\nThis build does not have the failure",
    "created_at": "2020-04-30T00:31:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465855",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@mkoeppe](#comment:19):
> I am now trying with ` EXTRA_CONFIGURE_ARGS="--with-mp=mpir" tox -e local-homebrew-macos-standard -- ptest` to disable use of homebrew's GMP.

This build does not have the failure



---

archive/issue_comments_465856.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n`EXTRA_CONFIGURE_ARGS=\"--without-system-readline\" tox -e local-homebrew-macos-standard -- ptest` has the failure",
    "created_at": "2020-04-30T04:26:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465856",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

`EXTRA_CONFIGURE_ARGS="--without-system-readline" tox -e local-homebrew-macos-standard -- ptest` has the failure



---

archive/issue_comments_465857.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nHum, I guess that could have predicted on the fact that only singular displayed the failure. Still, there is something fishy happening in `sage/interface/singular.py`. Incidentally, after scanning the singular libraries, it appears that `mpfr` is a direct dependency of `singular` - not just through `flint`. I certainly need to update the dependency list in Gentoo.",
    "created_at": "2020-04-30T04:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465857",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:29" align="right">comment:29</div>

Hum, I guess that could have predicted on the fact that only singular displayed the failure. Still, there is something fishy happening in `sage/interface/singular.py`. Incidentally, after scanning the singular libraries, it appears that `mpfr` is a direct dependency of `singular` - not just through `flint`. I certainly need to update the dependency list in Gentoo.



---

archive/issue_comments_465858.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI'm testing `EXTRA_CONFIGURE_ARGS=\"--without-system-mpfr\" tox -e local-homebrew-macos-standard -- ptest` at the moment",
    "created_at": "2020-04-30T04:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465858",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

I'm testing `EXTRA_CONFIGURE_ARGS="--without-system-mpfr" tox -e local-homebrew-macos-standard -- ptest` at the moment



---

archive/issue_comments_465859.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@mkoeppe](#comment:30):\n> I'm testing `EXTRA_CONFIGURE_ARGS=\"--without-system-mpfr\" tox -e local-homebrew-macos-standard -- ptest` at the moment\n\n... which has the failure.",
    "created_at": "2020-04-30T06:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465859",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@mkoeppe](#comment:30):
> I'm testing `EXTRA_CONFIGURE_ARGS="--without-system-mpfr" tox -e local-homebrew-macos-standard -- ptest` at the moment

... which has the failure.



---

archive/issue_comments_465860.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nHere's a self-contained interaction with Singular in the bad build:\n\n```\n$ Singular \n                     SINGULAR                                 /  Development\n A Computer Algebra System for Polynomial Computations       /   version 4.1.1\n                                                           0<\n by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \\   Feb 2018\nFB Mathematik der Universitaet, D-67653 Kaiserslautern        \\\n> ring sage7=0,(x,y),dp;\n> def sage8=9*y^8 - 9*x^2*y^7 - 18*x^3*y^6 - 18*x^5*y^6 +9*x^6*y^4 + 18*x^7*y^5 + 36*x^8*y^4 + 9*x^10*y^4 - 18*x^11*y^2 -9*x^12*y^3 - 18*x^13*y^2 + 9*x^16;\n> def sage9=factorize(sage8);\nSingular : signal 11 (v: 4112):\ncurrent line:>>def sage9=factorize(sage8);<<\nSegment fault/Bus error occurred (r:1588272268)\nplease inform the authors\ntrying to restart...\n```",
    "created_at": "2020-04-30T18:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465860",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Here's a self-contained interaction with Singular in the bad build:

```
$ Singular 
                     SINGULAR                                 /  Development
 A Computer Algebra System for Polynomial Computations       /   version 4.1.1
                                                           0<
 by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \   Feb 2018
FB Mathematik der Universitaet, D-67653 Kaiserslautern        \
> ring sage7=0,(x,y),dp;
> def sage8=9*y^8 - 9*x^2*y^7 - 18*x^3*y^6 - 18*x^5*y^6 +9*x^6*y^4 + 18*x^7*y^5 + 36*x^8*y^4 + 9*x^10*y^4 - 18*x^11*y^2 -9*x^12*y^3 - 18*x^13*y^2 + 9*x^16;
> def sage9=factorize(sage8);
Singular : signal 11 (v: 4112):
current line:>>def sage9=factorize(sage8);<<
Segment fault/Bus error occurred (r:1588272268)
please inform the authors
trying to restart...
```



---

archive/issue_comments_465861.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nSelf-contained command line test:\n\n```\necho \"ring sage7=0,(x,y),dp; factorize(9*y^8 - 9*x^2*y^7 - 18*x^3*y^6 - 18*x^5*y^6 +9*x^6*y^4 + 18*x^7*y^5 + 36*x^8*y^4 + 9*x^10*y^4 - 18*x^11*y^2 -9*x^12*y^3 - 18*x^13*y^2 + 9*x^16); \" | .tox/local-homebrew-macos-standard/local/bin/Singular | fgrep -q '[2]:'\n```",
    "created_at": "2020-04-30T19:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465861",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

Self-contained command line test:

```
echo "ring sage7=0,(x,y),dp; factorize(9*y^8 - 9*x^2*y^7 - 18*x^3*y^6 - 18*x^5*y^6 +9*x^6*y^4 + 18*x^7*y^5 + 36*x^8*y^4 + 9*x^10*y^4 - 18*x^11*y^2 -9*x^12*y^3 - 18*x^13*y^2 + 9*x^16); " | .tox/local-homebrew-macos-standard/local/bin/Singular | fgrep -q '[2]:'
```



---

archive/issue_comments_465862.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI can't even get Sage to build with `tox -e local-homebrew-macos-standard -- ptest` with this branch or without: the Sage library fails with\n\n```\nIn file included from build/cythonized/sage/tests/stl_vector.cpp:663:\n./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found\n#include <NTL/ZZ.h>\n```\nSage builds fine and passes tests (except for those at #29493) with `make ptestlong`.",
    "created_at": "2020-04-30T20:30:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465862",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

I can't even get Sage to build with `tox -e local-homebrew-macos-standard -- ptest` with this branch or without: the Sage library fails with

```
In file included from build/cythonized/sage/tests/stl_vector.cpp:663:
./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found
#include <NTL/ZZ.h>
```
Sage builds fine and passes tests (except for those at #29493) with `make ptestlong`.



---

archive/issue_comments_465863.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nCould you attach a log of the tox run?",
    "created_at": "2020-04-30T21:03:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465863",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

Could you attach a log of the tox run?



---

archive/issue_comments_465864.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI also see a testsuite segfault for FLINT\n\n```\n  [flint-2.5.2.p5]   make[3]: *** [../build/nmod_poly_mat/test/t-concat_vertical_RUN] Segmentation fault: 11\n```",
    "created_at": "2020-04-30T21:12:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465864",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

I also see a testsuite segfault for FLINT

```
  [flint-2.5.2.p5]   make[3]: *** [../build/nmod_poly_mat/test/t-concat_vertical_RUN] Segmentation fault: 11
```



---

archive/issue_comments_465865.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@jhpalmieri](#comment:35):\n> I can't even get Sage to build with `tox -e local-homebrew-macos-standard -- ptest` with this branch or without: the Sage library fails with\n> \n> ```\n> In file included from build/cythonized/sage/tests/stl_vector.cpp:663:\n> ./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found\n> #include <NTL/ZZ.h>\n> ```\n> Sage builds fine and passes tests (except for those at #29493) with `make ptestlong`.\n\nDo you happen to have NTL from homebrew installed in `/usr/local` (`brew info ntl`)?",
    "created_at": "2020-04-30T22:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465865",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@jhpalmieri](#comment:35):
> I can't even get Sage to build with `tox -e local-homebrew-macos-standard -- ptest` with this branch or without: the Sage library fails with
> 
> ```
> In file included from build/cythonized/sage/tests/stl_vector.cpp:663:
> ./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found
> #include <NTL/ZZ.h>
> ```
> Sage builds fine and passes tests (except for those at #29493) with `make ptestlong`.

Do you happen to have NTL from homebrew installed in `/usr/local` (`brew info ntl`)?



---

archive/issue_comments_465866.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@mkoeppe](#comment:38):\n> Replying to [@jhpalmieri](#comment:35):\n> > I can't even get Sage to build with `tox -e local-homebrew-macos-standard -- ptest` with this branch or without: the Sage library fails with\n> > \n> > ```\n> > In file included from build/cythonized/sage/tests/stl_vector.cpp:663:\n> > ./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found\n> > #include <NTL/ZZ.h>\n> > ```\n> > Sage builds fine and passes tests (except for those at #29493) with `make ptestlong`.\n\n> \n> Do you happen to have NTL from homebrew installed in `/usr/local` (`brew info ntl`)?\n\nYes, I do.\n\n> Could you attach a log of the tox run? \n\nWhich file do you want? One of the ones in `logs`?\n\n```\n-rw-r--r--    1 palmieri  staff  275651 Apr 30 12:17 config.log\n-rw-r--r--    1 palmieri  staff  103409 Apr 30 13:17 install.log\n-rw-r--r--    1 palmieri  staff     914 Apr 30 10:26 local-homebrew-macos-standard-0.log\n-rw-r--r--    1 palmieri  staff     268 Apr 30 10:26 local-homebrew-macos-standard-1.log\ndrwxr-xr-x  153 palmieri  staff    4896 Apr 30 13:08 pkgs\n```\nOr should I just uninstall homebrew's ntl?",
    "created_at": "2020-04-30T22:31:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465866",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@mkoeppe](#comment:38):
> Replying to [@jhpalmieri](#comment:35):
> > I can't even get Sage to build with `tox -e local-homebrew-macos-standard -- ptest` with this branch or without: the Sage library fails with
> > 
> > ```
> > In file included from build/cythonized/sage/tests/stl_vector.cpp:663:
> > ./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found
> > #include <NTL/ZZ.h>
> > ```
> > Sage builds fine and passes tests (except for those at #29493) with `make ptestlong`.

> 
> Do you happen to have NTL from homebrew installed in `/usr/local` (`brew info ntl`)?

Yes, I do.

> Could you attach a log of the tox run? 

Which file do you want? One of the ones in `logs`?

```
-rw-r--r--    1 palmieri  staff  275651 Apr 30 12:17 config.log
-rw-r--r--    1 palmieri  staff  103409 Apr 30 13:17 install.log
-rw-r--r--    1 palmieri  staff     914 Apr 30 10:26 local-homebrew-macos-standard-0.log
-rw-r--r--    1 palmieri  staff     268 Apr 30 10:26 local-homebrew-macos-standard-1.log
drwxr-xr-x  153 palmieri  staff    4896 Apr 30 13:08 pkgs
```
Or should I just uninstall homebrew's ntl?



---

archive/issue_comments_465867.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nJust the terminal output if you still have it, otherwise `install.log` please",
    "created_at": "2020-04-30T22:37:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465867",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

Just the terminal output if you still have it, otherwise `install.log` please



---

archive/issue_comments_465868.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThere is a problem with `/usr/local` interaction. FLINT's configure script is severely broken (that's not exactly news, but...): it puts `/usr/local/include/` in as explicit defaults and stuff there can override what we have in $SAGE_LOCAL.",
    "created_at": "2020-04-30T22:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465868",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

There is a problem with `/usr/local` interaction. FLINT's configure script is severely broken (that's not exactly news, but...): it puts `/usr/local/include/` in as explicit defaults and stuff there can override what we have in $SAGE_LOCAL.



---

archive/issue_comments_465869.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nFor flint, adding `--with-gmp=$SAGE_LOCAL` is fine even if gmp is not there and is found from the system.",
    "created_at": "2020-04-30T22:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465869",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:42" align="right">comment:42</div>

For flint, adding `--with-gmp=$SAGE_LOCAL` is fine even if gmp is not there and is found from the system.



---

archive/issue_comments_465870.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nAttachment: **[tox.log](https://github.com/sagemath/sage/files/ticket29607/tox.log)**\n\nI cut-and-pasted this from the terminal window.",
    "created_at": "2020-04-30T22:51:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465870",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:43" align="right">comment:43</div>

Attachment: **[tox.log](https://github.com/sagemath/sage/files/ticket29607/tox.log)**

I cut-and-pasted this from the terminal window.



---

archive/issue_comments_465871.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@isuruf](#comment:42):\n> For flint, adding `--with-gmp=$SAGE_LOCAL` is fine even if gmp is not there and is found from the system.\n\nYes, this is the fix that I am using now",
    "created_at": "2020-04-30T22:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465871",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@isuruf](#comment:42):
> For flint, adding `--with-gmp=$SAGE_LOCAL` is fine even if gmp is not there and is found from the system.

Yes, this is the fix that I am using now



---

archive/issue_comments_465872.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@jhpalmieri](#comment:39):\n> Replying to [@mkoeppe](#comment:38):\n> > Replying to [@jhpalmieri](#comment:35):\n> > > I can't even get Sage to build with `tox -e local-homebrew-macos-standard -- ptest` with this branch or without: the Sage library fails with\n> > > \n> > > ```\n> > > In file included from build/cythonized/sage/tests/stl_vector.cpp:663:\n> > > ./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found\n> > > #include <NTL/ZZ.h>\n> > > ```\n> > > Sage builds fine and passes tests (except for those at #29493) with `make ptestlong`.\n\n> > \n> > Do you happen to have NTL from homebrew installed in `/usr/local` (`brew info ntl`)?\n\nFrom your log:\n\n```\n[sagelib-9.1.rc2]   g++ -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/local/lib build/temp.macosx-10.15-x86_64-3.7/build/cythonized/sage/symbolic/substitution_map.o -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/homebrew/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/homebrew/opt/openssl@1.1/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/homebrew/opt/sqlite/lib -lgmp -lpynac -lstdc++ -o build/lib.macosx-10.15-x86_64-3.7/sage/symbolic/substitution_map.cpython-37m-darwin.so\n2400\t  [sagelib-9.1.rc2]   In file included from build/cythonized/sage/tests/stl_vector.cpp:663:\n2401\t  [sagelib-9.1.rc2]   ./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found\n2402\t  [sagelib-9.1.rc2]   #include <NTL/ZZ.h>\n2403\t  [sagelib-9.1.rc2]            ^~~~~~~~~~\n```\n\nThis is an interesting variant of the failure mode of #29000, #29448 - where `./configure` finds a library but then the package needing it does not. In this case, Homebrew's NTL in `/usr/local` is found by `./configure`. But we compile Python modules using ` g++ -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk`, where the `-isysroot` disables the use of `/usr/local`.",
    "created_at": "2020-04-30T23:18:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465872",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@jhpalmieri](#comment:39):
> Replying to [@mkoeppe](#comment:38):
> > Replying to [@jhpalmieri](#comment:35):
> > > I can't even get Sage to build with `tox -e local-homebrew-macos-standard -- ptest` with this branch or without: the Sage library fails with
> > > 
> > > ```
> > > In file included from build/cythonized/sage/tests/stl_vector.cpp:663:
> > > ./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found
> > > #include <NTL/ZZ.h>
> > > ```
> > > Sage builds fine and passes tests (except for those at #29493) with `make ptestlong`.

> > 
> > Do you happen to have NTL from homebrew installed in `/usr/local` (`brew info ntl`)?

From your log:

```
[sagelib-9.1.rc2]   g++ -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/local/lib build/temp.macosx-10.15-x86_64-3.7/build/cythonized/sage/symbolic/substitution_map.o -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/homebrew/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/homebrew/opt/openssl@1.1/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/tox/sage-9.1.rc2/.tox/local-homebrew-macos-standard/homebrew/opt/sqlite/lib -lgmp -lpynac -lstdc++ -o build/lib.macosx-10.15-x86_64-3.7/sage/symbolic/substitution_map.cpython-37m-darwin.so
2400	  [sagelib-9.1.rc2]   In file included from build/cythonized/sage/tests/stl_vector.cpp:663:
2401	  [sagelib-9.1.rc2]   ./sage/libs/ntl/ntlwrap.h:5:10: fatal error: 'NTL/ZZ.h' file not found
2402	  [sagelib-9.1.rc2]   #include <NTL/ZZ.h>
2403	  [sagelib-9.1.rc2]            ^~~~~~~~~~
```

This is an interesting variant of the failure mode of #29000, #29448 - where `./configure` finds a library but then the package needing it does not. In this case, Homebrew's NTL in `/usr/local` is found by `./configure`. But we compile Python modules using ` g++ -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk`, where the `-isysroot` disables the use of `/usr/local`.



---

archive/issue_comments_465873.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b5d19e49595a748d4fa8f34c8d5d14885924802\"><code>0b5d19e</code></a></td><td><code>build/pkgs/flint/spkg-install.in: Always pass --with-{gmp,mpfr,ntl}=$SAGE_LOCAL to get rid of /usr/local</code></td></tr></table>\n",
    "created_at": "2020-04-30T23:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465873",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b5d19e49595a748d4fa8f34c8d5d14885924802"><code>0b5d19e</code></a></td><td><code>build/pkgs/flint/spkg-install.in: Always pass --with-{gmp,mpfr,ntl}=$SAGE_LOCAL to get rid of /usr/local</code></td></tr></table>




---

archive/issue_comments_465874.json:
```json
{
    "body": "Changed commit from **[`f593e66`](https://github.com/sagemath/sagetrac-mirror/commit/f593e6657376e143647331ed4e73c555578b9884)** to **[`0b5d19e`](https://github.com/sagemath/sagetrac-mirror/commit/0b5d19e49595a748d4fa8f34c8d5d14885924802)**",
    "created_at": "2020-04-30T23:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465874",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f593e66`](https://github.com/sagemath/sagetrac-mirror/commit/f593e6657376e143647331ed4e73c555578b9884)** to **[`0b5d19e`](https://github.com/sagemath/sagetrac-mirror/commit/0b5d19e49595a748d4fa8f34c8d5d14885924802)**



---

archive/issue_comments_465875.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@mkoeppe](#comment:44):\n> Replying to [@isuruf](#comment:42):\n> > For flint, adding `--with-gmp=$SAGE_LOCAL` is fine even if gmp is not there and is found from the system.\n\n> Yes, this is the fix that I am using now\n\n... in the commit above.\n\nProbably the `spkg-install` of other packages with the same build system as FLINT need to be changed in the same way.",
    "created_at": "2020-04-30T23:23:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465875",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@mkoeppe](#comment:44):
> Replying to [@isuruf](#comment:42):
> > For flint, adding `--with-gmp=$SAGE_LOCAL` is fine even if gmp is not there and is found from the system.

> Yes, this is the fix that I am using now

... in the commit above.

Probably the `spkg-install` of other packages with the same build system as FLINT need to be changed in the same way.



---

archive/issue_comments_465876.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n ```\n \n \n-#29562 also broke `singular` on `homebrew`, leading to doctest errors and segfaults such as this one:\n+#29562 also broke `flint`/`singular` on `homebrew` when conflicting versions of libraries are in `/usr/local`, leading to doctest errors and segfaults such as this one:\n \n ```\n File \"src/sage/combinat/posets/posets.py\", line 3816, in sage.combinat.posets.posets.FinitePoset.coxeter_smith_form\n``````\n",
    "created_at": "2020-04-30T23:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465876",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 ```
 
 
-#29562 also broke `singular` on `homebrew`, leading to doctest errors and segfaults such as this one:
+#29562 also broke `flint`/`singular` on `homebrew` when conflicting versions of libraries are in `/usr/local`, leading to doctest errors and segfaults such as this one:
 
 ```
 File "src/sage/combinat/posets/posets.py", line 3816, in sage.combinat.posets.posets.FinitePoset.coxeter_smith_form
``````




---

archive/issue_comments_465877.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcfbc100625b2888ccca539e2f19304a9c2b6776\"><code>fcfbc10</code></a></td><td><code>build/pkgs/arb/spkg-install.in: Always pass --with-{gmp,mpfr,flint} to get rid of /usr/local</code></td></tr></table>\n",
    "created_at": "2020-05-01T00:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465877",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcfbc100625b2888ccca539e2f19304a9c2b6776"><code>fcfbc10</code></a></td><td><code>build/pkgs/arb/spkg-install.in: Always pass --with-{gmp,mpfr,flint} to get rid of /usr/local</code></td></tr></table>




---

archive/issue_comments_465878.json:
```json
{
    "body": "Changed commit from **[`0b5d19e`](https://github.com/sagemath/sagetrac-mirror/commit/0b5d19e49595a748d4fa8f34c8d5d14885924802)** to **[`fcfbc10`](https://github.com/sagemath/sagetrac-mirror/commit/fcfbc100625b2888ccca539e2f19304a9c2b6776)**",
    "created_at": "2020-05-01T00:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465878",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b5d19e`](https://github.com/sagemath/sagetrac-mirror/commit/0b5d19e49595a748d4fa8f34c8d5d14885924802)** to **[`fcfbc10`](https://github.com/sagemath/sagetrac-mirror/commit/fcfbc100625b2888ccca539e2f19304a9c2b6776)**



---

archive/issue_events_404212.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T00:14:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404212"
}
```



---

archive/issue_events_404213.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T00:14:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404213"
}
```



---

archive/issue_events_404214.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T00:15:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "title_is": "homebrew-standard: Fix several problems with library search paths",
    "title_was": "homebrew-standard: Fix segfaults with singular (src/bin/sage-env: Add to the front of CPATH, LIBRARY_PATH; .homebrew-build-env: Do not add current dir)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404214"
}
```



---

archive/issue_comments_465879.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nhow is this going to work on systems where /usr/local (or suchlike, e.g these keg-only installs on Homebrew) needs to be spelled out for a library  location to be useful?\n\nWould this break FreeBSD? Thierry, care to test this branch?",
    "created_at": "2020-05-01T08:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465879",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">comment:52</div>

how is this going to work on systems where /usr/local (or suchlike, e.g these keg-only installs on Homebrew) needs to be spelled out for a library  location to be useful?

Would this break FreeBSD? Thierry, care to test this branch?



---

archive/issue_comments_465880.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nAs you know, `/usr/local` is part of the normal library and include search path of the compiler. It does not need a `-I` or `-L` option.",
    "created_at": "2020-05-01T15:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465880",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:53" align="right">comment:53</div>

As you know, `/usr/local` is part of the normal library and include search path of the compiler. It does not need a `-I` or `-L` option.



---

archive/issue_comments_465881.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nStandard configure scripts do not deal with `/usr/local` specifically at all but only check what the compiler/linker is able to find.\nThe changes to the spkg-configure scripts for FLINT and arb only work around nonstandard behavior of their configure scripts.",
    "created_at": "2020-05-01T15:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465881",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

Standard configure scripts do not deal with `/usr/local` specifically at all but only check what the compiler/linker is able to find.
The changes to the spkg-configure scripts for FLINT and arb only work around nonstandard behavior of their configure scripts.



---

archive/issue_comments_465882.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@mkoeppe](#comment:53):\n> As you know, `/usr/local` is part of the normal library and include search path of the compiler. It does not need a `-I` or `-L` option.\n\nthis is not the case on FreeBSD.\nhttps://forums.freebsd.org/threads/clang-cant-find-headers-in-usr-local-include.74032/",
    "created_at": "2020-05-01T16:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465882",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@mkoeppe](#comment:53):
> As you know, `/usr/local` is part of the normal library and include search path of the compiler. It does not need a `-I` or `-L` option.

this is not the case on FreeBSD.
https://forums.freebsd.org/threads/clang-cant-find-headers-in-usr-local-include.74032/



---

archive/issue_comments_465883.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nnow, as I recalled this, I am sure that this branch breaks building Sage on FreeBSD.",
    "created_at": "2020-05-01T16:16:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465883",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:56" align="right">comment:56</div>

now, as I recalled this, I am sure that this branch breaks building Sage on FreeBSD.



---

archive/issue_comments_465884.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nDo other packages' configure scripts look for stuff in /usr/local on FreeBSD even though the compiler does not?",
    "created_at": "2020-05-01T16:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465884",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">comment:57</div>

Do other packages' configure scripts look for stuff in /usr/local on FreeBSD even though the compiler does not?



---

archive/issue_comments_465885.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nOn FreeBSD, if you do not use the ports mechanism, you are right, /usr/local is not in the default search paths for include and libs, but when you create (or modify) a port (I'm in this context), you just have to define:\n\n```\nUSES=localbase\n```\n\nto solve this common problem.",
    "created_at": "2020-05-01T16:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465885",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<div id="comment:58" align="right">comment:58</div>

On FreeBSD, if you do not use the ports mechanism, you are right, /usr/local is not in the default search paths for include and libs, but when you create (or modify) a port (I'm in this context), you just have to define:

```
USES=localbase
```

to solve this common problem.



---

archive/issue_comments_465886.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nNow that we know what we need to know about FreeBSD, can we come back to the review of this ticket?",
    "created_at": "2020-05-01T17:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465886",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

Now that we know what we need to know about FreeBSD, can we come back to the review of this ticket?



---

archive/issue_comments_465887.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nI think it's rather #29562 that needs to be done differently. \nI don't understand that `/usr/local` being \"always wrong\".\nWhat if I install GMP there and want to build Sage using it?\n\n\nActually, one just needs to use proper Homebrew formulae for arb and flint, as I experimented on\nhttps://github.com/sagemath/homebrew-science \n(and push the needed changes upstream)",
    "created_at": "2020-05-01T17:58:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465887",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:60" align="right">comment:60</div>

I think it's rather #29562 that needs to be done differently. 
I don't understand that `/usr/local` being "always wrong".
What if I install GMP there and want to build Sage using it?


Actually, one just needs to use proper Homebrew formulae for arb and flint, as I experimented on
https://github.com/sagemath/homebrew-science 
(and push the needed changes upstream)



---

archive/issue_comments_465888.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@dimpase](#comment:60):\n> I think it's rather #29562 that needs to be done differently. \n\nThe present ticket *is* changing what #29562 did.\n\n> I don't understand that `/usr/local` being \"always wrong\".\n\nLook at the configure scripts of FLINT and arb. They are putting `/usr/local` explicitly in the compiler and linker lines as -I and -L flags. This overrides correct paths that are configured by the user's CPATH and -I options etc.\n\n> What if I install GMP there and want to build Sage using it?\n\nYes, this still works. We do this on homebrew all the time.",
    "created_at": "2020-05-01T18:34:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465888",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@dimpase](#comment:60):
> I think it's rather #29562 that needs to be done differently. 

The present ticket *is* changing what #29562 did.

> I don't understand that `/usr/local` being "always wrong".

Look at the configure scripts of FLINT and arb. They are putting `/usr/local` explicitly in the compiler and linker lines as -I and -L flags. This overrides correct paths that are configured by the user's CPATH and -I options etc.

> What if I install GMP there and want to build Sage using it?

Yes, this still works. We do this on homebrew all the time.



---

archive/issue_comments_465889.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nHow about we just patch these configure scripts to remove `-I /usr/local` etc?",
    "created_at": "2020-05-01T18:46:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465889",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:62" align="right">comment:62</div>

How about we just patch these configure scripts to remove `-I /usr/local` etc?



---

archive/issue_comments_465890.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nHow is this better than just providing the options that work?",
    "created_at": "2020-05-01T18:59:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465890",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:63" align="right">comment:63</div>

How is this better than just providing the options that work?



---

archive/issue_comments_465891.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nOf course, an upstreamable patch for FLINT and arb would be good. Upstream indicates in https://github.com/wbhart/flint2/issues/400 that  2.6.0 (from FLINT trunk) is \"nearly out\" (as of 3 weeks ago). But I don't want to work on patches to a broken ad-hoc configure script at this point. FLINT trunk also has a CMake build system (not the default), so there is hope.",
    "created_at": "2020-05-01T19:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465891",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:64" align="right">comment:64</div>

Of course, an upstreamable patch for FLINT and arb would be good. Upstream indicates in https://github.com/wbhart/flint2/issues/400 that  2.6.0 (from FLINT trunk) is "nearly out" (as of 3 weeks ago). But I don't want to work on patches to a broken ad-hoc configure script at this point. FLINT trunk also has a CMake build system (not the default), so there is hope.



---

archive/issue_comments_465892.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nI looked at arb's [./configure script](https://github.com/fredrik-johansson/arb/blob/master/configure), and don't see where they unconditionally put /usr/local anywhere.\n\nAre you sure it's not coming from somewhere else, e.g. some Homebrew flags set?",
    "created_at": "2020-05-02T06:25:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465892",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:65" align="right">comment:65</div>

I looked at arb's [./configure script](https://github.com/fredrik-johansson/arb/blob/master/configure), and don't see where they unconditionally put /usr/local anywhere.

Are you sure it's not coming from somewhere else, e.g. some Homebrew flags set?



---

archive/issue_comments_465893.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@dimpase](#comment:65):\n> I looked at arb's [./configure script](https://github.com/fredrik-johansson/arb/blob/master/configure), and don't see where they unconditionally put /usr/local anywhere.\n\nNo, not \"unconditionally\", which is exactly why this ticket is able to fix it by providing options to that configure script.\n\nFrom the diff:\n\n```\n+# Trac #29607: We must always supply --with-gmp, --with-mpfr,\n+# --with-flint because otherwise ARB's configure script uses\n+# /usr/local, which is always wrong.\n+# This is why we do not use $SAGE_CONFIGURE_GMP etc. here.\n+# The value $SAGE_LOCAL is always a safe choice even if the library\n+# is coming from the system and is found using what is in\n+# LIBRARY_PATH or LDFLAGS etc.\n```",
    "created_at": "2020-05-02T10:31:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465893",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@dimpase](#comment:65):
> I looked at arb's [./configure script](https://github.com/fredrik-johansson/arb/blob/master/configure), and don't see where they unconditionally put /usr/local anywhere.

No, not "unconditionally", which is exactly why this ticket is able to fix it by providing options to that configure script.

From the diff:

```
+# Trac #29607: We must always supply --with-gmp, --with-mpfr,
+# --with-flint because otherwise ARB's configure script uses
+# /usr/local, which is always wrong.
+# This is why we do not use $SAGE_CONFIGURE_GMP etc. here.
+# The value $SAGE_LOCAL is always a safe choice even if the library
+# is coming from the system and is found using what is in
+# LIBRARY_PATH or LDFLAGS etc.
```



---

archive/issue_comments_465894.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nWhat else can I explain to facilitate review?",
    "created_at": "2020-05-02T17:15:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465894",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">comment:67</div>

What else can I explain to facilitate review?



---

archive/issue_comments_465895.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nHow can you be sure that SAGE_LOCAL/include/ and SAGE_LOCAL/lib/ exist when arb is built?\n(If one of them does not exist then it will error out).",
    "created_at": "2020-05-02T17:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465895",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:68" align="right">comment:68</div>

How can you be sure that SAGE_LOCAL/include/ and SAGE_LOCAL/lib/ exist when arb is built?
(If one of them does not exist then it will error out).



---

archive/issue_comments_465896.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nSage's config.status creates them.\n\nAnd I have tested this ticket.",
    "created_at": "2020-05-02T17:30:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465896",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">comment:69</div>

Sage's config.status creates them.

And I have tested this ticket.



---

archive/issue_comments_465897.json:
```json
{
    "body": "Changed reviewer from **John Palmieri** to **John Palmieri, Dima Pasechnik**",
    "created_at": "2020-05-02T18:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465897",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **John Palmieri** to **John Palmieri, Dima Pasechnik**



---

archive/issue_comments_465898.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nOK, fine, sorry for sitting on it for too long.",
    "created_at": "2020-05-02T18:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465898",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:70" align="right">comment:70</div>

OK, fine, sorry for sitting on it for too long.



---

archive/issue_events_404215.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-02T18:03:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404215"
}
```



---

archive/issue_events_404216.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-05-02T18:03:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404216"
}
```



---

archive/issue_comments_465899.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nThank you!",
    "created_at": "2020-05-02T18:06:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465899",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Thank you!



---

archive/issue_comments_465900.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/another_fixup_for__homebrew_build_env_setting_cpath__library_path](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/another_fixup_for__homebrew_build_env_setting_cpath__library_path)** to **[`fcfbc10`](https://github.com/sagemath/sagetrac-mirror/commit/fcfbc100625b2888ccca539e2f19304a9c2b6776)**",
    "created_at": "2020-05-04T06:41:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29607#issuecomment-465900",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/another_fixup_for__homebrew_build_env_setting_cpath__library_path](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/another_fixup_for__homebrew_build_env_setting_cpath__library_path)** to **[`fcfbc10`](https://github.com/sagemath/sagetrac-mirror/commit/fcfbc100625b2888ccca539e2f19304a9c2b6776)**



---

archive/issue_events_404217.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-04T06:41:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404217"
}
```



---

archive/issue_events_404218.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "903edac714077103e728efd90854386209d7d1aa",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-05-04T06:41:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29607",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29607#event-404218"
}
```
