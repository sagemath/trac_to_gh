# Issue 29013: Add configure option --with-sage-venv=SAGE_VENV to create venv there instead of in SAGE_LOCAL

archive/issues_028776.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\n#27824 made `$SAGE_LOCAL` a venv if a suitable system python3 is found.\n\nIn this ticket, we add support for installing builds of Sage with several python versions, sharing the non-Python packages in `SAGE_LOCAL`:\n- keeping install records for Python packages (recognized by having `install-requires.txt` or `requirements.txt`) in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages (`$SAGE_LOCAL/var/lib/sage/{installed,scripts}`)\n- likewise for `$SAGE_LOCAL/var/tmp/sage/build`\n- here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.\n\nConfiguration:\n- This is activated by running, for example, \n`./configure --with-python=/usr/bin/python3.8 --with-sage-venv=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n\n\nAs of this ticket, we are able to establish the venv in an arbitrary configured directory instead of `SAGE_LOCAL`. This is already useful for #31396 to create a wheel-building venv that will not be packaged as part of `SAGE_LOCAL`.\n\nIn follow-up tickets, we gain the full functionality that facilitates testing with several Python versions without having to rebuild the Sage distribution.  This depends on:\n\n- #30534 Repackage `pynac` as a pip-installable package\n\nFollow-ups:\n\n- We also want to support `./configure --with-sage-venv=no` which would suppress making any venv (#30896)\n\n- Support the tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created... or should python3 be installed in `$SAGE_VENV`?)\n\n- Optional: A file `build/pkgs/SPKG/trees` could override the install tree determination - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...\n\n\nCC:  @dimpase @jdemeyer @embray @vbraun @jhpalmieri\n\nComponent: **build**\n\nKeywords: **sd111**\n\nAuthor: **Matthias Koeppe**\n\nBranch/Commit: **[`d68e861`](https://github.com/sagemath/sagetrac-mirror/commit/d68e86144b4a37600654899d2ab655ae55fb4378)**\n\nReviewer: **John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29013_\n\n",
    "closed_at": "2021-05-27T20:30:21Z",
    "created_at": "2020-01-14T22:26:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add configure option --with-sage-venv=SAGE_VENV to create venv there instead of in SAGE_LOCAL",
    "type": "issue",
    "updated_at": "2021-05-27T20:30:21Z",
    "url": "https://github.com/sagemath/sage/issues/29013",
    "user": "https://github.com/mkoeppe"
}
```
<div id="comment:0"></div>

#27824 made `$SAGE_LOCAL` a venv if a suitable system python3 is found.

In this ticket, we add support for installing builds of Sage with several python versions, sharing the non-Python packages in `SAGE_LOCAL`:
- keeping install records for Python packages (recognized by having `install-requires.txt` or `requirements.txt`) in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages (`$SAGE_LOCAL/var/lib/sage/{installed,scripts}`)
- likewise for `$SAGE_LOCAL/var/tmp/sage/build`
- here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.

Configuration:
- This is activated by running, for example, 
`./configure --with-python=/usr/bin/python3.8 --with-sage-venv="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.


As of this ticket, we are able to establish the venv in an arbitrary configured directory instead of `SAGE_LOCAL`. This is already useful for #31396 to create a wheel-building venv that will not be packaged as part of `SAGE_LOCAL`.

In follow-up tickets, we gain the full functionality that facilitates testing with several Python versions without having to rebuild the Sage distribution.  This depends on:

- #30534 Repackage `pynac` as a pip-installable package

Follow-ups:

- We also want to support `./configure --with-sage-venv=no` which would suppress making any venv (#30896)

- Support the tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created... or should python3 be installed in `$SAGE_VENV`?)

- Optional: A file `build/pkgs/SPKG/trees` could override the install tree determination - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...


CC:  @dimpase @jdemeyer @embray @vbraun @jhpalmieri

Component: **build**

Keywords: **sd111**

Author: **Matthias Koeppe**

Branch/Commit: **[`d68e861`](https://github.com/sagemath/sagetrac-mirror/commit/d68e86144b4a37600654899d2ab655ae55fb4378)**

Reviewer: **John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/29013_





---

archive/issue_events_395613.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-14T22:26:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395613"
}
```



---

archive/issue_events_395614.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-14T22:26:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395614"
}
```



---

archive/issue_events_395615.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-14T22:26:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395615"
}
```



---

archive/issue_events_395616.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-14T22:26:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395616"
}
```



---

archive/issue_comments_453123.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-01-15T01:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453123",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_453124.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-We propose to create a venv (https://docs.python.org/3/library/venv.html) at `$SAGE_LOCAL/venv`, \n+We propose to create a venv (https://docs.python.org/3/library/venv.html) at `$SAGE_LOCAL/lib/sage/venv/sage/`, \n to activate the venv in the `sage-env` script, and to install all Python packages (including `sagelib`) into this venv.\n \n This is preparation for #27824, in which the system's python3 will be used when available.\n``````\n",
    "created_at": "2020-01-15T01:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453124",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-We propose to create a venv (https://docs.python.org/3/library/venv.html) at `$SAGE_LOCAL/venv`, 
+We propose to create a venv (https://docs.python.org/3/library/venv.html) at `$SAGE_LOCAL/lib/sage/venv/sage/`, 
 to activate the venv in the `sage-env` script, and to install all Python packages (including `sagelib`) into this venv.
 
 This is preparation for #27824, in which the system's python3 will be used when available.
``````




---

archive/issue_comments_453125.json:
```json
{
    "body": "Branch: **[public/29013-use-py3-venv](https://github.com/sagemath/sagetrac-mirror/tree/public/29013-use-py3-venv)**",
    "created_at": "2020-01-15T01:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453125",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[public/29013-use-py3-venv](https://github.com/sagemath/sagetrac-mirror/tree/public/29013-use-py3-venv)**



---

archive/issue_comments_453126.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nA simple change. Compiles from a fresh checkout and runs without problems on macOS.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1363425d85693dcc183e31e4efce99776fa1eb44\"><code>1363425</code></a></td><td><code>In a python3 build, install all Python packages into a venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9\"><code>a394268</code></a></td><td><code>sage-pip-install: Use PYTHON=sage-python23</code></td></tr></table>\n",
    "created_at": "2020-01-15T01:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453126",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

A simple change. Compiles from a fresh checkout and runs without problems on macOS.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1363425d85693dcc183e31e4efce99776fa1eb44"><code>1363425</code></a></td><td><code>In a python3 build, install all Python packages into a venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9"><code>a394268</code></a></td><td><code>sage-pip-install: Use PYTHON=sage-python23</code></td></tr></table>




---

archive/issue_comments_453127.json:
```json
{
    "body": "Commit: **[`a394268`](https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9)**",
    "created_at": "2020-01-15T01:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453127",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`a394268`](https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9)**



---

archive/issue_events_395617.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T01:55:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395617"
}
```



---

archive/issue_comments_453128.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIn the branch #27824, the venv is created by slightly more complicated code in `build/make/Makefile`. This complexity is not necessary for the present ticket.",
    "created_at": "2020-01-15T04:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453128",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

In the branch #27824, the venv is created by slightly more complicated code in `build/make/Makefile`. This complexity is not necessary for the present ticket.



---

archive/issue_comments_453129.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nDoes this ticket make sense separately, or only as part of #27824 ?",
    "created_at": "2020-01-15T10:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453129",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

Does this ticket make sense separately, or only as part of #27824 ?



---

archive/issue_comments_453130.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n#27824 is the use case that I have in mind.\nThis ticket is a less intrusive change and should go through the betas first.",
    "created_at": "2020-01-15T14:08:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453130",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

#27824 is the use case that I have in mind.
This ticket is a less intrusive change and should go through the betas first.



---

archive/issue_comments_453131.json:
```json
{
    "body": "Dependencies: **#29002**",
    "created_at": "2020-01-15T16:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453131",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29002**



---

archive/issue_comments_453132.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI tried building with this branch on OS X, and I got doctest failures:\n\n```\nsage -t --long src/sage/plot/plot.py  # 1 doctest failed\nsage -t --long src/sage/matrix/matrix2.pyx  # 2 doctests failed\nsage -t --long src/sage/finance/time_series.pyx  # 5 doctests failed\nsage -t --long src/sage/misc/trace.py  # 4 doctests failed\nsage -t --long src/sage/env.py  # 1 doctest failed\nsage -t --long src/sage/repl/configuration.py  # 1 doctest failed\nsage -t --long src/sage/schemes/affine/affine_homset.py  # 1 doctest failed\n```\nFor example\n\n```\nFile \"src/sage/plot/plot.py\", line 521, in sage.plot.plot\nFailed example:\n    os.system(\"sage -c \\\"if 'matplotlib' in sys.modules: sys.exit(1)\\\"\") # long time\nExpected:\n    0\nGot:\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.1.beta0/local/bin/sage-eval\", line 4, in <module>\n        from sage.all import *\n    ModuleNotFoundError: No module named 'sage'\n    256\n```\nand\n\n```\n**********************************************************************\nFile \"src/sage/matrix/matrix2.pyx\", line 1127, in sage.matrix.matrix2.Matrix.pseudoinverse\nFailed example:\n    M.pseudoinverse()  # tol 1e-15\nExpected:\n    [0.0620518477661335 0.0206839492553778 0.0124103695532267]\n    [ 0.124103695532267 0.0413678985107557 0.0248207391064534]\n    [ 0.186155543298400 0.0620518477661335 0.0372311086596801]\nGot:\n    [0.0620518477661334 0.0206839492553778 0.0124103695532267]\n    [ 0.124103695532267 0.0413678985107556 0.0248207391064534]\n    [ 0.186155543298400 0.0620518477661335 0.0372311086596801]\nTolerance exceeded in 2 of 9:\n    0.0620518477661335 vs 0.0620518477661334, tolerance 2e-15 > 1e-15\n    0.0413678985107557 vs 0.0413678985107556, tolerance 3e-15 > 1e-15\n**********************************************************************\nFile \"src/sage/matrix/matrix2.pyx\", line 1131, in sage.matrix.matrix2.Matrix.pseudoinverse\nFailed example:\n    M.pseudoinverse(algorithm=\"numpy\")  # tol 1e-15\nExpected:\n    [0.0620518477661335 0.0206839492553778 0.0124103695532267]\n    [ 0.124103695532267 0.0413678985107557 0.0248207391064534]\n    [ 0.186155543298400 0.0620518477661335 0.0372311086596801]\nGot:\n    [0.0620518477661334 0.0206839492553778 0.0124103695532267]\n    [ 0.124103695532267 0.0413678985107556 0.0248207391064534]\n    [ 0.186155543298400 0.0620518477661335 0.0372311086596801]\nTolerance exceeded in 2 of 9:\n    0.0620518477661335 vs 0.0620518477661334, tolerance 2e-15 > 1e-15\n    0.0413678985107557 vs 0.0413678985107556, tolerance 3e-15 > 1e-15\n**********************************************************************\n1 item had failures:\n   2 of  25 in sage.matrix.matrix2.Matrix.pseudoinverse\n    [2472 tests, 2 failures, 9.06 s]\n```",
    "created_at": "2020-01-15T20:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453132",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

I tried building with this branch on OS X, and I got doctest failures:

```
sage -t --long src/sage/plot/plot.py  # 1 doctest failed
sage -t --long src/sage/matrix/matrix2.pyx  # 2 doctests failed
sage -t --long src/sage/finance/time_series.pyx  # 5 doctests failed
sage -t --long src/sage/misc/trace.py  # 4 doctests failed
sage -t --long src/sage/env.py  # 1 doctest failed
sage -t --long src/sage/repl/configuration.py  # 1 doctest failed
sage -t --long src/sage/schemes/affine/affine_homset.py  # 1 doctest failed
```
For example

```
File "src/sage/plot/plot.py", line 521, in sage.plot.plot
Failed example:
    os.system("sage -c \"if 'matplotlib' in sys.modules: sys.exit(1)\"") # long time
Expected:
    0
Got:
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.1.beta0/local/bin/sage-eval", line 4, in <module>
        from sage.all import *
    ModuleNotFoundError: No module named 'sage'
    256
```
and

```
**********************************************************************
File "src/sage/matrix/matrix2.pyx", line 1127, in sage.matrix.matrix2.Matrix.pseudoinverse
Failed example:
    M.pseudoinverse()  # tol 1e-15
Expected:
    [0.0620518477661335 0.0206839492553778 0.0124103695532267]
    [ 0.124103695532267 0.0413678985107557 0.0248207391064534]
    [ 0.186155543298400 0.0620518477661335 0.0372311086596801]
Got:
    [0.0620518477661334 0.0206839492553778 0.0124103695532267]
    [ 0.124103695532267 0.0413678985107556 0.0248207391064534]
    [ 0.186155543298400 0.0620518477661335 0.0372311086596801]
Tolerance exceeded in 2 of 9:
    0.0620518477661335 vs 0.0620518477661334, tolerance 2e-15 > 1e-15
    0.0413678985107557 vs 0.0413678985107556, tolerance 3e-15 > 1e-15
**********************************************************************
File "src/sage/matrix/matrix2.pyx", line 1131, in sage.matrix.matrix2.Matrix.pseudoinverse
Failed example:
    M.pseudoinverse(algorithm="numpy")  # tol 1e-15
Expected:
    [0.0620518477661335 0.0206839492553778 0.0124103695532267]
    [ 0.124103695532267 0.0413678985107557 0.0248207391064534]
    [ 0.186155543298400 0.0620518477661335 0.0372311086596801]
Got:
    [0.0620518477661334 0.0206839492553778 0.0124103695532267]
    [ 0.124103695532267 0.0413678985107556 0.0248207391064534]
    [ 0.186155543298400 0.0620518477661335 0.0372311086596801]
Tolerance exceeded in 2 of 9:
    0.0620518477661335 vs 0.0620518477661334, tolerance 2e-15 > 1e-15
    0.0413678985107557 vs 0.0413678985107556, tolerance 3e-15 > 1e-15
**********************************************************************
1 item had failures:
   2 of  25 in sage.matrix.matrix2.Matrix.pseudoinverse
    [2472 tests, 2 failures, 9.06 s]
```



---

archive/issue_comments_453133.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks for testing!",
    "created_at": "2020-01-15T21:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453133",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks for testing!



---

archive/issue_comments_453134.json:
```json
{
    "body": "Changed dependencies from **#29002** to **#29002, #29022**",
    "created_at": "2020-01-15T22:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453134",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29002** to **#29002, #29022**



---

archive/issue_comments_453135.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jhpalmieri](#comment%3A8):\n> sage -t --long src/sage/matrix/matrix2.pyx  # 2 doctests failed\n\nNot sure what's causing the numerical failures.\n\n> sage -t --long src/sage/env.py  # 1 doctest failed\n\nFor this one, I have created #29022.",
    "created_at": "2020-01-15T22:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453135",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jhpalmieri](#comment%3A8):
> sage -t --long src/sage/matrix/matrix2.pyx  # 2 doctests failed

Not sure what's causing the numerical failures.

> sage -t --long src/sage/env.py  # 1 doctest failed

For this one, I have created #29022.



---

archive/issue_comments_453136.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94\"><code>d4fbe40</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2020-01-15T22:56:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453136",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94"><code>d4fbe40</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_453137.json:
```json
{
    "body": "Changed commit from **[`a394268`](https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9)** to **[`d4fbe40`](https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94)**",
    "created_at": "2020-01-15T22:56:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453137",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a394268`](https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9)** to **[`d4fbe40`](https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94)**



---

archive/issue_comments_453138.json:
```json
{
    "body": "Changed commit from **[`d4fbe40`](https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94)** to **[`d1779cc`](https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970)**",
    "created_at": "2020-01-15T23:37:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453138",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d4fbe40`](https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94)** to **[`d1779cc`](https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970)**



---

archive/issue_comments_453139.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23\"><code>bba08ec</code></a></td><td><code>Create module src/sage/env_config.py from src/sage/env_config.py.in, defining SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970\"><code>d1779cc</code></a></td><td><code>Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv</code></td></tr></table>\n",
    "created_at": "2020-01-15T23:37:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453139",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23"><code>bba08ec</code></a></td><td><code>Create module src/sage/env_config.py from src/sage/env_config.py.in, defining SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970"><code>d1779cc</code></a></td><td><code>Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv</code></td></tr></table>




---

archive/issue_comments_453140.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mkoeppe](#comment%3A10):\n> > sage -t --long src/sage/env.py  # 1 doctest failed\n> \n> \n> For this one, I have created #29022.\n\nFixed.",
    "created_at": "2020-01-15T23:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453140",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mkoeppe](#comment%3A10):
> > sage -t --long src/sage/env.py  # 1 doctest failed
> 
> 
> For this one, I have created #29022.

Fixed.



---

archive/issue_comments_453141.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThe numerical problems seems to happen because numpy does not find BLAS.",
    "created_at": "2020-01-16T02:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453141",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

The numerical problems seems to happen because numpy does not find BLAS.



---

archive/issue_comments_453142.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nActually, it does not find openblas or atlas, but it does find the \"Accelerate framework\":\n\n```\naccelerate_info:\n  FOUND:\n    extra_compile_args = ['-msse3', '-I/System/Library/Frameworks/vecLib.framework/Headers']\n    extra_link_args = ['-Wl,-framework', '-Wl,Accelerate']\n    define_macros = [('NO_ATLAS_INFO', 3), ('HAVE_CBLAS', None)]\n\n  FOUND:\n    extra_compile_args = ['-msse3', '-I/System/Library/Frameworks/vecLib.framework/Headers']\n    extra_link_args = ['-Wl,-framework', '-Wl,Accelerate']\n    define_macros = [('NO_ATLAS_INFO', 3), ('HAVE_CBLAS', None)]\n```",
    "created_at": "2020-01-16T02:37:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453142",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Actually, it does not find openblas or atlas, but it does find the "Accelerate framework":

```
accelerate_info:
  FOUND:
    extra_compile_args = ['-msse3', '-I/System/Library/Frameworks/vecLib.framework/Headers']
    extra_link_args = ['-Wl,-framework', '-Wl,Accelerate']
    define_macros = [('NO_ATLAS_INFO', 3), ('HAVE_CBLAS', None)]

  FOUND:
    extra_compile_args = ['-msse3', '-I/System/Library/Frameworks/vecLib.framework/Headers']
    extra_link_args = ['-Wl,-framework', '-Wl,Accelerate']
    define_macros = [('NO_ATLAS_INFO', 3), ('HAVE_CBLAS', None)]
```



---

archive/issue_comments_453143.json:
```json
{
    "body": "Changed commit from **[`d1779cc`](https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970)** to **[`93bae6f`](https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6)**",
    "created_at": "2020-01-16T03:04:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453143",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d1779cc`](https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970)** to **[`93bae6f`](https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6)**



---

archive/issue_comments_453144.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85147f9a7bb3741646693b913bbb96fff1e11432\"><code>85147f9</code></a></td><td><code>build/pkgs/numpy/lapack_conf.py: Add a [DEFAULT] section to site.cfg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6\"><code>93bae6f</code></a></td><td><code>Merge branch 't/29025/numpy__site_cfg_needs_a__default__section' into t/29013/public/29013-use-py3-venv</code></td></tr></table>\n",
    "created_at": "2020-01-16T03:04:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453144",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85147f9a7bb3741646693b913bbb96fff1e11432"><code>85147f9</code></a></td><td><code>build/pkgs/numpy/lapack_conf.py: Add a [DEFAULT] section to site.cfg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6"><code>93bae6f</code></a></td><td><code>Merge branch 't/29025/numpy__site_cfg_needs_a__default__section' into t/29013/public/29013-use-py3-venv</code></td></tr></table>




---

archive/issue_comments_453145.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nMerged #29025, fixes the numerical doctests.",
    "created_at": "2020-01-16T03:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453145",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Merged #29025, fixes the numerical doctests.



---

archive/issue_comments_453146.json:
```json
{
    "body": "Changed dependencies from **#29002, #29022** to **#29002, #29022, #29025**",
    "created_at": "2020-01-16T03:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453146",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29002, #29022** to **#29002, #29022, #29025**



---

archive/issue_comments_453147.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI see a problem with cryptominisat spkg on this branch (which otherwise builds and passes most tests (not related to this packages) on Gentoo)\n\n```\nsage -t --warn-long 88.1 src/sage/sat/solvers/cryptominisat.py\n**********************************************************************\nFile \"src/sage/sat/solvers/cryptominisat.py\", line 49, in sage.sat.solvers.cryptominisat.CryptoMiniSat\nFailed example:\n    solver = CryptoMiniSat()                                  # optional - cryptominisat\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/local/lib/sage/venv/sage/lib/python3.7/site-packages/sage/sat/solvers/cryptominisat.py\", line 69, in __init__\n        from pycryptosat import Solver\n    ModuleNotFoundError: No module named 'pycryptosat'\n```\nI wonder whether it uses a convoluted way to create python extensions, which got broken.",
    "created_at": "2020-01-16T09:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453147",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

I see a problem with cryptominisat spkg on this branch (which otherwise builds and passes most tests (not related to this packages) on Gentoo)

```
sage -t --warn-long 88.1 src/sage/sat/solvers/cryptominisat.py
**********************************************************************
File "src/sage/sat/solvers/cryptominisat.py", line 49, in sage.sat.solvers.cryptominisat.CryptoMiniSat
Failed example:
    solver = CryptoMiniSat()                                  # optional - cryptominisat
Exception raised:
    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/sage/venv/sage/lib/python3.7/site-packages/sage/sat/solvers/cryptominisat.py", line 69, in __init__
        from pycryptosat import Solver
    ModuleNotFoundError: No module named 'pycryptosat'
```
I wonder whether it uses a convoluted way to create python extensions, which got broken.



---

archive/issue_comments_453148.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\noops, [comment:18](#comment%3A18) belongs to #27824",
    "created_at": "2020-01-16T09:32:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453148",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

oops, [comment:18](#comment%3A18) belongs to #27824



---

archive/issue_comments_453149.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nMinor bikeshed, but why the long path \"lib/sage/venv/sage\"?  What about something like just \"lib/sage-X.Y\"; analogously to \"lib/python-X.Y\"?  We've never had a \"lib/sage\" before in the first place, so I don't see any immediate need to make the path so much more complicated.",
    "created_at": "2020-01-16T11:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453149",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Minor bikeshed, but why the long path "lib/sage/venv/sage"?  What about something like just "lib/sage-X.Y"; analogously to "lib/python-X.Y"?  We've never had a "lib/sage" before in the first place, so I don't see any immediate need to make the path so much more complicated.



---

archive/issue_comments_453150.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@embray](#comment%3A20):\n> Minor bikeshed, but why the long path \"lib/sage/venv/sage\"?  What about something like just \"lib/sage-X.Y\"; analogously to \"lib/python-X.Y\"?  We've never had a \"lib/sage\" before in the first place, so I don't see any immediate need to make the path so much more complicated.\n\n1) \"venv\" has to be in the path to indicate that it's a venv in the technical sense and not a random place with invitation to install stuff in it.\n\n2) Definitely no versioning.\n\n3) I suppose I could drop the final \"sage\", making it `lib/sage/venv`",
    "created_at": "2020-01-16T14:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453150",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@embray](#comment%3A20):
> Minor bikeshed, but why the long path "lib/sage/venv/sage"?  What about something like just "lib/sage-X.Y"; analogously to "lib/python-X.Y"?  We've never had a "lib/sage" before in the first place, so I don't see any immediate need to make the path so much more complicated.

1) "venv" has to be in the path to indicate that it's a venv in the technical sense and not a random place with invitation to install stuff in it.

2) Definitely no versioning.

3) I suppose I could drop the final "sage", making it `lib/sage/venv`



---

archive/issue_comments_453151.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@dimpase](#comment%3A18):\n> I see a problem with cryptominisat spkg on this branch (which otherwise builds and passes most tests (not related to this packages) on Gentoo)\n> \n> ```\n> sage -t --warn-long 88.1 src/sage/sat/solvers/cryptominisat.py\n> **********************************************************************\n> File \"src/sage/sat/solvers/cryptominisat.py\", line 49, in sage.sat.solvers.cryptominisat.CryptoMiniSat\n> Failed example:\n>     solver = CryptoMiniSat()                                  # optional - cryptominisat\n> Exception raised:\n>     Traceback (most recent call last):\n>       File \"/mnt/opt/Sage/sage-dev/local/lib/sage/venv/sage/lib/python3.7/site-packages/sage/sat/solvers/cryptominisat.py\", line 69, in __init__\n>         from pycryptosat import Solver\n>     ModuleNotFoundError: No module named 'pycryptosat'\n> ```\n> I wonder whether it uses a convoluted way to create python extensions, which got broken.\n\nUpstream merged pull request https://github.com/msoos/cryptominisat/pull/551\nto take care of a `virtualenv` installation.",
    "created_at": "2020-01-16T14:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453151",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@dimpase](#comment%3A18):
> I see a problem with cryptominisat spkg on this branch (which otherwise builds and passes most tests (not related to this packages) on Gentoo)
> 
> ```
> sage -t --warn-long 88.1 src/sage/sat/solvers/cryptominisat.py
> **********************************************************************
> File "src/sage/sat/solvers/cryptominisat.py", line 49, in sage.sat.solvers.cryptominisat.CryptoMiniSat
> Failed example:
>     solver = CryptoMiniSat()                                  # optional - cryptominisat
> Exception raised:
>     Traceback (most recent call last):
>       File "/mnt/opt/Sage/sage-dev/local/lib/sage/venv/sage/lib/python3.7/site-packages/sage/sat/solvers/cryptominisat.py", line 69, in __init__
>         from pycryptosat import Solver
>     ModuleNotFoundError: No module named 'pycryptosat'
> ```
> I wonder whether it uses a convoluted way to create python extensions, which got broken.

Upstream merged pull request https://github.com/msoos/cryptominisat/pull/551
to take care of a `virtualenv` installation.



---

archive/issue_comments_453152.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI haven't tested whether this patch helps for our `venv`. The patch is not in the current release 5.6.8 (which we have).",
    "created_at": "2020-01-16T14:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453152",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

I haven't tested whether this patch helps for our `venv`. The patch is not in the current release 5.6.8 (which we have).



---

archive/issue_comments_453153.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a\"><code>2ed5d07</code></a></td><td><code>Add cryptominisat patch for virtual envs</code></td></tr></table>\n",
    "created_at": "2020-01-16T14:47:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453153",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a"><code>2ed5d07</code></a></td><td><code>Add cryptominisat patch for virtual envs</code></td></tr></table>




---

archive/issue_comments_453154.json:
```json
{
    "body": "Changed commit from **[`93bae6f`](https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6)** to **[`2ed5d07`](https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a)**",
    "created_at": "2020-01-16T14:47:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453154",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`93bae6f`](https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6)** to **[`2ed5d07`](https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a)**



---

archive/issue_comments_453155.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nTry with this patch please. I can't compile cryptominisat because of an unrelated reason.",
    "created_at": "2020-01-16T14:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453155",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Try with this patch please. I can't compile cryptominisat because of an unrelated reason.



---

archive/issue_comments_453156.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\npatch landed into a wrong place, it should be one level down, in patches/\n\ntesting now, after correction of this.",
    "created_at": "2020-01-16T15:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453156",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

patch landed into a wrong place, it should be one level down, in patches/

testing now, after correction of this.



---

archive/issue_comments_453157.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nSorry, thanks.",
    "created_at": "2020-01-16T15:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453157",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Sorry, thanks.



---

archive/issue_comments_453158.json:
```json
{
    "body": "Changed commit from **[`2ed5d07`](https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a)** to **[`27d945a`](https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541)**",
    "created_at": "2020-01-16T16:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453158",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2ed5d07`](https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a)** to **[`27d945a`](https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541)**



---

archive/issue_comments_453159.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541\"><code>27d945a</code></a></td><td><code>moved patch to the right place</code></td></tr></table>\n",
    "created_at": "2020-01-16T16:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453159",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541"><code>27d945a</code></a></td><td><code>moved patch to the right place</code></td></tr></table>




---

archive/issue_comments_453160.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nthe patch worked, it's all good with tests now.",
    "created_at": "2020-01-16T16:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453160",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

the patch worked, it's all good with tests now.



---

archive/issue_comments_453161.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThank you!",
    "created_at": "2020-01-16T16:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453161",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

Thank you!



---

archive/issue_comments_453162.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI might have missed some discussion elsewhere, but I still don't see the advantage of this extra complication over having the sage environment just extend `sys.path` where necessary.  I say this as a big fan of virtualenvs in general, and having suggested doing something like this in the past.  But the more I think about it the less I see any advantage in this case over having an additional `sys.path` entry.",
    "created_at": "2020-01-16T16:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453162",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

I might have missed some discussion elsewhere, but I still don't see the advantage of this extra complication over having the sage environment just extend `sys.path` where necessary.  I say this as a big fan of virtualenvs in general, and having suggested doing something like this in the past.  But the more I think about it the less I see any advantage in this case over having an additional `sys.path` entry.



---

archive/issue_comments_453163.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@embray](#comment%3A31):\n> I say this as a big fan of virtualenvs in general, and having suggested doing something like this in the past.  \n\nYes, of course this ticket was inspired by various insights and discussions shared by you and others on trac tickets. \n\n> But the more I think about it the less I see any advantage in this case over having an additional `sys.path` entry.\n\nPreviously, with our python2 build, there was no clear way to do it. But now with python 3 there is a standard and clean tool: that's venv. Installing into it is supported by standard tools.",
    "created_at": "2020-01-16T17:01:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453163",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@embray](#comment%3A31):
> I say this as a big fan of virtualenvs in general, and having suggested doing something like this in the past.  

Yes, of course this ticket was inspired by various insights and discussions shared by you and others on trac tickets. 

> But the more I think about it the less I see any advantage in this case over having an additional `sys.path` entry.

Previously, with our python2 build, there was no clear way to do it. But now with python 3 there is a standard and clean tool: that's venv. Installing into it is supported by standard tools.



---

archive/issue_comments_453164.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nOr, at the very least, what I've suggested in the past was to make `$SAGE_LOCAL` itself a virtualenv, as virtualenvs already have a sort-of root filesystem, including among other things `lib/pythonX.Y/site-packages`.\n\nWith this approach, there will now be (depending whether or not the system Python is used) both:\n\n* `SAGE_LOCAL/lib/python3.7/site-packages`\n* `SAGE_LOCAL/lib/sage/venv/sage/lib/python3.7/site-packages`\n\nIf `SAGE_LOCAL` itself (if it exists) were a virtualenv already that would simplify matters greatly.",
    "created_at": "2020-01-16T17:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453164",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

Or, at the very least, what I've suggested in the past was to make `$SAGE_LOCAL` itself a virtualenv, as virtualenvs already have a sort-of root filesystem, including among other things `lib/pythonX.Y/site-packages`.

With this approach, there will now be (depending whether or not the system Python is used) both:

* `SAGE_LOCAL/lib/python3.7/site-packages`
* `SAGE_LOCAL/lib/sage/venv/sage/lib/python3.7/site-packages`

If `SAGE_LOCAL` itself (if it exists) were a virtualenv already that would simplify matters greatly.



---

archive/issue_comments_453165.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@embray](#comment%3A33):\n> Or, at the very least, what I've suggested in the past was to make `$SAGE_LOCAL` itself a virtualenv, as virtualenvs already have a sort-of root filesystem, including among other things `lib/pythonX.Y/site-packages`.\n\nNo, the present ticket explicitly avoids that.\nThe reason is that `venv` has no documented mechanism for adding non-Python stuff to it, in particular to its activation scripts.",
    "created_at": "2020-01-16T17:18:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453165",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@embray](#comment%3A33):
> Or, at the very least, what I've suggested in the past was to make `$SAGE_LOCAL` itself a virtualenv, as virtualenvs already have a sort-of root filesystem, including among other things `lib/pythonX.Y/site-packages`.

No, the present ticket explicitly avoids that.
The reason is that `venv` has no documented mechanism for adding non-Python stuff to it, in particular to its activation scripts.



---

archive/issue_comments_453166.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@embray](#comment%3A33):\n> With this approach, there will now be (depending whether or not the system Python is used) both:\n> \n> * `SAGE_LOCAL/lib/python3.7/site-packages`\n> * `SAGE_LOCAL/lib/sage/venv/sage/lib/python3.7/site-packages`\n\nThat's correct.\nIn a fresh install, the first one will be empty.\n\nIn an install upgraded from earlier versions, there will be packages in both.\nWhen there's an update, the old version if removed from the first one and the new version is added to the second one.",
    "created_at": "2020-01-16T17:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453166",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@embray](#comment%3A33):
> With this approach, there will now be (depending whether or not the system Python is used) both:
> 
> * `SAGE_LOCAL/lib/python3.7/site-packages`
> * `SAGE_LOCAL/lib/sage/venv/sage/lib/python3.7/site-packages`

That's correct.
In a fresh install, the first one will be empty.

In an install upgraded from earlier versions, there will be packages in both.
When there's an update, the old version if removed from the first one and the new version is added to the second one.



---

archive/issue_comments_453167.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@mkoeppe](#comment%3A34):\n> Replying to [@embray](#comment%3A33):\n> > Or, at the very least, what I've suggested in the past was to make `$SAGE_LOCAL` itself a virtualenv, as virtualenvs already have a sort-of root filesystem, including among other things `lib/pythonX.Y/site-packages`.\n> \n> \n> No, the present ticket explicitly avoids that.\n> The reason is that `venv` has no documented mechanism for adding non-Python stuff to it, in particular to its activation scripts.\n\nThere's no reason you can't--I've often install C libraries into a virtualenv by setting the path to it in `./configure --prefix`.",
    "created_at": "2020-01-16T17:52:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453167",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@mkoeppe](#comment%3A34):
> Replying to [@embray](#comment%3A33):
> > Or, at the very least, what I've suggested in the past was to make `$SAGE_LOCAL` itself a virtualenv, as virtualenvs already have a sort-of root filesystem, including among other things `lib/pythonX.Y/site-packages`.
> 
> 
> No, the present ticket explicitly avoids that.
> The reason is that `venv` has no documented mechanism for adding non-Python stuff to it, in particular to its activation scripts.

There's no reason you can't--I've often install C libraries into a virtualenv by setting the path to it in `./configure --prefix`.



---

archive/issue_comments_453168.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI really hate to be a pain in the ass because I know you put a lot of work into this, but I really don't get it...  It really seems complicated and messy to both activate the Sage environment, and then within that activate a virtualenv.  I don't think that's what I ever had in mind when I suggested using a virtualenv for Sage (or if I did, I take it back...)\n\nI'd still like to know what problem this is solving.  You say that it's required for #27824, but why?  What specific problems related to #27824 is it solving?  Because most likely there's another way.",
    "created_at": "2020-01-16T17:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453168",
    "user": "https://github.com/embray"
}
```

<div id="comment:37" align="right">comment:37</div>

I really hate to be a pain in the ass because I know you put a lot of work into this, but I really don't get it...  It really seems complicated and messy to both activate the Sage environment, and then within that activate a virtualenv.  I don't think that's what I ever had in mind when I suggested using a virtualenv for Sage (or if I did, I take it back...)

I'd still like to know what problem this is solving.  You say that it's required for #27824, but why?  What specific problems related to #27824 is it solving?  Because most likely there's another way.



---

archive/issue_comments_453169.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nWell, the separation of #29013 and #27824 is artificial, but otherwise, they do the job.\nvenv removes an extra complication of sagelib being very far from pip-installable.",
    "created_at": "2020-01-16T18:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453169",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

Well, the separation of #29013 and #27824 is artificial, but otherwise, they do the job.
venv removes an extra complication of sagelib being very far from pip-installable.



---

archive/issue_comments_453170.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@embray](#comment%3A37):\n>  I don't think that's what I ever had in mind when I suggested using a virtualenv for Sage\n\nDon't worry. I'm prepared to take full credit for this specific version of the idea, if necessary.",
    "created_at": "2020-01-16T18:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453170",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@embray](#comment%3A37):
>  I don't think that's what I ever had in mind when I suggested using a virtualenv for Sage

Don't worry. I'm prepared to take full credit for this specific version of the idea, if necessary.



---

archive/issue_comments_453171.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@dimpase](#comment%3A38):\n> Well, the separation of #29013 and #27824 is artificial, but otherwise, they do the job.\n> venv removes an extra complication of sagelib being very far from pip-installable.\n\nHow?  Why?  There's really nothing that magical about virtualenvs.  It's just an alternate install prefix plus (as of Python 3 and the venv module) some small support bits in the interpreter to report a different `sys.prefix`, etc.",
    "created_at": "2020-01-17T14:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453171",
    "user": "https://github.com/embray"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@dimpase](#comment%3A38):
> Well, the separation of #29013 and #27824 is artificial, but otherwise, they do the job.
> venv removes an extra complication of sagelib being very far from pip-installable.

How?  Why?  There's really nothing that magical about virtualenvs.  It's just an alternate install prefix plus (as of Python 3 and the venv module) some small support bits in the interpreter to report a different `sys.prefix`, etc.



---

archive/issue_comments_453172.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@embray](#comment%3A40):\n> Replying to [@dimpase](#comment%3A38):\n> > Well, the separation of #29013 and #27824 is artificial, but otherwise, they do the job.\n> > venv removes an extra complication of sagelib being very far from pip-installable.\n> \n> \n> How?  Why?  There's really nothing that magical about virtualenvs.  It's just an alternate install prefix plus (as of Python 3 and the venv module) some small support bits in the interpreter to report a different `sys.prefix`, etc.\n\nPart of the magic is to use the standard instead of project-specific tricks.",
    "created_at": "2020-01-17T14:25:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453172",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@embray](#comment%3A40):
> Replying to [@dimpase](#comment%3A38):
> > Well, the separation of #29013 and #27824 is artificial, but otherwise, they do the job.
> > venv removes an extra complication of sagelib being very far from pip-installable.
> 
> 
> How?  Why?  There's really nothing that magical about virtualenvs.  It's just an alternate install prefix plus (as of Python 3 and the venv module) some small support bits in the interpreter to report a different `sys.prefix`, etc.

Part of the magic is to use the standard instead of project-specific tricks.



---

archive/issue_comments_453173.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@mkoeppe](#comment%3A41):\n> Replying to [@embray](#comment%3A40):\n> > Replying to [@dimpase](#comment%3A38):\n> > > Well, the separation of #29013 and #27824 is artificial, but otherwise, they do the job.\n> > > venv removes an extra complication of sagelib being very far from pip-installable.\n> > \n> > \n> > How?  Why?  There's really nothing that magical about virtualenvs.  It's just an alternate install prefix plus (as of Python 3 and the venv module) some small support bits in the interpreter to report a different `sys.prefix`, etc.\n> \n> Part of the magic is to use the standard instead of project-specific tricks.\n\nWhat \"tricks\" are you avoiding?",
    "created_at": "2020-01-17T14:52:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453173",
    "user": "https://github.com/embray"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@mkoeppe](#comment%3A41):
> Replying to [@embray](#comment%3A40):
> > Replying to [@dimpase](#comment%3A38):
> > > Well, the separation of #29013 and #27824 is artificial, but otherwise, they do the job.
> > > venv removes an extra complication of sagelib being very far from pip-installable.
> > 
> > 
> > How?  Why?  There's really nothing that magical about virtualenvs.  It's just an alternate install prefix plus (as of Python 3 and the venv module) some small support bits in the interpreter to report a different `sys.prefix`, etc.
> 
> Part of the magic is to use the standard instead of project-specific tricks.

What "tricks" are you avoiding?



---

archive/issue_comments_453174.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08ec5516a2f5aa0b7e59b2a20ef0316bdc3784b7\"><code>08ec551</code></a></td><td><code>build/make/deps: Make python3_venv a .PHONY target</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2ab6f3b383e25656b520fd70b05908d24376c83\"><code>b2ab6f3</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6\"><code>7a43544</code></a></td><td><code>src/sage/env.py, envconfig.py.in: Add MAXIMA; src/sage/interfaces/maxima.py: Use it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a\"><code>f2af478</code></a></td><td><code>Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv</code></td></tr></table>\n",
    "created_at": "2020-01-17T21:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453174",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08ec5516a2f5aa0b7e59b2a20ef0316bdc3784b7"><code>08ec551</code></a></td><td><code>build/make/deps: Make python3_venv a .PHONY target</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2ab6f3b383e25656b520fd70b05908d24376c83"><code>b2ab6f3</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6"><code>7a43544</code></a></td><td><code>src/sage/env.py, envconfig.py.in: Add MAXIMA; src/sage/interfaces/maxima.py: Use it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a"><code>f2af478</code></a></td><td><code>Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv</code></td></tr></table>




---

archive/issue_comments_453175.json:
```json
{
    "body": "Changed commit from **[`27d945a`](https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541)** to **[`f2af478`](https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a)**",
    "created_at": "2020-01-17T21:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453175",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`27d945a`](https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541)** to **[`f2af478`](https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a)**



---

archive/issue_comments_453176.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@mkoeppe](#comment%3A21):\n> Replying to [@embray](#comment%3A20):\n> > Minor bikeshed, but why the long path \"lib/sage/venv/sage\"?  ....\n> \n> \n> 3) I suppose I could drop the final \"sage\", making it `lib/sage/venv`\n\nDone.",
    "created_at": "2020-01-17T21:41:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453176",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@mkoeppe](#comment%3A21):
> Replying to [@embray](#comment%3A20):
> > Minor bikeshed, but why the long path "lib/sage/venv/sage"?  ....
> 
> 
> 3) I suppose I could drop the final "sage", making it `lib/sage/venv`

Done.



---

archive/issue_comments_453177.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI've also merged in a few changes from #29032 (Erik's version of python spkg-configure / venv), and the current #29022.",
    "created_at": "2020-01-17T21:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453177",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

I've also merged in a few changes from #29032 (Erik's version of python spkg-configure / venv), and the current #29022.



---

archive/issue_comments_453178.json:
```json
{
    "body": "Changed commit from **[`f2af478`](https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a)** to **[`199a72e`](https://github.com/sagemath/sagetrac-mirror/commit/199a72ed50ae52a1024872e1c417fb3919a11eb8)**",
    "created_at": "2020-01-17T22:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453178",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f2af478`](https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a)** to **[`199a72e`](https://github.com/sagemath/sagetrac-mirror/commit/199a72ed50ae52a1024872e1c417fb3919a11eb8)**



---

archive/issue_comments_453179.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b28ac1ea210e58d43f10a9bedbcab36793e5a4e\"><code>6b28ac1</code></a></td><td><code>In a python3 build, install all Python packages into a venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/981f65e6925b5609fccf0d71a7e94168085f5b99\"><code>981f65e</code></a></td><td><code>sage-pip-install: Use PYTHON=sage-python23</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6854bda8ac4eceeeec2490e153f4e957d9dba93\"><code>a6854bd</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11ada01a39cfd31215dd5e0152973287f5cb268d\"><code>11ada01</code></a></td><td><code>build/pkgs/numpy/lapack_conf.py: Add a [DEFAULT] section to site.cfg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bd10e43a9ee8bf1c33ccdd55bb5778bdcefc7d3\"><code>3bd10e4</code></a></td><td><code>Add cryptominisat patch for virtual envs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da13a9e64f0ff982ec42b4ccb9de87e600d84f15\"><code>da13a9e</code></a></td><td><code>moved patch to the right place</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9d067a78c68f118cd080224ffacd26eabfa7578\"><code>c9d067a</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/199a72ed50ae52a1024872e1c417fb3919a11eb8\"><code>199a72e</code></a></td><td><code>src/sage/env.py: Rework _get_shared_lib_filename, fix for Cygwin: it would privilege system DLLs over DLLs in SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2020-01-17T22:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453179",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b28ac1ea210e58d43f10a9bedbcab36793e5a4e"><code>6b28ac1</code></a></td><td><code>In a python3 build, install all Python packages into a venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/981f65e6925b5609fccf0d71a7e94168085f5b99"><code>981f65e</code></a></td><td><code>sage-pip-install: Use PYTHON=sage-python23</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6854bda8ac4eceeeec2490e153f4e957d9dba93"><code>a6854bd</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11ada01a39cfd31215dd5e0152973287f5cb268d"><code>11ada01</code></a></td><td><code>build/pkgs/numpy/lapack_conf.py: Add a [DEFAULT] section to site.cfg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bd10e43a9ee8bf1c33ccdd55bb5778bdcefc7d3"><code>3bd10e4</code></a></td><td><code>Add cryptominisat patch for virtual envs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da13a9e64f0ff982ec42b4ccb9de87e600d84f15"><code>da13a9e</code></a></td><td><code>moved patch to the right place</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9d067a78c68f118cd080224ffacd26eabfa7578"><code>c9d067a</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/199a72ed50ae52a1024872e1c417fb3919a11eb8"><code>199a72e</code></a></td><td><code>src/sage/env.py: Rework _get_shared_lib_filename, fix for Cygwin: it would privilege system DLLs over DLLs in SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_453180.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, Erik Bray**",
    "created_at": "2020-01-17T23:24:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453180",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, Erik Bray**



---

archive/issue_events_395618.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-19T19:50:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395618"
}
```



---

archive/issue_events_395619.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-19T19:50:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395619"
}
```



---

archive/issue_comments_453181.json:
```json
{
    "body": "Work Issues: **Redo on top of current #29022; #29038 instead of #29022**",
    "created_at": "2020-01-19T19:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453181",
    "user": "https://github.com/mkoeppe"
}
```

Work Issues: **Redo on top of current #29022; #29038 instead of #29022**



---

archive/issue_comments_453182.json:
```json
{
    "body": "Changed dependencies from **#29002, #29022, #29025** to **#29002, #29022, #29025, #29038**",
    "created_at": "2020-01-19T20:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453182",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#29002, #29022, #29025** to **#29002, #29022, #29025, #29038**



---

archive/issue_comments_453183.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI would be interested in your comments on #29032.  By making `$SAGE_LOCAL` itself into a virtualenv--which it already essentially is in all other respects--no other weird hacks are needed.\n\nOther than some things like the OSX fixes I don't see what this solves that my branch doesn't.",
    "created_at": "2020-01-31T11:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453183",
    "user": "https://github.com/embray"
}
```

<div id="comment:50" align="right">comment:50</div>

I would be interested in your comments on #29032.  By making `$SAGE_LOCAL` itself into a virtualenv--which it already essentially is in all other respects--no other weird hacks are needed.

Other than some things like the OSX fixes I don't see what this solves that my branch doesn't.



---

archive/issue_comments_453184.json:
```json
{
    "body": "Changed commit from **[`199a72e`](https://github.com/sagemath/sagetrac-mirror/commit/199a72ed50ae52a1024872e1c417fb3919a11eb8)** to **[`208c7e6`](https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431)**",
    "created_at": "2020-03-17T23:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453184",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`199a72e`](https://github.com/sagemath/sagetrac-mirror/commit/199a72ed50ae52a1024872e1c417fb3919a11eb8)** to **[`208c7e6`](https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431)**



---

archive/issue_comments_453185.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/980f444f9852186949953760dfa94a16da91de92\"><code>980f444</code></a></td><td><code>In a python3 build, install all Python packages into a venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90bf090a01866ceb02632ee3f0ed154f802719a2\"><code>90bf090</code></a></td><td><code>sage-pip-install: Use PYTHON=sage-python23</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9edf0689325c84040e6f3f4ffd3f3e624735c37d\"><code>9edf068</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ead2d0f17d67a7e7abe1f85c4bd79b3a407b03c6\"><code>ead2d0f</code></a></td><td><code>Add cryptominisat patch for virtual envs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56e3daa3cc5b12f495f4f307b3450124466f5ac5\"><code>56e3daa</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431\"><code>208c7e6</code></a></td><td><code>src/sage/env.py: Rework _get_shared_lib_filename, fix for Cygwin: it would privilege system DLLs over DLLs in SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2020-03-17T23:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453185",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/980f444f9852186949953760dfa94a16da91de92"><code>980f444</code></a></td><td><code>In a python3 build, install all Python packages into a venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90bf090a01866ceb02632ee3f0ed154f802719a2"><code>90bf090</code></a></td><td><code>sage-pip-install: Use PYTHON=sage-python23</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9edf0689325c84040e6f3f4ffd3f3e624735c37d"><code>9edf068</code></a></td><td><code>_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ead2d0f17d67a7e7abe1f85c4bd79b3a407b03c6"><code>ead2d0f</code></a></td><td><code>Add cryptominisat patch for virtual envs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56e3daa3cc5b12f495f4f307b3450124466f5ac5"><code>56e3daa</code></a></td><td><code>src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431"><code>208c7e6</code></a></td><td><code>src/sage/env.py: Rework _get_shared_lib_filename, fix for Cygwin: it would privilege system DLLs over DLLs in SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_453186.json:
```json
{
    "body": "Changed dependencies from **#29002, #29022, #29025, #29038** to none",
    "created_at": "2020-03-17T23:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453186",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29002, #29022, #29025, #29038** to none



---

archive/issue_comments_453187.json:
```json
{
    "body": "Changed work issues from **Redo on top of current #29022; #29038 instead of #29022** to none",
    "created_at": "2020-03-17T23:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453187",
    "user": "https://github.com/mkoeppe"
}
```

Changed work issues from **Redo on top of current #29022; #29038 instead of #29022** to none



---

archive/issue_comments_453188.json:
```json
{
    "body": "Dependencies: **#29362**",
    "created_at": "2020-03-18T20:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453188",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29362**



---

archive/issue_events_395620.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T16:24:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395620"
}
```



---

archive/issue_events_395621.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T16:24:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395621"
}
```



---

archive/issue_events_395622.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T16:24:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "title_is": "In a python3 build, install all Python packages into a venv different from SAGE_LOCAL",
    "title_was": "In a python3 build, install all Python packages into a venv",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395622"
}
```



---

archive/issue_comments_453189.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n-We propose to create a venv (https://docs.python.org/3/library/venv.html) at `$SAGE_LOCAL/lib/sage/venv/sage/`, \n-to activate the venv in the `sage-env` script, and to install all Python packages (including `sagelib`) into this venv.\n+#27824 makes `$SAGE_LOCAL` a venv if a suitable system python3 is found.\n \n-This is preparation for #27824, in which the system's python3 will be used when available.\n+On this ticket, we create a venv (https://docs.python.org/3/library/venv.html) instead at `$SAGE_LOCAL/lib/sage/venv/sage/`, run the standard `activate` script in the `sage-env` script, and install all Python packages (including `sagelib`) into this venv.\n \n-Note, the proposal is to use `venv` (new since Python 3.3), not `virtualenv`. So this change will be limited to Python 3 builds of Sage. \n+(This used to be preparation for #27824; but the approach of that has been changed.)\n \n+\n``````\n",
    "created_at": "2020-03-19T16:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453189",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
-We propose to create a venv (https://docs.python.org/3/library/venv.html) at `$SAGE_LOCAL/lib/sage/venv/sage/`, 
-to activate the venv in the `sage-env` script, and to install all Python packages (including `sagelib`) into this venv.
+#27824 makes `$SAGE_LOCAL` a venv if a suitable system python3 is found.
 
-This is preparation for #27824, in which the system's python3 will be used when available.
+On this ticket, we create a venv (https://docs.python.org/3/library/venv.html) instead at `$SAGE_LOCAL/lib/sage/venv/sage/`, run the standard `activate` script in the `sage-env` script, and install all Python packages (including `sagelib`) into this venv.
 
-Note, the proposal is to use `venv` (new since Python 3.3), not `virtualenv`. So this change will be limited to Python 3 builds of Sage. 
+(This used to be preparation for #27824; but the approach of that has been changed.)
 
+
``````




---

archive/issue_comments_453190.json:
```json
{
    "body": "Changed dependencies from **#29362** to none",
    "created_at": "2020-09-17T03:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453190",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29362** to none



---

archive/issue_events_395623.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-17T03:48:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "title_is": "Support installation of Python packages into separate venvs depending on the python version",
    "title_was": "In a python3 build, install all Python packages into a venv different from SAGE_LOCAL",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395623"
}
```



---

archive/issue_comments_453191.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,16 @@\n-#27824 makes `$SAGE_LOCAL` a venv if a suitable system python3 is found.\n+#27824 made `$SAGE_LOCAL` a venv if a suitable system python3 is found.\n \n-On this ticket, we create a venv (https://docs.python.org/3/library/venv.html) instead at `$SAGE_LOCAL/lib/sage/venv/sage/`, run the standard `activate` script in the `sage-env` script, and install all Python packages (including `sagelib`) into this venv.\n+In this ticket, we add support for installing several python versions into the same `SAGE_LOCAL`:\n+- keeping install records for Python packages in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages ($SAGE_LOCAL/var/lib/sage/{installed,scripts})\n+- likewise for `$SAGE_LOCAL/var/tmp/sage/build`\n+- here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.\n \n-(This used to be preparation for #27824; but the approach of that has been changed.)\n+This is activated by running, for example, `make PYTHON_FOR_VENV=/usr/bin/python3.8 SAGE_VENV=`$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`. \n \n+To implement this, an SPKG needs an indication that it is a Python package - for example #30024.\n \n+This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.\n+\n+This depends on:\n+- #30534 Repackage `pynac` as a pip-installable package\n+\n``````\n",
    "created_at": "2020-09-17T03:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453191",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,16 @@
-#27824 makes `$SAGE_LOCAL` a venv if a suitable system python3 is found.
+#27824 made `$SAGE_LOCAL` a venv if a suitable system python3 is found.
 
-On this ticket, we create a venv (https://docs.python.org/3/library/venv.html) instead at `$SAGE_LOCAL/lib/sage/venv/sage/`, run the standard `activate` script in the `sage-env` script, and install all Python packages (including `sagelib`) into this venv.
+In this ticket, we add support for installing several python versions into the same `SAGE_LOCAL`:
+- keeping install records for Python packages in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages ($SAGE_LOCAL/var/lib/sage/{installed,scripts})
+- likewise for `$SAGE_LOCAL/var/tmp/sage/build`
+- here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.
 
-(This used to be preparation for #27824; but the approach of that has been changed.)
+This is activated by running, for example, `make PYTHON_FOR_VENV=/usr/bin/python3.8 SAGE_VENV=`$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`. 
 
+To implement this, an SPKG needs an indication that it is a Python package - for example #30024.
 
+This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.
+
+This depends on:
+- #30534 Repackage `pynac` as a pip-installable package
+
``````




---

archive/issue_events_395624.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-17T03:48:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395624"
}
```



---

archive/issue_events_395625.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-17T03:48:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395625"
}
```



---

archive/issue_comments_453192.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n #27824 made `$SAGE_LOCAL` a venv if a suitable system python3 is found.\n \n In this ticket, we add support for installing several python versions into the same `SAGE_LOCAL`:\n-- keeping install records for Python packages in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages ($SAGE_LOCAL/var/lib/sage/{installed,scripts})\n+- keeping install records for Python packages in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages (`$SAGE_LOCAL/var/lib/sage/{installed,scripts}`)\n - likewise for `$SAGE_LOCAL/var/tmp/sage/build`\n - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.\n \n``````\n",
    "created_at": "2020-09-17T03:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453192",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 #27824 made `$SAGE_LOCAL` a venv if a suitable system python3 is found.
 
 In this ticket, we add support for installing several python versions into the same `SAGE_LOCAL`:
-- keeping install records for Python packages in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages ($SAGE_LOCAL/var/lib/sage/{installed,scripts})
+- keeping install records for Python packages in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages (`$SAGE_LOCAL/var/lib/sage/{installed,scripts}`)
 - likewise for `$SAGE_LOCAL/var/tmp/sage/build`
 - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.
 
``````




---

archive/issue_comments_453193.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n - likewise for `$SAGE_LOCAL/var/tmp/sage/build`\n - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.\n \n-This is activated by running, for example, `make PYTHON_FOR_VENV=/usr/bin/python3.8 SAGE_VENV=`$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`. \n+This is activated by running, for example, `make PYTHON_FOR_VENV=\"/usr/bin/python3.8\" SAGE_VENV=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n \n To implement this, an SPKG needs an indication that it is a Python package - for example #30024.\n \n``````\n",
    "created_at": "2020-09-17T03:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453193",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 - likewise for `$SAGE_LOCAL/var/tmp/sage/build`
 - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.
 
-This is activated by running, for example, `make PYTHON_FOR_VENV=/usr/bin/python3.8 SAGE_VENV=`$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`. 
+This is activated by running, for example, `make PYTHON_FOR_VENV="/usr/bin/python3.8" SAGE_VENV="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
 
 To implement this, an SPKG needs an indication that it is a Python package - for example #30024.
 
``````




---

archive/issue_comments_453194.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.\n \n This is activated by running, for example, `make PYTHON_FOR_VENV=\"/usr/bin/python3.8\" SAGE_VENV=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n+(This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.)\n \n To implement this, an SPKG needs an indication that it is a Python package - for example #30024.\n \n``````\n",
    "created_at": "2020-09-17T06:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453194",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.
 
 This is activated by running, for example, `make PYTHON_FOR_VENV="/usr/bin/python3.8" SAGE_VENV="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
+(This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.)
 
 To implement this, an SPKG needs an indication that it is a Python package - for example #30024.
 
``````




---

archive/issue_comments_453195.json:
```json
{
    "body": "Dependencies: **#22731**",
    "created_at": "2020-09-17T16:35:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453195",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#22731**



---

archive/issue_comments_453196.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,6 +8,8 @@\n This is activated by running, for example, `make PYTHON_FOR_VENV=\"/usr/bin/python3.8\" SAGE_VENV=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n (This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.)\n \n+(Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)\n+\n To implement this, an SPKG needs an indication that it is a Python package - for example #30024.\n \n This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.\n``````\n",
    "created_at": "2020-09-18T04:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453196",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,6 +8,8 @@
 This is activated by running, for example, `make PYTHON_FOR_VENV="/usr/bin/python3.8" SAGE_VENV="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
 (This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.)
 
+(Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)
+
 To implement this, an SPKG needs an indication that it is a Python package - for example #30024.
 
 This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.
``````




---

archive/issue_comments_453197.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,8 +5,10 @@\n - likewise for `$SAGE_LOCAL/var/tmp/sage/build`\n - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.\n \n-This is activated by running, for example, `make PYTHON_FOR_VENV=\"/usr/bin/python3.8\" SAGE_VENV=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n-(This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.)\n+Configuration:\n+- This is activated by running, for example, `make PYTHON_FOR_VENV=\"/usr/bin/python3.8\" SAGE_VENV=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n+- This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.\n+- We may also want to support `./configure --with-python=no` which would suppress making any venv.\n \n (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)\n \n``````\n",
    "created_at": "2020-10-04T17:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453197",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,8 +5,10 @@
 - likewise for `$SAGE_LOCAL/var/tmp/sage/build`
 - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.
 
-This is activated by running, for example, `make PYTHON_FOR_VENV="/usr/bin/python3.8" SAGE_VENV="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
-(This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.)
+Configuration:
+- This is activated by running, for example, `make PYTHON_FOR_VENV="/usr/bin/python3.8" SAGE_VENV="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
+- This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.
+- We may also want to support `./configure --with-python=no` which would suppress making any venv.
 
 (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)
 
``````




---

archive/issue_comments_453198.json:
```json
{
    "body": "Changed dependencies from **#22731** to **#22731, #30719**",
    "created_at": "2020-10-04T21:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453198",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#22731** to **#22731, #30719**



---

archive/issue_comments_453199.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,7 @@\n \n (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)\n \n-To implement this, an SPKG needs an indication that it is a Python package - for example #30024.\n+To implement this, an SPKG needs an indication that it is a Python package.  Per #30719, we use existence of `install-requires.txt` or of `requirements.txt`.\n \n This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.\n \n``````\n",
    "created_at": "2020-10-04T21:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453199",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,7 @@
 
 (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)
 
-To implement this, an SPKG needs an indication that it is a Python package - for example #30024.
+To implement this, an SPKG needs an indication that it is a Python package.  Per #30719, we use existence of `install-requires.txt` or of `requirements.txt`.
 
 This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.
 
``````




---

archive/issue_comments_453200.json:
```json
{
    "body": "Changed dependencies from **#22731, #30719** to **#22731, #30719, #30657**",
    "created_at": "2020-10-04T22:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453200",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#22731, #30719** to **#22731, #30719, #30657**



---

archive/issue_comments_453201.json:
```json
{
    "body": "Changed commit from **[`208c7e6`](https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431)** to **[`1ead553`](https://github.com/sagemath/sagetrac-mirror/commit/1ead553c9407060c3459a92138b8448b5aa2fd3b)**",
    "created_at": "2020-10-04T22:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453201",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`208c7e6`](https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431)** to **[`1ead553`](https://github.com/sagemath/sagetrac-mirror/commit/1ead553c9407060c3459a92138b8448b5aa2fd3b)**



---

archive/issue_comments_453202.json:
```json
{
    "body": "<div id=\"comment:64\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11ce883bcb57024a33c6b22ca0dc8ceb2674e9c8\"><code>11ce883</code></a></td><td><code>Add more build/pkgs/*/install-requires.txt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85b2dcfb73325075f62e2c209f0842122de12b11\"><code>85b2dcf</code></a></td><td><code>for a in *; do if [ -d $a -a ! -r $a/requirements.txt -a ! -r $a/install-requires.txt ]; then if grep -q -i sdh_pip $a/spkg-install.in >&/dev/null ; then ( if [ -r $a/package-version.txt ]; then echo \"$a >=$(sed s/[.]p[0-9]$// $a/package-version.txt)\"; else echo \"$a\"; fi) > $a/install-requires.txt && git add $a/install-requires.txt; fi; fi; done</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9ac70ef321f333f2b7d0a7a080c01899cec4f86\"><code>f9ac70e</code></a></td><td><code>Add install-requires.txt for setuptools, pip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0635f618b50a42128d96354761c6dbee64667c12\"><code>0635f61</code></a></td><td><code>Merge branch 't/30719/add_build_pkgs_spkg_install_requires_txt_for_all_python_packages' into t/29013/separate_venvs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/082d3c03d2bae89b0ffc45a5a83666760595b9b6\"><code>082d3c0</code></a></td><td><code>build/make/Makefile.in: Change some SAGE_LOCAL to SAGE_VENV</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd0fd2f3142b08a906ebdbe3e2f37be6bec5f135\"><code>bd0fd2f</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30657/fix_up__sage__p_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e20f230c0ac0b24c14b04b180217db68a2b7278\"><code>2e20f23</code></a></td><td><code>build/bin/sage-spkg: Move SAGE_SPKG_{INST,SCRIPTS,WHEELS} setting here from build/bin/install, make them relative to SAGE_INST_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be2417cd48549b2c1a9fa29bcd362b08c2a6fda7\"><code>be2417c</code></a></td><td><code>Merge tag '9.2.beta14' into t/30657/fix_up__sage__p_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ee7ee29ea4686a968846df1621f52adcd8f4173\"><code>8ee7ee2</code></a></td><td><code>build/make/install: Set SAGE_SPKG_WHEELS also here so that script packages still work</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ead553c9407060c3459a92138b8448b5aa2fd3b\"><code>1ead553</code></a></td><td><code>Merge branch 't/30657/fix_up__sage__p_' into t/29013/separate_venvs</code></td></tr></table>\n",
    "created_at": "2020-10-04T22:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453202",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:64"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11ce883bcb57024a33c6b22ca0dc8ceb2674e9c8"><code>11ce883</code></a></td><td><code>Add more build/pkgs/*/install-requires.txt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85b2dcfb73325075f62e2c209f0842122de12b11"><code>85b2dcf</code></a></td><td><code>for a in *; do if [ -d $a -a ! -r $a/requirements.txt -a ! -r $a/install-requires.txt ]; then if grep -q -i sdh_pip $a/spkg-install.in >&/dev/null ; then ( if [ -r $a/package-version.txt ]; then echo "$a >=$(sed s/[.]p[0-9]$// $a/package-version.txt)"; else echo "$a"; fi) > $a/install-requires.txt && git add $a/install-requires.txt; fi; fi; done</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9ac70ef321f333f2b7d0a7a080c01899cec4f86"><code>f9ac70e</code></a></td><td><code>Add install-requires.txt for setuptools, pip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0635f618b50a42128d96354761c6dbee64667c12"><code>0635f61</code></a></td><td><code>Merge branch 't/30719/add_build_pkgs_spkg_install_requires_txt_for_all_python_packages' into t/29013/separate_venvs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/082d3c03d2bae89b0ffc45a5a83666760595b9b6"><code>082d3c0</code></a></td><td><code>build/make/Makefile.in: Change some SAGE_LOCAL to SAGE_VENV</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd0fd2f3142b08a906ebdbe3e2f37be6bec5f135"><code>bd0fd2f</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30657/fix_up__sage__p_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e20f230c0ac0b24c14b04b180217db68a2b7278"><code>2e20f23</code></a></td><td><code>build/bin/sage-spkg: Move SAGE_SPKG_{INST,SCRIPTS,WHEELS} setting here from build/bin/install, make them relative to SAGE_INST_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be2417cd48549b2c1a9fa29bcd362b08c2a6fda7"><code>be2417c</code></a></td><td><code>Merge tag '9.2.beta14' into t/30657/fix_up__sage__p_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ee7ee29ea4686a968846df1621f52adcd8f4173"><code>8ee7ee2</code></a></td><td><code>build/make/install: Set SAGE_SPKG_WHEELS also here so that script packages still work</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ead553c9407060c3459a92138b8448b5aa2fd3b"><code>1ead553</code></a></td><td><code>Merge branch 't/30657/fix_up__sage__p_' into t/29013/separate_venvs</code></td></tr></table>




---

archive/issue_comments_453203.json:
```json
{
    "body": "Changed author from **Matthias Koeppe, Erik Bray** to **Matthias Koeppe**",
    "created_at": "2020-10-04T22:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453203",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe, Erik Bray** to **Matthias Koeppe**



---

archive/issue_comments_453204.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplaced the branch",
    "created_at": "2020-10-04T22:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453204",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:65" align="right">comment:65</div>

Replaced the branch



---

archive/issue_comments_453205.json:
```json
{
    "body": "Changed dependencies from **#22731, #30719, #30657** to **#22731, #30719, #30657, #30622**",
    "created_at": "2020-10-05T00:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453205",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#22731, #30719, #30657** to **#22731, #30719, #30657, #30622**



---

archive/issue_comments_453206.json:
```json
{
    "body": "<div id=\"comment:67\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be554b08d885caf15c5284f56677d2ec6d2250a3\"><code>be554b0</code></a></td><td><code>build/bin/{sage-spkg,sage-dist-helpers}: Use SAGE_INST_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ca2d2388fc74bcef1d9e89a4b7853f668dc6cbf\"><code>8ca2d23</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fbf79f4e969313eff301a8172c9466fba8e3e2a\"><code>4fbf79f</code></a></td><td><code>build/bin/sage-spkg: Move SAGE_SPKG_{INST,SCRIPTS,WHEELS} setting here from build/bin/install, make them relative to SAGE_INST_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fc7f9ca20d6665425d0332070c6e7e3dc3968c9\"><code>8fc7f9c</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f1b7aab59ff88cbb2995287ce6c2de1a12473fc\"><code>0f1b7aa</code></a></td><td><code>build/make/install: Do not set SAGE_SPKG_INST here; set it in build/make/Makefile.in</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1baf8eae8a49e394c33c0b1c3633ab1755db86a5\"><code>1baf8ea</code></a></td><td><code>WIP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a713c390686ce8da37f0c0268059d3b522c0d0d3\"><code>a713c39</code></a></td><td><code>Merge branch 't/30657/fix_up__sage__p_' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6297dd72e65961bf68c16eb17d6a3787c24f07df\"><code>6297dd7</code></a></td><td><code>Merge branch 't/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix' into t/29013/separate_venvs</code></td></tr></table>\n",
    "created_at": "2020-10-05T01:31:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453206",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:67"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be554b08d885caf15c5284f56677d2ec6d2250a3"><code>be554b0</code></a></td><td><code>build/bin/{sage-spkg,sage-dist-helpers}: Use SAGE_INST_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ca2d2388fc74bcef1d9e89a4b7853f668dc6cbf"><code>8ca2d23</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fbf79f4e969313eff301a8172c9466fba8e3e2a"><code>4fbf79f</code></a></td><td><code>build/bin/sage-spkg: Move SAGE_SPKG_{INST,SCRIPTS,WHEELS} setting here from build/bin/install, make them relative to SAGE_INST_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fc7f9ca20d6665425d0332070c6e7e3dc3968c9"><code>8fc7f9c</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f1b7aab59ff88cbb2995287ce6c2de1a12473fc"><code>0f1b7aa</code></a></td><td><code>build/make/install: Do not set SAGE_SPKG_INST here; set it in build/make/Makefile.in</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1baf8eae8a49e394c33c0b1c3633ab1755db86a5"><code>1baf8ea</code></a></td><td><code>WIP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a713c390686ce8da37f0c0268059d3b522c0d0d3"><code>a713c39</code></a></td><td><code>Merge branch 't/30657/fix_up__sage__p_' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6297dd72e65961bf68c16eb17d6a3787c24f07df"><code>6297dd7</code></a></td><td><code>Merge branch 't/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix' into t/29013/separate_venvs</code></td></tr></table>




---

archive/issue_comments_453207.json:
```json
{
    "body": "Changed commit from **[`1ead553`](https://github.com/sagemath/sagetrac-mirror/commit/1ead553c9407060c3459a92138b8448b5aa2fd3b)** to **[`6297dd7`](https://github.com/sagemath/sagetrac-mirror/commit/6297dd72e65961bf68c16eb17d6a3787c24f07df)**",
    "created_at": "2020-10-05T01:31:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453207",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1ead553`](https://github.com/sagemath/sagetrac-mirror/commit/1ead553c9407060c3459a92138b8448b5aa2fd3b)** to **[`6297dd7`](https://github.com/sagemath/sagetrac-mirror/commit/6297dd72e65961bf68c16eb17d6a3787c24f07df)**



---

archive/issue_comments_453208.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nWhen `sage-env-config` is sourced, it overrides `PYTHON_FOR_VENV`.\nThis will be addressed in #30724.",
    "created_at": "2020-10-05T01:43:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453208",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">comment:68</div>

When `sage-env-config` is sourced, it overrides `PYTHON_FOR_VENV`.
This will be addressed in #30724.



---

archive/issue_comments_453209.json:
```json
{
    "body": "Changed dependencies from **#22731, #30719, #30657, #30622** to **#30719, #30657, #30622 | #22731, #30724**",
    "created_at": "2020-10-05T01:43:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453209",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#22731, #30719, #30657, #30622** to **#30719, #30657, #30622 | #22731, #30724**



---

archive/issue_comments_453210.json:
```json
{
    "body": "<div id=\"comment:69\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91b4c0f51db39342346fddea7190eca7b7bde423\"><code>91b4c0f</code></a></td><td><code>build/make/Makefile.in: Set PYTHON_FOR_VENV here, do not rely on sage-env to set it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1955fad1e3c9d0aa7727ebc22f8f6ffbffadcb08\"><code>1955fad</code></a></td><td><code>src/bin/sage-env: Set MACOSX_DEPLOYMENT_TARGET based on config variable SAGE_MACOSX_DEPLOYMENT_TARGET</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bfa0ea5b2c803cc15e21a88f0f5e1c4eb77faaa\"><code>4bfa0ea</code></a></td><td><code>src/bin/sage-env-config.in: Do not set PYTHON_FOR_VENV</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5673cd008d7e09f3f2b2208adc998b06c767ead4\"><code>5673cd0</code></a></td><td><code>Merge branch 't/30724/src_bin_sage_env__src_bin_sage_env_config_in__remove_python_for_venv' into t/29013/separate_venvs</code></td></tr></table>\n",
    "created_at": "2020-10-05T02:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453210",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:69"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91b4c0f51db39342346fddea7190eca7b7bde423"><code>91b4c0f</code></a></td><td><code>build/make/Makefile.in: Set PYTHON_FOR_VENV here, do not rely on sage-env to set it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1955fad1e3c9d0aa7727ebc22f8f6ffbffadcb08"><code>1955fad</code></a></td><td><code>src/bin/sage-env: Set MACOSX_DEPLOYMENT_TARGET based on config variable SAGE_MACOSX_DEPLOYMENT_TARGET</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bfa0ea5b2c803cc15e21a88f0f5e1c4eb77faaa"><code>4bfa0ea</code></a></td><td><code>src/bin/sage-env-config.in: Do not set PYTHON_FOR_VENV</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5673cd008d7e09f3f2b2208adc998b06c767ead4"><code>5673cd0</code></a></td><td><code>Merge branch 't/30724/src_bin_sage_env__src_bin_sage_env_config_in__remove_python_for_venv' into t/29013/separate_venvs</code></td></tr></table>




---

archive/issue_comments_453211.json:
```json
{
    "body": "Changed commit from **[`6297dd7`](https://github.com/sagemath/sagetrac-mirror/commit/6297dd72e65961bf68c16eb17d6a3787c24f07df)** to **[`5673cd0`](https://github.com/sagemath/sagetrac-mirror/commit/5673cd008d7e09f3f2b2208adc998b06c767ead4)**",
    "created_at": "2020-10-05T02:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453211",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6297dd7`](https://github.com/sagemath/sagetrac-mirror/commit/6297dd72e65961bf68c16eb17d6a3787c24f07df)** to **[`5673cd0`](https://github.com/sagemath/sagetrac-mirror/commit/5673cd008d7e09f3f2b2208adc998b06c767ead4)**



---

archive/issue_comments_453212.json:
```json
{
    "body": "Changed dependencies from **#30719, #30657, #30622 | #22731, #30724** to **#30719, #30657, #30622, #30724 | #22731**",
    "created_at": "2020-10-05T02:33:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453212",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30719, #30657, #30622 | #22731, #30724** to **#30719, #30657, #30622, #30724 | #22731**



---

archive/issue_comments_453213.json:
```json
{
    "body": "Changed commit from **[`5673cd0`](https://github.com/sagemath/sagetrac-mirror/commit/5673cd008d7e09f3f2b2208adc998b06c767ead4)** to **[`cc71ada`](https://github.com/sagemath/sagetrac-mirror/commit/cc71adae894d12cd902b5cecbd98118d70d283e5)**",
    "created_at": "2020-10-05T05:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453213",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5673cd0`](https://github.com/sagemath/sagetrac-mirror/commit/5673cd008d7e09f3f2b2208adc998b06c767ead4)** to **[`cc71ada`](https://github.com/sagemath/sagetrac-mirror/commit/cc71adae894d12cd902b5cecbd98118d70d283e5)**



---

archive/issue_comments_453214.json:
```json
{
    "body": "<div id=\"comment:71\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc71adae894d12cd902b5cecbd98118d70d283e5\"><code>cc71ada</code></a></td><td><code>WIP</code></td></tr></table>\n",
    "created_at": "2020-10-05T05:13:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453214",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:71"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc71adae894d12cd902b5cecbd98118d70d283e5"><code>cc71ada</code></a></td><td><code>WIP</code></td></tr></table>




---

archive/issue_comments_453215.json:
```json
{
    "body": "Changed dependencies from **#30719, #30657, #30622, #30724 | #22731** to **#30719, #30657, #30622, #30724 | #22731, #30731**",
    "created_at": "2020-10-05T23:53:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453215",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30719, #30657, #30622, #30724 | #22731** to **#30719, #30657, #30622, #30724 | #22731, #30731**



---

archive/issue_comments_453216.json:
```json
{
    "body": "Changed commit from **[`cc71ada`](https://github.com/sagemath/sagetrac-mirror/commit/cc71adae894d12cd902b5cecbd98118d70d283e5)** to **[`9b93425`](https://github.com/sagemath/sagetrac-mirror/commit/9b93425dad001fe468e0f1551a9b55c0f8289d62)**",
    "created_at": "2020-10-05T23:55:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453216",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cc71ada`](https://github.com/sagemath/sagetrac-mirror/commit/cc71adae894d12cd902b5cecbd98118d70d283e5)** to **[`9b93425`](https://github.com/sagemath/sagetrac-mirror/commit/9b93425dad001fe468e0f1551a9b55c0f8289d62)**



---

archive/issue_comments_453217.json:
```json
{
    "body": "<div id=\"comment:73\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/332c7231365f9f5f1e9627ae30171939ba28d10c\"><code>332c723</code></a></td><td><code>build/bin/sage-pip-install, build/bin/sage-python23: Just call python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b93425dad001fe468e0f1551a9b55c0f8289d62\"><code>9b93425</code></a></td><td><code>Working version for normal packages</code></td></tr></table>\n",
    "created_at": "2020-10-05T23:55:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453217",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/332c7231365f9f5f1e9627ae30171939ba28d10c"><code>332c723</code></a></td><td><code>build/bin/sage-pip-install, build/bin/sage-python23: Just call python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b93425dad001fe468e0f1551a9b55c0f8289d62"><code>9b93425</code></a></td><td><code>Working version for normal packages</code></td></tr></table>




---

archive/issue_comments_453218.json:
```json
{
    "body": "Work Issues: **refactor through #30896**",
    "created_at": "2020-11-11T20:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453218",
    "user": "https://github.com/mkoeppe"
}
```

Work Issues: **refactor through #30896**



---

archive/issue_comments_453219.json:
```json
{
    "body": "Changed dependencies from **#30719, #30657, #30622, #30724 | #22731, #30731** to **#30719, #30657, #30622, #30724 | #22731, #30731, #30896**",
    "created_at": "2020-11-11T20:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453219",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30719, #30657, #30622, #30724 | #22731, #30731** to **#30719, #30657, #30622, #30724 | #22731, #30731, #30896**



---

archive/issue_comments_453220.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n Configuration:\n - This is activated by running, for example, `make PYTHON_FOR_VENV=\"/usr/bin/python3.8\" SAGE_VENV=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n - This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.\n-- We may also want to support `./configure --with-python=no` which would suppress making any venv.\n+- We also want to support `./configure --with-python=no` which would suppress making any venv (#30896)\n \n (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)\n \n``````\n",
    "created_at": "2020-11-11T20:19:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453220",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 Configuration:
 - This is activated by running, for example, `make PYTHON_FOR_VENV="/usr/bin/python3.8" SAGE_VENV="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
 - This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.
-- We may also want to support `./configure --with-python=no` which would suppress making any venv.
+- We also want to support `./configure --with-python=no` which would suppress making any venv (#30896)
 
 (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)
 
``````




---

archive/issue_comments_453221.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,9 @@\n \n (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)\n \n-To implement this, an SPKG needs an indication that it is a Python package.  Per #30719, we use existence of `install-requires.txt` or of `requirements.txt`.\n+To implement this, an SPKG needs an indication that it is a Python package.  Per #30719, we use existence of `install-requires.txt` or of `requirements.txt`. \n+\n+(Optional: A file `build/pkgs/SPKG/trees` could override it - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...)\n \n This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.\n \n``````\n",
    "created_at": "2020-11-12T19:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453221",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,9 @@
 
 (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)
 
-To implement this, an SPKG needs an indication that it is a Python package.  Per #30719, we use existence of `install-requires.txt` or of `requirements.txt`.
+To implement this, an SPKG needs an indication that it is a Python package.  Per #30719, we use existence of `install-requires.txt` or of `requirements.txt`. 
+
+(Optional: A file `build/pkgs/SPKG/trees` could override it - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...)
 
 This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.
 
``````




---

archive/issue_comments_453222.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453222",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">comment:77</div>

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_453223.json:
```json
{
    "body": "Changed keywords from none to **sd111**",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453223",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from none to **sd111**



---

archive/issue_comments_453224.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,9 +6,9 @@\n - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.\n \n Configuration:\n-- This is activated by running, for example, `make PYTHON_FOR_VENV=\"/usr/bin/python3.8\" SAGE_VENV=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n-- This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.\n-- We also want to support `./configure --with-python=no` which would suppress making any venv (#30896)\n+- This is activated by running, for example, \n+`./configure --with-python=/usr/bin/python3.8 --with-sage-venv=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n+- We also want to support `./configure --with-sage-venv=no` which would suppress making any venv (#30896)\n \n (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)\n \n``````\n",
    "created_at": "2020-12-09T20:16:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453224",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,9 +6,9 @@
 - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.
 
 Configuration:
-- This is activated by running, for example, `make PYTHON_FOR_VENV="/usr/bin/python3.8" SAGE_VENV="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
-- This could also be a configure variable ([installation directory option](https://github.com/autotools-mirror/autoconf/blob/master/lib/autoconf/general.m4#L601)) defaulting to `${prefix}`.
-- We also want to support `./configure --with-python=no` which would suppress making any venv (#30896)
+- This is activated by running, for example, 
+`./configure --with-python=/usr/bin/python3.8 --with-sage-venv="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
+- We also want to support `./configure --with-sage-venv=no` which would suppress making any venv (#30896)
 
 (Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)
 
``````




---

archive/issue_comments_453225.json:
```json
{
    "body": "Changed dependencies from **#30719, #30657, #30622, #30724 | #22731, #30731, #30896** to none",
    "created_at": "2021-02-08T22:08:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453225",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30719, #30657, #30622, #30724 | #22731, #30731, #30896** to none



---

archive/issue_comments_453226.json:
```json
{
    "body": "Changed work issues from **refactor through #30896** to **refactor through #31362, #30896**",
    "created_at": "2021-02-08T22:08:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453226",
    "user": "https://github.com/mkoeppe"
}
```

Changed work issues from **refactor through #30896** to **refactor through #31362, #30896**



---

archive/issue_events_395626.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T03:42:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395626"
}
```



---

archive/issue_events_395627.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-10T03:42:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395627"
}
```



---

archive/issue_comments_453227.json:
```json
{
    "body": "Dependencies: **#31362**",
    "created_at": "2021-02-25T02:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453227",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31362**



---

archive/issue_comments_453228.json:
```json
{
    "body": "Changed work issues from **refactor through #31362, #30896** to **refactor through #31362**",
    "created_at": "2021-02-25T02:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453228",
    "user": "https://github.com/mkoeppe"
}
```

Changed work issues from **refactor through #31362, #30896** to **refactor through #31362**



---

archive/issue_comments_453229.json:
```json
{
    "body": "<div id=\"comment:82\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea182d7302b3d362bbd38b548cda65c86e3b6f66\"><code>ea182d7</code></a></td><td><code>Copy changes from build/pkgs/sagelib/src to src</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1a10b9b524e63574bbf1de2c4ce6f149116f147\"><code>a1a10b9</code></a></td><td><code>src/VERSION.txt: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5697335ed14c929adb01a3fafe95f82b79248918\"><code>5697335</code></a></td><td><code>src/setup.cfg: Add license_file=LICENSE.txt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/deb9eb3a33ee6474f755a9bee6f487d839c9d247\"><code>deb9eb3</code></a></td><td><code>Merge tag '9.3.beta3' into t/30912/sagelib__update_metadata_for_pypi_deployment</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ad4c0e6da58f8851cfbced0e9c1a66c9479f918\"><code>7ad4c0e</code></a></td><td><code>Merge tag '9.3.beta4' into t/30912/sagelib__update_metadata_for_pypi_deployment</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27b589baa864533f8a51ff8b46ae10735d09d62f\"><code>27b589b</code></a></td><td><code>Merge branch 't/30912/sagelib__update_metadata_for_pypi_deployment' into t/31362/make_all_sage_local__make_all_sage_venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8796008d4852679266b786d63fef2933f0619fa1\"><code>8796008</code></a></td><td><code>Put pynac into SAGE_LOCAL, sagelib into SAGE_VENV</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6831b1b9657035e91afe6c8b47b32358f24497c\"><code>d6831b1</code></a></td><td><code>build/make/Makefile.in: Add all-build-local, all-build-venv, which include dependency on toolchain</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61f6ba6ba917bc48a535470a5c781ccf57d94b06\"><code>61f6ba6</code></a></td><td><code>Makefile: Add top-level targets build-local, build-venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f6bb57173ba5b067334be57a83089f2e3ef6951\"><code>2f6bb57</code></a></td><td><code>build/make/Makefile.in: Change some SAGE_LOCAL to SAGE_VENV</code></td></tr></table>\n",
    "created_at": "2021-02-26T02:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453229",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:82"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea182d7302b3d362bbd38b548cda65c86e3b6f66"><code>ea182d7</code></a></td><td><code>Copy changes from build/pkgs/sagelib/src to src</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1a10b9b524e63574bbf1de2c4ce6f149116f147"><code>a1a10b9</code></a></td><td><code>src/VERSION.txt: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5697335ed14c929adb01a3fafe95f82b79248918"><code>5697335</code></a></td><td><code>src/setup.cfg: Add license_file=LICENSE.txt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/deb9eb3a33ee6474f755a9bee6f487d839c9d247"><code>deb9eb3</code></a></td><td><code>Merge tag '9.3.beta3' into t/30912/sagelib__update_metadata_for_pypi_deployment</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ad4c0e6da58f8851cfbced0e9c1a66c9479f918"><code>7ad4c0e</code></a></td><td><code>Merge tag '9.3.beta4' into t/30912/sagelib__update_metadata_for_pypi_deployment</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27b589baa864533f8a51ff8b46ae10735d09d62f"><code>27b589b</code></a></td><td><code>Merge branch 't/30912/sagelib__update_metadata_for_pypi_deployment' into t/31362/make_all_sage_local__make_all_sage_venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8796008d4852679266b786d63fef2933f0619fa1"><code>8796008</code></a></td><td><code>Put pynac into SAGE_LOCAL, sagelib into SAGE_VENV</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6831b1b9657035e91afe6c8b47b32358f24497c"><code>d6831b1</code></a></td><td><code>build/make/Makefile.in: Add all-build-local, all-build-venv, which include dependency on toolchain</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61f6ba6ba917bc48a535470a5c781ccf57d94b06"><code>61f6ba6</code></a></td><td><code>Makefile: Add top-level targets build-local, build-venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f6bb57173ba5b067334be57a83089f2e3ef6951"><code>2f6bb57</code></a></td><td><code>build/make/Makefile.in: Change some SAGE_LOCAL to SAGE_VENV</code></td></tr></table>




---

archive/issue_comments_453230.json:
```json
{
    "body": "Changed commit from **[`9b93425`](https://github.com/sagemath/sagetrac-mirror/commit/9b93425dad001fe468e0f1551a9b55c0f8289d62)** to **[`2f6bb57`](https://github.com/sagemath/sagetrac-mirror/commit/2f6bb57173ba5b067334be57a83089f2e3ef6951)**",
    "created_at": "2021-02-26T02:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453230",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9b93425`](https://github.com/sagemath/sagetrac-mirror/commit/9b93425dad001fe468e0f1551a9b55c0f8289d62)** to **[`2f6bb57`](https://github.com/sagemath/sagetrac-mirror/commit/2f6bb57173ba5b067334be57a83089f2e3ef6951)**



---

archive/issue_comments_453231.json:
```json
{
    "body": "Changed commit from **[`2f6bb57`](https://github.com/sagemath/sagetrac-mirror/commit/2f6bb57173ba5b067334be57a83089f2e3ef6951)** to **[`3c731b8`](https://github.com/sagemath/sagetrac-mirror/commit/3c731b8014a1ab6e323a87c73e6da1da160fd4a7)**",
    "created_at": "2021-02-26T06:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453231",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2f6bb57`](https://github.com/sagemath/sagetrac-mirror/commit/2f6bb57173ba5b067334be57a83089f2e3ef6951)** to **[`3c731b8`](https://github.com/sagemath/sagetrac-mirror/commit/3c731b8014a1ab6e323a87c73e6da1da160fd4a7)**



---

archive/issue_comments_453232.json:
```json
{
    "body": "<div id=\"comment:83\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c731b8014a1ab6e323a87c73e6da1da160fd4a7\"><code>3c731b8</code></a></td><td><code>build/make/Makefile.in: Rework using tree_... variables</code></td></tr></table>\n",
    "created_at": "2021-02-26T06:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453232",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:83"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c731b8014a1ab6e323a87c73e6da1da160fd4a7"><code>3c731b8</code></a></td><td><code>build/make/Makefile.in: Rework using tree_... variables</code></td></tr></table>




---

archive/issue_comments_453233.json:
```json
{
    "body": "<div id=\"comment:84\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d04b08b61ba7e86e75da625a30717b9809606cb7\"><code>d04b08b</code></a></td><td><code>build/make/Makefile.in: Define SAGE_VENV earlier</code></td></tr></table>\n",
    "created_at": "2021-02-26T06:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453233",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:84"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d04b08b61ba7e86e75da625a30717b9809606cb7"><code>d04b08b</code></a></td><td><code>build/make/Makefile.in: Define SAGE_VENV earlier</code></td></tr></table>




---

archive/issue_comments_453234.json:
```json
{
    "body": "Changed commit from **[`3c731b8`](https://github.com/sagemath/sagetrac-mirror/commit/3c731b8014a1ab6e323a87c73e6da1da160fd4a7)** to **[`d04b08b`](https://github.com/sagemath/sagetrac-mirror/commit/d04b08b61ba7e86e75da625a30717b9809606cb7)**",
    "created_at": "2021-02-26T06:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453234",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3c731b8`](https://github.com/sagemath/sagetrac-mirror/commit/3c731b8014a1ab6e323a87c73e6da1da160fd4a7)** to **[`d04b08b`](https://github.com/sagemath/sagetrac-mirror/commit/d04b08b61ba7e86e75da625a30717b9809606cb7)**



---

archive/issue_comments_453235.json:
```json
{
    "body": "Changed work issues from **refactor through #31362** to **AC_ARG_WITH**",
    "created_at": "2021-02-26T06:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453235",
    "user": "https://github.com/mkoeppe"
}
```

Changed work issues from **refactor through #31362** to **AC_ARG_WITH**



---

archive/issue_comments_453236.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n #27824 made `$SAGE_LOCAL` a venv if a suitable system python3 is found.\n \n-In this ticket, we add support for installing several python versions into the same `SAGE_LOCAL`:\n-- keeping install records for Python packages in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages (`$SAGE_LOCAL/var/lib/sage/{installed,scripts}`)\n+In this ticket, we add support for installing builds of Sage with several python versions, sharing the non-Python packages in `SAGE_LOCAL`:\n+- keeping install records for Python packages (recognized by having `install-requires.txt` or `requirements.txt`) in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages (`$SAGE_LOCAL/var/lib/sage/{installed,scripts}`)\n - likewise for `$SAGE_LOCAL/var/tmp/sage/build`\n - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.\n \n@@ -10,13 +10,11 @@\n `./configure --with-python=/usr/bin/python3.8 --with-sage-venv=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n - We also want to support `./configure --with-sage-venv=no` which would suppress making any venv (#30896)\n \n-(Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)\n+(Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created... or should python3 be installed in `$SAGE_VENV`?)\n \n-To implement this, an SPKG needs an indication that it is a Python package.  Per #30719, we use existence of `install-requires.txt` or of `requirements.txt`. \n+(Optional: A file `build/pkgs/SPKG/trees` could override the install tree determination - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...)\n \n-(Optional: A file `build/pkgs/SPKG/trees` could override it - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...)\n-\n-This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.\n+This facilitates testing with several Python versions without having to rebuild the Sage distribution.\n \n This depends on:\n - #30534 Repackage `pynac` as a pip-installable package\n``````\n",
    "created_at": "2021-02-26T07:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453236",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 #27824 made `$SAGE_LOCAL` a venv if a suitable system python3 is found.
 
-In this ticket, we add support for installing several python versions into the same `SAGE_LOCAL`:
-- keeping install records for Python packages in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages (`$SAGE_LOCAL/var/lib/sage/{installed,scripts}`)
+In this ticket, we add support for installing builds of Sage with several python versions, sharing the non-Python packages in `SAGE_LOCAL`:
+- keeping install records for Python packages (recognized by having `install-requires.txt` or `requirements.txt`) in `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`, separate from those of non-Python packages (`$SAGE_LOCAL/var/lib/sage/{installed,scripts}`)
 - likewise for `$SAGE_LOCAL/var/tmp/sage/build`
 - here `$SAGE_VENV` defaults to `$SAGE_LOCAL`, but can be overridden to an arbitrary directory that will be used as the wheel-building venv, for example  `$SAGE_LOCAL/var/lib/sage/venv/$PYTHON_TAG`.
 
@@ -10,13 +10,11 @@
 `./configure --with-python=/usr/bin/python3.8 --with-sage-venv="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
 - We also want to support `./configure --with-sage-venv=no` which would suppress making any venv (#30896)
 
-(Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created.)
+(Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created... or should python3 be installed in `$SAGE_VENV`?)
 
-To implement this, an SPKG needs an indication that it is a Python package.  Per #30719, we use existence of `install-requires.txt` or of `requirements.txt`. 
+(Optional: A file `build/pkgs/SPKG/trees` could override the install tree determination - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...)
 
-(Optional: A file `build/pkgs/SPKG/trees` could override it - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...)
-
-This is mainly for #29039; but also facilitates testing with several Python versions without having to rebuild the Sage distribution.
+This facilitates testing with several Python versions without having to rebuild the Sage distribution.
 
 This depends on:
 - #30534 Repackage `pynac` as a pip-installable package
``````




---

archive/issue_comments_453237.json:
```json
{
    "body": "<div id=\"comment:87\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/306ddefd5806daa5ce8a720a1480c28cea76c5f6\"><code>306ddef</code></a></td><td><code>WIP configure --with-sage-venv</code></td></tr></table>\n",
    "created_at": "2021-02-26T17:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453237",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:87"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/306ddefd5806daa5ce8a720a1480c28cea76c5f6"><code>306ddef</code></a></td><td><code>WIP configure --with-sage-venv</code></td></tr></table>




---

archive/issue_comments_453238.json:
```json
{
    "body": "Changed commit from **[`d04b08b`](https://github.com/sagemath/sagetrac-mirror/commit/d04b08b61ba7e86e75da625a30717b9809606cb7)** to **[`306ddef`](https://github.com/sagemath/sagetrac-mirror/commit/306ddefd5806daa5ce8a720a1480c28cea76c5f6)**",
    "created_at": "2021-02-26T17:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453238",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d04b08b`](https://github.com/sagemath/sagetrac-mirror/commit/d04b08b61ba7e86e75da625a30717b9809606cb7)** to **[`306ddef`](https://github.com/sagemath/sagetrac-mirror/commit/306ddefd5806daa5ce8a720a1480c28cea76c5f6)**



---

archive/issue_comments_453239.json:
```json
{
    "body": "Changed commit from **[`306ddef`](https://github.com/sagemath/sagetrac-mirror/commit/306ddefd5806daa5ce8a720a1480c28cea76c5f6)** to **[`8cc0b3c`](https://github.com/sagemath/sagetrac-mirror/commit/8cc0b3ca43d4c9f852d86079fa6edb1d6aa4cf14)**",
    "created_at": "2021-04-03T20:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453239",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`306ddef`](https://github.com/sagemath/sagetrac-mirror/commit/306ddefd5806daa5ce8a720a1480c28cea76c5f6)** to **[`8cc0b3c`](https://github.com/sagemath/sagetrac-mirror/commit/8cc0b3ca43d4c9f852d86079fa6edb1d6aa4cf14)**



---

archive/issue_comments_453240.json:
```json
{
    "body": "<div id=\"comment:88\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf6e5f88af4772da93c89b41cfce7c8da0dbae01\"><code>bf6e5f8</code></a></td><td><code>build/make/Makefile.in: Change some SAGE_LOCAL to SAGE_VENV</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/832f96a1f9e57de4a7df8feabff5620ef6b2e5f9\"><code>832f96a</code></a></td><td><code>build/make/Makefile.in: Rework using tree_... variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3436ad68da50a3f2caa5dcb0f8e76e7f33ecca80\"><code>3436ad6</code></a></td><td><code>build/make/Makefile.in: Define SAGE_VENV earlier</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cc0b3ca43d4c9f852d86079fa6edb1d6aa4cf14\"><code>8cc0b3c</code></a></td><td><code>WIP configure --with-sage-venv</code></td></tr></table>\n",
    "created_at": "2021-04-03T20:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453240",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:88"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf6e5f88af4772da93c89b41cfce7c8da0dbae01"><code>bf6e5f8</code></a></td><td><code>build/make/Makefile.in: Change some SAGE_LOCAL to SAGE_VENV</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/832f96a1f9e57de4a7df8feabff5620ef6b2e5f9"><code>832f96a</code></a></td><td><code>build/make/Makefile.in: Rework using tree_... variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3436ad68da50a3f2caa5dcb0f8e76e7f33ecca80"><code>3436ad6</code></a></td><td><code>build/make/Makefile.in: Define SAGE_VENV earlier</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cc0b3ca43d4c9f852d86079fa6edb1d6aa4cf14"><code>8cc0b3c</code></a></td><td><code>WIP configure --with-sage-venv</code></td></tr></table>




---

archive/issue_comments_453241.json:
```json
{
    "body": "Changed dependencies from **#31362** to none",
    "created_at": "2021-04-03T20:10:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453241",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31362** to none



---

archive/issue_comments_453242.json:
```json
{
    "body": "Changed commit from **[`8cc0b3c`](https://github.com/sagemath/sagetrac-mirror/commit/8cc0b3ca43d4c9f852d86079fa6edb1d6aa4cf14)** to **[`2202f84`](https://github.com/sagemath/sagetrac-mirror/commit/2202f842b7f7bf0a9f83d9dcdb07f57c2002dfd2)**",
    "created_at": "2021-04-03T20:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453242",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8cc0b3c`](https://github.com/sagemath/sagetrac-mirror/commit/8cc0b3ca43d4c9f852d86079fa6edb1d6aa4cf14)** to **[`2202f84`](https://github.com/sagemath/sagetrac-mirror/commit/2202f842b7f7bf0a9f83d9dcdb07f57c2002dfd2)**



---

archive/issue_comments_453243.json:
```json
{
    "body": "<div id=\"comment:90\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cfbe2bf13f2f4cefc98e2ac42e99e2e83c91f24\"><code>1cfbe2b</code></a></td><td><code>build/bin/sage-spkg: Change more SAGE_LOCAL to SAGE_INST_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2202f842b7f7bf0a9f83d9dcdb07f57c2002dfd2\"><code>2202f84</code></a></td><td><code>configure.ac: Finish --with-sage-venv handling</code></td></tr></table>\n",
    "created_at": "2021-04-03T20:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453243",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:90"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cfbe2bf13f2f4cefc98e2ac42e99e2e83c91f24"><code>1cfbe2b</code></a></td><td><code>build/bin/sage-spkg: Change more SAGE_LOCAL to SAGE_INST_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2202f842b7f7bf0a9f83d9dcdb07f57c2002dfd2"><code>2202f84</code></a></td><td><code>configure.ac: Finish --with-sage-venv handling</code></td></tr></table>




---

archive/issue_events_395628.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-03T20:50:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395628"
}
```



---

archive/issue_events_395629.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-03T20:50:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395629"
}
```



---

archive/issue_comments_453244.json:
```json
{
    "body": "Changed work issues from **AC_ARG_WITH** to none",
    "created_at": "2021-04-03T20:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453244",
    "user": "https://github.com/mkoeppe"
}
```

Changed work issues from **AC_ARG_WITH** to none



---

archive/issue_comments_453245.json:
```json
{
    "body": "Changed commit from **[`2202f84`](https://github.com/sagemath/sagetrac-mirror/commit/2202f842b7f7bf0a9f83d9dcdb07f57c2002dfd2)** to **[`92f1a1b`](https://github.com/sagemath/sagetrac-mirror/commit/92f1a1bba94a5dd6a4c9458438c39b781b101ead)**",
    "created_at": "2021-04-04T00:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453245",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2202f84`](https://github.com/sagemath/sagetrac-mirror/commit/2202f842b7f7bf0a9f83d9dcdb07f57c2002dfd2)** to **[`92f1a1b`](https://github.com/sagemath/sagetrac-mirror/commit/92f1a1bba94a5dd6a4c9458438c39b781b101ead)**



---

archive/issue_comments_453246.json:
```json
{
    "body": "<div id=\"comment:92\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b604a6853ccbfbce775eebeace429d0bd4bdd791\"><code>b604a68</code></a></td><td><code>build/make/Makefile.in: Also source sage-src-env-config for script packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92f1a1bba94a5dd6a4c9458438c39b781b101ead\"><code>92f1a1b</code></a></td><td><code>build/pkgs/pynac/spkg-install.in: Build with PYTHON_FOR_VENV</code></td></tr></table>\n",
    "created_at": "2021-04-04T00:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453246",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:92"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b604a6853ccbfbce775eebeace429d0bd4bdd791"><code>b604a68</code></a></td><td><code>build/make/Makefile.in: Also source sage-src-env-config for script packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92f1a1bba94a5dd6a4c9458438c39b781b101ead"><code>92f1a1b</code></a></td><td><code>build/pkgs/pynac/spkg-install.in: Build with PYTHON_FOR_VENV</code></td></tr></table>




---

archive/issue_comments_453247.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,14 +8,19 @@\n Configuration:\n - This is activated by running, for example, \n `./configure --with-python=/usr/bin/python3.8 --with-sage-venv=\"$SAGE_LOCAL/var/lib/sage/venv/python3.8\"`.\n+\n+\n+As of this ticket, we are able to establish the venv in an arbitrary configured directory instead of `SAGE_LOCAL`. This is already useful for #31396 to create a wheel-building venv that will not be packaged as part of `SAGE_LOCAL`.\n+\n+In follow-up tickets, we gain the full functionality that facilitates testing with several Python versions without having to rebuild the Sage distribution.  This depends on:\n+\n+- #30534 Repackage `pynac` as a pip-installable package\n+\n+Follow-ups:\n+\n - We also want to support `./configure --with-sage-venv=no` which would suppress making any venv (#30896)\n \n-(Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created... or should python3 be installed in `$SAGE_VENV`?)\n+- Support the tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created... or should python3 be installed in `$SAGE_VENV`?)\n \n-(Optional: A file `build/pkgs/SPKG/trees` could override the install tree determination - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...)\n+- Optional: A file `build/pkgs/SPKG/trees` could override the install tree determination - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...\n \n-This facilitates testing with several Python versions without having to rebuild the Sage distribution.\n-\n-This depends on:\n-- #30534 Repackage `pynac` as a pip-installable package\n-\n``````\n",
    "created_at": "2021-04-04T19:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453247",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,14 +8,19 @@
 Configuration:
 - This is activated by running, for example, 
 `./configure --with-python=/usr/bin/python3.8 --with-sage-venv="$SAGE_LOCAL/var/lib/sage/venv/python3.8"`.
+
+
+As of this ticket, we are able to establish the venv in an arbitrary configured directory instead of `SAGE_LOCAL`. This is already useful for #31396 to create a wheel-building venv that will not be packaged as part of `SAGE_LOCAL`.
+
+In follow-up tickets, we gain the full functionality that facilitates testing with several Python versions without having to rebuild the Sage distribution.  This depends on:
+
+- #30534 Repackage `pynac` as a pip-installable package
+
+Follow-ups:
+
 - We also want to support `./configure --with-sage-venv=no` which would suppress making any venv (#30896)
 
-(Tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created... or should python3 be installed in `$SAGE_VENV`?)
+- Support the tricky case: When system python3 is not in use and SAGE_VENV != SAGE_LOCAL, then both a real `$SAGE_LOCAL/bin/python3` needs to be built and a venv in SAGE_VENV created... or should python3 be installed in `$SAGE_VENV`?)
 
-(Optional: A file `build/pkgs/SPKG/trees` could override the install tree determination - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...)
+- Optional: A file `build/pkgs/SPKG/trees` could override the install tree determination - this would allow us to for example install a package such as `jupyter_core` both into something like `SAGE_NOTEBOOK_VENV` and `SAGE_VENV`...
 
-This facilitates testing with several Python versions without having to rebuild the Sage distribution.
-
-This depends on:
-- #30534 Repackage `pynac` as a pip-installable package
-
``````




---

archive/issue_events_395630.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-04T19:15:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "title_is": "Add configure option --with-sage-venv=SAGE_VENV to create venv there instead of in SAGE_LOCAL",
    "title_was": "Support installation of Python packages into separate venvs depending on the python version",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395630"
}
```



---

archive/issue_comments_453248.json:
```json
{
    "body": "Changed commit from **[`92f1a1b`](https://github.com/sagemath/sagetrac-mirror/commit/92f1a1bba94a5dd6a4c9458438c39b781b101ead)** to **[`9dcded5`](https://github.com/sagemath/sagetrac-mirror/commit/9dcded5e3188eec1c4f0d1a81016783f506708fd)**",
    "created_at": "2021-04-05T18:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453248",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`92f1a1b`](https://github.com/sagemath/sagetrac-mirror/commit/92f1a1bba94a5dd6a4c9458438c39b781b101ead)** to **[`9dcded5`](https://github.com/sagemath/sagetrac-mirror/commit/9dcded5e3188eec1c4f0d1a81016783f506708fd)**



---

archive/issue_comments_453249.json:
```json
{
    "body": "<div id=\"comment:95\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1942363cc0462a0417463561dd2d9750a9886b5d\"><code>1942363</code></a></td><td><code>build/pkgs/pynac/spkg-install.in: Back to PYTHON=python3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dcded5e3188eec1c4f0d1a81016783f506708fd\"><code>9dcded5</code></a></td><td><code>src/bin/sage: Only do the check for an incomplete installation when run from the source tree</code></td></tr></table>\n",
    "created_at": "2021-04-05T18:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453249",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:95"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1942363cc0462a0417463561dd2d9750a9886b5d"><code>1942363</code></a></td><td><code>build/pkgs/pynac/spkg-install.in: Back to PYTHON=python3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dcded5e3188eec1c4f0d1a81016783f506708fd"><code>9dcded5</code></a></td><td><code>src/bin/sage: Only do the check for an incomplete installation when run from the source tree</code></td></tr></table>




---

archive/issue_comments_453250.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nWith <code>./configure --with-python=/usr/bin/python3 --with-sage-venv=\"\\`pwd\\`/local/var/lib/sage/venv/python3.8\"</code>, I'm getting some doctest failures:\n\n```\nsage -t --long --warn-long 101.2 --random-seed=0 src/sage/misc/package.py  # 5 doctests failed\n```\n(because it doesn't find some Python packages). Also\n\n```\nsage -t --long --warn-long 101.2 --random-seed=0 src/sage_setup/find.py  # 2 doctests failed\nsage -t --long --warn-long 101.2 --random-seed=0 src/sage_setup/clean.py  # 1 doctest failed\n```\nDetails:\n\n```\nFile \"src/sage_setup/find.py\", line 365, in sage_setup.find.installed_files_by_module\nFailed example:\n    f1\nExpected:\n    'sage/structure/__init__.py'\nGot:\n    '/Users/palmieri/Library/Caches/com.apple.python/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.8/lib/python3.8/site-packages/sage/structure/__init__.cpython-38.pyc'\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 367, in sage_setup.find.installed_files_by_module\nFailed example:\n    f2\nExpected:\n    'sage/structure/....pyc'\nGot:\n    'sage/structure/__init__.py'\n**********************************************************************\nFile \"src/sage_setup/clean.py\", line 96, in sage_setup.clean._find_stale_files\nFailed example:\n    for f in stale_iter:\n        if f.endswith(skip_extensions): continue\n        if '/ext_data/' in f: continue\n        print('Found stale file: ' + f)\nExpected nothing\nGot:\n    Found stale file: /Users/palmieri/Library/Caches/com.apple.python/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.8/lib/python3.8/site-packages/sage/all_cmdline.cpython-38.pyc\n...\n[followed by many many lines of \"stale\" files]\n```",
    "created_at": "2021-04-05T23:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453250",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:96" align="right">comment:96</div>

With <code>./configure --with-python=/usr/bin/python3 --with-sage-venv="\`pwd\`/local/var/lib/sage/venv/python3.8"</code>, I'm getting some doctest failures:

```
sage -t --long --warn-long 101.2 --random-seed=0 src/sage/misc/package.py  # 5 doctests failed
```
(because it doesn't find some Python packages). Also

```
sage -t --long --warn-long 101.2 --random-seed=0 src/sage_setup/find.py  # 2 doctests failed
sage -t --long --warn-long 101.2 --random-seed=0 src/sage_setup/clean.py  # 1 doctest failed
```
Details:

```
File "src/sage_setup/find.py", line 365, in sage_setup.find.installed_files_by_module
Failed example:
    f1
Expected:
    'sage/structure/__init__.py'
Got:
    '/Users/palmieri/Library/Caches/com.apple.python/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.8/lib/python3.8/site-packages/sage/structure/__init__.cpython-38.pyc'
**********************************************************************
File "src/sage_setup/find.py", line 367, in sage_setup.find.installed_files_by_module
Failed example:
    f2
Expected:
    'sage/structure/....pyc'
Got:
    'sage/structure/__init__.py'
**********************************************************************
File "src/sage_setup/clean.py", line 96, in sage_setup.clean._find_stale_files
Failed example:
    for f in stale_iter:
        if f.endswith(skip_extensions): continue
        if '/ext_data/' in f: continue
        print('Found stale file: ' + f)
Expected nothing
Got:
    Found stale file: /Users/palmieri/Library/Caches/com.apple.python/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.8/lib/python3.8/site-packages/sage/all_cmdline.cpython-38.pyc
...
[followed by many many lines of "stale" files]
```



---

archive/issue_comments_453251.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nThe ones in `find` and `clean` are I think #31314.\n\nFor the failure in `package` I know what to do",
    "created_at": "2021-04-06T00:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453251",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:97" align="right">comment:97</div>

The ones in `find` and `clean` are I think #31314.

For the failure in `package` I know what to do



---

archive/issue_events_395631.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-06T00:04:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395631"
}
```



---

archive/issue_events_395632.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-06T00:04:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395632"
}
```



---

archive/issue_comments_453252.json:
```json
{
    "body": "<div id=\"comment:98\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e0c19ec5bf263ea75dffa0d5d7332daf37e6d6e\"><code>6e0c19e</code></a></td><td><code>sage.misc.package.installed_packages: After SAGE_SPKG_INST, also go through SAGE_VENV_SPKG_INST</code></td></tr></table>\n",
    "created_at": "2021-04-06T03:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453252",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:98"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e0c19ec5bf263ea75dffa0d5d7332daf37e6d6e"><code>6e0c19e</code></a></td><td><code>sage.misc.package.installed_packages: After SAGE_SPKG_INST, also go through SAGE_VENV_SPKG_INST</code></td></tr></table>




---

archive/issue_comments_453253.json:
```json
{
    "body": "Changed commit from **[`9dcded5`](https://github.com/sagemath/sagetrac-mirror/commit/9dcded5e3188eec1c4f0d1a81016783f506708fd)** to **[`6e0c19e`](https://github.com/sagemath/sagetrac-mirror/commit/6e0c19ec5bf263ea75dffa0d5d7332daf37e6d6e)**",
    "created_at": "2021-04-06T03:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453253",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9dcded5`](https://github.com/sagemath/sagetrac-mirror/commit/9dcded5e3188eec1c4f0d1a81016783f506708fd)** to **[`6e0c19e`](https://github.com/sagemath/sagetrac-mirror/commit/6e0c19ec5bf263ea75dffa0d5d7332daf37e6d6e)**



---

archive/issue_events_395633.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-06T04:22:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395633"
}
```



---

archive/issue_events_395634.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-06T04:22:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395634"
}
```



---

archive/issue_comments_453254.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nThe sage_setup doctest failures have vanished, but I am seeing different problems with `misc/package.py`:\n\n```\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 554, in sage.misc.package.package_manifest\nFailed example:\n    sagetex_manifest = package_manifest('sagetex')  # optional - build\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package.package_manifest[1]>\", line 1, in <module>\n        sagetex_manifest = package_manifest('sagetex')  # optional - build\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/misc/package.py\", line 570, in package_manifest\n        with open(stamp_file) as f:\n    FileNotFoundError: [Errno 2] No such file or directory: '/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/installed/sagetex-3.5'\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 555, in sage.misc.package.package_manifest\nFailed example:\n    sagetex_manifest['package_name'] == 'sagetex'  # optional - build\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package.package_manifest[2]>\", line 1, in <module>\n        sagetex_manifest['package_name'] == 'sagetex'  # optional - build\n    NameError: name 'sagetex_manifest' is not defined\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 557, in sage.misc.package.package_manifest\nFailed example:\n    'files' in sagetex_manifest  # optional - build\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package.package_manifest[3]>\", line 1, in <module>\n        'files' in sagetex_manifest  # optional - build\n    NameError: name 'sagetex_manifest' is not defined\n**********************************************************************\n```\nI guess the issue is that manifests are now written to two different places, depending on whether it's a Python package or not.",
    "created_at": "2021-04-06T21:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453254",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:100" align="right">comment:100</div>

The sage_setup doctest failures have vanished, but I am seeing different problems with `misc/package.py`:

```
**********************************************************************
File "src/sage/misc/package.py", line 554, in sage.misc.package.package_manifest
Failed example:
    sagetex_manifest = package_manifest('sagetex')  # optional - build
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package.package_manifest[1]>", line 1, in <module>
        sagetex_manifest = package_manifest('sagetex')  # optional - build
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/misc/package.py", line 570, in package_manifest
        with open(stamp_file) as f:
    FileNotFoundError: [Errno 2] No such file or directory: '/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/installed/sagetex-3.5'
**********************************************************************
File "src/sage/misc/package.py", line 555, in sage.misc.package.package_manifest
Failed example:
    sagetex_manifest['package_name'] == 'sagetex'  # optional - build
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package.package_manifest[2]>", line 1, in <module>
        sagetex_manifest['package_name'] == 'sagetex'  # optional - build
    NameError: name 'sagetex_manifest' is not defined
**********************************************************************
File "src/sage/misc/package.py", line 557, in sage.misc.package.package_manifest
Failed example:
    'files' in sagetex_manifest  # optional - build
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.rc1/local/var/lib/sage/venv/python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package.package_manifest[3]>", line 1, in <module>
        'files' in sagetex_manifest  # optional - build
    NameError: name 'sagetex_manifest' is not defined
**********************************************************************
```
I guess the issue is that manifests are now written to two different places, depending on whether it's a Python package or not.



---

archive/issue_events_395635.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-04-06T21:13:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395635"
}
```



---

archive/issue_events_395636.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-04-06T21:13:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395636"
}
```



---

archive/issue_comments_453255.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nRight, I forgot about this function. It will need a slightly generalized interface",
    "created_at": "2021-04-06T21:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453255",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:101" align="right">comment:101</div>

Right, I forgot about this function. It will need a slightly generalized interface



---

archive/issue_comments_453256.json:
```json
{
    "body": "<div id=\"comment:102\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5dd7bafb96de2ffd333da069470efa6c2f14da1\"><code>c5dd7ba</code></a></td><td><code>Merge tag '9.3.rc2' into t/29013/public/29013-use-py3-venv</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0fb082bce2c0d023aaccbe185f311b708c7f072\"><code>f0fb082</code></a></td><td><code>sage.misc.package.installed_packages: Refactor through new generator _spkg_inst_dirs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d68e86144b4a37600654899d2ab655ae55fb4378\"><code>d68e861</code></a></td><td><code>sage.misc.package.package_manifest: Go through all _spkg_inst_dirs()</code></td></tr></table>\n",
    "created_at": "2021-04-07T00:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453256",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:102"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5dd7bafb96de2ffd333da069470efa6c2f14da1"><code>c5dd7ba</code></a></td><td><code>Merge tag '9.3.rc2' into t/29013/public/29013-use-py3-venv</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0fb082bce2c0d023aaccbe185f311b708c7f072"><code>f0fb082</code></a></td><td><code>sage.misc.package.installed_packages: Refactor through new generator _spkg_inst_dirs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d68e86144b4a37600654899d2ab655ae55fb4378"><code>d68e861</code></a></td><td><code>sage.misc.package.package_manifest: Go through all _spkg_inst_dirs()</code></td></tr></table>




---

archive/issue_comments_453257.json:
```json
{
    "body": "Changed commit from **[`6e0c19e`](https://github.com/sagemath/sagetrac-mirror/commit/6e0c19ec5bf263ea75dffa0d5d7332daf37e6d6e)** to **[`d68e861`](https://github.com/sagemath/sagetrac-mirror/commit/d68e86144b4a37600654899d2ab655ae55fb4378)**",
    "created_at": "2021-04-07T00:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453257",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6e0c19e`](https://github.com/sagemath/sagetrac-mirror/commit/6e0c19ec5bf263ea75dffa0d5d7332daf37e6d6e)** to **[`d68e861`](https://github.com/sagemath/sagetrac-mirror/commit/d68e86144b4a37600654899d2ab655ae55fb4378)**



---

archive/issue_events_395637.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T00:27:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395637"
}
```



---

archive/issue_events_395638.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T00:27:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395638"
}
```



---

archive/issue_comments_453258.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nThat fixes the `package.py` doctest for me, thank you. I'm not sure I fully understand how venvs are supposed to work. If I do `./configure --with-sage-venv=... && make` and then separately do `./configure && make`, I should get two builds (as far as Python packages are concerned), which I could conceivably switch between, right? Now if I do `./configure && make pysingular`, then I can do `import PySingular`, but I switch to the other venv, I won't be able to. However, `'pysingular' in installed_packages()` returns `True` regardless of whether I'm using the venv, since it searches both installation directories.\n\n(a) Am I understanding the situation correctly? and\n\n(b) is it worth trying to fix?",
    "created_at": "2021-04-07T21:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453258",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:104" align="right">comment:104</div>

That fixes the `package.py` doctest for me, thank you. I'm not sure I fully understand how venvs are supposed to work. If I do `./configure --with-sage-venv=... && make` and then separately do `./configure && make`, I should get two builds (as far as Python packages are concerned), which I could conceivably switch between, right? Now if I do `./configure && make pysingular`, then I can do `import PySingular`, but I switch to the other venv, I won't be able to. However, `'pysingular' in installed_packages()` returns `True` regardless of whether I'm using the venv, since it searches both installation directories.

(a) Am I understanding the situation correctly? and

(b) is it worth trying to fix?



---

archive/issue_comments_453259.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">comment:105</div>\n\nReplying to [@jhpalmieri](#comment%3A104):\n> I'm not sure I fully understand how venvs are supposed to work. If I do `./configure --with-sage-venv=... && make` and then separately do `./configure && make`, I should get two builds (as far as Python packages are concerned), which I could conceivably switch between, right?\n\nYes, that's right. Separate for Python packages, sharing the non-Python packages, which are only in SAGE_LOCAL.\n\n> Now if I do `./configure && make pysingular`, then I can do `import PySingular`, but I switch to the other venv, I won't be able to. However, `'pysingular' in installed_packages()` returns `True` regardless of whether I'm using the venv, since it searches both installation directories.\n\nOK, thanks for catching this. Yes, the `sage.misc.package` code does not handle this situation correctly. I would simply suggest to not mix builds that use with `--with-sage-venv=...` with builds that don't. You can switch between several venvs in this way.",
    "created_at": "2021-04-07T22:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453259",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:105" align="right">comment:105</div>

Replying to [@jhpalmieri](#comment%3A104):
> I'm not sure I fully understand how venvs are supposed to work. If I do `./configure --with-sage-venv=... && make` and then separately do `./configure && make`, I should get two builds (as far as Python packages are concerned), which I could conceivably switch between, right?

Yes, that's right. Separate for Python packages, sharing the non-Python packages, which are only in SAGE_LOCAL.

> Now if I do `./configure && make pysingular`, then I can do `import PySingular`, but I switch to the other venv, I won't be able to. However, `'pysingular' in installed_packages()` returns `True` regardless of whether I'm using the venv, since it searches both installation directories.

OK, thanks for catching this. Yes, the `sage.misc.package` code does not handle this situation correctly. I would simply suggest to not mix builds that use with `--with-sage-venv=...` with builds that don't. You can switch between several venvs in this way.



---

archive/issue_events_395639.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-04-07T23:59:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395639"
}
```



---

archive/issue_events_395640.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-04-07T23:59:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395640"
}
```



---

archive/issue_comments_453260.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2021-04-07T23:59:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453260",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_453261.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">comment:106</div>\n\nGreat, let's merge it, then.",
    "created_at": "2021-04-07T23:59:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453261",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:106" align="right">comment:106</div>

Great, let's merge it, then.



---

archive/issue_comments_453262.json:
```json
{
    "body": "<div id=\"comment:107\" align=\"right\">comment:107</div>\n\nThank you!",
    "created_at": "2021-04-08T00:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453262",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:107" align="right">comment:107</div>

Thank you!



---

archive/issue_events_395641.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:30:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395641"
}
```



---

archive/issue_events_395642.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7ee621813419ab15b9c7c23bf1e0483768fdbaf7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-05-27T20:30:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29013#event-395642"
}
```



---

archive/issue_comments_453263.json:
```json
{
    "body": "Changed branch from **[public/29013-use-py3-venv](https://github.com/sagemath/sagetrac-mirror/tree/public/29013-use-py3-venv)** to **[`d68e861`](https://github.com/sagemath/sagetrac-mirror/commit/d68e86144b4a37600654899d2ab655ae55fb4378)**",
    "created_at": "2021-05-27T20:30:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29013#issuecomment-453263",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/29013-use-py3-venv](https://github.com/sagemath/sagetrac-mirror/tree/public/29013-use-py3-venv)** to **[`d68e861`](https://github.com/sagemath/sagetrac-mirror/commit/d68e86144b4a37600654899d2ab655ae55fb4378)**
