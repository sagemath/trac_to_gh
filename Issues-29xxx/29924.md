# Issue 29924: sage_setup: Do not fail if sage.env, sage.* are not available

archive/issues_029687.json:
```json
{
    "body": "... so that it can be used as a build system for the most fundamental distributions of parts of sagelib such as `sage-objects`, `sage-categories` without artificially including `sage.env` there (which is still done as of #29865).\n\n\nThis will require taking care of some dependencies:\n\nWe remove some dependencies on `sage.*` that are still in `sage_setup`: \n\n```\n./library_order.py:77:from sage.env import cython_aliases\n./command/sage_build_cython.py:21:from sage.env import (SAGE_INC, cython_aliases, sage_include_directories)\n```\n... by handling the case that the functions `sage_include_directories`, `cython_aliases` cannot be imported from sage.env\n\n... and removing the use of `SAGE_INC` by using instead the environment variables set in `sage-build-env-config` (this is #29855; see also #29711).\n\nHarmless dependencies on `sage.*`:\n\n```\n./docbuild/ ........\n  (will be invoked later, when sage.* is installed)\n./optional_extension.py:22:from sage.misc.package import list_packages\n./optional_extension.py:44:    from sage.misc.package import is_package_installed\n  (no longer used, only kept around in case user packages use it)\n./autogen/interpreters/__main__.py:4:from sage.env import SAGE_SRC\n  (only used when invoked interactively)\n./command/sage_install.py:28:        from sage.repl.ipython_kernel.install import SageKernelSpec\n  (just need to make sure that `sage_setup.command.sage_install` is only used by the distribution that installs `sage.repl.ipython_kernel`)\n```\n\n\n\n(split out from #29847)\n\n\nKeywords: sd111\n\nBranch: u/mkoeppe/sage_setup_without_sage_env_etc\n\nStatus: needs_review\n\nDependencies: #33812\n\nCommit: cb16b915315b3535460f76ab93907ed5075fb8cb\n\nIssue created by migration from https://trac.sagemath.org/ticket/29924\n\n",
    "created_at": "2020-06-21T01:30:21Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "sage_setup: Do not fail if sage.env, sage.* are not available",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29924",
    "user": "https://github.com/mkoeppe"
}
```
... so that it can be used as a build system for the most fundamental distributions of parts of sagelib such as `sage-objects`, `sage-categories` without artificially including `sage.env` there (which is still done as of #29865).


This will require taking care of some dependencies:

We remove some dependencies on `sage.*` that are still in `sage_setup`: 

```
./library_order.py:77:from sage.env import cython_aliases
./command/sage_build_cython.py:21:from sage.env import (SAGE_INC, cython_aliases, sage_include_directories)
```
... by handling the case that the functions `sage_include_directories`, `cython_aliases` cannot be imported from sage.env

... and removing the use of `SAGE_INC` by using instead the environment variables set in `sage-build-env-config` (this is #29855; see also #29711).

Harmless dependencies on `sage.*`:

```
./docbuild/ ........
  (will be invoked later, when sage.* is installed)
./optional_extension.py:22:from sage.misc.package import list_packages
./optional_extension.py:44:    from sage.misc.package import is_package_installed
  (no longer used, only kept around in case user packages use it)
./autogen/interpreters/__main__.py:4:from sage.env import SAGE_SRC
  (only used when invoked interactively)
./command/sage_install.py:28:        from sage.repl.ipython_kernel.install import SageKernelSpec
  (just need to make sure that `sage_setup.command.sage_install` is only used by the distribution that installs `sage.repl.ipython_kernel`)
```



(split out from #29847)


Keywords: sd111

Branch: u/mkoeppe/sage_setup_without_sage_env_etc

Status: needs_review

Dependencies: #33812

Commit: cb16b915315b3535460f76ab93907ed5075fb8cb

Issue created by migration from https://trac.sagemath.org/ticket/29924





---

archive/issue_comments_449303.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2020-11-14T06:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29924#issuecomment-449303",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_events_076740.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-14T06:36:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76740"
}
```



---

archive/issue_comments_449304.json:
```json
{
    "body": "<a id='comment:3'></a>Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29924#issuecomment-449304",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_449305.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29924#issuecomment-449305",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_events_076741.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76741"
}
```



---

archive/issue_events_076742.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76742"
}
```



---

archive/issue_events_076743.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76743"
}
```



---

archive/issue_events_076744.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76744"
}
```



---

archive/issue_events_076745.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76745"
}
```



---

archive/issue_events_076746.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76746"
}
```



---

archive/issue_events_076747.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-27T23:04:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76747"
}
```



---

archive/issue_events_076748.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-27T23:04:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29924#event-76748"
}
```



---

archive/issue_comments_449306.json:
```json
{
    "body": "<a id='comment:7'></a>obsolete with #33812",
    "created_at": "2022-08-27T23:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29924#issuecomment-449306",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>obsolete with #33812



---

archive/issue_comments_449307.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-27T23:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29924#issuecomment-449307",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.
