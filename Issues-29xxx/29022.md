# Issue 29022: Make sagelib installation directory more flexible by creating a module src/sage/env_config.py from src/sage/env_config.py.in, defining variables for use in sage.env

archive/issues_028785.json:
```json
{
    "assignees": [],
    "body": "This is a follow-up from #28225 - \"Allow sage to run in the absence of `sage-env`\". The present ticket also allows `$SAGE_LOCAL/bin/python` to run and import `sage.all` in the absence of the shell script `sage-env`. (Getting a fully functional `sage.all` is future work.)\n\nThis ticket also makes sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`), and to remove assumptions regarding install locations of sagelib relative to `$SAGE_LOCAL`.\n\n- To support users who want to install an experimental version of sagelib in other install locations, such as in a user site packages directory.\n- For making sagelib available in a user's venv, as in the following example:\n   Without this ticket:\n\n   ```\n   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n   $ source ~/personal-sage-venv/bin/activate\n   (personal-sage-venv) $ python\n   >>> import sage.env\n   >>> sage.env.SAGE_LOCAL\n   '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n   >>> import sage.all\n   RuntimeError: You must get the file local/bin/sage-maxima.lisp\n   ```\n   With this ticket:\n\n   ```\n   >>> sage.env.SAGE_LOCAL\n   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n   >>> import sage.all\n   >>> sage.all.maxima('1')\n   1\n   ```\n- To support #29013/#27824: spkg-configure.m4 for python3\n- To make it possible for distributions to use a stock `src/sage/env.py` (providing a custom `src/sage/env_conf.py`).\n\nIn a first step, we just set `SAGE_LOCAL` and `MAXIMA` (to the location of the `maxima` binary), but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module; see also #25486); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. \n\nIn a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.\n\n**Ticket #29038 provides an alternative implementation that uses an standalone installed Python module `sage_conf`, rather than writing into `src/sage`**\n\nRelated:\n- #21707: Split sage-env into sage-build-env and sage-env\n- #22652: Add a plain-text config file that feeds into sage.env\n- #21507: Task ticket: Make sagelib a pip-installable Python source package, listed on PyPI\n\n\nCC:  @kiwifb @antonio-rojas @isuruf @embray @infinity0 @timokau @jdemeyer @dimpase @jhpalmieri\n\nBranch/Commit: **[u/mkoeppe/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env) @ [7a43544](https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6)**\n\nReviewer: **Dima Pasechnik, Erik Bray**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29022_\n\n",
    "closed_at": "2020-01-31T11:27:27Z",
    "created_at": "2020-01-15T22:39:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make sagelib installation directory more flexible by creating a module src/sage/env_config.py from src/sage/env_config.py.in, defining variables for use in sage.env",
    "type": "issue",
    "updated_at": "2020-01-31T20:08:24Z",
    "url": "https://github.com/sagemath/sage/issues/29022",
    "user": "https://github.com/mkoeppe"
}
```
This is a follow-up from #28225 - "Allow sage to run in the absence of `sage-env`". The present ticket also allows `$SAGE_LOCAL/bin/python` to run and import `sage.all` in the absence of the shell script `sage-env`. (Getting a fully functional `sage.all` is future work.)

This ticket also makes sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`), and to remove assumptions regarding install locations of sagelib relative to `$SAGE_LOCAL`.

- To support users who want to install an experimental version of sagelib in other install locations, such as in a user site packages directory.
- For making sagelib available in a user's venv, as in the following example:
   Without this ticket:

   ```
   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
   $ source ~/personal-sage-venv/bin/activate
   (personal-sage-venv) $ python
   >>> import sage.env
   >>> sage.env.SAGE_LOCAL
   '/Users/mkoeppe/personal-sage-venv'                                     # wrong
   >>> import sage.all
   RuntimeError: You must get the file local/bin/sage-maxima.lisp
   ```
   With this ticket:

   ```
   >>> sage.env.SAGE_LOCAL
   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
   >>> import sage.all
   >>> sage.all.maxima('1')
   1
   ```
- To support #29013/#27824: spkg-configure.m4 for python3
- To make it possible for distributions to use a stock `src/sage/env.py` (providing a custom `src/sage/env_conf.py`).

In a first step, we just set `SAGE_LOCAL` and `MAXIMA` (to the location of the `maxima` binary), but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module; see also #25486); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. 

In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.

**Ticket #29038 provides an alternative implementation that uses an standalone installed Python module `sage_conf`, rather than writing into `src/sage`**

Related:
- #21707: Split sage-env into sage-build-env and sage-env
- #22652: Add a plain-text config file that feeds into sage.env
- #21507: Task ticket: Make sagelib a pip-installable Python source package, listed on PyPI


CC:  @kiwifb @antonio-rojas @isuruf @embray @infinity0 @timokau @jdemeyer @dimpase @jhpalmieri

Branch/Commit: **[u/mkoeppe/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env) @ [7a43544](https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6)**

Reviewer: **Dima Pasechnik, Erik Bray**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/29022_





---

archive/issue_events_367239.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T22:39:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367239"
}
```



---

archive/issue_events_367240.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T22:39:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367240"
}
```



---

archive/issue_events_367241.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T22:39:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367241"
}
```



---

archive/issue_events_367242.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T22:40:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "title_is": "Create module src/sage/env_config.py from src/sage/env_config.py.in, defining variables for use in sage.env",
    "title_was": "src/setup.py: Create module sage.env_config, which defines variables for use in sage.env",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367242"
}
```



---

archive/issue_comments_456373.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,12 @@\n+This is a step toward #25486: \"`$SAGE_LOCAL/bin/sage` should work in an environment without `SAGE_*` variables; and also useful for #29013.\n \n+In a first step, we just set `SAGE_LOCAL`, but later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. \n+\n+The hope is that distributions would be able to use a stock `src/sage/env.py` and a custom `src/sage/env_conf.py`.\n+\n+In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.\n+\n+Related:\n+- #21707: Split sage-env into sage-build-env and sage-env\n+- #22652: Add a plain-text config file that feeds into sage.env\n+\n``````\n",
    "created_at": "2020-01-15T22:50:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456373",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,12 @@
+This is a step toward #25486: "`$SAGE_LOCAL/bin/sage` should work in an environment without `SAGE_*` variables; and also useful for #29013.
 
+In a first step, we just set `SAGE_LOCAL`, but later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. 
+
+The hope is that distributions would be able to use a stock `src/sage/env.py` and a custom `src/sage/env_conf.py`.
+
+In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.
+
+Related:
+- #21707: Split sage-env into sage-build-env and sage-env
+- #22652: Add a plain-text config file that feeds into sage.env
+
``````




---

archive/issue_comments_456374.json:
```json
{
    "body": "Branch: **[u/mkoeppe/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env)**",
    "created_at": "2020-01-15T23:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456374",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env)**



---

archive/issue_comments_456375.json:
```json
{
    "body": "Commit: **[bba08ec](https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23)**",
    "created_at": "2020-01-15T23:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456375",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[bba08ec](https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23)**



---

archive/issue_comments_456376.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-01-15T23:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456376",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_456377.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23\">bba08ec</a></td><td><code>Create module src/sage/env_config.py from src/sage/env_config.py.in, defining SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2020-01-15T23:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456377",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'>Comment 4:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23">bba08ec</a></td><td><code>Create module src/sage/env_config.py from src/sage/env_config.py.in, defining SAGE_LOCAL</code></td></tr></table>




---

archive/issue_events_367243.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T23:30:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367243"
}
```



---

archive/issue_comments_456378.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nInteresting concept. But your branch won't achieve much since `SAGE_LOCAL` is not `None`. In fact the problem of the value of `SAGE_LOCAL` is solved in most case by the current setting of `os.path.abspath(sys.prefix)`. Did you mean to set `SAGE_ROOT`?",
    "created_at": "2020-01-16T01:10:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456378",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'>Comment 5:</a>
Interesting concept. But your branch won't achieve much since `SAGE_LOCAL` is not `None`. In fact the problem of the value of `SAGE_LOCAL` is solved in most case by the current setting of `os.path.abspath(sys.prefix)`. Did you mean to set `SAGE_ROOT`?



---

archive/issue_comments_456379.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@kiwifb](#comment%3A5):\n> Interesting concept. But your branch won't achieve much since `SAGE_LOCAL` is not `None`. In fact the problem of the value of `SAGE_LOCAL` is solved in most case by the current setting of `os.path.abspath(sys.prefix)`. \n\n1) With #29013, `os.path.abspath(sys.prefix)` is the location of the venv, and not equal to `SAGE_LOCAL`.\n\n2) If one starts Sage's Python directly, without going through `sage-env`, then the environment variable `SAGE_LOCAL` is not set; and in this case it is retrieved from `env_config.py`.",
    "created_at": "2020-01-16T01:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456379",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@kiwifb](#comment%3A5):
> Interesting concept. But your branch won't achieve much since `SAGE_LOCAL` is not `None`. In fact the problem of the value of `SAGE_LOCAL` is solved in most case by the current setting of `os.path.abspath(sys.prefix)`. 

1) With #29013, `os.path.abspath(sys.prefix)` is the location of the venv, and not equal to `SAGE_LOCAL`.

2) If one starts Sage's Python directly, without going through `sage-env`, then the environment variable `SAGE_LOCAL` is not set; and in this case it is retrieved from `env_config.py`.



---

archive/issue_comments_456380.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBut yes, let's add `SAGE_ROOT` to it.",
    "created_at": "2020-01-16T01:21:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456380",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
But yes, let's add `SAGE_ROOT` to it.



---

archive/issue_comments_456381.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nI misunderstood the way the code works in `var`. I thought your value from `env_config.py` wouldn't be used.\nFor your points\n 1) OK - I get it, that's a problem\n\n 2) I am perfectly happy with it being set as `os.path.abspath(sys.prefix)` if `sage-env` is not loaded as it is now. But your alternative is acceptable and of course solves your issue at (1).\n\nI removed `sage-env` completely from sage-on-gentoo a number of releases ago and it does work nicely with very little patching (I upstreamed most of it). There is only one place now where I have to replace a call to `SAGE_ROOT` at runtime (in `sage.misc.copying`). I'd say sage works at 99.99% out of the box without needing `sage-env`, in particular you should be able to call it directly from python. \n\nHowever \n 1) your venv work may introduce a few disparities\n\n 2) being able to override some default from a standardised configuration file instead of patching for your distro values is very appealing.\n\nI don't particularly need `SAGE_ROOT` to be set (in fact `None` suits me just fine since it doesn't make much sense on a distro), it was just my misconception on what you were doing.",
    "created_at": "2020-01-16T01:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456381",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'>Comment 8:</a>
I misunderstood the way the code works in `var`. I thought your value from `env_config.py` wouldn't be used.
For your points
 1) OK - I get it, that's a problem

 2) I am perfectly happy with it being set as `os.path.abspath(sys.prefix)` if `sage-env` is not loaded as it is now. But your alternative is acceptable and of course solves your issue at (1).

I removed `sage-env` completely from sage-on-gentoo a number of releases ago and it does work nicely with very little patching (I upstreamed most of it). There is only one place now where I have to replace a call to `SAGE_ROOT` at runtime (in `sage.misc.copying`). I'd say sage works at 99.99% out of the box without needing `sage-env`, in particular you should be able to call it directly from python. 

However 
 1) your venv work may introduce a few disparities

 2) being able to override some default from a standardised configuration file instead of patching for your distro values is very appealing.

I don't particularly need `SAGE_ROOT` to be set (in fact `None` suits me just fine since it doesn't make much sense on a distro), it was just my misconception on what you were doing.



---

archive/issue_comments_456382.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@kiwifb](#comment%3A8):\n> I don't particularly need `SAGE_ROOT` to be set (in fact `None` suits me just fine since it doesn't make much sense on a distro), it was just my misconception on what you were doing.\n\nYes, I agree that SAGE_ROOT is not very important, but it's still used for developer convenience functions like those in `sage.misc.edit_module`.",
    "created_at": "2020-01-16T01:58:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456382",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@kiwifb](#comment%3A8):
> I don't particularly need `SAGE_ROOT` to be set (in fact `None` suits me just fine since it doesn't make much sense on a distro), it was just my misconception on what you were doing.

Yes, I agree that SAGE_ROOT is not very important, but it's still used for developer convenience functions like those in `sage.misc.edit_module`.



---

archive/issue_comments_456383.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@mkoeppe](#comment%3A9):\n> Replying to [@kiwifb](#comment%3A8):\n> > I don't particularly need `SAGE_ROOT` to be set (in fact `None` suits me just fine since it doesn't make much sense on a distro), it was just my misconception on what you were doing.\n\n> \n> Yes, I agree that SAGE_ROOT is not very important, but it's still used for developer convenience functions like those in `sage.misc.edit_module`.\n\n`SAGE_ROOT` is mentioned in the documentation string for `edit_devel` but is otherwise absent. The bit in documentation should have been amended at the same time as https://github.com/sagemath/sage/commit/c352b1d5920ce9ffaebada2fe172784b2ba3e3fb#diff-141c6e649507c15775d157f417db1e26 I guess.\n\nAlmost all of the `SAGE_ROOT` stuff left pertains to packaging I think.",
    "created_at": "2020-01-16T02:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456383",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@mkoeppe](#comment%3A9):
> Replying to [@kiwifb](#comment%3A8):
> > I don't particularly need `SAGE_ROOT` to be set (in fact `None` suits me just fine since it doesn't make much sense on a distro), it was just my misconception on what you were doing.

> 
> Yes, I agree that SAGE_ROOT is not very important, but it's still used for developer convenience functions like those in `sage.misc.edit_module`.

`SAGE_ROOT` is mentioned in the documentation string for `edit_devel` but is otherwise absent. The bit in documentation should have been amended at the same time as https://github.com/sagemath/sage/commit/c352b1d5920ce9ffaebada2fe172784b2ba3e3fb#diff-141c6e649507c15775d157f417db1e26 I guess.

Almost all of the `SAGE_ROOT` stuff left pertains to packaging I think.



---

archive/issue_comments_456384.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nNote `SAGE_SRC` is defined through `SAGE_ROOT`.",
    "created_at": "2020-01-16T02:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456384",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'>Comment 11:</a>
Note `SAGE_SRC` is defined through `SAGE_ROOT`.



---

archive/issue_comments_456385.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@mkoeppe](#comment%3A11):\n> Note `SAGE_SRC` is defined through `SAGE_ROOT`.\n\n```\nvar('SAGE_SRC',            join(SAGE_ROOT, 'src'), SAGE_LIB)\n```\nI made sure of that :) - so if `SAGE_ROOT` is `None`, `SAGE_SRC` is set to `SAGE_LIB`. I guess you may prefer the `SAGE_ROOT` based value. But on a distro it will give me a read only view of the code (which is the best you should hope for if you install stuff with your distro package manager).",
    "created_at": "2020-01-16T02:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456385",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@mkoeppe](#comment%3A11):
> Note `SAGE_SRC` is defined through `SAGE_ROOT`.

```
var('SAGE_SRC',            join(SAGE_ROOT, 'src'), SAGE_LIB)
```
I made sure of that :) - so if `SAGE_ROOT` is `None`, `SAGE_SRC` is set to `SAGE_LIB`. I guess you may prefer the `SAGE_ROOT` based value. But on a distro it will give me a read only view of the code (which is the best you should hope for if you install stuff with your distro package manager).



---

archive/issue_comments_456386.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI don't see why it needs to explicitly be a Python module.  I think my proposal in #22652 is simpler, because the same file could be used both for configuring the shell environment, and can be read by the Python code.\n\nTo me this just seems like extra cruft.",
    "created_at": "2020-01-16T11:52:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456386",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'>Comment 13:</a>
I don't see why it needs to explicitly be a Python module.  I think my proposal in #22652 is simpler, because the same file could be used both for configuring the shell environment, and can be read by the Python code.

To me this just seems like extra cruft.



---

archive/issue_comments_456387.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@mkoeppe](#comment%3A6):\n> Replying to [@kiwifb](#comment%3A5):\n> > Interesting concept. But your branch won't achieve much since `SAGE_LOCAL` is not `None`. In fact the problem of the value of `SAGE_LOCAL` is solved in most case by the current setting of `os.path.abspath(sys.prefix)`. \n\n> \n> 1) With #29013, `os.path.abspath(sys.prefix)` is the location of the venv, and not equal to `SAGE_LOCAL`.\n\n`sys.prefix` may not be, but even in a venv `sysconfig.get_config_var('prefix')` will always give you the original install prefix for Python, which when using Sage's Python *will* be `SAGE_LOCAL`.",
    "created_at": "2020-01-16T12:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456387",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@mkoeppe](#comment%3A6):
> Replying to [@kiwifb](#comment%3A5):
> > Interesting concept. But your branch won't achieve much since `SAGE_LOCAL` is not `None`. In fact the problem of the value of `SAGE_LOCAL` is solved in most case by the current setting of `os.path.abspath(sys.prefix)`. 

> 
> 1) With #29013, `os.path.abspath(sys.prefix)` is the location of the venv, and not equal to `SAGE_LOCAL`.

`sys.prefix` may not be, but even in a venv `sysconfig.get_config_var('prefix')` will always give you the original install prefix for Python, which when using Sage's Python *will* be `SAGE_LOCAL`.



---

archive/issue_comments_456388.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@embray](#comment%3A13):\n> I don't see why it needs to explicitly be a Python module.  I think my proposal in #22652 is simpler, because the same file could be used both for configuring the shell environment, and can be read by the Python code.\n> \n> To me this just seems like extra cruft.\n\nFor example, a file like this could be generated at build time by running something like:\n\n```\n$ (source src/bin/sage-env-config && env | grep '^SAGE_' | sort)\nSAGE_ARB_LIBRARY=arb\nSAGE_CONFIGURE_FLINT=--with-flint=/home/embray/src/sagemath/sage/local\nSAGE_CONFIGURE_GMP=--with-gmp=/home/embray/src/sagemath/sage/local\nSAGE_CONFIGURE_MPC=--with-mpc=/home/embray/src/sagemath/sage/local\nSAGE_CONFIGURE_MPFR=--with-mpfr=/home/embray/src/sagemath/sage/local\nSAGE_CONFIGURE_NTL=--with-ntl=/home/embray/src/sagemath/sage/local\nSAGE_CONFIGURE_PARI=--with-pari=/home/embray/src/sagemath/sage/local\nSAGE_CRTI_DIR=\nSAGE_FLINT_PREFIX=/home/embray/src/sagemath/sage/local\nSAGE_FREETYPE_PREFIX=\nSAGE_GLPK_PREFIX=/home/embray/src/sagemath/sage/local\nSAGE_GMP_INCLUDE=/home/embray/src/sagemath/sage/local/include\nSAGE_GMP_PREFIX=/home/embray/src/sagemath/sage/local\nSAGE_LOCAL=/home/embray/src/sagemath/sage/local\nSAGE_MPC_PREFIX=/home/embray/src/sagemath/sage/local\nSAGE_MPFR_PREFIX=/home/embray/src/sagemath/sage/local\nSAGE_NTL_PREFIX=/home/embray/src/sagemath/sage/local\nSAGE_PARI_CFG=/home/embray/src/sagemath/sage/local/lib/pari/pari.cfg\nSAGE_PARI_PREFIX=/home/embray/src/sagemath/sage/local\nSAGE_PKG_CONFIG_PATH=\nSAGE_PYTHON_VERSION=2\n```\n\nIt could be output to a .py module that's (optionally) imported by `sage.env`, or just a \".env\" file (a common extension being used in recent years for a file like this that specifies some environment variables for a project).  Distros, if they wish, could write their own version of this file without patching.",
    "created_at": "2020-01-16T12:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456388",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@embray](#comment%3A13):
> I don't see why it needs to explicitly be a Python module.  I think my proposal in #22652 is simpler, because the same file could be used both for configuring the shell environment, and can be read by the Python code.
> 
> To me this just seems like extra cruft.

For example, a file like this could be generated at build time by running something like:

```
$ (source src/bin/sage-env-config && env | grep '^SAGE_' | sort)
SAGE_ARB_LIBRARY=arb
SAGE_CONFIGURE_FLINT=--with-flint=/home/embray/src/sagemath/sage/local
SAGE_CONFIGURE_GMP=--with-gmp=/home/embray/src/sagemath/sage/local
SAGE_CONFIGURE_MPC=--with-mpc=/home/embray/src/sagemath/sage/local
SAGE_CONFIGURE_MPFR=--with-mpfr=/home/embray/src/sagemath/sage/local
SAGE_CONFIGURE_NTL=--with-ntl=/home/embray/src/sagemath/sage/local
SAGE_CONFIGURE_PARI=--with-pari=/home/embray/src/sagemath/sage/local
SAGE_CRTI_DIR=
SAGE_FLINT_PREFIX=/home/embray/src/sagemath/sage/local
SAGE_FREETYPE_PREFIX=
SAGE_GLPK_PREFIX=/home/embray/src/sagemath/sage/local
SAGE_GMP_INCLUDE=/home/embray/src/sagemath/sage/local/include
SAGE_GMP_PREFIX=/home/embray/src/sagemath/sage/local
SAGE_LOCAL=/home/embray/src/sagemath/sage/local
SAGE_MPC_PREFIX=/home/embray/src/sagemath/sage/local
SAGE_MPFR_PREFIX=/home/embray/src/sagemath/sage/local
SAGE_NTL_PREFIX=/home/embray/src/sagemath/sage/local
SAGE_PARI_CFG=/home/embray/src/sagemath/sage/local/lib/pari/pari.cfg
SAGE_PARI_PREFIX=/home/embray/src/sagemath/sage/local
SAGE_PKG_CONFIG_PATH=
SAGE_PYTHON_VERSION=2
```

It could be output to a .py module that's (optionally) imported by `sage.env`, or just a ".env" file (a common extension being used in recent years for a file like this that specifies some environment variables for a project).  Distros, if they wish, could write their own version of this file without patching.



---

archive/issue_comments_456389.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@embray](#comment%3A14):\n> Replying to [@mkoeppe](#comment%3A6):\n> > Replying to [@kiwifb](#comment%3A5):\n> > > Interesting concept. But your branch won't achieve much since `SAGE_LOCAL` is not `None`. In fact the problem of the value of `SAGE_LOCAL` is solved in most case by the current setting of `os.path.abspath(sys.prefix)`. \n\n> > \n> > 1) With #29013, `os.path.abspath(sys.prefix)` is the location of the venv, and not equal to `SAGE_LOCAL`.\n\n> \n> `sys.prefix` may not be, but even in a venv `sysconfig.get_config_var('prefix')` will always give you the original install prefix for Python, which when using Sage's Python *will* be `SAGE_LOCAL`.\n\nThanks for this useful info. The purpose of this ticket, however, is to get rid of assumptions like that, to enable use of system python, see #27824.",
    "created_at": "2020-01-16T12:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456389",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@embray](#comment%3A14):
> Replying to [@mkoeppe](#comment%3A6):
> > Replying to [@kiwifb](#comment%3A5):
> > > Interesting concept. But your branch won't achieve much since `SAGE_LOCAL` is not `None`. In fact the problem of the value of `SAGE_LOCAL` is solved in most case by the current setting of `os.path.abspath(sys.prefix)`. 

> > 
> > 1) With #29013, `os.path.abspath(sys.prefix)` is the location of the venv, and not equal to `SAGE_LOCAL`.

> 
> `sys.prefix` may not be, but even in a venv `sysconfig.get_config_var('prefix')` will always give you the original install prefix for Python, which when using Sage's Python *will* be `SAGE_LOCAL`.

Thanks for this useful info. The purpose of this ticket, however, is to get rid of assumptions like that, to enable use of system python, see #27824.



---

archive/issue_comments_456390.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nYeah, I see what you're saying.  Long term I think it would be great if we could get rid of \"SAGE_LOCAL\" altogether, though I'm not exactly sure what the alternative looks like either...",
    "created_at": "2020-01-16T14:04:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456390",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'>Comment 17:</a>
Yeah, I see what you're saying.  Long term I think it would be great if we could get rid of "SAGE_LOCAL" altogether, though I'm not exactly sure what the alternative looks like either...



---

archive/issue_comments_456391.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nNeeds review.",
    "created_at": "2020-01-17T14:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456391",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>Comment 19:</a>
Needs review.



---

archive/issue_events_367244.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-17T15:12:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367244"
}
```



---

archive/issue_events_367245.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-17T15:12:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367245"
}
```



---

archive/issue_comments_456392.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nSorry, I'm just not convinced this is useful.  At least not yet.  It's not needed for setting SAGE_LOCAL.  I do agree something like this might be useful for setting other paths related to Sage's dependencies, but I don't think that's necessarily something that should be output by a configure script either, but rather should be loaded from a config file that downstream packagers can modify without patching if need be.\n\nTo expand on that a bit, the sage-the-distribution configure script is not generally run by packagers.  Instead, this should be handled at the level of the sagelib package itself.",
    "created_at": "2020-01-17T15:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456392",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'>Comment 20:</a>
Sorry, I'm just not convinced this is useful.  At least not yet.  It's not needed for setting SAGE_LOCAL.  I do agree something like this might be useful for setting other paths related to Sage's dependencies, but I don't think that's necessarily something that should be output by a configure script either, but rather should be loaded from a config file that downstream packagers can modify without patching if need be.

To expand on that a bit, the sage-the-distribution configure script is not generally run by packagers.  Instead, this should be handled at the level of the sagelib package itself.



---

archive/issue_comments_456393.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@embray](#comment%3A20):\n> I don't think that's necessarily something that should be output by a configure script either, but rather should be loaded from a config file that downstream packagers can modify without patching if need be.\n\nSage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.",
    "created_at": "2020-01-17T15:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456393",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@embray](#comment%3A20):
> I don't think that's necessarily something that should be output by a configure script either, but rather should be loaded from a config file that downstream packagers can modify without patching if need be.

Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.



---

archive/issue_comments_456394.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@mkoeppe](#comment%3A21):\n> Replying to [@embray](#comment%3A20):\n> > I don't think that's necessarily something that should be output by a configure script either, but rather should be loaded from a config file that downstream packagers can modify without patching if need be.\n\n> Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.\n\nIf that's the case, I don't think `env_config.py.in` should even be directly in the sage package.  But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package, but that would be a step handled by setup.py.  I also still fail to see the point of making it an actual Python module.",
    "created_at": "2020-01-17T15:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456394",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@mkoeppe](#comment%3A21):
> Replying to [@embray](#comment%3A20):
> > I don't think that's necessarily something that should be output by a configure script either, but rather should be loaded from a config file that downstream packagers can modify without patching if need be.

> Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.

If that's the case, I don't think `env_config.py.in` should even be directly in the sage package.  But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package, but that would be a step handled by setup.py.  I also still fail to see the point of making it an actual Python module.



---

archive/issue_comments_456395.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI think what I also need to see here is a concrete use case...",
    "created_at": "2020-01-17T15:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456395",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'>Comment 23:</a>
I think what I also need to see here is a concrete use case...



---

archive/issue_comments_456396.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@embray](#comment%3A22):\n> Replying to [@mkoeppe](#comment%3A21):\n> > Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.\n\n> \n> If that's the case, I don't think `env_config.py.in` should even be directly in the sage package. \n\nIt's the autoconf standard to have templates right next to the file they are templating.\n\n> But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package, but that would be a step handled by setup.py. \n\nI actually agree with that, as you can see in the ticket description: **In a follow-up ticket, src/sage/env_config.py would actually be generated by src/setup.py, not configure.**\n\n>  I also still fail to see the point of making it an actual Python module.\n\nIt's the easiest way to import values into Python, without having to fight about the \"correct\" file format to use. toml, anyone?",
    "created_at": "2020-01-17T15:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456396",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@embray](#comment%3A22):
> Replying to [@mkoeppe](#comment%3A21):
> > Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.

> 
> If that's the case, I don't think `env_config.py.in` should even be directly in the sage package. 

It's the autoconf standard to have templates right next to the file they are templating.

> But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package, but that would be a step handled by setup.py. 

I actually agree with that, as you can see in the ticket description: **In a follow-up ticket, src/sage/env_config.py would actually be generated by src/setup.py, not configure.**

>  I also still fail to see the point of making it an actual Python module.

It's the easiest way to import values into Python, without having to fight about the "correct" file format to use. toml, anyone?



---

archive/issue_comments_456397.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@mkoeppe](#comment%3A24):\n> Replying to [@embray](#comment%3A22):\n> > Replying to [@mkoeppe](#comment%3A21):\n> > > Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.\n\n> > \n> > If that's the case, I don't think `env_config.py.in` should even be directly in the sage package. \n\n> \n> It's the autoconf standard to have templates right next to the file they are templating.\n> \n> > But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package, but that would be a step handled by setup.py. \n\n> \n> I actually agree with that, as you can see in the ticket description: **In a follow-up ticket, src/sage/env_config.py would actually be generated by src/setup.py, not configure.**\n\nI think if we started with that, and put the .in file just directly under src/ instead of src/sage I'd be less concerned about this (I still don't see the need, but I wouldn't fight it as much).\n\n> >  I also still fail to see the point of making it an actual Python module.\n\n> \n> It's the easiest way to import values into Python, without having to fight about the \"correct\" file format to use. toml, anyone?\n\nI already suggested a \".env\" format which is just one \"KEY=VALUE\" per line, and can also be sourced by shell scripts.",
    "created_at": "2020-01-17T16:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456397",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@mkoeppe](#comment%3A24):
> Replying to [@embray](#comment%3A22):
> > Replying to [@mkoeppe](#comment%3A21):
> > > Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.

> > 
> > If that's the case, I don't think `env_config.py.in` should even be directly in the sage package. 

> 
> It's the autoconf standard to have templates right next to the file they are templating.
> 
> > But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package, but that would be a step handled by setup.py. 

> 
> I actually agree with that, as you can see in the ticket description: **In a follow-up ticket, src/sage/env_config.py would actually be generated by src/setup.py, not configure.**

I think if we started with that, and put the .in file just directly under src/ instead of src/sage I'd be less concerned about this (I still don't see the need, but I wouldn't fight it as much).

> >  I also still fail to see the point of making it an actual Python module.

> 
> It's the easiest way to import values into Python, without having to fight about the "correct" file format to use. toml, anyone?

I already suggested a ".env" format which is just one "KEY=VALUE" per line, and can also be sourced by shell scripts.



---

archive/issue_comments_456398.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@embray](#comment%3A25):\n> > > But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package, but that would be a step handled by setup.py. \n\n> > \n> > I actually agree with that, as you can see in the ticket description: **In a follow-up ticket, src/sage/env_config.py would actually be generated by src/setup.py, not configure.**\n\n> \n> I think if we started with that, and put the .in file just directly under src/ instead of src/sage I'd be less concerned about this \n\nBy making it a Python module in src/sage, it is installed by the standard facilities (`setup.py`) that already work now, not in some unspecified future.",
    "created_at": "2020-01-17T16:24:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456398",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@embray](#comment%3A25):
> > > But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package, but that would be a step handled by setup.py. 

> > 
> > I actually agree with that, as you can see in the ticket description: **In a follow-up ticket, src/sage/env_config.py would actually be generated by src/setup.py, not configure.**

> 
> I think if we started with that, and put the .in file just directly under src/ instead of src/sage I'd be less concerned about this 

By making it a Python module in src/sage, it is installed by the standard facilities (`setup.py`) that already work now, not in some unspecified future.



---

archive/issue_comments_456399.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI note here that everything about our installation of non-Python components that reside in `src/` is ad-hoc and we seem to have been unable to make progress on this in years. Relevant tickets:\n- #21785 - Installation of SAGE_SRC/ext/ in SAGE_LOCAL/share/sage/ext/ should be done by setup.py, not build/make/Makefile\n- #22655 - Support package_data-like of non-Python resource files in Python packages\n- #21569 - Install src/bin/* scripts via setup.py (scripts, console_scripts)\nThat's why I prefer an actionable solution that uses a solid part - the installation of Python modules.",
    "created_at": "2020-01-17T16:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456399",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'>Comment 27:</a>
I note here that everything about our installation of non-Python components that reside in `src/` is ad-hoc and we seem to have been unable to make progress on this in years. Relevant tickets:
- #21785 - Installation of SAGE_SRC/ext/ in SAGE_LOCAL/share/sage/ext/ should be done by setup.py, not build/make/Makefile
- #22655 - Support package_data-like of non-Python resource files in Python packages
- #21569 - Install src/bin/* scripts via setup.py (scripts, console_scripts)
That's why I prefer an actionable solution that uses a solid part - the installation of Python modules.



---

archive/issue_comments_456400.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,29 @@\n-This is a step toward #25486: \"`$SAGE_LOCAL/bin/sage` should work in an environment without `SAGE_*` variables; and also useful for #29013.\n+This ticket makes sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`), and to remove assumptions regarding install locations of sagelib relative to `$SAGE_LOCAL`.\n \n-In a first step, we just set `SAGE_LOCAL`, but later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. \n+- To support users who want to install an experimental version of sagelib in other install locations, such as in a user site packages directory.\n+- For making sagelib available in a user's venv, as in the following example:\n+   Without this ticket:\n \n-The hope is that distributions would be able to use a stock `src/sage/env.py` and a custom `src/sage/env_conf.py`.\n+   ```\n+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n+   >>> import sage.env\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n+   >>> import sage.all\n+   RuntimeError: You must get the file local/bin/sage-maxima.lisp\n+   ```\n+   With this ticket:\n+\n+   ```\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n+   >>> import sage.all\n+   >>>\n+   ```\n+- To support #29013/#27824: spkg-configure.m4 for python3\n+- To make it possible for distributions to use a stock `src/sage/env.py` (providing a custom `src/sage/env_conf.py`).\n+\n+In a first step, we just set `SAGE_LOCAL`, but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. \n \n In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.\n \n``````\n",
    "created_at": "2020-01-17T17:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456400",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,29 @@
-This is a step toward #25486: "`$SAGE_LOCAL/bin/sage` should work in an environment without `SAGE_*` variables; and also useful for #29013.
+This ticket makes sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`), and to remove assumptions regarding install locations of sagelib relative to `$SAGE_LOCAL`.
 
-In a first step, we just set `SAGE_LOCAL`, but later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. 
+- To support users who want to install an experimental version of sagelib in other install locations, such as in a user site packages directory.
+- For making sagelib available in a user's venv, as in the following example:
+   Without this ticket:
 
-The hope is that distributions would be able to use a stock `src/sage/env.py` and a custom `src/sage/env_conf.py`.
+   ```
+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
+   >>> import sage.env
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong
+   >>> import sage.all
+   RuntimeError: You must get the file local/bin/sage-maxima.lisp
+   ```
+   With this ticket:
+
+   ```
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
+   >>> import sage.all
+   >>>
+   ```
+- To support #29013/#27824: spkg-configure.m4 for python3
+- To make it possible for distributions to use a stock `src/sage/env.py` (providing a custom `src/sage/env_conf.py`).
+
+In a first step, we just set `SAGE_LOCAL`, but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. 
 
 In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.
 
``````




---

archive/issue_comments_456401.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nI've expanded on the explanation of the goals of this ticket.",
    "created_at": "2020-01-17T17:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456401",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'>Comment 28:</a>
I've expanded on the explanation of the goals of this ticket.



---

archive/issue_events_367246.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-17T17:22:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "title_is": "Make sagelib installation directory more flexible by creating a module src/sage/env_config.py from src/sage/env_config.py.in, defining variables for use in sage.env",
    "title_was": "Create module src/sage/env_config.py from src/sage/env_config.py.in, defining variables for use in sage.env",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367246"
}
```



---

archive/issue_comments_456402.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,8 @@\n \n    ```\n    $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n+   $ source ~/personal-sage-venv/bin/activate\n+   (personal-sage-venv) $ python\n    >>> import sage.env\n    >>> sage.env.SAGE_LOCAL\n    '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n``````\n",
    "created_at": "2020-01-17T17:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456402",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,8 @@
 
    ```
    $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
+   $ source ~/personal-sage-venv/bin/activate
+   (personal-sage-venv) $ python
    >>> import sage.env
    >>> sage.env.SAGE_LOCAL
    '/Users/mkoeppe/personal-sage-venv'                                     # wrong
``````




---

archive/issue_comments_456403.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,4 +32,5 @@\n Related:\n - #21707: Split sage-env into sage-build-env and sage-env\n - #22652: Add a plain-text config file that feeds into sage.env\n+- #21507: Task ticket: Make sagelib a pip-installable Python source package, listed on PyPI\n \n``````\n",
    "created_at": "2020-01-17T17:24:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456403",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,4 +32,5 @@
 Related:
 - #21707: Split sage-env into sage-build-env and sage-env
 - #22652: Add a plain-text config file that feeds into sage.env
+- #21507: Task ticket: Make sagelib a pip-installable Python source package, listed on PyPI
 
``````




---

archive/issue_comments_456404.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@embray](#comment%3A23):\n> I think what I also need to see here is a concrete use case...\n\nTake a look a the new ticket description please.",
    "created_at": "2020-01-17T17:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456404",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@embray](#comment%3A23):
> I think what I also need to see here is a concrete use case...

Take a look a the new ticket description please.



---

archive/issue_events_367247.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-17T17:55:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367247"
}
```



---

archive/issue_events_367248.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-17T17:55:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367248"
}
```



---

archive/issue_comments_456405.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-This ticket makes sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`), and to remove assumptions regarding install locations of sagelib relative to `$SAGE_LOCAL`.\n+This is a follow-up from #28225 - \"Allow sage to run in the absence of `sage-env`\". The present ticket also allows `$SAGE_LOCAL/bin/python` to run and import `sage.all` in the absence of the shell script `sage-env`. (Getting a fully functional `sage.all` is future work.)\n+\n+This ticket also makes sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`), and to remove assumptions regarding install locations of sagelib relative to `$SAGE_LOCAL`.\n \n - To support users who want to install an experimental version of sagelib in other install locations, such as in a user site packages directory.\n - For making sagelib available in a user's venv, as in the following example:\n``````\n",
    "created_at": "2020-01-17T19:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456405",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-This ticket makes sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`), and to remove assumptions regarding install locations of sagelib relative to `$SAGE_LOCAL`.
+This is a follow-up from #28225 - "Allow sage to run in the absence of `sage-env`". The present ticket also allows `$SAGE_LOCAL/bin/python` to run and import `sage.all` in the absence of the shell script `sage-env`. (Getting a fully functional `sage.all` is future work.)
+
+This ticket also makes sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`), and to remove assumptions regarding install locations of sagelib relative to `$SAGE_LOCAL`.
 
 - To support users who want to install an experimental version of sagelib in other install locations, such as in a user site packages directory.
 - For making sagelib available in a user's venv, as in the following example:
``````




---

archive/issue_comments_456406.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6\">7a43544</a></td><td><code>src/sage/env.py, envconfig.py.in: Add MAXIMA; src/sage/interfaces/maxima.py: Use it</code></td></tr></table>\n",
    "created_at": "2020-01-17T19:45:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456406",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:34'>Comment 34:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6">7a43544</a></td><td><code>src/sage/env.py, envconfig.py.in: Add MAXIMA; src/sage/interfaces/maxima.py: Use it</code></td></tr></table>




---

archive/issue_comments_456407.json:
```json
{
    "body": "Changed commit from **[bba08ec](https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23)** to **[7a43544](https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6)**",
    "created_at": "2020-01-17T19:45:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456407",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bba08ec](https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23)** to **[7a43544](https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6)**



---

archive/issue_comments_456408.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,12 +22,13 @@\n    >>> sage.env.SAGE_LOCAL\n    '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n    >>> import sage.all\n-   >>>\n+   >>> sage.all.maxima('1')\n+   1\n    ```\n - To support #29013/#27824: spkg-configure.m4 for python3\n - To make it possible for distributions to use a stock `src/sage/env.py` (providing a custom `src/sage/env_conf.py`).\n \n-In a first step, we just set `SAGE_LOCAL`, but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. \n+In a first step, we just set `SAGE_LOCAL` and `MAXIMA` (to the location of the `maxima` binary), but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. \n \n In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.\n \n``````\n",
    "created_at": "2020-01-17T19:46:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456408",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,12 +22,13 @@
    >>> sage.env.SAGE_LOCAL
    '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
    >>> import sage.all
-   >>>
+   >>> sage.all.maxima('1')
+   1
    ```
 - To support #29013/#27824: spkg-configure.m4 for python3
 - To make it possible for distributions to use a stock `src/sage/env.py` (providing a custom `src/sage/env_conf.py`).
 
-In a first step, we just set `SAGE_LOCAL`, but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. 
+In a first step, we just set `SAGE_LOCAL` and `MAXIMA` (to the location of the `maxima` binary), but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. 
 
 In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.
 
``````




---

archive/issue_comments_456409.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,7 +28,7 @@\n - To support #29013/#27824: spkg-configure.m4 for python3\n - To make it possible for distributions to use a stock `src/sage/env.py` (providing a custom `src/sage/env_conf.py`).\n \n-In a first step, we just set `SAGE_LOCAL` and `MAXIMA` (to the location of the `maxima` binary), but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. \n+In a first step, we just set `SAGE_LOCAL` and `MAXIMA` (to the location of the `maxima` binary), but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module; see also #25486); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. \n \n In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.\n \n``````\n",
    "created_at": "2020-01-17T20:29:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456409",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,7 +28,7 @@
 - To support #29013/#27824: spkg-configure.m4 for python3
 - To make it possible for distributions to use a stock `src/sage/env.py` (providing a custom `src/sage/env_conf.py`).
 
-In a first step, we just set `SAGE_LOCAL` and `MAXIMA` (to the location of the `maxima` binary), but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. 
+In a first step, we just set `SAGE_LOCAL` and `MAXIMA` (to the location of the `maxima` binary), but also `SAGE_ROOT` could be added (for developer conveniences such as sage.misc.edit_module; see also #25486); and later packages' `spkg-configure` might be setting `MATHJAX_DIR` etc. 
 
 In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.
 
``````




---

archive/issue_comments_456410.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,6 +32,8 @@\n \n In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.\n \n+**Ticket #29038 provides an alternative implementation that uses an standalone installed Python module `sage_conf`, rather than writing into `src/sage`**\n+\n Related:\n - #21707: Split sage-env into sage-build-env and sage-env\n - #22652: Add a plain-text config file that feeds into sage.env\n``````\n",
    "created_at": "2020-01-18T17:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456410",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,6 +32,8 @@
 
 In a follow-up ticket, `src/sage/env_config.py` would actually be generated by `src/setup.py`, not `configure`.
 
+**Ticket #29038 provides an alternative implementation that uses an standalone installed Python module `sage_conf`, rather than writing into `src/sage`**
+
 Related:
 - #21707: Split sage-env into sage-build-env and sage-env
 - #22652: Add a plain-text config file that feeds into sage.env
``````




---

archive/issue_comments_456411.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nReplying to [@embray](#comment%3A22):\n> > Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.\n\n> \n> If that's the case, I don't think `env_config.py.in` should even be directly in the sage package.  But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package\n\nIn #29038 I now do exactly that. Thanks for the input.",
    "created_at": "2020-01-18T17:42:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456411",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'>Comment 39:</a>
Replying to [@embray](#comment%3A22):
> > Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.

> 
> If that's the case, I don't think `env_config.py.in` should even be directly in the sage package.  But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package

In #29038 I now do exactly that. Thanks for the input.



---

archive/issue_events_367249.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-19T19:39:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367249"
}
```



---

archive/issue_comments_456412.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nThis ticket is superseded by #29038 - Python package `sage_conf`: Provides optional configuration information for sagelib.",
    "created_at": "2020-01-19T19:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456412",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'>Comment 40:</a>
This ticket is superseded by #29038 - Python package `sage_conf`: Provides optional configuration information for sagelib.



---

archive/issue_comments_456413.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik, Erik Bray**",
    "created_at": "2020-01-19T20:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456413",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik, Erik Bray**



---

archive/issue_events_367250.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-19T20:41:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367250"
}
```



---

archive/issue_events_367251.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-19T20:41:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367251"
}
```



---

archive/issue_events_367252.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-22T12:06:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367252"
}
```



---

archive/issue_events_367253.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-22T12:06:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367253"
}
```



---

archive/issue_comments_456414.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nReplying to [@mkoeppe](#comment%3A39):\n> Replying to [@embray](#comment%3A22):\n> > > Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.\n\n> > \n> > If that's the case, I don't think `env_config.py.in` should even be directly in the sage package.  But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package\n\n> \n> In #29038 I now do exactly that. Thanks for the input.\n\nI'm sorry, what you did in that ticket is not what I meant at all, and that's my fault for not being clearer and more explicit.  What I had in mind here was this:\n\n* I was unclear when I wrote \"external to the sage package's source tree\".  What I meant was (relative to the git repository), still in `src/`, but not in `src/sage`.\n\n* These settings (whether written by sage-the-distribution's configure script, or by hand by a packager) would be written by `src/setup.py` into a file that *is* installed in the `sage` package.\n\nAn analogy I would use is `numpy.__config__`.  If you look at it, and Numpy's setup.py, you can see that it's generated and installed inside the numpy package.  This is close to what you are trying to do, but just a different approach to how the file is installed.\n\nI'm still -1 on it being a .py module, but if you feel strongly about that I'd take it as long as we can do the rest more like Numpy does.",
    "created_at": "2020-01-22T12:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456414",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'>Comment 42:</a>
Replying to [@mkoeppe](#comment%3A39):
> Replying to [@embray](#comment%3A22):
> > > Sage-the-distribution generates the file using configure script. Downstream packagers would generate the file by any means that they prefer.

> > 
> > If that's the case, I don't think `env_config.py.in` should even be directly in the sage package.  But I also think this file should not go directly into the sage package at all.  It would be better if it were external to the sage package's source tree; but it could still be generated and installed along with the package

> 
> In #29038 I now do exactly that. Thanks for the input.

I'm sorry, what you did in that ticket is not what I meant at all, and that's my fault for not being clearer and more explicit.  What I had in mind here was this:

* I was unclear when I wrote "external to the sage package's source tree".  What I meant was (relative to the git repository), still in `src/`, but not in `src/sage`.

* These settings (whether written by sage-the-distribution's configure script, or by hand by a packager) would be written by `src/setup.py` into a file that *is* installed in the `sage` package.

An analogy I would use is `numpy.__config__`.  If you look at it, and Numpy's setup.py, you can see that it's generated and installed inside the numpy package.  This is close to what you are trying to do, but just a different approach to how the file is installed.

I'm still -1 on it being a .py module, but if you feel strongly about that I'd take it as long as we can do the rest more like Numpy does.



---

archive/issue_comments_456415.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nnumpy's configuration/setup is IMHO a good example of how NOT to do such things.",
    "created_at": "2020-01-22T12:19:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456415",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'>Comment 43:</a>
numpy's configuration/setup is IMHO a good example of how NOT to do such things.



---

archive/issue_comments_456416.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nReplying to [@embray](#comment%3A42):\n> I'd take it as long as we can do the rest more like Numpy does.\n\nNumpy's solution, expecting a configuration file in its to-be-installed sources, is outdated (and, by the way, untested by upstream) because it is incompatible with pip-installing from a source other than a local directory.\n\nLet's continue the discussion in #29038.",
    "created_at": "2020-01-22T14:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456416",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'>Comment 44:</a>
Replying to [@embray](#comment%3A42):
> I'd take it as long as we can do the rest more like Numpy does.

Numpy's solution, expecting a configuration file in its to-be-installed sources, is outdated (and, by the way, untested by upstream) because it is incompatible with pip-installing from a source other than a local directory.

Let's continue the discussion in #29038.



---

archive/issue_events_367254.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-25T18:31:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367254"
}
```



---

archive/issue_events_367255.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-25T18:31:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367255"
}
```



---

archive/issue_comments_456417.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nThis ticket can now be closed because superseded by #29038.",
    "created_at": "2020-01-25T18:31:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456417",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'>Comment 45:</a>
This ticket can now be closed because superseded by #29038.



---

archive/issue_events_367256.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-25T18:34:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367256"
}
```



---

archive/issue_events_367257.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-25T18:34:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367257"
}
```



---

archive/issue_events_367258.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-31T11:27:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "a6a6a6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367258"
}
```



---

archive/issue_events_367259.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-31T11:27:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367259"
}
```



---

archive/issue_events_367260.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-31T11:27:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29022#event-367260"
}
```



---

archive/issue_comments_456418.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nReplying to [@mkoeppe](#comment%3A44):\n> Replying to [@embray](#comment%3A42):\n> > I'd take it as long as we can do the rest more like Numpy does.\n\n> Numpy's solution, expecting a configuration file in its to-be-installed sources, is outdated (and, by the way, untested by upstream) because it is incompatible with pip-installing from a source other than a local directory.\n> \n> Let's continue the discussion in #29038.\n\nI dont think so; you could also pass the configuration by other means but it's just an example.  I don't see how #29038 makes this any better.  Now you have to have a whole external Python module to do the same thing.",
    "created_at": "2020-01-31T11:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456418",
    "user": "https://github.com/embray"
}
```

<a id='comment:48'>Comment 48:</a>
Replying to [@mkoeppe](#comment%3A44):
> Replying to [@embray](#comment%3A42):
> > I'd take it as long as we can do the rest more like Numpy does.

> Numpy's solution, expecting a configuration file in its to-be-installed sources, is outdated (and, by the way, untested by upstream) because it is incompatible with pip-installing from a source other than a local directory.
> 
> Let's continue the discussion in #29038.

I dont think so; you could also pass the configuration by other means but it's just an example.  I don't see how #29038 makes this any better.  Now you have to have a whole external Python module to do the same thing.



---

archive/issue_comments_456419.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nwrapping up configuration into a Python package is more Pythonic than \"other means\". \"A whole external Python\" module is way cleaner than a bunch of text files (maybe sourceable from shell, maybe not) for a Python library.",
    "created_at": "2020-01-31T12:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456419",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'>Comment 49:</a>
wrapping up configuration into a Python package is more Pythonic than "other means". "A whole external Python" module is way cleaner than a bunch of text files (maybe sourceable from shell, maybe not) for a Python library.



---

archive/issue_comments_456420.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nI need to do a write up about this. I guess I exchanged a bigger patch for a smaller one and an extra file. The issue with your python module is that it is not a proper package. I don't have a tarball for the source apart from sage's own source and it is not versioned. So as a distro packager I am looking at this as extra work if I want to package it as a separate python module because I have to do the packaging and versioning myself.\n\nSo right now I have a patch to look for sage.sage_conf in env.py, and I am putting sage_conf.py next to env.py. There may be something wrong with putting sage_cong.py.in in the source themselves. But replacing it by an half assed package is hardly ideal.",
    "created_at": "2020-01-31T19:31:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456420",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:50'>Comment 50:</a>
I need to do a write up about this. I guess I exchanged a bigger patch for a smaller one and an extra file. The issue with your python module is that it is not a proper package. I don't have a tarball for the source apart from sage's own source and it is not versioned. So as a distro packager I am looking at this as extra work if I want to package it as a separate python module because I have to do the packaging and versioning myself.

So right now I have a patch to look for sage.sage_conf in env.py, and I am putting sage_conf.py next to env.py. There may be something wrong with putting sage_cong.py.in in the source themselves. But replacing it by an half assed package is hardly ideal.



---

archive/issue_comments_456421.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nReplying to [@kiwifb](#comment%3A50):\n> I need to do a write up about this. I guess I exchanged a bigger patch for a smaller one and an extra file. The issue with your python module is that it is not a proper package. I don't have a tarball for the source apart from sage's own source and it is not versioned. So as a distro packager I am looking at this as extra work if I want to package it as a separate python module because I have to do the packaging and versioning myself.\n\nWe can make ./bootstrap to generate a tarball of it in upstream/ just as it's done \nfor configure package.\n\nWill it help?",
    "created_at": "2020-01-31T19:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456421",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'>Comment 51:</a>
Replying to [@kiwifb](#comment%3A50):
> I need to do a write up about this. I guess I exchanged a bigger patch for a smaller one and an extra file. The issue with your python module is that it is not a proper package. I don't have a tarball for the source apart from sage's own source and it is not versioned. So as a distro packager I am looking at this as extra work if I want to package it as a separate python module because I have to do the packaging and versioning myself.

We can make ./bootstrap to generate a tarball of it in upstream/ just as it's done 
for configure package.

Will it help?



---

archive/issue_comments_456422.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nIt'd possibly be an improvement if it is properly versioned. But it would still need to be pre-processed before it being usable. You are running away from the complexity by heaping a bit more :)\n\nI can adapt with most of the stuff that you throw at me. I have been doing that for about 12 years now. But I am fairly much in agreement with Erik that a different design should have been chosen altogether. In fact it's been years that I have been expecting sage to get a setup.cfg - at the very least for optional packages (the new design for coinor/gurobi/cplex rocks by the way).",
    "created_at": "2020-01-31T19:58:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456422",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:52'>Comment 52:</a>
It'd possibly be an improvement if it is properly versioned. But it would still need to be pre-processed before it being usable. You are running away from the complexity by heaping a bit more :)

I can adapt with most of the stuff that you throw at me. I have been doing that for about 12 years now. But I am fairly much in agreement with Erik that a different design should have been chosen altogether. In fact it's been years that I have been expecting sage to get a setup.cfg - at the very least for optional packages (the new design for coinor/gurobi/cplex rocks by the way).



---

archive/issue_comments_456423.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nReplying to [@kiwifb](#comment%3A50):\n> I need to do a write up about this. I guess I exchanged a bigger patch for a smaller one and an extra file. The issue with your python module is that it is not a proper package. I don't have a tarball for the source apart from sage's own source and it is not versioned. So as a distro packager I am looking at this as extra work if I want to package it as a separate python module because I have to do the packaging and versioning myself.\n> \n> So right now I have a patch to look for sage.sage_conf in env.py, and I am putting sage_conf.py next to env.py. There may be something wrong with putting sage_cong.py.in in the source themselves. But replacing it by an half assed package is hardly ideal.\n\nAre you commenting on the right ticket? #29038 was merged, not this one.",
    "created_at": "2020-01-31T20:01:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456423",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'>Comment 53:</a>
Replying to [@kiwifb](#comment%3A50):
> I need to do a write up about this. I guess I exchanged a bigger patch for a smaller one and an extra file. The issue with your python module is that it is not a proper package. I don't have a tarball for the source apart from sage's own source and it is not versioned. So as a distro packager I am looking at this as extra work if I want to package it as a separate python module because I have to do the packaging and versioning myself.
> 
> So right now I have a patch to look for sage.sage_conf in env.py, and I am putting sage_conf.py next to env.py. There may be something wrong with putting sage_cong.py.in in the source themselves. But replacing it by an half assed package is hardly ideal.

Are you commenting on the right ticket? #29038 was merged, not this one.



---

archive/issue_comments_456424.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nYou are right I should have commented on the other ticket. I just took the conversation on this ticket when I found it first in my inbox this morning. That being said I have been thinking of doing a comment for a week so I just took the opportunity before postponing it and never writing it. Of course the order I read things in my inbox in the morning is also a big influence in this case. But if I had waited to read all my inbox before thinking \"I should put my comment there\" I may not have written it at all :(",
    "created_at": "2020-01-31T20:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456424",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:54'>Comment 54:</a>
You are right I should have commented on the other ticket. I just took the conversation on this ticket when I found it first in my inbox this morning. That being said I have been thinking of doing a comment for a week so I just took the opportunity before postponing it and never writing it. Of course the order I read things in my inbox in the morning is also a big influence in this case. But if I had waited to read all my inbox before thinking "I should put my comment there" I may not have written it at all :(



---

archive/issue_comments_456425.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nI recommend to read #21707. It gives the high-level overview.",
    "created_at": "2020-01-31T20:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29022",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29022#issuecomment-456425",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'>Comment 55:</a>
I recommend to read #21707. It gives the high-level overview.
