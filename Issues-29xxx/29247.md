# Issue 29247: Remove no_generic_basering_coercion

archive/issues_029010.json:
```json
{
    "assignees": [],
    "body": "After #19225, the ad-hoc `no_generic_basering_coercion` attribute introduced in #11900 can be replaced by suitable `_coerce_map_from_base_ring()` methods.\n\n**CC:**  @tscrim\n\n**Branch:** [db76cac22774408fe7a15a03b78ccf88bec8c72f](https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Peter Bruin\n\nIssue created by migration from https://trac.sagemath.org/ticket/29247\n\n",
    "closed_at": "2020-03-08T11:27:01Z",
    "created_at": "2020-02-26T20:27:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20coercion",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove no_generic_basering_coercion",
    "type": "issue",
    "updated_at": "2020-03-11T08:52:43Z",
    "url": "https://github.com/sagemath/sage/issues/29247",
    "user": "https://github.com/pjbruin"
}
```
After #19225, the ad-hoc `no_generic_basering_coercion` attribute introduced in #11900 can be replaced by suitable `_coerce_map_from_base_ring()` methods.

**CC:**  @tscrim

**Branch:** [db76cac22774408fe7a15a03b78ccf88bec8c72f](https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f)

**Reviewer:** Travis Scrimshaw

**Author:** Peter Bruin

Issue created by migration from https://trac.sagemath.org/ticket/29247





---

archive/issue_comments_461483.json:
```json
{
    "body": "**Branch:** [u/pbruin/29247-no_generic_basering_coercion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/29247-no_generic_basering_coercion)",
    "created_at": "2020-02-28T09:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461483",
    "user": "https://github.com/pjbruin"
}
```

**Branch:** [u/pbruin/29247-no_generic_basering_coercion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/29247-no_generic_basering_coercion)



---

archive/issue_events_260153.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2020-02-28T09:09:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260153"
}
```



---

archive/issue_comments_461484.json:
```json
{
    "body": "**Commit:** [bd97ff9f189490d9e04ce8d22d6f564b9884ea16](https://github.com/sagemath/sagetrac-mirror/commit/bd97ff9f189490d9e04ce8d22d6f564b9884ea16)",
    "created_at": "2020-02-28T09:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461484",
    "user": "https://github.com/pjbruin"
}
```

**Commit:** [bd97ff9f189490d9e04ce8d22d6f564b9884ea16](https://github.com/sagemath/sagetrac-mirror/commit/bd97ff9f189490d9e04ce8d22d6f564b9884ea16)



---

archive/issue_comments_461485.json:
```json
{
    "body": "<a id='comment:2'></a>\nA few remarks:\n- The result of `_coerce_map_from_base_ring()` is now modified to have weak references to the domain and codomain when registering the map as a coercion, as is done for other coercion maps\n- Jordan algebras: `_no_generic_basering_coercion` was not used anymore since #19225\n- `MPolynomialRing_libsingular`: this is a somewhat peculiar case.  Since this is a Cython class, its type cannot be modified by the category framework, which results in the category-specific `__init_extra__()` methods not being called in `Parent.__init__()`.  However, when inheriting from this class in Python, these methods *are* called, which is what caused the crash in #26958.  This branch adds a common `_coerce_map_from_base_ring()` for all multivariate polynomial rings, which is called by `__init_extra__()` for Python classes and (if needed) by `_coerce_map_from_()` for the Cython class `MPolynomialRing_libsingular`.  Maybe `Parent.__init__()` should eventually be adapted to call the category-specific `__init_extra__()` methods also for Cython classes, but this should be done on a separate ticket.\n- Skew polynomial rings: `_no_generic_basering_coercion` was not used (anymore?) because these rings are not in the category of algebras.",
    "created_at": "2020-02-28T09:30:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461485",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:2'></a>
A few remarks:
- The result of `_coerce_map_from_base_ring()` is now modified to have weak references to the domain and codomain when registering the map as a coercion, as is done for other coercion maps
- Jordan algebras: `_no_generic_basering_coercion` was not used anymore since #19225
- `MPolynomialRing_libsingular`: this is a somewhat peculiar case.  Since this is a Cython class, its type cannot be modified by the category framework, which results in the category-specific `__init_extra__()` methods not being called in `Parent.__init__()`.  However, when inheriting from this class in Python, these methods *are* called, which is what caused the crash in #26958.  This branch adds a common `_coerce_map_from_base_ring()` for all multivariate polynomial rings, which is called by `__init_extra__()` for Python classes and (if needed) by `_coerce_map_from_()` for the Cython class `MPolynomialRing_libsingular`.  Maybe `Parent.__init__()` should eventually be adapted to call the category-specific `__init_extra__()` methods also for Cython classes, but this should be done on a separate ticket.
- Skew polynomial rings: `_no_generic_basering_coercion` was not used (anymore?) because these rings are not in the category of algebras.



---

archive/issue_comments_461486.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [@pjbruin](#comment%3A2):\n> A few remarks:\n> - The result of `_coerce_map_from_base_ring()` is now modified to have weak references to the domain and codomain when registering the map as a coercion, as is done for other coercion maps\n\nThis is done automatically by the coercion system when constructed via `_coerce_map_from_`, correct?\n\n> -  Maybe `Parent.__init__()` should eventually be adapted to call the category-specific `__init_extra__()` methods also for Cython classes, but this should be done on a separate ticket.\n\nIt definitely should be a separate ticket that might need some design discussions.\n\n> - Skew polynomial rings: `_no_generic_basering_coercion` was not used (anymore?) because these rings are not in the category of algebras.\n\nI think the proper thing to do, which should be done on this ticket, is to promote it to the category of unital algebras and use the new mechanism here.",
    "created_at": "2020-02-28T21:20:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461486",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Replying to [@pjbruin](#comment%3A2):
> A few remarks:
> - The result of `_coerce_map_from_base_ring()` is now modified to have weak references to the domain and codomain when registering the map as a coercion, as is done for other coercion maps

This is done automatically by the coercion system when constructed via `_coerce_map_from_`, correct?

> -  Maybe `Parent.__init__()` should eventually be adapted to call the category-specific `__init_extra__()` methods also for Cython classes, but this should be done on a separate ticket.

It definitely should be a separate ticket that might need some design discussions.

> - Skew polynomial rings: `_no_generic_basering_coercion` was not used (anymore?) because these rings are not in the category of algebras.

I think the proper thing to do, which should be done on this ticket, is to promote it to the category of unital algebras and use the new mechanism here.



---

archive/issue_comments_461487.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/128194eceec1620de4caf4ec7d8883ebf1c87cc9\">128194e</a></td><td><code>Trac 29247: put skew polynomial rings into the category of algebras</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/500219a7302262b2ec53f22eccbdbca9b6f5ae8d\">500219a</a></td><td><code>Trac 29247: some cleaning up</code></td></tr></table>\n",
    "created_at": "2020-03-02T07:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461487",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/128194eceec1620de4caf4ec7d8883ebf1c87cc9">128194e</a></td><td><code>Trac 29247: put skew polynomial rings into the category of algebras</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/500219a7302262b2ec53f22eccbdbca9b6f5ae8d">500219a</a></td><td><code>Trac 29247: some cleaning up</code></td></tr></table>




---

archive/issue_comments_461488.json:
```json
{
    "body": "**Changing commit** from \"[bd97ff9f189490d9e04ce8d22d6f564b9884ea16](https://github.com/sagemath/sagetrac-mirror/commit/bd97ff9f189490d9e04ce8d22d6f564b9884ea16)\" to \"[500219a7302262b2ec53f22eccbdbca9b6f5ae8d](https://github.com/sagemath/sagetrac-mirror/commit/500219a7302262b2ec53f22eccbdbca9b6f5ae8d)\".",
    "created_at": "2020-03-02T07:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461488",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bd97ff9f189490d9e04ce8d22d6f564b9884ea16](https://github.com/sagemath/sagetrac-mirror/commit/bd97ff9f189490d9e04ce8d22d6f564b9884ea16)" to "[500219a7302262b2ec53f22eccbdbca9b6f5ae8d](https://github.com/sagemath/sagetrac-mirror/commit/500219a7302262b2ec53f22eccbdbca9b6f5ae8d)".



---

archive/issue_comments_461489.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [@tscrim](#comment%3A3):\n> Replying to [@pjbruin](#comment%3A2):\n> > A few remarks:\n> > - The result of `_coerce_map_from_base_ring()` is now modified to have weak references to the domain and codomain when registering the map as a coercion, as is done for other coercion maps\n\n> \n> This is done automatically by the coercion system when constructed via `_coerce_map_from_`, correct?\n\nYes.\n\n> > - Skew polynomial rings: `_no_generic_basering_coercion` was not used (anymore?) because these rings are not in the category of algebras.\n\n> \n> I think the proper thing to do, which should be done on this ticket, is to promote it to the category of unital algebras and use the new mechanism here.\n\nAt first I thought this would be the wrong thing to do because the definition of algebras that I am used to implies that if *A* is an algebra over a ring *R*, then left multiplication and right multiplication by an element of *R* have the same effect.  However, it seems this condition is not imposed by Sage, so giving an *R*-algebra is equivalent to giving a (unital, associative) ring *A* and a ring homomorphism from *R* to *A*.",
    "created_at": "2020-03-02T07:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461489",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'></a>
Replying to [@tscrim](#comment%3A3):
> Replying to [@pjbruin](#comment%3A2):
> > A few remarks:
> > - The result of `_coerce_map_from_base_ring()` is now modified to have weak references to the domain and codomain when registering the map as a coercion, as is done for other coercion maps

> 
> This is done automatically by the coercion system when constructed via `_coerce_map_from_`, correct?

Yes.

> > - Skew polynomial rings: `_no_generic_basering_coercion` was not used (anymore?) because these rings are not in the category of algebras.

> 
> I think the proper thing to do, which should be done on this ticket, is to promote it to the category of unital algebras and use the new mechanism here.

At first I thought this would be the wrong thing to do because the definition of algebras that I am used to implies that if *A* is an algebra over a ring *R*, then left multiplication and right multiplication by an element of *R* have the same effect.  However, it seems this condition is not imposed by Sage, so giving an *R*-algebra is equivalent to giving a (unital, associative) ring *A* and a ring homomorphism from *R* to *A*.



---

archive/issue_comments_461490.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@pjbruin](#comment%3A5):\n> Replying to [@tscrim](#comment%3A3):\n> > Replying to [@pjbruin](#comment%3A2):\n> > > - Skew polynomial rings: `_no_generic_basering_coercion` was not used (anymore?) because these rings are not in the category of algebras.\n\n> > \n> > I think the proper thing to do, which should be done on this ticket, is to promote it to the category of unital algebras and use the new mechanism here.\n\n> At first I thought this would be the wrong thing to do because the definition of algebras that I am used to implies that if *A* is an algebra over a ring *R*, then left multiplication and right multiplication by an element of *R* have the same effect.  However, it seems this condition is not imposed by Sage, so giving an *R*-algebra is equivalent to giving a (unital, associative) ring *A* and a ring homomorphism from *R* to *A*.\n\nMy understanding is that for (magmatic) algebras, a left/right *R*-algebra has a left/right *R*-module structure, but nothing says that there has to be both or that these structures are the same. For unital algebras, the fact that `1` commutes is equivalent to saying that we have the ring homomorphism from *R* to *A* that you mentioned.\n\nLGTM. Thanks.",
    "created_at": "2020-03-02T23:38:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461490",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Replying to [@pjbruin](#comment%3A5):
> Replying to [@tscrim](#comment%3A3):
> > Replying to [@pjbruin](#comment%3A2):
> > > - Skew polynomial rings: `_no_generic_basering_coercion` was not used (anymore?) because these rings are not in the category of algebras.

> > 
> > I think the proper thing to do, which should be done on this ticket, is to promote it to the category of unital algebras and use the new mechanism here.

> At first I thought this would be the wrong thing to do because the definition of algebras that I am used to implies that if *A* is an algebra over a ring *R*, then left multiplication and right multiplication by an element of *R* have the same effect.  However, it seems this condition is not imposed by Sage, so giving an *R*-algebra is equivalent to giving a (unital, associative) ring *A* and a ring homomorphism from *R* to *A*.

My understanding is that for (magmatic) algebras, a left/right *R*-algebra has a left/right *R*-module structure, but nothing says that there has to be both or that these structures are the same. For unital algebras, the fact that `1` commutes is equivalent to saying that we have the ring homomorphism from *R* to *A* that you mentioned.

LGTM. Thanks.



---

archive/issue_comments_461491.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2020-03-02T23:38:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461491",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_events_260154.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-03-02T23:38:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260154"
}
```



---

archive/issue_events_260155.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-03-02T23:38:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260155"
}
```



---

archive/issue_comments_461492.json:
```json
{
    "body": "<a id='comment:7'></a>\nMerge conflict",
    "created_at": "2020-03-03T23:22:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461492",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Merge conflict



---

archive/issue_events_260156.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-03T23:22:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260156"
}
```



---

archive/issue_events_260157.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-03T23:22:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260157"
}
```



---

archive/issue_comments_461493.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@vbraun](#comment%3A7):\n> Merge conflict\n\nAny info as to what is the conflicting ticket?  I just tried\n\n```\ngit pull https://github.com/vbraun/sage develop\n```\nand got no conflicts.",
    "created_at": "2020-03-04T07:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461493",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:8'></a>
Replying to [@vbraun](#comment%3A7):
> Merge conflict

Any info as to what is the conflicting ticket?  I just tried

```
git pull https://github.com/vbraun/sage develop
```
and got no conflicts.



---

archive/issue_comments_461494.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f\">db76cac</a></td><td><code>Trac 29247: change doctest to prevent merge conflict with #28882</code></td></tr></table>\n",
    "created_at": "2020-03-04T16:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461494",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f">db76cac</a></td><td><code>Trac 29247: change doctest to prevent merge conflict with #28882</code></td></tr></table>




---

archive/issue_comments_461495.json:
```json
{
    "body": "**Changing commit** from \"[500219a7302262b2ec53f22eccbdbca9b6f5ae8d](https://github.com/sagemath/sagetrac-mirror/commit/500219a7302262b2ec53f22eccbdbca9b6f5ae8d)\" to \"[db76cac22774408fe7a15a03b78ccf88bec8c72f](https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f)\".",
    "created_at": "2020-03-04T16:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461495",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[500219a7302262b2ec53f22eccbdbca9b6f5ae8d](https://github.com/sagemath/sagetrac-mirror/commit/500219a7302262b2ec53f22eccbdbca9b6f5ae8d)" to "[db76cac22774408fe7a15a03b78ccf88bec8c72f](https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f)".



---

archive/issue_comments_461496.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@pjbruin](#comment%3A8):\n> Replying to [@vbraun](#comment%3A7):\n> > Merge conflict\n\n> Any info as to what is the conflicting ticket?  I just tried\n> \n> ```\n> git pull https://github.com/vbraun/sage develop\n> ```\n> and got no conflicts.\n\nMy mistake, I did this on the wrong branch.  The conflict was with #28882.",
    "created_at": "2020-03-04T16:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461496",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'></a>
Replying to [@pjbruin](#comment%3A8):
> Replying to [@vbraun](#comment%3A7):
> > Merge conflict

> Any info as to what is the conflicting ticket?  I just tried
> 
> ```
> git pull https://github.com/vbraun/sage develop
> ```
> and got no conflicts.

My mistake, I did this on the wrong branch.  The conflict was with #28882.



---

archive/issue_events_260158.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2020-03-04T16:28:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260158"
}
```



---

archive/issue_events_260159.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2020-03-04T16:28:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260159"
}
```



---

archive/issue_comments_461497.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/29247-no_generic_basering_coercion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/29247-no_generic_basering_coercion)\" to \"[db76cac22774408fe7a15a03b78ccf88bec8c72f](https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f)\".",
    "created_at": "2020-03-08T11:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461497",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/pbruin/29247-no_generic_basering_coercion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/29247-no_generic_basering_coercion)" to "[db76cac22774408fe7a15a03b78ccf88bec8c72f](https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f)".



---

archive/issue_events_260160.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T11:27:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260160"
}
```



---

archive/issue_events_260161.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d77360886b95a58e3b7ba146fa464c91a0790876",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-03-08T11:27:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29247#event-260161"
}
```



---

archive/issue_comments_461498.json:
```json
{
    "body": "**Changing commit** from \"[db76cac22774408fe7a15a03b78ccf88bec8c72f](https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f)\" to \"\".",
    "created_at": "2020-03-09T14:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461498",
    "user": "https://github.com/mezzarobba"
}
```

**Changing commit** from "[db76cac22774408fe7a15a03b78ccf88bec8c72f](https://github.com/sagemath/sagetrac-mirror/commit/db76cac22774408fe7a15a03b78ccf88bec8c72f)" to "".



---

archive/issue_comments_461499.json:
```json
{
    "body": "<a id='comment:12'></a>\nIt seems that this ticket does more than just deprecating `_no_generic_basering_coercion` -- it can break code that still uses it. For example, with ore_algebra, I get:\n\n```\nsage: Dops_x, x, Dx = DifferentialOperators()\n/home/marc/docs/code/sage/ore_algebra/ore_algebra/src/ore_algebra/ore_algebra.py:1019: DeprecationWarning: the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead\nSee http://trac.sagemath.org/19225 for details.\n  super(self.__class__, self).__init__(base_ring)\nsage: x + Dx\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-2-71f2b2c8bc9b> in <module>()\n----> 1 x + Dx\n\n/home/marc/co/sage/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__add__ (build/cythonized/sage/structure/element.c:10838)()\n   1232         # Left and right are Sage elements => use coercion model\n   1233         if BOTH_ARE_ELEMENT(cl):\n-> 1234             return coercion_model.bin_op(left, right, add)\n   1235 \n   1236         cdef long value\n\n/home/marc/co/sage/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10117)()\n   1205         # Now coerce to a common parent and do the operation there\n   1206         try:\n-> 1207             xy = self.canonical_coercion(x, y)\n   1208         except TypeError:\n   1209             self._record_exception()\n\n/home/marc/co/sage/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.canonical_coercion (build/cythonized/sage/structure/coerce.c:11700)()\n   1324                 y_elt = y\n   1325             if x_elt is None:\n-> 1326                 raise RuntimeError(\"BUG in map, returned None %s %s %s\" % (x, type(x_map), x_map))\n   1327             elif y_elt is None:\n   1328                 raise RuntimeError(\"BUG in map, returned None %s %s %s\" % (y, type(y_map), y_map))\n\nRuntimeError: BUG in map, returned None x <class 'sage.categories.morphism.SetMorphism'> (map internal to coercion system -- copy before use)\nGeneric morphism:\n  From: Univariate Polynomial Ring in x over Rational Field\n  To:   Univariate Ore algebra in Dx over Univariate Polynomial Ring in x over Rational Field\n```\n\nDefining `_coerce_map_from_base_ring()` fixes the issue.\n\nI personally don't really care (external users of this kind of things probably have to adapt their code with every release anyway), but if it is easy to preserve compatibility with older versions, it may be a good think nevertheless.",
    "created_at": "2020-03-09T14:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461499",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:12'></a>
It seems that this ticket does more than just deprecating `_no_generic_basering_coercion` -- it can break code that still uses it. For example, with ore_algebra, I get:

```
sage: Dops_x, x, Dx = DifferentialOperators()
/home/marc/docs/code/sage/ore_algebra/ore_algebra/src/ore_algebra/ore_algebra.py:1019: DeprecationWarning: the attribute _no_generic_basering_coercion is deprecated, implement _coerce_map_from_base_ring() instead
See http://trac.sagemath.org/19225 for details.
  super(self.__class__, self).__init__(base_ring)
sage: x + Dx
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-2-71f2b2c8bc9b> in <module>()
----> 1 x + Dx

/home/marc/co/sage/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__add__ (build/cythonized/sage/structure/element.c:10838)()
   1232         # Left and right are Sage elements => use coercion model
   1233         if BOTH_ARE_ELEMENT(cl):
-> 1234             return coercion_model.bin_op(left, right, add)
   1235 
   1236         cdef long value

/home/marc/co/sage/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10117)()
   1205         # Now coerce to a common parent and do the operation there
   1206         try:
-> 1207             xy = self.canonical_coercion(x, y)
   1208         except TypeError:
   1209             self._record_exception()

/home/marc/co/sage/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.canonical_coercion (build/cythonized/sage/structure/coerce.c:11700)()
   1324                 y_elt = y
   1325             if x_elt is None:
-> 1326                 raise RuntimeError("BUG in map, returned None %s %s %s" % (x, type(x_map), x_map))
   1327             elif y_elt is None:
   1328                 raise RuntimeError("BUG in map, returned None %s %s %s" % (y, type(y_map), y_map))

RuntimeError: BUG in map, returned None x <class 'sage.categories.morphism.SetMorphism'> (map internal to coercion system -- copy before use)
Generic morphism:
  From: Univariate Polynomial Ring in x over Rational Field
  To:   Univariate Ore algebra in Dx over Univariate Polynomial Ring in x over Rational Field
```

Defining `_coerce_map_from_base_ring()` fixes the issue.

I personally don't really care (external users of this kind of things probably have to adapt their code with every release anyway), but if it is easy to preserve compatibility with older versions, it may be a good think nevertheless.



---

archive/issue_comments_461500.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [@mezzarobba](#comment%3A12):\n> It seems that this ticket does more than just deprecating `_no_generic_basering_coercion` -- it can break code that still uses it.\n\nYou are right, I accidentally deleted the `return` statement while adding the deprecation.  This should be fixed by #29303.",
    "created_at": "2020-03-09T16:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461500",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:13'></a>
Replying to [@mezzarobba](#comment%3A12):
> It seems that this ticket does more than just deprecating `_no_generic_basering_coercion` -- it can break code that still uses it.

You are right, I accidentally deleted the `return` statement while adding the deprecation.  This should be fixed by #29303.



---

archive/issue_comments_461501.json:
```json
{
    "body": "<a id='comment:14'></a>\nAnother problem that seems to be caused by this ticket:\n\n```\nsage: R.<x,y,z> = QQ[]\nsage: from sage.libs.singular.function_factory import ff\nsage: W = ff.ring(ff.ringlist(R), ring=R)\nsage: C = sage.rings.polynomial.plural.new_CRing(W, R.base_ring())\nsage: C.one()   # should be 1\n0\n```\nPresumably, this happens because the coercion from Python ints is a composite map via `QQ` now\n\n```\nsage: C._internal_coerce_map_from(int)\n(map internal to coercion system -- copy before use)\nComposite map:\n  From: Set of Python objects of class 'int'\n  To:   Multivariate Polynomial Ring in x, y, z over Rational Field\nsage: C._internal_coerce_map_from(int)[0]\n(map internal to coercion system -- copy before use)\nNative morphism:\n  From: Set of Python objects of class 'int'\n  To:   Rational Field\n```\nbut the coercion from `QQ` to `C` calls `one()` again, resulting in a cycle. In 9.1.beta6, this was not a composite map:\n\n```\nsage: C._internal_coerce_map_from(int)\n(map internal to coercion system -- copy before use)\nCoercion map:\n  From: Set of Python objects of class 'int'\n  To:   Multivariate Polynomial Ring in x, y, z over Rational Field\n```\nDo you have any ideas how to fix this? This came up in #25993.\n\nAnother possible problem seems to be the following, but I am not sure whether letterplace algebras are missing `from_base_ring` or whether its existence should not be assumed:\n\n```\nsage: F.<x,y,z> = FreeAlgebra(QQ, implementation='letterplace')\nsage: F._coerce_map_from_base_ring()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-3-069acb379d83> in <module>()\n----> 1 F._coerce_map_from_base_ring()\n\n.../local/lib/python3.7/site-packages/sage/categories/unital_algebras.py in _coerce_map_from_base_ring(self)\n    212             # be used unconditionally.\n    213             generic_from_base_ring = self.category().parent_class.from_base_ring\n--> 214             if type(self).from_base_ring != generic_from_base_ring:\n    215                 # Custom from_base_ring()\n    216                 use_from_base_ring = True\n\nAttributeError: type object 'sage.algebras.letterplace.free_algebra_letterplace' has no attribute 'from_base_ring'\n```",
    "created_at": "2020-03-09T22:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461501",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:14'></a>
Another problem that seems to be caused by this ticket:

```
sage: R.<x,y,z> = QQ[]
sage: from sage.libs.singular.function_factory import ff
sage: W = ff.ring(ff.ringlist(R), ring=R)
sage: C = sage.rings.polynomial.plural.new_CRing(W, R.base_ring())
sage: C.one()   # should be 1
0
```
Presumably, this happens because the coercion from Python ints is a composite map via `QQ` now

```
sage: C._internal_coerce_map_from(int)
(map internal to coercion system -- copy before use)
Composite map:
  From: Set of Python objects of class 'int'
  To:   Multivariate Polynomial Ring in x, y, z over Rational Field
sage: C._internal_coerce_map_from(int)[0]
(map internal to coercion system -- copy before use)
Native morphism:
  From: Set of Python objects of class 'int'
  To:   Rational Field
```
but the coercion from `QQ` to `C` calls `one()` again, resulting in a cycle. In 9.1.beta6, this was not a composite map:

```
sage: C._internal_coerce_map_from(int)
(map internal to coercion system -- copy before use)
Coercion map:
  From: Set of Python objects of class 'int'
  To:   Multivariate Polynomial Ring in x, y, z over Rational Field
```
Do you have any ideas how to fix this? This came up in #25993.

Another possible problem seems to be the following, but I am not sure whether letterplace algebras are missing `from_base_ring` or whether its existence should not be assumed:

```
sage: F.<x,y,z> = FreeAlgebra(QQ, implementation='letterplace')
sage: F._coerce_map_from_base_ring()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-3-069acb379d83> in <module>()
----> 1 F._coerce_map_from_base_ring()

.../local/lib/python3.7/site-packages/sage/categories/unital_algebras.py in _coerce_map_from_base_ring(self)
    212             # be used unconditionally.
    213             generic_from_base_ring = self.category().parent_class.from_base_ring
--> 214             if type(self).from_base_ring != generic_from_base_ring:
    215                 # Custom from_base_ring()
    216                 use_from_base_ring = True

AttributeError: type object 'sage.algebras.letterplace.free_algebra_letterplace' has no attribute 'from_base_ring'
```



---

archive/issue_comments_461502.json:
```json
{
    "body": "<a id='comment:15'></a>\nI think the solution would be to define:\n\n```python\ndef _coerce_map_from_base_ring(self):\n    return self._generic_coerce_map(self.base_ring())\n```\nwhich then redirects the `QQ` call to the `_element_constructor_`, which should handle it correctly. I will need to test it.\n\nWhat was happening before is in `_coerce_map_from_`, it ends with this:\n\n```python\n        elif base_ring.has_coerce_map_from(other):\n            return True\n```\nwhich ultimately just means the `_element_constructor_` handles it. Thus it doesn't know about any coercion chains. However, I believe (but not 100% sure) when explicitly setting the coercion map to `QQ`, the coercion framework looks at coercions into `QQ` and then chains them together. That is at least my best guess about what is happening any why this is different. However, I don't have time tonight to verify this by looking at the coercion cache at each step and do a more detailed analysis. I will try to do this tomorrow or the next day, but I don't think I can promise it.",
    "created_at": "2020-03-10T06:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461502",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
I think the solution would be to define:

```python
def _coerce_map_from_base_ring(self):
    return self._generic_coerce_map(self.base_ring())
```
which then redirects the `QQ` call to the `_element_constructor_`, which should handle it correctly. I will need to test it.

What was happening before is in `_coerce_map_from_`, it ends with this:

```python
        elif base_ring.has_coerce_map_from(other):
            return True
```
which ultimately just means the `_element_constructor_` handles it. Thus it doesn't know about any coercion chains. However, I believe (but not 100% sure) when explicitly setting the coercion map to `QQ`, the coercion framework looks at coercions into `QQ` and then chains them together. That is at least my best guess about what is happening any why this is different. However, I don't have time tonight to verify this by looking at the coercion cache at each step and do a more detailed analysis. I will try to do this tomorrow or the next day, but I don't think I can promise it.



---

archive/issue_comments_461503.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [@mwageringel](#comment%3A14):\n> Another problem that seems to be caused by this ticket:\n> \n> ```\n> sage: R.<x,y,z> = QQ[]\n> sage: from sage.libs.singular.function_factory import ff\n> sage: W = ff.ring(ff.ringlist(R), ring=R)\n> sage: C = sage.rings.polynomial.plural.new_CRing(W, R.base_ring())\n> sage: C.one()   # should be 1\n> 0\n> ```\n\nI think the best way to fix this problem is to initialise `_one_element` and `_one_element_poly` in `new_CRing` in the same way as it is done in `MPolynomialRing_libsingular.__init__()`:\n\n```diff\n--- a/src/sage/rings/polynomial/plural.pyx\n+++ b/src/sage/rings/polynomial/plural.pyx\n@@ -126,7 +126,7 @@ from sage.rings.finite_rings.finite_field_prime_modn import FiniteField_prime_mo\n from sage.rings.integer cimport Integer\n from sage.rings.integer_ring import is_IntegerRing\n\n-from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomialRing_libsingular\n+from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomialRing_libsingular, MPolynomial_libsingular, new_MP\n from sage.rings.polynomial.multi_polynomial_ideal import NCPolynomialIdeal\n\n from sage.rings.polynomial.polydict import ETuple\n@@ -2860,13 +2860,16 @@ cpdef MPolynomialRing_libsingular new_CRing(RingWrap rw, base_ring):\n         sage: curcnt = ring_refcount_dict[currRing_wrapper()]\n         sage: newR = new_CRing(W, H.base_ring())\n         sage: ring_refcount_dict[currRing_wrapper()] - curcnt\n-        1\n+        2\n     \"\"\"\n     assert( rw.is_commutative() )\n\n     cdef MPolynomialRing_libsingular self = <MPolynomialRing_libsingular>MPolynomialRing_libsingular.__new__(MPolynomialRing_libsingular)\n\n     self._ring = rw._ring\n+    cdef MPolynomial_libsingular one = new_MP(self, p_ISet(1, self._ring))\n+    self._one_element = one\n+    self._one_element_poly = one._poly\n\n     wrapped_ring = wrap_ring(self._ring)\n     sage.libs.singular.ring.ring_refcount_dict[wrapped_ring] += 1\n```\nI compared this fix (which keeps the composite coercion map `int` -> `QQ` -> `C`) and the one Travis suggested in [comment:15](#comment%3A15) (which reverts it to the way it was before); somewhat surprisingly, the composite map is about 30% faster.",
    "created_at": "2020-03-10T13:41:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461503",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:16'></a>
Replying to [@mwageringel](#comment%3A14):
> Another problem that seems to be caused by this ticket:
> 
> ```
> sage: R.<x,y,z> = QQ[]
> sage: from sage.libs.singular.function_factory import ff
> sage: W = ff.ring(ff.ringlist(R), ring=R)
> sage: C = sage.rings.polynomial.plural.new_CRing(W, R.base_ring())
> sage: C.one()   # should be 1
> 0
> ```

I think the best way to fix this problem is to initialise `_one_element` and `_one_element_poly` in `new_CRing` in the same way as it is done in `MPolynomialRing_libsingular.__init__()`:

```diff
--- a/src/sage/rings/polynomial/plural.pyx
+++ b/src/sage/rings/polynomial/plural.pyx
@@ -126,7 +126,7 @@ from sage.rings.finite_rings.finite_field_prime_modn import FiniteField_prime_mo
 from sage.rings.integer cimport Integer
 from sage.rings.integer_ring import is_IntegerRing

-from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomialRing_libsingular
+from sage.rings.polynomial.multi_polynomial_libsingular cimport MPolynomialRing_libsingular, MPolynomial_libsingular, new_MP
 from sage.rings.polynomial.multi_polynomial_ideal import NCPolynomialIdeal

 from sage.rings.polynomial.polydict import ETuple
@@ -2860,13 +2860,16 @@ cpdef MPolynomialRing_libsingular new_CRing(RingWrap rw, base_ring):
         sage: curcnt = ring_refcount_dict[currRing_wrapper()]
         sage: newR = new_CRing(W, H.base_ring())
         sage: ring_refcount_dict[currRing_wrapper()] - curcnt
-        1
+        2
     """
     assert( rw.is_commutative() )

     cdef MPolynomialRing_libsingular self = <MPolynomialRing_libsingular>MPolynomialRing_libsingular.__new__(MPolynomialRing_libsingular)

     self._ring = rw._ring
+    cdef MPolynomial_libsingular one = new_MP(self, p_ISet(1, self._ring))
+    self._one_element = one
+    self._one_element_poly = one._poly

     wrapped_ring = wrap_ring(self._ring)
     sage.libs.singular.ring.ring_refcount_dict[wrapped_ring] += 1
```
I compared this fix (which keeps the composite coercion map `int` -> `QQ` -> `C`) and the one Travis suggested in [comment:15](#comment%3A15) (which reverts it to the way it was before); somewhat surprisingly, the composite map is about 30% faster.



---

archive/issue_comments_461504.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [@mwageringel](#comment%3A14):\n> Another possible problem seems to be the following, but I am not sure whether letterplace algebras are missing `from_base_ring` or whether its existence should not be assumed:\n> \n> ```\n> sage: F.<x,y,z> = FreeAlgebra(QQ, implementation='letterplace')\n> sage: F._coerce_map_from_base_ring()\n> ...\n> AttributeError: type object 'sage.algebras.letterplace.free_algebra_letterplace' has no attribute 'from_base_ring'\n> ```\n\nPython classes inherit a `from_base_ring()` method from the category of unital algebras when they are placed in that category, but Cython classes do not, because the category framework cannot change its type (see also [comment:2](#comment%3A2)).  I suggest this:\n\n```diff\n--- a/src/sage/categories/unital_algebras.py\n+++ b/src/sage/categories/unital_algebras.py\n@@ -212,7 +212,8 @@ class UnitalAlgebras(CategoryWithAxiom_over_base_ring):\n             # If there is a specialised from_base_ring(), then it should\n             # be used unconditionally.\n             generic_from_base_ring = self.category().parent_class.from_base_ring\n-            if type(self).from_base_ring != generic_from_base_ring:\n+            f = getattr(type(self), 'from_base_ring', None)\n+            if f is not None and f != generic_from_base_ring:\n                 # Custom from_base_ring()\n                 use_from_base_ring = True\n             if isinstance(generic_from_base_ring, lazy_attribute):\n```",
    "created_at": "2020-03-10T13:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461504",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:17'></a>
Replying to [@mwageringel](#comment%3A14):
> Another possible problem seems to be the following, but I am not sure whether letterplace algebras are missing `from_base_ring` or whether its existence should not be assumed:
> 
> ```
> sage: F.<x,y,z> = FreeAlgebra(QQ, implementation='letterplace')
> sage: F._coerce_map_from_base_ring()
> ...
> AttributeError: type object 'sage.algebras.letterplace.free_algebra_letterplace' has no attribute 'from_base_ring'
> ```

Python classes inherit a `from_base_ring()` method from the category of unital algebras when they are placed in that category, but Cython classes do not, because the category framework cannot change its type (see also [comment:2](#comment%3A2)).  I suggest this:

```diff
--- a/src/sage/categories/unital_algebras.py
+++ b/src/sage/categories/unital_algebras.py
@@ -212,7 +212,8 @@ class UnitalAlgebras(CategoryWithAxiom_over_base_ring):
             # If there is a specialised from_base_ring(), then it should
             # be used unconditionally.
             generic_from_base_ring = self.category().parent_class.from_base_ring
-            if type(self).from_base_ring != generic_from_base_ring:
+            f = getattr(type(self), 'from_base_ring', None)
+            if f is not None and f != generic_from_base_ring:
                 # Custom from_base_ring()
                 use_from_base_ring = True
             if isinstance(generic_from_base_ring, lazy_attribute):
```



---

archive/issue_comments_461505.json:
```json
{
    "body": "<a id='comment:18'></a>\nThe composite map is probably faster because `QQ` has specialized routines for converting `int` because of `mpq` and then creating the polynomial with elements already in `QQ` is likely very optimized as well. So I would go with Peter's solution in [comment:16](#comment%3A16).",
    "created_at": "2020-03-10T23:53:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461505",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
The composite map is probably faster because `QQ` has specialized routines for converting `int` because of `mpq` and then creating the polynomial with elements already in `QQ` is likely very optimized as well. So I would go with Peter's solution in [comment:16](#comment%3A16).



---

archive/issue_comments_461506.json:
```json
{
    "body": "<a id='comment:19'></a>\nSee #29311 and #29312 (the latter with a better solution than the one I suggested in [comment:17](#comment%3A17)).",
    "created_at": "2020-03-11T08:52:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29247#issuecomment-461506",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:19'></a>
See #29311 and #29312 (the latter with a better solution than the one I suggested in [comment:17](#comment%3A17)).
