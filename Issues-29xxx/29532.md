# Issue 29532: cygwin: Fix spkg-configure.m4 for iconv

archive/issues_029295.json:
```json
{
    "assignees": [],
    "body": "Follow-up from #27823 (spkg-configure.m4 for iconv), comment 46:\n\n  It seems that, at least on Cygwin, AM_ICONV will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at #include <iconv.h>).\n\n  For now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways. But maybe this still needs to be checked for somehow...\n\nIndeed this needs fixing:\n\n```\nconfigure:21635: g++ -std=gnu++11 -o conftest.exe -g -O2    conftest.cpp -lglpk -lreadline -lcurl -lbz2 -lflint -lmpfr -lgmp -lm  -lntl -liconv >&5\nconftest.cpp:68:10: fatal error: iconv.h: No such file or directory\n   68 | #include <iconv.h>\n      |          ^~~~~~~~~\ncompilation terminated.\n...\n\nconfigure:21645: result: no, consider installing GNU libiconv\n## ------------------------------------------------------ ##\n## Checking whether SageMath should install SPKG iconv... ##\n## ------------------------------------------------------ ##\nconfigure:21940: will use system package and not install SPKG iconv\n## ---------------------------------------------------- ##\n\n\n```\n\n\n  \n\nCC:  @embray @orlitzky @dimpase\n\nBranch/Commit: **[`49c8e4d`](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29532_\n\n",
    "closed_at": "2020-04-22T20:52:44Z",
    "created_at": "2020-04-19T13:40:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "cygwin: Fix spkg-configure.m4 for iconv",
    "type": "issue",
    "updated_at": "2020-04-22T20:52:44Z",
    "url": "https://github.com/sagemath/sage/issues/29532",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #27823 (spkg-configure.m4 for iconv), comment 46:

  It seems that, at least on Cygwin, AM_ICONV will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at #include <iconv.h>).

  For now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways. But maybe this still needs to be checked for somehow...

Indeed this needs fixing:

```
configure:21635: g++ -std=gnu++11 -o conftest.exe -g -O2    conftest.cpp -lglpk -lreadline -lcurl -lbz2 -lflint -lmpfr -lgmp -lm  -lntl -liconv >&5
conftest.cpp:68:10: fatal error: iconv.h: No such file or directory
   68 | #include <iconv.h>
      |          ^~~~~~~~~
compilation terminated.
...

configure:21645: result: no, consider installing GNU libiconv
## ------------------------------------------------------ ##
## Checking whether SageMath should install SPKG iconv... ##
## ------------------------------------------------------ ##
configure:21940: will use system package and not install SPKG iconv
## ---------------------------------------------------- ##


```


  

CC:  @embray @orlitzky @dimpase

Branch/Commit: **[`49c8e4d`](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**

Reviewer: **Dima Pasechnik**

Author: **Matthias Koeppe**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/29532_





---

archive/issue_events_406182.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T13:40:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406182"
}
```



---

archive/issue_events_406183.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T13:40:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406183"
}
```



---

archive/issue_events_406184.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T13:40:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406184"
}
```



---

archive/issue_events_406185.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T13:40:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406185"
}
```



---

archive/issue_comments_464436.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nhmm, so you are not running ./bootstrap on Cygwin?",
    "created_at": "2020-04-19T13:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464436",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

hmm, so you are not running ./bootstrap on Cygwin?



---

archive/issue_comments_464437.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nnote that spkg-install says \n\n```\n    echo \"iconv will be installed as the operating system is Cygwin, HP-UX or Solaris.\"\n    echo \"These systems either lack iconv, or do not have a sufficiently capable\"\n```\n\nIs this no longer true for Cygwin?",
    "created_at": "2020-04-19T14:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464437",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

note that spkg-install says 

```
    echo "iconv will be installed as the operating system is Cygwin, HP-UX or Solaris."
    echo "These systems either lack iconv, or do not have a sufficiently capable"
```

Is this no longer true for Cygwin?



---

archive/issue_comments_464438.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nGettext is installed, bootstrap worked.",
    "created_at": "2020-04-19T14:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464438",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

Gettext is installed, bootstrap worked.



---

archive/issue_comments_464439.json:
```json
{
    "body": "Branch: **[u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv)**",
    "created_at": "2020-04-19T15:14:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464439",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv)**



---

archive/issue_comments_464440.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484\"><code>49c8e4d</code></a></td><td><code>build/pkgs/iconv/spkg-configure.m4: Fix quoting bug</code></td></tr></table>\n",
    "created_at": "2020-04-19T15:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464440",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484"><code>49c8e4d</code></a></td><td><code>build/pkgs/iconv/spkg-configure.m4: Fix quoting bug</code></td></tr></table>




---

archive/issue_comments_464441.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-04-19T15:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464441",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_464442.json:
```json
{
    "body": "Commit: **[`49c8e4d`](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**",
    "created_at": "2020-04-19T15:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464442",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`49c8e4d`](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**



---

archive/issue_events_406186.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T15:31:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406186"
}
```



---

archive/issue_comments_464443.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-04-19T15:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464443",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_406187.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-19T15:45:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406187"
}
```



---

archive/issue_events_406188.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-19T15:45:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406188"
}
```



---

archive/issue_comments_464444.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOK, good catch.",
    "created_at": "2020-04-19T15:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464444",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

OK, good catch.



---

archive/issue_comments_464445.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks!",
    "created_at": "2020-04-19T15:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464445",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks!



---

archive/issue_comments_464446.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv)** to **[`49c8e4d`](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**",
    "created_at": "2020-04-22T20:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-464446",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv)** to **[`49c8e4d`](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**



---

archive/issue_events_406189.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-22T20:52:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406189"
}
```



---

archive/issue_events_406190.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "98c7ce08247ee9b5befb71319a648424681177ee",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-04-22T20:52:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-406190"
}
```
