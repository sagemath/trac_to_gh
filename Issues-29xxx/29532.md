# Issue 29532: cygwin: Fix spkg-configure.m4 for iconv

archive/issues_029295.json:
```json
{
    "assignees": [],
    "body": "Follow-up from #27823 (spkg-configure.m4 for iconv), comment 46:\n\n  It seems that, at least on Cygwin, AM_ICONV will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at #include <iconv.h>).\n\n  For now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways. But maybe this still needs to be checked for somehow...\n\nIndeed this needs fixing:\n\n```\nconfigure:21635: g++ -std=gnu++11 -o conftest.exe -g -O2    conftest.cpp -lglpk -lreadline -lcurl -lbz2 -lflint -lmpfr -lgmp -lm  -lntl -liconv >&5\nconftest.cpp:68:10: fatal error: iconv.h: No such file or directory\n   68 | #include <iconv.h>\n      |          ^~~~~~~~~\ncompilation terminated.\n...\n\nconfigure:21645: result: no, consider installing GNU libiconv\n## ------------------------------------------------------ ##\n## Checking whether SageMath should install SPKG iconv... ##\n## ------------------------------------------------------ ##\nconfigure:21940: will use system package and not install SPKG iconv\n## ---------------------------------------------------- ##\n\n\n```\n\n\n  \n\nCC:  @embray @orlitzky @dimpase\n\nBranch/Commit: **[49c8e4d](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29532_\n\n",
    "closed_at": "2020-04-22T20:52:44Z",
    "created_at": "2020-04-19T13:40:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "cygwin: Fix spkg-configure.m4 for iconv",
    "type": "issue",
    "updated_at": "2020-04-22T20:52:44Z",
    "url": "https://github.com/sagemath/sage/issues/29532",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #27823 (spkg-configure.m4 for iconv), comment 46:

  It seems that, at least on Cygwin, AM_ICONV will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at #include <iconv.h>).

  For now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways. But maybe this still needs to be checked for somehow...

Indeed this needs fixing:

```
configure:21635: g++ -std=gnu++11 -o conftest.exe -g -O2    conftest.cpp -lglpk -lreadline -lcurl -lbz2 -lflint -lmpfr -lgmp -lm  -lntl -liconv >&5
conftest.cpp:68:10: fatal error: iconv.h: No such file or directory
   68 | #include <iconv.h>
      |          ^~~~~~~~~
compilation terminated.
...

configure:21645: result: no, consider installing GNU libiconv
## ------------------------------------------------------ ##
## Checking whether SageMath should install SPKG iconv... ##
## ------------------------------------------------------ ##
configure:21940: will use system package and not install SPKG iconv
## ---------------------------------------------------- ##


```


  

CC:  @embray @orlitzky @dimpase

Branch/Commit: **[49c8e4d](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**

Reviewer: **Dima Pasechnik**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/29532_





---

archive/issue_events_374465.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T13:40:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374465"
}
```



---

archive/issue_events_374466.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T13:40:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "component: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374466"
}
```



---

archive/issue_events_374467.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T13:40:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374467"
}
```



---

archive/issue_events_374468.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T13:40:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374468"
}
```



---

archive/issue_comments_467327.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nhmm, so you are not running ./bootstrap on Cygwin?",
    "created_at": "2020-04-19T13:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467327",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'>Comment 1:</a>
hmm, so you are not running ./bootstrap on Cygwin?



---

archive/issue_comments_467328.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nnote that spkg-install says \n\n```\n    echo \"iconv will be installed as the operating system is Cygwin, HP-UX or Solaris.\"\n    echo \"These systems either lack iconv, or do not have a sufficiently capable\"\n```\n\nIs this no longer true for Cygwin?",
    "created_at": "2020-04-19T14:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467328",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'>Comment 2:</a>
note that spkg-install says 

```
    echo "iconv will be installed as the operating system is Cygwin, HP-UX or Solaris."
    echo "These systems either lack iconv, or do not have a sufficiently capable"
```

Is this no longer true for Cygwin?



---

archive/issue_comments_467329.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nGettext is installed, bootstrap worked.",
    "created_at": "2020-04-19T14:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467329",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'>Comment 3:</a>
Gettext is installed, bootstrap worked.



---

archive/issue_comments_467330.json:
```json
{
    "body": "Branch: **[u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv)**",
    "created_at": "2020-04-19T15:14:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467330",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv)**



---

archive/issue_comments_467331.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484\">49c8e4d</a></td><td><code>build/pkgs/iconv/spkg-configure.m4: Fix quoting bug</code></td></tr></table>\n",
    "created_at": "2020-04-19T15:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467331",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>Comment 5:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484">49c8e4d</a></td><td><code>build/pkgs/iconv/spkg-configure.m4: Fix quoting bug</code></td></tr></table>




---

archive/issue_comments_467332.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-04-19T15:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467332",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_467333.json:
```json
{
    "body": "Commit: **[49c8e4d](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**",
    "created_at": "2020-04-19T15:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467333",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[49c8e4d](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**



---

archive/issue_events_374469.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T15:31:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374469"
}
```



---

archive/issue_comments_467334.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-04-19T15:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467334",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_374470.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-19T15:45:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374470"
}
```



---

archive/issue_events_374471.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-19T15:45:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374471"
}
```



---

archive/issue_comments_467335.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nOK, good catch.",
    "created_at": "2020-04-19T15:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467335",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'>Comment 7:</a>
OK, good catch.



---

archive/issue_comments_467336.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThanks!",
    "created_at": "2020-04-19T15:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467336",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
Thanks!



---

archive/issue_comments_467337.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv)** to **[49c8e4d](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**",
    "created_at": "2020-04-22T20:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29532#issuecomment-467337",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/cygwin__fix_spkg_configure_m4_for_iconv)** to **[49c8e4d](https://github.com/sagemath/sagetrac-mirror/commit/49c8e4d2eda1a1c9f320b983c6ac5b7657653484)**



---

archive/issue_events_374472.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-22T20:52:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374472"
}
```



---

archive/issue_events_374473.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "98c7ce08247ee9b5befb71319a648424681177ee",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-04-22T20:52:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29532",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29532#event-374473"
}
```
