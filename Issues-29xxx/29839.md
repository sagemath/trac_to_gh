# Issue 29839: Implement `zero_pattern_matrix`

archive/issues_029602.json:
```json
{
    "body": "We implement a method on matrices that gives a new matrix with specified base ring\nand entries 1 where and only where the initial matrix had zero entries, and 0 elsewhere.\n\nMotivation: This method is useful to obtain the incidence matrix of a polyhedron from the slack matrix in #29837.\n\nAlong the way this ticket also fixes a bug:\n\n```\nM = Matrix(ZZ, [[0,1],[0,1]])\nsage: M._mod_int(2).transpose()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-8587f9dc80b2> in <module>()\n----> 1 M._mod_int(Integer(2)).transpose()\n\n/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n   1400             1\n   1401         \"\"\"\n-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n   1403         if self._nrows == 0 or self._ncols == 0:\n   1404             return A\n\nTypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n```\n\nTo optimize this method, a matrix class can use the optimized `get_is_zero_unsafe`.\nIn this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.\n\nKeywords: incidence matrix, zero pattern\n\nBranch/Commit: 82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89\n\nReviewer: Travis Scrimshaw, Jonathan Kliem\n\nAuthor: Jonathan Kliem, Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29839\n\n",
    "closed_at": "2020-06-27T09:25:22Z",
    "created_at": "2020-06-10T13:12:29Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Implement `zero_pattern_matrix`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29839",
    "user": "https://github.com/kliem"
}
```
We implement a method on matrices that gives a new matrix with specified base ring
and entries 1 where and only where the initial matrix had zero entries, and 0 elsewhere.

Motivation: This method is useful to obtain the incidence matrix of a polyhedron from the slack matrix in #29837.

Along the way this ticket also fixes a bug:

```
M = Matrix(ZZ, [[0,1],[0,1]])
sage: M._mod_int(2).transpose()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-8587f9dc80b2> in <module>()
----> 1 M._mod_int(Integer(2)).transpose()

/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
   1400             1
   1401         """
-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
   1403         if self._nrows == 0 or self._ncols == 0:
   1404             return A

TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
```

To optimize this method, a matrix class can use the optimized `get_is_zero_unsafe`.
In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.

Keywords: incidence matrix, zero pattern

Branch/Commit: 82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89

Reviewer: Travis Scrimshaw, Jonathan Kliem

Author: Jonathan Kliem, Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29839





---

archive/issue_comments_447842.json:
```json
{
    "body": "<a id='comment:1'></a>Better suggestions for a name would be welcome. `_zero_matrix` is somewhat strange.",
    "created_at": "2020-06-10T13:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447842",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>Better suggestions for a name would be welcome. `_zero_matrix` is somewhat strange.



---

archive/issue_comments_447843.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-10T13:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447843",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_447844.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2020-06-10T13:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447844",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_447845.json:
```json
{
    "body": "<a id='comment:3'></a>zero_pattern_matrix?",
    "created_at": "2020-06-10T13:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447845",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>zero_pattern_matrix?



---

archive/issue_comments_447846.json:
```json
{
    "body": "<a id='comment:4'></a>Better anyway. With public or semiprivate? (leading underscore).\n\nBtw, there is a bug here. I copied this from `_mod_two` which apparently sets up the parent incorrect:\n\n```\nM = Matrix(ZZ, [[0,1],[0,1]])\nsage: M._mod_int(2).transpose()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-8587f9dc80b2> in <module>()\n----> 1 M._mod_int(Integer(2)).transpose()\n\n/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n   1400             1\n   1401         \"\"\"\n-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n   1403         if self._nrows == 0 or self._ncols == 0:\n   1404             return A\n\nTypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\nsage:  MS = matrix_space.MatrixSpace(IntegerModRing(2), self._nrows, self._ncols)\n```",
    "created_at": "2020-06-10T14:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447846",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>Better anyway. With public or semiprivate? (leading underscore).

Btw, there is a bug here. I copied this from `_mod_two` which apparently sets up the parent incorrect:

```
M = Matrix(ZZ, [[0,1],[0,1]])
sage: M._mod_int(2).transpose()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-8587f9dc80b2> in <module>()
----> 1 M._mod_int(Integer(2)).transpose()

/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
   1400             1
   1401         """
-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
   1403         if self._nrows == 0 or self._ncols == 0:
   1404             return A

TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
sage:  MS = matrix_space.MatrixSpace(IntegerModRing(2), self._nrows, self._ncols)
```



---

archive/issue_comments_447847.json:
```json
{
    "body": "<a id='comment:5'></a>shouldn't `def _zero_matrix(self):` (or rather named as in comment:3) be `cpdef`, to facilitate calling from Cython?",
    "created_at": "2020-06-10T14:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447847",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>shouldn't `def _zero_matrix(self):` (or rather named as in comment:3) be `cpdef`, to facilitate calling from Cython?



---

archive/issue_comments_447848.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 gh-kliem]:\n> Better anyway. With public or semiprivate? (leading underscore).\n> \n> Btw, there is a bug here. I copied this from `_mod_two` which apparently sets up the parent incorrect:\n> \n> \n> ```\n> M = Matrix(ZZ, [[0,1],[0,1]])\n> sage: M._mod_int(2).transpose()\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> <ipython-input-4-8587f9dc80b2> in <module>()\n> ----> 1 M._mod_int(Integer(2)).transpose()\n> \n> /srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n>    1400             1\n>    1401         \"\"\"\n> -> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n>    1403         if self._nrows == 0 or self._ncols == 0:\n>    1404             return A\n> \n> TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n> sage:  MS = matrix_space.MatrixSpace(IntegerModRing(2), self._nrows, self._ncols)\n> ```\n\n\nwhy can't you use `mod`?\n\n```\nsage: M = Matrix(ZZ, [[0,1],[0,1]])\nsage: M.mod(2)\n[0 1]\n[0 1]\n```",
    "created_at": "2020-06-10T14:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447848",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>Replying to [comment:4 gh-kliem]:
> Better anyway. With public or semiprivate? (leading underscore).
> 
> Btw, there is a bug here. I copied this from `_mod_two` which apparently sets up the parent incorrect:
> 
> 
> ```
> M = Matrix(ZZ, [[0,1],[0,1]])
> sage: M._mod_int(2).transpose()
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> <ipython-input-4-8587f9dc80b2> in <module>()
> ----> 1 M._mod_int(Integer(2)).transpose()
> 
> /srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
>    1400             1
>    1401         """
> -> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
>    1403         if self._nrows == 0 or self._ncols == 0:
>    1404             return A
> 
> TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
> sage:  MS = matrix_space.MatrixSpace(IntegerModRing(2), self._nrows, self._ncols)
> ```


why can't you use `mod`?

```
sage: M = Matrix(ZZ, [[0,1],[0,1]])
sage: M.mod(2)
[0 1]
[0 1]
```



---

archive/issue_comments_447849.json:
```json
{
    "body": "<a id='comment:7'></a>Because it is slow. I just copied the construction of the parent from `_mod_two`.\nI really don't know why, but `change_ring` is really slow (e.g. for `ZZ` -> `GF(2)`). It should be improved, but maybe not in this ticket.\n\n`_mod_two` uses the ring with two elements to obtain the parent. However, `get_matrix_class` gives you `modn` in this case. It gives you `mod2` if you pass the field with two elements.",
    "created_at": "2020-06-10T14:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447849",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>Because it is slow. I just copied the construction of the parent from `_mod_two`.
I really don't know why, but `change_ring` is really slow (e.g. for `ZZ` -> `GF(2)`). It should be improved, but maybe not in this ticket.

`_mod_two` uses the ring with two elements to obtain the parent. However, `get_matrix_class` gives you `modn` in this case. It gives you `mod2` if you pass the field with two elements.



---

archive/issue_comments_447850.json:
```json
{
    "body": "<a id='comment:8'></a>And `M.mod` is really not what I want. I just illustrated this bug.",
    "created_at": "2020-06-10T14:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447850",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>And `M.mod` is really not what I want. I just illustrated this bug.



---

archive/issue_comments_447851.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -2,7 +2,25 @@\n \n Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.\n \n-Keywords: incidence matrix, zero entries\n+Along the way this ticket also fixes a bug:\n+\n+```\n+M = Matrix(ZZ, [[0,1],[0,1]])\n+sage: M._mod_int(2).transpose()\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-4-8587f9dc80b2> in <module>()\n+----> 1 M._mod_int(Integer(2)).transpose()\n+\n+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n+   1400             1\n+   1401         \"\"\"\n+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n+   1403         if self._nrows == 0 or self._ncols == 0:\n+   1404             return A\n+\n+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n+```\n \n Author: Jonathan Kliem\n \n```\n",
    "created_at": "2020-06-10T14:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447851",
    "user": "https://github.com/kliem"
}
```

Description changed:
```diff
--- 
+++ 
@@ -2,7 +2,25 @@
 
 Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.
 
-Keywords: incidence matrix, zero entries
+Along the way this ticket also fixes a bug:
+
+```
+M = Matrix(ZZ, [[0,1],[0,1]])
+sage: M._mod_int(2).transpose()
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-4-8587f9dc80b2> in <module>()
+----> 1 M._mod_int(Integer(2)).transpose()
+
+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
+   1400             1
+   1401         """
+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
+   1403         if self._nrows == 0 or self._ncols == 0:
+   1404             return A
+
+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
+```
 
 Author: Jonathan Kliem
 
```




---

archive/issue_comments_447852.json:
```json
{
    "body": "Changing keywords from \"incidence matrix, zero entries\" to \"incidence matrix, zero pattern\".",
    "created_at": "2020-06-10T14:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447852",
    "user": "https://github.com/kliem"
}
```

Changing keywords from "incidence matrix, zero entries" to "incidence matrix, zero pattern".



---

archive/issue_comments_447853.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-10T14:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447854.json:
```json
{
    "body": "<a id='comment:11'></a>New commits:",
    "created_at": "2020-06-10T14:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447854",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'></a>New commits:



---

archive/issue_comments_447855.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-10T20:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447855",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447856.json:
```json
{
    "body": "<a id='comment:12'></a>I really want a new integer matrix.",
    "created_at": "2020-06-10T20:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447856",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'></a>I really want a new integer matrix.



---

archive/issue_comments_447857.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-10T22:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447858.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+We implement a method that obtains a new integer matrix that contains 1 if and only if the corresponding entry is zero. Otherwise 0.\n \n+Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.\n+\n+Along the way this ticket also fixes a bug:\n+\n+```\n+M = Matrix(ZZ, [[0,1],[0,1]])\n+sage: M._mod_int(2).transpose()\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-4-8587f9dc80b2> in <module>()\n+----> 1 M._mod_int(Integer(2)).transpose()\n+\n+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n+   1400             1\n+   1401         \"\"\"\n+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n+   1403         if self._nrows == 0 or self._ncols == 0:\n+   1404             return A\n+\n+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n+```\n \n Author: Jonathan Kliem\n \n```\n",
    "created_at": "2020-06-10T22:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447858",
    "user": "https://github.com/kliem"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,26 @@
+We implement a method that obtains a new integer matrix that contains 1 if and only if the corresponding entry is zero. Otherwise 0.
 
+Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.
+
+Along the way this ticket also fixes a bug:
+
+```
+M = Matrix(ZZ, [[0,1],[0,1]])
+sage: M._mod_int(2).transpose()
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-4-8587f9dc80b2> in <module>()
+----> 1 M._mod_int(Integer(2)).transpose()
+
+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
+   1400             1
+   1401         """
+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
+   1403         if self._nrows == 0 or self._ncols == 0:
+   1404             return A
+
+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
+```
 
 Author: Jonathan Kliem
 
```




---

archive/issue_comments_447859.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-10T22:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447859",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447860.json:
```json
{
    "body": "<a id='comment:15'></a>Have you tried doing either `x = 1 - x` or `x = not x`? These should be fast as they avoid intermediate function calls and the first should work for any ring (maybe replace `1` with `one` where `one = self.base_ring().one()`).",
    "created_at": "2020-06-10T22:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447860",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>Have you tried doing either `x = 1 - x` or `x = not x`? These should be fast as they avoid intermediate function calls and the first should work for any ring (maybe replace `1` with `one` where `one = self.base_ring().one()`).



---

archive/issue_comments_447861.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 tscrim]:\n> Have you tried doing either `x = 1 - x` or `x = not x`? These should be fast as they avoid intermediate function calls and the first should work for any ring (maybe replace `1` with `one` where `one = self.base_ring().one()`).\n\n\nWhen? As in `slack_matrix.apply_map`?\n\nThis is slow, whatever I do.\n\nIf `slack_matrix` is the `slack_matrix` of the `polytopes.associahedron(['A', 9])` obtained e.g. with\n\n```\nsage: def get_slack(P):\n....:     self = P\n....:     Vrep_matrix = matrix(self.base_ring(), self.Vrepresentation())\n....:     Hrep_matrix = matrix(self.base_ring(), self.Hrepresentation())\n....:     hom_helper = matrix(self.base_ring(), [1 if v.is_vertex() else 0 for v\n....:  in self.Vrepresentation()])\n....:     hom_Vrep = hom_helper.stack(Vrep_matrix.transpose())\n....:     slack_matrix = (Hrep_matrix * hom_Vrep).transpose()\n....:     return slack_matrix\n\nsage: slack_matrix = get_slack(polytopes.associahedron(['A', 9])\n```\n\nthan the solution of this ticket needs about 15 ms. In comparison to\n\n```\nsage: %time incidence_matrix = M.apply_map(lambda y: not y, R=M.base_ring())\nCPU times: user 281 ms, sys: 15.8 ms, total: 296 ms\nWall time: 296 ms\n```\n\n(which is 100 ms slower than the trivial `lambda y: y`).",
    "created_at": "2020-06-10T23:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447861",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>Replying to [comment:15 tscrim]:
> Have you tried doing either `x = 1 - x` or `x = not x`? These should be fast as they avoid intermediate function calls and the first should work for any ring (maybe replace `1` with `one` where `one = self.base_ring().one()`).


When? As in `slack_matrix.apply_map`?

This is slow, whatever I do.

If `slack_matrix` is the `slack_matrix` of the `polytopes.associahedron(['A', 9])` obtained e.g. with

```
sage: def get_slack(P):
....:     self = P
....:     Vrep_matrix = matrix(self.base_ring(), self.Vrepresentation())
....:     Hrep_matrix = matrix(self.base_ring(), self.Hrepresentation())
....:     hom_helper = matrix(self.base_ring(), [1 if v.is_vertex() else 0 for v
....:  in self.Vrepresentation()])
....:     hom_Vrep = hom_helper.stack(Vrep_matrix.transpose())
....:     slack_matrix = (Hrep_matrix * hom_Vrep).transpose()
....:     return slack_matrix

sage: slack_matrix = get_slack(polytopes.associahedron(['A', 9])
```

than the solution of this ticket needs about 15 ms. In comparison to

```
sage: %time incidence_matrix = M.apply_map(lambda y: not y, R=M.base_ring())
CPU times: user 281 ms, sys: 15.8 ms, total: 296 ms
Wall time: 296 ms
```

(which is 100 ms slower than the trivial `lambda y: y`).



---

archive/issue_comments_447862.json:
```json
{
    "body": "<a id='comment:17'></a>For the `x = 1 - x`, I was thinking the matrix was already a 01 matrix (and perhaps you were trying to do it in-place). This is also slower than simply doing this?\n\n```python\n        cdef Py_ssize_t i, j\n        for i from 0 <= i < self._nrows:\n            for j from 0 <= j < self._ncols:\n                if not self.get_unsafe(i, j):\n                    M.set_unsafe_si(i, j, 1)\n```\nThis is more generic, but perhaps it is slower for special cases (e.g., rationals) because it goes partially through Python.\n\nI have some questions:\n\nShould this be lifted up to a generic matrix method with a generic implementation of `get_is_zero_unsafe`?\n\nDo you want to be an integer matrix or a mod2 matrix? The latter seems like it would be more memory efficient and possibly faster.\n\nI am not sure it is safe to assume the initialized matrix is 0. Is this documented somewhere?",
    "created_at": "2020-06-11T01:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447862",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>For the `x = 1 - x`, I was thinking the matrix was already a 01 matrix (and perhaps you were trying to do it in-place). This is also slower than simply doing this?

```python
        cdef Py_ssize_t i, j
        for i from 0 <= i < self._nrows:
            for j from 0 <= j < self._ncols:
                if not self.get_unsafe(i, j):
                    M.set_unsafe_si(i, j, 1)
```
This is more generic, but perhaps it is slower for special cases (e.g., rationals) because it goes partially through Python.

I have some questions:

Should this be lifted up to a generic matrix method with a generic implementation of `get_is_zero_unsafe`?

Do you want to be an integer matrix or a mod2 matrix? The latter seems like it would be more memory efficient and possibly faster.

I am not sure it is safe to assume the initialized matrix is 0. Is this documented somewhere?



---

archive/issue_comments_447863.json:
```json
{
    "body": "<a id='comment:18'></a>Good point. It is documented that the entries are not initialized.\n\nSo the following would be better:\n\n```\ncdef Matrix_integer_dense M = self._new(self._nrows, self._ncols)\ncdef Py_ssize_t i, j\n    for i from 0 <= i < self._nrows:\n        for j from 0 <= j < self._ncols:\n            if self.get_is_zero_unsafe(i, j):\n                M.set_unsafe_si(i, j, 1)\n            else:\n                M.set_unsafe_si(i, j, 0)\n```\n\nFor integers the difference between `if not self.get_unsafe(i, j)` and `if get_is_zero_unsafe(i, j)` is a factor of three. For rationals the difference is a factor of about 20.",
    "created_at": "2020-06-11T07:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447863",
    "user": "https://github.com/kliem"
}
```

<a id='comment:18'></a>Good point. It is documented that the entries are not initialized.

So the following would be better:

```
cdef Matrix_integer_dense M = self._new(self._nrows, self._ncols)
cdef Py_ssize_t i, j
    for i from 0 <= i < self._nrows:
        for j from 0 <= j < self._ncols:
            if self.get_is_zero_unsafe(i, j):
                M.set_unsafe_si(i, j, 1)
            else:
                M.set_unsafe_si(i, j, 0)
```

For integers the difference between `if not self.get_unsafe(i, j)` and `if get_is_zero_unsafe(i, j)` is a factor of three. For rationals the difference is a factor of about 20.



---

archive/issue_comments_447864.json:
```json
{
    "body": "<a id='comment:19'></a>`M.set_unsafe_si(i, j, self.get_is_zero_unsafe(i, j))` is a bit faster yet and almost the speed of not correctly initializing (26 ms vs 23 ms).",
    "created_at": "2020-06-11T07:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447864",
    "user": "https://github.com/kliem"
}
```

<a id='comment:19'></a>`M.set_unsafe_si(i, j, self.get_is_zero_unsafe(i, j))` is a bit faster yet and almost the speed of not correctly initializing (26 ms vs 23 ms).



---

archive/issue_comments_447865.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T09:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447866.json:
```json
{
    "body": "<a id='comment:21'></a>the",
    "created_at": "2020-06-11T09:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447866",
    "user": "https://github.com/kliem"
}
```

<a id='comment:21'></a>the



---

archive/issue_comments_447867.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+We implement a method that obtains a new matrix with specified base ring that contains 1 if and only if the corresponding entry is zero. Otherwise 0.\n \n+Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.\n+\n+Along the way this ticket also fixes a bug:\n+\n+```\n+M = Matrix(ZZ, [[0,1],[0,1]])\n+sage: M._mod_int(2).transpose()\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-4-8587f9dc80b2> in <module>()\n+----> 1 M._mod_int(Integer(2)).transpose()\n+\n+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n+   1400             1\n+   1401         \"\"\"\n+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n+   1403         if self._nrows == 0 or self._ncols == 0:\n+   1404             return A\n+\n+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n+```\n+\n+To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.\n+In this ticket this is done for `matrix_integer_dense` and `matrix_rational_dense`.\n \n Author: Jonathan Kliem\n \n```\n",
    "created_at": "2020-06-11T09:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447867",
    "user": "https://github.com/kliem"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,29 @@
+We implement a method that obtains a new matrix with specified base ring that contains 1 if and only if the corresponding entry is zero. Otherwise 0.
 
+Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.
+
+Along the way this ticket also fixes a bug:
+
+```
+M = Matrix(ZZ, [[0,1],[0,1]])
+sage: M._mod_int(2).transpose()
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-4-8587f9dc80b2> in <module>()
+----> 1 M._mod_int(Integer(2)).transpose()
+
+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
+   1400             1
+   1401         """
+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
+   1403         if self._nrows == 0 or self._ncols == 0:
+   1404             return A
+
+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
+```
+
+To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.
+In this ticket this is done for `matrix_integer_dense` and `matrix_rational_dense`.
 
 Author: Jonathan Kliem
 
```




---

archive/issue_comments_447868.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T09:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447869.json:
```json
{
    "body": "<a id='comment:23'></a>If you feel like `get_is_zero_unsafe` should be improved in other classes as well, please tell me. At the moment I would just leave it being optimized for those two classes that I need.",
    "created_at": "2020-06-11T09:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447869",
    "user": "https://github.com/kliem"
}
```

<a id='comment:23'></a>If you feel like `get_is_zero_unsafe` should be improved in other classes as well, please tell me. At the moment I would just leave it being optimized for those two classes that I need.



---

archive/issue_comments_447870.json:
```json
{
    "body": "<a id='comment:24'></a>Thank you. It is looking a lot better. One other place where it might make sense to do additional specialized `get_is_zero_unsafe` would be cyclo, gf2e, gfpn, and modn matrices, but these can wait if they turn out to be harder to do (I can also do some of them tomorrow). A few more little things:\n\nI don't understand this line:\n\n```\ncdef object one = M._coerce_element(1)\n```\nWhy not use `R.one()`? Also, similar to one of my previous questions, do we want this to be over the general ring? In principle, the matrix could be over a rng, and so the result might not be valid over `R` but the operation/output still makes sense. I think whatever output type we want (either as a `ZZ`-matrix or a `Zmod(2)`-matrix) is fine as long as we document it.\n\n```diff\n-        NOTE::\n+        .. NOTE::\n \n-            This method can be optimized by improving :meth:`get_is_zero_unsafe`` for derived matrix classes.\n+            This method can be optimized by improving :meth:`get_is_zero_unsafe` for derived matrix classes.\n```\n\n```diff\n-.. warning::\n+.. WARNING::\n```\n\nDo we want `get_is_zero_unsafe` to return a `bint` instead of an `int`? I don't hold a strong opinion, but I generally prefer the most restrictive/informative return type possible.",
    "created_at": "2020-06-11T14:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447870",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>Thank you. It is looking a lot better. One other place where it might make sense to do additional specialized `get_is_zero_unsafe` would be cyclo, gf2e, gfpn, and modn matrices, but these can wait if they turn out to be harder to do (I can also do some of them tomorrow). A few more little things:

I don't understand this line:

```
cdef object one = M._coerce_element(1)
```
Why not use `R.one()`? Also, similar to one of my previous questions, do we want this to be over the general ring? In principle, the matrix could be over a rng, and so the result might not be valid over `R` but the operation/output still makes sense. I think whatever output type we want (either as a `ZZ`-matrix or a `Zmod(2)`-matrix) is fine as long as we document it.

```diff
-        NOTE::
+        .. NOTE::
 
-            This method can be optimized by improving :meth:`get_is_zero_unsafe`` for derived matrix classes.
+            This method can be optimized by improving :meth:`get_is_zero_unsafe` for derived matrix classes.
```

```diff
-.. warning::
+.. WARNING::
```

Do we want `get_is_zero_unsafe` to return a `bint` instead of an `int`? I don't hold a strong opinion, but I generally prefer the most restrictive/informative return type possible.



---

archive/issue_comments_447871.json:
```json
{
    "body": "<a id='comment:25'></a>I prefer `int` for the following reason: It can be useful, if we guarantee that the value is either `1` or `0`. I'm not using it like this anymore, but I wouldn't burn bridges. This way we really guarantee that the method returns `1` or `0`. If we return a `bint` this would leave the impression that the exact value doesn't matter.\n\n```\nsage: cython('''\n....: def foo(int a):\n....:     cdef bint b = a\n....:     return 2 - b\n....: ''')\n```\n\nThis is an example that `bint` really can take any integer value. If you run `foo(10)`, it will return `-8`.",
    "created_at": "2020-06-11T16:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447871",
    "user": "https://github.com/kliem"
}
```

<a id='comment:25'></a>I prefer `int` for the following reason: It can be useful, if we guarantee that the value is either `1` or `0`. I'm not using it like this anymore, but I wouldn't burn bridges. This way we really guarantee that the method returns `1` or `0`. If we return a `bint` this would leave the impression that the exact value doesn't matter.

```
sage: cython('''
....: def foo(int a):
....:     cdef bint b = a
....:     return 2 - b
....: ''')
```

This is an example that `bint` really can take any integer value. If you run `foo(10)`, it will return `-8`.



---

archive/issue_comments_447872.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:24 tscrim]:\n> Thank you. It is looking a lot better. One other place where it might make sense to do additional specialized `get_is_zero_unsafe` would be cyclo, gf2e, gfpn, and modn matrices, but these can wait if they turn out to be harder to do (I can also do some of them tomorrow). A few more little things:\n> \n> I don't understand this line:\n> \n> ```\n> cdef object one = M._coerce_element(1)\n> ```\n> Why not use `R.one()`? Also, similar to one of my previous questions, do we want this to be over the general ring? In principle, the matrix could be over a rng, and so the result might not be valid over `R` but the operation/output still makes sense.\n\n\nI don't find an example of a matrix with base ring not a ring. It is mentioned in the constructor that such things exists, but I can't find it. Can you help me out?\n\nWe could have another optional argument, where you specify what you want to fill the matrix with, if not ones.\n\n> I think whatever output type we want (either as a `ZZ`-matrix or a `Zmod(2)`-matrix) is fine as long as we document it.\n> \n> \n> ```diff\n> -        NOTE::\n> +        .. NOTE::\n>  \n> -            This method can be optimized by improving :meth:`get_is_zero_unsafe`` for derived matrix classes.\n> +            This method can be optimized by improving :meth:`get_is_zero_unsafe` for derived matrix classes.\n> ```\n> \n> \n> ```diff\n> -.. warning::\n> +.. WARNING::\n> ```\n> \n> Do we want `get_is_zero_unsafe` to return a `bint` instead of an `int`? I don't hold a strong opinion, but I generally prefer the most restrictive/informative return type possible.",
    "created_at": "2020-06-11T18:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447872",
    "user": "https://github.com/kliem"
}
```

<a id='comment:26'></a>Replying to [comment:24 tscrim]:
> Thank you. It is looking a lot better. One other place where it might make sense to do additional specialized `get_is_zero_unsafe` would be cyclo, gf2e, gfpn, and modn matrices, but these can wait if they turn out to be harder to do (I can also do some of them tomorrow). A few more little things:
> 
> I don't understand this line:
> 
> ```
> cdef object one = M._coerce_element(1)
> ```
> Why not use `R.one()`? Also, similar to one of my previous questions, do we want this to be over the general ring? In principle, the matrix could be over a rng, and so the result might not be valid over `R` but the operation/output still makes sense.


I don't find an example of a matrix with base ring not a ring. It is mentioned in the constructor that such things exists, but I can't find it. Can you help me out?

We could have another optional argument, where you specify what you want to fill the matrix with, if not ones.

> I think whatever output type we want (either as a `ZZ`-matrix or a `Zmod(2)`-matrix) is fine as long as we document it.
> 
> 
> ```diff
> -        NOTE::
> +        .. NOTE::
>  
> -            This method can be optimized by improving :meth:`get_is_zero_unsafe`` for derived matrix classes.
> +            This method can be optimized by improving :meth:`get_is_zero_unsafe` for derived matrix classes.
> ```
> 
> 
> ```diff
> -.. warning::
> +.. WARNING::
> ```
> 
> Do we want `get_is_zero_unsafe` to return a `bint` instead of an `int`? I don't hold a strong opinion, but I generally prefer the most restrictive/informative return type possible.



---

archive/issue_comments_447873.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T20:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447873",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447874.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-11T20:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447874",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447875.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T20:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447875",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447876.json:
```json
{
    "body": "<a id='comment:30'></a>Sage explicitly only allows rings to be passed to matrices, despite what the documentation currently says:\n\n```\nsage: S = Semigroups().example()\nsage: A = S.algebra(QQ)\nsage: M = matrix(A, [[A.zero()]])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-5bed397dad10> in <module>()\n----> 1 M = matrix(A, [[A.zero()]])\n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/constructor.pyx in sage.matrix.constructor.matrix (build/cythonized/sage/matrix/constructor.c:2479)()\n    633     \"\"\"\n    634     immutable = kwds.pop('immutable', False)\n--> 635     M = MatrixArgs(*args, **kwds).matrix()\n    636     if immutable:\n    637         M.set_immutable()\n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/args.pyx in sage.matrix.args.MatrixArgs.matrix (build/cythonized/sage/matrix/args.c:7668)()\n    650             True\n    651         \"\"\"\n--> 652         self.finalize()\n    653 \n    654         cdef Matrix M\n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/args.pyx in sage.matrix.args.MatrixArgs.finalize (build/cythonized/sage/matrix/args.c:10264)()\n    932 \n    933         if self.space is None:\n--> 934             self.space = MatrixSpace(self.base, self.nrows, self.ncols,\n    935                     sparse=self.sparse, **self.kwds)\n    936 \n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1741)()\n    320         \"\"\"\n    321         if cls.classcall is not None:\n--> 322             return cls.classcall(cls, *args, **kwds)\n    323         else:\n    324             # Fast version of type.__call__(cls, *args, **kwds)\n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py in __classcall__(cls, base_ring, nrows, ncols, sparse, implementation, **kwds)\n    489         \"\"\"\n    490         if base_ring not in _Rings:\n--> 491             raise TypeError(\"base_ring (=%s) must be a ring\"%base_ring)\n    492         nrows = int(nrows)\n    493         if ncols is None:\n\nTypeError: base_ring (=Algebra of An example of a semigroup: the left zero semigroup over Rational Field) must be a ring\n```\nSo that might not something we need to worry about right now. Irregardless, I am still not convinced that we should be returning a matrix over the base ring and not either **Z** or **Z**<sub>2</sub>.\n\nI see your argument for not using `bint`; it is actually a little disheartening to see that code block; but I see that as garbage-in, garbage-out. My counter point would be the `is_zero_unsage` is suppose to be recording a true/false value, which is what the `bint` is suppose to be for (equivalent to a `bool` in C). Plus it is standard that `1` is `True`. So even if it is not enforacble, it still carries contextual significance.",
    "created_at": "2020-06-12T00:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447876",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>Sage explicitly only allows rings to be passed to matrices, despite what the documentation currently says:

```
sage: S = Semigroups().example()
sage: A = S.algebra(QQ)
sage: M = matrix(A, [[A.zero()]])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-5bed397dad10> in <module>()
----> 1 M = matrix(A, [[A.zero()]])

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/constructor.pyx in sage.matrix.constructor.matrix (build/cythonized/sage/matrix/constructor.c:2479)()
    633     """
    634     immutable = kwds.pop('immutable', False)
--> 635     M = MatrixArgs(*args, **kwds).matrix()
    636     if immutable:
    637         M.set_immutable()

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/args.pyx in sage.matrix.args.MatrixArgs.matrix (build/cythonized/sage/matrix/args.c:7668)()
    650             True
    651         """
--> 652         self.finalize()
    653 
    654         cdef Matrix M

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/args.pyx in sage.matrix.args.MatrixArgs.finalize (build/cythonized/sage/matrix/args.c:10264)()
    932 
    933         if self.space is None:
--> 934             self.space = MatrixSpace(self.base, self.nrows, self.ncols,
    935                     sparse=self.sparse, **self.kwds)
    936 

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1741)()
    320         """
    321         if cls.classcall is not None:
--> 322             return cls.classcall(cls, *args, **kwds)
    323         else:
    324             # Fast version of type.__call__(cls, *args, **kwds)

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py in __classcall__(cls, base_ring, nrows, ncols, sparse, implementation, **kwds)
    489         """
    490         if base_ring not in _Rings:
--> 491             raise TypeError("base_ring (=%s) must be a ring"%base_ring)
    492         nrows = int(nrows)
    493         if ncols is None:

TypeError: base_ring (=Algebra of An example of a semigroup: the left zero semigroup over Rational Field) must be a ring
```
So that might not something we need to worry about right now. Irregardless, I am still not convinced that we should be returning a matrix over the base ring and not either **Z** or **Z**<sub>2</sub>.

I see your argument for not using `bint`; it is actually a little disheartening to see that code block; but I see that as garbage-in, garbage-out. My counter point would be the `is_zero_unsage` is suppose to be recording a true/false value, which is what the `bint` is suppose to be for (equivalent to a `bool` in C). Plus it is standard that `1` is `True`. So even if it is not enforacble, it still carries contextual significance.



---

archive/issue_comments_447877.json:
```json
{
    "body": "<a id='comment:31'></a>As for other rings I think I have questions with all of them:\n\n- `gfpn` is `get_unsafe_int` guaranteed to be `0` if the entry is zero, or might it be `0` mod cardinality of field, if not, where do I find the cardinality?\n- similar for `gf2e` and `modn`\n- `cyclo` (I just realized this is probably easy)\n\nEDIT:\n\nFor `gf2e` this is indirectly confirmed in `rings/finite_rings/element_givaro.pyx` in `fetch_int`.",
    "created_at": "2020-06-12T06:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447877",
    "user": "https://github.com/kliem"
}
```

<a id='comment:31'></a>As for other rings I think I have questions with all of them:

- `gfpn` is `get_unsafe_int` guaranteed to be `0` if the entry is zero, or might it be `0` mod cardinality of field, if not, where do I find the cardinality?
- similar for `gf2e` and `modn`
- `cyclo` (I just realized this is probably easy)

EDIT:

For `gf2e` this is indirectly confirmed in `rings/finite_rings/element_givaro.pyx` in `fetch_int`.



---

archive/issue_comments_447878.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-12T08:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447878",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447879.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-13T01:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447879",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447880.json:
```json
{
    "body": "<a id='comment:35'></a>Okay, this is an implementation for all of the specialized dense matrices I mentioned before.\n\nI really don't like how in the gf2e it redirects through python for such a key feature with `get_unsafe`. This needs to be removed and is now #29853. Likely the way to do it will be based on what is done for gfpn.\n\nSome additions of better `__bool__` methods:\n\n```\nsage: K.<z> = CyclotomicField(3)\nsage: A = matrix(K, 4, 3, [0, -z, -2, -2*z + 2, 2*z, z, z, 1-z, 2+3*z, z, 1+z, 0])\nsage: %timeit bool(A)\n10000000 loops, best of 5: 86.2 ns per loop\nsage: %timeit bool(Z)\n10000000 loops, best of 5: 152 ns per loop\n```\nversus before:\n\n```\nsage: %timeit bool(A)\nThe slowest run took 70.37 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 5: 8.49 \u00b5s per loop\nsage: Z = matrix(K, 4, 3, 0)\nsage: %timeit bool(Z)\nThe slowest run took 7.43 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 5: 50 \u00b5s per loop\n```\n\nI also made changes in other places where `get_is_unsafe_zero()` could be used. Like the above and in your use case, this likely has (potentially significantly) sped things up.",
    "created_at": "2020-06-13T01:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447880",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>Okay, this is an implementation for all of the specialized dense matrices I mentioned before.

I really don't like how in the gf2e it redirects through python for such a key feature with `get_unsafe`. This needs to be removed and is now #29853. Likely the way to do it will be based on what is done for gfpn.

Some additions of better `__bool__` methods:

```
sage: K.<z> = CyclotomicField(3)
sage: A = matrix(K, 4, 3, [0, -z, -2, -2*z + 2, 2*z, z, z, 1-z, 2+3*z, z, 1+z, 0])
sage: %timeit bool(A)
10000000 loops, best of 5: 86.2 ns per loop
sage: %timeit bool(Z)
10000000 loops, best of 5: 152 ns per loop
```
versus before:

```
sage: %timeit bool(A)
The slowest run took 70.37 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 5: 8.49 s per loop
sage: Z = matrix(K, 4, 3, 0)
sage: %timeit bool(Z)
The slowest run took 7.43 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 5: 50 s per loop
```

I also made changes in other places where `get_is_unsafe_zero()` could be used. Like the above and in your use case, this likely has (potentially significantly) sped things up.



---

archive/issue_comments_447881.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-13T01:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447881",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447882.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-13T01:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447882",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447883.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-13T02:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447884.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-13T02:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447884",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447885.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+We implement a method that obtains a new matrix with specified base ring that contains 1 if and only if the corresponding entry is zero. Otherwise 0.\n \n+Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.\n+\n+Along the way this ticket also fixes a bug:\n+\n+```\n+M = Matrix(ZZ, [[0,1],[0,1]])\n+sage: M._mod_int(2).transpose()\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-4-8587f9dc80b2> in <module>()\n+----> 1 M._mod_int(Integer(2)).transpose()\n+\n+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n+   1400             1\n+   1401         \"\"\"\n+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n+   1403         if self._nrows == 0 or self._ncols == 0:\n+   1404             return A\n+\n+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n+```\n+\n+To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.\n+In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.\n \n Author: Jonathan Kliem\n \n```\n",
    "created_at": "2020-06-13T02:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447885",
    "user": "https://github.com/tscrim"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,29 @@
+We implement a method that obtains a new matrix with specified base ring that contains 1 if and only if the corresponding entry is zero. Otherwise 0.
 
+Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.
+
+Along the way this ticket also fixes a bug:
+
+```
+M = Matrix(ZZ, [[0,1],[0,1]])
+sage: M._mod_int(2).transpose()
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-4-8587f9dc80b2> in <module>()
+----> 1 M._mod_int(Integer(2)).transpose()
+
+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
+   1400             1
+   1401         """
+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
+   1403         if self._nrows == 0 or self._ncols == 0:
+   1404             return A
+
+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
+```
+
+To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.
+In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.
 
 Author: Jonathan Kliem
 
```




---

archive/issue_comments_447886.json:
```json
{
    "body": "<a id='comment:39'></a>Okay, that takes care of the sparse matrices and symbolic matrices.\n\nSlightly surprisingly, the gap matrices don't benefit from not going through Sage (well, at least for integer matrices).\n\nI am done now.",
    "created_at": "2020-06-13T02:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447886",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'></a>Okay, that takes care of the sparse matrices and symbolic matrices.

Slightly surprisingly, the gap matrices don't benefit from not going through Sage (well, at least for integer matrices).

I am done now.



---

archive/issue_comments_447887.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-13T09:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447888.json:
```json
{
    "body": "<a id='comment:41'></a>IMO this is good now. The doctests should also pass.",
    "created_at": "2020-06-13T09:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447888",
    "user": "https://github.com/kliem"
}
```

<a id='comment:41'></a>IMO this is good now. The doctests should also pass.



---

archive/issue_comments_447889.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-13T19:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447890.json:
```json
{
    "body": "<a id='comment:43'></a>Thank you. Two more little things:\n\n```diff\n         INPUT:\n \n-        - `ring` -- (optional); base ring of the output; default is `ZZ`\n+        - `ring` -- (optional); base ring of the output; default is ``ZZ``\n```\nand we should add a test for the empty row/column and empty matrix for `Matrix_gf2e_dense.__bool__` (as that was a good catch). I can do this tomorrow.",
    "created_at": "2020-06-13T22:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447890",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>Thank you. Two more little things:

```diff
         INPUT:
 
-        - `ring` -- (optional); base ring of the output; default is `ZZ`
+        - `ring` -- (optional); base ring of the output; default is ``ZZ``
```
and we should add a test for the empty row/column and empty matrix for `Matrix_gf2e_dense.__bool__` (as that was a good catch). I can do this tomorrow.



---

archive/issue_comments_447891.json:
```json
{
    "body": "<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-13T23:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447891",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447892.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:43 tscrim]:\n> and we should add a test for the empty row/column and empty matrix for `Matrix_gf2e_dense.__bool__` (as that was a good catch).\n\n\nWell the bot was segfaulting (and me to, when running the test).",
    "created_at": "2020-06-13T23:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447892",
    "user": "https://github.com/kliem"
}
```

<a id='comment:45'></a>Replying to [comment:43 tscrim]:
> and we should add a test for the empty row/column and empty matrix for `Matrix_gf2e_dense.__bool__` (as that was a good catch).


Well the bot was segfaulting (and me to, when running the test).



---

archive/issue_comments_447893.json:
```json
{
    "body": "<a id='comment:46'></a>Okay, then positive review. Thank you.",
    "created_at": "2020-06-13T23:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447893",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>Okay, then positive review. Thank you.



---

archive/issue_comments_447894.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-13T23:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447894",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447895.json:
```json
{
    "body": "<a id='comment:47'></a>I like that you made a polyhedron only ticket, into a more general improvement for other parts as well.",
    "created_at": "2020-06-14T08:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447895",
    "user": "https://github.com/kliem"
}
```

<a id='comment:47'></a>I like that you made a polyhedron only ticket, into a more general improvement for other parts as well.



---

archive/issue_comments_447896.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,30 @@\n+We implement a method on matrices that gives a new matrix with specified base ring\n+and entries 1 where and only where the initial matrix had zero entries, and 0 elsewhere.\n \n+Motivation: This method is useful to obtain the incidence matrix of a polyhedron from the slack matrix in #29837.\n+\n+Along the way this ticket also fixes a bug:\n+\n+```\n+M = Matrix(ZZ, [[0,1],[0,1]])\n+sage: M._mod_int(2).transpose()\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-4-8587f9dc80b2> in <module>()\n+----> 1 M._mod_int(Integer(2)).transpose()\n+\n+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n+   1400             1\n+   1401         \"\"\"\n+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n+   1403         if self._nrows == 0 or self._ncols == 0:\n+   1404             return A\n+\n+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n+```\n+\n+To optimize this method, a matrix class can use the optimized `get_is_zero_unsafe`.\n+In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.\n \n Author: Jonathan Kliem\n \n```\n",
    "created_at": "2020-06-18T02:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447896",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,30 @@
+We implement a method on matrices that gives a new matrix with specified base ring
+and entries 1 where and only where the initial matrix had zero entries, and 0 elsewhere.
 
+Motivation: This method is useful to obtain the incidence matrix of a polyhedron from the slack matrix in #29837.
+
+Along the way this ticket also fixes a bug:
+
+```
+M = Matrix(ZZ, [[0,1],[0,1]])
+sage: M._mod_int(2).transpose()
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-4-8587f9dc80b2> in <module>()
+----> 1 M._mod_int(Integer(2)).transpose()
+
+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
+   1400             1
+   1401         """
+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
+   1403         if self._nrows == 0 or self._ncols == 0:
+   1404             return A
+
+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
+```
+
+To optimize this method, a matrix class can use the optimized `get_is_zero_unsafe`.
+In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.
 
 Author: Jonathan Kliem
 
```




---

archive/issue_comments_447897.json:
```json
{
    "body": "<a id='comment:48'></a>(Slightly amending ticket description, please check that works for you.).",
    "created_at": "2020-06-18T02:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447897",
    "user": "https://github.com/slel"
}
```

<a id='comment:48'></a>(Slightly amending ticket description, please check that works for you.).



---

archive/issue_events_076417.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-06-27T09:25:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29839#event-76417"
}
```



---

archive/issue_comments_447898.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-27T09:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29839#issuecomment-447898",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
