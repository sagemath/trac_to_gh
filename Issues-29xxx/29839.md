# Issue 29839: Implement `zero_pattern_matrix`

archive/issues_029602.json:
```json
{
    "assignees": [],
    "body": "We implement a method on matrices that gives a new matrix with specified base ring\nand entries 1 where and only where the initial matrix had zero entries, and 0 elsewhere.\n\nMotivation: This method is useful to obtain the incidence matrix of a polyhedron from the slack matrix in #29837.\n\nAlong the way this ticket also fixes a bug:\n\n```\nM = Matrix(ZZ, [[0,1],[0,1]])\nsage: M._mod_int(2).transpose()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-8587f9dc80b2> in <module>()\n----> 1 M._mod_int(Integer(2)).transpose()\n\n/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n   1400             1\n   1401         \"\"\"\n-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n   1403         if self._nrows == 0 or self._ncols == 0:\n   1404             return A\n\nTypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n```\n\nTo optimize this method, a matrix class can use the optimized `get_is_zero_unsafe`.\nIn this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.\n\nKeywords: **incidence matrix, zero pattern**\n\nBranch/Commit: **[`82c6b4a`](https://github.com/sagemath/sagetrac-mirror/commit/82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89)**\n\nReviewer: **Travis Scrimshaw, Jonathan Kliem**\n\nAuthor: **Jonathan Kliem, Travis Scrimshaw**\n\nComponent: **basic arithmetic**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29839_\n\n",
    "closed_at": "2020-06-27T09:25:22Z",
    "created_at": "2020-06-10T13:12:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement `zero_pattern_matrix`",
    "type": "issue",
    "updated_at": "2020-06-27T09:25:22Z",
    "url": "https://github.com/sagemath/sage/issues/29839",
    "user": "https://github.com/kliem"
}
```
We implement a method on matrices that gives a new matrix with specified base ring
and entries 1 where and only where the initial matrix had zero entries, and 0 elsewhere.

Motivation: This method is useful to obtain the incidence matrix of a polyhedron from the slack matrix in #29837.

Along the way this ticket also fixes a bug:

```
M = Matrix(ZZ, [[0,1],[0,1]])
sage: M._mod_int(2).transpose()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-8587f9dc80b2> in <module>()
----> 1 M._mod_int(Integer(2)).transpose()

/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
   1400             1
   1401         """
-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
   1403         if self._nrows == 0 or self._ncols == 0:
   1404             return A

TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
```

To optimize this method, a matrix class can use the optimized `get_is_zero_unsafe`.
In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.

Keywords: **incidence matrix, zero pattern**

Branch/Commit: **[`82c6b4a`](https://github.com/sagemath/sagetrac-mirror/commit/82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89)**

Reviewer: **Travis Scrimshaw, Jonathan Kliem**

Author: **Jonathan Kliem, Travis Scrimshaw**

Component: **basic arithmetic**

_Issue created by migration from https://trac.sagemath.org/ticket/29839_





---

archive/issue_events_407566.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T13:12:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407566"
}
```



---

archive/issue_events_407567.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T13:12:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407567"
}
```



---

archive/issue_events_407568.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T13:12:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407568"
}
```



---

archive/issue_events_407569.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T13:12:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407569"
}
```



---

archive/issue_comments_470967.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nBetter suggestions for a name would be welcome. `_zero_matrix` is somewhat strange.",
    "created_at": "2020-06-10T13:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470967",
    "user": "https://github.com/kliem"
}
```

<div id="comment:1" align="right">comment:1</div>

Better suggestions for a name would be welcome. `_zero_matrix` is somewhat strange.



---

archive/issue_events_407570.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T13:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407570"
}
```



---

archive/issue_comments_470968.json:
```json
{
    "body": "Branch: **[public/29839](https://github.com/sagemath/sagetrac-mirror/tree/public/29839)**",
    "created_at": "2020-06-10T13:13:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470968",
    "user": "https://github.com/kliem"
}
```

Branch: **[public/29839](https://github.com/sagemath/sagetrac-mirror/tree/public/29839)**



---

archive/issue_comments_470969.json:
```json
{
    "body": "Commit: **[`43e6dfb`](https://github.com/sagemath/sagetrac-mirror/commit/43e6dfbd64c1372d0829ff18df7a9c7aa9491738)**",
    "created_at": "2020-06-10T13:13:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470969",
    "user": "https://github.com/kliem"
}
```

Commit: **[`43e6dfb`](https://github.com/sagemath/sagetrac-mirror/commit/43e6dfbd64c1372d0829ff18df7a9c7aa9491738)**



---

archive/issue_comments_470970.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43e6dfbd64c1372d0829ff18df7a9c7aa9491738\"><code>43e6dfb</code></a></td><td><code>implement _zero_matrix</code></td></tr></table>\n",
    "created_at": "2020-06-10T13:13:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470970",
    "user": "https://github.com/kliem"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43e6dfbd64c1372d0829ff18df7a9c7aa9491738"><code>43e6dfb</code></a></td><td><code>implement _zero_matrix</code></td></tr></table>




---

archive/issue_comments_470971.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nzero_pattern_matrix?",
    "created_at": "2020-06-10T13:57:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470971",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

zero_pattern_matrix?



---

archive/issue_comments_470972.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nBetter anyway. With public or semiprivate? (leading underscore).\n\nBtw, there is a bug here. I copied this from `_mod_two` which apparently sets up the parent incorrect:\n\n```\nM = Matrix(ZZ, [[0,1],[0,1]])\nsage: M._mod_int(2).transpose()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-8587f9dc80b2> in <module>()\n----> 1 M._mod_int(Integer(2)).transpose()\n\n/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n   1400             1\n   1401         \"\"\"\n-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n   1403         if self._nrows == 0 or self._ncols == 0:\n   1404             return A\n\nTypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\nsage:  MS = matrix_space.MatrixSpace(IntegerModRing(2), self._nrows, self._ncols)\n```",
    "created_at": "2020-06-10T14:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470972",
    "user": "https://github.com/kliem"
}
```

<div id="comment:4" align="right">comment:4</div>

Better anyway. With public or semiprivate? (leading underscore).

Btw, there is a bug here. I copied this from `_mod_two` which apparently sets up the parent incorrect:

```
M = Matrix(ZZ, [[0,1],[0,1]])
sage: M._mod_int(2).transpose()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-8587f9dc80b2> in <module>()
----> 1 M._mod_int(Integer(2)).transpose()

/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
   1400             1
   1401         """
-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
   1403         if self._nrows == 0 or self._ncols == 0:
   1404             return A

TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
sage:  MS = matrix_space.MatrixSpace(IntegerModRing(2), self._nrows, self._ncols)
```



---

archive/issue_comments_470973.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nshouldn't `def _zero_matrix(self):` (or rather named as in [comment:3](#comment:3)) be `cpdef`, to facilitate calling from Cython?",
    "created_at": "2020-06-10T14:01:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470973",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

shouldn't `def _zero_matrix(self):` (or rather named as in [comment:3](#comment:3)) be `cpdef`, to facilitate calling from Cython?



---

archive/issue_comments_470974.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@kliem](#comment:4):\n> Better anyway. With public or semiprivate? (leading underscore).\n> \n> Btw, there is a bug here. I copied this from `_mod_two` which apparently sets up the parent incorrect:\n> \n> ```\n> M = Matrix(ZZ, [[0,1],[0,1]])\n> sage: M._mod_int(2).transpose()\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> <ipython-input-4-8587f9dc80b2> in <module>()\n> ----> 1 M._mod_int(Integer(2)).transpose()\n> \n> /srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n>    1400             1\n>    1401         \"\"\"\n> -> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n>    1403         if self._nrows == 0 or self._ncols == 0:\n>    1404             return A\n> \n> TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n> sage:  MS = matrix_space.MatrixSpace(IntegerModRing(2), self._nrows, self._ncols)\n> ```\n\nwhy can't you use `mod`?\n\n```\nsage: M = Matrix(ZZ, [[0,1],[0,1]])\nsage: M.mod(2)\n[0 1]\n[0 1]\n```",
    "created_at": "2020-06-10T14:05:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470974",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@kliem](#comment:4):
> Better anyway. With public or semiprivate? (leading underscore).
> 
> Btw, there is a bug here. I copied this from `_mod_two` which apparently sets up the parent incorrect:
> 
> ```
> M = Matrix(ZZ, [[0,1],[0,1]])
> sage: M._mod_int(2).transpose()
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> <ipython-input-4-8587f9dc80b2> in <module>()
> ----> 1 M._mod_int(Integer(2)).transpose()
> 
> /srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
>    1400             1
>    1401         """
> -> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
>    1403         if self._nrows == 0 or self._ncols == 0:
>    1404             return A
> 
> TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
> sage:  MS = matrix_space.MatrixSpace(IntegerModRing(2), self._nrows, self._ncols)
> ```

why can't you use `mod`?

```
sage: M = Matrix(ZZ, [[0,1],[0,1]])
sage: M.mod(2)
[0 1]
[0 1]
```



---

archive/issue_comments_470975.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nBecause it is slow. I just copied the construction of the parent from `_mod_two`.\nI really don't know why, but `change_ring` is really slow (e.g. for `ZZ` -> `GF(2)`). It should be improved, but maybe not in this ticket.\n\n`_mod_two` uses the ring with two elements to obtain the parent. However, `get_matrix_class` gives you `modn` in this case. It gives you `mod2` if you pass the field with two elements.",
    "created_at": "2020-06-10T14:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470975",
    "user": "https://github.com/kliem"
}
```

<div id="comment:7" align="right">comment:7</div>

Because it is slow. I just copied the construction of the parent from `_mod_two`.
I really don't know why, but `change_ring` is really slow (e.g. for `ZZ` -> `GF(2)`). It should be improved, but maybe not in this ticket.

`_mod_two` uses the ring with two elements to obtain the parent. However, `get_matrix_class` gives you `modn` in this case. It gives you `mod2` if you pass the field with two elements.



---

archive/issue_comments_470976.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAnd `M.mod` is really not what I want. I just illustrated this bug.",
    "created_at": "2020-06-10T14:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470976",
    "user": "https://github.com/kliem"
}
```

<div id="comment:8" align="right">comment:8</div>

And `M.mod` is really not what I want. I just illustrated this bug.



---

archive/issue_comments_470977.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,23 @@\n We implement a method that obtains a new `GF(2)` matrix that contains 1 if and only if the corresponding entry is zero.\n \n Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.\n+\n+Along the way this ticket also fixes a bug:\n+\n+```\n+M = Matrix(ZZ, [[0,1],[0,1]])\n+sage: M._mod_int(2).transpose()\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-4-8587f9dc80b2> in <module>()\n+----> 1 M._mod_int(Integer(2)).transpose()\n+\n+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()\n+   1400             1\n+   1401         \"\"\"\n+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)\n+   1403         if self._nrows == 0 or self._ncols == 0:\n+   1404             return A\n+\n+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n+```\n``````\n",
    "created_at": "2020-06-10T14:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470977",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,23 @@
 We implement a method that obtains a new `GF(2)` matrix that contains 1 if and only if the corresponding entry is zero.
 
 Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.
+
+Along the way this ticket also fixes a bug:
+
+```
+M = Matrix(ZZ, [[0,1],[0,1]])
+sage: M._mod_int(2).transpose()
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-4-8587f9dc80b2> in <module>()
+----> 1 M._mod_int(Integer(2)).transpose()
+
+/srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_mod2_dense.pyx in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.transpose (build/cythonized/sage/matrix/matrix_mod2_dense.c:10873)()
+   1400             1
+   1401         """
+-> 1402         cdef Matrix_mod2_dense A = self.new_matrix(ncols = self._nrows,  nrows = self._ncols)
+   1403         if self._nrows == 0 or self._ncols == 0:
+   1404             return A
+
+TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
+```
``````




---

archive/issue_comments_470978.json:
```json
{
    "body": "Changed keywords from **incidence matrix, zero entries** to **incidence matrix, zero pattern**",
    "created_at": "2020-06-10T14:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470978",
    "user": "https://github.com/kliem"
}
```

Changed keywords from **incidence matrix, zero entries** to **incidence matrix, zero pattern**



---

archive/issue_comments_470979.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05eba1e190700fcaf2cd03fe043a8510706dd98f\"><code>05eba1e</code></a></td><td><code>fix bug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b708307f2aa4860299a9b7470e1344b88b59c12\"><code>7b70830</code></a></td><td><code>rename</code></td></tr></table>\n",
    "created_at": "2020-06-10T14:47:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470979",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05eba1e190700fcaf2cd03fe043a8510706dd98f"><code>05eba1e</code></a></td><td><code>fix bug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b708307f2aa4860299a9b7470e1344b88b59c12"><code>7b70830</code></a></td><td><code>rename</code></td></tr></table>




---

archive/issue_comments_470980.json:
```json
{
    "body": "Changed commit from **[`43e6dfb`](https://github.com/sagemath/sagetrac-mirror/commit/43e6dfbd64c1372d0829ff18df7a9c7aa9491738)** to **[`7b70830`](https://github.com/sagemath/sagetrac-mirror/commit/7b708307f2aa4860299a9b7470e1344b88b59c12)**",
    "created_at": "2020-06-10T14:47:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470980",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`43e6dfb`](https://github.com/sagemath/sagetrac-mirror/commit/43e6dfbd64c1372d0829ff18df7a9c7aa9491738)** to **[`7b70830`](https://github.com/sagemath/sagetrac-mirror/commit/7b708307f2aa4860299a9b7470e1344b88b59c12)**



---

archive/issue_comments_470981.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05eba1e190700fcaf2cd03fe043a8510706dd98f\"><code>05eba1e</code></a></td><td><code>fix bug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b708307f2aa4860299a9b7470e1344b88b59c12\"><code>7b70830</code></a></td><td><code>rename</code></td></tr></table>\n",
    "created_at": "2020-06-10T14:47:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470981",
    "user": "https://github.com/kliem"
}
```

<div id="comment:11"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05eba1e190700fcaf2cd03fe043a8510706dd98f"><code>05eba1e</code></a></td><td><code>fix bug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b708307f2aa4860299a9b7470e1344b88b59c12"><code>7b70830</code></a></td><td><code>rename</code></td></tr></table>




---

archive/issue_events_407571.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T14:47:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "title_is": "Implement `zero_pattern_matrix` for dense integer and rational matrices",
    "title_was": "Implement `_zero_matrix` for dense integer and rational matrices",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407571"
}
```



---

archive/issue_events_407572.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T20:05:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407572"
}
```



---

archive/issue_events_407573.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T20:05:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407573"
}
```



---

archive/issue_comments_470982.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI really want a new integer matrix.",
    "created_at": "2020-06-10T20:05:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470982",
    "user": "https://github.com/kliem"
}
```

<div id="comment:12" align="right">comment:12</div>

I really want a new integer matrix.



---

archive/issue_comments_470983.json:
```json
{
    "body": "Changed commit from **[`7b70830`](https://github.com/sagemath/sagetrac-mirror/commit/7b708307f2aa4860299a9b7470e1344b88b59c12)** to **[`62f1ff9`](https://github.com/sagemath/sagetrac-mirror/commit/62f1ff9bcbf0bc221d209ef92e893c375b76bb02)**",
    "created_at": "2020-06-10T22:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470983",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7b70830`](https://github.com/sagemath/sagetrac-mirror/commit/7b708307f2aa4860299a9b7470e1344b88b59c12)** to **[`62f1ff9`](https://github.com/sagemath/sagetrac-mirror/commit/62f1ff9bcbf0bc221d209ef92e893c375b76bb02)**



---

archive/issue_comments_470984.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62f1ff9bcbf0bc221d209ef92e893c375b76bb02\"><code>62f1ff9</code></a></td><td><code>use integer matrix for zero_pattern_matrix</code></td></tr></table>\n",
    "created_at": "2020-06-10T22:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470984",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62f1ff9bcbf0bc221d209ef92e893c375b76bb02"><code>62f1ff9</code></a></td><td><code>use integer matrix for zero_pattern_matrix</code></td></tr></table>




---

archive/issue_comments_470985.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-We implement a method that obtains a new `GF(2)` matrix that contains 1 if and only if the corresponding entry is zero.\n+We implement a method that obtains a new integer matrix that contains 1 if and only if the corresponding entry is zero. Otherwise 0.\n \n Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.\n \n``````\n",
    "created_at": "2020-06-10T22:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470985",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-We implement a method that obtains a new `GF(2)` matrix that contains 1 if and only if the corresponding entry is zero.
+We implement a method that obtains a new integer matrix that contains 1 if and only if the corresponding entry is zero. Otherwise 0.
 
 Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.
 
``````




---

archive/issue_events_407574.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T22:37:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407574"
}
```



---

archive/issue_events_407575.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-10T22:37:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407575"
}
```



---

archive/issue_comments_470986.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nHave you tried doing either `x = 1 - x` or `x = not x`? These should be fast as they avoid intermediate function calls and the first should work for any ring (maybe replace `1` with `one` where `one = self.base_ring().one()`).",
    "created_at": "2020-06-10T22:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470986",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

Have you tried doing either `x = 1 - x` or `x = not x`? These should be fast as they avoid intermediate function calls and the first should work for any ring (maybe replace `1` with `one` where `one = self.base_ring().one()`).



---

archive/issue_comments_470987.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@tscrim](#comment:15):\n> Have you tried doing either `x = 1 - x` or `x = not x`? These should be fast as they avoid intermediate function calls and the first should work for any ring (maybe replace `1` with `one` where `one = self.base_ring().one()`).\n\nWhen? As in `slack_matrix.apply_map`?\n\nThis is slow, whatever I do.\n\nIf `slack_matrix` is the `slack_matrix` of the `polytopes.associahedron(['A', 9])` obtained e.g. with\n\n```\nsage: def get_slack(P):\n....:     self = P\n....:     Vrep_matrix = matrix(self.base_ring(), self.Vrepresentation())\n....:     Hrep_matrix = matrix(self.base_ring(), self.Hrepresentation())\n....:     hom_helper = matrix(self.base_ring(), [1 if v.is_vertex() else 0 for v\n....:  in self.Vrepresentation()])\n....:     hom_Vrep = hom_helper.stack(Vrep_matrix.transpose())\n....:     slack_matrix = (Hrep_matrix * hom_Vrep).transpose()\n....:     return slack_matrix\n\nsage: slack_matrix = get_slack(polytopes.associahedron(['A', 9])\n```\n\nthan the solution of this ticket needs about 15 ms. In comparison to\n\n```\nsage: %time incidence_matrix = M.apply_map(lambda y: not y, R=M.base_ring())\nCPU times: user 281 ms, sys: 15.8 ms, total: 296 ms\nWall time: 296 ms\n```\n\n(which is 100 ms slower than the trivial `lambda y: y`).",
    "created_at": "2020-06-10T23:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470987",
    "user": "https://github.com/kliem"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@tscrim](#comment:15):
> Have you tried doing either `x = 1 - x` or `x = not x`? These should be fast as they avoid intermediate function calls and the first should work for any ring (maybe replace `1` with `one` where `one = self.base_ring().one()`).

When? As in `slack_matrix.apply_map`?

This is slow, whatever I do.

If `slack_matrix` is the `slack_matrix` of the `polytopes.associahedron(['A', 9])` obtained e.g. with

```
sage: def get_slack(P):
....:     self = P
....:     Vrep_matrix = matrix(self.base_ring(), self.Vrepresentation())
....:     Hrep_matrix = matrix(self.base_ring(), self.Hrepresentation())
....:     hom_helper = matrix(self.base_ring(), [1 if v.is_vertex() else 0 for v
....:  in self.Vrepresentation()])
....:     hom_Vrep = hom_helper.stack(Vrep_matrix.transpose())
....:     slack_matrix = (Hrep_matrix * hom_Vrep).transpose()
....:     return slack_matrix

sage: slack_matrix = get_slack(polytopes.associahedron(['A', 9])
```

than the solution of this ticket needs about 15 ms. In comparison to

```
sage: %time incidence_matrix = M.apply_map(lambda y: not y, R=M.base_ring())
CPU times: user 281 ms, sys: 15.8 ms, total: 296 ms
Wall time: 296 ms
```

(which is 100 ms slower than the trivial `lambda y: y`).



---

archive/issue_comments_470988.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFor the `x = 1 - x`, I was thinking the matrix was already a 01 matrix (and perhaps you were trying to do it in-place). This is also slower than simply doing this?\n\n```python\n        cdef Py_ssize_t i, j\n        for i from 0 <= i < self._nrows:\n            for j from 0 <= j < self._ncols:\n                if not self.get_unsafe(i, j):\n                    M.set_unsafe_si(i, j, 1)\n```\nThis is more generic, but perhaps it is slower for special cases (e.g., rationals) because it goes partially through Python.\n\nI have some questions:\n\nShould this be lifted up to a generic matrix method with a generic implementation of `get_is_zero_unsafe`?\n\nDo you want to be an integer matrix or a mod2 matrix? The latter seems like it would be more memory efficient and possibly faster.\n\nI am not sure it is safe to assume the initialized matrix is 0. Is this documented somewhere?",
    "created_at": "2020-06-11T01:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470988",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

For the `x = 1 - x`, I was thinking the matrix was already a 01 matrix (and perhaps you were trying to do it in-place). This is also slower than simply doing this?

```python
        cdef Py_ssize_t i, j
        for i from 0 <= i < self._nrows:
            for j from 0 <= j < self._ncols:
                if not self.get_unsafe(i, j):
                    M.set_unsafe_si(i, j, 1)
```
This is more generic, but perhaps it is slower for special cases (e.g., rationals) because it goes partially through Python.

I have some questions:

Should this be lifted up to a generic matrix method with a generic implementation of `get_is_zero_unsafe`?

Do you want to be an integer matrix or a mod2 matrix? The latter seems like it would be more memory efficient and possibly faster.

I am not sure it is safe to assume the initialized matrix is 0. Is this documented somewhere?



---

archive/issue_comments_470989.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nGood point. It is documented that the entries are not initialized.\n\nSo the following would be better:\n\n```\ncdef Matrix_integer_dense M = self._new(self._nrows, self._ncols)\ncdef Py_ssize_t i, j\n    for i from 0 <= i < self._nrows:\n        for j from 0 <= j < self._ncols:\n            if self.get_is_zero_unsafe(i, j):\n                M.set_unsafe_si(i, j, 1)\n            else:\n                M.set_unsafe_si(i, j, 0)\n```\n\nFor integers the difference between `if not self.get_unsafe(i, j)` and `if get_is_zero_unsafe(i, j)` is a factor of three. For rationals the difference is a factor of about 20.",
    "created_at": "2020-06-11T07:25:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470989",
    "user": "https://github.com/kliem"
}
```

<div id="comment:18" align="right">comment:18</div>

Good point. It is documented that the entries are not initialized.

So the following would be better:

```
cdef Matrix_integer_dense M = self._new(self._nrows, self._ncols)
cdef Py_ssize_t i, j
    for i from 0 <= i < self._nrows:
        for j from 0 <= j < self._ncols:
            if self.get_is_zero_unsafe(i, j):
                M.set_unsafe_si(i, j, 1)
            else:
                M.set_unsafe_si(i, j, 0)
```

For integers the difference between `if not self.get_unsafe(i, j)` and `if get_is_zero_unsafe(i, j)` is a factor of three. For rationals the difference is a factor of about 20.



---

archive/issue_comments_470990.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n`M.set_unsafe_si(i, j, self.get_is_zero_unsafe(i, j))` is a bit faster yet and almost the speed of not correctly initializing (26 ms vs 23 ms).",
    "created_at": "2020-06-11T07:28:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470990",
    "user": "https://github.com/kliem"
}
```

<div id="comment:19" align="right">comment:19</div>

`M.set_unsafe_si(i, j, self.get_is_zero_unsafe(i, j))` is a bit faster yet and almost the speed of not correctly initializing (26 ms vs 23 ms).



---

archive/issue_comments_470991.json:
```json
{
    "body": "Changed commit from **[`62f1ff9`](https://github.com/sagemath/sagetrac-mirror/commit/62f1ff9bcbf0bc221d209ef92e893c375b76bb02)** to **[`b583745`](https://github.com/sagemath/sagetrac-mirror/commit/b5837452ce2e3584c1ec2ca6f98ab4a2dd17de1c)**",
    "created_at": "2020-06-11T09:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470991",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`62f1ff9`](https://github.com/sagemath/sagetrac-mirror/commit/62f1ff9bcbf0bc221d209ef92e893c375b76bb02)** to **[`b583745`](https://github.com/sagemath/sagetrac-mirror/commit/b5837452ce2e3584c1ec2ca6f98ab4a2dd17de1c)**



---

archive/issue_comments_470992.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5837452ce2e3584c1ec2ca6f98ab4a2dd17de1c\"><code>b583745</code></a></td><td><code>make methods more generic</code></td></tr></table>\n",
    "created_at": "2020-06-11T09:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470992",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5837452ce2e3584c1ec2ca6f98ab4a2dd17de1c"><code>b583745</code></a></td><td><code>make methods more generic</code></td></tr></table>




---

archive/issue_comments_470993.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nthe",
    "created_at": "2020-06-11T09:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470993",
    "user": "https://github.com/kliem"
}
```

<div id="comment:21" align="right">comment:21</div>

the



---

archive/issue_comments_470994.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-We implement a method that obtains a new integer matrix that contains 1 if and only if the corresponding entry is zero. Otherwise 0.\n+We implement a method that obtains a new matrix with specified base ring that contains 1 if and only if the corresponding entry is zero. Otherwise 0.\n \n Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.\n \n@@ -21,3 +21,6 @@\n \n TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n ```\n+\n+To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.\n+In this ticket this is done for `matrix_integer_dense` and `matrix_rational_dense`.\n``````\n",
    "created_at": "2020-06-11T09:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470994",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-We implement a method that obtains a new integer matrix that contains 1 if and only if the corresponding entry is zero. Otherwise 0.
+We implement a method that obtains a new matrix with specified base ring that contains 1 if and only if the corresponding entry is zero. Otherwise 0.
 
 Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.
 
@@ -21,3 +21,6 @@
 
 TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
 ```
+
+To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.
+In this ticket this is done for `matrix_integer_dense` and `matrix_rational_dense`.
``````




---

archive/issue_events_407576.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-11T09:28:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "title_is": "Implement `zero_pattern_matrix`",
    "title_was": "Implement `zero_pattern_matrix` for dense integer and rational matrices",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407576"
}
```



---

archive/issue_comments_470995.json:
```json
{
    "body": "Changed commit from **[`b583745`](https://github.com/sagemath/sagetrac-mirror/commit/b5837452ce2e3584c1ec2ca6f98ab4a2dd17de1c)** to **[`535dc85`](https://github.com/sagemath/sagetrac-mirror/commit/535dc85e9d8a04baf28a646e11f80651b9c16e8a)**",
    "created_at": "2020-06-11T09:31:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470995",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b583745`](https://github.com/sagemath/sagetrac-mirror/commit/b5837452ce2e3584c1ec2ca6f98ab4a2dd17de1c)** to **[`535dc85`](https://github.com/sagemath/sagetrac-mirror/commit/535dc85e9d8a04baf28a646e11f80651b9c16e8a)**



---

archive/issue_comments_470996.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/535dc85e9d8a04baf28a646e11f80651b9c16e8a\"><code>535dc85</code></a></td><td><code>note for developers</code></td></tr></table>\n",
    "created_at": "2020-06-11T09:31:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470996",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/535dc85e9d8a04baf28a646e11f80651b9c16e8a"><code>535dc85</code></a></td><td><code>note for developers</code></td></tr></table>




---

archive/issue_comments_470997.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nIf you feel like `get_is_zero_unsafe` should be improved in other classes as well, please tell me. At the moment I would just leave it being optimized for those two classes that I need.",
    "created_at": "2020-06-11T09:41:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470997",
    "user": "https://github.com/kliem"
}
```

<div id="comment:23" align="right">comment:23</div>

If you feel like `get_is_zero_unsafe` should be improved in other classes as well, please tell me. At the moment I would just leave it being optimized for those two classes that I need.



---

archive/issue_comments_470998.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThank you. It is looking a lot better. One other place where it might make sense to do additional specialized `get_is_zero_unsafe` would be cyclo, gf2e, gfpn, and modn matrices, but these can wait if they turn out to be harder to do (I can also do some of them tomorrow). A few more little things:\n\nI don't understand this line:\n\n```\ncdef object one = M._coerce_element(1)\n```\nWhy not use `R.one()`? Also, similar to one of my previous questions, do we want this to be over the general ring? In principle, the matrix could be over a rng, and so the result might not be valid over `R` but the operation/output still makes sense. I think whatever output type we want (either as a `ZZ`-matrix or a `Zmod(2)`-matrix) is fine as long as we document it.\n\n```diff\n-        NOTE::\n+        .. NOTE::\n \n-            This method can be optimized by improving :meth:`get_is_zero_unsafe`` for derived matrix classes.\n+            This method can be optimized by improving :meth:`get_is_zero_unsafe` for derived matrix classes.\n```\n\n```diff\n-.. warning::\n+.. WARNING::\n```\n\nDo we want `get_is_zero_unsafe` to return a `bint` instead of an `int`? I don't hold a strong opinion, but I generally prefer the most restrictive/informative return type possible.",
    "created_at": "2020-06-11T14:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470998",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Thank you. It is looking a lot better. One other place where it might make sense to do additional specialized `get_is_zero_unsafe` would be cyclo, gf2e, gfpn, and modn matrices, but these can wait if they turn out to be harder to do (I can also do some of them tomorrow). A few more little things:

I don't understand this line:

```
cdef object one = M._coerce_element(1)
```
Why not use `R.one()`? Also, similar to one of my previous questions, do we want this to be over the general ring? In principle, the matrix could be over a rng, and so the result might not be valid over `R` but the operation/output still makes sense. I think whatever output type we want (either as a `ZZ`-matrix or a `Zmod(2)`-matrix) is fine as long as we document it.

```diff
-        NOTE::
+        .. NOTE::
 
-            This method can be optimized by improving :meth:`get_is_zero_unsafe`` for derived matrix classes.
+            This method can be optimized by improving :meth:`get_is_zero_unsafe` for derived matrix classes.
```

```diff
-.. warning::
+.. WARNING::
```

Do we want `get_is_zero_unsafe` to return a `bint` instead of an `int`? I don't hold a strong opinion, but I generally prefer the most restrictive/informative return type possible.



---

archive/issue_comments_470999.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI prefer `int` for the following reason: It can be useful, if we guarantee that the value is either `1` or `0`. I'm not using it like this anymore, but I wouldn't burn bridges. This way we really guarantee that the method returns `1` or `0`. If we return a `bint` this would leave the impression that the exact value doesn't matter.\n\n```\nsage: cython('''\n....: def foo(int a):\n....:     cdef bint b = a\n....:     return 2 - b\n....: ''')\n```\n\nThis is an example that `bint` really can take any integer value. If you run `foo(10)`, it will return `-8`.",
    "created_at": "2020-06-11T16:48:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-470999",
    "user": "https://github.com/kliem"
}
```

<div id="comment:25" align="right">comment:25</div>

I prefer `int` for the following reason: It can be useful, if we guarantee that the value is either `1` or `0`. I'm not using it like this anymore, but I wouldn't burn bridges. This way we really guarantee that the method returns `1` or `0`. If we return a `bint` this would leave the impression that the exact value doesn't matter.

```
sage: cython('''
....: def foo(int a):
....:     cdef bint b = a
....:     return 2 - b
....: ''')
```

This is an example that `bint` really can take any integer value. If you run `foo(10)`, it will return `-8`.



---

archive/issue_comments_471000.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@tscrim](#comment:24):\n> Thank you. It is looking a lot better. One other place where it might make sense to do additional specialized `get_is_zero_unsafe` would be cyclo, gf2e, gfpn, and modn matrices, but these can wait if they turn out to be harder to do (I can also do some of them tomorrow). A few more little things:\n> \n> I don't understand this line:\n> \n> ```\n> cdef object one = M._coerce_element(1)\n> ```\n> Why not use `R.one()`? Also, similar to one of my previous questions, do we want this to be over the general ring? In principle, the matrix could be over a rng, and so the result might not be valid over `R` but the operation/output still makes sense.\n\nI don't find an example of a matrix with base ring not a ring. It is mentioned in the constructor that such things exists, but I can't find it. Can you help me out?\n\nWe could have another optional argument, where you specify what you want to fill the matrix with, if not ones.\n\n> I think whatever output type we want (either as a `ZZ`-matrix or a `Zmod(2)`-matrix) is fine as long as we document it.\n> \n> ```diff\n> -        NOTE::\n> +        .. NOTE::\n>  \n> -            This method can be optimized by improving :meth:`get_is_zero_unsafe`` for derived matrix classes.\n> +            This method can be optimized by improving :meth:`get_is_zero_unsafe` for derived matrix classes.\n> ```\n> \n> ```diff\n> -.. warning::\n> +.. WARNING::\n> ```\n> \n> Do we want `get_is_zero_unsafe` to return a `bint` instead of an `int`? I don't hold a strong opinion, but I generally prefer the most restrictive/informative return type possible.",
    "created_at": "2020-06-11T18:17:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471000",
    "user": "https://github.com/kliem"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@tscrim](#comment:24):
> Thank you. It is looking a lot better. One other place where it might make sense to do additional specialized `get_is_zero_unsafe` would be cyclo, gf2e, gfpn, and modn matrices, but these can wait if they turn out to be harder to do (I can also do some of them tomorrow). A few more little things:
> 
> I don't understand this line:
> 
> ```
> cdef object one = M._coerce_element(1)
> ```
> Why not use `R.one()`? Also, similar to one of my previous questions, do we want this to be over the general ring? In principle, the matrix could be over a rng, and so the result might not be valid over `R` but the operation/output still makes sense.

I don't find an example of a matrix with base ring not a ring. It is mentioned in the constructor that such things exists, but I can't find it. Can you help me out?

We could have another optional argument, where you specify what you want to fill the matrix with, if not ones.

> I think whatever output type we want (either as a `ZZ`-matrix or a `Zmod(2)`-matrix) is fine as long as we document it.
> 
> ```diff
> -        NOTE::
> +        .. NOTE::
>  
> -            This method can be optimized by improving :meth:`get_is_zero_unsafe`` for derived matrix classes.
> +            This method can be optimized by improving :meth:`get_is_zero_unsafe` for derived matrix classes.
> ```
> 
> ```diff
> -.. warning::
> +.. WARNING::
> ```
> 
> Do we want `get_is_zero_unsafe` to return a `bint` instead of an `int`? I don't hold a strong opinion, but I generally prefer the most restrictive/informative return type possible.



---

archive/issue_comments_471001.json:
```json
{
    "body": "Changed commit from **[`535dc85`](https://github.com/sagemath/sagetrac-mirror/commit/535dc85e9d8a04baf28a646e11f80651b9c16e8a)** to **[`00aed02`](https://github.com/sagemath/sagetrac-mirror/commit/00aed0243abfd6a37b3ec9cc7c7e8c775abfab9d)**",
    "created_at": "2020-06-11T20:08:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471001",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`535dc85`](https://github.com/sagemath/sagetrac-mirror/commit/535dc85e9d8a04baf28a646e11f80651b9c16e8a)** to **[`00aed02`](https://github.com/sagemath/sagetrac-mirror/commit/00aed0243abfd6a37b3ec9cc7c7e8c775abfab9d)**



---

archive/issue_comments_471002.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0428d8d1dc567a022c478d238778afd669bfe49\"><code>d0428d8</code></a></td><td><code>small improvements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00aed0243abfd6a37b3ec9cc7c7e8c775abfab9d\"><code>00aed02</code></a></td><td><code>warning caps lock</code></td></tr></table>\n",
    "created_at": "2020-06-11T20:08:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471002",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0428d8d1dc567a022c478d238778afd669bfe49"><code>d0428d8</code></a></td><td><code>small improvements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00aed0243abfd6a37b3ec9cc7c7e8c775abfab9d"><code>00aed02</code></a></td><td><code>warning caps lock</code></td></tr></table>




---

archive/issue_events_407577.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-11T20:09:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407577"
}
```



---

archive/issue_events_407578.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-11T20:09:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407578"
}
```



---

archive/issue_comments_471003.json:
```json
{
    "body": "Work Issues: **documentation, more classes, more general baserings**",
    "created_at": "2020-06-11T20:09:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471003",
    "user": "https://github.com/kliem"
}
```

Work Issues: **documentation, more classes, more general baserings**



---

archive/issue_comments_471004.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb49574339d302455e9e919d04fa6546f61c92ec\"><code>fb49574</code></a></td><td><code>typo</code></td></tr></table>\n",
    "created_at": "2020-06-11T20:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471004",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb49574339d302455e9e919d04fa6546f61c92ec"><code>fb49574</code></a></td><td><code>typo</code></td></tr></table>




---

archive/issue_comments_471005.json:
```json
{
    "body": "Changed commit from **[`00aed02`](https://github.com/sagemath/sagetrac-mirror/commit/00aed0243abfd6a37b3ec9cc7c7e8c775abfab9d)** to **[`fb49574`](https://github.com/sagemath/sagetrac-mirror/commit/fb49574339d302455e9e919d04fa6546f61c92ec)**",
    "created_at": "2020-06-11T20:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471005",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`00aed02`](https://github.com/sagemath/sagetrac-mirror/commit/00aed0243abfd6a37b3ec9cc7c7e8c775abfab9d)** to **[`fb49574`](https://github.com/sagemath/sagetrac-mirror/commit/fb49574339d302455e9e919d04fa6546f61c92ec)**



---

archive/issue_comments_471006.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nSage explicitly only allows rings to be passed to matrices, despite what the documentation currently says:\n\n```\nsage: S = Semigroups().example()\nsage: A = S.algebra(QQ)\nsage: M = matrix(A, [[A.zero()]])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-5bed397dad10> in <module>()\n----> 1 M = matrix(A, [[A.zero()]])\n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/constructor.pyx in sage.matrix.constructor.matrix (build/cythonized/sage/matrix/constructor.c:2479)()\n    633     \"\"\"\n    634     immutable = kwds.pop('immutable', False)\n--> 635     M = MatrixArgs(*args, **kwds).matrix()\n    636     if immutable:\n    637         M.set_immutable()\n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/args.pyx in sage.matrix.args.MatrixArgs.matrix (build/cythonized/sage/matrix/args.c:7668)()\n    650             True\n    651         \"\"\"\n--> 652         self.finalize()\n    653 \n    654         cdef Matrix M\n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/args.pyx in sage.matrix.args.MatrixArgs.finalize (build/cythonized/sage/matrix/args.c:10264)()\n    932 \n    933         if self.space is None:\n--> 934             self.space = MatrixSpace(self.base, self.nrows, self.ncols,\n    935                     sparse=self.sparse, **self.kwds)\n    936 \n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1741)()\n    320         \"\"\"\n    321         if cls.classcall is not None:\n--> 322             return cls.classcall(cls, *args, **kwds)\n    323         else:\n    324             # Fast version of type.__call__(cls, *args, **kwds)\n\n/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py in __classcall__(cls, base_ring, nrows, ncols, sparse, implementation, **kwds)\n    489         \"\"\"\n    490         if base_ring not in _Rings:\n--> 491             raise TypeError(\"base_ring (=%s) must be a ring\"%base_ring)\n    492         nrows = int(nrows)\n    493         if ncols is None:\n\nTypeError: base_ring (=Algebra of An example of a semigroup: the left zero semigroup over Rational Field) must be a ring\n```\nSo that might not something we need to worry about right now. Irregardless, I am still not convinced that we should be returning a matrix over the base ring and not either **Z** or **Z**<sub>2</sub>.\n\nI see your argument for not using `bint`; it is actually a little disheartening to see that code block; but I see that as garbage-in, garbage-out. My counter point would be the `is_zero_unsage` is suppose to be recording a true/false value, which is what the `bint` is suppose to be for (equivalent to a `bool` in C). Plus it is standard that `1` is `True`. So even if it is not enforacble, it still carries contextual significance.",
    "created_at": "2020-06-12T00:44:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471006",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

Sage explicitly only allows rings to be passed to matrices, despite what the documentation currently says:

```
sage: S = Semigroups().example()
sage: A = S.algebra(QQ)
sage: M = matrix(A, [[A.zero()]])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-5bed397dad10> in <module>()
----> 1 M = matrix(A, [[A.zero()]])

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/constructor.pyx in sage.matrix.constructor.matrix (build/cythonized/sage/matrix/constructor.c:2479)()
    633     """
    634     immutable = kwds.pop('immutable', False)
--> 635     M = MatrixArgs(*args, **kwds).matrix()
    636     if immutable:
    637         M.set_immutable()

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/args.pyx in sage.matrix.args.MatrixArgs.matrix (build/cythonized/sage/matrix/args.c:7668)()
    650             True
    651         """
--> 652         self.finalize()
    653 
    654         cdef Matrix M

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/args.pyx in sage.matrix.args.MatrixArgs.finalize (build/cythonized/sage/matrix/args.c:10264)()
    932 
    933         if self.space is None:
--> 934             self.space = MatrixSpace(self.base, self.nrows, self.ncols,
    935                     sparse=self.sparse, **self.kwds)
    936 

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/misc/classcall_metaclass.pyx in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1741)()
    320         """
    321         if cls.classcall is not None:
--> 322             return cls.classcall(cls, *args, **kwds)
    323         else:
    324             # Fast version of type.__call__(cls, *args, **kwds)

/home/uqtscrim/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py in __classcall__(cls, base_ring, nrows, ncols, sparse, implementation, **kwds)
    489         """
    490         if base_ring not in _Rings:
--> 491             raise TypeError("base_ring (=%s) must be a ring"%base_ring)
    492         nrows = int(nrows)
    493         if ncols is None:

TypeError: base_ring (=Algebra of An example of a semigroup: the left zero semigroup over Rational Field) must be a ring
```
So that might not something we need to worry about right now. Irregardless, I am still not convinced that we should be returning a matrix over the base ring and not either **Z** or **Z**<sub>2</sub>.

I see your argument for not using `bint`; it is actually a little disheartening to see that code block; but I see that as garbage-in, garbage-out. My counter point would be the `is_zero_unsage` is suppose to be recording a true/false value, which is what the `bint` is suppose to be for (equivalent to a `bool` in C). Plus it is standard that `1` is `True`. So even if it is not enforacble, it still carries contextual significance.



---

archive/issue_comments_471007.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAs for other rings I think I have questions with all of them:\n\n- `gfpn` is `get_unsafe_int` guaranteed to be `0` if the entry is zero, or might it be `0` mod cardinality of field, if not, where do I find the cardinality?\n- similar for `gf2e` and `modn`\n- `cyclo` (I just realized this is probably easy)\n\nEDIT:\n\nFor `gf2e` this is indirectly confirmed in `rings/finite_rings/element_givaro.pyx` in `fetch_int`.",
    "created_at": "2020-06-12T06:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471007",
    "user": "https://github.com/kliem"
}
```

<div id="comment:31" align="right">comment:31</div>

As for other rings I think I have questions with all of them:

- `gfpn` is `get_unsafe_int` guaranteed to be `0` if the entry is zero, or might it be `0` mod cardinality of field, if not, where do I find the cardinality?
- similar for `gf2e` and `modn`
- `cyclo` (I just realized this is probably easy)

EDIT:

For `gf2e` this is indirectly confirmed in `rings/finite_rings/element_givaro.pyx` in `fetch_int`.



---

archive/issue_comments_471008.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc66193c10e8404a4b8faf2b690efe314868aae6\"><code>bc66193</code></a></td><td><code>fixed mistake</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8482c5ae0107d1715c56c4bc29fbbc907b1ef29c\"><code>8482c5a</code></a></td><td><code>documentation</code></td></tr></table>\n",
    "created_at": "2020-06-12T08:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471008",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc66193c10e8404a4b8faf2b690efe314868aae6"><code>bc66193</code></a></td><td><code>fixed mistake</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8482c5ae0107d1715c56c4bc29fbbc907b1ef29c"><code>8482c5a</code></a></td><td><code>documentation</code></td></tr></table>




---

archive/issue_comments_471009.json:
```json
{
    "body": "Changed commit from **[`fb49574`](https://github.com/sagemath/sagetrac-mirror/commit/fb49574339d302455e9e919d04fa6546f61c92ec)** to **[`8482c5a`](https://github.com/sagemath/sagetrac-mirror/commit/8482c5ae0107d1715c56c4bc29fbbc907b1ef29c)**",
    "created_at": "2020-06-12T08:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471009",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fb49574`](https://github.com/sagemath/sagetrac-mirror/commit/fb49574339d302455e9e919d04fa6546f61c92ec)** to **[`8482c5a`](https://github.com/sagemath/sagetrac-mirror/commit/8482c5ae0107d1715c56c4bc29fbbc907b1ef29c)**



---

archive/issue_comments_471010.json:
```json
{
    "body": "Changed work issues from **documentation, more classes, more general baserings** to **more classes**",
    "created_at": "2020-06-12T08:57:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471010",
    "user": "https://github.com/kliem"
}
```

Changed work issues from **documentation, more classes, more general baserings** to **more classes**



---

archive/issue_comments_471011.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13ff08bbd30afe253560d01e25bc88864ab6c5bb\"><code>13ff08b</code></a></td><td><code>Adding faster get_is_zero_unsafe for modn matrices.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20bd4e021e3479f9d3869561c6771b3ed049a45e\"><code>20bd4e0</code></a></td><td><code>Adding get_is_zero_unsafe() and `__bool__` to gf2e matrices.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbe266ac99dc9e94fe90677c0c1bc43562f63e68\"><code>cbe266a</code></a></td><td><code>Adding get_is_zero_unsafe to cyclotomic matrices.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e50681613b9ed1a53077a1fb8f1bc06ee31d90a3\"><code>e506816</code></a></td><td><code>Using get_is_unsafe_zero() in more places.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/169fa6c85de38be107d75481372f71cbf8b11c98\"><code>169fa6c</code></a></td><td><code>Adding get_is_zero_unsafe() to gfpn matrices.</code></td></tr></table>\n",
    "created_at": "2020-06-13T01:33:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471011",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13ff08bbd30afe253560d01e25bc88864ab6c5bb"><code>13ff08b</code></a></td><td><code>Adding faster get_is_zero_unsafe for modn matrices.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20bd4e021e3479f9d3869561c6771b3ed049a45e"><code>20bd4e0</code></a></td><td><code>Adding get_is_zero_unsafe() and `__bool__` to gf2e matrices.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbe266ac99dc9e94fe90677c0c1bc43562f63e68"><code>cbe266a</code></a></td><td><code>Adding get_is_zero_unsafe to cyclotomic matrices.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e50681613b9ed1a53077a1fb8f1bc06ee31d90a3"><code>e506816</code></a></td><td><code>Using get_is_unsafe_zero() in more places.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/169fa6c85de38be107d75481372f71cbf8b11c98"><code>169fa6c</code></a></td><td><code>Adding get_is_zero_unsafe() to gfpn matrices.</code></td></tr></table>




---

archive/issue_comments_471012.json:
```json
{
    "body": "Changed commit from **[`8482c5a`](https://github.com/sagemath/sagetrac-mirror/commit/8482c5ae0107d1715c56c4bc29fbbc907b1ef29c)** to **[`169fa6c`](https://github.com/sagemath/sagetrac-mirror/commit/169fa6c85de38be107d75481372f71cbf8b11c98)**",
    "created_at": "2020-06-13T01:33:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471012",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8482c5a`](https://github.com/sagemath/sagetrac-mirror/commit/8482c5ae0107d1715c56c4bc29fbbc907b1ef29c)** to **[`169fa6c`](https://github.com/sagemath/sagetrac-mirror/commit/169fa6c85de38be107d75481372f71cbf8b11c98)**



---

archive/issue_comments_471013.json:
```json
{
    "body": "Changed author from **Jonathan Kliem** to **Jonathan Kliem, Travis Scrimshaw**",
    "created_at": "2020-06-13T01:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471013",
    "user": "https://github.com/tscrim"
}
```

Changed author from **Jonathan Kliem** to **Jonathan Kliem, Travis Scrimshaw**



---

archive/issue_comments_471014.json:
```json
{
    "body": "Changed work issues from **more classes** to none",
    "created_at": "2020-06-13T01:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471014",
    "user": "https://github.com/tscrim"
}
```

Changed work issues from **more classes** to none



---

archive/issue_comments_471015.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nOkay, this is an implementation for all of the specialized dense matrices I mentioned before.\n\nI really don't like how in the gf2e it redirects through python for such a key feature with `get_unsafe`. This needs to be removed and is now #29853. Likely the way to do it will be based on what is done for gfpn.\n\nSome additions of better `__bool__` methods:\n\n```\nsage: K.<z> = CyclotomicField(3)\nsage: A = matrix(K, 4, 3, [0, -z, -2, -2*z + 2, 2*z, z, z, 1-z, 2+3*z, z, 1+z, 0])\nsage: %timeit bool(A)\n10000000 loops, best of 5: 86.2 ns per loop\nsage: %timeit bool(Z)\n10000000 loops, best of 5: 152 ns per loop\n```\nversus before:\n\n```\nsage: %timeit bool(A)\nThe slowest run took 70.37 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 5: 8.49 \u00b5s per loop\nsage: Z = matrix(K, 4, 3, 0)\nsage: %timeit bool(Z)\nThe slowest run took 7.43 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 5: 50 \u00b5s per loop\n```\n\nI also made changes in other places where `get_is_unsafe_zero()` could be used. Like the above and in your use case, this likely has (potentially significantly) sped things up.",
    "created_at": "2020-06-13T01:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471015",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Okay, this is an implementation for all of the specialized dense matrices I mentioned before.

I really don't like how in the gf2e it redirects through python for such a key feature with `get_unsafe`. This needs to be removed and is now #29853. Likely the way to do it will be based on what is done for gfpn.

Some additions of better `__bool__` methods:

```
sage: K.<z> = CyclotomicField(3)
sage: A = matrix(K, 4, 3, [0, -z, -2, -2*z + 2, 2*z, z, z, 1-z, 2+3*z, z, 1+z, 0])
sage: %timeit bool(A)
10000000 loops, best of 5: 86.2 ns per loop
sage: %timeit bool(Z)
10000000 loops, best of 5: 152 ns per loop
```
versus before:

```
sage: %timeit bool(A)
The slowest run took 70.37 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 5: 8.49 s per loop
sage: Z = matrix(K, 4, 3, 0)
sage: %timeit bool(Z)
The slowest run took 7.43 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 5: 50 s per loop
```

I also made changes in other places where `get_is_unsafe_zero()` could be used. Like the above and in your use case, this likely has (potentially significantly) sped things up.



---

archive/issue_events_407579.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-06-13T01:35:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407579"
}
```



---

archive/issue_events_407580.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-06-13T01:35:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407580"
}
```



---

archive/issue_comments_471016.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2020-06-13T01:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471016",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_471017.json:
```json
{
    "body": "Changed commit from **[`169fa6c`](https://github.com/sagemath/sagetrac-mirror/commit/169fa6c85de38be107d75481372f71cbf8b11c98)** to **[`9462376`](https://github.com/sagemath/sagetrac-mirror/commit/946237697b17bf1a2024326f854b1ef6e27dec04)**",
    "created_at": "2020-06-13T01:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471017",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`169fa6c`](https://github.com/sagemath/sagetrac-mirror/commit/169fa6c85de38be107d75481372f71cbf8b11c98)** to **[`9462376`](https://github.com/sagemath/sagetrac-mirror/commit/946237697b17bf1a2024326f854b1ef6e27dec04)**



---

archive/issue_comments_471018.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4257c79617bffed86a2c0b499111286c86b6d8de\"><code>4257c79</code></a></td><td><code>Adding get_is_zero_unsafe() for generic sparse matrices.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78ca75376857571ed5b89d316edcfd94e6747d7c\"><code>78ca753</code></a></td><td><code>Adding a custom get_is_zero_unsafe for sparse integer matrices.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/946237697b17bf1a2024326f854b1ef6e27dec04\"><code>9462376</code></a></td><td><code>Adding optimized get_is_zero_unsafe() to rational sparse matrices.</code></td></tr></table>\n",
    "created_at": "2020-06-13T01:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471018",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4257c79617bffed86a2c0b499111286c86b6d8de"><code>4257c79</code></a></td><td><code>Adding get_is_zero_unsafe() for generic sparse matrices.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78ca75376857571ed5b89d316edcfd94e6747d7c"><code>78ca753</code></a></td><td><code>Adding a custom get_is_zero_unsafe for sparse integer matrices.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/946237697b17bf1a2024326f854b1ef6e27dec04"><code>9462376</code></a></td><td><code>Adding optimized get_is_zero_unsafe() to rational sparse matrices.</code></td></tr></table>




---

archive/issue_comments_471019.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94febdeb4ae5782a97793d9446fe8951f0c78bf9\"><code>94febde</code></a></td><td><code>Custom get_is_zero_unsafe() for modn sparse matrices.</code></td></tr></table>\n",
    "created_at": "2020-06-13T02:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471019",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94febdeb4ae5782a97793d9446fe8951f0c78bf9"><code>94febde</code></a></td><td><code>Custom get_is_zero_unsafe() for modn sparse matrices.</code></td></tr></table>




---

archive/issue_comments_471020.json:
```json
{
    "body": "Changed commit from **[`9462376`](https://github.com/sagemath/sagetrac-mirror/commit/946237697b17bf1a2024326f854b1ef6e27dec04)** to **[`94febde`](https://github.com/sagemath/sagetrac-mirror/commit/94febdeb4ae5782a97793d9446fe8951f0c78bf9)**",
    "created_at": "2020-06-13T02:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471020",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9462376`](https://github.com/sagemath/sagetrac-mirror/commit/946237697b17bf1a2024326f854b1ef6e27dec04)** to **[`94febde`](https://github.com/sagemath/sagetrac-mirror/commit/94febdeb4ae5782a97793d9446fe8951f0c78bf9)**



---

archive/issue_comments_471021.json:
```json
{
    "body": "Changed commit from **[`94febde`](https://github.com/sagemath/sagetrac-mirror/commit/94febdeb4ae5782a97793d9446fe8951f0c78bf9)** to **[`bf0352f`](https://github.com/sagemath/sagetrac-mirror/commit/bf0352fdad5db674c3c2aa36f188f996600f7ee3)**",
    "created_at": "2020-06-13T02:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471021",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`94febde`](https://github.com/sagemath/sagetrac-mirror/commit/94febdeb4ae5782a97793d9446fe8951f0c78bf9)** to **[`bf0352f`](https://github.com/sagemath/sagetrac-mirror/commit/bf0352fdad5db674c3c2aa36f188f996600f7ee3)**



---

archive/issue_comments_471022.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf0352fdad5db674c3c2aa36f188f996600f7ee3\"><code>bf0352f</code></a></td><td><code>See if we can check trivial zeros first for symbolic matrices.</code></td></tr></table>\n",
    "created_at": "2020-06-13T02:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471022",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf0352fdad5db674c3c2aa36f188f996600f7ee3"><code>bf0352f</code></a></td><td><code>See if we can check trivial zeros first for symbolic matrices.</code></td></tr></table>




---

archive/issue_comments_471023.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,4 +23,4 @@\n ```\n \n To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.\n-In this ticket this is done for `matrix_integer_dense` and `matrix_rational_dense`.\n+In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.\n``````\n",
    "created_at": "2020-06-13T02:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471023",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,4 +23,4 @@
 ```
 
 To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.
-In this ticket this is done for `matrix_integer_dense` and `matrix_rational_dense`.
+In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.
``````




---

archive/issue_comments_471024.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nOkay, that takes care of the sparse matrices and symbolic matrices.\n\nSlightly surprisingly, the gap matrices don't benefit from not going through Sage (well, at least for integer matrices).\n\nI am done now.",
    "created_at": "2020-06-13T02:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471024",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:39" align="right">comment:39</div>

Okay, that takes care of the sparse matrices and symbolic matrices.

Slightly surprisingly, the gap matrices don't benefit from not going through Sage (well, at least for integer matrices).

I am done now.



---

archive/issue_comments_471025.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a08abe750c622e191a5849979bde1a041a31d52\"><code>2a08abe</code></a></td><td><code>small mistakes</code></td></tr></table>\n",
    "created_at": "2020-06-13T09:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471025",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a08abe750c622e191a5849979bde1a041a31d52"><code>2a08abe</code></a></td><td><code>small mistakes</code></td></tr></table>




---

archive/issue_comments_471026.json:
```json
{
    "body": "Changed commit from **[`bf0352f`](https://github.com/sagemath/sagetrac-mirror/commit/bf0352fdad5db674c3c2aa36f188f996600f7ee3)** to **[`2a08abe`](https://github.com/sagemath/sagetrac-mirror/commit/2a08abe750c622e191a5849979bde1a041a31d52)**",
    "created_at": "2020-06-13T09:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471026",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bf0352f`](https://github.com/sagemath/sagetrac-mirror/commit/bf0352fdad5db674c3c2aa36f188f996600f7ee3)** to **[`2a08abe`](https://github.com/sagemath/sagetrac-mirror/commit/2a08abe750c622e191a5849979bde1a041a31d52)**



---

archive/issue_comments_471027.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nIMO this is good now. The doctests should also pass.",
    "created_at": "2020-06-13T09:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471027",
    "user": "https://github.com/kliem"
}
```

<div id="comment:41" align="right">comment:41</div>

IMO this is good now. The doctests should also pass.



---

archive/issue_comments_471028.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Jonathan Kliem**",
    "created_at": "2020-06-13T09:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471028",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Jonathan Kliem**



---

archive/issue_comments_471029.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/333c4baf305e19b3a12e99a48e3140459521f339\"><code>333c4ba</code></a></td><td><code>wrong doctest</code></td></tr></table>\n",
    "created_at": "2020-06-13T19:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471029",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/333c4baf305e19b3a12e99a48e3140459521f339"><code>333c4ba</code></a></td><td><code>wrong doctest</code></td></tr></table>




---

archive/issue_comments_471030.json:
```json
{
    "body": "Changed commit from **[`2a08abe`](https://github.com/sagemath/sagetrac-mirror/commit/2a08abe750c622e191a5849979bde1a041a31d52)** to **[`333c4ba`](https://github.com/sagemath/sagetrac-mirror/commit/333c4baf305e19b3a12e99a48e3140459521f339)**",
    "created_at": "2020-06-13T19:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471030",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2a08abe`](https://github.com/sagemath/sagetrac-mirror/commit/2a08abe750c622e191a5849979bde1a041a31d52)** to **[`333c4ba`](https://github.com/sagemath/sagetrac-mirror/commit/333c4baf305e19b3a12e99a48e3140459521f339)**



---

archive/issue_comments_471031.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThank you. Two more little things:\n\n```diff\n         INPUT:\n \n-        - `ring` -- (optional); base ring of the output; default is `ZZ`\n+        - `ring` -- (optional); base ring of the output; default is ``ZZ``\n```\nand we should add a test for the empty row/column and empty matrix for `Matrix_gf2e_dense.__bool__` (as that was a good catch). I can do this tomorrow.",
    "created_at": "2020-06-13T22:39:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471031",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:43" align="right">comment:43</div>

Thank you. Two more little things:

```diff
         INPUT:
 
-        - `ring` -- (optional); base ring of the output; default is `ZZ`
+        - `ring` -- (optional); base ring of the output; default is ``ZZ``
```
and we should add a test for the empty row/column and empty matrix for `Matrix_gf2e_dense.__bool__` (as that was a good catch). I can do this tomorrow.



---

archive/issue_comments_471032.json:
```json
{
    "body": "Changed commit from **[`333c4ba`](https://github.com/sagemath/sagetrac-mirror/commit/333c4baf305e19b3a12e99a48e3140459521f339)** to **[`82c6b4a`](https://github.com/sagemath/sagetrac-mirror/commit/82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89)**",
    "created_at": "2020-06-13T23:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471032",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`333c4ba`](https://github.com/sagemath/sagetrac-mirror/commit/333c4baf305e19b3a12e99a48e3140459521f339)** to **[`82c6b4a`](https://github.com/sagemath/sagetrac-mirror/commit/82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89)**



---

archive/issue_comments_471033.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89\"><code>82c6b4a</code></a></td><td><code>docstring</code></td></tr></table>\n",
    "created_at": "2020-06-13T23:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471033",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89"><code>82c6b4a</code></a></td><td><code>docstring</code></td></tr></table>




---

archive/issue_comments_471034.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@tscrim](#comment:43):\n> and we should add a test for the empty row/column and empty matrix for `Matrix_gf2e_dense.__bool__` (as that was a good catch).\n\nWell the bot was segfaulting (and me to, when running the test).",
    "created_at": "2020-06-13T23:05:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471034",
    "user": "https://github.com/kliem"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@tscrim](#comment:43):
> and we should add a test for the empty row/column and empty matrix for `Matrix_gf2e_dense.__bool__` (as that was a good catch).

Well the bot was segfaulting (and me to, when running the test).



---

archive/issue_comments_471035.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nOkay, then positive review. Thank you.",
    "created_at": "2020-06-13T23:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471035",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

Okay, then positive review. Thank you.



---

archive/issue_events_407581.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-06-13T23:46:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407581"
}
```



---

archive/issue_events_407582.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-06-13T23:46:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407582"
}
```



---

archive/issue_comments_471036.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI like that you made a polyhedron only ticket, into a more general improvement for other parts as well.",
    "created_at": "2020-06-14T08:34:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471036",
    "user": "https://github.com/kliem"
}
```

<div id="comment:47" align="right">comment:47</div>

I like that you made a polyhedron only ticket, into a more general improvement for other parts as well.



---

archive/issue_comments_471037.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n-We implement a method that obtains a new matrix with specified base ring that contains 1 if and only if the corresponding entry is zero. Otherwise 0.\n+We implement a method on matrices that gives a new matrix with specified base ring\n+and entries 1 where and only where the initial matrix had zero entries, and 0 elsewhere.\n \n-Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.\n+Motivation: This method is useful to obtain the incidence matrix of a polyhedron from the slack matrix in #29837.\n \n Along the way this ticket also fixes a bug:\n \n@@ -22,5 +23,5 @@\n TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense\n ```\n \n-To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.\n+To optimize this method, a matrix class can use the optimized `get_is_zero_unsafe`.\n In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.\n``````\n",
    "created_at": "2020-06-18T02:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471037",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
-We implement a method that obtains a new matrix with specified base ring that contains 1 if and only if the corresponding entry is zero. Otherwise 0.
+We implement a method on matrices that gives a new matrix with specified base ring
+and entries 1 where and only where the initial matrix had zero entries, and 0 elsewhere.
 
-Motivation: This method is useful to obtain the incidence matrix of of a polyhedron from the slack matrix in #29837.
+Motivation: This method is useful to obtain the incidence matrix of a polyhedron from the slack matrix in #29837.
 
 Along the way this ticket also fixes a bug:
 
@@ -22,5 +23,5 @@
 TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod2_dense.Matrix_mod2_dense
 ```
 
-To optimize this method, a matrix class can optimized `get_is_zero_unsafe`.
+To optimize this method, a matrix class can use the optimized `get_is_zero_unsafe`.
 In this ticket this is done for most matrix classes. We also use this new optimized zero check in places where it makes sense.
``````




---

archive/issue_comments_471038.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\n(Slightly amending ticket description, please check that works for you.).",
    "created_at": "2020-06-18T02:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471038",
    "user": "https://github.com/slel"
}
```

<div id="comment:48" align="right">comment:48</div>

(Slightly amending ticket description, please check that works for you.).



---

archive/issue_events_407583.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-06-27T09:25:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407583"
}
```



---

archive/issue_events_407584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4f305e27a548d4d48bac294a23ce9da76b20f0c9",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-06-27T09:25:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29839#event-407584"
}
```



---

archive/issue_comments_471039.json:
```json
{
    "body": "Changed branch from **[public/29839](https://github.com/sagemath/sagetrac-mirror/tree/public/29839)** to **[`82c6b4a`](https://github.com/sagemath/sagetrac-mirror/commit/82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89)**",
    "created_at": "2020-06-27T09:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29839#issuecomment-471039",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/29839](https://github.com/sagemath/sagetrac-mirror/tree/public/29839)** to **[`82c6b4a`](https://github.com/sagemath/sagetrac-mirror/commit/82c6b4ad9afe2ae7be5e5c2fb2e47147c2b2bb89)**
