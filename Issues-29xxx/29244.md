# Issue 29244: Apply a function to all components of a tensor field

archive/issues_029007.json:
```json
{
    "body": "This ticket adds the method `apply_map` to the class `TensorField`, which applies a function to the coordinate expressions of all components of a tensor field in a given vector frame.\nThis allows operations like factorization, expansion, simplification or substitution to be performed on the components.\n\nSuch a method has been requested in e.g. https://ask.sagemath.org/question/42107/basic-work-on-tensor-components/ and was discussed again during [Sage Days 107](https://wiki.sagemath.org/days107).\n\nCC:  @tscrim\n\nKeywords: manifolds, tensor, components, sd107\n\nBranch/Commit: 5cf7fc53f523cb3a1a7c8c75df8b2f0774203df1\n\nReviewer: Vincent Delecroix, Travis Scrimshaw\n\nAuthor: Eric Gourgoulhon\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29244\n\n",
    "closed_at": "2020-03-11T23:46:20Z",
    "created_at": "2020-02-24T11:06:31Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Apply a function to all components of a tensor field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29244",
    "user": "https://github.com/egourgoulhon"
}
```
This ticket adds the method `apply_map` to the class `TensorField`, which applies a function to the coordinate expressions of all components of a tensor field in a given vector frame.
This allows operations like factorization, expansion, simplification or substitution to be performed on the components.

Such a method has been requested in e.g. https://ask.sagemath.org/question/42107/basic-work-on-tensor-components/ and was discussed again during [Sage Days 107](https://wiki.sagemath.org/days107).

CC:  @tscrim

Keywords: manifolds, tensor, components, sd107

Branch/Commit: 5cf7fc53f523cb3a1a7c8c75df8b2f0774203df1

Reviewer: Vincent Delecroix, Travis Scrimshaw

Author: Eric Gourgoulhon

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29244





---

archive/issue_comments_437262.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2020-02-24T11:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437262",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_437263.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-24T11:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437263",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437264.json:
```json
{
    "body": "<a id='comment:3'></a>For vectors and matrices, such method already exists and is called `apply_map`\n\n```\nsage: v = vector(range(4))\nsage: v.apply_map(lambda x: x^2)\n(0, 1, 4, 9)\nsage: m = matrix(3,range(9))\nsage: m.apply_map(lambda x: x^2)\n[ 0  1  4]\n[ 9 16 25]\n[36 49 64]\n```\nIs the difference in terminology intended?",
    "created_at": "2020-02-24T12:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437264",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>For vectors and matrices, such method already exists and is called `apply_map`

```
sage: v = vector(range(4))
sage: v.apply_map(lambda x: x^2)
(0, 1, 4, 9)
sage: m = matrix(3,range(9))
sage: m.apply_map(lambda x: x^2)
[ 0  1  4]
[ 9 16 25]
[36 49 64]
```
Is the difference in terminology intended?



---

archive/issue_comments_437265.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-02-24T12:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437265",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_437266.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 vdelecroix]:\n> For vectors and matrices, such method already exists and is called `apply_map`\n\n>\n> Is the difference in terminology intended?\n\n\nNo, not at all. Thanks for pointing out this. \nIn the context of tensor fields, `apply_map` may sound a little bit too vague (for instance, it may evoke a pull back operation associated with a map between manifolds). Would  `apply_map_components` be more appropriate?",
    "created_at": "2020-02-24T12:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437266",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>Replying to [comment:3 vdelecroix]:
> For vectors and matrices, such method already exists and is called `apply_map`

>
> Is the difference in terminology intended?


No, not at all. Thanks for pointing out this. 
In the context of tensor fields, `apply_map` may sound a little bit too vague (for instance, it may evoke a pull back operation associated with a map between manifolds). Would  `apply_map_components` be more appropriate?



---

archive/issue_comments_437267.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 egourgoulhon]:\n> Replying to [comment:3 vdelecroix]:\n> > For vectors and matrices, such method already exists and is called `apply_map`\n\n> >\n> > Is the difference in terminology intended?\n\n> \n> No, not at all. Thanks for pointing out this. \n> In the context of tensor fields, `apply_map` may sound a little bit too vague (for instance, it may evoke a pull back operation associated with a map between manifolds). Would  `apply_map_components` be more appropriate?\n\n\nThe vagueness also applies to vectors/matrices where map can also refer to a morphism between vector spaces. I am not a big fan of the terminology but to my mind, consistency is the best option for the Sage interface as a whole. This consistency didcatorship includes as an option changing `apply_map` to something better.",
    "created_at": "2020-02-24T13:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437267",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>Replying to [comment:4 egourgoulhon]:
> Replying to [comment:3 vdelecroix]:
> > For vectors and matrices, such method already exists and is called `apply_map`

> >
> > Is the difference in terminology intended?

> 
> No, not at all. Thanks for pointing out this. 
> In the context of tensor fields, `apply_map` may sound a little bit too vague (for instance, it may evoke a pull back operation associated with a map between manifolds). Would  `apply_map_components` be more appropriate?


The vagueness also applies to vectors/matrices where map can also refer to a morphism between vector spaces. I am not a big fan of the terminology but to my mind, consistency is the best option for the Sage interface as a whole. This consistency didcatorship includes as an option changing `apply_map` to something better.



---

archive/issue_comments_437268.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 vdelecroix]:\n> Replying to [comment:4 egourgoulhon]:\n> > Replying to [comment:3 vdelecroix]:\n> > > For vectors and matrices, such method already exists and is called `apply_map`\n\n> > >\n> > > Is the difference in terminology intended?\n\n> > \n> > No, not at all. Thanks for pointing out this. \n> > In the context of tensor fields, `apply_map` may sound a little bit too vague (for instance, it may evoke a pull back operation associated with a map between manifolds). Would  `apply_map_components` be more appropriate?\n\n> \n> The vagueness also applies to vectors/matrices where map can also refer to a morphism between vector spaces. I am not a big fan of the terminology but to my mind, consistency is the best option for the Sage interface as a whole. This consistency didcatorship includes as an option changing `apply_map` to something better.\n\n\n`apply_map` is redundant. I would just have called it map because of the already existing Python function\n\n```\nsage: list(map(lambda x: x^2, range(4)))\n[0, 1, 4, 9]\n```",
    "created_at": "2020-02-24T13:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437268",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Replying to [comment:5 vdelecroix]:
> Replying to [comment:4 egourgoulhon]:
> > Replying to [comment:3 vdelecroix]:
> > > For vectors and matrices, such method already exists and is called `apply_map`

> > >
> > > Is the difference in terminology intended?

> > 
> > No, not at all. Thanks for pointing out this. 
> > In the context of tensor fields, `apply_map` may sound a little bit too vague (for instance, it may evoke a pull back operation associated with a map between manifolds). Would  `apply_map_components` be more appropriate?

> 
> The vagueness also applies to vectors/matrices where map can also refer to a morphism between vector spaces. I am not a big fan of the terminology but to my mind, consistency is the best option for the Sage interface as a whole. This consistency didcatorship includes as an option changing `apply_map` to something better.


`apply_map` is redundant. I would just have called it map because of the already existing Python function

```
sage: list(map(lambda x: x^2, range(4)))
[0, 1, 4, 9]
```



---

archive/issue_comments_437269.json:
```json
{
    "body": "<a id='comment:7'></a>I am -1 on calling the method `map` as I would first think it should return a `map` either from or based on the object or a map form of the object (such as for a matrix).",
    "created_at": "2020-02-24T23:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437269",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>I am -1 on calling the method `map` as I would first think it should return a `map` either from or based on the object or a map form of the object (such as for a matrix).



---

archive/issue_comments_437270.json:
```json
{
    "body": "<a id='comment:8'></a>Thank you Vincent and Travis for the discussion. I am pretty sensitive to the consistency argument put forward in comment:5, so I would lean toward `apply_map`. Do we all agree?",
    "created_at": "2020-02-25T16:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437270",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:8'></a>Thank you Vincent and Travis for the discussion. I am pretty sensitive to the consistency argument put forward in comment:5, so I would lean toward `apply_map`. Do we all agree?



---

archive/issue_comments_437271.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 egourgoulhon]:\n> Thank you Vincent and Travis for the discussion. I am pretty sensitive to the consistency argument put forward in comment:5, so I would lean toward `apply_map`. Do we all agree?\n\n\nDear Eric, that is of course ok for me!",
    "created_at": "2020-02-25T16:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437271",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Replying to [comment:8 egourgoulhon]:
> Thank you Vincent and Travis for the discussion. I am pretty sensitive to the consistency argument put forward in comment:5, so I would lean toward `apply_map`. Do we all agree?


Dear Eric, that is of course ok for me!



---

archive/issue_comments_437272.json:
```json
{
    "body": "<a id='comment:10'></a>I just want to mention that matrices also have a method `map_coefficients` which is very similar, coming from modules with basis. It is supposed to work with an endofunction on the coefficient ring, however it seems to be broken for matrices:\n\n```\nsage: matrix.identity(2).map_coefficients(lambda x: x+1)\n...\nKeyError: 1\n```\nAs `apply_map` does not require an endofunction, it has a more general notion, though.",
    "created_at": "2020-02-25T17:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437272",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:10'></a>I just want to mention that matrices also have a method `map_coefficients` which is very similar, coming from modules with basis. It is supposed to work with an endofunction on the coefficient ring, however it seems to be broken for matrices:

```
sage: matrix.identity(2).map_coefficients(lambda x: x+1)
...
KeyError: 1
```
As `apply_map` does not require an endofunction, it has a more general notion, though.



---

archive/issue_comments_437273.json:
```json
{
    "body": "<a id='comment:11'></a>I'm the one who asked for this function, so I'm very happy to see this patch. But I'm uneasy about the way it can be used to introduce inconsistencies between frames. Was it already easy to abuse SageManifolds like this before?\n\nAt least I would phrase that as a warning in the docstrings, instead of making it sound like a feature. I mean, it can be a feature where the function being mapped is non-destructive like factor, but substituting a parameter in some frame but not the other is clearly evil.",
    "created_at": "2020-02-25T17:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437273",
    "user": "https://github.com/PatrickMassot"
}
```

<a id='comment:11'></a>I'm the one who asked for this function, so I'm very happy to see this patch. But I'm uneasy about the way it can be used to introduce inconsistencies between frames. Was it already easy to abuse SageManifolds like this before?

At least I would phrase that as a warning in the docstrings, instead of making it sound like a feature. I mean, it can be a feature where the function being mapped is non-destructive like factor, but substituting a parameter in some frame but not the other is clearly evil.



---

archive/issue_comments_437274.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 gh-PatrickMassot]:\n> I'm the one who asked for this function, so I'm very happy to see this patch. But I'm uneasy about the way it can be used to introduce inconsistencies between frames. Was it already easy to abuse SageManifolds like this before?\n> \n> At least I would phrase that as a warning in the docstrings, instead of making it sound like a feature. I mean, it can be a feature where the function being mapped is non-destructive like factor, but substituting a parameter in some frame but not the other is clearly evil.\n\n\nThat's a good point. It should be easy to add a keyword argument such as `keep_other_components=False` or `non-destructive=False` to enforce the consistency between the sets of components in various frames. The components in frames different from the requested one will then be deleted. When requested, they can be recomputed via change-of-frame formulas. However, this can be time consuming and, in some cases, may generate a loss of information due to some lack of simplifications.",
    "created_at": "2020-02-25T21:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437274",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:12'></a>Replying to [comment:11 gh-PatrickMassot]:
> I'm the one who asked for this function, so I'm very happy to see this patch. But I'm uneasy about the way it can be used to introduce inconsistencies between frames. Was it already easy to abuse SageManifolds like this before?
> 
> At least I would phrase that as a warning in the docstrings, instead of making it sound like a feature. I mean, it can be a feature where the function being mapped is non-destructive like factor, but substituting a parameter in some frame but not the other is clearly evil.


That's a good point. It should be easy to add a keyword argument such as `keep_other_components=False` or `non-destructive=False` to enforce the consistency between the sets of components in various frames. The components in frames different from the requested one will then be deleted. When requested, they can be recomputed via change-of-frame formulas. However, this can be time consuming and, in some cases, may generate a loss of information due to some lack of simplifications.



---

archive/issue_comments_437275.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-26T21:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437276.json:
```json
{
    "body": "<a id='comment:14'></a>In the above commit, the method has been renamed `apply_map` (cf. comment:9) and the consistency issue pointed out in comment:11 has been delt with by adding the keyword argument `keep_other_components`. Its default value (`False`) enforces the consistency among the components in various vector frames.",
    "created_at": "2020-02-26T22:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437276",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:14'></a>In the above commit, the method has been renamed `apply_map` (cf. comment:9) and the consistency issue pointed out in comment:11 has been delt with by adding the keyword argument `keep_other_components`. Its default value (`False`) enforces the consistency among the components in various vector frames.



---

archive/issue_comments_437277.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-02-26T22:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437277",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_437278.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This ticket adds the method `map_components` to the class `TensorField`, which applies a function to the coordinate expressions of all components of a tensor field in a given vector frame.\n+This ticket adds the method `apply_map` to the class `TensorField`, which applies a function to the coordinate expressions of all components of a tensor field in a given vector frame.\n This allows operations like factorization, expansion, simplification or substitution to be performed on the components.\n \n Such a method has been requested in e.g. https://ask.sagemath.org/question/42107/basic-work-on-tensor-components/ and was discussed again during [Sage Days 107](https://wiki.sagemath.org/days107).\n```\n",
    "created_at": "2020-02-26T22:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437278",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This ticket adds the method `map_components` to the class `TensorField`, which applies a function to the coordinate expressions of all components of a tensor field in a given vector frame.
+This ticket adds the method `apply_map` to the class `TensorField`, which applies a function to the coordinate expressions of all components of a tensor field in a given vector frame.
 This allows operations like factorization, expansion, simplification or substitution to be performed on the components.
 
 Such a method has been requested in e.g. https://ask.sagemath.org/question/42107/basic-work-on-tensor-components/ and was discussed again during [Sage Days 107](https://wiki.sagemath.org/days107).
```




---

archive/issue_comments_437279.json:
```json
{
    "body": "<a id='comment:17'></a>Anybody to perform the final review? If we want this in 9.1, this could be the good time...",
    "created_at": "2020-03-09T10:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437279",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:17'></a>Anybody to perform the final review? If we want this in 9.1, this could be the good time...



---

archive/issue_comments_437280.json:
```json
{
    "body": "<a id='comment:18'></a>I will give this the green light. I added Vincent as a reviewer considering the name change was based off his suggestion. If anyone else feels like they want to be a reviewer, please add your name.",
    "created_at": "2020-03-09T12:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437280",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>I will give this the green light. I added Vincent as a reviewer considering the name change was based off his suggestion. If anyone else feels like they want to be a reviewer, please add your name.



---

archive/issue_comments_437281.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-09T12:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437281",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437282.json:
```json
{
    "body": "<a id='comment:19'></a>Thank you Travis!",
    "created_at": "2020-03-09T13:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437282",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:19'></a>Thank you Travis!



---

archive/issue_events_074365.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-11T23:46:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29244#event-74365"
}
```



---

archive/issue_comments_437283.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-11T23:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29244",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29244#issuecomment-437283",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
