# Issue 29028: bugs for binary quadratic forms whose discriminant is a square

archive/issues_028791.json:
```json
{
    "body": "Ticket #28989 fixes bugs for quadratic forms whose discriminant is positive, but not a square. This ticket addresses the remaining case where the discriminant is a square. Symptoms of the bugs include:\n\nTwo forms may be properly equivalent, but not equivalent, and equivalence is not reflexive:\n\n```\nsage: Q = BinaryQF(0, 2, 0)\nsage: Q.discriminant()\n4\nsage: Q.is_equivalent(Q, proper=True)\nTrue\nsage: Q.is_equivalent(Q, proper=False)\nFalse\n```\n\nThe forms `-4*x^2 + 10*x*y`, `-2*x^2 + 10*x*y`, ` 10*x*y`, `2*x^2 + 10*x*y`, `4*x^2 + 10*x*y`, and `5*x^2 + 10*x*y` are not primitive (i.e., the gcd of the coefficients is not 1), but they appear in a list of primitive forms:\n\n```\nsage: BinaryQF_reduced_representatives(10^2, primitive_only=True)\n[-4*x^2 + 10*x*y,\n -3*x^2 + 10*x*y,\n -2*x^2 + 10*x*y,\n -x^2 + 10*x*y,\n 10*x*y,\n x^2 + 10*x*y,\n 2*x^2 + 10*x*y,\n 3*x^2 + 10*x*y,\n 4*x^2 + 10*x*y,\n 5*x^2 + 10*x*y]\n```\n\nI will upload a PR soon.\n\nCC:  @simonbrandhorst\n\nKeywords: binary quadratic form\n\nBranch/Commit: 4580620b079941cd02429057e306d0b6c79785b8\n\nReviewer: Travis Scrimshaw\n\nAuthor: Dave Morris\n\nDependencies: #28989\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29028\n\n",
    "closed_at": "2020-01-31T23:49:36Z",
    "created_at": "2020-01-16T18:54:35Z",
    "labels": [
        "component: number theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "bugs for binary quadratic forms whose discriminant is a square",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29028",
    "user": "https://github.com/DaveWitteMorris"
}
```
Ticket #28989 fixes bugs for quadratic forms whose discriminant is positive, but not a square. This ticket addresses the remaining case where the discriminant is a square. Symptoms of the bugs include:

Two forms may be properly equivalent, but not equivalent, and equivalence is not reflexive:

```
sage: Q = BinaryQF(0, 2, 0)
sage: Q.discriminant()
4
sage: Q.is_equivalent(Q, proper=True)
True
sage: Q.is_equivalent(Q, proper=False)
False
```

The forms `-4*x^2 + 10*x*y`, `-2*x^2 + 10*x*y`, ` 10*x*y`, `2*x^2 + 10*x*y`, `4*x^2 + 10*x*y`, and `5*x^2 + 10*x*y` are not primitive (i.e., the gcd of the coefficients is not 1), but they appear in a list of primitive forms:

```
sage: BinaryQF_reduced_representatives(10^2, primitive_only=True)
[-4*x^2 + 10*x*y,
 -3*x^2 + 10*x*y,
 -2*x^2 + 10*x*y,
 -x^2 + 10*x*y,
 10*x*y,
 x^2 + 10*x*y,
 2*x^2 + 10*x*y,
 3*x^2 + 10*x*y,
 4*x^2 + 10*x*y,
 5*x^2 + 10*x*y]
```

I will upload a PR soon.

CC:  @simonbrandhorst

Keywords: binary quadratic form

Branch/Commit: 4580620b079941cd02429057e306d0b6c79785b8

Reviewer: Travis Scrimshaw

Author: Dave Morris

Dependencies: #28989

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29028





---

archive/issue_comments_557498.json:
```json
{
    "body": "Changing branch from \"\" to \"public/29028\"",
    "created_at": "2020-01-16T19:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557498",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing branch from "" to "public/29028"



---

archive/issue_comments_557499.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[aa21ee1](https://github.com/sagemath/sagetrac-mirror/commit/aa21ee131425248b6ca8ae4ffde91aac5c1521b1)|`proper cycle should not have odd length`|\n|[c24e07d](https://github.com/sagemath/sagetrac-mirror/commit/c24e07df70ad46cae0f6a2f58778a90dbb843e05)|`apply tau only to half of the terms`|\n|[6ac626a](https://github.com/sagemath/sagetrac-mirror/commit/6ac626a6157cb31f96dc0cc981d5d6bc9732a68e)|`revise docstrings and fix another bug`|\n|[2c2bc7a](https://github.com/sagemath/sagetrac-mirror/commit/2c2bc7a454e444655e7c7303618beed6bc976e80)|`discriminants that are a square`|",
    "created_at": "2020-01-16T19:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557499",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[aa21ee1](https://github.com/sagemath/sagetrac-mirror/commit/aa21ee131425248b6ca8ae4ffde91aac5c1521b1)|`proper cycle should not have odd length`|
|[c24e07d](https://github.com/sagemath/sagetrac-mirror/commit/c24e07df70ad46cae0f6a2f58778a90dbb843e05)|`apply tau only to half of the terms`|
|[6ac626a](https://github.com/sagemath/sagetrac-mirror/commit/6ac626a6157cb31f96dc0cc981d5d6bc9732a68e)|`revise docstrings and fix another bug`|
|[2c2bc7a](https://github.com/sagemath/sagetrac-mirror/commit/2c2bc7a454e444655e7c7303618beed6bc976e80)|`discriminants that are a square`|



---

archive/issue_comments_557500.json:
```json
{
    "body": "Changing commit from \"\" to \"2c2bc7a454e444655e7c7303618beed6bc976e80\"",
    "created_at": "2020-01-16T19:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557500",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing commit from "" to "2c2bc7a454e444655e7c7303618beed6bc976e80"



---

archive/issue_comments_557501.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-16T19:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557501",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_557502.json:
```json
{
    "body": "Changing author from \"\" to \"Dave Morris\"",
    "created_at": "2020-01-16T19:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557502",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing author from "" to "Dave Morris"



---

archive/issue_comments_557503.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#28989\"",
    "created_at": "2020-01-16T19:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557503",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing dependencies from "" to "#28989"



---

archive/issue_comments_557504.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[48d6e89](https://github.com/sagemath/sagetrac-mirror/commit/48d6e8939ee7d9750f518e004ca99a51ce043815)|`docs should not have # comments`|\n|[17653f7](https://github.com/sagemath/sagetrac-mirror/commit/17653f788fe9659b8d77240d2798575a213549b2)|`Merge latest #28989 into #29028`|\n|[028d95b](https://github.com/sagemath/sagetrac-mirror/commit/028d95beca93dcf51350e004900ef188d513d41f)|`docs should not have # comments`|",
    "created_at": "2020-01-17T18:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[48d6e89](https://github.com/sagemath/sagetrac-mirror/commit/48d6e8939ee7d9750f518e004ca99a51ce043815)|`docs should not have # comments`|
|[17653f7](https://github.com/sagemath/sagetrac-mirror/commit/17653f788fe9659b8d77240d2798575a213549b2)|`Merge latest #28989 into #29028`|
|[028d95b](https://github.com/sagemath/sagetrac-mirror/commit/028d95beca93dcf51350e004900ef188d513d41f)|`docs should not have # comments`|



---

archive/issue_comments_557505.json:
```json
{
    "body": "Changing commit from \"2c2bc7a454e444655e7c7303618beed6bc976e80\" to \"028d95beca93dcf51350e004900ef188d513d41f\"",
    "created_at": "2020-01-17T18:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2c2bc7a454e444655e7c7303618beed6bc976e80" to "028d95beca93dcf51350e004900ef188d513d41f"



---

archive/issue_comments_557506.json:
```json
{
    "body": "Changing commit from \"028d95beca93dcf51350e004900ef188d513d41f\" to \"f2f6bd5044ebae9002c4281175b74419094805e6\"",
    "created_at": "2020-01-22T03:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557506",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "028d95beca93dcf51350e004900ef188d513d41f" to "f2f6bd5044ebae9002c4281175b74419094805e6"



---

archive/issue_comments_557507.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|\n|[ee54527](https://github.com/sagemath/sagetrac-mirror/commit/ee545279bc385f49de0520aed348401fb83d4660)|`fix minor issues`|\n|[f2f6bd5](https://github.com/sagemath/sagetrac-mirror/commit/f2f6bd5044ebae9002c4281175b74419094805e6)|`fix merge conflict with #28989`|",
    "created_at": "2020-01-22T03:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557507",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|
|[ee54527](https://github.com/sagemath/sagetrac-mirror/commit/ee545279bc385f49de0520aed348401fb83d4660)|`fix minor issues`|
|[f2f6bd5](https://github.com/sagemath/sagetrac-mirror/commit/f2f6bd5044ebae9002c4281175b74419094805e6)|`fix merge conflict with #28989`|



---

archive/issue_comments_557508.json:
```json
{
    "body": "<a id='comment:6'></a>\nMerged in #28989 again, to fix a merge conflict caused by the latest changes there.",
    "created_at": "2020-01-22T03:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557508",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:6'></a>
Merged in #28989 again, to fix a merge conflict caused by the latest changes there.



---

archive/issue_comments_557509.json:
```json
{
    "body": "<a id='comment:7'></a>\nTwo little changes:\n\n```diff\n         We check that the first part of :trac:`29028` is fixed::\n+\n             sage: Q = BinaryQF(0, 2, 0)\n             sage: Q.discriminant()\n             4\n```\n\n```diff\n     Test another part of :trac:`29028`::\n+\n         sage: BinaryQF_reduced_representatives(10^2, proper=False, primitive_only=False)\n```\nas you need a blankline after the `::` line.",
    "created_at": "2020-01-29T05:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557509",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Two little changes:

```diff
         We check that the first part of :trac:`29028` is fixed::
+
             sage: Q = BinaryQF(0, 2, 0)
             sage: Q.discriminant()
             4
```

```diff
     Test another part of :trac:`29028`::
+
         sage: BinaryQF_reduced_representatives(10^2, proper=False, primitive_only=False)
```
as you need a blankline after the `::` line.



---

archive/issue_comments_557510.json:
```json
{
    "body": "Changing commit from \"f2f6bd5044ebae9002c4281175b74419094805e6\" to \"4580620b079941cd02429057e306d0b6c79785b8\"",
    "created_at": "2020-01-29T21:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f2f6bd5044ebae9002c4281175b74419094805e6" to "4580620b079941cd02429057e306d0b6c79785b8"



---

archive/issue_comments_557511.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[4580620](https://github.com/sagemath/sagetrac-mirror/commit/4580620b079941cd02429057e306d0b6c79785b8)|`need blank line after comment`|",
    "created_at": "2020-01-29T21:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[4580620](https://github.com/sagemath/sagetrac-mirror/commit/4580620b079941cd02429057e306d0b6c79785b8)|`need blank line after comment`|



---

archive/issue_comments_557512.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks for the corrections.",
    "created_at": "2020-01-29T21:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557512",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:9'></a>
Thanks for the corrections.



---

archive/issue_comments_557513.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-29T23:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557513",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_557514.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks. LGTM.",
    "created_at": "2020-01-29T23:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557514",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
Thanks. LGTM.



---

archive/issue_comments_557515.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2020-01-29T23:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557515",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_events_090915.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29028#event-90915"
}
```



---

archive/issue_comments_557516.json:
```json
{
    "body": "Changing branch from \"public/29028\" to \"4580620b079941cd02429057e306d0b6c79785b8\"",
    "created_at": "2020-01-31T23:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557516",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/29028" to "4580620b079941cd02429057e306d0b6c79785b8"



---

archive/issue_comments_557517.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-31T23:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29028#issuecomment-557517",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
