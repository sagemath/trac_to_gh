# Issue 29017: Coercion map to a quotient of a polynomial ring has incorrect parent

archive/issues_028780.json:
```json
{
    "body": "In SageMath 9.1.beta0:\n\n```\nsage: R.<x> = ZZ[]\nsage: Q = R.quo(x - 1)\nsage: H = R.Hom(Q); H\nSet of Homomorphisms from Univariate Polynomial Ring in x over Integer Ring to Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1\nsage: h = R.hom(Q); h\nCoercion map:\n  From: Univariate Polynomial Ring in x over Integer Ring\n  To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1\nsage: h.parent()\nSet of Homomorphisms from Univariate Polynomial Ring in x over Integer Ring to Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1\n```\nThe parent of `h` seems to be `H` at first sight.  However:\n\n```\nsage: h in H\nFalse\nsage: h.parent() == H\nFalse\n```\nOne can convert `h` to an element of `H`, but the result is bizarre:\n\n```\nsage: H(h)\nComposite map:\n  From: Univariate Polynomial Ring in x over Integer Ring\n  To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1\n  Defn:   Identity endomorphism of Univariate Polynomial Ring in x over Integer Ring\n        then\n          Coercion map:\n          From: Univariate Polynomial Ring in x over Integer Ring\n          To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1\n        then\n          Identity endomorphism of Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1\n```\n\n\nKeywords: quotient ring, homset\n\nBranch/Commit: f8e34e1f798daf33d7a0dafa72c381e996eff411\n\nReviewer: Peter Bruin\n\nAuthor: Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29017\n\n",
    "closed_at": "2020-01-20T21:18:00Z",
    "created_at": "2020-01-15T14:27:32Z",
    "labels": [
        "component: coercion",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Coercion map to a quotient of a polynomial ring has incorrect parent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29017",
    "user": "https://github.com/pjbruin"
}
```
In SageMath 9.1.beta0:

```
sage: R.<x> = ZZ[]
sage: Q = R.quo(x - 1)
sage: H = R.Hom(Q); H
Set of Homomorphisms from Univariate Polynomial Ring in x over Integer Ring to Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
sage: h = R.hom(Q); h
Coercion map:
  From: Univariate Polynomial Ring in x over Integer Ring
  To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
sage: h.parent()
Set of Homomorphisms from Univariate Polynomial Ring in x over Integer Ring to Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
```
The parent of `h` seems to be `H` at first sight.  However:

```
sage: h in H
False
sage: h.parent() == H
False
```
One can convert `h` to an element of `H`, but the result is bizarre:

```
sage: H(h)
Composite map:
  From: Univariate Polynomial Ring in x over Integer Ring
  To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
  Defn:   Identity endomorphism of Univariate Polynomial Ring in x over Integer Ring
        then
          Coercion map:
          From: Univariate Polynomial Ring in x over Integer Ring
          To:   Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
        then
          Identity endomorphism of Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x - 1
```


Keywords: quotient ring, homset

Branch/Commit: f8e34e1f798daf33d7a0dafa72c381e996eff411

Reviewer: Peter Bruin

Author: Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29017





---

archive/issue_comments_564094.json:
```json
{
    "body": "<a id='comment:1'></a>\nAnother symptom is the categories of the respect homspaces not agreeing:\n\n```\nsage: H.category()\nCategory of homsets of unital magmas and additive unital additive magmas\nsage: h.parent().category()\nCategory of homsets of unital magmas and right modules over (euclidean domains and infinite enumerated sets and metric spaces) and left modules over (euclidean domains and infinite enumerated sets and metric spaces)\n```\nThis is why the homsets are not the same, but I don't know what is causing this.",
    "created_at": "2020-01-16T04:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564094",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
Another symptom is the categories of the respect homspaces not agreeing:

```
sage: H.category()
Category of homsets of unital magmas and additive unital additive magmas
sage: h.parent().category()
Category of homsets of unital magmas and right modules over (euclidean domains and infinite enumerated sets and metric spaces) and left modules over (euclidean domains and infinite enumerated sets and metric spaces)
```
This is why the homsets are not the same, but I don't know what is causing this.



---

archive/issue_comments_564095.json:
```json
{
    "body": "<a id='comment:2'></a>\nSo the issue comes down to the fact that the coercion map from `R -> Q` is in the bigger category (which is not detected by default). More specifically, it comes from this line in `Q._coerce_map_from_`:\n\n```\nparent = Hom(R, self, category=self.category()._meet_(R.category()))\n```\nwhich the category part is\n\n```\nsage: Q.category()._meet_(R.category())\nCategory of commutative no zero divisors algebras over (euclidean domains and infinite enumerated sets and metric spaces)\n```\nHowever, if we reverse it, we get\n\n```\nsage: R.category()._meet_(Q.category())\nCategory of integral domains\n```\nSo something is going wrong. My guess is it comes from the parameterization of the quotient ring's category:\n\n```\nsage: R.category()\nJoin of Category of unique factorization domains and Category of commutative algebras over (euclidean domains and infinite enumerated sets and metric spaces) and Category of infinite sets\nsage: Q.category()\nCategory of commutative no zero divisors quotients of algebras over Integer Ring\n```",
    "created_at": "2020-01-16T04:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564095",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
So the issue comes down to the fact that the coercion map from `R -> Q` is in the bigger category (which is not detected by default). More specifically, it comes from this line in `Q._coerce_map_from_`:

```
parent = Hom(R, self, category=self.category()._meet_(R.category()))
```
which the category part is

```
sage: Q.category()._meet_(R.category())
Category of commutative no zero divisors algebras over (euclidean domains and infinite enumerated sets and metric spaces)
```
However, if we reverse it, we get

```
sage: R.category()._meet_(Q.category())
Category of integral domains
```
So something is going wrong. My guess is it comes from the parameterization of the quotient ring's category:

```
sage: R.category()
Join of Category of unique factorization domains and Category of commutative algebras over (euclidean domains and infinite enumerated sets and metric spaces) and Category of infinite sets
sage: Q.category()
Category of commutative no zero divisors quotients of algebras over Integer Ring
```



---

archive/issue_comments_564096.json:
```json
{
    "body": "Changing author from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2020-01-16T04:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564096",
    "user": "https://github.com/tscrim"
}
```

Changing author from "" to "Travis Scrimshaw"



---

archive/issue_comments_564097.json:
```json
{
    "body": "Changing commit from \"\" to \"f8e34e1f798daf33d7a0dafa72c381e996eff411\"",
    "created_at": "2020-01-16T04:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564097",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "" to "f8e34e1f798daf33d7a0dafa72c381e996eff411"



---

archive/issue_comments_564098.json:
```json
{
    "body": "Changing branch from \"\" to \"public/categories/quotient_ring_category-29017\"",
    "created_at": "2020-01-16T04:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564098",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "" to "public/categories/quotient_ring_category-29017"



---

archive/issue_comments_564099.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-16T04:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564099",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_564100.json:
```json
{
    "body": "<a id='comment:3'></a>\nYep, the problem was exactly as I was suspecting. I don't think we ever implemented anything that properly category-meets together parameterized categories. This is a bit of a hack solution rather than a proper one, but it is something we should do anyways in line with other polynomial rings.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[f8e34e1](https://git.sagemath.org/sage.git/commit?id=f8e34e1f798daf33d7a0dafa72c381e996eff411)|`Making polynomial quotient rings category parameterization be a category.`|",
    "created_at": "2020-01-16T04:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564100",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Yep, the problem was exactly as I was suspecting. I don't think we ever implemented anything that properly category-meets together parameterized categories. This is a bit of a hack solution rather than a proper one, but it is something we should do anyways in line with other polynomial rings.

---
New commits:
|                                                                                                                                          |                                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[f8e34e1](https://git.sagemath.org/sage.git/commit?id=f8e34e1f798daf33d7a0dafa72c381e996eff411)|`Making polynomial quotient rings category parameterization be a category.`|



---

archive/issue_comments_564101.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-16T13:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564101",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_564102.json:
```json
{
    "body": "<a id='comment:4'></a>\nLooks good.  Your patch makes the category of `Q` more consistent with that of `R`, and fixes the bug.  Mathematically speaking, I think it would be nice if `Q` were in the more specific category of **Z**-algebras or even `R`-algebras, but this should do for now.",
    "created_at": "2020-01-16T13:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564102",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>
Looks good.  Your patch makes the category of `Q` more consistent with that of `R`, and fixes the bug.  Mathematically speaking, I think it would be nice if `Q` were in the more specific category of **Z**-algebras or even `R`-algebras, but this should do for now.



---

archive/issue_comments_564103.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Peter Bruin\"",
    "created_at": "2020-01-16T13:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564103",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "" to "Peter Bruin"



---

archive/issue_comments_564104.json:
```json
{
    "body": "Changing branch from \"public/categories/quotient_ring_category-29017\" to \"f8e34e1f798daf33d7a0dafa72c381e996eff411\"",
    "created_at": "2020-01-20T21:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564104",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/categories/quotient_ring_category-29017" to "f8e34e1f798daf33d7a0dafa72c381e996eff411"



---

archive/issue_comments_564105.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-20T21:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29017#issuecomment-564105",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_073501.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-20T21:18:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29017",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29017#event-73501"
}
```
