# Issue 29610: Implement Vertex algebras and related algebraic structures

archive/issues_029373.json:
```json
{
    "body": "This ticket implements **(super) vertex algebras**, **(super) Poisson vertex algebras** and **(super) Lie conformal algebras** \n\n## Summary of implemented structures\n- Lie conformal algebras: \n   - category of such and their subcategories (graded, finitely generated, super, etc)\n   - construction of central extensions of freely generated Lie conformal algebras from the brackets of the generators.\n\n- Vertex algebras:\n    - category of such and their subcategories as above.\n    - Universal enveloping vertex algebras of Lie conformal algebras.\n    - canonical embedding from a Lie conformal algebra to its universal enveloping algebra. \n    - Vertex algebra ideals of graded vertex algebras, generated by primary vectors. \n    - Quotients of universal enveloping vertex algebras by vertex algebra ideals. \n\n- Poisson vertex algebras:\n    - category of such and their subcategories as above.\n    - classical limits of universal enveloping vertex algebras and their quotients by primary vectors. \n    - arc algebras of universal enveloping vertex algebras and their quotients (the algebra of functions on the arc space of the associated scheme to a vertex algebra)\n    - The canonical surjective morphism from the arc algebra to the singular support of a vertex algebra.\n    - Ideals of freely generated poisson vertex algebras (this includes for example differential ideals of differential polynomial algebras)\n    - Quotients of freely generated poisson vertex algebras by their ideals.\n- The following examples are implemented:\n     - Abelian Lie conformal and vertex algebras \n     - Affine Lie conformal and vertex algebras\n     - Bosonic Ghosts Lie conformal algebras\n     - Fermionic Ghosts Lie conformal algebras\n     - Free Bosons Lie Conformal and vertex Algebras\n     - Free Fermions Lie Conformal and vertex Algebras\n     - N=2 Super Lie Conformal and vertex Algebra\n     - Neveu-Schwarz super Lie conformal and vertex algebra\n     - Virasoro Lie conformal and vertex algebra\n     - Weyl Lie conformal and vertex algebra\n\n## Examples from the documentation:\n\nThe documentation can be found in the compiled reference manuals. A copy can be found in the following links. The main usage examples are in:\n\nhttp://potuz.net/reference/algebras/sage/algebras/vertex_algebras/vertex_algebra.html\n\nAnd the tree of classes with more examples can be found in the pages\n\nhttp://potuz.net/reference/algebras/vertex_algebras/vertex_algebras.html\nhttp://potuz.net/reference/algebras/lie_conformal_algebras/lie_conformal_algebras.html\nhttp://potuz.net/reference/algebras/poisson_vertex_algebras/poisson_vertex_algebras.html\n\nThe following is a typical example from the documentation (which was essentially what drove me to write this patch as it was used in https://arxiv.org/abs/2005.10769:\n\n- We create the Universal Virasoro Vertex algebra of central charge c=1/2 and perform some basic computations:\n\n```\n    sage: V = VirasoroVertexAlgebra(QQ,1/2); V.inject_variables()\n    Defining L\n    sage: L*L\n    L_-2L_-2|0>\n    sage: (L*L).T()\n    2*L_-3L_-2|0> + L_-5|0>\n    sage: L.bracket(L*L)\n    {0: 2*L_-3L_-2|0> + L_-5|0>,\n     1: 4*L_-2L_-2|0>,\n     2: 3*L_-3|0>,\n     3: 17/2*L_-2|0>,\n     5: 3/2*|0>}\n```\n\n- We compute its irreducible quotient:\n\n```\n    sage: V.find_singular(6)\n    (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)\n    sage: I = V.ideal(_); I\n    ideal of The Virasoro vertex algebra of central charge 1/2 over Rational Field generated by (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)\n    sage: Q = V.quotient(I); Q\n    Quotient of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)\n    sage: Q.retract(L*(L*L))\n    -93/64*L_-3L_-3|0> + 33/8*L_-4L_-2|0> + 27/16*L_-6|0>\n```\n\n- We compute the arc algebra and the classical limit of `Q`:\n\n```\n    sage: P = Q.arc_algebra(); P\n    Quotient of The classical limit of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_2^3,)\n    sage: R = Q.classical_limit(); R\n    The classical limit of Quotient of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)\n    sage: P.hilbert_series(10)\n    1 + q^2 + q^3 + 2*q^4 + 2*q^5 + 3*q^6 + 3*q^7 + 5*q^8 + 6*q^9 + O(q^10)\n    sage: R.hilbert_series(10)\n    1 + q^2 + q^3 + 2*q^4 + 2*q^5 + 3*q^6 + 3*q^7 + 5*q^8 + 5*q^9 + O(q^10)\n```\n\n\n- The result above indicates that `Q` is not classically free:\n\n```\n    sage: f = R.arc_algebra_cover; f\n    Ring morphism:\n      From: Quotient of The classical limit of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_2^3,)\n      To:   The classical limit of Quotient of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)\n      Defn: L_2 |--> L_2\n    sage: f.kernel(9)\n    Free module generated by {0} over Rational Field\n    sage: _.an_element().lift()\n    2*L_4*L_3*L_2 + 1/3*L_5*L_2^2\n```\n\n\n## Random Comments\n\n- This ticket fails one of the first //Guidelines for opening tickets//:\n       \"It is much better to open several specific tickets than one that is very broad. Indeed, a single ticket which deals with lots of different issues can be quite problematic, and should be avoided.\" \n\nI am happy to help breaking the ticket if this will facilitate reviewing it. But on the other hand if you look at the list of examples it is clear that most of the doctesting and examples will break. \n\n- The directory structure is quite independent. Besides a very minor touch to PartitionTuples and the reference manual, the code is contained in three files in categories and the directories algebras/{lie_conformal_algebras,vertex_algebras,poisson_vertex_algebras} and shouldn't affect the rest of the library. \n\n- I am no programmer and just started using Sage (and python for that matter) last year. I focused on having a mathematically correct code first and will go over implementation details and good programming conduct in the near future. \n\n- A recurrent theme is the following: one has an infinite dimensional graded module with finite dimensional pieces. One would want to construct infinite dimensional submodules and quotients of these. The code in modules.with_basis.subquotient is already in place, but it relies in having lists as basis in a few places, instead of allowing custom classes that can be iterable. I coded the skeleton of what I needed in VertexAlgebraIdeal/Quotient and PoissonVertexAlgebraIdeal/Quotient (didn't implement ideals for LCA) but it seems to me that similar code should be in place on modules.with_basis I haven't browsed the repository but I suppose this is a very common situation in many areas. \n\n- Poisson vertex algebras are in particular differential commutative algebras. In the non-super integrally graded case I can convert to polynomial algebras and use the machinery of Groebner bases and such. Is there something like this implemented for exterior algebras? I also couldn't find anything like affine arc schemes or affine jet schemes in Sage, to hook the ring structure of non-super Poisson vertex algebras and their quotients\n\n## Immediate Goals\n- Better implementation of arithmetic, I'll move to Cython the main element methods responsible for arithmetic. But I am afraid that it may be a flaw of my design: computations in vertex algebra quotients are too expensive, and it get's worse in their classical limits. This is true even in very simple cases like the Ising model above. I am convinced that this is a problem with my ineptitude and I am hoping that some of the skillful programmers here will speed this up.\n\n- Implement morphisms and modules in the graded case: everything is in place and this should not be hard: same as for the two main cases that I worked here, Verma and quotients should go in the same way. \n\n## What is not implemented\n\n- Lattice vertex algebras\n\n- Coset models\n\nThese require other techniques. \n\n\n## What is obviously wrong\n\nI suppose I'll start adding things to this list shortly, but some things are now clearly wrong:\n\n- Printing of elements. A typical element of the Virasoro Vertex \n  algebra now is printed as \n\n  {{{\n  3*L_-3L_-3L_-2|0> -2*L_-2|0>\n  }}}\n\n  I couldn't think of a better way to write them. and this is not \n  that bad. But when you go to rational gradings, say the N=1 super \n  vertex algebra, you start seeing things like\n\n  {{{\n  3*G_-3/2|0>\n  }}}\n\n  Still not entirely awful as there can't be any confusion (as far \n  as I can see). The worst situation is the Poisson case where \n  that would render\n\n  {{{\n  3*G_3/2\n  }}}\n  And that /2 is quite bad. It is not ambiguous with \n  {{{\n  3/2*G_3\n  }}}\n  But is ugly. Still I couldn't find anything better. \n- Speed: the biggest problem in computing on quotients and on their \n  classical limits is the test that an element is in the ideal. \n  There is no analog to _divides_ in commutative rings. Currently \n  what I am doing is to compute every element of the algebra acting on the generators of the ideal so that many vectors are counted several times due to relations. This I think is the bottleneck and surely can be improved. \n\nCC:  @tscrim @heluani @dwbump\n\nKeywords: vertex algebras, lie conformal algebras\n\nAuthor: Reimundo Heluani\n\nBranch: u/heluani/vertex_algebras\n\nDependencies: #30007, #30032, #30043\n\nCommit: b578a357cc5bc5d124fd822c5ab436fb88b50884\n\nIssue created by migration from https://trac.sagemath.org/ticket/29610\n\n",
    "created_at": "2020-04-28T13:00:52Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Implement Vertex algebras and related algebraic structures",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29610",
    "user": "https://github.com/heluani"
}
```
This ticket implements **(super) vertex algebras**, **(super) Poisson vertex algebras** and **(super) Lie conformal algebras** 

## Summary of implemented structures
- Lie conformal algebras: 
   - category of such and their subcategories (graded, finitely generated, super, etc)
   - construction of central extensions of freely generated Lie conformal algebras from the brackets of the generators.

- Vertex algebras:
    - category of such and their subcategories as above.
    - Universal enveloping vertex algebras of Lie conformal algebras.
    - canonical embedding from a Lie conformal algebra to its universal enveloping algebra. 
    - Vertex algebra ideals of graded vertex algebras, generated by primary vectors. 
    - Quotients of universal enveloping vertex algebras by vertex algebra ideals. 

- Poisson vertex algebras:
    - category of such and their subcategories as above.
    - classical limits of universal enveloping vertex algebras and their quotients by primary vectors. 
    - arc algebras of universal enveloping vertex algebras and their quotients (the algebra of functions on the arc space of the associated scheme to a vertex algebra)
    - The canonical surjective morphism from the arc algebra to the singular support of a vertex algebra.
    - Ideals of freely generated poisson vertex algebras (this includes for example differential ideals of differential polynomial algebras)
    - Quotients of freely generated poisson vertex algebras by their ideals.
- The following examples are implemented:
     - Abelian Lie conformal and vertex algebras 
     - Affine Lie conformal and vertex algebras
     - Bosonic Ghosts Lie conformal algebras
     - Fermionic Ghosts Lie conformal algebras
     - Free Bosons Lie Conformal and vertex Algebras
     - Free Fermions Lie Conformal and vertex Algebras
     - N=2 Super Lie Conformal and vertex Algebra
     - Neveu-Schwarz super Lie conformal and vertex algebra
     - Virasoro Lie conformal and vertex algebra
     - Weyl Lie conformal and vertex algebra

## Examples from the documentation:

The documentation can be found in the compiled reference manuals. A copy can be found in the following links. The main usage examples are in:

http://potuz.net/reference/algebras/sage/algebras/vertex_algebras/vertex_algebra.html

And the tree of classes with more examples can be found in the pages

http://potuz.net/reference/algebras/vertex_algebras/vertex_algebras.html
http://potuz.net/reference/algebras/lie_conformal_algebras/lie_conformal_algebras.html
http://potuz.net/reference/algebras/poisson_vertex_algebras/poisson_vertex_algebras.html

The following is a typical example from the documentation (which was essentially what drove me to write this patch as it was used in https://arxiv.org/abs/2005.10769:

- We create the Universal Virasoro Vertex algebra of central charge c=1/2 and perform some basic computations:

```
    sage: V = VirasoroVertexAlgebra(QQ,1/2); V.inject_variables()
    Defining L
    sage: L*L
    L_-2L_-2|0>
    sage: (L*L).T()
    2*L_-3L_-2|0> + L_-5|0>
    sage: L.bracket(L*L)
    {0: 2*L_-3L_-2|0> + L_-5|0>,
     1: 4*L_-2L_-2|0>,
     2: 3*L_-3|0>,
     3: 17/2*L_-2|0>,
     5: 3/2*|0>}
```

- We compute its irreducible quotient:

```
    sage: V.find_singular(6)
    (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)
    sage: I = V.ideal(_); I
    ideal of The Virasoro vertex algebra of central charge 1/2 over Rational Field generated by (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)
    sage: Q = V.quotient(I); Q
    Quotient of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)
    sage: Q.retract(L*(L*L))
    -93/64*L_-3L_-3|0> + 33/8*L_-4L_-2|0> + 27/16*L_-6|0>
```

- We compute the arc algebra and the classical limit of `Q`:

```
    sage: P = Q.arc_algebra(); P
    Quotient of The classical limit of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_2^3,)
    sage: R = Q.classical_limit(); R
    The classical limit of Quotient of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)
    sage: P.hilbert_series(10)
    1 + q^2 + q^3 + 2*q^4 + 2*q^5 + 3*q^6 + 3*q^7 + 5*q^8 + 6*q^9 + O(q^10)
    sage: R.hilbert_series(10)
    1 + q^2 + q^3 + 2*q^4 + 2*q^5 + 3*q^6 + 3*q^7 + 5*q^8 + 5*q^9 + O(q^10)
```


- The result above indicates that `Q` is not classically free:

```
    sage: f = R.arc_algebra_cover; f
    Ring morphism:
      From: Quotient of The classical limit of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_2^3,)
      To:   The classical limit of Quotient of The Virasoro vertex algebra of central charge 1/2 over Rational Field by the ideal generated by (L_-2L_-2L_-2|0> + 93/64*L_-3L_-3|0> - 33/8*L_-4L_-2|0> - 27/16*L_-6|0>,)
      Defn: L_2 |--> L_2
    sage: f.kernel(9)
    Free module generated by {0} over Rational Field
    sage: _.an_element().lift()
    2*L_4*L_3*L_2 + 1/3*L_5*L_2^2
```


## Random Comments

- This ticket fails one of the first //Guidelines for opening tickets//:
       "It is much better to open several specific tickets than one that is very broad. Indeed, a single ticket which deals with lots of different issues can be quite problematic, and should be avoided." 

I am happy to help breaking the ticket if this will facilitate reviewing it. But on the other hand if you look at the list of examples it is clear that most of the doctesting and examples will break. 

- The directory structure is quite independent. Besides a very minor touch to PartitionTuples and the reference manual, the code is contained in three files in categories and the directories algebras/{lie_conformal_algebras,vertex_algebras,poisson_vertex_algebras} and shouldn't affect the rest of the library. 

- I am no programmer and just started using Sage (and python for that matter) last year. I focused on having a mathematically correct code first and will go over implementation details and good programming conduct in the near future. 

- A recurrent theme is the following: one has an infinite dimensional graded module with finite dimensional pieces. One would want to construct infinite dimensional submodules and quotients of these. The code in modules.with_basis.subquotient is already in place, but it relies in having lists as basis in a few places, instead of allowing custom classes that can be iterable. I coded the skeleton of what I needed in VertexAlgebraIdeal/Quotient and PoissonVertexAlgebraIdeal/Quotient (didn't implement ideals for LCA) but it seems to me that similar code should be in place on modules.with_basis I haven't browsed the repository but I suppose this is a very common situation in many areas. 

- Poisson vertex algebras are in particular differential commutative algebras. In the non-super integrally graded case I can convert to polynomial algebras and use the machinery of Groebner bases and such. Is there something like this implemented for exterior algebras? I also couldn't find anything like affine arc schemes or affine jet schemes in Sage, to hook the ring structure of non-super Poisson vertex algebras and their quotients

## Immediate Goals
- Better implementation of arithmetic, I'll move to Cython the main element methods responsible for arithmetic. But I am afraid that it may be a flaw of my design: computations in vertex algebra quotients are too expensive, and it get's worse in their classical limits. This is true even in very simple cases like the Ising model above. I am convinced that this is a problem with my ineptitude and I am hoping that some of the skillful programmers here will speed this up.

- Implement morphisms and modules in the graded case: everything is in place and this should not be hard: same as for the two main cases that I worked here, Verma and quotients should go in the same way. 

## What is not implemented

- Lattice vertex algebras

- Coset models

These require other techniques. 


## What is obviously wrong

I suppose I'll start adding things to this list shortly, but some things are now clearly wrong:

- Printing of elements. A typical element of the Virasoro Vertex 
  algebra now is printed as 

  {{{
  3*L_-3L_-3L_-2|0> -2*L_-2|0>
  }}}

  I couldn't think of a better way to write them. and this is not 
  that bad. But when you go to rational gradings, say the N=1 super 
  vertex algebra, you start seeing things like

  {{{
  3*G_-3/2|0>
  }}}

  Still not entirely awful as there can't be any confusion (as far 
  as I can see). The worst situation is the Poisson case where 
  that would render

  {{{
  3*G_3/2
  }}}
  And that /2 is quite bad. It is not ambiguous with 
  {{{
  3/2*G_3
  }}}
  But is ugly. Still I couldn't find anything better. 
- Speed: the biggest problem in computing on quotients and on their 
  classical limits is the test that an element is in the ideal. 
  There is no analog to _divides_ in commutative rings. Currently 
  what I am doing is to compute every element of the algebra acting on the generators of the ideal so that many vectors are counted several times due to relations. This I think is the bottleneck and surely can be improved. 

CC:  @tscrim @heluani @dwbump

Keywords: vertex algebras, lie conformal algebras

Author: Reimundo Heluani

Branch: u/heluani/vertex_algebras

Dependencies: #30007, #30032, #30043

Commit: b578a357cc5bc5d124fd822c5ab436fb88b50884

Issue created by migration from https://trac.sagemath.org/ticket/29610





---

archive/issue_comments_416086.json:
```json
{
    "body": "<a id='comment:1'></a>The problem with such a huge ticket is that you will have even harder times to find a reviewer.\n\nSmall comment:\n\n```\n+EXAMPLES::\n+\n+- We construct the algebra of functions of the arc space of the *fat origin of\n+  the line* `\\mathbb{A}^1` over the rationals and compute it's graded\n+  dimension::\n```\nThis is not correct, only lines with indented content should end with ::\n\nMore generally you should build the doc and look at it.",
    "created_at": "2020-04-28T16:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416086",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>The problem with such a huge ticket is that you will have even harder times to find a reviewer.

Small comment:

```
+EXAMPLES::
+
+- We construct the algebra of functions of the arc space of the *fat origin of
+  the line* `\mathbb{A}^1` over the rationals and compute it's graded
+  dimension::
```
This is not correct, only lines with indented content should end with ::

More generally you should build the doc and look at it.



---

archive/issue_comments_416087.json:
```json
{
    "body": "Attachment [ticket.jpg](tarball://root/attachments/some-uuid/ticket29610/ticket.jpg) by @heluani created at 2020-04-28 17:16:14\n\nimage built doc",
    "created_at": "2020-04-28T17:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416087",
    "user": "https://github.com/heluani"
}
```

Attachment [ticket.jpg](tarball://root/attachments/some-uuid/ticket29610/ticket.jpg) by @heluani created at 2020-04-28 17:16:14

image built doc



---

archive/issue_comments_416088.json:
```json
{
    "body": "<a id='comment:2'></a>Thanks. Regarding the comment it looks good in my built copy of the doc (modulo the \"it's\" that should be \"its\"):\n![](ticket:29610:ticket.jpg)",
    "created_at": "2020-04-28T17:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416088",
    "user": "https://github.com/heluani"
}
```

<a id='comment:2'></a>Thanks. Regarding the comment it looks good in my built copy of the doc (modulo the "it's" that should be "its"):
![](ticket:29610:ticket.jpg)



---

archive/issue_events_075611.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-29T00:26:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75611"
}
```



---

archive/issue_comments_416089.json:
```json
{
    "body": "<a id='comment:4'></a>The suggestion from comment:1 must be followed, please.",
    "created_at": "2020-05-01T18:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416089",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>The suggestion from comment:1 must be followed, please.



---

archive/issue_comments_416090.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-06-22T19:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_416091.json:
```json
{
    "body": "<a id='comment:6'></a>I am very much interested in getting this into Sage, and it is a very good project.\n\nLike Fr\u00e9d\u00e9ric, I think it would be better if you can split this into at least a few separate tickets. For example, the basic framework that can handle generic data can go in one and then some of the more specific examples can in another (or at most one specific implementation if there is no generic data possible that you can use for your doctests).\n\nSomething else from a quick browse through your code, it looks like at this point your framework of ABCs for Lie conformal algebras is better to be lifted to the respective categories.\n\nI think another good thing to have is a catalog object as a common entry point for the different specific examples.",
    "created_at": "2020-06-22T23:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416091",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>I am very much interested in getting this into Sage, and it is a very good project.

Like Frédéric, I think it would be better if you can split this into at least a few separate tickets. For example, the basic framework that can handle generic data can go in one and then some of the more specific examples can in another (or at most one specific implementation if there is no generic data possible that you can use for your doctests).

Something else from a quick browse through your code, it looks like at this point your framework of ABCs for Lie conformal algebras is better to be lifted to the respective categories.

I think another good thing to have is a catalog object as a common entry point for the different specific examples.



---

archive/issue_comments_416092.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-25T20:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416093.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 tscrim]:\n> I am very much interested in getting this into Sage, and it is a very good project.\n> \n> Like Fr\u00e9d\u00e9ric, I think it would be better if you can split this into at least a few separate tickets. For example, the basic framework that can handle generic data can go in one and then some of the more specific examples can in another (or at most one specific implementation if there is no generic data possible that you can use for your doctests).\n> \n> Something else from a quick browse through your code, it looks like at this point your framework of ABCs for Lie conformal algebras is better to be lifted to the respective categories.\n> \n> I think another good thing to have is a catalog object as a common entry point for the different specific examples.\n\n\nThanks for the comments, I'll finish documenting what I have now, following Chapoton's comments on the documentation (I refactored the whole with basis thing to use CombinatorialFreeModules and added plenty of examples of super algebras) and then I'll ask for help into how to break this. I have some ideas, but they all lead to breakage of doctesting, which I put a lot of effort into having plenty of them. \n\nI should be ready to ask for reviewers in the next few days. I am happy with the functionality as it is now, the biggest problem is the speed of arithmetics when working with classical limits of quotients of vertex algebras. I will move the main computations to cython in a following ticket, but I am afraid that it may even be my choice of recursion instead of brutally computing commutators of Lie algebra modes.",
    "created_at": "2020-06-25T20:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416093",
    "user": "https://github.com/heluani"
}
```

<a id='comment:8'></a>Replying to [comment:6 tscrim]:
> I am very much interested in getting this into Sage, and it is a very good project.
> 
> Like Frédéric, I think it would be better if you can split this into at least a few separate tickets. For example, the basic framework that can handle generic data can go in one and then some of the more specific examples can in another (or at most one specific implementation if there is no generic data possible that you can use for your doctests).
> 
> Something else from a quick browse through your code, it looks like at this point your framework of ABCs for Lie conformal algebras is better to be lifted to the respective categories.
> 
> I think another good thing to have is a catalog object as a common entry point for the different specific examples.


Thanks for the comments, I'll finish documenting what I have now, following Chapoton's comments on the documentation (I refactored the whole with basis thing to use CombinatorialFreeModules and added plenty of examples of super algebras) and then I'll ask for help into how to break this. I have some ideas, but they all lead to breakage of doctesting, which I put a lot of effort into having plenty of them. 

I should be ready to ask for reviewers in the next few days. I am happy with the functionality as it is now, the biggest problem is the speed of arithmetics when working with classical limits of quotients of vertex algebras. I will move the main computations to cython in a following ticket, but I am afraid that it may even be my choice of recursion instead of brutally computing commutators of Lie algebra modes.



---

archive/issue_comments_416094.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-06-28T00:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_416095.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-28T01:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416095",
    "user": "https://github.com/heluani"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_416096.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:6 tscrim]:\n> I am very much interested in getting this into Sage, and it is a very good project.\n> \n\nHello I just posted the last of what I had n mind for a first draft and I am hoping to get some reviewers. I posted some views in sage-devel (which I suppose is better to discuss than trac) but I am happy to break this if this would help reviewers. \n\nBefore doing so I wanted to come back to some of your comments:\n\n> \n> Something else from a quick browse through your code, it looks like at this point your framework of ABCs for Lie conformal algebras is better to be lifted to the respective categories.\n\n\nI tried to put every method that was implementation independent in the category, is this what you mean? did I miss much?\n\n> \n> I think another good thing to have is a catalog object as a common entry point for the different specific examples.\n\n\nThis I don't know what you mean? I tried to copy your model on LieAlgebras where there's one exposed class that you call to construct any other object through it's __classcall_private__ method. These are LieConformalAlgebra, VertexAlgebra and PoissonVertexAlgebra respectively now. The first is essentially the same as you LieAlgebra: you feed it structure constants and it constructs something. Is this what you mean by catalog?",
    "created_at": "2020-06-28T01:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416096",
    "user": "https://github.com/heluani"
}
```

<a id='comment:12'></a>Replying to [comment:6 tscrim]:
> I am very much interested in getting this into Sage, and it is a very good project.
> 

Hello I just posted the last of what I had n mind for a first draft and I am hoping to get some reviewers. I posted some views in sage-devel (which I suppose is better to discuss than trac) but I am happy to break this if this would help reviewers. 

Before doing so I wanted to come back to some of your comments:

> 
> Something else from a quick browse through your code, it looks like at this point your framework of ABCs for Lie conformal algebras is better to be lifted to the respective categories.


I tried to put every method that was implementation independent in the category, is this what you mean? did I miss much?

> 
> I think another good thing to have is a catalog object as a common entry point for the different specific examples.


This I don't know what you mean? I tried to copy your model on LieAlgebras where there's one exposed class that you call to construct any other object through it's __classcall_private__ method. These are LieConformalAlgebra, VertexAlgebra and PoissonVertexAlgebra respectively now. The first is essentially the same as you LieAlgebra: you feed it structure constants and it constructs something. Is this what you mean by catalog?



---

archive/issue_comments_416097.json:
```json
{
    "body": "<a id='comment:13'></a>I would suggest to split out the changes to `src/sage/combinat/partition_tuple.py` to a separate ticket, but I would suspect that there is no point in trying to break the other things into many tickets.",
    "created_at": "2020-06-28T02:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416097",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>I would suggest to split out the changes to `src/sage/combinat/partition_tuple.py` to a separate ticket, but I would suspect that there is no point in trying to break the other things into many tickets.



---

archive/issue_comments_416098.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 mkoeppe]:\n> I would suggest to split out the changes to `src/sage/combinat/partition_tuple.py` to a separate ticket, but I would suspect that there is no point in trying to break the other things into many tickets. \n> \n\nAh thanks, I opened #30007",
    "created_at": "2020-06-28T10:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416098",
    "user": "https://github.com/heluani"
}
```

<a id='comment:14'></a>Replying to [comment:13 mkoeppe]:
> I would suggest to split out the changes to `src/sage/combinat/partition_tuple.py` to a separate ticket, but I would suspect that there is no point in trying to break the other things into many tickets. 
> 

Ah thanks, I opened #30007



---

archive/issue_comments_416099.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T23:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416099",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416100.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-30T02:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416100",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416101.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-30T18:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416101",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416102.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-30T18:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416103.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-06-30T20:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_416104.json:
```json
{
    "body": "<a id='comment:22'></a>Last 10 new commits:",
    "created_at": "2020-06-30T20:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416104",
    "user": "https://github.com/heluani"
}
```

<a id='comment:22'></a>Last 10 new commits:



---

archive/issue_comments_416105.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-01T00:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416106.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-07-02T01:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416106",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_416107.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-02T02:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416108.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-02T10:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416109.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-02T10:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416110.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-07-04T00:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_416111.json:
```json
{
    "body": "<a id='comment:31'></a>red branch => needs work",
    "created_at": "2020-08-14T12:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416111",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>red branch => needs work



---

archive/issue_comments_416112.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-14T12:48:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416112",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_416113.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-08-28T11:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_416114.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-28T12:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416114",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416115.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-28T12:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416115",
    "user": "https://github.com/heluani"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_416116.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-28T15:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416116",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416117.json:
```json
{
    "body": "<a id='comment:37'></a>On my bot it came back green, but on Linux/1_SMP_Debian_4.19.132-1_%282020-07-24%29/x86_64/4.19.0-10-amd64/tmonteil-lxc it comes back with failed tests, but those look like timeouts on other parts of Sage, perhaps the bot is low on resources? anyhow, I'll be reading the code for PEP changes and similar, but I assume the tests are alright.",
    "created_at": "2020-08-30T18:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416117",
    "user": "https://github.com/heluani"
}
```

<a id='comment:37'></a>On my bot it came back green, but on Linux/1_SMP_Debian_4.19.132-1_%282020-07-24%29/x86_64/4.19.0-10-amd64/tmonteil-lxc it comes back with failed tests, but those look like timeouts on other parts of Sage, perhaps the bot is low on resources? anyhow, I'll be reading the code for PEP changes and similar, but I assume the tests are alright.



---

archive/issue_comments_416118.json:
```json
{
    "body": "<a id='comment:38'></a>I wouldn't worry too much about those failing tests.\n\nI will try to get through this ticket soon, but I am not sure if I will get it done in time to get into 9.2...",
    "created_at": "2020-08-31T05:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416118",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>I wouldn't worry too much about those failing tests.

I will try to get through this ticket soon, but I am not sure if I will get it done in time to get into 9.2...



---

archive/issue_comments_416119.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:38 tscrim]:\n> I wouldn't worry too much about those failing tests.\n> \n> I will try to get through this ticket soon, but I am not sure if I will get it done in time to get into 9.2...\nThanks. Indeed I don't think this will get into 9.2. besides lots of places where I broke lines to stick to PEP8 and the coding formats that you corrected in #30032, there will be some contentious points. I'd pay attention to classes like `EnergyPartitionTuples` that are just wrappers around partition tuples and the classes like `VertexALgebraIdealBasis` that are just an infinite `EnumeratedSet` with some methods to allow to construct cokernels of maps of graded vector spaces. This seems to me like a recurring theme in representation theory that perhaps can be coded into `ModulesWithBasis`: you have a graded infinite dimensional vector space and it's graded infinite dimensional subspace. Supposing that the graded pieces are finite dimensional, the quotient should be easy to construct. These classes do that. Unfortunately, in many places in Sage, \"graded\" is assumed to be integrally graded. Similarly filtrations are assumed to be indexed by natural numbers. I needed rational gradings so I worked these classes particularly for my case-use instead of trying to add anything to `modules/with_bssis/subquotients`.",
    "created_at": "2020-08-31T09:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416119",
    "user": "https://github.com/heluani"
}
```

<a id='comment:39'></a>Replying to [comment:38 tscrim]:
> I wouldn't worry too much about those failing tests.
> 
> I will try to get through this ticket soon, but I am not sure if I will get it done in time to get into 9.2...
Thanks. Indeed I don't think this will get into 9.2. besides lots of places where I broke lines to stick to PEP8 and the coding formats that you corrected in #30032, there will be some contentious points. I'd pay attention to classes like `EnergyPartitionTuples` that are just wrappers around partition tuples and the classes like `VertexALgebraIdealBasis` that are just an infinite `EnumeratedSet` with some methods to allow to construct cokernels of maps of graded vector spaces. This seems to me like a recurring theme in representation theory that perhaps can be coded into `ModulesWithBasis`: you have a graded infinite dimensional vector space and it's graded infinite dimensional subspace. Supposing that the graded pieces are finite dimensional, the quotient should be easy to construct. These classes do that. Unfortunately, in many places in Sage, "graded" is assumed to be integrally graded. Similarly filtrations are assumed to be indexed by natural numbers. I needed rational gradings so I worked these classes particularly for my case-use instead of trying to add anything to `modules/with_bssis/subquotients`.



---

archive/issue_comments_416120.json:
```json
{
    "body": "<a id='comment:40'></a>Looking this over, I am again reminded that this is indeed quite a project. It will be great to have this in Sage. Here are my comments from a very quick first glance through everything.\n\nAvoid\n\n```diff\n-from sage.rings.all import ZZ\n+from sage.rings.integer_ring import ZZ\n```\nThe more specific import helps in preventing cyclic imports and deal with Sage's import hell.\n\nFor basis indices, such as `PoissonVertexAlgebraIdealBasis`, you should look at inheriting from `AbstractFamily` and/or `LazyFamily` as those already have a lot of the features you want. Perhaps you can even just use `Family` objects without any modification either. See `sage/sets/family.py`. This would help make things more uniform across Sage.\n\nFor, e.g., `PoissonVertexAlgebraIdealElement`, it seems like that is something that should be defined completely in the category using generic/default methods in the corresponding `Subobjects` (and/or `Quotients`) category.\n\nChanges like this:\n\n```diff\n-            if any([w not in QQ or w < 0 for w in weights]):\n-                raise NotImplementedError(\"hilbert_series is not \"\\\n-                                  \"implemented for {}\".format(self))\n+            if any(w not in QQ or w < 0 for w in weights):\n+                raise NotImplementedError(\"hilbert_series is not \"\n+                                  \"implemented for {}\".format(self))\n```\nThe inner list is not necessary (and in principle slower because of the extra transient object); IIRC it is good practice to not have the list. You don't need the trailing line continuation because of the parentheses; it makes the code a little cleaner and more robust. As another example:\n\n```diff\n-                f = sum(self.dimension_at_weight(n/l)*q**(n/l) for\\\n-                        n in range(ord))\n+                f = sum(self.dimension_at_weight(n/l) * q**(n/l)\n+                        for n in range(ord))\n```\n\n```diff\n-            if l==1:\n-                from sage.rings.power_series_ring import\\\n-                                                    PowerSeriesRing\n+            if l == 1:\n+                from sage.rings.power_series_ring import PowerSeriesRing\n```\nHere I will say both follow PEP8 and don't follow it so strictly as enforcing the 80 char/line limit makes the code harder to read IMO.\n\n`\\mathbb{Z}` -> `\\ZZ` for standardization within Sage's doc.\n\n```diff\n-The associated graded of `V` with respect to this filtration is a\n+The associated graded algebra of `V` with respect to this filtration is a\n```\n\nInstead of having documentation in the `__init__`, I think it is generally better to have it at the class level. That way in the `__init__` you can have more technical information that is not available to the end-user (and put `TestSuite(foo).run()` tests).\n\nError messages should start with a lowercase letter.\n\nI would Cythonize `vertex_algebra_element.py` since that will likely have some performance critical code that will benefit from the cythonization.\n\nAlso, code like \n\n```\ni1 = next((j for j,x in enumerate(a.index()) if x))\nn1 = a.index()[i1][0]\n```\nsuggests to me that it should become a method on `a` to get this information.\n\n```diff\n-if energy==None:\n+if energy is None:\n```\n\nThis comment\n\n```\n        #__mro__ picks Modules before VertexAlgebras.Quotients\n        return self.lift().is_even_odd()\n```\nmakes me think that there should be something added to the corresponding module quotient category. Although I find it a bit surprising that it does happen at all since the `VertexAlgebras.Quotients` category should be very early in the MRO...\n\nUsually we don't call objects \"The foo...\" but simply \"foo...\", e.g.:\n\n```\nsage: ZZ                                                                                                              \nInteger Ring\n```\n\nI like the name proto vertex algebras. I will have to use that for Lie algebras.\n\nYour `poisson_vertex_algebras.rst` is overindented.\n\nIn `GradedLCAElement.degree()`, I would move the import of infinity outside to optimize it. Also, this should be faster:\n\n```\n-if self.is_zero():\n+if not self:\n```",
    "created_at": "2020-09-13T02:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416120",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>Looking this over, I am again reminded that this is indeed quite a project. It will be great to have this in Sage. Here are my comments from a very quick first glance through everything.

Avoid

```diff
-from sage.rings.all import ZZ
+from sage.rings.integer_ring import ZZ
```
The more specific import helps in preventing cyclic imports and deal with Sage's import hell.

For basis indices, such as `PoissonVertexAlgebraIdealBasis`, you should look at inheriting from `AbstractFamily` and/or `LazyFamily` as those already have a lot of the features you want. Perhaps you can even just use `Family` objects without any modification either. See `sage/sets/family.py`. This would help make things more uniform across Sage.

For, e.g., `PoissonVertexAlgebraIdealElement`, it seems like that is something that should be defined completely in the category using generic/default methods in the corresponding `Subobjects` (and/or `Quotients`) category.

Changes like this:

```diff
-            if any([w not in QQ or w < 0 for w in weights]):
-                raise NotImplementedError("hilbert_series is not "\
-                                  "implemented for {}".format(self))
+            if any(w not in QQ or w < 0 for w in weights):
+                raise NotImplementedError("hilbert_series is not "
+                                  "implemented for {}".format(self))
```
The inner list is not necessary (and in principle slower because of the extra transient object); IIRC it is good practice to not have the list. You don't need the trailing line continuation because of the parentheses; it makes the code a little cleaner and more robust. As another example:

```diff
-                f = sum(self.dimension_at_weight(n/l)*q**(n/l) for\
-                        n in range(ord))
+                f = sum(self.dimension_at_weight(n/l) * q**(n/l)
+                        for n in range(ord))
```

```diff
-            if l==1:
-                from sage.rings.power_series_ring import\
-                                                    PowerSeriesRing
+            if l == 1:
+                from sage.rings.power_series_ring import PowerSeriesRing
```
Here I will say both follow PEP8 and don't follow it so strictly as enforcing the 80 char/line limit makes the code harder to read IMO.

`\mathbb{Z}` -> `\ZZ` for standardization within Sage's doc.

```diff
-The associated graded of `V` with respect to this filtration is a
+The associated graded algebra of `V` with respect to this filtration is a
```

Instead of having documentation in the `__init__`, I think it is generally better to have it at the class level. That way in the `__init__` you can have more technical information that is not available to the end-user (and put `TestSuite(foo).run()` tests).

Error messages should start with a lowercase letter.

I would Cythonize `vertex_algebra_element.py` since that will likely have some performance critical code that will benefit from the cythonization.

Also, code like 

```
i1 = next((j for j,x in enumerate(a.index()) if x))
n1 = a.index()[i1][0]
```
suggests to me that it should become a method on `a` to get this information.

```diff
-if energy==None:
+if energy is None:
```

This comment

```
        #__mro__ picks Modules before VertexAlgebras.Quotients
        return self.lift().is_even_odd()
```
makes me think that there should be something added to the corresponding module quotient category. Although I find it a bit surprising that it does happen at all since the `VertexAlgebras.Quotients` category should be very early in the MRO...

Usually we don't call objects "The foo..." but simply "foo...", e.g.:

```
sage: ZZ                                                                                                              
Integer Ring
```

I like the name proto vertex algebras. I will have to use that for Lie algebras.

Your `poisson_vertex_algebras.rst` is overindented.

In `GradedLCAElement.degree()`, I would move the import of infinity outside to optimize it. Also, this should be faster:

```
-if self.is_zero():
+if not self:
```



---

archive/issue_comments_416121.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:40 tscrim]:\n\nThanks a lot for this, I'll try to go over it during the next weeks, I'm a bit overwhelmed at the moment. I was planning though to submit a small ticket implementing the infinite dimensional Lie algebra associated to a LCA to give some functionality to 9.2 since the LCAs alone is nothing compared to this ticket. \n\n> I would Cythonize `vertex_algebra_element.py` since that will likely have some performance critical code that will benefit from the cythonization.\n> \n\n\nI already tried this and it became slower for the examples in the doctesting, and slightly faster in very large computations, but barely noticeable. I am not sure if this is the heavy use of list comprehension or the overhead of the category framework to call methods. This code is way slower, a lot slower than Thielemann's Mathematica Package from the nineties, and it uses the same algorithm to compute OPEs. What did help a little is some parallelization that I implemented for my own computations.",
    "created_at": "2020-09-13T09:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416121",
    "user": "https://github.com/heluani"
}
```

<a id='comment:41'></a>Replying to [comment:40 tscrim]:

Thanks a lot for this, I'll try to go over it during the next weeks, I'm a bit overwhelmed at the moment. I was planning though to submit a small ticket implementing the infinite dimensional Lie algebra associated to a LCA to give some functionality to 9.2 since the LCAs alone is nothing compared to this ticket. 

> I would Cythonize `vertex_algebra_element.py` since that will likely have some performance critical code that will benefit from the cythonization.
> 


I already tried this and it became slower for the examples in the doctesting, and slightly faster in very large computations, but barely noticeable. I am not sure if this is the heavy use of list comprehension or the overhead of the category framework to call methods. This code is way slower, a lot slower than Thielemann's Mathematica Package from the nineties, and it uses the same algorithm to compute OPEs. What did help a little is some parallelization that I implemented for my own computations.



---

archive/issue_comments_416122.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:41 heluani]:\n> Replying to [comment:40 tscrim]:\n> \n> Thanks a lot for this, I'll try to go over it during the next weeks, I'm a bit overwhelmed at the moment. I was planning though to submit a small ticket implementing the infinite dimensional Lie algebra associated to a LCA to give some functionality to 9.2 since the LCAs alone is nothing compared to this ticket. \n\n\nNo rush. Feel free to subdivide or do other small tickets too.\n\n> > I would Cythonize `vertex_algebra_element.py` since that will likely have some performance critical code that will benefit from the cythonization.\n> > \n\n> \n> I already tried this and it became slower for the examples in the doctesting, and slightly faster in very large computations, but barely noticeable. I am not sure if this is the heavy use of list comprehension or the overhead of the category framework to call methods. This code is way slower, a lot slower than Thielemann's Mathematica Package from the nineties, and it uses the same algorithm to compute OPEs. What did help a little is some parallelization that I implemented for my own computations.\n\n\nI will have to try this too. Can you give me what you are using to do the timings (more so for the smaller computations)?",
    "created_at": "2020-09-15T23:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416122",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>Replying to [comment:41 heluani]:
> Replying to [comment:40 tscrim]:
> 
> Thanks a lot for this, I'll try to go over it during the next weeks, I'm a bit overwhelmed at the moment. I was planning though to submit a small ticket implementing the infinite dimensional Lie algebra associated to a LCA to give some functionality to 9.2 since the LCAs alone is nothing compared to this ticket. 


No rush. Feel free to subdivide or do other small tickets too.

> > I would Cythonize `vertex_algebra_element.py` since that will likely have some performance critical code that will benefit from the cythonization.
> > 

> 
> I already tried this and it became slower for the examples in the doctesting, and slightly faster in very large computations, but barely noticeable. I am not sure if this is the heavy use of list comprehension or the overhead of the category framework to call methods. This code is way slower, a lot slower than Thielemann's Mathematica Package from the nineties, and it uses the same algorithm to compute OPEs. What did help a little is some parallelization that I implemented for my own computations.


I will have to try this too. Can you give me what you are using to do the timings (more so for the smaller computations)?



---

archive/issue_events_075612.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75612"
}
```



---

archive/issue_events_075613.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75613"
}
```



---

archive/issue_comments_416123.json:
```json
{
    "body": "<a id='comment:44'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416123",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_075614.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75614"
}
```



---

archive/issue_events_075615.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75615"
}
```



---

archive/issue_comments_416124.json:
```json
{
    "body": "<a id='comment:45'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416124",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_075616.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75616"
}
```



---

archive/issue_events_075617.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75617"
}
```



---

archive/issue_comments_416125.json:
```json
{
    "body": "<a id='comment:46'></a>red branch => needs work",
    "created_at": "2021-10-05T11:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416125",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:46'></a>red branch => needs work



---

archive/issue_comments_416126.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-10-05T11:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29610#issuecomment-416126",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_075618.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75618"
}
```



---

archive/issue_events_075619.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75619"
}
```



---

archive/issue_events_075620.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75620"
}
```



---

archive/issue_events_075621.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75621"
}
```



---

archive/issue_events_075622.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75622"
}
```



---

archive/issue_events_075623.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29610",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29610#event-75623"
}
```
