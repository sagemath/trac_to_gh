# Issue 29676: Make a nogil version of the most important methods of FaceIterator.

archive/issues_029439.json:
```json
{
    "body": "We outsource 3 crucial methods of `FaceIterator` to nogil functions.\n\nThis is part of #28893: Parallel f-vector for polyhedra.\n\nAnything happening within `prange` should be without gil. Any function that is called in the parallel section needs to be nogil.\n\nCC:  @jplab @laisrast @tscrim\n\nKeywords: polytopes, f-vector\n\nBranch/Commit: 81372b652d2dd92c87b80a0795bb276e49c67985\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jonathan Kliem\n\nDependencies: #28894, #29654\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29676\n\n",
    "closed_at": "2020-09-01T23:00:09Z",
    "created_at": "2020-05-11T13:23:27Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Make a nogil version of the most important methods of FaceIterator.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29676",
    "user": "https://github.com/kliem"
}
```
We outsource 3 crucial methods of `FaceIterator` to nogil functions.

This is part of #28893: Parallel f-vector for polyhedra.

Anything happening within `prange` should be without gil. Any function that is called in the parallel section needs to be nogil.

CC:  @jplab @laisrast @tscrim

Keywords: polytopes, f-vector

Branch/Commit: 81372b652d2dd92c87b80a0795bb276e49c67985

Reviewer: Travis Scrimshaw

Author: Jonathan Kliem

Dependencies: #28894, #29654

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29676





---

archive/issue_comments_580932.json:
```json
{
    "body": "Changing branch from \"\" to \"public/29676\"",
    "created_at": "2020-05-11T13:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580932",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/29676"



---

archive/issue_comments_580933.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Kliem\"",
    "created_at": "2020-05-11T13:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580933",
    "user": "https://github.com/kliem"
}
```

Changing author from "" to "Jonathan Kliem"



---

archive/issue_comments_580934.json:
```json
{
    "body": "Changing commit from \"\" to \"c6fe6d4578c25aaa3e465f8c74b1c500ff5d6946\"",
    "created_at": "2020-05-11T13:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580934",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "c6fe6d4578c25aaa3e465f8c74b1c500ff5d6946"



---

archive/issue_comments_580935.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-11T13:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580935",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_580936.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[0c44221](https://git.sagemath.org/sage.git/commit?id=0c4422166073cd5904d41b3bbc34c2b98f7a4908)|`important attributes of iterator in structure`|\n|[efb0bd3](https://git.sagemath.org/sage.git/commit?id=efb0bd306ca33d11ba4096ed96d5d3d8303cc042)|`src/simplification of doctests`|\n|[53fd2a2](https://git.sagemath.org/sage.git/commit?id=53fd2a22dc05f93949b8390a5d24aae12eca1e06)|`fixed failing doctest`|\n|[c6fe6d4](https://git.sagemath.org/sage.git/commit?id=c6fe6d4578c25aaa3e465f8c74b1c500ff5d6946)|`make nogil function of crucial methods in FaceIterator`|",
    "created_at": "2020-05-11T13:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580936",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[0c44221](https://git.sagemath.org/sage.git/commit?id=0c4422166073cd5904d41b3bbc34c2b98f7a4908)|`important attributes of iterator in structure`|
|[efb0bd3](https://git.sagemath.org/sage.git/commit?id=efb0bd306ca33d11ba4096ed96d5d3d8303cc042)|`src/simplification of doctests`|
|[53fd2a2](https://git.sagemath.org/sage.git/commit?id=53fd2a22dc05f93949b8390a5d24aae12eca1e06)|`fixed failing doctest`|
|[c6fe6d4](https://git.sagemath.org/sage.git/commit?id=c6fe6d4578c25aaa3e465f8c74b1c500ff5d6946)|`make nogil function of crucial methods in FaceIterator`|



---

archive/issue_comments_580937.json:
```json
{
    "body": "<a id='comment:2'></a>\nCould you extend a little bit in the description on what this does?",
    "created_at": "2020-05-12T11:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580937",
    "user": "https://github.com/jplab"
}
```

<a id='comment:2'></a>
Could you extend a little bit in the description on what this does?



---

archive/issue_comments_580938.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n We outsource 3 crucial methods of `FaceIterator` to nogil functions.\n \n This is part of #28893: Parallel f-vector for polyhedra.\n+\n+Anything happening within `prange` should be without gil. Any function that is called in the parallel section needs to be nogil.\n``````\n",
    "created_at": "2020-05-12T12:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580938",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 We outsource 3 crucial methods of `FaceIterator` to nogil functions.
 
 This is part of #28893: Parallel f-vector for polyhedra.
+
+Anything happening within `prange` should be without gil. Any function that is called in the parallel section needs to be nogil.
``````




---

archive/issue_events_075881.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-17T18:33:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29676#event-75881"
}
```



---

archive/issue_comments_580939.json:
```json
{
    "body": "<a id='comment:6'></a>\nShouldn't you also make the corresponding changes/additions to the `pxd` file?",
    "created_at": "2020-08-11T22:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580939",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Shouldn't you also make the corresponding changes/additions to the `pxd` file?



---

archive/issue_comments_580940.json:
```json
{
    "body": "Changing commit from \"c6fe6d4578c25aaa3e465f8c74b1c500ff5d6946\" to \"81f43ea7f37111b5a920d51340cf0a65ba4dab4b\"",
    "created_at": "2020-08-12T05:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580940",
    "user": "https://github.com/kliem"
}
```

Changing commit from "c6fe6d4578c25aaa3e465f8c74b1c500ff5d6946" to "81f43ea7f37111b5a920d51340cf0a65ba4dab4b"



---

archive/issue_comments_580941.json:
```json
{
    "body": "Changing branch from \"public/29676\" to \"public/29676-reb\"",
    "created_at": "2020-08-12T05:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580941",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29676" to "public/29676-reb"



---

archive/issue_comments_580942.json:
```json
{
    "body": "<a id='comment:7'></a>\nNew commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[9045767](https://git.sagemath.org/sage.git/commit?id=9045767d085a52c65b9d078149c5698e51735e84)|`make nogil function of crucial methods in FaceIterator`|\n|[81f43ea](https://git.sagemath.org/sage.git/commit?id=81f43ea7f37111b5a920d51340cf0a65ba4dab4b)|`expose nogil functions in header`|",
    "created_at": "2020-08-12T05:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580942",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>
New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[9045767](https://git.sagemath.org/sage.git/commit?id=9045767d085a52c65b9d078149c5698e51735e84)|`make nogil function of crucial methods in FaceIterator`|
|[81f43ea](https://git.sagemath.org/sage.git/commit?id=81f43ea7f37111b5a920d51340cf0a65ba4dab4b)|`expose nogil functions in header`|



---

archive/issue_comments_580943.json:
```json
{
    "body": "Changing dependencies from \"#28894\" to \"#28894, #29654\"",
    "created_at": "2020-08-12T12:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580943",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "#28894" to "#28894, #29654"



---

archive/issue_comments_580944.json:
```json
{
    "body": "Changing commit from \"81f43ea7f37111b5a920d51340cf0a65ba4dab4b\" to \"\"",
    "created_at": "2020-08-12T12:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580944",
    "user": "https://github.com/kliem"
}
```

Changing commit from "81f43ea7f37111b5a920d51340cf0a65ba4dab4b" to ""



---

archive/issue_comments_580945.json:
```json
{
    "body": "<a id='comment:8'></a>\nMerge conflict.",
    "created_at": "2020-08-12T12:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580945",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>
Merge conflict.



---

archive/issue_comments_580946.json:
```json
{
    "body": "Changing branch from \"public/29676-reb\" to \"public/29676-reb2\"",
    "created_at": "2020-08-12T12:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580946",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29676-reb" to "public/29676-reb2"



---

archive/issue_comments_580947.json:
```json
{
    "body": "Changing commit from \"\" to \"81372b652d2dd92c87b80a0795bb276e49c67985\"",
    "created_at": "2020-08-12T12:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580947",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "81372b652d2dd92c87b80a0795bb276e49c67985"



---

archive/issue_comments_580948.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[a6d2b2d](https://git.sagemath.org/sage.git/commit/?id=a6d2b2dacde8dcf23d0f9bb32cfd226ff6fd3916)|`a face iterator subclass that yield PolyhedronFace`|\n|[1476675](https://git.sagemath.org/sage.git/commit/?id=147667529fa83d04bdd3998690ab7c371b40acb0)|`representation like Polyhedron_base`|\n|[47fc7cd](https://git.sagemath.org/sage.git/commit/?id=47fc7cd4bff0604a010ff44a5474745577697606)|`account for FaceIterator -> FaceIterator_base`|\n|[295039a](https://git.sagemath.org/sage.git/commit/?id=295039a4f2b39c70277a77d0df69bfe15caa98fd)|`documentation`|\n|[d36da4a](https://git.sagemath.org/sage.git/commit/?id=d36da4a262a2e02686bc0f966a6fb005a10c98f9)|`coverage and small improvement`|\n|[3f92d2d](https://git.sagemath.org/sage.git/commit/?id=3f92d2d85ae64d18024e8a49c2c9f9b7699a44a4)|`fixed merge conflict`|\n|[3ba34fd](https://git.sagemath.org/sage.git/commit/?id=3ba34fd622d33f8430a09e7c943a40ed1c805e56)|`move documenation to exposed class`|\n|[109d60f](https://git.sagemath.org/sage.git/commit/?id=109d60ff7a27c1cbc2357ee87905ebc34cacc5ae)|`make nogil function of crucial methods in FaceIterator`|\n|[ddd4687](https://git.sagemath.org/sage.git/commit/?id=ddd468702a9262d41ec3dbc0c145f1b087eb72bd)|`expose nogil functions in header`|\n|[81372b6](https://git.sagemath.org/sage.git/commit/?id=81372b652d2dd92c87b80a0795bb276e49c67985)|`Merge branch 'develop' of git://trac.sagemath.org/sage into public/29676-reb2`|",
    "created_at": "2020-08-12T12:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580948",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[a6d2b2d](https://git.sagemath.org/sage.git/commit/?id=a6d2b2dacde8dcf23d0f9bb32cfd226ff6fd3916)|`a face iterator subclass that yield PolyhedronFace`|
|[1476675](https://git.sagemath.org/sage.git/commit/?id=147667529fa83d04bdd3998690ab7c371b40acb0)|`representation like Polyhedron_base`|
|[47fc7cd](https://git.sagemath.org/sage.git/commit/?id=47fc7cd4bff0604a010ff44a5474745577697606)|`account for FaceIterator -> FaceIterator_base`|
|[295039a](https://git.sagemath.org/sage.git/commit/?id=295039a4f2b39c70277a77d0df69bfe15caa98fd)|`documentation`|
|[d36da4a](https://git.sagemath.org/sage.git/commit/?id=d36da4a262a2e02686bc0f966a6fb005a10c98f9)|`coverage and small improvement`|
|[3f92d2d](https://git.sagemath.org/sage.git/commit/?id=3f92d2d85ae64d18024e8a49c2c9f9b7699a44a4)|`fixed merge conflict`|
|[3ba34fd](https://git.sagemath.org/sage.git/commit/?id=3ba34fd622d33f8430a09e7c943a40ed1c805e56)|`move documenation to exposed class`|
|[109d60f](https://git.sagemath.org/sage.git/commit/?id=109d60ff7a27c1cbc2357ee87905ebc34cacc5ae)|`make nogil function of crucial methods in FaceIterator`|
|[ddd4687](https://git.sagemath.org/sage.git/commit/?id=ddd468702a9262d41ec3dbc0c145f1b087eb72bd)|`expose nogil functions in header`|
|[81372b6](https://git.sagemath.org/sage.git/commit/?id=81372b652d2dd92c87b80a0795bb276e49c67985)|`Merge branch 'develop' of git://trac.sagemath.org/sage into public/29676-reb2`|



---

archive/issue_comments_580949.json:
```json
{
    "body": "<a id='comment:10'></a>\nLGTM.",
    "created_at": "2020-08-30T04:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580949",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
LGTM.



---

archive/issue_comments_580950.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2020-08-30T04:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580950",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_580951.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-30T04:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580951",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_580952.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks.",
    "created_at": "2020-08-30T05:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580952",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'></a>
Thanks.



---

archive/issue_events_075882.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-01T23:00:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29676#event-75882"
}
```



---

archive/issue_comments_580953.json:
```json
{
    "body": "Changing branch from \"public/29676-reb2\" to \"81372b652d2dd92c87b80a0795bb276e49c67985\"",
    "created_at": "2020-09-01T23:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580953",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/29676-reb2" to "81372b652d2dd92c87b80a0795bb276e49c67985"



---

archive/issue_comments_580954.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-01T23:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29676#issuecomment-580954",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
