# Issue 29177: Make echelon_form(transformation=True) return transformation matrix

archive/issues_028940.json:
```json
{
    "body": "Contrary to user expectation, we get:\n\n```\nsage: m = matrix(GF(5), 3, [1,2,3,4,5,6,7,8,9])\nsage: m\n[1 2 3]\n[4 0 1]\n[2 3 4]\nsage: m.echelon_form(transformation=True)\n[1 0 4]\n[0 1 2]\n[0 0 0]\nsage: m = matrix(QQ, 3, [1,2,3,4,5,6,7,8,9])\nsage: m.echelon_form(transformation=True)\n[ 1  0 -1]\n[ 0  1  2]\n[ 0  0  0]\n```\nNo transformation matrix is returned. The docstring of echelon_form() says\n\n* \"transformation\" -- boolean. Whether to also return the\n  transformation matrix. Some matrix backends do not provide this\n  information, in which case this option is ignored.\n\nSo the default backends does not produce a transformation matrix!\n\nIn fact, the \"transformation\" option is **rarely** supported. \n\n\n\nCC:  @slel\n\nIssue created by migration from https://trac.sagemath.org/ticket/29177\n\n",
    "created_at": "2020-02-11T00:38:16Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Make echelon_form(transformation=True) return transformation matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29177",
    "user": "https://github.com/kwankyu"
}
```
Contrary to user expectation, we get:

```
sage: m = matrix(GF(5), 3, [1,2,3,4,5,6,7,8,9])
sage: m
[1 2 3]
[4 0 1]
[2 3 4]
sage: m.echelon_form(transformation=True)
[1 0 4]
[0 1 2]
[0 0 0]
sage: m = matrix(QQ, 3, [1,2,3,4,5,6,7,8,9])
sage: m.echelon_form(transformation=True)
[ 1  0 -1]
[ 0  1  2]
[ 0  0  0]
```
No transformation matrix is returned. The docstring of echelon_form() says

* "transformation" -- boolean. Whether to also return the
  transformation matrix. Some matrix backends do not provide this
  information, in which case this option is ignored.

So the default backends does not produce a transformation matrix!

In fact, the "transformation" option is **rarely** supported. 



CC:  @slel

Issue created by migration from https://trac.sagemath.org/ticket/29177





---

archive/issue_comments_409266.json:
```json
{
    "body": "<a id='comment:1'></a>As remarked before, if one augments the matrix on the right with an identity matrix, then that keeps track of the row operations and hence the transformation matrix. A default strategy to get the transformation matrix is to do this augmentation trick. You can override this with other tracking strategies for backends that support it. It's probably worth doing some timings to see what the penalty of this augmentation is. I suspect that it's going to be better to use a good backend and augment than to switch to a backend that produces the transformation matrix via other means.",
    "created_at": "2020-02-11T01:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409266",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:1'></a>As remarked before, if one augments the matrix on the right with an identity matrix, then that keeps track of the row operations and hence the transformation matrix. A default strategy to get the transformation matrix is to do this augmentation trick. You can override this with other tracking strategies for backends that support it. It's probably worth doing some timings to see what the penalty of this augmentation is. I suspect that it's going to be better to use a good backend and augment than to switch to a backend that produces the transformation matrix via other means.



---

archive/issue_comments_409267.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 nbruin]:\n>  I suspect that it's going to be better to use a good backend and augment than to switch to a backend that produces the transformation matrix via other means.\n\n\nI agree. So we can make backend choice independent from `transformation=True`.",
    "created_at": "2020-02-11T01:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409267",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:2'></a>Replying to [comment:1 nbruin]:
>  I suspect that it's going to be better to use a good backend and augment than to switch to a backend that produces the transformation matrix via other means.


I agree. So we can make backend choice independent from `transformation=True`.



---

archive/issue_comments_409268.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 klee]:\n> I agree. So we can make backend choice independent from `transformation=True`.\n\nWell ... it means that if `backend=auto` (or whatever the default option is), a good choice for the base ring should be made that takes into account the value of `transformation`.",
    "created_at": "2020-02-11T02:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409268",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:3'></a>Replying to [comment:2 klee]:
> I agree. So we can make backend choice independent from `transformation=True`.

Well ... it means that if `backend=auto` (or whatever the default option is), a good choice for the base ring should be made that takes into account the value of `transformation`.



---

archive/issue_comments_409269.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 nbruin]:\n> Replying to [comment:2 klee]:\n> > I agree. So we can make backend choice independent from `transformation=True`.\n\n> Well ... it means that if `backend=auto` (or whatever the default option is), a good choice for the base ring should be made that takes into account the value of `transformation`.\n\nI tried to early detect whether a backend supports transformation matrix. Each backend that does not compute tansformation matrix may raise an exception when given the `transformation=True` argument. If such an exception is raised, then we resort to the default strategy using`extended_echelon_form()` method. But this would add overhead of not much worth to each backend...",
    "created_at": "2020-02-11T05:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409269",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:4'></a>Replying to [comment:3 nbruin]:
> Replying to [comment:2 klee]:
> > I agree. So we can make backend choice independent from `transformation=True`.

> Well ... it means that if `backend=auto` (or whatever the default option is), a good choice for the base ring should be made that takes into account the value of `transformation`.

I tried to early detect whether a backend supports transformation matrix. Each backend that does not compute tansformation matrix may raise an exception when given the `transformation=True` argument. If such an exception is raised, then we resort to the default strategy using`extended_echelon_form()` method. But this would add overhead of not much worth to each backend...



---

archive/issue_comments_409270.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 klee]:\n> I tried to early detect whether a backend supports transformation matrix. Each backend that does not compute tansformation matrix may raise an exception when given the `transformation=True` argument. If such an exception is raised, then we resort to the default strategy using`extended_echelon_form()` method. But this would add overhead of not much worth to each backend...\n\n\nIt looks to me that this routine gets overridden on a lot of matrix classes, in which the various backends (or \"algorithms\") are implemented case-by-case. For instance, the one on integer matrices seems to cast an error for certain algorithms if transformation matrix is not specified.\n\nGiven that the minimal interface seems to be that transformation matrices are *not* supported, I guess the \"generic\" routine could just do this by augmenting. You'll have to go through all the special cases anyway, and since the backends are explicitly known there, you can just tune for each if augmentation or asking for a transformation matrix is the right thing to do.",
    "created_at": "2020-02-11T23:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409270",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:5'></a>Replying to [comment:4 klee]:
> I tried to early detect whether a backend supports transformation matrix. Each backend that does not compute tansformation matrix may raise an exception when given the `transformation=True` argument. If such an exception is raised, then we resort to the default strategy using`extended_echelon_form()` method. But this would add overhead of not much worth to each backend...


It looks to me that this routine gets overridden on a lot of matrix classes, in which the various backends (or "algorithms") are implemented case-by-case. For instance, the one on integer matrices seems to cast an error for certain algorithms if transformation matrix is not specified.

Given that the minimal interface seems to be that transformation matrices are *not* supported, I guess the "generic" routine could just do this by augmenting. You'll have to go through all the special cases anyway, and since the backends are explicitly known there, you can just tune for each if augmentation or asking for a transformation matrix is the right thing to do.



---

archive/issue_comments_409271.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 nbruin]:\n> It looks to me that this routine gets overridden on a lot of matrix classes, in which the various backends (or \"algorithms\") are implemented case-by-case. For instance, the one on integer matrices seems to cast an error for certain algorithms if transformation matrix is not specified.\n\n\nRight.\n\n> Given that the minimal interface seems to be that transformation matrices are *not* supported, I guess the \"generic\" routine could just do this by augmenting. You'll have to go through all the special cases anyway, and since the backends are explicitly known there, you can just tune for each if augmentation or asking for a transformation matrix is the right thing to do.\n\n\nI looked through all `echelon_form()` definitions in \n\n- `matrix_gf2e_dense`\n- `matrix_mod2_dense`\n- `matrix_modn_dense_template`\n- `matrix_cyclo_dense`\n- `matrix_integer_dense`\n- `matrix_mpolynomial_dense`\n- `matrix_rational_dense`\n- `matrix_rational_sparse`\n\nMy conclusion is that `echelon_form()` basically does not support `transformation` option, except matrices over `ZZ` and uncommon rings.\n\nSo I decided to just clarify the misleading docstring.",
    "created_at": "2020-02-12T06:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409271",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:6'></a>Replying to [comment:5 nbruin]:
> It looks to me that this routine gets overridden on a lot of matrix classes, in which the various backends (or "algorithms") are implemented case-by-case. For instance, the one on integer matrices seems to cast an error for certain algorithms if transformation matrix is not specified.


Right.

> Given that the minimal interface seems to be that transformation matrices are *not* supported, I guess the "generic" routine could just do this by augmenting. You'll have to go through all the special cases anyway, and since the backends are explicitly known there, you can just tune for each if augmentation or asking for a transformation matrix is the right thing to do.


I looked through all `echelon_form()` definitions in 

- `matrix_gf2e_dense`
- `matrix_mod2_dense`
- `matrix_modn_dense_template`
- `matrix_cyclo_dense`
- `matrix_integer_dense`
- `matrix_mpolynomial_dense`
- `matrix_rational_dense`
- `matrix_rational_sparse`

My conclusion is that `echelon_form()` basically does not support `transformation` option, except matrices over `ZZ` and uncommon rings.

So I decided to just clarify the misleading docstring.



---

archive/issue_comments_409272.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-12T06:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_409273.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-12T06:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409273",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_409274.json:
```json
{
    "body": "<a id='comment:12'></a>For your information:\n\n|         |                    |                     |\n|---------|--------------------|---------------------|\n| module  | has echelonize()?  | has echelon_form()? |\n|matrix2  | O| O|\n|matrix_gf2e_dense | O| X|\n|matrix_mod2_dense | O| X|\n|matrix_modn_dense_template | O| X|\n|matrix_cyclo_dense | X| O| \n|matrix_integer_dense | X| O|\n|matrix_mpolynomial_dense | O| O|\n|matrix_rational_dense | O| O|\n|matrix_rational_sparse | O| O|\n`matrix2` support `echelon_form(transformation=True)` for matrices over non-field rings.\n\n`matrix_integer_dense` support `echelon_form(transformation=True)`for flint and padic backends.",
    "created_at": "2020-02-13T00:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409274",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:12'></a>For your information:

|         |                    |                     |
|---------|--------------------|---------------------|
| module  | has echelonize()?  | has echelon_form()? |
|matrix2  | O| O|
|matrix_gf2e_dense | O| X|
|matrix_mod2_dense | O| X|
|matrix_modn_dense_template | O| X|
|matrix_cyclo_dense | X| O| 
|matrix_integer_dense | X| O|
|matrix_mpolynomial_dense | O| O|
|matrix_rational_dense | O| O|
|matrix_rational_sparse | O| O|
`matrix2` support `echelon_form(transformation=True)` for matrices over non-field rings.

`matrix_integer_dense` support `echelon_form(transformation=True)`for flint and padic backends.



---

archive/issue_comments_409275.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-02-13T00:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409275",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_409276.json:
```json
{
    "body": "<a id='comment:13'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409276",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_074094.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74094"
}
```



---

archive/issue_events_074095.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74095"
}
```



---

archive/issue_events_074096.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74096"
}
```



---

archive/issue_comments_409277.json:
```json
{
    "body": "<a id='comment:15'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409277",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_074097.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74097"
}
```



---

archive/issue_events_074098.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74098"
}
```



---

archive/issue_comments_409278.json:
```json
{
    "body": "<a id='comment:16'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29177#issuecomment-409278",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_074099.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74099"
}
```



---

archive/issue_events_074100.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74100"
}
```



---

archive/issue_events_074101.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74101"
}
```



---

archive/issue_events_074102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74102"
}
```



---

archive/issue_events_074103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74103"
}
```



---

archive/issue_events_074104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74104"
}
```



---

archive/issue_events_074105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74105"
}
```



---

archive/issue_events_074106.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29177",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29177#event-74106"
}
```
