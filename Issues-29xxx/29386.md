# Issue 29386: Install script and pip packages via sage-spkg

archive/issues_029149.json:
```json
{
    "body": "Follow-up from #29287.\n\nScript packages are installed by special rules in `build/make/Makefile`.\n\nThis ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.\n\nThis is useful for #29387 to clean up #27870/#29003/#29082, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.\n\nWe also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.\nWe simply generate `spkg-install` if `spkg-install.in` is present.\n\nIdeally, when done, changing a package's source between script and normal and pip will no longer require running `bootstrap`.\n\n\nCC:  @dimpase @jhpalmieri @embray @orlitzky\n\nWork_Issues: Move \"dummy script package\" code to sage-spkg\n\nAuthor: Matthias Koeppe\n\nBranch: u/mkoeppe/install_script_packages_via_sage_spkg\n\nStatus: new\n\nCommit: 7a25d1d0b74cf7fe7b29b0169ba2539b323ae04a\n\nIssue created by migration from https://trac.sagemath.org/ticket/29386\n\n",
    "created_at": "2020-03-21T13:06:08Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Install script and pip packages via sage-spkg",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29386",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #29287.

Script packages are installed by special rules in `build/make/Makefile`.

This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.

This is useful for #29387 to clean up #27870/#29003/#29082, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.

We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.
We simply generate `spkg-install` if `spkg-install.in` is present.

Ideally, when done, changing a package's source between script and normal and pip will no longer require running `bootstrap`.


CC:  @dimpase @jhpalmieri @embray @orlitzky

Work_Issues: Move "dummy script package" code to sage-spkg

Author: Matthias Koeppe

Branch: u/mkoeppe/install_script_packages_via_sage_spkg

Status: new

Commit: 7a25d1d0b74cf7fe7b29b0169ba2539b323ae04a

Issue created by migration from https://trac.sagemath.org/ticket/29386





---

archive/issue_comments_573386.json:
```json
{
    "body": "<a id='comment:1'></a>pushing these forward to 9.2",
    "created_at": "2020-04-14T06:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573386",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>pushing these forward to 9.2



---

archive/issue_events_074873.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T06:33:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74873"
}
```



---

archive/issue_comments_573387.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29793\"",
    "created_at": "2020-06-04T17:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573387",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29793"



---

archive/issue_comments_573388.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,11 @@\n \n This is useful for #29082... to clean up #27870/#29003, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.\n \n+\n+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.\n+\n+\n+\n Comment: 1\n \n Summary: Install script packages via sage-spkg\n``````\n",
    "created_at": "2020-06-12T22:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573388",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,11 @@
 
 This is useful for #29082... to clean up #27870/#29003, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.
 
+
+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.
+
+
+
 Comment: 1
 
 Summary: Install script packages via sage-spkg
``````




---

archive/issue_events_074874.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74874"
}
```



---

archive/issue_events_074875.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74875"
}
```



---

archive/issue_comments_573389.json:
```json
{
    "body": "<a id='comment:6'></a>+1 this would be a very nice improvement.",
    "created_at": "2020-09-02T09:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573389",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>+1 this would be a very nice improvement.



---

archive/issue_comments_573390.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/install_script_packages_via_sage_spkg\"",
    "created_at": "2020-09-24T21:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573390",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/install_script_packages_via_sage_spkg"



---

archive/issue_comments_573391.json:
```json
{
    "body": "<a id='comment:8'></a>New commits:",
    "created_at": "2020-09-24T22:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573391",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>New commits:



---

archive/issue_comments_573392.json:
```json
{
    "body": "Changing commit from \"\" to \"fee5bc2c04387745dbb9b8265ec13be7bcd434e1\"",
    "created_at": "2020-09-24T22:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573392",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "fee5bc2c04387745dbb9b8265ec13be7bcd434e1"



---

archive/issue_comments_573393.json:
```json
{
    "body": "Changing dependencies from \"#29793\" to \"#29793, #30657\"",
    "created_at": "2020-09-24T22:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573393",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29793" to "#29793, #30657"



---

archive/issue_comments_573394.json:
```json
{
    "body": "Changing commit from \"fee5bc2c04387745dbb9b8265ec13be7bcd434e1\" to \"e4c27f6f307c06d6a1c9fc368cb72a461e4c6b20\"",
    "created_at": "2020-09-24T22:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fee5bc2c04387745dbb9b8265ec13be7bcd434e1" to "e4c27f6f307c06d6a1c9fc368cb72a461e4c6b20"



---

archive/issue_comments_573395.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-09-24T22:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573395",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_573396.json:
```json
{
    "body": "Changing commit from \"e4c27f6f307c06d6a1c9fc368cb72a461e4c6b20\" to \"81a63df3107793d067f1bd5a9807bfff8c0cd054\"",
    "created_at": "2020-09-24T23:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e4c27f6f307c06d6a1c9fc368cb72a461e4c6b20" to "81a63df3107793d067f1bd5a9807bfff8c0cd054"



---

archive/issue_comments_573397.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-24T23:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_573398.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-24T23:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573398",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_573399.json:
```json
{
    "body": "Changing commit from \"81a63df3107793d067f1bd5a9807bfff8c0cd054\" to \"3d6fa5924f54b85a28f5c4d969afca01da8801fc\"",
    "created_at": "2020-09-24T23:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573399",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "81a63df3107793d067f1bd5a9807bfff8c0cd054" to "3d6fa5924f54b85a28f5c4d969afca01da8801fc"



---

archive/issue_comments_573400.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-09-24T23:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573400",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_573401.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,18 @@\n+Follow-up from #29287.\n+\n+Script packages are installed by special rules in `build/make/Makefile`.\n+\n+This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.\n+\n+This is useful for #29082... to clean up #27870/#29003, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.\n+\n+\n+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.\n+We simply generate `spkg-install` if `spkg-install.in` is present.\n+\n+\n+We also rename targets `SPKG-clean` to `SPKG-uninstall` (as originally discussed in #29097), leaving a deprecated target behind.  This is to unify the targets between normal and script packages (the latter used `-uninstall` already). \n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2020-09-24T23:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573401",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,18 @@
+Follow-up from #29287.
+
+Script packages are installed by special rules in `build/make/Makefile`.
+
+This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.
+
+This is useful for #29082... to clean up #27870/#29003, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.
+
+
+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.
+We simply generate `spkg-install` if `spkg-install.in` is present.
+
+
+We also rename targets `SPKG-clean` to `SPKG-uninstall` (as originally discussed in #29097), leaving a deprecated target behind.  This is to unify the targets between normal and script packages (the latter used `-uninstall` already). 
+
 
 
 Comment: 1
``````




---

archive/issue_comments_573402.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-25T00:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573402",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_573403.json:
```json
{
    "body": "Changing commit from \"3d6fa5924f54b85a28f5c4d969afca01da8801fc\" to \"ae5ea98908707d8ce3f23603f51b070b117c3892\"",
    "created_at": "2020-09-25T00:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3d6fa5924f54b85a28f5c4d969afca01da8801fc" to "ae5ea98908707d8ce3f23603f51b070b117c3892"



---

archive/issue_comments_573404.json:
```json
{
    "body": "Changing commit from \"ae5ea98908707d8ce3f23603f51b070b117c3892\" to \"6c27c05e64886bfb2133dc70c6f87145eb74fcf5\"",
    "created_at": "2020-09-25T01:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573404",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ae5ea98908707d8ce3f23603f51b070b117c3892" to "6c27c05e64886bfb2133dc70c6f87145eb74fcf5"



---

archive/issue_comments_573405.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-25T01:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_573406.json:
```json
{
    "body": "Changing commit from \"6c27c05e64886bfb2133dc70c6f87145eb74fcf5\" to \"660d689c8fc712b813adb19f076aa9d8eeaaccb4\"",
    "created_at": "2020-10-02T02:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6c27c05e64886bfb2133dc70c6f87145eb74fcf5" to "660d689c8fc712b813adb19f076aa9d8eeaaccb4"



---

archive/issue_comments_573407.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-02T02:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_074876.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74876"
}
```



---

archive/issue_events_074877.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74877"
}
```



---

archive/issue_comments_573408.json:
```json
{
    "body": "<a id='comment:16'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573408",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_573409.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+Follow-up from #29287.\n+\n+Script packages are installed by special rules in `build/make/Makefile`.\n+\n+This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.\n+\n+This is useful for #29082... to clean up #27870/#29003, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.\n+\n+\n+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.\n+We simply generate `spkg-install` if `spkg-install.in` is present.\n+\n+\n+We also rename targets `SPKG-clean` to `SPKG-uninstall` (as originally discussed in #29097), leaving a deprecated target behind.  This is to unify the targets between normal and script packages (the latter used `-uninstall` already). \n+\n+\n+\n+Ideally, when done, changing a package's source between script and normal and pip will no longer require running `bootstrap`.\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-04-05T18:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573409",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,21 @@
+Follow-up from #29287.
+
+Script packages are installed by special rules in `build/make/Makefile`.
+
+This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.
+
+This is useful for #29082... to clean up #27870/#29003, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.
+
+
+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.
+We simply generate `spkg-install` if `spkg-install.in` is present.
+
+
+We also rename targets `SPKG-clean` to `SPKG-uninstall` (as originally discussed in #29097), leaving a deprecated target behind.  This is to unify the targets between normal and script packages (the latter used `-uninstall` already). 
+
+
+
+Ideally, when done, changing a package's source between script and normal and pip will no longer require running `bootstrap`.
 
 
 Comment: 1
``````




---

archive/issue_comments_573410.json:
```json
{
    "body": "Changing work_issues from \"\" to \"rework on top of #29013\"",
    "created_at": "2021-04-05T18:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573410",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "" to "rework on top of #29013"



---

archive/issue_comments_573411.json:
```json
{
    "body": "Changing dependencies from \"#29793, #30657\" to \"#29793, #30657, #29013\"",
    "created_at": "2021-04-05T18:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573411",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29793, #30657" to "#29793, #30657, #29013"



---

archive/issue_comments_573412.json:
```json
{
    "body": "Changing dependencies from \"#29793, #30657, #29013\" to \"#29013\"",
    "created_at": "2021-04-05T18:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573412",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29793, #30657, #29013" to "#29013"



---

archive/issue_events_074878.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74878"
}
```



---

archive/issue_events_074879.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74879"
}
```



---

archive/issue_events_074880.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74880"
}
```



---

archive/issue_events_074881.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74881"
}
```



---

archive/issue_events_074882.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74882"
}
```



---

archive/issue_events_074883.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74883"
}
```



---

archive/issue_comments_573413.json:
```json
{
    "body": "Changing commit from \"660d689c8fc712b813adb19f076aa9d8eeaaccb4\" to \"7a25d1d0b74cf7fe7b29b0169ba2539b323ae04a\"",
    "created_at": "2022-07-21T07:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "660d689c8fc712b813adb19f076aa9d8eeaaccb4" to "7a25d1d0b74cf7fe7b29b0169ba2539b323ae04a"



---

archive/issue_comments_573414.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-21T07:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_573415.json:
```json
{
    "body": "Changing dependencies from \"#29013\" to \"\"",
    "created_at": "2022-07-21T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573415",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29013" to ""



---

archive/issue_comments_573416.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,15 @@\n+Follow-up from #29287.\n+\n+Script packages are installed by special rules in `build/make/Makefile`.\n+\n+This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.\n+\n+This is useful for #29082... to clean up #27870/#29003, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.\n+\n+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.\n+We simply generate `spkg-install` if `spkg-install.in` is present.\n+\n+Ideally, when done, changing a package's source between script and normal and pip will no longer require running `bootstrap`.\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573416",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,15 @@
+Follow-up from #29287.
+
+Script packages are installed by special rules in `build/make/Makefile`.
+
+This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.
+
+This is useful for #29082... to clean up #27870/#29003, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.
+
+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.
+We simply generate `spkg-install` if `spkg-install.in` is present.
+
+Ideally, when done, changing a package's source between script and normal and pip will no longer require running `bootstrap`.
 
 
 Comment: 1
``````




---

archive/issue_comments_573417.json:
```json
{
    "body": "Changing work_issues from \"rework on top of #29013\" to \"\"",
    "created_at": "2022-07-21T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573417",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "rework on top of #29013" to ""



---

archive/issue_comments_573418.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,15 @@\n+Follow-up from #29287.\n+\n+Script packages are installed by special rules in `build/make/Makefile`.\n+\n+This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.\n+\n+This is useful for #29387 to clean up #27870/#29003/#29082, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.\n+\n+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.\n+We simply generate `spkg-install` if `spkg-install.in` is present.\n+\n+Ideally, when done, changing a package's source between script and normal and pip will no longer require running `bootstrap`.\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-07-21T07:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573418",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,15 @@
+Follow-up from #29287.
+
+Script packages are installed by special rules in `build/make/Makefile`.
+
+This ticket installs them by `sage-spkg` instead. This enables script packages to participate in the staged installs (`SAGE_DESTDIR`) and uninstallation mechanisms.
+
+This is useful for #29387 to clean up #27870/#29003/#29082, which introduced files in `SAGE_LOCAL` that do not belong to any package and are never uninstalled.
+
+We also make the decision whether `spkg-install` is generated from a template `spkg-install.in` or provided as is in the source tree orthogonal to the distinction `source=script` vs. `source=pip`.
+We simply generate `spkg-install` if `spkg-install.in` is present.
+
+Ideally, when done, changing a package's source between script and normal and pip will no longer require running `bootstrap`.
 
 
 Comment: 1
``````




---

archive/issue_comments_573419.json:
```json
{
    "body": "<a id='comment:25'></a>Rebased and dropped all clean/uninstall changes here because that is #29097",
    "created_at": "2022-07-21T07:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573419",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Rebased and dropped all clean/uninstall changes here because that is #29097



---

archive/issue_comments_573420.json:
```json
{
    "body": "Changing work_issues from \"\" to \"Move \"dummy script package\" code to sage-spkg\"",
    "created_at": "2022-07-21T07:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29386#issuecomment-573420",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "" to "Move "dummy script package" code to sage-spkg"



---

archive/issue_events_074884.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-21T07:21:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74884"
}
```



---

archive/issue_events_074885.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-21T07:21:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29386",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29386#event-74885"
}
```
