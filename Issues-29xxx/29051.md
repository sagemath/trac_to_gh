# Issue 29051: Repair use of system BLAS broken by #29025: remove numpy site.cfg [DEFAULT/ALL] sections

archive/issues_028814.json:
```json
{
    "assignees": [],
    "body": "This ticket fixes what was broken by #29025.\n\n\nPrevious related tickets:\n- #20157: make numpy and scipy use `pkg-config` to find `blas/lapack`\n- #22047: Scipy fails to build with ATLAS\n- #29025: numpy: `site.cfg` needs a `[DEFAULT]` section\n\n---\n\nReferences:\n\nscipy/setup.py at master \u00b7 scipy/scipy\nhttps://github.com/scipy/scipy/blob/master/scipy/setup.py\n\nnumpy/system_info.py at master \u00b7 numpy/numpy\nhttps://github.com/numpy/numpy/blob/master/numpy/distutils/system_info.py\n\npython - How to check BLAS/LAPACK linkage in NumPy and SciPy? - Stack Overflow\nhttps://stackoverflow.com/questions/9000164/how-to-check-blas-lapack-linkage-in-numpy-and-scipy\n\nCC:  @kiwifb @dimpase @mwageringel @vbraun\n\nBranch/Commit: **[`dba7aef`](https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Dima Pasechnik**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29051_\n\n",
    "closed_at": "2020-01-31T00:23:37Z",
    "created_at": "2020-01-20T14:37:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Repair use of system BLAS broken by #29025: remove numpy site.cfg [DEFAULT/ALL] sections",
    "type": "issue",
    "updated_at": "2020-01-31T00:23:37Z",
    "url": "https://github.com/sagemath/sage/issues/29051",
    "user": "https://github.com/mkoeppe"
}
```
This ticket fixes what was broken by #29025.


Previous related tickets:
- #20157: make numpy and scipy use `pkg-config` to find `blas/lapack`
- #22047: Scipy fails to build with ATLAS
- #29025: numpy: `site.cfg` needs a `[DEFAULT]` section

---

References:

scipy/setup.py at master · scipy/scipy
https://github.com/scipy/scipy/blob/master/scipy/setup.py

numpy/system_info.py at master · numpy/numpy
https://github.com/numpy/numpy/blob/master/numpy/distutils/system_info.py

python - How to check BLAS/LAPACK linkage in NumPy and SciPy? - Stack Overflow
https://stackoverflow.com/questions/9000164/how-to-check-blas-lapack-linkage-in-numpy-and-scipy

CC:  @kiwifb @dimpase @mwageringel @vbraun

Branch/Commit: **[`dba7aef`](https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d)**

Reviewer: **Matthias Koeppe**

Author: **Dima Pasechnik**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/29051_





---

archive/issue_events_399232.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-20T14:37:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399232"
}
```



---

archive/issue_events_399233.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-20T14:37:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399233"
}
```



---

archive/issue_events_399234.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-20T14:37:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399234"
}
```



---

archive/issue_events_399235.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-20T14:37:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399235"
}
```



---

archive/issue_comments_454502.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI now see this on Arch on #29071 (with openblas from the system)",
    "created_at": "2020-01-24T23:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454502",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

I now see this on Arch on #29071 (with openblas from the system)



---

archive/issue_comments_454503.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n#29025 broke buidling scipy with system's OpenBLAS. I'm now looking into how to tweak  \n`numpy/distutils/site.cfg` to make it work, but it is not obvious. Probably there are more bugs there (in numpy).",
    "created_at": "2020-01-25T09:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454503",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

#29025 broke buidling scipy with system's OpenBLAS. I'm now looking into how to tweak  
`numpy/distutils/site.cfg` to make it work, but it is not obvious. Probably there are more bugs there (in numpy).



---

archive/issue_events_399236.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-25T09:28:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399236"
}
```



---

archive/issue_events_399237.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-25T09:28:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399237"
}
```



---

archive/issue_comments_454504.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSomething that weirded me a bit in #29025. Why keep the `[ALL]` section at all? I cannot be sure that's the root cause but I would start by cleaning that.",
    "created_at": "2020-01-25T09:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454504",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

Something that weirded me a bit in #29025. Why keep the `[ALL]` section at all? I cannot be sure that's the root cause but I would start by cleaning that.



---

archive/issue_comments_454505.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nit's a bloody mess, if you read the numpy issue linked at #29025 - some numpy config functions use `[ALL]` section.\n\nRemoving `[DEFAULT]` section allows the build with system OpenBLAS to work again,\nso there is clearly something amiss. I messed up while testing #29025 and so it went through.",
    "created_at": "2020-01-25T10:31:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454505",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

it's a bloody mess, if you read the numpy issue linked at #29025 - some numpy config functions use `[ALL]` section.

Removing `[DEFAULT]` section allows the build with system OpenBLAS to work again,
so there is clearly something amiss. I messed up while testing #29025 and so it went through.



---

archive/issue_comments_454506.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nShould we just revert  #29025 ?\n(at the moment it's not needed anywhere expect in not yet ready tickers)\n\nI don't see an easy fix for it, without digging into numpy mess.",
    "created_at": "2020-01-25T13:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454506",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

Should we just revert  #29025 ?
(at the moment it's not needed anywhere expect in not yet ready tickers)

I don't see an easy fix for it, without digging into numpy mess.



---

archive/issue_comments_454507.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAfter reverting, is [ALL] needed?",
    "created_at": "2020-01-25T13:33:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454507",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

After reverting, is [ALL] needed?



---

archive/issue_comments_454508.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nNo, [ALL] with just paths in it has no effect, according to numpy people.\nSo it should be removed.\n\nWhat was the orginal need for [DEFAULT] in #29025 ?",
    "created_at": "2020-01-25T19:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454508",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

No, [ALL] with just paths in it has no effect, according to numpy people.
So it should be removed.

What was the orginal need for [DEFAULT] in #29025 ?



---

archive/issue_comments_454509.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n\n```\n[blas]\nlibraries  = openblas\n[lapack]\nlibraries  = openblas\n```\nseems to work just as well.",
    "created_at": "2020-01-25T19:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454509",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>


```
[blas]
libraries  = openblas
[lapack]
libraries  = openblas
```
seems to work just as well.



---

archive/issue_comments_454510.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIf we did the work properly with the like of `CPATH` and `LIBRARY_PATH` we should be able to drop `[ALL]`/`[DEFAULT]` completely. These section just define additional default paths for headers and libraries to be used in numpy.",
    "created_at": "2020-01-25T20:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454510",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

If we did the work properly with the like of `CPATH` and `LIBRARY_PATH` we should be able to drop `[ALL]`/`[DEFAULT]` completely. These section just define additional default paths for headers and libraries to be used in numpy.



---

archive/issue_comments_454511.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97\">9d1770a</a></td><td><code>revert #29025, remove useless [ALL] section</code></td></tr></table>\n",
    "created_at": "2020-01-26T09:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454511",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97">9d1770a</a></td><td><code>revert #29025, remove useless [ALL] section</code></td></tr></table>




---

archive/issue_events_399238.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T09:50:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399238"
}
```



---

archive/issue_comments_454512.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2020-01-26T09:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454512",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_454513.json:
```json
{
    "body": "Commit: **[`9d1770a`](https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97)**",
    "created_at": "2020-01-26T09:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454513",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`9d1770a`](https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97)**



---

archive/issue_comments_454514.json:
```json
{
    "body": "Branch: **[public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg)**",
    "created_at": "2020-01-26T09:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454514",
    "user": "https://github.com/dimpase"
}
```

Branch: **[public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg)**



---

archive/issue_comments_454515.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@kiwifb](#comment:10):\n> If we did the work properly with the like of `CPATH` and `LIBRARY_PATH` we should be able to drop `[ALL]`/`[DEFAULT]` completely. These section just define additional default paths for headers and libraries to be used in numpy.\n\nIMHO all these paths are better set up per library-specific section (`[blas]` etc.)\nthan via \"globals\" like `LIBRARY_PATH`.",
    "created_at": "2020-01-26T11:12:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454515",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@kiwifb](#comment:10):
> If we did the work properly with the like of `CPATH` and `LIBRARY_PATH` we should be able to drop `[ALL]`/`[DEFAULT]` completely. These section just define additional default paths for headers and libraries to be used in numpy.

IMHO all these paths are better set up per library-specific section (`[blas]` etc.)
than via "globals" like `LIBRARY_PATH`.



---

archive/issue_comments_454516.json:
```json
{
    "body": "Attachment: **[vdelecroix-config.log](https://github.com/sagemath/sage/files/ticket29051/vdelecroix-config.log)**",
    "created_at": "2020-01-26T14:26:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454516",
    "user": "https://github.com/videlec"
}
```

Attachment: **[vdelecroix-config.log](https://github.com/sagemath/sage/files/ticket29051/vdelecroix-config.log)**



---

archive/issue_comments_454517.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[vdelecroix-numpy-1.16.1.log](https://github.com/sagemath/sage/files/ticket29051/vdelecroix-numpy-1.16.1.log)**\n\nThanks to Dima (and #29071 and the branch here), I got Sage compile up to numpy. It ends up with some linking trouble. See\n- [config.log](https://trac.sagemath.org/raw-attachment/ticket/29051/vdelecroix-config.log)\n- [numpy-1.16.1.log](https://trac.sagemath.org/raw-attachment/ticket/29051/vdelecroix-numpy-1.16.1.log)",
    "created_at": "2020-01-26T14:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454517",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[vdelecroix-numpy-1.16.1.log](https://github.com/sagemath/sage/files/ticket29051/vdelecroix-numpy-1.16.1.log)**

Thanks to Dima (and #29071 and the branch here), I got Sage compile up to numpy. It ends up with some linking trouble. See
- [config.log](https://trac.sagemath.org/raw-attachment/ticket/29051/vdelecroix-config.log)
- [numpy-1.16.1.log](https://trac.sagemath.org/raw-attachment/ticket/29051/vdelecroix-numpy-1.16.1.log)



---

archive/issue_events_399239.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T15:10:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399239"
}
```



---

archive/issue_events_399240.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T15:10:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399240"
}
```



---

archive/issue_comments_454518.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@videlec](#comment:13):\n> Thanks to Dima (and #29071 and the branch here), I got Sage compile up to numpy. It ends up with some linking trouble. See\n> - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29051/vdelecroix-config.log)\n> - [numpy-1.16.1.log](https://trac.sagemath.org/raw-attachment/ticket/29051/vdelecroix-numpy-1.16.1.log)\n\nthanks, it's the same Arch-specific issue again - more precisely, numpy does not know about cblas. Testing on Debian wasn't enough.",
    "created_at": "2020-01-26T15:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454518",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@videlec](#comment:13):
> Thanks to Dima (and #29071 and the branch here), I got Sage compile up to numpy. It ends up with some linking trouble. See
> - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29051/vdelecroix-config.log)
> - [numpy-1.16.1.log](https://trac.sagemath.org/raw-attachment/ticket/29051/vdelecroix-numpy-1.16.1.log)

thanks, it's the same Arch-specific issue again - more precisely, numpy does not know about cblas. Testing on Debian wasn't enough.



---

archive/issue_comments_454519.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d\">dba7aef</a></td><td><code>revert from \"libraries=\" back to section-specific \"BLAH_libs=\"</code></td></tr></table>\n",
    "created_at": "2020-01-26T16:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454519",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d">dba7aef</a></td><td><code>revert from "libraries=" back to section-specific "BLAH_libs="</code></td></tr></table>




---

archive/issue_comments_454520.json:
```json
{
    "body": "Changed commit from **[`9d1770a`](https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97)** to **[`dba7aef`](https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d)**",
    "created_at": "2020-01-26T16:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454520",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9d1770a`](https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97)** to **[`dba7aef`](https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d)**



---

archive/issue_comments_454521.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nthe commit at [comment:15](#comment:15) fixes the latest problem.\nI've also left a comment on this here: https://github.com/numpy/numpy/pull/15338#issuecomment-578516788",
    "created_at": "2020-01-26T16:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454521",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

the commit at [comment:15](#comment:15) fixes the latest problem.
I've also left a comment on this here: https://github.com/numpy/numpy/pull/15338#issuecomment-578516788



---

archive/issue_events_399241.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T16:11:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399241"
}
```



---

archive/issue_events_399242.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T16:11:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399242"
}
```



---

archive/issue_comments_454522.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nTesting at https://github.com/mkoeppe/sage/actions?query=workflow%3A%22Run+SAGE_ROOT%2Ftox.ini%22\nwith #29053",
    "created_at": "2020-01-26T16:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454522",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Testing at https://github.com/mkoeppe/sage/actions?query=workflow%3A%22Run+SAGE_ROOT%2Ftox.ini%22
with #29053



---

archive/issue_comments_454523.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAt `\u200bdba7aef`, success for me!",
    "created_at": "2020-01-26T17:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454523",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

At `​dba7aef`, success for me!



---

archive/issue_comments_454524.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nErrors on various platforms tested at https://github.com/mkoeppe/sage/actions/runs/31716135. Examples:\n\n- archlinux-latest-standard at https://github.com/mkoeppe/sage/runs/410329835:\n  configure finds system openblas, then installing R from source fails with openblas-related errors\n\n- ubuntu-bionic-minimal\n   builds openblas from source, then installing R from source fails with openblas-related errors\n\n- fedora-32-standard\n   configure fails to detect openblas, error building openblas from source",
    "created_at": "2020-01-27T14:51:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454524",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Errors on various platforms tested at https://github.com/mkoeppe/sage/actions/runs/31716135. Examples:

- archlinux-latest-standard at https://github.com/mkoeppe/sage/runs/410329835:
  configure finds system openblas, then installing R from source fails with openblas-related errors

- ubuntu-bionic-minimal
   builds openblas from source, then installing R from source fails with openblas-related errors

- fedora-32-standard
   configure fails to detect openblas, error building openblas from source



---

archive/issue_events_399243.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-27T14:51:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399243"
}
```



---

archive/issue_events_399244.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-27T14:51:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399244"
}
```



---

archive/issue_comments_454525.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@mkoeppe](#comment:19):\n> Errors on various platforms tested at https://github.com/mkoeppe/sage/actions/runs/31716135. Examples:\n> \n> - archlinux-latest-standard at https://github.com/mkoeppe/sage/runs/410329835:\n>   configure finds system openblas, then installing R from source fails with openblas-related errors\n> \n> - ubuntu-bionic-minimal\n>    builds openblas from source, then installing R from source fails with openblas-related errors\n> \n> - fedora-32-standard\n>    configure fails to detect openblas, error building openblas from source\n> \n\nI'll be honest. None of these failures can be a result of this ticket. May be the git branch needs rebasing to include some fix for those separate issues.",
    "created_at": "2020-01-27T19:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454525",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@mkoeppe](#comment:19):
> Errors on various platforms tested at https://github.com/mkoeppe/sage/actions/runs/31716135. Examples:
> 
> - archlinux-latest-standard at https://github.com/mkoeppe/sage/runs/410329835:
>   configure finds system openblas, then installing R from source fails with openblas-related errors
> 
> - ubuntu-bionic-minimal
>    builds openblas from source, then installing R from source fails with openblas-related errors
> 
> - fedora-32-standard
>    configure fails to detect openblas, error building openblas from source
> 

I'll be honest. None of these failures can be a result of this ticket. May be the git branch needs rebasing to include some fix for those separate issues.



---

archive/issue_events_399245.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-27T19:54:00Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "title_is": "Repair use of system BLAS broken by #29025: remove numpy site.cfg [DEFAULT/ALL] sections",
    "title_was": "Paths configured in installed numpy site.cfg [DEFAULT/ALL] do not affect scipy",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399245"
}
```



---

archive/issue_comments_454526.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2020-01-27T19:54:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454526",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_comments_454527.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,4 @@\n-This is from #27824 comments 60, 61, 62, 68. Observed on Ubuntu with system BLAS, after #29025, which makes numpy find BLAS. https://github.com/sagemath/sage/files/ticket27824/Dockerfile-ubuntu-minimal.gz\n-\n+This ticket fixes what was broken by #29025.\n \n \n Previous related tickets:\n``````\n",
    "created_at": "2020-01-27T19:54:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454527",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,4 @@
-This is from #27824 comments 60, 61, 62, 68. Observed on Ubuntu with system BLAS, after #29025, which makes numpy find BLAS. https://github.com/sagemath/sage/files/ticket27824/Dockerfile-ubuntu-minimal.gz
-
+This ticket fixes what was broken by #29025.
 
 
 Previous related tickets:
``````




---

archive/issue_events_399246.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-27T19:54:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399246"
}
```



---

archive/issue_events_399247.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-27T19:54:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399247"
}
```



---

archive/issue_comments_454528.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nYes, this fix should definitely go into the next beta.",
    "created_at": "2020-01-27T19:54:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454528",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Yes, this fix should definitely go into the next beta.



---

archive/issue_comments_454529.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nFollow-up for the other build issues related to BLAS at #29088.",
    "created_at": "2020-01-27T19:59:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454529",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Follow-up for the other build issues related to BLAS at #29088.



---

archive/issue_comments_454530.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@mkoeppe](#comment:21):\n> Yes, this fix should definitely go into the next beta.\n\nNote that Volker silently released 9.1.beta2 yesterday. Should ping him to make a proper announcement.",
    "created_at": "2020-01-27T20:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454530",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@mkoeppe](#comment:21):
> Yes, this fix should definitely go into the next beta.

Note that Volker silently released 9.1.beta2 yesterday. Should ping him to make a proper announcement.



---

archive/issue_comments_454531.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI just downloaded the 9.1.beta2 tarball today, and on an Ubuntu virtual machine it fails on `scipy`, complaining about `blas`:\n\n```\n    Traceback (most recent call last):\n      File \"<string>\", line 1, in <module>\n      File \"/tmp/pip-req-build-7agkks4g/setup.py\", line 492, in <module>\n        setup_package()\n      File \"/tmp/pip-req-build-7agkks4g/setup.py\", line 488, in setup_package\n        setup(**metadata)\n      File \"/home/john/Sage/sage-9.1.beta2/local/lib/python3.7/site-packages/numpy/distutils/core.py\", line 137, in setup\n        config = configuration()\n      File \"/tmp/pip-req-build-7agkks4g/setup.py\", line 395, in configuration\n        raise NotFoundError(msg)\n    numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.\n```\nThe main Sage `config.log` file says\n\n```\nconfigure:22549: result:     openblas-0.3.6.p0 will not be installed (configure check)\n```\nAm I doing something wrong?",
    "created_at": "2020-01-27T21:01:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454531",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

I just downloaded the 9.1.beta2 tarball today, and on an Ubuntu virtual machine it fails on `scipy`, complaining about `blas`:

```
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/tmp/pip-req-build-7agkks4g/setup.py", line 492, in <module>
        setup_package()
      File "/tmp/pip-req-build-7agkks4g/setup.py", line 488, in setup_package
        setup(**metadata)
      File "/home/john/Sage/sage-9.1.beta2/local/lib/python3.7/site-packages/numpy/distutils/core.py", line 137, in setup
        config = configuration()
      File "/tmp/pip-req-build-7agkks4g/setup.py", line 395, in configuration
        raise NotFoundError(msg)
    numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.
```
The main Sage `config.log` file says

```
configure:22549: result:     openblas-0.3.6.p0 will not be installed (configure check)
```
Am I doing something wrong?



---

archive/issue_comments_454532.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jhpalmieri](#comment:24):\n> Am I doing something wrong?\n\nNo you are not. This ticket is supposed to deal with the stuff you just experienced. But this ticket is not included in 9.1.beta2, so it is effectively broken for external openblas.",
    "created_at": "2020-01-27T21:05:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454532",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jhpalmieri](#comment:24):
> Am I doing something wrong?

No you are not. This ticket is supposed to deal with the stuff you just experienced. But this ticket is not included in 9.1.beta2, so it is effectively broken for external openblas.



---

archive/issue_comments_454533.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@kiwifb](#comment:25):\n> Replying to [@jhpalmieri](#comment:24):\n> > Am I doing something wrong?\n\n> \n> No you are not. This ticket is supposed to deal with the stuff you just experienced. But this ticket is not included in 9.1.beta2, so it is effectively broken for external openblas.\n\nI just realized that, too. When I merge this, `acipy` builds.",
    "created_at": "2020-01-27T21:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454533",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@kiwifb](#comment:25):
> Replying to [@jhpalmieri](#comment:24):
> > Am I doing something wrong?

> 
> No you are not. This ticket is supposed to deal with the stuff you just experienced. But this ticket is not included in 9.1.beta2, so it is effectively broken for external openblas.

I just realized that, too. When I merge this, `acipy` builds.



---

archive/issue_comments_454534.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nFollow-up = #29071.",
    "created_at": "2020-01-28T16:23:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454534",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Follow-up = #29071.



---

archive/issue_events_399248.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T00:23:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399248"
}
```



---

archive/issue_events_399249.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "da04c4fc0964be73a40263a59ce5e047f16b2d86",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-31T00:23:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29051#event-399249"
}
```



---

archive/issue_comments_454535.json:
```json
{
    "body": "Changed branch from **[public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg)** to **[`dba7aef`](https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d)**",
    "created_at": "2020-01-31T00:23:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29051#issuecomment-454535",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg)** to **[`dba7aef`](https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d)**
