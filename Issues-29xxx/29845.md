# Issue 29845: PEP 517 / PEP 660 buildapi for sage_setup

archive/issues_029608.json:
```json
{
    "assignees": [],
    "body": "Instead of fixing `setup.py sdist` using `MANIFEST.in` (#21516), we implement a PEP 517 `buildapi` in `sage_setup`. \n\nThis could be done, for example, by customizing flit. \n\n\nReferences:\n- https://github.com/takluyver/flit/blob/master/flit_core/flit_core/buildapi.py\n- https://flit.readthedocs.io/en/latest/pyproject_toml.html#\n- [Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265) - closed as wontfix\n- https://pypi.org/project/enscons/ ?\n\n- https://www.python.org/dev/peps/pep-0660/ Editable installs for pyproject.toml based builds (wheel based)\n- https://github.com/python/cpython/issues/92054 Clarification about how to implement namespace packages (as in PEP 420) via import hooks for PEP 660 use case\n- https://discuss.python.org/t/help-testing-pep-660-support-in-setuptools/16904 \n\n\nDepends on #29846\nDepends on #30581\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29845_\n\n",
    "created_at": "2020-06-11T02:25:50Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wishlist%20item"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "PEP 517 / PEP 660 buildapi for sage_setup",
    "type": "issue",
    "updated_at": "2022-07-21T22:29:30Z",
    "url": "https://github.com/sagemath/sage/issues/29845",
    "user": "https://github.com/mkoeppe"
}
```
Instead of fixing `setup.py sdist` using `MANIFEST.in` (#21516), we implement a PEP 517 `buildapi` in `sage_setup`. 

This could be done, for example, by customizing flit. 


References:
- https://github.com/takluyver/flit/blob/master/flit_core/flit_core/buildapi.py
- https://flit.readthedocs.io/en/latest/pyproject_toml.html#
- [Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265) - closed as wontfix
- https://pypi.org/project/enscons/ ?

- https://www.python.org/dev/peps/pep-0660/ Editable installs for pyproject.toml based builds (wheel based)
- https://github.com/python/cpython/issues/92054 Clarification about how to implement namespace packages (as in PEP 420) via import hooks for PEP 660 use case
- https://discuss.python.org/t/help-testing-pep-660-support-in-setuptools/16904 


Depends on #29846
Depends on #30581

_Issue created by migration from https://trac.sagemath.org/ticket/29845_





---

archive/issue_events_392499.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-11T02:25:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392499"
}
```



---

archive/issue_events_392500.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-11T02:25:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392500"
}
```



---

archive/issue_events_392501.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-11T02:25:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392501"
}
```



---

archive/issue_events_392502.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-11T02:25:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392502"
}
```



---

archive/issue_comments_474246.json:
```json
{
    "body": "Dependencies: **#29846**",
    "created_at": "2020-06-11T07:07:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474246",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29846**



---

archive/issue_comments_474247.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,12 @@\n \n This could be done, for example, by customizing flit. \n \n+\n References:\n - https://github.com/takluyver/flit/blob/master/flit_core/flit_core/buildapi.py\n - https://flit.readthedocs.io/en/latest/pyproject_toml.html#\n+- [https://github.com/python-poetry/poetry/issues/265 Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265 Poetry issue #265 - Support for custom commands and functions) closed as wontfix\n \n \n \n+\n``````\n",
    "created_at": "2020-06-12T19:42:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474247",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,12 @@
 
 This could be done, for example, by customizing flit. 
 
+
 References:
 - https://github.com/takluyver/flit/blob/master/flit_core/flit_core/buildapi.py
 - https://flit.readthedocs.io/en/latest/pyproject_toml.html#
+- [https://github.com/python-poetry/poetry/issues/265 Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265 Poetry issue #265 - Support for custom commands and functions) closed as wontfix
 
 
 
+
``````




---

archive/issue_comments_474248.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n References:\n - https://github.com/takluyver/flit/blob/master/flit_core/flit_core/buildapi.py\n - https://flit.readthedocs.io/en/latest/pyproject_toml.html#\n-- [https://github.com/python-poetry/poetry/issues/265 Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265 Poetry issue #265 - Support for custom commands and functions) closed as wontfix\n+- [Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265) - closed as wontfix\n \n \n \n``````\n",
    "created_at": "2020-06-12T19:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474248",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 References:
 - https://github.com/takluyver/flit/blob/master/flit_core/flit_core/buildapi.py
 - https://flit.readthedocs.io/en/latest/pyproject_toml.html#
-- [https://github.com/python-poetry/poetry/issues/265 Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265 Poetry issue #265 - Support for custom commands and functions) closed as wontfix
+- [Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265) - closed as wontfix
 
 
 
``````




---

archive/issue_events_392503.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-14T14:12:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392503"
}
```



---

archive/issue_events_392504.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-14T14:12:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392504"
}
```



---

archive/issue_comments_474249.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n - https://github.com/takluyver/flit/blob/master/flit_core/flit_core/buildapi.py\n - https://flit.readthedocs.io/en/latest/pyproject_toml.html#\n - [Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265) - closed as wontfix\n+- https://pypi.org/project/enscons/ ?\n \n \n \n-\n``````\n",
    "created_at": "2020-08-20T22:11:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474249",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
 - https://github.com/takluyver/flit/blob/master/flit_core/flit_core/buildapi.py
 - https://flit.readthedocs.io/en/latest/pyproject_toml.html#
 - [Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265) - closed as wontfix
+- https://pypi.org/project/enscons/ ?
 
 
 
-
``````




---

archive/issue_comments_474250.json:
```json
{
    "body": "Changed dependencies from **#29846** to **#29846, #30581**",
    "created_at": "2020-09-16T03:29:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474250",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29846** to **#29846, #30581**



---

archive/issue_events_392505.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392505"
}
```



---

archive/issue_events_392506.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392506"
}
```



---

archive/issue_comments_474251.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474251",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_392507.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-14T01:33:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392507"
}
```



---

archive/issue_events_392508.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-14T01:33:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392508"
}
```



---

archive/issue_comments_474252.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,5 +9,5 @@\n - [Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265) - closed as wontfix\n - https://pypi.org/project/enscons/ ?\n \n+- https://www.python.org/dev/peps/pep-0660/ Editable installs for pyproject.toml based builds (wheel based)\n \n-\n``````\n",
    "created_at": "2021-10-10T03:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474252",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,5 +9,5 @@
 - [Poetry issue #265 - Support for custom commands and functions](https://github.com/python-poetry/poetry/issues/265) - closed as wontfix
 - https://pypi.org/project/enscons/ ?
 
+- https://www.python.org/dev/peps/pep-0660/ Editable installs for pyproject.toml based builds (wheel based)
 
-
``````




---

archive/issue_events_392509.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-10T03:53:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "title_is": "PEP 517 / PEP 660 buildapi for sage_setup",
    "title_was": "PEP 517 buildapi for sage_setup",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29845#event-392509"
}
```



---

archive/issue_comments_474253.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n - https://pypi.org/project/enscons/ ?\n \n - https://www.python.org/dev/peps/pep-0660/ Editable installs for pyproject.toml based builds (wheel based)\n-\n+- https://github.com/python/cpython/issues/92054 Clarification about how to implement namespace packages (as in PEP 420) via import hooks for PEP 660 use case\n``````\n",
    "created_at": "2022-07-21T22:26:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474253",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 - https://pypi.org/project/enscons/ ?
 
 - https://www.python.org/dev/peps/pep-0660/ Editable installs for pyproject.toml based builds (wheel based)
-
+- https://github.com/python/cpython/issues/92054 Clarification about how to implement namespace packages (as in PEP 420) via import hooks for PEP 660 use case
``````




---

archive/issue_comments_474254.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,5 @@\n \n - https://www.python.org/dev/peps/pep-0660/ Editable installs for pyproject.toml based builds (wheel based)\n - https://github.com/python/cpython/issues/92054 Clarification about how to implement namespace packages (as in PEP 420) via import hooks for PEP 660 use case\n+- https://discuss.python.org/t/help-testing-pep-660-support-in-setuptools/16904 \n+\n``````\n",
    "created_at": "2022-07-21T22:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29845#issuecomment-474254",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,5 @@
 
 - https://www.python.org/dev/peps/pep-0660/ Editable installs for pyproject.toml based builds (wheel based)
 - https://github.com/python/cpython/issues/92054 Clarification about how to implement namespace packages (as in PEP 420) via import hooks for PEP 660 use case
+- https://discuss.python.org/t/help-testing-pep-660-support-in-setuptools/16904 
+
``````

