# Issue 29335: Fix Singular configure so it accepts NTL installed in nonstandard locations

archive/issues_029098.json:
```json
{
    "assignees": [],
    "body": "As observed in #29104, Singular's configure may fail to find NTL even if Sage finds a system NTL. It continues to build, but the result is broken.\n\nThe details:\n\nNTL's `spkg-configure.m4` (from #27265/#27822) uses `AC_CHECK_HEADER`/`AC_LINK_IFELSE`/`AC_RUN_IFELSE` and therefore is able to find NTL in an environment where the user has set CPPFLAGS and LDFLAGS accordingly.\nIn that case, it sets `AC_SUBST(SAGE_NTL_PREFIX, [''])`\n\nThen `build/bin/sage-build-env-config.in` does:\n\n```\n# This is usually blank if the system NTL is used, or $SAGE_LOCAL otherwise\nexport SAGE_NTL_PREFIX=\"@SAGE_NTL_PREFIX@\"\nif [ -n \"$SAGE_NTL_PREFIX\" ]; then\n    # Many packages that depend on NTL accept a --with-ntl=<prefix> flag to\n    # their ./configure scripts.  When using the system's NTL this is not\n    # generally necessary, but when using the NTL package installed in\n    # SAGE_LOCAL it is useful to pass it.\n    export SAGE_CONFIGURE_NTL=\"--with-ntl=$SAGE_NTL_PREFIX\"\nfi\n```\n\nBut Singular's `configure` (via its `m4/ntl-check.m4`) insists to find the headers in `NTL_HOME_PATH`, which defaults to `DEFAULT_CHECKING_PATH=\"/usr /usr/local /sw /opt/local\"`, which can of course be quite wrong.\n\n\nOn this ticket, we use a simple patch that modifies Singular's NTL detection code to make it similar to its GMP and FLINT detection codes. \n\n\nAn alternative solution would be to always provide the --with-ntl=PREFIX option to Singular.\nWe should also make it an error if Singular's configure cannot find NTL.\n\nSee also: #25993 - Upgrade Singular\n\nCC:  @dimpase @embray @kiwifb @mwageringel @antonio-rojas\n\nBranch/Commit: **[50f62c7](https://github.com/sagemath/sagetrac-mirror/commit/50f62c7a4cfea5343903f6b83cad22fde7bb8553)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29335_\n\n",
    "closed_at": "2020-03-22T23:20:45Z",
    "created_at": "2020-03-15T04:26:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix Singular configure so it accepts NTL installed in nonstandard locations",
    "type": "issue",
    "updated_at": "2020-03-22T23:20:45Z",
    "url": "https://github.com/sagemath/sage/issues/29335",
    "user": "https://github.com/mkoeppe"
}
```
As observed in #29104, Singular's configure may fail to find NTL even if Sage finds a system NTL. It continues to build, but the result is broken.

The details:

NTL's `spkg-configure.m4` (from #27265/#27822) uses `AC_CHECK_HEADER`/`AC_LINK_IFELSE`/`AC_RUN_IFELSE` and therefore is able to find NTL in an environment where the user has set CPPFLAGS and LDFLAGS accordingly.
In that case, it sets `AC_SUBST(SAGE_NTL_PREFIX, [''])`

Then `build/bin/sage-build-env-config.in` does:

```
# This is usually blank if the system NTL is used, or $SAGE_LOCAL otherwise
export SAGE_NTL_PREFIX="@SAGE_NTL_PREFIX@"
if [ -n "$SAGE_NTL_PREFIX" ]; then
    # Many packages that depend on NTL accept a --with-ntl=<prefix> flag to
    # their ./configure scripts.  When using the system's NTL this is not
    # generally necessary, but when using the NTL package installed in
    # SAGE_LOCAL it is useful to pass it.
    export SAGE_CONFIGURE_NTL="--with-ntl=$SAGE_NTL_PREFIX"
fi
```

But Singular's `configure` (via its `m4/ntl-check.m4`) insists to find the headers in `NTL_HOME_PATH`, which defaults to `DEFAULT_CHECKING_PATH="/usr /usr/local /sw /opt/local"`, which can of course be quite wrong.


On this ticket, we use a simple patch that modifies Singular's NTL detection code to make it similar to its GMP and FLINT detection codes. 


An alternative solution would be to always provide the --with-ntl=PREFIX option to Singular.
We should also make it an error if Singular's configure cannot find NTL.

See also: #25993 - Upgrade Singular

CC:  @dimpase @embray @kiwifb @mwageringel @antonio-rojas

Branch/Commit: **[50f62c7](https://github.com/sagemath/sagetrac-mirror/commit/50f62c7a4cfea5343903f6b83cad22fde7bb8553)**

Reviewer: **Dima Pasechnik**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/29335_





---

archive/issue_events_371709.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-15T04:26:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371709"
}
```



---

archive/issue_events_371710.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-15T04:26:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "component: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371710"
}
```



---

archive/issue_events_371711.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-15T04:26:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371711"
}
```



---

archive/issue_events_371712.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-15T04:26:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371712"
}
```



---

archive/issue_comments_463113.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nSingular's checks for GMP and FLINT are almost as bad, but because the check for the header file is commented out, it happens to accept the libraries that are accessible via CPPFLAGS and LDFLAGS.",
    "created_at": "2020-03-15T04:33:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463113",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'>Comment 1:</a>
Singular's checks for GMP and FLINT are almost as bad, but because the check for the header file is commented out, it happens to accept the libraries that are accessible via CPPFLAGS and LDFLAGS.



---

archive/issue_comments_463114.json:
```json
{
    "body": "Branch: **[u/mkoeppe/always_find_sage_ntl_prefix_and_call_singular_configure_with_it](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/always_find_sage_ntl_prefix_and_call_singular_configure_with_it)**",
    "created_at": "2020-03-15T04:51:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463114",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/always_find_sage_ntl_prefix_and_call_singular_configure_with_it](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/always_find_sage_ntl_prefix_and_call_singular_configure_with_it)**



---

archive/issue_events_371713.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-15T04:57:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "title_is": "Fix Singular configure so it accepts NTL installed in nonstandard locations",
    "title_was": "Always find SAGE_NTL_PREFIX and call Singular configure with it",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371713"
}
```



---

archive/issue_comments_463115.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,6 +21,11 @@\n \n But Singular's `configure` (via its `m4/ntl-check.m4`) insists to find the headers in `NTL_HOME_PATH`, which defaults to `DEFAULT_CHECKING_PATH=\"/usr /usr/local /sw /opt/local\"`, which can of course be quite wrong.\n \n-We should always provide the --with-ntl=PREFIX option to Singular -- and make it an error if Singular's configure cannot find NTL.\n+\n+On this ticket, we use a simple patch that modifies Singular's NTL detection code to make it similar to its GMP and FLINT detection codes. \n \n \n+An alternative solution would be to always provide the --with-ntl=PREFIX option to Singular.\n+We should also make it an error if Singular's configure cannot find NTL.\n+\n+\n``````\n",
    "created_at": "2020-03-15T04:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463115",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,6 +21,11 @@
 
 But Singular's `configure` (via its `m4/ntl-check.m4`) insists to find the headers in `NTL_HOME_PATH`, which defaults to `DEFAULT_CHECKING_PATH="/usr /usr/local /sw /opt/local"`, which can of course be quite wrong.
 
-We should always provide the --with-ntl=PREFIX option to Singular -- and make it an error if Singular's configure cannot find NTL.
+
+On this ticket, we use a simple patch that modifies Singular's NTL detection code to make it similar to its GMP and FLINT detection codes. 
 
 
+An alternative solution would be to always provide the --with-ntl=PREFIX option to Singular.
+We should also make it an error if Singular's configure cannot find NTL.
+
+
``````




---

archive/issue_comments_463116.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50f62c7a4cfea5343903f6b83cad22fde7bb8553\">50f62c7</a></td><td><code>build/pkgs/singular: Add patches to accept system NTL in nonstandard locations</code></td></tr></table>\n",
    "created_at": "2020-03-15T04:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463116",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'>Comment 3:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50f62c7a4cfea5343903f6b83cad22fde7bb8553">50f62c7</a></td><td><code>build/pkgs/singular: Add patches to accept system NTL in nonstandard locations</code></td></tr></table>




---

archive/issue_comments_463117.json:
```json
{
    "body": "Commit: **[50f62c7](https://github.com/sagemath/sagetrac-mirror/commit/50f62c7a4cfea5343903f6b83cad22fde7bb8553)**",
    "created_at": "2020-03-15T04:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463117",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[50f62c7](https://github.com/sagemath/sagetrac-mirror/commit/50f62c7a4cfea5343903f6b83cad22fde7bb8553)**



---

archive/issue_comments_463118.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-03-15T05:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463118",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_371714.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-15T05:23:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371714"
}
```



---

archive/issue_comments_463119.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThose detections are a bit better in newer versions of singular, but still a bit off. My pull request to sanitize the new `flint` detection code has been accepted but that's not the only thing that should be sanitized. https://github.com/Singular/Sources/pull/981",
    "created_at": "2020-03-15T05:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463119",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'>Comment 6:</a>
Those detections are a bit better in newer versions of singular, but still a bit off. My pull request to sanitize the new `flint` detection code has been accepted but that's not the only thing that should be sanitized. https://github.com/Singular/Sources/pull/981



---

archive/issue_comments_463120.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nGlad to hear that upstream accepts build cleanup patches!",
    "created_at": "2020-03-15T15:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463120",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
Glad to hear that upstream accepts build cleanup patches!



---

archive/issue_comments_463121.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThe fix on this ticket works (see #29104 / https://github.com/mkoeppe/sage/runs/508693083) - but it turns out that homebrew's NTL is not suitable:\n\n```\n  [singular-4.1.1p2.p0]   ld: illegal thread local variable reference to regular symbol __ZN3NTL13ErrorCallbackE for architecture x86_64\n  [singular-4.1.1p2.p0]   clang: error: linker command failed with exit code 1 (use -v to see invocation)\n  [singular-4.1.1p2.p0]   make[8]: *** [libSingular.la] Error 1\n```\nThis is something that our `ntl/spkg-configure.m4` should be checking. (This is #29339.)",
    "created_at": "2020-03-15T15:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463121",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
The fix on this ticket works (see #29104 / https://github.com/mkoeppe/sage/runs/508693083) - but it turns out that homebrew's NTL is not suitable:

```
  [singular-4.1.1p2.p0]   ld: illegal thread local variable reference to regular symbol __ZN3NTL13ErrorCallbackE for architecture x86_64
  [singular-4.1.1p2.p0]   clang: error: linker command failed with exit code 1 (use -v to see invocation)
  [singular-4.1.1p2.p0]   make[8]: *** [libSingular.la] Error 1
```
This is something that our `ntl/spkg-configure.m4` should be checking. (This is #29339.)



---

archive/issue_comments_463122.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,4 +28,4 @@\n An alternative solution would be to always provide the --with-ntl=PREFIX option to Singular.\n We should also make it an error if Singular's configure cannot find NTL.\n \n-\n+See also: #25993 - Upgrade Singular\n``````\n",
    "created_at": "2020-03-15T18:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463122",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,4 +28,4 @@
 An alternative solution would be to always provide the --with-ntl=PREFIX option to Singular.
 We should also make it an error if Singular's configure cannot find NTL.
 
-
+See also: #25993 - Upgrade Singular
``````




---

archive/issue_comments_463123.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReady for review",
    "created_at": "2020-03-16T15:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463123",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>Comment 10:</a>
Ready for review



---

archive/issue_comments_463124.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nwhat's going on in `./configure` with NTL headers? Why is it there, and not in the corresponding `spkg-configure.m4` ?\n\nWhy one cannot just use `AC_CHECK_HEADER(S)()`, instead of a dodgy loop?",
    "created_at": "2020-03-16T16:01:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463124",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'>Comment 11:</a>
what's going on in `./configure` with NTL headers? Why is it there, and not in the corresponding `spkg-configure.m4` ?

Why one cannot just use `AC_CHECK_HEADER(S)()`, instead of a dodgy loop?



---

archive/issue_comments_463125.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nMaking upstream singular configuration non-dodgy is beyond the scope of this ticket.",
    "created_at": "2020-03-16T16:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463125",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'>Comment 12:</a>
Making upstream singular configuration non-dodgy is beyond the scope of this ticket.



---

archive/issue_comments_463126.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\noops, sorry, I have not realised that's Singular's `./configure`\n(stress and jetlag :-( )\n\nhow about we just pass it what's Sage already knows about NTL headers, i.e.\n`SAGE_NTL_PREFIX` ?",
    "created_at": "2020-03-16T16:27:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463126",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'>Comment 13:</a>
oops, sorry, I have not realised that's Singular's `./configure`
(stress and jetlag :-( )

how about we just pass it what's Sage already knows about NTL headers, i.e.
`SAGE_NTL_PREFIX` ?



---

archive/issue_comments_463127.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nThe problem is that we do not really determine SAGE_NTL_PREFIX. It is empty if the system package is used.",
    "created_at": "2020-03-16T16:28:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'>Comment 14:</a>
The problem is that we do not really determine SAGE_NTL_PREFIX. It is empty if the system package is used.



---

archive/issue_comments_463128.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n(see ticket description)",
    "created_at": "2020-03-16T16:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463128",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'>Comment 15:</a>
(see ticket description)



---

archive/issue_comments_463129.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@mkoeppe](#comment%3A14):\n> The problem is that we do not really determine SAGE_NTL_PREFIX. It is empty if the system package is used.\n\nBut we can, as we call AC_CHECK_HEADER, and it sets `ac_cv_header_`<header-file>\nso we can easily store it somewhere.",
    "created_at": "2020-03-16T17:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463129",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@mkoeppe](#comment%3A14):
> The problem is that we do not really determine SAGE_NTL_PREFIX. It is empty if the system package is used.

But we can, as we call AC_CHECK_HEADER, and it sets `ac_cv_header_`<header-file>
so we can easily store it somewhere.



---

archive/issue_comments_463130.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nac_cv_header_NTL_ZZ_h=yes",
    "created_at": "2020-03-16T17:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463130",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'>Comment 17:</a>
ac_cv_header_NTL_ZZ_h=yes



---

archive/issue_comments_463131.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nOK, but we can use `AX_ABSOLUTE_HEADER()` - as used in MPIR's spkg-configure.m4\nto get the absolute path.\n\nIMHO this way we don't have to patch Singular at all, right? Just pass the value, whatever it is.",
    "created_at": "2020-03-16T18:02:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463131",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'>Comment 18:</a>
OK, but we can use `AX_ABSOLUTE_HEADER()` - as used in MPIR's spkg-configure.m4
to get the absolute path.

IMHO this way we don't have to patch Singular at all, right? Just pass the value, whatever it is.



---

archive/issue_comments_463132.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI wouldn't consider use of this terrible macro an improvement.",
    "created_at": "2020-03-16T18:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463132",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>Comment 19:</a>
I wouldn't consider use of this terrible macro an improvement.



---

archive/issue_comments_463133.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nIn particular, reconstructing an install prefix from the location of a header file is NOT a good technical solution.",
    "created_at": "2020-03-16T18:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463133",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'>Comment 20:</a>
In particular, reconstructing an install prefix from the location of a header file is NOT a good technical solution.



---

archive/issue_comments_463134.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nif you don't want a terrible macro, you can parse `NTL/config_log.h` to get the value of `DEF_PREFIX`, which is exactly the prefix we're after. If it's not defined, one can look for`PREFIX`, which would amount for the same thing. Finally, if neither are defined,\nthe prefix is `/usr/local`.\nCf. https://www.shoup.net/ntl/doc/tour-unix.html",
    "created_at": "2020-03-16T18:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463134",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'>Comment 21:</a>
if you don't want a terrible macro, you can parse `NTL/config_log.h` to get the value of `DEF_PREFIX`, which is exactly the prefix we're after. If it's not defined, one can look for`PREFIX`, which would amount for the same thing. Finally, if neither are defined,
the prefix is `/usr/local`.
Cf. https://www.shoup.net/ntl/doc/tour-unix.html



---

archive/issue_comments_463135.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nSorry, none of these are improvements over the simple patch.",
    "created_at": "2020-03-16T19:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463135",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>Comment 22:</a>
Sorry, none of these are improvements over the simple patch.



---

archive/issue_comments_463136.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nOK. Upstream really needs to get this stuff fixed.",
    "created_at": "2020-03-18T02:41:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463136",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'>Comment 23:</a>
OK. Upstream really needs to get this stuff fixed.



---

archive/issue_events_371715.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-18T02:41:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371715"
}
```



---

archive/issue_events_371716.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-18T02:41:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371716"
}
```



---

archive/issue_comments_463137.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-03-18T02:41:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463137",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_463138.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nThanks.",
    "created_at": "2020-03-18T03:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463138",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>Comment 24:</a>
Thanks.



---

archive/issue_events_371717.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-22T23:20:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371717"
}
```



---

archive/issue_events_371718.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c480201572613f62b6a92c9b0ab0c94677a81508",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-03-22T23:20:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29335#event-371718"
}
```



---

archive/issue_comments_463139.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/always_find_sage_ntl_prefix_and_call_singular_configure_with_it](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/always_find_sage_ntl_prefix_and_call_singular_configure_with_it)** to **[50f62c7](https://github.com/sagemath/sagetrac-mirror/commit/50f62c7a4cfea5343903f6b83cad22fde7bb8553)**",
    "created_at": "2020-03-22T23:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29335",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29335#issuecomment-463139",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/always_find_sage_ntl_prefix_and_call_singular_configure_with_it](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/always_find_sage_ntl_prefix_and_call_singular_configure_with_it)** to **[50f62c7](https://github.com/sagemath/sagetrac-mirror/commit/50f62c7a4cfea5343903f6b83cad22fde7bb8553)**
