# Issue 29275: fix issues in the DiGraph constructor for incidence matrix

archive/issues_029038.json:
```json
{
    "body": "Currently, DiGraph constructor throws error for following type of incidence matrix.\n\n```\nsage: m=Matrix([[1,-1],[-1,1]])\nsage: g=DiGraph(m,format='incidence_matrix')\nTraceback (most recent call last)\n...\nValueError: each column represents an edge: -1 goes to 1\n```\n\n\n```\nsage: m=Matrix([[0,1],[0,-1],[0,0]])\nsage: G = DiGraph(m,format='incidence_matrix')\nTraceback (most recent call last)\n...\nValueError: there must be two nonzero entries (-1 & 1) per column\n```\n\nCC:  @dcoudert\n\nReviewer: David Coudert\n\nAuthor: Vipul Gupta\n\nBranch: 139c77461f7f67b7f9059d674d8ad315e0d6611e\n\nCommit: 139c77461f7f67b7f9059d674d8ad315e0d6611e\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29275\n\n",
    "closed_at": "2020-03-08T11:27:10Z",
    "created_at": "2020-03-03T18:51:47Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "fix issues in the DiGraph constructor for incidence matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29275",
    "user": "https://github.com/vipul79321"
}
```
Currently, DiGraph constructor throws error for following type of incidence matrix.

```
sage: m=Matrix([[1,-1],[-1,1]])
sage: g=DiGraph(m,format='incidence_matrix')
Traceback (most recent call last)
...
ValueError: each column represents an edge: -1 goes to 1
```


```
sage: m=Matrix([[0,1],[0,-1],[0,0]])
sage: G = DiGraph(m,format='incidence_matrix')
Traceback (most recent call last)
...
ValueError: there must be two nonzero entries (-1 & 1) per column
```

CC:  @dcoudert

Reviewer: David Coudert

Author: Vipul Gupta

Branch: 139c77461f7f67b7f9059d674d8ad315e0d6611e

Commit: 139c77461f7f67b7f9059d674d8ad315e0d6611e

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29275





---

archive/issue_comments_410544.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2020-03-03T18:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410544",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_410545.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-03T18:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410545",
    "user": "https://github.com/vipul79321"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_410546.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2020-03-03T19:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410546",
    "user": "https://github.com/vipul79321"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_410547.json:
```json
{
    "body": "<a id='comment:3'></a>Instead of `L = sorted(set(c.list()))`, we could use `L = [c[i] for i in NZ]`, no ?\nand then we would only had to check that `sorted(L) == [-1, 1]`",
    "created_at": "2020-03-04T07:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410547",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>Instead of `L = sorted(set(c.list()))`, we could use `L = [c[i] for i in NZ]`, no ?
and then we would only had to check that `sorted(L) == [-1, 1]`



---

archive/issue_comments_410548.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-04T08:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410549.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 dcoudert]:\n> Instead of `L = sorted(set(c.list()))`, we could use `L = [c[i] for i in NZ]`, no ?\n> and then we would only had to check that `sorted(L) == [-1, 1]`\n\nDone",
    "created_at": "2020-03-04T08:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410549",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:5'></a>Replying to [comment:3 dcoudert]:
> Instead of `L = sorted(set(c.list()))`, we could use `L = [c[i] for i in NZ]`, no ?
> and then we would only had to check that `sorted(L) == [-1, 1]`

Done



---

archive/issue_comments_410550.json:
```json
{
    "body": "<a id='comment:6'></a>the comments for #29276 also apply here: ensure that you can handle a column with only zeros, add relevant doctests.",
    "created_at": "2020-03-04T08:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410550",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>the comments for #29276 also apply here: ensure that you can handle a column with only zeros, add relevant doctests.



---

archive/issue_comments_410551.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 dcoudert]:\n> the comments for #29276 also apply here: ensure that you can handle a column with only zeros, add relevant doctests.\n\ncan i add following doctest for both #29275 and #29276:\n\n```\nTESTS:\n\nFix bug reported in :trac:`29275` and :trac:`29276`::\n\n    sage: m = Matrix([[0,1],[0,-1]])\n    sage: m\n    [ 0  1]\n    [ 0 -1]\n    sage: G = DiGraph(m,format='incidence_matrix')\n    sage: list(G.edges(labels=False))\n    [(1, 0)]\n```\n\nor shall I add separate doctest for this ticket?",
    "created_at": "2020-03-04T08:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410551",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:7'></a>Replying to [comment:6 dcoudert]:
> the comments for #29276 also apply here: ensure that you can handle a column with only zeros, add relevant doctests.

can i add following doctest for both #29275 and #29276:

```
TESTS:

Fix bug reported in :trac:`29275` and :trac:`29276`::

    sage: m = Matrix([[0,1],[0,-1]])
    sage: m
    [ 0  1]
    [ 0 -1]
    sage: G = DiGraph(m,format='incidence_matrix')
    sage: list(G.edges(labels=False))
    [(1, 0)]
```

or shall I add separate doctest for this ticket?



---

archive/issue_comments_410552.json:
```json
{
    "body": "<a id='comment:8'></a>separated dockets is better.",
    "created_at": "2020-03-04T09:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410552",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>separated dockets is better.



---

archive/issue_comments_410553.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-04T09:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410554.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:8 dcoudert]:\n> separated dockets is better.\n\nDone",
    "created_at": "2020-03-04T09:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410554",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:10'></a>Replying to [comment:8 dcoudert]:
> separated dockets is better.

Done



---

archive/issue_comments_410555.json:
```json
{
    "body": "<a id='comment:11'></a>If #29276 is duplicate of this ticket, we can make all doctests refer to this ticket.\n\nDon't forget to add your name in Authors field.",
    "created_at": "2020-03-04T10:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410555",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:11'></a>If #29276 is duplicate of this ticket, we can make all doctests refer to this ticket.

Don't forget to add your name in Authors field.



---

archive/issue_comments_410556.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 dcoudert]:\n> If #29276 is duplicate of this ticket, we can make all doctests refer to this ticket.\n\nNo, I dont think #29276 is duplicate of #29275 both have completely different aim. #29275 is more of defect and #29276 is somewhat type of enhancement.\nAlthough both have same branches performing same thing.\nIf you want, I can make `u/gh-vipul79321/ticket29275` specifically for #29275 by removing `if not NZ` part from code and corresponding doctest.",
    "created_at": "2020-03-04T12:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410556",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:12'></a>Replying to [comment:11 dcoudert]:
> If #29276 is duplicate of this ticket, we can make all doctests refer to this ticket.

No, I dont think #29276 is duplicate of #29275 both have completely different aim. #29275 is more of defect and #29276 is somewhat type of enhancement.
Although both have same branches performing same thing.
If you want, I can make `u/gh-vipul79321/ticket29275` specifically for #29275 by removing `if not NZ` part from code and corresponding doctest.



---

archive/issue_comments_410557.json:
```json
{
    "body": "<a id='comment:14'></a>You have to ensure that tickets are not touching the same part of the code, otherwise we may have merge conflicts.\n\nOne option is to do everything in this ticket (certainly the easiest solution), and the other is to ensure that tickets are completely independent. I let you decide.",
    "created_at": "2020-03-04T12:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410557",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>You have to ensure that tickets are not touching the same part of the code, otherwise we may have merge conflicts.

One option is to do everything in this ticket (certainly the easiest solution), and the other is to ensure that tickets are completely independent. I let you decide.



---

archive/issue_comments_410558.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 dcoudert]:\n> You have to ensure that tickets are not touching the same part of the code, otherwise we may have merge conflicts.\n> \n> One option is to do everything in this ticket (certainly the easiest solution), and the other is to ensure that tickets are completely independent. I let you decide.\n\n\nIf that's the case then, It would be better to go with easiest solution for clean merging.\nBut I dont want to make doctest of ticket #29276 refer to ticket #29275. Can we keep it as it is?",
    "created_at": "2020-03-04T13:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410558",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:15'></a>Replying to [comment:14 dcoudert]:
> You have to ensure that tickets are not touching the same part of the code, otherwise we may have merge conflicts.
> 
> One option is to do everything in this ticket (certainly the easiest solution), and the other is to ensure that tickets are completely independent. I let you decide.


If that's the case then, It would be better to go with easiest solution for clean merging.
But I dont want to make doctest of ticket #29276 refer to ticket #29275. Can we keep it as it is?



---

archive/issue_comments_410559.json:
```json
{
    "body": "<a id='comment:16'></a>If we keep only one ticket, we cannot refer the other ticket.\nYou can adjust the ticket description for instance like:\n- title: `fix issues in the DiGraph constructor for incidence matrix`\n- description: merge all issues.",
    "created_at": "2020-03-04T13:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410559",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:16'></a>If we keep only one ticket, we cannot refer the other ticket.
You can adjust the ticket description for instance like:
- title: `fix issues in the DiGraph constructor for incidence matrix`
- description: merge all issues.



---

archive/issue_comments_410560.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-04T13:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410560",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_410561.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-04T16:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410561",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410562.json:
```json
{
    "body": "<a id='comment:19'></a>LGTM.",
    "created_at": "2020-03-04T16:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410562",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:19'></a>LGTM.



---

archive/issue_events_074467.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T11:27:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29275#event-74467"
}
```



---

archive/issue_comments_410563.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-08T11:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29275",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29275#issuecomment-410563",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
