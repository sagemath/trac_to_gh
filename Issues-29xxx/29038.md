# Issue 29038: Python package sage_conf: Provides optional configuration information for sagelib

archive/issues_028801.json:
```json
{
    "assignees": [],
    "body": "This ticket introduces a new Python package `sage_conf`.\n\n- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n\nA `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n\n```\n$ local/bin/sage-config MAXIMA\n/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n$ local/bin/sage-config\nVERSION=9.1.beta0\nMAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\nSAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\nSAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n```\n\nThe module and the script are used as follows:\n\n1. It provides configuration information to sagelib at installation time (`src/setup.py`).\n\n   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.\n\n2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.\n\n3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).\n\na. By providing `SAGE_LOCAL` as one the configuration variables, it removes assumptions regarding install locations of `sagelib` relative to `$SAGE_LOCAL`. This enables the following: \n- Installing an experimental version of `sagelib` in other install locations, such as in a user site packages directory.\n- Making `sagelib` available in a user's venv, as in the following example:\n   Without this ticket:\n\n   ```\n   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n   $ source ~/personal-sage-venv/bin/activate\n   (personal-sage-venv) $ python\n   >>> import sage.env\n   >>> sage.env.SAGE_LOCAL\n   '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n   >>> import sage.all\n   RuntimeError: You must get the file local/bin/sage-maxima.lisp\n   ```\n   With this ticket:\n\n   ```\n   >>> sage.env.SAGE_LOCAL\n   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n   >>> import sage.all\n   >>> sage.all.maxima('1')\n   1\n   ```\n- #29013/#27824: Using the system python3 via spkg-configure.m4\nb. For a broader context: see #21707 Task: Split `sage-env` into 5\n\n\n**CC:**  @kiwifb @antonio-rojas @isuruf @embray @infinity0 @timokau @jdemeyer @dimpase @jhpalmieri @vbraun\n\n**Branch:** [af18a01e25b70406cf5ea948f550493f065282ae](https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae)\n\n**Reviewer:** Dima Pasechnik, Erik Bray\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/29038\n\n",
    "closed_at": "2020-01-25T17:27:15Z",
    "created_at": "2020-01-18T15:36:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Python package sage_conf: Provides optional configuration information for sagelib",
    "type": "issue",
    "updated_at": "2020-01-31T14:36:54Z",
    "url": "https://github.com/sagemath/sage/issues/29038",
    "user": "https://github.com/mkoeppe"
}
```
This ticket introduces a new Python package `sage_conf`.

- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.

A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:

```
$ local/bin/sage-config MAXIMA
/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
$ local/bin/sage-config
VERSION=9.1.beta0
MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
```

The module and the script are used as follows:

1. It provides configuration information to sagelib at installation time (`src/setup.py`).

   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.

2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.

3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).

a. By providing `SAGE_LOCAL` as one the configuration variables, it removes assumptions regarding install locations of `sagelib` relative to `$SAGE_LOCAL`. This enables the following: 
- Installing an experimental version of `sagelib` in other install locations, such as in a user site packages directory.
- Making `sagelib` available in a user's venv, as in the following example:
   Without this ticket:

   ```
   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
   $ source ~/personal-sage-venv/bin/activate
   (personal-sage-venv) $ python
   >>> import sage.env
   >>> sage.env.SAGE_LOCAL
   '/Users/mkoeppe/personal-sage-venv'                                     # wrong
   >>> import sage.all
   RuntimeError: You must get the file local/bin/sage-maxima.lisp
   ```
   With this ticket:

   ```
   >>> sage.env.SAGE_LOCAL
   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
   >>> import sage.all
   >>> sage.all.maxima('1')
   1
   ```
- #29013/#27824: Using the system python3 via spkg-configure.m4
b. For a broader context: see #21707 Task: Split `sage-env` into 5


**CC:**  @kiwifb @antonio-rojas @isuruf @embray @infinity0 @timokau @jdemeyer @dimpase @jhpalmieri @vbraun

**Branch:** [af18a01e25b70406cf5ea948f550493f065282ae](https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae)

**Reviewer:** Dima Pasechnik, Erik Bray

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/29038





---

archive/issue_events_349843.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-18T15:36:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349843"
}
```



---

archive/issue_events_349844.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-18T15:36:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "08517b",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349844"
}
```



---

archive/issue_events_349845.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-18T15:36:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349845"
}
```



---

archive/issue_comments_456660.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-01-18T17:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456660",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_456661.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,6 @@\n This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.\n \n-- sage-the-distribution will generate this Python package at `./configure` time and install it before attempting to install sagelib using `src/setup.py`.\n-- Distributions will generate and install their own `sage_conf` by a method of their choice.\n+- sage-the-distribution will generate this Python package at `./configure` time and install it before starting to build/install sagelib using `src/setup.py`.\n+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n \n+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)\n``````\n",
    "created_at": "2020-01-18T17:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456661",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,6 @@
 This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.
 
-- sage-the-distribution will generate this Python package at `./configure` time and install it before attempting to install sagelib using `src/setup.py`.
-- Distributions will generate and install their own `sage_conf` by a method of their choice.
+- sage-the-distribution will generate this Python package at `./configure` time and install it before starting to build/install sagelib using `src/setup.py`.
+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
 
+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)
``````




---

archive/issue_comments_456662.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/python_package_sage_conf__provides_optional_configuration_information_for_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/python_package_sage_conf__provides_optional_configuration_information_for_sagelib)",
    "created_at": "2020-01-18T17:36:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456662",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/python_package_sage_conf__provides_optional_configuration_information_for_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/python_package_sage_conf__provides_optional_configuration_information_for_sagelib)



---

archive/issue_events_349846.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-18T17:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349846"
}
```



---

archive/issue_comments_456663.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe5c890e66a7dd37395720b6c8e08a3837e5a74d\">fe5c890</a></td><td><code>29038: Python package sage_conf: Provides configuration information for sagelib</code></td></tr></table>\n",
    "created_at": "2020-01-18T17:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456663",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'>**Comment 3:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe5c890e66a7dd37395720b6c8e08a3837e5a74d">fe5c890</a></td><td><code>29038: Python package sage_conf: Provides configuration information for sagelib</code></td></tr></table>




---

archive/issue_comments_456664.json:
```json
{
    "body": "**Commit:** [fe5c890e66a7dd37395720b6c8e08a3837e5a74d](https://github.com/sagemath/sagetrac-mirror/commit/fe5c890e66a7dd37395720b6c8e08a3837e5a74d)",
    "created_at": "2020-01-18T17:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456664",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [fe5c890e66a7dd37395720b6c8e08a3837e5a74d](https://github.com/sagemath/sagetrac-mirror/commit/fe5c890e66a7dd37395720b6c8e08a3837e5a74d)



---

archive/issue_comments_456665.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aefd827981481f015c696328402278f2f8d30912\">aefd827</a></td><td><code>build/pkgs/sage_conf/spkg-install: Fix up path</code></td></tr></table>\n",
    "created_at": "2020-01-18T20:07:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456665",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>**Comment 4:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aefd827981481f015c696328402278f2f8d30912">aefd827</a></td><td><code>build/pkgs/sage_conf/spkg-install: Fix up path</code></td></tr></table>




---

archive/issue_comments_456666.json:
```json
{
    "body": "**Changing commit** from \"[fe5c890e66a7dd37395720b6c8e08a3837e5a74d](https://github.com/sagemath/sagetrac-mirror/commit/fe5c890e66a7dd37395720b6c8e08a3837e5a74d)\" to \"[aefd827981481f015c696328402278f2f8d30912](https://github.com/sagemath/sagetrac-mirror/commit/aefd827981481f015c696328402278f2f8d30912)\".",
    "created_at": "2020-01-18T20:07:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456666",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[fe5c890e66a7dd37395720b6c8e08a3837e5a74d](https://github.com/sagemath/sagetrac-mirror/commit/fe5c890e66a7dd37395720b6c8e08a3837e5a74d)" to "[aefd827981481f015c696328402278f2f8d30912](https://github.com/sagemath/sagetrac-mirror/commit/aefd827981481f015c696328402278f2f8d30912)".



---

archive/issue_comments_456667.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nwhy are you checking in files which apparently are meant to be generated from .in templates?",
    "created_at": "2020-01-18T20:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456667",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'>**Comment 5:**</a>
why are you checking in files which apparently are meant to be generated from .in templates?



---

archive/issue_comments_456668.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nA mistake, which I will fix in a moment. Thanks!",
    "created_at": "2020-01-18T20:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456668",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>**Comment 6:**</a>
A mistake, which I will fix in a moment. Thanks!



---

archive/issue_comments_456669.json:
```json
{
    "body": "**Changing commit** from \"[aefd827981481f015c696328402278f2f8d30912](https://github.com/sagemath/sagetrac-mirror/commit/aefd827981481f015c696328402278f2f8d30912)\" to \"[88fd03c7784eb82eeb8cb06102ed4e93f5f1d758](https://github.com/sagemath/sagetrac-mirror/commit/88fd03c7784eb82eeb8cb06102ed4e93f5f1d758)\".",
    "created_at": "2020-01-18T20:32:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456669",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[aefd827981481f015c696328402278f2f8d30912](https://github.com/sagemath/sagetrac-mirror/commit/aefd827981481f015c696328402278f2f8d30912)" to "[88fd03c7784eb82eeb8cb06102ed4e93f5f1d758](https://github.com/sagemath/sagetrac-mirror/commit/88fd03c7784eb82eeb8cb06102ed4e93f5f1d758)".



---

archive/issue_comments_456670.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/981e8644e2a2fdcee47537926a5b31045449c784\">981e864</a></td><td><code>Move .gitignore to the right place, remove generated files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88fd03c7784eb82eeb8cb06102ed4e93f5f1d758\">88fd03c</a></td><td><code>Add console_scripts entry_point sage-config</code></td></tr></table>\n",
    "created_at": "2020-01-18T20:32:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456670",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>**Comment 7:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/981e8644e2a2fdcee47537926a5b31045449c784">981e864</a></td><td><code>Move .gitignore to the right place, remove generated files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88fd03c7784eb82eeb8cb06102ed4e93f5f1d758">88fd03c</a></td><td><code>Add console_scripts entry_point sage-config</code></td></tr></table>




---

archive/issue_comments_456671.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,3 +4,16 @@\n - Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n \n (This ticket provides an alternative implementation of #29022 - see there for additional motivation.)\n+\n+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n+\n+```\n+$ local/bin/sage-config MAXIMA\n+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+$ local/bin/sage-config\n+VERSION=9.1.beta0\n+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\n+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n+```\n+\n``````\n",
    "created_at": "2020-01-18T20:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456671",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,3 +4,16 @@
 - Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
 
 (This ticket provides an alternative implementation of #29022 - see there for additional motivation.)
+
+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:
+
+```
+$ local/bin/sage-config MAXIMA
+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+$ local/bin/sage-config
+VERSION=9.1.beta0
+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
+```
+
``````




---

archive/issue_comments_456672.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.\n \n-- sage-the-distribution will generate this Python package at `./configure` time and install it before starting to build/install sagelib using `src/setup.py`.\n+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n - Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n \n (This ticket provides an alternative implementation of #29022 - see there for additional motivation.)\n``````\n",
    "created_at": "2020-01-19T17:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456672",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.
 
-- sage-the-distribution will generate this Python package at `./configure` time and install it before starting to build/install sagelib using `src/setup.py`.
+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
 - Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
 
 (This ticket provides an alternative implementation of #29022 - see there for additional motivation.)
``````




---

archive/issue_comments_456673.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,3 +17,5 @@\n SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n ```\n \n+See also, for a broader context,\n+- #21707 Task: Split sage-env into 5\n``````\n",
    "created_at": "2020-01-19T17:22:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456673",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,3 +17,5 @@
 SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
 ```
 
+See also, for a broader context,
+- #21707 Task: Split sage-env into 5
``````




---

archive/issue_comments_456674.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,7 @@\n-This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.\n+This ticket introduces a new Python package `sage_conf`.\n \n - sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n - Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n-\n-(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)\n \n A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n \n@@ -17,5 +15,38 @@\n SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n ```\n \n-See also, for a broader context,\n-- #21707 Task: Split sage-env into 5\n+The module and the script are used as follows:\n+\n+1. It provides configuration information to sagelib at installation time (`src/setup.py`).\n+\n+2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.\n+\n+3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).\n+\n+a. By providing SAGE_LOCAL as one the configuration variables, it removes assumptions regarding install locations of sagelib relative to $SAGE_LOCAL. This enables the following: \n+- Installing an experimental version of sagelib in other install locations, such as in a user site packages directory.\n+- Making sagelib available in a user's venv, as in the following example:\n+   Without this ticket:\n+\n+   ```\n+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n+   $ source ~/personal-sage-venv/bin/activate\n+   (personal-sage-venv) $ python\n+   >>> import sage.env\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n+   >>> import sage.all\n+   RuntimeError: You must get the file local/bin/sage-maxima.lisp\n+   ```\n+   With this ticket:\n+\n+   ```\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n+   >>> import sage.all\n+   >>> sage.all.maxima('1')\n+   1\n+   ```\n+- #29013/#27824: Using the system python3 via spkg-configure.m4\n+b. For a broader context: see #21707 Task: Split sage-env into 5\n+\n``````\n",
    "created_at": "2020-01-19T17:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456674",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,7 @@
-This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.
+This ticket introduces a new Python package `sage_conf`.
 
 - sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
 - Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
-
-(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)
 
 A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:
 
@@ -17,5 +15,38 @@
 SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
 ```
 
-See also, for a broader context,
-- #21707 Task: Split sage-env into 5
+The module and the script are used as follows:
+
+1. It provides configuration information to sagelib at installation time (`src/setup.py`).
+
+2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.
+
+3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).
+
+a. By providing SAGE_LOCAL as one the configuration variables, it removes assumptions regarding install locations of sagelib relative to $SAGE_LOCAL. This enables the following: 
+- Installing an experimental version of sagelib in other install locations, such as in a user site packages directory.
+- Making sagelib available in a user's venv, as in the following example:
+   Without this ticket:
+
+   ```
+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
+   $ source ~/personal-sage-venv/bin/activate
+   (personal-sage-venv) $ python
+   >>> import sage.env
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong
+   >>> import sage.all
+   RuntimeError: You must get the file local/bin/sage-maxima.lisp
+   ```
+   With this ticket:
+
+   ```
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
+   >>> import sage.all
+   >>> sage.all.maxima('1')
+   1
+   ```
+- #29013/#27824: Using the system python3 via spkg-configure.m4
+b. For a broader context: see #21707 Task: Split sage-env into 5
+
``````




---

archive/issue_comments_456675.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nthe example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?",
    "created_at": "2020-01-19T18:23:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456675",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'>**Comment 12:**</a>
the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?



---

archive/issue_comments_456676.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nReplying to [@dimpase](#comment%3A12):\n> the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?\n\nNot without installing sage packages into the new venv. As far as I can see, one can only control whether system-packages are made available but not whether the originating venv's packages are made available. But I'd expect that this option will be invented at some point in Python.",
    "created_at": "2020-01-19T19:27:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456676",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'>**Comment 13:**</a>
Replying to [@dimpase](#comment%3A12):
> the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?

Not without installing sage packages into the new venv. As far as I can see, one can only control whether system-packages are made available but not whether the originating venv's packages are made available. But I'd expect that this option will be invented at some point in Python.



---

archive/issue_comments_456677.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -18,6 +18,8 @@\n The module and the script are used as follows:\n \n 1. It provides configuration information to sagelib at installation time (`src/setup.py`).\n+\n+   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.\n \n 2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.\n \n``````\n",
    "created_at": "2020-01-19T20:00:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456677",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -18,6 +18,8 @@
 The module and the script are used as follows:
 
 1. It provides configuration information to sagelib at installation time (`src/setup.py`).
+
+   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.
 
 2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.
 
``````




---

archive/issue_comments_456678.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nis `sage_conf` also meant to be used while building Sage's dependencies?",
    "created_at": "2020-01-19T21:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456678",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'>**Comment 15:**</a>
is `sage_conf` also meant to be used while building Sage's dependencies?



---

archive/issue_comments_456679.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nReplying to [@dimpase](#comment%3A15):\n> is `sage_conf` also meant to be used while building Sage's dependencies?\n\nNo.",
    "created_at": "2020-01-19T21:20:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456679",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'>**Comment 16:**</a>
Replying to [@dimpase](#comment%3A15):
> is `sage_conf` also meant to be used while building Sage's dependencies?

No.



---

archive/issue_comments_456680.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\n`author` ought to be either \"The Sage Developers\" (cf https://wiki.sagemath.org/Publications_using_SageMath?action=show&redirect=Publications_using_SAGE)\nor yourself...",
    "created_at": "2020-01-19T21:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456680",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'>**Comment 17:**</a>
`author` ought to be either "The Sage Developers" (cf https://wiki.sagemath.org/Publications_using_SageMath?action=show&redirect=Publications_using_SAGE)
or yourself...



---

archive/issue_comments_456681.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nI copied the metadata from `src/setup.py`",
    "created_at": "2020-01-19T21:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456681",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'>**Comment 18:**</a>
I copied the metadata from `src/setup.py`



---

archive/issue_comments_456682.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nReplying to [@mkoeppe](#comment%3A18):\n> I copied the metadata from `src/setup.py`\n\nthat line is 5.5 years old. With all respect, William has not contributed a line of code to sagemath since 2017.",
    "created_at": "2020-01-19T22:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456682",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'>**Comment 19:**</a>
Replying to [@mkoeppe](#comment%3A18):
> I copied the metadata from `src/setup.py`

that line is 5.5 years old. With all respect, William has not contributed a line of code to sagemath since 2017.



---

archive/issue_comments_456683.json:
```json
{
    "body": "**Changing commit** from \"[88fd03c7784eb82eeb8cb06102ed4e93f5f1d758](https://github.com/sagemath/sagetrac-mirror/commit/88fd03c7784eb82eeb8cb06102ed4e93f5f1d758)\" to \"[f2863760bea085d285709ef848c53e6ce17a65fa](https://github.com/sagemath/sagetrac-mirror/commit/f2863760bea085d285709ef848c53e6ce17a65fa)\".",
    "created_at": "2020-01-20T01:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456683",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[88fd03c7784eb82eeb8cb06102ed4e93f5f1d758](https://github.com/sagemath/sagetrac-mirror/commit/88fd03c7784eb82eeb8cb06102ed4e93f5f1d758)" to "[f2863760bea085d285709ef848c53e6ce17a65fa](https://github.com/sagemath/sagetrac-mirror/commit/f2863760bea085d285709ef848c53e6ce17a65fa)".



---

archive/issue_comments_456684.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2863760bea085d285709ef848c53e6ce17a65fa\">f286376</a></td><td><code>build/pkgs/sage_conf/src/setup.cfg.in: Change author to 'The Sage Developers'</code></td></tr></table>\n",
    "created_at": "2020-01-20T01:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456684",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>**Comment 20:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2863760bea085d285709ef848c53e6ce17a65fa">f286376</a></td><td><code>build/pkgs/sage_conf/src/setup.cfg.in: Change author to 'The Sage Developers'</code></td></tr></table>




---

archive/issue_comments_456685.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -25,9 +25,9 @@\n \n 3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).\n \n-a. By providing SAGE_LOCAL as one the configuration variables, it removes assumptions regarding install locations of sagelib relative to $SAGE_LOCAL. This enables the following: \n-- Installing an experimental version of sagelib in other install locations, such as in a user site packages directory.\n-- Making sagelib available in a user's venv, as in the following example:\n+a. By providing `SAGE_LOCAL` as one the configuration variables, it removes assumptions regarding install locations of `sagelib` relative to `$SAGE_LOCAL`. This enables the following: \n+- Installing an experimental version of `sagelib` in other install locations, such as in a user site packages directory.\n+- Making `sagelib` available in a user's venv, as in the following example:\n    Without this ticket:\n \n    ```\n@@ -50,5 +50,5 @@\n    1\n    ```\n - #29013/#27824: Using the system python3 via spkg-configure.m4\n-b. For a broader context: see #21707 Task: Split sage-env into 5\n+b. For a broader context: see #21707 Task: Split `sage-env` into 5\n \n``````\n",
    "created_at": "2020-01-20T01:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456685",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -25,9 +25,9 @@
 
 3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).
 
-a. By providing SAGE_LOCAL as one the configuration variables, it removes assumptions regarding install locations of sagelib relative to $SAGE_LOCAL. This enables the following: 
-- Installing an experimental version of sagelib in other install locations, such as in a user site packages directory.
-- Making sagelib available in a user's venv, as in the following example:
+a. By providing `SAGE_LOCAL` as one the configuration variables, it removes assumptions regarding install locations of `sagelib` relative to `$SAGE_LOCAL`. This enables the following: 
+- Installing an experimental version of `sagelib` in other install locations, such as in a user site packages directory.
+- Making `sagelib` available in a user's venv, as in the following example:
    Without this ticket:
 
    ```
@@ -50,5 +50,5 @@
    1
    ```
 - #29013/#27824: Using the system python3 via spkg-configure.m4
-b. For a broader context: see #21707 Task: Split sage-env into 5
+b. For a broader context: see #21707 Task: Split `sage-env` into 5
 
``````




---

archive/issue_comments_456686.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nI don't seem to get `local/bin/sage-config` - it is not on the branch?",
    "created_at": "2020-01-20T22:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456686",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'>**Comment 22:**</a>
I don't seem to get `local/bin/sage-config` - it is not on the branch?



---

archive/issue_comments_456687.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\notherwise the branch builds and passes tests on a Debian system",
    "created_at": "2020-01-20T22:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456687",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'>**Comment 23:**</a>
otherwise the branch builds and passes tests on a Debian system



---

archive/issue_comments_456688.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nReplying to [@dimpase](#comment%3A22):\n> I don't seem to get `local/bin/sage-config` - it is not on the branch?\n\nStrange. Can you post the output of \"sage -f sage_conf\"?",
    "created_at": "2020-01-20T22:17:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456688",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>**Comment 24:**</a>
Replying to [@dimpase](#comment%3A22):
> I don't seem to get `local/bin/sage-config` - it is not on the branch?

Strange. Can you post the output of "sage -f sage_conf"?



---

archive/issue_comments_456689.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4205a776e9563a9d1db72541df7fef2d7a9f8c0\">a4205a7</a></td><td><code>build/pkgs/sage_conf/src/setup.cfg.in: Use py_modules instead of packages</code></td></tr></table>\n",
    "created_at": "2020-01-21T00:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456689",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'>**Comment 25:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4205a776e9563a9d1db72541df7fef2d7a9f8c0">a4205a7</a></td><td><code>build/pkgs/sage_conf/src/setup.cfg.in: Use py_modules instead of packages</code></td></tr></table>




---

archive/issue_comments_456690.json:
```json
{
    "body": "**Changing commit** from \"[f2863760bea085d285709ef848c53e6ce17a65fa](https://github.com/sagemath/sagetrac-mirror/commit/f2863760bea085d285709ef848c53e6ce17a65fa)\" to \"[a4205a776e9563a9d1db72541df7fef2d7a9f8c0](https://github.com/sagemath/sagetrac-mirror/commit/a4205a776e9563a9d1db72541df7fef2d7a9f8c0)\".",
    "created_at": "2020-01-21T00:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456690",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f2863760bea085d285709ef848c53e6ce17a65fa](https://github.com/sagemath/sagetrac-mirror/commit/f2863760bea085d285709ef848c53e6ce17a65fa)" to "[a4205a776e9563a9d1db72541df7fef2d7a9f8c0](https://github.com/sagemath/sagetrac-mirror/commit/a4205a776e9563a9d1db72541df7fef2d7a9f8c0)".



---

archive/issue_comments_456691.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nwith the latest commit I get an error from sage -f sage_conf\n\n```\nmake[1]: Entering directory '/home/dimpase/sage/build/make'\ncd '/home/dimpase/sage' && source '/home/dimpase/sage/src/bin/sage-env' && sage-logger -p '/home/dimpase/sage/build/pkgs/sage_conf/spkg-install' '/home/dimpase/sage/logs/pkgs/sage_conf.log'\n[sage_conf] /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: 4: /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: source: not found\n[sage_conf] Error: failed to source /home/dimpase/sage/build/bin/sage-dist-helpers\n[sage_conf] Is /home/dimpase/sage the correct SAGE_ROOT?\nmake[1]: *** [Makefile:2240: sage_conf] Error 1\nmake[1]: Leaving directory '/home/dimpase/sage/build/make'\n\nreal\t0m0.137s\nuser\t0m0.076s\nsys\t0m0.066s\n***************************************************************\nError building Sage.\n\nThe following package(s) may have failed to build (not necessarily\nduring this run of 'make sage_conf'):\n\n* package: sage_conf\n  log file: /home/dimpase/sage/logs/pkgs/sage_conf.log\n  build directory: /home/dimpase/sage/local/var/tmp/sage/build/sage_conf\n```",
    "created_at": "2020-01-21T11:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456691",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'>**Comment 26:**</a>
with the latest commit I get an error from sage -f sage_conf

```
make[1]: Entering directory '/home/dimpase/sage/build/make'
cd '/home/dimpase/sage' && source '/home/dimpase/sage/src/bin/sage-env' && sage-logger -p '/home/dimpase/sage/build/pkgs/sage_conf/spkg-install' '/home/dimpase/sage/logs/pkgs/sage_conf.log'
[sage_conf] /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: 4: /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: source: not found
[sage_conf] Error: failed to source /home/dimpase/sage/build/bin/sage-dist-helpers
[sage_conf] Is /home/dimpase/sage the correct SAGE_ROOT?
make[1]: *** [Makefile:2240: sage_conf] Error 1
make[1]: Leaving directory '/home/dimpase/sage/build/make'

real	0m0.137s
user	0m0.076s
sys	0m0.066s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make sage_conf'):

* package: sage_conf
  log file: /home/dimpase/sage/logs/pkgs/sage_conf.log
  build directory: /home/dimpase/sage/local/var/tmp/sage/build/sage_conf
```



---

archive/issue_comments_456692.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nsimply due to Debian's /bin/sh not knowing what `source` is:\n\n```\n$ /bin/sh\n$ source \n/bin/sh: 1: source: not found\n```",
    "created_at": "2020-01-21T11:08:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456692",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'>**Comment 27:**</a>
simply due to Debian's /bin/sh not knowing what `source` is:

```
$ /bin/sh
$ source 
/bin/sh: 1: source: not found
```



---

archive/issue_comments_456693.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nI suppose the 1st line got to be\n\n```\n#!/usr/bin/env bash\n```\n\nTrying this now.",
    "created_at": "2020-01-21T11:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456693",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'>**Comment 28:**</a>
I suppose the 1st line got to be

```
#!/usr/bin/env bash
```

Trying this now.



---

archive/issue_comments_456694.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nOK, with the latter fix, it completes, and also\n\n```\n$ ./local/bin/sage-config\nVERSION=9.1.beta0\nMAXIMA=/home/dimpase/sage/local/bin/maxima\nSAGE_LOCAL=/home/dimpase/sage/local\nSAGE_ROOT=/home/dimpase/sage\n```\nworks.\n\n\\begin{lament}\n\nAn annoying thing is that `sage -f sage_conf` did cause `./configure` to be run like 4 or 5 times, I really lost count. \nThis is a by-product of `sage -f/-i` changing the configuration.\nSee #27373.\n\nI really think we should get rid of these snowflake `sage -f/-i` and do `./configure && make` :-)\n \n\n\\end{lament}",
    "created_at": "2020-01-21T11:22:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456694",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'>**Comment 29:**</a>
OK, with the latter fix, it completes, and also

```
$ ./local/bin/sage-config
VERSION=9.1.beta0
MAXIMA=/home/dimpase/sage/local/bin/maxima
SAGE_LOCAL=/home/dimpase/sage/local
SAGE_ROOT=/home/dimpase/sage
```
works.

\begin{lament}

An annoying thing is that `sage -f sage_conf` did cause `./configure` to be run like 4 or 5 times, I really lost count. 
This is a by-product of `sage -f/-i` changing the configuration.
See #27373.

I really think we should get rid of these snowflake `sage -f/-i` and do `./configure && make` :-)
 

\end{lament}



---

archive/issue_comments_456695.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\n`$ sage -python -m venv --system-site-packages ~/personal-sage-venv/`\nalso works as advertised by this ticket.",
    "created_at": "2020-01-21T11:28:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456695",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'>**Comment 30:**</a>
`$ sage -python -m venv --system-site-packages ~/personal-sage-venv/`
also works as advertised by this ticket.



---

archive/issue_comments_456696.json:
```json
{
    "body": "**Work Issues:** use bash, not /bin/sh",
    "created_at": "2020-01-21T11:29:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456696",
    "user": "https://github.com/dimpase"
}
```

**Work Issues:** use bash, not /bin/sh



---

archive/issue_comments_456697.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-01-21T11:29:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456697",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_349847.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-21T11:29:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349847"
}
```



---

archive/issue_events_349848.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-21T11:29:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349848"
}
```



---

archive/issue_comments_456698.json:
```json
{
    "body": "**Changing commit** from \"[a4205a776e9563a9d1db72541df7fef2d7a9f8c0](https://github.com/sagemath/sagetrac-mirror/commit/a4205a776e9563a9d1db72541df7fef2d7a9f8c0)\" to \"[747b05a5364d1e939533648dbae6dde9fbc75363](https://github.com/sagemath/sagetrac-mirror/commit/747b05a5364d1e939533648dbae6dde9fbc75363)\".",
    "created_at": "2020-01-21T14:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456698",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a4205a776e9563a9d1db72541df7fef2d7a9f8c0](https://github.com/sagemath/sagetrac-mirror/commit/a4205a776e9563a9d1db72541df7fef2d7a9f8c0)" to "[747b05a5364d1e939533648dbae6dde9fbc75363](https://github.com/sagemath/sagetrac-mirror/commit/747b05a5364d1e939533648dbae6dde9fbc75363)".



---

archive/issue_comments_456699.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/747b05a5364d1e939533648dbae6dde9fbc75363\">747b05a</a></td><td><code>build/pkgs/sage_conf/spkg-install: Use bash, not sh</code></td></tr></table>\n",
    "created_at": "2020-01-21T14:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456699",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>**Comment 32:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/747b05a5364d1e939533648dbae6dde9fbc75363">747b05a</a></td><td><code>build/pkgs/sage_conf/spkg-install: Use bash, not sh</code></td></tr></table>




---

archive/issue_events_349849.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-21T14:11:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349849"
}
```



---

archive/issue_events_349850.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-21T14:11:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349850"
}
```



---

archive/issue_comments_456700.json:
```json
{
    "body": "**Changing work issues** from \"use bash, not /bin/sh\" to \"\".",
    "created_at": "2020-01-21T14:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456700",
    "user": "https://github.com/mkoeppe"
}
```

**Changing work issues** from "use bash, not /bin/sh" to "".



---

archive/issue_events_349851.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-21T14:33:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349851"
}
```



---

archive/issue_events_349852.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-21T14:33:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349852"
}
```



---

archive/issue_comments_456701.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nOK.",
    "created_at": "2020-01-21T14:33:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456701",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'>**Comment 34:**</a>
OK.



---

archive/issue_comments_456702.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nThank you!",
    "created_at": "2020-01-21T14:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456702",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'>**Comment 35:**</a>
Thank you!



---

archive/issue_events_349853.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-22T11:04:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349853"
}
```



---

archive/issue_events_349854.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-22T11:04:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349854"
}
```



---

archive/issue_comments_456703.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nFor the argument parsing please just use argparse.",
    "created_at": "2020-01-22T11:04:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456703",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'>**Comment 36:**</a>
For the argument parsing please just use argparse.



---

archive/issue_comments_456704.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nI don't understand this line:\n\n```\nMAXIMA = \"@prefix@/bin/maxima\"\n```\n\nWhy assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.",
    "created_at": "2020-01-22T11:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456704",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'>**Comment 37:**</a>
I don't understand this line:

```
MAXIMA = "@prefix@/bin/maxima"
```

Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.



---

archive/issue_comments_456705.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nReplying to [@embray](#comment%3A37):\n> I don't understand this line:\n> \n> ```\n> MAXIMA = \"@prefix@/bin/maxima\"\n> ```\n> \n> Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.\n\nAs long as we don't have spkg-configure.m4 for maxima, it's OK.",
    "created_at": "2020-01-22T11:13:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456705",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'>**Comment 38:**</a>
Replying to [@embray](#comment%3A37):
> I don't understand this line:
> 
> ```
> MAXIMA = "@prefix@/bin/maxima"
> ```
> 
> Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.

As long as we don't have spkg-configure.m4 for maxima, it's OK.



---

archive/issue_comments_456706.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nThe idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, it's installed like this:\n\n```\n# ============================= script packages ==============================\n# Generate build rules for 'script' packages; this template is used to generate\n# two rules in the form:\n#\n# <pkgname>: <dependencies>\n#     $(AM_V_at)cd '$SAGE_ROOT' && \\\\\n#         source '$SAGE_ROOT/src/bin/sage-env' && \\\\\n#         sage-logger -p '$SAGE_ROOT/build/pkgs/<pkgname>/spkg-install' '$(SAGE_LOGS)/<pkgname>.log'\n```\n\nSo it already sources `sage-env`, but not `sage-dist-helpers`.  \n\nLooking at the handful of other `spkg-install` scripts for the type=script packages, they might not work properly anyways since they don't get the \"wrapper\" treatment that other spkg-install scripts now get from `sage-spkg` (that didn't used to be the case.  \n\nI would make the splitting up of sage-env a prerequisite to this, and at a minimum ensure that sage-dist-helpers is already sourced in the build env.  Then you could do away with the extra boilerplate at the top of the `spkg-install` for this.",
    "created_at": "2020-01-22T11:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456706",
    "user": "https://github.com/embray"
}
```

<a id='comment:39'>**Comment 39:**</a>
The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, it's installed like this:

```
# ============================= script packages ==============================
# Generate build rules for 'script' packages; this template is used to generate
# two rules in the form:
#
# <pkgname>: <dependencies>
#     $(AM_V_at)cd '$SAGE_ROOT' && \\
#         source '$SAGE_ROOT/src/bin/sage-env' && \\
#         sage-logger -p '$SAGE_ROOT/build/pkgs/<pkgname>/spkg-install' '$(SAGE_LOGS)/<pkgname>.log'
```

So it already sources `sage-env`, but not `sage-dist-helpers`.  

Looking at the handful of other `spkg-install` scripts for the type=script packages, they might not work properly anyways since they don't get the "wrapper" treatment that other spkg-install scripts now get from `sage-spkg` (that didn't used to be the case.  

I would make the splitting up of sage-env a prerequisite to this, and at a minimum ensure that sage-dist-helpers is already sourced in the build env.  Then you could do away with the extra boilerplate at the top of the `spkg-install` for this.



---

archive/issue_comments_456707.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nReplying to [@dimpase](#comment%3A38):\n> Replying to [@embray](#comment%3A37):\n> > I don't understand this line:\n> > \n> > ```\n> > MAXIMA = \"@prefix@/bin/maxima\"\n> > ```\n> > \n> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.\n\n> \n> As long as we don't have spkg-configure.m4 for maxima, it's OK.\n> \n\nYes, I suppose, though this would have to be changed later if it were added.",
    "created_at": "2020-01-22T11:17:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456707",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'>**Comment 40:**</a>
Replying to [@dimpase](#comment%3A38):
> Replying to [@embray](#comment%3A37):
> > I don't understand this line:
> > 
> > ```
> > MAXIMA = "@prefix@/bin/maxima"
> > ```
> > 
> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.

> 
> As long as we don't have spkg-configure.m4 for maxima, it's OK.
> 

Yes, I suppose, though this would have to be changed later if it were added.



---

archive/issue_comments_456708.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\nIn the `setup.cfg` this should not be necessary:\n\n```\n+setup_requires =\n+    setuptools\n```\n\nThe standard now for specifying build-time dependencies is to add a pyproject.toml file.",
    "created_at": "2020-01-22T11:19:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456708",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'>**Comment 41:**</a>
In the `setup.cfg` this should not be necessary:

```
+setup_requires =
+    setuptools
```

The standard now for specifying build-time dependencies is to add a pyproject.toml file.



---

archive/issue_comments_456709.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\nNot to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file.  In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.\n\nAll of the data provided by this module can go in a config file, similarly to Numpy's `site.cfg`.  It can even go directly in `setup.cfg` under a Sage-specific section, but probably better a separate file that doesn't need to be patched.\n\nIf you want to install the data along with the sage package it can be added to `package_data`.  If you look at Sage's setup.py it already has one other `package_data` file.  Adding one more is not really a problem, issues like #22655 nonwithstanding.  The file can be generated by the `setup.py`, which is not that unusual a thing to do.  If all this is to just avoid questions of how to update `setup.py`, I can help with that.",
    "created_at": "2020-01-22T11:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456709",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'>**Comment 42:**</a>
Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file.  In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.

All of the data provided by this module can go in a config file, similarly to Numpy's `site.cfg`.  It can even go directly in `setup.cfg` under a Sage-specific section, but probably better a separate file that doesn't need to be patched.

If you want to install the data along with the sage package it can be added to `package_data`.  If you look at Sage's setup.py it already has one other `package_data` file.  Adding one more is not really a problem, issues like #22655 nonwithstanding.  The file can be generated by the `setup.py`, which is not that unusual a thing to do.  If all this is to just avoid questions of how to update `setup.py`, I can help with that.



---

archive/issue_comments_456710.json:
```json
{
    "body": "<a id='comment:43'>**Comment 43:**</a>\nThis fix (adding the MAXIMA variable) is definitely good anything else in this ticket aside, and I'd approve right away as a separate ticket:\n\n```\n@@ -186,6 +192,7 @@ var('MTXLIB',                        join(SAGE_SHARE, 'meataxe'))\n var('THREEJS_DIR',                   join(SAGE_SHARE, 'threejs'))\n var('SINGULARPATH',                  join(SAGE_SHARE, 'singular'))\n var('PPLPY_DOCS',                    join(SAGE_SHARE, 'doc', 'pplpy'))\n+var('MAXIMA',                        'maxima')\n var('MAXIMA_FAS')\n var('SAGE_NAUTY_BINS_PREFIX', '')\n \ndiff --git a/src/sage/interfaces/maxima.py b/src/sage/interfaces/maxima.py\nindex eacbc4c..d6d37fe 100644\n--- a/src/sage/interfaces/maxima.py\n+++ b/src/sage/interfaces/maxima.py\n@@ -472,7 +472,7 @@ import pexpect\n \n from random import randrange\n \n-from sage.env import DOT_SAGE, SAGE_LOCAL\n+from sage.env import DOT_SAGE, SAGE_LOCAL, MAXIMA\n from sage.misc.misc import ECL_TMP\n \n from .expect import (Expect, ExpectElement, gc_disabled)\n@@ -546,7 +546,7 @@ class Maxima(MaximaAbstract, Expect):\n         Expect.__init__(self,\n                         name = 'maxima',\n                         prompt = r'\\(\\%i[0-9]+\\) ',\n-                        command = 'maxima -p \"{0}\"'.format(STARTUP),\n+                        command = '\"{0}\" -p \"{1}\"'.format(MAXIMA, STARTUP),\n                         env = {'TMPDIR': str(ECL_TMP)},\n                         script_subdirectory = script_subdirectory,\n                         restart_on_ctrlc = False,\n```",
    "created_at": "2020-01-22T11:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456710",
    "user": "https://github.com/embray"
}
```

<a id='comment:43'>**Comment 43:**</a>
This fix (adding the MAXIMA variable) is definitely good anything else in this ticket aside, and I'd approve right away as a separate ticket:

```
@@ -186,6 +192,7 @@ var('MTXLIB',                        join(SAGE_SHARE, 'meataxe'))
 var('THREEJS_DIR',                   join(SAGE_SHARE, 'threejs'))
 var('SINGULARPATH',                  join(SAGE_SHARE, 'singular'))
 var('PPLPY_DOCS',                    join(SAGE_SHARE, 'doc', 'pplpy'))
+var('MAXIMA',                        'maxima')
 var('MAXIMA_FAS')
 var('SAGE_NAUTY_BINS_PREFIX', '')
 
diff --git a/src/sage/interfaces/maxima.py b/src/sage/interfaces/maxima.py
index eacbc4c..d6d37fe 100644
--- a/src/sage/interfaces/maxima.py
+++ b/src/sage/interfaces/maxima.py
@@ -472,7 +472,7 @@ import pexpect
 
 from random import randrange
 
-from sage.env import DOT_SAGE, SAGE_LOCAL
+from sage.env import DOT_SAGE, SAGE_LOCAL, MAXIMA
 from sage.misc.misc import ECL_TMP
 
 from .expect import (Expect, ExpectElement, gc_disabled)
@@ -546,7 +546,7 @@ class Maxima(MaximaAbstract, Expect):
         Expect.__init__(self,
                         name = 'maxima',
                         prompt = r'\(\%i[0-9]+\) ',
-                        command = 'maxima -p "{0}"'.format(STARTUP),
+                        command = '"{0}" -p "{1}"'.format(MAXIMA, STARTUP),
                         env = {'TMPDIR': str(ECL_TMP)},
                         script_subdirectory = script_subdirectory,
                         restart_on_ctrlc = False,
```



---

archive/issue_comments_456711.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\nReplying to [@embray](#comment%3A42):\n> Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. \n\nit is easier to make data available in Python if it is packaged as a Python module.\nOtherwise you need to read a plain text file from somewhere etc etc.",
    "created_at": "2020-01-22T11:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456711",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'>**Comment 44:**</a>
Replying to [@embray](#comment%3A42):
> Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 

it is easier to make data available in Python if it is packaged as a Python module.
Otherwise you need to read a plain text file from somewhere etc etc.



---

archive/issue_comments_456712.json:
```json
{
    "body": "<a id='comment:45'>**Comment 45:**</a>\nReplying to [@dimpase](#comment%3A44):\n> Replying to [@embray](#comment%3A42):\n> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. \n\n> \n> it is easier to make data available in Python if it is packaged as a Python module.\n> Otherwise you need to read a plain text file from somewhere etc etc.\n\nperhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.",
    "created_at": "2020-01-22T11:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456712",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'>**Comment 45:**</a>
Replying to [@dimpase](#comment%3A44):
> Replying to [@embray](#comment%3A42):
> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 

> 
> it is easier to make data available in Python if it is packaged as a Python module.
> Otherwise you need to read a plain text file from somewhere etc etc.

perhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.



---

archive/issue_comments_456713.json:
```json
{
    "body": "<a id='comment:46'>**Comment 46:**</a>\nReplying to [@dimpase](#comment%3A45):\n> Replying to [@dimpase](#comment%3A44):\n> > Replying to [@embray](#comment%3A42):\n> > > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. \n\n> > \n> > it is easier to make data available in Python if it is packaged as a Python module.\n> > Otherwise you need to read a plain text file from somewhere etc etc.\n\n> \n> perhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.\n\nHave you looked at the [sysconfig](https://github.com/python/cpython/blob/5bbac8cbdf140ebce446ea4e7db2b20a5d7b8402/Lib/sysconfig.py) module?  None of it is generated.  In fact, Python installs the Makefile it was built with, and sysconfig.py reads it.  I'm not advocating *that* approach either, but something closer to it.\n\nThat said, having a generated Python file for this configuration is something I'd bend on.  I don't think it needs to be a .py module but *shrug*.  I added a comment on #29022 which I hope clarifies what I think this should be.\n\nI *do* like that addition of a `sage-config` script.  That could just be part of the `sage` package itself though; no need for an module external to `sage` that I can see.",
    "created_at": "2020-01-22T12:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456713",
    "user": "https://github.com/embray"
}
```

<a id='comment:46'>**Comment 46:**</a>
Replying to [@dimpase](#comment%3A45):
> Replying to [@dimpase](#comment%3A44):
> > Replying to [@embray](#comment%3A42):
> > > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 

> > 
> > it is easier to make data available in Python if it is packaged as a Python module.
> > Otherwise you need to read a plain text file from somewhere etc etc.

> 
> perhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.

Have you looked at the [sysconfig](https://github.com/python/cpython/blob/5bbac8cbdf140ebce446ea4e7db2b20a5d7b8402/Lib/sysconfig.py) module?  None of it is generated.  In fact, Python installs the Makefile it was built with, and sysconfig.py reads it.  I'm not advocating *that* approach either, but something closer to it.

That said, having a generated Python file for this configuration is something I'd bend on.  I don't think it needs to be a .py module but *shrug*.  I added a comment on #29022 which I hope clarifies what I think this should be.

I *do* like that addition of a `sage-config` script.  That could just be part of the `sage` package itself though; no need for an module external to `sage` that I can see.



---

archive/issue_comments_456714.json:
```json
{
    "body": "<a id='comment:47'>**Comment 47:**</a>\nReplying to [@dimpase](#comment%3A44):\n> Replying to [@embray](#comment%3A42):\n> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. \n\n> \n> it is easier to make data available in Python if it is packaged as a Python module.\n> Otherwise you need to read a plain text file from somewhere etc etc.\n\n```\n# sage/env.py\n...\n\nSAGE_ENV_FILE = os.path.join(os.path.dirname(__file__), 'sage.env')\nwith open(SAGE_ENV_FILE) as sage_env:\n    for line in sage_env:\n        key, value = line.split('=', 1)\n        os.environ[key] = value\n\n...\n```\n\nThis format has the advantage that it can also be sourced by a shell script as it's valid shell syntax.\n\nThis is just a suggestion though; the .py equivalent is almost the same except with spaces around the `=`.\n\nAnother version, if you require that the values are quoted (so that it's simultaneously valid shell syntax and Python syntax):\n\n```\nwith open(SAGE_ENV_FILE) as sage_env:\n    exec(sage_env.read(), os.environ)\n```\n\nOr, if we prefer not to override things in `os.environ` we can use `globals()` instead.\n\nPoint being, it's a few lines.\n\nI like this because even if `$SAGE_LOCAL` is not \"activated\" (`sage-env` not sourced), you can run `$SAGE_LOCAL/bin/python -c 'import sage'` and have a working environment.  The necessary environment variables can then also be passed to Sage's external dependencies, without any requirement of modifying the outer shell environment.  To me, that's the primary motivation.  That motivation can still be achieved even if the generated file is a .py module, which is why I'm more open to that; I'm just trying to show that it doesn't  gain all that much in simplicity either.",
    "created_at": "2020-01-22T12:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456714",
    "user": "https://github.com/embray"
}
```

<a id='comment:47'>**Comment 47:**</a>
Replying to [@dimpase](#comment%3A44):
> Replying to [@embray](#comment%3A42):
> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 

> 
> it is easier to make data available in Python if it is packaged as a Python module.
> Otherwise you need to read a plain text file from somewhere etc etc.

```
# sage/env.py
...

SAGE_ENV_FILE = os.path.join(os.path.dirname(__file__), 'sage.env')
with open(SAGE_ENV_FILE) as sage_env:
    for line in sage_env:
        key, value = line.split('=', 1)
        os.environ[key] = value

...
```

This format has the advantage that it can also be sourced by a shell script as it's valid shell syntax.

This is just a suggestion though; the .py equivalent is almost the same except with spaces around the `=`.

Another version, if you require that the values are quoted (so that it's simultaneously valid shell syntax and Python syntax):

```
with open(SAGE_ENV_FILE) as sage_env:
    exec(sage_env.read(), os.environ)
```

Or, if we prefer not to override things in `os.environ` we can use `globals()` instead.

Point being, it's a few lines.

I like this because even if `$SAGE_LOCAL` is not "activated" (`sage-env` not sourced), you can run `$SAGE_LOCAL/bin/python -c 'import sage'` and have a working environment.  The necessary environment variables can then also be passed to Sage's external dependencies, without any requirement of modifying the outer shell environment.  To me, that's the primary motivation.  That motivation can still be achieved even if the generated file is a .py module, which is why I'm more open to that; I'm just trying to show that it doesn't  gain all that much in simplicity either.



---

archive/issue_comments_456715.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nIMHO the internal design of `sysconfig` is a technical detail - given Python's historical dislike of non-Python tooling, no wonder they do it their way.",
    "created_at": "2020-01-22T12:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456715",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'>**Comment 48:**</a>
IMHO the internal design of `sysconfig` is a technical detail - given Python's historical dislike of non-Python tooling, no wonder they do it their way.



---

archive/issue_comments_456716.json:
```json
{
    "body": "<a id='comment:49'>**Comment 49:**</a>\n`globals()`, `exec()`, etc are really measures of last resort. \n\nAnd a plain text file is much more vulnerable to all sorts of problems, too, e.g. it's not checked for syntax by Python...",
    "created_at": "2020-01-22T12:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456716",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'>**Comment 49:**</a>
`globals()`, `exec()`, etc are really measures of last resort. 

And a plain text file is much more vulnerable to all sorts of problems, too, e.g. it's not checked for syntax by Python...



---

archive/issue_comments_456717.json:
```json
{
    "body": "<a id='comment:50'>**Comment 50:**</a>\nReplying to [@embray](#comment%3A39):\n> I would make the splitting up of sage-env a prerequisite to this\n\nI have laid out a plan for splitting of `sage-env` in #21707. It is more complex. The present ticket is an actionable step toward it.",
    "created_at": "2020-01-22T14:15:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456717",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'>**Comment 50:**</a>
Replying to [@embray](#comment%3A39):
> I would make the splitting up of sage-env a prerequisite to this

I have laid out a plan for splitting of `sage-env` in #21707. It is more complex. The present ticket is an actionable step toward it.



---

archive/issue_comments_456718.json:
```json
{
    "body": "<a id='comment:51'>**Comment 51:**</a>\nReplying to [@dimpase](#comment%3A38):\n> Replying to [@embray](#comment%3A37):\n> > I don't understand this line:\n> > \n> > ```\n> > MAXIMA = \"@prefix@/bin/maxima\"\n> > ```\n> > \n> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.\n\n> \n> As long as we don't have spkg-configure.m4 for maxima, it's OK.\n\nYes, of course the intention is that a follow-up ticket will add `spkg-configure.m4`. \n\nI picked this invocation of `maxima` as an illustrating example for this ticket - one of many places where the Python code assumes that externally to the Python process, an environment has been set up. In the systematic of #21707 (\"Split sage-env into 5\"), this example belongs to category 5.",
    "created_at": "2020-01-22T14:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456718",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'>**Comment 51:**</a>
Replying to [@dimpase](#comment%3A38):
> Replying to [@embray](#comment%3A37):
> > I don't understand this line:
> > 
> > ```
> > MAXIMA = "@prefix@/bin/maxima"
> > ```
> > 
> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.

> 
> As long as we don't have spkg-configure.m4 for maxima, it's OK.

Yes, of course the intention is that a follow-up ticket will add `spkg-configure.m4`. 

I picked this invocation of `maxima` as an illustrating example for this ticket - one of many places where the Python code assumes that externally to the Python process, an environment has been set up. In the systematic of #21707 ("Split sage-env into 5"), this example belongs to category 5.



---

archive/issue_comments_456719.json:
```json
{
    "body": "<a id='comment:52'>**Comment 52:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f7adc62326b63292f798fb7b6f276f49b2229d3\">5f7adc6</a></td><td><code>build/pkgs/sage_conf/src/setup.cfg.in: Remove unnecessary setup_requires</code></td></tr></table>\n",
    "created_at": "2020-01-22T14:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456719",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:52'>**Comment 52:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f7adc62326b63292f798fb7b6f276f49b2229d3">5f7adc6</a></td><td><code>build/pkgs/sage_conf/src/setup.cfg.in: Remove unnecessary setup_requires</code></td></tr></table>




---

archive/issue_comments_456720.json:
```json
{
    "body": "**Changing commit** from \"[747b05a5364d1e939533648dbae6dde9fbc75363](https://github.com/sagemath/sagetrac-mirror/commit/747b05a5364d1e939533648dbae6dde9fbc75363)\" to \"[5f7adc62326b63292f798fb7b6f276f49b2229d3](https://github.com/sagemath/sagetrac-mirror/commit/5f7adc62326b63292f798fb7b6f276f49b2229d3)\".",
    "created_at": "2020-01-22T14:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456720",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[747b05a5364d1e939533648dbae6dde9fbc75363](https://github.com/sagemath/sagetrac-mirror/commit/747b05a5364d1e939533648dbae6dde9fbc75363)" to "[5f7adc62326b63292f798fb7b6f276f49b2229d3](https://github.com/sagemath/sagetrac-mirror/commit/5f7adc62326b63292f798fb7b6f276f49b2229d3)".



---

archive/issue_comments_456721.json:
```json
{
    "body": "<a id='comment:53'>**Comment 53:**</a>\nReplying to [@embray](#comment%3A41):\n> In the `setup.cfg` this should not be necessary:\n> \n> ```\n> +setup_requires =\n> +    setuptools\n> ```\n\nThanks, I've removed it.\n\n> The standard now for specifying build-time dependencies is to add a pyproject.toml file.\n\nOur present tooling does not need that file either. I'd suggest we do pyproject.toml business after #21508.",
    "created_at": "2020-01-22T14:28:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456721",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'>**Comment 53:**</a>
Replying to [@embray](#comment%3A41):
> In the `setup.cfg` this should not be necessary:
> 
> ```
> +setup_requires =
> +    setuptools
> ```

Thanks, I've removed it.

> The standard now for specifying build-time dependencies is to add a pyproject.toml file.

Our present tooling does not need that file either. I'd suggest we do pyproject.toml business after #21508.



---

archive/issue_comments_456722.json:
```json
{
    "body": "**Changing commit** from \"[5f7adc62326b63292f798fb7b6f276f49b2229d3](https://github.com/sagemath/sagetrac-mirror/commit/5f7adc62326b63292f798fb7b6f276f49b2229d3)\" to \"[8f8d8e3976d1c891b501e64ecdc094da65cf8239](https://github.com/sagemath/sagetrac-mirror/commit/8f8d8e3976d1c891b501e64ecdc094da65cf8239)\".",
    "created_at": "2020-01-22T14:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456722",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5f7adc62326b63292f798fb7b6f276f49b2229d3](https://github.com/sagemath/sagetrac-mirror/commit/5f7adc62326b63292f798fb7b6f276f49b2229d3)" to "[8f8d8e3976d1c891b501e64ecdc094da65cf8239](https://github.com/sagemath/sagetrac-mirror/commit/8f8d8e3976d1c891b501e64ecdc094da65cf8239)".



---

archive/issue_comments_456723.json:
```json
{
    "body": "<a id='comment:54'>**Comment 54:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f8d8e3976d1c891b501e64ecdc094da65cf8239\">8f8d8e3</a></td><td><code>build/pkgs/sage_conf/spkg-install: Don't source sage-env, as it is sourced already by the build/make/Makefile rule</code></td></tr></table>\n",
    "created_at": "2020-01-22T14:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456723",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:54'>**Comment 54:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f8d8e3976d1c891b501e64ecdc094da65cf8239">8f8d8e3</a></td><td><code>build/pkgs/sage_conf/spkg-install: Don't source sage-env, as it is sourced already by the build/make/Makefile rule</code></td></tr></table>




---

archive/issue_comments_456724.json:
```json
{
    "body": "<a id='comment:55'>**Comment 55:**</a>\nReplying to [@embray](#comment%3A39):\n> The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, [...] it already sources `sage-env`, but not `sage-dist-helpers`.  \n\nThanks! I've simplified `spkg-install` accordingly.",
    "created_at": "2020-01-22T14:34:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456724",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'>**Comment 55:**</a>
Replying to [@embray](#comment%3A39):
> The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, [...] it already sources `sage-env`, but not `sage-dist-helpers`.  

Thanks! I've simplified `spkg-install` accordingly.



---

archive/issue_comments_456725.json:
```json
{
    "body": "<a id='comment:56'>**Comment 56:**</a>\nReplying to [@embray](#comment%3A42):\n>   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.\n\nNo, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. \n\nThe version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.\n\nPackagers will just be able to generate a `sage_conf` module in any way they like. \n\n\nI have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:\n- committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.\n- for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.\n- it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.",
    "created_at": "2020-01-22T14:55:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456725",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'>**Comment 56:**</a>
Replying to [@embray](#comment%3A42):
>   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.

No, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. 

The version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.

Packagers will just be able to generate a `sage_conf` module in any way they like. 


I have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:
- committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.
- for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.
- it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.



---

archive/issue_comments_456726.json:
```json
{
    "body": "**Changing commit** from \"[8f8d8e3976d1c891b501e64ecdc094da65cf8239](https://github.com/sagemath/sagetrac-mirror/commit/8f8d8e3976d1c891b501e64ecdc094da65cf8239)\" to \"[7e34340291bce50f341a047f32f018ae97af6f08](https://github.com/sagemath/sagetrac-mirror/commit/7e34340291bce50f341a047f32f018ae97af6f08)\".",
    "created_at": "2020-01-22T15:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456726",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[8f8d8e3976d1c891b501e64ecdc094da65cf8239](https://github.com/sagemath/sagetrac-mirror/commit/8f8d8e3976d1c891b501e64ecdc094da65cf8239)" to "[7e34340291bce50f341a047f32f018ae97af6f08](https://github.com/sagemath/sagetrac-mirror/commit/7e34340291bce50f341a047f32f018ae97af6f08)".



---

archive/issue_comments_456727.json:
```json
{
    "body": "<a id='comment:57'>**Comment 57:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e34340291bce50f341a047f32f018ae97af6f08\">7e34340</a></td><td><code>build/pkgs/sage_conf/src/sage_conf.py.in: Reimplement _main using argparse</code></td></tr></table>\n",
    "created_at": "2020-01-22T15:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456727",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:57'>**Comment 57:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e34340291bce50f341a047f32f018ae97af6f08">7e34340</a></td><td><code>build/pkgs/sage_conf/src/sage_conf.py.in: Reimplement _main using argparse</code></td></tr></table>




---

archive/issue_comments_456728.json:
```json
{
    "body": "<a id='comment:58'>**Comment 58:**</a>\nReplying to [@embray](#comment%3A36):\n> For the argument parsing please just use argparse.\n\nThanks for the suggestion. Done.",
    "created_at": "2020-01-22T15:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456728",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'>**Comment 58:**</a>
Replying to [@embray](#comment%3A36):
> For the argument parsing please just use argparse.

Thanks for the suggestion. Done.



---

archive/issue_events_349855.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-22T15:42:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349855"
}
```



---

archive/issue_events_349856.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-22T15:42:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349856"
}
```



---

archive/issue_comments_456729.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik\" to \"Dima Pasechnik, Erik Bray\".",
    "created_at": "2020-01-22T15:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456729",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Dima Pasechnik" to "Dima Pasechnik, Erik Bray".



---

archive/issue_comments_456730.json:
```json
{
    "body": "<a id='comment:61'>**Comment 61:**</a>\n\n```\nfrom __future__ import print_function\n+del print_function\n```\nby the way, can you explain these 2 lines",
    "created_at": "2020-01-22T15:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456730",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:61'>**Comment 61:**</a>

```
from __future__ import print_function
+del print_function
```
by the way, can you explain these 2 lines



---

archive/issue_comments_456731.json:
```json
{
    "body": "<a id='comment:62'>**Comment 62:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae\">af18a01</a></td><td><code>Use sys.stdout.write instead of print</code></td></tr></table>\n",
    "created_at": "2020-01-22T16:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456731",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:62'>**Comment 62:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae">af18a01</a></td><td><code>Use sys.stdout.write instead of print</code></td></tr></table>




---

archive/issue_comments_456732.json:
```json
{
    "body": "**Changing commit** from \"[7e34340291bce50f341a047f32f018ae97af6f08](https://github.com/sagemath/sagetrac-mirror/commit/7e34340291bce50f341a047f32f018ae97af6f08)\" to \"[af18a01e25b70406cf5ea948f550493f065282ae](https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae)\".",
    "created_at": "2020-01-22T16:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456732",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[7e34340291bce50f341a047f32f018ae97af6f08](https://github.com/sagemath/sagetrac-mirror/commit/7e34340291bce50f341a047f32f018ae97af6f08)" to "[af18a01e25b70406cf5ea948f550493f065282ae](https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae)".



---

archive/issue_comments_456733.json:
```json
{
    "body": "<a id='comment:63'>**Comment 63:**</a>\nReplying to [@dimpase](#comment%3A61):\n> \n> ```\n> from __future__ import print_function\n> +del print_function\n> ```\n> by the way, can you explain these 2 lines\n\nWithout the `del print_function`, `sage-config` would print a line `print_function=_Feature((2, 6, 0, 'alpha', 2), (3, 0, 0, 'alpha', 0), 65536)`.\n\nBut I have simplified the module by avoiding `print` altogether.",
    "created_at": "2020-01-22T16:31:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456733",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'>**Comment 63:**</a>
Replying to [@dimpase](#comment%3A61):
> 
> ```
> from __future__ import print_function
> +del print_function
> ```
> by the way, can you explain these 2 lines

Without the `del print_function`, `sage-config` would print a line `print_function=_Feature((2, 6, 0, 'alpha', 2), (3, 0, 0, 'alpha', 0), 65536)`.

But I have simplified the module by avoiding `print` altogether.



---

archive/issue_events_349857.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-22T21:49:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349857"
}
```



---

archive/issue_events_349858.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-22T21:49:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349858"
}
```



---

archive/issue_comments_456734.json:
```json
{
    "body": "<a id='comment:64'>**Comment 64:**</a>\nOK for me.",
    "created_at": "2020-01-22T21:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456734",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:64'>**Comment 64:**</a>
OK for me.



---

archive/issue_comments_456735.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/python_package_sage_conf__provides_optional_configuration_information_for_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/python_package_sage_conf__provides_optional_configuration_information_for_sagelib)\" to \"[af18a01e25b70406cf5ea948f550493f065282ae](https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae)\".",
    "created_at": "2020-01-25T17:27:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456735",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/python_package_sage_conf__provides_optional_configuration_information_for_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/python_package_sage_conf__provides_optional_configuration_information_for_sagelib)" to "[af18a01e25b70406cf5ea948f550493f065282ae](https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae)".



---

archive/issue_events_349859.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-25T17:27:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349859"
}
```



---

archive/issue_events_349860.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1c5d011b5f05a954dd2ea810635c9d59cc48e7b5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-25T17:27:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29038#event-349860"
}
```



---

archive/issue_comments_456736.json:
```json
{
    "body": "<a id='comment:66'>**Comment 66:**</a>\nReplying to [@mkoeppe](#comment%3A56):\n> Replying to [@embray](#comment%3A42):\n> >   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.\n\n> \n> No, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. \n> \n> The version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.\n> \n> Packagers will just be able to generate a `sage_conf` module in any way they like. \n> \n> \n> I have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:\n> - committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.\n> - for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.\n> - it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.\n> \n\nBut it's not even documented what this is supposed to provide or how it's supposed to work.  This is all very confusing.\n\nI don't really know what you mean by \"functional\" here.  Do you mean executable?  Why?  Is there a specific reason for that?  In any case I know of all that's needed here is at most a list of environment variables.  In many cases this will just be static.  If a packager has a need to generate some values for those variables programmatically they can do so however they like, but now they have to write a whole Python script that implements some undocumented interface.",
    "created_at": "2020-01-31T11:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456736",
    "user": "https://github.com/embray"
}
```

<a id='comment:66'>**Comment 66:**</a>
Replying to [@mkoeppe](#comment%3A56):
> Replying to [@embray](#comment%3A42):
> >   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.

> 
> No, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. 
> 
> The version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.
> 
> Packagers will just be able to generate a `sage_conf` module in any way they like. 
> 
> 
> I have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:
> - committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.
> - for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.
> - it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.
> 

But it's not even documented what this is supposed to provide or how it's supposed to work.  This is all very confusing.

I don't really know what you mean by "functional" here.  Do you mean executable?  Why?  Is there a specific reason for that?  In any case I know of all that's needed here is at most a list of environment variables.  In many cases this will just be static.  If a packager has a need to generate some values for those variables programmatically they can do so however they like, but now they have to write a whole Python script that implements some undocumented interface.



---

archive/issue_comments_456737.json:
```json
{
    "body": "**Changing commit** from \"[af18a01e25b70406cf5ea948f550493f065282ae](https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae)\" to \"\".",
    "created_at": "2020-01-31T11:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456737",
    "user": "https://github.com/embray"
}
```

**Changing commit** from "[af18a01e25b70406cf5ea948f550493f065282ae](https://github.com/sagemath/sagetrac-mirror/commit/af18a01e25b70406cf5ea948f550493f065282ae)" to "".



---

archive/issue_comments_456738.json:
```json
{
    "body": "<a id='comment:67'>**Comment 67:**</a>\nOnce again, it's more Pythonic to wrap Python-needed things into Python modules, as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls \"functional\".",
    "created_at": "2020-01-31T12:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456738",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:67'>**Comment 67:**</a>
Once again, it's more Pythonic to wrap Python-needed things into Python modules, as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".



---

archive/issue_comments_456739.json:
```json
{
    "body": "<a id='comment:68'>**Comment 68:**</a>\nReplying to [@dimpase](#comment%3A67):\n> Once again, it's more Pythonic to wrap Python-needed things into Python modules\n\n![citation needed]\n\n> as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls \"functional\".\n\nPerhaps you missed it, but as I already explained above this is *exactly* what `sysconfig` does.  You are saying that `sysconfig` is \"unpythonic\".",
    "created_at": "2020-01-31T13:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456739",
    "user": "https://github.com/embray"
}
```

<a id='comment:68'>**Comment 68:**</a>
Replying to [@dimpase](#comment%3A67):
> Once again, it's more Pythonic to wrap Python-needed things into Python modules

![citation needed]

> as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".

Perhaps you missed it, but as I already explained above this is *exactly* what `sysconfig` does.  You are saying that `sysconfig` is "unpythonic".



---

archive/issue_comments_456740.json:
```json
{
    "body": "<a id='comment:69'>**Comment 69:**</a>\nThe larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.",
    "created_at": "2020-01-31T13:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456740",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'>**Comment 69:**</a>
The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.



---

archive/issue_comments_456741.json:
```json
{
    "body": "<a id='comment:70'>**Comment 70:**</a>\nFor reference, again [sysconfig](https://github.com/python/cpython/blob/master/Lib/sysconfig.py), which is a hard-coded Python module which reads from a plain text-file.\n\nAlso recommended, the [venv](https://github.com/python/cpython/blob/master/Lib/venv/__init__.py) module which is actually a lot less mysterious than you guys seem to be making it out to be.  The only magic involved is some support bits coded directly into the Python interpreter used for setting `sys.prefix` correctly (this is one of the few ways `venv` differs from the original `virtualenv` which needed some hacks to achieve this).",
    "created_at": "2020-01-31T13:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456741",
    "user": "https://github.com/embray"
}
```

<a id='comment:70'>**Comment 70:**</a>
For reference, again [sysconfig](https://github.com/python/cpython/blob/master/Lib/sysconfig.py), which is a hard-coded Python module which reads from a plain text-file.

Also recommended, the [venv](https://github.com/python/cpython/blob/master/Lib/venv/__init__.py) module which is actually a lot less mysterious than you guys seem to be making it out to be.  The only magic involved is some support bits coded directly into the Python interpreter used for setting `sys.prefix` correctly (this is one of the few ways `venv` differs from the original `virtualenv` which needed some hacks to achieve this).



---

archive/issue_comments_456742.json:
```json
{
    "body": "<a id='comment:71'>**Comment 71:**</a>\nReplying to [@mkoeppe](#comment%3A69):\n> The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.\n\nThanks, that is useful.  Obviously I've participated in that ticket before, but I wasn't sure if it was *the* ticket tying the rest of this together.  I still believe that steps 3/4/5 can be achieved by different means which merit more discussion.  But I'm on board with the overall plan :)",
    "created_at": "2020-01-31T13:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456742",
    "user": "https://github.com/embray"
}
```

<a id='comment:71'>**Comment 71:**</a>
Replying to [@mkoeppe](#comment%3A69):
> The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.

Thanks, that is useful.  Obviously I've participated in that ticket before, but I wasn't sure if it was *the* ticket tying the rest of this together.  I still believe that steps 3/4/5 can be achieved by different means which merit more discussion.  But I'm on board with the overall plan :)



---

archive/issue_comments_456743.json:
```json
{
    "body": "<a id='comment:72'>**Comment 72:**</a>\nNo problem. I know that it is not always possible to keep up with all developments when there are more important things to do.\n\nAs you see in that plan in #21707, the present ticket on `sage_conf` was a step to cleaning up the sage-env mess. \n\nIt has little to do with my venv-python3 tickets (which I haven't had time to work on). (In fact, I now think that your version at #29032 may, after all, be the simpler way to go at it -- but I have to get back to the python3-spkg-configure business later.)\n\nSo there's no need to mix any \"venv\" discussion into the \"sagelib configuration\" discussion.\n\nThe \"regression\" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch.",
    "created_at": "2020-01-31T13:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456743",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'>**Comment 72:**</a>
No problem. I know that it is not always possible to keep up with all developments when there are more important things to do.

As you see in that plan in #21707, the present ticket on `sage_conf` was a step to cleaning up the sage-env mess. 

It has little to do with my venv-python3 tickets (which I haven't had time to work on). (In fact, I now think that your version at #29032 may, after all, be the simpler way to go at it -- but I have to get back to the python3-spkg-configure business later.)

So there's no need to mix any "venv" discussion into the "sagelib configuration" discussion.

The "regression" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch.



---

archive/issue_comments_456744.json:
```json
{
    "body": "<a id='comment:73'>**Comment 73:**</a>\nReplying to [@embray](#comment%3A68):\n> Replying to [@dimpase](#comment%3A67):\n> > Once again, it's more Pythonic to wrap Python-needed things into Python modules\n\n> \n> ![citation needed]\n\ncf. [`sysconfig`].\n> \n> > as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls \"functional\".\n\n> \n> Perhaps you missed it, but as I already explained above this is *exactly* what `sysconfig` does.  You are saying that `sysconfig` is \"unpythonic\".\n\nNo, obviously Python needs to do some non-Pythonic things under the hood, but then the interface is Pythonic, and `sysconfig` is an example of such an approach.\nYou are somehow against this approach, you say that such wrapping is too complicated, so it should not be done - if you were Python BDFL, you'd not have allowed `sysconfig` in.",
    "created_at": "2020-01-31T14:33:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456744",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:73'>**Comment 73:**</a>
Replying to [@embray](#comment%3A68):
> Replying to [@dimpase](#comment%3A67):
> > Once again, it's more Pythonic to wrap Python-needed things into Python modules

> 
> ![citation needed]

cf. [`sysconfig`].
> 
> > as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".

> 
> Perhaps you missed it, but as I already explained above this is *exactly* what `sysconfig` does.  You are saying that `sysconfig` is "unpythonic".

No, obviously Python needs to do some non-Pythonic things under the hood, but then the interface is Pythonic, and `sysconfig` is an example of such an approach.
You are somehow against this approach, you say that such wrapping is too complicated, so it should not be done - if you were Python BDFL, you'd not have allowed `sysconfig` in.



---

archive/issue_comments_456745.json:
```json
{
    "body": "<a id='comment:74'>**Comment 74:**</a>\nReplying to [@mkoeppe](#comment%3A72):\n> The \"regression\" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch. \n\nFor tickets where merging the current `develop` is not easy, I have prepared #29120 - One-line fix for \"./configure is too sensitive to stray files/subdirectories\".",
    "created_at": "2020-01-31T14:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29038#issuecomment-456745",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'>**Comment 74:**</a>
Replying to [@mkoeppe](#comment%3A72):
> The "regression" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch. 

For tickets where merging the current `develop` is not easy, I have prepared #29120 - One-line fix for "./configure is too sensitive to stray files/subdirectories".
