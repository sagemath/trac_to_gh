# Issue 29038: Python package sage_conf: Provides optional configuration information for sagelib

archive/issues_028801.json:
```json
{
    "body": "This ticket introduces a new Python package `sage_conf`.\n\n- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n\nA `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n\n```\n$ local/bin/sage-config MAXIMA\n/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n$ local/bin/sage-config\nVERSION=9.1.beta0\nMAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\nSAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\nSAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n```\n\nThe module and the script are used as follows:\n\n1. It provides configuration information to sagelib at installation time (`src/setup.py`).\n\n   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.\n\n2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.\n\n3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).\n\na. By providing `SAGE_LOCAL` as one the configuration variables, it removes assumptions regarding install locations of `sagelib` relative to `$SAGE_LOCAL`. This enables the following: \n- Installing an experimental version of `sagelib` in other install locations, such as in a user site packages directory.\n- Making `sagelib` available in a user's venv, as in the following example:\n   Without this ticket:\n   {{{\n   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n   $ source ~/personal-sage-venv/bin/activate\n   (personal-sage-venv) $ python\n   >>> import sage.env\n   >>> sage.env.SAGE_LOCAL\n   '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n   >>> import sage.all\n   RuntimeError: You must get the file local/bin/sage-maxima.lisp\n   }}}\n   With this ticket:\n   {{{\n   >>> sage.env.SAGE_LOCAL\n   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n   >>> import sage.all\n   >>> sage.all.maxima('1')\n   1\n   }}}\n- #29013/#27824: Using the system python3 via spkg-configure.m4\nb. For a broader context: see #21707 Task: Split `sage-env` into 5\n\n\nCC:  @kiwifb @antonio-rojas @isuruf @embray @infinity0 @timokau @jdemeyer @dimpase @jhpalmieri @vbraun\n\nReviewer: Dima Pasechnik, Erik Bray\n\nAuthor: Matthias Koeppe\n\nBranch: af18a01e25b70406cf5ea948f550493f065282ae\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29038\n\n",
    "closed_at": "2020-01-25T17:27:15Z",
    "created_at": "2020-01-18T15:36:44Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Python package sage_conf: Provides optional configuration information for sagelib",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29038",
    "user": "https://github.com/mkoeppe"
}
```
This ticket introduces a new Python package `sage_conf`.

- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.

A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:

```
$ local/bin/sage-config MAXIMA
/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
$ local/bin/sage-config
VERSION=9.1.beta0
MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
```

The module and the script are used as follows:

1. It provides configuration information to sagelib at installation time (`src/setup.py`).

   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.

2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.

3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).

a. By providing `SAGE_LOCAL` as one the configuration variables, it removes assumptions regarding install locations of `sagelib` relative to `$SAGE_LOCAL`. This enables the following: 
- Installing an experimental version of `sagelib` in other install locations, such as in a user site packages directory.
- Making `sagelib` available in a user's venv, as in the following example:
   Without this ticket:
   {{{
   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
   $ source ~/personal-sage-venv/bin/activate
   (personal-sage-venv) $ python
   >>> import sage.env
   >>> sage.env.SAGE_LOCAL
   '/Users/mkoeppe/personal-sage-venv'                                     # wrong
   >>> import sage.all
   RuntimeError: You must get the file local/bin/sage-maxima.lisp
   }}}
   With this ticket:
   {{{
   >>> sage.env.SAGE_LOCAL
   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
   >>> import sage.all
   >>> sage.all.maxima('1')
   1
   }}}
- #29013/#27824: Using the system python3 via spkg-configure.m4
b. For a broader context: see #21707 Task: Split `sage-env` into 5


CC:  @kiwifb @antonio-rojas @isuruf @embray @infinity0 @timokau @jdemeyer @dimpase @jhpalmieri @vbraun

Reviewer: Dima Pasechnik, Erik Bray

Author: Matthias Koeppe

Branch: af18a01e25b70406cf5ea948f550493f065282ae

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29038





---

archive/issue_comments_433259.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,7 +1,9 @@\n This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.\n \n-- sage-the-distribution will generate this Python package at `./configure` time and install it before attempting to install sagelib using `src/setup.py`.\n-- Distributions will generate and install their own `sage_conf` by a method of their choice.\n+- sage-the-distribution will generate this Python package at `./configure` time and install it before starting to build/install sagelib using `src/setup.py`.\n+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n+\n+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)\n \n Comment: 1\n \n```\n",
    "created_at": "2020-01-18T17:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433259",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,7 +1,9 @@
 This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.
 
-- sage-the-distribution will generate this Python package at `./configure` time and install it before attempting to install sagelib using `src/setup.py`.
-- Distributions will generate and install their own `sage_conf` by a method of their choice.
+- sage-the-distribution will generate this Python package at `./configure` time and install it before starting to build/install sagelib using `src/setup.py`.
+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
+
+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)
 
 Comment: 1
 
```




---

archive/issue_comments_433260.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-18T17:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433260",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_433261.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2020-01-18T17:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433261",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_433262.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-18T20:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433263.json:
```json
{
    "body": "<a id='comment:5'></a>why are you checking in files which apparently are meant to be generated from .in templates?",
    "created_at": "2020-01-18T20:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433263",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>why are you checking in files which apparently are meant to be generated from .in templates?



---

archive/issue_comments_433264.json:
```json
{
    "body": "<a id='comment:6'></a>A mistake, which I will fix in a moment. Thanks!",
    "created_at": "2020-01-18T20:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433264",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>A mistake, which I will fix in a moment. Thanks!



---

archive/issue_comments_433265.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-18T20:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433266.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.\n+\n+- sage-the-distribution will generate this Python package at `./configure` time and install it before starting to build/install sagelib using `src/setup.py`.\n+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n+\n+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)\n+\n+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n+\n+```\n+$ local/bin/sage-config MAXIMA\n+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+$ local/bin/sage-config\n+VERSION=9.1.beta0\n+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\n+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n+```\n \n \n Comment: 1\n```\n",
    "created_at": "2020-01-18T20:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433266",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.
+
+- sage-the-distribution will generate this Python package at `./configure` time and install it before starting to build/install sagelib using `src/setup.py`.
+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
+
+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)
+
+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:
+
+```
+$ local/bin/sage-config MAXIMA
+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+$ local/bin/sage-config
+VERSION=9.1.beta0
+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
+```
 
 
 Comment: 1
```




---

archive/issue_comments_433267.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.\n+\n+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n+\n+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)\n+\n+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n+\n+```\n+$ local/bin/sage-config MAXIMA\n+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+$ local/bin/sage-config\n+VERSION=9.1.beta0\n+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\n+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n+```\n \n \n Comment: 1\n```\n",
    "created_at": "2020-01-19T17:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433267",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.
+
+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
+
+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)
+
+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:
+
+```
+$ local/bin/sage-config MAXIMA
+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+$ local/bin/sage-config
+VERSION=9.1.beta0
+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
+```
 
 
 Comment: 1
```




---

archive/issue_comments_433268.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,24 @@\n+This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.\n \n+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n+\n+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)\n+\n+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n+\n+```\n+$ local/bin/sage-config MAXIMA\n+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+$ local/bin/sage-config\n+VERSION=9.1.beta0\n+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\n+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n+```\n+\n+See also, for a broader context,\n+- #21707 Task: Split sage-env into 5\n \n Comment: 1\n \n```\n",
    "created_at": "2020-01-19T17:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433268",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,24 @@
+This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.
 
+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
+
+(This ticket provides an alternative implementation of #29022 - see there for additional motivation.)
+
+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:
+
+```
+$ local/bin/sage-config MAXIMA
+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+$ local/bin/sage-config
+VERSION=9.1.beta0
+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
+```
+
+See also, for a broader context,
+- #21707 Task: Split sage-env into 5
 
 Comment: 1
 
```




---

archive/issue_comments_433269.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,52 @@\n+This ticket introduces a new Python package `sage_conf`.\n+\n+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n+\n+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n+\n+```\n+$ local/bin/sage-config MAXIMA\n+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+$ local/bin/sage-config\n+VERSION=9.1.beta0\n+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\n+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n+```\n+\n+The module and the script are used as follows:\n+\n+1. It provides configuration information to sagelib at installation time (`src/setup.py`).\n+\n+2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.\n+\n+3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).\n+\n+a. By providing SAGE_LOCAL as one the configuration variables, it removes assumptions regarding install locations of sagelib relative to $SAGE_LOCAL. This enables the following: \n+- Installing an experimental version of sagelib in other install locations, such as in a user site packages directory.\n+- Making sagelib available in a user's venv, as in the following example:\n+   Without this ticket:\n+   {{{\n+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n+   $ source ~/personal-sage-venv/bin/activate\n+   (personal-sage-venv) $ python\n+   >>> import sage.env\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n+   >>> import sage.all\n+   RuntimeError: You must get the file local/bin/sage-maxima.lisp\n+   }}}\n+   With this ticket:\n+   {{{\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n+   >>> import sage.all\n+   >>> sage.all.maxima('1')\n+   1\n+   }}}\n+- #29013/#27824: Using the system python3 via spkg-configure.m4\n+b. For a broader context: see #21707 Task: Split sage-env into 5\n \n \n Comment: 1\n```\n",
    "created_at": "2020-01-19T17:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433269",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,52 @@
+This ticket introduces a new Python package `sage_conf`.
+
+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
+
+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:
+
+```
+$ local/bin/sage-config MAXIMA
+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+$ local/bin/sage-config
+VERSION=9.1.beta0
+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
+```
+
+The module and the script are used as follows:
+
+1. It provides configuration information to sagelib at installation time (`src/setup.py`).
+
+2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.
+
+3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).
+
+a. By providing SAGE_LOCAL as one the configuration variables, it removes assumptions regarding install locations of sagelib relative to $SAGE_LOCAL. This enables the following: 
+- Installing an experimental version of sagelib in other install locations, such as in a user site packages directory.
+- Making sagelib available in a user's venv, as in the following example:
+   Without this ticket:
+   {{{
+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
+   $ source ~/personal-sage-venv/bin/activate
+   (personal-sage-venv) $ python
+   >>> import sage.env
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong
+   >>> import sage.all
+   RuntimeError: You must get the file local/bin/sage-maxima.lisp
+   }}}
+   With this ticket:
+   {{{
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
+   >>> import sage.all
+   >>> sage.all.maxima('1')
+   1
+   }}}
+- #29013/#27824: Using the system python3 via spkg-configure.m4
+b. For a broader context: see #21707 Task: Split sage-env into 5
 
 
 Comment: 1
```




---

archive/issue_comments_433270.json:
```json
{
    "body": "<a id='comment:12'></a>the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?",
    "created_at": "2020-01-19T18:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433270",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?



---

archive/issue_comments_433271.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 dimpase]:\n> the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?\n\nNot without installing sage packages into the new venv. As far as I can see, one can only control whether system-packages are made available but not whether the originating venv's packages are made available. But I'd expect that this option will be invented at some point in Python.",
    "created_at": "2020-01-19T19:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433271",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Replying to [comment:12 dimpase]:
> the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?

Not without installing sage packages into the new venv. As far as I can see, one can only control whether system-packages are made available but not whether the originating venv's packages are made available. But I'd expect that this option will be invented at some point in Python.



---

archive/issue_comments_433272.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,54 @@\n+This ticket introduces a new Python package `sage_conf`.\n+\n+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n+\n+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n+\n+```\n+$ local/bin/sage-config MAXIMA\n+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+$ local/bin/sage-config\n+VERSION=9.1.beta0\n+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\n+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n+```\n+\n+The module and the script are used as follows:\n+\n+1. It provides configuration information to sagelib at installation time (`src/setup.py`).\n+\n+   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.\n+\n+2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.\n+\n+3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).\n+\n+a. By providing SAGE_LOCAL as one the configuration variables, it removes assumptions regarding install locations of sagelib relative to $SAGE_LOCAL. This enables the following: \n+- Installing an experimental version of sagelib in other install locations, such as in a user site packages directory.\n+- Making sagelib available in a user's venv, as in the following example:\n+   Without this ticket:\n+   {{{\n+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n+   $ source ~/personal-sage-venv/bin/activate\n+   (personal-sage-venv) $ python\n+   >>> import sage.env\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n+   >>> import sage.all\n+   RuntimeError: You must get the file local/bin/sage-maxima.lisp\n+   }}}\n+   With this ticket:\n+   {{{\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n+   >>> import sage.all\n+   >>> sage.all.maxima('1')\n+   1\n+   }}}\n+- #29013/#27824: Using the system python3 via spkg-configure.m4\n+b. For a broader context: see #21707 Task: Split sage-env into 5\n \n \n Comment: 1\n```\n",
    "created_at": "2020-01-19T20:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433272",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,54 @@
+This ticket introduces a new Python package `sage_conf`.
+
+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
+
+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:
+
+```
+$ local/bin/sage-config MAXIMA
+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+$ local/bin/sage-config
+VERSION=9.1.beta0
+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
+```
+
+The module and the script are used as follows:
+
+1. It provides configuration information to sagelib at installation time (`src/setup.py`).
+
+   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.
+
+2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.
+
+3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).
+
+a. By providing SAGE_LOCAL as one the configuration variables, it removes assumptions regarding install locations of sagelib relative to $SAGE_LOCAL. This enables the following: 
+- Installing an experimental version of sagelib in other install locations, such as in a user site packages directory.
+- Making sagelib available in a user's venv, as in the following example:
+   Without this ticket:
+   {{{
+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
+   $ source ~/personal-sage-venv/bin/activate
+   (personal-sage-venv) $ python
+   >>> import sage.env
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong
+   >>> import sage.all
+   RuntimeError: You must get the file local/bin/sage-maxima.lisp
+   }}}
+   With this ticket:
+   {{{
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
+   >>> import sage.all
+   >>> sage.all.maxima('1')
+   1
+   }}}
+- #29013/#27824: Using the system python3 via spkg-configure.m4
+b. For a broader context: see #21707 Task: Split sage-env into 5
 
 
 Comment: 1
```




---

archive/issue_comments_433273.json:
```json
{
    "body": "<a id='comment:15'></a>is `sage_conf` also meant to be used while building Sage's dependencies?",
    "created_at": "2020-01-19T21:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433273",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>is `sage_conf` also meant to be used while building Sage's dependencies?



---

archive/issue_comments_433274.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 dimpase]:\n> is `sage_conf` also meant to be used while building Sage's dependencies?\n\nNo.",
    "created_at": "2020-01-19T21:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433274",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [comment:15 dimpase]:
> is `sage_conf` also meant to be used while building Sage's dependencies?

No.



---

archive/issue_comments_433275.json:
```json
{
    "body": "<a id='comment:17'></a>`author` ought to be either \"The Sage Developers\" (cf https://wiki.sagemath.org/Publications_using_SageMath?action=show&redirect=Publications_using_SAGE)\nor yourself...",
    "created_at": "2020-01-19T21:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433275",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>`author` ought to be either "The Sage Developers" (cf https://wiki.sagemath.org/Publications_using_SageMath?action=show&redirect=Publications_using_SAGE)
or yourself...



---

archive/issue_comments_433276.json:
```json
{
    "body": "<a id='comment:18'></a>I copied the metadata from `src/setup.py`",
    "created_at": "2020-01-19T21:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433276",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>I copied the metadata from `src/setup.py`



---

archive/issue_comments_433277.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 mkoeppe]:\n> I copied the metadata from `src/setup.py`\n\nthat line is 5.5 years old. With all respect, William has not contributed a line of code to sagemath since 2017.",
    "created_at": "2020-01-19T22:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433277",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>Replying to [comment:18 mkoeppe]:
> I copied the metadata from `src/setup.py`

that line is 5.5 years old. With all respect, William has not contributed a line of code to sagemath since 2017.



---

archive/issue_comments_433278.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-20T01:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433279.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,54 @@\n+This ticket introduces a new Python package `sage_conf`.\n+\n+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.\n+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.\n+\n+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:\n+\n+```\n+$ local/bin/sage-config MAXIMA\n+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+$ local/bin/sage-config\n+VERSION=9.1.beta0\n+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima\n+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local\n+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring\n+```\n+\n+The module and the script are used as follows:\n+\n+1. It provides configuration information to sagelib at installation time (`src/setup.py`).\n+\n+   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.\n+\n+2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.\n+\n+3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).\n+\n+a. By providing `SAGE_LOCAL` as one the configuration variables, it removes assumptions regarding install locations of `sagelib` relative to `$SAGE_LOCAL`. This enables the following: \n+- Installing an experimental version of `sagelib` in other install locations, such as in a user site packages directory.\n+- Making `sagelib` available in a user's venv, as in the following example:\n+   Without this ticket:\n+   {{{\n+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/\n+   $ source ~/personal-sage-venv/bin/activate\n+   (personal-sage-venv) $ python\n+   >>> import sage.env\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong\n+   >>> import sage.all\n+   RuntimeError: You must get the file local/bin/sage-maxima.lisp\n+   }}}\n+   With this ticket:\n+   {{{\n+   >>> sage.env.SAGE_LOCAL\n+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'\n+   >>> import sage.all\n+   >>> sage.all.maxima('1')\n+   1\n+   }}}\n+- #29013/#27824: Using the system python3 via spkg-configure.m4\n+b. For a broader context: see #21707 Task: Split `sage-env` into 5\n \n \n Comment: 1\n```\n",
    "created_at": "2020-01-20T01:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433279",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,54 @@
+This ticket introduces a new Python package `sage_conf`.
+
+- sage-the-distribution will generate this Python package at `./configure` time and install it at build time before starting to build/install sagelib using `src/setup.py`.
+- Distributions will generate and install their own `sage_conf` by a method of their choice before starting to build/install sagelib.
+
+A `console_script` allows to query individual variable values from the shell, or output all variables in .env format:
+
+```
+$ local/bin/sage-config MAXIMA
+/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+$ local/bin/sage-config
+VERSION=9.1.beta0
+MAXIMA=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/bin/maxima
+SAGE_LOCAL=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local
+SAGE_ROOT=/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring
+```
+
+The module and the script are used as follows:
+
+1. It provides configuration information to sagelib at installation time (`src/setup.py`).
+
+   Ultimately we want to be able to install sagelib with `pip`. To support installation by `pip` from PyPI, from an URL, etc., we cannot expect to configure the build like we do now, by writing the configuration to the file `src/sage-env-config`. Moreover, if pip is running in `--isolated` mode, also no environment variables are passed. Then the only information flow is through arguments to `pip build` and through the installed Python packages. By installing `sage_conf` first, we make the configuration available to the pip install of sagelib.
+
+2. It provides configuration information to the docbuild, in particular about the install locations of documentation of external packages.
+
+3. It provides configuration information to the runtime of sagelib, making sagelib more independent from the environment variables set by `src/bin/sage-env` (`local/bin/sage-env`).
+
+a. By providing `SAGE_LOCAL` as one the configuration variables, it removes assumptions regarding install locations of `sagelib` relative to `$SAGE_LOCAL`. This enables the following: 
+- Installing an experimental version of `sagelib` in other install locations, such as in a user site packages directory.
+- Making `sagelib` available in a user's venv, as in the following example:
+   Without this ticket:
+   {{{
+   $ sage -python -m venv --system-site-packages ~/personal-sage-venv/
+   $ source ~/personal-sage-venv/bin/activate
+   (personal-sage-venv) $ python
+   >>> import sage.env
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/personal-sage-venv'                                     # wrong
+   >>> import sage.all
+   RuntimeError: You must get the file local/bin/sage-maxima.lisp
+   }}}
+   With this ticket:
+   {{{
+   >>> sage.env.SAGE_LOCAL
+   '/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local'
+   >>> import sage.all
+   >>> sage.all.maxima('1')
+   1
+   }}}
+- #29013/#27824: Using the system python3 via spkg-configure.m4
+b. For a broader context: see #21707 Task: Split `sage-env` into 5
 
 
 Comment: 1
```




---

archive/issue_comments_433280.json:
```json
{
    "body": "<a id='comment:22'></a>I don't seem to get `local/bin/sage-config` - it is not on the branch?",
    "created_at": "2020-01-20T22:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433280",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>I don't seem to get `local/bin/sage-config` - it is not on the branch?



---

archive/issue_comments_433281.json:
```json
{
    "body": "<a id='comment:23'></a>otherwise the branch builds and passes tests on a Debian system",
    "created_at": "2020-01-20T22:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433281",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>otherwise the branch builds and passes tests on a Debian system



---

archive/issue_comments_433282.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 dimpase]:\n> I don't seem to get `local/bin/sage-config` - it is not on the branch?\nStrange. Can you post the output of \"sage -f sage_conf\"?",
    "created_at": "2020-01-20T22:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433282",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Replying to [comment:22 dimpase]:
> I don't seem to get `local/bin/sage-config` - it is not on the branch?
Strange. Can you post the output of "sage -f sage_conf"?



---

archive/issue_comments_433283.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-21T00:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433284.json:
```json
{
    "body": "<a id='comment:26'></a>with the latest commit I get an error from sage -f sage_conf\n\n```\nmake[1]: Entering directory '/home/dimpase/sage/build/make'\ncd '/home/dimpase/sage' && source '/home/dimpase/sage/src/bin/sage-env' && sage-logger -p '/home/dimpase/sage/build/pkgs/sage_conf/spkg-install' '/home/dimpase/sage/logs/pkgs/sage_conf.log'\n[sage_conf] /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: 4: /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: source: not found\n[sage_conf] Error: failed to source /home/dimpase/sage/build/bin/sage-dist-helpers\n[sage_conf] Is /home/dimpase/sage the correct SAGE_ROOT?\nmake[1]: *** [Makefile:2240: sage_conf] Error 1\nmake[1]: Leaving directory '/home/dimpase/sage/build/make'\n\nreal\t0m0.137s\nuser\t0m0.076s\nsys\t0m0.066s\n***************************************************************\nError building Sage.\n\nThe following package(s) may have failed to build (not necessarily\nduring this run of 'make sage_conf'):\n\n* package: sage_conf\n  log file: /home/dimpase/sage/logs/pkgs/sage_conf.log\n  build directory: /home/dimpase/sage/local/var/tmp/sage/build/sage_conf\n```",
    "created_at": "2020-01-21T11:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433284",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>with the latest commit I get an error from sage -f sage_conf

```
make[1]: Entering directory '/home/dimpase/sage/build/make'
cd '/home/dimpase/sage' && source '/home/dimpase/sage/src/bin/sage-env' && sage-logger -p '/home/dimpase/sage/build/pkgs/sage_conf/spkg-install' '/home/dimpase/sage/logs/pkgs/sage_conf.log'
[sage_conf] /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: 4: /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: source: not found
[sage_conf] Error: failed to source /home/dimpase/sage/build/bin/sage-dist-helpers
[sage_conf] Is /home/dimpase/sage the correct SAGE_ROOT?
make[1]: *** [Makefile:2240: sage_conf] Error 1
make[1]: Leaving directory '/home/dimpase/sage/build/make'

real	0m0.137s
user	0m0.076s
sys	0m0.066s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make sage_conf'):

* package: sage_conf
  log file: /home/dimpase/sage/logs/pkgs/sage_conf.log
  build directory: /home/dimpase/sage/local/var/tmp/sage/build/sage_conf
```



---

archive/issue_comments_433285.json:
```json
{
    "body": "<a id='comment:27'></a>simply due to Debian's /bin/sh not knowing what `source` is:\n\n```\n$ /bin/sh\n$ source \n/bin/sh: 1: source: not found\n```",
    "created_at": "2020-01-21T11:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433285",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>simply due to Debian's /bin/sh not knowing what `source` is:

```
$ /bin/sh
$ source 
/bin/sh: 1: source: not found
```



---

archive/issue_comments_433286.json:
```json
{
    "body": "<a id='comment:28'></a>I suppose the 1st line got to be\n\n```/usr/bin/env bash\n```\n\nTrying this now.",
    "created_at": "2020-01-21T11:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433286",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>I suppose the 1st line got to be

```/usr/bin/env bash
```

Trying this now.



---

archive/issue_comments_433287.json:
```json
{
    "body": "<a id='comment:29'></a>OK, with the latter fix, it completes, and also\n\n```\n$ ./local/bin/sage-config\nVERSION=9.1.beta0\nMAXIMA=/home/dimpase/sage/local/bin/maxima\nSAGE_LOCAL=/home/dimpase/sage/local\nSAGE_ROOT=/home/dimpase/sage\n```\nworks.\n\n\\begin{lament}\n\nAn annoying thing is that `sage -f sage_conf` did cause `./configure` to be run like 4 or 5 times, I really lost count. \nThis is a by-product of `sage -f/-i` changing the configuration.\nSee #27373.\n\nI really think we should get rid of these snowflake `sage -f/-i` and do `./configure && make` :-)\n \n\n\\end{lament}",
    "created_at": "2020-01-21T11:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433287",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>OK, with the latter fix, it completes, and also

```
$ ./local/bin/sage-config
VERSION=9.1.beta0
MAXIMA=/home/dimpase/sage/local/bin/maxima
SAGE_LOCAL=/home/dimpase/sage/local
SAGE_ROOT=/home/dimpase/sage
```
works.

\begin{lament}

An annoying thing is that `sage -f sage_conf` did cause `./configure` to be run like 4 or 5 times, I really lost count. 
This is a by-product of `sage -f/-i` changing the configuration.
See #27373.

I really think we should get rid of these snowflake `sage -f/-i` and do `./configure && make` :-)
 

\end{lament}



---

archive/issue_comments_433288.json:
```json
{
    "body": "<a id='comment:30'></a>`$ sage -python -m venv --system-site-packages ~/personal-sage-venv/`\nalso works as advertised by this ticket.",
    "created_at": "2020-01-21T11:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433288",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>`$ sage -python -m venv --system-site-packages ~/personal-sage-venv/`
also works as advertised by this ticket.



---

archive/issue_comments_433289.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-01-21T11:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433289",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_433290.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-21T14:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433291.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-01-21T14:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433291",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_433292.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-21T14:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433292",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433293.json:
```json
{
    "body": "<a id='comment:34'></a>OK.",
    "created_at": "2020-01-21T14:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433293",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>OK.



---

archive/issue_comments_433294.json:
```json
{
    "body": "<a id='comment:35'></a>Thank you!",
    "created_at": "2020-01-21T14:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433294",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Thank you!



---

archive/issue_comments_433295.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-01-22T11:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433295",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_433296.json:
```json
{
    "body": "<a id='comment:36'></a>For the argument parsing please just use argparse.",
    "created_at": "2020-01-22T11:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433296",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'></a>For the argument parsing please just use argparse.



---

archive/issue_comments_433297.json:
```json
{
    "body": "<a id='comment:37'></a>I don't understand this line:\n\n```\nMAXIMA = \"@prefix@/bin/maxima\"\n```\n\nWhy assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.",
    "created_at": "2020-01-22T11:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433297",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'></a>I don't understand this line:

```
MAXIMA = "@prefix@/bin/maxima"
```

Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.



---

archive/issue_comments_433298.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 embray]:\n> I don't understand this line:\n> \n> \n> ```\n> MAXIMA = \"@prefix@/bin/maxima\"\n> ```\n> \n> Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.\n\n\nAs long as we don't have spkg-configure.m4 for maxima, it's OK.",
    "created_at": "2020-01-22T11:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433298",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'></a>Replying to [comment:37 embray]:
> I don't understand this line:
> 
> 
> ```
> MAXIMA = "@prefix@/bin/maxima"
> ```
> 
> Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.


As long as we don't have spkg-configure.m4 for maxima, it's OK.



---

archive/issue_comments_433299.json:
```json
{
    "body": "<a id='comment:39'></a>The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, it's installed like this:\n\n```\n# ============================= script packages ==============================\n# Generate build rules for 'script' packages; this template is used to generate\n# two rules in the form:\n#\n# <pkgname>: <dependencies>\n#     $(AM_V_at)cd '$SAGE_ROOT' && \\\\\n#         source '$SAGE_ROOT/src/bin/sage-env' && \\\\\n#         sage-logger -p '$SAGE_ROOT/build/pkgs/<pkgname>/spkg-install' '$(SAGE_LOGS)/<pkgname>.log'\n```\n\nSo it already sources `sage-env`, but not `sage-dist-helpers`.  \n\nLooking at the handful of other `spkg-install` scripts for the type=script packages, they might not work properly anyways since they don't get the \"wrapper\" treatment that other spkg-install scripts now get from `sage-spkg` (that didn't used to be the case.  \n\nI would make the splitting up of sage-env a prerequisite to this, and at a minimum ensure that sage-dist-helpers is already sourced in the build env.  Then you could do away with the extra boilerplate at the top of the `spkg-install` for this.",
    "created_at": "2020-01-22T11:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433299",
    "user": "https://github.com/embray"
}
```

<a id='comment:39'></a>The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, it's installed like this:

```
# ============================= script packages ==============================
# Generate build rules for 'script' packages; this template is used to generate
# two rules in the form:
#
# <pkgname>: <dependencies>
#     $(AM_V_at)cd '$SAGE_ROOT' && \\
#         source '$SAGE_ROOT/src/bin/sage-env' && \\
#         sage-logger -p '$SAGE_ROOT/build/pkgs/<pkgname>/spkg-install' '$(SAGE_LOGS)/<pkgname>.log'
```

So it already sources `sage-env`, but not `sage-dist-helpers`.  

Looking at the handful of other `spkg-install` scripts for the type=script packages, they might not work properly anyways since they don't get the "wrapper" treatment that other spkg-install scripts now get from `sage-spkg` (that didn't used to be the case.  

I would make the splitting up of sage-env a prerequisite to this, and at a minimum ensure that sage-dist-helpers is already sourced in the build env.  Then you could do away with the extra boilerplate at the top of the `spkg-install` for this.



---

archive/issue_comments_433300.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:38 dimpase]:\n> Replying to [comment:37 embray]:\n> > I don't understand this line:\n> > \n> > \n> > ```\n> > MAXIMA = \"@prefix@/bin/maxima\"\n> > ```\n> > \n> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.\n\n> \n> As long as we don't have spkg-configure.m4 for maxima, it's OK.\n> \n\n\nYes, I suppose, though this would have to be changed later if it were added.",
    "created_at": "2020-01-22T11:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433300",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>Replying to [comment:38 dimpase]:
> Replying to [comment:37 embray]:
> > I don't understand this line:
> > 
> > 
> > ```
> > MAXIMA = "@prefix@/bin/maxima"
> > ```
> > 
> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.

> 
> As long as we don't have spkg-configure.m4 for maxima, it's OK.
> 


Yes, I suppose, though this would have to be changed later if it were added.



---

archive/issue_comments_433301.json:
```json
{
    "body": "<a id='comment:41'></a>In the `setup.cfg` this should not be necessary:\n\n```\n+setup_requires =\n+    setuptools\n```\n\nThe standard now for specifying build-time dependencies is to add a pyproject.toml file.",
    "created_at": "2020-01-22T11:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433301",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>In the `setup.cfg` this should not be necessary:

```
+setup_requires =
+    setuptools
```

The standard now for specifying build-time dependencies is to add a pyproject.toml file.



---

archive/issue_comments_433302.json:
```json
{
    "body": "<a id='comment:42'></a>Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file.  In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.\n\nAll of the data provided by this module can go in a config file, similarly to Numpy's `site.cfg`.  It can even go directly in `setup.cfg` under a Sage-specific section, but probably better a separate file that doesn't need to be patched.\n\nIf you want to install the data along with the sage package it can be added to `package_data`.  If you look at Sage's setup.py it already has one other `package_data` file.  Adding one more is not really a problem, issues like #22655 nonwithstanding.  The file can be generated by the `setup.py`, which is not that unusual a thing to do.  If all this is to just avoid questions of how to update `setup.py`, I can help with that.",
    "created_at": "2020-01-22T11:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433302",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file.  In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.

All of the data provided by this module can go in a config file, similarly to Numpy's `site.cfg`.  It can even go directly in `setup.cfg` under a Sage-specific section, but probably better a separate file that doesn't need to be patched.

If you want to install the data along with the sage package it can be added to `package_data`.  If you look at Sage's setup.py it already has one other `package_data` file.  Adding one more is not really a problem, issues like #22655 nonwithstanding.  The file can be generated by the `setup.py`, which is not that unusual a thing to do.  If all this is to just avoid questions of how to update `setup.py`, I can help with that.



---

archive/issue_comments_433303.json:
```json
{
    "body": "<a id='comment:43'></a>This fix (adding the MAXIMA variable) is definitely good anything else in this ticket aside, and I'd approve right away as a separate ticket:\n\n```\n@@ -186,6 +192,7 @@ var('MTXLIB',                        join(SAGE_SHARE, 'meataxe'))\n var('THREEJS_DIR',                   join(SAGE_SHARE, 'threejs'))\n var('SINGULARPATH',                  join(SAGE_SHARE, 'singular'))\n var('PPLPY_DOCS',                    join(SAGE_SHARE, 'doc', 'pplpy'))\n+var('MAXIMA',                        'maxima')\n var('MAXIMA_FAS')\n var('SAGE_NAUTY_BINS_PREFIX', '')\n \ndiff --git a/src/sage/interfaces/maxima.py b/src/sage/interfaces/maxima.py\nindex eacbc4c..d6d37fe 100644\n--- a/src/sage/interfaces/maxima.py\n+++ b/src/sage/interfaces/maxima.py\n@@ -472,7 +472,7 @@ import pexpect\n \n from random import randrange\n \n-from sage.env import DOT_SAGE, SAGE_LOCAL\n+from sage.env import DOT_SAGE, SAGE_LOCAL, MAXIMA\n from sage.misc.misc import ECL_TMP\n \n from .expect import (Expect, ExpectElement, gc_disabled)\n@@ -546,7 +546,7 @@ class Maxima(MaximaAbstract, Expect):\n         Expect.__init__(self,\n                         name = 'maxima',\n                         prompt = r'\\(\\%i[0-9]+\\) ',\n-                        command = 'maxima -p \"{0}\"'.format(STARTUP),\n+                        command = '\"{0}\" -p \"{1}\"'.format(MAXIMA, STARTUP),\n                         env = {'TMPDIR': str(ECL_TMP)},\n                         script_subdirectory = script_subdirectory,\n                         restart_on_ctrlc = False,\n```",
    "created_at": "2020-01-22T11:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433303",
    "user": "https://github.com/embray"
}
```

<a id='comment:43'></a>This fix (adding the MAXIMA variable) is definitely good anything else in this ticket aside, and I'd approve right away as a separate ticket:

```
@@ -186,6 +192,7 @@ var('MTXLIB',                        join(SAGE_SHARE, 'meataxe'))
 var('THREEJS_DIR',                   join(SAGE_SHARE, 'threejs'))
 var('SINGULARPATH',                  join(SAGE_SHARE, 'singular'))
 var('PPLPY_DOCS',                    join(SAGE_SHARE, 'doc', 'pplpy'))
+var('MAXIMA',                        'maxima')
 var('MAXIMA_FAS')
 var('SAGE_NAUTY_BINS_PREFIX', '')
 
diff --git a/src/sage/interfaces/maxima.py b/src/sage/interfaces/maxima.py
index eacbc4c..d6d37fe 100644
--- a/src/sage/interfaces/maxima.py
+++ b/src/sage/interfaces/maxima.py
@@ -472,7 +472,7 @@ import pexpect
 
 from random import randrange
 
-from sage.env import DOT_SAGE, SAGE_LOCAL
+from sage.env import DOT_SAGE, SAGE_LOCAL, MAXIMA
 from sage.misc.misc import ECL_TMP
 
 from .expect import (Expect, ExpectElement, gc_disabled)
@@ -546,7 +546,7 @@ class Maxima(MaximaAbstract, Expect):
         Expect.__init__(self,
                         name = 'maxima',
                         prompt = r'\(\%i[0-9]+\) ',
-                        command = 'maxima -p "{0}"'.format(STARTUP),
+                        command = '"{0}" -p "{1}"'.format(MAXIMA, STARTUP),
                         env = {'TMPDIR': str(ECL_TMP)},
                         script_subdirectory = script_subdirectory,
                         restart_on_ctrlc = False,
```



---

archive/issue_comments_433304.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:42 embray]:\n> Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. \n\n\nit is easier to make data available in Python if it is packaged as a Python module.\nOtherwise you need to read a plain text file from somewhere etc etc.",
    "created_at": "2020-01-22T11:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433304",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>Replying to [comment:42 embray]:
> Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 


it is easier to make data available in Python if it is packaged as a Python module.
Otherwise you need to read a plain text file from somewhere etc etc.



---

archive/issue_comments_433305.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:44 dimpase]:\n> Replying to [comment:42 embray]:\n> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. \n\n> \n> it is easier to make data available in Python if it is packaged as a Python module.\n> Otherwise you need to read a plain text file from somewhere etc etc.\n\n\nperhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.",
    "created_at": "2020-01-22T11:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433305",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'></a>Replying to [comment:44 dimpase]:
> Replying to [comment:42 embray]:
> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 

> 
> it is easier to make data available in Python if it is packaged as a Python module.
> Otherwise you need to read a plain text file from somewhere etc etc.


perhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.



---

archive/issue_comments_433306.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:45 dimpase]:\n> Replying to [comment:44 dimpase]:\n> > Replying to [comment:42 embray]:\n> > > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. \n\n> > \n> > it is easier to make data available in Python if it is packaged as a Python module.\n> > Otherwise you need to read a plain text file from somewhere etc etc.\n\n> \n> perhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.\n\n\nHave you looked at the [sysconfig](https://github.com/python/cpython/blob/5bbac8cbdf140ebce446ea4e7db2b20a5d7b8402/Lib/sysconfig.py) module?  None of it is generated.  In fact, Python installs the Makefile it was built with, and sysconfig.py reads it.  I'm not advocating *that* approach either, but something closer to it.\n\nThat said, having a generated Python file for this configuration is something I'd bend on.  I don't think it needs to be a .py module but *shrug*.  I added a comment on #29022 which I hope clarifies what I think this should be.\n\nI *do* like that addition of a `sage-config` script.  That could just be part of the `sage` package itself though; no need for an module external to `sage` that I can see.",
    "created_at": "2020-01-22T12:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433306",
    "user": "https://github.com/embray"
}
```

<a id='comment:46'></a>Replying to [comment:45 dimpase]:
> Replying to [comment:44 dimpase]:
> > Replying to [comment:42 embray]:
> > > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 

> > 
> > it is easier to make data available in Python if it is packaged as a Python module.
> > Otherwise you need to read a plain text file from somewhere etc etc.

> 
> perhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.


Have you looked at the [sysconfig](https://github.com/python/cpython/blob/5bbac8cbdf140ebce446ea4e7db2b20a5d7b8402/Lib/sysconfig.py) module?  None of it is generated.  In fact, Python installs the Makefile it was built with, and sysconfig.py reads it.  I'm not advocating *that* approach either, but something closer to it.

That said, having a generated Python file for this configuration is something I'd bend on.  I don't think it needs to be a .py module but *shrug*.  I added a comment on #29022 which I hope clarifies what I think this should be.

I *do* like that addition of a `sage-config` script.  That could just be part of the `sage` package itself though; no need for an module external to `sage` that I can see.



---

archive/issue_comments_433307.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:44 dimpase]:\n> Replying to [comment:42 embray]:\n> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. \n\n> \n> it is easier to make data available in Python if it is packaged as a Python module.\n> Otherwise you need to read a plain text file from somewhere etc etc.\n\n\n```\n# sage/env.py\n...\n\nSAGE_ENV_FILE = os.path.join(os.path.dirname(__file__), 'sage.env')\nwith open(SAGE_ENV_FILE) as sage_env:\n    for line in sage_env:\n        key, value = line.split('=', 1)\n        os.environ[key] = value\n\n...\n```\n\nThis format has the advantage that it can also be sourced by a shell script as it's valid shell syntax.\n\nThis is just a suggestion though; the .py equivalent is almost the same except with spaces around the `=`.\n\nAnother version, if you require that the values are quoted (so that it's simultaneously valid shell syntax and Python syntax):\n\n```\nwith open(SAGE_ENV_FILE) as sage_env:\n    exec(sage_env.read(), os.environ)\n```\n\nOr, if we prefer not to override things in `os.environ` we can use `globals()` instead.\n\nPoint being, it's a few lines.\n\nI like this because even if `$SAGE_LOCAL` is not \"activated\" (`sage-env` not sourced), you can run `$SAGE_LOCAL/bin/python -c 'import sage'` and have a working environment.  The necessary environment variables can then also be passed to Sage's external dependencies, without any requirement of modifying the outer shell environment.  To me, that's the primary motivation.  That motivation can still be achieved even if the generated file is a .py module, which is why I'm more open to that; I'm just trying to show that it doesn't  gain all that much in simplicity either.",
    "created_at": "2020-01-22T12:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433307",
    "user": "https://github.com/embray"
}
```

<a id='comment:47'></a>Replying to [comment:44 dimpase]:
> Replying to [comment:42 embray]:
> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 

> 
> it is easier to make data available in Python if it is packaged as a Python module.
> Otherwise you need to read a plain text file from somewhere etc etc.


```
# sage/env.py
...

SAGE_ENV_FILE = os.path.join(os.path.dirname(__file__), 'sage.env')
with open(SAGE_ENV_FILE) as sage_env:
    for line in sage_env:
        key, value = line.split('=', 1)
        os.environ[key] = value

...
```

This format has the advantage that it can also be sourced by a shell script as it's valid shell syntax.

This is just a suggestion though; the .py equivalent is almost the same except with spaces around the `=`.

Another version, if you require that the values are quoted (so that it's simultaneously valid shell syntax and Python syntax):

```
with open(SAGE_ENV_FILE) as sage_env:
    exec(sage_env.read(), os.environ)
```

Or, if we prefer not to override things in `os.environ` we can use `globals()` instead.

Point being, it's a few lines.

I like this because even if `$SAGE_LOCAL` is not "activated" (`sage-env` not sourced), you can run `$SAGE_LOCAL/bin/python -c 'import sage'` and have a working environment.  The necessary environment variables can then also be passed to Sage's external dependencies, without any requirement of modifying the outer shell environment.  To me, that's the primary motivation.  That motivation can still be achieved even if the generated file is a .py module, which is why I'm more open to that; I'm just trying to show that it doesn't  gain all that much in simplicity either.



---

archive/issue_comments_433308.json:
```json
{
    "body": "<a id='comment:48'></a>IMHO the internal design of `sysconfig` is a technical detail - given Python's historical dislike of non-Python tooling, no wonder they do it their way.",
    "created_at": "2020-01-22T12:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433308",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>IMHO the internal design of `sysconfig` is a technical detail - given Python's historical dislike of non-Python tooling, no wonder they do it their way.



---

archive/issue_comments_433309.json:
```json
{
    "body": "<a id='comment:49'></a>`globals()`, `exec()`, etc are really measures of last resort. \n\nAnd a plain text file is much more vulnerable to all sorts of problems, too, e.g. it's not checked for syntax by Python...",
    "created_at": "2020-01-22T12:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433309",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'></a>`globals()`, `exec()`, etc are really measures of last resort. 

And a plain text file is much more vulnerable to all sorts of problems, too, e.g. it's not checked for syntax by Python...



---

archive/issue_comments_433310.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:39 embray]:\n> I would make the splitting up of sage-env a prerequisite to this\n\n\nI have laid out a plan for splitting of `sage-env` in #21707. It is more complex. The present ticket is an actionable step toward it.",
    "created_at": "2020-01-22T14:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433310",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>Replying to [comment:39 embray]:
> I would make the splitting up of sage-env a prerequisite to this


I have laid out a plan for splitting of `sage-env` in #21707. It is more complex. The present ticket is an actionable step toward it.



---

archive/issue_comments_433311.json:
```json
{
    "body": "<a id='comment:51'></a>Replying to [comment:38 dimpase]:\n> Replying to [comment:37 embray]:\n> > I don't understand this line:\n> > \n> > \n> > ```\n> > MAXIMA = \"@prefix@/bin/maxima\"\n> > ```\n> > \n> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.\n\n> \n> As long as we don't have spkg-configure.m4 for maxima, it's OK.\n\n\nYes, of course the intention is that a follow-up ticket will add `spkg-configure.m4`. \n\nI picked this invocation of `maxima` as an illustrating example for this ticket - one of many places where the Python code assumes that externally to the Python process, an environment has been set up. In the systematic of #21707 (\"Split sage-env into 5\"), this example belongs to category 5.",
    "created_at": "2020-01-22T14:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433311",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>Replying to [comment:38 dimpase]:
> Replying to [comment:37 embray]:
> > I don't understand this line:
> > 
> > 
> > ```
> > MAXIMA = "@prefix@/bin/maxima"
> > ```
> > 
> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.

> 
> As long as we don't have spkg-configure.m4 for maxima, it's OK.


Yes, of course the intention is that a follow-up ticket will add `spkg-configure.m4`. 

I picked this invocation of `maxima` as an illustrating example for this ticket - one of many places where the Python code assumes that externally to the Python process, an environment has been set up. In the systematic of #21707 ("Split sage-env into 5"), this example belongs to category 5.



---

archive/issue_comments_433312.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-22T14:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433313.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:41 embray]:\n> In the `setup.cfg` this should not be necessary:\n> \n> ```\n> +setup_requires =\n> +    setuptools\n> ```\n\n\nThanks, I've removed it.\n\n> The standard now for specifying build-time dependencies is to add a pyproject.toml file.\n\n\nOur present tooling does not need that file either. I'd suggest we do pyproject.toml business after #21508.",
    "created_at": "2020-01-22T14:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433313",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>Replying to [comment:41 embray]:
> In the `setup.cfg` this should not be necessary:
> 
> ```
> +setup_requires =
> +    setuptools
> ```


Thanks, I've removed it.

> The standard now for specifying build-time dependencies is to add a pyproject.toml file.


Our present tooling does not need that file either. I'd suggest we do pyproject.toml business after #21508.



---

archive/issue_comments_433314.json:
```json
{
    "body": "<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-22T14:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433315.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:39 embray]:\n> The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, [...] it already sources `sage-env`, but not `sage-dist-helpers`.  \n\n\nThanks! I've simplified `spkg-install` accordingly.",
    "created_at": "2020-01-22T14:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433315",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>Replying to [comment:39 embray]:
> The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, [...] it already sources `sage-env`, but not `sage-dist-helpers`.  


Thanks! I've simplified `spkg-install` accordingly.



---

archive/issue_comments_433316.json:
```json
{
    "body": "<a id='comment:56'></a>Replying to [comment:42 embray]:\n>   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.\n\n\nNo, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. \n\nThe version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.\n\nPackagers will just be able to generate a `sage_conf` module in any way they like. \n\n\nI have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:\n- committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.\n- for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.\n- it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.",
    "created_at": "2020-01-22T14:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433316",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>Replying to [comment:42 embray]:
>   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.


No, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. 

The version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.

Packagers will just be able to generate a `sage_conf` module in any way they like. 


I have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:
- committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.
- for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.
- it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.



---

archive/issue_comments_433317.json:
```json
{
    "body": "<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-22T15:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433318.json:
```json
{
    "body": "<a id='comment:58'></a>Replying to [comment:36 embray]:\n> For the argument parsing please just use argparse.\n\nThanks for the suggestion. Done.",
    "created_at": "2020-01-22T15:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433318",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>Replying to [comment:36 embray]:
> For the argument parsing please just use argparse.

Thanks for the suggestion. Done.



---

archive/issue_comments_433319.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-01-22T15:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433319",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_433320.json:
```json
{
    "body": "<a id='comment:61'></a>\n```\nfrom __future__ import print_function\n+del print_function\n```\nby the way, can you explain these 2 lines",
    "created_at": "2020-01-22T15:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433320",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:61'></a>
```
from __future__ import print_function
+del print_function
```
by the way, can you explain these 2 lines



---

archive/issue_comments_433321.json:
```json
{
    "body": "<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-22T16:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433322.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [comment:61 dimpase]:\n> {{{\n> from __future__ import print_function\n> +del print_function\n> }}}\n> by the way, can you explain these 2 lines\n\n\nWithout the `del print_function`, `sage-config` would print a line `print_function=_Feature((2, 6, 0, 'alpha', 2), (3, 0, 0, 'alpha', 0), 65536)`.\n\nBut I have simplified the module by avoiding `print` altogether.",
    "created_at": "2020-01-22T16:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433322",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>Replying to [comment:61 dimpase]:
> {{{
> from __future__ import print_function
> +del print_function
> }}}
> by the way, can you explain these 2 lines


Without the `del print_function`, `sage-config` would print a line `print_function=_Feature((2, 6, 0, 'alpha', 2), (3, 0, 0, 'alpha', 0), 65536)`.

But I have simplified the module by avoiding `print` altogether.



---

archive/issue_comments_433323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-22T21:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433323",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433324.json:
```json
{
    "body": "<a id='comment:64'></a>OK for me.",
    "created_at": "2020-01-22T21:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433324",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:64'></a>OK for me.



---

archive/issue_events_073574.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-25T17:27:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29038#event-73574"
}
```



---

archive/issue_comments_433325.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-25T17:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433325",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_433326.json:
```json
{
    "body": "<a id='comment:66'></a>Replying to [comment:56 mkoeppe]:\n> Replying to [comment:42 embray]:\n> >   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.\n\n> \n> No, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. \n> \n> The version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.\n> \n> Packagers will just be able to generate a `sage_conf` module in any way they like. \n> \n> \n> I have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:\n> - committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.\n> - for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.\n> - it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.\n> \n\n\nBut it's not even documented what this is supposed to provide or how it's supposed to work.  This is all very confusing.\n\nI don't really know what you mean by \"functional\" here.  Do you mean executable?  Why?  Is there a specific reason for that?  In any case I know of all that's needed here is at most a list of environment variables.  In many cases this will just be static.  If a packager has a need to generate some values for those variables programmatically they can do so however they like, but now they have to write a whole Python script that implements some undocumented interface.",
    "created_at": "2020-01-31T11:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433326",
    "user": "https://github.com/embray"
}
```

<a id='comment:66'></a>Replying to [comment:56 mkoeppe]:
> Replying to [comment:42 embray]:
> >   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.

> 
> No, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. 
> 
> The version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.
> 
> Packagers will just be able to generate a `sage_conf` module in any way they like. 
> 
> 
> I have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:
> - committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.
> - for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.
> - it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.
> 


But it's not even documented what this is supposed to provide or how it's supposed to work.  This is all very confusing.

I don't really know what you mean by "functional" here.  Do you mean executable?  Why?  Is there a specific reason for that?  In any case I know of all that's needed here is at most a list of environment variables.  In many cases this will just be static.  If a packager has a need to generate some values for those variables programmatically they can do so however they like, but now they have to write a whole Python script that implements some undocumented interface.



---

archive/issue_comments_433327.json:
```json
{
    "body": "<a id='comment:67'></a>Once again, it's more Pythonic to wrap Python-needed things into Python modules, as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls \"functional\".",
    "created_at": "2020-01-31T12:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433327",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:67'></a>Once again, it's more Pythonic to wrap Python-needed things into Python modules, as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".



---

archive/issue_comments_433328.json:
```json
{
    "body": "<a id='comment:68'></a>Replying to [comment:67 dimpase]:\n> Once again, it's more Pythonic to wrap Python-needed things into Python modules\n\n\n![citation needed]\n\n> as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls \"functional\".\n\n\nPerhaps you missed it, but as I already explained above this is *exactly* what `sysconfig` does.  You are saying that `sysconfig` is \"unpythonic\".",
    "created_at": "2020-01-31T13:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433328",
    "user": "https://github.com/embray"
}
```

<a id='comment:68'></a>Replying to [comment:67 dimpase]:
> Once again, it's more Pythonic to wrap Python-needed things into Python modules


![citation needed]

> as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".


Perhaps you missed it, but as I already explained above this is *exactly* what `sysconfig` does.  You are saying that `sysconfig` is "unpythonic".



---

archive/issue_comments_433329.json:
```json
{
    "body": "<a id='comment:69'></a>The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.",
    "created_at": "2020-01-31T13:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433329",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.



---

archive/issue_comments_433330.json:
```json
{
    "body": "<a id='comment:70'></a>For reference, again [sysconfig](https://github.com/python/cpython/blob/master/Lib/sysconfig.py), which is a hard-coded Python module which reads from a plain text-file.\n\nAlso recommended, the [venv](https://github.com/python/cpython/blob/master/Lib/venv/__init__.py) module which is actually a lot less mysterious than you guys seem to be making it out to be.  The only magic involved is some support bits coded directly into the Python interpreter used for setting `sys.prefix` correctly (this is one of the few ways `venv` differs from the original `virtualenv` which needed some hacks to achieve this).",
    "created_at": "2020-01-31T13:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433330",
    "user": "https://github.com/embray"
}
```

<a id='comment:70'></a>For reference, again [sysconfig](https://github.com/python/cpython/blob/master/Lib/sysconfig.py), which is a hard-coded Python module which reads from a plain text-file.

Also recommended, the [venv](https://github.com/python/cpython/blob/master/Lib/venv/__init__.py) module which is actually a lot less mysterious than you guys seem to be making it out to be.  The only magic involved is some support bits coded directly into the Python interpreter used for setting `sys.prefix` correctly (this is one of the few ways `venv` differs from the original `virtualenv` which needed some hacks to achieve this).



---

archive/issue_comments_433331.json:
```json
{
    "body": "<a id='comment:71'></a>Replying to [comment:69 mkoeppe]:\n> The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.\n\n\nThanks, that is useful.  Obviously I've participated in that ticket before, but I wasn't sure if it was *the* ticket tying the rest of this together.  I still believe that steps 3/4/5 can be achieved by different means which merit more discussion.  But I'm on board with the overall plan :)",
    "created_at": "2020-01-31T13:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433331",
    "user": "https://github.com/embray"
}
```

<a id='comment:71'></a>Replying to [comment:69 mkoeppe]:
> The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.


Thanks, that is useful.  Obviously I've participated in that ticket before, but I wasn't sure if it was *the* ticket tying the rest of this together.  I still believe that steps 3/4/5 can be achieved by different means which merit more discussion.  But I'm on board with the overall plan :)



---

archive/issue_comments_433332.json:
```json
{
    "body": "<a id='comment:72'></a>No problem. I know that it is not always possible to keep up with all developments when there are more important things to do.\n\nAs you see in that plan in #21707, the present ticket on `sage_conf` was a step to cleaning up the sage-env mess. \n\nIt has little to do with my venv-python3 tickets (which I haven't had time to work on). (In fact, I now think that your version at #29032 may, after all, be the simpler way to go at it -- but I have to get back to the python3-spkg-configure business later.)\n\nSo there's no need to mix any \"venv\" discussion into the \"sagelib configuration\" discussion.\n\nThe \"regression\" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch.",
    "created_at": "2020-01-31T13:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433332",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>No problem. I know that it is not always possible to keep up with all developments when there are more important things to do.

As you see in that plan in #21707, the present ticket on `sage_conf` was a step to cleaning up the sage-env mess. 

It has little to do with my venv-python3 tickets (which I haven't had time to work on). (In fact, I now think that your version at #29032 may, after all, be the simpler way to go at it -- but I have to get back to the python3-spkg-configure business later.)

So there's no need to mix any "venv" discussion into the "sagelib configuration" discussion.

The "regression" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch.



---

archive/issue_comments_433333.json:
```json
{
    "body": "<a id='comment:73'></a>Replying to [comment:68 embray]:\n> Replying to [comment:67 dimpase]:\n> > Once again, it's more Pythonic to wrap Python-needed things into Python modules\n\n> \n> ![citation needed]\ncf. [`sysconfig`].\n> \n> > as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls \"functional\".\n\n> \n> Perhaps you missed it, but as I already explained above this is *exactly* what `sysconfig` does.  You are saying that `sysconfig` is \"unpythonic\".\n\n\nNo, obviously Python needs to do some non-Pythonic things under the hood, but then the interface is Pythonic, and `sysconfig` is an example of such an approach.\nYou are somehow against this approach, you say that such wrapping is too complicated, so it should not be done - if you were Python BDFL, you'd not have allowed `sysconfig` in.",
    "created_at": "2020-01-31T14:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433333",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:73'></a>Replying to [comment:68 embray]:
> Replying to [comment:67 dimpase]:
> > Once again, it's more Pythonic to wrap Python-needed things into Python modules

> 
> ![citation needed]
cf. [`sysconfig`].
> 
> > as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".

> 
> Perhaps you missed it, but as I already explained above this is *exactly* what `sysconfig` does.  You are saying that `sysconfig` is "unpythonic".


No, obviously Python needs to do some non-Pythonic things under the hood, but then the interface is Pythonic, and `sysconfig` is an example of such an approach.
You are somehow against this approach, you say that such wrapping is too complicated, so it should not be done - if you were Python BDFL, you'd not have allowed `sysconfig` in.



---

archive/issue_comments_433334.json:
```json
{
    "body": "<a id='comment:74'></a>Replying to [comment:72 mkoeppe]:\n> The \"regression\" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch. \n\n\nFor tickets where merging the current `develop` is not easy, I have prepared #29120 - One-line fix for \"./configure is too sensitive to stray files/subdirectories\".",
    "created_at": "2020-01-31T14:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29038#issuecomment-433334",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'></a>Replying to [comment:72 mkoeppe]:
> The "regression" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch. 


For tickets where merging the current `develop` is not easy, I have prepared #29120 - One-line fix for "./configure is too sensitive to stray files/subdirectories".
