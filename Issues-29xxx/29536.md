# Issue 29536: Make docker images from tox/GitHub CI workflow, regular Sage Docker images, gitpod, CoCalc interoperable

archive/issues_029299.json:
```json
{
    "body": "1. Adjust directory names to something that works for both cases ...\n   - `docker/Dockerfile` currently has:\n      - `SAGE_ROOT=/home/sage/sage`\n      - `SAGE_LOCAL=$SAGE_ROOT/local`\n   - Docker images built with tox/GH Actions (including Gitpod) and also `computop/sage` have:\n      - `SAGE_ROOT=/sage`\n      - `SAGE_LOCAL=/sage/local`\n   - **After this ticket:**\n      - `SAGE_ROOT=/sage`\n      - `SAGE_LOCAL=/opt/sage`\n   - CoCalc Docker image has:\n      - `SAGE_ROOT=/usr/local/sage`\n      - `SAGE_LOCAL=/usr/local/sage/local`\n\n2. #33851: Define a script package representing \"useful stuff to have on a Docker image\" \n\n3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n\n4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n\n\n5. Move `build/bin/write-dockerfile.sh` into `docker/`\n\n6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n\n\n\nCC:  @kliem @dimpase @embray @saraedum @slel @fchapoton @tobiasdiez @williamstein @culler @NathanDunfield\n\nKeywords: ci, docker, ContinuousIntegration, sd109\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/29536\n\n",
    "created_at": "2020-04-20T01:41:38Z",
    "labels": [
        "component: docker"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Make docker images from tox/GitHub CI workflow, regular Sage Docker images, gitpod, CoCalc interoperable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29536",
    "user": "https://github.com/mkoeppe"
}
```
1. Adjust directory names to something that works for both cases ...
   - `docker/Dockerfile` currently has:
      - `SAGE_ROOT=/home/sage/sage`
      - `SAGE_LOCAL=$SAGE_ROOT/local`
   - Docker images built with tox/GH Actions (including Gitpod) and also `computop/sage` have:
      - `SAGE_ROOT=/sage`
      - `SAGE_LOCAL=/sage/local`
   - **After this ticket:**
      - `SAGE_ROOT=/sage`
      - `SAGE_LOCAL=/opt/sage`
   - CoCalc Docker image has:
      - `SAGE_ROOT=/usr/local/sage`
      - `SAGE_LOCAL=/usr/local/sage/local`

2. #33851: Define a script package representing "useful stuff to have on a Docker image" 

3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.

4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"


5. Move `build/bin/write-dockerfile.sh` into `docker/`

6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.



CC:  @kliem @dimpase @embray @saraedum @slel @fchapoton @tobiasdiez @williamstein @culler @NathanDunfield

Keywords: ci, docker, ContinuousIntegration, sd109

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/29536





---

archive/issue_comments_577206.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,10 @@\n ... by adjusting directory names to something that works for both cases ...\n \n-Keywords: ci, docker, ContinuousIntegration\n+`docker/Dockerfile`:\n+- `SAGE_ROOT=/home/sage/sage`\n+- `SAGE_LOCAL=$SAGE_ROOT/local`\n+\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-04-21T02:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577206",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,10 @@
 ... by adjusting directory names to something that works for both cases ...
 
-Keywords: ci, docker, ContinuousIntegration
+`docker/Dockerfile`:
+- `SAGE_ROOT=/home/sage/sage`
+- `SAGE_LOCAL=$SAGE_ROOT/local`
+
+
 
 Comment: 1
 
``````




---

archive/issue_comments_577207.json:
```json
{
    "body": "<a id='comment:2'></a>by the way, we don't seem to have in docs an explanation regarding file shared between docker images and regular file system of the host system.",
    "created_at": "2020-04-26T08:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577207",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>by the way, we don't seem to have in docs an explanation regarding file shared between docker images and regular file system of the host system.



---

archive/issue_comments_577208.json:
```json
{
    "body": "Changing keywords from \"ci, docker, ContinuousIntegration\" to \"ci, docker, ContinuousIntegration, sd109\".",
    "created_at": "2020-05-27T12:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577208",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "ci, docker, ContinuousIntegration" to "ci, docker, ContinuousIntegration, sd109".



---

archive/issue_comments_577209.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n+1. adjust directory names to something that works for both cases ...\n+\n+   `docker/Dockerfile`:\n+   - `SAGE_ROOT=/home/sage/sage`\n+   - `SAGE_LOCAL=$SAGE_ROOT/local`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n \n \n Comment: 1\n``````\n",
    "created_at": "2020-05-28T00:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577209",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,14 @@
+1. adjust directory names to something that works for both cases ...
+
+   `docker/Dockerfile`:
+   - `SAGE_ROOT=/home/sage/sage`
+   - `SAGE_LOCAL=$SAGE_ROOT/local`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
 
 
 Comment: 1
``````




---

archive/issue_comments_577210.json:
```json
{
    "body": "<a id='comment:5'></a>I'm confused--should this say \"GitHub\" in the title or \"GitLab\"?  I don't know of any [GitHub](GitHub) CI docker images.",
    "created_at": "2020-05-28T14:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577210",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>I'm confused--should this say "GitHub" in the title or "GitLab"?  I don't know of any [GitHub](GitHub) CI docker images.



---

archive/issue_comments_577211.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 embray]:\n> I'm confused--should this say \"GitHub\" in the title or \"GitLab\"?  I don't know of any [GitHub](GitHub) CI docker images.\n\n\nplease see\nhttps://doc.sagemath.org/html/en/developer/index.html#testing-on-multiple-platforms\n\nwe now have a builder of docker images for multiple platforms, configurable, and by default hosted on github.",
    "created_at": "2020-05-28T15:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577211",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>Replying to [comment:5 embray]:
> I'm confused--should this say "GitHub" in the title or "GitLab"?  I don't know of any [GitHub](GitHub) CI docker images.


please see
https://doc.sagemath.org/html/en/developer/index.html#testing-on-multiple-platforms

we now have a builder of docker images for multiple platforms, configurable, and by default hosted on github.



---

archive/issue_comments_577212.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n+1. adjust directory names to something that works for both cases ...\n+\n+   `docker/Dockerfile` currently has:\n+    - `SAGE_ROOT=/home/sage/sage`\n+    - `SAGE_LOCAL=$SAGE_ROOT/local`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n \n \n Comment: 1\n``````\n",
    "created_at": "2020-05-29T17:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577212",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,14 @@
+1. adjust directory names to something that works for both cases ...
+
+   `docker/Dockerfile` currently has:
+    - `SAGE_ROOT=/home/sage/sage`
+    - `SAGE_LOCAL=$SAGE_ROOT/local`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
 
 
 Comment: 1
``````




---

archive/issue_events_075364.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-03T17:39:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75364"
}
```



---

archive/issue_comments_577213.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,18 @@\n+1. adjust directory names to something that works for both cases ...\n+\n+   `docker/Dockerfile` currently has:\n+    - `SAGE_ROOT=/home/sage/sage`\n+    - `SAGE_LOCAL=$SAGE_ROOT/local`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile` into `docker/`\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2020-09-04T18:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577213",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,18 @@
+1. adjust directory names to something that works for both cases ...
+
+   `docker/Dockerfile` currently has:
+    - `SAGE_ROOT=/home/sage/sage`
+    - `SAGE_LOCAL=$SAGE_ROOT/local`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile` into `docker/`
+
 
 
 Comment: 1
``````




---

archive/issue_events_075365.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75365"
}
```



---

archive/issue_events_075366.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75366"
}
```



---

archive/issue_comments_577214.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#30960\"",
    "created_at": "2020-11-25T20:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577214",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#30960"



---

archive/issue_events_075367.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75367"
}
```



---

archive/issue_events_075368.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75368"
}
```



---

archive/issue_comments_577215.json:
```json
{
    "body": "<a id='comment:14'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577215",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_577216.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,20 @@\n+1. adjust directory names to something that works for both cases ...\n+\n+   `docker/Dockerfile` currently has:\n+    - `SAGE_ROOT=/home/sage/sage`\n+    - `SAGE_LOCAL=$SAGE_ROOT/local`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-03-28T18:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577216",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,20 @@
+1. adjust directory names to something that works for both cases ...
+
+   `docker/Dockerfile` currently has:
+    - `SAGE_ROOT=/home/sage/sage`
+    - `SAGE_LOCAL=$SAGE_ROOT/local`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_events_075369.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75369"
}
```



---

archive/issue_events_075370.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75370"
}
```



---

archive/issue_comments_577217.json:
```json
{
    "body": "<a id='comment:17'></a>Given that [GitLab](GitLab) Docker build is broken for ages, can we arrange for GitHub-built docker images to be pushed to the main Docker repo,\nor at least create some sort of advertised Docker repo on [GitHub](GitHub)?",
    "created_at": "2021-10-01T08:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577217",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Given that [GitLab](GitLab) Docker build is broken for ages, can we arrange for GitHub-built docker images to be pushed to the main Docker repo,
or at least create some sort of advertised Docker repo on [GitHub](GitHub)?



---

archive/issue_events_075371.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75371"
}
```



---

archive/issue_events_075372.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75372"
}
```



---

archive/issue_comments_577218.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,23 @@\n+1. adjust directory names to something that works for both cases ...\n \n+   `docker/Dockerfile` currently has:\n+    - `SAGE_ROOT=/home/sage/sage`\n+    - `SAGE_LOCAL=$SAGE_ROOT/local`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n+\n+\n+Gitpod - see #32749\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-12-27T21:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577218",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,23 @@
+1. adjust directory names to something that works for both cases ...
 
+   `docker/Dockerfile` currently has:
+    - `SAGE_ROOT=/home/sage/sage`
+    - `SAGE_LOCAL=$SAGE_ROOT/local`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
+
+
+Gitpod - see #32749
 
 Comment: 1
 
``````




---

archive/issue_events_075373.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75373"
}
```



---

archive/issue_events_075374.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75374"
}
```



---

archive/issue_comments_577219.json:
```json
{
    "body": "<a id='comment:22'></a>Bikeshedding time! Let's pick `SAGE_ROOT`, `SAGE_LOCAL`. My proposal is in the ticket description. \n\n(The only important constraint for me is: Don't nest `SAGE_LOCAL` within `SAGE_ROOT` - for flexibility such as bind-mounting a new version of the source tree over `SAGE_ROOT` without hiding `SAGE_LOCAL`.)",
    "created_at": "2022-05-11T21:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577219",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>Bikeshedding time! Let's pick `SAGE_ROOT`, `SAGE_LOCAL`. My proposal is in the ticket description. 

(The only important constraint for me is: Don't nest `SAGE_LOCAL` within `SAGE_ROOT` - for flexibility such as bind-mounting a new version of the source tree over `SAGE_ROOT` without hiding `SAGE_LOCAL`.)



---

archive/issue_comments_577220.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,26 @@\n+1. Adjust directory names to something that works for both cases ...\n+   - `docker/Dockerfile` currently has:\n+      - `SAGE_ROOT=/home/sage/sage`\n+      - `SAGE_LOCAL=$SAGE_ROOT/local`\n+   - Docker images built with tox/GH Actions (including Gitpod) have:\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/sage/local`\n+   - **After this ticket:**\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/opt/sage`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+   - perhaps call it `_devtools`? \n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile.sh` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-05-11T21:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577220",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,26 @@
+1. Adjust directory names to something that works for both cases ...
+   - `docker/Dockerfile` currently has:
+      - `SAGE_ROOT=/home/sage/sage`
+      - `SAGE_LOCAL=$SAGE_ROOT/local`
+   - Docker images built with tox/GH Actions (including Gitpod) have:
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/sage/local`
+   - **After this ticket:**
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/opt/sage`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+   - perhaps call it `_devtools`? 
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile.sh` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_comments_577221.json:
```json
{
    "body": "Changing dependencies from \"#30960\" to \"#33740\"",
    "created_at": "2022-05-11T21:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577221",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#30960" to "#33740"



---

archive/issue_comments_577222.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,27 @@\n+1. Adjust directory names to something that works for both cases ...\n+   - `docker/Dockerfile` currently has:\n+      - `SAGE_ROOT=/home/sage/sage`\n+      - `SAGE_LOCAL=$SAGE_ROOT/local`\n+   - Docker images built with tox/GH Actions (including Gitpod) have:\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/sage/local`\n+   - **After this ticket:**\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/opt/sage`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+   - perhaps call it `_devtools`? \n+   - include the stuff added in #33740 to `environment-dev.yml`\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile.sh` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-05-11T21:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577222",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,27 @@
+1. Adjust directory names to something that works for both cases ...
+   - `docker/Dockerfile` currently has:
+      - `SAGE_ROOT=/home/sage/sage`
+      - `SAGE_LOCAL=$SAGE_ROOT/local`
+   - Docker images built with tox/GH Actions (including Gitpod) have:
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/sage/local`
+   - **After this ticket:**
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/opt/sage`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+   - perhaps call it `_devtools`? 
+   - include the stuff added in #33740 to `environment-dev.yml`
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile.sh` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_comments_577223.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,28 @@\n+1. Adjust directory names to something that works for both cases ...\n+   - `docker/Dockerfile` currently has:\n+      - `SAGE_ROOT=/home/sage/sage`\n+      - `SAGE_LOCAL=$SAGE_ROOT/local`\n+   - Docker images built with tox/GH Actions (including Gitpod) have:\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/sage/local`\n+   - **After this ticket:**\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/opt/sage`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+   - perhaps call it `_devtools`? \n+   - include the stuff added in #33740 to `environment-dev.yml`\n+   - solve #27677, #29153\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile.sh` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-05-11T21:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577223",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,28 @@
+1. Adjust directory names to something that works for both cases ...
+   - `docker/Dockerfile` currently has:
+      - `SAGE_ROOT=/home/sage/sage`
+      - `SAGE_LOCAL=$SAGE_ROOT/local`
+   - Docker images built with tox/GH Actions (including Gitpod) have:
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/sage/local`
+   - **After this ticket:**
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/opt/sage`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+   - perhaps call it `_devtools`? 
+   - include the stuff added in #33740 to `environment-dev.yml`
+   - solve #27677, #29153
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile.sh` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_comments_577224.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,28 @@\n+1. Adjust directory names to something that works for both cases ...\n+   - `docker/Dockerfile` currently has:\n+      - `SAGE_ROOT=/home/sage/sage`\n+      - `SAGE_LOCAL=$SAGE_ROOT/local`\n+   - Docker images built with tox/GH Actions (including Gitpod) have:\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/sage/local`\n+   - **After this ticket:**\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/opt/sage`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+   - perhaps call it `_devtools`? \n+   - include the stuff added in #33740 to `environment-dev.yml` and #33671\n+   - solve #27677, #29153\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile.sh` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-05-14T17:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577224",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,28 @@
+1. Adjust directory names to something that works for both cases ...
+   - `docker/Dockerfile` currently has:
+      - `SAGE_ROOT=/home/sage/sage`
+      - `SAGE_LOCAL=$SAGE_ROOT/local`
+   - Docker images built with tox/GH Actions (including Gitpod) have:
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/sage/local`
+   - **After this ticket:**
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/opt/sage`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+   - perhaps call it `_devtools`? 
+   - include the stuff added in #33740 to `environment-dev.yml` and #33671
+   - solve #27677, #29153
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile.sh` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_comments_577225.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,28 @@\n+1. Adjust directory names to something that works for both cases ...\n+   - `docker/Dockerfile` currently has:\n+      - `SAGE_ROOT=/home/sage/sage`\n+      - `SAGE_LOCAL=$SAGE_ROOT/local`\n+   - Docker images built with tox/GH Actions (including Gitpod) have:\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/sage/local`\n+   - **After this ticket:**\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/opt/sage`\n+\n+2. Define a script package representing \"useful stuff to have on a Docker image\" (more than the `_recommended` package from #29557)\n+   - perhaps call it `_develop`? \n+   - include the stuff added in #33740 to `environment-dev.yml` and #33671\n+   - solve #27677, #29153\n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile.sh` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-05-14T17:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577225",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,28 @@
+1. Adjust directory names to something that works for both cases ...
+   - `docker/Dockerfile` currently has:
+      - `SAGE_ROOT=/home/sage/sage`
+      - `SAGE_LOCAL=$SAGE_ROOT/local`
+   - Docker images built with tox/GH Actions (including Gitpod) have:
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/sage/local`
+   - **After this ticket:**
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/opt/sage`
+
+2. Define a script package representing "useful stuff to have on a Docker image" (more than the `_recommended` package from #29557)
+   - perhaps call it `_develop`? 
+   - include the stuff added in #33740 to `environment-dev.yml` and #33671
+   - solve #27677, #29153
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile.sh` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_comments_577226.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,25 @@\n+1. Adjust directory names to something that works for both cases ...\n+   - `docker/Dockerfile` currently has:\n+      - `SAGE_ROOT=/home/sage/sage`\n+      - `SAGE_LOCAL=$SAGE_ROOT/local`\n+   - Docker images built with tox/GH Actions (including Gitpod) have:\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/sage/local`\n+   - **After this ticket:**\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/opt/sage`\n+\n+2. #33851: Define a script package representing \"useful stuff to have on a Docker image\" \n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile.sh` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-05-14T18:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577226",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,25 @@
+1. Adjust directory names to something that works for both cases ...
+   - `docker/Dockerfile` currently has:
+      - `SAGE_ROOT=/home/sage/sage`
+      - `SAGE_LOCAL=$SAGE_ROOT/local`
+   - Docker images built with tox/GH Actions (including Gitpod) have:
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/sage/local`
+   - **After this ticket:**
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/opt/sage`
+
+2. #33851: Define a script package representing "useful stuff to have on a Docker image" 
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile.sh` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_comments_577227.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/make_docker_images_from_tox_github_ci_workflow__regular_sage_docker_images__and_gitpod_interoperable\"",
    "created_at": "2022-05-14T18:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577227",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/make_docker_images_from_tox_github_ci_workflow__regular_sage_docker_images__and_gitpod_interoperable"



---

archive/issue_comments_577228.json:
```json
{
    "body": "Changing commit from \"\" to \"58e112ab36ecec775199528c66e4b6e5535ad953\"",
    "created_at": "2022-05-14T18:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577228",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "58e112ab36ecec775199528c66e4b6e5535ad953"



---

archive/issue_comments_577229.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-05-14T18:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_577230.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/make_docker_images_from_tox_github_ci_workflow__regular_sage_docker_images__and_gitpod_interoperable\" to \"\"",
    "created_at": "2022-05-14T20:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577230",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/mkoeppe/make_docker_images_from_tox_github_ci_workflow__regular_sage_docker_images__and_gitpod_interoperable" to ""



---

archive/issue_comments_577231.json:
```json
{
    "body": "Changing commit from \"58e112ab36ecec775199528c66e4b6e5535ad953\" to \"\"",
    "created_at": "2022-05-14T20:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577231",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "58e112ab36ecec775199528c66e4b6e5535ad953" to ""



---

archive/issue_comments_577232.json:
```json
{
    "body": "Changing dependencies from \"#33740\" to \"\"",
    "created_at": "2022-05-14T20:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577232",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#33740" to ""



---

archive/issue_comments_577233.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,28 @@\n+1. Adjust directory names to something that works for both cases ...\n+   - `docker/Dockerfile` currently has:\n+      - `SAGE_ROOT=/home/sage/sage`\n+      - `SAGE_LOCAL=$SAGE_ROOT/local`\n+   - Docker images built with tox/GH Actions (including Gitpod) have:\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/sage/local`\n+   - **After this ticket:**\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/opt/sage`\n+   - CoCalc Docker image has:\n+      - `SAGE_ROOT=/usr/local/sage`\n+      - `SAGE_LOCAL=/usr/local/sage/local`\n+\n+2. #33851: Define a script package representing \"useful stuff to have on a Docker image\" \n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile.sh` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-05-17T21:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577233",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,28 @@
+1. Adjust directory names to something that works for both cases ...
+   - `docker/Dockerfile` currently has:
+      - `SAGE_ROOT=/home/sage/sage`
+      - `SAGE_LOCAL=$SAGE_ROOT/local`
+   - Docker images built with tox/GH Actions (including Gitpod) have:
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/sage/local`
+   - **After this ticket:**
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/opt/sage`
+   - CoCalc Docker image has:
+      - `SAGE_ROOT=/usr/local/sage`
+      - `SAGE_LOCAL=/usr/local/sage/local`
+
+2. #33851: Define a script package representing "useful stuff to have on a Docker image" 
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile.sh` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_comments_577234.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,28 @@\n+1. Adjust directory names to something that works for both cases ...\n+   - `docker/Dockerfile` currently has:\n+      - `SAGE_ROOT=/home/sage/sage`\n+      - `SAGE_LOCAL=$SAGE_ROOT/local`\n+   - Docker images built with tox/GH Actions (including Gitpod) and also `computop/sage` have:\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/sage/local`\n+   - **After this ticket:**\n+      - `SAGE_ROOT=/sage`\n+      - `SAGE_LOCAL=/opt/sage`\n+   - CoCalc Docker image has:\n+      - `SAGE_ROOT=/usr/local/sage`\n+      - `SAGE_LOCAL=/usr/local/sage/local`\n+\n+2. #33851: Define a script package representing \"useful stuff to have on a Docker image\" \n+\n+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.\n+\n+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against \"the reference distribution\"\n+\n+\n+5. Move `build/bin/write-dockerfile.sh` into `docker/`\n+\n+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2022-05-17T23:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29536#issuecomment-577234",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,28 @@
+1. Adjust directory names to something that works for both cases ...
+   - `docker/Dockerfile` currently has:
+      - `SAGE_ROOT=/home/sage/sage`
+      - `SAGE_LOCAL=$SAGE_ROOT/local`
+   - Docker images built with tox/GH Actions (including Gitpod) and also `computop/sage` have:
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/sage/local`
+   - **After this ticket:**
+      - `SAGE_ROOT=/sage`
+      - `SAGE_LOCAL=/opt/sage`
+   - CoCalc Docker image has:
+      - `SAGE_ROOT=/usr/local/sage`
+      - `SAGE_LOCAL=/usr/local/sage/local`
+
+2. #33851: Define a script package representing "useful stuff to have on a Docker image" 
+
+3. Replace all `apt-get` in `docker/Dockerfile` by using a Docker image built using `build/bin/write-dockerfile` as the base image.
+
+4. By default, `docker/Dockerfile` would use `configure --without-system-...` a lot so that CI is done against "the reference distribution"
+
+
+5. Move `build/bin/write-dockerfile.sh` into `docker/`
+
+6. Add a mechanism (environment variable) to `tox -e docker...` to copy SAGE_LOCAL from a given Docker image.
+
 
 
 Comment: 1
``````




---

archive/issue_events_075375.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-01T20:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75375"
}
```



---

archive/issue_events_075376.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-01T20:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29536",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29536#event-75376"
}
```
