# Issue 29910: sage.rings.finite_rings.element_givaro: Remove dependency on NTL

archive/issues_029673.json:
```json
{
    "assignees": [],
    "body": "All dependencies on NTL seem to have been removed from this Cython module already. \n\nIn this ticket, we remove `ntl` from the list of includes and libraries to link.\n\n\nDepends on #29786\n\nCC:  @kiwifb @fchapoton @videlec @ClementPernet\n\nBranch/Commit: **[21f8162](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29910_\n\n",
    "closed_at": "2020-07-08T19:32:18Z",
    "created_at": "2020-06-20T03:47:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20finite%20rings",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage.rings.finite_rings.element_givaro: Remove dependency on NTL",
    "type": "issue",
    "updated_at": "2020-07-08T19:32:18Z",
    "url": "https://github.com/sagemath/sage/issues/29910",
    "user": "https://github.com/mkoeppe"
}
```
All dependencies on NTL seem to have been removed from this Cython module already. 

In this ticket, we remove `ntl` from the list of includes and libraries to link.


Depends on #29786

CC:  @kiwifb @fchapoton @videlec @ClementPernet

Branch/Commit: **[21f8162](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)**

Reviewer: **Fran√ßois Bissey**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/29910_





---

archive/issue_events_379856.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-20T03:47:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379856"
}
```



---

archive/issue_events_379857.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-20T03:47:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20finite%20rings",
    "label_color": "0000ff",
    "label_name": "component: finite rings",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379857"
}
```



---

archive/issue_events_379858.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-20T03:47:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379858"
}
```



---

archive/issue_events_379859.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-20T03:47:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379859"
}
```



---

archive/issue_comments_475719.json:
```json
{
    "body": "Dependencies: **#29786**",
    "created_at": "2020-06-20T03:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475719",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29786**



---

archive/issue_comments_475720.json:
```json
{
    "body": "Branch: **[u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl)**",
    "created_at": "2020-06-20T03:50:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475720",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl)**



---

archive/issue_comments_475721.json:
```json
{
    "body": "Commit: **[21f8162](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)**",
    "created_at": "2020-06-20T03:53:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475721",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[21f8162](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)**



---

archive/issue_comments_475722.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThe branch consists of 1 commit on top of #29786\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa7581059a44bf380614967bfb279f2c88969b74\">aa75810</a></td><td><code>src/module_list.py: Move options for most Extensions in sage.rings to distutils directives</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43a9b169f4030b9a036f3c0e3f94214dbc4f6ab7\">43a9b16</a></td><td><code>src/sage/misc/sageinspect.py: Fix up doctest that depends on a modified source file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5bc828338393e248e1d9e9e9719f9ba22aa7b4e\">a5bc828</a></td><td><code>src/sage/misc/sageinspect.py: Fixup fixup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1baaa68a0fde79d25081c463fed8657c44a43762\">1baaa68</a></td><td><code>src/sage/misc/sageinspect.py: Remove unused import</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da75dc2732fdc38a001a7321e5696792d00d41f0\">da75dc2</a></td><td><code>Merge branch 't/29786/move_extension_options_from_src_module_list_py_to__distutils___directives_in_the_individual_files__part_4__sage_rings_' into t/29910/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751\">21f8162</a></td><td><code>sage.rings.finite_rings.element_givaro: Remove dependency on NTL</code></td></tr></table>\n",
    "created_at": "2020-06-20T03:53:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475722",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'>Comment 3:</a>
The branch consists of 1 commit on top of #29786

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa7581059a44bf380614967bfb279f2c88969b74">aa75810</a></td><td><code>src/module_list.py: Move options for most Extensions in sage.rings to distutils directives</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43a9b169f4030b9a036f3c0e3f94214dbc4f6ab7">43a9b16</a></td><td><code>src/sage/misc/sageinspect.py: Fix up doctest that depends on a modified source file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5bc828338393e248e1d9e9e9719f9ba22aa7b4e">a5bc828</a></td><td><code>src/sage/misc/sageinspect.py: Fixup fixup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1baaa68a0fde79d25081c463fed8657c44a43762">1baaa68</a></td><td><code>src/sage/misc/sageinspect.py: Remove unused import</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da75dc2732fdc38a001a7321e5696792d00d41f0">da75dc2</a></td><td><code>Merge branch 't/29786/move_extension_options_from_src_module_list_py_to__distutils___directives_in_the_individual_files__part_4__sage_rings_' into t/29910/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751">21f8162</a></td><td><code>sage.rings.finite_rings.element_givaro: Remove dependency on NTL</code></td></tr></table>




---

archive/issue_comments_475723.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-06-20T03:54:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475723",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_379860.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-20T03:54:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379860"
}
```



---

archive/issue_comments_475724.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2020-06-20T03:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475724",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **Fran√ßois Bissey**



---

archive/issue_events_379861.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-06-20T03:55:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379861"
}
```



---

archive/issue_events_379862.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-06-20T03:55:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379862"
}
```



---

archive/issue_comments_475725.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nSounds fair to me. In gentoo we apply `--as-needed` at linking time to remove libraries not directly used. \n\n```\n readelf -d /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so \n\nDynamic section at offset 0x4db78 contains 30 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libgivaro.so.9]\n 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0xd000\n```\nno `libntl` in there, not even in `ldd -r` of the same object\n\n```\nldd -r /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so \n\tlinux-vdso.so.1 (0x00007ffe86f86000)\n\tlibgivaro.so.9 => /usr/lib64/libgivaro.so.9 (0x00007f6c5ff7e000)\n\tlibpari-gmp.so.6 => /usr/lib64/libpari-gmp.so.6 (0x00007f6c5f711000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f6c5f698000)\n\tlibstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/10.1.0/libstdc++.so.6 (0x00007f6c5f42d000)\n\tlibpython3.7m.so.1.0 => /usr/lib64/libpython3.7m.so.1.0 (0x00007f6c5f12c000)\n\tlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/10.1.0/libgcc_s.so.1 (0x00007f6c5f112000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f6c5ef57000)\n\tlibgmpxx.so.4 => /usr/lib64/libgmpxx.so.4 (0x00007f6c5ef4e000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f6c5ee18000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f6c5ee13000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f6c6006f000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007f6c5edf3000)\n\tlibutil.so.1 => /lib64/libutil.so.1 (0x00007f6c5edee000)\n```\n\nThe commit looks good to me.",
    "created_at": "2020-06-20T03:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475725",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'>Comment 5:</a>
Sounds fair to me. In gentoo we apply `--as-needed` at linking time to remove libraries not directly used. 

```
 readelf -d /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so 

Dynamic section at offset 0x4db78 contains 30 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libgivaro.so.9]
 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0xd000
```
no `libntl` in there, not even in `ldd -r` of the same object

```
ldd -r /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so 
	linux-vdso.so.1 (0x00007ffe86f86000)
	libgivaro.so.9 => /usr/lib64/libgivaro.so.9 (0x00007f6c5ff7e000)
	libpari-gmp.so.6 => /usr/lib64/libpari-gmp.so.6 (0x00007f6c5f711000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f6c5f698000)
	libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/10.1.0/libstdc++.so.6 (0x00007f6c5f42d000)
	libpython3.7m.so.1.0 => /usr/lib64/libpython3.7m.so.1.0 (0x00007f6c5f12c000)
	libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/10.1.0/libgcc_s.so.1 (0x00007f6c5f112000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f6c5ef57000)
	libgmpxx.so.4 => /usr/lib64/libgmpxx.so.4 (0x00007f6c5ef4e000)
	libm.so.6 => /lib64/libm.so.6 (0x00007f6c5ee18000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007f6c5ee13000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f6c6006f000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f6c5edf3000)
	libutil.so.1 => /lib64/libutil.so.1 (0x00007f6c5edee000)
```

The commit looks good to me.



---

archive/issue_comments_475726.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThanks!",
    "created_at": "2020-06-20T04:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475726",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>Comment 6:</a>
Thanks!



---

archive/issue_events_379863.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-08T19:32:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379863"
}
```



---

archive/issue_events_379864.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "736ceffc417982dd59fa22464f28b4575937fd2e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-07-08T19:32:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29910#event-379864"
}
```



---

archive/issue_comments_475727.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl)** to **[21f8162](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)**",
    "created_at": "2020-07-08T19:32:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29910#issuecomment-475727",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl)** to **[21f8162](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)**
