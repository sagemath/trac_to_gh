# Issue 29910: sage.rings.finite_rings.element_givaro: Remove dependency on NTL

archive/issues_029673.json:
```json
{
    "body": "All dependencies on NTL seem to have been removed from this Cython module already. \n\nIn this ticket, we remove `ntl` from the list of includes and libraries to link.\n\n\nCC:  @kiwifb @fchapoton @videlec @ClementPernet\n\nBranch/Commit: [21f8162c82131a6d5f10999ceb5a20fbe8e47751](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Matthias Koeppe\n\nDependencies: #29786\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29910\n\n",
    "closed_at": "2020-07-08T19:32:18Z",
    "created_at": "2020-06-20T03:47:19Z",
    "labels": [
        "component: finite rings",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "sage.rings.finite_rings.element_givaro: Remove dependency on NTL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29910",
    "user": "https://github.com/mkoeppe"
}
```
All dependencies on NTL seem to have been removed from this Cython module already. 

In this ticket, we remove `ntl` from the list of includes and libraries to link.


CC:  @kiwifb @fchapoton @videlec @ClementPernet

Branch/Commit: [21f8162c82131a6d5f10999ceb5a20fbe8e47751](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)

Reviewer: François Bissey

Author: Matthias Koeppe

Dependencies: #29786

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29910





---

archive/issue_comments_587890.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29786\"",
    "created_at": "2020-06-20T03:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587890",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29786"



---

archive/issue_comments_587891.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl\"",
    "created_at": "2020-06-20T03:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587891",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl"



---

archive/issue_comments_587892.json:
```json
{
    "body": "Changing commit from \"\" to \"21f8162c82131a6d5f10999ceb5a20fbe8e47751\"",
    "created_at": "2020-06-20T03:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587892",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "21f8162c82131a6d5f10999ceb5a20fbe8e47751"



---

archive/issue_comments_587893.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe branch consists of 1 commit on top of #29786\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|\n|[aa75810](https://github.com/sagemath/sagetrac-mirror/commit/aa7581059a44bf380614967bfb279f2c88969b74)|`src/module_list.py: Move options for most Extensions in sage.rings to distutils directives`|\n|[43a9b16](https://github.com/sagemath/sagetrac-mirror/commit/43a9b169f4030b9a036f3c0e3f94214dbc4f6ab7)|`src/sage/misc/sageinspect.py: Fix up doctest that depends on a modified source file`|\n|[a5bc828](https://github.com/sagemath/sagetrac-mirror/commit/a5bc828338393e248e1d9e9e9719f9ba22aa7b4e)|`src/sage/misc/sageinspect.py: Fixup fixup`|\n|[1baaa68](https://github.com/sagemath/sagetrac-mirror/commit/1baaa68a0fde79d25081c463fed8657c44a43762)|`src/sage/misc/sageinspect.py: Remove unused import`|\n|[da75dc2](https://github.com/sagemath/sagetrac-mirror/commit/da75dc2732fdc38a001a7321e5696792d00d41f0)|`Merge branch 't/29786/move_extension_options_from_src_module_list_py_to__distutils___directives_in_the_individual_files__part_4__sage_rings_' into t/29910/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl`|\n|[21f8162](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)|`sage.rings.finite_rings.element_givaro: Remove dependency on NTL`|",
    "created_at": "2020-06-20T03:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587893",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
The branch consists of 1 commit on top of #29786

---
New commits:
|                                                                                                                                          |                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
|[aa75810](https://github.com/sagemath/sagetrac-mirror/commit/aa7581059a44bf380614967bfb279f2c88969b74)|`src/module_list.py: Move options for most Extensions in sage.rings to distutils directives`|
|[43a9b16](https://github.com/sagemath/sagetrac-mirror/commit/43a9b169f4030b9a036f3c0e3f94214dbc4f6ab7)|`src/sage/misc/sageinspect.py: Fix up doctest that depends on a modified source file`|
|[a5bc828](https://github.com/sagemath/sagetrac-mirror/commit/a5bc828338393e248e1d9e9e9719f9ba22aa7b4e)|`src/sage/misc/sageinspect.py: Fixup fixup`|
|[1baaa68](https://github.com/sagemath/sagetrac-mirror/commit/1baaa68a0fde79d25081c463fed8657c44a43762)|`src/sage/misc/sageinspect.py: Remove unused import`|
|[da75dc2](https://github.com/sagemath/sagetrac-mirror/commit/da75dc2732fdc38a001a7321e5696792d00d41f0)|`Merge branch 't/29786/move_extension_options_from_src_module_list_py_to__distutils___directives_in_the_individual_files__part_4__sage_rings_' into t/29910/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl`|
|[21f8162](https://github.com/sagemath/sagetrac-mirror/commit/21f8162c82131a6d5f10999ceb5a20fbe8e47751)|`sage.rings.finite_rings.element_givaro: Remove dependency on NTL`|



---

archive/issue_comments_587894.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-06-20T03:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587894",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_587895.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-20T03:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587895",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_587896.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2020-06-20T03:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587896",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_587897.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-20T03:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587897",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_587898.json:
```json
{
    "body": "<a id='comment:5'></a>\nSounds fair to me. In gentoo we apply `--as-needed` at linking time to remove libraries not directly used. \n\n```\n readelf -d /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so \n\nDynamic section at offset 0x4db78 contains 30 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libgivaro.so.9]\n 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0xd000\n```\nno `libntl` in there, not even in `ldd -r` of the same object\n\n```\nldd -r /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so \n\tlinux-vdso.so.1 (0x00007ffe86f86000)\n\tlibgivaro.so.9 => /usr/lib64/libgivaro.so.9 (0x00007f6c5ff7e000)\n\tlibpari-gmp.so.6 => /usr/lib64/libpari-gmp.so.6 (0x00007f6c5f711000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f6c5f698000)\n\tlibstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/10.1.0/libstdc++.so.6 (0x00007f6c5f42d000)\n\tlibpython3.7m.so.1.0 => /usr/lib64/libpython3.7m.so.1.0 (0x00007f6c5f12c000)\n\tlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/10.1.0/libgcc_s.so.1 (0x00007f6c5f112000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f6c5ef57000)\n\tlibgmpxx.so.4 => /usr/lib64/libgmpxx.so.4 (0x00007f6c5ef4e000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f6c5ee18000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f6c5ee13000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f6c6006f000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007f6c5edf3000)\n\tlibutil.so.1 => /lib64/libutil.so.1 (0x00007f6c5edee000)\n```\n\nThe commit looks good to me.",
    "created_at": "2020-06-20T03:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587898",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Sounds fair to me. In gentoo we apply `--as-needed` at linking time to remove libraries not directly used. 

```
 readelf -d /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so 

Dynamic section at offset 0x4db78 contains 30 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libgivaro.so.9]
 0x0000000000000001 (NEEDED)             Shared library: [libpari-gmp.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libpython3.7m.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0xd000
```
no `libntl` in there, not even in `ldd -r` of the same object

```
ldd -r /usr/lib/python3.7/site-packages/sage/rings/finite_rings/element_givaro.cpython-37m-x86_64-linux-gnu.so 
	linux-vdso.so.1 (0x00007ffe86f86000)
	libgivaro.so.9 => /usr/lib64/libgivaro.so.9 (0x00007f6c5ff7e000)
	libpari-gmp.so.6 => /usr/lib64/libpari-gmp.so.6 (0x00007f6c5f711000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f6c5f698000)
	libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/10.1.0/libstdc++.so.6 (0x00007f6c5f42d000)
	libpython3.7m.so.1.0 => /usr/lib64/libpython3.7m.so.1.0 (0x00007f6c5f12c000)
	libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/10.1.0/libgcc_s.so.1 (0x00007f6c5f112000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f6c5ef57000)
	libgmpxx.so.4 => /usr/lib64/libgmpxx.so.4 (0x00007f6c5ef4e000)
	libm.so.6 => /lib64/libm.so.6 (0x00007f6c5ee18000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007f6c5ee13000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f6c6006f000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f6c5edf3000)
	libutil.so.1 => /lib64/libutil.so.1 (0x00007f6c5edee000)
```

The commit looks good to me.



---

archive/issue_comments_587899.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks!",
    "created_at": "2020-06-20T04:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587899",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Thanks!



---

archive/issue_events_086527.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-08T19:32:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29910#event-86527"
}
```



---

archive/issue_comments_587900.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl\" to \"21f8162c82131a6d5f10999ceb5a20fbe8e47751\"",
    "created_at": "2020-07-08T19:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587900",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/sage_rings_finite_rings_element_givaro__remove_dependency_on_ntl" to "21f8162c82131a6d5f10999ceb5a20fbe8e47751"



---

archive/issue_comments_587901.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T19:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29910#issuecomment-587901",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
