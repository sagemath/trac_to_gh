# Issue 29901: .github/workflows/: Test all optional packages, add workflow for testing all experimental packages

archive/issues_029664.json:
```json
{
    "body": "Follow up from #29341.\n\n\n\nCC:  @jhpalmieri @novoselt @kliem @orlitzky\n\nReviewer: Jonathan Kliem\n\nAuthor: Matthias Koeppe\n\nBranch: 6afe959a174db2339f5f10bcad8c4a535ec66cf2\n\nDependencies: #29174, #29823, #20104\n\nCommit: 6afe959a174db2339f5f10bcad8c4a535ec66cf2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29901\n\n",
    "closed_at": "2020-07-25T22:51:14Z",
    "created_at": "2020-06-19T16:41:43Z",
    "labels": [
        "component: porting"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": ".github/workflows/: Test all optional packages, add workflow for testing all experimental packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29901",
    "user": "https://github.com/mkoeppe"
}
```
Follow up from #29341.



CC:  @jhpalmieri @novoselt @kliem @orlitzky

Reviewer: Jonathan Kliem

Author: Matthias Koeppe

Branch: 6afe959a174db2339f5f10bcad8c4a535ec66cf2

Dependencies: #29174, #29823, #20104

Commit: 6afe959a174db2339f5f10bcad8c4a535ec66cf2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29901





---

archive/issue_comments_420817.json:
```json
{
    "body": "<a id='comment:5'></a>The present version has an explicit list of the packages to the workflow scripts. This could be made less maintenance-intensive by #29902\n\n---\nNew commits:",
    "created_at": "2020-06-19T17:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420817",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>The present version has an explicit list of the packages to the workflow scripts. This could be made less maintenance-intensive by #29902

---
New commits:



---

archive/issue_comments_420818.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-19T17:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_420819.json:
```json
{
    "body": "<a id='comment:7'></a>.github/workflows/: Test all optional packages, add workflow for testing all experimental packages \u00b7 mkoeppe/sage`@`f87c885\nhttps://github.com/mkoeppe/sage/actions/runs/141135018\n\n.github/workflows/: Test all optional packages, add workflow for testing all experimental packages \u00b7 mkoeppe/sage`@`f87c885\nhttps://github.com/mkoeppe/sage/actions/runs/141135010",
    "created_at": "2020-06-19T18:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420819",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>.github/workflows/: Test all optional packages, add workflow for testing all experimental packages · mkoeppe/sage`@`f87c885
https://github.com/mkoeppe/sage/actions/runs/141135018

.github/workflows/: Test all optional packages, add workflow for testing all experimental packages · mkoeppe/sage`@`f87c885
https://github.com/mkoeppe/sage/actions/runs/141135010



---

archive/issue_comments_420820.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-20T06:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420821.json:
```json
{
    "body": "<a id='comment:10'></a>https://github.com/mkoeppe/sage/runs/789828733\n\n```\nError processing tar file(exit status 1): write /sage/local/share/pari/elldata/ell366: no space left on device\nError response from daemon: Error processing tar file(exit status 1): write /sage/local/share/stein_watkins/a.010.bz2: no space left on device\n```",
    "created_at": "2020-06-20T06:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420821",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>https://github.com/mkoeppe/sage/runs/789828733

```
Error processing tar file(exit status 1): write /sage/local/share/pari/elldata/ell366: no space left on device
Error response from daemon: Error processing tar file(exit status 1): write /sage/local/share/stein_watkins/a.010.bz2: no space left on device
```



---

archive/issue_comments_420822.json:
```json
{
    "body": "<a id='comment:11'></a>Maybe we don't need to test `database_stein_watkins` much: if `database_stein_watkins_mini` works, then since they use the same spkg-install.in, the only issue, I think, is whether the big tarball is corrupt.",
    "created_at": "2020-06-20T15:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420822",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>Maybe we don't need to test `database_stein_watkins` much: if `database_stein_watkins_mini` works, then since they use the same spkg-install.in, the only issue, I think, is whether the big tarball is corrupt.



---

archive/issue_comments_420823.json:
```json
{
    "body": "<a id='comment:12'></a>Right. There was apparently a point to having that old category of \"huge\" packages. Wondering how that got lost. --> #29919 (Restore \"huge\" package type)",
    "created_at": "2020-06-20T16:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420823",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Right. There was apparently a point to having that old category of "huge" packages. Wondering how that got lost. --> #29919 (Restore "huge" package type)



---

archive/issue_comments_420824.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-20T16:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420825.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-20T16:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_420826.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-20T17:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_420827.json:
```json
{
    "body": "<a id='comment:16'></a>New test at https://github.com/mkoeppe/sage/actions/runs/141954265",
    "created_at": "2020-06-20T17:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420827",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>New test at https://github.com/mkoeppe/sage/actions/runs/141954265



---

archive/issue_comments_420828.json:
```json
{
    "body": "<a id='comment:17'></a>Filtering out the known huge packages works now.\n\nBut there are many timeouts. Will need to split \"optional\" into 2 parts.",
    "created_at": "2020-06-22T17:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420828",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Filtering out the known huge packages works now.

But there are many timeouts. Will need to split "optional" into 2 parts.



---

archive/issue_comments_420829.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-14T04:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420830.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-14T04:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420831.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-15T18:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420832.json:
```json
{
    "body": "<a id='comment:22'></a>Tests for experimental packages at https://github.com/mkoeppe/sage/actions/runs/170318716\n\nTests for optional packages at https://github.com/mkoeppe/sage/actions/runs/170362341",
    "created_at": "2020-07-15T18:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420832",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>Tests for experimental packages at https://github.com/mkoeppe/sage/actions/runs/170318716

Tests for optional packages at https://github.com/mkoeppe/sage/actions/runs/170362341



---

archive/issue_comments_420833.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-15T21:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420833",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_420834.json:
```json
{
    "body": "<a id='comment:24'></a>Still exceeds 2 x 6h on `ubuntu-xenial`, need to split it up more",
    "created_at": "2020-07-16T01:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420834",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Still exceeds 2 x 6h on `ubuntu-xenial`, need to split it up more



---

archive/issue_comments_420835.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-16T05:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420836.json:
```json
{
    "body": "<a id='comment:26'></a>Tests at https://github.com/mkoeppe/sage/actions/runs/170932419 and https://github.com/mkoeppe/sage/actions/runs/170932412",
    "created_at": "2020-07-16T05:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420836",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Tests at https://github.com/mkoeppe/sage/actions/runs/170932419 and https://github.com/mkoeppe/sage/actions/runs/170932412



---

archive/issue_comments_420837.json:
```json
{
    "body": "<a id='comment:27'></a>Should remove the testing of `sage_numerical_backends_cplex`, `sage_numerical_backends_gurobi`, which require the commercial packages to be installed first",
    "created_at": "2020-07-16T19:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420837",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Should remove the testing of `sage_numerical_backends_cplex`, `sage_numerical_backends_gurobi`, which require the commercial packages to be installed first



---

archive/issue_comments_420838.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-16T19:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420839.json:
```json
{
    "body": "<a id='comment:29'></a>Why are there green checkmarks, if things haven't worked out?\n\nhttps://github.com/mkoeppe/sage/runs/876312084?check_suite_focus=true",
    "created_at": "2020-07-17T19:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420839",
    "user": "https://github.com/kliem"
}
```

<a id='comment:29'></a>Why are there green checkmarks, if things haven't worked out?

https://github.com/mkoeppe/sage/runs/876312084?check_suite_focus=true



---

archive/issue_comments_420840.json:
```json
{
    "body": "<a id='comment:30'></a>Targets listed in `TARGETS_OPTIONAL` ignore errors.",
    "created_at": "2020-07-17T19:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420840",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>Targets listed in `TARGETS_OPTIONAL` ignore errors.



---

archive/issue_comments_420841.json:
```json
{
    "body": "<a id='comment:31'></a>Why is that? There is probably a good reason, but I'm curious. How do I efficiently use it then.",
    "created_at": "2020-07-17T19:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420841",
    "user": "https://github.com/kliem"
}
```

<a id='comment:31'></a>Why is that? There is probably a good reason, but I'm curious. How do I efficiently use it then.



---

archive/issue_comments_420842.json:
```json
{
    "body": "<a id='comment:32'></a>Unfortunately a test run can only get a red or a green status on GH Actions.\n`TARGETS_OPTIONAL` is designed for additional tests of things that are likely to fail - such as `ptest` in `tox.yml`, which always has 1 or 2 failures that we don't want to be signaled by a red status.\n\nThere's only a rather shallow reason why currently use `TARGETS_OPTIONAL` for testing the optional and experimental packages. At the moment the majority of the optional and experimental packages fail, so all of these test runs will fail. Thus there is no information either way. But the green checkmarks look more friendly. \n\nWe can change this when we have made some progress in #29900 (Meta-ticket: Fix optional and experimental packages for Sage 9.2).",
    "created_at": "2020-07-17T19:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420842",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Unfortunately a test run can only get a red or a green status on GH Actions.
`TARGETS_OPTIONAL` is designed for additional tests of things that are likely to fail - such as `ptest` in `tox.yml`, which always has 1 or 2 failures that we don't want to be signaled by a red status.

There's only a rather shallow reason why currently use `TARGETS_OPTIONAL` for testing the optional and experimental packages. At the moment the majority of the optional and experimental packages fail, so all of these test runs will fail. Thus there is no information either way. But the green checkmarks look more friendly. 

We can change this when we have made some progress in #29900 (Meta-ticket: Fix optional and experimental packages for Sage 9.2).



---

archive/issue_comments_420843.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:31 gh-kliem]:\n> How do I efficiently use it then.\n\n\nLook at the \"This run\" tab of the whole workflow and search for package names that you're interested in.",
    "created_at": "2020-07-17T19:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420843",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Replying to [comment:31 gh-kliem]:
> How do I efficiently use it then.


Look at the "This run" tab of the whole workflow and search for package names that you're interested in.



---

archive/issue_comments_420844.json:
```json
{
    "body": "<a id='comment:34'></a>Thanks. Yes, sounds reasonable.\n\nFrom my point of view, optional should mean almost as safe as sage itself and experimental is for all stuff that might or might not work (I guess there are runtime failures as well that make stuff experimental). So adding a doctesting framework for this seems great.",
    "created_at": "2020-07-17T19:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420844",
    "user": "https://github.com/kliem"
}
```

<a id='comment:34'></a>Thanks. Yes, sounds reasonable.

From my point of view, optional should mean almost as safe as sage itself and experimental is for all stuff that might or might not work (I guess there are runtime failures as well that make stuff experimental). So adding a doctesting framework for this seems great.



---

archive/issue_comments_420845.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 gh-kliem]:\n> From my point of view, optional should mean almost as safe as sage itself and experimental is for all stuff that might or might not work (I guess there are runtime failures as well that make stuff experimental).\n\n\nYes, I agree with this interpretation.",
    "created_at": "2020-07-17T20:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420845",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Replying to [comment:34 gh-kliem]:
> From my point of view, optional should mean almost as safe as sage itself and experimental is for all stuff that might or might not work (I guess there are runtime failures as well that make stuff experimental).


Yes, I agree with this interpretation.



---

archive/issue_comments_420846.json:
```json
{
    "body": "<a id='comment:36'></a>I think this is a good improvement as it is.",
    "created_at": "2020-07-17T20:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420846",
    "user": "https://github.com/kliem"
}
```

<a id='comment:36'></a>I think this is a good improvement as it is.



---

archive/issue_comments_420847.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-17T20:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420847",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_420848.json:
```json
{
    "body": "<a id='comment:37'></a>Thanks!",
    "created_at": "2020-07-17T20:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420848",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>Thanks!



---

archive/issue_comments_420849.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-25T22:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29901#issuecomment-420849",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076675.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-25T22:51:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29901",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29901#event-76675"
}
```
