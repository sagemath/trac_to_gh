# Issue 29257: use solve_left for division operation of matrices

archive/issues_029020.json:
```json
{
    "body": "This ticket improves the `__truediv__` division operation of matrices and vectors by implementing it using `solve_left` (the `_backslash_` operator is already implemented using `solve_right`).\n\nCurrently, `__truediv__` only works for square matrices with the same parent. The implementation naively computes the inverse of a matrix, which should be avoided, especially over inexact rings.\n\nWith the changes of this ticket (and #12406), the operation works over differing rings and even with non-square matrices.\n\n```\nsage: a = matrix(ZZ, [[1, 2], [0, 3]])\nsage: b = matrix(ZZ, 3, 2, range(6))\nsage: b / a == b * ~a\nTrue\n\nsage: a = matrix(ZZ, [[1, 2], [0, 3], [1, 5]])\nsage: (b / a) * a == b\nTrue\n\nsage: b = vector(RDF, [1.5, 2.5])\nsage: (b / a * a - b).norm() < 1e-14\nTrue\n```\n\n\nBranch/Commit: 653849a0ec393a672103560aae9cfc78d398e1d6\n\nReviewer: Jonathan Kliem\n\nAuthor: Markus Wageringel\n\nDependencies: #12406\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29257\n\n",
    "closed_at": "2020-08-16T22:33:14Z",
    "created_at": "2020-02-28T13:05:56Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "use solve_left for division operation of matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29257",
    "user": "https://github.com/mwageringel"
}
```
This ticket improves the `__truediv__` division operation of matrices and vectors by implementing it using `solve_left` (the `_backslash_` operator is already implemented using `solve_right`).

Currently, `__truediv__` only works for square matrices with the same parent. The implementation naively computes the inverse of a matrix, which should be avoided, especially over inexact rings.

With the changes of this ticket (and #12406), the operation works over differing rings and even with non-square matrices.

```
sage: a = matrix(ZZ, [[1, 2], [0, 3]])
sage: b = matrix(ZZ, 3, 2, range(6))
sage: b / a == b * ~a
True

sage: a = matrix(ZZ, [[1, 2], [0, 3], [1, 5]])
sage: (b / a) * a == b
True

sage: b = vector(RDF, [1.5, 2.5])
sage: (b / a * a - b).norm() < 1e-14
True
```


Branch/Commit: 653849a0ec393a672103560aae9cfc78d398e1d6

Reviewer: Jonathan Kliem

Author: Markus Wageringel

Dependencies: #12406

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29257





---

archive/issue_comments_570504.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-mwageringel/29257\"",
    "created_at": "2020-02-28T13:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570504",
    "user": "https://github.com/mwageringel"
}
```

Changing branch from "" to "u/gh-mwageringel/29257"



---

archive/issue_comments_570505.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-28T13:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570505",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_570506.json:
```json
{
    "body": "Changing author from \"\" to \"Markus Wageringel\"",
    "created_at": "2020-02-28T13:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570506",
    "user": "https://github.com/mwageringel"
}
```

Changing author from "" to "Markus Wageringel"



---

archive/issue_comments_570507.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#12406\"",
    "created_at": "2020-02-28T13:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570507",
    "user": "https://github.com/mwageringel"
}
```

Changing dependencies from "" to "#12406"



---

archive/issue_comments_570508.json:
```json
{
    "body": "<a id='comment:1'></a>Based on #12406.\n\n---\nNew commits:",
    "created_at": "2020-02-28T13:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570508",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>Based on #12406.

---
New commits:



---

archive/issue_comments_570509.json:
```json
{
    "body": "Changing commit from \"\" to \"828d67aa9d9732e340d879a2293e31a1378dce38\"",
    "created_at": "2020-02-28T13:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570509",
    "user": "https://github.com/mwageringel"
}
```

Changing commit from "" to "828d67aa9d9732e340d879a2293e31a1378dce38"



---

archive/issue_comments_570510.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-02-28T13:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_570511.json:
```json
{
    "body": "Changing commit from \"828d67aa9d9732e340d879a2293e31a1378dce38\" to \"859900e4fac586b00343342fb99abcccf52a01d3\"",
    "created_at": "2020-02-28T13:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "828d67aa9d9732e340d879a2293e31a1378dce38" to "859900e4fac586b00343342fb99abcccf52a01d3"



---

archive/issue_comments_570512.json:
```json
{
    "body": "<a id='comment:3'></a>Now this also passes the tests with Python 2.",
    "created_at": "2020-02-28T13:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570512",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:3'></a>Now this also passes the tests with Python 2.



---

archive/issue_comments_570513.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-03-31T17:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570513",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_570514.json:
```json
{
    "body": "Changing commit from \"859900e4fac586b00343342fb99abcccf52a01d3\" to \"be62f788c4047f0f8a04a398e16368aaba09fc04\"",
    "created_at": "2020-03-31T17:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "859900e4fac586b00343342fb99abcccf52a01d3" to "be62f788c4047f0f8a04a398e16368aaba09fc04"



---

archive/issue_comments_570515.json:
```json
{
    "body": "<a id='comment:5'></a>Rebased on top of #12406.",
    "created_at": "2020-03-31T17:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570515",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:5'></a>Rebased on top of #12406.



---

archive/issue_events_074421.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29257#event-74421"
}
```



---

archive/issue_comments_570516.json:
```json
{
    "body": "<a id='comment:6'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570516",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_570517.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-13T17:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_570518.json:
```json
{
    "body": "Changing commit from \"be62f788c4047f0f8a04a398e16368aaba09fc04\" to \"653849a0ec393a672103560aae9cfc78d398e1d6\"",
    "created_at": "2020-08-13T17:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570518",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "be62f788c4047f0f8a04a398e16368aaba09fc04" to "653849a0ec393a672103560aae9cfc78d398e1d6"



---

archive/issue_comments_570519.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jonathan Kliem\"",
    "created_at": "2020-08-15T08:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570519",
    "user": "https://github.com/kliem"
}
```

Changing reviewer from "" to "Jonathan Kliem"



---

archive/issue_comments_570520.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-15T08:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570520",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_570521.json:
```json
{
    "body": "<a id='comment:8'></a>LGTM.",
    "created_at": "2020-08-15T08:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570521",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>LGTM.



---

archive/issue_comments_570522.json:
```json
{
    "body": "<a id='comment:9'></a>Thank you. There was a related discussion in #29226 which has not been crosslinked here yet. IMHO, this is still an improvement over the current behavior, but it is okay if you would like to reconsider the review.",
    "created_at": "2020-08-15T10:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570522",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:9'></a>Thank you. There was a related discussion in #29226 which has not been crosslinked here yet. IMHO, this is still an improvement over the current behavior, but it is okay if you would like to reconsider the review.



---

archive/issue_comments_570523.json:
```json
{
    "body": "<a id='comment:10'></a>I see. Of course we can remove division of matrices, but even our documentation https://doc.sagemath.org/html/en/tutorial/tour_linalg.html\nadvertises using the backslash.\n\nFor the time being it's an improvement. Even if we want to get rid of it eventually, at this point we could raise a deprecation error more easily and say, \"use solve left/right instead\".",
    "created_at": "2020-08-15T10:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570523",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>I see. Of course we can remove division of matrices, but even our documentation https://doc.sagemath.org/html/en/tutorial/tour_linalg.html
advertises using the backslash.

For the time being it's an improvement. Even if we want to get rid of it eventually, at this point we could raise a deprecation error more easily and say, "use solve left/right instead".



---

archive/issue_comments_570524.json:
```json
{
    "body": "<a id='comment:11'></a>Ok, sounds good to me.",
    "created_at": "2020-08-15T10:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570524",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:11'></a>Ok, sounds good to me.



---

archive/issue_events_074422.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-16T22:33:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29257#event-74422"
}
```



---

archive/issue_comments_570525.json:
```json
{
    "body": "Changing branch from \"u/gh-mwageringel/29257\" to \"653849a0ec393a672103560aae9cfc78d398e1d6\"",
    "created_at": "2020-08-16T22:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570525",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-mwageringel/29257" to "653849a0ec393a672103560aae9cfc78d398e1d6"



---

archive/issue_comments_570526.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-16T22:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29257",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29257#issuecomment-570526",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
