# Issue 29240: Upgrade pexpect to 4.8

archive/issues_029003.json:
```json
{
    "body": "Requires changes to expect_upto and expect_peek due to [1]. Removed patch merged upstream\n\n[1] https://github.com/pexpect/pexpect/commit/fa084459198f7e9f4a2f346ea8bdac2ca102bc87\n\nTarball: https://codeload.github.com/pexpect/pexpect/tar.gz/4.8.0\n\nCC:  @kiwifb @timokau @jdemeyer @slel @saraedum @mkoeppe\n\nKeywords: upgrade, pexpect\n\nReviewer: Matthias Koeppe\n\nAuthor: Antonio Rojas, Samuel Leli\u00e8vre\n\nBranch: 97a4b082adc8b1ebb8cf80fbd6f70670a34b599b\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29240\n\n",
    "closed_at": "2020-08-26T21:17:45Z",
    "created_at": "2020-02-23T22:02:30Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Upgrade pexpect to 4.8",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29240",
    "user": "https://github.com/antonio-rojas"
}
```
Requires changes to expect_upto and expect_peek due to [1]. Removed patch merged upstream

[1] https://github.com/pexpect/pexpect/commit/fa084459198f7e9f4a2f346ea8bdac2ca102bc87

Tarball: https://codeload.github.com/pexpect/pexpect/tar.gz/4.8.0

CC:  @kiwifb @timokau @jdemeyer @slel @saraedum @mkoeppe

Keywords: upgrade, pexpect

Reviewer: Matthias Koeppe

Author: Antonio Rojas, Samuel Leli√®vre

Branch: 97a4b082adc8b1ebb8cf80fbd6f70670a34b599b

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29240





---

archive/issue_comments_437153.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2020-02-23T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437153",
    "user": "https://github.com/antonio-rojas"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_437154.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+Requires changes to expect_upto and expect_peek due to [1]. Removed patch merged upstream\n \n+[1] https://github.com/pexpect/pexpect/commit/fa084459198f7e9f4a2f346ea8bdac2ca102bc87\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-02-23T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437154",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+Requires changes to expect_upto and expect_peek due to [1]. Removed patch merged upstream
 
+[1] https://github.com/pexpect/pexpect/commit/fa084459198f7e9f4a2f346ea8bdac2ca102bc87
 
 Comment: 1
 
``````




---

archive/issue_comments_437155.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2020-02-23T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437155",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_437156.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2020-02-23T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437156",
    "user": "https://github.com/antonio-rojas"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_437157.json:
```json
{
    "body": "pexpect 4.8 crash log",
    "created_at": "2020-02-23T22:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437157",
    "user": "https://github.com/antonio-rojas"
}
```

pexpect 4.8 crash log



---

archive/issue_comments_437158.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [crash_prq3b6_w.log](tarball://root/attachments/some-uuid/ticket29240/crash_prq3b6_w.log) by @antonio-rojas created at 2020-02-23 22:13:14\n\nI'm getting a segfault on interfaces/singular.py caused by [2]. It is not reproducible in my distro package, only on sage-the-distro. Any ideas?\n\n[2] https://github.com/pexpect/pexpect/commit/f98485ae7ddd2786f2d0fc6234d15f9f1e55caea",
    "created_at": "2020-02-23T22:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437158",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:3'></a>Attachment [crash_prq3b6_w.log](tarball://root/attachments/some-uuid/ticket29240/crash_prq3b6_w.log) by @antonio-rojas created at 2020-02-23 22:13:14

I'm getting a segfault on interfaces/singular.py caused by [2]. It is not reproducible in my distro package, only on sage-the-distro. Any ideas?

[2] https://github.com/pexpect/pexpect/commit/f98485ae7ddd2786f2d0fc6234d15f9f1e55caea



---

archive/issue_comments_437159.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+Requires changes to expect_upto and expect_peek due to [1]. Removed patch merged upstream\n \n+[1] https://github.com/pexpect/pexpect/commit/fa084459198f7e9f4a2f346ea8bdac2ca102bc87\n+\n+Tarball: https://codeload.github.com/pexpect/pexpect/tar.gz/4.8.0\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-02-23T22:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437159",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
+Requires changes to expect_upto and expect_peek due to [1]. Removed patch merged upstream
 
+[1] https://github.com/pexpect/pexpect/commit/fa084459198f7e9f4a2f346ea8bdac2ca102bc87
+
+Tarball: https://codeload.github.com/pexpect/pexpect/tar.gz/4.8.0
 
 Comment: 1
 
``````




---

archive/issue_events_074359.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-04T20:06:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29240#event-74359"
}
```



---

archive/issue_comments_437160.json:
```json
{
    "body": "<a id='comment:7'></a>I have no ideas about your crash. Does it still happen on sage-the-distro in the current beta? I would quite happily move on on that one otherwise.",
    "created_at": "2020-07-19T23:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437160",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>I have no ideas about your crash. Does it still happen on sage-the-distro in the current beta? I would quite happily move on on that one otherwise.



---

archive/issue_comments_437161.json:
```json
{
    "body": "<a id='comment:8'></a>Actually, this has just started crashing on my Arch package too recently. No idea which update triggered it.",
    "created_at": "2020-07-22T08:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437161",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:8'></a>Actually, this has just started crashing on my Arch package too recently. No idea which update triggered it.



---

archive/issue_comments_437162.json:
```json
{
    "body": "<a id='comment:9'></a>I am not experiencing crash so far.",
    "created_at": "2020-07-22T09:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437162",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>I am not experiencing crash so far.



---

archive/issue_comments_437163.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-24T07:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437163",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437164.json:
```json
{
    "body": "<a id='comment:10'></a>And now I can't reproduce the crash on sage-the-distro, only on my Arch package... well this is weird.\nI'll set this to needs_review to see if any of the build bots can reproduce the crash.",
    "created_at": "2020-07-24T07:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437164",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:10'></a>And now I can't reproduce the crash on sage-the-distro, only on my Arch package... well this is weird.
I'll set this to needs_review to see if any of the build bots can reproduce the crash.



---

archive/issue_comments_437165.json:
```json
{
    "body": "<a id='comment:12'></a>Strangely, the Arch segfault seems caused by sympy 1.6.1 (which doesn't seem to be used in interfaces/singular.py at all)",
    "created_at": "2020-07-24T11:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437165",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:12'></a>Strangely, the Arch segfault seems caused by sympy 1.6.1 (which doesn't seem to be used in interfaces/singular.py at all)



---

archive/issue_comments_437166.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:10 arojas]:\n> And now I can't reproduce the crash on sage-the-distro, only on my Arch package... well this is weird.\n> I'll set this to needs_review to see if any of the build bots can reproduce the crash.\n\n\nFor broader coverage of platforms you could push a tag to GitHub so that the GH actions CI infrastructure is run on this ticket...",
    "created_at": "2020-07-26T18:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437166",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Replying to [comment:10 arojas]:
> And now I can't reproduce the crash on sage-the-distro, only on my Arch package... well this is weird.
> I'll set this to needs_review to see if any of the build bots can reproduce the crash.


For broader coverage of platforms you could push a tag to GitHub so that the GH actions CI infrastructure is run on this ticket...



---

archive/issue_comments_437167.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 arojas]:\n> Strangely, the Arch segfault seems caused by sympy 1.6.1 (which doesn't seem to be used in interfaces/singular.py at all)\n\n\nThis is in the weird territory, especially if you can reproduce it individually. We should definitely have a go at doing the github testing.",
    "created_at": "2020-07-27T01:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437167",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>Replying to [comment:12 arojas]:
> Strangely, the Arch segfault seems caused by sympy 1.6.1 (which doesn't seem to be used in interfaces/singular.py at all)


This is in the weird territory, especially if you can reproduce it individually. We should definitely have a go at doing the github testing.



---

archive/issue_comments_437168.json:
```json
{
    "body": "<a id='comment:15'></a>I also see segfaults on `archlinux-latest-standard` at https://github.com/mkoeppe/sage/runs/912558565 while testing #29766 - unrelated to this ticket.\n\n```\nsage -t --random-seed=0 src/doc/en/reference/sat/index.rst  # Killed due to segmentation fault\nsage -t --random-seed=0 src/sage/crypto/mq/sr.py  # Killed due to abort\nsage -t --random-seed=0 src/sage/interfaces/quit.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/rings/polynomial/multi_polynomial_sequence.py  # Killed due to segmentation fault\nsage -t --random-seed=0 src/sage/rings/polynomial/pbori.pyx  # Killed due to abort\nsage -t --random-seed=0 src/sage/rings/polynomial/polynomial_ring_constructor.py  # Killed due to abort\nsage -t --random-seed=0 src/sage/sat/boolean_polynomials.py  # Killed due to segmentation fault\nsage -t --random-seed=0 src/sage/sat/solvers/dimacs.py  # Killed due to segmentation fault\n```",
    "created_at": "2020-07-28T02:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437168",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>I also see segfaults on `archlinux-latest-standard` at https://github.com/mkoeppe/sage/runs/912558565 while testing #29766 - unrelated to this ticket.

```
sage -t --random-seed=0 src/doc/en/reference/sat/index.rst  # Killed due to segmentation fault
sage -t --random-seed=0 src/sage/crypto/mq/sr.py  # Killed due to abort
sage -t --random-seed=0 src/sage/interfaces/quit.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/rings/polynomial/multi_polynomial_sequence.py  # Killed due to segmentation fault
sage -t --random-seed=0 src/sage/rings/polynomial/pbori.pyx  # Killed due to abort
sage -t --random-seed=0 src/sage/rings/polynomial/polynomial_ring_constructor.py  # Killed due to abort
sage -t --random-seed=0 src/sage/sat/boolean_polynomials.py  # Killed due to segmentation fault
sage -t --random-seed=0 src/sage/sat/solvers/dimacs.py  # Killed due to segmentation fault
```



---

archive/issue_comments_437169.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 mkoeppe]:\n> I also see segfaults on `archlinux-latest-standard` at https://github.com/mkoeppe/sage/runs/912558565 while testing #29766 - unrelated to this ticket.\n\n\nThose crashes are on brial - I'm pretty sure they are caused by using system brial compiled with GCC 10 and running against sage's stdlib from GCC 9. brial is very sensitive to the GCC version it is compiled with - if system GCC is not being used, system brial shouldn't be used either.",
    "created_at": "2020-07-28T07:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437169",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:16'></a>Replying to [comment:15 mkoeppe]:
> I also see segfaults on `archlinux-latest-standard` at https://github.com/mkoeppe/sage/runs/912558565 while testing #29766 - unrelated to this ticket.


Those crashes are on brial - I'm pretty sure they are caused by using system brial compiled with GCC 10 and running against sage's stdlib from GCC 9. brial is very sensitive to the GCC version it is compiled with - if system GCC is not being used, system brial shouldn't be used either.



---

archive/issue_comments_437170.json:
```json
{
    "body": "<a id='comment:17'></a>I accept pull request for brial if there is anything you can pinpoint to.",
    "created_at": "2020-07-28T07:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437170",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>I accept pull request for brial if there is anything you can pinpoint to.



---

archive/issue_comments_437171.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 fbissey]:\n> I accept pull request for brial if there is anything you can pinpoint to.\n\n\nNo idea what the actual issue is - I just know I need to rebuild it every time libstdc++ is updated to prevent crashes.",
    "created_at": "2020-07-28T08:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437171",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:18'></a>Replying to [comment:17 fbissey]:
> I accept pull request for brial if there is anything you can pinpoint to.


No idea what the actual issue is - I just know I need to rebuild it every time libstdc++ is updated to prevent crashes.



---

archive/issue_comments_437172.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-15T21:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437172",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_437173.json:
```json
{
    "body": "<a id='comment:19'></a>needs upstream_url",
    "created_at": "2020-08-15T21:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437173",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>needs upstream_url



---

archive/issue_comments_437174.json:
```json
{
    "body": "Changing keywords from \"\" to \"upgrade, pexpect\".",
    "created_at": "2020-08-20T16:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437174",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "upgrade, pexpect".



---

archive/issue_comments_437175.json:
```json
{
    "body": "<a id='comment:20'></a>New commits:",
    "created_at": "2020-08-20T16:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437175",
    "user": "https://github.com/slel"
}
```

<a id='comment:20'></a>New commits:



---

archive/issue_comments_437176.json:
```json
{
    "body": "<a id='comment:21'></a>Added upstream url and rebased on Sage 9.2.beta9.",
    "created_at": "2020-08-20T16:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437176",
    "user": "https://github.com/slel"
}
```

<a id='comment:21'></a>Added upstream url and rebased on Sage 9.2.beta9.



---

archive/issue_comments_437177.json:
```json
{
    "body": "<a id='comment:22'></a>I pushed a tag to my copy of the Sage repo on GitHub.\n\nhttps://github.com/slel/sage/tree/ci-pexpect-29240",
    "created_at": "2020-08-20T17:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437177",
    "user": "https://github.com/slel"
}
```

<a id='comment:22'></a>I pushed a tag to my copy of the Sage repo on GitHub.

https://github.com/slel/sage/tree/ci-pexpect-29240



---

archive/issue_comments_437178.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-22T03:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437178",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_437179.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-22T03:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437179",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437180.json:
```json
{
    "body": "<a id='comment:24'></a>Looks OK.",
    "created_at": "2020-08-22T03:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437180",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Looks OK.



---

archive/issue_events_074360.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-26T21:17:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29240#event-74360"
}
```



---

archive/issue_comments_437181.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-26T21:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437181",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_437182.json:
```json
{
    "body": "<a id='comment:26'></a>Follow-up at #30945.",
    "created_at": "2020-11-26T14:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29240#issuecomment-437182",
    "user": "https://github.com/slel"
}
```

<a id='comment:26'></a>Follow-up at #30945.
