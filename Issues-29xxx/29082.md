# Issue 29082: Do not stage .pc files in src/lib/, clean old generated *.pc files at 'make distclean', fix 'permission denied' errors

archive/issues_028845.json:
```json
{
    "body": "#29003 introduced 2-stage installation of generated *.pc files, \nvia `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).\n \nAlso, in some installations, repeated installations this code leads to 'permission denied' errors when trying to overwrite read-only files:\n\n```\n  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/blas.pc\n  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/cblas.pc\n  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/lapack.pc\n  [openblas-0.3.6.p0]   \n  [openblas-0.3.6.p0]   real\t8m40.259s\n  [openblas-0.3.6.p0]   user\t45m2.739s\n  [openblas-0.3.6.p0]   sys\t5m48.754s\n  [openblas-0.3.6.p0]   Copying package files from temporary location /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst to /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local\n  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/cblas.pc: Permission denied\n  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/blas.pc: Permission denied\n  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/lapack.pc: Permission denied\n```\n\nThis ticket revises the installation as follows:\n\n- `configure` no longer creates .pc files in the build tree\n- Instead it creates rules in `make/Makefile` that create the .pc files in `SAGE_LOCAL`.\n- Before pc files are installed into `SAGE_LOCAL`, the targets are removed, to avoid permission problems\n\nThis ticket does not solve everything. There may still be problems when switching from a system library to an spkg-provided library. We will use the follow-up ticket #29387 (Complete solution for installing the generated *.pc files) to address this problem.\n\n\n\n**CC:**  @embray @mkoeppe @jhpalmieri @vbraun @kiwifb\n\n**Branch/Commit:** [329843baa9cecfb751e8afdb6b666f01930f0bf0](https://github.com/sagemath/sagetrac-mirror/commit/329843baa9cecfb751e8afdb6b666f01930f0bf0)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/29082\n\n",
    "closed_at": "2020-03-29T00:24:26Z",
    "created_at": "2020-01-26T12:40:13Z",
    "labels": [
        "component: build: configure",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "Do not stage .pc files in src/lib/, clean old generated *.pc files at 'make distclean', fix 'permission denied' errors",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/29082",
    "user": "https://github.com/dimpase"
}
```
#29003 introduced 2-stage installation of generated *.pc files, 
via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).
 
Also, in some installations, repeated installations this code leads to 'permission denied' errors when trying to overwrite read-only files:

```
  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/blas.pc
  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/cblas.pc
  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/lapack.pc
  [openblas-0.3.6.p0]   
  [openblas-0.3.6.p0]   real	8m40.259s
  [openblas-0.3.6.p0]   user	45m2.739s
  [openblas-0.3.6.p0]   sys	5m48.754s
  [openblas-0.3.6.p0]   Copying package files from temporary location /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst to /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local
  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/cblas.pc: Permission denied
  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/blas.pc: Permission denied
  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/lapack.pc: Permission denied
```

This ticket revises the installation as follows:

- `configure` no longer creates .pc files in the build tree
- Instead it creates rules in `make/Makefile` that create the .pc files in `SAGE_LOCAL`.
- Before pc files are installed into `SAGE_LOCAL`, the targets are removed, to avoid permission problems

This ticket does not solve everything. There may still be problems when switching from a system library to an spkg-provided library. We will use the follow-up ticket #29387 (Complete solution for installing the generated *.pc files) to address this problem.



**CC:**  @embray @mkoeppe @jhpalmieri @vbraun @kiwifb

**Branch/Commit:** [329843baa9cecfb751e8afdb6b666f01930f0bf0](https://github.com/sagemath/sagetrac-mirror/commit/329843baa9cecfb751e8afdb6b666f01930f0bf0)

**Reviewer:** Dima Pasechnik

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/29082





---

archive/issue_events_258375.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T12:43:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258375"
}
```



---

archive/issue_comments_457847.json:
```json
{
    "body": "<a id='comment:2'></a>\nMy suggestion would be to rewrite this as a script package instead of putting things into `src/`. This stuff really does not belong into `src/`.",
    "created_at": "2020-01-28T00:43:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457847",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
My suggestion would be to rewrite this as a script package instead of putting things into `src/`. This stuff really does not belong into `src/`.



---

archive/issue_comments_457848.json:
```json
{
    "body": "<a id='comment:3'></a>\nAdded #29071 as a dependency as it touches the same files.",
    "created_at": "2020-01-28T01:00:14Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457848",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Added #29071 as a dependency as it touches the same files.



---

archive/issue_comments_457849.json:
```json
{
    "body": "**Dependencies:** #29071",
    "created_at": "2020-01-28T01:00:14Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457849",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #29071



---

archive/issue_events_258376.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T01:00:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "rename": {
        "from": "clean generated *.pc files",
        "to": "Move .pc file from src/ to build/, clean generated *.pc files at 'make distclean'"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258376"
}
```



---

archive/issue_comments_457850.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,7 @@\n #29003 introduced 2-stage installation of generated *.pc files, \n via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).\n  \n-At least `make distclean` should clean them, possibly even `make clean`, not sure about this.\n+The generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.\n \n+Because `configure` (`config.status`) creates them, `make distclean` should clean them, but not `make clean`.\n+\n``````\n",
    "created_at": "2020-01-28T01:00:14Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457850",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,7 @@
 #29003 introduced 2-stage installation of generated *.pc files, 
 via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).
  
-At least `make distclean` should clean them, possibly even `make clean`, not sure about this.
+The generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.
 
+Because `configure` (`config.status`) creates them, `make distclean` should clean them, but not `make clean`.
+
``````




---

archive/issue_events_258377.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T01:01:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258377"
}
```



---

archive/issue_events_258378.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T01:01:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258378"
}
```



---

archive/issue_comments_457851.json:
```json
{
    "body": "<a id='comment:5'></a>\n(deleted a comment that was intended for #29071.)",
    "created_at": "2020-01-28T01:06:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457851",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
(deleted a comment that was intended for #29071.)



---

archive/issue_comments_457852.json:
```json
{
    "body": "<a id='comment:6'></a>\n(deleted a comment that was intended for #29071.)",
    "created_at": "2020-01-28T01:19:20Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457852",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
(deleted a comment that was intended for #29071.)



---

archive/issue_comments_457853.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mkoeppe](#comment%3A2):\n> My suggestion would be to rewrite this as a script package instead of putting things into `src/`. This stuff really does not belong into `src/`.\n\nPerhaps we should just create `var/` next to `src/` and put these things there?",
    "created_at": "2020-01-28T09:03:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457853",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
Replying to [mkoeppe](#comment%3A2):
> My suggestion would be to rewrite this as a script package instead of putting things into `src/`. This stuff really does not belong into `src/`.

Perhaps we should just create `var/` next to `src/` and put these things there?



---

archive/issue_comments_457854.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,5 +3,5 @@\n  \n The generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.\n \n-Because `configure` (`config.status`) creates them, `make distclean` should clean them, but not `make clean`.\n+Because `configure` (`config.status`) creates them, `make distclean` should clean them, if not `make clean`.\n \n``````\n",
    "created_at": "2020-01-28T09:03:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457854",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,5 +3,5 @@
  
 The generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.
 
-Because `configure` (`config.status`) creates them, `make distclean` should clean them, but not `make clean`.
+Because `configure` (`config.status`) creates them, `make distclean` should clean them, if not `make clean`.
 
``````




---

archive/issue_comments_457855.json:
```json
{
    "body": "<a id='comment:8'></a>\nNo, I don't think so. These are configure-generated files of sage-the-distribution - like `build/make/Makefile`. There's no need for a new top level.\n\nLet me take care of this ticket after #29071 is done.",
    "created_at": "2020-01-28T12:22:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457855",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
No, I don't think so. These are configure-generated files of sage-the-distribution - like `build/make/Makefile`. There's no need for a new top level.

Let me take care of this ticket after #29071 is done.



---

archive/issue_comments_457856.json:
```json
{
    "body": "**Changing dependencies** from \"#29071\" to \"#29051, #29071, #29084\".",
    "created_at": "2020-01-29T00:31:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457856",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29071" to "#29051, #29071, #29084".



---

archive/issue_comments_457857.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-01-29T02:02:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457857",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_457858.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_)",
    "created_at": "2020-01-29T04:19:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457858",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_)



---

archive/issue_comments_457859.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,9 @@\n #29003 introduced 2-stage installation of generated *.pc files, \n via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).\n  \n-The generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.\n+This ticket revises the 2-stage installation as follows:\n+- Because the generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.\n+- Because `configure` (`config.status`) creates them, `make distclean` cleans them.\n+- Special-purpose code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.\n+- `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.\n \n-Because `configure` (`config.status`) creates them, `make distclean` should clean them, if not `make clean`.\n-\n``````\n",
    "created_at": "2020-01-29T04:26:34Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457859",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,9 @@
 #29003 introduced 2-stage installation of generated *.pc files, 
 via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).
  
-The generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.
+This ticket revises the 2-stage installation as follows:
+- Because the generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.
+- Because `configure` (`config.status`) creates them, `make distclean` cleans them.
+- Special-purpose code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.
+- `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.
 
-Because `configure` (`config.status`) creates them, `make distclean` should clean them, if not `make clean`.
-
``````




---

archive/issue_comments_457860.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/683a926bb67d90832711ba64be1446dbe0463ea0\">683a926</a></td><td><code>make installing *.pc files conditional</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0acbcb1a199e5b9795dd126756288869e86e09a\">a0acbcb</a></td><td><code>correct quoting of m4 index variable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ee6844ebc67fa43f4a1d6a502e90ed8751b0889\">5ee6844</a></td><td><code>ensure gfortran is available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2\">56541ae</a></td><td><code>wrap AC_FC_FUNC so that it does not throw an error without Fortran</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97\">9d1770a</a></td><td><code>revert #29025, remove useless [ALL] section</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d\">dba7aef</a></td><td><code>revert from \"libraries=\" back to section-specific \"BLAH_libs=\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd\">3a4524e</a></td><td><code>Merge remote-tracking branch 'trac/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' into openblaspcfix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0\">06f46eb</a></td><td><code>Add blas to fflas_ffpack linked libraries so that openblas is picked up on Arch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f16988d3545fb08f52ea3bd3362ae70f9c83b9b\">5f16988</a></td><td><code>Merge branch 'u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch' of git://trac.sagemath.org/sage into t/29082/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a01db11ef106d00217d3176a794850524467bcd\">2a01db1</a></td><td><code>Move all BLAS PC file installation logic to new script package sage_sage_system_blas_facade</code></td></tr></table>\n",
    "created_at": "2020-01-29T04:26:34Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457860",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/683a926bb67d90832711ba64be1446dbe0463ea0">683a926</a></td><td><code>make installing *.pc files conditional</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0acbcb1a199e5b9795dd126756288869e86e09a">a0acbcb</a></td><td><code>correct quoting of m4 index variable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ee6844ebc67fa43f4a1d6a502e90ed8751b0889">5ee6844</a></td><td><code>ensure gfortran is available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2">56541ae</a></td><td><code>wrap AC_FC_FUNC so that it does not throw an error without Fortran</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97">9d1770a</a></td><td><code>revert #29025, remove useless [ALL] section</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d">dba7aef</a></td><td><code>revert from "libraries=" back to section-specific "BLAH_libs="</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd">3a4524e</a></td><td><code>Merge remote-tracking branch 'trac/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' into openblaspcfix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06f46ebaa41a620016d8e04c8c27045acbcd3ae0">06f46eb</a></td><td><code>Add blas to fflas_ffpack linked libraries so that openblas is picked up on Arch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f16988d3545fb08f52ea3bd3362ae70f9c83b9b">5f16988</a></td><td><code>Merge branch 'u/arojas/make_fflas_ffpack_detect_and_use_system_openblas_on_arch' of git://trac.sagemath.org/sage into t/29082/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a01db11ef106d00217d3176a794850524467bcd">2a01db1</a></td><td><code>Move all BLAS PC file installation logic to new script package sage_sage_system_blas_facade</code></td></tr></table>




---

archive/issue_comments_457861.json:
```json
{
    "body": "**Commit:** [2a01db11ef106d00217d3176a794850524467bcd](https://github.com/sagemath/sagetrac-mirror/commit/2a01db11ef106d00217d3176a794850524467bcd)",
    "created_at": "2020-01-29T04:26:34Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457861",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [2a01db11ef106d00217d3176a794850524467bcd](https://github.com/sagemath/sagetrac-mirror/commit/2a01db11ef106d00217d3176a794850524467bcd)



---

archive/issue_comments_457862.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch is on top of #29051, #29071, #29084.\nThis is a first version, haven't tested much yet.",
    "created_at": "2020-01-29T04:27:05Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457862",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Branch is on top of #29051, #29071, #29084.
This is a first version, haven't tested much yet.



---

archive/issue_comments_457863.json:
```json
{
    "body": "<a id='comment:14'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/32449719",
    "created_at": "2020-01-29T04:31:04Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457863",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/32449719



---

archive/issue_comments_457864.json:
```json
{
    "body": "**Changing dependencies** from \"#29051, #29071, #29084\" to \"#29051, #29071, #29084, #26130, #29056\".",
    "created_at": "2020-01-30T01:37:22Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457864",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29051, #29071, #29084" to "#29051, #29071, #29084, #26130, #29056".



---

archive/issue_events_258379.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-31T15:59:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258379"
}
```



---

archive/issue_comments_457865.json:
```json
{
    "body": "<a id='comment:16'></a>\nI will redo this on top of the hot fix - #29121.",
    "created_at": "2020-01-31T15:59:35Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457865",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
I will redo this on top of the hot fix - #29121.



---

archive/issue_comments_457866.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).\n  \n This ticket revises the 2-stage installation as follows:\n-- Because the generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.\n+- Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.\n - Because `configure` (`config.status`) creates them, `make distclean` cleans them.\n - Special-purpose code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.\n - `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.\n``````\n",
    "created_at": "2020-02-16T20:32:12Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457866",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).
  
 This ticket revises the 2-stage installation as follows:
-- Because the generated files are for sage-the-distribution, not sagelib, so they belong into `build`, not `src`.
+- Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.
 - Because `configure` (`config.status`) creates them, `make distclean` cleans them.
 - Special-purpose code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.
 - `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.
``````




---

archive/issue_comments_457867.json:
```json
{
    "body": "**Changing commit** from \"[2a01db11ef106d00217d3176a794850524467bcd](https://github.com/sagemath/sagetrac-mirror/commit/2a01db11ef106d00217d3176a794850524467bcd)\" to \"[2535c186176468a691627bdc0cff84d8387782a8](https://github.com/sagemath/sagetrac-mirror/commit/2535c186176468a691627bdc0cff84d8387782a8)\".",
    "created_at": "2020-02-16T20:37:42Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2a01db11ef106d00217d3176a794850524467bcd](https://github.com/sagemath/sagetrac-mirror/commit/2a01db11ef106d00217d3176a794850524467bcd)" to "[2535c186176468a691627bdc0cff84d8387782a8](https://github.com/sagemath/sagetrac-mirror/commit/2535c186176468a691627bdc0cff84d8387782a8)".



---

archive/issue_comments_457868.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2535c186176468a691627bdc0cff84d8387782a8\">2535c18</a></td><td><code>Move all BLAS PC file installation logic to new script package sage_sage_system_blas_facade</code></td></tr></table>\n",
    "created_at": "2020-02-16T20:37:42Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2535c186176468a691627bdc0cff84d8387782a8">2535c18</a></td><td><code>Move all BLAS PC file installation logic to new script package sage_sage_system_blas_facade</code></td></tr></table>




---

archive/issue_comments_457869.json:
```json
{
    "body": "**Changing dependencies** from \"#29051, #29071, #29084, #26130, #29056\" to \"\".",
    "created_at": "2020-02-16T20:38:47Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457869",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29051, #29071, #29084, #26130, #29056" to "".



---

archive/issue_events_258380.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-16T20:38:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258380"
}
```



---

archive/issue_events_258381.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-16T20:38:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258381"
}
```



---

archive/issue_comments_457870.json:
```json
{
    "body": "<a id='comment:19'></a>\nRebased on 9.1.beta4",
    "created_at": "2020-02-16T20:38:47Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457870",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Rebased on 9.1.beta4



---

archive/issue_comments_457871.json:
```json
{
    "body": "**Changing commit** from \"[2535c186176468a691627bdc0cff84d8387782a8](https://github.com/sagemath/sagetrac-mirror/commit/2535c186176468a691627bdc0cff84d8387782a8)\" to \"[3f2060ebf71d3cd593efe44a751b1a8017af969b](https://github.com/sagemath/sagetrac-mirror/commit/3f2060ebf71d3cd593efe44a751b1a8017af969b)\".",
    "created_at": "2020-02-22T23:52:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2535c186176468a691627bdc0cff84d8387782a8](https://github.com/sagemath/sagetrac-mirror/commit/2535c186176468a691627bdc0cff84d8387782a8)" to "[3f2060ebf71d3cd593efe44a751b1a8017af969b](https://github.com/sagemath/sagetrac-mirror/commit/3f2060ebf71d3cd593efe44a751b1a8017af969b)".



---

archive/issue_comments_457872.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f2060ebf71d3cd593efe44a751b1a8017af969b\">3f2060e</a></td><td><code>Merge tag '9.1.beta5' into t/29082/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_</code></td></tr></table>\n",
    "created_at": "2020-02-22T23:52:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f2060ebf71d3cd593efe44a751b1a8017af969b">3f2060e</a></td><td><code>Merge tag '9.1.beta5' into t/29082/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_</code></td></tr></table>




---

archive/issue_comments_457873.json:
```json
{
    "body": "<a id='comment:22'></a>\nNeeds review.",
    "created_at": "2020-02-22T23:53:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457873",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Needs review.



---

archive/issue_comments_457874.json:
```json
{
    "body": "**Changing commit** from \"[3f2060ebf71d3cd593efe44a751b1a8017af969b](https://github.com/sagemath/sagetrac-mirror/commit/3f2060ebf71d3cd593efe44a751b1a8017af969b)\" to \"[d6b5677f0a51dd790377482f4608fd041fb0fbbe](https://github.com/sagemath/sagetrac-mirror/commit/d6b5677f0a51dd790377482f4608fd041fb0fbbe)\".",
    "created_at": "2020-03-02T01:51:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457874",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3f2060ebf71d3cd593efe44a751b1a8017af969b](https://github.com/sagemath/sagetrac-mirror/commit/3f2060ebf71d3cd593efe44a751b1a8017af969b)" to "[d6b5677f0a51dd790377482f4608fd041fb0fbbe](https://github.com/sagemath/sagetrac-mirror/commit/d6b5677f0a51dd790377482f4608fd041fb0fbbe)".



---

archive/issue_comments_457875.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6b5677f0a51dd790377482f4608fd041fb0fbbe\">d6b5677</a></td><td><code>Merge tag '9.1.beta6' into t/29082/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_</code></td></tr></table>\n",
    "created_at": "2020-03-02T01:51:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457875",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6b5677f0a51dd790377482f4608fd041fb0fbbe">d6b5677</a></td><td><code>Merge tag '9.1.beta6' into t/29082/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_</code></td></tr></table>




---

archive/issue_comments_457876.json:
```json
{
    "body": "<a id='comment:24'></a>\nAgreed on the first two points in the description.\n\nDon't agree on sage_system_blas_facade and the changes to Makefile.in.  I don't see how it's \"special-purpose code\".  It's a quite generic solution that you seem to be *replacing* with \"special-purpose code\" that's very specific to openblas.  This ticket was needed for more than just blas.",
    "created_at": "2020-03-06T14:40:19Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457876",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
Agreed on the first two points in the description.

Don't agree on sage_system_blas_facade and the changes to Makefile.in.  I don't see how it's "special-purpose code".  It's a quite generic solution that you seem to be *replacing* with "special-purpose code" that's very specific to openblas.  This ticket was needed for more than just blas.



---

archive/issue_events_258382.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-03-06T14:42:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258382"
}
```



---

archive/issue_events_258383.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-03-06T14:42:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258383"
}
```



---

archive/issue_comments_457877.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,6 +4,6 @@\n This ticket revises the 2-stage installation as follows:\n - Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.\n - Because `configure` (`config.status`) creates them, `make distclean` cleans them.\n-- Special-purpose code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.\n+- Code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.\n - `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.\n \n``````\n",
    "created_at": "2020-03-06T16:04:18Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457877",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,6 +4,6 @@
 This ticket revises the 2-stage installation as follows:
 - Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.
 - Because `configure` (`config.status`) creates them, `make distclean` cleans them.
-- Special-purpose code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.
+- Code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.
 - `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.
 
``````




---

archive/issue_comments_457878.json:
```json
{
    "body": "<a id='comment:27'></a>\nIs my ticket handling the `gsl.pc` correctly? Which packages use this file?",
    "created_at": "2020-03-07T03:32:09Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457878",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Is my ticket handling the `gsl.pc` correctly? Which packages use this file?



---

archive/issue_events_258384.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-14T01:10:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "rename": {
        "from": "Move .pc file from src/ to build/, clean generated *.pc files at 'make distclean'",
        "to": "Move .pc file from src/ to build/, clean generated *.pc files at 'make distclean', fix 'permission denied' errors"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258384"
}
```



---

archive/issue_comments_457879.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,22 @@\n #29003 introduced 2-stage installation of generated *.pc files, \n via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).\n  \n+Also, in some installations, repeated installations this code leads to 'permission denied' errors when trying to override read-only files:\n+\n+```\n+  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/blas.pc\n+  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/cblas.pc\n+  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/lapack.pc\n+  [openblas-0.3.6.p0]   \n+  [openblas-0.3.6.p0]   real\t8m40.259s\n+  [openblas-0.3.6.p0]   user\t45m2.739s\n+  [openblas-0.3.6.p0]   sys\t5m48.754s\n+  [openblas-0.3.6.p0]   Copying package files from temporary location /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst to /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local\n+  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/cblas.pc: Permission denied\n+  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/blas.pc: Permission denied\n+  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/lapack.pc: Permission denied\n+```\n+\n This ticket revises the 2-stage installation as follows:\n - Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.\n - Because `configure` (`config.status`) creates them, `make distclean` cleans them.\n``````\n",
    "created_at": "2020-03-14T01:10:27Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457879",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,22 @@
 #29003 introduced 2-stage installation of generated *.pc files, 
 via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).
  
+Also, in some installations, repeated installations this code leads to 'permission denied' errors when trying to override read-only files:
+
+```
+  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/blas.pc
+  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/cblas.pc
+  [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/lapack.pc
+  [openblas-0.3.6.p0]   
+  [openblas-0.3.6.p0]   real	8m40.259s
+  [openblas-0.3.6.p0]   user	45m2.739s
+  [openblas-0.3.6.p0]   sys	5m48.754s
+  [openblas-0.3.6.p0]   Copying package files from temporary location /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst to /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local
+  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/cblas.pc: Permission denied
+  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/blas.pc: Permission denied
+  [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/lapack.pc: Permission denied
+```
+
 This ticket revises the 2-stage installation as follows:
 - Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.
 - Because `configure` (`config.status`) creates them, `make distclean` cleans them.
``````




---

archive/issue_comments_457880.json:
```json
{
    "body": "<a id='comment:29'></a>\nI also don't quite understand the need to create a special script package, instead of adjusting `build/make/Makefile.in`.\n\nIs there a technical problem?",
    "created_at": "2020-03-19T03:31:40Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457880",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>
I also don't quite understand the need to create a special script package, instead of adjusting `build/make/Makefile.in`.

Is there a technical problem?



---

archive/issue_comments_457881.json:
```json
{
    "body": "<a id='comment:30'></a>\nIt seemed to be an elegant solution when I wrote this a month ago",
    "created_at": "2020-03-19T03:49:07Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457881",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
It seemed to be an elegant solution when I wrote this a month ago



---

archive/issue_comments_457882.json:
```json
{
    "body": "<a id='comment:31'></a>\nIt seems that your package handles more that blas/lapack pc files, no?\nPerhaps it just is wrongly named?",
    "created_at": "2020-03-19T03:58:36Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457882",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
It seems that your package handles more that blas/lapack pc files, no?
Perhaps it just is wrongly named?



---

archive/issue_comments_457883.json:
```json
{
    "body": "<a id='comment:32'></a>\nThat's basically my question regarding gsl.pc above, I guess.",
    "created_at": "2020-03-19T03:59:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457883",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
That's basically my question regarding gsl.pc above, I guess.



---

archive/issue_comments_457884.json:
```json
{
    "body": "<a id='comment:33'></a>\nthere is also a bug: PKG_CONFIG_PATH is pointing to the wrong directory, so these\nnewly installed pc files are not found:\n\n```\n(sage-sh) dima@fedora:sagetrac-mirror$ echo $PKG_CONFIG_PATH\n/home/dima/sagetrac-mirror/local/lib/pkgconfig:.\n(sage-sh) dima@fedora:sagetrac-mirror$ find . -name cblas.pc\n./build/pkgs/sage_system_blas_facade/src/cblas.pc\n./src/lib/pkgconfig/cblas.pc\n```",
    "created_at": "2020-03-19T04:11:28Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457884",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>
there is also a bug: PKG_CONFIG_PATH is pointing to the wrong directory, so these
newly installed pc files are not found:

```
(sage-sh) dima@fedora:sagetrac-mirror$ echo $PKG_CONFIG_PATH
/home/dima/sagetrac-mirror/local/lib/pkgconfig:.
(sage-sh) dima@fedora:sagetrac-mirror$ find . -name cblas.pc
./build/pkgs/sage_system_blas_facade/src/cblas.pc
./src/lib/pkgconfig/cblas.pc
```



---

archive/issue_comments_457885.json:
```json
{
    "body": "<a id='comment:34'></a>\noops, I mean, they are just not installed at all.\nPKG_CONFIG_PATH is correct, but pc files are not there, or anywhere, except the old location",
    "created_at": "2020-03-19T04:14:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457885",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
oops, I mean, they are just not installed at all.
PKG_CONFIG_PATH is correct, but pc files are not there, or anywhere, except the old location



---

archive/issue_comments_457886.json:
```json
{
    "body": "<a id='comment:35'></a>\nFeel free to make changes -- otherwise I can look into it tomorrow",
    "created_at": "2020-03-19T04:29:46Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457886",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Feel free to make changes -- otherwise I can look into it tomorrow



---

archive/issue_comments_457887.json:
```json
{
    "body": "<a id='comment:36'></a>\nWhat does `build/pkgs/sage_system_blas_facade/spkg-install` look like on your machine?",
    "created_at": "2020-03-19T04:34:10Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457887",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
What does `build/pkgs/sage_system_blas_facade/spkg-install` look like on your machine?



---

archive/issue_comments_457888.json:
```json
{
    "body": "<a id='comment:37'></a>\nhere it is:\n\n```\n#! /usr/bin/env bash\nPCFILES=\"blas.pccblas.pclapack.pc\"\nSAGE_PKGCONFIG=\"$SAGE_LOCAL/lib/pkgconfig\"\nmkdir -p \"$SAGE_PKGCONFIG\"\nif [ -n \"$PCFILES\" ]; then\n   cd build/pkgs/sage_system_blas_facade/src && cp -P $PCFILES \"$SAGE_PKGCONFIG\"\nfi\n```\nalso note that the original openblas.pc is in SAGE_ROOT",
    "created_at": "2020-03-19T04:40:03Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457888",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>
here it is:

```
#! /usr/bin/env bash
PCFILES="blas.pccblas.pclapack.pc"
SAGE_PKGCONFIG="$SAGE_LOCAL/lib/pkgconfig"
mkdir -p "$SAGE_PKGCONFIG"
if [ -n "$PCFILES" ]; then
   cd build/pkgs/sage_system_blas_facade/src && cp -P $PCFILES "$SAGE_PKGCONFIG"
fi
```
also note that the original openblas.pc is in SAGE_ROOT



---

archive/issue_comments_457889.json:
```json
{
    "body": "<a id='comment:38'></a>\nLooks like some spaces are missing",
    "created_at": "2020-03-19T04:58:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457889",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
Looks like some spaces are missing



---

archive/issue_comments_457890.json:
```json
{
    "body": "<a id='comment:39'></a>\nindeed, one needs\n\n```diff\n--- a/build/pkgs/openblas/spkg-configure.m4\n+++ b/build/pkgs/openblas/spkg-configure.m4\n@@ -37,7 +37,7 @@ SAGE_SPKG_CONFIGURE([openblas], [dnl CHECK\n        m4_foreach([blaslibnam], [blas, cblas, lapack], [\n         AS_IF([test x$sage_install_]blaslibnam[_pc = xyes], [\n          AC_CONFIG_LINKS([build/pkgs/sage_system_blas_facade/src/]blaslibnam[.pc:$OPENBLASPCDIR/openblas.pc])\n-         AS_VAR_APPEND([SAGE_SYSTEM_BLAS_FACADE_PC_FILES], blaslibnam[.pc])])\n+         AS_VAR_APPEND([SAGE_SYSTEM_BLAS_FACADE_PC_FILES], [blaslibnam[.pc]' '])])\n          AC_SUBST([SAGE_BLAS], [sage_system_blas_facade])\n        ])\n     ])\n```",
    "created_at": "2020-03-19T06:47:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457890",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>
indeed, one needs

```diff
--- a/build/pkgs/openblas/spkg-configure.m4
+++ b/build/pkgs/openblas/spkg-configure.m4
@@ -37,7 +37,7 @@ SAGE_SPKG_CONFIGURE([openblas], [dnl CHECK
        m4_foreach([blaslibnam], [blas, cblas, lapack], [
         AS_IF([test x$sage_install_]blaslibnam[_pc = xyes], [
          AC_CONFIG_LINKS([build/pkgs/sage_system_blas_facade/src/]blaslibnam[.pc:$OPENBLASPCDIR/openblas.pc])
-         AS_VAR_APPEND([SAGE_SYSTEM_BLAS_FACADE_PC_FILES], blaslibnam[.pc])])
+         AS_VAR_APPEND([SAGE_SYSTEM_BLAS_FACADE_PC_FILES], [blaslibnam[.pc]' '])])
          AC_SUBST([SAGE_BLAS], [sage_system_blas_facade])
        ])
     ])
```



---

archive/issue_comments_457891.json:
```json
{
    "body": "<a id='comment:40'></a>\nbut this does not make any difference. As far as I can see, `spkg-install` of `sage_system_blas_facade` never gets run - I'm lost in untangling the reason for this.",
    "created_at": "2020-03-19T13:39:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457891",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>
but this does not make any difference. As far as I can see, `spkg-install` of `sage_system_blas_facade` never gets run - I'm lost in untangling the reason for this.



---

archive/issue_comments_457892.json:
```json
{
    "body": "<a id='comment:41'></a>\nOK, I'll take care of it later today.",
    "created_at": "2020-03-19T13:44:01Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457892",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
OK, I'll take care of it later today.



---

archive/issue_events_258385.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-19T15:11:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258385"
}
```



---

archive/issue_events_258386.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-19T15:11:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258386"
}
```



---

archive/issue_comments_457893.json:
```json
{
    "body": "**Dependencies:** #29287",
    "created_at": "2020-03-20T22:07:46Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457893",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #29287



---

archive/issue_comments_457894.json:
```json
{
    "body": "<a id='comment:44'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1fd7a73c077f122847b27ef779bde44f9efc430\">d1fd7a7</a></td><td><code>src/bin/sage-list-packages: Remove use of type=pip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75175db466a0ef461b656fdb1b7b40e7479981f7\">75175db</a></td><td><code>sage.misc.package.list_packages: For unversioned packages, use 'none' as version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3d78f47429f6d033abdfa47e32453d980f995e5\">d3d78f4</a></td><td><code>m4/sage_spkg_collect.m4: Fix up collection of dependencies</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbb9860cb41006fbe4108447f4f01e26ed8f0bdd\">dbb9860</a></td><td><code>build/pkgs/texlive/spkg-install: Fix up path</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b1d5ca6074561315be14ea4f072149b88fe2fd0\">8b1d5ca</a></td><td><code>trac 29287: rewording documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/057a66bdd05ad75539f2bdbd27561af3f0d57d65\">057a66b</a></td><td><code>Make pyopenssl a pip package</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f6323ed8af19d0c1301c65e41d3b219a8fa7a43\">8f6323e</a></td><td><code>src/sage/env.py: Fix up doctest on starting sage without SAGE_* variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/091908665ae681b6f9cc1f491d4801acbdfb89ae\">0919086</a></td><td><code>trac 29287: doc fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67817908a4b8956b7a78d15295d1af3c0865bb82\">6781790</a></td><td><code>Move all BLAS PC file installation logic to new script package sage_sage_system_blas_facade</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30d3b8245cbcee8c7b629dfebc9de213e89f7c86\">30d3b82</a></td><td><code>build/pkgs/openblas/spkg-configure.m4: Separate library names by spaces</code></td></tr></table>\n",
    "created_at": "2020-03-20T22:44:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1fd7a73c077f122847b27ef779bde44f9efc430">d1fd7a7</a></td><td><code>src/bin/sage-list-packages: Remove use of type=pip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75175db466a0ef461b656fdb1b7b40e7479981f7">75175db</a></td><td><code>sage.misc.package.list_packages: For unversioned packages, use 'none' as version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3d78f47429f6d033abdfa47e32453d980f995e5">d3d78f4</a></td><td><code>m4/sage_spkg_collect.m4: Fix up collection of dependencies</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbb9860cb41006fbe4108447f4f01e26ed8f0bdd">dbb9860</a></td><td><code>build/pkgs/texlive/spkg-install: Fix up path</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b1d5ca6074561315be14ea4f072149b88fe2fd0">8b1d5ca</a></td><td><code>trac 29287: rewording documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/057a66bdd05ad75539f2bdbd27561af3f0d57d65">057a66b</a></td><td><code>Make pyopenssl a pip package</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f6323ed8af19d0c1301c65e41d3b219a8fa7a43">8f6323e</a></td><td><code>src/sage/env.py: Fix up doctest on starting sage without SAGE_* variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/091908665ae681b6f9cc1f491d4801acbdfb89ae">0919086</a></td><td><code>trac 29287: doc fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67817908a4b8956b7a78d15295d1af3c0865bb82">6781790</a></td><td><code>Move all BLAS PC file installation logic to new script package sage_sage_system_blas_facade</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30d3b8245cbcee8c7b629dfebc9de213e89f7c86">30d3b82</a></td><td><code>build/pkgs/openblas/spkg-configure.m4: Separate library names by spaces</code></td></tr></table>




---

archive/issue_comments_457895.json:
```json
{
    "body": "**Changing commit** from \"[d6b5677f0a51dd790377482f4608fd041fb0fbbe](https://github.com/sagemath/sagetrac-mirror/commit/d6b5677f0a51dd790377482f4608fd041fb0fbbe)\" to \"[30d3b8245cbcee8c7b629dfebc9de213e89f7c86](https://github.com/sagemath/sagetrac-mirror/commit/30d3b8245cbcee8c7b629dfebc9de213e89f7c86)\".",
    "created_at": "2020-03-20T22:44:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457895",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d6b5677f0a51dd790377482f4608fd041fb0fbbe](https://github.com/sagemath/sagetrac-mirror/commit/d6b5677f0a51dd790377482f4608fd041fb0fbbe)" to "[30d3b8245cbcee8c7b629dfebc9de213e89f7c86](https://github.com/sagemath/sagetrac-mirror/commit/30d3b8245cbcee8c7b629dfebc9de213e89f7c86)".



---

archive/issue_comments_457896.json:
```json
{
    "body": "<a id='comment:45'></a>\nBranch is on top of #29287",
    "created_at": "2020-03-20T22:44:34Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457896",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
Branch is on top of #29287



---

archive/issue_comments_457897.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b68595e74582eacd050b93312610f0ece11d2a93\">b68595e</a></td><td><code>Change type</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7fd5e31fa51e0f9a662848450dbae37732468d6f\">7fd5e31</a></td><td><code>fixup</code></td></tr></table>\n",
    "created_at": "2020-03-21T02:05:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b68595e74582eacd050b93312610f0ece11d2a93">b68595e</a></td><td><code>Change type</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7fd5e31fa51e0f9a662848450dbae37732468d6f">7fd5e31</a></td><td><code>fixup</code></td></tr></table>




---

archive/issue_comments_457898.json:
```json
{
    "body": "**Changing commit** from \"[30d3b8245cbcee8c7b629dfebc9de213e89f7c86](https://github.com/sagemath/sagetrac-mirror/commit/30d3b8245cbcee8c7b629dfebc9de213e89f7c86)\" to \"[7fd5e31fa51e0f9a662848450dbae37732468d6f](https://github.com/sagemath/sagetrac-mirror/commit/7fd5e31fa51e0f9a662848450dbae37732468d6f)\".",
    "created_at": "2020-03-21T02:05:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457898",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[30d3b8245cbcee8c7b629dfebc9de213e89f7c86](https://github.com/sagemath/sagetrac-mirror/commit/30d3b8245cbcee8c7b629dfebc9de213e89f7c86)" to "[7fd5e31fa51e0f9a662848450dbae37732468d6f](https://github.com/sagemath/sagetrac-mirror/commit/7fd5e31fa51e0f9a662848450dbae37732468d6f)".



---

archive/issue_comments_457899.json:
```json
{
    "body": "**Changing commit** from \"[7fd5e31fa51e0f9a662848450dbae37732468d6f](https://github.com/sagemath/sagetrac-mirror/commit/7fd5e31fa51e0f9a662848450dbae37732468d6f)\" to \"[b493a32df5c9bb08613e370759412e55a2501676](https://github.com/sagemath/sagetrac-mirror/commit/b493a32df5c9bb08613e370759412e55a2501676)\".",
    "created_at": "2020-03-21T02:08:49Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7fd5e31fa51e0f9a662848450dbae37732468d6f](https://github.com/sagemath/sagetrac-mirror/commit/7fd5e31fa51e0f9a662848450dbae37732468d6f)" to "[b493a32df5c9bb08613e370759412e55a2501676](https://github.com/sagemath/sagetrac-mirror/commit/b493a32df5c9bb08613e370759412e55a2501676)".



---

archive/issue_comments_457900.json:
```json
{
    "body": "<a id='comment:47'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b493a32df5c9bb08613e370759412e55a2501676\">b493a32</a></td><td><code>install sage_system_blas_facade</code></td></tr></table>\n",
    "created_at": "2020-03-21T02:08:49Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b493a32df5c9bb08613e370759412e55a2501676">b493a32</a></td><td><code>install sage_system_blas_facade</code></td></tr></table>




---

archive/issue_events_258387.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-21T08:13:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258387"
}
```



---

archive/issue_comments_457901.json:
```json
{
    "body": "<a id='comment:48'></a>\nthis prevents building on Fedora after distclean",
    "created_at": "2020-03-21T08:13:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457901",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>
this prevents building on Fedora after distclean



---

archive/issue_comments_457902.json:
```json
{
    "body": "<a id='comment:49'></a>\nI'm working on a simpler version of this ticket.",
    "created_at": "2020-03-21T12:36:31Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457902",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
I'm working on a simpler version of this ticket.



---

archive/issue_comments_457903.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n #29003 introduced 2-stage installation of generated *.pc files, \n via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).\n  \n-Also, in some installations, repeated installations this code leads to 'permission denied' errors when trying to override read-only files:\n+Also, in some installations, repeated installations this code leads to 'permission denied' errors when trying to overwrite read-only files:\n \n ```\n   [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/blas.pc\n@@ -20,6 +20,7 @@\n This ticket revises the 2-stage installation as follows:\n - Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.\n - Because `configure` (`config.status`) creates them, `make distclean` cleans them.\n+- The pc files installed into `SAGE_LOCAL` are uninstalled when necessary - or it is ensured that they are properly overwritten.\n - Code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.\n - `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.\n \n``````\n",
    "created_at": "2020-03-21T12:57:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457903",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 #29003 introduced 2-stage installation of generated *.pc files, 
 via `src/lib/pkgconfig`- but did not provide a way to clean them up at all. And this is a problem (cf. e.g. #29071).
  
-Also, in some installations, repeated installations this code leads to 'permission denied' errors when trying to override read-only files:
+Also, in some installations, repeated installations this code leads to 'permission denied' errors when trying to overwrite read-only files:
 
 ```
   [openblas-0.3.6.p0]   Wrote /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/var/tmp/sage/build/openblas-0.3.6.p0/inst/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/lib/pkgconfig/blas.pc
@@ -20,6 +20,7 @@
 This ticket revises the 2-stage installation as follows:
 - Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.
 - Because `configure` (`config.status`) creates them, `make distclean` cleans them.
+- The pc files installed into `SAGE_LOCAL` are uninstalled when necessary - or it is ensured that they are properly overwritten.
 - Code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.
 - `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.
 
``````




---

archive/issue_comments_457904.json:
```json
{
    "body": "**Changing dependencies** from \"#29287\" to \"\".",
    "created_at": "2020-03-21T15:52:18Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457904",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29287" to "".



---

archive/issue_comments_457905.json:
```json
{
    "body": "**Changing commit** from \"[b493a32df5c9bb08613e370759412e55a2501676](https://github.com/sagemath/sagetrac-mirror/commit/b493a32df5c9bb08613e370759412e55a2501676)\" to \"[705da6a06eaa69613f0c25149f7e9e2d21833371](https://github.com/sagemath/sagetrac-mirror/commit/705da6a06eaa69613f0c25149f7e9e2d21833371)\".",
    "created_at": "2020-03-21T18:30:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b493a32df5c9bb08613e370759412e55a2501676](https://github.com/sagemath/sagetrac-mirror/commit/b493a32df5c9bb08613e370759412e55a2501676)" to "[705da6a06eaa69613f0c25149f7e9e2d21833371](https://github.com/sagemath/sagetrac-mirror/commit/705da6a06eaa69613f0c25149f7e9e2d21833371)".



---

archive/issue_comments_457906.json:
```json
{
    "body": "<a id='comment:52'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/705da6a06eaa69613f0c25149f7e9e2d21833371\">705da6a</a></td><td><code>Link/generate pc files in make, not configure</code></td></tr></table>\n",
    "created_at": "2020-03-21T18:30:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457906",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/705da6a06eaa69613f0c25149f7e9e2d21833371">705da6a</a></td><td><code>Link/generate pc files in make, not configure</code></td></tr></table>




---

archive/issue_events_258388.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-21T18:31:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258388"
}
```



---

archive/issue_events_258389.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-21T18:31:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258389"
}
```



---

archive/issue_comments_457907.json:
```json
{
    "body": "**Changing commit** from \"[705da6a06eaa69613f0c25149f7e9e2d21833371](https://github.com/sagemath/sagetrac-mirror/commit/705da6a06eaa69613f0c25149f7e9e2d21833371)\" to \"[d86cd33c67e253dd17992a8a470a6391663892e2](https://github.com/sagemath/sagetrac-mirror/commit/d86cd33c67e253dd17992a8a470a6391663892e2)\".",
    "created_at": "2020-03-21T18:34:03Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457907",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[705da6a06eaa69613f0c25149f7e9e2d21833371](https://github.com/sagemath/sagetrac-mirror/commit/705da6a06eaa69613f0c25149f7e9e2d21833371)" to "[d86cd33c67e253dd17992a8a470a6391663892e2](https://github.com/sagemath/sagetrac-mirror/commit/d86cd33c67e253dd17992a8a470a6391663892e2)".



---

archive/issue_comments_457908.json:
```json
{
    "body": "<a id='comment:54'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d86cd33c67e253dd17992a8a470a6391663892e2\">d86cd33</a></td><td><code>fixup</code></td></tr></table>\n",
    "created_at": "2020-03-21T18:34:03Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457908",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d86cd33c67e253dd17992a8a470a6391663892e2">d86cd33</a></td><td><code>fixup</code></td></tr></table>




---

archive/issue_comments_457909.json:
```json
{
    "body": "<a id='comment:55'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5b4f625d6e3001f07123974b4d1f5356545ae03\">f5b4f62</a></td><td><code>Makefile [misc-clean]: No need to remove build/lib/pkgconfig</code></td></tr></table>\n",
    "created_at": "2020-03-21T19:33:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5b4f625d6e3001f07123974b4d1f5356545ae03">f5b4f62</a></td><td><code>Makefile [misc-clean]: No need to remove build/lib/pkgconfig</code></td></tr></table>




---

archive/issue_comments_457910.json:
```json
{
    "body": "**Changing commit** from \"[d86cd33c67e253dd17992a8a470a6391663892e2](https://github.com/sagemath/sagetrac-mirror/commit/d86cd33c67e253dd17992a8a470a6391663892e2)\" to \"[f5b4f625d6e3001f07123974b4d1f5356545ae03](https://github.com/sagemath/sagetrac-mirror/commit/f5b4f625d6e3001f07123974b4d1f5356545ae03)\".",
    "created_at": "2020-03-21T19:33:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d86cd33c67e253dd17992a8a470a6391663892e2](https://github.com/sagemath/sagetrac-mirror/commit/d86cd33c67e253dd17992a8a470a6391663892e2)" to "[f5b4f625d6e3001f07123974b4d1f5356545ae03](https://github.com/sagemath/sagetrac-mirror/commit/f5b4f625d6e3001f07123974b4d1f5356545ae03)".



---

archive/issue_events_258390.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T02:13:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258390"
}
```



---

archive/issue_events_258391.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T02:13:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258391"
}
```



---

archive/issue_comments_457911.json:
```json
{
    "body": "<a id='comment:56'></a>\nError with gsl.pc for `local-homebrew-macos-standard` - https://github.com/mkoeppe/sage/runs/524361197",
    "created_at": "2020-03-22T02:13:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457911",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>
Error with gsl.pc for `local-homebrew-macos-standard` - https://github.com/mkoeppe/sage/runs/524361197



---

archive/issue_comments_457912.json:
```json
{
    "body": "<a id='comment:57'></a>\nalso `ubuntu-bionic-standard` (sagelib and cvxopt)",
    "created_at": "2020-03-22T02:15:04Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457912",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>
also `ubuntu-bionic-standard` (sagelib and cvxopt)



---

archive/issue_comments_457913.json:
```json
{
    "body": "<a id='comment:58'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a38a167ab0c6aa3f39d704eb4087d9adf36c85a\">2a38a16</a></td><td><code>build/pkgs/gsl/spkg-configure.m4: Quoting fix</code></td></tr></table>\n",
    "created_at": "2020-03-22T02:59:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a38a167ab0c6aa3f39d704eb4087d9adf36c85a">2a38a16</a></td><td><code>build/pkgs/gsl/spkg-configure.m4: Quoting fix</code></td></tr></table>




---

archive/issue_comments_457914.json:
```json
{
    "body": "**Changing commit** from \"[f5b4f625d6e3001f07123974b4d1f5356545ae03](https://github.com/sagemath/sagetrac-mirror/commit/f5b4f625d6e3001f07123974b4d1f5356545ae03)\" to \"[2a38a167ab0c6aa3f39d704eb4087d9adf36c85a](https://github.com/sagemath/sagetrac-mirror/commit/2a38a167ab0c6aa3f39d704eb4087d9adf36c85a)\".",
    "created_at": "2020-03-22T02:59:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457914",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f5b4f625d6e3001f07123974b4d1f5356545ae03](https://github.com/sagemath/sagetrac-mirror/commit/f5b4f625d6e3001f07123974b4d1f5356545ae03)" to "[2a38a167ab0c6aa3f39d704eb4087d9adf36c85a](https://github.com/sagemath/sagetrac-mirror/commit/2a38a167ab0c6aa3f39d704eb4087d9adf36c85a)".



---

archive/issue_events_258392.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T02:59:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258392"
}
```



---

archive/issue_events_258393.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T02:59:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258393"
}
```



---

archive/issue_comments_457915.json:
```json
{
    "body": "<a id='comment:60'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/60588138",
    "created_at": "2020-03-22T02:59:45Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457915",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/60588138



---

archive/issue_comments_457916.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,10 +17,12 @@\n   [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/lapack.pc: Permission denied\n ```\n \n-This ticket revises the 2-stage installation as follows:\n-- Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.\n-- Because `configure` (`config.status`) creates them, `make distclean` cleans them.\n-- The pc files installed into `SAGE_LOCAL` are uninstalled when necessary - or it is ensured that they are properly overwritten.\n-- Code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.\n-- `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.\n+This ticket revises the installation as follows:\n \n+- `configure` no longer creates .pc files in the build tree\n+- Instead it creates rules in `make/Makefile` that create the .pc files in `SAGE_LOCAL`.\n+- Before pc files are installed into `SAGE_LOCAL`, the targets are removed, to avoid permission problems\n+\n+This ticket does not solve everything. There may still be problems when switching from a system library to an spkg-provided library. We will use the follow-up ticket #29387 (Complete solution for installing the generated *.pc files) to address this problem.\n+\n+\n``````\n",
    "created_at": "2020-03-22T03:41:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457916",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,10 +17,12 @@
   [openblas-0.3.6.p0]   cp: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-minimal/local/./lib/pkgconfig/lapack.pc: Permission denied
 ```
 
-This ticket revises the 2-stage installation as follows:
-- Because the generated files are for sage-the-distribution, not sagelib, they belong into `build`, not `src`.
-- Because `configure` (`config.status`) creates them, `make distclean` cleans them.
-- The pc files installed into `SAGE_LOCAL` are uninstalled when necessary - or it is ensured that they are properly overwritten.
-- Code in `build/make/Makefile.in` is removed in favor of creating a new type=script package `sage_system_blas_facade`, whose `spkg-install` does the installation to `SAGE_LOCAL`.
-- `openblas/spkg-configure.m4` sets `SAGE_BLAS=sage_system_blas_facade` if PC files are generated.
+This ticket revises the installation as follows:
 
+- `configure` no longer creates .pc files in the build tree
+- Instead it creates rules in `make/Makefile` that create the .pc files in `SAGE_LOCAL`.
+- Before pc files are installed into `SAGE_LOCAL`, the targets are removed, to avoid permission problems
+
+This ticket does not solve everything. There may still be problems when switching from a system library to an spkg-provided library. We will use the follow-up ticket #29387 (Complete solution for installing the generated *.pc files) to address this problem.
+
+
``````




---

archive/issue_comments_457917.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-03-22T09:10:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457917",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_457918.json:
```json
{
    "body": "<a id='comment:62'></a>\nOK, this does the needed job. Perhaps the make rules could be made less explicit, but OK.",
    "created_at": "2020-03-22T09:10:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457918",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:62'></a>
OK, this does the needed job. Perhaps the make rules could be made less explicit, but OK.



---

archive/issue_events_258394.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-22T09:10:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258394"
}
```



---

archive/issue_events_258395.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-22T09:10:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258395"
}
```



---

archive/issue_comments_457919.json:
```json
{
    "body": "<a id='comment:63'></a>\nThanks!",
    "created_at": "2020-03-22T09:27:10Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457919",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>
Thanks!



---

archive/issue_events_258396.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T14:22:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "rename": {
        "from": "Move .pc file from src/ to build/, clean generated *.pc files at 'make distclean', fix 'permission denied' errors",
        "to": "Do not stage .pc files in src/lib/, clean old generated *.pc files at 'make distclean', fix 'permission denied' errors"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258396"
}
```



---

archive/issue_comments_457920.json:
```json
{
    "body": "<a id='comment:65'></a>\nMake distclean deletes `src/lib/pkgconfig/.gitignore`",
    "created_at": "2020-03-23T23:22:26Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457920",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:65'></a>
Make distclean deletes `src/lib/pkgconfig/.gitignore`



---

archive/issue_events_258397.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-23T23:22:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258397"
}
```



---

archive/issue_events_258398.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-23T23:22:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258398"
}
```



---

archive/issue_comments_457921.json:
```json
{
    "body": "<a id='comment:66'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/329843baa9cecfb751e8afdb6b666f01930f0bf0\">329843b</a></td><td><code>Ignore /src/lib/pkgconfig using top-level .gitignore</code></td></tr></table>\n",
    "created_at": "2020-03-23T23:26:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:66'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/329843baa9cecfb751e8afdb6b666f01930f0bf0">329843b</a></td><td><code>Ignore /src/lib/pkgconfig using top-level .gitignore</code></td></tr></table>




---

archive/issue_comments_457922.json:
```json
{
    "body": "**Changing commit** from \"[2a38a167ab0c6aa3f39d704eb4087d9adf36c85a](https://github.com/sagemath/sagetrac-mirror/commit/2a38a167ab0c6aa3f39d704eb4087d9adf36c85a)\" to \"[329843baa9cecfb751e8afdb6b666f01930f0bf0](https://github.com/sagemath/sagetrac-mirror/commit/329843baa9cecfb751e8afdb6b666f01930f0bf0)\".",
    "created_at": "2020-03-23T23:26:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457922",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2a38a167ab0c6aa3f39d704eb4087d9adf36c85a](https://github.com/sagemath/sagetrac-mirror/commit/2a38a167ab0c6aa3f39d704eb4087d9adf36c85a)" to "[329843baa9cecfb751e8afdb6b666f01930f0bf0](https://github.com/sagemath/sagetrac-mirror/commit/329843baa9cecfb751e8afdb6b666f01930f0bf0)".



---

archive/issue_events_258399.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-23T23:27:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258399"
}
```



---

archive/issue_events_258400.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-23T23:27:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258400"
}
```



---

archive/issue_events_258401.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-24T03:32:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258401"
}
```



---

archive/issue_events_258402.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-24T03:32:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258402"
}
```



---

archive/issue_comments_457923.json:
```json
{
    "body": "<a id='comment:68'></a>\nok. sorry for overlooking this.",
    "created_at": "2020-03-24T03:32:11Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457923",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:68'></a>
ok. sorry for overlooking this.



---

archive/issue_comments_457924.json:
```json
{
    "body": "<a id='comment:69'></a>\nThanks",
    "created_at": "2020-03-24T03:33:21Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457924",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>
Thanks



---

archive/issue_events_258403.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-29T00:24:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258403"
}
```



---

archive/issue_events_258404.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d7db290643f3daa9be08354dcccd2ea52ca797b0",
    "created_at": "2020-03-29T00:24:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29082#event-258404"
}
```



---

archive/issue_comments_457925.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_)\" to \"[329843baa9cecfb751e8afdb6b666f01930f0bf0](https://github.com/sagemath/sagetrac-mirror/commit/329843baa9cecfb751e8afdb6b666f01930f0bf0)\".",
    "created_at": "2020-03-29T00:24:26Z",
    "issue": "https://github.com/sagemath/sage/issues/29082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29082#issuecomment-457925",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/move__pc_file_from_src__to_build___clean_generated___pc_files_at__make_distclean_)" to "[329843baa9cecfb751e8afdb6b666f01930f0bf0](https://github.com/sagemath/sagetrac-mirror/commit/329843baa9cecfb751e8afdb6b666f01930f0bf0)".
