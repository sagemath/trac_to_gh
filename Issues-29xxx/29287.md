# Issue 29287: SPKG type: Make "normal/script/pip" orthogonal to "base/standard/optional/experimental"

archive/issues_029050.json:
```json
{
    "body": "This ticket, inspired by a proposal by embray in #24586, removes the misuse of \"package type\" for the undocumented \"script package\" category (introduced in #19427). Likewise, it removes the same misuse of \"package type\" for the undocumented (as noted in #21033) \"pip package\" category (introduced in #19187).\n\nWith this ticket, `type` has to be one of `base` / `standard` / `optional` / `experimental`.\n\nAll `type=pip` packages are changed to `optional`.\n\nAll `type=script` packages are changed to `optional`; with the exception of `sage_conf`, which is a dependency of `sagelib` and is changed to `standard`.\n\nOrthogonal to `type` is the new notion of a package \"source\", which is defined as follows:\n- `normal` packages have a `checksum.ini` file\n- `pip` packages have a `requirements.txt` file instead (which is used for `pip install`). (This allows us to change the `pyopenssl` package from `script` to `pip`.)\n- `script` packages have neither of the two\n\nThe ticket also makes `script` packages more similar to `normal` packages: They can now optionally have a `package-version.txt` file; and their installation status is recorded.\n\nFinally, this ticket adds documentation to the developer manual.\n\n\n\nCC:  @embray @dimpase @jhpalmieri tmonteil @vbraun\n\nBranch/Commit: 091908665ae681b6f9cc1f491d4801acbdfb89ae\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29287\n\n",
    "closed_at": "2020-03-25T22:48:51Z",
    "created_at": "2020-03-06T16:46:19Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "SPKG type: Make \"normal/script/pip\" orthogonal to \"base/standard/optional/experimental\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29287",
    "user": "https://github.com/mkoeppe"
}
```
This ticket, inspired by a proposal by embray in #24586, removes the misuse of "package type" for the undocumented "script package" category (introduced in #19427). Likewise, it removes the same misuse of "package type" for the undocumented (as noted in #21033) "pip package" category (introduced in #19187).

With this ticket, `type` has to be one of `base` / `standard` / `optional` / `experimental`.

All `type=pip` packages are changed to `optional`.

All `type=script` packages are changed to `optional`; with the exception of `sage_conf`, which is a dependency of `sagelib` and is changed to `standard`.

Orthogonal to `type` is the new notion of a package "source", which is defined as follows:
- `normal` packages have a `checksum.ini` file
- `pip` packages have a `requirements.txt` file instead (which is used for `pip install`). (This allows us to change the `pyopenssl` package from `script` to `pip`.)
- `script` packages have neither of the two

The ticket also makes `script` packages more similar to `normal` packages: They can now optionally have a `package-version.txt` file; and their installation status is recorded.

Finally, this ticket adds documentation to the developer manual.



CC:  @embray @dimpase @jhpalmieri tmonteil @vbraun

Branch/Commit: 091908665ae681b6f9cc1f491d4801acbdfb89ae

Reviewer: John Palmieri

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29287





---

archive/issue_comments_437809.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2020-03-07T00:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437809",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_437810.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-07T02:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437811.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-07T03:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437811",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437812.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-03-07T05:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437812",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_437813.json:
```json
{
    "body": "<a id='comment:5'></a>This needs documentation.",
    "created_at": "2020-03-07T05:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437813",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>This needs documentation.



---

archive/issue_comments_437814.json:
```json
{
    "body": "<a id='comment:6'></a>Indeed, as noted already in #21033.",
    "created_at": "2020-03-08T00:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437814",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Indeed, as noted already in #21033.



---

archive/issue_comments_437815.json:
```json
{
    "body": "<a id='comment:7'></a>Just putting the list in the description somewhere in the docs would help. What is a \"script\" package, anyway?",
    "created_at": "2020-03-08T20:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437815",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>Just putting the list in the description somewhere in the docs would help. What is a "script" package, anyway?



---

archive/issue_comments_437816.json:
```json
{
    "body": "<a id='comment:8'></a>Yes, I'll work on it",
    "created_at": "2020-03-08T20:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437816",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Yes, I'll work on it



---

archive/issue_comments_437817.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-14T21:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437817",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_437818.json:
```json
{
    "body": "<a id='comment:11'></a>Rebased on 9.1.beta7, merged #29096 to avoid conflicts in documentation",
    "created_at": "2020-03-14T21:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437818",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Rebased on 9.1.beta7, merged #29096 to avoid conflicts in documentation



---

archive/issue_comments_437819.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,10 +1,13 @@\n This would enable having \"optional\" \"script\" packages. (Needed for #27952 - libnauty)\n \n-\\`type\\` would only be used for \"standard/optional/experimental\".\n+\\`type\\` would only be used for \\`standard\\`/\\`optional\\`/\\`experimental\\`.\n \n-- regular packages have a \\`checksum.ini\\`\n-- pip packages have \\`requirements.txt\\` instead\n-- script packages have neither of the two\n+- \\`normal\\` packages have a \\`checksum.ini\\`\n+- \\`pip\\` packages have \\`requirements.txt\\` instead\n+- \\`script\\` packages have neither of the two\n+\n+\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2020-03-14T22:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437819",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,10 +1,13 @@
 This would enable having "optional" "script" packages. (Needed for #27952 - libnauty)
 
-\`type\` would only be used for "standard/optional/experimental".
+\`type\` would only be used for \`standard\`/\`optional\`/\`experimental\`.
 
-- regular packages have a \`checksum.ini\`
-- pip packages have \`requirements.txt\` instead
-- script packages have neither of the two
+- \`normal\` packages have a \`checksum.ini\`
+- \`pip\` packages have \`requirements.txt\` instead
+- \`script\` packages have neither of the two
+
+
+
 
 Comment: 1
 
```




---

archive/issue_comments_437820.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-14T23:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437821.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-14T23:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437822.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T00:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437823.json:
```json
{
    "body": "<a id='comment:16'></a>Added documentation describing normal, pip, and script packages.",
    "created_at": "2020-03-15T01:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437823",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Added documentation describing normal, pip, and script packages.



---

archive/issue_comments_437824.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T01:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437825.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T01:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437826.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T02:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437827.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T02:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437828.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-03-15T03:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437828",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_437829.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,20 @@\n+This ticket, inspired by a proposal by embray in #24586, removes the misuse of \"package type\" for the undocumented \"script package\" category (introduced in #19427). Likewise, it removes the same misuse of \"package type\" for the undocumented (as noted in #21033) \"pip package\" category (introduced in #19187).\n+\n+With this ticket, \\`type\\` has to be one of \\`base\\` / \\`standard\\` / \\`optional\\` / \\`experimental\\`.\n+\n+All \\`type=pip\\` packages are changed to \\`optional\\`.\n+\n+All \\`type=script\\` packages are changed to \\`optional\\`; with the exception of \\`sage_conf\\`, which is a dependency of \\`sagelib\\` and is changed to \\`standard\\`.\n+\n+Orthogonal to \\`type\\` is the new notion of a package \"source\", which is defined as follows:\n+- \\`normal\\` packages have a \\`checksum.ini\\` file\n+- \\`pip\\` packages have a \\`requirements.txt\\` file instead (which is used for \\`pip install\\`)\n+- \\`script\\` packages have neither of the two\n+\n+The ticket also makes \\`script\\` packages more similar to \\`normal\\` packages: They can now optionally have a \\`package-version.txt\\` file; and their installation status is recorded.\n+\n+Finally, this ticket adds documentation to the developer manual.\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-03-15T03:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437829",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,20 @@
+This ticket, inspired by a proposal by embray in #24586, removes the misuse of "package type" for the undocumented "script package" category (introduced in #19427). Likewise, it removes the same misuse of "package type" for the undocumented (as noted in #21033) "pip package" category (introduced in #19187).
+
+With this ticket, \`type\` has to be one of \`base\` / \`standard\` / \`optional\` / \`experimental\`.
+
+All \`type=pip\` packages are changed to \`optional\`.
+
+All \`type=script\` packages are changed to \`optional\`; with the exception of \`sage_conf\`, which is a dependency of \`sagelib\` and is changed to \`standard\`.
+
+Orthogonal to \`type\` is the new notion of a package "source", which is defined as follows:
+- \`normal\` packages have a \`checksum.ini\` file
+- \`pip\` packages have a \`requirements.txt\` file instead (which is used for \`pip install\`)
+- \`script\` packages have neither of the two
+
+The ticket also makes \`script\` packages more similar to \`normal\` packages: They can now optionally have a \`package-version.txt\` file; and their installation status is recorded.
+
+Finally, this ticket adds documentation to the developer manual.
+
 
 
 Comment: 1
```




---

archive/issue_comments_437830.json:
```json
{
    "body": "<a id='comment:22'></a>Why do you had all these `.in`? Such a change should be agreed on sage-devel.",
    "created_at": "2020-03-15T22:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437830",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>Why do you had all these `.in`? Such a change should be agreed on sage-devel.



---

archive/issue_comments_437831.json:
```json
{
    "body": "<a id='comment:23'></a>Unless I misunderstood something, in the section `Install scripts of script packages`, ```spkg-install``` should be ```spkg-install.in``` (twice).",
    "created_at": "2020-03-15T22:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437831",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>Unless I misunderstood something, in the section `Install scripts of script packages`, ```spkg-install``` should be ```spkg-install.in``` (twice).



---

archive/issue_comments_437832.json:
```json
{
    "body": "<a id='comment:24'></a>Changing to .in happened on #29096.\n\nNo, script packages don't to templating.",
    "created_at": "2020-03-15T22:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437832",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Changing to .in happened on #29096.

No, script packages don't to templating.



---

archive/issue_comments_437833.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:22 vdelecroix]:\n> Why do you had all these `.in`? Such a change should be agreed on sage-devel.\n\n\nwe had an argument about it, and that change should have been done when the actual conversion of most of sage-install scripts into templates happened, a couple of years back. So this change merely corrects an old fault of the naming scheme.",
    "created_at": "2020-03-16T08:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437833",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>Replying to [comment:22 vdelecroix]:
> Why do you had all these `.in`? Such a change should be agreed on sage-devel.


we had an argument about it, and that change should have been done when the actual conversion of most of sage-install scripts into templates happened, a couple of years back. So this change merely corrects an old fault of the naming scheme.



---

archive/issue_comments_437834.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-03-19T00:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_437835.json:
```json
{
    "body": "<a id='comment:27'></a>Rebased on 9.1.beta8 -- so the diff is easier to read now. Needs review",
    "created_at": "2020-03-19T00:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437835",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Rebased on 9.1.beta8 -- so the diff is easier to read now. Needs review



---

archive/issue_comments_437836.json:
```json
{
    "body": "<a id='comment:28'></a>I get a doctest failure:\n\n```\nsage -t --long --warn-long 65.3 src/sage/env.py\n**********************************************************************\nFile \"src/sage/env.py\", line 14, in sage.env\nFailed example:\n    res = subprocess.call([sys.executable, \"-c\", cmd], env=env)  # long time\nExpected:\n    None\nGot:\n    /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/29090/29287/sage-9.1.beta8\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.env\n    [45 tests, 1 failure, 1.41 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 65.3 src/sage/env.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 1.4 seconds\n    cpu time: 0.1 seconds\n    cumulative wall time: 1.4 seconds\n```",
    "created_at": "2020-03-19T16:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437836",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>I get a doctest failure:

```
sage -t --long --warn-long 65.3 src/sage/env.py
**********************************************************************
File "src/sage/env.py", line 14, in sage.env
Failed example:
    res = subprocess.call([sys.executable, "-c", cmd], env=env)  # long time
Expected:
    None
Got:
    /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/29090/29287/sage-9.1.beta8
**********************************************************************
1 item had failures:
   1 of   5 in sage.env
    [45 tests, 1 failure, 1.41 s]
----------------------------------------------------------------------
sage -t --long --warn-long 65.3 src/sage/env.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 1.4 seconds
    cpu time: 0.1 seconds
    cumulative wall time: 1.4 seconds
```



---

archive/issue_comments_437837.json:
```json
{
    "body": "<a id='comment:29'></a>I don't know m4 syntax. Is the indentation remaining after you delete `if test \"$SPKG_NAME\" != \"$SPKG_VERSION\"; then` meaningful?",
    "created_at": "2020-03-19T17:00:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437837",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>I don't know m4 syntax. Is the indentation remaining after you delete `if test "$SPKG_NAME" != "$SPKG_VERSION"; then` meaningful?



---

archive/issue_comments_437838.json:
```json
{
    "body": "<a id='comment:30'></a>No, it is not meaningful, I was just keeping the diff small.",
    "created_at": "2020-03-19T17:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437838",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>No, it is not meaningful, I was just keeping the diff small.



---

archive/issue_comments_437839.json:
```json
{
    "body": "<a id='comment:31'></a>What do you think about this proposed change:\n\n```diff\ndiff --git a/src/doc/en/developer/packaging.rst b/src/doc/en/developer/packaging.rst\nindex 6934f4ebbf..34f5651bc1 100644\n--- a/src/doc/en/developer/packaging.rst\n+++ b/src/doc/en/developer/packaging.rst\n@@ -87,8 +87,9 @@ the following source types:\n    - is obtained directly from https://pypi.org/;\n \n    - the version to be installed is determined using the required file\n-     ``requirements.txt`` (see\n-     https://pip.pypa.io/en/stable/reference/pip_install/#requirements-file-format);\n+     ``requirements.txt`` -- in its simplest form, this file just\n+     contains the name of the package (more details at\n+     https://pip.pypa.io/en/stable/user_guide/#requirements-files);\n \n    - Sage installs the package using the ``pip`` package manager;\n \n```\nNote: different link, in addition to the changed text.",
    "created_at": "2020-03-19T17:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437839",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>What do you think about this proposed change:

```diff
diff --git a/src/doc/en/developer/packaging.rst b/src/doc/en/developer/packaging.rst
index 6934f4ebbf..34f5651bc1 100644
--- a/src/doc/en/developer/packaging.rst
+++ b/src/doc/en/developer/packaging.rst
@@ -87,8 +87,9 @@ the following source types:
    - is obtained directly from https://pypi.org/;
 
    - the version to be installed is determined using the required file
-     ``requirements.txt`` (see
-     https://pip.pypa.io/en/stable/reference/pip_install/#requirements-file-format);
+     ``requirements.txt`` -- in its simplest form, this file just
+     contains the name of the package (more details at
+     https://pip.pypa.io/en/stable/user_guide/#requirements-files);
 
    - Sage installs the package using the ``pip`` package manager;
 
```
Note: different link, in addition to the changed text.



---

archive/issue_comments_437840.json:
```json
{
    "body": "<a id='comment:32'></a>Excellent, please push it to the ticket",
    "created_at": "2020-03-19T17:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437840",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Excellent, please push it to the ticket



---

archive/issue_comments_437841.json:
```json
{
    "body": "<a id='comment:34'></a>Not necessarily for this ticket, but should `pyopenssl` be a pip package?\n\n---\nNew commits:",
    "created_at": "2020-03-19T17:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437841",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>Not necessarily for this ticket, but should `pyopenssl` be a pip package?

---
New commits:



---

archive/issue_comments_437842.json:
```json
{
    "body": "<a id='comment:35'></a>Good idea. I'll make this change.",
    "created_at": "2020-03-19T17:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437842",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Good idea. I'll make this change.



---

archive/issue_comments_437843.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:28 jhpalmieri]:\n> I get a doctest failure:\n> \n> ```\n> sage -t --long --warn-long 65.3 src/sage/env.py\n> **********************************************************************\n> File \"src/sage/env.py\", line 14, in sage.env\n> Failed example:\n>     res = subprocess.call([sys.executable, \"-c\", cmd], env=env)  # long time\n> Expected:\n>     None\n> Got:\n>     /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/29090/29287/sage-9.1.beta8\n> ```\n\n\nHa, this doctest is funny. I'll fix it.\n\n---\nNew commits:",
    "created_at": "2020-03-19T17:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437843",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>Replying to [comment:28 jhpalmieri]:
> I get a doctest failure:
> 
> ```
> sage -t --long --warn-long 65.3 src/sage/env.py
> **********************************************************************
> File "src/sage/env.py", line 14, in sage.env
> Failed example:
>     res = subprocess.call([sys.executable, "-c", cmd], env=env)  # long time
> Expected:
>     None
> Got:
>     /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/29090/29287/sage-9.1.beta8
> ```


Ha, this doctest is funny. I'll fix it.

---
New commits:



---

archive/issue_comments_437844.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-19T18:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437845.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,20 @@\n+This ticket, inspired by a proposal by embray in #24586, removes the misuse of \"package type\" for the undocumented \"script package\" category (introduced in #19427). Likewise, it removes the same misuse of \"package type\" for the undocumented (as noted in #21033) \"pip package\" category (introduced in #19187).\n+\n+With this ticket, \\`type\\` has to be one of \\`base\\` / \\`standard\\` / \\`optional\\` / \\`experimental\\`.\n+\n+All \\`type=pip\\` packages are changed to \\`optional\\`.\n+\n+All \\`type=script\\` packages are changed to \\`optional\\`; with the exception of \\`sage_conf\\`, which is a dependency of \\`sagelib\\` and is changed to \\`standard\\`.\n+\n+Orthogonal to \\`type\\` is the new notion of a package \"source\", which is defined as follows:\n+- \\`normal\\` packages have a \\`checksum.ini\\` file\n+- \\`pip\\` packages have a \\`requirements.txt\\` file instead (which is used for \\`pip install\\`). (This allows us to change the \\`pyopenssl\\` package from \\`script\\` to \\`pip\\`.)\n+- \\`script\\` packages have neither of the two\n+\n+The ticket also makes \\`script\\` packages more similar to \\`normal\\` packages: They can now optionally have a \\`package-version.txt\\` file; and their installation status is recorded.\n+\n+Finally, this ticket adds documentation to the developer manual.\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-03-19T18:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437845",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,20 @@
+This ticket, inspired by a proposal by embray in #24586, removes the misuse of "package type" for the undocumented "script package" category (introduced in #19427). Likewise, it removes the same misuse of "package type" for the undocumented (as noted in #21033) "pip package" category (introduced in #19187).
+
+With this ticket, \`type\` has to be one of \`base\` / \`standard\` / \`optional\` / \`experimental\`.
+
+All \`type=pip\` packages are changed to \`optional\`.
+
+All \`type=script\` packages are changed to \`optional\`; with the exception of \`sage_conf\`, which is a dependency of \`sagelib\` and is changed to \`standard\`.
+
+Orthogonal to \`type\` is the new notion of a package "source", which is defined as follows:
+- \`normal\` packages have a \`checksum.ini\` file
+- \`pip\` packages have a \`requirements.txt\` file instead (which is used for \`pip install\`). (This allows us to change the \`pyopenssl\` package from \`script\` to \`pip\`.)
+- \`script\` packages have neither of the two
+
+The ticket also makes \`script\` packages more similar to \`normal\` packages: They can now optionally have a \`package-version.txt\` file; and their installation status is recorded.
+
+Finally, this ticket adds documentation to the developer manual.
+
 
 
 Comment: 1
```




---

archive/issue_comments_437846.json:
```json
{
    "body": "<a id='comment:40'></a>Can you explain the doctest failure? For some reason, there was no output before, but now there is output?",
    "created_at": "2020-03-19T20:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437846",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>Can you explain the doctest failure? For some reason, there was no output before, but now there is output?



---

archive/issue_comments_437847.json:
```json
{
    "body": "<a id='comment:41'></a>The doctest was actually \"broken\" by #29038 in the situation when the `sage_conf` package that it added is installed.\nSee ticket description of #29038 -- in particular, it provides `SAGE_ROOT` in the situation that Python imports `sage.all` outside of a sage-env.\nThat doctest was testing that `SAGE_ROOT` is not provided in that situation -- when it should simply have tested that the `sage.all` module works.\n\nThe present ticket makes sure that `sage_conf` is always installed (fixes #29365, for example), and so you now saw the doctest failure.",
    "created_at": "2020-03-19T20:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437847",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>The doctest was actually "broken" by #29038 in the situation when the `sage_conf` package that it added is installed.
See ticket description of #29038 -- in particular, it provides `SAGE_ROOT` in the situation that Python imports `sage.all` outside of a sage-env.
That doctest was testing that `SAGE_ROOT` is not provided in that situation -- when it should simply have tested that the `sage.all` module works.

The present ticket makes sure that `sage_conf` is always installed (fixes #29365, for example), and so you now saw the doctest failure.



---

archive/issue_comments_437848.json:
```json
{
    "body": "<a id='comment:42'></a>Why do we need to give a longer path in the `spkg-install` file for `texlive`?",
    "created_at": "2020-03-19T22:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437848",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:42'></a>Why do we need to give a longer path in the `spkg-install` file for `texlive`?



---

archive/issue_comments_437849.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:42 jhpalmieri]:\n> Why do we need to give a longer path in the `spkg-install` file for `texlive`?\n\nThis is an incidental bugfix for something that was broken by some earlier ticket. Seems nobody has tried `sage -i texlive` in a while.",
    "created_at": "2020-03-19T22:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437849",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>Replying to [comment:42 jhpalmieri]:
> Why do we need to give a longer path in the `spkg-install` file for `texlive`?

This is an incidental bugfix for something that was broken by some earlier ticket. Seems nobody has tried `sage -i texlive` in a while.



---

archive/issue_comments_437850.json:
```json
{
    "body": "<a id='comment:45'></a>A few small changes. If you're happy with these, positive review from me.\n\n---\nNew commits:",
    "created_at": "2020-03-19T22:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437850",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:45'></a>A few small changes. If you're happy with these, positive review from me.

---
New commits:



---

archive/issue_comments_437851.json:
```json
{
    "body": "<a id='comment:46'></a>Great, thanks very much.",
    "created_at": "2020-03-19T22:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437851",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>Great, thanks very much.



---

archive/issue_comments_437852.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-19T22:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437852",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437853.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-03-21T01:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437853",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_events_074510.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-25T22:48:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29287#event-74510"
}
```



---

archive/issue_comments_437854.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-25T22:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29287#issuecomment-437854",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
