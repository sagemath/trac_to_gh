# Issue 29410: Combinatorial designs: add some difference matrices and related objects

archive/issues_029173.json:
```json
{
    "body": "We add a few constructions of difference matrices whose lambda parameter is not 1.\n\nWe then modify the orthogonal arrays and transversal designs constructions\nto take advantage of these additions. Finally, we add a new function `symmetric_net`.\n\n\nCC:  @dimpase @slel\n\nKeywords: symmetric_nets orthogonal_arrays transversal_designs difference_matrices\n\nAuthor: Ivo Maffei\n\nBranch: u/gh-Ivo-Maffei/symmetric_nets\n\nStatus: new\n\nCommit: b3c3bd573187c03f43414b913523a04dd609017c\n\nIssue created by migration from https://trac.sagemath.org/ticket/29410\n\n",
    "created_at": "2020-03-26T18:43:45Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Combinatorial designs: add some difference matrices and related objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29410",
    "user": "https://github.com/Ivo-Maffei"
}
```
We add a few constructions of difference matrices whose lambda parameter is not 1.

We then modify the orthogonal arrays and transversal designs constructions
to take advantage of these additions. Finally, we add a new function `symmetric_net`.


CC:  @dimpase @slel

Keywords: symmetric_nets orthogonal_arrays transversal_designs difference_matrices

Author: Ivo Maffei

Branch: u/gh-Ivo-Maffei/symmetric_nets

Status: new

Commit: b3c3bd573187c03f43414b913523a04dd609017c

Issue created by migration from https://trac.sagemath.org/ticket/29410





---

archive/issue_comments_440022.json:
```json
{
    "body": "<a id='comment:1'></a>I see failing doctests:\n\n```\nsage -t --warn-long 94.4 src/sage/combinat/designs/latin_squares.py  # 2 doctests failed\nsage -t --warn-long 94.4 src/sage/combinat/designs/designs_pyx.pyx  # 3 doctests failed\n```",
    "created_at": "2020-04-07T18:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440022",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>I see failing doctests:

```
sage -t --warn-long 94.4 src/sage/combinat/designs/latin_squares.py  # 2 doctests failed
sage -t --warn-long 94.4 src/sage/combinat/designs/designs_pyx.pyx  # 3 doctests failed
```



---

archive/issue_comments_440023.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-07T21:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440023",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440024.json:
```json
{
    "body": "<a id='comment:3'></a>Do you run tests using [GitHub](GitHub) Actions? (see #29401 for details)\n\nIn your code, to build docs, one needs\n\n```diff\n--- a/src/sage/combinat/designs/orthogonal_arrays.py\n+++ b/src/sage/combinat/designs/orthogonal_arrays.py\n@@ -80,10 +80,10 @@ def symmetric_net(n, lmbda=1, check=True, existence=False):\n       Set to ``True`` by default\n \n     - ``existence`` -- bolean. Instead of returnig a symmetric net, return:\n-      - ``True`` -- such a net can be constructed by Sage\n-      - ``False`` -- no such a net exists\n-      - ``Unknown`` -- Sage does not know how to build such a design\n-        so such design may or may not exist\n+        - ``True`` -- such a net can be constructed by Sage\n+        - ``False`` -- no such a net exists\n+        - ``Unknown`` -- Sage does not know how to build such a design\n+          so such design may or may not exist\n \n     EXAMPLES::\n\n--- a/src/sage/combinat/designs/difference_matrices.py\n+++ b/src/sage/combinat/designs/difference_matrices.py\n@@ -428,9 +428,9 @@ def subgroup_construction(g,k,lmbda,existence=False):\n     - ``g,k,\\lambda`` -- (integers) parameters of the difference matrix to construct\n \n     - ``existence`` -- (boolean) instead of building the design, return:\n-      - ``True`` if Sage can build the difference matrix using the subgroup construction\n-      - ``False`` if Sage can't build the difference matrix using this construction\n-         Note that Sage may be able to build such difference matrix in other ways\n+        - ``True`` if Sage can build the difference matrix using the subgroup construction\n+        - ``False`` if Sage can't build the difference matrix using this construction\n+          Note that Sage may be able to build such difference matrix in other ways\n \n     EXAMPLES::\n \n\n```\n\n(sphinx is very sensitive to correct indentation)",
    "created_at": "2020-04-13T09:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440024",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>Do you run tests using [GitHub](GitHub) Actions? (see #29401 for details)

In your code, to build docs, one needs

```diff
--- a/src/sage/combinat/designs/orthogonal_arrays.py
+++ b/src/sage/combinat/designs/orthogonal_arrays.py
@@ -80,10 +80,10 @@ def symmetric_net(n, lmbda=1, check=True, existence=False):
       Set to ``True`` by default
 
     - ``existence`` -- bolean. Instead of returnig a symmetric net, return:
-      - ``True`` -- such a net can be constructed by Sage
-      - ``False`` -- no such a net exists
-      - ``Unknown`` -- Sage does not know how to build such a design
-        so such design may or may not exist
+        - ``True`` -- such a net can be constructed by Sage
+        - ``False`` -- no such a net exists
+        - ``Unknown`` -- Sage does not know how to build such a design
+          so such design may or may not exist
 
     EXAMPLES::

--- a/src/sage/combinat/designs/difference_matrices.py
+++ b/src/sage/combinat/designs/difference_matrices.py
@@ -428,9 +428,9 @@ def subgroup_construction(g,k,lmbda,existence=False):
     - ``g,k,\lambda`` -- (integers) parameters of the difference matrix to construct
 
     - ``existence`` -- (boolean) instead of building the design, return:
-      - ``True`` if Sage can build the difference matrix using the subgroup construction
-      - ``False`` if Sage can't build the difference matrix using this construction
-         Note that Sage may be able to build such difference matrix in other ways
+        - ``True`` if Sage can build the difference matrix using the subgroup construction
+        - ``False`` if Sage can't build the difference matrix using this construction
+          Note that Sage may be able to build such difference matrix in other ways
 
     EXAMPLES::
 

```

(sphinx is very sensitive to correct indentation)



---

archive/issue_comments_440025.json:
```json
{
    "body": "<a id='comment:4'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440025",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_074939.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74939"
}
```



---

archive/issue_comments_440026.json:
```json
{
    "body": "<a id='comment:5'></a>One occurrence of \"more than 1 time\" should be \"more than once\" as elsewhere.\n\nCan you do a round of pep8 formatting?\n\nI would use `lamda` as an alternate name for lambda\n(since lambda is a reserved keyword in Python).\nI find it makes code easier to read than lambd or lmbda.",
    "created_at": "2020-06-19T10:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440026",
    "user": "https://github.com/slel"
}
```

<a id='comment:5'></a>One occurrence of "more than 1 time" should be "more than once" as elsewhere.

Can you do a round of pep8 formatting?

I would use `lamda` as an alternate name for lambda
(since lambda is a reserved keyword in Python).
I find it makes code easier to read than lambd or lmbda.



---

archive/issue_comments_440027.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,5 +1,8 @@\n-I added a few constructions of difference matrices whose \\lambda parameter is not 1.\n-I then modified the orthogonal arrays and transversal designs constructions to take advantage of my additions. Finally, I added a new function symmetric_net.\n+We add a few constructions of difference matrices whose lambda parameter is not 1.\n+\n+We then modify the orthogonal arrays and transversal designs constructions\n+to take advantage of these additions. Finally, we add a new function \\`symmetric_net\\`.\n+\n \n Author: Ivo Maffei\n \n```\n",
    "created_at": "2020-06-19T10:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440027",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,5 +1,8 @@
-I added a few constructions of difference matrices whose \lambda parameter is not 1.
-I then modified the orthogonal arrays and transversal designs constructions to take advantage of my additions. Finally, I added a new function symmetric_net.
+We add a few constructions of difference matrices whose lambda parameter is not 1.
+
+We then modify the orthogonal arrays and transversal designs constructions
+to take advantage of these additions. Finally, we add a new function \`symmetric_net\`.
+
 
 Author: Ivo Maffei
 
```




---

archive/issue_comments_440028.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 slelievre]:\n>\n> I would use `lamda` as an alternate name for lambda\n\n\nAnother option is `la` which I like too.",
    "created_at": "2020-06-19T10:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440028",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'></a>Replying to [comment:5 slelievre]:
>
> I would use `lamda` as an alternate name for lambda


Another option is `la` which I like too.



---

archive/issue_comments_440029.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-23T17:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_440030.json:
```json
{
    "body": "<a id='comment:8'></a>I did some more work on the \"subgroup_construction\" method and added support for GAP groups in other places.\nSage's tests pass and the documentation builds without errors. However, I've probably missed some formatting issues here and there.\n\n`lmbda` is the keyword used throughout the \"designs_pyx.pyx\" and the \"difference_matrices.py\" files. I introduced it only in the \"orthogonal_arrays.py\" file. If it bothers you, then I'll change it in all three files as I believe it should be consistent across them.\n\nFinally, the definition of difference matrices in the doctoring doesn't seem right and needs some checking.",
    "created_at": "2020-06-23T17:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440030",
    "user": "https://github.com/Ivo-Maffei"
}
```

<a id='comment:8'></a>I did some more work on the "subgroup_construction" method and added support for GAP groups in other places.
Sage's tests pass and the documentation builds without errors. However, I've probably missed some formatting issues here and there.

`lmbda` is the keyword used throughout the "designs_pyx.pyx" and the "difference_matrices.py" files. I introduced it only in the "orthogonal_arrays.py" file. If it bothers you, then I'll change it in all three files as I believe it should be consistent across them.

Finally, the definition of difference matrices in the doctoring doesn't seem right and needs some checking.



---

archive/issue_comments_440031.json:
```json
{
    "body": "<a id='comment:9'></a>I looked into the definition of difference matrices.\\\\\nThe book \"Design Theory\" by Beth et. al. (Cambridge University Press, 1999) defines a `(g, k, \\lambda)` difference matrix as a `k \\times \\lambda g` matrix such that for any two distinct rows `R_i, R_j` each element of `G` appears `\\lambda` times in the sequence `(R_i[l]-R_j[l])`. This is basically, the definition given in the docstring, but the dimensions of the matrix are flipped (hence the docstring is wrong).\\\\\nThe docstring in `is_difference_matrix`, gives the same definition without specifying the dimensions.\nWhat the codes actually do is redirecting the call to `is_quasi_difference_matrix` which, in this specific case, checks that in any 2  __columns__ `C_i, C_j` each element of `G` appears `\\lambda` times in the sequence `(C_i[l] - C_j[l])`. However we need `G` to be Abelian since the code doesn't check both `C_i - C_j` and `C_j - C_i`.\n\nSo there are 2 issues to fix:\n1. change the docstring of difference matrices to use columns or change the code by taking transposes when needed;\n2. limit difference matrices to Abelian groups or change the `is_quasi_difference_matrix` function to allow for non-Abelian groups\n\nPersonally, I would change the docstring for the difference matrices so that it matches the definition of quasi-difference matrices and then change the code of `is_quasi_difference_matrix` to allow for non-Abelian groups. Are there any reasons I should not go this way?",
    "created_at": "2020-06-24T10:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440031",
    "user": "https://github.com/Ivo-Maffei"
}
```

<a id='comment:9'></a>I looked into the definition of difference matrices.\\
The book "Design Theory" by Beth et. al. (Cambridge University Press, 1999) defines a `(g, k, \lambda)` difference matrix as a `k \times \lambda g` matrix such that for any two distinct rows `R_i, R_j` each element of `G` appears `\lambda` times in the sequence `(R_i[l]-R_j[l])`. This is basically, the definition given in the docstring, but the dimensions of the matrix are flipped (hence the docstring is wrong).\\
The docstring in `is_difference_matrix`, gives the same definition without specifying the dimensions.
What the codes actually do is redirecting the call to `is_quasi_difference_matrix` which, in this specific case, checks that in any 2  __columns__ `C_i, C_j` each element of `G` appears `\lambda` times in the sequence `(C_i[l] - C_j[l])`. However we need `G` to be Abelian since the code doesn't check both `C_i - C_j` and `C_j - C_i`.

So there are 2 issues to fix:
1. change the docstring of difference matrices to use columns or change the code by taking transposes when needed;
2. limit difference matrices to Abelian groups or change the `is_quasi_difference_matrix` function to allow for non-Abelian groups

Personally, I would change the docstring for the difference matrices so that it matches the definition of quasi-difference matrices and then change the code of `is_quasi_difference_matrix` to allow for non-Abelian groups. Are there any reasons I should not go this way?



---

archive/issue_comments_440032.json:
```json
{
    "body": "<a id='comment:10'></a>do you meanwhile have non-trivial examples of difference sets for non-abelian groups?",
    "created_at": "2020-06-25T12:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440032",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>do you meanwhile have non-trivial examples of difference sets for non-abelian groups?



---

archive/issue_comments_440033.json:
```json
{
    "body": "<a id='comment:11'></a>I think changing the docstring is the obvious best option - as it does not break any code.\n\nIn the non-abelian case, do you still use additive notation for the group? This is unusual,\nperhaps needs commenting...",
    "created_at": "2020-06-25T12:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440033",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>I think changing the docstring is the obvious best option - as it does not break any code.

In the non-abelian case, do you still use additive notation for the group? This is unusual,
perhaps needs commenting...



---

archive/issue_comments_440034.json:
```json
{
    "body": "<a id='comment:12'></a>While there exist non-abelian difference sets (e.g. http://mathonline.wikidot.com/difference-sets-in-non-abelian-groups), the `difference_family` function explicitly states that it only returns difference families for abelian groups.\n\nAs far as the notation is concerned, it seems standard to use `+` and `-` for difference matrices despite I haven't found any definition that restricts to abelian groups. If we end up allowing non-abelian groups, then I'll add a note in the docstrings.",
    "created_at": "2020-06-25T13:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440034",
    "user": "https://github.com/Ivo-Maffei"
}
```

<a id='comment:12'></a>While there exist non-abelian difference sets (e.g. http://mathonline.wikidot.com/difference-sets-in-non-abelian-groups), the `difference_family` function explicitly states that it only returns difference families for abelian groups.

As far as the notation is concerned, it seems standard to use `+` and `-` for difference matrices despite I haven't found any definition that restricts to abelian groups. If we end up allowing non-abelian groups, then I'll add a note in the docstrings.



---

archive/issue_events_074940.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74940"
}
```



---

archive/issue_events_074941.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74941"
}
```



---

archive/issue_events_074942.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74942"
}
```



---

archive/issue_events_074943.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74943"
}
```



---

archive/issue_comments_440035.json:
```json
{
    "body": "<a id='comment:14'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29410#issuecomment-440035",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_074944.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74944"
}
```



---

archive/issue_events_074945.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74945"
}
```



---

archive/issue_events_074946.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74946"
}
```



---

archive/issue_events_074947.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74947"
}
```



---

archive/issue_events_074948.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74948"
}
```



---

archive/issue_events_074949.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74949"
}
```



---

archive/issue_events_074950.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74950"
}
```



---

archive/issue_events_074951.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29410",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29410#event-74951"
}
```
