# Issue 29971: Make categories doctests ready for random seeds

archive/issues_029734.json:
```json
{
    "body": "This ticket makes\n\n```\nsage -t --long --random-seed=n src/sage/categories/\n```\npass for different values `n` than just `0`.\n\n\nBranch/Commit: d3457de5dd5fd11cc7e2e6ec8fb48504fd37bf6b\n\nReviewer: Markus Wageringel\n\nAuthor: Jonathan Kliem\n\nDependencies: #29962\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29971\n\n",
    "closed_at": "2020-08-16T22:33:03Z",
    "created_at": "2020-06-24T20:40:51Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Make categories doctests ready for random seeds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29971",
    "user": "https://github.com/kliem"
}
```
This ticket makes

```
sage -t --long --random-seed=n src/sage/categories/
```
pass for different values `n` than just `0`.


Branch/Commit: d3457de5dd5fd11cc7e2e6ec8fb48504fd37bf6b

Reviewer: Markus Wageringel

Author: Jonathan Kliem

Dependencies: #29962

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29971





---

archive/issue_comments_421887.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2020-06-24T20:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421887",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_421888.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-24T20:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421888",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_421889.json:
```json
{
    "body": "<a id='comment:2'></a>I'm not sure if this is a good way to update the doctests. Essentially you are disabling a test by marking it random; the only way it can fail is if it raises an error.\n\nI think it would be better to invent a new doctest tag such as \"# random_seed=0\" or whatever is syntactically convenient.",
    "created_at": "2020-06-25T18:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421889",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>I'm not sure if this is a good way to update the doctests. Essentially you are disabling a test by marking it random; the only way it can fail is if it raises an error.

I think it would be better to invent a new doctest tag such as "# random_seed=0" or whatever is syntactically convenient.



---

archive/issue_comments_421890.json:
```json
{
    "body": "<a id='comment:3'></a>To advertise my point about testing this stuff random #29961. In this instance, the `get_random_element` thing really failed sometimes. It wasn't discovered before, because only seed 0 is tested.\n\nWhat's the point about testing this only at seed 0. This doesn't tell us anything about how stable the method is.\n\nBut I should add a test that illustrates that this is an element of the correct thing.",
    "created_at": "2020-06-25T18:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421890",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>To advertise my point about testing this stuff random #29961. In this instance, the `get_random_element` thing really failed sometimes. It wasn't discovered before, because only seed 0 is tested.

What's the point about testing this only at seed 0. This doesn't tell us anything about how stable the method is.

But I should add a test that illustrates that this is an element of the correct thing.



---

archive/issue_comments_421891.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-25T20:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421891",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_421892.json:
```json
{
    "body": "<a id='comment:5'></a>Is this better? I would say the test is now more valuable than the old tests. It tells us that `random_element` will give us an element (not just on random seed 0 and not just something that looks like an element).",
    "created_at": "2020-06-25T20:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421892",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>Is this better? I would say the test is now more valuable than the old tests. It tells us that `random_element` will give us an element (not just on random seed 0 and not just something that looks like an element).



---

archive/issue_comments_421893.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:3 gh-kliem]:\n> To advertise my point about testing this stuff random #29961. In this instance, the `get_random_element` thing really failed sometimes. It wasn't discovered before, because only seed 0 is tested.\n> \n> What's the point about testing this only at seed 0.\n\n\nWell, my main point is that test coverage before and after this ticket are really incomparable.  The change \n- drops the test for seed 0 giving a specific element (or, as you say, what looks like an element); \n- adds a test for an arbitrary seed giving no error and passing the `__contains__` test",
    "created_at": "2020-06-25T21:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421893",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Replying to [comment:3 gh-kliem]:
> To advertise my point about testing this stuff random #29961. In this instance, the `get_random_element` thing really failed sometimes. It wasn't discovered before, because only seed 0 is tested.
> 
> What's the point about testing this only at seed 0.


Well, my main point is that test coverage before and after this ticket are really incomparable.  The change 
- drops the test for seed 0 giving a specific element (or, as you say, what looks like an element); 
- adds a test for an arbitrary seed giving no error and passing the `__contains__` test



---

archive/issue_comments_421894.json:
```json
{
    "body": "<a id='comment:7'></a>The other thing that one could do, if you really want to keep the old test, is add the old test in the `TESTS` block (starting with `set_random_seed(0)`).\n\nThis way one could keep the old test.",
    "created_at": "2020-06-26T06:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421894",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>The other thing that one could do, if you really want to keep the old test, is add the old test in the `TESTS` block (starting with `set_random_seed(0)`).

This way one could keep the old test.



---

archive/issue_comments_421895.json:
```json
{
    "body": "<a id='comment:8'></a>I'm not sure if I like explicit `set_random_seed` calls in the doctests because they affect all following doctests in the same block. \n\nI would prefer a solution as proposed in comment 2 above if this can be done easily.",
    "created_at": "2020-06-26T16:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421895",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>I'm not sure if I like explicit `set_random_seed` calls in the doctests because they affect all following doctests in the same block. 

I would prefer a solution as proposed in comment 2 above if this can be done easily.



---

archive/issue_comments_421896.json:
```json
{
    "body": "<a id='comment:9'></a>How will the solution as in comment two work out if all testings are done with random seed. That would basically mean, it is never tested as well.\n\nI know that `set_random_seed(0)` will affect all other tests in the same block. This is why I propsed having it in the tests section (as last thing being run). Than it wouldn't affect anything.",
    "created_at": "2020-06-26T20:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421896",
    "user": "https://github.com/kliem"
}
```

<a id='comment:9'></a>How will the solution as in comment two work out if all testings are done with random seed. That would basically mean, it is never tested as well.

I know that `set_random_seed(0)` will affect all other tests in the same block. This is why I propsed having it in the tests section (as last thing being run). Than it wouldn't affect anything.



---

archive/issue_comments_421897.json:
```json
{
    "body": "<a id='comment:10'></a>How about a Makefile target that runs tests with `random_seed=0`, or maybe a Makefile target that runs tests twice, once with `seed=0` and once with a random seed? Then make sure that people start thinking of that as the new default.\n\nOr as `@`gh-kliem suggests, double up on some doctests:\n\n```\n    sage: test1\n    sage: test2\n\nEnd of test block::\n\n    sage: test1 # random-seed=0\n    sage: test2 # random-seed=0\n```",
    "created_at": "2020-06-26T23:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421897",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>How about a Makefile target that runs tests with `random_seed=0`, or maybe a Makefile target that runs tests twice, once with `seed=0` and once with a random seed? Then make sure that people start thinking of that as the new default.

Or as `@`gh-kliem suggests, double up on some doctests:

```
    sage: test1
    sage: test2

End of test block::

    sage: test1 # random-seed=0
    sage: test2 # random-seed=0
```



---

archive/issue_comments_421898.json:
```json
{
    "body": "<a id='comment:11'></a>I feel like the discussion is on the wrong ticket.\n\nThis ticket is merely about making tests in categories pass with a different random seed than `0`.\n\nIn principal a new flag `random-seed=0` sounds fine, but shouldn't be introduced here. That should be introduced in #29962 I think, or in a seperate follow up ticket that this here is based on.\n\nThe discussion about the big pictures mainly happened on sage-devel and on #29935 so far.\n\nI mean there are 23 tickets like this and we should really come up with a uniform way to do them all. I'm fine with doing those 23 tickets, but if the general set up should be different, I might need some help with #29962 or #29935 (one introduces random seed, one makes them default after 23 tickets made all parts of sage compatible to it).",
    "created_at": "2020-06-27T08:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421898",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'></a>I feel like the discussion is on the wrong ticket.

This ticket is merely about making tests in categories pass with a different random seed than `0`.

In principal a new flag `random-seed=0` sounds fine, but shouldn't be introduced here. That should be introduced in #29962 I think, or in a seperate follow up ticket that this here is based on.

The discussion about the big pictures mainly happened on sage-devel and on #29935 so far.

I mean there are 23 tickets like this and we should really come up with a uniform way to do them all. I'm fine with doing those 23 tickets, but if the general set up should be different, I might need some help with #29962 or #29935 (one introduces random seed, one makes them default after 23 tickets made all parts of sage compatible to it).



---

archive/issue_comments_421899.json:
```json
{
    "body": "<a id='comment:12'></a>I agree, discussing this on sage-devel and #29935 would probably be best.",
    "created_at": "2020-06-27T17:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421899",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>I agree, discussing this on sage-devel and #29935 would probably be best.



---

archive/issue_comments_421900.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-12T18:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421900",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_421901.json:
```json
{
    "body": "<a id='comment:13'></a>Merge conflict.\n\nI also need to go through it again and check I respected the design decision in #29935.",
    "created_at": "2020-07-12T18:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421901",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>Merge conflict.

I also need to go through it again and check I respected the design decision in #29935.



---

archive/issue_comments_421902.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-20T04:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421902",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_421903.json:
```json
{
    "body": "<a id='comment:14'></a>New commits:",
    "created_at": "2020-07-20T04:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421903",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>New commits:



---

archive/issue_comments_421904.json:
```json
{
    "body": "<a id='comment:15'></a>Note that elements of `C = FiniteEnumeratedSets().example()` are not elements of `C`, but integers.",
    "created_at": "2020-07-20T04:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421904",
    "user": "https://github.com/kliem"
}
```

<a id='comment:15'></a>Note that elements of `C = FiniteEnumeratedSets().example()` are not elements of `C`, but integers.



---

archive/issue_comments_421905.json:
```json
{
    "body": "<a id='comment:16'></a>This seems to work.",
    "created_at": "2020-08-13T20:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421905",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:16'></a>This seems to work.



---

archive/issue_comments_421906.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-13T20:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421906",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_421907.json:
```json
{
    "body": "<a id='comment:17'></a>Thank you.",
    "created_at": "2020-08-14T05:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421907",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>Thank you.



---

archive/issue_comments_421908.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-16T22:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29971#issuecomment-421908",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076962.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-16T22:33:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29971",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29971#event-76962"
}
```
