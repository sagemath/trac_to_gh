# Issue 29828: Broken conversion from ZZ['x'] to Qp['y']

archive/issues_029591.json:
```json
{
    "body": "Currently, the following code fails:\n\n```\nsage: R.<x> = PolynomialRing(ZZ)\nsage: f = x^4 - x - 1\nsage: S.<y> = PolynomialRing(Qp(5))\nsage: g2 = S(f)\nsage: g2.factor()\n\nTypeError: 'sage.rings.fraction_field_element.FractionFieldElement_1poly_field' object is not iterable\n```\n\nHowever, the following code works\n\n```\nsage: g = y^4 - y - 1\nsage: g.factor()\n```\nand moreover\n\n```\nsage: g == g2\nTrue\n```\n\nThe cause seems to be the following:\n\n```\nsage: g2._poly\nx^4 - x - 1\n```\n\nTo fix this, we change the line where ._poly is initialized when converting from ZZ[] to Qp[].\n\nCC:  @bhutz @pfili\n\nKeywords: gsoc20\n\nBranch/Commit: 726c83b4c3ea482666d3785c7ebfb78e6fd68384\n\nReviewer: Travis Scrimshaw\n\nAuthor: Alexander Galarraga\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29828\n\n",
    "closed_at": "2020-07-08T19:31:43Z",
    "created_at": "2020-06-08T21:54:54Z",
    "labels": [
        "component: padics",
        "trivial",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Broken conversion from ZZ['x'] to Qp['y']",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29828",
    "user": "https://github.com/EnderWannabe"
}
```
Currently, the following code fails:

```
sage: R.<x> = PolynomialRing(ZZ)
sage: f = x^4 - x - 1
sage: S.<y> = PolynomialRing(Qp(5))
sage: g2 = S(f)
sage: g2.factor()

TypeError: 'sage.rings.fraction_field_element.FractionFieldElement_1poly_field' object is not iterable
```

However, the following code works

```
sage: g = y^4 - y - 1
sage: g.factor()
```
and moreover

```
sage: g == g2
True
```

The cause seems to be the following:

```
sage: g2._poly
x^4 - x - 1
```

To fix this, we change the line where ._poly is initialized when converting from ZZ[] to Qp[].

CC:  @bhutz @pfili

Keywords: gsoc20

Branch/Commit: 726c83b4c3ea482666d3785c7ebfb78e6fd68384

Reviewer: Travis Scrimshaw

Author: Alexander Galarraga

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29828





---

archive/issue_comments_584854.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-EnderWannabe/broken_conversion_from_zz__x___to_qp__y__\"",
    "created_at": "2020-06-08T22:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584854",
    "user": "https://github.com/EnderWannabe"
}
```

Changing branch from "" to "u/gh-EnderWannabe/broken_conversion_from_zz__x___to_qp__y__"



---

archive/issue_comments_584855.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,4 +30,4 @@\n False\n ```\n \n-To fix this, we change how ._poly is initialize when converting from ZZ[] to Qp[].\n+To fix this, we change the line where ._poly is initialized when converting from ZZ[] to Qp[].\n``````\n",
    "created_at": "2020-06-08T22:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584855",
    "user": "https://github.com/EnderWannabe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,4 +30,4 @@
 False
 ```
 
-To fix this, we change how ._poly is initialize when converting from ZZ[] to Qp[].
+To fix this, we change the line where ._poly is initialized when converting from ZZ[] to Qp[].
``````




---

archive/issue_comments_584856.json:
```json
{
    "body": "Changing commit from \"\" to \"d2fd21f41280e5c3aeae934e8df440a3b8dad473\"",
    "created_at": "2020-06-08T22:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584856",
    "user": "https://github.com/EnderWannabe"
}
```

Changing commit from "" to "d2fd21f41280e5c3aeae934e8df440a3b8dad473"



---

archive/issue_comments_584857.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[d2fd21f](https://git.sagemath.org/sage.git/commit?id=d2fd21f41280e5c3aeae934e8df440a3b8dad473)|`Fix for conversion from ZZ[] to Qp[]`|",
    "created_at": "2020-06-08T22:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584857",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[d2fd21f](https://git.sagemath.org/sage.git/commit?id=d2fd21f41280e5c3aeae934e8df440a3b8dad473)|`Fix for conversion from ZZ[] to Qp[]`|



---

archive/issue_comments_584858.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-08T22:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584858",
    "user": "https://github.com/EnderWannabe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_584859.json:
```json
{
    "body": "Changing commit from \"d2fd21f41280e5c3aeae934e8df440a3b8dad473\" to \"12a0454ca0bafefe2fa038bf8af733a6ceb70260\"",
    "created_at": "2020-06-09T01:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d2fd21f41280e5c3aeae934e8df440a3b8dad473" to "12a0454ca0bafefe2fa038bf8af733a6ceb70260"



---

archive/issue_comments_584860.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------|\n|[12a0454](https://git.sagemath.org/sage.git/commit/?id=12a0454ca0bafefe2fa038bf8af733a6ceb70260)|`Better fix`|",
    "created_at": "2020-06-09T01:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[12a0454](https://git.sagemath.org/sage.git/commit/?id=12a0454ca0bafefe2fa038bf8af733a6ceb70260)|`Better fix`|



---

archive/issue_comments_584861.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -26,8 +26,8 @@\n The cause seems to be the following:\n \n ```\n-sage: g._poly == g2._poly\n-False\n+sage: g2._poly\n+x^4 - x - 1\n ```\n \n To fix this, we change the line where ._poly is initialized when converting from ZZ[] to Qp[].\n``````\n",
    "created_at": "2020-06-09T01:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584861",
    "user": "https://github.com/EnderWannabe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -26,8 +26,8 @@
 The cause seems to be the following:
 
 ```
-sage: g._poly == g2._poly
-False
+sage: g2._poly
+x^4 - x - 1
 ```
 
 To fix this, we change the line where ._poly is initialized when converting from ZZ[] to Qp[].
``````




---

archive/issue_comments_584862.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2020-06-09T07:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584862",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_584863.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe fix is good. Just add a doctest showing the issue is fixed and prevent a regression.",
    "created_at": "2020-06-09T07:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584863",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
The fix is good. Just add a doctest showing the issue is fixed and prevent a regression.



---

archive/issue_comments_584864.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[d7975d5](https://git.sagemath.org/sage.git/commit/?id=d7975d52f621ebde29084b462f88f6cc13004b83)|`Added doctest`|",
    "created_at": "2020-06-09T18:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[d7975d5](https://git.sagemath.org/sage.git/commit/?id=d7975d52f621ebde29084b462f88f6cc13004b83)|`Added doctest`|



---

archive/issue_comments_584865.json:
```json
{
    "body": "Changing commit from \"12a0454ca0bafefe2fa038bf8af733a6ceb70260\" to \"d7975d52f621ebde29084b462f88f6cc13004b83\"",
    "created_at": "2020-06-09T18:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "12a0454ca0bafefe2fa038bf8af733a6ceb70260" to "d7975d52f621ebde29084b462f88f6cc13004b83"



---

archive/issue_comments_584866.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [tscrim](#comment%3A5):\n> The fix is good. Just add a doctest showing the issue is fixed and prevent a regression.\n\n\nDoctest added. Tests multiplication since this also breaks without the fix",
    "created_at": "2020-06-09T18:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584866",
    "user": "https://github.com/EnderWannabe"
}
```

<a id='comment:7'></a>
Replying to [tscrim](#comment%3A5):
> The fix is good. Just add a doctest showing the issue is fixed and prevent a regression.


Doctest added. Tests multiplication since this also breaks without the fix



---

archive/issue_comments_584867.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[726c83b](https://git.sagemath.org/sage.git/commit/?id=726c83b4c3ea482666d3785c7ebfb78e6fd68384)|`Better test`|",
    "created_at": "2020-06-09T20:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[726c83b](https://git.sagemath.org/sage.git/commit/?id=726c83b4c3ea482666d3785c7ebfb78e6fd68384)|`Better test`|



---

archive/issue_comments_584868.json:
```json
{
    "body": "Changing commit from \"d7975d52f621ebde29084b462f88f6cc13004b83\" to \"726c83b4c3ea482666d3785c7ebfb78e6fd68384\"",
    "created_at": "2020-06-09T20:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d7975d52f621ebde29084b462f88f6cc13004b83" to "726c83b4c3ea482666d3785c7ebfb78e6fd68384"



---

archive/issue_comments_584869.json:
```json
{
    "body": "<a id='comment:9'></a>\nThank you. LGTM.",
    "created_at": "2020-06-10T00:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584869",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
Thank you. LGTM.



---

archive/issue_comments_584870.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-10T00:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584870",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_584871.json:
```json
{
    "body": "Changing branch from \"u/gh-EnderWannabe/broken_conversion_from_zz__x___to_qp__y__\" to \"726c83b4c3ea482666d3785c7ebfb78e6fd68384\"",
    "created_at": "2020-07-08T19:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584871",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-EnderWannabe/broken_conversion_from_zz__x___to_qp__y__" to "726c83b4c3ea482666d3785c7ebfb78e6fd68384"



---

archive/issue_comments_584872.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T19:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29828#issuecomment-584872",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076396.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-08T19:31:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29828",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29828#event-76396"
}
```
