# Issue 29617: Support system installations of ECL and fix the kenzo SPKG build

archive/issues_029380.json:
```json
{
    "assignees": [],
    "body": "I tried to use ECL and Maxima from system packages as suggested by #27330, but without success for the moment.\n\nThe `spkg-configure.m4` are trivial (see attachments), but the problems occur during build:\n\nIn [dochtml] [manifolds] this error is produced:\n\n```\nRuntimeError: ECL says: The function SET-LOCALE-SUBDIR is undefined\n```\n\nActually this error is reproducible out of the Sage's build mechanism:\n\n```\n$ ecl\n> (require 'maxima)\n> (in-package :maxima)\nMAXIMA> (set-locale-subdir)\nCondition of type: UNDEFINED-FUNCTION\nThe function MAXIMA::SET-LOCALE-SUBDIR is undefined.\n```\n\nAccording to Maxima's code, `set-locale-subdir` is defined in `src/init-cl.lisp` and:\n\n```\n    ;; If a file is declared as private-file it is loaded\n    ;; from the build tree (which makes an out-of-tree\n    ;; build possible), but not compiled (which means\n    ;; that with ECL or ABCL it won't end up in the final image)\n    ;; => no out-of-tree build for ECL.\n```\n\nMaybe someone with Lisp-fu could patch it, if possible?\n\n\nDepends on #31593\n\nCC:  @orlitzky @kiwifb @antonio-rojas @spaghettisalat @tobiasdiez @isuruf @mkoeppe @miguelmarco @jhpalmieri @jcuevas-rozo @slel @vbraun\n\nKeywords: **spkg-configure, ECL, Maxima**\n\nBranch/Commit: **[`5cbe423`](https://github.com/sagemath/sagetrac-mirror/commit/5cbe423253c38535b854a60a349b368b96f6a860)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Thierry Thomas, Dima Pasechnik, Michael Orlitzky**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29617_\n\n",
    "closed_at": "2021-06-20T08:14:47Z",
    "created_at": "2020-04-29T15:37:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Support system installations of ECL and fix the kenzo SPKG build",
    "type": "issue",
    "updated_at": "2021-06-20T08:14:47Z",
    "url": "https://github.com/sagemath/sage/issues/29617",
    "user": "https://github.com/thierry-FreeBSD"
}
```
I tried to use ECL and Maxima from system packages as suggested by #27330, but without success for the moment.

The `spkg-configure.m4` are trivial (see attachments), but the problems occur during build:

In [dochtml] [manifolds] this error is produced:

```
RuntimeError: ECL says: The function SET-LOCALE-SUBDIR is undefined
```

Actually this error is reproducible out of the Sage's build mechanism:

```
$ ecl
> (require 'maxima)
> (in-package :maxima)
MAXIMA> (set-locale-subdir)
Condition of type: UNDEFINED-FUNCTION
The function MAXIMA::SET-LOCALE-SUBDIR is undefined.
```

According to Maxima's code, `set-locale-subdir` is defined in `src/init-cl.lisp` and:

```
    ;; If a file is declared as private-file it is loaded
    ;; from the build tree (which makes an out-of-tree
    ;; build possible), but not compiled (which means
    ;; that with ECL or ABCL it won't end up in the final image)
    ;; => no out-of-tree build for ECL.
```

Maybe someone with Lisp-fu could patch it, if possible?


Depends on #31593

CC:  @orlitzky @kiwifb @antonio-rojas @spaghettisalat @tobiasdiez @isuruf @mkoeppe @miguelmarco @jhpalmieri @jcuevas-rozo @slel @vbraun

Keywords: **spkg-configure, ECL, Maxima**

Branch/Commit: **[`5cbe423`](https://github.com/sagemath/sagetrac-mirror/commit/5cbe423253c38535b854a60a349b368b96f6a860)**

Reviewer: **Matthias Koeppe**

Author: **Thierry Thomas, Dima Pasechnik, Michael Orlitzky**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/29617_





---

archive/issue_events_407439.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-04-29T15:37:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407439"
}
```



---

archive/issue_events_407440.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-04-29T15:37:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407440"
}
```



---

archive/issue_events_407441.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-04-29T15:37:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407441"
}
```



---

archive/issue_events_407442.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-04-29T15:37:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407442"
}
```



---

archive/issue_comments_466215.json:
```json
{
    "body": "To be copied as build/pkgs/ecl/spkg-configure.m4",
    "created_at": "2020-04-29T15:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466215",
    "user": "https://github.com/thierry-FreeBSD"
}
```

To be copied as build/pkgs/ecl/spkg-configure.m4



---

archive/issue_comments_466216.json:
```json
{
    "body": "Attachment: **[ecl_spkg-configure.m4.gz](https://github.com/sagemath/sage/files/ticket29617/ecl_spkg-configure.m4.gz)**\n\nAttachment: **[maxima_spkg-configure.m4.gz](https://github.com/sagemath/sage/files/ticket29617/maxima_spkg-configure.m4.gz)**\n\nTo be copied as build/pkgs/maxima/spkg-configure.m4",
    "created_at": "2020-04-29T15:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466216",
    "user": "https://github.com/thierry-FreeBSD"
}
```

Attachment: **[ecl_spkg-configure.m4.gz](https://github.com/sagemath/sage/files/ticket29617/ecl_spkg-configure.m4.gz)**

Attachment: **[maxima_spkg-configure.m4.gz](https://github.com/sagemath/sage/files/ticket29617/maxima_spkg-configure.m4.gz)**

To be copied as build/pkgs/maxima/spkg-configure.m4



---

archive/issue_comments_466217.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nNote: I also tried to use only ECL from the system packages, and build maxima from Sage, but in this case Maxima fails\n\n- with the default ECLDIR in sage-env the cmp lisp files are not found:\n\n```\necl -norc -eval '(progn (load \"../lisp-utils/defsystem.lisp\") (load \"../lisp-utils/make-depends.lisp\") (funcall (intern \"CREATE-DEPENDENCY-FILE\" :mk) \"binary-ecl/maxima\" \"ecl-depends.mk\") (quit))'\n;;; Loading \"/usr/ports/math/sage/work/stage/usr/local/var/tmp/sage/build/maxima-5.42.2/src/src/../lisp-utils/defsystem.lisp\"\nAn error occurred during initialization:\nFilesystem error with pathname #P\"SYS:CMP.NEWEST\".\n```\n\n- when ECLDIR is patched to the right value, that works, but it fails when it tries to install the maxima library under this directory (unless you are root!).",
    "created_at": "2020-04-29T15:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466217",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<div id="comment:1" align="right">comment:1</div>

Note: I also tried to use only ECL from the system packages, and build maxima from Sage, but in this case Maxima fails

- with the default ECLDIR in sage-env the cmp lisp files are not found:

```
ecl -norc -eval '(progn (load "../lisp-utils/defsystem.lisp") (load "../lisp-utils/make-depends.lisp") (funcall (intern "CREATE-DEPENDENCY-FILE" :mk) "binary-ecl/maxima" "ecl-depends.mk") (quit))'
;;; Loading "/usr/ports/math/sage/work/stage/usr/local/var/tmp/sage/build/maxima-5.42.2/src/src/../lisp-utils/defsystem.lisp"
An error occurred during initialization:
Filesystem error with pathname #P"SYS:CMP.NEWEST".
```

- when ECLDIR is patched to the right value, that works, but it fails when it tries to install the maxima library under this directory (unless you are root!).



---

archive/issue_comments_466218.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI would wait for #22191 before attempting this if I were you. We have a mountain of patches for ecl-16.1.2 that won't be present in any system copy, and ecl-16.1.3 is incompatible with sage (that's why we haven't upgraded to it after so many years). The latest v20.4.24 release is from just a few days ago, though, and with any luck it will work (unpatched) with sage and we can look for v20.4.24 on the system.",
    "created_at": "2020-04-29T16:13:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466218",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:2" align="right">comment:2</div>

I would wait for #22191 before attempting this if I were you. We have a mountain of patches for ecl-16.1.2 that won't be present in any system copy, and ecl-16.1.3 is incompatible with sage (that's why we haven't upgraded to it after so many years). The latest v20.4.24 release is from just a few days ago, though, and with any luck it will work (unpatched) with sage and we can look for v20.4.24 on the system.



---

archive/issue_comments_466219.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOK, in FreeBSD the ECL system package is at 16.1.3!\n\nI did not know that it was incompatible with sage, maybe this is the source of the problem, thanks.",
    "created_at": "2020-04-29T16:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466219",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<div id="comment:3" align="right">comment:3</div>

OK, in FreeBSD the ECL system package is at 16.1.3!

I did not know that it was incompatible with sage, maybe this is the source of the problem, thanks.



---

archive/issue_comments_466220.json:
```json
{
    "body": "Dependencies: **#22191**",
    "created_at": "2020-04-30T13:11:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466220",
    "user": "https://github.com/thierry-FreeBSD"
}
```

Dependencies: **#22191**



---

archive/issue_comments_466221.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNote: applying patches from build/pkgs/ecl/patches and build/pkgs/maxima/patches to the FreeBSD ports,  I have been able to use them as system packages. For ECL 16.1.3, the patches from #22191 are required.",
    "created_at": "2020-05-22T17:03:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466221",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<div id="comment:5" align="right">comment:5</div>

Note: applying patches from build/pkgs/ecl/patches and build/pkgs/maxima/patches to the FreeBSD ports,  I have been able to use them as system packages. For ECL 16.1.3, the patches from #22191 are required.



---

archive/issue_comments_466222.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nperhaps one can get FreeBSD's ECL bumped to v20.4.24 ? Well, we do ship a lot of patches for it in #22191 - but they are all upstream patches.",
    "created_at": "2020-07-31T12:53:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466222",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

perhaps one can get FreeBSD's ECL bumped to v20.4.24 ? Well, we do ship a lot of patches for it in #22191 - but they are all upstream patches.



---

archive/issue_comments_466223.json:
```json
{
    "body": "Changed dependencies from **#22191** to **#28991**",
    "created_at": "2020-08-11T21:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466223",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#22191** to **#28991**



---

archive/issue_comments_466224.json:
```json
{
    "body": "Changed author from **gh-thierry-FreeBSD** to **Thierry Thomas**",
    "created_at": "2020-08-11T21:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466224",
    "user": "https://github.com/dimpase"
}
```

Changed author from **gh-thierry-FreeBSD** to **Thierry Thomas**



---

archive/issue_comments_466225.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05ae4d4666921c9ecee3dbef6a659de4b7f1adb8\">05ae4d4</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>\n",
    "created_at": "2020-09-09T10:17:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466225",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05ae4d4666921c9ecee3dbef6a659de4b7f1adb8">05ae4d4</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>




---

archive/issue_comments_466226.json:
```json
{
    "body": "Changed author from **Thierry Thomas** to **Thierry Thomas, Dima Pasechnik**",
    "created_at": "2020-09-09T10:17:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466226",
    "user": "https://github.com/dimpase"
}
```

Changed author from **Thierry Thomas** to **Thierry Thomas, Dima Pasechnik**



---

archive/issue_comments_466227.json:
```json
{
    "body": "Commit: **[`05ae4d4`](https://github.com/sagemath/sagetrac-mirror/commit/05ae4d4666921c9ecee3dbef6a659de4b7f1adb8)**",
    "created_at": "2020-09-09T10:17:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466227",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`05ae4d4`](https://github.com/sagemath/sagetrac-mirror/commit/05ae4d4666921c9ecee3dbef6a659de4b7f1adb8)**



---

archive/issue_comments_466228.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/eclconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/eclconfig)**",
    "created_at": "2020-09-09T10:17:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466228",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/eclconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/eclconfig)**



---

archive/issue_comments_466229.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIt appears that perhaps Gentoo's `ecl` misses a number of important patches - in particular it can't build `maxima.fas` (some path mixup).",
    "created_at": "2020-09-09T23:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466229",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

It appears that perhaps Gentoo's `ecl` misses a number of important patches - in particular it can't build `maxima.fas` (some path mixup).



---

archive/issue_events_407443.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-09-09T23:04:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407443"
}
```



---

archive/issue_events_407444.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-09-09T23:04:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407444"
}
```



---

archive/issue_comments_466230.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI'm not an ecl maintainer, so we will probably have to wait for the next point release of ecl to address all of the bugs that sage fixes with patches. Afterwards the spkg-configure.m4 should check for a version newer than that patch release.\n\nIf we add this spkg-configure now, we're going to be in a position similar to the one we were in with pari a few months ago. The upstream release is unsuitable, so we need to test for all of the bugs fixed by the custom patches so that we don't accept a distro version that's missing them.",
    "created_at": "2020-09-09T23:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466230",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:11" align="right">comment:11</div>

I'm not an ecl maintainer, so we will probably have to wait for the next point release of ecl to address all of the bugs that sage fixes with patches. Afterwards the spkg-configure.m4 should check for a version newer than that patch release.

If we add this spkg-configure now, we're going to be in a position similar to the one we were in with pari a few months ago. The upstream release is unsuitable, so we need to test for all of the bugs fixed by the custom patches so that we don't accept a distro version that's missing them.



---

archive/issue_comments_466231.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b7c2f6e86986f42cc0b44c69882563929e40bad\">3b7c2f6</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>\n",
    "created_at": "2020-10-08T17:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466231",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b7c2f6e86986f42cc0b44c69882563929e40bad">3b7c2f6</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>




---

archive/issue_comments_466232.json:
```json
{
    "body": "Changed commit from **[`05ae4d4`](https://github.com/sagemath/sagetrac-mirror/commit/05ae4d4666921c9ecee3dbef6a659de4b7f1adb8)** to **[`3b7c2f6`](https://github.com/sagemath/sagetrac-mirror/commit/3b7c2f6e86986f42cc0b44c69882563929e40bad)**",
    "created_at": "2020-10-08T17:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466232",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`05ae4d4`](https://github.com/sagemath/sagetrac-mirror/commit/05ae4d4666921c9ecee3dbef6a659de4b7f1adb8)** to **[`3b7c2f6`](https://github.com/sagemath/sagetrac-mirror/commit/3b7c2f6e86986f42cc0b44c69882563929e40bad)**



---

archive/issue_comments_466233.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/301800f3e0552b5d9e997ff1f4f831ab53d76137\">301800f</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>\n",
    "created_at": "2020-10-08T17:14:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466233",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/301800f3e0552b5d9e997ff1f4f831ab53d76137">301800f</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>




---

archive/issue_comments_466234.json:
```json
{
    "body": "Changed commit from **[`3b7c2f6`](https://github.com/sagemath/sagetrac-mirror/commit/3b7c2f6e86986f42cc0b44c69882563929e40bad)** to **[`301800f`](https://github.com/sagemath/sagetrac-mirror/commit/301800f3e0552b5d9e997ff1f4f831ab53d76137)**",
    "created_at": "2020-10-08T17:14:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466234",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3b7c2f6`](https://github.com/sagemath/sagetrac-mirror/commit/3b7c2f6e86986f42cc0b44c69882563929e40bad)** to **[`301800f`](https://github.com/sagemath/sagetrac-mirror/commit/301800f3e0552b5d9e997ff1f4f831ab53d76137)**



---

archive/issue_comments_466235.json:
```json
{
    "body": "Changed commit from **[`301800f`](https://github.com/sagemath/sagetrac-mirror/commit/301800f3e0552b5d9e997ff1f4f831ab53d76137)** to **[`83b9f9d`](https://github.com/sagemath/sagetrac-mirror/commit/83b9f9df98604504fad0844865aefc5a8f884854)**",
    "created_at": "2020-10-08T17:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466235",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`301800f`](https://github.com/sagemath/sagetrac-mirror/commit/301800f3e0552b5d9e997ff1f4f831ab53d76137)** to **[`83b9f9d`](https://github.com/sagemath/sagetrac-mirror/commit/83b9f9df98604504fad0844865aefc5a8f884854)**



---

archive/issue_comments_466236.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83b9f9df98604504fad0844865aefc5a8f884854\">83b9f9d</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>\n",
    "created_at": "2020-10-08T17:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466236",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83b9f9df98604504fad0844865aefc5a8f884854">83b9f9d</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>




---

archive/issue_comments_466237.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5a4fc0c7bd6db2c511f630c4e25ffcc9e0d6a76\">d5a4fc0</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>\n",
    "created_at": "2020-10-08T18:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466237",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5a4fc0c7bd6db2c511f630c4e25ffcc9e0d6a76">d5a4fc0</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>




---

archive/issue_comments_466238.json:
```json
{
    "body": "Changed commit from **[`83b9f9d`](https://github.com/sagemath/sagetrac-mirror/commit/83b9f9df98604504fad0844865aefc5a8f884854)** to **[`d5a4fc0`](https://github.com/sagemath/sagetrac-mirror/commit/d5a4fc0c7bd6db2c511f630c4e25ffcc9e0d6a76)**",
    "created_at": "2020-10-08T18:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466238",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`83b9f9d`](https://github.com/sagemath/sagetrac-mirror/commit/83b9f9df98604504fad0844865aefc5a8f884854)** to **[`d5a4fc0`](https://github.com/sagemath/sagetrac-mirror/commit/d5a4fc0c7bd6db2c511f630c4e25ffcc9e0d6a76)**



---

archive/issue_comments_466239.json:
```json
{
    "body": "Changed commit from **[`d5a4fc0`](https://github.com/sagemath/sagetrac-mirror/commit/d5a4fc0c7bd6db2c511f630c4e25ffcc9e0d6a76)** to **[`aea5768`](https://github.com/sagemath/sagetrac-mirror/commit/aea576829d9fda9402ca45c28e80d0f154cd96bc)**",
    "created_at": "2020-10-08T18:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466239",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d5a4fc0`](https://github.com/sagemath/sagetrac-mirror/commit/d5a4fc0c7bd6db2c511f630c4e25ffcc9e0d6a76)** to **[`aea5768`](https://github.com/sagemath/sagetrac-mirror/commit/aea576829d9fda9402ca45c28e80d0f154cd96bc)**



---

archive/issue_comments_466240.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aea576829d9fda9402ca45c28e80d0f154cd96bc\">aea5768</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>\n",
    "created_at": "2020-10-08T18:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466240",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aea576829d9fda9402ca45c28e80d0f154cd96bc">aea5768</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>




---

archive/issue_comments_466241.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/341e99ce5cd2e7d7e499c5b94bdb522a9b9d3a09\">341e99c</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>\n",
    "created_at": "2020-10-09T21:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466241",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/341e99ce5cd2e7d7e499c5b94bdb522a9b9d3a09">341e99c</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>




---

archive/issue_comments_466242.json:
```json
{
    "body": "Changed commit from **[`aea5768`](https://github.com/sagemath/sagetrac-mirror/commit/aea576829d9fda9402ca45c28e80d0f154cd96bc)** to **[`341e99c`](https://github.com/sagemath/sagetrac-mirror/commit/341e99ce5cd2e7d7e499c5b94bdb522a9b9d3a09)**",
    "created_at": "2020-10-09T21:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466242",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`aea5768`](https://github.com/sagemath/sagetrac-mirror/commit/aea576829d9fda9402ca45c28e80d0f154cd96bc)** to **[`341e99c`](https://github.com/sagemath/sagetrac-mirror/commit/341e99ce5cd2e7d7e499c5b94bdb522a9b9d3a09)**



---

archive/issue_comments_466243.json:
```json
{
    "body": "Changed dependencies from **#28991** to **#30770**",
    "created_at": "2021-01-13T18:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466243",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#28991** to **#30770**



---

archive/issue_comments_466244.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI've narrowed the ticket to ECL. Dealing with a system maxima can be done on a follow-up ticket.\n\nFollowing up on the discussion in #30770, when using a (sufficiently patched) system ECL, our maxima install script should not attempt to install the FASL in the (typically read only) ECL system directory but rather set the configuration variable `MAXIMA_FAS` to the correct path.",
    "created_at": "2021-01-19T21:29:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466244",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

I've narrowed the ticket to ECL. Dealing with a system maxima can be done on a follow-up ticket.

Following up on the discussion in #30770, when using a (sufficiently patched) system ECL, our maxima install script should not attempt to install the FASL in the (typically read only) ECL system directory but rather set the configuration variable `MAXIMA_FAS` to the correct path.



---

archive/issue_events_407445.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-19T21:29:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "title_is": "spkg-configure.m4 and distros/ information for ecl",
    "title_was": "spkg-configure.m4 for ecl and maxima",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407445"
}
```



---

archive/issue_comments_466245.json:
```json
{
    "body": "Changed dependencies from **#30770** to **#30770, #31114**",
    "created_at": "2021-01-19T21:34:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466245",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30770** to **#30770, #31114**



---

archive/issue_comments_466246.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/eclconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/eclconfig)** to **[u/mkoeppe/packages/eclconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/eclconfig)**",
    "created_at": "2021-01-19T21:43:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466246",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/dimpase/packages/eclconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/eclconfig)** to **[u/mkoeppe/packages/eclconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/eclconfig)**



---

archive/issue_comments_466247.json:
```json
{
    "body": "Changed commit from **[`341e99c`](https://github.com/sagemath/sagetrac-mirror/commit/341e99ce5cd2e7d7e499c5b94bdb522a9b9d3a09)** to **[`271f030`](https://github.com/sagemath/sagetrac-mirror/commit/271f0306274ad27a4e1bf9d4533a8f05d4651f9b)**",
    "created_at": "2021-01-19T21:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466247",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`341e99c`](https://github.com/sagemath/sagetrac-mirror/commit/341e99ce5cd2e7d7e499c5b94bdb522a9b9d3a09)** to **[`271f030`](https://github.com/sagemath/sagetrac-mirror/commit/271f0306274ad27a4e1bf9d4533a8f05d4651f9b)**



---

archive/issue_comments_466248.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/271f0306274ad27a4e1bf9d4533a8f05d4651f9b\">271f030</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>\n",
    "created_at": "2021-01-19T21:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466248",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/271f0306274ad27a4e1bf9d4533a8f05d4651f9b">271f030</a></td><td><code>adding spkg-configure for ecl</code></td></tr></table>




---

archive/issue_comments_466249.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nHow can we detect a sufficiently patched ECL, as is presumably shipped by conda, arch, gentoo, ...?",
    "created_at": "2021-01-19T21:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466249",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

How can we detect a sufficiently patched ECL, as is presumably shipped by conda, arch, gentoo, ...?



---

archive/issue_comments_466250.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6062b219fadf9f695d0196d5a8b39b53e5a28aa\">c6062b2</a></td><td><code>build/pkgs/ecl/distros/arch.txt: New</code></td></tr></table>\n",
    "created_at": "2021-01-19T21:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466250",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6062b219fadf9f695d0196d5a8b39b53e5a28aa">c6062b2</a></td><td><code>build/pkgs/ecl/distros/arch.txt: New</code></td></tr></table>




---

archive/issue_comments_466251.json:
```json
{
    "body": "Changed commit from **[`271f030`](https://github.com/sagemath/sagetrac-mirror/commit/271f0306274ad27a4e1bf9d4533a8f05d4651f9b)** to **[`c6062b2`](https://github.com/sagemath/sagetrac-mirror/commit/c6062b219fadf9f695d0196d5a8b39b53e5a28aa)**",
    "created_at": "2021-01-19T21:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466251",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`271f030`](https://github.com/sagemath/sagetrac-mirror/commit/271f0306274ad27a4e1bf9d4533a8f05d4651f9b)** to **[`c6062b2`](https://github.com/sagemath/sagetrac-mirror/commit/c6062b219fadf9f695d0196d5a8b39b53e5a28aa)**



---

archive/issue_comments_466252.json:
```json
{
    "body": "Changed dependencies from **#30770, #31114** to **#30770, #31114, #31336**",
    "created_at": "2021-02-13T21:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466252",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30770, #31114** to **#30770, #31114, #31336**



---

archive/issue_comments_466253.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nNow that #31336 is in, I don't think we need to detect anything other than the ECL version. If they stick to the new versioning scheme, then the following constant (defined in `/usr/include/ecl/config.h`, here) can probably be checked with a simple integer comparison:\n\n```\n#define ECL_VERSION_NUMBER 210201\n```",
    "created_at": "2021-03-16T16:05:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466253",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:26" align="right">comment:26</div>

Now that #31336 is in, I don't think we need to detect anything other than the ECL version. If they stick to the new versioning scheme, then the following constant (defined in `/usr/include/ecl/config.h`, here) can probably be checked with a simple integer comparison:

```
#define ECL_VERSION_NUMBER 210201
```



---

archive/issue_comments_466254.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n+1",
    "created_at": "2021-03-16T17:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466254",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

+1



---

archive/issue_events_407446.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-03-16T19:22:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407446"
}
```



---

archive/issue_comments_466255.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/packages/eclconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/eclconfig)** to **[u/mjo/ticket/29617](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29617)**",
    "created_at": "2021-03-16T19:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466255",
    "user": "https://github.com/orlitzky"
}
```

Changed branch from **[u/mkoeppe/packages/eclconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/eclconfig)** to **[u/mjo/ticket/29617](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29617)**



---

archive/issue_comments_466256.json:
```json
{
    "body": "Changed author from **Thierry Thomas, Dima Pasechnik** to **Thierry Thomas, Dima Pasechnik, Michael Orlitzky**",
    "created_at": "2021-03-16T19:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466256",
    "user": "https://github.com/orlitzky"
}
```

Changed author from **Thierry Thomas, Dima Pasechnik** to **Thierry Thomas, Dima Pasechnik, Michael Orlitzky**



---

archive/issue_comments_466257.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThis rejects ecl-16.1.3 and accepts ecl-21.2.1 on Gentoo. I'm still waiting on the build to finish to see if it works, though.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1a83e47779c40f24c2720eccbd13e56a79bc9c9\">c1a83e4</a></td><td><code>Trac #29617: check for ecl-config instead of ecl.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec26807e77bc1722ba249aa46b7e5a30fe1b5ea4\">ec26807</a></td><td><code>Trac #29617: compile a check for ECL_VERSION_NUMBER.</code></td></tr></table>\n",
    "created_at": "2021-03-16T19:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466257",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:28" align="right">comment:28</div>

This rejects ecl-16.1.3 and accepts ecl-21.2.1 on Gentoo. I'm still waiting on the build to finish to see if it works, though.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1a83e47779c40f24c2720eccbd13e56a79bc9c9">c1a83e4</a></td><td><code>Trac #29617: check for ecl-config instead of ecl.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec26807e77bc1722ba249aa46b7e5a30fe1b5ea4">ec26807</a></td><td><code>Trac #29617: compile a check for ECL_VERSION_NUMBER.</code></td></tr></table>




---

archive/issue_comments_466258.json:
```json
{
    "body": "Changed commit from **[`c6062b2`](https://github.com/sagemath/sagetrac-mirror/commit/c6062b219fadf9f695d0196d5a8b39b53e5a28aa)** to **[`ec26807`](https://github.com/sagemath/sagetrac-mirror/commit/ec26807e77bc1722ba249aa46b7e5a30fe1b5ea4)**",
    "created_at": "2021-03-16T19:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466258",
    "user": "https://github.com/orlitzky"
}
```

Changed commit from **[`c6062b2`](https://github.com/sagemath/sagetrac-mirror/commit/c6062b219fadf9f695d0196d5a8b39b53e5a28aa)** to **[`ec26807`](https://github.com/sagemath/sagetrac-mirror/commit/ec26807e77bc1722ba249aa46b7e5a30fe1b5ea4)**



---

archive/issue_comments_466259.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nmaxima install script needs adjustment, see comment 19",
    "created_at": "2021-03-16T19:24:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466259",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

maxima install script needs adjustment, see comment 19



---

archive/issue_comments_466260.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIn sage-on-gentoo it works fine but the following doctest failure appeared\n\n```\nsage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/interfaces/tests.py\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/interfaces/tests.py\", line 34, in sage.interfaces.tests\nFailed example:\n    subprocess.call(\"echo syntax error | ecl\", **kwds) in (0, 255)\nExpected:\n    True\nGot:\n    False\n```\nNot sure if it is because of any other aspect of sage-on-gentoo/Gentoo or the lone patch in vanilla sage.",
    "created_at": "2021-03-16T20:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466260",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">comment:30</div>

In sage-on-gentoo it works fine but the following doctest failure appeared

```
sage -t --long --random-seed=0 /usr/lib/python3.9/site-packages/sage/interfaces/tests.py
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/interfaces/tests.py", line 34, in sage.interfaces.tests
Failed example:
    subprocess.call("echo syntax error | ecl", **kwds) in (0, 255)
Expected:
    True
Got:
    False
```
Not sure if it is because of any other aspect of sage-on-gentoo/Gentoo or the lone patch in vanilla sage.



---

archive/issue_events_407447.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-16T20:44:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407447"
}
```



---

archive/issue_events_407448.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-16T20:44:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407448"
}
```



---

archive/issue_comments_466261.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@kiwifb](#comment:30):\n> In sage-on-gentoo it works fine but the following doctest failure appeared\n> ...\n> Not sure if it is because of any other aspect of sage-on-gentoo/Gentoo or the lone patch in vanilla sage.\n\nThat's from the missing patch. When stderr is /dev/full, ecl used to go into an infinite loop. That particular problem is fixed, but the test in question actually goes a bit further and checks what happens if both stdout and stderr are full. In short: it segfaults. I reported this upstream a few hours ago not realizing we had a test for it: https://gitlab.com/embeddable-common-lisp/ecl/-/issues/634\n\nI'd rather not add 139 (segault) to the list of allowed return codes there... so maybe we should make the ECL test weaker for the time being? The patch that sage carries is no longer being considered upstream anywhere.",
    "created_at": "2021-03-16T20:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466261",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@kiwifb](#comment:30):
> In sage-on-gentoo it works fine but the following doctest failure appeared
> ...
> Not sure if it is because of any other aspect of sage-on-gentoo/Gentoo or the lone patch in vanilla sage.

That's from the missing patch. When stderr is /dev/full, ecl used to go into an infinite loop. That particular problem is fixed, but the test in question actually goes a bit further and checks what happens if both stdout and stderr are full. In short: it segfaults. I reported this upstream a few hours ago not realizing we had a test for it: https://gitlab.com/embeddable-common-lisp/ecl/-/issues/634

I'd rather not add 139 (segault) to the list of allowed return codes there... so maybe we should make the ECL test weaker for the time being? The patch that sage carries is no longer being considered upstream anywhere.



---

archive/issue_comments_466262.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e259fc9374259cffb6321b906bcdb061c1b6dd0\">7e259fc</a></td><td><code>build/pkgs/ecl: Add more to distros/</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88d1ea5cf0eaf6e81874cf15b1480fa8680f5777\">88d1ea5</a></td><td><code>adding spkg-configure for ecl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04c4412971c8596abb8f08cd3d0985ae47102b16\">04c4412</a></td><td><code>build/pkgs/ecl/distros/arch.txt: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3824393ad5386b4a6f0e43ab3d44848024c5d1a3\">3824393</a></td><td><code>Trac #29617: check for ecl-config instead of ecl.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30f5f15e17dba15ba91d35f4081cc736e32eb3f0\">30f5f15</a></td><td><code>Trac #29617: compile a check for ECL_VERSION_NUMBER.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dde89cf5daab753bf789f1642c3b3759f9720d1f\">dde89cf</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1dcda9d4d2dcf791d30b8b34b4237c32740b8e3a\">1dcda9d</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr></table>\n",
    "created_at": "2021-03-17T13:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466262",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e259fc9374259cffb6321b906bcdb061c1b6dd0">7e259fc</a></td><td><code>build/pkgs/ecl: Add more to distros/</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88d1ea5cf0eaf6e81874cf15b1480fa8680f5777">88d1ea5</a></td><td><code>adding spkg-configure for ecl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04c4412971c8596abb8f08cd3d0985ae47102b16">04c4412</a></td><td><code>build/pkgs/ecl/distros/arch.txt: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3824393ad5386b4a6f0e43ab3d44848024c5d1a3">3824393</a></td><td><code>Trac #29617: check for ecl-config instead of ecl.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30f5f15e17dba15ba91d35f4081cc736e32eb3f0">30f5f15</a></td><td><code>Trac #29617: compile a check for ECL_VERSION_NUMBER.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dde89cf5daab753bf789f1642c3b3759f9720d1f">dde89cf</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1dcda9d4d2dcf791d30b8b34b4237c32740b8e3a">1dcda9d</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr></table>




---

archive/issue_comments_466263.json:
```json
{
    "body": "Changed commit from **[`ec26807`](https://github.com/sagemath/sagetrac-mirror/commit/ec26807e77bc1722ba249aa46b7e5a30fe1b5ea4)** to **[`1dcda9d`](https://github.com/sagemath/sagetrac-mirror/commit/1dcda9d4d2dcf791d30b8b34b4237c32740b8e3a)**",
    "created_at": "2021-03-17T13:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466263",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ec26807`](https://github.com/sagemath/sagetrac-mirror/commit/ec26807e77bc1722ba249aa46b7e5a30fe1b5ea4)** to **[`1dcda9d`](https://github.com/sagemath/sagetrac-mirror/commit/1dcda9d4d2dcf791d30b8b34b4237c32740b8e3a)**



---

archive/issue_comments_466264.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nWhat's the correct way to substitute a `$SAGE_LOCAL` path into `sage_conf.py.in` at build time? The \"substitute ecl-config path into sage_conf\" commit is currently broken with the SPKG because I don't know what to put in there. It works with the system copy though.",
    "created_at": "2021-03-17T13:13:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466264",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:34" align="right">comment:34</div>

What's the correct way to substitute a `$SAGE_LOCAL` path into `sage_conf.py.in` at build time? The "substitute ecl-config path into sage_conf" commit is currently broken with the SPKG because I don't know what to put in there. It works with the system copy though.



---

archive/issue_comments_466265.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@orlitzky](#comment:34):\n> What's the correct way to substitute a `$SAGE_LOCAL` path into `sage_conf.py.in` at build time? \n\nOK to just use `ecl-config` without path, as we may assume that `SAGE_LOCAL/bin` is near the front of the PATH.",
    "created_at": "2021-03-17T14:42:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466265",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@orlitzky](#comment:34):
> What's the correct way to substitute a `$SAGE_LOCAL` path into `sage_conf.py.in` at build time? 

OK to just use `ecl-config` without path, as we may assume that `SAGE_LOCAL/bin` is near the front of the PATH.



---

archive/issue_comments_466266.json:
```json
{
    "body": "Changed dependencies from **#30770, #31114, #31336** to none",
    "created_at": "2021-03-20T00:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466266",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30770, #31114, #31336** to none



---

archive/issue_comments_466267.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb42c4b32c620653a9a916e970e27a37c270ce7a\">fb42c4b</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c77e315ce0566f5602b426c8c12115cf64dc21d\">3c77e31</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr></table>\n",
    "created_at": "2021-03-20T22:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466267",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb42c4b32c620653a9a916e970e27a37c270ce7a">fb42c4b</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c77e315ce0566f5602b426c8c12115cf64dc21d">3c77e31</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr></table>




---

archive/issue_comments_466268.json:
```json
{
    "body": "Changed commit from **[`1dcda9d`](https://github.com/sagemath/sagetrac-mirror/commit/1dcda9d4d2dcf791d30b8b34b4237c32740b8e3a)** to **[`3c77e31`](https://github.com/sagemath/sagetrac-mirror/commit/3c77e315ce0566f5602b426c8c12115cf64dc21d)**",
    "created_at": "2021-03-20T22:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466268",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1dcda9d`](https://github.com/sagemath/sagetrac-mirror/commit/1dcda9d4d2dcf791d30b8b34b4237c32740b8e3a)** to **[`3c77e31`](https://github.com/sagemath/sagetrac-mirror/commit/3c77e315ce0566f5602b426c8c12115cf64dc21d)**



---

archive/issue_comments_466269.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOk, that worked.\n\nWe still need the maxima fix from [comment:19](#comment:19). And I guess we should check the other packages (kenzo, fricas) that depend on ecl as well.",
    "created_at": "2021-03-20T22:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466269",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:38" align="right">comment:38</div>

Ok, that worked.

We still need the maxima fix from [comment:19](#comment:19). And I guess we should check the other packages (kenzo, fricas) that depend on ecl as well.



---

archive/issue_comments_466270.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfcf56dbdce12f83943c4c1d16466e21b1d1b085\">cfcf56d</a></td><td><code>Trac #29617: don't set ECLDIR in sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b923e33cefe4e9b0ee16faefe5103ab2646c14c8\">b923e33</a></td><td><code>Trac #29617: move MAXIMA_FAS variable into sage_conf.</code></td></tr></table>\n",
    "created_at": "2021-03-22T17:49:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466270",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfcf56dbdce12f83943c4c1d16466e21b1d1b085">cfcf56d</a></td><td><code>Trac #29617: don't set ECLDIR in sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b923e33cefe4e9b0ee16faefe5103ab2646c14c8">b923e33</a></td><td><code>Trac #29617: move MAXIMA_FAS variable into sage_conf.</code></td></tr></table>




---

archive/issue_comments_466271.json:
```json
{
    "body": "Changed commit from **[`3c77e31`](https://github.com/sagemath/sagetrac-mirror/commit/3c77e315ce0566f5602b426c8c12115cf64dc21d)** to **[`b923e33`](https://github.com/sagemath/sagetrac-mirror/commit/b923e33cefe4e9b0ee16faefe5103ab2646c14c8)**",
    "created_at": "2021-03-22T17:49:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466271",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3c77e31`](https://github.com/sagemath/sagetrac-mirror/commit/3c77e315ce0566f5602b426c8c12115cf64dc21d)** to **[`b923e33`](https://github.com/sagemath/sagetrac-mirror/commit/b923e33cefe4e9b0ee16faefe5103ab2646c14c8)**



---

archive/issue_comments_466272.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@mkoeppe](#comment:35):\n> Replying to [@orlitzky](#comment:34):\n> > What's the correct way to substitute a `$SAGE_LOCAL` path into `sage_conf.py.in` at build time? \n\n> OK to just use `ecl-config` without path, as we may assume that `SAGE_LOCAL/bin` is near the front of the PATH.\n\nI ran into the same problem with `MAXIMA_FAS`, which should default to the `SAGE_LOCAL` path where the Maxima SPKG installs it.\n\nI've worked around this in the latest commit but it's pretty ugly. I made the SPKG location the default again, undoing part of #26100. That works because `SAGE_LOCAL` is available in `env.py`.\n\nBut there are two other things you might want to set `MAXIMA_FAS` to: an unusual but correct path, and \"no path.\" Setting it to the correct path is easy, but now \"no path\" is achieved by setting `MAXIMA_FAS = <junk>` in sage_conf, and counting on the fallback in `maxima_lib.py`.\n\nI'm certainly open to other ideas. If we decide to keep the workaround, @antonio-rojas in particular should make sure I didn't mess anything up too badly for distro packages.\n\nThis passes tests with my system ECL and SPKG maxima on Gentoo.",
    "created_at": "2021-03-22T17:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466272",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@mkoeppe](#comment:35):
> Replying to [@orlitzky](#comment:34):
> > What's the correct way to substitute a `$SAGE_LOCAL` path into `sage_conf.py.in` at build time? 

> OK to just use `ecl-config` without path, as we may assume that `SAGE_LOCAL/bin` is near the front of the PATH.

I ran into the same problem with `MAXIMA_FAS`, which should default to the `SAGE_LOCAL` path where the Maxima SPKG installs it.

I've worked around this in the latest commit but it's pretty ugly. I made the SPKG location the default again, undoing part of #26100. That works because `SAGE_LOCAL` is available in `env.py`.

But there are two other things you might want to set `MAXIMA_FAS` to: an unusual but correct path, and "no path." Setting it to the correct path is easy, but now "no path" is achieved by setting `MAXIMA_FAS = <junk>` in sage_conf, and counting on the fallback in `maxima_lib.py`.

I'm certainly open to other ideas. If we decide to keep the workaround, @antonio-rojas in particular should make sure I didn't mess anything up too badly for distro packages.

This passes tests with my system ECL and SPKG maxima on Gentoo.



---

archive/issue_comments_466273.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@orlitzky](#comment:40):\n \n> I'm certainly open to other ideas. If we decide to keep the workaround, @antonio-rojas in particular should make sure I didn't mess anything up too badly for distro packages.\n\nHi,\n Looks good as far as the Arch distro package is concerned. `ecl_eval(\"(require 'maxima \\\"{}\\\")\".format(MAXIMA_FAS))` fails because the ecl modules are in the default upstream path `/usr/lib/ecl-${version}`, but then `ecl_eval(\"(require 'maxima)\")` succeeds.",
    "created_at": "2021-03-22T18:18:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466273",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@orlitzky](#comment:40):
 
> I'm certainly open to other ideas. If we decide to keep the workaround, @antonio-rojas in particular should make sure I didn't mess anything up too badly for distro packages.

Hi,
 Looks good as far as the Arch distro package is concerned. `ecl_eval("(require 'maxima \"{}\")".format(MAXIMA_FAS))` fails because the ecl modules are in the default upstream path `/usr/lib/ecl-${version}`, but then `ecl_eval("(require 'maxima)")` succeeds.



---

archive/issue_comments_466274.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nthis works on my Gentoo box, with system's ECL, too.",
    "created_at": "2021-03-24T18:22:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466274",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

this works on my Gentoo box, with system's ECL, too.



---

archive/issue_comments_466275.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nMatthias, as a Lisp guru, what's your opinion on this? Maybe it all may be fixed on Lisp level?",
    "created_at": "2021-03-31T11:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466275",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:43" align="right">comment:43</div>

Matthias, as a Lisp guru, what's your opinion on this? Maybe it all may be fixed on Lisp level?



---

archive/issue_events_407449.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-03-31T11:35:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407449"
}
```



---

archive/issue_events_407450.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-03-31T11:35:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407450"
}
```



---

archive/issue_comments_466276.json:
```json
{
    "body": "Work Issues: **fix kenzo SPKG with system ECL**",
    "created_at": "2021-03-31T11:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466276",
    "user": "https://github.com/orlitzky"
}
```

Work Issues: **fix kenzo SPKG with system ECL**



---

archive/issue_comments_466277.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI would think (hope) that the current solution is more complicated than needed.\n\nDistributions are able to install maxima in a way that a simple `(REQUIRE :MAXIMA)` works in ecl.\n(Note that this is not just a search for a `maxima.fasl` but rather goes through `EXT:*MODULE-PROVIDER-FUNCTIONS*` into which system definition facilities such as MK:DEFSYSTEM or ASDF hook.)\n\nIf the Sage distribution has to install maxima, then we install the FASL in a custom directory and set the variable `MAXIMA_FAS` to the correct value in `sage_conf`. No defaults should be set in `env.py`.\n\nInstead of the `try`/`except` in `maxima_lib.py`, just dispatch on empty/nonempty value of `MAXIMA_FAS`.",
    "created_at": "2021-03-31T18:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466277",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

I would think (hope) that the current solution is more complicated than needed.

Distributions are able to install maxima in a way that a simple `(REQUIRE :MAXIMA)` works in ecl.
(Note that this is not just a search for a `maxima.fasl` but rather goes through `EXT:*MODULE-PROVIDER-FUNCTIONS*` into which system definition facilities such as MK:DEFSYSTEM or ASDF hook.)

If the Sage distribution has to install maxima, then we install the FASL in a custom directory and set the variable `MAXIMA_FAS` to the correct value in `sage_conf`. No defaults should be set in `env.py`.

Instead of the `try`/`except` in `maxima_lib.py`, just dispatch on empty/nonempty value of `MAXIMA_FAS`.



---

archive/issue_comments_466278.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@mkoeppe](#comment:45):\n> If the Sage distribution has to install maxima, then we install the FASL in a custom directory and set the variable `MAXIMA_FAS` to the correct value in `sage_conf`. No defaults should be set in `env.py`.\n> \n> Instead of the `try`/`except` in `maxima_lib.py`, just dispatch on empty/nonempty value of `MAXIMA_FAS`.\n\nThis was the first thing I tried, but I ran into the same problem as in [comment:34](#comment:34). With no (?) way to substitute `$SAGE_LOCAL` at `./configure`-time, I made the `$SAGE_LOCAL` location the default at runtime instead. That way you can effectively point `MAXIMA_FAS` at `SAGE_LOCAL` by leaving it undefined.\n\nPretty much all of the extra complexity comes from that. If there's a way to get `$SAGE_LOCAL` into `MAXIMA_FAS` at `./configure`-time, I can make this branch a lot simpler.",
    "created_at": "2021-04-01T00:44:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466278",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@mkoeppe](#comment:45):
> If the Sage distribution has to install maxima, then we install the FASL in a custom directory and set the variable `MAXIMA_FAS` to the correct value in `sage_conf`. No defaults should be set in `env.py`.
> 
> Instead of the `try`/`except` in `maxima_lib.py`, just dispatch on empty/nonempty value of `MAXIMA_FAS`.

This was the first thing I tried, but I ran into the same problem as in [comment:34](#comment:34). With no (?) way to substitute `$SAGE_LOCAL` at `./configure`-time, I made the `$SAGE_LOCAL` location the default at runtime instead. That way you can effectively point `MAXIMA_FAS` at `SAGE_LOCAL` by leaving it undefined.

Pretty much all of the extra complexity comes from that. If there's a way to get `$SAGE_LOCAL` into `MAXIMA_FAS` at `./configure`-time, I can make this branch a lot simpler.



---

archive/issue_comments_466279.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nOK, thanks for the explanation, I had forgotten about this issue.\n\nI'll work on a general solution for this problem.",
    "created_at": "2021-04-01T19:10:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466279",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

OK, thanks for the explanation, I had forgotten about this issue.

I'll work on a general solution for this problem.



---

archive/issue_comments_466280.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\n... see #31593.",
    "created_at": "2021-04-01T22:10:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466280",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">comment:48</div>

... see #31593.



---

archive/issue_comments_466281.json:
```json
{
    "body": "Changed commit from **[`b923e33`](https://github.com/sagemath/sagetrac-mirror/commit/b923e33cefe4e9b0ee16faefe5103ab2646c14c8)** to **[`9f1afba`](https://github.com/sagemath/sagetrac-mirror/commit/9f1afba16f69b7e6ded12e064786fb7e4c9c155a)**",
    "created_at": "2021-04-02T13:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466281",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b923e33`](https://github.com/sagemath/sagetrac-mirror/commit/b923e33cefe4e9b0ee16faefe5103ab2646c14c8)** to **[`9f1afba`](https://github.com/sagemath/sagetrac-mirror/commit/9f1afba16f69b7e6ded12e064786fb7e4c9c155a)**



---

archive/issue_comments_466282.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfad5c9c7b64cb8ea10adfc987a1ca7e61de2d4c\">dfad5c9</a></td><td><code>adding spkg-configure for ecl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2561f33801e3c62693720dd5d85e3b4c6b42fa1\">d2561f3</a></td><td><code>build/pkgs/ecl/distros/arch.txt: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94e69413a2733fda33b0e0245ceb77371dc3ff6f\">94e6941</a></td><td><code>Trac #29617: check for ecl-config instead of ecl.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d69775ae65ee51cd410c20af11c6af1690474ca5\">d69775a</a></td><td><code>Trac #29617: compile a check for ECL_VERSION_NUMBER.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fddcc0c248227e847e368199b4f37290b560a06d\">fddcc0c</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e562adc9348b5da9f9dba6f73b9227b092508d78\">e562adc</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb1b8ca7c5ac7544bcaa785dd31373ebce927c57\">fb1b8ca</a></td><td><code>Trac #29617: don't set ECLDIR in sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/835cfc02ffb9f83023c60620dbd275c3c0f65798\">835cfc0</a></td><td><code>Trac #29617: move MAXIMA_FAS to sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e3a721be7753efa65124eae785b41aef9cb77c6\">7e3a721</a></td><td><code>Trac #29617: modify Kenzo interface to support system ECL.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f1afba16f69b7e6ded12e064786fb7e4c9c155a\">9f1afba</a></td><td><code>Trac #29617: fix kenzo SPKG build.</code></td></tr></table>\n",
    "created_at": "2021-04-02T13:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466282",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfad5c9c7b64cb8ea10adfc987a1ca7e61de2d4c">dfad5c9</a></td><td><code>adding spkg-configure for ecl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2561f33801e3c62693720dd5d85e3b4c6b42fa1">d2561f3</a></td><td><code>build/pkgs/ecl/distros/arch.txt: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94e69413a2733fda33b0e0245ceb77371dc3ff6f">94e6941</a></td><td><code>Trac #29617: check for ecl-config instead of ecl.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d69775ae65ee51cd410c20af11c6af1690474ca5">d69775a</a></td><td><code>Trac #29617: compile a check for ECL_VERSION_NUMBER.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fddcc0c248227e847e368199b4f37290b560a06d">fddcc0c</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e562adc9348b5da9f9dba6f73b9227b092508d78">e562adc</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb1b8ca7c5ac7544bcaa785dd31373ebce927c57">fb1b8ca</a></td><td><code>Trac #29617: don't set ECLDIR in sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/835cfc02ffb9f83023c60620dbd275c3c0f65798">835cfc0</a></td><td><code>Trac #29617: move MAXIMA_FAS to sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e3a721be7753efa65124eae785b41aef9cb77c6">7e3a721</a></td><td><code>Trac #29617: modify Kenzo interface to support system ECL.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f1afba16f69b7e6ded12e064786fb7e4c9c155a">9f1afba</a></td><td><code>Trac #29617: fix kenzo SPKG build.</code></td></tr></table>




---

archive/issue_comments_466283.json:
```json
{
    "body": "Changed work issues from **fix kenzo SPKG with system ECL** to none",
    "created_at": "2021-04-02T13:15:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466283",
    "user": "https://github.com/orlitzky"
}
```

Changed work issues from **fix kenzo SPKG with system ECL** to none



---

archive/issue_events_407451.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:15:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407451"
}
```



---

archive/issue_events_407452.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T13:15:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407452"
}
```



---

archive/issue_comments_466284.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nLooks a lot better now, just needs testing.",
    "created_at": "2021-04-02T13:15:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466284",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:50" align="right">comment:50</div>

Looks a lot better now, just needs testing.



---

archive/issue_comments_466285.json:
```json
{
    "body": "Dependencies: **#31593**",
    "created_at": "2021-04-02T16:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466285",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31593**



---

archive/issue_comments_466286.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI would suggest to change the lines\n\n```\n            if KENZO_FAS is not None:\n            if MAXIMA_FAS is not None:\n```\nto `if not KENZO_FAS` etc. so that it makes no difference whether these variables are undefined in `sage_conf.py` or defined as the empty string.",
    "created_at": "2021-04-02T16:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466286",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:52" align="right">comment:52</div>

I would suggest to change the lines

```
            if KENZO_FAS is not None:
            if MAXIMA_FAS is not None:
```
to `if not KENZO_FAS` etc. so that it makes no difference whether these variables are undefined in `sage_conf.py` or defined as the empty string.



---

archive/issue_comments_466287.json:
```json
{
    "body": "<div id=\"comment:53\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4aeb5358bfcd657d3ba91c8ae45d53300fbe820f\">4aeb535</a></td><td><code>Trac #29617: treat empty MAXIMA_FAS and KENZO_FAS as None.</code></td></tr></table>\n",
    "created_at": "2021-04-02T19:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466287",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4aeb5358bfcd657d3ba91c8ae45d53300fbe820f">4aeb535</a></td><td><code>Trac #29617: treat empty MAXIMA_FAS and KENZO_FAS as None.</code></td></tr></table>




---

archive/issue_comments_466288.json:
```json
{
    "body": "Changed commit from **[`9f1afba`](https://github.com/sagemath/sagetrac-mirror/commit/9f1afba16f69b7e6ded12e064786fb7e4c9c155a)** to **[`4aeb535`](https://github.com/sagemath/sagetrac-mirror/commit/4aeb5358bfcd657d3ba91c8ae45d53300fbe820f)**",
    "created_at": "2021-04-02T19:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466288",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9f1afba`](https://github.com/sagemath/sagetrac-mirror/commit/9f1afba16f69b7e6ded12e064786fb7e4c9c155a)** to **[`4aeb535`](https://github.com/sagemath/sagetrac-mirror/commit/4aeb5358bfcd657d3ba91c8ae45d53300fbe820f)**



---

archive/issue_comments_466289.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\n\n```\n+    # assumes that $SAGE_LOCAL/bin is somewhere near\n+    # the beginning of the user's PATH\n+    AC_SUBST(SAGE_ECL_CONFIG, ['${prefix}'/bin/ecl-config])\n```\nthis comment is no longer true and should be removed",
    "created_at": "2021-04-02T19:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466289",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>


```
+    # assumes that $SAGE_LOCAL/bin is somewhere near
+    # the beginning of the user's PATH
+    AC_SUBST(SAGE_ECL_CONFIG, ['${prefix}'/bin/ecl-config])
```
this comment is no longer true and should be removed



---

archive/issue_comments_466290.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\n\n```\n+    from sage.env import KENZO_FAS\n+    if not KENZO_FAS:\n+        ecl_eval(\"(require :kenzo \\\"{}\\\")\".format(KENZO_FAS))\n+    else:\n+        ecl_eval(\"(require :kenzo)\")\n```\nI think this one is backwards",
    "created_at": "2021-04-02T19:27:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466290",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>


```
+    from sage.env import KENZO_FAS
+    if not KENZO_FAS:
+        ecl_eval("(require :kenzo \"{}\")".format(KENZO_FAS))
+    else:
+        ecl_eval("(require :kenzo)")
```
I think this one is backwards



---

archive/issue_comments_466291.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\n\n```\necl_eval(\"(setf *load-verbose* NIL)\")\n-if MAXIMA_FAS is not None:\n+if not MAXIMA_FAS:\n     ecl_eval(\"(require 'maxima \\\"{}\\\")\".format(MAXIMA_FAS))\n```\nthis one too",
    "created_at": "2021-04-02T19:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466291",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:56" align="right">comment:56</div>


```
ecl_eval("(setf *load-verbose* NIL)")
-if MAXIMA_FAS is not None:
+if not MAXIMA_FAS:
     ecl_eval("(require 'maxima \"{}\")".format(MAXIMA_FAS))
```
this one too



---

archive/issue_comments_466292.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nCould you add some comments regarding the \"fasb\" business for Kenzo?",
    "created_at": "2021-04-02T19:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466292",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">comment:57</div>

Could you add some comments regarding the "fasb" business for Kenzo?



---

archive/issue_comments_466293.json:
```json
{
    "body": "Changed commit from **[`4aeb535`](https://github.com/sagemath/sagetrac-mirror/commit/4aeb5358bfcd657d3ba91c8ae45d53300fbe820f)** to **[`1615691`](https://github.com/sagemath/sagetrac-mirror/commit/161569159089bde2516bebd5f99b3b25c562ad6b)**",
    "created_at": "2021-04-02T19:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466293",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4aeb535`](https://github.com/sagemath/sagetrac-mirror/commit/4aeb5358bfcd657d3ba91c8ae45d53300fbe820f)** to **[`1615691`](https://github.com/sagemath/sagetrac-mirror/commit/161569159089bde2516bebd5f99b3b25c562ad6b)**



---

archive/issue_comments_466294.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/677cd2221526d9ab4fcadc88d3575030cddfdd89\">677cd22</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe77e5ec22fc875da6941d73caeb9b9e82b6104b\">fe77e5e</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db002e708521eea449a18edc6cf9c09831a95753\">db002e7</a></td><td><code>Trac #29617: don't set ECLDIR in sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd04a8c198542863d5ba69da562f79afedf2f63a\">cd04a8c</a></td><td><code>Trac #29617: move MAXIMA_FAS to sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/482ad993ee2224b505814f1edd5063f4476999c7\">482ad99</a></td><td><code>Trac #29617: modify Kenzo interface to support system ECL.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/683abb9251a945979ab3e7b64695b5ac1115916c\">683abb9</a></td><td><code>Trac #29617: fix kenzo SPKG build.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/161569159089bde2516bebd5f99b3b25c562ad6b\">1615691</a></td><td><code>Trac #29617: treat empty MAXIMA_FAS and KENZO_FAS as None.</code></td></tr></table>\n",
    "created_at": "2021-04-02T19:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466294",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/677cd2221526d9ab4fcadc88d3575030cddfdd89">677cd22</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe77e5ec22fc875da6941d73caeb9b9e82b6104b">fe77e5e</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db002e708521eea449a18edc6cf9c09831a95753">db002e7</a></td><td><code>Trac #29617: don't set ECLDIR in sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd04a8c198542863d5ba69da562f79afedf2f63a">cd04a8c</a></td><td><code>Trac #29617: move MAXIMA_FAS to sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/482ad993ee2224b505814f1edd5063f4476999c7">482ad99</a></td><td><code>Trac #29617: modify Kenzo interface to support system ECL.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/683abb9251a945979ab3e7b64695b5ac1115916c">683abb9</a></td><td><code>Trac #29617: fix kenzo SPKG build.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/161569159089bde2516bebd5f99b3b25c562ad6b">1615691</a></td><td><code>Trac #29617: treat empty MAXIMA_FAS and KENZO_FAS as None.</code></td></tr></table>




---

archive/issue_comments_466295.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nSure, all done.",
    "created_at": "2021-04-02T19:52:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466295",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:59" align="right">comment:59</div>

Sure, all done.



---

archive/issue_comments_466296.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nSo this fixes a regression for the `kenzo` package introduced by the ECL update?\n\nIt would be good to update the ticket description.",
    "created_at": "2021-04-02T19:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466296",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">comment:60</div>

So this fixes a regression for the `kenzo` package introduced by the ECL update?

It would be good to update the ticket description.



---

archive/issue_comments_466297.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nAlso, run this ticket on GH Actions please so that we can see if the system packages are accepted correctly",
    "created_at": "2021-04-02T19:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466297",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">comment:61</div>

Also, run this ticket on GH Actions please so that we can see if the system packages are accepted correctly



---

archive/issue_comments_466298.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@mkoeppe](#comment:60):\n> So this fixes a regression for the `kenzo` package introduced by the ECL update?\n> \n\nKenzo is optional so I wouldn't guess as to when it stopped working. Some of its tests fail; for example, `sage/interfaces/kenzo.py` has\n\n```\nEXAMPLES::                                                                                                                                                               \n                                                                                                                                                                             \n    sage: from sage.interfaces.kenzo import MooreSpace   # optional - kenzo                                                                                              \n    sage: m24 = MooreSpace(2,4)                          # optional - kenzo                                                                                              \n    sage: m24                                            # optional - kenzo                                                                                              \n    [K10 Simplicial-Set]                                                    \n```\n\nbut when I run it I get\n\n```\nsage: from sage.interfaces.kenzo import MooreSpace                                                                                                                           \nsage: m24 = MooreSpace(2,4)                                                                                                                                                  \nsage: m24                                                                                                                                                                    \n[K1 Simplicial-Set]\n```",
    "created_at": "2021-04-02T20:13:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466298",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@mkoeppe](#comment:60):
> So this fixes a regression for the `kenzo` package introduced by the ECL update?
> 

Kenzo is optional so I wouldn't guess as to when it stopped working. Some of its tests fail; for example, `sage/interfaces/kenzo.py` has

```
EXAMPLES::                                                                                                                                                               
                                                                                                                                                                             
    sage: from sage.interfaces.kenzo import MooreSpace   # optional - kenzo                                                                                              
    sage: m24 = MooreSpace(2,4)                          # optional - kenzo                                                                                              
    sage: m24                                            # optional - kenzo                                                                                              
    [K10 Simplicial-Set]                                                    
```

but when I run it I get

```
sage: from sage.interfaces.kenzo import MooreSpace                                                                                                                           
sage: m24 = MooreSpace(2,4)                                                                                                                                                  
sage: m24                                                                                                                                                                    
[K1 Simplicial-Set]
```



---

archive/issue_events_407453.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-04-02T20:13:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "title_is": "Support system installations of ECL and fix the kenzo SPKG build",
    "title_was": "spkg-configure.m4 and distros/ information for ecl",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407453"
}
```



---

archive/issue_comments_466299.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nTox run: https://github.com/orlitzky/sage/actions/runs/712735969",
    "created_at": "2021-04-02T20:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466299",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:63" align="right">comment:63</div>

Tox run: https://github.com/orlitzky/sage/actions/runs/712735969



---

archive/issue_comments_466300.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@orlitzky](#comment:62):\n> Replying to [@mkoeppe](#comment:60):\n> > So this fixes a regression for the `kenzo` package introduced by the ECL update?\n> > \n\n> \n> Kenzo is optional so I wouldn't guess as to when it stopped working. \n\nWe do run CI tests on GH Actions for all optional packages (just the installation + spkg-check). See for example https://github.com/sagemath/sage/runs/2223044706 for 9.3.rc1. I do not see any build failures for kenzo. Were just some tests of the sagelib testsuite failing when kenzo is installed (the GH Actions do not test this), or what is the issue?",
    "created_at": "2021-04-03T01:23:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466300",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@orlitzky](#comment:62):
> Replying to [@mkoeppe](#comment:60):
> > So this fixes a regression for the `kenzo` package introduced by the ECL update?
> > 

> 
> Kenzo is optional so I wouldn't guess as to when it stopped working. 

We do run CI tests on GH Actions for all optional packages (just the installation + spkg-check). See for example https://github.com/sagemath/sage/runs/2223044706 for 9.3.rc1. I do not see any build failures for kenzo. Were just some tests of the sagelib testsuite failing when kenzo is installed (the GH Actions do not test this), or what is the issue?



---

archive/issue_comments_466301.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@mkoeppe](#comment:65):\n> \n> We do run CI tests on GH Actions for all optional packages (just the installation + spkg-check). See for example https://github.com/sagemath/sage/runs/2223044706 for 9.3.rc1. I do not see any build failures for kenzo. Were just some tests of the sagelib testsuite failing when kenzo is installed (the GH Actions do not test this), or what is the issue?\n> \n\nDigging deeper, I probably just broke kenzo with the ECL spkg.\n\nOur ECL spkg bundles ASDF, and the bundled version works OK. But if the system copy of ECL is used and if that system copy does **not** bundle ASDF, then there's a backwards-incompatible API change in the ASDF `make-build` function which has been deprecated for a while (and now exists only for the sake of backwards-compatibility with ECL).\n\nUltimately the `make-build` function takes a `type` argument (was `:fasl` but I changed it to `:fasb`) and passes it to another function called `select-bundle-operation`. In the bundled copy of ASDF, it looks like\n\n```cl\n  ;; Find the operation that produces a given bundle-type                                                                                                                    \n  (defun select-bundle-operation (type &optional monolithic)\n    (ecase type\n      ((:dll :shared-library)\n       (if monolithic 'monolithic-dll-op 'dll-op))\n      ((:lib :static-library)\n       (if monolithic 'monolithic-lib-op 'lib-op))\n      ((:fasl)\n       (if monolithic 'monolithic-compile-bundle-op 'compile-bundle-op))\n      ((:image)\n       'image-op)\n      ((:program)\n       'program-op)))\n```\n\nbut in my unbundled ASDF, it's\n\n```cl\n  ;; Find the operation that produces a given bundle-type                                                                                                                    \n  (defun select-bundle-operation (type &optional monolithic)\n    (ecase type\n      ((:dll :shared-library)\n       (if monolithic 'monolithic-dll-op 'dll-op))\n      ((:lib :static-library)\n       (if monolithic 'monolithic-lib-op 'lib-op))\n      ((:fasb)\n       (if monolithic 'monolithic-compile-bundle-op 'compile-bundle-op))\n      ((:image)\n       'image-op)\n      ((:program)\n       'program-op))))\n```\n\nTo avoid having to support both, one idea that comes to mind is that we could take a newer version of `asdf.lisp` and copy it over the bundled version in the ECL spkg. Then `:fasb` would work in both of the situations above. However it would still fail if the system ECL is using a bundled `asdf.lisp`. Patching kenzo's `compile.lisp` to try both is likely the only reliable way.",
    "created_at": "2021-04-03T17:15:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466301",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@mkoeppe](#comment:65):
> 
> We do run CI tests on GH Actions for all optional packages (just the installation + spkg-check). See for example https://github.com/sagemath/sage/runs/2223044706 for 9.3.rc1. I do not see any build failures for kenzo. Were just some tests of the sagelib testsuite failing when kenzo is installed (the GH Actions do not test this), or what is the issue?
> 

Digging deeper, I probably just broke kenzo with the ECL spkg.

Our ECL spkg bundles ASDF, and the bundled version works OK. But if the system copy of ECL is used and if that system copy does **not** bundle ASDF, then there's a backwards-incompatible API change in the ASDF `make-build` function which has been deprecated for a while (and now exists only for the sake of backwards-compatibility with ECL).

Ultimately the `make-build` function takes a `type` argument (was `:fasl` but I changed it to `:fasb`) and passes it to another function called `select-bundle-operation`. In the bundled copy of ASDF, it looks like

```cl
  ;; Find the operation that produces a given bundle-type                                                                                                                    
  (defun select-bundle-operation (type &optional monolithic)
    (ecase type
      ((:dll :shared-library)
       (if monolithic 'monolithic-dll-op 'dll-op))
      ((:lib :static-library)
       (if monolithic 'monolithic-lib-op 'lib-op))
      ((:fasl)
       (if monolithic 'monolithic-compile-bundle-op 'compile-bundle-op))
      ((:image)
       'image-op)
      ((:program)
       'program-op)))
```

but in my unbundled ASDF, it's

```cl
  ;; Find the operation that produces a given bundle-type                                                                                                                    
  (defun select-bundle-operation (type &optional monolithic)
    (ecase type
      ((:dll :shared-library)
       (if monolithic 'monolithic-dll-op 'dll-op))
      ((:lib :static-library)
       (if monolithic 'monolithic-lib-op 'lib-op))
      ((:fasb)
       (if monolithic 'monolithic-compile-bundle-op 'compile-bundle-op))
      ((:image)
       'image-op)
      ((:program)
       'program-op))))
```

To avoid having to support both, one idea that comes to mind is that we could take a newer version of `asdf.lisp` and copy it over the bundled version in the ECL spkg. Then `:fasb` would work in both of the situations above. However it would still fail if the system ECL is using a bundled `asdf.lisp`. Patching kenzo's `compile.lisp` to try both is likely the only reliable way.



---

archive/issue_comments_466302.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nDoes Kenzo have an active upstream maintainer?",
    "created_at": "2021-04-03T17:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466302",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">comment:67</div>

Does Kenzo have an active upstream maintainer?



---

archive/issue_comments_466303.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@orlitzky](#comment:66):\n> we could take a newer version of `asdf.lisp` and copy it over the bundled version in the ECL spkg. Then `:fasb` would work in both of the situations above.\n\nAs we currently do not have plans to ship additional Common Lisp libraries in the Sage distribution, I think we should not do unbundling work on ECL but stick with upstream.\n\n> Patching kenzo's `compile.lisp` to try both is likely the only reliable way.\n\nYes, I agree, this seems to be the way to go. You can use `HANDLER-CASE` for this http://clhs.lisp.se/Body/m_hand_1.htm",
    "created_at": "2021-04-03T17:54:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466303",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@orlitzky](#comment:66):
> we could take a newer version of `asdf.lisp` and copy it over the bundled version in the ECL spkg. Then `:fasb` would work in both of the situations above.

As we currently do not have plans to ship additional Common Lisp libraries in the Sage distribution, I think we should not do unbundling work on ECL but stick with upstream.

> Patching kenzo's `compile.lisp` to try both is likely the only reliable way.

Yes, I agree, this seems to be the way to go. You can use `HANDLER-CASE` for this http://clhs.lisp.se/Body/m_hand_1.htm



---

archive/issue_comments_466304.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nIt would probably also be good to add a `kenzo/spkg-check.in` that at least tries to load it into ECL.",
    "created_at": "2021-04-03T18:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466304",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">comment:69</div>

It would probably also be good to add a `kenzo/spkg-check.in` that at least tries to load it into ECL.



---

archive/issue_comments_466305.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@mkoeppe](#comment:67):\n> Does Kenzo have an active upstream maintainer?\n\nPaging @miguelmarco :o\n\n* The original kenzo upstream is at https://www-fourier.ujf-grenoble.fr/~sergerar/Kenzo/\n* Our SPKG points to https://github.com/gheber/kenzo\n* The release itself comes from https://github.com/miguelmarco/kenzo/\n\nThe ASDF docs say that `program-op` and `program-system` should replace `make-build`. Those functions are available in the bundled copy of ASDF as well, so another good long-term option would be for kenzo upstream to switch to them (if possible).",
    "created_at": "2021-04-03T18:32:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466305",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@mkoeppe](#comment:67):
> Does Kenzo have an active upstream maintainer?

Paging @miguelmarco :o

* The original kenzo upstream is at https://www-fourier.ujf-grenoble.fr/~sergerar/Kenzo/
* Our SPKG points to https://github.com/gheber/kenzo
* The release itself comes from https://github.com/miguelmarco/kenzo/

The ASDF docs say that `program-op` and `program-system` should replace `make-build`. Those functions are available in the bundled copy of ASDF as well, so another good long-term option would be for kenzo upstream to switch to them (if possible).



---

archive/issue_comments_466306.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\n> \n> * The original kenzo upstream is at https://www-fourier.ujf-grenoble.fr/~sergerar/Kenzo/\n> * Our SPKG points to https://github.com/gheber/kenzo\n> * The release itself comes from https://github.com/miguelmarco/kenzo/\n> \n> The ASDF docs say that `program-op` and `program-system` should replace `make-build`. Those functions are available in the bundled copy of ASDF as well, so another good long-term option would be for kenzo upstream to switch to them (if possible).\n\n\nTo clarify this:\n\nWhat we maintain (by \"we\" I mean Ana Romeno, Julian Cuevas, Jose Divason and myself) is a small fork of Kenzo, modified to be compatible with ECL, easier to install, and some extra features to allow a better interface with Sage.\n\nI am not fluent in lisp myself, but will talk about this issues with the rest of the team. Maybe we can modify the package to make it more installation friendly.",
    "created_at": "2021-04-04T11:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466306",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:71" align="right">comment:71</div>

> 
> * The original kenzo upstream is at https://www-fourier.ujf-grenoble.fr/~sergerar/Kenzo/
> * Our SPKG points to https://github.com/gheber/kenzo
> * The release itself comes from https://github.com/miguelmarco/kenzo/
> 
> The ASDF docs say that `program-op` and `program-system` should replace `make-build`. Those functions are available in the bundled copy of ASDF as well, so another good long-term option would be for kenzo upstream to switch to them (if possible).


To clarify this:

What we maintain (by "we" I mean Ana Romeno, Julian Cuevas, Jose Divason and myself) is a small fork of Kenzo, modified to be compatible with ECL, easier to install, and some extra features to allow a better interface with Sage.

I am not fluent in lisp myself, but will talk about this issues with the rest of the team. Maybe we can modify the package to make it more installation friendly.



---

archive/issue_comments_466307.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [@orlitzky](#comment:70):\n> The ASDF docs say that `program-op` and `program-system` should replace `make-build`. Those functions are available in the bundled copy of ASDF as well, so another good long-term option would be for kenzo upstream to switch to them (if possible).\n\nYes, this sounds the like the right solution.",
    "created_at": "2021-04-05T16:38:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466307",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [@orlitzky](#comment:70):
> The ASDF docs say that `program-op` and `program-system` should replace `make-build`. Those functions are available in the bundled copy of ASDF as well, so another good long-term option would be for kenzo upstream to switch to them (if possible).

Yes, this sounds the like the right solution.



---

archive/issue_comments_466308.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@mkoeppe](#comment:72):\n> Replying to [@orlitzky](#comment:70):\n> > The ASDF docs say that `program-op` and `program-system` should replace `make-build`. Those functions are available in the bundled copy of ASDF as well, so another good long-term option would be for kenzo upstream to switch to them (if possible).\n\n> \n> Yes, this sounds the like the right solution.\n\n\nI have done some tests on that. Might release a new version with this change in a few days, after some testing.\n\nSo, to make sure: can you confirm that changing from \n\n\n```\n(asdf:make-build :kenzo :type :fasl :monolithic t :move-here #P\".\")\n```\n\nto \n\n```\n(asdf:operate 'asdf:monolithic-compile-bundle-op :kenzo)\n```\n\nin the `compile.lisp` file would solve the problem?",
    "created_at": "2021-04-05T17:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466308",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@mkoeppe](#comment:72):
> Replying to [@orlitzky](#comment:70):
> > The ASDF docs say that `program-op` and `program-system` should replace `make-build`. Those functions are available in the bundled copy of ASDF as well, so another good long-term option would be for kenzo upstream to switch to them (if possible).

> 
> Yes, this sounds the like the right solution.


I have done some tests on that. Might release a new version with this change in a few days, after some testing.

So, to make sure: can you confirm that changing from 


```
(asdf:make-build :kenzo :type :fasl :monolithic t :move-here #P".")
```

to 

```
(asdf:operate 'asdf:monolithic-compile-bundle-op :kenzo)
```

in the `compile.lisp` file would solve the problem?



---

archive/issue_events_407454.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407454"
}
```



---

archive/issue_events_407455.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-07T19:29:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407455"
}
```



---

archive/issue_comments_466309.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466309",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:74" align="right">comment:74</div>

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_407456.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-04-07T20:36:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407456"
}
```



---

archive/issue_events_407457.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-04-07T20:36:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407457"
}
```



---

archive/issue_comments_466310.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nis kenzo build fixed? I'm getting (on macOS/homebrew), with ecl from Homebrew\n\n```\n[kenzo-1.1.9] Package 'kenzo' is currently not installed\n[kenzo-1.1.9] No legacy uninstaller found for 'kenzo'; nothing to do\n[kenzo-1.1.9] sed: 1: \"compile.lisp\": command c expects \\ followed by text\n[kenzo-1.1.9] ********************************************************************************\n[kenzo-1.1.9] failed to update make-build invocation\n```",
    "created_at": "2021-04-07T20:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466310",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:75" align="right">comment:75</div>

is kenzo build fixed? I'm getting (on macOS/homebrew), with ecl from Homebrew

```
[kenzo-1.1.9] Package 'kenzo' is currently not installed
[kenzo-1.1.9] No legacy uninstaller found for 'kenzo'; nothing to do
[kenzo-1.1.9] sed: 1: "compile.lisp": command c expects \ followed by text
[kenzo-1.1.9] ********************************************************************************
[kenzo-1.1.9] failed to update make-build invocation
```



---

archive/issue_events_407458.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-04-07T20:36:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407458"
}
```



---

archive/issue_events_407459.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-04-07T20:36:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407459"
}
```



---

archive/issue_comments_466311.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@miguelmarco](#comment:73):\n> \n> I have done some tests on that. Might release a new version with this change in a few days, after some testing.\n> \n> So, to make sure: can you confirm that changing from \n> \n> \n> ```\n> (asdf:make-build :kenzo :type :fasl :monolithic t :move-here #P\".\")\n> ```\n> \n> to \n> \n> ```\n> (asdf:operate 'asdf:monolithic-compile-bundle-op :kenzo)\n> ```\n> \n> in the `compile.lisp` file would solve the problem?\n\nIt fixes the build for my system ECL (with ASDF unbundled). If it also works with sage's ECL spkg, I think we have a solution. Thanks!",
    "created_at": "2021-04-08T01:14:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466311",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@miguelmarco](#comment:73):
> 
> I have done some tests on that. Might release a new version with this change in a few days, after some testing.
> 
> So, to make sure: can you confirm that changing from 
> 
> 
> ```
> (asdf:make-build :kenzo :type :fasl :monolithic t :move-here #P".")
> ```
> 
> to 
> 
> ```
> (asdf:operate 'asdf:monolithic-compile-bundle-op :kenzo)
> ```
> 
> in the `compile.lisp` file would solve the problem?

It fixes the build for my system ECL (with ASDF unbundled). If it also works with sage's ECL spkg, I think we have a solution. Thanks!



---

archive/issue_comments_466312.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nI just made a new release. You can get the tarball at https://github.com/miguelmarco/kenzo/releases/download/1.1.10/kenzo-1.1.10.tar.gz\n\nPlease check that it solves the problem, and then we can update the kenzo Sage package.",
    "created_at": "2021-04-08T10:57:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466312",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:78" align="right">comment:78</div>

I just made a new release. You can get the tarball at https://github.com/miguelmarco/kenzo/releases/download/1.1.10/kenzo-1.1.10.tar.gz

Please check that it solves the problem, and then we can update the kenzo Sage package.



---

archive/issue_comments_466313.json:
```json
{
    "body": "<div id=\"comment:79\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27727acc92443e3efc922ea382f225e86cacac9e\">27727ac</a></td><td><code>build/pkgs/ecl/distros/arch.txt: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38cc46d7f4759c826ed7c0e7353e378b359cb6dd\">38cc46d</a></td><td><code>Trac #29617: check for ecl-config instead of ecl.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18cbcee9a37d645f12f78c1067257ac27d559130\">18cbcee</a></td><td><code>Trac #29617: compile a check for ECL_VERSION_NUMBER.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/444d828201fd6559d914dabf0afea9c0aad8e381\">444d828</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4061f54a88c234ec03f44df255cbf28eea67213c\">4061f54</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edd246f03f4b64a31702b3b6c92635ee0dfe506c\">edd246f</a></td><td><code>Trac #29617: don't set ECLDIR in sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/133aab7f38cde61fc5ac916b90eb5745be772760\">133aab7</a></td><td><code>Trac #29617: move MAXIMA_FAS to sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b595c0c54d6e3591ab6d11462a60f0f03c71fce\">9b595c0</a></td><td><code>Trac #29617: modify Kenzo interface to support system ECL.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4ae35ed66488bdc2017af489b6672810473535c\">b4ae35e</a></td><td><code>Trac #29617: treat empty MAXIMA_FAS and KENZO_FAS as None.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d40f36753ed0f4a93c44952730d67e06f19eb38\">2d40f36</a></td><td><code>Trac #29617: upgrade kenzo to v1.1.10.</code></td></tr></table>\n",
    "created_at": "2021-04-08T19:27:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466313",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27727acc92443e3efc922ea382f225e86cacac9e">27727ac</a></td><td><code>build/pkgs/ecl/distros/arch.txt: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38cc46d7f4759c826ed7c0e7353e378b359cb6dd">38cc46d</a></td><td><code>Trac #29617: check for ecl-config instead of ecl.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18cbcee9a37d645f12f78c1067257ac27d559130">18cbcee</a></td><td><code>Trac #29617: compile a check for ECL_VERSION_NUMBER.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/444d828201fd6559d914dabf0afea9c0aad8e381">444d828</a></td><td><code>Trac #29617: substitute ecl-config path into sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4061f54a88c234ec03f44df255cbf28eea67213c">4061f54</a></td><td><code>Trac #29617: remove failing ECL test.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edd246f03f4b64a31702b3b6c92635ee0dfe506c">edd246f</a></td><td><code>Trac #29617: don't set ECLDIR in sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/133aab7f38cde61fc5ac916b90eb5745be772760">133aab7</a></td><td><code>Trac #29617: move MAXIMA_FAS to sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b595c0c54d6e3591ab6d11462a60f0f03c71fce">9b595c0</a></td><td><code>Trac #29617: modify Kenzo interface to support system ECL.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4ae35ed66488bdc2017af489b6672810473535c">b4ae35e</a></td><td><code>Trac #29617: treat empty MAXIMA_FAS and KENZO_FAS as None.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d40f36753ed0f4a93c44952730d67e06f19eb38">2d40f36</a></td><td><code>Trac #29617: upgrade kenzo to v1.1.10.</code></td></tr></table>




---

archive/issue_comments_466314.json:
```json
{
    "body": "Changed commit from **[`1615691`](https://github.com/sagemath/sagetrac-mirror/commit/161569159089bde2516bebd5f99b3b25c562ad6b)** to **[`2d40f36`](https://github.com/sagemath/sagetrac-mirror/commit/2d40f36753ed0f4a93c44952730d67e06f19eb38)**",
    "created_at": "2021-04-08T19:27:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466314",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1615691`](https://github.com/sagemath/sagetrac-mirror/commit/161569159089bde2516bebd5f99b3b25c562ad6b)** to **[`2d40f36`](https://github.com/sagemath/sagetrac-mirror/commit/2d40f36753ed0f4a93c44952730d67e06f19eb38)**



---

archive/issue_comments_466315.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nThe kenzo upgrade is now included, and my previous broken spkg-install hack removed. Everything still works with system ECL.\n\nGithub has helpfully disabled actions on my account after the last run, and I'm waiting to hear back from support. Can someone else kick off a CI run please?",
    "created_at": "2021-04-08T19:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466315",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:80" align="right">comment:80</div>

The kenzo upgrade is now included, and my previous broken spkg-install hack removed. Everything still works with system ECL.

Github has helpfully disabled actions on my account after the last run, and I'm waiting to hear back from support. Can someone else kick off a CI run please?



---

archive/issue_comments_466316.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nRunning at https://github.com/mkoeppe/sage/actions/runs/732049335 (with a bunch of other tickets)",
    "created_at": "2021-04-09T06:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466316",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:81" align="right">comment:81</div>

Running at https://github.com/mkoeppe/sage/actions/runs/732049335 (with a bunch of other tickets)



---

archive/issue_comments_466317.json:
```json
{
    "body": "Reviewer: **https://github.com/mkoeppe/sage/actions/runs/732049335**",
    "created_at": "2021-04-09T06:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466317",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **https://github.com/mkoeppe/sage/actions/runs/732049335**



---

archive/issue_comments_466318.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nOne of the bunch of tickets was broken; the failures that you see in the run are from that.\n\nA new run is at https://github.com/mkoeppe/sage/actions/runs/733869032: \n\nCorrectly accepts system ecl on `homebrew-macos-11.0-xcode_default-standard` (https://github.com/mkoeppe/sage/runs/2308094353) and has clean doctests\n\nCorrectly accepts system ecl on `gentoo-standard` (https://github.com/mkoeppe/sage/runs/2308093679). The build completes. The numerous doctest failures are from the unrelated unfortunate situation described in #31578\n\nCorrectly accepts system ecl on `fedora-34-standard` (https://github.com/mkoeppe/sage/runs/2308093524), but the build fails for unrelated reasons\n\nCorrectly rejects too old system ecl on other platforms.\n\n\nBuild of `kenzo` was tested in https://github.com/mkoeppe/sage/actions/runs/732049334, looks OK.",
    "created_at": "2021-04-10T17:23:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466318",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">comment:82</div>

One of the bunch of tickets was broken; the failures that you see in the run are from that.

A new run is at https://github.com/mkoeppe/sage/actions/runs/733869032: 

Correctly accepts system ecl on `homebrew-macos-11.0-xcode_default-standard` (https://github.com/mkoeppe/sage/runs/2308094353) and has clean doctests

Correctly accepts system ecl on `gentoo-standard` (https://github.com/mkoeppe/sage/runs/2308093679). The build completes. The numerous doctest failures are from the unrelated unfortunate situation described in #31578

Correctly accepts system ecl on `fedora-34-standard` (https://github.com/mkoeppe/sage/runs/2308093524), but the build fails for unrelated reasons

Correctly rejects too old system ecl on other platforms.


Build of `kenzo` was tested in https://github.com/mkoeppe/sage/actions/runs/732049334, looks OK.



---

archive/issue_events_407460.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-10T17:23:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407460"
}
```



---

archive/issue_events_407461.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-10T17:23:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407461"
}
```



---

archive/issue_comments_466319.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/732049335** to **Matthias Koeppe**",
    "created_at": "2021-04-10T17:23:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466319",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/732049335** to **Matthias Koeppe**



---

archive/issue_comments_466320.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/29617](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29617)** to **[u/mkoeppe/ticket/29617](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29617)**",
    "created_at": "2021-05-26T22:26:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466320",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mjo/ticket/29617](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29617)** to **[u/mkoeppe/ticket/29617](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29617)**



---

archive/issue_comments_466321.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,14 @@\n I tried to use ECL and Maxima from system packages as suggested by #27330, but without success for the moment.\n \n-The spkg-configure.m4 are trivial (see attachments), but the problems occur during build:\n+The `spkg-configure.m4` are trivial (see attachments), but the problems occur during build:\n \n In [dochtml] [manifolds] this error is produced:\n \n ```\n-\tRuntimeError: ECL says: The function SET-LOCALE-SUBDIR is undefined\n+RuntimeError: ECL says: The function SET-LOCALE-SUBDIR is undefined\n ```\n \n Actually this error is reproducible out of the Sage's build mechanism:\n-\n \n ```\n $ ecl\n@@ -20,15 +19,15 @@\n The function MAXIMA::SET-LOCALE-SUBDIR is undefined.\n ```\n \n-According to Maxima's code, set-locale-subdir is defined in src/init-cl.lisp and:\n+According to Maxima's code, `set-locale-subdir` is defined in `src/init-cl.lisp` and:\n \n ```\n-\t     ;; If a file is declared as private-file it is loaded\n-\t     ;; from the build tree (which makes an out-of-tree\n-\t     ;; build possible), but not compiled (which means\n-\t     ;; that with ECL or ABCL it won't end up in the final image)\n-\t     ;; => no out-of-tree build for ECL.\n+    ;; If a file is declared as private-file it is loaded\n+    ;; from the build tree (which makes an out-of-tree\n+    ;; build possible), but not compiled (which means\n+    ;; that with ECL or ABCL it won't end up in the final image)\n+    ;; => no out-of-tree build for ECL.\n ```\n \n-Maybe someone with lisp-flu could patch it, if possible?\n+Maybe someone with Lisp-fu could patch it, if possible?\n \n``````\n",
    "created_at": "2021-05-26T23:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466321",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,14 @@
 I tried to use ECL and Maxima from system packages as suggested by #27330, but without success for the moment.
 
-The spkg-configure.m4 are trivial (see attachments), but the problems occur during build:
+The `spkg-configure.m4` are trivial (see attachments), but the problems occur during build:
 
 In [dochtml] [manifolds] this error is produced:
 
 ```
-	RuntimeError: ECL says: The function SET-LOCALE-SUBDIR is undefined
+RuntimeError: ECL says: The function SET-LOCALE-SUBDIR is undefined
 ```
 
 Actually this error is reproducible out of the Sage's build mechanism:
-
 
 ```
 $ ecl
@@ -20,15 +19,15 @@
 The function MAXIMA::SET-LOCALE-SUBDIR is undefined.
 ```
 
-According to Maxima's code, set-locale-subdir is defined in src/init-cl.lisp and:
+According to Maxima's code, `set-locale-subdir` is defined in `src/init-cl.lisp` and:
 
 ```
-	     ;; If a file is declared as private-file it is loaded
-	     ;; from the build tree (which makes an out-of-tree
-	     ;; build possible), but not compiled (which means
-	     ;; that with ECL or ABCL it won't end up in the final image)
-	     ;; => no out-of-tree build for ECL.
+    ;; If a file is declared as private-file it is loaded
+    ;; from the build tree (which makes an out-of-tree
+    ;; build possible), but not compiled (which means
+    ;; that with ECL or ABCL it won't end up in the final image)
+    ;; => no out-of-tree build for ECL.
 ```
 
-Maybe someone with lisp-flu could patch it, if possible?
+Maybe someone with Lisp-fu could patch it, if possible?
 
``````




---

archive/issue_comments_466322.json:
```json
{
    "body": "Changed commit from **[`2d40f36`](https://github.com/sagemath/sagetrac-mirror/commit/2d40f36753ed0f4a93c44952730d67e06f19eb38)** to **[`5cbe423`](https://github.com/sagemath/sagetrac-mirror/commit/5cbe423253c38535b854a60a349b368b96f6a860)**",
    "created_at": "2021-05-26T23:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466322",
    "user": "https://github.com/slel"
}
```

Changed commit from **[`2d40f36`](https://github.com/sagemath/sagetrac-mirror/commit/2d40f36753ed0f4a93c44952730d67e06f19eb38)** to **[`5cbe423`](https://github.com/sagemath/sagetrac-mirror/commit/5cbe423253c38535b854a60a349b368b96f6a860)**



---

archive/issue_comments_466323.json:
```json
{
    "body": "<div id=\"comment:84\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5161d658528e5f61e052a270611cfad2a8da5fe4\">5161d65</a></td><td><code>build/pkgs/sage_conf/src/sage_conf.py.in: Move SAGE_ROOT, SAGE_LOCAL to beginning of file; only use substitution @prefix@ once</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/986ca18c4a3b255daede540ee114e9f38cbe65bd\">986ca18</a></td><td><code>build/pkgs/sage_conf/src/sage_conf.py.in: replace subst by replace</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2078fa6eb00db691046572868d510fad14dd6ede\">2078fa6</a></td><td><code>Merge tag '9.4.beta0' into t/31593/configure__paths_within__sage_local___prefix__for_sage_conf</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5cbe423253c38535b854a60a349b368b96f6a860\">5cbe423</a></td><td><code>Merge #31593</code></td></tr></table>\n",
    "created_at": "2021-05-26T23:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466323",
    "user": "https://github.com/slel"
}
```

<div id="comment:84"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5161d658528e5f61e052a270611cfad2a8da5fe4">5161d65</a></td><td><code>build/pkgs/sage_conf/src/sage_conf.py.in: Move SAGE_ROOT, SAGE_LOCAL to beginning of file; only use substitution @prefix@ once</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/986ca18c4a3b255daede540ee114e9f38cbe65bd">986ca18</a></td><td><code>build/pkgs/sage_conf/src/sage_conf.py.in: replace subst by replace</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2078fa6eb00db691046572868d510fad14dd6ede">2078fa6</a></td><td><code>Merge tag '9.4.beta0' into t/31593/configure__paths_within__sage_local___prefix__for_sage_conf</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5cbe423253c38535b854a60a349b368b96f6a860">5cbe423</a></td><td><code>Merge #31593</code></td></tr></table>




---

archive/issue_events_407462.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-09T12:49:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407462"
}
```



---

archive/issue_events_407463.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-09T12:49:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407463"
}
```



---

archive/issue_events_407464.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-20T08:14:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407464"
}
```



---

archive/issue_events_407465.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b334f3434c2a4f61c8d899411cc16f81b12a74a1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-20T08:14:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29617#event-407465"
}
```



---

archive/issue_comments_466324.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/ticket/29617](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29617)** to **[`5cbe423`](https://github.com/sagemath/sagetrac-mirror/commit/5cbe423253c38535b854a60a349b368b96f6a860)**",
    "created_at": "2021-06-20T08:14:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29617",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29617#issuecomment-466324",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/ticket/29617](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29617)** to **[`5cbe423`](https://github.com/sagemath/sagetrac-mirror/commit/5cbe423253c38535b854a60a349b368b96f6a860)**
