# Issue 29096: Rename spkg-build, spkg-install etc. templates as spkg-build.in, spkg-install.in etc.

archive/issues_028859.json:
```json
{
    "body": "It is unnecessarily confusing that `build/bin/sage-spkg` transforms the template `spkg-install` to an executable script that is *also* called `spkg-install`.\n\nThis ticket renames all `build/pkgs/SPKG/spkg-*` of packages other than `type=script` (which are regular executable shell scripts already) to `build/pkgs/SPKG/spkg-*.in`.\n\nIn addition to the increased clarity, this is preparation for #29122 (Build packages in `build/pkgs/SPKG/src`, not `SAGE_LOCAL/var/tmp/sage/build/SPKG-...`).\n\n**CC:**  @embray @dimpase @jhpalmieri\n\n**Branch/Commit:** [ec540dd345a3127ef19bdb2def38e63cdb6a3361](https://github.com/sagemath/sagetrac-mirror/commit/ec540dd345a3127ef19bdb2def38e63cdb6a3361)\n\n**Reviewer:** Dima Pasechnik, John Palmieri\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/29096\n\n",
    "closed_at": "2020-03-10T23:27:45Z",
    "created_at": "2020-01-29T00:56:29Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "Rename spkg-build, spkg-install etc. templates as spkg-build.in, spkg-install.in etc.",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/29096",
    "user": "https://github.com/mkoeppe"
}
```
It is unnecessarily confusing that `build/bin/sage-spkg` transforms the template `spkg-install` to an executable script that is *also* called `spkg-install`.

This ticket renames all `build/pkgs/SPKG/spkg-*` of packages other than `type=script` (which are regular executable shell scripts already) to `build/pkgs/SPKG/spkg-*.in`.

In addition to the increased clarity, this is preparation for #29122 (Build packages in `build/pkgs/SPKG/src`, not `SAGE_LOCAL/var/tmp/sage/build/SPKG-...`).

**CC:**  @embray @dimpase @jhpalmieri

**Branch/Commit:** [ec540dd345a3127ef19bdb2def38e63cdb6a3361](https://github.com/sagemath/sagetrac-mirror/commit/ec540dd345a3127ef19bdb2def38e63cdb6a3361)

**Reviewer:** Dima Pasechnik, John Palmieri

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/29096





---

archive/issue_comments_458265.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/rename_spkg_build__spkg_install_etc__templates_as_spkg_build_in__spkg_install_in_etc_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/rename_spkg_build__spkg_install_etc__templates_as_spkg_build_in__spkg_install_in_etc_)",
    "created_at": "2020-03-04T03:54:01Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458265",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/rename_spkg_build__spkg_install_etc__templates_as_spkg_build_in__spkg_install_in_etc_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/rename_spkg_build__spkg_install_etc__templates_as_spkg_build_in__spkg_install_in_etc_)



---

archive/issue_comments_458266.json:
```json
{
    "body": "**Commit:** [4524b04f9ecff7346aec7d27caf985629f8ca7e8](https://github.com/sagemath/sagetrac-mirror/commit/4524b04f9ecff7346aec7d27caf985629f8ca7e8)",
    "created_at": "2020-03-04T04:07:26Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [4524b04f9ecff7346aec7d27caf985629f8ca7e8](https://github.com/sagemath/sagetrac-mirror/commit/4524b04f9ecff7346aec7d27caf985629f8ca7e8)



---

archive/issue_comments_458267.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4524b04f9ecff7346aec7d27caf985629f8ca7e8\">4524b04</a></td><td><code>Update developer manual</code></td></tr></table>\n",
    "created_at": "2020-03-04T04:07:26Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4524b04f9ecff7346aec7d27caf985629f8ca7e8">4524b04</a></td><td><code>Update developer manual</code></td></tr></table>




---

archive/issue_comments_458268.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-03-04T04:08:48Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458268",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_events_258537.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-04T04:08:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258537"
}
```



---

archive/issue_comments_458269.json:
```json
{
    "body": "<a id='comment:4'></a>\nYou need to at least make this change:\n\n```diff\ndiff --git a/build/bin/sage-spkg b/build/bin/sage-spkg\nindex 66ff1d08bb..4776654a4d 100755\n--- a/build/bin/sage-spkg\n+++ b/build/bin/sage-spkg\n@@ -770,7 +770,7 @@ for script in $WRAPPED_SCRIPTS; do\n \n     script=\"spkg-$script\"\n \n-    if [ -f \"$script\" ]; then\n+    if [ -f \"$script.in\" ]; then\n         if [ \"$USE_LOCAL_SCRIPTS\" = \"yes\" ]; then\n             if [ -x \"$script.in\" ]; then\n                 msg=\"$script.in should not be marked executable in the build/pkgs directory\"\n```",
    "created_at": "2020-03-04T05:05:03Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458269",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
You need to at least make this change:

```diff
diff --git a/build/bin/sage-spkg b/build/bin/sage-spkg
index 66ff1d08bb..4776654a4d 100755
--- a/build/bin/sage-spkg
+++ b/build/bin/sage-spkg
@@ -770,7 +770,7 @@ for script in $WRAPPED_SCRIPTS; do
 
     script="spkg-$script"
 
-    if [ -f "$script" ]; then
+    if [ -f "$script.in" ]; then
         if [ "$USE_LOCAL_SCRIPTS" = "yes" ]; then
             if [ -x "$script.in" ]; then
                 msg="$script.in should not be marked executable in the build/pkgs directory"
```



---

archive/issue_comments_458270.json:
```json
{
    "body": "<a id='comment:5'></a>\nAlso, you shouldn't rename `elliptic_curves/spkg-install.py`.",
    "created_at": "2020-03-04T06:04:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458270",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Also, you shouldn't rename `elliptic_curves/spkg-install.py`.



---

archive/issue_comments_458271.json:
```json
{
    "body": "<a id='comment:6'></a>\nindeed, as far as I know, none of `build/pkgs/*/*.py` are templates, they are Python scripts, and should remain so.",
    "created_at": "2020-03-04T12:55:05Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458271",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
indeed, as far as I know, none of `build/pkgs/*/*.py` are templates, they are Python scripts, and should remain so.



---

archive/issue_comments_458272.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks for catching this -- query-replace-regexp was a little bit too enthusiastic",
    "created_at": "2020-03-04T13:36:58Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458272",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Thanks for catching this -- query-replace-regexp was a little bit too enthusiastic



---

archive/issue_comments_458273.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27240830696cfe7c140b98f6120382b99f8b73c5\">2724083</a></td><td><code>Undo rename of build/pkgs/*/spkg-install.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec540dd345a3127ef19bdb2def38e63cdb6a3361\">ec540dd</a></td><td><code>Fix up sage-spkg</code></td></tr></table>\n",
    "created_at": "2020-03-04T13:44:45Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27240830696cfe7c140b98f6120382b99f8b73c5">2724083</a></td><td><code>Undo rename of build/pkgs/*/spkg-install.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec540dd345a3127ef19bdb2def38e63cdb6a3361">ec540dd</a></td><td><code>Fix up sage-spkg</code></td></tr></table>




---

archive/issue_comments_458274.json:
```json
{
    "body": "**Changing commit** from \"[4524b04f9ecff7346aec7d27caf985629f8ca7e8](https://github.com/sagemath/sagetrac-mirror/commit/4524b04f9ecff7346aec7d27caf985629f8ca7e8)\" to \"[ec540dd345a3127ef19bdb2def38e63cdb6a3361](https://github.com/sagemath/sagetrac-mirror/commit/ec540dd345a3127ef19bdb2def38e63cdb6a3361)\".",
    "created_at": "2020-03-04T13:44:45Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4524b04f9ecff7346aec7d27caf985629f8ca7e8](https://github.com/sagemath/sagetrac-mirror/commit/4524b04f9ecff7346aec7d27caf985629f8ca7e8)" to "[ec540dd345a3127ef19bdb2def38e63cdb6a3361](https://github.com/sagemath/sagetrac-mirror/commit/ec540dd345a3127ef19bdb2def38e63cdb6a3361)".



---

archive/issue_comments_458275.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks for the quick reactions. Here's a version that actually has a chance of working",
    "created_at": "2020-03-04T13:45:20Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458275",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Thanks for the quick reactions. Here's a version that actually has a chance of working



---

archive/issue_comments_458276.json:
```json
{
    "body": "<a id='comment:10'></a>\nlooks good to me.",
    "created_at": "2020-03-05T09:02:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458276",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
looks good to me.



---

archive/issue_comments_458277.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-03-05T09:02:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458277",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_258538.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-05T09:02:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258538"
}
```



---

archive/issue_events_258539.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-05T09:02:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258539"
}
```



---

archive/issue_comments_458278.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks!",
    "created_at": "2020-03-05T20:16:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458278",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Thanks!



---

archive/issue_events_258540.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-03-06T13:14:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258540"
}
```



---

archive/issue_events_258541.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-03-06T13:14:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258541"
}
```



---

archive/issue_comments_458279.json:
```json
{
    "body": "<a id='comment:12'></a>\nI think this is a rather disruptive change that doesn't seem well-motivated.  What problem is this fixing?",
    "created_at": "2020-03-06T13:14:35Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458279",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
I think this is a rather disruptive change that doesn't seem well-motivated.  What problem is this fixing?



---

archive/issue_comments_458280.json:
```json
{
    "body": "<a id='comment:13'></a>\nImproper file naming. Templates for scripts should be easily distinguishable from non-templates, i.e. \"real\" scripts. What's so disruptive about it? It's a bit more sanity in a quite complicated setup.",
    "created_at": "2020-03-06T13:39:25Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458280",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
Improper file naming. Templates for scripts should be easily distinguishable from non-templates, i.e. "real" scripts. What's so disruptive about it? It's a bit more sanity in a quite complicated setup.



---

archive/issue_events_258542.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-06T13:40:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258542"
}
```



---

archive/issue_events_258543.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-06T13:40:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258543"
}
```



---

archive/issue_events_258544.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-03-06T13:56:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258544"
}
```



---

archive/issue_events_258545.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-03-06T13:56:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258545"
}
```



---

archive/issue_comments_458281.json:
```json
{
    "body": "<a id='comment:15'></a>\nActually, this confuses me, because the `.in` extension tends to suggest that the real files are generated by a configure script.\n\nAlso, this is only a problem if the generated files live side-by-side with the templates in the source.  The generated files in this case are only created in temporary build directories.  It doesn't actually disrupt anything.\n\nAgain, what real problem is this solving?",
    "created_at": "2020-03-06T13:56:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458281",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Actually, this confuses me, because the `.in` extension tends to suggest that the real files are generated by a configure script.

Also, this is only a problem if the generated files live side-by-side with the templates in the source.  The generated files in this case are only created in temporary build directories.  It doesn't actually disrupt anything.

Again, what real problem is this solving?



---

archive/issue_comments_458282.json:
```json
{
    "body": "<a id='comment:16'></a>\nThis seems to make the instructions for creating SPKGs more confusing as well, and adds disruption in the process that people are already familiar with for now clear gain.  Please don't set tickets to positive review if there is a reasonable disagreement here.",
    "created_at": "2020-03-06T13:57:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458282",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
This seems to make the instructions for creating SPKGs more confusing as well, and adds disruption in the process that people are already familiar with for now clear gain.  Please don't set tickets to positive review if there is a reasonable disagreement here.



---

archive/issue_comments_458283.json:
```json
{
    "body": "<a id='comment:17'></a>\nAlso disruptive: Mass file rename which makes any pending tickets updating SPKGs invalid.  Might also break other existing scripts, etc.  Unless there is a serious problem this is solving it seems way overboard.",
    "created_at": "2020-03-06T13:58:21Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458283",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>
Also disruptive: Mass file rename which makes any pending tickets updating SPKGs invalid.  Might also break other existing scripts, etc.  Unless there is a serious problem this is solving it seems way overboard.



---

archive/issue_comments_458284.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [@dimpase](#comment%3A13):\n> Improper file naming. Templates for scripts should be easily distinguishable from non-templates, i.e. \"real\" scripts.\n\nThey are already distinguished by the fact that they are not marked executable.  If you really want to make a distinction, you can have the files output by `sage-spkg` have a different name, but that's not much clearer.  It's nice when debugging a build directory to have the output `spkg-install` just work.",
    "created_at": "2020-03-06T13:59:39Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458284",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Replying to [@dimpase](#comment%3A13):
> Improper file naming. Templates for scripts should be easily distinguishable from non-templates, i.e. "real" scripts.

They are already distinguished by the fact that they are not marked executable.  If you really want to make a distinction, you can have the files output by `sage-spkg` have a different name, but that's not much clearer.  It's nice when debugging a build directory to have the output `spkg-install` just work.



---

archive/issue_comments_458285.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@dimpase](#comment%3A13):\n> Improper file naming. Templates for scripts should be easily distinguishable from non-templates, \n\nIn fact, come to think of it, these files are not even *templates*.  The *template* is the code in `sage-spkg`:\n\n```\nwrite_script_wrapper() {\n    local script=\"$1\"\n    local script_dir=\"$2\"\n\n    trap \"echo >&2 Error: Unexpected error writing wrapper script for $script; exit \\$_\" ERR\n\n    if head -1 \"$script\" | grep '^#!.*$' >/dev/null; then\n        echo >&2 \"Error: ${script##*/} should not contain a shebang line; it will be prepended automatically.\"\n        exit 1\n    fi\n\n    local tmpscript=\"$(dirname \"$script\")/.tmp-${script##*/}\"\n\n    cat > \"$tmpscript\" <<__EOF__\n#!/usr/bin/env bash\n\nexport SAGE_ROOT=\"$SAGE_ROOT\"\nexport SAGE_SRC=\"$SAGE_SRC\"\nexport SAGE_PKG_DIR=\"$script_dir\"\nexport SAGE_SPKG_SCRIPTS=\"$SAGE_SPKG_SCRIPTS\"\n\nexport PKG_NAME=\"$PKG_NAME\"\nexport PKG_BASE=\"$PKG_BASE\"\nexport PKG_VER=\"$PKG_VER\"\n\nfor lib in \"\\$SAGE_ROOT/build/bin/sage-dist-helpers\" \"\\$SAGE_SRC/bin/sage-env\" \"\\$SAGE_ROOT/build/bin/sage-build-env-config\"; do\n    source \"\\$lib\"\n    if [ \\$? -ne 0 ]; then\n        echo >&2 \"Error: failed to source \\$lib\"\n        echo >&2 \"Is \\$SAGE_ROOT the correct SAGE_ROOT?\"\n        exit 1\n    fi\ndone\n\nsdh_guard\nif [ \\$? -ne 0 ]; then\n    echo >&2 \"Error: sdh_guard not found; Sage environment was not set up properly\"\n    exit 1\nfi\n\ncd \"\\$SAGE_PKG_DIR\"\nif [ \\$? -ne 0 ]; then\n    echo >&2 \"Error: could not cd to the package build directory \\$SAGE_PKG_DIR\"\n    exit 1\nfi\n\n__EOF__\n\n    cat \"$script\" >> \"$tmpscript\"\n    mv \"$tmpscript\" \"$script\"\n    chmod +x \"$script\"\n\n    trap - ERR\n}\n```\n\nThat's the template.  The files in `build/pkg/*/spkg-*` are not templates.  They are snippets that are interpolated into that template.",
    "created_at": "2020-03-06T14:05:07Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458285",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>
Replying to [@dimpase](#comment%3A13):
> Improper file naming. Templates for scripts should be easily distinguishable from non-templates, 

In fact, come to think of it, these files are not even *templates*.  The *template* is the code in `sage-spkg`:

```
write_script_wrapper() {
    local script="$1"
    local script_dir="$2"

    trap "echo >&2 Error: Unexpected error writing wrapper script for $script; exit \$_" ERR

    if head -1 "$script" | grep '^#!.*$' >/dev/null; then
        echo >&2 "Error: ${script##*/} should not contain a shebang line; it will be prepended automatically."
        exit 1
    fi

    local tmpscript="$(dirname "$script")/.tmp-${script##*/}"

    cat > "$tmpscript" <<__EOF__
#!/usr/bin/env bash

export SAGE_ROOT="$SAGE_ROOT"
export SAGE_SRC="$SAGE_SRC"
export SAGE_PKG_DIR="$script_dir"
export SAGE_SPKG_SCRIPTS="$SAGE_SPKG_SCRIPTS"

export PKG_NAME="$PKG_NAME"
export PKG_BASE="$PKG_BASE"
export PKG_VER="$PKG_VER"

for lib in "\$SAGE_ROOT/build/bin/sage-dist-helpers" "\$SAGE_SRC/bin/sage-env" "\$SAGE_ROOT/build/bin/sage-build-env-config"; do
    source "\$lib"
    if [ \$? -ne 0 ]; then
        echo >&2 "Error: failed to source \$lib"
        echo >&2 "Is \$SAGE_ROOT the correct SAGE_ROOT?"
        exit 1
    fi
done

sdh_guard
if [ \$? -ne 0 ]; then
    echo >&2 "Error: sdh_guard not found; Sage environment was not set up properly"
    exit 1
fi

cd "\$SAGE_PKG_DIR"
if [ \$? -ne 0 ]; then
    echo >&2 "Error: could not cd to the package build directory \$SAGE_PKG_DIR"
    exit 1
fi

__EOF__

    cat "$script" >> "$tmpscript"
    mv "$tmpscript" "$script"
    chmod +x "$script"

    trap - ERR
}
```

That's the template.  The files in `build/pkg/*/spkg-*` are not templates.  They are snippets that are interpolated into that template.



---

archive/issue_comments_458286.json:
```json
{
    "body": "<a id='comment:20'></a>\nOK, they are template parameters, if you prefer, that's a better description indeed. What's important is that they are not scripts by themselves.",
    "created_at": "2020-03-06T14:41:39Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458286",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
OK, they are template parameters, if you prefer, that's a better description indeed. What's important is that they are not scripts by themselves.



---

archive/issue_comments_458287.json:
```json
{
    "body": "<a id='comment:21'></a>\nRight.  And that's clear from the lack of shebang line or executable flags.\n\nIf you really want to make a clearer distinction, one idea might be to have the working scripts output by sage-spkg have a `.sh` extension or something.  I don't think it's necessary, but if there is a legitimate confusion that it might clear up I'm for it.",
    "created_at": "2020-03-06T14:53:25Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458287",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
Right.  And that's clear from the lack of shebang line or executable flags.

If you really want to make a clearer distinction, one idea might be to have the working scripts output by sage-spkg have a `.sh` extension or something.  I don't think it's necessary, but if there is a legitimate confusion that it might clear up I'm for it.



---

archive/issue_comments_458288.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe files could just as well be generated by configure. The only thing that's missing for that is a line\n\n```\n@SPKG_SCRIPT@\n```\non top of each of the .in files. I'm not proposing to do that in this ticket. But I hope this explains why the files now have the .in extension.",
    "created_at": "2020-03-06T15:05:29Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458288",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
The files could just as well be generated by configure. The only thing that's missing for that is a line

```
@SPKG_SCRIPT@
```
on top of each of the .in files. I'm not proposing to do that in this ticket. But I hope this explains why the files now have the .in extension.



---

archive/issue_comments_458289.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [@embray](#comment%3A21):\n> Right.  And that's clear from the lack of shebang line or executable flags.\n> \n> If you really want to make a clearer distinction, one idea might be to have the working scripts output by sage-spkg have a `.sh` extension or something.  I don't think it's necessary, but if there is a legitimate confusion that it might clear up I'm for it.\n\nthere are `build/pkgs/*/spkg-install` files which are proper shell scripts (for spkgs which are of type `script`).\nOne should make them namewise-distinct from templates, e.g. as done on this branch, or by appending `.sh` to them.",
    "created_at": "2020-03-06T15:18:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458289",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>
Replying to [@embray](#comment%3A21):
> Right.  And that's clear from the lack of shebang line or executable flags.
> 
> If you really want to make a clearer distinction, one idea might be to have the working scripts output by sage-spkg have a `.sh` extension or something.  I don't think it's necessary, but if there is a legitimate confusion that it might clear up I'm for it.

there are `build/pkgs/*/spkg-install` files which are proper shell scripts (for spkgs which are of type `script`).
One should make them namewise-distinct from templates, e.g. as done on this branch, or by appending `.sh` to them.



---

archive/issue_comments_458290.json:
```json
{
    "body": "<a id='comment:25'></a>\nI think the name changes are justified.",
    "created_at": "2020-03-06T20:42:09Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458290",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>
I think the name changes are justified.



---

archive/issue_events_258546.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-06T20:42:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258546"
}
```



---

archive/issue_events_258547.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-06T20:42:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258547"
}
```



---

archive/issue_comments_458291.json:
```json
{
    "body": "<a id='comment:26'></a>\nIt would be less invasive but accomplish the same thing (wouldn't it?) if we kept the `spkg-install` files as they are, but had `sage-spkg` create new scripts `spkg-install.sh` in the build directories.\n\nWould that make everyone happy? Or at least be a reasonable compromise?",
    "created_at": "2020-03-06T21:13:37Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458291",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
It would be less invasive but accomplish the same thing (wouldn't it?) if we kept the `spkg-install` files as they are, but had `sage-spkg` create new scripts `spkg-install.sh` in the build directories.

Would that make everyone happy? Or at least be a reasonable compromise?



---

archive/issue_events_258548.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-06T21:13:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258548"
}
```



---

archive/issue_events_258549.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-06T21:13:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258549"
}
```



---

archive/issue_comments_458292.json:
```json
{
    "body": "<a id='comment:27'></a>\nas I explained in [comment:23](#comment%3A23), some of these files are scripts, and some (most) are not.\n\nThe invasive change happened when most of these files stopped being scripts, so this ticket merely sets the record straight.",
    "created_at": "2020-03-06T21:35:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458292",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>
as I explained in [comment:23](#comment%3A23), some of these files are scripts, and some (most) are not.

The invasive change happened when most of these files stopped being scripts, so this ticket merely sets the record straight.



---

archive/issue_comments_458293.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [@embray](#comment%3A17):\n> Also disruptive: Mass file rename which makes any pending tickets updating SPKGs invalid.  \n\nAny merge conflicts of this kind are trivial to resolve.\n> Might also break other existing scripts, etc.  \n\nThis is unsubstantiated.",
    "created_at": "2020-03-06T21:39:04Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458293",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Replying to [@embray](#comment%3A17):
> Also disruptive: Mass file rename which makes any pending tickets updating SPKGs invalid.  

Any merge conflicts of this kind are trivial to resolve.
> Might also break other existing scripts, etc.  

This is unsubstantiated.



---

archive/issue_comments_458294.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [@embray](#comment%3A19):\n> Replying to [@dimpase](#comment%3A13):\n> > Improper file naming. Templates for scripts should be easily distinguishable from non-templates, \n\n> \n> In fact, come to think of it, these files are not even *templates*.  \n\nIf you have a better word for this, I'll be happy to change the documentation.\nAutoconf just calls these files \"input files\" (hence .in)",
    "created_at": "2020-03-06T21:43:48Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458294",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Replying to [@embray](#comment%3A19):
> Replying to [@dimpase](#comment%3A13):
> > Improper file naming. Templates for scripts should be easily distinguishable from non-templates, 

> 
> In fact, come to think of it, these files are not even *templates*.  

If you have a better word for this, I'll be happy to change the documentation.
Autoconf just calls these files "input files" (hence .in)



---

archive/issue_comments_458295.json:
```json
{
    "body": "<a id='comment:30'></a>\nAlso there aren't many open tickets changing these files, so that's very minor problem, if at all. Actually while we are at it I would go further and drop these `spkg-` and `package-` prefixes everywhere in build/pkgs/*/, too.",
    "created_at": "2020-03-06T21:48:01Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458295",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>
Also there aren't many open tickets changing these files, so that's very minor problem, if at all. Actually while we are at it I would go further and drop these `spkg-` and `package-` prefixes everywhere in build/pkgs/*/, too.



---

archive/issue_comments_458296.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [@dimpase](#comment%3A30):\n> Actually while we are at it I would go further and drop these `spkg-` and `package-` prefixes everywhere in build/pkgs/*/, too.\n\nThis will only be possible after #29289 (Remove support for old-style SPKGs). So let's not do this in this ticket.",
    "created_at": "2020-03-06T22:15:31Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458296",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Replying to [@dimpase](#comment%3A30):
> Actually while we are at it I would go further and drop these `spkg-` and `package-` prefixes everywhere in build/pkgs/*/, too.

This will only be possible after #29289 (Remove support for old-style SPKGs). So let's not do this in this ticket.



---

archive/issue_comments_458297.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,4 @@\n \n This ticket renames all `build/pkgs/SPKG/spkg-*` of packages other than `type=script` (which are regular executable shell scripts already) to `build/pkgs/SPKG/spkg-*.in`.\n \n+In addition to the increased clarity, this is preparation for #29122 (Build packages in `build/pkgs/SPKG/src`, not `SAGE_LOCAL/var/tmp/sage/build/SPKG-...`).\n``````\n",
    "created_at": "2020-03-06T22:20:05Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458297",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,4 @@
 
 This ticket renames all `build/pkgs/SPKG/spkg-*` of packages other than `type=script` (which are regular executable shell scripts already) to `build/pkgs/SPKG/spkg-*.in`.
 
+In addition to the increased clarity, this is preparation for #29122 (Build packages in `build/pkgs/SPKG/src`, not `SAGE_LOCAL/var/tmp/sage/build/SPKG-...`).
``````




---

archive/issue_comments_458298.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [@dimpase](#comment%3A27):\n> as I explained in [comment:23](#comment%3A23), some of these files are scripts, and some (most) are not.\n> \n> The invasive change happened when most of these files stopped being scripts, so this ticket merely sets the record straight.\n\nYou are using the word \"invasive\" differently than the rest of us, I think. I just mean: it touches a lot of files.\n\nAnyway, it's nice to see everyone so entrenched in their positions.",
    "created_at": "2020-03-06T22:41:35Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458298",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:33'></a>
Replying to [@dimpase](#comment%3A27):
> as I explained in [comment:23](#comment%3A23), some of these files are scripts, and some (most) are not.
> 
> The invasive change happened when most of these files stopped being scripts, so this ticket merely sets the record straight.

You are using the word "invasive" differently than the rest of us, I think. I just mean: it touches a lot of files.

Anyway, it's nice to see everyone so entrenched in their positions.



---

archive/issue_events_258550.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-06T22:41:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258550"
}
```



---

archive/issue_events_258551.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-06T22:41:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258551"
}
```



---

archive/issue_comments_458299.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik\" to \"Dima Pasechnik, John Palmieri\".",
    "created_at": "2020-03-06T23:01:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458299",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Dima Pasechnik" to "Dima Pasechnik, John Palmieri".



---

archive/issue_comments_458300.json:
```json
{
    "body": "<a id='comment:35'></a>\nNothing to merge",
    "created_at": "2020-03-08T22:20:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458300",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>
Nothing to merge



---

archive/issue_events_258552.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:20:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258552"
}
```



---

archive/issue_events_258553.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:20:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258553"
}
```



---

archive/issue_events_258554.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:25:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258554"
}
```



---

archive/issue_events_258555.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:25:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258555"
}
```



---

archive/issue_comments_458301.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/rename_spkg_build__spkg_install_etc__templates_as_spkg_build_in__spkg_install_in_etc_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/rename_spkg_build__spkg_install_etc__templates_as_spkg_build_in__spkg_install_in_etc_)\" to \"[ec540dd345a3127ef19bdb2def38e63cdb6a3361](https://github.com/sagemath/sagetrac-mirror/commit/ec540dd345a3127ef19bdb2def38e63cdb6a3361)\".",
    "created_at": "2020-03-10T23:27:45Z",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29096#issuecomment-458301",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/rename_spkg_build__spkg_install_etc__templates_as_spkg_build_in__spkg_install_in_etc_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/rename_spkg_build__spkg_install_etc__templates_as_spkg_build_in__spkg_install_in_etc_)" to "[ec540dd345a3127ef19bdb2def38e63cdb6a3361](https://github.com/sagemath/sagetrac-mirror/commit/ec540dd345a3127ef19bdb2def38e63cdb6a3361)".



---

archive/issue_events_258556.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-10T23:27:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258556"
}
```



---

archive/issue_events_258557.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a9807d446f7f1791e3e2bfb51cfc09d35916b8c0",
    "created_at": "2020-03-10T23:27:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29096",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29096#event-258557"
}
```
