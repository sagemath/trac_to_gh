# Issue 29408: Fix build errors with pplpy, scipy, kiwisolver, fpylll on macos with system python3

archive/issues_029171.json:
```json
{
    "assignees": [],
    "body": "On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with `pplpy`, as seen in https://github.com/mkoeppe/sage/runs/538432631:\n\n```\n    g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so\n    clang: error: unknown argument: '-sdk'\n    clang: error: no such file or directory: 'macosx'\n    clang: error: no such file or directory: 'clang'\n    error: command 'g++' failed with exit status 1\n    Running setup.py install for pplpy: finished with status 'error'\nCleaning up...\n```\n\nSame kind of error with scipy, kiwisolver, fpylll.\n\nFull logs can be downloaded at the above link.\n\nTo test locally, using #29104 + #27824, remove all python3 from the homebrew in /usr/local \nand run\n\n```\ntox -e local-homebrew-macos-standard -- V=0 pplpy\n```\nWith #29417, it is:\n\n```\ntox -e local-homebrew-macos-standard-python3_xcode -- V=0 pplpy\n```\n\n\n\n(broken out from #29404)\n\nCC:  @dimpase @videlec @kiwifb @mwageringel @embray @jhpalmieri @vbraun\n\nBranch/Commit: **[`8317c3e`](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)**\n\nReviewer: **John Palmieri**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29408_\n\n",
    "closed_at": "2020-04-15T22:13:18Z",
    "created_at": "2020-03-26T02:10:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix build errors with pplpy, scipy, kiwisolver, fpylll on macos with system python3",
    "type": "issue",
    "updated_at": "2020-04-15T22:13:18Z",
    "url": "https://github.com/sagemath/sage/issues/29408",
    "user": "https://github.com/mkoeppe"
}
```
On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with `pplpy`, as seen in https://github.com/mkoeppe/sage/runs/538432631:

```
    g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so
    clang: error: unknown argument: '-sdk'
    clang: error: no such file or directory: 'macosx'
    clang: error: no such file or directory: 'clang'
    error: command 'g++' failed with exit status 1
    Running setup.py install for pplpy: finished with status 'error'
Cleaning up...
```

Same kind of error with scipy, kiwisolver, fpylll.

Full logs can be downloaded at the above link.

To test locally, using #29104 + #27824, remove all python3 from the homebrew in /usr/local 
and run

```
tox -e local-homebrew-macos-standard -- V=0 pplpy
```
With #29417, it is:

```
tox -e local-homebrew-macos-standard-python3_xcode -- V=0 pplpy
```



(broken out from #29404)

CC:  @dimpase @videlec @kiwifb @mwageringel @embray @jhpalmieri @vbraun

Branch/Commit: **[`8317c3e`](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)**

Reviewer: **John Palmieri**

Author: **Matthias Koeppe**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/29408_





---

archive/issue_events_404384.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-26T02:10:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404384"
}
```



---

archive/issue_events_404385.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-26T02:10:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404385"
}
```



---

archive/issue_events_404386.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-26T02:10:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404386"
}
```



---

archive/issue_events_404387.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-26T02:10:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404387"
}
```



---

archive/issue_comments_461868.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nthis needs details on the Python (system MacOS? Homebrew? CPython package?) and on clang (XCode? Homebrew? Other (e.g. conda?))",
    "created_at": "2020-03-26T02:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461868",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

this needs details on the Python (system MacOS? Homebrew? CPython package?) and on clang (XCode? Homebrew? Other (e.g. conda?))



---

archive/issue_comments_461869.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,4 @@\n-https://github.com/mkoeppe/sage/runs/531095486\n-\n-pplpy:\n+On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with pply, as seen in https://github.com/mkoeppe/sage/runs/531095486:\n \n ```\n     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so\n@@ -12,4 +10,6 @@\n Cleaning up...\n ```\n \n+Full logs can be downloaded at the above link.\n+\n (broken out from #29404)\n``````\n",
    "created_at": "2020-03-26T02:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461869",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,4 @@
-https://github.com/mkoeppe/sage/runs/531095486
-
-pplpy:
+On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with pply, as seen in https://github.com/mkoeppe/sage/runs/531095486:
 
 ```
     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so
@@ -12,4 +10,6 @@
 Cleaning up...
 ```
 
+Full logs can be downloaded at the above link.
+
 (broken out from #29404)
``````




---

archive/issue_comments_461870.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nwhat I gather from these links is that Pythons in MacOS are not Homebrew ones.",
    "created_at": "2020-03-26T03:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461870",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

what I gather from these links is that Pythons in MacOS are not Homebrew ones.



---

archive/issue_comments_461871.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with pply, as seen in https://github.com/mkoeppe/sage/runs/531095486:\n+On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with `pplpy`, as seen in https://github.com/mkoeppe/sage/runs/538432631:\n \n ```\n     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so\n@@ -10,6 +10,8 @@\n Cleaning up...\n ```\n \n+Same kind of error with scipy, kiwisolver, fpylll.\n+\n Full logs can be downloaded at the above link.\n \n (broken out from #29404)\n``````\n",
    "created_at": "2020-03-27T14:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461871",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with pply, as seen in https://github.com/mkoeppe/sage/runs/531095486:
+On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with `pplpy`, as seen in https://github.com/mkoeppe/sage/runs/538432631:
 
 ```
     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so
@@ -10,6 +10,8 @@
 Cleaning up...
 ```
 
+Same kind of error with scipy, kiwisolver, fpylll.
+
 Full logs can be downloaded at the above link.
 
 (broken out from #29404)
``````




---

archive/issue_events_404388.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-27T14:56:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "title_is": "Fix build errors with pplpy, scipy, kiwisolver, fpylll on macos with system python3",
    "title_was": "Fix build errors with pplpy on macos with system python3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404388"
}
```



---

archive/issue_comments_461872.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@dimpase](#comment:3):\n> what I gather from these links is that Pythons in MacOS are not Homebrew ones.\n\nThat's right, this is system python3 from `/usr/bin`",
    "created_at": "2020-03-27T14:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461872",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@dimpase](#comment:3):
> what I gather from these links is that Pythons in MacOS are not Homebrew ones.

That's right, this is system python3 from `/usr/bin`



---

archive/issue_comments_461873.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,4 +14,11 @@\n \n Full logs can be downloaded at the above link.\n \n+To test locally, using #29104 + #27824, remove all python3 from the homebrew in /usr/local \n+and run\n+\n+```\n+tox -e local-homebrew-macos-standard -- V=0 pplpy\n+```\n+\n (broken out from #29404)\n``````\n",
    "created_at": "2020-03-27T15:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461873",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,4 +14,11 @@
 
 Full logs can be downloaded at the above link.
 
+To test locally, using #29104 + #27824, remove all python3 from the homebrew in /usr/local 
+and run
+
+```
+tox -e local-homebrew-macos-standard -- V=0 pplpy
+```
+
 (broken out from #29404)
``````




---

archive/issue_comments_461874.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSomething seems to get very confused about values from sysconfig as it tries to replace `xcrun` by `g++`.\n\n```\n>>> for k, v in sysconfig.get_config_vars().items():\n...     if isinstance(v, str) and 'sdk' in v:\n...         print(k, v)\n... \nBLDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup \nCC xcrun -sdk macosx clang    -arch x86_64 \nCONFIG_ARGS '-C' '--host=x86_64-apple-darwin' '--build=x86_64-apple-darwin' '--enable-framework=/Applications/Xcode.app/Contents/Developer/Library/Frameworks' '--with-framework-name=Python3' '--with-openssl=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Root/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7' '--enable-ipv6' '--prefix=/Applications/Xcode.app/Contents/Developer/usr' '--with-pymalloc' 'PYTHON_FOR_BUILD=DYLD_FRAMEWORK_PATH=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects/host /BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects/host/python.exe' 'CC=xcrun -sdk macosx clang    -arch x86_64' 'CXX=xcrun -sdk macosx clang++  -arch x86_64' 'CPP=xcrun -sdk macosx clang -E -arch x86_64' 'CFLAGS=-iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/Headers' 'CPPFLAGS=-iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/Headers' 'LIBS=-lSystem' 'LDFLAGS=' 'OBJROOT=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects' 'SDKROOT=/BuildRoot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.Internal.sdk' 'build_alias=x86_64-apple-darwin' 'host_alias=x86_64-apple-darwin'\nCXX xcrun -sdk macosx clang++  -arch x86_64 \nLDCXXSHARED xcrun -sdk macosx clang++  -arch x86_64 -bundle -undefined dynamic_lookup\nLDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup \nLINKCC xcrun -sdk macosx clang    -arch x86_64\nMAINCC xcrun -sdk macosx clang    -arch x86_64\nSDKROOT /BuildRoot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.Internal.sdk\n_OSX_SUPPORT_INITIAL_BLDSHARED xcrun -sdk macosx clang    -arch x86_64 -bundle -undefined dynamic_lookup\n_OSX_SUPPORT_INITIAL_LDSHARED xcrun -sdk macosx clang    -arch x86_64 -bundle -undefined dynamic_lookup\n_OSX_SUPPORT_INITIAL_CC xcrun -sdk macosx clang    -arch x86_64\n_OSX_SUPPORT_INITIAL_CXX xcrun -sdk macosx clang++  -arch x86_64\n```",
    "created_at": "2020-03-27T19:54:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461874",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Something seems to get very confused about values from sysconfig as it tries to replace `xcrun` by `g++`.

```
>>> for k, v in sysconfig.get_config_vars().items():
...     if isinstance(v, str) and 'sdk' in v:
...         print(k, v)
... 
BLDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup 
CC xcrun -sdk macosx clang    -arch x86_64 
CONFIG_ARGS '-C' '--host=x86_64-apple-darwin' '--build=x86_64-apple-darwin' '--enable-framework=/Applications/Xcode.app/Contents/Developer/Library/Frameworks' '--with-framework-name=Python3' '--with-openssl=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Root/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7' '--enable-ipv6' '--prefix=/Applications/Xcode.app/Contents/Developer/usr' '--with-pymalloc' 'PYTHON_FOR_BUILD=DYLD_FRAMEWORK_PATH=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects/host /BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects/host/python.exe' 'CC=xcrun -sdk macosx clang    -arch x86_64' 'CXX=xcrun -sdk macosx clang++  -arch x86_64' 'CPP=xcrun -sdk macosx clang -E -arch x86_64' 'CFLAGS=-iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/Headers' 'CPPFLAGS=-iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/Headers' 'LIBS=-lSystem' 'LDFLAGS=' 'OBJROOT=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects' 'SDKROOT=/BuildRoot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.Internal.sdk' 'build_alias=x86_64-apple-darwin' 'host_alias=x86_64-apple-darwin'
CXX xcrun -sdk macosx clang++  -arch x86_64 
LDCXXSHARED xcrun -sdk macosx clang++  -arch x86_64 -bundle -undefined dynamic_lookup
LDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup 
LINKCC xcrun -sdk macosx clang    -arch x86_64
MAINCC xcrun -sdk macosx clang    -arch x86_64
SDKROOT /BuildRoot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.Internal.sdk
_OSX_SUPPORT_INITIAL_BLDSHARED xcrun -sdk macosx clang    -arch x86_64 -bundle -undefined dynamic_lookup
_OSX_SUPPORT_INITIAL_LDSHARED xcrun -sdk macosx clang    -arch x86_64 -bundle -undefined dynamic_lookup
_OSX_SUPPORT_INITIAL_CC xcrun -sdk macosx clang    -arch x86_64
_OSX_SUPPORT_INITIAL_CXX xcrun -sdk macosx clang++  -arch x86_64
```



---

archive/issue_comments_461875.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIt is caused by bizarre code in `distutils.unixccompiler.UnixCCompiler.link`.",
    "created_at": "2020-03-27T20:36:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461875",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

It is caused by bizarre code in `distutils.unixccompiler.UnixCCompiler.link`.



---

archive/issue_comments_461876.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nhttps://github.com/python/cpython/blob/master/Lib/distutils/unixccompiler.py#L180\nwith \n\n```\n(Pdb) p self.linker_so\n['xcrun', '-sdk', 'macosx', 'clang', '-bundle', '-undefined', 'dynamic_lookup', '-L/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib', '-Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib', '-L/usr/local/opt/readline/lib', '-L/usr/local/lib', '-I/usr/local/opt/readline/include', '-I/usr/local/include']\n(Pdb) p self.compiler_cxx\n['g++', '-std=gnu++11']\n```",
    "created_at": "2020-03-27T20:38:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461876",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

https://github.com/python/cpython/blob/master/Lib/distutils/unixccompiler.py#L180
with 

```
(Pdb) p self.linker_so
['xcrun', '-sdk', 'macosx', 'clang', '-bundle', '-undefined', 'dynamic_lookup', '-L/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib', '-Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib', '-L/usr/local/opt/readline/lib', '-L/usr/local/lib', '-I/usr/local/opt/readline/include', '-I/usr/local/include']
(Pdb) p self.compiler_cxx
['g++', '-std=gnu++11']
```



---

archive/issue_comments_461877.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYes, my head hurts when I look at that file. I am fairly sure distros all over have patches for some aspects of it.\n\nFrom the line it expect some behavior from xcode.",
    "created_at": "2020-03-27T20:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461877",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

Yes, my head hurts when I look at that file. I am fairly sure distros all over have patches for some aspects of it.

From the line it expect some behavior from xcode.



---

archive/issue_comments_461878.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHum\n\n```\nfbissey@itsv-frb15 ~ % xcrun --help\nUsage: xcrun [options] <tool name> ... arguments ...\n\nFind and execute the named command line tool from the active developer\ndirectory.\n\nThe active developer directory can be set using `xcode-select`, or via the\nDEVELOPER_DIR environment variable. See the xcrun and xcode-select manual\npages for more information.\n\nOptions:\n  -h, --help                  show this help message and exit\n  --version                   show the xcrun version\n  -v, --verbose               show verbose logging output\n  --sdk <sdk name>            find the tool for the given SDK name\n  --toolchain <name>          find the tool for the given toolchain\n  -l, --log                   show commands to be executed (with --run)\n  -f, --find                  only find and print the tool path\n  -r, --run                   find and execute the tool (the default behavior)\n  -n, --no-cache              do not use the lookup cache\n  -k, --kill-cache            invalidate all existing cache entries\n  --show-sdk-path             show selected SDK install path\n  --show-sdk-version          show selected SDK version\n  --show-sdk-build-version    show selected SDK build version\n  --show-sdk-platform-path    show selected SDK platform path\n  --show-sdk-platform-version show selected SDK platform version\n```\nIs it just a stupid `--` versus `-`?",
    "created_at": "2020-03-27T20:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461878",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

Hum

```
fbissey@itsv-frb15 ~ % xcrun --help
Usage: xcrun [options] <tool name> ... arguments ...

Find and execute the named command line tool from the active developer
directory.

The active developer directory can be set using `xcode-select`, or via the
DEVELOPER_DIR environment variable. See the xcrun and xcode-select manual
pages for more information.

Options:
  -h, --help                  show this help message and exit
  --version                   show the xcrun version
  -v, --verbose               show verbose logging output
  --sdk <sdk name>            find the tool for the given SDK name
  --toolchain <name>          find the tool for the given toolchain
  -l, --log                   show commands to be executed (with --run)
  -f, --find                  only find and print the tool path
  -r, --run                   find and execute the tool (the default behavior)
  -n, --no-cache              do not use the lookup cache
  -k, --kill-cache            invalidate all existing cache entries
  --show-sdk-path             show selected SDK install path
  --show-sdk-version          show selected SDK version
  --show-sdk-build-version    show selected SDK build version
  --show-sdk-platform-path    show selected SDK platform path
  --show-sdk-platform-version show selected SDK platform version
```
Is it just a stupid `--` versus `-`?



---

archive/issue_comments_461879.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nNo, the linked code is really replacing \"xcrun\" by \"g++\".",
    "created_at": "2020-03-27T20:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461879",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

No, the linked code is really replacing "xcrun" by "g++".



---

archive/issue_comments_461880.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nMore context, more fun at https://github.com/python/cpython/blob/master/Lib/_osx_support.py",
    "created_at": "2020-03-27T20:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461880",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

More context, more fun at https://github.com/python/cpython/blob/master/Lib/_osx_support.py



---

archive/issue_comments_461881.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nEach of `xcrun -sdk macosx clang`, `g++`, and `xcrun -sdk macosx clang++`  make sense.\nBut the code tries to mix the first two to get the third, and gets `g++  -sdk macosx clang`, which makes no sense, obviously.",
    "created_at": "2020-03-27T20:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461881",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

Each of `xcrun -sdk macosx clang`, `g++`, and `xcrun -sdk macosx clang++`  make sense.
But the code tries to mix the first two to get the third, and gets `g++  -sdk macosx clang`, which makes no sense, obviously.



---

archive/issue_comments_461882.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nGoogle search for LDCXXSHARED distutils brings up various things\n\nhttps://www.google.com/search?safe=off&sxsrf=ALeKk01RyL6O3kSKx0-W2ZRb3O8N8Pdg-A:1585342860000&q=LDCXXSHARED+distutils&nfpr=1&sa=X&ved=2ahUKEwiSrZGwxrvoAhWkl3IEHZtFCmEQvgUoAXoECAwQKA&biw=875&bih=862",
    "created_at": "2020-03-27T21:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461882",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Google search for LDCXXSHARED distutils brings up various things

https://www.google.com/search?safe=off&sxsrf=ALeKk01RyL6O3kSKx0-W2ZRb3O8N8Pdg-A:1585342860000&q=LDCXXSHARED+distutils&nfpr=1&sa=X&ved=2ahUKEwiSrZGwxrvoAhWkl3IEHZtFCmEQvgUoAXoECAwQKA&biw=875&bih=862



---

archive/issue_comments_461883.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIt's an existing Python issue: https://bugs.python.org/issue8027",
    "created_at": "2020-03-27T21:07:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461883",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

It's an existing Python issue: https://bugs.python.org/issue8027



---

archive/issue_comments_461884.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nMore precisely, this one: https://bugs.python.org/issue1222585",
    "created_at": "2020-03-27T21:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461884",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

More precisely, this one: https://bugs.python.org/issue1222585



---

archive/issue_comments_461885.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n... open since 2005",
    "created_at": "2020-03-27T21:11:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461885",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

... open since 2005



---

archive/issue_comments_461886.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nRelated previous issue: #17484",
    "created_at": "2020-03-27T21:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461886",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Related previous issue: #17484



---

archive/issue_comments_461887.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@mkoeppe](#comment:19):\n> ... open since 2005\n\nUpstream python does have a bad history of compiler/linker support (especially differentiation between C and C++ actually).",
    "created_at": "2020-03-27T21:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461887",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@mkoeppe](#comment:19):
> ... open since 2005

Upstream python does have a bad history of compiler/linker support (especially differentiation between C and C++ actually).



---

archive/issue_comments_461888.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nA simple workaround is to clear the CXX environment variable before we call the installation.\nThen it will build the extension using the compiler configured in python's sysconfig.",
    "created_at": "2020-03-27T21:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461888",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

A simple workaround is to clear the CXX environment variable before we call the installation.
Then it will build the extension using the compiler configured in python's sysconfig.



---

archive/issue_comments_461889.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nHum, OK but only for OSX. The problem is that we set CXX as a c++11 compiler which means CXX may actually be `g++ -std=c++11` (or `gnu++11` actually) in most case. On OS X, clang++ is c++11 at least by default so we can afford that. On other platforms, we would run into troubles.\n\nWhy does CXX includes `-std=c++11` rather than it being a separate CPPFLAGS? Because CXX as a whole is defined as a c++11 compiler.",
    "created_at": "2020-03-27T21:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461889",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:23" align="right">comment:23</div>

Hum, OK but only for OSX. The problem is that we set CXX as a c++11 compiler which means CXX may actually be `g++ -std=c++11` (or `gnu++11` actually) in most case. On OS X, clang++ is c++11 at least by default so we can afford that. On other platforms, we would run into troubles.

Why does CXX includes `-std=c++11` rather than it being a separate CPPFLAGS? Because CXX as a whole is defined as a c++11 compiler.



---

archive/issue_comments_461890.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOur own python3 has `g++ -std=c++11` in its sysconfig CXX in that case.\n\nBut you are right, for a system python3, we would not be able to assume that the sysconfig CXX is a C++11 compiler.",
    "created_at": "2020-03-27T22:22:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461890",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Our own python3 has `g++ -std=c++11` in its sysconfig CXX in that case.

But you are right, for a system python3, we would not be able to assume that the sysconfig CXX is a C++11 compiler.



---

archive/issue_comments_461891.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nSo I guess this needs to be figured out at configure time.",
    "created_at": "2020-03-27T22:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461891",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

So I guess this needs to be figured out at configure time.



---

archive/issue_comments_461892.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nA different workaround is to set `LDSHARED=\"$CXX -bundle -undefined dynamic_lookup\"`.",
    "created_at": "2020-03-27T22:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461892",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

A different workaround is to set `LDSHARED="$CXX -bundle -undefined dynamic_lookup"`.



---

archive/issue_comments_461893.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThat sounds interesting! And it avoids the c++11 mess.",
    "created_at": "2020-03-27T22:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461893",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:27" align="right">comment:27</div>

That sounds interesting! And it avoids the c++11 mess.



---

archive/issue_comments_461894.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nSo, a macOS-specific workaround for all Python packages that use C++ extensions?",
    "created_at": "2020-03-27T22:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461894",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

So, a macOS-specific workaround for all Python packages that use C++ extensions?



---

archive/issue_comments_461895.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nUnfortunately, pretty much.",
    "created_at": "2020-03-27T22:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461895",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:29" align="right">comment:29</div>

Unfortunately, pretty much.



---

archive/issue_comments_461896.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nInteresting is also this test:\nhttps://github.com/python/cpython/blob/e42b705188271da108de42b55d9344642170aa2b/Lib/distutils/tests/test_unixccompiler.py#L105\nwhich corresponds to https://bugs.python.org/issue18080. \nThe code added in this issue is unfortunately made ineffective by the fact that in Apple's installation, `cc = \"xcrun -sdk macosx clang    -arch x86_64 \"` and `ldshared = \"xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup \"`, i.e., `ldshared.startswith(cc)` is False.",
    "created_at": "2020-03-27T23:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461896",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

Interesting is also this test:
https://github.com/python/cpython/blob/e42b705188271da108de42b55d9344642170aa2b/Lib/distutils/tests/test_unixccompiler.py#L105
which corresponds to https://bugs.python.org/issue18080. 
The code added in this issue is unfortunately made ineffective by the fact that in Apple's installation, `cc = "xcrun -sdk macosx clang    -arch x86_64 "` and `ldshared = "xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup "`, i.e., `ldshared.startswith(cc)` is False.



---

archive/issue_comments_461897.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nA candidate for a portable solution, to be applied to all Python packages that build C++ extensions would be:\n\n```\nLDSHARED=$(/usr/bin/python -c 'import sysconfig; print(sysconfig.get_config_var(\"LDCXXSHARED\"))')\n```",
    "created_at": "2020-03-27T23:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461897",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

A candidate for a portable solution, to be applied to all Python packages that build C++ extensions would be:

```
LDSHARED=$(/usr/bin/python -c 'import sysconfig; print(sysconfig.get_config_var("LDCXXSHARED"))')
```



---

archive/issue_comments_461898.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nWith this, packages would still compile with CXX (which would include the C++11 flags if needed), but link with the C++ linker known to sysconfig.",
    "created_at": "2020-03-27T23:30:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461898",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

With this, packages would still compile with CXX (which would include the C++11 flags if needed), but link with the C++ linker known to sysconfig.



---

archive/issue_comments_461899.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@mkoeppe](#comment:31):\n> A candidate for a portable solution, to be applied to all Python packages that build C++ extensions would be:\n> \n> ```\n> LDSHARED=$(/usr/bin/python -c 'import sysconfig; print(sysconfig.get_config_var(\"LDCXXSHARED\"))')\n> ```\n\nI don't like the `/usr/bin/python` bit, but I am sure we can replace that by something appropriate. That sounds like a good idea and now it needs to be tested.",
    "created_at": "2020-03-27T23:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461899",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@mkoeppe](#comment:31):
> A candidate for a portable solution, to be applied to all Python packages that build C++ extensions would be:
> 
> ```
> LDSHARED=$(/usr/bin/python -c 'import sysconfig; print(sysconfig.get_config_var("LDCXXSHARED"))')
> ```

I don't like the `/usr/bin/python` bit, but I am sure we can replace that by something appropriate. That sounds like a good idea and now it needs to be tested.



---

archive/issue_comments_461900.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nRight, of course it would be `LDSHARED=$(sage-python23 -c 'import sysconfig; print(sysconfig.get_config_var(\"LDCXXSHARED\"))').`",
    "created_at": "2020-03-27T23:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461900",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

Right, of course it would be `LDSHARED=$(sage-python23 -c 'import sysconfig; print(sysconfig.get_config_var("LDCXXSHARED"))').`



---

archive/issue_comments_461901.json:
```json
{
    "body": "Branch: **[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)**",
    "created_at": "2020-03-28T03:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461901",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)**



---

archive/issue_comments_461902.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThis did not work after all, but I have found a solution that seems to work and is reasonably clean.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629\"><code>4541e18</code></a></td><td><code>src/bin/sage-env: Set LDSHARED when CXX is set</code></td></tr></table>\n",
    "created_at": "2020-03-28T03:05:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461902",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

This did not work after all, but I have found a solution that seems to work and is reasonably clean.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629"><code>4541e18</code></a></td><td><code>src/bin/sage-env: Set LDSHARED when CXX is set</code></td></tr></table>




---

archive/issue_comments_461903.json:
```json
{
    "body": "Commit: **[`4541e18`](https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629)**",
    "created_at": "2020-03-28T03:05:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461903",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`4541e18`](https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629)**



---

archive/issue_comments_461904.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nSetting this unconditionally in `sage-env` rather than in package build scripts -- to make sure that these settings are in place even when a user does a `sage -pip install` of some random package.",
    "created_at": "2020-03-28T03:06:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461904",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Setting this unconditionally in `sage-env` rather than in package build scripts -- to make sure that these settings are in place even when a user does a `sage -pip install` of some random package.



---

archive/issue_comments_461905.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-03-28T03:08:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461905",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_461906.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nLooks OK to me. I guess you have some bots testing it out.",
    "created_at": "2020-03-28T03:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461906",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:39" align="right">comment:39</div>

Looks OK to me. I guess you have some bots testing it out.



---

archive/issue_comments_461907.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nTests run at https://github.com/mkoeppe/sage/actions/runs/65083365",
    "created_at": "2020-03-28T03:42:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461907",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

Tests run at https://github.com/mkoeppe/sage/actions/runs/65083365



---

archive/issue_events_404389.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T03:42:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404389"
}
```



---

archive/issue_comments_461908.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nThis breaks matplotlib via numpy unfortunately",
    "created_at": "2020-03-28T14:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461908",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

This breaks matplotlib via numpy unfortunately



---

archive/issue_events_404390.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T14:30:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404390"
}
```



---

archive/issue_events_404391.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T14:30:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404391"
}
```



---

archive/issue_comments_461909.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\n\n```\n        from numpy.core._multiarray_umath import (\n    ImportError: /sage/local/lib/python3.7/site-packages/numpy/core/_multiarray_umath.cpython-37m-x86_64-linux-gnu.so: undefined symbol: __cpu_model\n\n```",
    "created_at": "2020-03-28T14:30:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461909",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43" align="right">comment:43</div>


```
        from numpy.core._multiarray_umath import (
    ImportError: /sage/local/lib/python3.7/site-packages/numpy/core/_multiarray_umath.cpython-37m-x86_64-linux-gnu.so: undefined symbol: __cpu_model

```



---

archive/issue_comments_461910.json:
```json
{
    "body": "Changed commit from **[`4541e18`](https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629)** to **[`7472971`](https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7)**",
    "created_at": "2020-03-28T14:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461910",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4541e18`](https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629)** to **[`7472971`](https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7)**



---

archive/issue_comments_461911.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7\"><code>7472971</code></a></td><td><code>build/pkgs/numpy/spkg-install.in: Unset LDSHARED</code></td></tr></table>\n",
    "created_at": "2020-03-28T14:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461911",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7"><code>7472971</code></a></td><td><code>build/pkgs/numpy/spkg-install.in: Unset LDSHARED</code></td></tr></table>




---

archive/issue_events_404392.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T15:09:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404392"
}
```



---

archive/issue_events_404393.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T15:09:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404393"
}
```



---

archive/issue_events_404394.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-03-28T15:24:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404394"
}
```



---

archive/issue_events_404395.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-03-28T15:24:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404395"
}
```



---

archive/issue_comments_461912.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nThis is dropping `-pthread` on linux.",
    "created_at": "2020-03-28T15:24:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461912",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:46" align="right">comment:46</div>

This is dropping `-pthread` on linux.



---

archive/issue_comments_461913.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nOriginal issue is because the logic at https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 doesn't get triggered with,\n\n```\nCC xcrun -sdk macosx clang    -arch x86_64\nLDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup\n```",
    "created_at": "2020-03-28T15:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461913",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:47" align="right">comment:47</div>

Original issue is because the logic at https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 doesn't get triggered with,

```
CC xcrun -sdk macosx clang    -arch x86_64
LDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup
```



---

archive/issue_comments_461914.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nHelp with this ticket is welcome!",
    "created_at": "2020-03-28T16:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461914",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">comment:48</div>

Help with this ticket is welcome!



---

archive/issue_events_404396.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-29T14:39:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404396"
}
```



---

archive/issue_events_404397.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-29T14:39:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404397"
}
```



---

archive/issue_comments_461915.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@isuruf](#comment:47):\n> Original issue is because the logic at https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 doesn't get triggered with,\n> \n> ```\n> CC xcrun -sdk macosx clang    -arch x86_64\n> LDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup\n> ```\n\nI don't quite understand this comment. Should it be `CC=...` etc? \nAnyhow, we can propose an upstream patch...",
    "created_at": "2020-03-30T15:16:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461915",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@isuruf](#comment:47):
> Original issue is because the logic at https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 doesn't get triggered with,
> 
> ```
> CC xcrun -sdk macosx clang    -arch x86_64
> LDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup
> ```

I don't quite understand this comment. Should it be `CC=...` etc? 
Anyhow, we can propose an upstream patch...



---

archive/issue_comments_461916.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nhttps://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 checks that `LDSHARED` starts with the old `CC` and if so, old `CC` is replaced with the new `CC`.\n\nIf `LDSHARED` was `xcrun -sdk macosx clang     -arch x86_64 -bundle -undefined dynamic_lookup`, then setting `CC=clang` would give you, `clang -bundle -undefined dynamic_lookup`, but at the moment it is not.",
    "created_at": "2020-03-30T15:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461916",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:51" align="right">comment:51</div>

https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 checks that `LDSHARED` starts with the old `CC` and if so, old `CC` is replaced with the new `CC`.

If `LDSHARED` was `xcrun -sdk macosx clang     -arch x86_64 -bundle -undefined dynamic_lookup`, then setting `CC=clang` would give you, `clang -bundle -undefined dynamic_lookup`, but at the moment it is not.



---

archive/issue_comments_461917.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,5 +20,12 @@\n ```\n tox -e local-homebrew-macos-standard -- V=0 pplpy\n ```\n+With #29417, it is:\n+\n+```\n+tox -e local-homebrew-macos-standard-python3_xcode -- V=0 pplpy\n+```\n+\n+\n \n (broken out from #29404)\n``````\n",
    "created_at": "2020-03-31T01:21:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461917",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,5 +20,12 @@
 ```
 tox -e local-homebrew-macos-standard -- V=0 pplpy
 ```
+With #29417, it is:
+
+```
+tox -e local-homebrew-macos-standard-python3_xcode -- V=0 pplpy
+```
+
+
 
 (broken out from #29404)
``````




---

archive/issue_comments_461918.json:
```json
{
    "body": "Changed commit from **[`7472971`](https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7)** to **[`bcb7534`](https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0)**",
    "created_at": "2020-04-01T03:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461918",
    "user": "https://github.com/isuruf"
}
```

Changed commit from **[`7472971`](https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7)** to **[`bcb7534`](https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0)**



---

archive/issue_comments_461919.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, Isuru Fernando**",
    "created_at": "2020-04-01T03:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461919",
    "user": "https://github.com/isuruf"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, Isuru Fernando**



---

archive/issue_events_404398.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-01T03:01:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404398"
}
```



---

archive/issue_events_404399.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-01T03:01:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404399"
}
```



---

archive/issue_comments_461920.json:
```json
{
    "body": "<div id=\"comment:54\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0\"><code>bcb7534</code></a></td><td><code>Add -pthread to LDSHARED</code></td></tr></table>\n",
    "created_at": "2020-04-01T03:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461920",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:54"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0"><code>bcb7534</code></a></td><td><code>Add -pthread to LDSHARED</code></td></tr></table>




---

archive/issue_comments_461921.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)** to **[u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)**",
    "created_at": "2020-04-01T03:01:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461921",
    "user": "https://github.com/isuruf"
}
```

Changed branch from **[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)** to **[u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)**



---

archive/issue_comments_461922.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nFails on ubuntu-xenial-standard (https://github.com/mkoeppe/sage/runs/552215553):\n\n```\n  ImportError: /sage/local/lib/python3.7/site-packages/numpy/core/_multiarray_umath.cpython-37m-x86_64-linux-gnu.so: undefined symbol: __cpu_model\n```",
    "created_at": "2020-04-02T00:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461922",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Fails on ubuntu-xenial-standard (https://github.com/mkoeppe/sage/runs/552215553):

```
  ImportError: /sage/local/lib/python3.7/site-packages/numpy/core/_multiarray_umath.cpython-37m-x86_64-linux-gnu.so: undefined symbol: __cpu_model
```



---

archive/issue_events_404400.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-02T00:50:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404400"
}
```



---

archive/issue_events_404401.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-02T00:50:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404401"
}
```



---

archive/issue_comments_461923.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nIt looks like on ubuntu, `LDSHARED` has `-Wl,-Bsymbolic-functions` which we need to include.\nShall we only set `LDSHARED` in OSX?",
    "created_at": "2020-04-02T01:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461923",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:57" align="right">comment:57</div>

It looks like on ubuntu, `LDSHARED` has `-Wl,-Bsymbolic-functions` which we need to include.
Shall we only set `LDSHARED` in OSX?



---

archive/issue_comments_461924.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@isuruf](#comment:57):\n> Shall we only set `LDSHARED` in OSX?\n\nProbably better, yes",
    "created_at": "2020-04-02T01:43:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461924",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@isuruf](#comment:57):
> Shall we only set `LDSHARED` in OSX?

Probably better, yes



---

archive/issue_comments_461925.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259\"><code>e4056f0</code></a></td><td><code>Set LDSHARED only on OSX</code></td></tr></table>\n",
    "created_at": "2020-04-02T03:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461925",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259"><code>e4056f0</code></a></td><td><code>Set LDSHARED only on OSX</code></td></tr></table>




---

archive/issue_comments_461926.json:
```json
{
    "body": "Changed commit from **[`bcb7534`](https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0)** to **[`e4056f0`](https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259)**",
    "created_at": "2020-04-02T03:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461926",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bcb7534`](https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0)** to **[`e4056f0`](https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259)**



---

archive/issue_events_404402.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-02T03:03:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404402"
}
```



---

archive/issue_events_404403.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-02T03:03:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404403"
}
```



---

archive/issue_comments_461927.json:
```json
{
    "body": "Changed branch from **[u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)** to **[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)**",
    "created_at": "2020-04-02T12:17:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461927",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)** to **[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)**



---

archive/issue_comments_461928.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nrebased on 9.1.beta9\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a6238eed2ab25519b1b40061dc3803e3163c581\"><code>7a6238e</code></a></td><td><code>src/bin/sage-env: Set LDSHARED when CXX is set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbe7a1e9c6724d1ae9ae0f5b26c218c967a915e5\"><code>cbe7a1e</code></a></td><td><code>build/pkgs/numpy/spkg-install.in: Unset LDSHARED</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/089d2a2ea8aa64a2bf7bafb77094f9d9e73e3cd7\"><code>089d2a2</code></a></td><td><code>Add -pthread to LDSHARED</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1\"><code>96a599c</code></a></td><td><code>Set LDSHARED only on OSX</code></td></tr></table>\n",
    "created_at": "2020-04-02T12:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461928",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:62" align="right">comment:62</div>

rebased on 9.1.beta9

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a6238eed2ab25519b1b40061dc3803e3163c581"><code>7a6238e</code></a></td><td><code>src/bin/sage-env: Set LDSHARED when CXX is set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbe7a1e9c6724d1ae9ae0f5b26c218c967a915e5"><code>cbe7a1e</code></a></td><td><code>build/pkgs/numpy/spkg-install.in: Unset LDSHARED</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/089d2a2ea8aa64a2bf7bafb77094f9d9e73e3cd7"><code>089d2a2</code></a></td><td><code>Add -pthread to LDSHARED</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1"><code>96a599c</code></a></td><td><code>Set LDSHARED only on OSX</code></td></tr></table>




---

archive/issue_comments_461929.json:
```json
{
    "body": "Changed commit from **[`e4056f0`](https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259)** to **[`96a599c`](https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1)**",
    "created_at": "2020-04-02T12:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461929",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`e4056f0`](https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259)** to **[`96a599c`](https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1)**



---

archive/issue_comments_461930.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nOn `local-homebrew-macos-python3_pythonorg-minimal`(https://github.com/mkoeppe/sage/runs/557674691):\n\n```\nsage -t src/sage/repl/ipython_extension.py\n**********************************************************************\nFile \"src/sage/repl/ipython_extension.py\", line 385, in sage.repl.ipython_extension.SageMagics.fortran\nFailed example:\n...\nRuntimeError: failed to compile Fortran code:\n    b'Could not locate executable g++ -std=gnu++11 -pthread -bundle -undefined dynamic_lookup\\nIn file included from \n```",
    "created_at": "2020-04-03T17:36:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461930",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:63" align="right">comment:63</div>

On `local-homebrew-macos-python3_pythonorg-minimal`(https://github.com/mkoeppe/sage/runs/557674691):

```
sage -t src/sage/repl/ipython_extension.py
**********************************************************************
File "src/sage/repl/ipython_extension.py", line 385, in sage.repl.ipython_extension.SageMagics.fortran
Failed example:
...
RuntimeError: failed to compile Fortran code:
    b'Could not locate executable g++ -std=gnu++11 -pthread -bundle -undefined dynamic_lookup\nIn file included from 
```



---

archive/issue_events_404404.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T17:37:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404404"
}
```



---

archive/issue_events_404405.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T17:37:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404405"
}
```



---

archive/issue_comments_461931.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nAlso \n\n```\nsage -t src/sage/interfaces/gap.py  # 1 doctest failed\nsage -t src/sage/misc/inline_fortran.py  # 3 doctests failed\nsage -t src/sage/misc/persist.pyx  # 2 doctests failed\n```",
    "created_at": "2020-04-03T17:38:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461931",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:65" align="right">comment:65</div>

Also 

```
sage -t src/sage/interfaces/gap.py  # 1 doctest failed
sage -t src/sage/misc/inline_fortran.py  # 3 doctests failed
sage -t src/sage/misc/persist.pyx  # 2 doctests failed
```



---

archive/issue_comments_461932.json:
```json
{
    "body": "<div id=\"comment:66\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f721740d1e85cc6f503d5b0fba01bdcbc4e9f97e\"><code>f721740</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Also check whether C++ extensions can be built</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046\"><code>8317c3e</code></a></td><td><code>Undo #21175: Set ARCHFLAGS only when compiling Perl modules</code></td></tr></table>\n",
    "created_at": "2020-04-09T03:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461932",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:66"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f721740d1e85cc6f503d5b0fba01bdcbc4e9f97e"><code>f721740</code></a></td><td><code>build/pkgs/python3/spkg-configure.m4: Also check whether C++ extensions can be built</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046"><code>8317c3e</code></a></td><td><code>Undo #21175: Set ARCHFLAGS only when compiling Perl modules</code></td></tr></table>




---

archive/issue_comments_461933.json:
```json
{
    "body": "Changed commit from **[`96a599c`](https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1)** to **[`8317c3e`](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)**",
    "created_at": "2020-04-09T03:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461933",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`96a599c`](https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1)** to **[`8317c3e`](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)**



---

archive/issue_events_404406.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T03:52:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404406"
}
```



---

archive/issue_events_404407.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T03:52:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404407"
}
```



---

archive/issue_comments_461934.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nStarted again from scratch. Turns out I broke it 4 years ago in #21175 by setting `ARCHFLAGS`. This interacts in a bizarre way with the bizarre code discussed above.",
    "created_at": "2020-04-09T03:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461934",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">comment:67</div>

Started again from scratch. Turns out I broke it 4 years ago in #21175 by setting `ARCHFLAGS`. This interacts in a bizarre way with the bizarre code discussed above.



---

archive/issue_comments_461935.json:
```json
{
    "body": "Changed author from **Matthias Koeppe, Isuru Fernando** to **Matthias Koeppe**",
    "created_at": "2020-04-09T03:52:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461935",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe, Isuru Fernando** to **Matthias Koeppe**



---

archive/issue_comments_461936.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nTests run in https://github.com/mkoeppe/sage/actions/runs/73955490",
    "created_at": "2020-04-09T03:58:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461936",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">comment:69</div>

Tests run in https://github.com/mkoeppe/sage/actions/runs/73955490



---

archive/issue_comments_461937.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nThis works for me, but I don't understand the changes in `build/pkgs/python3/spkg-configure.m4`.",
    "created_at": "2020-04-09T23:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461937",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:70" align="right">comment:70</div>

This works for me, but I don't understand the changes in `build/pkgs/python3/spkg-configure.m4`.



---

archive/issue_comments_461938.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nSo if someone else wants to review it, I am happy to give some fraction of a positive review.",
    "created_at": "2020-04-09T23:31:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461938",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:71" align="right">comment:71</div>

So if someone else wants to review it, I am happy to give some fraction of a positive review.



---

archive/issue_comments_461939.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [@jhpalmieri](#comment:70):\n> I don't understand the changes in `build/pkgs/python3/spkg-configure.m4`.\n\nThere was already a test that the system python (in the venv) is able to build a C extension.\nThe change tightens this check by imposing the configured `CC` (and `CXX`) values -- because this is what the actual build will be running.\nIt also adds the same test for building a C++ 11 extension.",
    "created_at": "2020-04-09T23:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461939",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [@jhpalmieri](#comment:70):
> I don't understand the changes in `build/pkgs/python3/spkg-configure.m4`.

There was already a test that the system python (in the venv) is able to build a C extension.
The change tightens this check by imposing the configured `CC` (and `CXX`) values -- because this is what the actual build will be running.
It also adds the same test for building a C++ 11 extension.



---

archive/issue_comments_461940.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@jhpalmieri](#comment:71):\n> some fraction of a positive review.\n\n100% thanks already",
    "created_at": "2020-04-09T23:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461940",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@jhpalmieri](#comment:71):
> some fraction of a positive review.

100% thanks already



---

archive/issue_comments_461941.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nLet's also get this one into the next beta please",
    "created_at": "2020-04-12T00:55:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461941",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:74" align="right">comment:74</div>

Let's also get this one into the next beta please



---

archive/issue_events_404408.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-12T16:59:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404408"
}
```



---

archive/issue_events_404409.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-12T16:59:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404409"
}
```



---

archive/issue_comments_461942.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nOkay, let's merge it. I can't get polymake to build with or without these changes, and the changes make sense.\n\nRe polymake, here is the error:\n\n```\nninja: Entering directory `build/Opt'\n[1/1] GENERATE /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja\nFAILED: /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja \n/usr/bin/perl /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_ninja_targets.pl /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/config.ninja\nCan't locate JSON.pm in @INC (you may need to install the JSON module) (@INC contains: /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/lib/perl5/darwin-thread-multi-2level /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/lib/perl5 /Library/Perl/5.18/darwin-thread-multi-2level /Library/Perl/5.18 /Network/Library/Perl/5.18/darwin-thread-multi-2level /Network/Library/Perl/5.18 /Library/Perl/Updates/5.18.4 /System/Library/Perl/5.18/darwin-thread-multi-2level /System/Library/Perl/5.18 /System/Library/Perl/Extras/5.18/darwin-thread-multi-2level /System/Library/Perl/Extras/5.18 .) at /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_cpperl_modules.pl line 22.\nBEGIN failed--compilation aborted at /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_cpperl_modules.pl line 22.\nninja: error: rebuilding 'build.ninja': subcommand failed\nmake[2]: *** [all] Error 1\n```\nIt's probably the old problem of not having the right perl modules present and Sage's polymake build system failing to recognize that. The instructions in polymake's SPKG.txt are no longer valid.\n\nIn any case, the polymake problems should be dealt with at #29054.",
    "created_at": "2020-04-12T21:02:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461942",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:77" align="right">comment:77</div>

Okay, let's merge it. I can't get polymake to build with or without these changes, and the changes make sense.

Re polymake, here is the error:

```
ninja: Entering directory `build/Opt'
[1/1] GENERATE /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja
FAILED: /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja 
/usr/bin/perl /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_ninja_targets.pl /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/config.ninja
Can't locate JSON.pm in @INC (you may need to install the JSON module) (@INC contains: /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/lib/perl5/darwin-thread-multi-2level /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/lib/perl5 /Library/Perl/5.18/darwin-thread-multi-2level /Library/Perl/5.18 /Network/Library/Perl/5.18/darwin-thread-multi-2level /Network/Library/Perl/5.18 /Library/Perl/Updates/5.18.4 /System/Library/Perl/5.18/darwin-thread-multi-2level /System/Library/Perl/5.18 /System/Library/Perl/Extras/5.18/darwin-thread-multi-2level /System/Library/Perl/Extras/5.18 .) at /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_cpperl_modules.pl line 22.
BEGIN failed--compilation aborted at /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_cpperl_modules.pl line 22.
ninja: error: rebuilding 'build.ninja': subcommand failed
make[2]: *** [all] Error 1
```
It's probably the old problem of not having the right perl modules present and Sage's polymake build system failing to recognize that. The instructions in polymake's SPKG.txt are no longer valid.

In any case, the polymake problems should be dealt with at #29054.



---

archive/issue_comments_461943.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2020-04-12T21:02:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461943",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_404410.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-04-12T21:02:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404410"
}
```



---

archive/issue_events_404411.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-04-12T21:02:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404411"
}
```



---

archive/issue_comments_461944.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nThanks. Yes, polymake will take more work.",
    "created_at": "2020-04-12T21:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461944",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:78" align="right">comment:78</div>

Thanks. Yes, polymake will take more work.



---

archive/issue_comments_461945.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)** to **[`8317c3e`](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)**",
    "created_at": "2020-04-15T22:13:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-461945",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)** to **[`8317c3e`](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)**



---

archive/issue_events_404412.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-15T22:13:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404412"
}
```



---

archive/issue_events_404413.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b42af5e1f923f5d36a4ee4c6a9c866cb4dcdc4a1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-04-15T22:13:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-404413"
}
```
