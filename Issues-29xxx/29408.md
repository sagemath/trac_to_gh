# Issue 29408: Fix build errors with pplpy, scipy, kiwisolver, fpylll on macos with system python3

archive/issues_029171.json:
```json
{
    "body": "On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with `pplpy`, as seen in https://github.com/mkoeppe/sage/runs/538432631:\n\n```\n    g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so\n    clang: error: unknown argument: '-sdk'\n    clang: error: no such file or directory: 'macosx'\n    clang: error: no such file or directory: 'clang'\n    error: command 'g++' failed with exit status 1\n    Running setup.py install for pplpy: finished with status 'error'\nCleaning up...\n```\n\nSame kind of error with scipy, kiwisolver, fpylll.\n\nFull logs can be downloaded at the above link.\n\nTo test locally, using #29104 + #27824, remove all python3 from the homebrew in /usr/local \nand run\n\n```\ntox -e local-homebrew-macos-standard -- V=0 pplpy\n```\nWith #29417, it is:\n\n```\ntox -e local-homebrew-macos-standard-python3_xcode -- V=0 pplpy\n```\n\n\n\n(broken out from #29404)\n\n**CC:**  @dimpase @videlec @kiwifb @mwageringel @embray @jhpalmieri @vbraun\n\n**Branch/Commit:** [8317c3eb7729c06aeace618726808d6342fda046](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)\n\n**Reviewer:** John Palmieri\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/29408\n\n",
    "closed_at": "2020-04-15T22:13:18Z",
    "created_at": "2020-03-26T02:10:44Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "Fix build errors with pplpy, scipy, kiwisolver, fpylll on macos with system python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/29408",
    "user": "https://github.com/mkoeppe"
}
```
On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with `pplpy`, as seen in https://github.com/mkoeppe/sage/runs/538432631:

```
    g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so
    clang: error: unknown argument: '-sdk'
    clang: error: no such file or directory: 'macosx'
    clang: error: no such file or directory: 'clang'
    error: command 'g++' failed with exit status 1
    Running setup.py install for pplpy: finished with status 'error'
Cleaning up...
```

Same kind of error with scipy, kiwisolver, fpylll.

Full logs can be downloaded at the above link.

To test locally, using #29104 + #27824, remove all python3 from the homebrew in /usr/local 
and run

```
tox -e local-homebrew-macos-standard -- V=0 pplpy
```
With #29417, it is:

```
tox -e local-homebrew-macos-standard-python3_xcode -- V=0 pplpy
```



(broken out from #29404)

**CC:**  @dimpase @videlec @kiwifb @mwageringel @embray @jhpalmieri @vbraun

**Branch/Commit:** [8317c3eb7729c06aeace618726808d6342fda046](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)

**Reviewer:** John Palmieri

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/29408





---

archive/issue_comments_464544.json:
```json
{
    "body": "<a id='comment:1'></a>\nthis needs details on the Python (system MacOS? Homebrew? CPython package?) and on clang (XCode? Homebrew? Other (e.g. conda?))",
    "created_at": "2020-03-26T02:26:37Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464544",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
this needs details on the Python (system MacOS? Homebrew? CPython package?) and on clang (XCode? Homebrew? Other (e.g. conda?))



---

archive/issue_comments_464545.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,4 @@\n-https://github.com/mkoeppe/sage/runs/531095486\n-\n-pplpy:\n+On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with pply, as seen in https://github.com/mkoeppe/sage/runs/531095486:\n \n ```\n     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so\n@@ -12,4 +10,6 @@\n Cleaning up...\n ```\n \n+Full logs can be downloaded at the above link.\n+\n (broken out from #29404)\n``````\n",
    "created_at": "2020-03-26T02:58:27Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464545",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,4 @@
-https://github.com/mkoeppe/sage/runs/531095486
-
-pplpy:
+On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with pply, as seen in https://github.com/mkoeppe/sage/runs/531095486:
 
 ```
     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so
@@ -12,4 +10,6 @@
 Cleaning up...
 ```
 
+Full logs can be downloaded at the above link.
+
 (broken out from #29404)
``````




---

archive/issue_comments_464546.json:
```json
{
    "body": "<a id='comment:3'></a>\nwhat I gather from these links is that Pythons in MacOS are not Homebrew ones.",
    "created_at": "2020-03-26T03:26:39Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464546",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
what I gather from these links is that Pythons in MacOS are not Homebrew ones.



---

archive/issue_comments_464547.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with pply, as seen in https://github.com/mkoeppe/sage/runs/531095486:\n+On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with `pplpy`, as seen in https://github.com/mkoeppe/sage/runs/538432631:\n \n ```\n     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so\n@@ -10,6 +10,8 @@\n Cleaning up...\n ```\n \n+Same kind of error with scipy, kiwisolver, fpylll.\n+\n Full logs can be downloaded at the above link.\n \n (broken out from #29404)\n``````\n",
    "created_at": "2020-03-27T14:56:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464547",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with pply, as seen in https://github.com/mkoeppe/sage/runs/531095486:
+On the platform `local-homebrew-macos` defined by `tox.ini`, running on a `macos-latest` system as defined in https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners#supported-runners-and-hardware-resources, a branch that includes #27824 (spkg-configure.m4 for python3) leads to the following error with `pplpy`, as seen in https://github.com/mkoeppe/sage/runs/538432631:
 
 ```
     g++ -sdk macosx clang -bundle -undefined dynamic_lookup -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -Wl,-rpath,/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/local/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/lib -L/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/lib -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/opt/readline/include -I/Users/runner/runners/2.165.2/work/sage/sage/.tox/local-homebrew-macos-standard/homebrew/include build/temp.macosx-10.14-x86_64-3.7/ppl/linear_algebra.o build/temp.macosx-10.14-x86_64-3.7/ppl/ppl_shim.o -lgmp -lgmpxx -lppl -lm -o build/lib.macosx-10.14-x86_64-3.7/ppl/linear_algebra.cpython-37m-darwin.so
@@ -10,6 +10,8 @@
 Cleaning up...
 ```
 
+Same kind of error with scipy, kiwisolver, fpylll.
+
 Full logs can be downloaded at the above link.
 
 (broken out from #29404)
``````




---

archive/issue_events_261731.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-27T14:56:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "rename": {
        "from": "Fix build errors with pplpy on macos with system python3",
        "to": "Fix build errors with pplpy, scipy, kiwisolver, fpylll on macos with system python3"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261731"
}
```



---

archive/issue_comments_464548.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [dimpase](#comment%3A3):\n> what I gather from these links is that Pythons in MacOS are not Homebrew ones.\n\nThat's right, this is system python3 from `/usr/bin`",
    "created_at": "2020-03-27T14:57:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464548",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Replying to [dimpase](#comment%3A3):
> what I gather from these links is that Pythons in MacOS are not Homebrew ones.

That's right, this is system python3 from `/usr/bin`



---

archive/issue_comments_464549.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,4 +14,11 @@\n \n Full logs can be downloaded at the above link.\n \n+To test locally, using #29104 + #27824, remove all python3 from the homebrew in /usr/local \n+and run\n+\n+```\n+tox -e local-homebrew-macos-standard -- V=0 pplpy\n+```\n+\n (broken out from #29404)\n``````\n",
    "created_at": "2020-03-27T15:09:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464549",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,4 +14,11 @@
 
 Full logs can be downloaded at the above link.
 
+To test locally, using #29104 + #27824, remove all python3 from the homebrew in /usr/local 
+and run
+
+```
+tox -e local-homebrew-macos-standard -- V=0 pplpy
+```
+
 (broken out from #29404)
``````




---

archive/issue_comments_464550.json:
```json
{
    "body": "<a id='comment:7'></a>\nSomething seems to get very confused about values from sysconfig as it tries to replace `xcrun` by `g++`.\n\n```\n>>> for k, v in sysconfig.get_config_vars().items():\n...     if isinstance(v, str) and 'sdk' in v:\n...         print(k, v)\n... \nBLDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup \nCC xcrun -sdk macosx clang    -arch x86_64 \nCONFIG_ARGS '-C' '--host=x86_64-apple-darwin' '--build=x86_64-apple-darwin' '--enable-framework=/Applications/Xcode.app/Contents/Developer/Library/Frameworks' '--with-framework-name=Python3' '--with-openssl=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Root/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7' '--enable-ipv6' '--prefix=/Applications/Xcode.app/Contents/Developer/usr' '--with-pymalloc' 'PYTHON_FOR_BUILD=DYLD_FRAMEWORK_PATH=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects/host /BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects/host/python.exe' 'CC=xcrun -sdk macosx clang    -arch x86_64' 'CXX=xcrun -sdk macosx clang++  -arch x86_64' 'CPP=xcrun -sdk macosx clang -E -arch x86_64' 'CFLAGS=-iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/Headers' 'CPPFLAGS=-iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/Headers' 'LIBS=-lSystem' 'LDFLAGS=' 'OBJROOT=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects' 'SDKROOT=/BuildRoot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.Internal.sdk' 'build_alias=x86_64-apple-darwin' 'host_alias=x86_64-apple-darwin'\nCXX xcrun -sdk macosx clang++  -arch x86_64 \nLDCXXSHARED xcrun -sdk macosx clang++  -arch x86_64 -bundle -undefined dynamic_lookup\nLDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup \nLINKCC xcrun -sdk macosx clang    -arch x86_64\nMAINCC xcrun -sdk macosx clang    -arch x86_64\nSDKROOT /BuildRoot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.Internal.sdk\n_OSX_SUPPORT_INITIAL_BLDSHARED xcrun -sdk macosx clang    -arch x86_64 -bundle -undefined dynamic_lookup\n_OSX_SUPPORT_INITIAL_LDSHARED xcrun -sdk macosx clang    -arch x86_64 -bundle -undefined dynamic_lookup\n_OSX_SUPPORT_INITIAL_CC xcrun -sdk macosx clang    -arch x86_64\n_OSX_SUPPORT_INITIAL_CXX xcrun -sdk macosx clang++  -arch x86_64\n```",
    "created_at": "2020-03-27T19:54:57Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464550",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Something seems to get very confused about values from sysconfig as it tries to replace `xcrun` by `g++`.

```
>>> for k, v in sysconfig.get_config_vars().items():
...     if isinstance(v, str) and 'sdk' in v:
...         print(k, v)
... 
BLDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup 
CC xcrun -sdk macosx clang    -arch x86_64 
CONFIG_ARGS '-C' '--host=x86_64-apple-darwin' '--build=x86_64-apple-darwin' '--enable-framework=/Applications/Xcode.app/Contents/Developer/Library/Frameworks' '--with-framework-name=Python3' '--with-openssl=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Root/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7' '--enable-ipv6' '--prefix=/Applications/Xcode.app/Contents/Developer/usr' '--with-pymalloc' 'PYTHON_FOR_BUILD=DYLD_FRAMEWORK_PATH=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects/host /BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects/host/python.exe' 'CC=xcrun -sdk macosx clang    -arch x86_64' 'CXX=xcrun -sdk macosx clang++  -arch x86_64' 'CPP=xcrun -sdk macosx clang -E -arch x86_64' 'CFLAGS=-iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/Headers' 'CPPFLAGS=-iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.7/Headers' 'LIBS=-lSystem' 'LDFLAGS=' 'OBJROOT=/BuildRoot/Library/Caches/com.apple.xbs/Binaries/python3/install/TempContent/Objects' 'SDKROOT=/BuildRoot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.Internal.sdk' 'build_alias=x86_64-apple-darwin' 'host_alias=x86_64-apple-darwin'
CXX xcrun -sdk macosx clang++  -arch x86_64 
LDCXXSHARED xcrun -sdk macosx clang++  -arch x86_64 -bundle -undefined dynamic_lookup
LDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup 
LINKCC xcrun -sdk macosx clang    -arch x86_64
MAINCC xcrun -sdk macosx clang    -arch x86_64
SDKROOT /BuildRoot/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.Internal.sdk
_OSX_SUPPORT_INITIAL_BLDSHARED xcrun -sdk macosx clang    -arch x86_64 -bundle -undefined dynamic_lookup
_OSX_SUPPORT_INITIAL_LDSHARED xcrun -sdk macosx clang    -arch x86_64 -bundle -undefined dynamic_lookup
_OSX_SUPPORT_INITIAL_CC xcrun -sdk macosx clang    -arch x86_64
_OSX_SUPPORT_INITIAL_CXX xcrun -sdk macosx clang++  -arch x86_64
```



---

archive/issue_comments_464551.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt is caused by bizarre code in `distutils.unixccompiler.UnixCCompiler.link`.",
    "created_at": "2020-03-27T20:36:31Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464551",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
It is caused by bizarre code in `distutils.unixccompiler.UnixCCompiler.link`.



---

archive/issue_comments_464552.json:
```json
{
    "body": "<a id='comment:9'></a>\nhttps://github.com/python/cpython/blob/master/Lib/distutils/unixccompiler.py#L180\nwith \n\n```\n(Pdb) p self.linker_so\n['xcrun', '-sdk', 'macosx', 'clang', '-bundle', '-undefined', 'dynamic_lookup', '-L/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib', '-Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib', '-L/usr/local/opt/readline/lib', '-L/usr/local/lib', '-I/usr/local/opt/readline/include', '-I/usr/local/include']\n(Pdb) p self.compiler_cxx\n['g++', '-std=gnu++11']\n```",
    "created_at": "2020-03-27T20:38:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464552",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
https://github.com/python/cpython/blob/master/Lib/distutils/unixccompiler.py#L180
with 

```
(Pdb) p self.linker_so
['xcrun', '-sdk', 'macosx', 'clang', '-bundle', '-undefined', 'dynamic_lookup', '-L/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib', '-Wl,-rpath,/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-standard/local/lib', '-L/usr/local/opt/readline/lib', '-L/usr/local/lib', '-I/usr/local/opt/readline/include', '-I/usr/local/include']
(Pdb) p self.compiler_cxx
['g++', '-std=gnu++11']
```



---

archive/issue_comments_464553.json:
```json
{
    "body": "<a id='comment:10'></a>\nYes, my head hurts when I look at that file. I am fairly sure distros all over have patches for some aspects of it.\n\nFrom the line it expect some behavior from xcode.",
    "created_at": "2020-03-27T20:40:41Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464553",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Yes, my head hurts when I look at that file. I am fairly sure distros all over have patches for some aspects of it.

From the line it expect some behavior from xcode.



---

archive/issue_comments_464554.json:
```json
{
    "body": "<a id='comment:11'></a>\nHum\n\n```\nfbissey@itsv-frb15 ~ % xcrun --help\nUsage: xcrun [options] <tool name> ... arguments ...\n\nFind and execute the named command line tool from the active developer\ndirectory.\n\nThe active developer directory can be set using `xcode-select`, or via the\nDEVELOPER_DIR environment variable. See the xcrun and xcode-select manual\npages for more information.\n\nOptions:\n  -h, --help                  show this help message and exit\n  --version                   show the xcrun version\n  -v, --verbose               show verbose logging output\n  --sdk <sdk name>            find the tool for the given SDK name\n  --toolchain <name>          find the tool for the given toolchain\n  -l, --log                   show commands to be executed (with --run)\n  -f, --find                  only find and print the tool path\n  -r, --run                   find and execute the tool (the default behavior)\n  -n, --no-cache              do not use the lookup cache\n  -k, --kill-cache            invalidate all existing cache entries\n  --show-sdk-path             show selected SDK install path\n  --show-sdk-version          show selected SDK version\n  --show-sdk-build-version    show selected SDK build version\n  --show-sdk-platform-path    show selected SDK platform path\n  --show-sdk-platform-version show selected SDK platform version\n```\nIs it just a stupid `--` versus `-`?",
    "created_at": "2020-03-27T20:42:12Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464554",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Hum

```
fbissey@itsv-frb15 ~ % xcrun --help
Usage: xcrun [options] <tool name> ... arguments ...

Find and execute the named command line tool from the active developer
directory.

The active developer directory can be set using `xcode-select`, or via the
DEVELOPER_DIR environment variable. See the xcrun and xcode-select manual
pages for more information.

Options:
  -h, --help                  show this help message and exit
  --version                   show the xcrun version
  -v, --verbose               show verbose logging output
  --sdk <sdk name>            find the tool for the given SDK name
  --toolchain <name>          find the tool for the given toolchain
  -l, --log                   show commands to be executed (with --run)
  -f, --find                  only find and print the tool path
  -r, --run                   find and execute the tool (the default behavior)
  -n, --no-cache              do not use the lookup cache
  -k, --kill-cache            invalidate all existing cache entries
  --show-sdk-path             show selected SDK install path
  --show-sdk-version          show selected SDK version
  --show-sdk-build-version    show selected SDK build version
  --show-sdk-platform-path    show selected SDK platform path
  --show-sdk-platform-version show selected SDK platform version
```
Is it just a stupid `--` versus `-`?



---

archive/issue_comments_464555.json:
```json
{
    "body": "<a id='comment:12'></a>\nNo, the linked code is really replacing \"xcrun\" by \"g++\".",
    "created_at": "2020-03-27T20:51:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464555",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
No, the linked code is really replacing "xcrun" by "g++".



---

archive/issue_comments_464556.json:
```json
{
    "body": "<a id='comment:13'></a>\nMore context, more fun at https://github.com/python/cpython/blob/master/Lib/_osx_support.py",
    "created_at": "2020-03-27T20:51:43Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464556",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
More context, more fun at https://github.com/python/cpython/blob/master/Lib/_osx_support.py



---

archive/issue_comments_464557.json:
```json
{
    "body": "<a id='comment:14'></a>\nEach of `xcrun -sdk macosx clang`, `g++`, and `xcrun -sdk macosx clang++`  make sense.\nBut the code tries to mix the first two to get the third, and gets `g++  -sdk macosx clang`, which makes no sense, obviously.",
    "created_at": "2020-03-27T20:57:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464557",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Each of `xcrun -sdk macosx clang`, `g++`, and `xcrun -sdk macosx clang++`  make sense.
But the code tries to mix the first two to get the third, and gets `g++  -sdk macosx clang`, which makes no sense, obviously.



---

archive/issue_comments_464558.json:
```json
{
    "body": "<a id='comment:15'></a>\nGoogle search for LDCXXSHARED distutils brings up various things\n\nhttps://www.google.com/search?safe=off&sxsrf=ALeKk01RyL6O3kSKx0-W2ZRb3O8N8Pdg-A:1585342860000&q=LDCXXSHARED+distutils&nfpr=1&sa=X&ved=2ahUKEwiSrZGwxrvoAhWkl3IEHZtFCmEQvgUoAXoECAwQKA&biw=875&bih=862",
    "created_at": "2020-03-27T21:02:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464558",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Google search for LDCXXSHARED distutils brings up various things

https://www.google.com/search?safe=off&sxsrf=ALeKk01RyL6O3kSKx0-W2ZRb3O8N8Pdg-A:1585342860000&q=LDCXXSHARED+distutils&nfpr=1&sa=X&ved=2ahUKEwiSrZGwxrvoAhWkl3IEHZtFCmEQvgUoAXoECAwQKA&biw=875&bih=862



---

archive/issue_comments_464559.json:
```json
{
    "body": "<a id='comment:16'></a>\nIt's an existing Python issue: https://bugs.python.org/issue8027",
    "created_at": "2020-03-27T21:07:59Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464559",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
It's an existing Python issue: https://bugs.python.org/issue8027



---

archive/issue_comments_464560.json:
```json
{
    "body": "<a id='comment:18'></a>\nMore precisely, this one: https://bugs.python.org/issue1222585",
    "created_at": "2020-03-27T21:11:27Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464560",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
More precisely, this one: https://bugs.python.org/issue1222585



---

archive/issue_comments_464561.json:
```json
{
    "body": "<a id='comment:19'></a>\n... open since 2005",
    "created_at": "2020-03-27T21:11:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464561",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
... open since 2005



---

archive/issue_comments_464562.json:
```json
{
    "body": "<a id='comment:20'></a>\nRelated previous issue: #17484",
    "created_at": "2020-03-27T21:16:31Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464562",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Related previous issue: #17484



---

archive/issue_comments_464563.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mkoeppe](#comment%3A19):\n> ... open since 2005\n\n\nUpstream python does have a bad history of compiler/linker support (especially differentiation between C and C++ actually).",
    "created_at": "2020-03-27T21:18:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464563",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>
Replying to [mkoeppe](#comment%3A19):
> ... open since 2005


Upstream python does have a bad history of compiler/linker support (especially differentiation between C and C++ actually).



---

archive/issue_comments_464564.json:
```json
{
    "body": "<a id='comment:22'></a>\nA simple workaround is to clear the CXX environment variable before we call the installation.\nThen it will build the extension using the compiler configured in python's sysconfig.",
    "created_at": "2020-03-27T21:21:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464564",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
A simple workaround is to clear the CXX environment variable before we call the installation.
Then it will build the extension using the compiler configured in python's sysconfig.



---

archive/issue_comments_464565.json:
```json
{
    "body": "<a id='comment:23'></a>\nHum, OK but only for OSX. The problem is that we set CXX as a c++11 compiler which means CXX may actually be `g++ -std=c++11` (or `gnu++11` actually) in most case. On OS X, clang++ is c++11 at least by default so we can afford that. On other platforms, we would run into troubles.\n\nWhy does CXX includes `-std=c++11` rather than it being a separate CPPFLAGS? Because CXX as a whole is defined as a c++11 compiler.",
    "created_at": "2020-03-27T21:27:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464565",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
Hum, OK but only for OSX. The problem is that we set CXX as a c++11 compiler which means CXX may actually be `g++ -std=c++11` (or `gnu++11` actually) in most case. On OS X, clang++ is c++11 at least by default so we can afford that. On other platforms, we would run into troubles.

Why does CXX includes `-std=c++11` rather than it being a separate CPPFLAGS? Because CXX as a whole is defined as a c++11 compiler.



---

archive/issue_comments_464566.json:
```json
{
    "body": "<a id='comment:24'></a>\nOur own python3 has `g++ -std=c++11` in its sysconfig CXX in that case.\n\nBut you are right, for a system python3, we would not be able to assume that the sysconfig CXX is a C++11 compiler.",
    "created_at": "2020-03-27T22:22:19Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464566",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Our own python3 has `g++ -std=c++11` in its sysconfig CXX in that case.

But you are right, for a system python3, we would not be able to assume that the sysconfig CXX is a C++11 compiler.



---

archive/issue_comments_464567.json:
```json
{
    "body": "<a id='comment:25'></a>\nSo I guess this needs to be figured out at configure time.",
    "created_at": "2020-03-27T22:22:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464567",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
So I guess this needs to be figured out at configure time.



---

archive/issue_comments_464568.json:
```json
{
    "body": "<a id='comment:26'></a>\nA different workaround is to set `LDSHARED=\"$CXX -bundle -undefined dynamic_lookup\"`.",
    "created_at": "2020-03-27T22:44:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464568",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
A different workaround is to set `LDSHARED="$CXX -bundle -undefined dynamic_lookup"`.



---

archive/issue_comments_464569.json:
```json
{
    "body": "<a id='comment:27'></a>\nThat sounds interesting! And it avoids the c++11 mess.",
    "created_at": "2020-03-27T22:46:20Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464569",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
That sounds interesting! And it avoids the c++11 mess.



---

archive/issue_comments_464570.json:
```json
{
    "body": "<a id='comment:28'></a>\nSo, a macOS-specific workaround for all Python packages that use C++ extensions?",
    "created_at": "2020-03-27T22:54:49Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464570",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
So, a macOS-specific workaround for all Python packages that use C++ extensions?



---

archive/issue_comments_464571.json:
```json
{
    "body": "<a id='comment:29'></a>\nUnfortunately, pretty much.",
    "created_at": "2020-03-27T22:56:36Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464571",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>
Unfortunately, pretty much.



---

archive/issue_comments_464572.json:
```json
{
    "body": "<a id='comment:30'></a>\nInteresting is also this test:\nhttps://github.com/python/cpython/blob/e42b705188271da108de42b55d9344642170aa2b/Lib/distutils/tests/test_unixccompiler.py#L105\nwhich corresponds to https://bugs.python.org/issue18080. \nThe code added in this issue is unfortunately made ineffective by the fact that in Apple's installation, `cc = \"xcrun -sdk macosx clang    -arch x86_64 \"` and `ldshared = \"xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup \"`, i.e., `ldshared.startswith(cc)` is False.",
    "created_at": "2020-03-27T23:23:47Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464572",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Interesting is also this test:
https://github.com/python/cpython/blob/e42b705188271da108de42b55d9344642170aa2b/Lib/distutils/tests/test_unixccompiler.py#L105
which corresponds to https://bugs.python.org/issue18080. 
The code added in this issue is unfortunately made ineffective by the fact that in Apple's installation, `cc = "xcrun -sdk macosx clang    -arch x86_64 "` and `ldshared = "xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup "`, i.e., `ldshared.startswith(cc)` is False.



---

archive/issue_comments_464573.json:
```json
{
    "body": "<a id='comment:31'></a>\nA candidate for a portable solution, to be applied to all Python packages that build C++ extensions would be:\n\n```\nLDSHARED=$(/usr/bin/python -c 'import sysconfig; print(sysconfig.get_config_var(\"LDCXXSHARED\"))')\n```",
    "created_at": "2020-03-27T23:29:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464573",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
A candidate for a portable solution, to be applied to all Python packages that build C++ extensions would be:

```
LDSHARED=$(/usr/bin/python -c 'import sysconfig; print(sysconfig.get_config_var("LDCXXSHARED"))')
```



---

archive/issue_comments_464574.json:
```json
{
    "body": "<a id='comment:32'></a>\nWith this, packages would still compile with CXX (which would include the C++11 flags if needed), but link with the C++ linker known to sysconfig.",
    "created_at": "2020-03-27T23:30:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464574",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
With this, packages would still compile with CXX (which would include the C++11 flags if needed), but link with the C++ linker known to sysconfig.



---

archive/issue_comments_464575.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [mkoeppe](#comment%3A31):\n> A candidate for a portable solution, to be applied to all Python packages that build C++ extensions would be:\n> \n> ```\n> LDSHARED=$(/usr/bin/python -c 'import sysconfig; print(sysconfig.get_config_var(\"LDCXXSHARED\"))')\n> ```\n\n\nI don't like the `/usr/bin/python` bit, but I am sure we can replace that by something appropriate. That sounds like a good idea and now it needs to be tested.",
    "created_at": "2020-03-27T23:53:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464575",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:33'></a>
Replying to [mkoeppe](#comment%3A31):
> A candidate for a portable solution, to be applied to all Python packages that build C++ extensions would be:
> 
> ```
> LDSHARED=$(/usr/bin/python -c 'import sysconfig; print(sysconfig.get_config_var("LDCXXSHARED"))')
> ```


I don't like the `/usr/bin/python` bit, but I am sure we can replace that by something appropriate. That sounds like a good idea and now it needs to be tested.



---

archive/issue_comments_464576.json:
```json
{
    "body": "<a id='comment:34'></a>\nRight, of course it would be `LDSHARED=$(sage-python23 -c 'import sysconfig; print(sysconfig.get_config_var(\"LDCXXSHARED\"))').`",
    "created_at": "2020-03-27T23:56:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464576",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
Right, of course it would be `LDSHARED=$(sage-python23 -c 'import sysconfig; print(sysconfig.get_config_var("LDCXXSHARED"))').`



---

archive/issue_comments_464577.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)",
    "created_at": "2020-03-28T03:04:59Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464577",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)



---

archive/issue_comments_464578.json:
```json
{
    "body": "<a id='comment:36'></a>\nThis did not work after all, but I have found a solution that seems to work and is reasonably clean.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629\">4541e18</a></td><td><code>src/bin/sage-env: Set LDSHARED when CXX is set</code></td></tr></table>\n",
    "created_at": "2020-03-28T03:05:39Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464578",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
This did not work after all, but I have found a solution that seems to work and is reasonably clean.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629">4541e18</a></td><td><code>src/bin/sage-env: Set LDSHARED when CXX is set</code></td></tr></table>




---

archive/issue_comments_464579.json:
```json
{
    "body": "**Commit:** [4541e189ee189c554512c2948aba7bdea6b02629](https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629)",
    "created_at": "2020-03-28T03:05:39Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464579",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [4541e189ee189c554512c2948aba7bdea6b02629](https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629)



---

archive/issue_comments_464580.json:
```json
{
    "body": "<a id='comment:37'></a>\nSetting this unconditionally in `sage-env` rather than in package build scripts -- to make sure that these settings are in place even when a user does a `sage -pip install` of some random package.",
    "created_at": "2020-03-28T03:06:34Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464580",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
Setting this unconditionally in `sage-env` rather than in package build scripts -- to make sure that these settings are in place even when a user does a `sage -pip install` of some random package.



---

archive/issue_comments_464581.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-03-28T03:08:19Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464581",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_464582.json:
```json
{
    "body": "<a id='comment:39'></a>\nLooks OK to me. I guess you have some bots testing it out.",
    "created_at": "2020-03-28T03:09:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464582",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
Looks OK to me. I guess you have some bots testing it out.



---

archive/issue_comments_464583.json:
```json
{
    "body": "<a id='comment:40'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/65083365",
    "created_at": "2020-03-28T03:42:29Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464583",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/65083365



---

archive/issue_events_261732.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T03:42:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261732"
}
```



---

archive/issue_comments_464584.json:
```json
{
    "body": "<a id='comment:42'></a>\nThis breaks matplotlib via numpy unfortunately",
    "created_at": "2020-03-28T14:30:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464584",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
This breaks matplotlib via numpy unfortunately



---

archive/issue_events_261733.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T14:30:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261733"
}
```



---

archive/issue_events_261734.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T14:30:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261734"
}
```



---

archive/issue_comments_464585.json:
```json
{
    "body": "<a id='comment:43'></a>\n\n```\n        from numpy.core._multiarray_umath import (\n    ImportError: /sage/local/lib/python3.7/site-packages/numpy/core/_multiarray_umath.cpython-37m-x86_64-linux-gnu.so: undefined symbol: __cpu_model\n\n```",
    "created_at": "2020-03-28T14:30:58Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464585",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>

```
        from numpy.core._multiarray_umath import (
    ImportError: /sage/local/lib/python3.7/site-packages/numpy/core/_multiarray_umath.cpython-37m-x86_64-linux-gnu.so: undefined symbol: __cpu_model

```



---

archive/issue_comments_464586.json:
```json
{
    "body": "**Changing commit** from \"[4541e189ee189c554512c2948aba7bdea6b02629](https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629)\" to \"[747297132ccf36b1c610ccafbef984a403fc39e7](https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7)\".",
    "created_at": "2020-03-28T14:42:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464586",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4541e189ee189c554512c2948aba7bdea6b02629](https://github.com/sagemath/sagetrac-mirror/commit/4541e189ee189c554512c2948aba7bdea6b02629)" to "[747297132ccf36b1c610ccafbef984a403fc39e7](https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7)".



---

archive/issue_comments_464587.json:
```json
{
    "body": "<a id='comment:44'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7\">7472971</a></td><td><code>build/pkgs/numpy/spkg-install.in: Unset LDSHARED</code></td></tr></table>\n",
    "created_at": "2020-03-28T14:42:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464587",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7">7472971</a></td><td><code>build/pkgs/numpy/spkg-install.in: Unset LDSHARED</code></td></tr></table>




---

archive/issue_events_261735.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T15:09:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261735"
}
```



---

archive/issue_events_261736.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-28T15:09:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261736"
}
```



---

archive/issue_events_261737.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-03-28T15:24:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261737"
}
```



---

archive/issue_events_261738.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-03-28T15:24:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261738"
}
```



---

archive/issue_comments_464588.json:
```json
{
    "body": "<a id='comment:46'></a>\nThis is dropping `-pthread` on linux.",
    "created_at": "2020-03-28T15:24:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464588",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:46'></a>
This is dropping `-pthread` on linux.



---

archive/issue_comments_464589.json:
```json
{
    "body": "<a id='comment:47'></a>\nOriginal issue is because the logic at https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 doesn't get triggered with,\n\n```\nCC xcrun -sdk macosx clang    -arch x86_64\nLDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup\n```",
    "created_at": "2020-03-28T15:38:10Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464589",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:47'></a>
Original issue is because the logic at https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 doesn't get triggered with,

```
CC xcrun -sdk macosx clang    -arch x86_64
LDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup
```



---

archive/issue_comments_464590.json:
```json
{
    "body": "<a id='comment:48'></a>\nHelp with this ticket is welcome!",
    "created_at": "2020-03-28T16:21:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464590",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
Help with this ticket is welcome!



---

archive/issue_events_261739.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-29T14:39:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261739"
}
```



---

archive/issue_comments_464591.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [isuruf](#comment%3A47):\n> Original issue is because the logic at https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 doesn't get triggered with,\n> \n> ```\n> CC xcrun -sdk macosx clang    -arch x86_64\n> LDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup\n> ```\n\n\nI don't quite understand this comment. Should it be `CC=...` etc? \nAnyhow, we can propose an upstream patch...",
    "created_at": "2020-03-30T15:16:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464591",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>
Replying to [isuruf](#comment%3A47):
> Original issue is because the logic at https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 doesn't get triggered with,
> 
> ```
> CC xcrun -sdk macosx clang    -arch x86_64
> LDSHARED xcrun -sdk macosx clang     -bundle -undefined dynamic_lookup
> ```


I don't quite understand this comment. Should it be `CC=...` etc? 
Anyhow, we can propose an upstream patch...



---

archive/issue_comments_464592.json:
```json
{
    "body": "<a id='comment:51'></a>\nhttps://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 checks that `LDSHARED` starts with the old `CC` and if so, old `CC` is replaced with the new `CC`.\n\nIf `LDSHARED` was `xcrun -sdk macosx clang     -arch x86_64 -bundle -undefined dynamic_lookup`, then setting `CC=clang` would give you, `clang -bundle -undefined dynamic_lookup`, but at the moment it is not.",
    "created_at": "2020-03-30T15:19:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464592",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:51'></a>
https://github.com/python/cpython/blob/8510f430781118d9b603c3a2f06945d6ebc5fe42/Lib/distutils/sysconfig.py#L204-L205 checks that `LDSHARED` starts with the old `CC` and if so, old `CC` is replaced with the new `CC`.

If `LDSHARED` was `xcrun -sdk macosx clang     -arch x86_64 -bundle -undefined dynamic_lookup`, then setting `CC=clang` would give you, `clang -bundle -undefined dynamic_lookup`, but at the moment it is not.



---

archive/issue_comments_464593.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -20,5 +20,12 @@\n ```\n tox -e local-homebrew-macos-standard -- V=0 pplpy\n ```\n+With #29417, it is:\n+\n+```\n+tox -e local-homebrew-macos-standard-python3_xcode -- V=0 pplpy\n+```\n+\n+\n \n (broken out from #29404)\n``````\n",
    "created_at": "2020-03-31T01:21:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464593",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -20,5 +20,12 @@
 ```
 tox -e local-homebrew-macos-standard -- V=0 pplpy
 ```
+With #29417, it is:
+
+```
+tox -e local-homebrew-macos-standard-python3_xcode -- V=0 pplpy
+```
+
+
 
 (broken out from #29404)
``````




---

archive/issue_comments_464594.json:
```json
{
    "body": "**Changing commit** from \"[747297132ccf36b1c610ccafbef984a403fc39e7](https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7)\" to \"[bcb753409f879151616cb022be8a35247f4be2e0](https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0)\".",
    "created_at": "2020-04-01T03:01:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464594",
    "user": "https://github.com/isuruf"
}
```

**Changing commit** from "[747297132ccf36b1c610ccafbef984a403fc39e7](https://github.com/sagemath/sagetrac-mirror/commit/747297132ccf36b1c610ccafbef984a403fc39e7)" to "[bcb753409f879151616cb022be8a35247f4be2e0](https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0)".



---

archive/issue_comments_464595.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"Matthias Koeppe, Isuru Fernando\".",
    "created_at": "2020-04-01T03:01:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464595",
    "user": "https://github.com/isuruf"
}
```

**Changing author** from "Matthias Koeppe" to "Matthias Koeppe, Isuru Fernando".



---

archive/issue_events_261740.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-01T03:01:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261740"
}
```



---

archive/issue_events_261741.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-01T03:01:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261741"
}
```



---

archive/issue_comments_464596.json:
```json
{
    "body": "<a id='comment:54'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0\">bcb7534</a></td><td><code>Add -pthread to LDSHARED</code></td></tr></table>\n",
    "created_at": "2020-04-01T03:01:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464596",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:54'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0">bcb7534</a></td><td><code>Add -pthread to LDSHARED</code></td></tr></table>




---

archive/issue_comments_464597.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)\" to \"[u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)\".",
    "created_at": "2020-04-01T03:01:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464597",
    "user": "https://github.com/isuruf"
}
```

**Changing branch** from "[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)" to "[u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)".



---

archive/issue_comments_464598.json:
```json
{
    "body": "<a id='comment:55'></a>\nFails on ubuntu-xenial-standard (https://github.com/mkoeppe/sage/runs/552215553):\n\n```\n  ImportError: /sage/local/lib/python3.7/site-packages/numpy/core/_multiarray_umath.cpython-37m-x86_64-linux-gnu.so: undefined symbol: __cpu_model\n```",
    "created_at": "2020-04-02T00:49:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464598",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>
Fails on ubuntu-xenial-standard (https://github.com/mkoeppe/sage/runs/552215553):

```
  ImportError: /sage/local/lib/python3.7/site-packages/numpy/core/_multiarray_umath.cpython-37m-x86_64-linux-gnu.so: undefined symbol: __cpu_model
```



---

archive/issue_events_261742.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-02T00:50:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261742"
}
```



---

archive/issue_events_261743.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-02T00:50:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261743"
}
```



---

archive/issue_comments_464599.json:
```json
{
    "body": "<a id='comment:57'></a>\nIt looks like on ubuntu, `LDSHARED` has `-Wl,-Bsymbolic-functions` which we need to include.\nShall we only set `LDSHARED` in OSX?",
    "created_at": "2020-04-02T01:22:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464599",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:57'></a>
It looks like on ubuntu, `LDSHARED` has `-Wl,-Bsymbolic-functions` which we need to include.
Shall we only set `LDSHARED` in OSX?



---

archive/issue_comments_464600.json:
```json
{
    "body": "<a id='comment:58'></a>\nReplying to [isuruf](#comment%3A57):\n> Shall we only set `LDSHARED` in OSX?\n\n\nProbably better, yes",
    "created_at": "2020-04-02T01:43:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464600",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
Replying to [isuruf](#comment%3A57):
> Shall we only set `LDSHARED` in OSX?


Probably better, yes



---

archive/issue_comments_464601.json:
```json
{
    "body": "<a id='comment:59'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259\">e4056f0</a></td><td><code>Set LDSHARED only on OSX</code></td></tr></table>\n",
    "created_at": "2020-04-02T03:03:13Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464601",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259">e4056f0</a></td><td><code>Set LDSHARED only on OSX</code></td></tr></table>




---

archive/issue_comments_464602.json:
```json
{
    "body": "**Changing commit** from \"[bcb753409f879151616cb022be8a35247f4be2e0](https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0)\" to \"[e4056f05b37a5bae7ceca18992ee91a502089259](https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259)\".",
    "created_at": "2020-04-02T03:03:13Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464602",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bcb753409f879151616cb022be8a35247f4be2e0](https://github.com/sagemath/sagetrac-mirror/commit/bcb753409f879151616cb022be8a35247f4be2e0)" to "[e4056f05b37a5bae7ceca18992ee91a502089259](https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259)".



---

archive/issue_events_261744.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-02T03:03:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261744"
}
```



---

archive/issue_events_261745.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-04-02T03:03:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261745"
}
```



---

archive/issue_comments_464603.json:
```json
{
    "body": "**Changing branch** from \"[u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)\" to \"[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)\".",
    "created_at": "2020-04-02T12:17:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464603",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/isuruf/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)" to "[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)".



---

archive/issue_comments_464604.json:
```json
{
    "body": "<a id='comment:62'></a>\nrebased on 9.1.beta9\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a6238eed2ab25519b1b40061dc3803e3163c581\">7a6238e</a></td><td><code>src/bin/sage-env: Set LDSHARED when CXX is set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbe7a1e9c6724d1ae9ae0f5b26c218c967a915e5\">cbe7a1e</a></td><td><code>build/pkgs/numpy/spkg-install.in: Unset LDSHARED</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/089d2a2ea8aa64a2bf7bafb77094f9d9e73e3cd7\">089d2a2</a></td><td><code>Add -pthread to LDSHARED</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1\">96a599c</a></td><td><code>Set LDSHARED only on OSX</code></td></tr></table>\n",
    "created_at": "2020-04-02T12:17:14Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464604",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>
rebased on 9.1.beta9

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a6238eed2ab25519b1b40061dc3803e3163c581">7a6238e</a></td><td><code>src/bin/sage-env: Set LDSHARED when CXX is set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbe7a1e9c6724d1ae9ae0f5b26c218c967a915e5">cbe7a1e</a></td><td><code>build/pkgs/numpy/spkg-install.in: Unset LDSHARED</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/089d2a2ea8aa64a2bf7bafb77094f9d9e73e3cd7">089d2a2</a></td><td><code>Add -pthread to LDSHARED</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1">96a599c</a></td><td><code>Set LDSHARED only on OSX</code></td></tr></table>




---

archive/issue_comments_464605.json:
```json
{
    "body": "**Changing commit** from \"[e4056f05b37a5bae7ceca18992ee91a502089259](https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259)\" to \"[96a599c5ff3802bd77f63688d859aa689c3f5fe1](https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1)\".",
    "created_at": "2020-04-02T12:17:14Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464605",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[e4056f05b37a5bae7ceca18992ee91a502089259](https://github.com/sagemath/sagetrac-mirror/commit/e4056f05b37a5bae7ceca18992ee91a502089259)" to "[96a599c5ff3802bd77f63688d859aa689c3f5fe1](https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1)".



---

archive/issue_comments_464606.json:
```json
{
    "body": "<a id='comment:63'></a>\nOn `local-homebrew-macos-python3_pythonorg-minimal`(https://github.com/mkoeppe/sage/runs/557674691):\n\n```\nsage -t src/sage/repl/ipython_extension.py\n**********************************************************************\nFile \"src/sage/repl/ipython_extension.py\", line 385, in sage.repl.ipython_extension.SageMagics.fortran\nFailed example:\n...\nRuntimeError: failed to compile Fortran code:\n    b'Could not locate executable g++ -std=gnu++11 -pthread -bundle -undefined dynamic_lookup\\nIn file included from \n```",
    "created_at": "2020-04-03T17:36:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464606",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>
On `local-homebrew-macos-python3_pythonorg-minimal`(https://github.com/mkoeppe/sage/runs/557674691):

```
sage -t src/sage/repl/ipython_extension.py
**********************************************************************
File "src/sage/repl/ipython_extension.py", line 385, in sage.repl.ipython_extension.SageMagics.fortran
Failed example:
...
RuntimeError: failed to compile Fortran code:
    b'Could not locate executable g++ -std=gnu++11 -pthread -bundle -undefined dynamic_lookup\nIn file included from 
```



---

archive/issue_events_261746.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T17:37:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261746"
}
```



---

archive/issue_events_261747.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T17:37:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261747"
}
```



---

archive/issue_comments_464607.json:
```json
{
    "body": "<a id='comment:65'></a>\nAlso \n\n```\nsage -t src/sage/interfaces/gap.py  # 1 doctest failed\nsage -t src/sage/misc/inline_fortran.py  # 3 doctests failed\nsage -t src/sage/misc/persist.pyx  # 2 doctests failed\n```",
    "created_at": "2020-04-03T17:38:01Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464607",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>
Also 

```
sage -t src/sage/interfaces/gap.py  # 1 doctest failed
sage -t src/sage/misc/inline_fortran.py  # 3 doctests failed
sage -t src/sage/misc/persist.pyx  # 2 doctests failed
```



---

archive/issue_comments_464608.json:
```json
{
    "body": "<a id='comment:66'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f721740d1e85cc6f503d5b0fba01bdcbc4e9f97e\">f721740</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Also check whether C++ extensions can be built</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046\">8317c3e</a></td><td><code>Undo #21175: Set ARCHFLAGS only when compiling Perl modules</code></td></tr></table>\n",
    "created_at": "2020-04-09T03:50:27Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464608",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:66'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f721740d1e85cc6f503d5b0fba01bdcbc4e9f97e">f721740</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Also check whether C++ extensions can be built</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046">8317c3e</a></td><td><code>Undo #21175: Set ARCHFLAGS only when compiling Perl modules</code></td></tr></table>




---

archive/issue_comments_464609.json:
```json
{
    "body": "**Changing commit** from \"[96a599c5ff3802bd77f63688d859aa689c3f5fe1](https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1)\" to \"[8317c3eb7729c06aeace618726808d6342fda046](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)\".",
    "created_at": "2020-04-09T03:50:27Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464609",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[96a599c5ff3802bd77f63688d859aa689c3f5fe1](https://github.com/sagemath/sagetrac-mirror/commit/96a599c5ff3802bd77f63688d859aa689c3f5fe1)" to "[8317c3eb7729c06aeace618726808d6342fda046](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)".



---

archive/issue_events_261748.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T03:52:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261748"
}
```



---

archive/issue_events_261749.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T03:52:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261749"
}
```



---

archive/issue_comments_464610.json:
```json
{
    "body": "<a id='comment:67'></a>\nStarted again from scratch. Turns out I broke it 4 years ago in #21175 by setting `ARCHFLAGS`. This interacts in a bizarre way with the bizarre code discussed above.",
    "created_at": "2020-04-09T03:52:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464610",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:67'></a>
Started again from scratch. Turns out I broke it 4 years ago in #21175 by setting `ARCHFLAGS`. This interacts in a bizarre way with the bizarre code discussed above.



---

archive/issue_comments_464611.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe, Isuru Fernando\" to \"Matthias Koeppe\".",
    "created_at": "2020-04-09T03:52:20Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464611",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe, Isuru Fernando" to "Matthias Koeppe".



---

archive/issue_comments_464612.json:
```json
{
    "body": "<a id='comment:69'></a>\nTests run in https://github.com/mkoeppe/sage/actions/runs/73955490",
    "created_at": "2020-04-09T03:58:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464612",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>
Tests run in https://github.com/mkoeppe/sage/actions/runs/73955490



---

archive/issue_comments_464613.json:
```json
{
    "body": "<a id='comment:70'></a>\nThis works for me, but I don't understand the changes in `build/pkgs/python3/spkg-configure.m4`.",
    "created_at": "2020-04-09T23:29:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464613",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:70'></a>
This works for me, but I don't understand the changes in `build/pkgs/python3/spkg-configure.m4`.



---

archive/issue_comments_464614.json:
```json
{
    "body": "<a id='comment:71'></a>\nSo if someone else wants to review it, I am happy to give some fraction of a positive review.",
    "created_at": "2020-04-09T23:31:19Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464614",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:71'></a>
So if someone else wants to review it, I am happy to give some fraction of a positive review.



---

archive/issue_comments_464615.json:
```json
{
    "body": "<a id='comment:72'></a>\nReplying to [jhpalmieri](#comment%3A70):\n> I don't understand the changes in `build/pkgs/python3/spkg-configure.m4`.\n\n\nThere was already a test that the system python (in the venv) is able to build a C extension.\nThe change tightens this check by imposing the configured `CC` (and `CXX`) values -- because this is what the actual build will be running.\nIt also adds the same test for building a C++ 11 extension.",
    "created_at": "2020-04-09T23:35:28Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464615",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>
Replying to [jhpalmieri](#comment%3A70):
> I don't understand the changes in `build/pkgs/python3/spkg-configure.m4`.


There was already a test that the system python (in the venv) is able to build a C extension.
The change tightens this check by imposing the configured `CC` (and `CXX`) values -- because this is what the actual build will be running.
It also adds the same test for building a C++ 11 extension.



---

archive/issue_comments_464616.json:
```json
{
    "body": "<a id='comment:73'></a>\nReplying to [jhpalmieri](#comment%3A71):\n> some fraction of a positive review.\n\n100% thanks already",
    "created_at": "2020-04-09T23:36:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464616",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>
Replying to [jhpalmieri](#comment%3A71):
> some fraction of a positive review.

100% thanks already



---

archive/issue_comments_464617.json:
```json
{
    "body": "<a id='comment:74'></a>\nLet's also get this one into the next beta please",
    "created_at": "2020-04-12T00:55:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464617",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'></a>
Let's also get this one into the next beta please



---

archive/issue_events_261750.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-12T16:59:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261750"
}
```



---

archive/issue_events_261751.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-12T16:59:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261751"
}
```



---

archive/issue_comments_464618.json:
```json
{
    "body": "<a id='comment:77'></a>\nOkay, let's merge it. I can't get polymake to build with or without these changes, and the changes make sense.\n\nRe polymake, here is the error:\n\n```\nninja: Entering directory `build/Opt'\n[1/1] GENERATE /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja\nFAILED: /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja \n/usr/bin/perl /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_ninja_targets.pl /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/config.ninja\nCan't locate JSON.pm in @INC (you may need to install the JSON module) (@INC contains: /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/lib/perl5/darwin-thread-multi-2level /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/lib/perl5 /Library/Perl/5.18/darwin-thread-multi-2level /Library/Perl/5.18 /Network/Library/Perl/5.18/darwin-thread-multi-2level /Network/Library/Perl/5.18 /Library/Perl/Updates/5.18.4 /System/Library/Perl/5.18/darwin-thread-multi-2level /System/Library/Perl/5.18 /System/Library/Perl/Extras/5.18/darwin-thread-multi-2level /System/Library/Perl/Extras/5.18 .) at /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_cpperl_modules.pl line 22.\nBEGIN failed--compilation aborted at /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_cpperl_modules.pl line 22.\nninja: error: rebuilding 'build.ninja': subcommand failed\nmake[2]: *** [all] Error 1\n```\nIt's probably the old problem of not having the right perl modules present and Sage's polymake build system failing to recognize that. The instructions in polymake's SPKG.txt are no longer valid.\n\nIn any case, the polymake problems should be dealt with at #29054.",
    "created_at": "2020-04-12T21:02:13Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464618",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:77'></a>
Okay, let's merge it. I can't get polymake to build with or without these changes, and the changes make sense.

Re polymake, here is the error:

```
ninja: Entering directory `build/Opt'
[1/1] GENERATE /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja
FAILED: /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja 
/usr/bin/perl /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_ninja_targets.pl /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/targets.ninja /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/build/config.ninja
Can't locate JSON.pm in @INC (you may need to install the JSON module) (@INC contains: /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/lib/perl5/darwin-thread-multi-2level /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/lib/perl5 /Library/Perl/5.18/darwin-thread-multi-2level /Library/Perl/5.18 /Network/Library/Perl/5.18/darwin-thread-multi-2level /Network/Library/Perl/5.18 /Library/Perl/Updates/5.18.4 /System/Library/Perl/5.18/darwin-thread-multi-2level /System/Library/Perl/5.18 /System/Library/Perl/Extras/5.18/darwin-thread-multi-2level /System/Library/Perl/Extras/5.18 .) at /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_cpperl_modules.pl line 22.
BEGIN failed--compilation aborted at /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.1.beta9/local/var/tmp/sage/build/polymake-3.4/src/support/generate_cpperl_modules.pl line 22.
ninja: error: rebuilding 'build.ninja': subcommand failed
make[2]: *** [all] Error 1
```
It's probably the old problem of not having the right perl modules present and Sage's polymake build system failing to recognize that. The instructions in polymake's SPKG.txt are no longer valid.

In any case, the polymake problems should be dealt with at #29054.



---

archive/issue_comments_464619.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2020-04-12T21:02:13Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464619",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_events_261752.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-04-12T21:02:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261752"
}
```



---

archive/issue_events_261753.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-04-12T21:02:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261753"
}
```



---

archive/issue_comments_464620.json:
```json
{
    "body": "<a id='comment:78'></a>\nThanks. Yes, polymake will take more work.",
    "created_at": "2020-04-12T21:03:59Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464620",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'></a>
Thanks. Yes, polymake will take more work.



---

archive/issue_comments_464621.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)\" to \"[8317c3eb7729c06aeace618726808d6342fda046](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)\".",
    "created_at": "2020-04-15T22:13:18Z",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29408#issuecomment-464621",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_build_errors_with_pplpy__scipy__kiwisolver__fpylll_on_macos_with_system_python3)" to "[8317c3eb7729c06aeace618726808d6342fda046](https://github.com/sagemath/sagetrac-mirror/commit/8317c3eb7729c06aeace618726808d6342fda046)".



---

archive/issue_events_261754.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-15T22:13:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261754"
}
```



---

archive/issue_events_261755.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b42af5e1f923f5d36a4ee4c6a9c866cb4dcdc4a1",
    "created_at": "2020-04-15T22:13:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29408",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29408#event-261755"
}
```
