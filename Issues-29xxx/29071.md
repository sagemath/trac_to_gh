# Issue 29071: verify if cblas.pc and lapack.pc should be replaced by links to openblas.pc

archive/issues_028834.json:
```json
{
    "assignees": [],
    "body": "currently openblas's spkg-configure.pc unconditionally makes cblas.pc and lapack.pc copies of openblas.pc, which in some cases if incorrect, e.g. Arch Linux has libcblas linked to libopenblas\nand containing stuff missing in libopenblas, resulting in errors.\n\nthis has been reported on sage-devel\nhttps://groups.google.com/d/msg/sage-devel/pIOnFyFJMtM/_FbzM2OxCQAJ\n\nSo we should make these installations conditional.\n\nDepends on #29051\n\nCC:  @isuruf @mkoeppe @antonio-rojas\n\nBranch/Commit: **[3a4524e](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**\n\nReviewer: **Isuru Fernando, Matthias Koeppe**\n\nAuthor: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29071_\n\n",
    "closed_at": "2020-01-31T23:49:32Z",
    "created_at": "2020-01-23T17:18:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "verify if cblas.pc and lapack.pc should be replaced by links to openblas.pc",
    "type": "issue",
    "updated_at": "2020-01-31T23:49:32Z",
    "url": "https://github.com/sagemath/sage/issues/29071",
    "user": "https://github.com/dimpase"
}
```
currently openblas's spkg-configure.pc unconditionally makes cblas.pc and lapack.pc copies of openblas.pc, which in some cases if incorrect, e.g. Arch Linux has libcblas linked to libopenblas
and containing stuff missing in libopenblas, resulting in errors.

this has been reported on sage-devel
https://groups.google.com/d/msg/sage-devel/pIOnFyFJMtM/_FbzM2OxCQAJ

So we should make these installations conditional.

Depends on #29051

CC:  @isuruf @mkoeppe @antonio-rojas

Branch/Commit: **[3a4524e](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**

Reviewer: **Isuru Fernando, Matthias Koeppe**

Author: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/29071_





---

archive/issue_events_381269.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-23T17:18:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381269"
}
```



---

archive/issue_events_381270.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-23T17:18:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "component: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381270"
}
```



---

archive/issue_events_381271.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-23T17:18:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381271"
}
```



---

archive/issue_events_381272.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-23T17:18:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381272"
}
```



---

archive/issue_comments_457841.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\n> It depends on the fortran name mangling. For gfortran, one symbol would be dgeqrf_.\n\nwe can do an `AC_LINK_IFELSE()` test with a subroutine `dgeqef` call,\nand try to link it against libopenblas. this would be independent of Fortran compiler.\n\nhttp://www.netlib.org/lapack/explore-html/df/dc5/group__variants_g_ecomputational_ga3766ea903391b5cf9008132f7440ec7b.html",
    "created_at": "2020-01-23T19:25:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457841",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">Comment 1</div>

> It depends on the fortran name mangling. For gfortran, one symbol would be dgeqrf_.

we can do an `AC_LINK_IFELSE()` test with a subroutine `dgeqef` call,
and try to link it against libopenblas. this would be independent of Fortran compiler.

http://www.netlib.org/lapack/explore-html/df/dc5/group__variants_g_ecomputational_ga3766ea903391b5cf9008132f7440ec7b.html



---

archive/issue_comments_457842.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nAnd for cblas we can do `AC_CHECK_LIB()` on `cblas_dgemm`, as Antonio proposed.",
    "created_at": "2020-01-23T19:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457842",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">Comment 2</div>

And for cblas we can do `AC_CHECK_LIB()` on `cblas_dgemm`, as Antonio proposed.



---

archive/issue_comments_457843.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nYou can also use `AC_FC_FUNC` to get the mangled name.",
    "created_at": "2020-01-23T19:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457843",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:3" align="right">Comment 3</div>

You can also use `AC_FC_FUNC` to get the mangled name.



---

archive/issue_comments_457844.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nReplying to [@isuruf](#comment%3A3):\n> You can also use `AC_FC_FUNC` to get the mangled name.\n\nOK, that's better, thanks.",
    "created_at": "2020-01-23T19:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457844",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">Comment 4</div>

Replying to [@isuruf](#comment%3A3):
> You can also use `AC_FC_FUNC` to get the mangled name.

OK, that's better, thanks.



---

archive/issue_comments_457845.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2020-01-24T11:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457845",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_events_381273.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-24T11:17:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381273"
}
```



---

archive/issue_comments_457846.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)**",
    "created_at": "2020-01-24T11:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457846",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)**



---

archive/issue_comments_457847.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nneeds testing on Arch in particular.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04\">ccc5d82</a></td><td><code>install cblas.pc and lapack.pc links conditionally</code></td></tr></table>\n",
    "created_at": "2020-01-24T11:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457847",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">Comment 5</div>

needs testing on Arch in particular.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04">ccc5d82</a></td><td><code>install cblas.pc and lapack.pc links conditionally</code></td></tr></table>




---

archive/issue_comments_457848.json:
```json
{
    "body": "Commit: **[ccc5d82](https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04)**",
    "created_at": "2020-01-24T11:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457848",
    "user": "https://github.com/dimpase"
}
```

Commit: **[ccc5d82](https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04)**



---

archive/issue_comments_457849.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\ntrying now on arch",
    "created_at": "2020-01-24T12:14:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457849",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">Comment 6</div>

trying now on arch



---

archive/issue_comments_457850.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160\">f6714fb</a></td><td><code>use AC_SEARCH_LIBS</code></td></tr></table>\n",
    "created_at": "2020-01-24T12:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457850",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7" align="right">Comment 7</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160">f6714fb</a></td><td><code>use AC_SEARCH_LIBS</code></td></tr></table>




---

archive/issue_comments_457851.json:
```json
{
    "body": "Changed commit from **[ccc5d82](https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04)** to **[f6714fb](https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160)**",
    "created_at": "2020-01-24T12:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457851",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ccc5d82](https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04)** to **[f6714fb](https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160)**



---

archive/issue_comments_457852.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nWith the branch applied, I end up with the same permission issues as with `./configure --without-system-openblas`. That is to say\n\n```\nCopying package files from temporary location /opt/sage/local/var/tmp/sage/build/openblas-0.3.6.p0/inst to /opt/sage/local\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/blas.pc': Permission denied\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/cblas.pc': Permission denied\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/lapack.pc': Permission denied\n```",
    "created_at": "2020-01-24T12:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457852",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">Comment 8</div>

With the branch applied, I end up with the same permission issues as with `./configure --without-system-openblas`. That is to say

```
Copying package files from temporary location /opt/sage/local/var/tmp/sage/build/openblas-0.3.6.p0/inst to /opt/sage/local
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/blas.pc': Permission denied
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/cblas.pc': Permission denied
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/lapack.pc': Permission denied
```



---

archive/issue_comments_457853.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nIs /opt/sage/local your $SAGE_LOCAL?\nIf so, could you try `rm -rf /opt/sage/local/pkgconfig/` ?",
    "created_at": "2020-01-24T12:28:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457853",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">Comment 9</div>

Is /opt/sage/local your $SAGE_LOCAL?
If so, could you try `rm -rf /opt/sage/local/pkgconfig/` ?



---

archive/issue_comments_457854.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nsorry, I meant `rm -rf /opt/sage/local/lib/pkgconfig/`",
    "created_at": "2020-01-24T12:31:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457854",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">Comment 10</div>

sorry, I meant `rm -rf /opt/sage/local/lib/pkgconfig/`



---

archive/issue_comments_457855.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\neven more precisely, `rm -f /opt/sage/local/lib/pkgconfig/*blas.pc && rm -f /opt/sage/local/lib/pkgconfig/lapack.pc`",
    "created_at": "2020-01-24T12:38:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457855",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">Comment 11</div>

even more precisely, `rm -f /opt/sage/local/lib/pkgconfig/*blas.pc && rm -f /opt/sage/local/lib/pkgconfig/lapack.pc`



---

archive/issue_comments_457856.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI presume you get permission problems while running `make`. This is due to #29003 - where the installation of these is done somewhat carelessly.",
    "created_at": "2020-01-24T12:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457856",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">Comment 12</div>

I presume you get permission problems while running `make`. This is due to #29003 - where the installation of these is done somewhat carelessly.



---

archive/issue_comments_457857.json:
```json
{
    "body": "Changed commit from **[f6714fb](https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160)** to **[7ac1293](https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315)**",
    "created_at": "2020-01-24T13:37:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457857",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f6714fb](https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160)** to **[7ac1293](https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315)**



---

archive/issue_comments_457858.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315\">7ac1293</a></td><td><code>added missing module names - cblas and lapack</code></td></tr></table>\n",
    "created_at": "2020-01-24T13:37:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457858",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13" align="right">Comment 13</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315">7ac1293</a></td><td><code>added missing module names - cblas and lapack</code></td></tr></table>




---

archive/issue_comments_457859.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nWhen I do `make distclean` it does remove `local` entirely. At which step do you want me to try `rm XXX`?",
    "created_at": "2020-01-24T13:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457859",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">Comment 14</div>

When I do `make distclean` it does remove `local` entirely. At which step do you want me to try `rm XXX`?



---

archive/issue_comments_457860.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nthe logic of this branch is still not 100% correct - if we end up installing OpenBLAS we should not install any *.pc files, i.e. should not run any `AC_CONFIG_LINKS`.",
    "created_at": "2020-01-24T13:42:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457860",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">Comment 15</div>

the logic of this branch is still not 100% correct - if we end up installing OpenBLAS we should not install any *.pc files, i.e. should not run any `AC_CONFIG_LINKS`.



---

archive/issue_comments_457861.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@videlec](#comment%3A14):\n> When I do `make distclean` it does remove `local` entirely. At which step do you want me to try `rm XXX`?\n\nthese `rm` from [comment:11](#comment%3A11) should be run after `./configure` and before `make`, assuming I understand what's going on.",
    "created_at": "2020-01-24T13:44:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457861",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@videlec](#comment%3A14):
> When I do `make distclean` it does remove `local` entirely. At which step do you want me to try `rm XXX`?

these `rm` from [comment:11](#comment%3A11) should be run after `./configure` and before `make`, assuming I understand what's going on.



---

archive/issue_comments_457862.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nBy the way, please pull the branch again - [comment:13](#comment%3A13) is rather important for Arch.",
    "created_at": "2020-01-24T13:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457862",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">Comment 17</div>

By the way, please pull the branch again - [comment:13](#comment%3A13) is rather important for Arch.



---

archive/issue_comments_457863.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nAfter `./configure` there is no directory `local/lib/pkgconfig/`\n\n```\n$ ls -R local/\nlocal/:\nbin  etc  include  lib  lib64  share  var\n\nlocal/bin:\n\nlocal/etc:\n\nlocal/include:\n\nlocal/lib:\n\nlocal/share:\n\nlocal/var:\nlib\n\nlocal/var/lib:\nsage\n\nlocal/var/lib/sage:\ninstalled\n\nlocal/var/lib/sage/installed:\n```",
    "created_at": "2020-01-24T13:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457863",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">Comment 18</div>

After `./configure` there is no directory `local/lib/pkgconfig/`

```
$ ls -R local/
local/:
bin  etc  include  lib  lib64  share  var

local/bin:

local/etc:

local/include:

local/lib:

local/share:

local/var:
lib

local/var/lib:
sage

local/var/lib/sage:
installed

local/var/lib/sage/installed:
```



---

archive/issue_comments_457864.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\n`local/lib/pkgconfig/` may or may not be present, it depends upon the state of the system.\n(e.g. if you did `make distclean` before `./configure` you won't have\n`local/` at all)\n\nNow, what happens if you run `make`? Do you still get the same error?",
    "created_at": "2020-01-24T14:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457864",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">Comment 19</div>

`local/lib/pkgconfig/` may or may not be present, it depends upon the state of the system.
(e.g. if you did `make distclean` before `./configure` you won't have
`local/` at all)

Now, what happens if you run `make`? Do you still get the same error?



---

archive/issue_comments_457865.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nIt seems I got Arch running in an lxc container, so I guess I can polish it on my own.",
    "created_at": "2020-01-24T15:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457865",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">Comment 20</div>

It seems I got Arch running in an lxc container, so I guess I can polish it on my own.



---

archive/issue_comments_457866.json:
```json
{
    "body": "Changed commit from **[7ac1293](https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315)** to **[16b4d9d](https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5)**",
    "created_at": "2020-01-24T18:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457866",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7ac1293](https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315)** to **[16b4d9d](https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5)**



---

archive/issue_comments_457867.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5\">16b4d9d</a></td><td><code>make installing *.pc files conditional</code></td></tr></table>\n",
    "created_at": "2020-01-24T18:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457867",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5">16b4d9d</a></td><td><code>make installing *.pc files conditional</code></td></tr></table>




---

archive/issue_comments_457868.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1\">2941411</a></td><td><code>correct quoting of m4 index variable</code></td></tr></table>\n",
    "created_at": "2020-01-24T22:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457868",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22" align="right">Comment 22</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1">2941411</a></td><td><code>correct quoting of m4 index variable</code></td></tr></table>




---

archive/issue_comments_457869.json:
```json
{
    "body": "Changed commit from **[16b4d9d](https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5)** to **[2941411](https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1)**",
    "created_at": "2020-01-24T22:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457869",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[16b4d9d](https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5)** to **[2941411](https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1)**



---

archive/issue_comments_457870.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nwith this last commit appears to work on Arch (with openblas from the system), all the way to the point of a broken scipy build - probably #29051.",
    "created_at": "2020-01-24T23:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457870",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">Comment 23</div>

with this last commit appears to work on Arch (with openblas from the system), all the way to the point of a broken scipy build - probably #29051.



---

archive/issue_comments_457871.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nIf I'm reading the code correctly `openblas.pc` is not copied to `blas.pc` right in the Arch Linux case right?",
    "created_at": "2020-01-24T23:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457871",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:24" align="right">Comment 24</div>

If I'm reading the code correctly `openblas.pc` is not copied to `blas.pc` right in the Arch Linux case right?



---

archive/issue_comments_457872.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nReplying to [@isuruf](#comment%3A24):\n> If I'm reading the code correctly `openblas.pc` is not copied to `blas.pc` right in the Arch Linux case right?\n\nit is copied (i.e. blas.pc becomes a link to openblas.pc), but on Arch it makes no difference, as they are also like this on the system\n\n```\n[dimpase@arch]$ file /usr/lib/pkgconfig/blas.pc \n/usr/lib/pkgconfig/blas.pc: symbolic link to openblas.pc\n```",
    "created_at": "2020-01-24T23:11:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457872",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">Comment 25</div>

Replying to [@isuruf](#comment%3A24):
> If I'm reading the code correctly `openblas.pc` is not copied to `blas.pc` right in the Arch Linux case right?

it is copied (i.e. blas.pc becomes a link to openblas.pc), but on Arch it makes no difference, as they are also like this on the system

```
[dimpase@arch]$ file /usr/lib/pkgconfig/blas.pc 
/usr/lib/pkgconfig/blas.pc: symbolic link to openblas.pc
```



---

archive/issue_events_381274.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-01-24T23:12:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381274"
}
```



---

archive/issue_events_381275.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-01-24T23:12:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381275"
}
```



---

archive/issue_comments_457873.json:
```json
{
    "body": "Reviewer: **Isuru Fernando**",
    "created_at": "2020-01-24T23:12:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457873",
    "user": "https://github.com/isuruf"
}
```

Reviewer: **Isuru Fernando**



---

archive/issue_comments_457874.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nThanks. I misread the code",
    "created_at": "2020-01-24T23:12:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457874",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:26" align="right">Comment 26</div>

Thanks. I misread the code



---

archive/issue_comments_457875.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nwith this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)",
    "created_at": "2020-01-25T13:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457875",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">Comment 27</div>

with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)



---

archive/issue_comments_457876.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nDoes not work on my arch... At commit `2941411`, the build of `fflas-ffpack` failed with\n\n```\n../../../fflas-ffpack/fflas/fflas_fassign.inl: In function 'void FFLAS::fassign(const Field&, size_t, typename Field::ConstElement_ptr, size_t, typename Field::Element_ptr, size_t) [with Field = Givaro::Modular<f\nloat>; size_t = long unsigned int; typename Field::ConstElement_ptr = const float*; typename Field::Element_ptr = float*]':\n../../../fflas-ffpack/fflas/fflas_fassign.inl:75:9: error: 'openblas_set_num_threads' was not declared in this scope; did you mean 'omp_set_num_threads'?\n   75 |         openblas_set_num_threads(__FFLASFFPACK_OPENBLAS_NUM_THREADS);\n      |         ^~~~~~~~~~~~~~~~~~~~~~~~\n      |         omp_set_num_threads\n```",
    "created_at": "2020-01-25T16:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457876",
    "user": "https://github.com/videlec"
}
```

<div id="comment:28" align="right">Comment 28</div>

Does not work on my arch... At commit `2941411`, the build of `fflas-ffpack` failed with

```
../../../fflas-ffpack/fflas/fflas_fassign.inl: In function 'void FFLAS::fassign(const Field&, size_t, typename Field::ConstElement_ptr, size_t, typename Field::Element_ptr, size_t) [with Field = Givaro::Modular<f
loat>; size_t = long unsigned int; typename Field::ConstElement_ptr = const float*; typename Field::Element_ptr = float*]':
../../../fflas-ffpack/fflas/fflas_fassign.inl:75:9: error: 'openblas_set_num_threads' was not declared in this scope; did you mean 'omp_set_num_threads'?
   75 |         openblas_set_num_threads(__FFLASFFPACK_OPENBLAS_NUM_THREADS);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~
      |         omp_set_num_threads
```



---

archive/issue_comments_457877.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\n(trying now with `./configure --without-system-openblas`)",
    "created_at": "2020-01-25T16:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457877",
    "user": "https://github.com/videlec"
}
```

<div id="comment:29" align="right">Comment 29</div>

(trying now with `./configure --without-system-openblas`)



---

archive/issue_comments_457878.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nReplying to [@videlec](#comment%3A29):\n> (trying now with `./configure --without-system-openblas`)\n\nIn the above situation, `make` fails at building openblas with the same as usual\n\n```\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/blas.pc': Permission denied\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/cblas.pc': Permission denied\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/lapack.pc': Permission denied\n```",
    "created_at": "2020-01-25T16:19:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457878",
    "user": "https://github.com/videlec"
}
```

<div id="comment:30" align="right">Comment 30</div>

Replying to [@videlec](#comment%3A29):
> (trying now with `./configure --without-system-openblas`)

In the above situation, `make` fails at building openblas with the same as usual

```
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/blas.pc': Permission denied
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/cblas.pc': Permission denied
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/lapack.pc': Permission denied
```



---

archive/issue_comments_457879.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nThat breaks configure if there is no system-wide fortran:\n\n```\nchecking for Fortran libraries of ... \nchecking for dummy main to link with Fortran libraries... none\nconfigure: error: in `/Users/buildbot-sage/slave/sage_git/build':\nconfigure: error: cannot compile a simple Fortran program\nSee `config.log' for more details\nchecking for Fortran name-mangling scheme... If you would like to try to build Sage anyway (to help porting),\nexport the variable 'SAGE_PORT' to something non-empty.\nmake[1]: *** [build/make/Makefile] Error 1\nmake: *** [base-toolchain] Error 2\nmake: Target `start' not remade because of errors.\n```",
    "created_at": "2020-01-25T17:22:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457879",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:31" align="right">Comment 31</div>

That breaks configure if there is no system-wide fortran:

```
checking for Fortran libraries of ... 
checking for dummy main to link with Fortran libraries... none
configure: error: in `/Users/buildbot-sage/slave/sage_git/build':
configure: error: cannot compile a simple Fortran program
See `config.log' for more details
checking for Fortran name-mangling scheme... If you would like to try to build Sage anyway (to help porting),
export the variable 'SAGE_PORT' to something non-empty.
make[1]: *** [build/make/Makefile] Error 1
make: *** [base-toolchain] Error 2
make: Target `start' not remade because of errors.
```



---

archive/issue_events_381276.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-25T17:22:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381276"
}
```



---

archive/issue_events_381277.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-25T17:22:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381277"
}
```



---

archive/issue_comments_457880.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@vbraun](#comment%3A31):\n> That breaks configure if there is no system-wide fortran:\n\ngood catch - so the gfortran is a dependency here.\n\nBut this also applies to many `spkg-configure.m4` tests that use a C++ compiler\nto run tests.",
    "created_at": "2020-01-25T18:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457880",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@vbraun](#comment%3A31):
> That breaks configure if there is no system-wide fortran:

good catch - so the gfortran is a dependency here.

But this also applies to many `spkg-configure.m4` tests that use a C++ compiler
to run tests.



---

archive/issue_comments_457881.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nby right, C, C++, and Fortran compilers are pre-reqs for many `spkg-configure.m4` tests,\nas testing with one compiler and then build another compiler and use it is dodgy.",
    "created_at": "2020-01-25T18:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457881",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">Comment 33</div>

by right, C, C++, and Fortran compilers are pre-reqs for many `spkg-configure.m4` tests,
as testing with one compiler and then build another compiler and use it is dodgy.



---

archive/issue_comments_457882.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@dimpase](#comment%3A27):\n> with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)\n\nI can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?",
    "created_at": "2020-01-26T09:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457882",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@dimpase](#comment%3A27):
> with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)

I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?



---

archive/issue_comments_457883.json:
```json
{
    "body": "Dependencies: **#29051**",
    "created_at": "2020-01-26T09:51:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457883",
    "user": "https://github.com/dimpase"
}
```

Dependencies: **#29051**



---

archive/issue_comments_457884.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nAttachment: **[vdelecroix-29071-fflas_ffpack-2.4.3.log](https://github.com/sagemath/sage/files/ticket29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)**\n\nReplying to [@antonio-rojas](#comment%3A34):\n> Replying to [@dimpase](#comment%3A27):\n> > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)\n\n> \n> I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?\n\nHere they are\n- [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)\n- [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)",
    "created_at": "2020-01-26T09:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457884",
    "user": "https://github.com/videlec"
}
```

<div id="comment:36" align="right">Comment 36</div>

Attachment: **[vdelecroix-29071-fflas_ffpack-2.4.3.log](https://github.com/sagemath/sage/files/ticket29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)**

Replying to [@antonio-rojas](#comment%3A34):
> Replying to [@dimpase](#comment%3A27):
> > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)

> 
> I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?

Here they are
- [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)
- [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)



---

archive/issue_comments_457885.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nReplying to [@videlec](#comment%3A36):\n> Replying to [@antonio-rojas](#comment%3A34):\n> > Replying to [@dimpase](#comment%3A27):\n> > > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)\n\n> > \n> > I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?\n\n> \n> Here they are\n> - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)\n> - [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)\n\nI think your issue is caused by the same .pc stale symlinks that are making the build fail with sage's openblas. fflas-ffpack's spkg-install has `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"`, which should return `-lcblas` on Arch, but it is returning `-lopenblas` for you. The only reason I can think of is those symlinks. Can you delete them and try again?",
    "created_at": "2020-01-26T10:21:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457885",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:37" align="right">Comment 37</div>

Replying to [@videlec](#comment%3A36):
> Replying to [@antonio-rojas](#comment%3A34):
> > Replying to [@dimpase](#comment%3A27):
> > > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)

> > 
> > I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?

> 
> Here they are
> - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)
> - [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)

I think your issue is caused by the same .pc stale symlinks that are making the build fail with sage's openblas. fflas-ffpack's spkg-install has `LINBOX_BLAS="$(pkg-config --libs cblas)"`, which should return `-lcblas` on Arch, but it is returning `-lopenblas` for you. The only reason I can think of is those symlinks. Can you delete them and try again?



---

archive/issue_comments_457886.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@antonio-rojas](#comment%3A37):\n> Replying to [@videlec](#comment%3A36):\n> > Replying to [@antonio-rojas](#comment%3A34):\n> > > Replying to [@dimpase](#comment%3A27):\n> > > > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)\n\n> > > \n> > > I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?\n\n> > \n> > Here they are\n> > - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)\n> > - [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)\n\n> \n> I think your issue is caused by the same .pc stale symlinks that are making the build fail with sage's openblas. fflas-ffpack's spkg-install has `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"`, which should return `-lcblas` on Arch, but it is returning `-lopenblas` for you. The only reason I can think of is those symlinks. Can you delete them and try again?\n\nIndeed\n\n```\n(sage-sh)$ pkg-config --libs cblas\n-lopenblas \n(sage-sh) vincent@mangouste:sage$ rm local/lib/pkgconfig/cblas.pc \n(sage-sh) vincent@mangouste:sage$ rm local/lib/pkgconfig/blas.pc \n(sage-sh) vincent@mangouste:sage$ pkg-config --libs cblas\n-lcblas \n```\nI just relaunched `make` after that...",
    "created_at": "2020-01-26T10:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457886",
    "user": "https://github.com/videlec"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@antonio-rojas](#comment%3A37):
> Replying to [@videlec](#comment%3A36):
> > Replying to [@antonio-rojas](#comment%3A34):
> > > Replying to [@dimpase](#comment%3A27):
> > > > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)

> > > 
> > > I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?

> > 
> > Here they are
> > - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)
> > - [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)

> 
> I think your issue is caused by the same .pc stale symlinks that are making the build fail with sage's openblas. fflas-ffpack's spkg-install has `LINBOX_BLAS="$(pkg-config --libs cblas)"`, which should return `-lcblas` on Arch, but it is returning `-lopenblas` for you. The only reason I can think of is those symlinks. Can you delete them and try again?

Indeed

```
(sage-sh)$ pkg-config --libs cblas
-lopenblas 
(sage-sh) vincent@mangouste:sage$ rm local/lib/pkgconfig/cblas.pc 
(sage-sh) vincent@mangouste:sage$ rm local/lib/pkgconfig/blas.pc 
(sage-sh) vincent@mangouste:sage$ pkg-config --libs cblas
-lcblas 
```
I just relaunched `make` after that...



---

archive/issue_comments_457887.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f\">508ac7c</a></td><td><code>ensure gfortran is available</code></td></tr></table>\n",
    "created_at": "2020-01-26T10:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457887",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39" align="right">Comment 39</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f">508ac7c</a></td><td><code>ensure gfortran is available</code></td></tr></table>




---

archive/issue_comments_457888.json:
```json
{
    "body": "Changed commit from **[2941411](https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1)** to **[508ac7c](https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f)**",
    "created_at": "2020-01-26T10:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457888",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2941411](https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1)** to **[508ac7c](https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f)**



---

archive/issue_events_381278.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T10:33:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381278"
}
```



---

archive/issue_events_381279.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T10:33:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381279"
}
```



---

archive/issue_comments_457889.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nfixed the issue in [comment:31](#comment%3A31)",
    "created_at": "2020-01-26T10:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457889",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">Comment 40</div>

fixed the issue in [comment:31](#comment%3A31)



---

archive/issue_comments_457890.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nThe fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n\nTo fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\nDima, do you want to include this change here or should I open a new ticket?",
    "created_at": "2020-01-26T10:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457890",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:41" align="right">Comment 41</div>

The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.

To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

Dima, do you want to include this change here or should I open a new ticket?



---

archive/issue_comments_457891.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nReplying to [@antonio-rojas](#comment%3A41):\n> The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> \n> To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n> \n> Dima, do you want to include this change here or should I open a new ticket?\n\nlet's do a new ticket, as this is a rather different issue.",
    "created_at": "2020-01-26T10:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457891",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">Comment 42</div>

Replying to [@antonio-rojas](#comment%3A41):
> The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> 
> To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas
> 
> Dima, do you want to include this change here or should I open a new ticket?

let's do a new ticket, as this is a rather different issue.



---

archive/issue_comments_457892.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nReplying to [@antonio-rojas](#comment%3A41):\n> The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> \n> To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\nOn my machine I got\n\n```\n(sage-sh)$ pkg-config --libs blas cblas\n-lopenblas \n```",
    "created_at": "2020-01-26T11:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457892",
    "user": "https://github.com/videlec"
}
```

<div id="comment:43" align="right">Comment 43</div>

Replying to [@antonio-rojas](#comment%3A41):
> The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> 
> To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

On my machine I got

```
(sage-sh)$ pkg-config --libs blas cblas
-lopenblas 
```



---

archive/issue_comments_457893.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nReplying to [@videlec](#comment%3A43):\n> Replying to [@antonio-rojas](#comment%3A41):\n> > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> > \n> > To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\n> \n> On my machine I got\n> \n> ```\n> (sage-sh)$ pkg-config --libs blas cblas\n> -lopenblas \n> ```\n\nThe above is coherent with the symlinks provided in Sage\n\n```\n(sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n```\nBut not with what I have in `/usr/lib/pkgconfig/`\n\n```\n$ ls -l /usr/lib/pkgconfig/ | grep blas\nlrwxrwxrwx 1 root root   11 20 ao\u00fbt  12:35 blas.pc -> openblas.pc\n-rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc\n-rw-r--r-- 1 root root  497 20 ao\u00fbt  12:35 openblas.pc\n```",
    "created_at": "2020-01-26T11:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457893",
    "user": "https://github.com/videlec"
}
```

<div id="comment:44" align="right">Comment 44</div>

Replying to [@videlec](#comment%3A43):
> Replying to [@antonio-rojas](#comment%3A41):
> > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> > 
> > To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

> 
> On my machine I got
> 
> ```
> (sage-sh)$ pkg-config --libs blas cblas
> -lopenblas 
> ```

The above is coherent with the symlinks provided in Sage

```
(sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas
lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
```
But not with what I have in `/usr/lib/pkgconfig/`

```
$ ls -l /usr/lib/pkgconfig/ | grep blas
lrwxrwxrwx 1 root root   11 20 aot  12:35 blas.pc -> openblas.pc
-rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc
-rw-r--r-- 1 root root  497 20 aot  12:35 openblas.pc
```



---

archive/issue_comments_457894.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nReplying to [@videlec](#comment%3A44):\n> Replying to [@videlec](#comment%3A43):\n> > Replying to [@antonio-rojas](#comment%3A41):\n> > > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> > > \n> > > To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\n> > \n> > On my machine I got\n> > \n> > ```\n> > (sage-sh)$ pkg-config --libs blas cblas\n> > -lopenblas \n> > ```\n\n> \n> The above is coherent with the symlinks provided in Sage\n> \n> ```\n> (sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n> ```\n> But not with what I have in `/usr/lib/pkgconfig/`\n> \n> ```\n> $ ls -l /usr/lib/pkgconfig/ | grep blas\n> lrwxrwxrwx 1 root root   11 20 ao\u00fbt  12:35 blas.pc -> openblas.pc\n> -rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc\n> -rw-r--r-- 1 root root  497 20 ao\u00fbt  12:35 openblas.pc\n> ```\n\nThose links are no longer created on Arch, that's the point of this ticket",
    "created_at": "2020-01-26T11:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457894",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:45" align="right">Comment 45</div>

Replying to [@videlec](#comment%3A44):
> Replying to [@videlec](#comment%3A43):
> > Replying to [@antonio-rojas](#comment%3A41):
> > > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> > > 
> > > To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

> > 
> > On my machine I got
> > 
> > ```
> > (sage-sh)$ pkg-config --libs blas cblas
> > -lopenblas 
> > ```

> 
> The above is coherent with the symlinks provided in Sage
> 
> ```
> (sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
> ```
> But not with what I have in `/usr/lib/pkgconfig/`
> 
> ```
> $ ls -l /usr/lib/pkgconfig/ | grep blas
> lrwxrwxrwx 1 root root   11 20 aot  12:35 blas.pc -> openblas.pc
> -rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc
> -rw-r--r-- 1 root root  497 20 aot  12:35 openblas.pc
> ```

Those links are no longer created on Arch, that's the point of this ticket



---

archive/issue_comments_457895.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nReplying to [@videlec](#comment%3A44):\n> Replying to [@videlec](#comment%3A43):\n> > Replying to [@antonio-rojas](#comment%3A41):\n> > > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> > > \n> > > To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\n> > \n> > On my machine I got\n> > \n> > ```\n> > (sage-sh)$ pkg-config --libs blas cblas\n> > -lopenblas \n> > ```\n\n> \n> The above is coherent with the symlinks provided in Sage\n> \n> ```\n> (sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n> ```\n> But not with what I have in `/usr/lib/pkgconfig/`\n> \n> ```\n> $ ls -l /usr/lib/pkgconfig/ | grep blas\n> lrwxrwxrwx 1 root root   11 20 ao\u00fbt  12:35 blas.pc -> openblas.pc\n> -rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc\n> -rw-r--r-- 1 root root  497 20 ao\u00fbt  12:35 openblas.pc\n> ```\n\nRemoving the symlinks and setting them according to what is in `/usr/lib` seems to fix the issue\n\n```\n$ rm /opt/sage/local/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/cblas.pc\n$ ln -s /usr/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/\n$ ln -s /usr/lib/pkgconfig/cblas.pc /opt/sage/local/lib/pkgconfig/\n```",
    "created_at": "2020-01-26T12:00:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457895",
    "user": "https://github.com/videlec"
}
```

<div id="comment:46" align="right">Comment 46</div>

Replying to [@videlec](#comment%3A44):
> Replying to [@videlec](#comment%3A43):
> > Replying to [@antonio-rojas](#comment%3A41):
> > > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> > > 
> > > To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

> > 
> > On my machine I got
> > 
> > ```
> > (sage-sh)$ pkg-config --libs blas cblas
> > -lopenblas 
> > ```

> 
> The above is coherent with the symlinks provided in Sage
> 
> ```
> (sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
> ```
> But not with what I have in `/usr/lib/pkgconfig/`
> 
> ```
> $ ls -l /usr/lib/pkgconfig/ | grep blas
> lrwxrwxrwx 1 root root   11 20 aot  12:35 blas.pc -> openblas.pc
> -rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc
> -rw-r--r-- 1 root root  497 20 aot  12:35 openblas.pc
> ```

Removing the symlinks and setting them according to what is in `/usr/lib` seems to fix the issue

```
$ rm /opt/sage/local/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/cblas.pc
$ ln -s /usr/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/
$ ln -s /usr/lib/pkgconfig/cblas.pc /opt/sage/local/lib/pkgconfig/
```



---

archive/issue_comments_457896.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nAfter a `make distclean` and standing at commit `508ac7c` I see the same problem\n\n```\n$ ls -l /opt/sage/local/lib/pkgconfig/ | grep blas\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 blas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n```",
    "created_at": "2020-01-26T12:05:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457896",
    "user": "https://github.com/videlec"
}
```

<div id="comment:47" align="right">Comment 47</div>

After a `make distclean` and standing at commit `508ac7c` I see the same problem

```
$ ls -l /opt/sage/local/lib/pkgconfig/ | grep blas
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 blas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
```



---

archive/issue_comments_457897.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nhave you run `./bootstrap && ./configure` ?\nIf yes, please post config.log (as attachement)",
    "created_at": "2020-01-26T12:11:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457897",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:48" align="right">Comment 48</div>

have you run `./bootstrap && ./configure` ?
If yes, please post config.log (as attachement)



---

archive/issue_comments_457898.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nWait, why do you do these:\n\n```\n$ ln -s /usr/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/\n$ ln -s /usr/lib/pkgconfig/cblas.pc /opt/sage/local/lib/pkgconfig/\n```\n\n?\n\nThis could only break stuff, if you do it after `make distclean`.",
    "created_at": "2020-01-26T12:14:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457898",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:49" align="right">Comment 49</div>

Wait, why do you do these:

```
$ ln -s /usr/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/
$ ln -s /usr/lib/pkgconfig/cblas.pc /opt/sage/local/lib/pkgconfig/
```

?

This could only break stuff, if you do it after `make distclean`.



---

archive/issue_comments_457899.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nAfter `make distclean`, `./bootstrap`, `./configure` the build still fails at `fflas-ffpack` with the same\n\n```\nerror: 'openblas_set_num_threads' was not declared in this scope; did you mean 'omp_set_num_threads'?\n```\nAlso the blas symlinks are still pointing to openblas\n\n```\n$ ls -l local/lib/pkgconfig/ | grep blas\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 blas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n```",
    "created_at": "2020-01-26T12:18:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457899",
    "user": "https://github.com/videlec"
}
```

<div id="comment:50" align="right">Comment 50</div>

After `make distclean`, `./bootstrap`, `./configure` the build still fails at `fflas-ffpack` with the same

```
error: 'openblas_set_num_threads' was not declared in this scope; did you mean 'omp_set_num_threads'?
```
Also the blas symlinks are still pointing to openblas

```
$ ls -l local/lib/pkgconfig/ | grep blas
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 blas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
```



---

archive/issue_comments_457900.json:
```json
{
    "body": "Attachment: **[vdelecroix-29071-config.log](https://github.com/sagemath/sage/files/ticket29071/vdelecroix-29071-config.log)**",
    "created_at": "2020-01-26T12:19:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457900",
    "user": "https://github.com/videlec"
}
```

Attachment: **[vdelecroix-29071-config.log](https://github.com/sagemath/sage/files/ticket29071/vdelecroix-29071-config.log)**



---

archive/issue_comments_457901.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nPlease also make sure there is nothing in `src/lib/pkgconfig` before running `./configure`. After running ./configure on Arch it should look like\n\n```\n$ ls src/lib/pkgconfig/\nblas.pc  gsl.pc\n```\n\nYou could have these stale stuff from older versions of this ticket or even before.",
    "created_at": "2020-01-26T12:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457901",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">Comment 51</div>

Please also make sure there is nothing in `src/lib/pkgconfig` before running `./configure`. After running ./configure on Arch it should look like

```
$ ls src/lib/pkgconfig/
blas.pc  gsl.pc
```

You could have these stale stuff from older versions of this ticket or even before.



---

archive/issue_comments_457902.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nHere is [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)",
    "created_at": "2020-01-26T12:20:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457902",
    "user": "https://github.com/videlec"
}
```

<div id="comment:52" align="right">Comment 52</div>

Here is [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)



---

archive/issue_comments_457903.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nIndeed\n\n```\n$ ls -l src/lib/pkgconfig/\ntotal 4\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 blas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 11:51 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\n-rw-r--r-- 1 vincent vincent 200 26 janv. 14:12 gsl.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 11:51 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n```",
    "created_at": "2020-01-26T12:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457903",
    "user": "https://github.com/videlec"
}
```

<div id="comment:53" align="right">Comment 53</div>

Indeed

```
$ ls -l src/lib/pkgconfig/
total 4
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 blas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:51 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
-rw-r--r-- 1 vincent vincent 200 26 janv. 14:12 gsl.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:51 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
```



---

archive/issue_comments_457904.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nWhy isn't `src/lib/pkgconfig` properly cleaned?",
    "created_at": "2020-01-26T12:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457904",
    "user": "https://github.com/videlec"
}
```

<div id="comment:54" align="right">Comment 54</div>

Why isn't `src/lib/pkgconfig` properly cleaned?



---

archive/issue_comments_457905.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nI agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?",
    "created_at": "2020-01-26T12:23:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457905",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:55" align="right">Comment 55</div>

I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?



---

archive/issue_comments_457906.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\nReplying to [@dimpase](#comment%3A55):\n> I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?\n\nThat `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.",
    "created_at": "2020-01-26T12:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457906",
    "user": "https://github.com/videlec"
}
```

<div id="comment:56" align="right">Comment 56</div>

Replying to [@dimpase](#comment%3A55):
> I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?

That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.



---

archive/issue_comments_457907.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nAfter removing `src/lib/pkgconfig` the build `fflas-ffpack` succeeded! Thank you.",
    "created_at": "2020-01-26T12:38:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457907",
    "user": "https://github.com/videlec"
}
```

<div id="comment:57" align="right">Comment 57</div>

After removing `src/lib/pkgconfig` the build `fflas-ffpack` succeeded! Thank you.



---

archive/issue_comments_457908.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nReplying to [@videlec](#comment%3A56):\n> Replying to [@dimpase](#comment%3A55):\n> > I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?\n\n> \n> That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.\n\nI've opened a blocker #29082 to deal with cleaning of these files, sorry for this mess.",
    "created_at": "2020-01-26T12:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457908",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:58" align="right">Comment 58</div>

Replying to [@videlec](#comment%3A56):
> Replying to [@dimpase](#comment%3A55):
> > I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?

> 
> That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.

I've opened a blocker #29082 to deal with cleaning of these files, sorry for this mess.



---

archive/issue_comments_457909.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nReplying to [@dimpase](#comment%3A58):\n> Replying to [@videlec](#comment%3A56):\n> > Replying to [@dimpase](#comment%3A55):\n> > > I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?\n\n> > \n> > That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.\n\n> \n> I've opened a blocker #29082 to deal with cleaning of these files, sorry for this mess.\n\nYou did more good than bad :-) It is quite nice to have Sage using the libraries from the system!",
    "created_at": "2020-01-26T12:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457909",
    "user": "https://github.com/videlec"
}
```

<div id="comment:59" align="right">Comment 59</div>

Replying to [@dimpase](#comment%3A58):
> Replying to [@videlec](#comment%3A56):
> > Replying to [@dimpase](#comment%3A55):
> > > I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?

> > 
> > That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.

> 
> I've opened a blocker #29082 to deal with cleaning of these files, sorry for this mess.

You did more good than bad :-) It is quite nice to have Sage using the libraries from the system!



---

archive/issue_comments_457910.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nPlease also don't forget that you'll need (an equivalent of) #29051 to make the build succeed (without it scipy will fail).",
    "created_at": "2020-01-26T12:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457910",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:60" align="right">Comment 60</div>

Please also don't forget that you'll need (an equivalent of) #29051 to make the build succeed (without it scipy will fail).



---

archive/issue_comments_457911.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)** to **[u/mkoeppe/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/openblaspcfix)**",
    "created_at": "2020-01-28T00:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457911",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)** to **[u/mkoeppe/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/openblaspcfix)**



---

archive/issue_comments_457912.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nI have merged in #29051 and current beta.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97\">9d1770a</a></td><td><code>revert #29025, remove useless [ALL] section</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d\">dba7aef</a></td><td><code>revert from \"libraries=\" back to section-specific \"BLAH_libs=\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe4a67e3b77e0249ea51cfd1231e3327489c185b\">fe4a67e</a></td><td><code>Merge branch 'public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' of git://trac.sagemath.org/sage into t/29071/packages/openblaspcfix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54\">2be2905</a></td><td><code>Merge tag '9.1.beta2' into t/29071/packages/openblaspcfix</code></td></tr></table>\n",
    "created_at": "2020-01-28T00:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457912",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:62" align="right">Comment 62</div>

I have merged in #29051 and current beta.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97">9d1770a</a></td><td><code>revert #29025, remove useless [ALL] section</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d">dba7aef</a></td><td><code>revert from "libraries=" back to section-specific "BLAH_libs="</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe4a67e3b77e0249ea51cfd1231e3327489c185b">fe4a67e</a></td><td><code>Merge branch 'public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' of git://trac.sagemath.org/sage into t/29071/packages/openblaspcfix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54">2be2905</a></td><td><code>Merge tag '9.1.beta2' into t/29071/packages/openblaspcfix</code></td></tr></table>




---

archive/issue_comments_457913.json:
```json
{
    "body": "Changed commit from **[508ac7c](https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f)** to **[2be2905](https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54)**",
    "created_at": "2020-01-28T00:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457913",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[508ac7c](https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f)** to **[2be2905](https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54)**



---

archive/issue_comments_457914.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nI don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n\nAfter all, sage-the-distribution has a mechanism to install `gfortran` itself. We shouldn't break that.\n\nAs you can see at https://github.com/mkoeppe/sage/runs/411989461, with this ticket all \"minimal\" installs fail with `configure: error: in `/sage':\nconfigure: error: cannot compile a simple Fortran program`.",
    "created_at": "2020-01-28T01:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457914",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:63" align="right">Comment 63</div>

I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 

After all, sage-the-distribution has a mechanism to install `gfortran` itself. We shouldn't break that.

As you can see at https://github.com/mkoeppe/sage/runs/411989461, with this ticket all "minimal" installs fail with `configure: error: in `/sage':
configure: error: cannot compile a simple Fortran program`.



---

archive/issue_comments_457915.json:
```json
{
    "body": "Changed reviewer from **Isuru Fernando** to **Isuru Fernando, Matthias Koeppe**",
    "created_at": "2020-01-28T01:29:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457915",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Isuru Fernando** to **Isuru Fernando, Matthias Koeppe**



---

archive/issue_comments_457916.json:
```json
{
    "body": "Changed commit from **[2be2905](https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54)** to **[d2b5e13](https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe)**",
    "created_at": "2020-01-28T05:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457916",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2be2905](https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54)** to **[d2b5e13](https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe)**



---

archive/issue_comments_457917.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe\">d2b5e13</a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>\n",
    "created_at": "2020-01-28T05:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457917",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65" align="right">Comment 65</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe">d2b5e13</a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>




---

archive/issue_comments_457918.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nReplying to [@mkoeppe](#comment%3A63):\n> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n\nFixed in d2b5e13.",
    "created_at": "2020-01-28T05:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457918",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">Comment 66</div>

Replying to [@mkoeppe](#comment%3A63):
> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 

Fixed in d2b5e13.



---

archive/issue_comments_457919.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nTests see https://github.com/mkoeppe/sage/runs/412256169",
    "created_at": "2020-01-28T06:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457919",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">Comment 67</div>

Tests see https://github.com/mkoeppe/sage/runs/412256169



---

archive/issue_comments_457920.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nReplying to [@mkoeppe](#comment%3A63):\n> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n> \n> After all, sage-the-distribution has a mechanism to install `gfortran` itself. We shouldn't break that.\n> \n> As you can see at https://github.com/mkoeppe/sage/runs/411989461, with this ticket all \"minimal\" installs fail with `configure: error: in `/sage':\n> configure: error: cannot compile a simple Fortran program`.\n> \n\noops, I see, I only tested with `./configure --without-system-gfortran` - which worked just fine :-)",
    "created_at": "2020-01-28T08:37:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457920",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:68" align="right">Comment 68</div>

Replying to [@mkoeppe](#comment%3A63):
> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 
> 
> After all, sage-the-distribution has a mechanism to install `gfortran` itself. We shouldn't break that.
> 
> As you can see at https://github.com/mkoeppe/sage/runs/411989461, with this ticket all "minimal" installs fail with `configure: error: in `/sage':
> configure: error: cannot compile a simple Fortran program`.
> 

oops, I see, I only tested with `./configure --without-system-gfortran` - which worked just fine :-)



---

archive/issue_comments_457921.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\n\n```\n+       if test \"$SAGE_HAVE_FC_FREEFORM\" = yes ; then dnl Have a suitable Fortran compiler\n```\n\ncould we please stick to `AS_IF` ?",
    "created_at": "2020-01-28T08:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457921",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:69" align="right">Comment 69</div>


```
+       if test "$SAGE_HAVE_FC_FREEFORM" = yes ; then dnl Have a suitable Fortran compiler
```

could we please stick to `AS_IF` ?



---

archive/issue_comments_457922.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">Comment 70</div>\n\nReplying to [@sagetrac-git](#comment%3A65):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe\">d2b5e13</a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>\n\nthis has broken recognition of gfortran on Debian 10.\n\nprobably cause arguments were shuffled around...",
    "created_at": "2020-01-28T11:18:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457922",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:70" align="right">Comment 70</div>

Replying to [@sagetrac-git](#comment%3A65):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe">d2b5e13</a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>

this has broken recognition of gfortran on Debian 10.

probably cause arguments were shuffled around...



---

archive/issue_events_381280.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T11:18:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381280"
}
```



---

archive/issue_events_381281.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T11:18:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381281"
}
```



---

archive/issue_comments_457923.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nI also don't get\n\n```\n+      # We already checked (in the initial portion of configure.ac)\n+      # whether the Fortran compiler accepts free-format source code (as\n```\nIMHO there is nothing either in configure.ac or build/pkgs/gcc/spkg-configure.m4 that\ndoes any Fortran checks.",
    "created_at": "2020-01-28T11:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457923",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:72" align="right">Comment 72</div>

I also don't get

```
+      # We already checked (in the initial portion of configure.ac)
+      # whether the Fortran compiler accepts free-format source code (as
```
IMHO there is nothing either in configure.ac or build/pkgs/gcc/spkg-configure.m4 that
does any Fortran checks.



---

archive/issue_comments_457924.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nReplying to [@dimpase](#comment%3A69):\n> \n> ```\n> +       if test \"$SAGE_HAVE_FC_FREEFORM\" = yes ; then dnl Have a suitable Fortran compiler\n> ```\n> \n> could we please stick to `AS_IF` ?\n\nactually, I don't see the  point of this `if` at all. If we get there then it's already true, as it's inside the check for `gfortran` as a pre-req, in the scope of `SAGE_SPKG_DEPCHECK([gfortran], ...)`.\n`",
    "created_at": "2020-01-28T11:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457924",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:73" align="right">Comment 73</div>

Replying to [@dimpase](#comment%3A69):
> 
> ```
> +       if test "$SAGE_HAVE_FC_FREEFORM" = yes ; then dnl Have a suitable Fortran compiler
> ```
> 
> could we please stick to `AS_IF` ?

actually, I don't see the  point of this `if` at all. If we get there then it's already true, as it's inside the check for `gfortran` as a pre-req, in the scope of `SAGE_SPKG_DEPCHECK([gfortran], ...)`.
`



---

archive/issue_comments_457925.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">Comment 74</div>\n\nThe trouble is in `AC_FC_FUNC()`, which throws a fit if there is no Fortran compiler around, instead of just suffering in silence.",
    "created_at": "2020-01-28T12:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457925",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:74" align="right">Comment 74</div>

The trouble is in `AC_FC_FUNC()`, which throws a fit if there is no Fortran compiler around, instead of just suffering in silence.



---

archive/issue_comments_457926.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">Comment 75</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cf2a3bb8feb5524daf4be93f0434c3b383a1c1d\">8cf2a3b</a></td><td><code>configure.ac: Check some FC properties earlier</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7\">c98c6b2</a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>\n",
    "created_at": "2020-01-28T12:29:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457926",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:75" align="right">Comment 75</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cf2a3bb8feb5524daf4be93f0434c3b383a1c1d">8cf2a3b</a></td><td><code>configure.ac: Check some FC properties earlier</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7">c98c6b2</a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>




---

archive/issue_comments_457927.json:
```json
{
    "body": "Changed commit from **[d2b5e13](https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe)** to **[c98c6b2](https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7)**",
    "created_at": "2020-01-28T12:29:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457927",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d2b5e13](https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe)** to **[c98c6b2](https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7)**



---

archive/issue_comments_457928.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nReplying to [@dimpase](#comment%3A72):\n> I also don't get\n> \n> ```\n> +      # We already checked (in the initial portion of configure.ac)\n> +      # whether the Fortran compiler accepts free-format source code (as\n> ```\n> IMHO there is nothing either in configure.ac or build/pkgs/gcc/spkg-configure.m4 that\n> does any Fortran checks.\n\nSorry, I forgot to include one commit on this branch.\nFixed.",
    "created_at": "2020-01-28T12:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457928",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">Comment 76</div>

Replying to [@dimpase](#comment%3A72):
> I also don't get
> 
> ```
> +      # We already checked (in the initial portion of configure.ac)
> +      # whether the Fortran compiler accepts free-format source code (as
> ```
> IMHO there is nothing either in configure.ac or build/pkgs/gcc/spkg-configure.m4 that
> does any Fortran checks.

Sorry, I forgot to include one commit on this branch.
Fixed.



---

archive/issue_comments_457929.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">Comment 77</div>\n\nReplying to [@dimpase](#comment%3A74):\n> The trouble is in `AC_FC_FUNC()`, which throws a fit if there is no Fortran compiler around, instead of just suffering in silence. \n\nYes, exactly, and more specifically: Because of AC_REQUIRE and AC_DEFUN_ONCE one cannot easily make all things conditional that one would liike.",
    "created_at": "2020-01-28T12:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457929",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">Comment 77</div>

Replying to [@dimpase](#comment%3A74):
> The trouble is in `AC_FC_FUNC()`, which throws a fit if there is no Fortran compiler around, instead of just suffering in silence. 

Yes, exactly, and more specifically: Because of AC_REQUIRE and AC_DEFUN_ONCE one cannot easily make all things conditional that one would liike.



---

archive/issue_comments_457930.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">Comment 78</div>\n\nReplying to [@dimpase](#comment%3A73):\n> Replying to [@dimpase](#comment%3A69):\n> > \n> > ```\n> > +       if test \"$SAGE_HAVE_FC_FREEFORM\" = yes ; then dnl Have a suitable Fortran compiler\n> > ```\n> > \n> > could we please stick to `AS_IF` ?\n\nNo, they are unfortunately not equivalent because of autoconf's AC_PREREQ/AC_DEFUN_ONCE magic.",
    "created_at": "2020-01-28T12:34:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457930",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:78" align="right">Comment 78</div>

Replying to [@dimpase](#comment%3A73):
> Replying to [@dimpase](#comment%3A69):
> > 
> > ```
> > +       if test "$SAGE_HAVE_FC_FREEFORM" = yes ; then dnl Have a suitable Fortran compiler
> > ```
> > 
> > could we please stick to `AS_IF` ?

No, they are unfortunately not equivalent because of autoconf's AC_PREREQ/AC_DEFUN_ONCE magic.



---

archive/issue_comments_457931.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">Comment 79</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39a317ddf2dae9400ddf339e5988cab71b57bdbc\">39a317d</a></td><td><code>install cblas.pc and lapack.pc links conditionally</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7adc71201980fdd5e828f2c69a1e03881d87fcfd\">7adc712</a></td><td><code>use AC_SEARCH_LIBS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abda83ec30302dde4368029ae0cc9de581da36ea\">abda83e</a></td><td><code>added missing module names - cblas and lapack</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/683a926bb67d90832711ba64be1446dbe0463ea0\">683a926</a></td><td><code>make installing *.pc files conditional</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0acbcb1a199e5b9795dd126756288869e86e09a\">a0acbcb</a></td><td><code>correct quoting of m4 index variable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ee6844ebc67fa43f4a1d6a502e90ed8751b0889\">5ee6844</a></td><td><code>ensure gfortran is available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2\">56541ae</a></td><td><code>wrap AC_FC_FUNC so that it does not throw an error without Fortran</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd\">3a4524e</a></td><td><code>Merge remote-tracking branch 'trac/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' into openblaspcfix</code></td></tr></table>\n",
    "created_at": "2020-01-28T12:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457931",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:79" align="right">Comment 79</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39a317ddf2dae9400ddf339e5988cab71b57bdbc">39a317d</a></td><td><code>install cblas.pc and lapack.pc links conditionally</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7adc71201980fdd5e828f2c69a1e03881d87fcfd">7adc712</a></td><td><code>use AC_SEARCH_LIBS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abda83ec30302dde4368029ae0cc9de581da36ea">abda83e</a></td><td><code>added missing module names - cblas and lapack</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/683a926bb67d90832711ba64be1446dbe0463ea0">683a926</a></td><td><code>make installing *.pc files conditional</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0acbcb1a199e5b9795dd126756288869e86e09a">a0acbcb</a></td><td><code>correct quoting of m4 index variable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ee6844ebc67fa43f4a1d6a502e90ed8751b0889">5ee6844</a></td><td><code>ensure gfortran is available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2">56541ae</a></td><td><code>wrap AC_FC_FUNC so that it does not throw an error without Fortran</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd">3a4524e</a></td><td><code>Merge remote-tracking branch 'trac/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' into openblaspcfix</code></td></tr></table>




---

archive/issue_comments_457932.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/openblaspcfix)** to **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)**",
    "created_at": "2020-01-28T12:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457932",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/mkoeppe/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/openblaspcfix)** to **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)**



---

archive/issue_comments_457933.json:
```json
{
    "body": "Changed commit from **[c98c6b2](https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7)** to **[3a4524e](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**",
    "created_at": "2020-01-28T12:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457933",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[c98c6b2](https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7)** to **[3a4524e](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**



---

archive/issue_events_381282.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T12:37:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381282"
}
```



---

archive/issue_events_381283.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T12:37:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381283"
}
```



---

archive/issue_comments_457934.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">Comment 80</div>\n\nReplying to [@mkoeppe](#comment%3A63):\n> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n\nFixed by `wrap AC_FC_FUNC so that it does not throw an error without Fortran`: [56541ae](https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2)",
    "created_at": "2020-01-28T12:40:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457934",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:80" align="right">Comment 80</div>

Replying to [@mkoeppe](#comment%3A63):
> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 

Fixed by `wrap AC_FC_FUNC so that it does not throw an error without Fortran`: [56541ae](https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2)



---

archive/issue_comments_457935.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">Comment 81</div>\n\nIMHO it's an autoconf bug/feature that `AC_FC_FUNC` errors out without Fortran, while e.g. `AC_FC_FREEFORM` does not.",
    "created_at": "2020-01-28T12:44:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457935",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:81" align="right">Comment 81</div>

IMHO it's an autoconf bug/feature that `AC_FC_FUNC` errors out without Fortran, while e.g. `AC_FC_FREEFORM` does not.



---

archive/issue_comments_457936.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">Comment 82</div>\n\nReplying to [@dimpase](#comment%3A81):\n> IMHO it's an autoconf bug/feature that `AC_FC_FUNC` errors out without Fortran, while e.g. `AC_FC_FREEFORM` does not.\n\nYes, I agree.",
    "created_at": "2020-01-28T13:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457936",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">Comment 82</div>

Replying to [@dimpase](#comment%3A81):
> IMHO it's an autoconf bug/feature that `AC_FC_FUNC` errors out without Fortran, while e.g. `AC_FC_FREEFORM` does not.

Yes, I agree.



---

archive/issue_comments_457937.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">Comment 83</div>\n\nReplying to [@dimpase](#comment%3A80):\n> Replying to [@mkoeppe](#comment%3A63):\n> > I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n\n> \n> Fixed by `wrap AC_FC_FUNC so that it does not throw an error without Fortran`: [56541ae](https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2)\n\nGreat, a much easier fix than what I put together in \u200b8cf2a3b/\u200bc98c6b2.  \nTesting at https://github.com/mkoeppe/sage/actions/runs/32186055",
    "created_at": "2020-01-28T13:26:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457937",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:83" align="right">Comment 83</div>

Replying to [@dimpase](#comment%3A80):
> Replying to [@mkoeppe](#comment%3A63):
> > I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 

> 
> Fixed by `wrap AC_FC_FUNC so that it does not throw an error without Fortran`: [56541ae](https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2)

Great, a much easier fix than what I put together in 8cf2a3b/c98c6b2.  
Testing at https://github.com/mkoeppe/sage/actions/runs/32186055



---

archive/issue_comments_457938.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">Comment 84</div>\n\nTests finished at https://github.com/mkoeppe/sage/actions/runs/32186055",
    "created_at": "2020-01-28T16:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457938",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:84" align="right">Comment 84</div>

Tests finished at https://github.com/mkoeppe/sage/actions/runs/32186055



---

archive/issue_comments_457939.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">Comment 85</div>\n\nLooking good, and certainly fixes what was original reported on this ticket (fflas_ffpack on archlinux). The build error of fflas_ffpack on `debian-jessie-standard` (https://github.com/mkoeppe/sage/runs/412891766) is unrelated. It is good on all other configurations.",
    "created_at": "2020-01-28T16:22:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457939",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">Comment 85</div>

Looking good, and certainly fixes what was original reported on this ticket (fflas_ffpack on archlinux). The build error of fflas_ffpack on `debian-jessie-standard` (https://github.com/mkoeppe/sage/runs/412891766) is unrelated. It is good on all other configurations.



---

archive/issue_events_381284.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T16:22:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381284"
}
```



---

archive/issue_events_381285.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T16:22:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381285"
}
```



---

archive/issue_comments_457940.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)** to **[3a4524e](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**",
    "created_at": "2020-01-31T23:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-457940",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)** to **[3a4524e](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**



---

archive/issue_events_381286.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381286"
}
```



---

archive/issue_events_381287.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2c207ead2b50c79e9acdb2d0f4bb282927c5c20a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-31T23:49:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-381287"
}
```
