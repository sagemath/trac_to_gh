# Issue 29071: verify if cblas.pc and lapack.pc should be replaced by links to openblas.pc

archive/issues_028834.json:
```json
{
    "assignees": [],
    "body": "currently openblas's spkg-configure.pc unconditionally makes cblas.pc and lapack.pc copies of openblas.pc, which in some cases if incorrect, e.g. Arch Linux has libcblas linked to libopenblas\nand containing stuff missing in libopenblas, resulting in errors.\n\nthis has been reported on sage-devel\nhttps://groups.google.com/d/msg/sage-devel/pIOnFyFJMtM/_FbzM2OxCQAJ\n\nSo we should make these installations conditional.\n\nDepends on #29051\n\nCC:  @isuruf @mkoeppe @antonio-rojas\n\nBranch/Commit: **[`3a4524e`](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**\n\nReviewer: **Isuru Fernando, Matthias Koeppe**\n\nAuthor: **Dima Pasechnik**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29071_\n\n",
    "closed_at": "2020-01-31T23:49:32Z",
    "created_at": "2020-01-23T17:18:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "verify if cblas.pc and lapack.pc should be replaced by links to openblas.pc",
    "type": "issue",
    "updated_at": "2020-01-31T23:49:32Z",
    "url": "https://github.com/sagemath/sage/issues/29071",
    "user": "https://github.com/dimpase"
}
```
currently openblas's spkg-configure.pc unconditionally makes cblas.pc and lapack.pc copies of openblas.pc, which in some cases if incorrect, e.g. Arch Linux has libcblas linked to libopenblas
and containing stuff missing in libopenblas, resulting in errors.

this has been reported on sage-devel
https://groups.google.com/d/msg/sage-devel/pIOnFyFJMtM/_FbzM2OxCQAJ

So we should make these installations conditional.

Depends on #29051

CC:  @isuruf @mkoeppe @antonio-rojas

Branch/Commit: **[`3a4524e`](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**

Reviewer: **Isuru Fernando, Matthias Koeppe**

Author: **Dima Pasechnik**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/29071_





---

archive/issue_events_401510.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-23T17:18:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401510"
}
```



---

archive/issue_events_401511.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-23T17:18:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401511"
}
```



---

archive/issue_events_401512.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-23T17:18:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401512"
}
```



---

archive/issue_events_401513.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-23T17:18:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401513"
}
```



---

archive/issue_comments_454809.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\n> It depends on the fortran name mangling. For gfortran, one symbol would be dgeqrf_.\n\nwe can do an `AC_LINK_IFELSE()` test with a subroutine `dgeqef` call,\nand try to link it against libopenblas. this would be independent of Fortran compiler.\n\nhttp://www.netlib.org/lapack/explore-html/df/dc5/group__variants_g_ecomputational_ga3766ea903391b5cf9008132f7440ec7b.html",
    "created_at": "2020-01-23T19:25:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454809",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

> It depends on the fortran name mangling. For gfortran, one symbol would be dgeqrf_.

we can do an `AC_LINK_IFELSE()` test with a subroutine `dgeqef` call,
and try to link it against libopenblas. this would be independent of Fortran compiler.

http://www.netlib.org/lapack/explore-html/df/dc5/group__variants_g_ecomputational_ga3766ea903391b5cf9008132f7440ec7b.html



---

archive/issue_comments_454810.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAnd for cblas we can do `AC_CHECK_LIB()` on `cblas_dgemm`, as Antonio proposed.",
    "created_at": "2020-01-23T19:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454810",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

And for cblas we can do `AC_CHECK_LIB()` on `cblas_dgemm`, as Antonio proposed.



---

archive/issue_comments_454811.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nYou can also use `AC_FC_FUNC` to get the mangled name.",
    "created_at": "2020-01-23T19:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454811",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:3" align="right">comment:3</div>

You can also use `AC_FC_FUNC` to get the mangled name.



---

archive/issue_comments_454812.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@isuruf](#comment:3):\n> You can also use `AC_FC_FUNC` to get the mangled name.\n\nOK, that's better, thanks.",
    "created_at": "2020-01-23T19:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454812",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@isuruf](#comment:3):
> You can also use `AC_FC_FUNC` to get the mangled name.

OK, that's better, thanks.



---

archive/issue_comments_454813.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2020-01-24T11:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454813",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_events_401514.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-24T11:17:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401514"
}
```



---

archive/issue_comments_454814.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)**",
    "created_at": "2020-01-24T11:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454814",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)**



---

archive/issue_comments_454815.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nneeds testing on Arch in particular.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04\"><code>ccc5d82</code></a></td><td><code>install cblas.pc and lapack.pc links conditionally</code></td></tr></table>\n",
    "created_at": "2020-01-24T11:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454815",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

needs testing on Arch in particular.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04"><code>ccc5d82</code></a></td><td><code>install cblas.pc and lapack.pc links conditionally</code></td></tr></table>




---

archive/issue_comments_454816.json:
```json
{
    "body": "Commit: **[`ccc5d82`](https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04)**",
    "created_at": "2020-01-24T11:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454816",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`ccc5d82`](https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04)**



---

archive/issue_comments_454817.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\ntrying now on arch",
    "created_at": "2020-01-24T12:14:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454817",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

trying now on arch



---

archive/issue_comments_454818.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160\"><code>f6714fb</code></a></td><td><code>use AC_SEARCH_LIBS</code></td></tr></table>\n",
    "created_at": "2020-01-24T12:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454818",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160"><code>f6714fb</code></a></td><td><code>use AC_SEARCH_LIBS</code></td></tr></table>




---

archive/issue_comments_454819.json:
```json
{
    "body": "Changed commit from **[`ccc5d82`](https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04)** to **[`f6714fb`](https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160)**",
    "created_at": "2020-01-24T12:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454819",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ccc5d82`](https://github.com/sagemath/sagetrac-mirror/commit/ccc5d82e586569f764c9fcdffb0d4aab9a7e1e04)** to **[`f6714fb`](https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160)**



---

archive/issue_comments_454820.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWith the branch applied, I end up with the same permission issues as with `./configure --without-system-openblas`. That is to say\n\n```\nCopying package files from temporary location /opt/sage/local/var/tmp/sage/build/openblas-0.3.6.p0/inst to /opt/sage/local\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/blas.pc': Permission denied\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/cblas.pc': Permission denied\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/lapack.pc': Permission denied\n```",
    "created_at": "2020-01-24T12:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454820",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

With the branch applied, I end up with the same permission issues as with `./configure --without-system-openblas`. That is to say

```
Copying package files from temporary location /opt/sage/local/var/tmp/sage/build/openblas-0.3.6.p0/inst to /opt/sage/local
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/blas.pc': Permission denied
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/cblas.pc': Permission denied
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/lapack.pc': Permission denied
```



---

archive/issue_comments_454821.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIs /opt/sage/local your $SAGE_LOCAL?\nIf so, could you try `rm -rf /opt/sage/local/pkgconfig/` ?",
    "created_at": "2020-01-24T12:28:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454821",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

Is /opt/sage/local your $SAGE_LOCAL?
If so, could you try `rm -rf /opt/sage/local/pkgconfig/` ?



---

archive/issue_comments_454822.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nsorry, I meant `rm -rf /opt/sage/local/lib/pkgconfig/`",
    "created_at": "2020-01-24T12:31:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454822",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

sorry, I meant `rm -rf /opt/sage/local/lib/pkgconfig/`



---

archive/issue_comments_454823.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\neven more precisely, `rm -f /opt/sage/local/lib/pkgconfig/*blas.pc && rm -f /opt/sage/local/lib/pkgconfig/lapack.pc`",
    "created_at": "2020-01-24T12:38:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454823",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

even more precisely, `rm -f /opt/sage/local/lib/pkgconfig/*blas.pc && rm -f /opt/sage/local/lib/pkgconfig/lapack.pc`



---

archive/issue_comments_454824.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI presume you get permission problems while running `make`. This is due to #29003 - where the installation of these is done somewhat carelessly.",
    "created_at": "2020-01-24T12:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454824",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

I presume you get permission problems while running `make`. This is due to #29003 - where the installation of these is done somewhat carelessly.



---

archive/issue_comments_454825.json:
```json
{
    "body": "Changed commit from **[`f6714fb`](https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160)** to **[`7ac1293`](https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315)**",
    "created_at": "2020-01-24T13:37:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454825",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f6714fb`](https://github.com/sagemath/sagetrac-mirror/commit/f6714fb778558136095fd9a8d61b86da1d744160)** to **[`7ac1293`](https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315)**



---

archive/issue_comments_454826.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315\"><code>7ac1293</code></a></td><td><code>added missing module names - cblas and lapack</code></td></tr></table>\n",
    "created_at": "2020-01-24T13:37:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454826",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315"><code>7ac1293</code></a></td><td><code>added missing module names - cblas and lapack</code></td></tr></table>




---

archive/issue_comments_454827.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhen I do `make distclean` it does remove `local` entirely. At which step do you want me to try `rm XXX`?",
    "created_at": "2020-01-24T13:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454827",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

When I do `make distclean` it does remove `local` entirely. At which step do you want me to try `rm XXX`?



---

archive/issue_comments_454828.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nthe logic of this branch is still not 100% correct - if we end up installing OpenBLAS we should not install any *.pc files, i.e. should not run any `AC_CONFIG_LINKS`.",
    "created_at": "2020-01-24T13:42:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454828",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

the logic of this branch is still not 100% correct - if we end up installing OpenBLAS we should not install any *.pc files, i.e. should not run any `AC_CONFIG_LINKS`.



---

archive/issue_comments_454829.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@videlec](#comment:14):\n> When I do `make distclean` it does remove `local` entirely. At which step do you want me to try `rm XXX`?\n\nthese `rm` from [comment:11](#comment:11) should be run after `./configure` and before `make`, assuming I understand what's going on.",
    "created_at": "2020-01-24T13:44:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454829",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@videlec](#comment:14):
> When I do `make distclean` it does remove `local` entirely. At which step do you want me to try `rm XXX`?

these `rm` from [comment:11](#comment:11) should be run after `./configure` and before `make`, assuming I understand what's going on.



---

archive/issue_comments_454830.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nBy the way, please pull the branch again - [comment:13](#comment:13) is rather important for Arch.",
    "created_at": "2020-01-24T13:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454830",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

By the way, please pull the branch again - [comment:13](#comment:13) is rather important for Arch.



---

archive/issue_comments_454831.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAfter `./configure` there is no directory `local/lib/pkgconfig/`\n\n```\n$ ls -R local/\nlocal/:\nbin  etc  include  lib  lib64  share  var\n\nlocal/bin:\n\nlocal/etc:\n\nlocal/include:\n\nlocal/lib:\n\nlocal/share:\n\nlocal/var:\nlib\n\nlocal/var/lib:\nsage\n\nlocal/var/lib/sage:\ninstalled\n\nlocal/var/lib/sage/installed:\n```",
    "created_at": "2020-01-24T13:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454831",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

After `./configure` there is no directory `local/lib/pkgconfig/`

```
$ ls -R local/
local/:
bin  etc  include  lib  lib64  share  var

local/bin:

local/etc:

local/include:

local/lib:

local/share:

local/var:
lib

local/var/lib:
sage

local/var/lib/sage:
installed

local/var/lib/sage/installed:
```



---

archive/issue_comments_454832.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n`local/lib/pkgconfig/` may or may not be present, it depends upon the state of the system.\n(e.g. if you did `make distclean` before `./configure` you won't have\n`local/` at all)\n\nNow, what happens if you run `make`? Do you still get the same error?",
    "created_at": "2020-01-24T14:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454832",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

`local/lib/pkgconfig/` may or may not be present, it depends upon the state of the system.
(e.g. if you did `make distclean` before `./configure` you won't have
`local/` at all)

Now, what happens if you run `make`? Do you still get the same error?



---

archive/issue_comments_454833.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIt seems I got Arch running in an lxc container, so I guess I can polish it on my own.",
    "created_at": "2020-01-24T15:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454833",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

It seems I got Arch running in an lxc container, so I guess I can polish it on my own.



---

archive/issue_comments_454834.json:
```json
{
    "body": "Changed commit from **[`7ac1293`](https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315)** to **[`16b4d9d`](https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5)**",
    "created_at": "2020-01-24T18:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454834",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7ac1293`](https://github.com/sagemath/sagetrac-mirror/commit/7ac129319552ce341bf5f827f378fd43e95d7315)** to **[`16b4d9d`](https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5)**



---

archive/issue_comments_454835.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5\"><code>16b4d9d</code></a></td><td><code>make installing *.pc files conditional</code></td></tr></table>\n",
    "created_at": "2020-01-24T18:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454835",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5"><code>16b4d9d</code></a></td><td><code>make installing *.pc files conditional</code></td></tr></table>




---

archive/issue_comments_454836.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1\"><code>2941411</code></a></td><td><code>correct quoting of m4 index variable</code></td></tr></table>\n",
    "created_at": "2020-01-24T22:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454836",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1"><code>2941411</code></a></td><td><code>correct quoting of m4 index variable</code></td></tr></table>




---

archive/issue_comments_454837.json:
```json
{
    "body": "Changed commit from **[`16b4d9d`](https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5)** to **[`2941411`](https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1)**",
    "created_at": "2020-01-24T22:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454837",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`16b4d9d`](https://github.com/sagemath/sagetrac-mirror/commit/16b4d9d74aa9217253f12ad8cd3b3d7dd48323c5)** to **[`2941411`](https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1)**



---

archive/issue_comments_454838.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nwith this last commit appears to work on Arch (with openblas from the system), all the way to the point of a broken scipy build - probably #29051.",
    "created_at": "2020-01-24T23:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454838",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

with this last commit appears to work on Arch (with openblas from the system), all the way to the point of a broken scipy build - probably #29051.



---

archive/issue_comments_454839.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nIf I'm reading the code correctly `openblas.pc` is not copied to `blas.pc` right in the Arch Linux case right?",
    "created_at": "2020-01-24T23:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454839",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:24" align="right">comment:24</div>

If I'm reading the code correctly `openblas.pc` is not copied to `blas.pc` right in the Arch Linux case right?



---

archive/issue_comments_454840.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@isuruf](#comment:24):\n> If I'm reading the code correctly `openblas.pc` is not copied to `blas.pc` right in the Arch Linux case right?\n\nit is copied (i.e. blas.pc becomes a link to openblas.pc), but on Arch it makes no difference, as they are also like this on the system\n\n```\n[dimpase@arch]$ file /usr/lib/pkgconfig/blas.pc \n/usr/lib/pkgconfig/blas.pc: symbolic link to openblas.pc\n```",
    "created_at": "2020-01-24T23:11:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454840",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@isuruf](#comment:24):
> If I'm reading the code correctly `openblas.pc` is not copied to `blas.pc` right in the Arch Linux case right?

it is copied (i.e. blas.pc becomes a link to openblas.pc), but on Arch it makes no difference, as they are also like this on the system

```
[dimpase@arch]$ file /usr/lib/pkgconfig/blas.pc 
/usr/lib/pkgconfig/blas.pc: symbolic link to openblas.pc
```



---

archive/issue_events_401515.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-01-24T23:12:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401515"
}
```



---

archive/issue_events_401516.json:
```json
{
    "actor": "https://github.com/isuruf",
    "created_at": "2020-01-24T23:12:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401516"
}
```



---

archive/issue_comments_454841.json:
```json
{
    "body": "Reviewer: **Isuru Fernando**",
    "created_at": "2020-01-24T23:12:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454841",
    "user": "https://github.com/isuruf"
}
```

Reviewer: **Isuru Fernando**



---

archive/issue_comments_454842.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThanks. I misread the code",
    "created_at": "2020-01-24T23:12:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454842",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:26" align="right">comment:26</div>

Thanks. I misread the code



---

archive/issue_comments_454843.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nwith this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)",
    "created_at": "2020-01-25T13:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454843",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)



---

archive/issue_comments_454844.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nDoes not work on my arch... At commit `2941411`, the build of `fflas-ffpack` failed with\n\n```\n../../../fflas-ffpack/fflas/fflas_fassign.inl: In function 'void FFLAS::fassign(const Field&, size_t, typename Field::ConstElement_ptr, size_t, typename Field::Element_ptr, size_t) [with Field = Givaro::Modular<f\nloat>; size_t = long unsigned int; typename Field::ConstElement_ptr = const float*; typename Field::Element_ptr = float*]':\n../../../fflas-ffpack/fflas/fflas_fassign.inl:75:9: error: 'openblas_set_num_threads' was not declared in this scope; did you mean 'omp_set_num_threads'?\n   75 |         openblas_set_num_threads(__FFLASFFPACK_OPENBLAS_NUM_THREADS);\n      |         ^~~~~~~~~~~~~~~~~~~~~~~~\n      |         omp_set_num_threads\n```",
    "created_at": "2020-01-25T16:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454844",
    "user": "https://github.com/videlec"
}
```

<div id="comment:28" align="right">comment:28</div>

Does not work on my arch... At commit `2941411`, the build of `fflas-ffpack` failed with

```
../../../fflas-ffpack/fflas/fflas_fassign.inl: In function 'void FFLAS::fassign(const Field&, size_t, typename Field::ConstElement_ptr, size_t, typename Field::Element_ptr, size_t) [with Field = Givaro::Modular<f
loat>; size_t = long unsigned int; typename Field::ConstElement_ptr = const float*; typename Field::Element_ptr = float*]':
../../../fflas-ffpack/fflas/fflas_fassign.inl:75:9: error: 'openblas_set_num_threads' was not declared in this scope; did you mean 'omp_set_num_threads'?
   75 |         openblas_set_num_threads(__FFLASFFPACK_OPENBLAS_NUM_THREADS);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~
      |         omp_set_num_threads
```



---

archive/issue_comments_454845.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n(trying now with `./configure --without-system-openblas`)",
    "created_at": "2020-01-25T16:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454845",
    "user": "https://github.com/videlec"
}
```

<div id="comment:29" align="right">comment:29</div>

(trying now with `./configure --without-system-openblas`)



---

archive/issue_comments_454846.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@videlec](#comment:29):\n> (trying now with `./configure --without-system-openblas`)\n\nIn the above situation, `make` fails at building openblas with the same as usual\n\n```\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/blas.pc': Permission denied\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/cblas.pc': Permission denied\ncp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/lapack.pc': Permission denied\n```",
    "created_at": "2020-01-25T16:19:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454846",
    "user": "https://github.com/videlec"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@videlec](#comment:29):
> (trying now with `./configure --without-system-openblas`)

In the above situation, `make` fails at building openblas with the same as usual

```
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/blas.pc': Permission denied
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/cblas.pc': Permission denied
cp: cannot create regular file '/opt/sage/local/./lib/pkgconfig/lapack.pc': Permission denied
```



---

archive/issue_comments_454847.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThat breaks configure if there is no system-wide fortran:\n\n```\nchecking for Fortran libraries of ... \nchecking for dummy main to link with Fortran libraries... none\nconfigure: error: in `/Users/buildbot-sage/slave/sage_git/build':\nconfigure: error: cannot compile a simple Fortran program\nSee `config.log' for more details\nchecking for Fortran name-mangling scheme... If you would like to try to build Sage anyway (to help porting),\nexport the variable 'SAGE_PORT' to something non-empty.\nmake[1]: *** [build/make/Makefile] Error 1\nmake: *** [base-toolchain] Error 2\nmake: Target `start' not remade because of errors.\n```",
    "created_at": "2020-01-25T17:22:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454847",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:31" align="right">comment:31</div>

That breaks configure if there is no system-wide fortran:

```
checking for Fortran libraries of ... 
checking for dummy main to link with Fortran libraries... none
configure: error: in `/Users/buildbot-sage/slave/sage_git/build':
configure: error: cannot compile a simple Fortran program
See `config.log' for more details
checking for Fortran name-mangling scheme... If you would like to try to build Sage anyway (to help porting),
export the variable 'SAGE_PORT' to something non-empty.
make[1]: *** [build/make/Makefile] Error 1
make: *** [base-toolchain] Error 2
make: Target `start' not remade because of errors.
```



---

archive/issue_events_401517.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-25T17:22:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401517"
}
```



---

archive/issue_events_401518.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-25T17:22:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401518"
}
```



---

archive/issue_comments_454848.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@vbraun](#comment:31):\n> That breaks configure if there is no system-wide fortran:\n\ngood catch - so the gfortran is a dependency here.\n\nBut this also applies to many `spkg-configure.m4` tests that use a C++ compiler\nto run tests.",
    "created_at": "2020-01-25T18:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454848",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@vbraun](#comment:31):
> That breaks configure if there is no system-wide fortran:

good catch - so the gfortran is a dependency here.

But this also applies to many `spkg-configure.m4` tests that use a C++ compiler
to run tests.



---

archive/issue_comments_454849.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nby right, C, C++, and Fortran compilers are pre-reqs for many `spkg-configure.m4` tests,\nas testing with one compiler and then build another compiler and use it is dodgy.",
    "created_at": "2020-01-25T18:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454849",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">comment:33</div>

by right, C, C++, and Fortran compilers are pre-reqs for many `spkg-configure.m4` tests,
as testing with one compiler and then build another compiler and use it is dodgy.



---

archive/issue_comments_454850.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@dimpase](#comment:27):\n> with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)\n\nI can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?",
    "created_at": "2020-01-26T09:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454850",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@dimpase](#comment:27):
> with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)

I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?



---

archive/issue_comments_454851.json:
```json
{
    "body": "Dependencies: **#29051**",
    "created_at": "2020-01-26T09:51:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454851",
    "user": "https://github.com/dimpase"
}
```

Dependencies: **#29051**



---

archive/issue_comments_454852.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nAttachment: **[vdelecroix-29071-fflas_ffpack-2.4.3.log](https://github.com/sagemath/sage/files/ticket29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)**\n\nReplying to [@antonio-rojas](#comment:34):\n> Replying to [@dimpase](#comment:27):\n> > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)\n\n> \n> I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?\n\nHere they are\n- [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)\n- [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)",
    "created_at": "2020-01-26T09:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454852",
    "user": "https://github.com/videlec"
}
```

<div id="comment:36" align="right">comment:36</div>

Attachment: **[vdelecroix-29071-fflas_ffpack-2.4.3.log](https://github.com/sagemath/sage/files/ticket29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)**

Replying to [@antonio-rojas](#comment:34):
> Replying to [@dimpase](#comment:27):
> > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)

> 
> I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?

Here they are
- [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)
- [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)



---

archive/issue_comments_454853.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@videlec](#comment:36):\n> Replying to [@antonio-rojas](#comment:34):\n> > Replying to [@dimpase](#comment:27):\n> > > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)\n\n> > \n> > I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?\n\n> \n> Here they are\n> - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)\n> - [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)\n\nI think your issue is caused by the same .pc stale symlinks that are making the build fail with sage's openblas. fflas-ffpack's spkg-install has `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"`, which should return `-lcblas` on Arch, but it is returning `-lopenblas` for you. The only reason I can think of is those symlinks. Can you delete them and try again?",
    "created_at": "2020-01-26T10:21:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454853",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@videlec](#comment:36):
> Replying to [@antonio-rojas](#comment:34):
> > Replying to [@dimpase](#comment:27):
> > > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)

> > 
> > I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?

> 
> Here they are
> - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)
> - [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)

I think your issue is caused by the same .pc stale symlinks that are making the build fail with sage's openblas. fflas-ffpack's spkg-install has `LINBOX_BLAS="$(pkg-config --libs cblas)"`, which should return `-lcblas` on Arch, but it is returning `-lopenblas` for you. The only reason I can think of is those symlinks. Can you delete them and try again?



---

archive/issue_comments_454854.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@antonio-rojas](#comment:37):\n> Replying to [@videlec](#comment:36):\n> > Replying to [@antonio-rojas](#comment:34):\n> > > Replying to [@dimpase](#comment:27):\n> > > > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)\n\n> > > \n> > > I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?\n\n> > \n> > Here they are\n> > - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)\n> > - [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)\n\n> \n> I think your issue is caused by the same .pc stale symlinks that are making the build fail with sage's openblas. fflas-ffpack's spkg-install has `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"`, which should return `-lcblas` on Arch, but it is returning `-lopenblas` for you. The only reason I can think of is those symlinks. Can you delete them and try again?\n\nIndeed\n\n```\n(sage-sh)$ pkg-config --libs cblas\n-lopenblas \n(sage-sh) vincent@mangouste:sage$ rm local/lib/pkgconfig/cblas.pc \n(sage-sh) vincent@mangouste:sage$ rm local/lib/pkgconfig/blas.pc \n(sage-sh) vincent@mangouste:sage$ pkg-config --libs cblas\n-lcblas \n```\nI just relaunched `make` after that...",
    "created_at": "2020-01-26T10:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454854",
    "user": "https://github.com/videlec"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@antonio-rojas](#comment:37):
> Replying to [@videlec](#comment:36):
> > Replying to [@antonio-rojas](#comment:34):
> > > Replying to [@dimpase](#comment:27):
> > > > with this branch, reverting #29025 makes everything  work on Arch (also with OpenBLAS, gsl, R, etc from the system)

> > > 
> > > I can confirm, thank you. Vincent, can you post the config log of the failed fflas-ffpack build?

> > 
> > Here they are
> > - [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)
> > - [fflas_ffpack-2.4.3.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-fflas_ffpack-2.4.3.log)

> 
> I think your issue is caused by the same .pc stale symlinks that are making the build fail with sage's openblas. fflas-ffpack's spkg-install has `LINBOX_BLAS="$(pkg-config --libs cblas)"`, which should return `-lcblas` on Arch, but it is returning `-lopenblas` for you. The only reason I can think of is those symlinks. Can you delete them and try again?

Indeed

```
(sage-sh)$ pkg-config --libs cblas
-lopenblas 
(sage-sh) vincent@mangouste:sage$ rm local/lib/pkgconfig/cblas.pc 
(sage-sh) vincent@mangouste:sage$ rm local/lib/pkgconfig/blas.pc 
(sage-sh) vincent@mangouste:sage$ pkg-config --libs cblas
-lcblas 
```
I just relaunched `make` after that...



---

archive/issue_comments_454855.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f\"><code>508ac7c</code></a></td><td><code>ensure gfortran is available</code></td></tr></table>\n",
    "created_at": "2020-01-26T10:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454855",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f"><code>508ac7c</code></a></td><td><code>ensure gfortran is available</code></td></tr></table>




---

archive/issue_comments_454856.json:
```json
{
    "body": "Changed commit from **[`2941411`](https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1)** to **[`508ac7c`](https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f)**",
    "created_at": "2020-01-26T10:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454856",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2941411`](https://github.com/sagemath/sagetrac-mirror/commit/29414110c7d0e6880774aa327948ce6bb4528ed1)** to **[`508ac7c`](https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f)**



---

archive/issue_events_401519.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T10:33:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401519"
}
```



---

archive/issue_events_401520.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-26T10:33:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401520"
}
```



---

archive/issue_comments_454857.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nfixed the issue in [comment:31](#comment:31)",
    "created_at": "2020-01-26T10:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454857",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">comment:40</div>

fixed the issue in [comment:31](#comment:31)



---

archive/issue_comments_454858.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThe fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n\nTo fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\nDima, do you want to include this change here or should I open a new ticket?",
    "created_at": "2020-01-26T10:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454858",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:41" align="right">comment:41</div>

The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.

To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

Dima, do you want to include this change here or should I open a new ticket?



---

archive/issue_comments_454859.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@antonio-rojas](#comment:41):\n> The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> \n> To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n> \n> Dima, do you want to include this change here or should I open a new ticket?\n\nlet's do a new ticket, as this is a rather different issue.",
    "created_at": "2020-01-26T10:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454859",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@antonio-rojas](#comment:41):
> The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> 
> To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas
> 
> Dima, do you want to include this change here or should I open a new ticket?

let's do a new ticket, as this is a rather different issue.



---

archive/issue_comments_454860.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@antonio-rojas](#comment:41):\n> The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> \n> To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\nOn my machine I got\n\n```\n(sage-sh)$ pkg-config --libs blas cblas\n-lopenblas \n```",
    "created_at": "2020-01-26T11:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454860",
    "user": "https://github.com/videlec"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@antonio-rojas](#comment:41):
> The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> 
> To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

On my machine I got

```
(sage-sh)$ pkg-config --libs blas cblas
-lopenblas 
```



---

archive/issue_comments_454861.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@videlec](#comment:43):\n> Replying to [@antonio-rojas](#comment:41):\n> > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> > \n> > To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\n> \n> On my machine I got\n> \n> ```\n> (sage-sh)$ pkg-config --libs blas cblas\n> -lopenblas \n> ```\n\nThe above is coherent with the symlinks provided in Sage\n\n```\n(sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n```\nBut not with what I have in `/usr/lib/pkgconfig/`\n\n```\n$ ls -l /usr/lib/pkgconfig/ | grep blas\nlrwxrwxrwx 1 root root   11 20 ao\u00fbt  12:35 blas.pc -> openblas.pc\n-rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc\n-rw-r--r-- 1 root root  497 20 ao\u00fbt  12:35 openblas.pc\n```",
    "created_at": "2020-01-26T11:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454861",
    "user": "https://github.com/videlec"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@videlec](#comment:43):
> Replying to [@antonio-rojas](#comment:41):
> > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> > 
> > To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

> 
> On my machine I got
> 
> ```
> (sage-sh)$ pkg-config --libs blas cblas
> -lopenblas 
> ```

The above is coherent with the symlinks provided in Sage

```
(sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas
lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
```
But not with what I have in `/usr/lib/pkgconfig/`

```
$ ls -l /usr/lib/pkgconfig/ | grep blas
lrwxrwxrwx 1 root root   11 20 aot  12:35 blas.pc -> openblas.pc
-rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc
-rw-r--r-- 1 root root  497 20 aot  12:35 openblas.pc
```



---

archive/issue_comments_454862.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@videlec](#comment:44):\n> Replying to [@videlec](#comment:43):\n> > Replying to [@antonio-rojas](#comment:41):\n> > > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> > > \n> > > To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\n> > \n> > On my machine I got\n> > \n> > ```\n> > (sage-sh)$ pkg-config --libs blas cblas\n> > -lopenblas \n> > ```\n\n> \n> The above is coherent with the symlinks provided in Sage\n> \n> ```\n> (sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n> ```\n> But not with what I have in `/usr/lib/pkgconfig/`\n> \n> ```\n> $ ls -l /usr/lib/pkgconfig/ | grep blas\n> lrwxrwxrwx 1 root root   11 20 ao\u00fbt  12:35 blas.pc -> openblas.pc\n> -rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc\n> -rw-r--r-- 1 root root  497 20 ao\u00fbt  12:35 openblas.pc\n> ```\n\nThose links are no longer created on Arch, that's the point of this ticket",
    "created_at": "2020-01-26T11:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454862",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@videlec](#comment:44):
> Replying to [@videlec](#comment:43):
> > Replying to [@antonio-rojas](#comment:41):
> > > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> > > 
> > > To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

> > 
> > On my machine I got
> > 
> > ```
> > (sage-sh)$ pkg-config --libs blas cblas
> > -lopenblas 
> > ```

> 
> The above is coherent with the symlinks provided in Sage
> 
> ```
> (sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
> ```
> But not with what I have in `/usr/lib/pkgconfig/`
> 
> ```
> $ ls -l /usr/lib/pkgconfig/ | grep blas
> lrwxrwxrwx 1 root root   11 20 aot  12:35 blas.pc -> openblas.pc
> -rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc
> -rw-r--r-- 1 root root  497 20 aot  12:35 openblas.pc
> ```

Those links are no longer created on Arch, that's the point of this ticket



---

archive/issue_comments_454863.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@videlec](#comment:44):\n> Replying to [@videlec](#comment:43):\n> > Replying to [@antonio-rojas](#comment:41):\n> > > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.\n> > > \n> > > To fix this, `LINBOX_BLAS=\"$(pkg-config --libs cblas)\"` should be replaced with ` LINBOX_BLAS=\"$(pkg-config --libs blas cblas)\"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas\n\n> > \n> > On my machine I got\n> > \n> > ```\n> > (sage-sh)$ pkg-config --libs blas cblas\n> > -lopenblas \n> > ```\n\n> \n> The above is coherent with the symlinks provided in Sage\n> \n> ```\n> (sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\n> lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n> ```\n> But not with what I have in `/usr/lib/pkgconfig/`\n> \n> ```\n> $ ls -l /usr/lib/pkgconfig/ | grep blas\n> lrwxrwxrwx 1 root root   11 20 ao\u00fbt  12:35 blas.pc -> openblas.pc\n> -rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc\n> -rw-r--r-- 1 root root  497 20 ao\u00fbt  12:35 openblas.pc\n> ```\n\nRemoving the symlinks and setting them according to what is in `/usr/lib` seems to fix the issue\n\n```\n$ rm /opt/sage/local/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/cblas.pc\n$ ln -s /usr/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/\n$ ln -s /usr/lib/pkgconfig/cblas.pc /opt/sage/local/lib/pkgconfig/\n```",
    "created_at": "2020-01-26T12:00:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454863",
    "user": "https://github.com/videlec"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@videlec](#comment:44):
> Replying to [@videlec](#comment:43):
> > Replying to [@antonio-rojas](#comment:41):
> > > The fact that LINBOX_BLAS is set to -lcblas on Arch makes fflas-ffpack not detect openblas (since -lcblas doesn't provide openblas_set_num_threads), so it is compiled without openblas optimizations.
> > > 
> > > To fix this, `LINBOX_BLAS="$(pkg-config --libs cblas)"` should be replaced with ` LINBOX_BLAS="$(pkg-config --libs blas cblas)"` in fflas-ffpack's spkg-install, which would return `-lopenblas -lcblas` on Arch and wouldn't make any difference on systems where openblas provides cblas

> > 
> > On my machine I got
> > 
> > ```
> > (sage-sh)$ pkg-config --libs blas cblas
> > -lopenblas 
> > ```

> 
> The above is coherent with the symlinks provided in Sage
> 
> ```
> (sage-sh)$ ls -l local/lib/pkgconfig/ | grep blas
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 blas.pc -> /usr/lib/pkgconfig/openblas.pc
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 12:25 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
> lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:54 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
> ```
> But not with what I have in `/usr/lib/pkgconfig/`
> 
> ```
> $ ls -l /usr/lib/pkgconfig/ | grep blas
> lrwxrwxrwx 1 root root   11 20 aot  12:35 blas.pc -> openblas.pc
> -rw-r--r-- 1 root root  256 24 nov.  11:43 cblas.pc
> -rw-r--r-- 1 root root  497 20 aot  12:35 openblas.pc
> ```

Removing the symlinks and setting them according to what is in `/usr/lib` seems to fix the issue

```
$ rm /opt/sage/local/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/cblas.pc
$ ln -s /usr/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/
$ ln -s /usr/lib/pkgconfig/cblas.pc /opt/sage/local/lib/pkgconfig/
```



---

archive/issue_comments_454864.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nAfter a `make distclean` and standing at commit `508ac7c` I see the same problem\n\n```\n$ ls -l /opt/sage/local/lib/pkgconfig/ | grep blas\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 blas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n```",
    "created_at": "2020-01-26T12:05:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454864",
    "user": "https://github.com/videlec"
}
```

<div id="comment:47" align="right">comment:47</div>

After a `make distclean` and standing at commit `508ac7c` I see the same problem

```
$ ls -l /opt/sage/local/lib/pkgconfig/ | grep blas
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 blas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:02 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
```



---

archive/issue_comments_454865.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nhave you run `./bootstrap && ./configure` ?\nIf yes, please post config.log (as attachement)",
    "created_at": "2020-01-26T12:11:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454865",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:48" align="right">comment:48</div>

have you run `./bootstrap && ./configure` ?
If yes, please post config.log (as attachement)



---

archive/issue_comments_454866.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nWait, why do you do these:\n\n```\n$ ln -s /usr/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/\n$ ln -s /usr/lib/pkgconfig/cblas.pc /opt/sage/local/lib/pkgconfig/\n```\n\n?\n\nThis could only break stuff, if you do it after `make distclean`.",
    "created_at": "2020-01-26T12:14:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454866",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:49" align="right">comment:49</div>

Wait, why do you do these:

```
$ ln -s /usr/lib/pkgconfig/blas.pc /opt/sage/local/lib/pkgconfig/
$ ln -s /usr/lib/pkgconfig/cblas.pc /opt/sage/local/lib/pkgconfig/
```

?

This could only break stuff, if you do it after `make distclean`.



---

archive/issue_comments_454867.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nAfter `make distclean`, `./bootstrap`, `./configure` the build still fails at `fflas-ffpack` with the same\n\n```\nerror: 'openblas_set_num_threads' was not declared in this scope; did you mean 'omp_set_num_threads'?\n```\nAlso the blas symlinks are still pointing to openblas\n\n```\n$ ls -l local/lib/pkgconfig/ | grep blas\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 blas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n```",
    "created_at": "2020-01-26T12:18:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454867",
    "user": "https://github.com/videlec"
}
```

<div id="comment:50" align="right">comment:50</div>

After `make distclean`, `./bootstrap`, `./configure` the build still fails at `fflas-ffpack` with the same

```
error: 'openblas_set_num_threads' was not declared in this scope; did you mean 'omp_set_num_threads'?
```
Also the blas symlinks are still pointing to openblas

```
$ ls -l local/lib/pkgconfig/ | grep blas
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 blas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
```



---

archive/issue_comments_454868.json:
```json
{
    "body": "Attachment: **[vdelecroix-29071-config.log](https://github.com/sagemath/sage/files/ticket29071/vdelecroix-29071-config.log)**",
    "created_at": "2020-01-26T12:19:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454868",
    "user": "https://github.com/videlec"
}
```

Attachment: **[vdelecroix-29071-config.log](https://github.com/sagemath/sage/files/ticket29071/vdelecroix-29071-config.log)**



---

archive/issue_comments_454869.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nPlease also make sure there is nothing in `src/lib/pkgconfig` before running `./configure`. After running ./configure on Arch it should look like\n\n```\n$ ls src/lib/pkgconfig/\nblas.pc  gsl.pc\n```\n\nYou could have these stale stuff from older versions of this ticket or even before.",
    "created_at": "2020-01-26T12:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454869",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">comment:51</div>

Please also make sure there is nothing in `src/lib/pkgconfig` before running `./configure`. After running ./configure on Arch it should look like

```
$ ls src/lib/pkgconfig/
blas.pc  gsl.pc
```

You could have these stale stuff from older versions of this ticket or even before.



---

archive/issue_comments_454870.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nHere is [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)",
    "created_at": "2020-01-26T12:20:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454870",
    "user": "https://github.com/videlec"
}
```

<div id="comment:52" align="right">comment:52</div>

Here is [config.log](https://trac.sagemath.org/raw-attachment/ticket/29071/vdelecroix-29071-config.log)



---

archive/issue_comments_454871.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nIndeed\n\n```\n$ ls -l src/lib/pkgconfig/\ntotal 4\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 blas.pc -> /usr/lib/pkgconfig/openblas.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 11:51 cblas.pc -> /usr/lib/pkgconfig/openblas.pc\n-rw-r--r-- 1 vincent vincent 200 26 janv. 14:12 gsl.pc\nlrwxrwxrwx 1 vincent vincent  30 26 janv. 11:51 lapack.pc -> /usr/lib/pkgconfig/openblas.pc\n```",
    "created_at": "2020-01-26T12:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454871",
    "user": "https://github.com/videlec"
}
```

<div id="comment:53" align="right">comment:53</div>

Indeed

```
$ ls -l src/lib/pkgconfig/
total 4
lrwxrwxrwx 1 vincent vincent  30 26 janv. 14:12 blas.pc -> /usr/lib/pkgconfig/openblas.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:51 cblas.pc -> /usr/lib/pkgconfig/openblas.pc
-rw-r--r-- 1 vincent vincent 200 26 janv. 14:12 gsl.pc
lrwxrwxrwx 1 vincent vincent  30 26 janv. 11:51 lapack.pc -> /usr/lib/pkgconfig/openblas.pc
```



---

archive/issue_comments_454872.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nWhy isn't `src/lib/pkgconfig` properly cleaned?",
    "created_at": "2020-01-26T12:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454872",
    "user": "https://github.com/videlec"
}
```

<div id="comment:54" align="right">comment:54</div>

Why isn't `src/lib/pkgconfig` properly cleaned?



---

archive/issue_comments_454873.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nI agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?",
    "created_at": "2020-01-26T12:23:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454873",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:55" align="right">comment:55</div>

I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?



---

archive/issue_comments_454874.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@dimpase](#comment:55):\n> I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?\n\nThat `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.",
    "created_at": "2020-01-26T12:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454874",
    "user": "https://github.com/videlec"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@dimpase](#comment:55):
> I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?

That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.



---

archive/issue_comments_454875.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nAfter removing `src/lib/pkgconfig` the build `fflas-ffpack` succeeded! Thank you.",
    "created_at": "2020-01-26T12:38:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454875",
    "user": "https://github.com/videlec"
}
```

<div id="comment:57" align="right">comment:57</div>

After removing `src/lib/pkgconfig` the build `fflas-ffpack` succeeded! Thank you.



---

archive/issue_comments_454876.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@videlec](#comment:56):\n> Replying to [@dimpase](#comment:55):\n> > I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?\n\n> \n> That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.\n\nI've opened a blocker #29082 to deal with cleaning of these files, sorry for this mess.",
    "created_at": "2020-01-26T12:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454876",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@videlec](#comment:56):
> Replying to [@dimpase](#comment:55):
> > I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?

> 
> That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.

I've opened a blocker #29082 to deal with cleaning of these files, sorry for this mess.



---

archive/issue_comments_454877.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nReplying to [@dimpase](#comment:58):\n> Replying to [@videlec](#comment:56):\n> > Replying to [@dimpase](#comment:55):\n> > > I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?\n\n> > \n> > That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.\n\n> \n> I've opened a blocker #29082 to deal with cleaning of these files, sorry for this mess.\n\nYou did more good than bad :-) It is quite nice to have Sage using the libraries from the system!",
    "created_at": "2020-01-26T12:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454877",
    "user": "https://github.com/videlec"
}
```

<div id="comment:59" align="right">comment:59</div>

Replying to [@dimpase](#comment:58):
> Replying to [@videlec](#comment:56):
> > Replying to [@dimpase](#comment:55):
> > > I agree that `src/lib/pkgconfig` should be properly cleaned, you are right. Perhaps by `make distclean`?

> > 
> > That `make distclean` removes `src/lib/pkgconfig` entirely would make sense to me.

> 
> I've opened a blocker #29082 to deal with cleaning of these files, sorry for this mess.

You did more good than bad :-) It is quite nice to have Sage using the libraries from the system!



---

archive/issue_comments_454878.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nPlease also don't forget that you'll need (an equivalent of) #29051 to make the build succeed (without it scipy will fail).",
    "created_at": "2020-01-26T12:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454878",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:60" align="right">comment:60</div>

Please also don't forget that you'll need (an equivalent of) #29051 to make the build succeed (without it scipy will fail).



---

archive/issue_comments_454879.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)** to **[u/mkoeppe/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/openblaspcfix)**",
    "created_at": "2020-01-28T00:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454879",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)** to **[u/mkoeppe/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/openblaspcfix)**



---

archive/issue_comments_454880.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI have merged in #29051 and current beta.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97\"><code>9d1770a</code></a></td><td><code>revert #29025, remove useless [ALL] section</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d\"><code>dba7aef</code></a></td><td><code>revert from \"libraries=\" back to section-specific \"BLAH_libs=\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe4a67e3b77e0249ea51cfd1231e3327489c185b\"><code>fe4a67e</code></a></td><td><code>Merge branch 'public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' of git://trac.sagemath.org/sage into t/29071/packages/openblaspcfix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54\"><code>2be2905</code></a></td><td><code>Merge tag '9.1.beta2' into t/29071/packages/openblaspcfix</code></td></tr></table>\n",
    "created_at": "2020-01-28T00:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454880",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:62" align="right">comment:62</div>

I have merged in #29051 and current beta.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d1770a3ae75526fab19cff91dba6aeba1e04d97"><code>9d1770a</code></a></td><td><code>revert #29025, remove useless [ALL] section</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dba7aefc4d6678210c796aaea4edf17867be216d"><code>dba7aef</code></a></td><td><code>revert from "libraries=" back to section-specific "BLAH_libs="</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe4a67e3b77e0249ea51cfd1231e3327489c185b"><code>fe4a67e</code></a></td><td><code>Merge branch 'public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' of git://trac.sagemath.org/sage into t/29071/packages/openblaspcfix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54"><code>2be2905</code></a></td><td><code>Merge tag '9.1.beta2' into t/29071/packages/openblaspcfix</code></td></tr></table>




---

archive/issue_comments_454881.json:
```json
{
    "body": "Changed commit from **[`508ac7c`](https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f)** to **[`2be2905`](https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54)**",
    "created_at": "2020-01-28T00:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454881",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`508ac7c`](https://github.com/sagemath/sagetrac-mirror/commit/508ac7cd7400a8302a5bf3fcb8f18672415cbb4f)** to **[`2be2905`](https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54)**



---

archive/issue_comments_454882.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nI don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n\nAfter all, sage-the-distribution has a mechanism to install `gfortran` itself. We shouldn't break that.\n\nAs you can see at https://github.com/mkoeppe/sage/runs/411989461, with this ticket all \"minimal\" installs fail with `configure: error: in `/sage':\nconfigure: error: cannot compile a simple Fortran program`.",
    "created_at": "2020-01-28T01:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454882",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:63" align="right">comment:63</div>

I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 

After all, sage-the-distribution has a mechanism to install `gfortran` itself. We shouldn't break that.

As you can see at https://github.com/mkoeppe/sage/runs/411989461, with this ticket all "minimal" installs fail with `configure: error: in `/sage':
configure: error: cannot compile a simple Fortran program`.



---

archive/issue_comments_454883.json:
```json
{
    "body": "Changed reviewer from **Isuru Fernando** to **Isuru Fernando, Matthias Koeppe**",
    "created_at": "2020-01-28T01:29:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454883",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Isuru Fernando** to **Isuru Fernando, Matthias Koeppe**



---

archive/issue_comments_454884.json:
```json
{
    "body": "Changed commit from **[`2be2905`](https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54)** to **[`d2b5e13`](https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe)**",
    "created_at": "2020-01-28T05:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454884",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2be2905`](https://github.com/sagemath/sagetrac-mirror/commit/2be29056cf55bd19730fffdb69a6814885bc9c54)** to **[`d2b5e13`](https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe)**



---

archive/issue_comments_454885.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe\"><code>d2b5e13</code></a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>\n",
    "created_at": "2020-01-28T05:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454885",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe"><code>d2b5e13</code></a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>




---

archive/issue_comments_454886.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@mkoeppe](#comment:63):\n> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n\nFixed in d2b5e13.",
    "created_at": "2020-01-28T05:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454886",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@mkoeppe](#comment:63):
> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 

Fixed in d2b5e13.



---

archive/issue_comments_454887.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nTests see https://github.com/mkoeppe/sage/runs/412256169",
    "created_at": "2020-01-28T06:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454887",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">comment:67</div>

Tests see https://github.com/mkoeppe/sage/runs/412256169



---

archive/issue_comments_454888.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@mkoeppe](#comment:63):\n> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n> \n> After all, sage-the-distribution has a mechanism to install `gfortran` itself. We shouldn't break that.\n> \n> As you can see at https://github.com/mkoeppe/sage/runs/411989461, with this ticket all \"minimal\" installs fail with `configure: error: in `/sage':\n> configure: error: cannot compile a simple Fortran program`.\n> \n\noops, I see, I only tested with `./configure --without-system-gfortran` - which worked just fine :-)",
    "created_at": "2020-01-28T08:37:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454888",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@mkoeppe](#comment:63):
> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 
> 
> After all, sage-the-distribution has a mechanism to install `gfortran` itself. We shouldn't break that.
> 
> As you can see at https://github.com/mkoeppe/sage/runs/411989461, with this ticket all "minimal" installs fail with `configure: error: in `/sage':
> configure: error: cannot compile a simple Fortran program`.
> 

oops, I see, I only tested with `./configure --without-system-gfortran` - which worked just fine :-)



---

archive/issue_comments_454889.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\n\n```\n+       if test \"$SAGE_HAVE_FC_FREEFORM\" = yes ; then dnl Have a suitable Fortran compiler\n```\n\ncould we please stick to `AS_IF` ?",
    "created_at": "2020-01-28T08:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454889",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:69" align="right">comment:69</div>


```
+       if test "$SAGE_HAVE_FC_FREEFORM" = yes ; then dnl Have a suitable Fortran compiler
```

could we please stick to `AS_IF` ?



---

archive/issue_comments_454890.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@sagetrac-git](#comment:65):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe\"><code>d2b5e13</code></a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>\n\nthis has broken recognition of gfortran on Debian 10.\n\nprobably cause arguments were shuffled around...",
    "created_at": "2020-01-28T11:18:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454890",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@sagetrac-git](#comment:65):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe"><code>d2b5e13</code></a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>

this has broken recognition of gfortran on Debian 10.

probably cause arguments were shuffled around...



---

archive/issue_events_401521.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T11:18:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401521"
}
```



---

archive/issue_events_401522.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T11:18:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401522"
}
```



---

archive/issue_comments_454891.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nI also don't get\n\n```\n+      # We already checked (in the initial portion of configure.ac)\n+      # whether the Fortran compiler accepts free-format source code (as\n```\nIMHO there is nothing either in configure.ac or build/pkgs/gcc/spkg-configure.m4 that\ndoes any Fortran checks.",
    "created_at": "2020-01-28T11:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454891",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:72" align="right">comment:72</div>

I also don't get

```
+      # We already checked (in the initial portion of configure.ac)
+      # whether the Fortran compiler accepts free-format source code (as
```
IMHO there is nothing either in configure.ac or build/pkgs/gcc/spkg-configure.m4 that
does any Fortran checks.



---

archive/issue_comments_454892.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@dimpase](#comment:69):\n> \n> ```\n> +       if test \"$SAGE_HAVE_FC_FREEFORM\" = yes ; then dnl Have a suitable Fortran compiler\n> ```\n> \n> could we please stick to `AS_IF` ?\n\nactually, I don't see the  point of this `if` at all. If we get there then it's already true, as it's inside the check for `gfortran` as a pre-req, in the scope of `SAGE_SPKG_DEPCHECK([gfortran], ...)`.\n`",
    "created_at": "2020-01-28T11:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454892",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@dimpase](#comment:69):
> 
> ```
> +       if test "$SAGE_HAVE_FC_FREEFORM" = yes ; then dnl Have a suitable Fortran compiler
> ```
> 
> could we please stick to `AS_IF` ?

actually, I don't see the  point of this `if` at all. If we get there then it's already true, as it's inside the check for `gfortran` as a pre-req, in the scope of `SAGE_SPKG_DEPCHECK([gfortran], ...)`.
`



---

archive/issue_comments_454893.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nThe trouble is in `AC_FC_FUNC()`, which throws a fit if there is no Fortran compiler around, instead of just suffering in silence.",
    "created_at": "2020-01-28T12:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454893",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:74" align="right">comment:74</div>

The trouble is in `AC_FC_FUNC()`, which throws a fit if there is no Fortran compiler around, instead of just suffering in silence.



---

archive/issue_comments_454894.json:
```json
{
    "body": "<div id=\"comment:75\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cf2a3bb8feb5524daf4be93f0434c3b383a1c1d\"><code>8cf2a3b</code></a></td><td><code>configure.ac: Check some FC properties earlier</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7\"><code>c98c6b2</code></a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>\n",
    "created_at": "2020-01-28T12:29:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454894",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:75"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cf2a3bb8feb5524daf4be93f0434c3b383a1c1d"><code>8cf2a3b</code></a></td><td><code>configure.ac: Check some FC properties earlier</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7"><code>c98c6b2</code></a></td><td><code>configure.ac, build/pkgs/{openblas,gfortran}: Do not fail if there is no FC</code></td></tr></table>




---

archive/issue_comments_454895.json:
```json
{
    "body": "Changed commit from **[`d2b5e13`](https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe)** to **[`c98c6b2`](https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7)**",
    "created_at": "2020-01-28T12:29:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454895",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d2b5e13`](https://github.com/sagemath/sagetrac-mirror/commit/d2b5e139875c8769d1b0dca0cc05512df3cdfcbe)** to **[`c98c6b2`](https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7)**



---

archive/issue_comments_454896.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nReplying to [@dimpase](#comment:72):\n> I also don't get\n> \n> ```\n> +      # We already checked (in the initial portion of configure.ac)\n> +      # whether the Fortran compiler accepts free-format source code (as\n> ```\n> IMHO there is nothing either in configure.ac or build/pkgs/gcc/spkg-configure.m4 that\n> does any Fortran checks.\n\nSorry, I forgot to include one commit on this branch.\nFixed.",
    "created_at": "2020-01-28T12:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454896",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">comment:76</div>

Replying to [@dimpase](#comment:72):
> I also don't get
> 
> ```
> +      # We already checked (in the initial portion of configure.ac)
> +      # whether the Fortran compiler accepts free-format source code (as
> ```
> IMHO there is nothing either in configure.ac or build/pkgs/gcc/spkg-configure.m4 that
> does any Fortran checks.

Sorry, I forgot to include one commit on this branch.
Fixed.



---

archive/issue_comments_454897.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@dimpase](#comment:74):\n> The trouble is in `AC_FC_FUNC()`, which throws a fit if there is no Fortran compiler around, instead of just suffering in silence. \n\nYes, exactly, and more specifically: Because of AC_REQUIRE and AC_DEFUN_ONCE one cannot easily make all things conditional that one would liike.",
    "created_at": "2020-01-28T12:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454897",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@dimpase](#comment:74):
> The trouble is in `AC_FC_FUNC()`, which throws a fit if there is no Fortran compiler around, instead of just suffering in silence. 

Yes, exactly, and more specifically: Because of AC_REQUIRE and AC_DEFUN_ONCE one cannot easily make all things conditional that one would liike.



---

archive/issue_comments_454898.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@dimpase](#comment:73):\n> Replying to [@dimpase](#comment:69):\n> > \n> > ```\n> > +       if test \"$SAGE_HAVE_FC_FREEFORM\" = yes ; then dnl Have a suitable Fortran compiler\n> > ```\n> > \n> > could we please stick to `AS_IF` ?\n\nNo, they are unfortunately not equivalent because of autoconf's AC_PREREQ/AC_DEFUN_ONCE magic.",
    "created_at": "2020-01-28T12:34:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454898",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@dimpase](#comment:73):
> Replying to [@dimpase](#comment:69):
> > 
> > ```
> > +       if test "$SAGE_HAVE_FC_FREEFORM" = yes ; then dnl Have a suitable Fortran compiler
> > ```
> > 
> > could we please stick to `AS_IF` ?

No, they are unfortunately not equivalent because of autoconf's AC_PREREQ/AC_DEFUN_ONCE magic.



---

archive/issue_comments_454899.json:
```json
{
    "body": "<div id=\"comment:79\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39a317ddf2dae9400ddf339e5988cab71b57bdbc\"><code>39a317d</code></a></td><td><code>install cblas.pc and lapack.pc links conditionally</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7adc71201980fdd5e828f2c69a1e03881d87fcfd\"><code>7adc712</code></a></td><td><code>use AC_SEARCH_LIBS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abda83ec30302dde4368029ae0cc9de581da36ea\"><code>abda83e</code></a></td><td><code>added missing module names - cblas and lapack</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/683a926bb67d90832711ba64be1446dbe0463ea0\"><code>683a926</code></a></td><td><code>make installing *.pc files conditional</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0acbcb1a199e5b9795dd126756288869e86e09a\"><code>a0acbcb</code></a></td><td><code>correct quoting of m4 index variable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ee6844ebc67fa43f4a1d6a502e90ed8751b0889\"><code>5ee6844</code></a></td><td><code>ensure gfortran is available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2\"><code>56541ae</code></a></td><td><code>wrap AC_FC_FUNC so that it does not throw an error without Fortran</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd\"><code>3a4524e</code></a></td><td><code>Merge remote-tracking branch 'trac/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' into openblaspcfix</code></td></tr></table>\n",
    "created_at": "2020-01-28T12:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454899",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:79"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39a317ddf2dae9400ddf339e5988cab71b57bdbc"><code>39a317d</code></a></td><td><code>install cblas.pc and lapack.pc links conditionally</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7adc71201980fdd5e828f2c69a1e03881d87fcfd"><code>7adc712</code></a></td><td><code>use AC_SEARCH_LIBS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abda83ec30302dde4368029ae0cc9de581da36ea"><code>abda83e</code></a></td><td><code>added missing module names - cblas and lapack</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/683a926bb67d90832711ba64be1446dbe0463ea0"><code>683a926</code></a></td><td><code>make installing *.pc files conditional</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0acbcb1a199e5b9795dd126756288869e86e09a"><code>a0acbcb</code></a></td><td><code>correct quoting of m4 index variable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ee6844ebc67fa43f4a1d6a502e90ed8751b0889"><code>5ee6844</code></a></td><td><code>ensure gfortran is available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2"><code>56541ae</code></a></td><td><code>wrap AC_FC_FUNC so that it does not throw an error without Fortran</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd"><code>3a4524e</code></a></td><td><code>Merge remote-tracking branch 'trac/public/packages/numpy/no_DEFAULT_and_ALL_numpy_site_cfg' into openblaspcfix</code></td></tr></table>




---

archive/issue_comments_454900.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/openblaspcfix)** to **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)**",
    "created_at": "2020-01-28T12:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454900",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/mkoeppe/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/packages/openblaspcfix)** to **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)**



---

archive/issue_comments_454901.json:
```json
{
    "body": "Changed commit from **[`c98c6b2`](https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7)** to **[`3a4524e`](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**",
    "created_at": "2020-01-28T12:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454901",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`c98c6b2`](https://github.com/sagemath/sagetrac-mirror/commit/c98c6b2c3d95119445975e45c3e5d4ad2ce586f7)** to **[`3a4524e`](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**



---

archive/issue_events_401523.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T12:37:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401523"
}
```



---

archive/issue_events_401524.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-28T12:37:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401524"
}
```



---

archive/issue_comments_454902.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nReplying to [@mkoeppe](#comment:63):\n> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n\nFixed by `wrap AC_FC_FUNC so that it does not throw an error without Fortran`: [56541ae](https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2)",
    "created_at": "2020-01-28T12:40:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454902",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:80" align="right">comment:80</div>

Replying to [@mkoeppe](#comment:63):
> I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 

Fixed by `wrap AC_FC_FUNC so that it does not throw an error without Fortran`: [56541ae](https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2)



---

archive/issue_comments_454903.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nIMHO it's an autoconf bug/feature that `AC_FC_FUNC` errors out without Fortran, while e.g. `AC_FC_FREEFORM` does not.",
    "created_at": "2020-01-28T12:44:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454903",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:81" align="right">comment:81</div>

IMHO it's an autoconf bug/feature that `AC_FC_FUNC` errors out without Fortran, while e.g. `AC_FC_FREEFORM` does not.



---

archive/issue_comments_454904.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nReplying to [@dimpase](#comment:81):\n> IMHO it's an autoconf bug/feature that `AC_FC_FUNC` errors out without Fortran, while e.g. `AC_FC_FREEFORM` does not.\n\nYes, I agree.",
    "created_at": "2020-01-28T13:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454904",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">comment:82</div>

Replying to [@dimpase](#comment:81):
> IMHO it's an autoconf bug/feature that `AC_FC_FUNC` errors out without Fortran, while e.g. `AC_FC_FREEFORM` does not.

Yes, I agree.



---

archive/issue_comments_454905.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nReplying to [@dimpase](#comment:80):\n> Replying to [@mkoeppe](#comment:63):\n> > I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. \n\n> \n> Fixed by `wrap AC_FC_FUNC so that it does not throw an error without Fortran`: [56541ae](https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2)\n\nGreat, a much easier fix than what I put together in \u200b8cf2a3b/\u200bc98c6b2.  \nTesting at https://github.com/mkoeppe/sage/actions/runs/32186055",
    "created_at": "2020-01-28T13:26:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454905",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:83" align="right">comment:83</div>

Replying to [@dimpase](#comment:80):
> Replying to [@mkoeppe](#comment:63):
> > I don't like the idea of requiring a Fortran compiler to even run `./configure` successfully. 

> 
> Fixed by `wrap AC_FC_FUNC so that it does not throw an error without Fortran`: [56541ae](https://github.com/sagemath/sagetrac-mirror/commit/56541ae443c5cffaf5d943694c37f3b4afb5bca2)

Great, a much easier fix than what I put together in 8cf2a3b/c98c6b2.  
Testing at https://github.com/mkoeppe/sage/actions/runs/32186055



---

archive/issue_comments_454906.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nTests finished at https://github.com/mkoeppe/sage/actions/runs/32186055",
    "created_at": "2020-01-28T16:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454906",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:84" align="right">comment:84</div>

Tests finished at https://github.com/mkoeppe/sage/actions/runs/32186055



---

archive/issue_comments_454907.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nLooking good, and certainly fixes what was original reported on this ticket (fflas_ffpack on archlinux). The build error of fflas_ffpack on `debian-jessie-standard` (https://github.com/mkoeppe/sage/runs/412891766) is unrelated. It is good on all other configurations.",
    "created_at": "2020-01-28T16:22:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454907",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">comment:85</div>

Looking good, and certainly fixes what was original reported on this ticket (fflas_ffpack on archlinux). The build error of fflas_ffpack on `debian-jessie-standard` (https://github.com/mkoeppe/sage/runs/412891766) is unrelated. It is good on all other configurations.



---

archive/issue_events_401525.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T16:22:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401525"
}
```



---

archive/issue_events_401526.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-28T16:22:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401526"
}
```



---

archive/issue_comments_454908.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)** to **[`3a4524e`](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**",
    "created_at": "2020-01-31T23:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29071#issuecomment-454908",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/packages/openblaspcfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblaspcfix)** to **[`3a4524e`](https://github.com/sagemath/sagetrac-mirror/commit/3a4524e4c82840fb023a0fd2af83d0a1c65292cd)**



---

archive/issue_events_401527.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-31T23:49:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401527"
}
```



---

archive/issue_events_401528.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2c207ead2b50c79e9acdb2d0f4bb282927c5c20a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-01-31T23:49:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29071",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29071#event-401528"
}
```
