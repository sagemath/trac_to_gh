# Issue 29054: polymake: Add system package lists for Perl prereqs

archive/issues_028817.json:
```json
{
    "body": "We add the lists of system packages providing polymake's Perl prerequisites \nso that `./configure` will include them in the list of suggested packages.\n\nAt least for the distributions that provide these packages, this is more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`.\n\nThis is achieved by adding them in `distros/` of a new script package `perl_cpan_polymake_prereq` (a new dependency of `polymake`) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails. \n\n(See also the more ambitious #27763, which will not be ready for 9.1.)\n\n\n\nCC:  @dimpase @jhpalmieri @jplab @antonio-rojas @isuruf @videlec\n\nBranch/Commit: 9de47089141f6eed6a2c5a8725778aec6f924ab4\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29054\n\n",
    "closed_at": "2020-04-16T22:33:27Z",
    "created_at": "2020-01-20T15:10:27Z",
    "labels": [
        "component: packages: experimental"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "polymake: Add system package lists for Perl prereqs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29054",
    "user": "https://github.com/mkoeppe"
}
```
We add the lists of system packages providing polymake's Perl prerequisites 
so that `./configure` will include them in the list of suggested packages.

At least for the distributions that provide these packages, this is more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`.

This is achieved by adding them in `distros/` of a new script package `perl_cpan_polymake_prereq` (a new dependency of `polymake`) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails. 

(See also the more ambitious #27763, which will not be ready for 9.1.)



CC:  @dimpase @jhpalmieri @jplab @antonio-rojas @isuruf @videlec

Branch/Commit: 9de47089141f6eed6a2c5a8725778aec6f924ab4

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29054





---

archive/issue_comments_565505.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/polymake__make_it_an_error_at_sage___configure_time_if_perl_prerequisites_are_missing\"",
    "created_at": "2020-03-17T03:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565505",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/polymake__make_it_an_error_at_sage___configure_time_if_perl_prerequisites_are_missing"



---

archive/issue_comments_565506.json:
```json
{
    "body": "<a id='comment:2'></a>Is this ready for review? Some comments, in any case: when I use this on OS X, `perl_cpan_polymake_prereq` fails to build, and its log file says:\n\n```\n.../sage-9.1.beta7/build/bin/sage-logger: line 91: .../sage-9.1.beta7/build/pkgs/perl_cpan_polymake_prereq/spkg-install: Permission denied\n```\nA key point is that it doesn't have a line matching the regular expression `^Error`, so I see this:\n\n```\nThe following package(s) may have failed to build (not necessarily\nduring this run of 'make polymake'):\n\nIt is safe to delete any log files and build directories, but they\ncontain information that is helpful for debugging build problems.\nWARNING: If you now run 'make' again, the build directory of the\nsame version of the package will, by default, be deleted. Set the\nenvironment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.\n```\nI assume you're going to make `spkg-install` fail with a meaningful error message?\n\n---\nNew commits:",
    "created_at": "2020-03-24T17:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565506",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>Is this ready for review? Some comments, in any case: when I use this on OS X, `perl_cpan_polymake_prereq` fails to build, and its log file says:

```
.../sage-9.1.beta7/build/bin/sage-logger: line 91: .../sage-9.1.beta7/build/pkgs/perl_cpan_polymake_prereq/spkg-install: Permission denied
```
A key point is that it doesn't have a line matching the regular expression `^Error`, so I see this:

```
The following package(s) may have failed to build (not necessarily
during this run of 'make polymake'):

It is safe to delete any log files and build directories, but they
contain information that is helpful for debugging build problems.
WARNING: If you now run 'make' again, the build directory of the
same version of the package will, by default, be deleted. Set the
environment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.
```
I assume you're going to make `spkg-install` fail with a meaningful error message?

---
New commits:



---

archive/issue_comments_565507.json:
```json
{
    "body": "Changing commit from \"\" to \"12c2b2a793fda45f1df9c4522bd5f8c6ce04fa5a\"",
    "created_at": "2020-03-24T17:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565507",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "" to "12c2b2a793fda45f1df9c4522bd5f8c6ce04fa5a"



---

archive/issue_comments_565508.json:
```json
{
    "body": "<a id='comment:3'></a>Thanks for the feedback. This ticket is not ready for review.\n\nWhat it is missing (the same applies to the \"libnauty\" business on #27952) is a way for optional packages to signal configure-time errors ONLY if they are configured to be installed. \n\nThis is trickier than it sounds because optional packages may be dependencies of other optional packages.\n(See also #29363\tAt the end of configure, indicate which optional/experimental packages are configured to be installed)",
    "created_at": "2020-03-24T17:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565508",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Thanks for the feedback. This ticket is not ready for review.

What it is missing (the same applies to the "libnauty" business on #27952) is a way for optional packages to signal configure-time errors ONLY if they are configured to be installed. 

This is trickier than it sounds because optional packages may be dependencies of other optional packages.
(See also #29363	At the end of configure, indicate which optional/experimental packages are configured to be installed)



---

archive/issue_comments_565509.json:
```json
{
    "body": "<a id='comment:4'></a>See also - #29498\tDo not check for system packages of disabled optional packages",
    "created_at": "2020-04-12T21:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565509",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>See also - #29498	Do not check for system packages of disabled optional packages



---

archive/issue_comments_565510.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-14T02:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_565511.json:
```json
{
    "body": "Changing commit from \"12c2b2a793fda45f1df9c4522bd5f8c6ce04fa5a\" to \"e6b8e8092a47e960b7b565bf47f2f7afb05e5e7e\"",
    "created_at": "2020-04-14T02:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "12c2b2a793fda45f1df9c4522bd5f8c6ce04fa5a" to "e6b8e8092a47e960b7b565bf47f2f7afb05e5e7e"



---

archive/issue_comments_565512.json:
```json
{
    "body": "<a id='comment:6'></a>`+# known correct on Fedora 23` is a blast from the past. The names are still the same on Fedora 30.",
    "created_at": "2020-04-14T02:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565512",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>`+# known correct on Fedora 23` is a blast from the past. The names are still the same on Fedora 30.



---

archive/issue_comments_565513.json:
```json
{
    "body": "Changing commit from \"e6b8e8092a47e960b7b565bf47f2f7afb05e5e7e\" to \"41839e98ba24c75e2d3daf6b0d9c45b69cc77900\"",
    "created_at": "2020-04-14T02:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565513",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e6b8e8092a47e960b7b565bf47f2f7afb05e5e7e" to "41839e98ba24c75e2d3daf6b0d9c45b69cc77900"



---

archive/issue_comments_565514.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-14T02:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_565515.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-14T02:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_565516.json:
```json
{
    "body": "Changing commit from \"41839e98ba24c75e2d3daf6b0d9c45b69cc77900\" to \"d4d832dc4f5fa3eee0d7ddf6ecac9717f1a17a9a\"",
    "created_at": "2020-04-14T02:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "41839e98ba24c75e2d3daf6b0d9c45b69cc77900" to "d4d832dc4f5fa3eee0d7ddf6ecac9717f1a17a9a"



---

archive/issue_comments_565517.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n We do this by adding a script package `perl_cpan_polymake_prereq` (see #27763) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails.\n \n Simpler than #27763 and more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`\n+\n+We also add lists of system packages in `distros/`.\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-04-14T02:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565517",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
 We do this by adding a script package `perl_cpan_polymake_prereq` (see #27763) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails.
 
 Simpler than #27763 and more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`
+
+We also add lists of system packages in `distros/`.
+
 
 Comment: 1
 
``````




---

archive/issue_comments_565518.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+We add the lists of system packages in `distros/` of a new script package `perl_cpan_polymake_prereq` (a new dependency of `polymake`) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails.\n+\n+Simpler than #27763 and more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2020-04-14T05:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565518",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
+We add the lists of system packages in `distros/` of a new script package `perl_cpan_polymake_prereq` (a new dependency of `polymake`) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails.
+
+Simpler than #27763 and more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`
+
 
 
 Comment: 1
``````




---

archive/issue_comments_565519.json:
```json
{
    "body": "Changing commit from \"d4d832dc4f5fa3eee0d7ddf6ecac9717f1a17a9a\" to \"18f135259e8738e23e684529d253a2168435272f\"",
    "created_at": "2020-04-14T05:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565519",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d4d832dc4f5fa3eee0d7ddf6ecac9717f1a17a9a" to "18f135259e8738e23e684529d253a2168435272f"



---

archive/issue_comments_565520.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-14T05:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_565521.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-14T05:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565521",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_565522.json:
```json
{
    "body": "Changing commit from \"18f135259e8738e23e684529d253a2168435272f\" to \"9de47089141f6eed6a2c5a8725778aec6f924ab4\"",
    "created_at": "2020-04-14T05:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565522",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "18f135259e8738e23e684529d253a2168435272f" to "9de47089141f6eed6a2c5a8725778aec6f924ab4"



---

archive/issue_comments_565523.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-04-14T05:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565523",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_565524.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-14T05:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565524",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_565525.json:
```json
{
    "body": "<a id='comment:16'></a>without the description on #27763 it's a bit unclear what this is meant to do.",
    "created_at": "2020-04-14T06:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565525",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>without the description on #27763 it's a bit unclear what this is meant to do.



---

archive/issue_comments_565526.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+We add the lists of system packages providing polymake's Perl prerequisites \n+so that `./configure` will include them in the list of suggested packages.\n+\n+At least for the distributions that provide these packages, this is more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`.\n+\n+This is achieved by adding them in `distros/` of a new script package `perl_cpan_polymake_prereq` (a new dependency of `polymake`) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails. \n+\n+(See also the more ambitious #27763, which will not be ready for 9.1.)\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2020-04-14T06:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565526",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,12 @@
+We add the lists of system packages providing polymake's Perl prerequisites 
+so that `./configure` will include them in the list of suggested packages.
+
+At least for the distributions that provide these packages, this is more reliable than depending on users reading `build/pkgs/polymake/SPKG.txt`.
+
+This is achieved by adding them in `distros/` of a new script package `perl_cpan_polymake_prereq` (a new dependency of `polymake`) with an `spkg-configure.m4` that checks for the prerequisites and an `spkg-install` that always fails. 
+
+(See also the more ambitious #27763, which will not be ready for 9.1.)
+
 
 
 Comment: 1
``````




---

archive/issue_comments_565527.json:
```json
{
    "body": "<a id='comment:18'></a>lgtm",
    "created_at": "2020-04-14T06:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565527",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>lgtm



---

archive/issue_comments_565528.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2020-04-14T06:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565528",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_565529.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-14T06:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565529",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_565530.json:
```json
{
    "body": "<a id='comment:19'></a>Thanks!",
    "created_at": "2020-04-14T06:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565530",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Thanks!



---

archive/issue_comments_565531.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-16T22:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565531",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_073647.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-16T22:33:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29054#event-73647"
}
```



---

archive/issue_comments_565532.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/polymake__make_it_an_error_at_sage___configure_time_if_perl_prerequisites_are_missing\" to \"9de47089141f6eed6a2c5a8725778aec6f924ab4\"",
    "created_at": "2020-04-16T22:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29054#issuecomment-565532",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/polymake__make_it_an_error_at_sage___configure_time_if_perl_prerequisites_are_missing" to "9de47089141f6eed6a2c5a8725778aec6f924ab4"
