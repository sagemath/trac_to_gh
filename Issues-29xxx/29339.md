# Issue 29339: Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS

archive/issues_029102.json:
```json
{
    "assignees": [],
    "body": "... such as homebrew's NTL (#29104).\n\nBuilds with NTL_THREADS breaks Singular (as observed in #29104).\n\nIn fact, as of the NTL upgrade ticket #20590, we build the NTL SPKG with NTL_THREADS=off. (On that ticket, it was noted \"we cannot take advantage of the threading until a number of things are resolved. Threading requires C++11 and a number of packages are behind the curve.\")\n\nIn a follow-up ticket we may consider issuing a warning if NTL is configured without NTL_GMP_LIP, without NTL_GF2X_LIB, which may lead to a performance degradation.\n\n\n\n**CC:**  @dimpase @kiwifb @mwageringel @jhpalmieri jpflori\n\n**Branch:** [u/mkoeppe/fix_ntl_spkg_configure_m4_so_it_rejects_ntls_built_with_ntl_threads__without_ntl_gmp_lip__without_ntl_gf2x_lib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_ntl_spkg_configure_m4_so_it_rejects_ntls_built_with_ntl_threads__without_ntl_gmp_lip__without_ntl_gf2x_lib)\n\n**Commit:** [c3bc092ba9e7bea69092085b65231212f0367f6d](https://github.com/sagemath/sagetrac-mirror/commit/c3bc092ba9e7bea69092085b65231212f0367f6d)\n\n**Reviewer:** Dima Pasechnik\n\nIssue created by migration from https://trac.sagemath.org/ticket/29339\n\n",
    "closed_at": "2021-06-13T06:40:58Z",
    "created_at": "2020-03-15T16:25:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS",
    "type": "issue",
    "updated_at": "2021-06-13T06:40:58Z",
    "url": "https://github.com/sagemath/sage/issues/29339",
    "user": "https://github.com/mkoeppe"
}
```
... such as homebrew's NTL (#29104).

Builds with NTL_THREADS breaks Singular (as observed in #29104).

In fact, as of the NTL upgrade ticket #20590, we build the NTL SPKG with NTL_THREADS=off. (On that ticket, it was noted "we cannot take advantage of the threading until a number of things are resolved. Threading requires C++11 and a number of packages are behind the curve.")

In a follow-up ticket we may consider issuing a warning if NTL is configured without NTL_GMP_LIP, without NTL_GF2X_LIB, which may lead to a performance degradation.



**CC:**  @dimpase @kiwifb @mwageringel @jhpalmieri jpflori

**Branch:** [u/mkoeppe/fix_ntl_spkg_configure_m4_so_it_rejects_ntls_built_with_ntl_threads__without_ntl_gmp_lip__without_ntl_gf2x_lib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_ntl_spkg_configure_m4_so_it_rejects_ntls_built_with_ntl_threads__without_ntl_gmp_lip__without_ntl_gf2x_lib)

**Commit:** [c3bc092ba9e7bea69092085b65231212f0367f6d](https://github.com/sagemath/sagetrac-mirror/commit/c3bc092ba9e7bea69092085b65231212f0367f6d)

**Reviewer:** Dima Pasechnik

Issue created by migration from https://trac.sagemath.org/ticket/29339





---

archive/issue_comments_463013.json:
```json
{
    "body": "<a id='comment:1'></a>\nthe wise thing is to enable TLS as much as possible, IMHO. The configuration with enabled TLS on NTL, pari, and flint used to work, IIRC.",
    "created_at": "2020-03-15T16:40:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463013",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
the wise thing is to enable TLS as much as possible, IMHO. The configuration with enabled TLS on NTL, pari, and flint used to work, IIRC.



---

archive/issue_comments_463014.json:
```json
{
    "body": "<a id='comment:2'></a>\nI also don't think gf2x should be a hard requirement. It is entirely optional for NTL.",
    "created_at": "2020-03-15T16:43:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463014",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
I also don't think gf2x should be a hard requirement. It is entirely optional for NTL.



---

archive/issue_comments_463015.json:
```json
{
    "body": "<a id='comment:3'></a>\nDo you mean NTL_TLS_HACK?",
    "created_at": "2020-03-15T17:50:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463015",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Do you mean NTL_TLS_HACK?



---

archive/issue_comments_463016.json:
```json
{
    "body": "<a id='comment:4'></a>\nhomebrew's NTL is configured with `NTL_TLS_HACK` and `NTL_THREADS`, and I am getting the reported error with Singular.\nWhat do you suggest?",
    "created_at": "2020-03-15T17:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463016",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
homebrew's NTL is configured with `NTL_TLS_HACK` and `NTL_THREADS`, and I am getting the reported error with Singular.
What do you suggest?



---

archive/issue_comments_463017.json:
```json
{
    "body": "<a id='comment:5'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/56215147",
    "created_at": "2020-03-15T17:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463017",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/56215147



---

archive/issue_comments_463018.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,6 +2,8 @@\n \n Builds with NTL_THREADS breaks Singular (as observed in #29104).\n \n+In fact, as of the NTL upgrade ticket #20590, we build the NTL SPKG with NTL_THREADS=off. (On that ticket, it was noted \"we cannot take advantage of the threading until a number of things are resolved. Threading requires C++11 and a number of packages are behind the curve.\")\n+\n The other checks are about performance degradation that we should not accept.\n \n \n``````\n",
    "created_at": "2020-03-15T18:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463018",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,6 +2,8 @@
 
 Builds with NTL_THREADS breaks Singular (as observed in #29104).
 
+In fact, as of the NTL upgrade ticket #20590, we build the NTL SPKG with NTL_THREADS=off. (On that ticket, it was noted "we cannot take advantage of the threading until a number of things are resolved. Threading requires C++11 and a number of packages are behind the curve.")
+
 The other checks are about performance degradation that we should not accept.
 
 
``````




---

archive/issue_comments_463019.json:
```json
{
    "body": "<a id='comment:7'></a>\nsee #27764",
    "created_at": "2020-03-15T18:13:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463019",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
see #27764



---

archive/issue_comments_463020.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/fix_ntl_spkg_configure_m4_so_it_rejects_ntls_built_with_ntl_threads__without_ntl_gmp_lip__without_ntl_gf2x_lib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_ntl_spkg_configure_m4_so_it_rejects_ntls_built_with_ntl_threads__without_ntl_gmp_lip__without_ntl_gf2x_lib)",
    "created_at": "2020-03-15T22:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463020",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/fix_ntl_spkg_configure_m4_so_it_rejects_ntls_built_with_ntl_threads__without_ntl_gmp_lip__without_ntl_gf2x_lib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_ntl_spkg_configure_m4_so_it_rejects_ntls_built_with_ntl_threads__without_ntl_gmp_lip__without_ntl_gf2x_lib)



---

archive/issue_comments_463021.json:
```json
{
    "body": "**Commit:** [96553db01783fcd6c86e451b0b16b4bcb88140f7](https://github.com/sagemath/sagetrac-mirror/commit/96553db01783fcd6c86e451b0b16b4bcb88140f7)",
    "created_at": "2020-03-15T22:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463021",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [96553db01783fcd6c86e451b0b16b4bcb88140f7](https://github.com/sagemath/sagetrac-mirror/commit/96553db01783fcd6c86e451b0b16b4bcb88140f7)



---

archive/issue_comments_463022.json:
```json
{
    "body": "<a id='comment:9'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96553db01783fcd6c86e451b0b16b4bcb88140f7\">96553db</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Check for NTL configuration</code></td></tr></table>\n",
    "created_at": "2020-03-15T22:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463022",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96553db01783fcd6c86e451b0b16b4bcb88140f7">96553db</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Check for NTL configuration</code></td></tr></table>




---

archive/issue_comments_463023.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-03-15T22:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463023",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_events_261034.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-15T22:53:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261034"
}
```



---

archive/issue_comments_463024.json:
```json
{
    "body": "<a id='comment:10'></a>\nonce again - some distros build NTL without gf2x support, and it results in some deterioration of performance, but this is not something Sage should worry too much. Print a warning if you must.\n\nAfter all, it is by far not the only place where the performance is suboptimal on pre-build installs, untuned for the hardware, say.",
    "created_at": "2020-03-16T06:32:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463024",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
once again - some distros build NTL without gf2x support, and it results in some deterioration of performance, but this is not something Sage should worry too much. Print a warning if you must.

After all, it is by far not the only place where the performance is suboptimal on pre-build installs, untuned for the hardware, say.



---

archive/issue_comments_463025.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,6 +4,6 @@\n \n In fact, as of the NTL upgrade ticket #20590, we build the NTL SPKG with NTL_THREADS=off. (On that ticket, it was noted \"we cannot take advantage of the threading until a number of things are resolved. Threading requires C++11 and a number of packages are behind the curve.\")\n \n-The other checks are about performance degradation that we should not accept.\n+In a follow-up ticket we may consider issuing a warning if NTL is configured without NTL_GMP_LIP, without NTL_GF2X_LIB, which may lead to a performance degradation.\n \n \n``````\n",
    "created_at": "2020-03-16T14:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463025",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,6 +4,6 @@
 
 In fact, as of the NTL upgrade ticket #20590, we build the NTL SPKG with NTL_THREADS=off. (On that ticket, it was noted "we cannot take advantage of the threading until a number of things are resolved. Threading requires C++11 and a number of packages are behind the curve.")
 
-The other checks are about performance degradation that we should not accept.
+In a follow-up ticket we may consider issuing a warning if NTL is configured without NTL_GMP_LIP, without NTL_GF2X_LIB, which may lead to a performance degradation.
 
 
``````




---

archive/issue_events_261035.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-16T14:54:13Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "rename": {
        "from": "Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS, without NTL_GMP_LIP, without NTL_GF2X_LIB",
        "to": "Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261035"
}
```



---

archive/issue_events_261036.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-16T14:54:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261036"
}
```



---

archive/issue_events_261037.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-16T14:54:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261037"
}
```



---

archive/issue_comments_463026.json:
```json
{
    "body": "**Changing commit** from \"[96553db01783fcd6c86e451b0b16b4bcb88140f7](https://github.com/sagemath/sagetrac-mirror/commit/96553db01783fcd6c86e451b0b16b4bcb88140f7)\" to \"[c3bc092ba9e7bea69092085b65231212f0367f6d](https://github.com/sagemath/sagetrac-mirror/commit/c3bc092ba9e7bea69092085b65231212f0367f6d)\".",
    "created_at": "2020-03-16T14:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463026",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[96553db01783fcd6c86e451b0b16b4bcb88140f7](https://github.com/sagemath/sagetrac-mirror/commit/96553db01783fcd6c86e451b0b16b4bcb88140f7)" to "[c3bc092ba9e7bea69092085b65231212f0367f6d](https://github.com/sagemath/sagetrac-mirror/commit/c3bc092ba9e7bea69092085b65231212f0367f6d)".



---

archive/issue_comments_463027.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3bc092ba9e7bea69092085b65231212f0367f6d\">c3bc092</a></td><td><code>Remove tests for NTL_GMP_LIP, NTL_GF2X_LIB</code></td></tr></table>\n",
    "created_at": "2020-03-16T14:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463027",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3bc092ba9e7bea69092085b65231212f0367f6d">c3bc092</a></td><td><code>Remove tests for NTL_GMP_LIP, NTL_GF2X_LIB</code></td></tr></table>




---

archive/issue_events_261038.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-16T14:55:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261038"
}
```



---

archive/issue_events_261039.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-16T14:55:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261039"
}
```



---

archive/issue_comments_463028.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@dimpase](#comment%3A10):\n> once again - some distros build NTL without gf2x support, and it results in some deterioration of performance, but this is not something Sage should worry too much. Print a warning if you must.\n\nOK, I have removed the tests",
    "created_at": "2020-03-17T17:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463028",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Replying to [@dimpase](#comment%3A10):
> once again - some distros build NTL without gf2x support, and it results in some deterioration of performance, but this is not something Sage should worry too much. Print a warning if you must.

OK, I have removed the tests



---

archive/issue_comments_463029.json:
```json
{
    "body": "<a id='comment:15'></a>\nIMHO also pari/gp is typically built with threads on by distros.\nThis means that TLS is enabled for pari/gp.\n\nWe may end up with having to build all the libs...",
    "created_at": "2020-03-17T17:33:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463029",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
IMHO also pari/gp is typically built with threads on by distros.
This means that TLS is enabled for pari/gp.

We may end up with having to build all the libs...



---

archive/issue_comments_463030.json:
```json
{
    "body": "<a id='comment:16'></a>\nI don't see such problems in my tests",
    "created_at": "2020-03-17T17:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463030",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
I don't see such problems in my tests



---

archive/issue_comments_463031.json:
```json
{
    "body": "<a id='comment:17'></a>\ndo you test with options **forcing** the use of system packages?",
    "created_at": "2020-03-17T18:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463031",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
do you test with options **forcing** the use of system packages?



---

archive/issue_comments_463032.json:
```json
{
    "body": "<a id='comment:18'></a>\nNot recently, will do",
    "created_at": "2020-03-17T18:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463032",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Not recently, will do



---

archive/issue_comments_463033.json:
```json
{
    "body": "<a id='comment:19'></a>\nHowever, you can look for the new messages `configure: Hint: The following SPKGs did not find equivalent system packages`\nsuch as (https://github.com/mkoeppe/sage/runs/512242876) for `ubuntu-focal-standard`:\n\n```\nconfigure: Hint: The following SPKGs did not find equivalent system packages:\nconfigure:   arb cbc cmake eclib fflas_ffpack flint fplll isl libatomic_ops libsemigroups ninja_build ntl perl_term_readline_gnu\nchecking for the package system in use... debian\nconfigure: Hint: Installing the following system packages is recommended and may avoid building some of the above SPKGs from source:\nconfigure:   $ sudo apt-get install libflint-arb-dev coinor-cbc coinor-libcbc-dev cmake libec-dev libflint-dev libisl-dev ninja-build libntl-dev libterm-readline-gnu-perl\nconfigure: After installation, re-run configure using:\nconfigure:   $ ./config.status --recheck && ./config.status\n```",
    "created_at": "2020-03-17T18:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463033",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
However, you can look for the new messages `configure: Hint: The following SPKGs did not find equivalent system packages`
such as (https://github.com/mkoeppe/sage/runs/512242876) for `ubuntu-focal-standard`:

```
configure: Hint: The following SPKGs did not find equivalent system packages:
configure:   arb cbc cmake eclib fflas_ffpack flint fplll isl libatomic_ops libsemigroups ninja_build ntl perl_term_readline_gnu
checking for the package system in use... debian
configure: Hint: Installing the following system packages is recommended and may avoid building some of the above SPKGs from source:
configure:   $ sudo apt-get install libflint-arb-dev coinor-cbc coinor-libcbc-dev cmake libec-dev libflint-dev libisl-dev ninja-build libntl-dev libterm-readline-gnu-perl
configure: After installation, re-run configure using:
configure:   $ ./config.status --recheck && ./config.status
```



---

archive/issue_comments_463034.json:
```json
{
    "body": "<a id='comment:20'></a>\nI think that the threads issue should be handled on per platform basis. If threads are not working on MacOS it does not mean that Sage on Linux should be made single-thread.",
    "created_at": "2020-03-18T01:59:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463034",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
I think that the threads issue should be handled on per platform basis. If threads are not working on MacOS it does not mean that Sage on Linux should be made single-thread.



---

archive/issue_comments_463035.json:
```json
{
    "body": "<a id='comment:21'></a>\nDo you know a platform that actually builds NTL with threads?",
    "created_at": "2020-03-18T02:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463035",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Do you know a platform that actually builds NTL with threads?



---

archive/issue_comments_463036.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [@mkoeppe](#comment%3A21):\n> Do you know a platform that actually builds NTL with threads?\n\nGentoo.",
    "created_at": "2020-03-18T02:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463036",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
Replying to [@mkoeppe](#comment%3A21):
> Do you know a platform that actually builds NTL with threads?

Gentoo.



---

archive/issue_comments_463037.json:
```json
{
    "body": "<a id='comment:23'></a>\nWell, does sage-the-distribution work with Gentoo's NTL?",
    "created_at": "2020-03-18T02:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463037",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Well, does sage-the-distribution work with Gentoo's NTL?



---

archive/issue_comments_463038.json:
```json
{
    "body": "<a id='comment:24'></a>\nyes it does, I think.",
    "created_at": "2020-03-18T02:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463038",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
yes it does, I think.



---

archive/issue_comments_463039.json:
```json
{
    "body": "<a id='comment:25'></a>\nShouldn't there be a ticket that enables NTL threads for Sage-the-distribution then?\nThe NTL upgrade ticket #20590 disabled threads explicitly.\nSo I assume there was a difficulty -- and there is no evidence that it has been resolved.",
    "created_at": "2020-03-18T02:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463039",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Shouldn't there be a ticket that enables NTL threads for Sage-the-distribution then?
The NTL upgrade ticket #20590 disabled threads explicitly.
So I assume there was a difficulty -- and there is no evidence that it has been resolved.



---

archive/issue_comments_463040.json:
```json
{
    "body": "<a id='comment:26'></a>\n4 years ago the Python's single-thread religion still had many followers :-)",
    "created_at": "2020-03-18T02:27:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463040",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>
4 years ago the Python's single-thread religion still had many followers :-)



---

archive/issue_comments_463041.json:
```json
{
    "body": "<a id='comment:27'></a>\nNo, seriously, when our own installation scripts avoid NTL's threads, then I think it is quite appropriate that the spkg-configure checks for that.",
    "created_at": "2020-03-18T02:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463041",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
No, seriously, when our own installation scripts avoid NTL's threads, then I think it is quite appropriate that the spkg-configure checks for that.



---

archive/issue_comments_463042.json:
```json
{
    "body": "<a id='comment:28'></a>\nby the way, Fedora 30 (and on newer Fedoras too) also provides multithreaded NTL, and Sage happily uses it, tests pass.\n\n```\n$ uname -a\nLinux clpc171.cs.ox.ac.uk 5.2.18-200.fc30.x86_64 #1 SMP Tue Oct 1 13:14:07 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\n$ ldd /lib64/libntl.so\n        linux-vdso.so.1 (0x00007ffe9affd000)\n        libgmp.so.10 => /lib64/libgmp.so.10 (0x00007fabe7899000)\n        libgf2x.so.1 => /lib64/libgf2x.so.1 (0x00007fabe7888000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fabe7867000)\n        libstdc++.so.6 => /lib64/libstdc++.so.6 (0x00007fabe766d000)\n        libm.so.6 => /lib64/libm.so.6 (0x00007fabe7527000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007fabe7361000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fabe7c33000)\n        libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fabe7345000)\n```",
    "created_at": "2020-03-18T07:38:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463042",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>
by the way, Fedora 30 (and on newer Fedoras too) also provides multithreaded NTL, and Sage happily uses it, tests pass.

```
$ uname -a
Linux clpc171.cs.ox.ac.uk 5.2.18-200.fc30.x86_64 #1 SMP Tue Oct 1 13:14:07 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
$ ldd /lib64/libntl.so
        linux-vdso.so.1 (0x00007ffe9affd000)
        libgmp.so.10 => /lib64/libgmp.so.10 (0x00007fabe7899000)
        libgf2x.so.1 => /lib64/libgf2x.so.1 (0x00007fabe7888000)
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fabe7867000)
        libstdc++.so.6 => /lib64/libstdc++.so.6 (0x00007fabe766d000)
        libm.so.6 => /lib64/libm.so.6 (0x00007fabe7527000)
        libc.so.6 => /lib64/libc.so.6 (0x00007fabe7361000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fabe7c33000)
        libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fabe7345000)
```



---

archive/issue_comments_463043.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [@mkoeppe](#comment%3A27):\n> No, seriously, when our own installation scripts avoid NTL's threads, then I think it is quite appropriate that the spkg-configure checks for that.\n\nI don't see why. Anyhow, this problem (inability to use multithreaded NTL) seems to be MacOS-only, and probably related to #27764",
    "created_at": "2020-03-18T07:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463043",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>
Replying to [@mkoeppe](#comment%3A27):
> No, seriously, when our own installation scripts avoid NTL's threads, then I think it is quite appropriate that the spkg-configure checks for that.

I don't see why. Anyhow, this problem (inability to use multithreaded NTL) seems to be MacOS-only, and probably related to #27764



---

archive/issue_comments_463044.json:
```json
{
    "body": "<a id='comment:30'></a>\nWe historically had an issue before defaulting to C++11 but we should be able to move ahead in my opinion. I am expecting distros to all be threaded at this stage. It is just a matter of testing the insane number of corner cases.",
    "created_at": "2020-03-18T07:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463044",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
We historically had an issue before defaulting to C++11 but we should be able to move ahead in my opinion. I am expecting distros to all be threaded at this stage. It is just a matter of testing the insane number of corner cases.



---

archive/issue_comments_463045.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [@kiwifb](#comment%3A30):\n> We historically had an issue before defaulting to C++11 but we should be able to move ahead in my opinion. I am expecting distros to all be threaded at this stage. It is just a matter of testing the insane number of corner cases.\n\nit seems to be that Debian is not providing multithreaded NTL (and the related libs, such as Flint, are single-threaded too).",
    "created_at": "2020-03-18T08:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463045",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
Replying to [@kiwifb](#comment%3A30):
> We historically had an issue before defaulting to C++11 but we should be able to move ahead in my opinion. I am expecting distros to all be threaded at this stage. It is just a matter of testing the insane number of corner cases.

it seems to be that Debian is not providing multithreaded NTL (and the related libs, such as Flint, are single-threaded too).



---

archive/issue_comments_463046.json:
```json
{
    "body": "<a id='comment:32'></a>\nFor what it is worth, on macOS 10.13.6, Homebrew's NTL works for me without any problems. I last checked with a clean build of 9.1.beta4 and ptestlong passed.",
    "created_at": "2020-03-18T08:10:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463046",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:32'></a>
For what it is worth, on macOS 10.13.6, Homebrew's NTL works for me without any problems. I last checked with a clean build of 9.1.beta4 and ptestlong passed.



---

archive/issue_comments_463047.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [@kiwifb](#comment%3A30):\n> We historically had an issue before defaulting to C++11 but we should be able to move ahead in my opinion. I am expecting distros to all be threaded at this stage. It is just a matter of testing the insane number of corner cases.\n\nI have created ticket #29340 (Enable threads in NTL) for that, in case someone would like to work on it.",
    "created_at": "2020-03-18T16:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463047",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Replying to [@kiwifb](#comment%3A30):
> We historically had an issue before defaulting to C++11 but we should be able to move ahead in my opinion. I am expecting distros to all be threaded at this stage. It is just a matter of testing the insane number of corner cases.

I have created ticket #29340 (Enable threads in NTL) for that, in case someone would like to work on it.



---

archive/issue_comments_463048.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [@dimpase](#comment%3A29):\n> Replying to [@mkoeppe](#comment%3A27):\n> > No, seriously, when our own installation scripts avoid NTL's threads, then I think it is quite appropriate that the spkg-configure checks for that.\n\n> \n> I don't see why. Anyhow, this problem (inability to use multithreaded NTL) seems to be MacOS-only, and probably related to #27764\n\n#27764 does not fix the problem on macOS, I've already tested that",
    "created_at": "2020-03-18T16:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463048",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
Replying to [@dimpase](#comment%3A29):
> Replying to [@mkoeppe](#comment%3A27):
> > No, seriously, when our own installation scripts avoid NTL's threads, then I think it is quite appropriate that the spkg-configure checks for that.

> 
> I don't see why. Anyhow, this problem (inability to use multithreaded NTL) seems to be MacOS-only, and probably related to #27764

#27764 does not fix the problem on macOS, I've already tested that



---

archive/issue_events_261040.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T16:12:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261040"
}
```



---

archive/issue_events_261041.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T16:12:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261041"
}
```



---

archive/issue_comments_463049.json:
```json
{
    "body": "<a id='comment:35'></a>\nSee #29366 (arch)",
    "created_at": "2020-03-19T16:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463049",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
See #29366 (arch)



---

archive/issue_events_261042.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-05T17:58:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261042"
}
```



---

archive/issue_events_261043.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-05T17:58:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261043"
}
```



---

archive/issue_events_261044.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261044"
}
```



---

archive/issue_events_261045.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261045"
}
```



---

archive/issue_comments_463050.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"\".",
    "created_at": "2021-02-03T02:07:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463050",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "".



---

archive/issue_events_261046.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-03T02:07:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261046"
}
```



---

archive/issue_events_261047.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-03T02:07:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261047"
}
```



---

archive/issue_comments_463051.json:
```json
{
    "body": "<a id='comment:38'></a>\nI think this is no longer needed",
    "created_at": "2021-02-03T02:07:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463051",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
I think this is no longer needed



---

archive/issue_events_261048.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-03T02:07:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261048"
}
```



---

archive/issue_comments_463052.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2021-02-04T10:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463052",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_261049.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-02-04T10:01:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261049"
}
```



---

archive/issue_events_261050.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-02-04T10:01:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261050"
}
```



---

archive/issue_comments_463053.json:
```json
{
    "body": "<a id='comment:39'></a>\nok",
    "created_at": "2021-02-04T10:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29339#issuecomment-463053",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>
ok



---

archive/issue_events_261051.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-13T06:40:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261051"
}
```



---

archive/issue_events_261052.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-13T06:40:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29339",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29339#event-261052"
}
```
