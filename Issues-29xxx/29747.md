# Issue 29747: Add tangent_line() and related methods to curves and ambient spaces

archive/issues_029510.json:
```json
{
    "body": "Add tangent_line(), tangent_space(), line_through(), and other related methods to curves and ambient spaces.\n\nBranch/Commit: 86729adfd580b6008d7494934abc715feaa269cd\n\nReviewer: Travis Scrimshaw\n\nAuthor: Kwankyu Lee\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29747\n\n",
    "closed_at": "2020-06-05T22:12:24Z",
    "created_at": "2020-05-28T11:43:40Z",
    "labels": [
        "component: algebraic geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Add tangent_line() and related methods to curves and ambient spaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29747",
    "user": "https://github.com/kwankyu"
}
```
Add tangent_line(), tangent_space(), line_through(), and other related methods to curves and ambient spaces.

Branch/Commit: 86729adfd580b6008d7494934abc715feaa269cd

Reviewer: Travis Scrimshaw

Author: Kwankyu Lee

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29747





---

archive/issue_comments_583057.json:
```json
{
    "body": "Changing branch from \"\" to \"u/klee/29747\"",
    "created_at": "2020-05-28T11:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583057",
    "user": "https://github.com/kwankyu"
}
```

Changing branch from "" to "u/klee/29747"



---

archive/issue_comments_583058.json:
```json
{
    "body": "Changing author from \"\" to \"Kwankyu Lee\"",
    "created_at": "2020-05-28T11:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583058",
    "user": "https://github.com/kwankyu"
}
```

Changing author from "" to "Kwankyu Lee"



---

archive/issue_comments_583059.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[461a2b8](https://git.sagemath.org/sage.git/commit/?id=461a2b8a538f20cdee8fd0cd665f0506e0377697)|`Add tangent_line() method to curves`|",
    "created_at": "2020-05-28T11:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583059",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[461a2b8](https://git.sagemath.org/sage.git/commit/?id=461a2b8a538f20cdee8fd0cd665f0506e0377697)|`Add tangent_line() method to curves`|



---

archive/issue_comments_583060.json:
```json
{
    "body": "Changing commit from \"\" to \"461a2b8a538f20cdee8fd0cd665f0506e0377697\"",
    "created_at": "2020-05-28T11:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583060",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "461a2b8a538f20cdee8fd0cd665f0506e0377697"



---

archive/issue_comments_583061.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Add tangent_line() and tangent_space() methods to curves.\n+Add tangent_line(), tangent_space(), and line_through() methods to curves and ambient spaces.\n``````\n",
    "created_at": "2020-05-31T13:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583061",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Add tangent_line() and tangent_space() methods to curves.
+Add tangent_line(), tangent_space(), and line_through() methods to curves and ambient spaces.
``````




---

archive/issue_comments_583062.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[b05bed8](https://git.sagemath.org/sage.git/commit/?id=b05bed81730982752805c1bae629782d94fd7aff)|`Add tangent_line() and line_through() methods`|",
    "created_at": "2020-06-01T01:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583062",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[b05bed8](https://git.sagemath.org/sage.git/commit/?id=b05bed81730982752805c1bae629782d94fd7aff)|`Add tangent_line() and line_through() methods`|



---

archive/issue_comments_583063.json:
```json
{
    "body": "Changing commit from \"461a2b8a538f20cdee8fd0cd665f0506e0377697\" to \"b05bed81730982752805c1bae629782d94fd7aff\"",
    "created_at": "2020-06-01T01:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "461a2b8a538f20cdee8fd0cd665f0506e0377697" to "b05bed81730982752805c1bae629782d94fd7aff"



---

archive/issue_comments_583064.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-01T01:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583064",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_583065.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Add tangent_line(), tangent_space(), and line_through() methods to curves and ambient spaces.\n+Add tangent_line(), tangent_space(), line_through(), and other related methods to curves and ambient spaces.\n``````\n",
    "created_at": "2020-06-01T01:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583065",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Add tangent_line(), tangent_space(), and line_through() methods to curves and ambient spaces.
+Add tangent_line(), tangent_space(), line_through(), and other related methods to curves and ambient spaces.
``````




---

archive/issue_comments_583066.json:
```json
{
    "body": "Changing commit from \"b05bed81730982752805c1bae629782d94fd7aff\" to \"bcb56ac4e1e1a9e9ac283f5ee82d3519f22d439d\"",
    "created_at": "2020-06-01T01:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b05bed81730982752805c1bae629782d94fd7aff" to "bcb56ac4e1e1a9e9ac283f5ee82d3519f22d439d"



---

archive/issue_comments_583067.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------|\n|[bcb56ac](https://git.sagemath.org/sage.git/commit/?id=bcb56ac4e1e1a9e9ac283f5ee82d3519f22d439d)|`A bug fix`|",
    "created_at": "2020-06-01T01:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------|
|[bcb56ac](https://git.sagemath.org/sage.git/commit/?id=bcb56ac4e1e1a9e9ac283f5ee82d3519f22d439d)|`A bug fix`|



---

archive/issue_comments_583068.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2020-06-01T05:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583068",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_583069.json:
```json
{
    "body": "<a id='comment:9'></a>\nA few comments:\n\nThis is a bit faster and `int` is immutable:\n\n```diff\n-return self([0 for i in range(self.ngens())])\n+return self([0]*self.ngens())\n```\n\nI don't think the `list` is needed here:\n\n```diff\n-Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )\n+Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )\n```\n\nThis is a little cleaner IMO:\n\n```diff\n-I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))\n+I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))\n```\n\nThis is not future-proof (if `i` gets made so it remains local to the for-loop):\n\n```diff\n         for i in range(len(p)):\n             if p[i]:\n-                break\n-\n-        C = self.affine_patch(i)\n-        q = p.dehomogenize(i)\n-        T = C.tangent_line(q)\n-\n-        return T.projective_closure(i, self.ambient_space())\n+                C = self.affine_patch(i)\n+                q = p.dehomogenize(i)\n+                T = C.tangent_line(q)\n+                return T.projective_closure(i, self.ambient_space())\n+\n+        n = len(p)\n+        C = self.affine_patch(n)\n+        q = p.dehomogenize(n)\n+        T = C.tangent_line(q)\n+        return T.projective_closure(n, self.ambient_space())\n```\nI am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?",
    "created_at": "2020-06-01T05:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583069",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
A few comments:

This is a bit faster and `int` is immutable:

```diff
-return self([0 for i in range(self.ngens())])
+return self([0]*self.ngens())
```

I don't think the `list` is needed here:

```diff
-Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )
+Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )
```

This is a little cleaner IMO:

```diff
-I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))
+I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))
```

This is not future-proof (if `i` gets made so it remains local to the for-loop):

```diff
         for i in range(len(p)):
             if p[i]:
-                break
-
-        C = self.affine_patch(i)
-        q = p.dehomogenize(i)
-        T = C.tangent_line(q)
-
-        return T.projective_closure(i, self.ambient_space())
+                C = self.affine_patch(i)
+                q = p.dehomogenize(i)
+                T = C.tangent_line(q)
+                return T.projective_closure(i, self.ambient_space())
+
+        n = len(p)
+        C = self.affine_patch(n)
+        q = p.dehomogenize(n)
+        T = C.tangent_line(q)
+        return T.projective_closure(n, self.ambient_space())
```
I am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?



---

archive/issue_comments_583070.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-01T05:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583070",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_583071.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-06-01T05:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583071",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_583072.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [tscrim](#comment%3A9):\n> A few comments:\n> \n> This is a bit faster and `int` is immutable:\n> \n> ```diff\n> -return self([0 for i in range(self.ngens())])\n> +return self([0]*self.ngens())\n> ```\n\n\nDone.\n\n> I don't think the `list` is needed here:\n> \n> ```diff\n> -Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )\n> +Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )\n> ```\n\n\nDone.\n\n> This is a little cleaner IMO:\n> \n> ```diff\n> -I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))\n> +I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))\n> ```\n\n\nDone.\n\n> This is not future-proof (if `i` gets made so it remains local to the for-loop):\n> \n> ```diff\n>          for i in range(len(p)):\n>              if p[i]:\n> -                break\n> -\n> -        C = self.affine_patch(i)\n> -        q = p.dehomogenize(i)\n> -        T = C.tangent_line(q)\n> -\n> -        return T.projective_closure(i, self.ambient_space())\n> +                C = self.affine_patch(i)\n> +                q = p.dehomogenize(i)\n> +                T = C.tangent_line(q)\n> +                return T.projective_closure(i, self.ambient_space())\n> +\n> +        n = len(p)\n> +        C = self.affine_patch(n)\n> +        q = p.dehomogenize(n)\n> +        T = C.tangent_line(q)\n> +        return T.projective_closure(n, self.ambient_space())\n> ```\n> I am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?\n\n\nRight. There is no rational point with all zero homogeneous coordinates. It is now modified to raise a `TypeError` if somehow the part is reached.",
    "created_at": "2020-06-01T06:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583072",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:11'></a>
Replying to [tscrim](#comment%3A9):
> A few comments:
> 
> This is a bit faster and `int` is immutable:
> 
> ```diff
> -return self([0 for i in range(self.ngens())])
> +return self([0]*self.ngens())
> ```


Done.

> I don't think the `list` is needed here:
> 
> ```diff
> -Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )
> +Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )
> ```


Done.

> This is a little cleaner IMO:
> 
> ```diff
> -I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))
> +I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))
> ```


Done.

> This is not future-proof (if `i` gets made so it remains local to the for-loop):
> 
> ```diff
>          for i in range(len(p)):
>              if p[i]:
> -                break
> -
> -        C = self.affine_patch(i)
> -        q = p.dehomogenize(i)
> -        T = C.tangent_line(q)
> -
> -        return T.projective_closure(i, self.ambient_space())
> +                C = self.affine_patch(i)
> +                q = p.dehomogenize(i)
> +                T = C.tangent_line(q)
> +                return T.projective_closure(i, self.ambient_space())
> +
> +        n = len(p)
> +        C = self.affine_patch(n)
> +        q = p.dehomogenize(n)
> +        T = C.tangent_line(q)
> +        return T.projective_closure(n, self.ambient_space())
> ```
> I am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?


Right. There is no rational point with all zero homogeneous coordinates. It is now modified to raise a `TypeError` if somehow the part is reached.



---

archive/issue_comments_583073.json:
```json
{
    "body": "Changing commit from \"bcb56ac4e1e1a9e9ac283f5ee82d3519f22d439d\" to \"86729adfd580b6008d7494934abc715feaa269cd\"",
    "created_at": "2020-06-01T06:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bcb56ac4e1e1a9e9ac283f5ee82d3519f22d439d" to "86729adfd580b6008d7494934abc715feaa269cd"



---

archive/issue_comments_583074.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[86729ad](https://git.sagemath.org/sage.git/commit/?id=86729adfd580b6008d7494934abc715feaa269cd)|`Cleaning fixes suggested by the reviewer`|",
    "created_at": "2020-06-01T06:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[86729ad](https://git.sagemath.org/sage.git/commit/?id=86729adfd580b6008d7494934abc715feaa269cd)|`Cleaning fixes suggested by the reviewer`|



---

archive/issue_comments_583075.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-01T06:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583075",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_583076.json:
```json
{
    "body": "<a id='comment:13'></a>\nThank you. LGTM.",
    "created_at": "2020-06-01T06:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583076",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Thank you. LGTM.



---

archive/issue_comments_583077.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [tscrim](#comment%3A13):\n> Thank you. LGTM.\n\n\nThank you!",
    "created_at": "2020-06-01T06:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583077",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'></a>
Replying to [tscrim](#comment%3A13):
> Thank you. LGTM.


Thank you!



---

archive/issue_comments_583078.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-05T22:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583078",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076107.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-06-05T22:12:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29747#event-76107"
}
```



---

archive/issue_comments_583079.json:
```json
{
    "body": "Changing branch from \"u/klee/29747\" to \"86729adfd580b6008d7494934abc715feaa269cd\"",
    "created_at": "2020-06-05T22:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29747#issuecomment-583079",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/klee/29747" to "86729adfd580b6008d7494934abc715feaa269cd"
