# Issue 29164: Computing log(0, 2) takes a long time

archive/issues_028927.json:
```json
{
    "body": "The following commands run \"instantly\":\n\n```\nsage: log (0.0)\n-infinity\nsage: log (0.0, 2)\n-infinity\nsage: log (0)\n-Infinity\n```\n\nBut the command\n\n```\nsage: log (0, 2)\n```\ntakes a very long time (at least a few minutes). Moreover, the python process needs to be killed, using Ctrl+C does not work to stop the computation.\n\nI was able to reproduce the bug with Sage 9.0 (using Python3) and Sage 8.9 (using Python2). But i was not able to reproduce the bug with Sage 7.6.\n\nAssignee: @bmlivin\n\nKeywords: log float integer\n\nBranch/Commit: [e44937e6f76a1f16258096a2298eb3e5baed8653](https://github.com/sagemath/sagetrac-mirror/commit/e44937e6f76a1f16258096a2298eb3e5baed8653)\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Ben Livingston\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29164\n\n",
    "closed_at": "2020-09-23T21:28:04Z",
    "created_at": "2020-02-07T10:47:18Z",
    "labels": [
        "component: basic arithmetic",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Computing log(0, 2) takes a long time",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29164",
    "user": "https://trac.sagemath.org/admin/accounts/users/bouvier"
}
```
The following commands run "instantly":

```
sage: log (0.0)
-infinity
sage: log (0.0, 2)
-infinity
sage: log (0)
-Infinity
```

But the command

```
sage: log (0, 2)
```
takes a very long time (at least a few minutes). Moreover, the python process needs to be killed, using Ctrl+C does not work to stop the computation.

I was able to reproduce the bug with Sage 9.0 (using Python3) and Sage 8.9 (using Python2). But i was not able to reproduce the bug with Sage 7.6.

Assignee: @bmlivin

Keywords: log float integer

Branch/Commit: [e44937e6f76a1f16258096a2298eb3e5baed8653](https://github.com/sagemath/sagetrac-mirror/commit/e44937e6f76a1f16258096a2298eb3e5baed8653)

Reviewer: Frédéric Chapoton

Author: Ben Livingston

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29164





---

archive/issue_comments_569620.json:
```json
{
    "body": "<a id='comment:1'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569620",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_083600.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29164#event-83600"
}
```



---

archive/issue_events_083601.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-29T16:37:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29164#event-83601"
}
```



---

archive/issue_events_083602.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-29T16:37:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29164#event-83602"
}
```



---

archive/issue_comments_569621.json:
```json
{
    "body": "<a id='comment:4'></a>\nIn `sage.rings.integer.Integer.exact_log`, this triggers a `ValueError`:\n\n```\nif mpz_sgn(self.value) <= 0 or mpz_sgn(_m.value) <= 0:\n    raise ValueError(\"both self and m must be positive\")\n```\n\nIn your example, `self.value` is 0 and `_m.value` is 2. It seems to me like it would be better to return `-infinity` instead of raising this error if `self.value` is 0, but in a sense that is beside the point. What instead happens is that this `ValueError` is in a try-except in `sage.functions.log.log`:\n\n```\n    try:\n        return args[0].log(args[1])\n    except ValueError as ex:\n        if repr(ex)[12:27] == \"No discrete log\":\n            raise\n        return logb(args[0], args[1])\n```\n\nHere, `args[0]` is 0 and `args[1]` is 2. Calling the function `logb` results in the same `ValueError` and the same try-except, and thus an infinite loop. \n\nTo avoid this, `-infinity` needs to be returned at some point. I think that point should be in `sage.rings.integer.Integer.exact_log`, immediately before raising the `ValueError`.",
    "created_at": "2020-09-05T23:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569621",
    "user": "https://github.com/bmlivin"
}
```

<a id='comment:4'></a>
In `sage.rings.integer.Integer.exact_log`, this triggers a `ValueError`:

```
if mpz_sgn(self.value) <= 0 or mpz_sgn(_m.value) <= 0:
    raise ValueError("both self and m must be positive")
```

In your example, `self.value` is 0 and `_m.value` is 2. It seems to me like it would be better to return `-infinity` instead of raising this error if `self.value` is 0, but in a sense that is beside the point. What instead happens is that this `ValueError` is in a try-except in `sage.functions.log.log`:

```
    try:
        return args[0].log(args[1])
    except ValueError as ex:
        if repr(ex)[12:27] == "No discrete log":
            raise
        return logb(args[0], args[1])
```

Here, `args[0]` is 0 and `args[1]` is 2. Calling the function `logb` results in the same `ValueError` and the same try-except, and thus an infinite loop. 

To avoid this, `-infinity` needs to be returned at some point. I think that point should be in `sage.rings.integer.Integer.exact_log`, immediately before raising the `ValueError`.



---

archive/issue_comments_569622.json:
```json
{
    "body": "Set assignee to @bmlivin.",
    "created_at": "2020-09-05T23:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569622",
    "user": "https://github.com/bmlivin"
}
```

Set assignee to @bmlivin.



---

archive/issue_comments_569623.json:
```json
{
    "body": "Branch: [u/bmlivin/29164](https://github.com/sagemath/sagetrac-mirror/tree/u/bmlivin/29164)",
    "created_at": "2020-09-06T03:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569623",
    "user": "https://github.com/bmlivin"
}
```

Branch: [u/bmlivin/29164](https://github.com/sagemath/sagetrac-mirror/tree/u/bmlivin/29164)



---

archive/issue_comments_569624.json:
```json
{
    "body": "Changing branch from \"[u/bmlivin/29164](https://github.com/sagemath/sagetrac-mirror/tree/u/bmlivin/29164)\" to \"[u/gh-bmlivin/29164](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-bmlivin/29164)\"",
    "created_at": "2020-09-06T03:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569624",
    "user": "https://github.com/bmlivin"
}
```

Changing branch from "[u/bmlivin/29164](https://github.com/sagemath/sagetrac-mirror/tree/u/bmlivin/29164)" to "[u/gh-bmlivin/29164](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-bmlivin/29164)"



---

archive/issue_comments_569625.json:
```json
{
    "body": "Changing branch from \"[u/gh-bmlivin/29164](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-bmlivin/29164)\" to \"\"",
    "created_at": "2020-09-06T19:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569625",
    "user": "https://github.com/bmlivin"
}
```

Changing branch from "[u/gh-bmlivin/29164](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-bmlivin/29164)" to ""



---

archive/issue_comments_569626.json:
```json
{
    "body": "Branch: [u/gh-bmlivin/computing_log_0__2__takes_a_long_time](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-bmlivin/computing_log_0__2__takes_a_long_time)",
    "created_at": "2020-09-12T21:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569626",
    "user": "https://github.com/bmlivin"
}
```

Branch: [u/gh-bmlivin/computing_log_0__2__takes_a_long_time](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-bmlivin/computing_log_0__2__takes_a_long_time)



---

archive/issue_comments_569627.json:
```json
{
    "body": "Commit: [fe8c3871129b00c4d2d03dbad1d5e76e552ac20c](https://github.com/sagemath/sagetrac-mirror/commit/fe8c3871129b00c4d2d03dbad1d5e76e552ac20c)",
    "created_at": "2020-09-12T21:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569627",
    "user": "https://github.com/bmlivin"
}
```

Commit: [fe8c3871129b00c4d2d03dbad1d5e76e552ac20c](https://github.com/sagemath/sagetrac-mirror/commit/fe8c3871129b00c4d2d03dbad1d5e76e552ac20c)



---

archive/issue_comments_569628.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-12T21:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569628",
    "user": "https://github.com/bmlivin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_569629.json:
```json
{
    "body": "<a id='comment:10'></a>\nNew commits:\n|                                                                                                                                          |                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[0f35da0](https://github.com/sagemath/sagetrac-mirror/commit/0f35da0bc34e8ba2d591cbb90df19ee93d4d19e7)|`Fixed issue when taking log(0, n) for integer n`|\n|[fe8c387](https://github.com/sagemath/sagetrac-mirror/commit/fe8c3871129b00c4d2d03dbad1d5e76e552ac20c)|`Added a doctest to sage.functions.log.log to check that issue 29164 is fixed`|",
    "created_at": "2020-09-12T21:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569629",
    "user": "https://github.com/bmlivin"
}
```

<a id='comment:10'></a>
New commits:
|                                                                                                                                          |                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[0f35da0](https://github.com/sagemath/sagetrac-mirror/commit/0f35da0bc34e8ba2d591cbb90df19ee93d4d19e7)|`Fixed issue when taking log(0, n) for integer n`|
|[fe8c387](https://github.com/sagemath/sagetrac-mirror/commit/fe8c3871129b00c4d2d03dbad1d5e76e552ac20c)|`Added a doctest to sage.functions.log.log to check that issue 29164 is fixed`|



---

archive/issue_comments_569630.json:
```json
{
    "body": "<a id='comment:11'></a>\nin the doctest, please add the missing empty line after `::`\n\n```\n+    \n+    Check if :track:`29164` is fixed::\n+        sage: log(0, 2)\n+        -Infinity\n```",
    "created_at": "2020-09-13T19:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569630",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
in the doctest, please add the missing empty line after `::`

```
+    
+    Check if :track:`29164` is fixed::
+        sage: log(0, 2)
+        -Infinity
```



---

archive/issue_comments_569631.json:
```json
{
    "body": "<a id='comment:12'></a>\nalso use `:trac:` and not `:track:`",
    "created_at": "2020-09-13T19:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569631",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
also use `:trac:` and not `:track:`



---

archive/issue_comments_569632.json:
```json
{
    "body": "Changing commit from \"[fe8c3871129b00c4d2d03dbad1d5e76e552ac20c](https://github.com/sagemath/sagetrac-mirror/commit/fe8c3871129b00c4d2d03dbad1d5e76e552ac20c)\" to \"[e44937e6f76a1f16258096a2298eb3e5baed8653](https://github.com/sagemath/sagetrac-mirror/commit/e44937e6f76a1f16258096a2298eb3e5baed8653)\"",
    "created_at": "2020-09-13T20:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569632",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[fe8c3871129b00c4d2d03dbad1d5e76e552ac20c](https://github.com/sagemath/sagetrac-mirror/commit/fe8c3871129b00c4d2d03dbad1d5e76e552ac20c)" to "[e44937e6f76a1f16258096a2298eb3e5baed8653](https://github.com/sagemath/sagetrac-mirror/commit/e44937e6f76a1f16258096a2298eb3e5baed8653)"



---

archive/issue_comments_569633.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|\n|[e44937e](https://github.com/sagemath/sagetrac-mirror/commit/e44937e6f76a1f16258096a2298eb3e5baed8653)|`adding empty line and changing track to trac in doctest of sage.functions.log.log`|",
    "created_at": "2020-09-13T20:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569633",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
|[e44937e](https://github.com/sagemath/sagetrac-mirror/commit/e44937e6f76a1f16258096a2298eb3e5baed8653)|`adding empty line and changing track to trac in doctest of sage.functions.log.log`|



---

archive/issue_comments_569634.json:
```json
{
    "body": "<a id='comment:14'></a>\nFull names in \"Authors\" and \"Reviewers\" fields please.",
    "created_at": "2020-09-14T10:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569634",
    "user": "https://github.com/slel"
}
```

<a id='comment:14'></a>
Full names in "Authors" and "Reviewers" fields please.



---

archive/issue_comments_569635.json:
```json
{
    "body": "Reviewer: Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2020-09-15T08:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569635",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: Frédéric Chapoton



---

archive/issue_comments_569636.json:
```json
{
    "body": "<a id='comment:16'></a>\nBen, please add your full real name in the author field here above.",
    "created_at": "2020-09-15T10:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569636",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
Ben, please add your full real name in the author field here above.



---

archive/issue_comments_569637.json:
```json
{
    "body": "Author: Ben Livingston",
    "created_at": "2020-09-15T21:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569637",
    "user": "https://github.com/bmlivin"
}
```

Author: Ben Livingston



---

archive/issue_comments_569638.json:
```json
{
    "body": "<a id='comment:18'></a>\nok, let it be then. Thanks",
    "created_at": "2020-09-16T06:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569638",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
ok, let it be then. Thanks



---

archive/issue_comments_569639.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-16T06:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569639",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_083603.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-23T21:28:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29164#event-83603"
}
```



---

archive/issue_comments_569640.json:
```json
{
    "body": "Changing branch from \"[u/gh-bmlivin/computing_log_0__2__takes_a_long_time](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-bmlivin/computing_log_0__2__takes_a_long_time)\" to \"[e44937e6f76a1f16258096a2298eb3e5baed8653](https://github.com/sagemath/sagetrac-mirror/commit/e44937e6f76a1f16258096a2298eb3e5baed8653)\"",
    "created_at": "2020-09-23T21:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569640",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/gh-bmlivin/computing_log_0__2__takes_a_long_time](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-bmlivin/computing_log_0__2__takes_a_long_time)" to "[e44937e6f76a1f16258096a2298eb3e5baed8653](https://github.com/sagemath/sagetrac-mirror/commit/e44937e6f76a1f16258096a2298eb3e5baed8653)"



---

archive/issue_comments_569641.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-23T21:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29164#issuecomment-569641",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_083604.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-23T22:26:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29164#event-83604"
}
```



---

archive/issue_events_083605.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-23T22:26:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29164",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29164#event-83605"
}
```
