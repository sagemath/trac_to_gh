# Issue 29665: configure --enable-system-site-packages via spkg-configure.m4 for cvxopt and other python packages

archive/issues_029428.json:
```json
{
    "assignees": [],
    "body": "This ticket adds an spkg-configure.m4 for cvxopt and various other python packages, to allow them to be used from the system (part of #27330).\n\nThese python packages are special because we currently use a python \"venv\" that is isolated from the system. Thus this ticket proceeds in several steps:\n\n1. Add an `--enable-system-site-packages` flag to the top-level `./configure` script. When present, this will tell `sage-venv` that the venv it creates **should not** be isolated from the system.\n2. Create a new macro that can detect python packages on the system. It should ensure that the version bounds in each python package's `install-requires.txt` are met.\n3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.\n4. Test everything thoroughly with various combinations of system and non-system python packages.\n\nPlatform-specific testing:\n- for example `TARGETS_PRE=\"build-local\" EXTRA_CONFIGURE_ARGS=\"--enable-system-site-packages\" tox -e docker-ubuntu-focal-standard -- build ptest`\n\n\nDepends on #32703\nDepends on #33067\n\nKeywords: **cvxopt, system packages, Python library**\n\nBranch/Commit: **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665) @ [`baf6301`](https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb)**\n\nAuthor: **Michael Orlitzky**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29665_\n\n",
    "created_at": "2020-05-08T14:40:42Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/pending",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "configure --enable-system-site-packages via spkg-configure.m4 for cvxopt and other python packages",
    "type": "issue",
    "updated_at": "2022-02-07T12:15:58Z",
    "url": "https://github.com/sagemath/sage/issues/29665",
    "user": "https://github.com/thierry-FreeBSD"
}
```
This ticket adds an spkg-configure.m4 for cvxopt and various other python packages, to allow them to be used from the system (part of #27330).

These python packages are special because we currently use a python "venv" that is isolated from the system. Thus this ticket proceeds in several steps:

1. Add an `--enable-system-site-packages` flag to the top-level `./configure` script. When present, this will tell `sage-venv` that the venv it creates **should not** be isolated from the system.
2. Create a new macro that can detect python packages on the system. It should ensure that the version bounds in each python package's `install-requires.txt` are met.
3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.
4. Test everything thoroughly with various combinations of system and non-system python packages.

Platform-specific testing:
- for example `TARGETS_PRE="build-local" EXTRA_CONFIGURE_ARGS="--enable-system-site-packages" tox -e docker-ubuntu-focal-standard -- build ptest`


Depends on #32703
Depends on #33067

Keywords: **cvxopt, system packages, Python library**

Branch/Commit: **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665) @ [`baf6301`](https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb)**

Author: **Michael Orlitzky**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/29665_





---

archive/issue_events_405123.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-05-08T14:40:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405123"
}
```



---

archive/issue_events_405124.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-05-08T14:40:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405124"
}
```



---

archive/issue_events_405125.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-05-08T14:40:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405125"
}
```



---

archive/issue_events_405126.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-05-08T14:40:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405126"
}
```



---

archive/issue_events_405127.json:
```json
{
    "actor": "https://github.com/thierry-FreeBSD",
    "created_at": "2020-05-08T14:40:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405127"
}
```



---

archive/issue_comments_467166.json:
```json
{
    "body": "spkg-configure.m4 to be copied under build/pkgs/cvxopt",
    "created_at": "2020-05-08T14:42:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467166",
    "user": "https://github.com/thierry-FreeBSD"
}
```

spkg-configure.m4 to be copied under build/pkgs/cvxopt



---

archive/issue_comments_467167.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[spkg-configure.m4.gz](https://github.com/sagemath/sage/files/ticket29665/spkg-configure.m4.gz)**\n\nI don't see a branch",
    "created_at": "2020-05-08T14:56:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467167",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[spkg-configure.m4.gz](https://github.com/sagemath/sage/files/ticket29665/spkg-configure.m4.gz)**

I don't see a branch



---

archive/issue_comments_467168.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSee comments in #29023",
    "created_at": "2020-05-08T15:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467168",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

See comments in #29023



---

archive/issue_comments_467169.json:
```json
{
    "body": "Branch: **[u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt)**",
    "created_at": "2020-05-09T09:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467169",
    "user": "https://github.com/thierry-FreeBSD"
}
```

Branch: **[u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt)**



---

archive/issue_comments_467170.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n\"wontfix\" because of #29023\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac668017532cede326d69aad5cf6094b2f4dcbce\"><code>ac66801</code></a></td><td><code>Experimental spkg-configure.m4 for cvxopt</code></td></tr></table>\n",
    "created_at": "2020-08-11T17:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467170",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

"wontfix" because of #29023

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac668017532cede326d69aad5cf6094b2f4dcbce"><code>ac66801</code></a></td><td><code>Experimental spkg-configure.m4 for cvxopt</code></td></tr></table>




---

archive/issue_comments_467171.json:
```json
{
    "body": "Commit: **[`ac66801`](https://github.com/sagemath/sagetrac-mirror/commit/ac668017532cede326d69aad5cf6094b2f4dcbce)**",
    "created_at": "2020-08-11T17:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467171",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`ac66801`](https://github.com/sagemath/sagetrac-mirror/commit/ac668017532cede326d69aad5cf6094b2f4dcbce)**



---

archive/issue_events_405128.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-11T17:37:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405128"
}
```



---

archive/issue_comments_467172.json:
```json
{
    "body": "Changed author from **gh-thierry-FreeBSD** to none",
    "created_at": "2020-08-11T17:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467172",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **gh-thierry-FreeBSD** to none



---

archive/issue_events_405129.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-11T17:37:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405129"
}
```



---

archive/issue_comments_467173.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThere is per se nothing wrong with having spkg-configure.m4 for Python packages.",
    "created_at": "2020-08-13T09:07:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467173",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

There is per se nothing wrong with having spkg-configure.m4 for Python packages.



---

archive/issue_comments_467174.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nNot per se, only per the big picture.",
    "created_at": "2020-08-13T14:51:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467174",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

Not per se, only per the big picture.



---

archive/issue_comments_467175.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nRegardless of what we eventually wind up with... does this work? Does it hurt anything? The solution in #29023 could be years away. If we can avoid building e.g. numpy, scipy, matplotlib, and cvxopt with relatively trivial spkg-configures until then, why not do it?",
    "created_at": "2021-09-18T18:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467175",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:7" align="right">comment:7</div>

Regardless of what we eventually wind up with... does this work? Does it hurt anything? The solution in #29023 could be years away. If we can avoid building e.g. numpy, scipy, matplotlib, and cvxopt with relatively trivial spkg-configures until then, why not do it?



---

archive/issue_comments_467176.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nNo, it does not work.",
    "created_at": "2021-09-18T18:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467176",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

No, it does not work.



---

archive/issue_comments_467177.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@mkoeppe](#comment:8):\n> No, it does not work. \n\nWhat goes wrong? I just did a quick test (without this branch):\n\n1. make cvxopt-clean\n2. install system cvxopt\n3. touch any file in sagelib names `*cvxopt*`\n4. sage -b\n5. run some tests on said cvxopt files\n\nBehavior is unchanged as far as I can tell.",
    "created_at": "2021-09-19T00:12:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467177",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@mkoeppe](#comment:8):
> No, it does not work. 

What goes wrong? I just did a quick test (without this branch):

1. make cvxopt-clean
2. install system cvxopt
3. touch any file in sagelib names `*cvxopt*`
4. sage -b
5. run some tests on said cvxopt files

Behavior is unchanged as far as I can tell.



---

archive/issue_comments_467178.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSound like you forgot to test with `--optional=sage,cvxopt`. \n\nSage runs in a venv that does not provide access to system site packages.",
    "created_at": "2021-09-19T00:17:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467178",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Sound like you forgot to test with `--optional=sage,cvxopt`. 

Sage runs in a venv that does not provide access to system site packages.



---

archive/issue_comments_467179.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@mkoeppe](#comment:10):\n> Sound like you forgot to test with `--optional=sage,cvxopt`. \n> \n> Sage runs in a venv that does not provide access to system site packages.\n\nLucky guess! I forgot we made it possible to disable cvxopt even though it's type=standard. On the surface, setting  `include-system-site-packages = true` in `local/pyvenv.cfg` looks like it solves that, and is one of the first steps mentioned on #29023. What necessitates the next step B.2. in #29023? In other words, what's the next thing that's going to go wrong for me?",
    "created_at": "2021-09-19T00:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467179",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@mkoeppe](#comment:10):
> Sound like you forgot to test with `--optional=sage,cvxopt`. 
> 
> Sage runs in a venv that does not provide access to system site packages.

Lucky guess! I forgot we made it possible to disable cvxopt even though it's type=standard. On the surface, setting  `include-system-site-packages = true` in `local/pyvenv.cfg` looks like it solves that, and is one of the first steps mentioned on #29023. What necessitates the next step B.2. in #29023? In other words, what's the next thing that's going to go wrong for me?



---

archive/issue_comments_467180.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nLet's take the discussion of #29023 to #29023. I think it would be fine if you want to go ahead with step B.1 (via a new option `./configure --enable-system-site-packages`) in a ticket, for users to experiment.",
    "created_at": "2021-09-19T01:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467180",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

Let's take the discussion of #29023 to #29023. I think it would be fine if you want to go ahead with step B.1 (via a new option `./configure --enable-system-site-packages`) in a ticket, for users to experiment.



---

archive/issue_comments_467181.json:
```json
{
    "body": "Changed commit from **[`ac66801`](https://github.com/sagemath/sagetrac-mirror/commit/ac668017532cede326d69aad5cf6094b2f4dcbce)** to **[`faed999`](https://github.com/sagemath/sagetrac-mirror/commit/faed9990a0b99fa50fe843cca981cb855c88b224)**",
    "created_at": "2021-10-11T13:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467181",
    "user": "https://github.com/orlitzky"
}
```

Changed commit from **[`ac66801`](https://github.com/sagemath/sagetrac-mirror/commit/ac668017532cede326d69aad5cf6094b2f4dcbce)** to **[`faed999`](https://github.com/sagemath/sagetrac-mirror/commit/faed9990a0b99fa50fe843cca981cb855c88b224)**



---

archive/issue_comments_467182.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nMatthias, does something like this fit with your master plan?\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17860f7322b0ac5a2bdc988594ab742512661f48\"><code>17860f7</code></a></td><td><code>Trac #29665: spkg-configure.m4 for requests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67db9ef2f9c14641dcb3e84c6d8f4096d428badc\"><code>67db9ef</code></a></td><td><code>Trac #29665: spkg-configure.m4 for six.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef80d1a90769047325dd5ded1189b39548e9f845\"><code>ef80d1a</code></a></td><td><code>Trac #29665: spkg-configure.m4 for packaging.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/310e56b506cbb331eb6b2a1933336162fe7e0da5\"><code>310e56b</code></a></td><td><code>Trac #29665: spkg-configure.m4 for numpy.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8d6a7405499bd971722c3b70be7cae1b8aaaa652\"><code>8d6a740</code></a></td><td><code>Trac #29665: spkg-configure.m4 for scipy.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe16a90568f0f9710ee258a9900b59c355651ad2\"><code>fe16a90</code></a></td><td><code>Trac #29665: spkg-configure.m4 for pluggy.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57cb9be16712fef73fe2e260dc921fb9236e9ba0\"><code>57cb9be</code></a></td><td><code>Trac #29665: spkg-configure.m4 for toml.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f976afae9b32fcac92f4164707a51e45e0469c9f\"><code>f976afa</code></a></td><td><code>Trac #29665: spkg-configure.m4 for pickleshare.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/413721841a8aa0486e5d31f85a11d784d521975a\"><code>4137218</code></a></td><td><code>Trac #29665: spkg-configure.m4 for html5lib.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/faed9990a0b99fa50fe843cca981cb855c88b224\"><code>faed999</code></a></td><td><code>Trac #29665: spkg-configure.m4 for scandir.</code></td></tr></table>\n",
    "created_at": "2021-10-11T13:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467182",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:13" align="right">comment:13</div>

Matthias, does something like this fit with your master plan?

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17860f7322b0ac5a2bdc988594ab742512661f48"><code>17860f7</code></a></td><td><code>Trac #29665: spkg-configure.m4 for requests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67db9ef2f9c14641dcb3e84c6d8f4096d428badc"><code>67db9ef</code></a></td><td><code>Trac #29665: spkg-configure.m4 for six.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef80d1a90769047325dd5ded1189b39548e9f845"><code>ef80d1a</code></a></td><td><code>Trac #29665: spkg-configure.m4 for packaging.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/310e56b506cbb331eb6b2a1933336162fe7e0da5"><code>310e56b</code></a></td><td><code>Trac #29665: spkg-configure.m4 for numpy.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8d6a7405499bd971722c3b70be7cae1b8aaaa652"><code>8d6a740</code></a></td><td><code>Trac #29665: spkg-configure.m4 for scipy.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe16a90568f0f9710ee258a9900b59c355651ad2"><code>fe16a90</code></a></td><td><code>Trac #29665: spkg-configure.m4 for pluggy.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57cb9be16712fef73fe2e260dc921fb9236e9ba0"><code>57cb9be</code></a></td><td><code>Trac #29665: spkg-configure.m4 for toml.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f976afae9b32fcac92f4164707a51e45e0469c9f"><code>f976afa</code></a></td><td><code>Trac #29665: spkg-configure.m4 for pickleshare.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/413721841a8aa0486e5d31f85a11d784d521975a"><code>4137218</code></a></td><td><code>Trac #29665: spkg-configure.m4 for html5lib.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/faed9990a0b99fa50fe843cca981cb855c88b224"><code>faed999</code></a></td><td><code>Trac #29665: spkg-configure.m4 for scandir.</code></td></tr></table>




---

archive/issue_comments_467183.json:
```json
{
    "body": "Changed branch from **[u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt)** to **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)**",
    "created_at": "2021-10-11T13:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467183",
    "user": "https://github.com/orlitzky"
}
```

Changed branch from **[u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt)** to **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)**



---

archive/issue_events_405130.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-11T13:22:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405130"
}
```



---

archive/issue_events_405131.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-11T13:22:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405131"
}
```



---

archive/issue_comments_467184.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI wouldn't object to doing something like this, as it is clearly marked experimental.\n\nHowever, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.\n\nAlso the version constraints shouldn't be hardcoded in the spkg-configure.m4 file; instead, they should really be taken from `install-requires.txt`.\nLikewise, don't use distutils, it's on its way out. Use a higher-level library that can check the requirements\n\nAlso, note `scandir` is gone after #32626",
    "created_at": "2021-10-11T17:13:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467184",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

I wouldn't object to doing something like this, as it is clearly marked experimental.

However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.

Also the version constraints shouldn't be hardcoded in the spkg-configure.m4 file; instead, they should really be taken from `install-requires.txt`.
Likewise, don't use distutils, it's on its way out. Use a higher-level library that can check the requirements

Also, note `scandir` is gone after #32626



---

archive/issue_events_405132.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-11T17:14:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405132"
}
```



---

archive/issue_comments_467185.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7a0dcb101bf6bf300e2ed121247105a1182730f\"><code>b7a0dcb</code></a></td><td><code>Trac #29665: new spkg-configure.m4 for pillow.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4252edd29c54f89d992e8a3a4eb0accea59aca4\"><code>b4252ed</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for mpmath.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b20db345d093550b3345211cee9ecd629343d2c\"><code>1b20db3</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sympy.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37c7732bcf2f8106102c0f080067cc03e8c7d4e1\"><code>37c7732</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pygments.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0dce081312877a63b8fc9f8b974262f774f5fdd\"><code>c0dce08</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for jinja2.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/492471a37e9a15776957dabb2730f904b21795d2\"><code>492471a</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pandocfilters.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d70ed54592a94afa32071e4b1a80ef1fe0cfb04\"><code>9d70ed5</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for webencodings.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71cc57428c6311e2920b7b16091e360501eb9232\"><code>71cc574</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pytz.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29e95b2db4d9ee1a43e43b16c3a408fec27bc97d\"><code>29e95b2</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for texttable.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a5246dbbc980ebf97dd6b1fba70e58d198d9db3\"><code>6a5246d</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for babel.</code></td></tr></table>\n",
    "created_at": "2021-10-12T14:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467185",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7a0dcb101bf6bf300e2ed121247105a1182730f"><code>b7a0dcb</code></a></td><td><code>Trac #29665: new spkg-configure.m4 for pillow.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4252edd29c54f89d992e8a3a4eb0accea59aca4"><code>b4252ed</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for mpmath.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b20db345d093550b3345211cee9ecd629343d2c"><code>1b20db3</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sympy.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37c7732bcf2f8106102c0f080067cc03e8c7d4e1"><code>37c7732</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pygments.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0dce081312877a63b8fc9f8b974262f774f5fdd"><code>c0dce08</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for jinja2.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/492471a37e9a15776957dabb2730f904b21795d2"><code>492471a</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pandocfilters.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d70ed54592a94afa32071e4b1a80ef1fe0cfb04"><code>9d70ed5</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for webencodings.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71cc57428c6311e2920b7b16091e360501eb9232"><code>71cc574</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pytz.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29e95b2db4d9ee1a43e43b16c3a408fec27bc97d"><code>29e95b2</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for texttable.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a5246dbbc980ebf97dd6b1fba70e58d198d9db3"><code>6a5246d</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for babel.</code></td></tr></table>




---

archive/issue_comments_467186.json:
```json
{
    "body": "Changed commit from **[`faed999`](https://github.com/sagemath/sagetrac-mirror/commit/faed9990a0b99fa50fe843cca981cb855c88b224)** to **[`6a5246d`](https://github.com/sagemath/sagetrac-mirror/commit/6a5246dbbc980ebf97dd6b1fba70e58d198d9db3)**",
    "created_at": "2021-10-12T14:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467186",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`faed999`](https://github.com/sagemath/sagetrac-mirror/commit/faed9990a0b99fa50fe843cca981cb855c88b224)** to **[`6a5246d`](https://github.com/sagemath/sagetrac-mirror/commit/6a5246dbbc980ebf97dd6b1fba70e58d198d9db3)**



---

archive/issue_comments_467187.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mkoeppe](#comment:14):\n> \n> However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.\n\nHow so? The version information is maintained separately in `install-requires.txt`. And on Gentoo, most of these packages are already present and maintained by somebody else.\n\n> Also the version constraints shouldn't be hardcoded in the spkg-configure.m4 file; instead, they should really be taken from `install-requires.txt`.\n\nDone.\n\n> Likewise, don't use distutils, it's on its way out. Use a higher-level library that can check the requirements\n\nI'm using setuptools now, because I figure it (with its vendored \"packaging\") is more likely to be present than the \"packaging\" package itself.\n\n> Also, note `scandir` is gone after #32626\n\nThanks, I dropped that one, and added a few more.",
    "created_at": "2021-10-12T14:13:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467187",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mkoeppe](#comment:14):
> 
> However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.

How so? The version information is maintained separately in `install-requires.txt`. And on Gentoo, most of these packages are already present and maintained by somebody else.

> Also the version constraints shouldn't be hardcoded in the spkg-configure.m4 file; instead, they should really be taken from `install-requires.txt`.

Done.

> Likewise, don't use distutils, it's on its way out. Use a higher-level library that can check the requirements

I'm using setuptools now, because I figure it (with its vendored "packaging") is more likely to be present than the "packaging" package itself.

> Also, note `scandir` is gone after #32626

Thanks, I dropped that one, and added a few more.



---

archive/issue_comments_467188.json:
```json
{
    "body": "Author: **Michael Orlitzky**",
    "created_at": "2021-10-12T14:13:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467188",
    "user": "https://github.com/orlitzky"
}
```

Author: **Michael Orlitzky**



---

archive/issue_events_405133.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-12T14:13:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405133"
}
```



---

archive/issue_events_405134.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-12T14:13:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405134"
}
```



---

archive/issue_comments_467189.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@orlitzky](#comment:17):\n> Replying to [@mkoeppe](#comment:14):\n> > \n> > However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.\n\n> \n> How so? The version information is maintained separately in `install-requires.txt`. And on Gentoo, most of these packages are already present and maintained by somebody else.\n\nThe metadata in these packages (distributions published on PyPI) declares install-requires as well. pip's resolver inspects all of these version constraints.",
    "created_at": "2021-10-12T16:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467189",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@orlitzky](#comment:17):
> Replying to [@mkoeppe](#comment:14):
> > 
> > However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.

> 
> How so? The version information is maintained separately in `install-requires.txt`. And on Gentoo, most of these packages are already present and maintained by somebody else.

The metadata in these packages (distributions published on PyPI) declares install-requires as well. pip's resolver inspects all of these version constraints.



---

archive/issue_comments_467190.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nCould you update the ticket description please?",
    "created_at": "2021-10-12T16:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467190",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Could you update the ticket description please?



---

archive/issue_comments_467191.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWith #32442, which sets up `SAGE_VENV = SAGE_LOCAL/var/lib/sage/venv-PYTHONVERSION` by default, one could consider to use a suffix `+site` in the case that `--enable-system-site-packages` was used.",
    "created_at": "2021-10-12T16:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467191",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

With #32442, which sets up `SAGE_VENV = SAGE_LOCAL/var/lib/sage/venv-PYTHONVERSION` by default, one could consider to use a suffix `+site` in the case that `--enable-system-site-packages` was used.



---

archive/issue_comments_467192.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAlso, when `--enable-system-site-packages` has been given but system python3 is not used, this should be an error.",
    "created_at": "2021-10-12T17:15:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467192",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Also, when `--enable-system-site-packages` has been given but system python3 is not used, this should be an error.



---

archive/issue_events_405135.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-13T12:43:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "title_is": "spkg-configure.m4 for cvxopt and other python packages",
    "title_was": "spkg-configure.m4 for cvxopt",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405135"
}
```



---

archive/issue_comments_467193.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,9 @@\n-This ticket adds an spkg-configure.m4 for cvxopt, in order to use it from a system package if possible (see #27330).\n+This ticket adds an spkg-configure.m4 for cvxopt and various other python packages, to allow them to be used from the system (part of #27330).\n \n-This one is a bit special, because cvxopt is a Python module.\n+These python packages are special because we currently use a python \"venv\" that is isolated from the system. Thus this ticket proceeds in several steps:\n \n-The proposed attachment uses `python3`: I don\u00b4t like that, but at this point `$ac_path_PYTHON3` is not yet defined. (Note: on FreeBSD we have no python3 by default, and I have to patch it with the real versioned program name, but I guess that `python3` is more portable)\n+1. Add an `--enable-system-site-packages` flag to the top-level `./configure` script. When present, this will tell `sage-venv` that the venv it creates **should not** be isolated from the system.\n+2. Create a new macro that can detect python packages on the system. It should ensure that the version bounds in each python package's `install-requires.txt` are met.\n+3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.\n+4. Test everything thoroughly with various combinations of system and non-system python packages.\n \n-To build Sage with it, `build/make/install` must be modified: it sets `PYTHONPATH` to `$SAGE_LOCAL`, and the system-wide Python modules are not found. It must be replaced by something like\n-\n-```\n-\"$SAGE_LOCAL:$SAGE_LOCAL/$PYTHON_SITELIBDIR:$PYTHON_SITELIBDIR\"\n-```\n-\n-with `$PYTHON_SITELIBDIR` being the site-packages directory used. So the Sage-built packages are always found in the first place, and those from the system are found when needed.\n``````\n",
    "created_at": "2021-10-13T12:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467193",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,9 @@
-This ticket adds an spkg-configure.m4 for cvxopt, in order to use it from a system package if possible (see #27330).
+This ticket adds an spkg-configure.m4 for cvxopt and various other python packages, to allow them to be used from the system (part of #27330).
 
-This one is a bit special, because cvxopt is a Python module.
+These python packages are special because we currently use a python "venv" that is isolated from the system. Thus this ticket proceeds in several steps:
 
-The proposed attachment uses `python3`: I don´t like that, but at this point `$ac_path_PYTHON3` is not yet defined. (Note: on FreeBSD we have no python3 by default, and I have to patch it with the real versioned program name, but I guess that `python3` is more portable)
+1. Add an `--enable-system-site-packages` flag to the top-level `./configure` script. When present, this will tell `sage-venv` that the venv it creates **should not** be isolated from the system.
+2. Create a new macro that can detect python packages on the system. It should ensure that the version bounds in each python package's `install-requires.txt` are met.
+3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.
+4. Test everything thoroughly with various combinations of system and non-system python packages.
 
-To build Sage with it, `build/make/install` must be modified: it sets `PYTHONPATH` to `$SAGE_LOCAL`, and the system-wide Python modules are not found. It must be replaced by something like
-
-```
-"$SAGE_LOCAL:$SAGE_LOCAL/$PYTHON_SITELIBDIR:$PYTHON_SITELIBDIR"
-```
-
-with `$PYTHON_SITELIBDIR` being the site-packages directory used. So the Sage-built packages are always found in the first place, and those from the system are found when needed.
``````




---

archive/issue_comments_467194.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@mkoeppe](#comment:22):\n> Also, when `--enable-system-site-packages` has been given but system python3 is not used, this should be an error.\n\nI think this is working as intended, but I still have to check it with python3 installed from an SPKG. The intention is that `--enable-system-site-packages` will only attempt to use packages from the system; not force it. If we're using python from the SPKG, the macro should always fail (this is in its documentation), and thus we'll use SPKGs for all of the python stuff.\n\nI don't think we need to bail out with an error unless that process can somehow do the wrong thing?",
    "created_at": "2021-10-13T12:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467194",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@mkoeppe](#comment:22):
> Also, when `--enable-system-site-packages` has been given but system python3 is not used, this should be an error.

I think this is working as intended, but I still have to check it with python3 installed from an SPKG. The intention is that `--enable-system-site-packages` will only attempt to use packages from the system; not force it. If we're using python from the SPKG, the macro should always fail (this is in its documentation), and thus we'll use SPKGs for all of the python stuff.

I don't think we need to bail out with an error unless that process can somehow do the wrong thing?



---

archive/issue_comments_467195.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nUser expectations -- users may be interested in this option because they want to actually use system Python packages (which we don't have as SPKG), not just save time on installation. So it's best to tell them upfront that it won't work, instead of making them go through an hours-long build and failure and mailing list Q&A.",
    "created_at": "2021-10-13T16:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467195",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

User expectations -- users may be interested in this option because they want to actually use system Python packages (which we don't have as SPKG), not just save time on installation. So it's best to tell them upfront that it won't work, instead of making them go through an hours-long build and failure and mailing list Q&A.



---

archive/issue_comments_467196.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@mkoeppe](#comment:25):\n> User expectations -- users may be interested in this option because they want to actually use system Python packages (which we don't have as SPKG), not just save time on installation. So it's best to tell them upfront that it won't work, instead of making them go through an hours-long build and failure and mailing list Q&A.\n\nWe could make that possible with another option, like `--enable-user-site-packages`, that would undo the intentional breakage in sage-env:\n\n```python\n# Set PYTHONUSERBASE to avoid picking up non-Sage versions of\n# Matplotlib, numpy, etc. See http://trac.sagemath.org/ticket/19612.\n#\n# For more history (it used to be PYTHONNOUSERSITE=yes which killed\n# the ability to do \"sage -pip install PACKAGE --user\"), see\n# http://trac.sagemath.org/ticket/14243 and\n# http://trac.sagemath.org/ticket/18955.\n\nif [ \"$PYTHONUSERBASE\" = \"\" ]; then\n    PYTHONUSERBASE=\"$DOT_SAGE/local\"\n    export PYTHONUSERBASE\nfi\n```\n\nThe \"system\" site packages do work either way... you're just getting a different \"system\" with the SPKG than you would with `/usr/bin/python3`. Regardless, I only build with `--with-system-python3=force`, so I won't belabor this distinction.\n\nI'll change `--enable-system-site-packages` to set `--with-system-python3=force`.",
    "created_at": "2021-10-13T17:26:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467196",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@mkoeppe](#comment:25):
> User expectations -- users may be interested in this option because they want to actually use system Python packages (which we don't have as SPKG), not just save time on installation. So it's best to tell them upfront that it won't work, instead of making them go through an hours-long build and failure and mailing list Q&A.

We could make that possible with another option, like `--enable-user-site-packages`, that would undo the intentional breakage in sage-env:

```python
# Set PYTHONUSERBASE to avoid picking up non-Sage versions of
# Matplotlib, numpy, etc. See http://trac.sagemath.org/ticket/19612.
#
# For more history (it used to be PYTHONNOUSERSITE=yes which killed
# the ability to do "sage -pip install PACKAGE --user"), see
# http://trac.sagemath.org/ticket/14243 and
# http://trac.sagemath.org/ticket/18955.

if [ "$PYTHONUSERBASE" = "" ]; then
    PYTHONUSERBASE="$DOT_SAGE/local"
    export PYTHONUSERBASE
fi
```

The "system" site packages do work either way... you're just getting a different "system" with the SPKG than you would with `/usr/bin/python3`. Regardless, I only build with `--with-system-python3=force`, so I won't belabor this distinction.

I'll change `--enable-system-site-packages` to set `--with-system-python3=force`.



---

archive/issue_comments_467197.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI was talking about system site packages.\n\nReplying to [@orlitzky](#comment:26):\n> The \"system\" site packages do work either way... you're just getting a different \"system\" with the SPKG than you would with `/usr/bin/python3`. \n\nI know that, you know that, I know that you know that, etc., but users don't.\n\n> I'll change `--enable-system-site-packages` to set `--with-system-python3=force`.\n\nGreat, thanks.",
    "created_at": "2021-10-13T17:40:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467197",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

I was talking about system site packages.

Replying to [@orlitzky](#comment:26):
> The "system" site packages do work either way... you're just getting a different "system" with the SPKG than you would with `/usr/bin/python3`. 

I know that, you know that, I know that you know that, etc., but users don't.

> I'll change `--enable-system-site-packages` to set `--with-system-python3=force`.

Great, thanks.



---

archive/issue_comments_467198.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@orlitzky](#comment:26):\n> another option, like `--enable-user-site-packages`, that would undo the intentional breakage in sage-env:\n> \n> ```python\n> # Set PYTHONUSERBASE to avoid picking up non-Sage versions of\n> ```\n\nActually in venvs, the user scheme is altogether disabled by Python - see https://packaging.python.org/tutorials/installing-packages/#installing-to-the-user-site",
    "created_at": "2021-10-13T17:41:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467198",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@orlitzky](#comment:26):
> another option, like `--enable-user-site-packages`, that would undo the intentional breakage in sage-env:
> 
> ```python
> # Set PYTHONUSERBASE to avoid picking up non-Sage versions of
> ```

Actually in venvs, the user scheme is altogether disabled by Python - see https://packaging.python.org/tutorials/installing-packages/#installing-to-the-user-site



---

archive/issue_comments_467199.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e8c004a9ff03b67470fed876c379e5173041ccd\"><code>8e8c004</code></a></td><td><code>Trac #29665: force system python3 with --enable-system-site-packages.</code></td></tr></table>\n",
    "created_at": "2021-10-14T12:15:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467199",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e8c004a9ff03b67470fed876c379e5173041ccd"><code>8e8c004</code></a></td><td><code>Trac #29665: force system python3 with --enable-system-site-packages.</code></td></tr></table>




---

archive/issue_comments_467200.json:
```json
{
    "body": "Changed commit from **[`6a5246d`](https://github.com/sagemath/sagetrac-mirror/commit/6a5246dbbc980ebf97dd6b1fba70e58d198d9db3)** to **[`8e8c004`](https://github.com/sagemath/sagetrac-mirror/commit/8e8c004a9ff03b67470fed876c379e5173041ccd)**",
    "created_at": "2021-10-14T12:15:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467200",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6a5246d`](https://github.com/sagemath/sagetrac-mirror/commit/6a5246dbbc980ebf97dd6b1fba70e58d198d9db3)** to **[`8e8c004`](https://github.com/sagemath/sagetrac-mirror/commit/8e8c004a9ff03b67470fed876c379e5173041ccd)**



---

archive/issue_comments_467201.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nFeels too easy for something involving autotools, but that last commit looks like it does the trick.",
    "created_at": "2021-10-14T12:16:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467201",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:30" align="right">comment:30</div>

Feels too easy for something involving autotools, but that last commit looks like it does the trick.



---

archive/issue_comments_467202.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThe next thing is that at the end of configure, it now recommends to install system python packages -- which is useless (unless the experimental new option is used) and potentially will confuse users.",
    "created_at": "2021-10-14T20:43:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467202",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

The next thing is that at the end of configure, it now recommends to install system python packages -- which is useless (unless the experimental new option is used) and potentially will confuse users.



---

archive/issue_comments_467203.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSo perhaps instead of supplying `spkg-configure.m4` files, in `m4/sage_spkg_collect.m4` if a package does not have `spkg-configure.m4` but it has `install-requires.txt`, just run the test?",
    "created_at": "2021-10-14T20:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467203",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

So perhaps instead of supplying `spkg-configure.m4` files, in `m4/sage_spkg_collect.m4` if a package does not have `spkg-configure.m4` but it has `install-requires.txt`, just run the test?



---

archive/issue_comments_467204.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nis it distinguishing system and user-installed python packages?",
    "created_at": "2021-10-14T20:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467204",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">comment:33</div>

is it distinguishing system and user-installed python packages?



---

archive/issue_comments_467205.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nsee [comment:28](#comment:28)",
    "created_at": "2021-10-14T21:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467205",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

see [comment:28](#comment:28)



---

archive/issue_comments_467206.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThe new test in m4/sage_python_package_check.m4 should really be run with a venv, not the `PYTHON_FOR_VENV` directly -- or, as per Dima's comment, you would need to poison the user scheme in another way, so that the configure test does not take user packages into account.",
    "created_at": "2021-10-14T21:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467206",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

The new test in m4/sage_python_package_check.m4 should really be run with a venv, not the `PYTHON_FOR_VENV` directly -- or, as per Dima's comment, you would need to poison the user scheme in another way, so that the configure test does not take user packages into account.



---

archive/issue_comments_467207.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nAn easy way to do this is could be to run these tests as part of the `python3` spkg-configure.m4, which already creates a venv for testing",
    "created_at": "2021-10-14T22:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467207",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

An easy way to do this is could be to run these tests as part of the `python3` spkg-configure.m4, which already creates a venv for testing



---

archive/issue_comments_467208.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@mkoeppe](#comment:31):\n> The next thing is that at the end of configure, it now recommends to install system python packages -- which is useless (unless the experimental new option is used) and potentially will confuse users.\n\nThis, at least, is easy: we can delete `distros/` for the python packages all in one commit. Then whenever we intend to actually use that information, it can be `git revert`ed.",
    "created_at": "2021-10-14T22:54:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467208",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@mkoeppe](#comment:31):
> The next thing is that at the end of configure, it now recommends to install system python packages -- which is useless (unless the experimental new option is used) and potentially will confuse users.

This, at least, is easy: we can delete `distros/` for the python packages all in one commit. Then whenever we intend to actually use that information, it can be `git revert`ed.



---

archive/issue_comments_467209.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@mkoeppe](#comment:35):\n> The new test in m4/sage_python_package_check.m4 should really be run with a venv, not the `PYTHON_FOR_VENV` directly -- or, as per Dima's comment, you would need to poison the user scheme in another way, so that the configure test does not take user packages into account.\n\nShould we not poison `PYTHONUSERBASE` in the same way that sage-env does it? That way the test and what you get at runtime is at least consistent.",
    "created_at": "2021-10-14T22:56:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467209",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@mkoeppe](#comment:35):
> The new test in m4/sage_python_package_check.m4 should really be run with a venv, not the `PYTHON_FOR_VENV` directly -- or, as per Dima's comment, you would need to poison the user scheme in another way, so that the configure test does not take user packages into account.

Should we not poison `PYTHONUSERBASE` in the same way that sage-env does it? That way the test and what you get at runtime is at least consistent.



---

archive/issue_comments_467210.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nNo, see [comment:28](#comment:28): `PYTHONUSERBASE` does not matter because for venvs, the user installation scheme is already disabled by Python.",
    "created_at": "2021-10-15T03:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467210",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

No, see [comment:28](#comment:28): `PYTHONUSERBASE` does not matter because for venvs, the user installation scheme is already disabled by Python.



---

archive/issue_comments_467211.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@mkoeppe](#comment:39):\n> No, see [comment:28](#comment:28): `PYTHONUSERBASE` does not matter because for venvs, the user installation scheme is already disabled by Python.\n\nOh, right. Do you see any reason why I shouldn't delete that code from sage-env, then?",
    "created_at": "2021-10-15T03:47:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467211",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@mkoeppe](#comment:39):
> No, see [comment:28](#comment:28): `PYTHONUSERBASE` does not matter because for venvs, the user installation scheme is already disabled by Python.

Oh, right. Do you see any reason why I shouldn't delete that code from sage-env, then?



---

archive/issue_comments_467212.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nActually I have to correct myself: venvs that enable system site packages do not disable the user scheme. https://github.com/python/cpython/blob/main/Lib/site.py#L533",
    "created_at": "2021-10-15T03:48:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467212",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

Actually I have to correct myself: venvs that enable system site packages do not disable the user scheme. https://github.com/python/cpython/blob/main/Lib/site.py#L533



---

archive/issue_comments_467213.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nSo the correct test in configure is to set up the venv AND to set PYTHONUSERBASE in the same way as sage-env would do.",
    "created_at": "2021-10-15T03:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467213",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

So the correct test in configure is to set up the venv AND to set PYTHONUSERBASE in the same way as sage-env would do.



---

archive/issue_comments_467214.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nOk, I have to do my actual job for about an hour but then I'll take a stab at it.",
    "created_at": "2021-10-15T03:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467214",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:43" align="right">comment:43</div>

Ok, I have to do my actual job for about an hour but then I'll take a stab at it.



---

archive/issue_comments_467215.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c74270470c7f2501b5a9c564afeb80f7a80d32c3\"><code>c742704</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for setuptools.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02\"><code>2dafaf0</code></a></td><td><code>Trac #29665: remove \"distros\" information for python packages.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7aed5d470ca7e5e102c4f3da62eeba5133111d1e\"><code>7aed5d4</code></a></td><td><code>Trac #29665: poison PYTHONUSERBASE when testing for \"system\" packages.</code></td></tr></table>\n",
    "created_at": "2021-10-15T05:21:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467215",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c74270470c7f2501b5a9c564afeb80f7a80d32c3"><code>c742704</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for setuptools.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02"><code>2dafaf0</code></a></td><td><code>Trac #29665: remove "distros" information for python packages.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7aed5d470ca7e5e102c4f3da62eeba5133111d1e"><code>7aed5d4</code></a></td><td><code>Trac #29665: poison PYTHONUSERBASE when testing for "system" packages.</code></td></tr></table>




---

archive/issue_comments_467216.json:
```json
{
    "body": "Changed commit from **[`8e8c004`](https://github.com/sagemath/sagetrac-mirror/commit/8e8c004a9ff03b67470fed876c379e5173041ccd)** to **[`7aed5d4`](https://github.com/sagemath/sagetrac-mirror/commit/7aed5d470ca7e5e102c4f3da62eeba5133111d1e)**",
    "created_at": "2021-10-15T05:21:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467216",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8e8c004`](https://github.com/sagemath/sagetrac-mirror/commit/8e8c004a9ff03b67470fed876c379e5173041ccd)** to **[`7aed5d4`](https://github.com/sagemath/sagetrac-mirror/commit/7aed5d470ca7e5e102c4f3da62eeba5133111d1e)**



---

archive/issue_comments_467217.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI'll have to look into using a venv tomorrow. What's there now is an improvement, though.",
    "created_at": "2021-10-15T05:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467217",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:45" align="right">comment:45</div>

I'll have to look into using a venv tomorrow. What's there now is an improvement, though.



---

archive/issue_comments_467218.json:
```json
{
    "body": "Changed commit from **[`7aed5d4`](https://github.com/sagemath/sagetrac-mirror/commit/7aed5d470ca7e5e102c4f3da62eeba5133111d1e)** to **[`05a846c`](https://github.com/sagemath/sagetrac-mirror/commit/05a846c51df4167afaad964ec39ae384f1692101)**",
    "created_at": "2021-10-15T17:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467218",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7aed5d4`](https://github.com/sagemath/sagetrac-mirror/commit/7aed5d470ca7e5e102c4f3da62eeba5133111d1e)** to **[`05a846c`](https://github.com/sagemath/sagetrac-mirror/commit/05a846c51df4167afaad964ec39ae384f1692101)**



---

archive/issue_comments_467219.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d00cdbbb63a78c44d688f861ba4f83ba0049e8b4\"><code>d00cdbb</code></a></td><td><code>Trac #29665: run SAGE_PYTHON_PACKAGE_CHECK() inside a venv.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1d927b7963e4c2f15df65e6ba1f0e0f1c1b1c55\"><code>f1d927b</code></a></td><td><code>Trac #29665: log SAGE_PYTHON_PACKAGE_CHECK() failures to config.log.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05a846c51df4167afaad964ec39ae384f1692101\"><code>05a846c</code></a></td><td><code>Trac #29665: don't clobber a plain file named config.venv.</code></td></tr></table>\n",
    "created_at": "2021-10-15T17:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467219",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d00cdbbb63a78c44d688f861ba4f83ba0049e8b4"><code>d00cdbb</code></a></td><td><code>Trac #29665: run SAGE_PYTHON_PACKAGE_CHECK() inside a venv.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1d927b7963e4c2f15df65e6ba1f0e0f1c1b1c55"><code>f1d927b</code></a></td><td><code>Trac #29665: log SAGE_PYTHON_PACKAGE_CHECK() failures to config.log.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05a846c51df4167afaad964ec39ae384f1692101"><code>05a846c</code></a></td><td><code>Trac #29665: don't clobber a plain file named config.venv.</code></td></tr></table>




---

archive/issue_comments_467220.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@sagetrac-git](#comment:44):\n|                                                                                                                                                 |                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove \"distros\" information for python packages.`|\n\nThat's not a good solution",
    "created_at": "2021-10-15T17:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467220",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@sagetrac-git](#comment:44):
|                                                                                                                                                 |                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove "distros" information for python packages.`|

That's not a good solution



---

archive/issue_comments_467221.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@mkoeppe](#comment:47):\n> Replying to [@sagetrac-git](#comment:44):\n\n> |                                                                                                                                                 |                                                                |\n> |-------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n> |[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove \"distros\" information for python packages.`|\n> \n> That's not a good solution\n\nI'll take a few days to try to think of something better, but removing `distros/` is going to be hard to beat for simplicity and ease of implementation. The sole purpose of those files is to do the thing you don't want to happen. Removing them prevents it, and doesn't hurt anything else.\n\nKeeping the files that cause the wrong thing to happen and then trying to stop the wrong thing from happening somewhere else is only going to push our `./configure` further down the path to Mouse Trap. These system packages already work flawlessly for me. If there are no major problems, we could enable this by default as early as sage-9.6, bring back the `distros/`, and never have to worry about if the swimmer hits the plate just right to launch the cannonball into the bathtub to disable the system package suggestion.",
    "created_at": "2021-10-15T23:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467221",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@mkoeppe](#comment:47):
> Replying to [@sagetrac-git](#comment:44):

> |                                                                                                                                                 |                                                                |
> |-------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
> |[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove "distros" information for python packages.`|
> 
> That's not a good solution

I'll take a few days to try to think of something better, but removing `distros/` is going to be hard to beat for simplicity and ease of implementation. The sole purpose of those files is to do the thing you don't want to happen. Removing them prevents it, and doesn't hurt anything else.

Keeping the files that cause the wrong thing to happen and then trying to stop the wrong thing from happening somewhere else is only going to push our `./configure` further down the path to Mouse Trap. These system packages already work flawlessly for me. If there are no major problems, we could enable this by default as early as sage-9.6, bring back the `distros/`, and never have to worry about if the swimmer hits the plate just right to launch the cannonball into the bathtub to disable the system package suggestion.



---

archive/issue_comments_467222.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nBut then how do we test that this new experimental switch actually works on a distribution?\n\nThe `distros` information is not just for the user, but also for provisioning the test environment on GH Actions etc.",
    "created_at": "2021-10-15T23:39:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467222",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">comment:49</div>

But then how do we test that this new experimental switch actually works on a distribution?

The `distros` information is not just for the user, but also for provisioning the test environment on GH Actions etc.



---

archive/issue_comments_467223.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nAnd in [comment:32](#comment:32) I have already explained a simple implementation strategy",
    "created_at": "2021-10-15T23:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467223",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">comment:50</div>

And in [comment:32](#comment:32) I have already explained a simple implementation strategy



---

archive/issue_comments_467224.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41370cb5809dbf01e9aba53353ead29479a81b10\"><code>41370cb</code></a></td><td><code>Trac #29665: poison PYTHONUSERBASE when testing for \"system\" packages.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5042a52916278334c8e25ec8d655f88a866adf56\"><code>5042a52</code></a></td><td><code>Trac #29665: run SAGE_PYTHON_PACKAGE_CHECK() inside a venv.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa3836865435106ddc42b4308765be6878cf904d\"><code>fa38368</code></a></td><td><code>Trac #29665: log SAGE_PYTHON_PACKAGE_CHECK() failures to config.log.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e77e67f37c6d39da8c394839bdcdeded2557cd5c\"><code>e77e67f</code></a></td><td><code>Trac #29665: don't clobber a plain file named config.venv.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb00721f556de97a0005b9fb6ab801a01900fb48\"><code>fb00721</code></a></td><td><code>Trac #29665: don't announce system python packages that won't be used.</code></td></tr></table>\n",
    "created_at": "2021-10-16T12:27:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467224",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41370cb5809dbf01e9aba53353ead29479a81b10"><code>41370cb</code></a></td><td><code>Trac #29665: poison PYTHONUSERBASE when testing for "system" packages.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5042a52916278334c8e25ec8d655f88a866adf56"><code>5042a52</code></a></td><td><code>Trac #29665: run SAGE_PYTHON_PACKAGE_CHECK() inside a venv.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa3836865435106ddc42b4308765be6878cf904d"><code>fa38368</code></a></td><td><code>Trac #29665: log SAGE_PYTHON_PACKAGE_CHECK() failures to config.log.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e77e67f37c6d39da8c394839bdcdeded2557cd5c"><code>e77e67f</code></a></td><td><code>Trac #29665: don't clobber a plain file named config.venv.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb00721f556de97a0005b9fb6ab801a01900fb48"><code>fb00721</code></a></td><td><code>Trac #29665: don't announce system python packages that won't be used.</code></td></tr></table>




---

archive/issue_comments_467225.json:
```json
{
    "body": "Changed commit from **[`05a846c`](https://github.com/sagemath/sagetrac-mirror/commit/05a846c51df4167afaad964ec39ae384f1692101)** to **[`fb00721`](https://github.com/sagemath/sagetrac-mirror/commit/fb00721f556de97a0005b9fb6ab801a01900fb48)**",
    "created_at": "2021-10-16T12:27:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467225",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`05a846c`](https://github.com/sagemath/sagetrac-mirror/commit/05a846c51df4167afaad964ec39ae384f1692101)** to **[`fb00721`](https://github.com/sagemath/sagetrac-mirror/commit/fb00721f556de97a0005b9fb6ab801a01900fb48)**



---

archive/issue_comments_467226.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@mkoeppe](#comment:50):\n> And in [comment:32](#comment:32) I have already explained a simple implementation strategy\n\nNot every package with an `install-requires.txt` requires `--enable-system-site-packages`. Hiding the package checks in two different places is also not great for maintainability; but more importantly, not every package uses the same check. Some have DEPCHECKs, and in the future I'm sure we'll need feature tests to ensure that e.g. matplotlib has support for our documented export formats.\n\nIn principle I'd rather hack the test setup than the build system if we have to do it for a release or two. But maybe my latest commit solves it without any collateral damage (I hope).",
    "created_at": "2021-10-16T12:35:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467226",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@mkoeppe](#comment:50):
> And in [comment:32](#comment:32) I have already explained a simple implementation strategy

Not every package with an `install-requires.txt` requires `--enable-system-site-packages`. Hiding the package checks in two different places is also not great for maintainability; but more importantly, not every package uses the same check. Some have DEPCHECKs, and in the future I'm sure we'll need feature tests to ensure that e.g. matplotlib has support for our documented export formats.

In principle I'd rather hack the test setup than the build system if we have to do it for a release or two. But maybe my latest commit solves it without any collateral damage (I hope).



---

archive/issue_comments_467227.json:
```json
{
    "body": "<div id=\"comment:53\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba6142b6b26ce8d5185f759b2165861530471b5a\"><code>ba6142b</code></a></td><td><code>Trac #29665: don't announce system python packages that won't be used.</code></td></tr></table>\n",
    "created_at": "2021-10-16T12:39:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467227",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba6142b6b26ce8d5185f759b2165861530471b5a"><code>ba6142b</code></a></td><td><code>Trac #29665: don't announce system python packages that won't be used.</code></td></tr></table>




---

archive/issue_comments_467228.json:
```json
{
    "body": "Changed commit from **[`fb00721`](https://github.com/sagemath/sagetrac-mirror/commit/fb00721f556de97a0005b9fb6ab801a01900fb48)** to **[`ba6142b`](https://github.com/sagemath/sagetrac-mirror/commit/ba6142b6b26ce8d5185f759b2165861530471b5a)**",
    "created_at": "2021-10-16T12:39:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467228",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fb00721`](https://github.com/sagemath/sagetrac-mirror/commit/fb00721f556de97a0005b9fb6ab801a01900fb48)** to **[`ba6142b`](https://github.com/sagemath/sagetrac-mirror/commit/ba6142b6b26ce8d5185f759b2165861530471b5a)**



---

archive/issue_events_405136.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-16T21:03:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "title_is": "configure --enable-system-site-packages via spkg-configure.m4 for cvxopt and other python packages",
    "title_was": "spkg-configure.m4 for cvxopt and other python packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405136"
}
```



---

archive/issue_comments_467229.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,6 @@\n 3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.\n 4. Test everything thoroughly with various combinations of system and non-system python packages.\n \n+Platform-specific testing:\n+- for example `EXTRA_CONFIGURE_ARGS=\"--enable-system-site-packages\" tox -e docker-ubuntu-focal-standard -- build ptest`\n+\n``````\n",
    "created_at": "2021-10-16T21:16:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467229",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,6 @@
 3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.
 4. Test everything thoroughly with various combinations of system and non-system python packages.
 
+Platform-specific testing:
+- for example `EXTRA_CONFIGURE_ARGS="--enable-system-site-packages" tox -e docker-ubuntu-focal-standard -- build ptest`
+
``````




---

archive/issue_comments_467230.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nTo test this more thoroughly,\n- we need many more `distros/` files for various platforms\n- need a GH Actions workflow to automate this - see #32703 for a possible approach",
    "created_at": "2021-10-16T21:17:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467230",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:56" align="right">comment:56</div>

To test this more thoroughly,
- we need many more `distros/` files for various platforms
- need a GH Actions workflow to automate this - see #32703 for a possible approach



---

archive/issue_comments_467231.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,5 +8,5 @@\n 4. Test everything thoroughly with various combinations of system and non-system python packages.\n \n Platform-specific testing:\n-- for example `EXTRA_CONFIGURE_ARGS=\"--enable-system-site-packages\" tox -e docker-ubuntu-focal-standard -- build ptest`\n+- for example `TARGETS_PRE=\"build-local\" EXTRA_CONFIGURE_ARGS=\"--enable-system-site-packages\" tox -e docker-ubuntu-focal-standard -- build ptest`\n \n``````\n",
    "created_at": "2021-10-16T23:47:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467231",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,5 +8,5 @@
 4. Test everything thoroughly with various combinations of system and non-system python packages.
 
 Platform-specific testing:
-- for example `EXTRA_CONFIGURE_ARGS="--enable-system-site-packages" tox -e docker-ubuntu-focal-standard -- build ptest`
+- for example `TARGETS_PRE="build-local" EXTRA_CONFIGURE_ARGS="--enable-system-site-packages" tox -e docker-ubuntu-focal-standard -- build ptest`
 
``````




---

archive/issue_comments_467232.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a463d1cc90080fe89c734898b975ed80d0334073\"><code>a463d1c</code></a></td><td><code>Trac #29665: add Gentoo package information for python packages.</code></td></tr></table>\n",
    "created_at": "2021-10-17T10:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467232",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a463d1cc90080fe89c734898b975ed80d0334073"><code>a463d1c</code></a></td><td><code>Trac #29665: add Gentoo package information for python packages.</code></td></tr></table>




---

archive/issue_comments_467233.json:
```json
{
    "body": "Changed commit from **[`ba6142b`](https://github.com/sagemath/sagetrac-mirror/commit/ba6142b6b26ce8d5185f759b2165861530471b5a)** to **[`a463d1c`](https://github.com/sagemath/sagetrac-mirror/commit/a463d1cc90080fe89c734898b975ed80d0334073)**",
    "created_at": "2021-10-17T10:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467233",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ba6142b`](https://github.com/sagemath/sagetrac-mirror/commit/ba6142b6b26ce8d5185f759b2165861530471b5a)** to **[`a463d1c`](https://github.com/sagemath/sagetrac-mirror/commit/a463d1cc90080fe89c734898b975ed80d0334073)**



---

archive/issue_comments_467234.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nWhen the new experimental option is not used, the configure tests should probably say something like \"skipping test, only available with --enable-system-site-packages (experimental)\" before it concludes \"no suitable system package found\"",
    "created_at": "2021-10-18T01:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467234",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

When the new experimental option is not used, the configure tests should probably say something like "skipping test, only available with --enable-system-site-packages (experimental)" before it concludes "no suitable system package found"



---

archive/issue_comments_467235.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)** to **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)**",
    "created_at": "2021-10-18T01:43:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467235",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)** to **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)**



---

archive/issue_comments_467236.json:
```json
{
    "body": "<div id=\"comment:61\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f42d7559ba85cbb2c3846f05196b773e5e00c59a\"><code>f42d755</code></a></td><td><code>build/pkgs: Add distros/arch.txt for Python packages</code></td></tr></table>\n",
    "created_at": "2021-10-18T04:04:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467236",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:61"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f42d7559ba85cbb2c3846f05196b773e5e00c59a"><code>f42d755</code></a></td><td><code>build/pkgs: Add distros/arch.txt for Python packages</code></td></tr></table>




---

archive/issue_comments_467237.json:
```json
{
    "body": "Changed commit from **[`a463d1c`](https://github.com/sagemath/sagetrac-mirror/commit/a463d1cc90080fe89c734898b975ed80d0334073)** to **[`f42d755`](https://github.com/sagemath/sagetrac-mirror/commit/f42d7559ba85cbb2c3846f05196b773e5e00c59a)**",
    "created_at": "2021-10-18T04:04:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467237",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a463d1c`](https://github.com/sagemath/sagetrac-mirror/commit/a463d1cc90080fe89c734898b975ed80d0334073)** to **[`f42d755`](https://github.com/sagemath/sagetrac-mirror/commit/f42d7559ba85cbb2c3846f05196b773e5e00c59a)**



---

archive/issue_comments_467238.json:
```json
{
    "body": "<div id=\"comment:62\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82fe0f14b4d5ad052f164b2e825a187e00164ab3\"><code>82fe0f1</code></a></td><td><code>build/pkgs: Add distros/opensuse.txt for Python packages</code></td></tr></table>\n",
    "created_at": "2021-10-18T04:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467238",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:62"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82fe0f14b4d5ad052f164b2e825a187e00164ab3"><code>82fe0f1</code></a></td><td><code>build/pkgs: Add distros/opensuse.txt for Python packages</code></td></tr></table>




---

archive/issue_comments_467239.json:
```json
{
    "body": "Changed commit from **[`f42d755`](https://github.com/sagemath/sagetrac-mirror/commit/f42d7559ba85cbb2c3846f05196b773e5e00c59a)** to **[`82fe0f1`](https://github.com/sagemath/sagetrac-mirror/commit/82fe0f14b4d5ad052f164b2e825a187e00164ab3)**",
    "created_at": "2021-10-18T04:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467239",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f42d755`](https://github.com/sagemath/sagetrac-mirror/commit/f42d7559ba85cbb2c3846f05196b773e5e00c59a)** to **[`82fe0f1`](https://github.com/sagemath/sagetrac-mirror/commit/82fe0f14b4d5ad052f164b2e825a187e00164ab3)**



---

archive/issue_comments_467240.json:
```json
{
    "body": "<div id=\"comment:63\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72\"><code>a4608ae</code></a></td><td><code>build/pkgs: Add distros/debian.txt for Python packages</code></td></tr></table>\n",
    "created_at": "2021-10-18T05:45:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467240",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:63"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72"><code>a4608ae</code></a></td><td><code>build/pkgs: Add distros/debian.txt for Python packages</code></td></tr></table>




---

archive/issue_comments_467241.json:
```json
{
    "body": "Changed commit from **[`82fe0f1`](https://github.com/sagemath/sagetrac-mirror/commit/82fe0f14b4d5ad052f164b2e825a187e00164ab3)** to **[`a4608ae`](https://github.com/sagemath/sagetrac-mirror/commit/a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72)**",
    "created_at": "2021-10-18T05:45:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467241",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`82fe0f1`](https://github.com/sagemath/sagetrac-mirror/commit/82fe0f14b4d5ad052f164b2e825a187e00164ab3)** to **[`a4608ae`](https://github.com/sagemath/sagetrac-mirror/commit/a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72)**



---

archive/issue_comments_467242.json:
```json
{
    "body": "<div id=\"comment:64\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4406798fcbfd5918d187591e84b28221676f4f57\"><code>4406798</code></a></td><td><code>Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58\"><code>bf1eb35</code></a></td><td><code>Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.</code></td></tr></table>\n",
    "created_at": "2021-10-18T12:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467242",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:64"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4406798fcbfd5918d187591e84b28221676f4f57"><code>4406798</code></a></td><td><code>Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58"><code>bf1eb35</code></a></td><td><code>Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.</code></td></tr></table>




---

archive/issue_comments_467243.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)** to **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)**",
    "created_at": "2021-10-18T12:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467243",
    "user": "https://github.com/orlitzky"
}
```

Changed branch from **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)** to **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)**



---

archive/issue_comments_467244.json:
```json
{
    "body": "Changed commit from **[`a4608ae`](https://github.com/sagemath/sagetrac-mirror/commit/a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72)** to **[`bf1eb35`](https://github.com/sagemath/sagetrac-mirror/commit/bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58)**",
    "created_at": "2021-10-18T12:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467244",
    "user": "https://github.com/orlitzky"
}
```

Changed commit from **[`a4608ae`](https://github.com/sagemath/sagetrac-mirror/commit/a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72)** to **[`bf1eb35`](https://github.com/sagemath/sagetrac-mirror/commit/bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58)**



---

archive/issue_comments_467245.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)** to **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)**",
    "created_at": "2021-10-23T23:45:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467245",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)** to **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)**



---

archive/issue_comments_467246.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nTested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:\nIt thinks that `setuptools` is available, but then it isn't\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eeae67cbb372cf215a7498200d25c8e402d60296\"><code>eeae67c</code></a></td><td><code>Merge tag '9.5.beta4' into t/29665/ticket/29665</code></td></tr></table>\n",
    "created_at": "2021-10-24T20:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467246",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">comment:66</div>

Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:
It thinks that `setuptools` is available, but then it isn't

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eeae67cbb372cf215a7498200d25c8e402d60296"><code>eeae67c</code></a></td><td><code>Merge tag '9.5.beta4' into t/29665/ticket/29665</code></td></tr></table>




---

archive/issue_events_405137.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-24T20:21:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405137"
}
```



---

archive/issue_events_405138.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-24T20:21:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405138"
}
```



---

archive/issue_comments_467247.json:
```json
{
    "body": "Changed commit from **[`bf1eb35`](https://github.com/sagemath/sagetrac-mirror/commit/bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58)** to **[`eeae67c`](https://github.com/sagemath/sagetrac-mirror/commit/eeae67cbb372cf215a7498200d25c8e402d60296)**",
    "created_at": "2021-10-24T20:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467247",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`bf1eb35`](https://github.com/sagemath/sagetrac-mirror/commit/bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58)** to **[`eeae67c`](https://github.com/sagemath/sagetrac-mirror/commit/eeae67cbb372cf215a7498200d25c8e402d60296)**



---

archive/issue_comments_467248.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@mkoeppe](#comment:66):\n> Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:\n> It thinks that `setuptools` is available, but then it isn't\n\nYou sure setuptools isn't there? The new autoconf macro uses it to check for all of the other packages. If the whole thing is not crashing and burning (and if I did not flip an exit code somewhere...) setuptools is probably there.\n\nMaybe something to do with `export PYTHONPATH=\"$(pwd)/src\"` in pip's `spkg-install.in`.",
    "created_at": "2021-10-24T21:16:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467248",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@mkoeppe](#comment:66):
> Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:
> It thinks that `setuptools` is available, but then it isn't

You sure setuptools isn't there? The new autoconf macro uses it to check for all of the other packages. If the whole thing is not crashing and burning (and if I did not flip an exit code somewhere...) setuptools is probably there.

Maybe something to do with `export PYTHONPATH="$(pwd)/src"` in pip's `spkg-install.in`.



---

archive/issue_comments_467249.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@orlitzky](#comment:67):\n> Replying to [@mkoeppe](#comment:66):\n> > Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:\n> > It thinks that `setuptools` is available, but then it isn't\n\n> \n> You sure setuptools isn't there? The new autoconf macro uses it to check for all of the other packages. If the whole thing is not crashing and burning (and if I did not flip an exit code somewhere...) setuptools is probably there.\n\nWell, it is probably present in the test venv. But as you can see in the test, it's not present in the venv at build time.",
    "created_at": "2021-10-24T21:20:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467249",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@orlitzky](#comment:67):
> Replying to [@mkoeppe](#comment:66):
> > Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:
> > It thinks that `setuptools` is available, but then it isn't

> 
> You sure setuptools isn't there? The new autoconf macro uses it to check for all of the other packages. If the whole thing is not crashing and burning (and if I did not flip an exit code somewhere...) setuptools is probably there.

Well, it is probably present in the test venv. But as you can see in the test, it's not present in the venv at build time.



---

archive/issue_comments_467250.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@orlitzky](#comment:67):\n> Maybe something to do with `export PYTHONPATH=\"$(pwd)/src\"` in pip's `spkg-install.in`.\n\nI don't think so.",
    "created_at": "2021-10-24T21:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467250",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@orlitzky](#comment:67):
> Maybe something to do with `export PYTHONPATH="$(pwd)/src"` in pip's `spkg-install.in`.

I don't think so.



---

archive/issue_comments_467251.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nIs `python3` not the `$PYTHON_FOR_VENV` on this machine? The `sdh_*` scripts call `python3` directly, while the macro uses `$PYTHON_FOR_VENV`. That's the only thing I can think of.",
    "created_at": "2021-10-24T21:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467251",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:70" align="right">comment:70</div>

Is `python3` not the `$PYTHON_FOR_VENV` on this machine? The `sdh_*` scripts call `python3` directly, while the macro uses `$PYTHON_FOR_VENV`. That's the only thing I can think of.



---

archive/issue_comments_467252.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@orlitzky](#comment:70):\n> The `sdh_*` scripts call `python3` directly\n\n... because they run with the venv activated. This is correct.",
    "created_at": "2021-10-24T22:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467252",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@orlitzky](#comment:70):
> The `sdh_*` scripts call `python3` directly

... because they run with the venv activated. This is correct.



---

archive/issue_comments_467253.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\n\n```\n+    dnl Use --clear because ./configure typically clobbers its output files.\n+    AS_IF([\"${PYTHON_FOR_VENV}\" -m venv --system-site-packages dnl\n+                                        --clear                dnl\n+                                        --without-pip          dnl\n+                                        config.venv            dnl\n+                                        2>&AS_MESSAGE_LOG_FD], [\n```\nI think you should change this to use the `sage-venv` script, like `m4/sage_check_python_for_venv.m4` does.",
    "created_at": "2021-10-24T22:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467253",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:72" align="right">comment:72</div>


```
+    dnl Use --clear because ./configure typically clobbers its output files.
+    AS_IF(["${PYTHON_FOR_VENV}" -m venv --system-site-packages dnl
+                                        --clear                dnl
+                                        --without-pip          dnl
+                                        config.venv            dnl
+                                        2>&AS_MESSAGE_LOG_FD], [
```
I think you should change this to use the `sage-venv` script, like `m4/sage_check_python_for_venv.m4` does.



---

archive/issue_comments_467254.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\n(I don't know if this will change anything -- but it's best to use the script that we actually use to set up the production venv to set up the test venv.)",
    "created_at": "2021-10-24T22:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467254",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:73" align="right">comment:73</div>

(I don't know if this will change anything -- but it's best to use the script that we actually use to set up the production venv to set up the test venv.)



---

archive/issue_comments_467255.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@mkoeppe](#comment:73):\n> (I don't know if this will change anything -- but it's best to use the script that we actually use to set up the production venv to set up the test venv.)\n\nWhat does this script abstract, anyway? It's only called in two places so far (`build/make/Makefile.in` and `m4/sage_check_python_for_venv.m4`, and in both places we have access to the full path to the python interpreter and the flags that should be passed to `-m venv` (now called `$SAGE_VENV_FLAGS`).\n\nIf the only thing it does is handle `--symlinks`, then we could add `--symlinks` to `$SAGE_VENV_FLAGS` in `configure.ac` dependent upon the platform and avoid the separate script that just reimplements `-m venv`.",
    "created_at": "2021-10-24T22:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467255",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@mkoeppe](#comment:73):
> (I don't know if this will change anything -- but it's best to use the script that we actually use to set up the production venv to set up the test venv.)

What does this script abstract, anyway? It's only called in two places so far (`build/make/Makefile.in` and `m4/sage_check_python_for_venv.m4`, and in both places we have access to the full path to the python interpreter and the flags that should be passed to `-m venv` (now called `$SAGE_VENV_FLAGS`).

If the only thing it does is handle `--symlinks`, then we could add `--symlinks` to `$SAGE_VENV_FLAGS` in `configure.ac` dependent upon the platform and avoid the separate script that just reimplements `-m venv`.



---

archive/issue_comments_467256.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nClearly outside the scope of this ticket to make changes to the well-working `sage-venv` script.",
    "created_at": "2021-10-24T23:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467256",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:75" align="right">comment:75</div>

Clearly outside the scope of this ticket to make changes to the well-working `sage-venv` script.



---

archive/issue_comments_467257.json:
```json
{
    "body": "Changed commit from **[`eeae67c`](https://github.com/sagemath/sagetrac-mirror/commit/eeae67cbb372cf215a7498200d25c8e402d60296)** to **[`a11dd26`](https://github.com/sagemath/sagetrac-mirror/commit/a11dd268ec49371faf835b92f434e05e4ffb3485)**",
    "created_at": "2021-10-25T00:42:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467257",
    "user": "https://github.com/orlitzky"
}
```

Changed commit from **[`eeae67c`](https://github.com/sagemath/sagetrac-mirror/commit/eeae67cbb372cf215a7498200d25c8e402d60296)** to **[`a11dd26`](https://github.com/sagemath/sagetrac-mirror/commit/a11dd268ec49371faf835b92f434e05e4ffb3485)**



---

archive/issue_comments_467258.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)** to **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)**",
    "created_at": "2021-10-25T00:42:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467258",
    "user": "https://github.com/orlitzky"
}
```

Changed branch from **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)** to **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)**



---

archive/issue_comments_467259.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nI dropped the toml commit because somebody else added an `spkg-configure.m4` in the meantime and I don't want to worry about reconciling them.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13d708706420b9d03377bfb2bf4bd198536e739a\"><code>13d7087</code></a></td><td><code>Trac #29665: don't clobber a plain file named config.venv.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb0311aff6f48de2d91667ed87207b08c6723fb7\"><code>cb0311a</code></a></td><td><code>Trac #29665: don't announce system python packages that won't be used.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b81ac52c545ed923e83ee60324fb4451bb69524f\"><code>b81ac52</code></a></td><td><code>Trac #29665: add Gentoo package information for python packages.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a9f0d4df82c1ca398e5c394b783e32ad788b08e\"><code>5a9f0d4</code></a></td><td><code>build/pkgs: Add distros/fedora.txt for Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d235c1793aa1b430162d275bf041f24c029b3c89\"><code>d235c17</code></a></td><td><code>build/pkgs: Add distros/arch.txt for Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4e323d52682733d709e6dcd22d89db792010655\"><code>d4e323d</code></a></td><td><code>build/pkgs: Add distros/opensuse.txt for Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0458001f2b95b873837b4018df1d2c364335677b\"><code>0458001</code></a></td><td><code>build/pkgs: Add distros/debian.txt for Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a77b85cb7a675a7dffc17c5fe343d3991967418a\"><code>a77b85c</code></a></td><td><code>Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d5b0a5c6958d0e623da7c25d9ce0e8abcd0781a\"><code>9d5b0a5</code></a></td><td><code>Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a11dd268ec49371faf835b92f434e05e4ffb3485\"><code>a11dd26</code></a></td><td><code>Trac #29665: use sage-venv in SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr></table>\n",
    "created_at": "2021-10-25T00:42:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467259",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:76" align="right">comment:76</div>

I dropped the toml commit because somebody else added an `spkg-configure.m4` in the meantime and I don't want to worry about reconciling them.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13d708706420b9d03377bfb2bf4bd198536e739a"><code>13d7087</code></a></td><td><code>Trac #29665: don't clobber a plain file named config.venv.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb0311aff6f48de2d91667ed87207b08c6723fb7"><code>cb0311a</code></a></td><td><code>Trac #29665: don't announce system python packages that won't be used.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b81ac52c545ed923e83ee60324fb4451bb69524f"><code>b81ac52</code></a></td><td><code>Trac #29665: add Gentoo package information for python packages.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a9f0d4df82c1ca398e5c394b783e32ad788b08e"><code>5a9f0d4</code></a></td><td><code>build/pkgs: Add distros/fedora.txt for Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d235c1793aa1b430162d275bf041f24c029b3c89"><code>d235c17</code></a></td><td><code>build/pkgs: Add distros/arch.txt for Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4e323d52682733d709e6dcd22d89db792010655"><code>d4e323d</code></a></td><td><code>build/pkgs: Add distros/opensuse.txt for Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0458001f2b95b873837b4018df1d2c364335677b"><code>0458001</code></a></td><td><code>build/pkgs: Add distros/debian.txt for Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a77b85cb7a675a7dffc17c5fe343d3991967418a"><code>a77b85c</code></a></td><td><code>Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d5b0a5c6958d0e623da7c25d9ce0e8abcd0781a"><code>9d5b0a5</code></a></td><td><code>Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a11dd268ec49371faf835b92f434e05e4ffb3485"><code>a11dd26</code></a></td><td><code>Trac #29665: use sage-venv in SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr></table>




---

archive/issue_comments_467260.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nYou didn't like how I merged it in eeae67c?",
    "created_at": "2021-10-25T00:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467260",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">comment:77</div>

You didn't like how I merged it in eeae67c?



---

archive/issue_comments_467261.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@mkoeppe](#comment:77):\n> You didn't like how I merged it in eeae67c?\n\nThat part is probably fine but huge merge commits aren't very nice to review.\n\nThere are a bunch of other python packages with similar spkg-configures that I skipped initially. Once the `--enable-system-site-packages` mechanism works well enough to enable by default, I'll go back and replace them all at once with the trivial python spkg-configure that all of the other packages are using.",
    "created_at": "2021-10-25T00:54:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467261",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@mkoeppe](#comment:77):
> You didn't like how I merged it in eeae67c?

That part is probably fine but huge merge commits aren't very nice to review.

There are a bunch of other python packages with similar spkg-configures that I skipped initially. Once the `--enable-system-site-packages` mechanism works well enough to enable by default, I'll go back and replace them all at once with the trivial python spkg-configure that all of the other packages are using.



---

archive/issue_comments_467262.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nReplying to [@mkoeppe](#comment:71):\n> Replying to [@orlitzky](#comment:70):\n> > The `sdh_*` scripts call `python3` directly\n\n> ... because they run with the venv activated. This is correct.\n\nSo both are supposedly running the symlink `/Users/runner/work/sage/sage/.tox/local-homebrew-macos-standard/local/bin/python3`, which should point to the real homebrew python3, by way of its being near the front of `PATH`. I'd love to know how it loses track of setuptools in the span of a few seconds, but I'm at a loss for ways to test it without a mac.",
    "created_at": "2021-10-25T02:09:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467262",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:79" align="right">comment:79</div>

Replying to [@mkoeppe](#comment:71):
> Replying to [@orlitzky](#comment:70):
> > The `sdh_*` scripts call `python3` directly

> ... because they run with the venv activated. This is correct.

So both are supposedly running the symlink `/Users/runner/work/sage/sage/.tox/local-homebrew-macos-standard/local/bin/python3`, which should point to the real homebrew python3, by way of its being near the front of `PATH`. I'd love to know how it loses track of setuptools in the span of a few seconds, but I'm at a loss for ways to test it without a mac.



---

archive/issue_comments_467263.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nIt is unlikely that any of this is macOS-specific. It's just the only environment for which I have built #32703 so far. Help on that is welcome.",
    "created_at": "2021-10-25T02:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467263",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:80" align="right">comment:80</div>

It is unlikely that any of this is macOS-specific. It's just the only environment for which I have built #32703 so far. Help on that is welcome.



---

archive/issue_comments_467264.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nI tried installing a separate copy of python-3.9.6 in `/home/mjo/tmp/python3` that doesn't have setuptools. After prepending `/home/mjo/tmp/python3/bin` to my `PATH`, I configured sage with `--with-python=/usr/bin/python3`, the \"good\" copy that has setuptools. Everything is detected and pip builds normally.",
    "created_at": "2021-10-25T02:39:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467264",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:81" align="right">comment:81</div>

I tried installing a separate copy of python-3.9.6 in `/home/mjo/tmp/python3` that doesn't have setuptools. After prepending `/home/mjo/tmp/python3/bin` to my `PATH`, I configured sage with `--with-python=/usr/bin/python3`, the "good" copy that has setuptools. Everything is detected and pip builds normally.



---

archive/issue_comments_467265.json:
```json
{
    "body": "Changed commit from **[`a11dd26`](https://github.com/sagemath/sagetrac-mirror/commit/a11dd268ec49371faf835b92f434e05e4ffb3485)** to **[`b0a1a1d`](https://github.com/sagemath/sagetrac-mirror/commit/b0a1a1d5be476ececaf5e128f1edde9480fa1a7b)**",
    "created_at": "2021-11-03T13:23:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467265",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a11dd26`](https://github.com/sagemath/sagetrac-mirror/commit/a11dd268ec49371faf835b92f434e05e4ffb3485)** to **[`b0a1a1d`](https://github.com/sagemath/sagetrac-mirror/commit/b0a1a1d5be476ececaf5e128f1edde9480fa1a7b)**



---

archive/issue_comments_467266.json:
```json
{
    "body": "<div id=\"comment:82\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/708dd10451dfb6a589ffd067874d1403c87c188f\"><code>708dd10</code></a></td><td><code>Trac #29665: don't clobber a plain file named config.venv.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/711fbe9c6cb87648a59f75619458714f884fad75\"><code>711fbe9</code></a></td><td><code>Trac #29665: don't announce system python packages that won't be used.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ef46fa4538c49fb4aadc5747daa49cfff7f7dfa\"><code>9ef46fa</code></a></td><td><code>Trac #29665: add Gentoo package information for python packages.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b11abf5fd2cf9a00caf724cc09e9b1d3f5051cbf\"><code>b11abf5</code></a></td><td><code>build/pkgs: Add distros/fedora.txt for Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30295130909863659fbdf661cf23b2649ef9406d\"><code>3029513</code></a></td><td><code>build/pkgs: Add distros/arch.txt for Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b079d5d5a75ff9b952cdb7d37528b11b2dca61f\"><code>6b079d5</code></a></td><td><code>build/pkgs: Add distros/opensuse.txt for Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cfef70953c8a962c1b05f0255b66b0973964e22\"><code>4cfef70</code></a></td><td><code>build/pkgs: Add distros/debian.txt for Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95cd8dfa62bad9a3382c67928dd79b3b65c9139f\"><code>95cd8df</code></a></td><td><code>Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d36d69c539c038f917162e6d8b64d9f06dc5834\"><code>6d36d69</code></a></td><td><code>Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0a1a1d5be476ececaf5e128f1edde9480fa1a7b\"><code>b0a1a1d</code></a></td><td><code>Trac #29665: use sage-venv in SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr></table>\n",
    "created_at": "2021-11-03T13:23:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467266",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:82"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/708dd10451dfb6a589ffd067874d1403c87c188f"><code>708dd10</code></a></td><td><code>Trac #29665: don't clobber a plain file named config.venv.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/711fbe9c6cb87648a59f75619458714f884fad75"><code>711fbe9</code></a></td><td><code>Trac #29665: don't announce system python packages that won't be used.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ef46fa4538c49fb4aadc5747daa49cfff7f7dfa"><code>9ef46fa</code></a></td><td><code>Trac #29665: add Gentoo package information for python packages.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b11abf5fd2cf9a00caf724cc09e9b1d3f5051cbf"><code>b11abf5</code></a></td><td><code>build/pkgs: Add distros/fedora.txt for Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30295130909863659fbdf661cf23b2649ef9406d"><code>3029513</code></a></td><td><code>build/pkgs: Add distros/arch.txt for Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b079d5d5a75ff9b952cdb7d37528b11b2dca61f"><code>6b079d5</code></a></td><td><code>build/pkgs: Add distros/opensuse.txt for Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cfef70953c8a962c1b05f0255b66b0973964e22"><code>4cfef70</code></a></td><td><code>build/pkgs: Add distros/debian.txt for Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95cd8dfa62bad9a3382c67928dd79b3b65c9139f"><code>95cd8df</code></a></td><td><code>Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d36d69c539c038f917162e6d8b64d9f06dc5834"><code>6d36d69</code></a></td><td><code>Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0a1a1d5be476ececaf5e128f1edde9480fa1a7b"><code>b0a1a1d</code></a></td><td><code>Trac #29665: use sage-venv in SAGE_PYTHON_PACKAGE_CHECK().</code></td></tr></table>




---

archive/issue_comments_467267.json:
```json
{
    "body": "<div id=\"comment:83\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d648d238699c512657d4d7ad18e65419cd605f8c\"><code>d648d23</code></a></td><td><code>Trac #29665: add Gentoo package information for imagesize.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04839241df086f66219904614c2615f6dfe425d0\"><code>0483924</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for imagesize.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ba58f79a0b164d54cee021a24ba4f883bcec5ba\"><code>2ba58f7</code></a></td><td><code>Trac #29665: add Gentoo package information for mistune.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec87c1257c2451fa3214c3585a962aa1ab17e1d0\"><code>ec87c12</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for mistune.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e44a60956aca9a62b8e1a0f3af13407d4e4c78a\"><code>2e44a60</code></a></td><td><code>Trac #29665: add Gentoo package information for backcall.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/418fc488c5e30bd31c0eadc286b437572830ed83\"><code>418fc48</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for backcall.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21102cda8bb44ebbe048c30e5b2f6edcefc97348\"><code>21102cd</code></a></td><td><code>Trac #29665: add Gentoo package information for parso.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/110e0cf87c20de1d32422d46c90bb76dbae39870\"><code>110e0cf</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for parso.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0597506ce9dc1c00bbd72fcfeaf6ca04a1acdb9\"><code>e059750</code></a></td><td><code>Trac #29665: add Gentoo package information for pyparsing.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae68ea1904f53249f8e0c473e0d9942b1b2d926c\"><code>ae68ea1</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pyparsing.</code></td></tr></table>\n",
    "created_at": "2021-11-03T23:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467267",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:83"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d648d238699c512657d4d7ad18e65419cd605f8c"><code>d648d23</code></a></td><td><code>Trac #29665: add Gentoo package information for imagesize.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04839241df086f66219904614c2615f6dfe425d0"><code>0483924</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for imagesize.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ba58f79a0b164d54cee021a24ba4f883bcec5ba"><code>2ba58f7</code></a></td><td><code>Trac #29665: add Gentoo package information for mistune.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec87c1257c2451fa3214c3585a962aa1ab17e1d0"><code>ec87c12</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for mistune.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e44a60956aca9a62b8e1a0f3af13407d4e4c78a"><code>2e44a60</code></a></td><td><code>Trac #29665: add Gentoo package information for backcall.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/418fc488c5e30bd31c0eadc286b437572830ed83"><code>418fc48</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for backcall.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21102cda8bb44ebbe048c30e5b2f6edcefc97348"><code>21102cd</code></a></td><td><code>Trac #29665: add Gentoo package information for parso.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/110e0cf87c20de1d32422d46c90bb76dbae39870"><code>110e0cf</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for parso.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0597506ce9dc1c00bbd72fcfeaf6ca04a1acdb9"><code>e059750</code></a></td><td><code>Trac #29665: add Gentoo package information for pyparsing.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae68ea1904f53249f8e0c473e0d9942b1b2d926c"><code>ae68ea1</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pyparsing.</code></td></tr></table>




---

archive/issue_comments_467268.json:
```json
{
    "body": "Changed commit from **[`b0a1a1d`](https://github.com/sagemath/sagetrac-mirror/commit/b0a1a1d5be476ececaf5e128f1edde9480fa1a7b)** to **[`ae68ea1`](https://github.com/sagemath/sagetrac-mirror/commit/ae68ea1904f53249f8e0c473e0d9942b1b2d926c)**",
    "created_at": "2021-11-03T23:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467268",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b0a1a1d`](https://github.com/sagemath/sagetrac-mirror/commit/b0a1a1d5be476ececaf5e128f1edde9480fa1a7b)** to **[`ae68ea1`](https://github.com/sagemath/sagetrac-mirror/commit/ae68ea1904f53249f8e0c473e0d9942b1b2d926c)**



---

archive/issue_comments_467269.json:
```json
{
    "body": "Changed commit from **[`ae68ea1`](https://github.com/sagemath/sagetrac-mirror/commit/ae68ea1904f53249f8e0c473e0d9942b1b2d926c)** to **[`f1890fb`](https://github.com/sagemath/sagetrac-mirror/commit/f1890fb090720378eb6f5a8e0169a2181d37298d)**",
    "created_at": "2021-11-04T22:55:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467269",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ae68ea1`](https://github.com/sagemath/sagetrac-mirror/commit/ae68ea1904f53249f8e0c473e0d9942b1b2d926c)** to **[`f1890fb`](https://github.com/sagemath/sagetrac-mirror/commit/f1890fb090720378eb6f5a8e0169a2181d37298d)**



---

archive/issue_comments_467270.json:
```json
{
    "body": "<div id=\"comment:84\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b0bb0a1bf71b95339226f87c0cb65a9415beb93\"><code>1b0bb0a</code></a></td><td><code>Trac #29665: add Gentoo package information for attrs.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e446759b623d995cb5a582ff28fd78f7111a624\"><code>5e44675</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for attrs.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1a1a4962466a292b2a194aaecf7805b4fa1f99c\"><code>f1a1a49</code></a></td><td><code>Trac #29665: add Gentoo package information for send2trash.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80b99fe9307a2e3e1a753edec4f4a3a7bc857ef3\"><code>80b99fe</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for send2trash.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/064a7011fbe9be7bde09ebb7204b13d7a8d08ab6\"><code>064a701</code></a></td><td><code>Trac #29665: add Gentoo package information for pyrsistent.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e18ce3d5621a11a5c255a208fcb7efe627dae11e\"><code>e18ce3d</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pyrsistent.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/853da97d92e6fc00de107cbfe4e32953ce5b2345\"><code>853da97</code></a></td><td><code>Trac #29665: add Gentoo package information for entrypoints.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04d547255e4034b6c97c5edffb0826c8b43d27a8\"><code>04d5472</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for entrypoints.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6490caf1c51e51b51b3153395c485709a1a73c4a\"><code>6490caf</code></a></td><td><code>Trac #29665: add Gentoo package information for markupsafe.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1890fb090720378eb6f5a8e0169a2181d37298d\"><code>f1890fb</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for markupsafe.</code></td></tr></table>\n",
    "created_at": "2021-11-04T22:55:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467270",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:84"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b0bb0a1bf71b95339226f87c0cb65a9415beb93"><code>1b0bb0a</code></a></td><td><code>Trac #29665: add Gentoo package information for attrs.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e446759b623d995cb5a582ff28fd78f7111a624"><code>5e44675</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for attrs.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1a1a4962466a292b2a194aaecf7805b4fa1f99c"><code>f1a1a49</code></a></td><td><code>Trac #29665: add Gentoo package information for send2trash.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80b99fe9307a2e3e1a753edec4f4a3a7bc857ef3"><code>80b99fe</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for send2trash.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/064a7011fbe9be7bde09ebb7204b13d7a8d08ab6"><code>064a701</code></a></td><td><code>Trac #29665: add Gentoo package information for pyrsistent.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e18ce3d5621a11a5c255a208fcb7efe627dae11e"><code>e18ce3d</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pyrsistent.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/853da97d92e6fc00de107cbfe4e32953ce5b2345"><code>853da97</code></a></td><td><code>Trac #29665: add Gentoo package information for entrypoints.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04d547255e4034b6c97c5edffb0826c8b43d27a8"><code>04d5472</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for entrypoints.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6490caf1c51e51b51b3153395c485709a1a73c4a"><code>6490caf</code></a></td><td><code>Trac #29665: add Gentoo package information for markupsafe.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1890fb090720378eb6f5a8e0169a2181d37298d"><code>f1890fb</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for markupsafe.</code></td></tr></table>




---

archive/issue_comments_467271.json:
```json
{
    "body": "<div id=\"comment:85\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47f78d28e3d5c0fc3072ea75ea950dddc4adde10\"><code>47f78d2</code></a></td><td><code>Trac #29665: add Gentoo package information for flit_core.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a9d173289a06fe1af88005b27511f351e3976c5\"><code>1a9d173</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for flit_core.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4095c6ab3f1d2fa3ba274a16a98951c636199eb\"><code>c4095c6</code></a></td><td><code>Trac #29665: add Gentoo package information for nest_asyncio.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6da4c043de00dfd26cc83b15dfb4c70a7c8cbe96\"><code>6da4c04</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for nest_asyncio.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4da3849239ce1f356d3cb1ac67639726ba41d00\"><code>e4da384</code></a></td><td><code>Trac #29665: add Gentoo package information for ipython_genutils.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00a37aadc998fb273d0ba2461688e2811ec20598\"><code>00a37aa</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for ipython_genutils.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b94073eb49e45c0be71a18564088c587dd8bdf6\"><code>0b94073</code></a></td><td><code>Trac #29665: add Gentoo package information for ipython.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c13864696182f9583b684b85131388676c7d191\"><code>2c13864</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for ipython.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8b2c8eb27fab67a5e23d78090dd3a54bec1863e\"><code>e8b2c8e</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for ipywidgets.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5540df25d567ebe8c0fa632b7374b98674984d5a\"><code>5540df2</code></a></td><td><code>Trac #29665: add Gentoo package information for wheel.</code></td></tr></table>\n",
    "created_at": "2021-11-05T16:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467271",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:85"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47f78d28e3d5c0fc3072ea75ea950dddc4adde10"><code>47f78d2</code></a></td><td><code>Trac #29665: add Gentoo package information for flit_core.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a9d173289a06fe1af88005b27511f351e3976c5"><code>1a9d173</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for flit_core.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4095c6ab3f1d2fa3ba274a16a98951c636199eb"><code>c4095c6</code></a></td><td><code>Trac #29665: add Gentoo package information for nest_asyncio.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6da4c043de00dfd26cc83b15dfb4c70a7c8cbe96"><code>6da4c04</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for nest_asyncio.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4da3849239ce1f356d3cb1ac67639726ba41d00"><code>e4da384</code></a></td><td><code>Trac #29665: add Gentoo package information for ipython_genutils.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00a37aadc998fb273d0ba2461688e2811ec20598"><code>00a37aa</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for ipython_genutils.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b94073eb49e45c0be71a18564088c587dd8bdf6"><code>0b94073</code></a></td><td><code>Trac #29665: add Gentoo package information for ipython.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c13864696182f9583b684b85131388676c7d191"><code>2c13864</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for ipython.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8b2c8eb27fab67a5e23d78090dd3a54bec1863e"><code>e8b2c8e</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for ipywidgets.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5540df25d567ebe8c0fa632b7374b98674984d5a"><code>5540df2</code></a></td><td><code>Trac #29665: add Gentoo package information for wheel.</code></td></tr></table>




---

archive/issue_comments_467272.json:
```json
{
    "body": "Changed commit from **[`f1890fb`](https://github.com/sagemath/sagetrac-mirror/commit/f1890fb090720378eb6f5a8e0169a2181d37298d)** to **[`5540df2`](https://github.com/sagemath/sagetrac-mirror/commit/5540df25d567ebe8c0fa632b7374b98674984d5a)**",
    "created_at": "2021-11-05T16:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467272",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f1890fb`](https://github.com/sagemath/sagetrac-mirror/commit/f1890fb090720378eb6f5a8e0169a2181d37298d)** to **[`5540df2`](https://github.com/sagemath/sagetrac-mirror/commit/5540df25d567ebe8c0fa632b7374b98674984d5a)**



---

archive/issue_comments_467273.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nSomething's gone wrong in the meantime. I'm now seeing cypari fail to cythonize.\n\ncypari has a custom patch that in turn requires a custom patched cython, so I wouldn't expect it to work with the system cython... but I've got the cython SPKG installed. Must be somehow the system cython is getting used.",
    "created_at": "2021-11-05T17:05:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467273",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:86" align="right">comment:86</div>

Something's gone wrong in the meantime. I'm now seeing cypari fail to cythonize.

cypari has a custom patch that in turn requires a custom patched cython, so I wouldn't expect it to work with the system cython... but I've got the cython SPKG installed. Must be somehow the system cython is getting used.



---

archive/issue_comments_467274.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nReplying to [@orlitzky](#comment:86):\n> Must be somehow the system cython is getting used.\n\nI think this explains all of the problems observed so far:\n\n```\n$ sage -c \"print(sys.path)\"\n['/home/mjo/src/sage.git/src/bin',\n '/usr/lib/python39.zip',\n '/usr/lib/python3.9',\n '/usr/lib/python3.9/lib-dynload',\n '/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages', \n '/usr/lib/python3.9/site-packages']\n```\n\nI have been assuming that the venv would be searched before the system paths. When it isn't, installing an SPKG to override an unusable system package doesn't work.",
    "created_at": "2021-11-06T13:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467274",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:87" align="right">comment:87</div>

Replying to [@orlitzky](#comment:86):
> Must be somehow the system cython is getting used.

I think this explains all of the problems observed so far:

```
$ sage -c "print(sys.path)"
['/home/mjo/src/sage.git/src/bin',
 '/usr/lib/python39.zip',
 '/usr/lib/python3.9',
 '/usr/lib/python3.9/lib-dynload',
 '/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages', 
 '/usr/lib/python3.9/site-packages']
```

I have been assuming that the venv would be searched before the system paths. When it isn't, installing an SPKG to override an unusable system package doesn't work.



---

archive/issue_comments_467275.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nReplying to [@orlitzky](#comment:87):\n> I have been assuming that the venv would be searched before the system paths.\n\nIt is searched before the system `site-packages`; but not before the paths that provide the Python standard library.",
    "created_at": "2021-11-06T17:36:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467275",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:88" align="right">comment:88</div>

Replying to [@orlitzky](#comment:87):
> I have been assuming that the venv would be searched before the system paths.

It is searched before the system `site-packages`; but not before the paths that provide the Python standard library.



---

archive/issue_comments_467276.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nReplying to [@mkoeppe](#comment:88):\n> Replying to [@orlitzky](#comment:87):\n> > I have been assuming that the venv would be searched before the system paths.\n\n> \n> It is searched before the system `site-packages`; but not before the paths that provide the Python standard library.\n\nYeah, thanks, I realized that later. The problem with cython is due to pip refusing to install a wheel that's the same version as the existing one. You dealt with that recently by issuing a `pip uninstall` prior to `pip install`... but the uninstall does nothing if cython comes from the system. We're going to have the same issue with many patched python packages.",
    "created_at": "2021-11-06T17:47:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467276",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:89" align="right">comment:89</div>

Replying to [@mkoeppe](#comment:88):
> Replying to [@orlitzky](#comment:87):
> > I have been assuming that the venv would be searched before the system paths.

> 
> It is searched before the system `site-packages`; but not before the paths that provide the Python standard library.

Yeah, thanks, I realized that later. The problem with cython is due to pip refusing to install a wheel that's the same version as the existing one. You dealt with that recently by issuing a `pip uninstall` prior to `pip install`... but the uninstall does nothing if cython comes from the system. We're going to have the same issue with many patched python packages.



---

archive/issue_comments_467277.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nReplying to [@orlitzky](#comment:89):\n> The problem with cython is due to pip refusing to install a wheel that's the same version as the existing one. You dealt with that recently by issuing a `pip uninstall` prior to `pip install`... but the uninstall does nothing if cython comes from the system. We're going to have the same issue with many patched python packages.\n\nAha, interesting. \nThat's the 2nd and 3rd bullet points in #29023 \"Questions to be resolved\".",
    "created_at": "2021-11-06T18:12:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467277",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:90" align="right">comment:90</div>

Replying to [@orlitzky](#comment:89):
> The problem with cython is due to pip refusing to install a wheel that's the same version as the existing one. You dealt with that recently by issuing a `pip uninstall` prior to `pip install`... but the uninstall does nothing if cython comes from the system. We're going to have the same issue with many patched python packages.

Aha, interesting. 
That's the 2nd and 3rd bullet points in #29023 "Questions to be resolved".



---

archive/issue_comments_467278.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nSo in the case of `--enable-system-site-packages`, we may have to add `--ignore-installed` to the options when installing the wheel.",
    "created_at": "2021-11-06T18:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467278",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:91" align="right">comment:91</div>

So in the case of `--enable-system-site-packages`, we may have to add `--ignore-installed` to the options when installing the wheel.



---

archive/issue_comments_467279.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nReplying to [@mkoeppe](#comment:91):\n> So in the case of `--enable-system-site-packages`, we may have to add `--ignore-installed` to the options when installing the wheel.\n\nThat was already part of the fallback case in `sage-pip-install`, but the install conflict doesn't actually cause an error -- only a warning. I've already moved it from the fallback into the main `pip_install_flags` and will see what happens.",
    "created_at": "2021-11-06T18:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467279",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:92" align="right">comment:92</div>

Replying to [@mkoeppe](#comment:91):
> So in the case of `--enable-system-site-packages`, we may have to add `--ignore-installed` to the options when installing the wheel.

That was already part of the fallback case in `sage-pip-install`, but the install conflict doesn't actually cause an error -- only a warning. I've already moved it from the fallback into the main `pip_install_flags` and will see what happens.



---

archive/issue_comments_467280.json:
```json
{
    "body": "Changed commit from **[`5540df2`](https://github.com/sagemath/sagetrac-mirror/commit/5540df25d567ebe8c0fa632b7374b98674984d5a)** to **[`178253d`](https://github.com/sagemath/sagetrac-mirror/commit/178253d5b58a46fd8b428a6e3cc391d4ea790934)**",
    "created_at": "2021-11-07T12:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467280",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5540df2`](https://github.com/sagemath/sagetrac-mirror/commit/5540df25d567ebe8c0fa632b7374b98674984d5a)** to **[`178253d`](https://github.com/sagemath/sagetrac-mirror/commit/178253d5b58a46fd8b428a6e3cc391d4ea790934)**



---

archive/issue_comments_467281.json:
```json
{
    "body": "<div id=\"comment:93\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/178253d5b58a46fd8b428a6e3cc391d4ea790934\"><code>178253d</code></a></td><td><code>Trac #29665: add --ignore-installed flag to pip installs.</code></td></tr></table>\n",
    "created_at": "2021-11-07T12:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467281",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:93"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/178253d5b58a46fd8b428a6e3cc391d4ea790934"><code>178253d</code></a></td><td><code>Trac #29665: add --ignore-installed flag to pip installs.</code></td></tr></table>




---

archive/issue_comments_467282.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nWon't this reinstall dependencies of every package every time?",
    "created_at": "2021-11-07T17:47:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467282",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:94" align="right">comment:94</div>

Won't this reinstall dependencies of every package every time?



---

archive/issue_comments_467283.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nReplying to [@mkoeppe](#comment:94):\n> Won't this reinstall dependencies of every package every time?\n\nThat would have been a smart thing for me to check a few hours ago, but I saw a bunch of unrelated doctest failures and just clobbered my local checkout to confirm that #32836 occurs on the unmodified develop branch.\n\nI'll switch back to this ticket eventually and make sure that we're not installing dependencies that shouldn't be. It would be especially counterproductive if pip was installing local copies of dependencies when the intention is to use those from the system.",
    "created_at": "2021-11-07T18:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467283",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:95" align="right">comment:95</div>

Replying to [@mkoeppe](#comment:94):
> Won't this reinstall dependencies of every package every time?

That would have been a smart thing for me to check a few hours ago, but I saw a bunch of unrelated doctest failures and just clobbered my local checkout to confirm that #32836 occurs on the unmodified develop branch.

I'll switch back to this ticket eventually and make sure that we're not installing dependencies that shouldn't be. It would be especially counterproductive if pip was installing local copies of dependencies when the intention is to use those from the system.



---

archive/issue_comments_467284.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nReplying to [@mkoeppe](#comment:94):\n> Won't this reinstall dependencies of every package every time?\n\nSort of. It actually winds up doing the right thing in most cases, but pollutes the logs and probably wastes a few seconds.\n\nIf the dependency is installed as a system package, an error gets thrown and the whole thing is retried with `--no-deps`, which makes it work. For example with system setuptools: \n\n```\n[setuptools_scm-6.3.2] ERROR: Could not find a version that satisfies the requirement setuptools (from setuptools-scm) (from versions: none)\n[setuptools_scm-6.3.2] ERROR: No matching distribution found for setuptools\n[setuptools_scm-6.3.2] Warning: installing with ... failed. Retrying, adding \"--no-deps --ignore-requires-python\"\n[setuptools_scm-6.3.2] Using pip 21.2.4 from /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/pip (python 3.9)\n...\n[setuptools_scm-6.3.2] Successfully installed setuptools-scm-6.3.2\n[setuptools_scm-6.3.2] Warning: The installation needed to use \"--no-deps --ignore-requires-python\" to succeed. This means that a dependencies file in build/pkgs/ needs to be updated. Please report this to sage-devel@googlegroups.com, including the build log of this package.\n```\n\nHowever, when the dependency itself is installed as an SPKG, it looks like a portion of its installation routine is re-run. Here's cypari reinstalling cysignals/cython:\n\n```\n[cypari-2.1.2] Using pip 21.2.4 from /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/pip (python 3.9)\n[cypari-2.1.2] Looking in links: /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels\n[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/cypari-2.1.2/inst/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/cypari2-2.1.2-cp39-cp39-linux_x86_64.whl\n[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/cysignals-1.10.3-cp39-cp39-linux_x86_64.whl\n[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/Cython-0.29.24-cp39-cp39-linux_x86_64.whl\n[cypari-2.1.2] Installing collected packages: Cython, cysignals, cypari2\n[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cygdb to 755\n[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cython to 755\n[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cythonize to 755\n[cypari-2.1.2] Successfully installed Cython-0.29.24 cypari2-2.1.2 cysignals-1.10.3\n```\n\nI'm not sure what all it's doing, or how undesirable it is in the general case. It doesn't take noticeably longer, and everything works out in the end.\n\nI suppose I'll add both `--no-deps` and `--ignore-installed`, but only when `--enable-system-site-packages` is on. If it ever becomes default, we'll just have to run a CI with `--disable-system-site-packages` to detect stale deps using that warning.",
    "created_at": "2021-11-09T03:25:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467284",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:96" align="right">comment:96</div>

Replying to [@mkoeppe](#comment:94):
> Won't this reinstall dependencies of every package every time?

Sort of. It actually winds up doing the right thing in most cases, but pollutes the logs and probably wastes a few seconds.

If the dependency is installed as a system package, an error gets thrown and the whole thing is retried with `--no-deps`, which makes it work. For example with system setuptools: 

```
[setuptools_scm-6.3.2] ERROR: Could not find a version that satisfies the requirement setuptools (from setuptools-scm) (from versions: none)
[setuptools_scm-6.3.2] ERROR: No matching distribution found for setuptools
[setuptools_scm-6.3.2] Warning: installing with ... failed. Retrying, adding "--no-deps --ignore-requires-python"
[setuptools_scm-6.3.2] Using pip 21.2.4 from /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/pip (python 3.9)
...
[setuptools_scm-6.3.2] Successfully installed setuptools-scm-6.3.2
[setuptools_scm-6.3.2] Warning: The installation needed to use "--no-deps --ignore-requires-python" to succeed. This means that a dependencies file in build/pkgs/ needs to be updated. Please report this to sage-devel@googlegroups.com, including the build log of this package.
```

However, when the dependency itself is installed as an SPKG, it looks like a portion of its installation routine is re-run. Here's cypari reinstalling cysignals/cython:

```
[cypari-2.1.2] Using pip 21.2.4 from /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/pip (python 3.9)
[cypari-2.1.2] Looking in links: /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels
[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/cypari-2.1.2/inst/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/cypari2-2.1.2-cp39-cp39-linux_x86_64.whl
[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/cysignals-1.10.3-cp39-cp39-linux_x86_64.whl
[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/Cython-0.29.24-cp39-cp39-linux_x86_64.whl
[cypari-2.1.2] Installing collected packages: Cython, cysignals, cypari2
[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cygdb to 755
[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cython to 755
[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cythonize to 755
[cypari-2.1.2] Successfully installed Cython-0.29.24 cypari2-2.1.2 cysignals-1.10.3
```

I'm not sure what all it's doing, or how undesirable it is in the general case. It doesn't take noticeably longer, and everything works out in the end.

I suppose I'll add both `--no-deps` and `--ignore-installed`, but only when `--enable-system-site-packages` is on. If it ever becomes default, we'll just have to run a CI with `--disable-system-site-packages` to detect stale deps using that warning.



---

archive/issue_comments_467285.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nReplying to [@orlitzky](#comment:96):\n> I suppose I'll add both `--no-deps` and `--ignore-installed`, but only when `--enable-system-site-packages` is on. \n\nYes, this seems to be the way forward.",
    "created_at": "2021-11-09T04:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467285",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:97" align="right">comment:97</div>

Replying to [@orlitzky](#comment:96):
> I suppose I'll add both `--no-deps` and `--ignore-installed`, but only when `--enable-system-site-packages` is on. 

Yes, this seems to be the way forward.



---

archive/issue_comments_467286.json:
```json
{
    "body": "<div id=\"comment:98\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffea765dd285947817554d3a651364860a5a65b6\"><code>ffea765</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Handle new option --build-isolation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac93e7bcd483b5ab72be655ce93df96e74542402\"><code>ac93e7b</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Pass options on to sdh_store_and_pip_install_wheel</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb83e8b6e27c84f7ecb9d6e10218c0366f529d87\"><code>eb83e8b</code></a></td><td><code>build/bin/sage-dist-helpers: Only extract special ooptions --build-isolation and --no-deps from the front, pass --no-deps only to install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41d65d5b30b0aad6f529c6cd97b66e4d44290b60\"><code>41d65d5</code></a></td><td><code>Trac #29665: support passing --ignore-installed to sdh_pip_install.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f96b66965dd29e7ba9567d4733f02f052a4dfc40\"><code>f96b669</code></a></td><td><code>Trac #29665: set $SAGE_SDH_PIP_INSTALL_FLAGS for --enable-system-site-packages.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0528df324df55fa08e1cdac75313a257b9a26cce\"><code>0528df3</code></a></td><td><code>build/pkgs/flit_core/spkg-install.in: Use sdh_pip_install --no-deps</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e91fd2f6656982135ca904aa1bcb1964c3d5d4f8\"><code>e91fd2f</code></a></td><td><code>Trac #29665: pass $SAGE_SDH_PIP_INSTALL_FLAGS to sdh_pip_install.</code></td></tr></table>\n",
    "created_at": "2021-11-10T01:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467286",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:98"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffea765dd285947817554d3a651364860a5a65b6"><code>ffea765</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Handle new option --build-isolation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac93e7bcd483b5ab72be655ce93df96e74542402"><code>ac93e7b</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Pass options on to sdh_store_and_pip_install_wheel</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb83e8b6e27c84f7ecb9d6e10218c0366f529d87"><code>eb83e8b</code></a></td><td><code>build/bin/sage-dist-helpers: Only extract special ooptions --build-isolation and --no-deps from the front, pass --no-deps only to install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41d65d5b30b0aad6f529c6cd97b66e4d44290b60"><code>41d65d5</code></a></td><td><code>Trac #29665: support passing --ignore-installed to sdh_pip_install.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f96b66965dd29e7ba9567d4733f02f052a4dfc40"><code>f96b669</code></a></td><td><code>Trac #29665: set $SAGE_SDH_PIP_INSTALL_FLAGS for --enable-system-site-packages.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0528df324df55fa08e1cdac75313a257b9a26cce"><code>0528df3</code></a></td><td><code>build/pkgs/flit_core/spkg-install.in: Use sdh_pip_install --no-deps</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e91fd2f6656982135ca904aa1bcb1964c3d5d4f8"><code>e91fd2f</code></a></td><td><code>Trac #29665: pass $SAGE_SDH_PIP_INSTALL_FLAGS to sdh_pip_install.</code></td></tr></table>




---

archive/issue_comments_467287.json:
```json
{
    "body": "Changed commit from **[`178253d`](https://github.com/sagemath/sagetrac-mirror/commit/178253d5b58a46fd8b428a6e3cc391d4ea790934)** to **[`e91fd2f`](https://github.com/sagemath/sagetrac-mirror/commit/e91fd2f6656982135ca904aa1bcb1964c3d5d4f8)**",
    "created_at": "2021-11-10T01:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467287",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`178253d`](https://github.com/sagemath/sagetrac-mirror/commit/178253d5b58a46fd8b428a6e3cc391d4ea790934)** to **[`e91fd2f`](https://github.com/sagemath/sagetrac-mirror/commit/e91fd2f6656982135ca904aa1bcb1964c3d5d4f8)**



---

archive/issue_comments_467288.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nI've cherry-picked your changes from #32715, and added the ability to pass `--ignore-installed` to `sdh_pip_install`, too. Afterwards I pass the new variable `$SAGE_SDH_PIP_INSTALL_FLAGS` to every invocation of `sdh_pip_install` in an `spkg-install.in` file.\n\nI think this is a tiny bit cleaner than introducing a dependency upon `sage-build-env-config` within `sage-dist-helpers`, but the duplication is hard to overlook. If you prefer to have `sdh_pip_install` directly use `$SAGE_SDH_PIP_INSTALL_FLAGS`, I'm happy to do it that way too.",
    "created_at": "2021-11-10T01:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467288",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:99" align="right">comment:99</div>

I've cherry-picked your changes from #32715, and added the ability to pass `--ignore-installed` to `sdh_pip_install`, too. Afterwards I pass the new variable `$SAGE_SDH_PIP_INSTALL_FLAGS` to every invocation of `sdh_pip_install` in an `spkg-install.in` file.

I think this is a tiny bit cleaner than introducing a dependency upon `sage-build-env-config` within `sage-dist-helpers`, but the duplication is hard to overlook. If you prefer to have `sdh_pip_install` directly use `$SAGE_SDH_PIP_INSTALL_FLAGS`, I'm happy to do it that way too.



---

archive/issue_comments_467289.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nReplying to [@orlitzky](#comment:99):\n> the duplication is hard to overlook\n\nYes, this is too much",
    "created_at": "2021-11-10T01:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467289",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:100" align="right">comment:100</div>

Replying to [@orlitzky](#comment:99):
> the duplication is hard to overlook

Yes, this is too much



---

archive/issue_comments_467290.json:
```json
{
    "body": "Changed commit from **[`e91fd2f`](https://github.com/sagemath/sagetrac-mirror/commit/e91fd2f6656982135ca904aa1bcb1964c3d5d4f8)** to **[`055dc93`](https://github.com/sagemath/sagetrac-mirror/commit/055dc93a17cc23db141d8bc354bd4d2257667328)**",
    "created_at": "2021-11-10T02:26:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467290",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e91fd2f`](https://github.com/sagemath/sagetrac-mirror/commit/e91fd2f6656982135ca904aa1bcb1964c3d5d4f8)** to **[`055dc93`](https://github.com/sagemath/sagetrac-mirror/commit/055dc93a17cc23db141d8bc354bd4d2257667328)**



---

archive/issue_comments_467291.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f50892e5c72973981d4e79f64646ba5ca4b5bbd\"><code>0f50892</code></a></td><td><code>build/pkgs/flit_core/spkg-install.in: Use sdh_pip_install --no-deps</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87f52232c036c719b6bcd0d6db371be21d2c23e7\"><code>87f5223</code></a></td><td><code>Trac #29665: set $SAGE_SDH_PIP_INSTALL_FLAGS for --enable-system-site-packages.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/055dc93a17cc23db141d8bc354bd4d2257667328\"><code>055dc93</code></a></td><td><code>Trac #29665: pass $SAGE_SDH_PIP_INSTALL_FLAGS to sdh_pip_install.</code></td></tr></table>\n",
    "created_at": "2021-11-10T02:26:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467291",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f50892e5c72973981d4e79f64646ba5ca4b5bbd"><code>0f50892</code></a></td><td><code>build/pkgs/flit_core/spkg-install.in: Use sdh_pip_install --no-deps</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87f52232c036c719b6bcd0d6db371be21d2c23e7"><code>87f5223</code></a></td><td><code>Trac #29665: set $SAGE_SDH_PIP_INSTALL_FLAGS for --enable-system-site-packages.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/055dc93a17cc23db141d8bc354bd4d2257667328"><code>055dc93</code></a></td><td><code>Trac #29665: pass $SAGE_SDH_PIP_INSTALL_FLAGS to sdh_pip_install.</code></td></tr></table>




---

archive/issue_comments_467292.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nOk, `sdh_pip_install` handles it now. I didn't even have to source `sage-build-env-config`, since in the context of `spkg-install.in` it will already have been sourced. And in any other context, an empty `$SAGE_SDH_PIP_INSTALL_OPTIONS` has no effect.",
    "created_at": "2021-11-10T02:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467292",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:2" align="right">comment:2</div>

Ok, `sdh_pip_install` handles it now. I didn't even have to source `sage-build-env-config`, since in the context of `spkg-install.in` it will already have been sourced. And in any other context, an empty `$SAGE_SDH_PIP_INSTALL_OPTIONS` has no effect.



---

archive/issue_comments_467293.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI think this should go into `sdh_store_and_pip_install_wheel`, not `sdh_pip_install`",
    "created_at": "2021-11-10T02:37:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467293",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

I think this should go into `sdh_store_and_pip_install_wheel`, not `sdh_pip_install`



---

archive/issue_comments_467294.json:
```json
{
    "body": "Changed commit from **[`055dc93`](https://github.com/sagemath/sagetrac-mirror/commit/055dc93a17cc23db141d8bc354bd4d2257667328)** to **[`922473a`](https://github.com/sagemath/sagetrac-mirror/commit/922473a9fa81db7664baa725b2db0ac745ce5f61)**",
    "created_at": "2021-11-10T18:42:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467294",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`055dc93`](https://github.com/sagemath/sagetrac-mirror/commit/055dc93a17cc23db141d8bc354bd4d2257667328)** to **[`922473a`](https://github.com/sagemath/sagetrac-mirror/commit/922473a9fa81db7664baa725b2db0ac745ce5f61)**



---

archive/issue_comments_467295.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08b201a1078388b30560c9ba893ba97e1e2820ff\"><code>08b201a</code></a></td><td><code>Trac #29665: set $SAGE_PIP_INSTALL_FLAGS for --enable-system-site-packages.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2b80fbaaea0809f17ea1c0ba55a51b3e3804e02\"><code>c2b80fb</code></a></td><td><code>Trac #29665: pass $SAGE_PIP_INSTALL_FLAGS to sdh_pip_install.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4c5839b2abea399a43bdbd80cf855230be5da2d\"><code>f4c5839</code></a></td><td><code>Trac #29665: add Gentoo package information for pexpect.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5f4fc7549490b23293a0fbb7b7b899ccf53ecda\"><code>d5f4fc7</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pexpect.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b860e8c0c34d43768b39c427fb596972afa84e5\"><code>0b860e8</code></a></td><td><code>Trac #29665: add Gentoo package information for docutils.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2b54ff516931c4ff7711a2d59462898d0a96b5b\"><code>c2b54ff</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for docutils.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4855ddcbaa40babb2ba048ab5ddcfb9c84836cb\"><code>d4855dd</code></a></td><td><code>Trac #29665: add Gentoo package information for nbclient.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b02c3f51370709e9c9e5e017da4255418c70417f\"><code>b02c3f5</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for nbclient.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fab328d286094bad407bb9c853863266d3611821\"><code>fab328d</code></a></td><td><code>Trac #29665: add Gentoo package information for argon2_cffi.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/922473a9fa81db7664baa725b2db0ac745ce5f61\"><code>922473a</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for argon2-cffi.</code></td></tr></table>\n",
    "created_at": "2021-11-10T18:42:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467295",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08b201a1078388b30560c9ba893ba97e1e2820ff"><code>08b201a</code></a></td><td><code>Trac #29665: set $SAGE_PIP_INSTALL_FLAGS for --enable-system-site-packages.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2b80fbaaea0809f17ea1c0ba55a51b3e3804e02"><code>c2b80fb</code></a></td><td><code>Trac #29665: pass $SAGE_PIP_INSTALL_FLAGS to sdh_pip_install.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4c5839b2abea399a43bdbd80cf855230be5da2d"><code>f4c5839</code></a></td><td><code>Trac #29665: add Gentoo package information for pexpect.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5f4fc7549490b23293a0fbb7b7b899ccf53ecda"><code>d5f4fc7</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pexpect.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b860e8c0c34d43768b39c427fb596972afa84e5"><code>0b860e8</code></a></td><td><code>Trac #29665: add Gentoo package information for docutils.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2b54ff516931c4ff7711a2d59462898d0a96b5b"><code>c2b54ff</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for docutils.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4855ddcbaa40babb2ba048ab5ddcfb9c84836cb"><code>d4855dd</code></a></td><td><code>Trac #29665: add Gentoo package information for nbclient.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b02c3f51370709e9c9e5e017da4255418c70417f"><code>b02c3f5</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for nbclient.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fab328d286094bad407bb9c853863266d3611821"><code>fab328d</code></a></td><td><code>Trac #29665: add Gentoo package information for argon2_cffi.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/922473a9fa81db7664baa725b2db0ac745ce5f61"><code>922473a</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for argon2-cffi.</code></td></tr></table>




---

archive/issue_comments_467296.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAdding more and more packages (whatever is available on Gentoo) and things still look OK.\n\nWhen you get a second, can you double-check if this should be \"dateutil\" or \"python-dateutil\"?\n\n```\n$ cat build/pkgs/dateutil/install-requires.txt \ndateutil >=2.8.1\n```\n\ncf. https://github.com/dateutil/dateutil/blob/master/setup.cfg",
    "created_at": "2021-11-10T18:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467296",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:5" align="right">comment:5</div>

Adding more and more packages (whatever is available on Gentoo) and things still look OK.

When you get a second, can you double-check if this should be "dateutil" or "python-dateutil"?

```
$ cat build/pkgs/dateutil/install-requires.txt 
dateutil >=2.8.1
```

cf. https://github.com/dateutil/dateutil/blob/master/setup.cfg



---

archive/issue_comments_467297.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIt should be **python-dateutil** (https://pypi.org/project/python-dateutil/), thanks for catching this.\n\nMany of these `install-requires.txt` file are only decoration at the moment; only the `install-requires.txt` files of those packages that are named in files like `src/setup.cfg.m4` are used.",
    "created_at": "2021-11-10T20:05:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467297",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

It should be **python-dateutil** (https://pypi.org/project/python-dateutil/), thanks for catching this.

Many of these `install-requires.txt` file are only decoration at the moment; only the `install-requires.txt` files of those packages that are named in files like `src/setup.cfg.m4` are used.



---

archive/issue_comments_467298.json:
```json
{
    "body": "Changed commit from **[`922473a`](https://github.com/sagemath/sagetrac-mirror/commit/922473a9fa81db7664baa725b2db0ac745ce5f61)** to **[`96f2358`](https://github.com/sagemath/sagetrac-mirror/commit/96f235862c31cdd992c0ee5b69a5e8f476fbfe2e)**",
    "created_at": "2021-11-11T10:24:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467298",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`922473a`](https://github.com/sagemath/sagetrac-mirror/commit/922473a9fa81db7664baa725b2db0ac745ce5f61)** to **[`96f2358`](https://github.com/sagemath/sagetrac-mirror/commit/96f235862c31cdd992c0ee5b69a5e8f476fbfe2e)**



---

archive/issue_comments_467299.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/560248c4802b0a8c1e8c3479a996a8738b65ef3b\"><code>560248c</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_devhelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e94e4db38b694d790dcb4ce5fecd9fdb068c44\"><code>b6e94e4</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_devhelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96579a6b7d29aeac03602a230e3af5006fffb1ae\"><code>96579a6</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_qthelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c093096c3951c417eed5f20a09e5a75eb081efb\"><code>4c09309</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_qthelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed7ffc1cc47b505e6fd15dc40929ee6cf64fee26\"><code>ed7ffc1</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_applehelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd90c66e3549b5351ee14b852eecc25697ecc349\"><code>bd90c66</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_applehelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e860dcc3b529b2df64c0e6a79ce0a3f9ff1a8f3\"><code>1e860dc</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_htmlhelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ad9ed4355fccb8436e01980fab9a23ec9ad87c8\"><code>2ad9ed4</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_htmlhelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1c6e1e80fda3d242726f3faa8db6c10988f6f9e\"><code>c1c6e1e</code></a></td><td><code>Trac #29665: add Gentoo package information for jupyterlab_pygments.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96f235862c31cdd992c0ee5b69a5e8f476fbfe2e\"><code>96f2358</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for jupyterlab_pygments.</code></td></tr></table>\n",
    "created_at": "2021-11-11T10:24:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467299",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/560248c4802b0a8c1e8c3479a996a8738b65ef3b"><code>560248c</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_devhelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e94e4db38b694d790dcb4ce5fecd9fdb068c44"><code>b6e94e4</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_devhelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96579a6b7d29aeac03602a230e3af5006fffb1ae"><code>96579a6</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_qthelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c093096c3951c417eed5f20a09e5a75eb081efb"><code>4c09309</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_qthelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed7ffc1cc47b505e6fd15dc40929ee6cf64fee26"><code>ed7ffc1</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_applehelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd90c66e3549b5351ee14b852eecc25697ecc349"><code>bd90c66</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_applehelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e860dcc3b529b2df64c0e6a79ce0a3f9ff1a8f3"><code>1e860dc</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_htmlhelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ad9ed4355fccb8436e01980fab9a23ec9ad87c8"><code>2ad9ed4</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_htmlhelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1c6e1e80fda3d242726f3faa8db6c10988f6f9e"><code>c1c6e1e</code></a></td><td><code>Trac #29665: add Gentoo package information for jupyterlab_pygments.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96f235862c31cdd992c0ee5b69a5e8f476fbfe2e"><code>96f2358</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for jupyterlab_pygments.</code></td></tr></table>




---

archive/issue_comments_467300.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI haven't been able to test ptyprocess yet due to a version mismatch on Gentoo, and importllib_resources will need some subsequent work (it's built-in to python >= 3.9, but the existing check will save you a pointless pip install if you happen to be running an older python). And I've avoided anything with patches for now.\n\nOtherwise, I think it's good.",
    "created_at": "2021-11-11T11:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467300",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:8" align="right">comment:8</div>

I haven't been able to test ptyprocess yet due to a version mismatch on Gentoo, and importllib_resources will need some subsequent work (it's built-in to python >= 3.9, but the existing check will save you a pointless pip install if you happen to be running an older python). And I've avoided anything with patches for now.

Otherwise, I think it's good.



---

archive/issue_comments_467301.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe test suite still passes with all of those packages installed on the system.\n\nI did discover one more problem that we'll need to be aware of in the future. A lot of python packages have \"automagic\" dependencies that get used if they're available at runtime, rather than detected/configured at build-time. With python-3.9, for example, having an old version of ipyparallel installed will cause ipykernel to throw a deprecation warning that fails a doctest in `repl/ipython_kernel/kernel.py`.\n\nWe could try to address all of those (as they're reported) in `spkg-configure.m4`. Something like,\n\n```\nAC_DEFUN([SAGE_PYTHON_RUN_IFELSE], [dnl\ncat >conftest.py <<SAGE__EOF\n$1\nSAGE__EOF\nAS_IF([\"${PYTHON_FOR_VENV}\" conftest.py 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD],[$2],[$3])\n])\n```\n\ncan be used to detect serious problems that are amenable to such a test. But for cosmetic issues like deprecation warnings I think we're better off just hiding them from the test suite. Or letting them fail (what's the point of the test suite?). Regardless, we can only ever hope to address the problems that exist when sage is being built. If I build sage and *then* install the old ipyparallel, there's nothing sage can do to stop me. That's not really a new problem of course, but it will show up more often with python packages than with C packages due to the prevalence of automagic features in python.",
    "created_at": "2021-11-12T12:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467301",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:9" align="right">comment:9</div>

The test suite still passes with all of those packages installed on the system.

I did discover one more problem that we'll need to be aware of in the future. A lot of python packages have "automagic" dependencies that get used if they're available at runtime, rather than detected/configured at build-time. With python-3.9, for example, having an old version of ipyparallel installed will cause ipykernel to throw a deprecation warning that fails a doctest in `repl/ipython_kernel/kernel.py`.

We could try to address all of those (as they're reported) in `spkg-configure.m4`. Something like,

```
AC_DEFUN([SAGE_PYTHON_RUN_IFELSE], [dnl
cat >conftest.py <<SAGE__EOF
$1
SAGE__EOF
AS_IF(["${PYTHON_FOR_VENV}" conftest.py 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD],[$2],[$3])
])
```

can be used to detect serious problems that are amenable to such a test. But for cosmetic issues like deprecation warnings I think we're better off just hiding them from the test suite. Or letting them fail (what's the point of the test suite?). Regardless, we can only ever hope to address the problems that exist when sage is being built. If I build sage and *then* install the old ipyparallel, there's nothing sage can do to stop me. That's not really a new problem of course, but it will show up more often with python packages than with C packages due to the prevalence of automagic features in python.



---

archive/issue_events_405139.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-11-12T12:59:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405139"
}
```



---

archive/issue_events_405140.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-11-12T12:59:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29665#event-405140"
}
```



---

archive/issue_comments_467302.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nReplying to [@orlitzky](#comment:109):\n> A lot of python packages have \"automagic\" dependencies that get used if they're available at runtime, rather than detected/configured at build-time. \n\nYes, this is normal - with PEP 517/518, the build environment is separate from the runtime environment.",
    "created_at": "2021-11-12T18:05:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467302",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:110" align="right">comment:110</div>

Replying to [@orlitzky](#comment:109):
> A lot of python packages have "automagic" dependencies that get used if they're available at runtime, rather than detected/configured at build-time. 

Yes, this is normal - with PEP 517/518, the build environment is separate from the runtime environment.



---

archive/issue_comments_467303.json:
```json
{
    "body": "<div id=\"comment:111\" align=\"right\">comment:111</div>\n\nBroken \"plugins\" break things, I don't think there's a need to do anything about it.",
    "created_at": "2021-11-12T18:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467303",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:111" align="right">comment:111</div>

Broken "plugins" break things, I don't think there's a need to do anything about it.



---

archive/issue_comments_467304.json:
```json
{
    "body": "<div id=\"comment:112\" align=\"right\">comment:112</div>\n\nReplying to [@orlitzky](#comment:108):\n> I haven't been able to test ptyprocess yet due to a version mismatch on Gentoo\n\nFor `ptyprocess`, see #32147",
    "created_at": "2021-11-12T18:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467304",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:112" align="right">comment:112</div>

Replying to [@orlitzky](#comment:108):
> I haven't been able to test ptyprocess yet due to a version mismatch on Gentoo

For `ptyprocess`, see #32147



---

archive/issue_comments_467305.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nrebase please",
    "created_at": "2021-11-17T16:37:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467305",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

rebase please



---

archive/issue_comments_467306.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3800e825f933972abb00add39ae8f7ecb2186a1f\"><code>3800e82</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_devhelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/913b9093cd0be905c68e68b29ccfbb467364211b\"><code>913b909</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_devhelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bae2beb8901203dab4bd55e1368b36b5a25cb4d\"><code>4bae2be</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_qthelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e562430aee777c2803f8b8d24d6dc0d3f5e47a70\"><code>e562430</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_qthelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fa9bc6a75af8f5a6cf8039812ed119dda12c6f8\"><code>4fa9bc6</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_applehelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2345c47729fe2ea96be56f2add6ecf40cb0c9f65\"><code>2345c47</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_applehelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32fd3829d6dae9dbc3870695e5e3d3d8b64a1e7f\"><code>32fd382</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_htmlhelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81c1e32b8b3d1d3f54e2ddac5a3a3ac8efa1521c\"><code>81c1e32</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_htmlhelp.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17e378ef77c1420cbb1610555543134a9b81e6d4\"><code>17e378e</code></a></td><td><code>Trac #29665: add Gentoo package information for jupyterlab_pygments.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf94d3cd3dd80195f4a167591cdb79de80333091\"><code>bf94d3c</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for jupyterlab_pygments.</code></td></tr></table>\n",
    "created_at": "2021-11-17T21:26:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467306",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3800e825f933972abb00add39ae8f7ecb2186a1f"><code>3800e82</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_devhelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/913b9093cd0be905c68e68b29ccfbb467364211b"><code>913b909</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_devhelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bae2beb8901203dab4bd55e1368b36b5a25cb4d"><code>4bae2be</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_qthelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e562430aee777c2803f8b8d24d6dc0d3f5e47a70"><code>e562430</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_qthelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fa9bc6a75af8f5a6cf8039812ed119dda12c6f8"><code>4fa9bc6</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_applehelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2345c47729fe2ea96be56f2add6ecf40cb0c9f65"><code>2345c47</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_applehelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32fd3829d6dae9dbc3870695e5e3d3d8b64a1e7f"><code>32fd382</code></a></td><td><code>Trac #29665: add Gentoo package information for sphinxcontrib_htmlhelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81c1e32b8b3d1d3f54e2ddac5a3a3ac8efa1521c"><code>81c1e32</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_htmlhelp.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17e378ef77c1420cbb1610555543134a9b81e6d4"><code>17e378e</code></a></td><td><code>Trac #29665: add Gentoo package information for jupyterlab_pygments.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf94d3cd3dd80195f4a167591cdb79de80333091"><code>bf94d3c</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for jupyterlab_pygments.</code></td></tr></table>




---

archive/issue_comments_467307.json:
```json
{
    "body": "Changed commit from **[`96f2358`](https://github.com/sagemath/sagetrac-mirror/commit/96f235862c31cdd992c0ee5b69a5e8f476fbfe2e)** to **[`bf94d3c`](https://github.com/sagemath/sagetrac-mirror/commit/bf94d3cd3dd80195f4a167591cdb79de80333091)**",
    "created_at": "2021-11-17T21:26:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467307",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`96f2358`](https://github.com/sagemath/sagetrac-mirror/commit/96f235862c31cdd992c0ee5b69a5e8f476fbfe2e)** to **[`bf94d3c`](https://github.com/sagemath/sagetrac-mirror/commit/bf94d3cd3dd80195f4a167591cdb79de80333091)**



---

archive/issue_comments_467308.json:
```json
{
    "body": "<div id=\"comment:115\" align=\"right\">comment:115</div>\n\nReplying to [@dimpase](#comment:113):\n> rebase please\n\nI'd love to know why these branches are going red... this one rebased cleanly just like #32037 did.",
    "created_at": "2021-11-17T21:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467308",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:115" align="right">comment:115</div>

Replying to [@dimpase](#comment:113):
> rebase please

I'd love to know why these branches are going red... this one rebased cleanly just like #32037 did.



---

archive/issue_comments_467309.json:
```json
{
    "body": "Dependencies: **#32703**",
    "created_at": "2021-12-19T03:28:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467309",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#32703**



---

archive/issue_comments_467310.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)** to **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)**",
    "created_at": "2021-12-19T03:47:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467310",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)** to **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)**



---

archive/issue_comments_467311.json:
```json
{
    "body": "Changed dependencies from **#32703** to **#32703, #33067**",
    "created_at": "2021-12-22T19:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467311",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#32703** to **#32703, #33067**



---

archive/issue_comments_467312.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/afbd4fa337fa7560267ea3b7f43f62634a6ed01d\"><code>afbd4fa</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57884a631c5b092e08613e470e0f1cb4b515a465\"><code>57884a6</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49276f2ef14cdfc6d6b338e5997e5f615fcaea0b\"><code>49276f2</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3e246781cc3063a15d9ed4db6bcd8954054ce8b\"><code>c3e2467</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55c83f519717daf027fec961a7f066ccf59146bd\"><code>55c83f5</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481\"><code>10de67a</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12\"><code>8617b6f</code></a></td><td><code>.github/workflows/tox.yml: Reduce/streamline macos environments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b5c97fcf2a434b0e08a34c4332f32bd9c19fc5b\"><code>2b5c97f</code></a></td><td><code>Merge #32703</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d65ec5903169ee2f17c2496ad708801b9395cc2\"><code>1d65ec5</code></a></td><td><code>.github/workflows/tox.yml: Test with --enable-system-site-packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29e1e836d62cc14f04c9deb84932e3e5d7114827\"><code>29e1e83</code></a></td><td><code>.github/workflows/tox.yml: In enable-site build, remove old pyvenv.cfg first</code></td></tr></table>\n",
    "created_at": "2021-12-22T19:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467312",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/afbd4fa337fa7560267ea3b7f43f62634a6ed01d"><code>afbd4fa</code></a></td><td><code>github/workflows/tox.yml: Multi-stage local-macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57884a631c5b092e08613e470e0f1cb4b515a465"><code>57884a6</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run optional packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49276f2ef14cdfc6d6b338e5997e5f615fcaea0b"><code>49276f2</code></a></td><td><code>.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3e246781cc3063a15d9ed4db6bcd8954054ce8b"><code>c3e2467</code></a></td><td><code>.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55c83f519717daf027fec961a7f066ccf59146bd"><code>55c83f5</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Run experimental packages here</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481"><code>10de67a</code></a></td><td><code>.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12"><code>8617b6f</code></a></td><td><code>.github/workflows/tox.yml: Reduce/streamline macos environments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b5c97fcf2a434b0e08a34c4332f32bd9c19fc5b"><code>2b5c97f</code></a></td><td><code>Merge #32703</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d65ec5903169ee2f17c2496ad708801b9395cc2"><code>1d65ec5</code></a></td><td><code>.github/workflows/tox.yml: Test with --enable-system-site-packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29e1e836d62cc14f04c9deb84932e3e5d7114827"><code>29e1e83</code></a></td><td><code>.github/workflows/tox.yml: In enable-site build, remove old pyvenv.cfg first</code></td></tr></table>




---

archive/issue_comments_467313.json:
```json
{
    "body": "Changed commit from **[`bf94d3c`](https://github.com/sagemath/sagetrac-mirror/commit/bf94d3cd3dd80195f4a167591cdb79de80333091)** to **[`29e1e83`](https://github.com/sagemath/sagetrac-mirror/commit/29e1e836d62cc14f04c9deb84932e3e5d7114827)**",
    "created_at": "2021-12-22T19:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467313",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`bf94d3c`](https://github.com/sagemath/sagetrac-mirror/commit/bf94d3cd3dd80195f4a167591cdb79de80333091)** to **[`29e1e83`](https://github.com/sagemath/sagetrac-mirror/commit/29e1e836d62cc14f04c9deb84932e3e5d7114827)**



---

archive/issue_comments_467314.json:
```json
{
    "body": "Changed commit from **[`29e1e83`](https://github.com/sagemath/sagetrac-mirror/commit/29e1e836d62cc14f04c9deb84932e3e5d7114827)** to **[`f44d45f`](https://github.com/sagemath/sagetrac-mirror/commit/f44d45f9405860030bfbbe5fa30135d88dd8abc0)**",
    "created_at": "2021-12-22T19:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467314",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`29e1e83`](https://github.com/sagemath/sagetrac-mirror/commit/29e1e836d62cc14f04c9deb84932e3e5d7114827)** to **[`f44d45f`](https://github.com/sagemath/sagetrac-mirror/commit/f44d45f9405860030bfbbe5fa30135d88dd8abc0)**



---

archive/issue_comments_467315.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02505ca6d353e44253f8e461055fe1f2ca6bb995\"><code>02505ca</code></a></td><td><code>pkgs/sage-conf_pypi/MANIFEST.in: Update from #31396</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aeca1a03015f27b74c6641cb7bbcdd9c5e82bf16\"><code>aeca1a0</code></a></td><td><code>Makefile (pypi-sdists): Add sage_setup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd3dce9e076ba81febc4e8f838e1b5ca03b12459\"><code>cd3dce9</code></a></td><td><code>pkgs/sage-conf_pypi/setup.py: Update directory of configured sage_conf.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c695921c3cee61a32a8d7ec9443bb4e315eb481b\"><code>c695921</code></a></td><td><code>pkgs/sage-conf/sage_conf.py.in (SAGE_SPKG_WHEELS): Update so it works if SAGE_VENV != SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cebcda3fa7e1ae0ecd0e7cbf1a0aba15bed1a010\"><code>cebcda3</code></a></td><td><code>Merge tag '9.5.beta4' into t/29039/pip_installable_package_sage_bootstrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0026892c983828c7925626d2bc9165967f0bebe5\"><code>0026892</code></a></td><td><code>Merge tag '9.5.beta5' into t/29039/pip_installable_package_sage_bootstrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a4a32384133408ef05edb4f40b9d363697d3087\"><code>2a4a323</code></a></td><td><code>Merge tag '9.5.beta7' into t/29039/pip_installable_package_sage_bootstrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02234ce0b51908c0dfa233da5942721428fe9f9b\"><code>02234ce</code></a></td><td><code>Merge #29039</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1413d45fe041d7e4b017961d8b273b2a97ddb18\"><code>b1413d4</code></a></td><td><code>build/bin/write-dockerfile.sh: Move 'ADD pkgs' earlier</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f44d45f9405860030bfbbe5fa30135d88dd8abc0\"><code>f44d45f</code></a></td><td><code>Merge #33067</code></td></tr></table>\n",
    "created_at": "2021-12-22T19:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467315",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02505ca6d353e44253f8e461055fe1f2ca6bb995"><code>02505ca</code></a></td><td><code>pkgs/sage-conf_pypi/MANIFEST.in: Update from #31396</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aeca1a03015f27b74c6641cb7bbcdd9c5e82bf16"><code>aeca1a0</code></a></td><td><code>Makefile (pypi-sdists): Add sage_setup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd3dce9e076ba81febc4e8f838e1b5ca03b12459"><code>cd3dce9</code></a></td><td><code>pkgs/sage-conf_pypi/setup.py: Update directory of configured sage_conf.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c695921c3cee61a32a8d7ec9443bb4e315eb481b"><code>c695921</code></a></td><td><code>pkgs/sage-conf/sage_conf.py.in (SAGE_SPKG_WHEELS): Update so it works if SAGE_VENV != SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cebcda3fa7e1ae0ecd0e7cbf1a0aba15bed1a010"><code>cebcda3</code></a></td><td><code>Merge tag '9.5.beta4' into t/29039/pip_installable_package_sage_bootstrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0026892c983828c7925626d2bc9165967f0bebe5"><code>0026892</code></a></td><td><code>Merge tag '9.5.beta5' into t/29039/pip_installable_package_sage_bootstrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a4a32384133408ef05edb4f40b9d363697d3087"><code>2a4a323</code></a></td><td><code>Merge tag '9.5.beta7' into t/29039/pip_installable_package_sage_bootstrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02234ce0b51908c0dfa233da5942721428fe9f9b"><code>02234ce</code></a></td><td><code>Merge #29039</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1413d45fe041d7e4b017961d8b273b2a97ddb18"><code>b1413d4</code></a></td><td><code>build/bin/write-dockerfile.sh: Move 'ADD pkgs' earlier</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f44d45f9405860030bfbbe5fa30135d88dd8abc0"><code>f44d45f</code></a></td><td><code>Merge #33067</code></td></tr></table>




---

archive/issue_comments_467316.json:
```json
{
    "body": "Changed commit from **[`f44d45f`](https://github.com/sagemath/sagetrac-mirror/commit/f44d45f9405860030bfbbe5fa30135d88dd8abc0)** to **[`72fddad`](https://github.com/sagemath/sagetrac-mirror/commit/72fddad4a8f7e3379b2e7aaa597cd552cb273026)**",
    "created_at": "2021-12-22T20:27:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467316",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f44d45f`](https://github.com/sagemath/sagetrac-mirror/commit/f44d45f9405860030bfbbe5fa30135d88dd8abc0)** to **[`72fddad`](https://github.com/sagemath/sagetrac-mirror/commit/72fddad4a8f7e3379b2e7aaa597cd552cb273026)**



---

archive/issue_comments_467317.json:
```json
{
    "body": "<div id=\"comment:0\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/859be3ef9e3293f63fb18d8ac2a87e16f6f2114c\"><code>859be3e</code></a></td><td><code>build/bin/write-dockerfile.sh: ADD src/*.m4 files for bootstrapping</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72fddad4a8f7e3379b2e7aaa597cd552cb273026\"><code>72fddad</code></a></td><td><code>Merge #33067</code></td></tr></table>\n",
    "created_at": "2021-12-22T20:27:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467317",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:0"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/859be3ef9e3293f63fb18d8ac2a87e16f6f2114c"><code>859be3e</code></a></td><td><code>build/bin/write-dockerfile.sh: ADD src/*.m4 files for bootstrapping</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72fddad4a8f7e3379b2e7aaa597cd552cb273026"><code>72fddad</code></a></td><td><code>Merge #33067</code></td></tr></table>




---

archive/issue_comments_467318.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nA few fixes in package names in `spkg-configure.m4`:\n\n```\ndiff --git a/build/pkgs/argon2_cffi/spkg-configure.m4 b/build/pkgs/argon2_cffi/spkg-configure.m4\nindex 9ae7f2ea0c..ff476db0b2 100644\n--- a/build/pkgs/argon2_cffi/spkg-configure.m4\n+++ b/build/pkgs/argon2_cffi/spkg-configure.m4\n@@ -1 +1 @@\n-SAGE_SPKG_CONFIGURE([argon2-cffi], [SAGE_PYTHON_PACKAGE_CHECK([argon2-cffi])])\n+SAGE_SPKG_CONFIGURE([argon2_cffi], [SAGE_PYTHON_PACKAGE_CHECK([argon2-cffi])])\ndiff --git a/build/pkgs/jupyter_client/spkg-configure.m4 b/build/pkgs/jupyter_client/spkg-configure.m4\nindex 3c9bb26bb0..1d2735de59 100644\n--- a/build/pkgs/jupyter_client/spkg-configure.m4\n+++ b/build/pkgs/jupyter_client/spkg-configure.m4\n@@ -1 +1 @@\n-SAGE_SPKG_CONFIGURE([bleach], [SAGE_PYTHON_PACKAGE_CHECK([bleach])])\n+SAGE_SPKG_CONFIGURE([jupyter_client], [SAGE_PYTHON_PACKAGE_CHECK([jupyter_client])])\ndiff --git a/build/pkgs/matplotlib_inline/spkg-configure.m4 b/build/pkgs/matplotlib_inline/spkg-configure.m4\nindex 3af724d674..f72fef4802 100644\n--- a/build/pkgs/matplotlib_inline/spkg-configure.m4\n+++ b/build/pkgs/matplotlib_inline/spkg-configure.m4\n@@ -1,3 +1,3 @@\n-SAGE_SPKG_CONFIGURE([matplotlib-inline], [\n+SAGE_SPKG_CONFIGURE([matplotlib_inline], [\n   SAGE_PYTHON_PACKAGE_CHECK([matplotlib-inline])\n ])\n```\n\nEdit: small fix.",
    "created_at": "2021-12-30T22:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467318",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:1" align="right">comment:1</div>

A few fixes in package names in `spkg-configure.m4`:

```
diff --git a/build/pkgs/argon2_cffi/spkg-configure.m4 b/build/pkgs/argon2_cffi/spkg-configure.m4
index 9ae7f2ea0c..ff476db0b2 100644
--- a/build/pkgs/argon2_cffi/spkg-configure.m4
+++ b/build/pkgs/argon2_cffi/spkg-configure.m4
@@ -1 +1 @@
-SAGE_SPKG_CONFIGURE([argon2-cffi], [SAGE_PYTHON_PACKAGE_CHECK([argon2-cffi])])
+SAGE_SPKG_CONFIGURE([argon2_cffi], [SAGE_PYTHON_PACKAGE_CHECK([argon2-cffi])])
diff --git a/build/pkgs/jupyter_client/spkg-configure.m4 b/build/pkgs/jupyter_client/spkg-configure.m4
index 3c9bb26bb0..1d2735de59 100644
--- a/build/pkgs/jupyter_client/spkg-configure.m4
+++ b/build/pkgs/jupyter_client/spkg-configure.m4
@@ -1 +1 @@
-SAGE_SPKG_CONFIGURE([bleach], [SAGE_PYTHON_PACKAGE_CHECK([bleach])])
+SAGE_SPKG_CONFIGURE([jupyter_client], [SAGE_PYTHON_PACKAGE_CHECK([jupyter_client])])
diff --git a/build/pkgs/matplotlib_inline/spkg-configure.m4 b/build/pkgs/matplotlib_inline/spkg-configure.m4
index 3af724d674..f72fef4802 100644
--- a/build/pkgs/matplotlib_inline/spkg-configure.m4
+++ b/build/pkgs/matplotlib_inline/spkg-configure.m4
@@ -1,3 +1,3 @@
-SAGE_SPKG_CONFIGURE([matplotlib-inline], [
+SAGE_SPKG_CONFIGURE([matplotlib_inline], [
   SAGE_PYTHON_PACKAGE_CHECK([matplotlib-inline])
 ])
```

Edit: small fix.



---

archive/issue_comments_467319.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nA few more standard packages:\n\n```\ndiff --git a/build/pkgs/alabaster/spkg-configure.m4 b/build/pkgs/alabaster/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..4eca6e05a5\n--- /dev/null\n+++ b/build/pkgs/alabaster/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([alabaster], [SAGE_PYTHON_PACKAGE_CHECK([alabaster])])\ndiff --git a/build/pkgs/beniget/spkg-configure.m4 b/build/pkgs/beniget/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..8ae6101333\n--- /dev/null\n+++ b/build/pkgs/beniget/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([beniget], [SAGE_PYTHON_PACKAGE_CHECK([beniget])])\ndiff --git a/build/pkgs/gast/spkg-configure.m4 b/build/pkgs/gast/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..26ec59feae\n--- /dev/null\n+++ b/build/pkgs/gast/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([gast], [SAGE_PYTHON_PACKAGE_CHECK([gast])])\ndiff --git a/build/pkgs/gmpy2/spkg-configure.m4 b/build/pkgs/gmpy2/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..2d0390f7db\n--- /dev/null\n+++ b/build/pkgs/gmpy2/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([gmpy2], [SAGE_PYTHON_PACKAGE_CHECK([gmpy2])])\ndiff --git a/build/pkgs/importlib_metadata/spkg-configure.m4 b/build/pkgs/importlib_metadata/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..d940b101b8\n--- /dev/null\n+++ b/build/pkgs/importlib_metadata/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([importlib_metadata], [SAGE_PYTHON_PACKAGE_CHECK([importlib_metadata])])\ndiff --git a/build/pkgs/ply/spkg-configure.m4 b/build/pkgs/ply/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..ffb0030d01\n--- /dev/null\n+++ b/build/pkgs/ply/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([ply], [SAGE_PYTHON_PACKAGE_CHECK([ply])])\ndiff --git a/build/pkgs/pythran/spkg-configure.m4 b/build/pkgs/pythran/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..592e95bcb3\n--- /dev/null\n+++ b/build/pkgs/pythran/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([pythran], [SAGE_PYTHON_PACKAGE_CHECK([pythran])])\ndiff --git a/build/pkgs/typing_extensions/spkg-configure.m4 b/build/pkgs/typing_extensions/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..d475fd8257\n--- /dev/null\n+++ b/build/pkgs/typing_extensions/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([typing_extensions], [SAGE_PYTHON_PACKAGE_CHECK([typing_extensions])])\n```\n\nThere's also `cython` but it uses some patches so my system package, at the same version, doesn't work. The rest seems ok.",
    "created_at": "2021-12-30T23:22:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467319",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:2" align="right">comment:2</div>

A few more standard packages:

```
diff --git a/build/pkgs/alabaster/spkg-configure.m4 b/build/pkgs/alabaster/spkg-configure.m4
new file mode 100644
index 0000000000..4eca6e05a5
--- /dev/null
+++ b/build/pkgs/alabaster/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([alabaster], [SAGE_PYTHON_PACKAGE_CHECK([alabaster])])
diff --git a/build/pkgs/beniget/spkg-configure.m4 b/build/pkgs/beniget/spkg-configure.m4
new file mode 100644
index 0000000000..8ae6101333
--- /dev/null
+++ b/build/pkgs/beniget/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([beniget], [SAGE_PYTHON_PACKAGE_CHECK([beniget])])
diff --git a/build/pkgs/gast/spkg-configure.m4 b/build/pkgs/gast/spkg-configure.m4
new file mode 100644
index 0000000000..26ec59feae
--- /dev/null
+++ b/build/pkgs/gast/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([gast], [SAGE_PYTHON_PACKAGE_CHECK([gast])])
diff --git a/build/pkgs/gmpy2/spkg-configure.m4 b/build/pkgs/gmpy2/spkg-configure.m4
new file mode 100644
index 0000000000..2d0390f7db
--- /dev/null
+++ b/build/pkgs/gmpy2/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([gmpy2], [SAGE_PYTHON_PACKAGE_CHECK([gmpy2])])
diff --git a/build/pkgs/importlib_metadata/spkg-configure.m4 b/build/pkgs/importlib_metadata/spkg-configure.m4
new file mode 100644
index 0000000000..d940b101b8
--- /dev/null
+++ b/build/pkgs/importlib_metadata/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([importlib_metadata], [SAGE_PYTHON_PACKAGE_CHECK([importlib_metadata])])
diff --git a/build/pkgs/ply/spkg-configure.m4 b/build/pkgs/ply/spkg-configure.m4
new file mode 100644
index 0000000000..ffb0030d01
--- /dev/null
+++ b/build/pkgs/ply/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([ply], [SAGE_PYTHON_PACKAGE_CHECK([ply])])
diff --git a/build/pkgs/pythran/spkg-configure.m4 b/build/pkgs/pythran/spkg-configure.m4
new file mode 100644
index 0000000000..592e95bcb3
--- /dev/null
+++ b/build/pkgs/pythran/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([pythran], [SAGE_PYTHON_PACKAGE_CHECK([pythran])])
diff --git a/build/pkgs/typing_extensions/spkg-configure.m4 b/build/pkgs/typing_extensions/spkg-configure.m4
new file mode 100644
index 0000000000..d475fd8257
--- /dev/null
+++ b/build/pkgs/typing_extensions/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([typing_extensions], [SAGE_PYTHON_PACKAGE_CHECK([typing_extensions])])
```

There's also `cython` but it uses some patches so my system package, at the same version, doesn't work. The rest seems ok.



---

archive/issue_comments_467320.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI should mention that I'm using a patch created from branch `u/mjo/ticket/29665` rather than the whole thing to make it more manageable for me. I hope I'm not missing anything important.\n\nI'll let you know if anything goes wrong with doctesting. I'm now building using all possible system packages and python site packages available on void.",
    "created_at": "2021-12-30T23:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467320",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:3" align="right">comment:3</div>

I should mention that I'm using a patch created from branch `u/mjo/ticket/29665` rather than the whole thing to make it more manageable for me. I hope I'm not missing anything important.

I'll let you know if anything goes wrong with doctesting. I'm now building using all possible system packages and python site packages available on void.



---

archive/issue_comments_467321.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nEverything passes with the following patch which is neecessary if `alabaster` is used from system.\n\n```\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex 84f3d50de7..c7ad206959 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -386,9 +386,9 @@ def installed_packages(exclude_pip=True):\n     EXAMPLES::\n \n         sage: sorted(installed_packages().keys())  # optional - build\n-        [...'alabaster', ...'sage_conf', ...]\n-        sage: installed_packages()['alabaster']  # optional - build, random\n-        '0.7.12'\n+        [...'sage_conf', ...]\n+        sage: installed_packages()['sage_conf']  # optional - build, random\n+        '9.5'\n \n     .. SEEALSO::\n \n```",
    "created_at": "2021-12-31T02:15:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467321",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:4" align="right">comment:4</div>

Everything passes with the following patch which is neecessary if `alabaster` is used from system.

```
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index 84f3d50de7..c7ad206959 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -386,9 +386,9 @@ def installed_packages(exclude_pip=True):
     EXAMPLES::
 
         sage: sorted(installed_packages().keys())  # optional - build
-        [...'alabaster', ...'sage_conf', ...]
-        sage: installed_packages()['alabaster']  # optional - build, random
-        '0.7.12'
+        [...'sage_conf', ...]
+        sage: installed_packages()['sage_conf']  # optional - build, random
+        '9.5'
 
     .. SEEALSO::
 
```



---

archive/issue_comments_467322.json:
```json
{
    "body": "Changed commit from **[`72fddad`](https://github.com/sagemath/sagetrac-mirror/commit/72fddad4a8f7e3379b2e7aaa597cd552cb273026)** to **[`135f184`](https://github.com/sagemath/sagetrac-mirror/commit/135f184f7498a2046065e669723e68efe2d65cee)**",
    "created_at": "2021-12-31T02:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467322",
    "user": "https://github.com/orlitzky"
}
```

Changed commit from **[`72fddad`](https://github.com/sagemath/sagetrac-mirror/commit/72fddad4a8f7e3379b2e7aaa597cd552cb273026)** to **[`135f184`](https://github.com/sagemath/sagetrac-mirror/commit/135f184f7498a2046065e669723e68efe2d65cee)**



---

archive/issue_comments_467323.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)** to **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)**",
    "created_at": "2021-12-31T02:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467323",
    "user": "https://github.com/orlitzky"
}
```

Changed branch from **[u/mkoeppe/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/29665)** to **[u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)**



---

archive/issue_comments_467324.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks, I fixed the existing packages and added most of the new ones. I've left out `gmpy2` and `typing_extensions` because they aren't available in Gentoo yet (chicken and egg problem) so I'm unable to test them easily. I also added your alabaster doctest fix.\n\nI'm not sure if there were any new commits on Matthias's branch (it's impossible to tell when merge commits are involved), or if his dependencies are only intended to make this easier to test. In any case, I've switched it back to my branch which works fine in real life if not on github.",
    "created_at": "2021-12-31T02:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467324",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks, I fixed the existing packages and added most of the new ones. I've left out `gmpy2` and `typing_extensions` because they aren't available in Gentoo yet (chicken and egg problem) so I'm unable to test them easily. I also added your alabaster doctest fix.

I'm not sure if there were any new commits on Matthias's branch (it's impossible to tell when merge commits are involved), or if his dependencies are only intended to make this easier to test. In any case, I've switched it back to my branch which works fine in real life if not on github.



---

archive/issue_comments_467325.json:
```json
{
    "body": "<div id=\"comment:126\" align=\"right\">comment:126</div>\n\nReplying to [@orlitzky](#comment:125):\n> it's impossible to tell when merge commits are involved\n\ntry `git log --first-parent`",
    "created_at": "2021-12-31T02:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467325",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:126" align="right">comment:126</div>

Replying to [@orlitzky](#comment:125):
> it's impossible to tell when merge commits are involved

try `git log --first-parent`



---

archive/issue_comments_467326.json:
```json
{
    "body": "<div id=\"comment:127\" align=\"right\">comment:127</div>\n\nReplying to [@mkoeppe](#comment:126):\n> Replying to [@orlitzky](#comment:125):\n> > it's impossible to tell when merge commits are involved\n\n> \n> try `git log --first-parent`\n\nThanks, I've been missing this my entire adult life. Can we teach trac to use it?",
    "created_at": "2021-12-31T03:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467326",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:127" align="right">comment:127</div>

Replying to [@mkoeppe](#comment:126):
> Replying to [@orlitzky](#comment:125):
> > it's impossible to tell when merge commits are involved

> 
> try `git log --first-parent`

Thanks, I've been missing this my entire adult life. Can we teach trac to use it?



---

archive/issue_comments_467327.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nCan `pytest` be not isolated also?",
    "created_at": "2021-12-31T10:34:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467327",
    "user": "https://github.com/sheerluck"
}
```

<div id="comment:8" align="right">comment:8</div>

Can `pytest` be not isolated also?



---

archive/issue_comments_467328.json:
```json
{
    "body": "<div id=\"comment:129\" align=\"right\">comment:129</div>\n\nReplying to [@sheerluck](#comment:128):\n> Can `pytest` be not isolated also?\n\nOh, yes, I forgot: since pytest gives problems (see #31924) I had to disable it:\n\n```\ndiff --git a/src/bin/sage-runtests b/src/bin/sage-runtests\nindex 589dc8cd37..6bb8bf99a4 100755\n--- a/src/bin/sage-runtests\n+++ b/src/bin/sage-runtests\n@@ -154,21 +154,4 @@ if __name__ == \"__main__\":\n     DC = DocTestController(args, args.filenames)\n     err = DC.run()\n \n-    try:\n-        exit_code_pytest = 0\n-        import pytest\n-        pytest_options = [\"--import-mode\", \"importlib\"]\n-        if args.verbose:\n-            pytest_options.append(\"-v\")\n-        exit_code_pytest = pytest.main(pytest_options + args.filenames)\n-        if exit_code_pytest == 5:\n-            # Exit code 5 means there were no test files, pass in this case\n-            exit_code_pytest = 0\n-\n-    except ModuleNotFoundError:\n-        print(\"Pytest is not installed, skip checking tests that rely on it.\")\n-\n-    if err == 0:\n-        sys.exit(exit_code_pytest)\n-    else:\n-        sys.exit(err)\n+    sys.exit(err)\n```\n\nI don't know any other way to workaround this problem until #31924 is fixed.",
    "created_at": "2021-12-31T15:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467328",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:129" align="right">comment:129</div>

Replying to [@sheerluck](#comment:128):
> Can `pytest` be not isolated also?

Oh, yes, I forgot: since pytest gives problems (see #31924) I had to disable it:

```
diff --git a/src/bin/sage-runtests b/src/bin/sage-runtests
index 589dc8cd37..6bb8bf99a4 100755
--- a/src/bin/sage-runtests
+++ b/src/bin/sage-runtests
@@ -154,21 +154,4 @@ if __name__ == "__main__":
     DC = DocTestController(args, args.filenames)
     err = DC.run()
 
-    try:
-        exit_code_pytest = 0
-        import pytest
-        pytest_options = ["--import-mode", "importlib"]
-        if args.verbose:
-            pytest_options.append("-v")
-        exit_code_pytest = pytest.main(pytest_options + args.filenames)
-        if exit_code_pytest == 5:
-            # Exit code 5 means there were no test files, pass in this case
-            exit_code_pytest = 0
-
-    except ModuleNotFoundError:
-        print("Pytest is not installed, skip checking tests that rely on it.")
-
-    if err == 0:
-        sys.exit(exit_code_pytest)
-    else:
-        sys.exit(err)
+    sys.exit(err)
```

I don't know any other way to workaround this problem until #31924 is fixed.



---

archive/issue_comments_467329.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nFor the record, in addition to what is in the current patch, I'm also using from system:\n- `gmpy2-2.1.1` (I had to patch `install-requires.txt` since it currently requires `2.1.0rc1`)\n- `sphinx-4.3.2` (I had to update it in void linux)\n- `typing_extensions-3.10.0.2`\n\nI also had to patch `ptyprocess/install-requires.txt` to allow `ptyprocess-0.7.0` since it currently requires `0.5.1` but this version seems to work ok.\n\nOf all the python packages added by this patch only three were not available for me on void linux: `cvxopt`, `importlib_resources` and `debugpy`, everything else was tested (note that `debugpy` is optional now)",
    "created_at": "2021-12-31T18:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467329",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:0" align="right">comment:0</div>

For the record, in addition to what is in the current patch, I'm also using from system:
- `gmpy2-2.1.1` (I had to patch `install-requires.txt` since it currently requires `2.1.0rc1`)
- `sphinx-4.3.2` (I had to update it in void linux)
- `typing_extensions-3.10.0.2`

I also had to patch `ptyprocess/install-requires.txt` to allow `ptyprocess-0.7.0` since it currently requires `0.5.1` but this version seems to work ok.

Of all the python packages added by this patch only three were not available for me on void linux: `cvxopt`, `importlib_resources` and `debugpy`, everything else was tested (note that `debugpy` is optional now)



---

archive/issue_comments_467330.json:
```json
{
    "body": "<div id=\"comment:131\" align=\"right\">comment:131</div>\n\nReplying to [@tornaria](#comment:130):\n> I also had to patch `ptyprocess/install-requires.txt` to allow `ptyprocess-0.7.0` since it currently requires `0.5.1` but this version seems to work ok.\n\nSee #32147",
    "created_at": "2021-12-31T18:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467330",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:131" align="right">comment:131</div>

Replying to [@tornaria](#comment:130):
> I also had to patch `ptyprocess/install-requires.txt` to allow `ptyprocess-0.7.0` since it currently requires `0.5.1` but this version seems to work ok.

See #32147



---

archive/issue_comments_467331.json:
```json
{
    "body": "<div id=\"comment:132\" align=\"right\">comment:132</div>\n\nReplying to [@tornaria](#comment:130):\n> For the record, in addition to what is in the current patch, I'm also using from system:\n> - `gmpy2-2.1.1` (I had to patch `install-requires.txt` since it currently requires `2.1.0rc1`)\n\nThis is now done in the updated #33070",
    "created_at": "2022-01-01T04:37:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467331",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:132" align="right">comment:132</div>

Replying to [@tornaria](#comment:130):
> For the record, in addition to what is in the current patch, I'm also using from system:
> - `gmpy2-2.1.1` (I had to patch `install-requires.txt` since it currently requires `2.1.0rc1`)

This is now done in the updated #33070



---

archive/issue_comments_467332.json:
```json
{
    "body": "Changed commit from **[`135f184`](https://github.com/sagemath/sagetrac-mirror/commit/135f184f7498a2046065e669723e68efe2d65cee)** to **[`baf6301`](https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb)**",
    "created_at": "2022-02-07T12:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467332",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`135f184`](https://github.com/sagemath/sagetrac-mirror/commit/135f184f7498a2046065e669723e68efe2d65cee)** to **[`baf6301`](https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb)**



---

archive/issue_comments_467333.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfb0918a9ec8da1486e8b8314da6e77eab0bafbd\"><code>dfb0918</code></a></td><td><code>Trac #29665: add Gentoo package information for gast.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4440b33292f5f9c49670c6300668d72d819f3f57\"><code>4440b33</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pythran.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72f05ace8503a1060afcc4e5de6f674210ac18b3\"><code>72f05ac</code></a></td><td><code>Trac #29665: add Gentoo package information for pythran.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b69262df310016232830f34088b0ebd108dd826\"><code>3b69262</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for beniget.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84e27c022e8be70c8dadb1f93dd26a6c36284bf2\"><code>84e27c0</code></a></td><td><code>Trac #29665: add Gentoo package information for beniget.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e30ff80ab51af02e2f47f28b41f9c2c885d0cc3\"><code>5e30ff8</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for alabaster.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20c35c1873955cc405aa3d8623c48648b2eef8a0\"><code>20c35c1</code></a></td><td><code>Trac #29665: add Gentoo package information for alabaster.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be8b43cb3601488ee0a88b3be15bdae23a148a29\"><code>be8b43c</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for importlib_metadata.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/afd682a78c971c31142dd8b600178b355329002f\"><code>afd682a</code></a></td><td><code>Trac #29665: add Gentoo package information for importlib_metadata.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb\"><code>baf6301</code></a></td><td><code>Trac #29665: fix sage.misc.package doctest with system alabaster.</code></td></tr></table>\n",
    "created_at": "2022-02-07T12:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29665#issuecomment-467333",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfb0918a9ec8da1486e8b8314da6e77eab0bafbd"><code>dfb0918</code></a></td><td><code>Trac #29665: add Gentoo package information for gast.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4440b33292f5f9c49670c6300668d72d819f3f57"><code>4440b33</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for pythran.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72f05ace8503a1060afcc4e5de6f674210ac18b3"><code>72f05ac</code></a></td><td><code>Trac #29665: add Gentoo package information for pythran.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b69262df310016232830f34088b0ebd108dd826"><code>3b69262</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for beniget.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84e27c022e8be70c8dadb1f93dd26a6c36284bf2"><code>84e27c0</code></a></td><td><code>Trac #29665: add Gentoo package information for beniget.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e30ff80ab51af02e2f47f28b41f9c2c885d0cc3"><code>5e30ff8</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for alabaster.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20c35c1873955cc405aa3d8623c48648b2eef8a0"><code>20c35c1</code></a></td><td><code>Trac #29665: add Gentoo package information for alabaster.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be8b43cb3601488ee0a88b3be15bdae23a148a29"><code>be8b43c</code></a></td><td><code>Trac #29665: standard python spkg-configure.m4 for importlib_metadata.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/afd682a78c971c31142dd8b600178b355329002f"><code>afd682a</code></a></td><td><code>Trac #29665: add Gentoo package information for importlib_metadata.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb"><code>baf6301</code></a></td><td><code>Trac #29665: fix sage.misc.package doctest with system alabaster.</code></td></tr></table>

