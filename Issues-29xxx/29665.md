# Issue 29665: configure --enable-system-site-packages via spkg-configure.m4 for cvxopt and other python packages

archive/issues_029428.json:
```json
{
    "body": "This ticket adds an spkg-configure.m4 for cvxopt and various other python packages, to allow them to be used from the system (part of #27330).\n\nThese python packages are special because we currently use a python \"venv\" that is isolated from the system. Thus this ticket proceeds in several steps:\n\n1. Add an `--enable-system-site-packages` flag to the top-level `./configure` script. When present, this will tell `sage-venv` that the venv it creates **should not** be isolated from the system.\n2. Create a new macro that can detect python packages on the system. It should ensure that the version bounds in each python package's `install-requires.txt` are met.\n3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.\n4. Test everything thoroughly with various combinations of system and non-system python packages.\n\nPlatform-specific testing:\n- for example `TARGETS_PRE=\"build-local\" EXTRA_CONFIGURE_ARGS=\"--enable-system-site-packages\" tox -e docker-ubuntu-focal-standard -- build ptest`\n\n\nKeywords: cvxopt; spkg-configure; system packages; Python library\n\nBranch: [u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)\n\nCommit: [baf63017c93ffb135f33e49c5a15bda33a5ecffb](https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb)\n\nAuthor: Michael Orlitzky\n\nStatus: needs_review\n\nDependencies: #32703, #33067\n\nIssue created by migration from https://trac.sagemath.org/ticket/29665\n\n",
    "created_at": "2020-05-08T14:40:42Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-pending",
    "title": "configure --enable-system-site-packages via spkg-configure.m4 for cvxopt and other python packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29665",
    "user": "https://github.com/thierry-FreeBSD"
}
```
This ticket adds an spkg-configure.m4 for cvxopt and various other python packages, to allow them to be used from the system (part of #27330).

These python packages are special because we currently use a python "venv" that is isolated from the system. Thus this ticket proceeds in several steps:

1. Add an `--enable-system-site-packages` flag to the top-level `./configure` script. When present, this will tell `sage-venv` that the venv it creates **should not** be isolated from the system.
2. Create a new macro that can detect python packages on the system. It should ensure that the version bounds in each python package's `install-requires.txt` are met.
3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.
4. Test everything thoroughly with various combinations of system and non-system python packages.

Platform-specific testing:
- for example `TARGETS_PRE="build-local" EXTRA_CONFIGURE_ARGS="--enable-system-site-packages" tox -e docker-ubuntu-focal-standard -- build ptest`


Keywords: cvxopt; spkg-configure; system packages; Python library

Branch: [u/mjo/ticket/29665](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29665)

Commit: [baf63017c93ffb135f33e49c5a15bda33a5ecffb](https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb)

Author: Michael Orlitzky

Status: needs_review

Dependencies: #32703, #33067

Issue created by migration from https://trac.sagemath.org/ticket/29665





---

archive/issue_comments_581488.json:
```json
{
    "body": "spkg-configure.m4 to be copied under build/pkgs/cvxopt",
    "created_at": "2020-05-08T14:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581488",
    "user": "https://github.com/thierry-FreeBSD"
}
```

spkg-configure.m4 to be copied under build/pkgs/cvxopt



---

archive/issue_comments_581489.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [spkg-configure.m4](tarball://root/attachments/some-uuid/ticket29665/spkg-configure.m4) by @mkoeppe created at 2020-05-08 14:56:07\n\nI don't see a branch",
    "created_at": "2020-05-08T14:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581489",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
Attachment [spkg-configure.m4](tarball://root/attachments/some-uuid/ticket29665/spkg-configure.m4) by @mkoeppe created at 2020-05-08 14:56:07

I don't see a branch



---

archive/issue_comments_581490.json:
```json
{
    "body": "<a id='comment:2'></a>\nSee comments in #29023",
    "created_at": "2020-05-08T15:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581490",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
See comments in #29023



---

archive/issue_comments_581491.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt\"",
    "created_at": "2020-05-09T09:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581491",
    "user": "https://github.com/thierry-FreeBSD"
}
```

Changing branch from "" to "u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt"



---

archive/issue_comments_581492.json:
```json
{
    "body": "<a id='comment:4'></a>\n\"wontfix\" because of #29023\n\n---\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[ac66801](https://github.com/sagemath/sagetrac-mirror/commit/ac668017532cede326d69aad5cf6094b2f4dcbce)|`Experimental spkg-configure.m4 for cvxopt`|",
    "created_at": "2020-08-11T17:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581492",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
"wontfix" because of #29023

---
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[ac66801](https://github.com/sagemath/sagetrac-mirror/commit/ac668017532cede326d69aad5cf6094b2f4dcbce)|`Experimental spkg-configure.m4 for cvxopt`|



---

archive/issue_comments_581493.json:
```json
{
    "body": "Changing commit from \"\" to \"ac668017532cede326d69aad5cf6094b2f4dcbce\"",
    "created_at": "2020-08-11T17:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581493",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "ac668017532cede326d69aad5cf6094b2f4dcbce"



---

archive/issue_events_085581.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-11T17:37:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29665#event-85581"
}
```



---

archive/issue_comments_581494.json:
```json
{
    "body": "Changing author from \"gh-thierry-FreeBSD\" to \"\"",
    "created_at": "2020-08-11T17:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581494",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "gh-thierry-FreeBSD" to ""



---

archive/issue_comments_581495.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-11T17:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581495",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_581496.json:
```json
{
    "body": "<a id='comment:5'></a>\nThere is per se nothing wrong with having spkg-configure.m4 for Python packages.",
    "created_at": "2020-08-13T09:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581496",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
There is per se nothing wrong with having spkg-configure.m4 for Python packages.



---

archive/issue_comments_581497.json:
```json
{
    "body": "<a id='comment:6'></a>\nNot per se, only per the big picture.",
    "created_at": "2020-08-13T14:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581497",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Not per se, only per the big picture.



---

archive/issue_comments_581498.json:
```json
{
    "body": "<a id='comment:7'></a>\nRegardless of what we eventually wind up with... does this work? Does it hurt anything? The solution in #29023 could be years away. If we can avoid building e.g. numpy, scipy, matplotlib, and cvxopt with relatively trivial spkg-configures until then, why not do it?",
    "created_at": "2021-09-18T18:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581498",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>
Regardless of what we eventually wind up with... does this work? Does it hurt anything? The solution in #29023 could be years away. If we can avoid building e.g. numpy, scipy, matplotlib, and cvxopt with relatively trivial spkg-configures until then, why not do it?



---

archive/issue_comments_581499.json:
```json
{
    "body": "<a id='comment:8'></a>\nNo, it does not work.",
    "created_at": "2021-09-18T18:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581499",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
No, it does not work.



---

archive/issue_comments_581500.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [mkoeppe](#comment%3A8):\n> No, it does not work. \n\n\nWhat goes wrong? I just did a quick test (without this branch):\n\n1. make cvxopt-clean\n2. install system cvxopt\n3. touch any file in sagelib names `*cvxopt*`\n4. sage -b\n5. run some tests on said cvxopt files\n\nBehavior is unchanged as far as I can tell.",
    "created_at": "2021-09-19T00:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581500",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:9'></a>
Replying to [mkoeppe](#comment%3A8):
> No, it does not work. 


What goes wrong? I just did a quick test (without this branch):

1. make cvxopt-clean
2. install system cvxopt
3. touch any file in sagelib names `*cvxopt*`
4. sage -b
5. run some tests on said cvxopt files

Behavior is unchanged as far as I can tell.



---

archive/issue_comments_581501.json:
```json
{
    "body": "<a id='comment:10'></a>\nSound like you forgot to test with `--optional=sage,cvxopt`. \n\nSage runs in a venv that does not provide access to system site packages.",
    "created_at": "2021-09-19T00:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581501",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Sound like you forgot to test with `--optional=sage,cvxopt`. 

Sage runs in a venv that does not provide access to system site packages.



---

archive/issue_comments_581502.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mkoeppe](#comment%3A10):\n> Sound like you forgot to test with `--optional=sage,cvxopt`. \n> \n> Sage runs in a venv that does not provide access to system site packages.\n\n\nLucky guess! I forgot we made it possible to disable cvxopt even though it's type=standard. On the surface, setting  `include-system-site-packages = true` in `local/pyvenv.cfg` looks like it solves that, and is one of the first steps mentioned on #29023. What necessitates the next step B.2. in #29023? In other words, what's the next thing that's going to go wrong for me?",
    "created_at": "2021-09-19T00:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581502",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:11'></a>
Replying to [mkoeppe](#comment%3A10):
> Sound like you forgot to test with `--optional=sage,cvxopt`. 
> 
> Sage runs in a venv that does not provide access to system site packages.


Lucky guess! I forgot we made it possible to disable cvxopt even though it's type=standard. On the surface, setting  `include-system-site-packages = true` in `local/pyvenv.cfg` looks like it solves that, and is one of the first steps mentioned on #29023. What necessitates the next step B.2. in #29023? In other words, what's the next thing that's going to go wrong for me?



---

archive/issue_comments_581503.json:
```json
{
    "body": "<a id='comment:12'></a>\nLet's take the discussion of #29023 to #29023. I think it would be fine if you want to go ahead with step B.1 (via a new option `./configure --enable-system-site-packages`) in a ticket, for users to experiment.",
    "created_at": "2021-09-19T01:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581503",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Let's take the discussion of #29023 to #29023. I think it would be fine if you want to go ahead with step B.1 (via a new option `./configure --enable-system-site-packages`) in a ticket, for users to experiment.



---

archive/issue_comments_581504.json:
```json
{
    "body": "Changing commit from \"ac668017532cede326d69aad5cf6094b2f4dcbce\" to \"faed9990a0b99fa50fe843cca981cb855c88b224\"",
    "created_at": "2021-10-11T13:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581504",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "ac668017532cede326d69aad5cf6094b2f4dcbce" to "faed9990a0b99fa50fe843cca981cb855c88b224"



---

archive/issue_comments_581505.json:
```json
{
    "body": "<a id='comment:13'></a>\nMatthias, does something like this fit with your master plan?\n\n---\nLast 10 new commits:\n|                                                                                                                                          |                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[17860f7](https://github.com/sagemath/sagetrac-mirror/commit/17860f7322b0ac5a2bdc988594ab742512661f48)|`Trac #29665: spkg-configure.m4 for requests.`|\n|[67db9ef](https://github.com/sagemath/sagetrac-mirror/commit/67db9ef2f9c14641dcb3e84c6d8f4096d428badc)|`Trac #29665: spkg-configure.m4 for six.`|\n|[ef80d1a](https://github.com/sagemath/sagetrac-mirror/commit/ef80d1a90769047325dd5ded1189b39548e9f845)|`Trac #29665: spkg-configure.m4 for packaging.`|\n|[310e56b](https://github.com/sagemath/sagetrac-mirror/commit/310e56b506cbb331eb6b2a1933336162fe7e0da5)|`Trac #29665: spkg-configure.m4 for numpy.`|\n|[8d6a740](https://github.com/sagemath/sagetrac-mirror/commit/8d6a7405499bd971722c3b70be7cae1b8aaaa652)|`Trac #29665: spkg-configure.m4 for scipy.`|\n|[fe16a90](https://github.com/sagemath/sagetrac-mirror/commit/fe16a90568f0f9710ee258a9900b59c355651ad2)|`Trac #29665: spkg-configure.m4 for pluggy.`|\n|[57cb9be](https://github.com/sagemath/sagetrac-mirror/commit/57cb9be16712fef73fe2e260dc921fb9236e9ba0)|`Trac #29665: spkg-configure.m4 for toml.`|\n|[f976afa](https://github.com/sagemath/sagetrac-mirror/commit/f976afae9b32fcac92f4164707a51e45e0469c9f)|`Trac #29665: spkg-configure.m4 for pickleshare.`|\n|[4137218](https://github.com/sagemath/sagetrac-mirror/commit/413721841a8aa0486e5d31f85a11d784d521975a)|`Trac #29665: spkg-configure.m4 for html5lib.`|\n|[faed999](https://github.com/sagemath/sagetrac-mirror/commit/faed9990a0b99fa50fe843cca981cb855c88b224)|`Trac #29665: spkg-configure.m4 for scandir.`|",
    "created_at": "2021-10-11T13:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581505",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:13'></a>
Matthias, does something like this fit with your master plan?

---
Last 10 new commits:
|                                                                                                                                          |                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[17860f7](https://github.com/sagemath/sagetrac-mirror/commit/17860f7322b0ac5a2bdc988594ab742512661f48)|`Trac #29665: spkg-configure.m4 for requests.`|
|[67db9ef](https://github.com/sagemath/sagetrac-mirror/commit/67db9ef2f9c14641dcb3e84c6d8f4096d428badc)|`Trac #29665: spkg-configure.m4 for six.`|
|[ef80d1a](https://github.com/sagemath/sagetrac-mirror/commit/ef80d1a90769047325dd5ded1189b39548e9f845)|`Trac #29665: spkg-configure.m4 for packaging.`|
|[310e56b](https://github.com/sagemath/sagetrac-mirror/commit/310e56b506cbb331eb6b2a1933336162fe7e0da5)|`Trac #29665: spkg-configure.m4 for numpy.`|
|[8d6a740](https://github.com/sagemath/sagetrac-mirror/commit/8d6a7405499bd971722c3b70be7cae1b8aaaa652)|`Trac #29665: spkg-configure.m4 for scipy.`|
|[fe16a90](https://github.com/sagemath/sagetrac-mirror/commit/fe16a90568f0f9710ee258a9900b59c355651ad2)|`Trac #29665: spkg-configure.m4 for pluggy.`|
|[57cb9be](https://github.com/sagemath/sagetrac-mirror/commit/57cb9be16712fef73fe2e260dc921fb9236e9ba0)|`Trac #29665: spkg-configure.m4 for toml.`|
|[f976afa](https://github.com/sagemath/sagetrac-mirror/commit/f976afae9b32fcac92f4164707a51e45e0469c9f)|`Trac #29665: spkg-configure.m4 for pickleshare.`|
|[4137218](https://github.com/sagemath/sagetrac-mirror/commit/413721841a8aa0486e5d31f85a11d784d521975a)|`Trac #29665: spkg-configure.m4 for html5lib.`|
|[faed999](https://github.com/sagemath/sagetrac-mirror/commit/faed9990a0b99fa50fe843cca981cb855c88b224)|`Trac #29665: spkg-configure.m4 for scandir.`|



---

archive/issue_comments_581506.json:
```json
{
    "body": "Changing branch from \"u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt\" to \"u/mjo/ticket/29665\"",
    "created_at": "2021-10-11T13:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581506",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "u/gh-thierry-FreeBSD/spkg_configure_m4_for_cvxopt" to "u/mjo/ticket/29665"



---

archive/issue_comments_581507.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-10-11T13:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581507",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_581508.json:
```json
{
    "body": "<a id='comment:14'></a>\nI wouldn't object to doing something like this, as it is clearly marked experimental.\n\nHowever, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.\n\nAlso the version constraints shouldn't be hardcoded in the spkg-configure.m4 file; instead, they should really be taken from `install-requires.txt`.\nLikewise, don't use distutils, it's on its way out. Use a higher-level library that can check the requirements\n\nAlso, note `scandir` is gone after #32626",
    "created_at": "2021-10-11T17:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581508",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
I wouldn't object to doing something like this, as it is clearly marked experimental.

However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.

Also the version constraints shouldn't be hardcoded in the spkg-configure.m4 file; instead, they should really be taken from `install-requires.txt`.
Likewise, don't use distutils, it's on its way out. Use a higher-level library that can check the requirements

Also, note `scandir` is gone after #32626



---

archive/issue_events_085582.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-11T17:14:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29665#event-85582"
}
```



---

archive/issue_events_085583.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-11T17:14:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29665#event-85583"
}
```



---

archive/issue_comments_581509.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[b7a0dcb](https://github.com/sagemath/sagetrac-mirror/commit/b7a0dcb101bf6bf300e2ed121247105a1182730f)|`Trac #29665: new spkg-configure.m4 for pillow.`|\n|[b4252ed](https://github.com/sagemath/sagetrac-mirror/commit/b4252edd29c54f89d992e8a3a4eb0accea59aca4)|`Trac #29665: standard python spkg-configure.m4 for mpmath.`|\n|[1b20db3](https://github.com/sagemath/sagetrac-mirror/commit/1b20db345d093550b3345211cee9ecd629343d2c)|`Trac #29665: standard python spkg-configure.m4 for sympy.`|\n|[37c7732](https://github.com/sagemath/sagetrac-mirror/commit/37c7732bcf2f8106102c0f080067cc03e8c7d4e1)|`Trac #29665: standard python spkg-configure.m4 for pygments.`|\n|[c0dce08](https://github.com/sagemath/sagetrac-mirror/commit/c0dce081312877a63b8fc9f8b974262f774f5fdd)|`Trac #29665: standard python spkg-configure.m4 for jinja2.`|\n|[492471a](https://github.com/sagemath/sagetrac-mirror/commit/492471a37e9a15776957dabb2730f904b21795d2)|`Trac #29665: standard python spkg-configure.m4 for pandocfilters.`|\n|[9d70ed5](https://github.com/sagemath/sagetrac-mirror/commit/9d70ed54592a94afa32071e4b1a80ef1fe0cfb04)|`Trac #29665: standard python spkg-configure.m4 for webencodings.`|\n|[71cc574](https://github.com/sagemath/sagetrac-mirror/commit/71cc57428c6311e2920b7b16091e360501eb9232)|`Trac #29665: standard python spkg-configure.m4 for pytz.`|\n|[29e95b2](https://github.com/sagemath/sagetrac-mirror/commit/29e95b2db4d9ee1a43e43b16c3a408fec27bc97d)|`Trac #29665: standard python spkg-configure.m4 for texttable.`|\n|[6a5246d](https://github.com/sagemath/sagetrac-mirror/commit/6a5246dbbc980ebf97dd6b1fba70e58d198d9db3)|`Trac #29665: standard python spkg-configure.m4 for babel.`|",
    "created_at": "2021-10-12T14:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581509",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[b7a0dcb](https://github.com/sagemath/sagetrac-mirror/commit/b7a0dcb101bf6bf300e2ed121247105a1182730f)|`Trac #29665: new spkg-configure.m4 for pillow.`|
|[b4252ed](https://github.com/sagemath/sagetrac-mirror/commit/b4252edd29c54f89d992e8a3a4eb0accea59aca4)|`Trac #29665: standard python spkg-configure.m4 for mpmath.`|
|[1b20db3](https://github.com/sagemath/sagetrac-mirror/commit/1b20db345d093550b3345211cee9ecd629343d2c)|`Trac #29665: standard python spkg-configure.m4 for sympy.`|
|[37c7732](https://github.com/sagemath/sagetrac-mirror/commit/37c7732bcf2f8106102c0f080067cc03e8c7d4e1)|`Trac #29665: standard python spkg-configure.m4 for pygments.`|
|[c0dce08](https://github.com/sagemath/sagetrac-mirror/commit/c0dce081312877a63b8fc9f8b974262f774f5fdd)|`Trac #29665: standard python spkg-configure.m4 for jinja2.`|
|[492471a](https://github.com/sagemath/sagetrac-mirror/commit/492471a37e9a15776957dabb2730f904b21795d2)|`Trac #29665: standard python spkg-configure.m4 for pandocfilters.`|
|[9d70ed5](https://github.com/sagemath/sagetrac-mirror/commit/9d70ed54592a94afa32071e4b1a80ef1fe0cfb04)|`Trac #29665: standard python spkg-configure.m4 for webencodings.`|
|[71cc574](https://github.com/sagemath/sagetrac-mirror/commit/71cc57428c6311e2920b7b16091e360501eb9232)|`Trac #29665: standard python spkg-configure.m4 for pytz.`|
|[29e95b2](https://github.com/sagemath/sagetrac-mirror/commit/29e95b2db4d9ee1a43e43b16c3a408fec27bc97d)|`Trac #29665: standard python spkg-configure.m4 for texttable.`|
|[6a5246d](https://github.com/sagemath/sagetrac-mirror/commit/6a5246dbbc980ebf97dd6b1fba70e58d198d9db3)|`Trac #29665: standard python spkg-configure.m4 for babel.`|



---

archive/issue_comments_581510.json:
```json
{
    "body": "Changing commit from \"faed9990a0b99fa50fe843cca981cb855c88b224\" to \"6a5246dbbc980ebf97dd6b1fba70e58d198d9db3\"",
    "created_at": "2021-10-12T14:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "faed9990a0b99fa50fe843cca981cb855c88b224" to "6a5246dbbc980ebf97dd6b1fba70e58d198d9db3"



---

archive/issue_comments_581511.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mkoeppe](#comment%3A14):\n> \n> However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.\n\n\nHow so? The version information is maintained separately in `install-requires.txt`. And on Gentoo, most of these packages are already present and maintained by somebody else.\n\n> Also the version constraints shouldn't be hardcoded in the spkg-configure.m4 file; instead, they should really be taken from `install-requires.txt`.\n\n\nDone.\n\n> Likewise, don't use distutils, it's on its way out. Use a higher-level library that can check the requirements\n\n\nI'm using setuptools now, because I figure it (with its vendored \"packaging\") is more likely to be present than the \"packaging\" package itself.\n\n> Also, note `scandir` is gone after #32626\n\n\nThanks, I dropped that one, and added a few more.",
    "created_at": "2021-10-12T14:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581511",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:17'></a>
Replying to [mkoeppe](#comment%3A14):
> 
> However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.


How so? The version information is maintained separately in `install-requires.txt`. And on Gentoo, most of these packages are already present and maintained by somebody else.

> Also the version constraints shouldn't be hardcoded in the spkg-configure.m4 file; instead, they should really be taken from `install-requires.txt`.


Done.

> Likewise, don't use distutils, it's on its way out. Use a higher-level library that can check the requirements


I'm using setuptools now, because I figure it (with its vendored "packaging") is more likely to be present than the "packaging" package itself.

> Also, note `scandir` is gone after #32626


Thanks, I dropped that one, and added a few more.



---

archive/issue_comments_581512.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Orlitzky\"",
    "created_at": "2021-10-12T14:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581512",
    "user": "https://github.com/orlitzky"
}
```

Changing author from "" to "Michael Orlitzky"



---

archive/issue_comments_581513.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-12T14:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581513",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_581514.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [mjo](#comment%3A17):\n> Replying to [mkoeppe](#comment%3A14):\n> > \n> > However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.\n\n> \n> How so? The version information is maintained separately in `install-requires.txt`. And on Gentoo, most of these packages are already present and maintained by somebody else.\n\n\nThe metadata in these packages (distributions published on PyPI) declares install-requires as well. pip's resolver inspects all of these version constraints.",
    "created_at": "2021-10-12T16:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581514",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Replying to [mjo](#comment%3A17):
> Replying to [mkoeppe](#comment%3A14):
> > 
> > However, be prepared for a long-term burden of maintenance regarding the declared version ranges. Lots of things can go wrong because the individual packages often have complicated version constraints.

> 
> How so? The version information is maintained separately in `install-requires.txt`. And on Gentoo, most of these packages are already present and maintained by somebody else.


The metadata in these packages (distributions published on PyPI) declares install-requires as well. pip's resolver inspects all of these version constraints.



---

archive/issue_comments_581515.json:
```json
{
    "body": "<a id='comment:20'></a>\nCould you update the ticket description please?",
    "created_at": "2021-10-12T16:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581515",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Could you update the ticket description please?



---

archive/issue_comments_581516.json:
```json
{
    "body": "<a id='comment:21'></a>\nWith #32442, which sets up `SAGE_VENV = SAGE_LOCAL/var/lib/sage/venv-PYTHONVERSION` by default, one could consider to use a suffix `+site` in the case that `--enable-system-site-packages` was used.",
    "created_at": "2021-10-12T16:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581516",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
With #32442, which sets up `SAGE_VENV = SAGE_LOCAL/var/lib/sage/venv-PYTHONVERSION` by default, one could consider to use a suffix `+site` in the case that `--enable-system-site-packages` was used.



---

archive/issue_comments_581517.json:
```json
{
    "body": "<a id='comment:22'></a>\nAlso, when `--enable-system-site-packages` has been given but system python3 is not used, this should be an error.",
    "created_at": "2021-10-12T17:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581517",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Also, when `--enable-system-site-packages` has been given but system python3 is not used, this should be an error.



---

archive/issue_events_085584.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "rename": {
        "from": "spkg-configure.m4 for cvxopt",
        "to": "spkg-configure.m4 for cvxopt and other python packages"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29665#event-85584"
}
```



---

archive/issue_comments_581518.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,9 @@\n-This ticket adds an spkg-configure.m4 for cvxopt, in order to use it from a system package if possible (see #27330).\n+This ticket adds an spkg-configure.m4 for cvxopt and various other python packages, to allow them to be used from the system (part of #27330).\n \n-This one is a bit special, because cvxopt is a Python module.\n+These python packages are special because we currently use a python \"venv\" that is isolated from the system. Thus this ticket proceeds in several steps:\n \n-The proposed attachment uses `python3`: I don\u00b4t like that, but at this point `$ac_path_PYTHON3` is not yet defined. (Note: on FreeBSD we have no python3 by default, and I have to patch it with the real versioned program name, but I guess that `python3` is more portable)\n+1. Add an `--enable-system-site-packages` flag to the top-level `./configure` script. When present, this will tell `sage-venv` that the venv it creates **should not** be isolated from the system.\n+2. Create a new macro that can detect python packages on the system. It should ensure that the version bounds in each python package's `install-requires.txt` are met.\n+3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.\n+4. Test everything thoroughly with various combinations of system and non-system python packages.\n \n-To build Sage with it, `build/make/install` must be modified: it sets `PYTHONPATH` to `$SAGE_LOCAL`, and the system-wide Python modules are not found. It must be replaced by something like\n-\n-```\n-\"$SAGE_LOCAL:$SAGE_LOCAL/$PYTHON_SITELIBDIR:$PYTHON_SITELIBDIR\"\n-```\n-\n-with `$PYTHON_SITELIBDIR` being the site-packages directory used. So the Sage-built packages are always found in the first place, and those from the system are found when needed.\n``````\n",
    "created_at": "2021-10-13T12:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581518",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,9 @@
-This ticket adds an spkg-configure.m4 for cvxopt, in order to use it from a system package if possible (see #27330).
+This ticket adds an spkg-configure.m4 for cvxopt and various other python packages, to allow them to be used from the system (part of #27330).
 
-This one is a bit special, because cvxopt is a Python module.
+These python packages are special because we currently use a python "venv" that is isolated from the system. Thus this ticket proceeds in several steps:
 
-The proposed attachment uses `python3`: I donÂ´t like that, but at this point `$ac_path_PYTHON3` is not yet defined. (Note: on FreeBSD we have no python3 by default, and I have to patch it with the real versioned program name, but I guess that `python3` is more portable)
+1. Add an `--enable-system-site-packages` flag to the top-level `./configure` script. When present, this will tell `sage-venv` that the venv it creates **should not** be isolated from the system.
+2. Create a new macro that can detect python packages on the system. It should ensure that the version bounds in each python package's `install-requires.txt` are met.
+3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.
+4. Test everything thoroughly with various combinations of system and non-system python packages.
 
-To build Sage with it, `build/make/install` must be modified: it sets `PYTHONPATH` to `$SAGE_LOCAL`, and the system-wide Python modules are not found. It must be replaced by something like
-
-```
-"$SAGE_LOCAL:$SAGE_LOCAL/$PYTHON_SITELIBDIR:$PYTHON_SITELIBDIR"
-```
-
-with `$PYTHON_SITELIBDIR` being the site-packages directory used. So the Sage-built packages are always found in the first place, and those from the system are found when needed.
``````




---

archive/issue_comments_581519.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [mkoeppe](#comment%3A22):\n> Also, when `--enable-system-site-packages` has been given but system python3 is not used, this should be an error.\n\n\nI think this is working as intended, but I still have to check it with python3 installed from an SPKG. The intention is that `--enable-system-site-packages` will only attempt to use packages from the system; not force it. If we're using python from the SPKG, the macro should always fail (this is in its documentation), and thus we'll use SPKGs for all of the python stuff.\n\nI don't think we need to bail out with an error unless that process can somehow do the wrong thing?",
    "created_at": "2021-10-13T12:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581519",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:24'></a>
Replying to [mkoeppe](#comment%3A22):
> Also, when `--enable-system-site-packages` has been given but system python3 is not used, this should be an error.


I think this is working as intended, but I still have to check it with python3 installed from an SPKG. The intention is that `--enable-system-site-packages` will only attempt to use packages from the system; not force it. If we're using python from the SPKG, the macro should always fail (this is in its documentation), and thus we'll use SPKGs for all of the python stuff.

I don't think we need to bail out with an error unless that process can somehow do the wrong thing?



---

archive/issue_comments_581520.json:
```json
{
    "body": "<a id='comment:25'></a>\nUser expectations -- users may be interested in this option because they want to actually use system Python packages (which we don't have as SPKG), not just save time on installation. So it's best to tell them upfront that it won't work, instead of making them go through an hours-long build and failure and mailing list Q&A.",
    "created_at": "2021-10-13T16:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581520",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
User expectations -- users may be interested in this option because they want to actually use system Python packages (which we don't have as SPKG), not just save time on installation. So it's best to tell them upfront that it won't work, instead of making them go through an hours-long build and failure and mailing list Q&A.



---

archive/issue_comments_581521.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [mkoeppe](#comment%3A25):\n> User expectations -- users may be interested in this option because they want to actually use system Python packages (which we don't have as SPKG), not just save time on installation. So it's best to tell them upfront that it won't work, instead of making them go through an hours-long build and failure and mailing list Q&A.\n\n\nWe could make that possible with another option, like `--enable-user-site-packages`, that would undo the intentional breakage in sage-env:\n\n```python\n# Set PYTHONUSERBASE to avoid picking up non-Sage versions of\n# Matplotlib, numpy, etc. See http://trac.sagemath.org/ticket/19612.\n#\n# For more history (it used to be PYTHONNOUSERSITE=yes which killed\n# the ability to do \"sage -pip install PACKAGE --user\"), see\n# http://trac.sagemath.org/ticket/14243 and\n# http://trac.sagemath.org/ticket/18955.\n\nif [ \"$PYTHONUSERBASE\" = \"\" ]; then\n    PYTHONUSERBASE=\"$DOT_SAGE/local\"\n    export PYTHONUSERBASE\nfi\n```\n\nThe \"system\" site packages do work either way... you're just getting a different \"system\" with the SPKG than you would with `/usr/bin/python3`. Regardless, I only build with `--with-system-python3=force`, so I won't belabor this distinction.\n\nI'll change `--enable-system-site-packages` to set `--with-system-python3=force`.",
    "created_at": "2021-10-13T17:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581521",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:26'></a>
Replying to [mkoeppe](#comment%3A25):
> User expectations -- users may be interested in this option because they want to actually use system Python packages (which we don't have as SPKG), not just save time on installation. So it's best to tell them upfront that it won't work, instead of making them go through an hours-long build and failure and mailing list Q&A.


We could make that possible with another option, like `--enable-user-site-packages`, that would undo the intentional breakage in sage-env:

```python
# Set PYTHONUSERBASE to avoid picking up non-Sage versions of
# Matplotlib, numpy, etc. See http://trac.sagemath.org/ticket/19612.
#
# For more history (it used to be PYTHONNOUSERSITE=yes which killed
# the ability to do "sage -pip install PACKAGE --user"), see
# http://trac.sagemath.org/ticket/14243 and
# http://trac.sagemath.org/ticket/18955.

if [ "$PYTHONUSERBASE" = "" ]; then
    PYTHONUSERBASE="$DOT_SAGE/local"
    export PYTHONUSERBASE
fi
```

The "system" site packages do work either way... you're just getting a different "system" with the SPKG than you would with `/usr/bin/python3`. Regardless, I only build with `--with-system-python3=force`, so I won't belabor this distinction.

I'll change `--enable-system-site-packages` to set `--with-system-python3=force`.



---

archive/issue_comments_581522.json:
```json
{
    "body": "<a id='comment:27'></a>\nI was talking about system site packages.\n\nReplying to [mjo](#comment%3A26):\n> The \"system\" site packages do work either way... you're just getting a different \"system\" with the SPKG than you would with `/usr/bin/python3`. \n\n\nI know that, you know that, I know that you know that, etc., but users don't.\n\n> I'll change `--enable-system-site-packages` to set `--with-system-python3=force`.\n\n\nGreat, thanks.",
    "created_at": "2021-10-13T17:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581522",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
I was talking about system site packages.

Replying to [mjo](#comment%3A26):
> The "system" site packages do work either way... you're just getting a different "system" with the SPKG than you would with `/usr/bin/python3`. 


I know that, you know that, I know that you know that, etc., but users don't.

> I'll change `--enable-system-site-packages` to set `--with-system-python3=force`.


Great, thanks.



---

archive/issue_comments_581523.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [mjo](#comment%3A26):\n> another option, like `--enable-user-site-packages`, that would undo the intentional breakage in sage-env:\n> \n> \n> ```python\n> # Set PYTHONUSERBASE to avoid picking up non-Sage versions of\n\n\nActually in venvs, the user scheme is altogether disabled by Python - see https://packaging.python.org/tutorials/installing-packages/#installing-to-the-user-site",
    "created_at": "2021-10-13T17:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581523",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Replying to [mjo](#comment%3A26):
> another option, like `--enable-user-site-packages`, that would undo the intentional breakage in sage-env:
> 
> 
> ```python
> # Set PYTHONUSERBASE to avoid picking up non-Sage versions of


Actually in venvs, the user scheme is altogether disabled by Python - see https://packaging.python.org/tutorials/installing-packages/#installing-to-the-user-site



---

archive/issue_comments_581524.json:
```json
{
    "body": "<a id='comment:29'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|\n|[8e8c004](https://github.com/sagemath/sagetrac-mirror/commit/8e8c004a9ff03b67470fed876c379e5173041ccd)|`Trac #29665: force system python3 with --enable-system-site-packages.`|",
    "created_at": "2021-10-14T12:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581524",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|
|[8e8c004](https://github.com/sagemath/sagetrac-mirror/commit/8e8c004a9ff03b67470fed876c379e5173041ccd)|`Trac #29665: force system python3 with --enable-system-site-packages.`|



---

archive/issue_comments_581525.json:
```json
{
    "body": "Changing commit from \"6a5246dbbc980ebf97dd6b1fba70e58d198d9db3\" to \"8e8c004a9ff03b67470fed876c379e5173041ccd\"",
    "created_at": "2021-10-14T12:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6a5246dbbc980ebf97dd6b1fba70e58d198d9db3" to "8e8c004a9ff03b67470fed876c379e5173041ccd"



---

archive/issue_comments_581526.json:
```json
{
    "body": "<a id='comment:30'></a>\nFeels too easy for something involving autotools, but that last commit looks like it does the trick.",
    "created_at": "2021-10-14T12:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581526",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:30'></a>
Feels too easy for something involving autotools, but that last commit looks like it does the trick.



---

archive/issue_comments_581527.json:
```json
{
    "body": "<a id='comment:31'></a>\nThe next thing is that at the end of configure, it now recommends to install system python packages -- which is useless (unless the experimental new option is used) and potentially will confuse users.",
    "created_at": "2021-10-14T20:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581527",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
The next thing is that at the end of configure, it now recommends to install system python packages -- which is useless (unless the experimental new option is used) and potentially will confuse users.



---

archive/issue_comments_581528.json:
```json
{
    "body": "<a id='comment:32'></a>\nSo perhaps instead of supplying `spkg-configure.m4` files, in `m4/sage_spkg_collect.m4` if a package does not have `spkg-configure.m4` but it has `install-requires.txt`, just run the test?",
    "created_at": "2021-10-14T20:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581528",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
So perhaps instead of supplying `spkg-configure.m4` files, in `m4/sage_spkg_collect.m4` if a package does not have `spkg-configure.m4` but it has `install-requires.txt`, just run the test?



---

archive/issue_comments_581529.json:
```json
{
    "body": "<a id='comment:33'></a>\nis it distinguishing system and user-installed python packages?",
    "created_at": "2021-10-14T20:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581529",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>
is it distinguishing system and user-installed python packages?



---

archive/issue_comments_581530.json:
```json
{
    "body": "<a id='comment:34'></a>\nsee[comment:28](#comment%3A28)",
    "created_at": "2021-10-14T21:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581530",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
see[comment:28](#comment%3A28)



---

archive/issue_comments_581531.json:
```json
{
    "body": "<a id='comment:35'></a>\nThe new test in m4/sage_python_package_check.m4 should really be run with a venv, not the `PYTHON_FOR_VENV` directly -- or, as per Dima's comment, you would need to poison the user scheme in another way, so that the configure test does not take user packages into account.",
    "created_at": "2021-10-14T21:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581531",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
The new test in m4/sage_python_package_check.m4 should really be run with a venv, not the `PYTHON_FOR_VENV` directly -- or, as per Dima's comment, you would need to poison the user scheme in another way, so that the configure test does not take user packages into account.



---

archive/issue_comments_581532.json:
```json
{
    "body": "<a id='comment:36'></a>\nAn easy way to do this is could be to run these tests as part of the `python3` spkg-configure.m4, which already creates a venv for testing",
    "created_at": "2021-10-14T22:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581532",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
An easy way to do this is could be to run these tests as part of the `python3` spkg-configure.m4, which already creates a venv for testing



---

archive/issue_comments_581533.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [mkoeppe](#comment%3A31):\n> The next thing is that at the end of configure, it now recommends to install system python packages -- which is useless (unless the experimental new option is used) and potentially will confuse users.\n\n\nThis, at least, is easy: we can delete `distros/` for the python packages all in one commit. Then whenever we intend to actually use that information, it can be `git revert`ed.",
    "created_at": "2021-10-14T22:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581533",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:37'></a>
Replying to [mkoeppe](#comment%3A31):
> The next thing is that at the end of configure, it now recommends to install system python packages -- which is useless (unless the experimental new option is used) and potentially will confuse users.


This, at least, is easy: we can delete `distros/` for the python packages all in one commit. Then whenever we intend to actually use that information, it can be `git revert`ed.



---

archive/issue_comments_581534.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [mkoeppe](#comment%3A35):\n> The new test in m4/sage_python_package_check.m4 should really be run with a venv, not the `PYTHON_FOR_VENV` directly -- or, as per Dima's comment, you would need to poison the user scheme in another way, so that the configure test does not take user packages into account.\n\n\nShould we not poison `PYTHONUSERBASE` in the same way that sage-env does it? That way the test and what you get at runtime is at least consistent.",
    "created_at": "2021-10-14T22:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581534",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:38'></a>
Replying to [mkoeppe](#comment%3A35):
> The new test in m4/sage_python_package_check.m4 should really be run with a venv, not the `PYTHON_FOR_VENV` directly -- or, as per Dima's comment, you would need to poison the user scheme in another way, so that the configure test does not take user packages into account.


Should we not poison `PYTHONUSERBASE` in the same way that sage-env does it? That way the test and what you get at runtime is at least consistent.



---

archive/issue_comments_581535.json:
```json
{
    "body": "<a id='comment:39'></a>\nNo, see[comment:28](#comment%3A28): `PYTHONUSERBASE` does not matter because for venvs, the user installation scheme is already disabled by Python.",
    "created_at": "2021-10-15T03:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581535",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
No, see[comment:28](#comment%3A28): `PYTHONUSERBASE` does not matter because for venvs, the user installation scheme is already disabled by Python.



---

archive/issue_comments_581536.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [mkoeppe](#comment%3A39):\n> No, see[comment:28](#comment%3A28): `PYTHONUSERBASE` does not matter because for venvs, the user installation scheme is already disabled by Python.\n\n\nOh, right. Do you see any reason why I shouldn't delete that code from sage-env, then?",
    "created_at": "2021-10-15T03:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581536",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:40'></a>
Replying to [mkoeppe](#comment%3A39):
> No, see[comment:28](#comment%3A28): `PYTHONUSERBASE` does not matter because for venvs, the user installation scheme is already disabled by Python.


Oh, right. Do you see any reason why I shouldn't delete that code from sage-env, then?



---

archive/issue_comments_581537.json:
```json
{
    "body": "<a id='comment:41'></a>\nActually I have to correct myself: venvs that enable system site packages do not disable the user scheme. https://github.com/python/cpython/blob/main/Lib/site.py#L533",
    "created_at": "2021-10-15T03:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581537",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Actually I have to correct myself: venvs that enable system site packages do not disable the user scheme. https://github.com/python/cpython/blob/main/Lib/site.py#L533



---

archive/issue_comments_581538.json:
```json
{
    "body": "<a id='comment:42'></a>\nSo the correct test in configure is to set up the venv AND to set PYTHONUSERBASE in the same way as sage-env would do.",
    "created_at": "2021-10-15T03:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581538",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
So the correct test in configure is to set up the venv AND to set PYTHONUSERBASE in the same way as sage-env would do.



---

archive/issue_comments_581539.json:
```json
{
    "body": "<a id='comment:43'></a>\nOk, I have to do my actual job for about an hour but then I'll take a stab at it.",
    "created_at": "2021-10-15T03:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581539",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:43'></a>
Ok, I have to do my actual job for about an hour but then I'll take a stab at it.



---

archive/issue_comments_581540.json:
```json
{
    "body": "<a id='comment:44'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[c742704](https://github.com/sagemath/sagetrac-mirror/commit/c74270470c7f2501b5a9c564afeb80f7a80d32c3)|`Trac #29665: standard python spkg-configure.m4 for setuptools.`|\n|[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove \"distros\" information for python packages.`|\n|[7aed5d4](https://github.com/sagemath/sagetrac-mirror/commit/7aed5d470ca7e5e102c4f3da62eeba5133111d1e)|`Trac #29665: poison PYTHONUSERBASE when testing for \"system\" packages.`|",
    "created_at": "2021-10-15T05:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581540",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[c742704](https://github.com/sagemath/sagetrac-mirror/commit/c74270470c7f2501b5a9c564afeb80f7a80d32c3)|`Trac #29665: standard python spkg-configure.m4 for setuptools.`|
|[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove "distros" information for python packages.`|
|[7aed5d4](https://github.com/sagemath/sagetrac-mirror/commit/7aed5d470ca7e5e102c4f3da62eeba5133111d1e)|`Trac #29665: poison PYTHONUSERBASE when testing for "system" packages.`|



---

archive/issue_comments_581541.json:
```json
{
    "body": "Changing commit from \"8e8c004a9ff03b67470fed876c379e5173041ccd\" to \"7aed5d470ca7e5e102c4f3da62eeba5133111d1e\"",
    "created_at": "2021-10-15T05:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581541",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8e8c004a9ff03b67470fed876c379e5173041ccd" to "7aed5d470ca7e5e102c4f3da62eeba5133111d1e"



---

archive/issue_comments_581542.json:
```json
{
    "body": "<a id='comment:45'></a>\nI'll have to look into using a venv tomorrow. What's there now is an improvement, though.",
    "created_at": "2021-10-15T05:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581542",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:45'></a>
I'll have to look into using a venv tomorrow. What's there now is an improvement, though.



---

archive/issue_comments_581543.json:
```json
{
    "body": "Changing commit from \"7aed5d470ca7e5e102c4f3da62eeba5133111d1e\" to \"05a846c51df4167afaad964ec39ae384f1692101\"",
    "created_at": "2021-10-15T17:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7aed5d470ca7e5e102c4f3da62eeba5133111d1e" to "05a846c51df4167afaad964ec39ae384f1692101"



---

archive/issue_comments_581544.json:
```json
{
    "body": "<a id='comment:46'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|\n|[d00cdbb](https://github.com/sagemath/sagetrac-mirror/commit/d00cdbbb63a78c44d688f861ba4f83ba0049e8b4)|`Trac #29665: run SAGE_PYTHON_PACKAGE_CHECK() inside a venv.`|\n|[f1d927b](https://github.com/sagemath/sagetrac-mirror/commit/f1d927b7963e4c2f15df65e6ba1f0e0f1c1b1c55)|`Trac #29665: log SAGE_PYTHON_PACKAGE_CHECK() failures to config.log.`|\n|[05a846c](https://github.com/sagemath/sagetrac-mirror/commit/05a846c51df4167afaad964ec39ae384f1692101)|`Trac #29665: don't clobber a plain file named config.venv.`|",
    "created_at": "2021-10-15T17:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
|[d00cdbb](https://github.com/sagemath/sagetrac-mirror/commit/d00cdbbb63a78c44d688f861ba4f83ba0049e8b4)|`Trac #29665: run SAGE_PYTHON_PACKAGE_CHECK() inside a venv.`|
|[f1d927b](https://github.com/sagemath/sagetrac-mirror/commit/f1d927b7963e4c2f15df65e6ba1f0e0f1c1b1c55)|`Trac #29665: log SAGE_PYTHON_PACKAGE_CHECK() failures to config.log.`|
|[05a846c](https://github.com/sagemath/sagetrac-mirror/commit/05a846c51df4167afaad964ec39ae384f1692101)|`Trac #29665: don't clobber a plain file named config.venv.`|



---

archive/issue_comments_581545.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [git](#comment%3A44):\n> |                                                                                                                                           |                                                                |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n> |[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove \"distros\" information for python packages.`|\n\n\nThat's not a good solution",
    "created_at": "2021-10-15T17:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581545",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
Replying to [git](#comment%3A44):
> |                                                                                                                                           |                                                                |
> |-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
> |[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove "distros" information for python packages.`|


That's not a good solution



---

archive/issue_comments_581546.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [mkoeppe](#comment%3A47):\n> Replying to [git](#comment%3A44):\n> > |                                                                                                                                           |                                                                |\n> > |-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n> > |[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove \"distros\" information for python packages.`|\n\n> \n> That's not a good solution\n\n\nI'll take a few days to try to think of something better, but removing `distros/` is going to be hard to beat for simplicity and ease of implementation. The sole purpose of those files is to do the thing you don't want to happen. Removing them prevents it, and doesn't hurt anything else.\n\nKeeping the files that cause the wrong thing to happen and then trying to stop the wrong thing from happening somewhere else is only going to push our `./configure` further down the path to Mouse Trap. These system packages already work flawlessly for me. If there are no major problems, we could enable this by default as early as sage-9.6, bring back the `distros/`, and never have to worry about if the swimmer hits the plate just right to launch the cannonball into the bathtub to disable the system package suggestion.",
    "created_at": "2021-10-15T23:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581546",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:48'></a>
Replying to [mkoeppe](#comment%3A47):
> Replying to [git](#comment%3A44):
> > |                                                                                                                                           |                                                                |
> > |-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
> > |[2dafaf0](https://github.com/sagemath/sagetrac-mirror/commit/2dafaf092ef1c547a1dde4713f643f7704e6cc02)|`Trac #29665: remove "distros" information for python packages.`|

> 
> That's not a good solution


I'll take a few days to try to think of something better, but removing `distros/` is going to be hard to beat for simplicity and ease of implementation. The sole purpose of those files is to do the thing you don't want to happen. Removing them prevents it, and doesn't hurt anything else.

Keeping the files that cause the wrong thing to happen and then trying to stop the wrong thing from happening somewhere else is only going to push our `./configure` further down the path to Mouse Trap. These system packages already work flawlessly for me. If there are no major problems, we could enable this by default as early as sage-9.6, bring back the `distros/`, and never have to worry about if the swimmer hits the plate just right to launch the cannonball into the bathtub to disable the system package suggestion.



---

archive/issue_comments_581547.json:
```json
{
    "body": "<a id='comment:49'></a>\nBut then how do we test that this new experimental switch actually works on a distribution?\n\nThe `distros` information is not just for the user, but also for provisioning the test environment on GH Actions etc.",
    "created_at": "2021-10-15T23:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581547",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
But then how do we test that this new experimental switch actually works on a distribution?

The `distros` information is not just for the user, but also for provisioning the test environment on GH Actions etc.



---

archive/issue_comments_581548.json:
```json
{
    "body": "<a id='comment:50'></a>\nAnd in[comment:32](#comment%3A32) I have already explained a simple implementation strategy",
    "created_at": "2021-10-15T23:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581548",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
And in[comment:32](#comment%3A32) I have already explained a simple implementation strategy



---

archive/issue_comments_581549.json:
```json
{
    "body": "<a id='comment:51'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[41370cb](https://github.com/sagemath/sagetrac-mirror/commit/41370cb5809dbf01e9aba53353ead29479a81b10)|`Trac #29665: poison PYTHONUSERBASE when testing for \"system\" packages.`|\n|[5042a52](https://github.com/sagemath/sagetrac-mirror/commit/5042a52916278334c8e25ec8d655f88a866adf56)|`Trac #29665: run SAGE_PYTHON_PACKAGE_CHECK() inside a venv.`|\n|[fa38368](https://github.com/sagemath/sagetrac-mirror/commit/fa3836865435106ddc42b4308765be6878cf904d)|`Trac #29665: log SAGE_PYTHON_PACKAGE_CHECK() failures to config.log.`|\n|[e77e67f](https://github.com/sagemath/sagetrac-mirror/commit/e77e67f37c6d39da8c394839bdcdeded2557cd5c)|`Trac #29665: don't clobber a plain file named config.venv.`|\n|[fb00721](https://github.com/sagemath/sagetrac-mirror/commit/fb00721f556de97a0005b9fb6ab801a01900fb48)|`Trac #29665: don't announce system python packages that won't be used.`|",
    "created_at": "2021-10-16T12:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[41370cb](https://github.com/sagemath/sagetrac-mirror/commit/41370cb5809dbf01e9aba53353ead29479a81b10)|`Trac #29665: poison PYTHONUSERBASE when testing for "system" packages.`|
|[5042a52](https://github.com/sagemath/sagetrac-mirror/commit/5042a52916278334c8e25ec8d655f88a866adf56)|`Trac #29665: run SAGE_PYTHON_PACKAGE_CHECK() inside a venv.`|
|[fa38368](https://github.com/sagemath/sagetrac-mirror/commit/fa3836865435106ddc42b4308765be6878cf904d)|`Trac #29665: log SAGE_PYTHON_PACKAGE_CHECK() failures to config.log.`|
|[e77e67f](https://github.com/sagemath/sagetrac-mirror/commit/e77e67f37c6d39da8c394839bdcdeded2557cd5c)|`Trac #29665: don't clobber a plain file named config.venv.`|
|[fb00721](https://github.com/sagemath/sagetrac-mirror/commit/fb00721f556de97a0005b9fb6ab801a01900fb48)|`Trac #29665: don't announce system python packages that won't be used.`|



---

archive/issue_comments_581550.json:
```json
{
    "body": "Changing commit from \"05a846c51df4167afaad964ec39ae384f1692101\" to \"fb00721f556de97a0005b9fb6ab801a01900fb48\"",
    "created_at": "2021-10-16T12:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "05a846c51df4167afaad964ec39ae384f1692101" to "fb00721f556de97a0005b9fb6ab801a01900fb48"



---

archive/issue_comments_581551.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [mkoeppe](#comment%3A50):\n> And in[comment:32](#comment%3A32) I have already explained a simple implementation strategy\n\n\nNot every package with an `install-requires.txt` requires `--enable-system-site-packages`. Hiding the package checks in two different places is also not great for maintainability; but more importantly, not every package uses the same check. Some have DEPCHECKs, and in the future I'm sure we'll need feature tests to ensure that e.g. matplotlib has support for our documented export formats.\n\nIn principle I'd rather hack the test setup than the build system if we have to do it for a release or two. But maybe my latest commit solves it without any collateral damage (I hope).",
    "created_at": "2021-10-16T12:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581551",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:52'></a>
Replying to [mkoeppe](#comment%3A50):
> And in[comment:32](#comment%3A32) I have already explained a simple implementation strategy


Not every package with an `install-requires.txt` requires `--enable-system-site-packages`. Hiding the package checks in two different places is also not great for maintainability; but more importantly, not every package uses the same check. Some have DEPCHECKs, and in the future I'm sure we'll need feature tests to ensure that e.g. matplotlib has support for our documented export formats.

In principle I'd rather hack the test setup than the build system if we have to do it for a release or two. But maybe my latest commit solves it without any collateral damage (I hope).



---

archive/issue_comments_581552.json:
```json
{
    "body": "<a id='comment:53'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[ba6142b](https://github.com/sagemath/sagetrac-mirror/commit/ba6142b6b26ce8d5185f759b2165861530471b5a)|`Trac #29665: don't announce system python packages that won't be used.`|",
    "created_at": "2021-10-16T12:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[ba6142b](https://github.com/sagemath/sagetrac-mirror/commit/ba6142b6b26ce8d5185f759b2165861530471b5a)|`Trac #29665: don't announce system python packages that won't be used.`|



---

archive/issue_comments_581553.json:
```json
{
    "body": "Changing commit from \"fb00721f556de97a0005b9fb6ab801a01900fb48\" to \"ba6142b6b26ce8d5185f759b2165861530471b5a\"",
    "created_at": "2021-10-16T12:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fb00721f556de97a0005b9fb6ab801a01900fb48" to "ba6142b6b26ce8d5185f759b2165861530471b5a"



---

archive/issue_events_085585.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "rename": {
        "from": "spkg-configure.m4 for cvxopt and other python packages",
        "to": "configure --enable-system-site-packages via spkg-configure.m4 for cvxopt and other python packages"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29665#event-85585"
}
```



---

archive/issue_comments_581554.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,6 @@\n 3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.\n 4. Test everything thoroughly with various combinations of system and non-system python packages.\n \n+Platform-specific testing:\n+- for example `EXTRA_CONFIGURE_ARGS=\"--enable-system-site-packages\" tox -e docker-ubuntu-focal-standard -- build ptest`\n+\n``````\n",
    "created_at": "2021-10-16T21:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581554",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,6 @@
 3. Create the `spkg-configure.m4` files themselves, which should be relatively simple at that point.
 4. Test everything thoroughly with various combinations of system and non-system python packages.
 
+Platform-specific testing:
+- for example `EXTRA_CONFIGURE_ARGS="--enable-system-site-packages" tox -e docker-ubuntu-focal-standard -- build ptest`
+
``````




---

archive/issue_comments_581555.json:
```json
{
    "body": "<a id='comment:56'></a>\nTo test this more thoroughly,\n- we need many more `distros/` files for various platforms\n- need a GH Actions workflow to automate this - see #32703 for a possible approach",
    "created_at": "2021-10-16T21:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581555",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>
To test this more thoroughly,
- we need many more `distros/` files for various platforms
- need a GH Actions workflow to automate this - see #32703 for a possible approach



---

archive/issue_comments_581556.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,5 +8,5 @@\n 4. Test everything thoroughly with various combinations of system and non-system python packages.\n \n Platform-specific testing:\n-- for example `EXTRA_CONFIGURE_ARGS=\"--enable-system-site-packages\" tox -e docker-ubuntu-focal-standard -- build ptest`\n+- for example `TARGETS_PRE=\"build-local\" EXTRA_CONFIGURE_ARGS=\"--enable-system-site-packages\" tox -e docker-ubuntu-focal-standard -- build ptest`\n \n``````\n",
    "created_at": "2021-10-16T23:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581556",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,5 +8,5 @@
 4. Test everything thoroughly with various combinations of system and non-system python packages.
 
 Platform-specific testing:
-- for example `EXTRA_CONFIGURE_ARGS="--enable-system-site-packages" tox -e docker-ubuntu-focal-standard -- build ptest`
+- for example `TARGETS_PRE="build-local" EXTRA_CONFIGURE_ARGS="--enable-system-site-packages" tox -e docker-ubuntu-focal-standard -- build ptest`
 
``````




---

archive/issue_comments_581557.json:
```json
{
    "body": "<a id='comment:58'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|\n|[a463d1c](https://github.com/sagemath/sagetrac-mirror/commit/a463d1cc90080fe89c734898b975ed80d0334073)|`Trac #29665: add Gentoo package information for python packages.`|",
    "created_at": "2021-10-17T10:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
|[a463d1c](https://github.com/sagemath/sagetrac-mirror/commit/a463d1cc90080fe89c734898b975ed80d0334073)|`Trac #29665: add Gentoo package information for python packages.`|



---

archive/issue_comments_581558.json:
```json
{
    "body": "Changing commit from \"ba6142b6b26ce8d5185f759b2165861530471b5a\" to \"a463d1cc90080fe89c734898b975ed80d0334073\"",
    "created_at": "2021-10-17T10:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581558",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ba6142b6b26ce8d5185f759b2165861530471b5a" to "a463d1cc90080fe89c734898b975ed80d0334073"



---

archive/issue_comments_581559.json:
```json
{
    "body": "<a id='comment:59'></a>\nWhen the new experimental option is not used, the configure tests should probably say something like \"skipping test, only available with --enable-system-site-packages (experimental)\" before it concludes \"no suitable system package found\"",
    "created_at": "2021-10-18T01:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581559",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
When the new experimental option is not used, the configure tests should probably say something like "skipping test, only available with --enable-system-site-packages (experimental)" before it concludes "no suitable system package found"



---

archive/issue_comments_581560.json:
```json
{
    "body": "Changing branch from \"u/mjo/ticket/29665\" to \"u/mkoeppe/ticket/29665\"",
    "created_at": "2021-10-18T01:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581560",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/mjo/ticket/29665" to "u/mkoeppe/ticket/29665"



---

archive/issue_comments_581561.json:
```json
{
    "body": "<a id='comment:61'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[f42d755](https://github.com/sagemath/sagetrac-mirror/commit/f42d7559ba85cbb2c3846f05196b773e5e00c59a)|`build/pkgs: Add distros/arch.txt for Python packages`|",
    "created_at": "2021-10-18T04:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581561",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[f42d755](https://github.com/sagemath/sagetrac-mirror/commit/f42d7559ba85cbb2c3846f05196b773e5e00c59a)|`build/pkgs: Add distros/arch.txt for Python packages`|



---

archive/issue_comments_581562.json:
```json
{
    "body": "Changing commit from \"a463d1cc90080fe89c734898b975ed80d0334073\" to \"f42d7559ba85cbb2c3846f05196b773e5e00c59a\"",
    "created_at": "2021-10-18T04:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581562",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a463d1cc90080fe89c734898b975ed80d0334073" to "f42d7559ba85cbb2c3846f05196b773e5e00c59a"



---

archive/issue_comments_581563.json:
```json
{
    "body": "<a id='comment:62'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[82fe0f1](https://github.com/sagemath/sagetrac-mirror/commit/82fe0f14b4d5ad052f164b2e825a187e00164ab3)|`build/pkgs: Add distros/opensuse.txt for Python packages`|",
    "created_at": "2021-10-18T04:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581563",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[82fe0f1](https://github.com/sagemath/sagetrac-mirror/commit/82fe0f14b4d5ad052f164b2e825a187e00164ab3)|`build/pkgs: Add distros/opensuse.txt for Python packages`|



---

archive/issue_comments_581564.json:
```json
{
    "body": "Changing commit from \"f42d7559ba85cbb2c3846f05196b773e5e00c59a\" to \"82fe0f14b4d5ad052f164b2e825a187e00164ab3\"",
    "created_at": "2021-10-18T04:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581564",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f42d7559ba85cbb2c3846f05196b773e5e00c59a" to "82fe0f14b4d5ad052f164b2e825a187e00164ab3"



---

archive/issue_comments_581565.json:
```json
{
    "body": "<a id='comment:63'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[a4608ae](https://github.com/sagemath/sagetrac-mirror/commit/a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72)|`build/pkgs: Add distros/debian.txt for Python packages`|",
    "created_at": "2021-10-18T05:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581565",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:63'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[a4608ae](https://github.com/sagemath/sagetrac-mirror/commit/a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72)|`build/pkgs: Add distros/debian.txt for Python packages`|



---

archive/issue_comments_581566.json:
```json
{
    "body": "Changing commit from \"82fe0f14b4d5ad052f164b2e825a187e00164ab3\" to \"a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72\"",
    "created_at": "2021-10-18T05:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581566",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "82fe0f14b4d5ad052f164b2e825a187e00164ab3" to "a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72"



---

archive/issue_comments_581567.json:
```json
{
    "body": "<a id='comment:64'></a>\nNew commits:\n|                                                                                                                                          |                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[4406798](https://github.com/sagemath/sagetrac-mirror/commit/4406798fcbfd5918d187591e84b28221676f4f57)|`Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().`|\n|[bf1eb35](https://github.com/sagemath/sagetrac-mirror/commit/bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58)|`Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.`|",
    "created_at": "2021-10-18T12:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581567",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:64'></a>
New commits:
|                                                                                                                                          |                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[4406798](https://github.com/sagemath/sagetrac-mirror/commit/4406798fcbfd5918d187591e84b28221676f4f57)|`Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().`|
|[bf1eb35](https://github.com/sagemath/sagetrac-mirror/commit/bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58)|`Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.`|



---

archive/issue_comments_581568.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/ticket/29665\" to \"u/mjo/ticket/29665\"",
    "created_at": "2021-10-18T12:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581568",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "u/mkoeppe/ticket/29665" to "u/mjo/ticket/29665"



---

archive/issue_comments_581569.json:
```json
{
    "body": "Changing commit from \"a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72\" to \"bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58\"",
    "created_at": "2021-10-18T12:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581569",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "a4608ae58a7c6dd584299b3a9dcb399a7f9b9d72" to "bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58"



---

archive/issue_comments_581570.json:
```json
{
    "body": "Changing branch from \"u/mjo/ticket/29665\" to \"u/mkoeppe/ticket/29665\"",
    "created_at": "2021-10-23T23:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581570",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/mjo/ticket/29665" to "u/mkoeppe/ticket/29665"



---

archive/issue_comments_581571.json:
```json
{
    "body": "<a id='comment:66'></a>\nTested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:\nIt thinks that `setuptools` is available, but then it isn't\n\n---\nNew commits:\n|                                                                                                                                          |                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[eeae67c](https://github.com/sagemath/sagetrac-mirror/commit/eeae67cbb372cf215a7498200d25c8e402d60296)|`Merge tag '9.5.beta4' into t/29665/ticket/29665`|",
    "created_at": "2021-10-24T20:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581571",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>
Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:
It thinks that `setuptools` is available, but then it isn't

---
New commits:
|                                                                                                                                          |                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[eeae67c](https://github.com/sagemath/sagetrac-mirror/commit/eeae67cbb372cf215a7498200d25c8e402d60296)|`Merge tag '9.5.beta4' into t/29665/ticket/29665`|



---

archive/issue_comments_581572.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-10-24T20:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581572",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_581573.json:
```json
{
    "body": "Changing commit from \"bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58\" to \"eeae67cbb372cf215a7498200d25c8e402d60296\"",
    "created_at": "2021-10-24T20:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581573",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "bf1eb35a9d04be9a0eec99e2e265f4cd81a6ae58" to "eeae67cbb372cf215a7498200d25c8e402d60296"



---

archive/issue_comments_581574.json:
```json
{
    "body": "<a id='comment:67'></a>\nReplying to [mkoeppe](#comment%3A66):\n> Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:\n> It thinks that `setuptools` is available, but then it isn't\n\n\nYou sure setuptools isn't there? The new autoconf macro uses it to check for all of the other packages. If the whole thing is not crashing and burning (and if I did not flip an exit code somewhere...) setuptools is probably there.\n\nMaybe something to do with `export PYTHONPATH=\"$(pwd)/src\"` in pip's `spkg-install.in`.",
    "created_at": "2021-10-24T21:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581574",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:67'></a>
Replying to [mkoeppe](#comment%3A66):
> Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:
> It thinks that `setuptools` is available, but then it isn't


You sure setuptools isn't there? The new autoconf macro uses it to check for all of the other packages. If the whole thing is not crashing and burning (and if I did not flip an exit code somewhere...) setuptools is probably there.

Maybe something to do with `export PYTHONPATH="$(pwd)/src"` in pip's `spkg-install.in`.



---

archive/issue_comments_581575.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [mjo](#comment%3A67):\n> Replying to [mkoeppe](#comment%3A66):\n> > Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:\n> > It thinks that `setuptools` is available, but then it isn't\n\n> \n> You sure setuptools isn't there? The new autoconf macro uses it to check for all of the other packages. If the whole thing is not crashing and burning (and if I did not flip an exit code somewhere...) setuptools is probably there.\n\n\nWell, it is probably present in the test venv. But as you can see in the test, it's not present in the venv at build time.",
    "created_at": "2021-10-24T21:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581575",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>
Replying to [mjo](#comment%3A67):
> Replying to [mkoeppe](#comment%3A66):
> > Tested using #32703 at https://github.com/mkoeppe/sage/runs/3987632855:
> > It thinks that `setuptools` is available, but then it isn't

> 
> You sure setuptools isn't there? The new autoconf macro uses it to check for all of the other packages. If the whole thing is not crashing and burning (and if I did not flip an exit code somewhere...) setuptools is probably there.


Well, it is probably present in the test venv. But as you can see in the test, it's not present in the venv at build time.



---

archive/issue_comments_581576.json:
```json
{
    "body": "<a id='comment:69'></a>\nReplying to [mjo](#comment%3A67):\n> Maybe something to do with `export PYTHONPATH=\"$(pwd)/src\"` in pip's `spkg-install.in`.\n\n\nI don't think so.",
    "created_at": "2021-10-24T21:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581576",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>
Replying to [mjo](#comment%3A67):
> Maybe something to do with `export PYTHONPATH="$(pwd)/src"` in pip's `spkg-install.in`.


I don't think so.



---

archive/issue_comments_581577.json:
```json
{
    "body": "<a id='comment:70'></a>\nIs `python3` not the `$PYTHON_FOR_VENV` on this machine? The `sdh_*` scripts call `python3` directly, while the macro uses `$PYTHON_FOR_VENV`. That's the only thing I can think of.",
    "created_at": "2021-10-24T21:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581577",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:70'></a>
Is `python3` not the `$PYTHON_FOR_VENV` on this machine? The `sdh_*` scripts call `python3` directly, while the macro uses `$PYTHON_FOR_VENV`. That's the only thing I can think of.



---

archive/issue_comments_581578.json:
```json
{
    "body": "<a id='comment:71'></a>\nReplying to [mjo](#comment%3A70):\n> The `sdh_*` scripts call `python3` directly\n... because they run with the venv activated. This is correct.",
    "created_at": "2021-10-24T22:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581578",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>
Replying to [mjo](#comment%3A70):
> The `sdh_*` scripts call `python3` directly
... because they run with the venv activated. This is correct.



---

archive/issue_comments_581579.json:
```json
{
    "body": "<a id='comment:72'></a>\n\n```\n+    dnl Use --clear because ./configure typically clobbers its output files.\n+    AS_IF([\"${PYTHON_FOR_VENV}\" -m venv --system-site-packages dnl\n+                                        --clear                dnl\n+                                        --without-pip          dnl\n+                                        config.venv            dnl\n+                                        2>&AS_MESSAGE_LOG_FD], [\n```\nI think you should change this to use the `sage-venv` script, like `m4/sage_check_python_for_venv.m4` does.",
    "created_at": "2021-10-24T22:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581579",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>

```
+    dnl Use --clear because ./configure typically clobbers its output files.
+    AS_IF(["${PYTHON_FOR_VENV}" -m venv --system-site-packages dnl
+                                        --clear                dnl
+                                        --without-pip          dnl
+                                        config.venv            dnl
+                                        2>&AS_MESSAGE_LOG_FD], [
```
I think you should change this to use the `sage-venv` script, like `m4/sage_check_python_for_venv.m4` does.



---

archive/issue_comments_581580.json:
```json
{
    "body": "<a id='comment:73'></a>\n(I don't know if this will change anything -- but it's best to use the script that we actually use to set up the production venv to set up the test venv.)",
    "created_at": "2021-10-24T22:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581580",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>
(I don't know if this will change anything -- but it's best to use the script that we actually use to set up the production venv to set up the test venv.)



---

archive/issue_comments_581581.json:
```json
{
    "body": "<a id='comment:74'></a>\nReplying to [mkoeppe](#comment%3A73):\n> (I don't know if this will change anything -- but it's best to use the script that we actually use to set up the production venv to set up the test venv.)\n\n\nWhat does this script abstract, anyway? It's only called in two places so far (`build/make/Makefile.in` and `m4/sage_check_python_for_venv.m4`, and in both places we have access to the full path to the python interpreter and the flags that should be passed to `-m venv` (now called `$SAGE_VENV_FLAGS`).\n\nIf the only thing it does is handle `--symlinks`, then we could add `--symlinks` to `$SAGE_VENV_FLAGS` in `configure.ac` dependent upon the platform and avoid the separate script that just reimplements `-m venv`.",
    "created_at": "2021-10-24T22:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581581",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:74'></a>
Replying to [mkoeppe](#comment%3A73):
> (I don't know if this will change anything -- but it's best to use the script that we actually use to set up the production venv to set up the test venv.)


What does this script abstract, anyway? It's only called in two places so far (`build/make/Makefile.in` and `m4/sage_check_python_for_venv.m4`, and in both places we have access to the full path to the python interpreter and the flags that should be passed to `-m venv` (now called `$SAGE_VENV_FLAGS`).

If the only thing it does is handle `--symlinks`, then we could add `--symlinks` to `$SAGE_VENV_FLAGS` in `configure.ac` dependent upon the platform and avoid the separate script that just reimplements `-m venv`.



---

archive/issue_comments_581582.json:
```json
{
    "body": "<a id='comment:75'></a>\nClearly outside the scope of this ticket to make changes to the well-working `sage-venv` script.",
    "created_at": "2021-10-24T23:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581582",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>
Clearly outside the scope of this ticket to make changes to the well-working `sage-venv` script.



---

archive/issue_comments_581583.json:
```json
{
    "body": "Changing commit from \"eeae67cbb372cf215a7498200d25c8e402d60296\" to \"a11dd268ec49371faf835b92f434e05e4ffb3485\"",
    "created_at": "2021-10-25T00:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581583",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "eeae67cbb372cf215a7498200d25c8e402d60296" to "a11dd268ec49371faf835b92f434e05e4ffb3485"



---

archive/issue_comments_581584.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/ticket/29665\" to \"u/mjo/ticket/29665\"",
    "created_at": "2021-10-25T00:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581584",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "u/mkoeppe/ticket/29665" to "u/mjo/ticket/29665"



---

archive/issue_comments_581585.json:
```json
{
    "body": "<a id='comment:76'></a>\nI dropped the toml commit because somebody else added an `spkg-configure.m4` in the meantime and I don't want to worry about reconciling them.\n\n---\nLast 10 new commits:\n|                                                                                                                                          |                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[13d7087](https://github.com/sagemath/sagetrac-mirror/commit/13d708706420b9d03377bfb2bf4bd198536e739a)|`Trac #29665: don't clobber a plain file named config.venv.`|\n|[cb0311a](https://github.com/sagemath/sagetrac-mirror/commit/cb0311aff6f48de2d91667ed87207b08c6723fb7)|`Trac #29665: don't announce system python packages that won't be used.`|\n|[b81ac52](https://github.com/sagemath/sagetrac-mirror/commit/b81ac52c545ed923e83ee60324fb4451bb69524f)|`Trac #29665: add Gentoo package information for python packages.`|\n|[5a9f0d4](https://github.com/sagemath/sagetrac-mirror/commit/5a9f0d4df82c1ca398e5c394b783e32ad788b08e)|`build/pkgs: Add distros/fedora.txt for Python packages`|\n|[d235c17](https://github.com/sagemath/sagetrac-mirror/commit/d235c1793aa1b430162d275bf041f24c029b3c89)|`build/pkgs: Add distros/arch.txt for Python packages`|\n|[d4e323d](https://github.com/sagemath/sagetrac-mirror/commit/d4e323d52682733d709e6dcd22d89db792010655)|`build/pkgs: Add distros/opensuse.txt for Python packages`|\n|[0458001](https://github.com/sagemath/sagetrac-mirror/commit/0458001f2b95b873837b4018df1d2c364335677b)|`build/pkgs: Add distros/debian.txt for Python packages`|\n|[a77b85c](https://github.com/sagemath/sagetrac-mirror/commit/a77b85cb7a675a7dffc17c5fe343d3991967418a)|`Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().`|\n|[9d5b0a5](https://github.com/sagemath/sagetrac-mirror/commit/9d5b0a5c6958d0e623da7c25d9ce0e8abcd0781a)|`Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.`|\n|[a11dd26](https://github.com/sagemath/sagetrac-mirror/commit/a11dd268ec49371faf835b92f434e05e4ffb3485)|`Trac #29665: use sage-venv in SAGE_PYTHON_PACKAGE_CHECK().`|",
    "created_at": "2021-10-25T00:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581585",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:76'></a>
I dropped the toml commit because somebody else added an `spkg-configure.m4` in the meantime and I don't want to worry about reconciling them.

---
Last 10 new commits:
|                                                                                                                                          |                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[13d7087](https://github.com/sagemath/sagetrac-mirror/commit/13d708706420b9d03377bfb2bf4bd198536e739a)|`Trac #29665: don't clobber a plain file named config.venv.`|
|[cb0311a](https://github.com/sagemath/sagetrac-mirror/commit/cb0311aff6f48de2d91667ed87207b08c6723fb7)|`Trac #29665: don't announce system python packages that won't be used.`|
|[b81ac52](https://github.com/sagemath/sagetrac-mirror/commit/b81ac52c545ed923e83ee60324fb4451bb69524f)|`Trac #29665: add Gentoo package information for python packages.`|
|[5a9f0d4](https://github.com/sagemath/sagetrac-mirror/commit/5a9f0d4df82c1ca398e5c394b783e32ad788b08e)|`build/pkgs: Add distros/fedora.txt for Python packages`|
|[d235c17](https://github.com/sagemath/sagetrac-mirror/commit/d235c1793aa1b430162d275bf041f24c029b3c89)|`build/pkgs: Add distros/arch.txt for Python packages`|
|[d4e323d](https://github.com/sagemath/sagetrac-mirror/commit/d4e323d52682733d709e6dcd22d89db792010655)|`build/pkgs: Add distros/opensuse.txt for Python packages`|
|[0458001](https://github.com/sagemath/sagetrac-mirror/commit/0458001f2b95b873837b4018df1d2c364335677b)|`build/pkgs: Add distros/debian.txt for Python packages`|
|[a77b85c](https://github.com/sagemath/sagetrac-mirror/commit/a77b85cb7a675a7dffc17c5fe343d3991967418a)|`Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().`|
|[9d5b0a5](https://github.com/sagemath/sagetrac-mirror/commit/9d5b0a5c6958d0e623da7c25d9ce0e8abcd0781a)|`Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.`|
|[a11dd26](https://github.com/sagemath/sagetrac-mirror/commit/a11dd268ec49371faf835b92f434e05e4ffb3485)|`Trac #29665: use sage-venv in SAGE_PYTHON_PACKAGE_CHECK().`|



---

archive/issue_comments_581586.json:
```json
{
    "body": "<a id='comment:77'></a>\nYou didn't like how I merged it in eeae67c?",
    "created_at": "2021-10-25T00:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581586",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'></a>
You didn't like how I merged it in eeae67c?



---

archive/issue_comments_581587.json:
```json
{
    "body": "<a id='comment:78'></a>\nReplying to [mkoeppe](#comment%3A77):\n> You didn't like how I merged it in eeae67c?\n\n\nThat part is probably fine but huge merge commits aren't very nice to review.\n\nThere are a bunch of other python packages with similar spkg-configures that I skipped initially. Once the `--enable-system-site-packages` mechanism works well enough to enable by default, I'll go back and replace them all at once with the trivial python spkg-configure that all of the other packages are using.",
    "created_at": "2021-10-25T00:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581587",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:78'></a>
Replying to [mkoeppe](#comment%3A77):
> You didn't like how I merged it in eeae67c?


That part is probably fine but huge merge commits aren't very nice to review.

There are a bunch of other python packages with similar spkg-configures that I skipped initially. Once the `--enable-system-site-packages` mechanism works well enough to enable by default, I'll go back and replace them all at once with the trivial python spkg-configure that all of the other packages are using.



---

archive/issue_comments_581588.json:
```json
{
    "body": "<a id='comment:79'></a>\nReplying to [mkoeppe](#comment%3A71):\n> Replying to [mjo](#comment%3A70):\n> > The `sdh_*` scripts call `python3` directly\n\n> ... because they run with the venv activated. This is correct.\n\nSo both are supposedly running the symlink `/Users/runner/work/sage/sage/.tox/local-homebrew-macos-standard/local/bin/python3`, which should point to the real homebrew python3, by way of its being near the front of `PATH`. I'd love to know how it loses track of setuptools in the span of a few seconds, but I'm at a loss for ways to test it without a mac.",
    "created_at": "2021-10-25T02:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581588",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:79'></a>
Replying to [mkoeppe](#comment%3A71):
> Replying to [mjo](#comment%3A70):
> > The `sdh_*` scripts call `python3` directly

> ... because they run with the venv activated. This is correct.

So both are supposedly running the symlink `/Users/runner/work/sage/sage/.tox/local-homebrew-macos-standard/local/bin/python3`, which should point to the real homebrew python3, by way of its being near the front of `PATH`. I'd love to know how it loses track of setuptools in the span of a few seconds, but I'm at a loss for ways to test it without a mac.



---

archive/issue_comments_581589.json:
```json
{
    "body": "<a id='comment:80'></a>\nIt is unlikely that any of this is macOS-specific. It's just the only environment for which I have built #32703 so far. Help on that is welcome.",
    "created_at": "2021-10-25T02:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581589",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'></a>
It is unlikely that any of this is macOS-specific. It's just the only environment for which I have built #32703 so far. Help on that is welcome.



---

archive/issue_comments_581590.json:
```json
{
    "body": "<a id='comment:81'></a>\nI tried installing a separate copy of python-3.9.6 in `/home/mjo/tmp/python3` that doesn't have setuptools. After prepending `/home/mjo/tmp/python3/bin` to my `PATH`, I configured sage with `--with-python=/usr/bin/python3`, the \"good\" copy that has setuptools. Everything is detected and pip builds normally.",
    "created_at": "2021-10-25T02:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581590",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:81'></a>
I tried installing a separate copy of python-3.9.6 in `/home/mjo/tmp/python3` that doesn't have setuptools. After prepending `/home/mjo/tmp/python3/bin` to my `PATH`, I configured sage with `--with-python=/usr/bin/python3`, the "good" copy that has setuptools. Everything is detected and pip builds normally.



---

archive/issue_comments_581591.json:
```json
{
    "body": "Changing commit from \"a11dd268ec49371faf835b92f434e05e4ffb3485\" to \"b0a1a1d5be476ececaf5e128f1edde9480fa1a7b\"",
    "created_at": "2021-11-03T13:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581591",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a11dd268ec49371faf835b92f434e05e4ffb3485" to "b0a1a1d5be476ececaf5e128f1edde9480fa1a7b"



---

archive/issue_comments_581592.json:
```json
{
    "body": "<a id='comment:82'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[708dd10](https://github.com/sagemath/sagetrac-mirror/commit/708dd10451dfb6a589ffd067874d1403c87c188f)|`Trac #29665: don't clobber a plain file named config.venv.`|\n|[711fbe9](https://github.com/sagemath/sagetrac-mirror/commit/711fbe9c6cb87648a59f75619458714f884fad75)|`Trac #29665: don't announce system python packages that won't be used.`|\n|[9ef46fa](https://github.com/sagemath/sagetrac-mirror/commit/9ef46fa4538c49fb4aadc5747daa49cfff7f7dfa)|`Trac #29665: add Gentoo package information for python packages.`|\n|[b11abf5](https://github.com/sagemath/sagetrac-mirror/commit/b11abf5fd2cf9a00caf724cc09e9b1d3f5051cbf)|`build/pkgs: Add distros/fedora.txt for Python packages`|\n|[3029513](https://github.com/sagemath/sagetrac-mirror/commit/30295130909863659fbdf661cf23b2649ef9406d)|`build/pkgs: Add distros/arch.txt for Python packages`|\n|[6b079d5](https://github.com/sagemath/sagetrac-mirror/commit/6b079d5d5a75ff9b952cdb7d37528b11b2dca61f)|`build/pkgs: Add distros/opensuse.txt for Python packages`|\n|[4cfef70](https://github.com/sagemath/sagetrac-mirror/commit/4cfef70953c8a962c1b05f0255b66b0973964e22)|`build/pkgs: Add distros/debian.txt for Python packages`|\n|[95cd8df](https://github.com/sagemath/sagetrac-mirror/commit/95cd8dfa62bad9a3382c67928dd79b3b65c9139f)|`Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().`|\n|[6d36d69](https://github.com/sagemath/sagetrac-mirror/commit/6d36d69c539c038f917162e6d8b64d9f06dc5834)|`Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.`|\n|[b0a1a1d](https://github.com/sagemath/sagetrac-mirror/commit/b0a1a1d5be476ececaf5e128f1edde9480fa1a7b)|`Trac #29665: use sage-venv in SAGE_PYTHON_PACKAGE_CHECK().`|",
    "created_at": "2021-11-03T13:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[708dd10](https://github.com/sagemath/sagetrac-mirror/commit/708dd10451dfb6a589ffd067874d1403c87c188f)|`Trac #29665: don't clobber a plain file named config.venv.`|
|[711fbe9](https://github.com/sagemath/sagetrac-mirror/commit/711fbe9c6cb87648a59f75619458714f884fad75)|`Trac #29665: don't announce system python packages that won't be used.`|
|[9ef46fa](https://github.com/sagemath/sagetrac-mirror/commit/9ef46fa4538c49fb4aadc5747daa49cfff7f7dfa)|`Trac #29665: add Gentoo package information for python packages.`|
|[b11abf5](https://github.com/sagemath/sagetrac-mirror/commit/b11abf5fd2cf9a00caf724cc09e9b1d3f5051cbf)|`build/pkgs: Add distros/fedora.txt for Python packages`|
|[3029513](https://github.com/sagemath/sagetrac-mirror/commit/30295130909863659fbdf661cf23b2649ef9406d)|`build/pkgs: Add distros/arch.txt for Python packages`|
|[6b079d5](https://github.com/sagemath/sagetrac-mirror/commit/6b079d5d5a75ff9b952cdb7d37528b11b2dca61f)|`build/pkgs: Add distros/opensuse.txt for Python packages`|
|[4cfef70](https://github.com/sagemath/sagetrac-mirror/commit/4cfef70953c8a962c1b05f0255b66b0973964e22)|`build/pkgs: Add distros/debian.txt for Python packages`|
|[95cd8df](https://github.com/sagemath/sagetrac-mirror/commit/95cd8dfa62bad9a3382c67928dd79b3b65c9139f)|`Trac #29665: add more documentation for SAGE_PYTHON_PACKAGE_CHECK().`|
|[6d36d69](https://github.com/sagemath/sagetrac-mirror/commit/6d36d69c539c038f917162e6d8b64d9f06dc5834)|`Trac #29665: improve SAGE_PYTHON_PACKAGE_CHECK() failure message.`|
|[b0a1a1d](https://github.com/sagemath/sagetrac-mirror/commit/b0a1a1d5be476ececaf5e128f1edde9480fa1a7b)|`Trac #29665: use sage-venv in SAGE_PYTHON_PACKAGE_CHECK().`|



---

archive/issue_comments_581593.json:
```json
{
    "body": "<a id='comment:83'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[d648d23](https://github.com/sagemath/sagetrac-mirror/commit/d648d238699c512657d4d7ad18e65419cd605f8c)|`Trac #29665: add Gentoo package information for imagesize.`|\n|[0483924](https://github.com/sagemath/sagetrac-mirror/commit/04839241df086f66219904614c2615f6dfe425d0)|`Trac #29665: standard python spkg-configure.m4 for imagesize.`|\n|[2ba58f7](https://github.com/sagemath/sagetrac-mirror/commit/2ba58f79a0b164d54cee021a24ba4f883bcec5ba)|`Trac #29665: add Gentoo package information for mistune.`|\n|[ec87c12](https://github.com/sagemath/sagetrac-mirror/commit/ec87c1257c2451fa3214c3585a962aa1ab17e1d0)|`Trac #29665: standard python spkg-configure.m4 for mistune.`|\n|[2e44a60](https://github.com/sagemath/sagetrac-mirror/commit/2e44a60956aca9a62b8e1a0f3af13407d4e4c78a)|`Trac #29665: add Gentoo package information for backcall.`|\n|[418fc48](https://github.com/sagemath/sagetrac-mirror/commit/418fc488c5e30bd31c0eadc286b437572830ed83)|`Trac #29665: standard python spkg-configure.m4 for backcall.`|\n|[21102cd](https://github.com/sagemath/sagetrac-mirror/commit/21102cda8bb44ebbe048c30e5b2f6edcefc97348)|`Trac #29665: add Gentoo package information for parso.`|\n|[110e0cf](https://github.com/sagemath/sagetrac-mirror/commit/110e0cf87c20de1d32422d46c90bb76dbae39870)|`Trac #29665: standard python spkg-configure.m4 for parso.`|\n|[e059750](https://github.com/sagemath/sagetrac-mirror/commit/e0597506ce9dc1c00bbd72fcfeaf6ca04a1acdb9)|`Trac #29665: add Gentoo package information for pyparsing.`|\n|[ae68ea1](https://github.com/sagemath/sagetrac-mirror/commit/ae68ea1904f53249f8e0c473e0d9942b1b2d926c)|`Trac #29665: standard python spkg-configure.m4 for pyparsing.`|",
    "created_at": "2021-11-03T23:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:83'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[d648d23](https://github.com/sagemath/sagetrac-mirror/commit/d648d238699c512657d4d7ad18e65419cd605f8c)|`Trac #29665: add Gentoo package information for imagesize.`|
|[0483924](https://github.com/sagemath/sagetrac-mirror/commit/04839241df086f66219904614c2615f6dfe425d0)|`Trac #29665: standard python spkg-configure.m4 for imagesize.`|
|[2ba58f7](https://github.com/sagemath/sagetrac-mirror/commit/2ba58f79a0b164d54cee021a24ba4f883bcec5ba)|`Trac #29665: add Gentoo package information for mistune.`|
|[ec87c12](https://github.com/sagemath/sagetrac-mirror/commit/ec87c1257c2451fa3214c3585a962aa1ab17e1d0)|`Trac #29665: standard python spkg-configure.m4 for mistune.`|
|[2e44a60](https://github.com/sagemath/sagetrac-mirror/commit/2e44a60956aca9a62b8e1a0f3af13407d4e4c78a)|`Trac #29665: add Gentoo package information for backcall.`|
|[418fc48](https://github.com/sagemath/sagetrac-mirror/commit/418fc488c5e30bd31c0eadc286b437572830ed83)|`Trac #29665: standard python spkg-configure.m4 for backcall.`|
|[21102cd](https://github.com/sagemath/sagetrac-mirror/commit/21102cda8bb44ebbe048c30e5b2f6edcefc97348)|`Trac #29665: add Gentoo package information for parso.`|
|[110e0cf](https://github.com/sagemath/sagetrac-mirror/commit/110e0cf87c20de1d32422d46c90bb76dbae39870)|`Trac #29665: standard python spkg-configure.m4 for parso.`|
|[e059750](https://github.com/sagemath/sagetrac-mirror/commit/e0597506ce9dc1c00bbd72fcfeaf6ca04a1acdb9)|`Trac #29665: add Gentoo package information for pyparsing.`|
|[ae68ea1](https://github.com/sagemath/sagetrac-mirror/commit/ae68ea1904f53249f8e0c473e0d9942b1b2d926c)|`Trac #29665: standard python spkg-configure.m4 for pyparsing.`|



---

archive/issue_comments_581594.json:
```json
{
    "body": "Changing commit from \"b0a1a1d5be476ececaf5e128f1edde9480fa1a7b\" to \"ae68ea1904f53249f8e0c473e0d9942b1b2d926c\"",
    "created_at": "2021-11-03T23:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581594",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b0a1a1d5be476ececaf5e128f1edde9480fa1a7b" to "ae68ea1904f53249f8e0c473e0d9942b1b2d926c"



---

archive/issue_comments_581595.json:
```json
{
    "body": "Changing commit from \"ae68ea1904f53249f8e0c473e0d9942b1b2d926c\" to \"f1890fb090720378eb6f5a8e0169a2181d37298d\"",
    "created_at": "2021-11-04T22:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ae68ea1904f53249f8e0c473e0d9942b1b2d926c" to "f1890fb090720378eb6f5a8e0169a2181d37298d"



---

archive/issue_comments_581596.json:
```json
{
    "body": "<a id='comment:84'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[1b0bb0a](https://github.com/sagemath/sagetrac-mirror/commit/1b0bb0a1bf71b95339226f87c0cb65a9415beb93)|`Trac #29665: add Gentoo package information for attrs.`|\n|[5e44675](https://github.com/sagemath/sagetrac-mirror/commit/5e446759b623d995cb5a582ff28fd78f7111a624)|`Trac #29665: standard python spkg-configure.m4 for attrs.`|\n|[f1a1a49](https://github.com/sagemath/sagetrac-mirror/commit/f1a1a4962466a292b2a194aaecf7805b4fa1f99c)|`Trac #29665: add Gentoo package information for send2trash.`|\n|[80b99fe](https://github.com/sagemath/sagetrac-mirror/commit/80b99fe9307a2e3e1a753edec4f4a3a7bc857ef3)|`Trac #29665: standard python spkg-configure.m4 for send2trash.`|\n|[064a701](https://github.com/sagemath/sagetrac-mirror/commit/064a7011fbe9be7bde09ebb7204b13d7a8d08ab6)|`Trac #29665: add Gentoo package information for pyrsistent.`|\n|[e18ce3d](https://github.com/sagemath/sagetrac-mirror/commit/e18ce3d5621a11a5c255a208fcb7efe627dae11e)|`Trac #29665: standard python spkg-configure.m4 for pyrsistent.`|\n|[853da97](https://github.com/sagemath/sagetrac-mirror/commit/853da97d92e6fc00de107cbfe4e32953ce5b2345)|`Trac #29665: add Gentoo package information for entrypoints.`|\n|[04d5472](https://github.com/sagemath/sagetrac-mirror/commit/04d547255e4034b6c97c5edffb0826c8b43d27a8)|`Trac #29665: standard python spkg-configure.m4 for entrypoints.`|\n|[6490caf](https://github.com/sagemath/sagetrac-mirror/commit/6490caf1c51e51b51b3153395c485709a1a73c4a)|`Trac #29665: add Gentoo package information for markupsafe.`|\n|[f1890fb](https://github.com/sagemath/sagetrac-mirror/commit/f1890fb090720378eb6f5a8e0169a2181d37298d)|`Trac #29665: standard python spkg-configure.m4 for markupsafe.`|",
    "created_at": "2021-11-04T22:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:84'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[1b0bb0a](https://github.com/sagemath/sagetrac-mirror/commit/1b0bb0a1bf71b95339226f87c0cb65a9415beb93)|`Trac #29665: add Gentoo package information for attrs.`|
|[5e44675](https://github.com/sagemath/sagetrac-mirror/commit/5e446759b623d995cb5a582ff28fd78f7111a624)|`Trac #29665: standard python spkg-configure.m4 for attrs.`|
|[f1a1a49](https://github.com/sagemath/sagetrac-mirror/commit/f1a1a4962466a292b2a194aaecf7805b4fa1f99c)|`Trac #29665: add Gentoo package information for send2trash.`|
|[80b99fe](https://github.com/sagemath/sagetrac-mirror/commit/80b99fe9307a2e3e1a753edec4f4a3a7bc857ef3)|`Trac #29665: standard python spkg-configure.m4 for send2trash.`|
|[064a701](https://github.com/sagemath/sagetrac-mirror/commit/064a7011fbe9be7bde09ebb7204b13d7a8d08ab6)|`Trac #29665: add Gentoo package information for pyrsistent.`|
|[e18ce3d](https://github.com/sagemath/sagetrac-mirror/commit/e18ce3d5621a11a5c255a208fcb7efe627dae11e)|`Trac #29665: standard python spkg-configure.m4 for pyrsistent.`|
|[853da97](https://github.com/sagemath/sagetrac-mirror/commit/853da97d92e6fc00de107cbfe4e32953ce5b2345)|`Trac #29665: add Gentoo package information for entrypoints.`|
|[04d5472](https://github.com/sagemath/sagetrac-mirror/commit/04d547255e4034b6c97c5edffb0826c8b43d27a8)|`Trac #29665: standard python spkg-configure.m4 for entrypoints.`|
|[6490caf](https://github.com/sagemath/sagetrac-mirror/commit/6490caf1c51e51b51b3153395c485709a1a73c4a)|`Trac #29665: add Gentoo package information for markupsafe.`|
|[f1890fb](https://github.com/sagemath/sagetrac-mirror/commit/f1890fb090720378eb6f5a8e0169a2181d37298d)|`Trac #29665: standard python spkg-configure.m4 for markupsafe.`|



---

archive/issue_comments_581597.json:
```json
{
    "body": "<a id='comment:85'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[47f78d2](https://github.com/sagemath/sagetrac-mirror/commit/47f78d28e3d5c0fc3072ea75ea950dddc4adde10)|`Trac #29665: add Gentoo package information for flit_core.`|\n|[1a9d173](https://github.com/sagemath/sagetrac-mirror/commit/1a9d173289a06fe1af88005b27511f351e3976c5)|`Trac #29665: standard python spkg-configure.m4 for flit_core.`|\n|[c4095c6](https://github.com/sagemath/sagetrac-mirror/commit/c4095c6ab3f1d2fa3ba274a16a98951c636199eb)|`Trac #29665: add Gentoo package information for nest_asyncio.`|\n|[6da4c04](https://github.com/sagemath/sagetrac-mirror/commit/6da4c043de00dfd26cc83b15dfb4c70a7c8cbe96)|`Trac #29665: standard python spkg-configure.m4 for nest_asyncio.`|\n|[e4da384](https://github.com/sagemath/sagetrac-mirror/commit/e4da3849239ce1f356d3cb1ac67639726ba41d00)|`Trac #29665: add Gentoo package information for ipython_genutils.`|\n|[00a37aa](https://github.com/sagemath/sagetrac-mirror/commit/00a37aadc998fb273d0ba2461688e2811ec20598)|`Trac #29665: standard python spkg-configure.m4 for ipython_genutils.`|\n|[0b94073](https://github.com/sagemath/sagetrac-mirror/commit/0b94073eb49e45c0be71a18564088c587dd8bdf6)|`Trac #29665: add Gentoo package information for ipython.`|\n|[2c13864](https://github.com/sagemath/sagetrac-mirror/commit/2c13864696182f9583b684b85131388676c7d191)|`Trac #29665: standard python spkg-configure.m4 for ipython.`|\n|[e8b2c8e](https://github.com/sagemath/sagetrac-mirror/commit/e8b2c8eb27fab67a5e23d78090dd3a54bec1863e)|`Trac #29665: standard python spkg-configure.m4 for ipywidgets.`|\n|[5540df2](https://github.com/sagemath/sagetrac-mirror/commit/5540df25d567ebe8c0fa632b7374b98674984d5a)|`Trac #29665: add Gentoo package information for wheel.`|",
    "created_at": "2021-11-05T16:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:85'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[47f78d2](https://github.com/sagemath/sagetrac-mirror/commit/47f78d28e3d5c0fc3072ea75ea950dddc4adde10)|`Trac #29665: add Gentoo package information for flit_core.`|
|[1a9d173](https://github.com/sagemath/sagetrac-mirror/commit/1a9d173289a06fe1af88005b27511f351e3976c5)|`Trac #29665: standard python spkg-configure.m4 for flit_core.`|
|[c4095c6](https://github.com/sagemath/sagetrac-mirror/commit/c4095c6ab3f1d2fa3ba274a16a98951c636199eb)|`Trac #29665: add Gentoo package information for nest_asyncio.`|
|[6da4c04](https://github.com/sagemath/sagetrac-mirror/commit/6da4c043de00dfd26cc83b15dfb4c70a7c8cbe96)|`Trac #29665: standard python spkg-configure.m4 for nest_asyncio.`|
|[e4da384](https://github.com/sagemath/sagetrac-mirror/commit/e4da3849239ce1f356d3cb1ac67639726ba41d00)|`Trac #29665: add Gentoo package information for ipython_genutils.`|
|[00a37aa](https://github.com/sagemath/sagetrac-mirror/commit/00a37aadc998fb273d0ba2461688e2811ec20598)|`Trac #29665: standard python spkg-configure.m4 for ipython_genutils.`|
|[0b94073](https://github.com/sagemath/sagetrac-mirror/commit/0b94073eb49e45c0be71a18564088c587dd8bdf6)|`Trac #29665: add Gentoo package information for ipython.`|
|[2c13864](https://github.com/sagemath/sagetrac-mirror/commit/2c13864696182f9583b684b85131388676c7d191)|`Trac #29665: standard python spkg-configure.m4 for ipython.`|
|[e8b2c8e](https://github.com/sagemath/sagetrac-mirror/commit/e8b2c8eb27fab67a5e23d78090dd3a54bec1863e)|`Trac #29665: standard python spkg-configure.m4 for ipywidgets.`|
|[5540df2](https://github.com/sagemath/sagetrac-mirror/commit/5540df25d567ebe8c0fa632b7374b98674984d5a)|`Trac #29665: add Gentoo package information for wheel.`|



---

archive/issue_comments_581598.json:
```json
{
    "body": "Changing commit from \"f1890fb090720378eb6f5a8e0169a2181d37298d\" to \"5540df25d567ebe8c0fa632b7374b98674984d5a\"",
    "created_at": "2021-11-05T16:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f1890fb090720378eb6f5a8e0169a2181d37298d" to "5540df25d567ebe8c0fa632b7374b98674984d5a"



---

archive/issue_comments_581599.json:
```json
{
    "body": "<a id='comment:86'></a>\nSomething's gone wrong in the meantime. I'm now seeing cypari fail to cythonize.\n\ncypari has a custom patch that in turn requires a custom patched cython, so I wouldn't expect it to work with the system cython... but I've got the cython SPKG installed. Must be somehow the system cython is getting used.",
    "created_at": "2021-11-05T17:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581599",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:86'></a>
Something's gone wrong in the meantime. I'm now seeing cypari fail to cythonize.

cypari has a custom patch that in turn requires a custom patched cython, so I wouldn't expect it to work with the system cython... but I've got the cython SPKG installed. Must be somehow the system cython is getting used.



---

archive/issue_comments_581600.json:
```json
{
    "body": "<a id='comment:87'></a>\nReplying to [mjo](#comment%3A86):\n> Must be somehow the system cython is getting used.\n\n\nI think this explains all of the problems observed so far:\n\n```\n$ sage -c \"print(sys.path)\"\n['/home/mjo/src/sage.git/src/bin',\n '/usr/lib/python39.zip',\n '/usr/lib/python3.9',\n '/usr/lib/python3.9/lib-dynload',\n '/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages', \n '/usr/lib/python3.9/site-packages']\n```\n\nI have been assuming that the venv would be searched before the system paths. When it isn't, installing an SPKG to override an unusable system package doesn't work.",
    "created_at": "2021-11-06T13:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581600",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:87'></a>
Replying to [mjo](#comment%3A86):
> Must be somehow the system cython is getting used.


I think this explains all of the problems observed so far:

```
$ sage -c "print(sys.path)"
['/home/mjo/src/sage.git/src/bin',
 '/usr/lib/python39.zip',
 '/usr/lib/python3.9',
 '/usr/lib/python3.9/lib-dynload',
 '/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages', 
 '/usr/lib/python3.9/site-packages']
```

I have been assuming that the venv would be searched before the system paths. When it isn't, installing an SPKG to override an unusable system package doesn't work.



---

archive/issue_comments_581601.json:
```json
{
    "body": "<a id='comment:88'></a>\nReplying to [mjo](#comment%3A87):\n> I have been assuming that the venv would be searched before the system paths.\n\n\nIt is searched before the system `site-packages`; but not before the paths that provide the Python standard library.",
    "created_at": "2021-11-06T17:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581601",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:88'></a>
Replying to [mjo](#comment%3A87):
> I have been assuming that the venv would be searched before the system paths.


It is searched before the system `site-packages`; but not before the paths that provide the Python standard library.



---

archive/issue_comments_581602.json:
```json
{
    "body": "<a id='comment:89'></a>\nReplying to [mkoeppe](#comment%3A88):\n> Replying to [mjo](#comment%3A87):\n> > I have been assuming that the venv would be searched before the system paths.\n\n> \n> It is searched before the system `site-packages`; but not before the paths that provide the Python standard library.\n\n\nYeah, thanks, I realized that later. The problem with cython is due to pip refusing to install a wheel that's the same version as the existing one. You dealt with that recently by issuing a `pip uninstall` prior to `pip install`... but the uninstall does nothing if cython comes from the system. We're going to have the same issue with many patched python packages.",
    "created_at": "2021-11-06T17:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581602",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:89'></a>
Replying to [mkoeppe](#comment%3A88):
> Replying to [mjo](#comment%3A87):
> > I have been assuming that the venv would be searched before the system paths.

> 
> It is searched before the system `site-packages`; but not before the paths that provide the Python standard library.


Yeah, thanks, I realized that later. The problem with cython is due to pip refusing to install a wheel that's the same version as the existing one. You dealt with that recently by issuing a `pip uninstall` prior to `pip install`... but the uninstall does nothing if cython comes from the system. We're going to have the same issue with many patched python packages.



---

archive/issue_comments_581603.json:
```json
{
    "body": "<a id='comment:90'></a>\nReplying to [mjo](#comment%3A89):\n> The problem with cython is due to pip refusing to install a wheel that's the same version as the existing one. You dealt with that recently by issuing a `pip uninstall` prior to `pip install`... but the uninstall does nothing if cython comes from the system. We're going to have the same issue with many patched python packages.\n\n\nAha, interesting. \nThat's the 2nd and 3rd bullet points in #29023 \"Questions to be resolved\".",
    "created_at": "2021-11-06T18:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581603",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:90'></a>
Replying to [mjo](#comment%3A89):
> The problem with cython is due to pip refusing to install a wheel that's the same version as the existing one. You dealt with that recently by issuing a `pip uninstall` prior to `pip install`... but the uninstall does nothing if cython comes from the system. We're going to have the same issue with many patched python packages.


Aha, interesting. 
That's the 2nd and 3rd bullet points in #29023 "Questions to be resolved".



---

archive/issue_comments_581604.json:
```json
{
    "body": "<a id='comment:91'></a>\nSo in the case of `--enable-system-site-packages`, we may have to add `--ignore-installed` to the options when installing the wheel.",
    "created_at": "2021-11-06T18:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581604",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:91'></a>
So in the case of `--enable-system-site-packages`, we may have to add `--ignore-installed` to the options when installing the wheel.



---

archive/issue_comments_581605.json:
```json
{
    "body": "<a id='comment:92'></a>\nReplying to [mkoeppe](#comment%3A91):\n> So in the case of `--enable-system-site-packages`, we may have to add `--ignore-installed` to the options when installing the wheel.\n\n\nThat was already part of the fallback case in `sage-pip-install`, but the install conflict doesn't actually cause an error -- only a warning. I've already moved it from the fallback into the main `pip_install_flags` and will see what happens.",
    "created_at": "2021-11-06T18:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581605",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:92'></a>
Replying to [mkoeppe](#comment%3A91):
> So in the case of `--enable-system-site-packages`, we may have to add `--ignore-installed` to the options when installing the wheel.


That was already part of the fallback case in `sage-pip-install`, but the install conflict doesn't actually cause an error -- only a warning. I've already moved it from the fallback into the main `pip_install_flags` and will see what happens.



---

archive/issue_comments_581606.json:
```json
{
    "body": "Changing commit from \"5540df25d567ebe8c0fa632b7374b98674984d5a\" to \"178253d5b58a46fd8b428a6e3cc391d4ea790934\"",
    "created_at": "2021-11-07T12:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581606",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5540df25d567ebe8c0fa632b7374b98674984d5a" to "178253d5b58a46fd8b428a6e3cc391d4ea790934"



---

archive/issue_comments_581607.json:
```json
{
    "body": "<a id='comment:93'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[178253d](https://github.com/sagemath/sagetrac-mirror/commit/178253d5b58a46fd8b428a6e3cc391d4ea790934)|`Trac #29665: add --ignore-installed flag to pip installs.`|",
    "created_at": "2021-11-07T12:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581607",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:93'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[178253d](https://github.com/sagemath/sagetrac-mirror/commit/178253d5b58a46fd8b428a6e3cc391d4ea790934)|`Trac #29665: add --ignore-installed flag to pip installs.`|



---

archive/issue_comments_581608.json:
```json
{
    "body": "<a id='comment:94'></a>\nWon't this reinstall dependencies of every package every time?",
    "created_at": "2021-11-07T17:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581608",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:94'></a>
Won't this reinstall dependencies of every package every time?



---

archive/issue_comments_581609.json:
```json
{
    "body": "<a id='comment:95'></a>\nReplying to [mkoeppe](#comment%3A94):\n> Won't this reinstall dependencies of every package every time?\n\n\nThat would have been a smart thing for me to check a few hours ago, but I saw a bunch of unrelated doctest failures and just clobbered my local checkout to confirm that #32836 occurs on the unmodified develop branch.\n\nI'll switch back to this ticket eventually and make sure that we're not installing dependencies that shouldn't be. It would be especially counterproductive if pip was installing local copies of dependencies when the intention is to use those from the system.",
    "created_at": "2021-11-07T18:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581609",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:95'></a>
Replying to [mkoeppe](#comment%3A94):
> Won't this reinstall dependencies of every package every time?


That would have been a smart thing for me to check a few hours ago, but I saw a bunch of unrelated doctest failures and just clobbered my local checkout to confirm that #32836 occurs on the unmodified develop branch.

I'll switch back to this ticket eventually and make sure that we're not installing dependencies that shouldn't be. It would be especially counterproductive if pip was installing local copies of dependencies when the intention is to use those from the system.



---

archive/issue_comments_581610.json:
```json
{
    "body": "<a id='comment:96'></a>\nReplying to [mkoeppe](#comment%3A94):\n> Won't this reinstall dependencies of every package every time?\n\n\nSort of. It actually winds up doing the right thing in most cases, but pollutes the logs and probably wastes a few seconds.\n\nIf the dependency is installed as a system package, an error gets thrown and the whole thing is retried with `--no-deps`, which makes it work. For example with system setuptools: \n\n```\n[setuptools_scm-6.3.2] ERROR: Could not find a version that satisfies the requirement setuptools (from setuptools-scm) (from versions: none)\n[setuptools_scm-6.3.2] ERROR: No matching distribution found for setuptools\n[setuptools_scm-6.3.2] Warning: installing with ... failed. Retrying, adding \"--no-deps --ignore-requires-python\"\n[setuptools_scm-6.3.2] Using pip 21.2.4 from /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/pip (python 3.9)\n...\n[setuptools_scm-6.3.2] Successfully installed setuptools-scm-6.3.2\n[setuptools_scm-6.3.2] Warning: The installation needed to use \"--no-deps --ignore-requires-python\" to succeed. This means that a dependencies file in build/pkgs/ needs to be updated. Please report this to sage-devel@googlegroups.com, including the build log of this package.\n```\n\nHowever, when the dependency itself is installed as an SPKG, it looks like a portion of its installation routine is re-run. Here's cypari reinstalling cysignals/cython:\n\n```\n[cypari-2.1.2] Using pip 21.2.4 from /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/pip (python 3.9)\n[cypari-2.1.2] Looking in links: /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels\n[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/cypari-2.1.2/inst/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/cypari2-2.1.2-cp39-cp39-linux_x86_64.whl\n[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/cysignals-1.10.3-cp39-cp39-linux_x86_64.whl\n[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/Cython-0.29.24-cp39-cp39-linux_x86_64.whl\n[cypari-2.1.2] Installing collected packages: Cython, cysignals, cypari2\n[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cygdb to 755\n[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cython to 755\n[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cythonize to 755\n[cypari-2.1.2] Successfully installed Cython-0.29.24 cypari2-2.1.2 cysignals-1.10.3\n```\n\nI'm not sure what all it's doing, or how undesirable it is in the general case. It doesn't take noticeably longer, and everything works out in the end.\n\nI suppose I'll add both `--no-deps` and `--ignore-installed`, but only when `--enable-system-site-packages` is on. If it ever becomes default, we'll just have to run a CI with `--disable-system-site-packages` to detect stale deps using that warning.",
    "created_at": "2021-11-09T03:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581610",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:96'></a>
Replying to [mkoeppe](#comment%3A94):
> Won't this reinstall dependencies of every package every time?


Sort of. It actually winds up doing the right thing in most cases, but pollutes the logs and probably wastes a few seconds.

If the dependency is installed as a system package, an error gets thrown and the whole thing is retried with `--no-deps`, which makes it work. For example with system setuptools: 

```
[setuptools_scm-6.3.2] ERROR: Could not find a version that satisfies the requirement setuptools (from setuptools-scm) (from versions: none)
[setuptools_scm-6.3.2] ERROR: No matching distribution found for setuptools
[setuptools_scm-6.3.2] Warning: installing with ... failed. Retrying, adding "--no-deps --ignore-requires-python"
[setuptools_scm-6.3.2] Using pip 21.2.4 from /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/pip (python 3.9)
...
[setuptools_scm-6.3.2] Successfully installed setuptools-scm-6.3.2
[setuptools_scm-6.3.2] Warning: The installation needed to use "--no-deps --ignore-requires-python" to succeed. This means that a dependencies file in build/pkgs/ needs to be updated. Please report this to sage-devel@googlegroups.com, including the build log of this package.
```

However, when the dependency itself is installed as an SPKG, it looks like a portion of its installation routine is re-run. Here's cypari reinstalling cysignals/cython:

```
[cypari-2.1.2] Using pip 21.2.4 from /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/pip (python 3.9)
[cypari-2.1.2] Looking in links: /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels
[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/cypari-2.1.2/inst/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/cypari2-2.1.2-cp39-cp39-linux_x86_64.whl
[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/cysignals-1.10.3-cp39-cp39-linux_x86_64.whl
[cypari-2.1.2] Processing /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/Cython-0.29.24-cp39-cp39-linux_x86_64.whl
[cypari-2.1.2] Installing collected packages: Cython, cysignals, cypari2
[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cygdb to 755
[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cython to 755
[cypari-2.1.2]   changing mode of /home/mjo/src/sage.git/local/var/lib/sage/venv-python3.9/bin/cythonize to 755
[cypari-2.1.2] Successfully installed Cython-0.29.24 cypari2-2.1.2 cysignals-1.10.3
```

I'm not sure what all it's doing, or how undesirable it is in the general case. It doesn't take noticeably longer, and everything works out in the end.

I suppose I'll add both `--no-deps` and `--ignore-installed`, but only when `--enable-system-site-packages` is on. If it ever becomes default, we'll just have to run a CI with `--disable-system-site-packages` to detect stale deps using that warning.



---

archive/issue_comments_581611.json:
```json
{
    "body": "<a id='comment:97'></a>\nReplying to [mjo](#comment%3A96):\n> I suppose I'll add both `--no-deps` and `--ignore-installed`, but only when `--enable-system-site-packages` is on. \n\nYes, this seems to be the way forward.",
    "created_at": "2021-11-09T04:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581611",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:97'></a>
Replying to [mjo](#comment%3A96):
> I suppose I'll add both `--no-deps` and `--ignore-installed`, but only when `--enable-system-site-packages` is on. 

Yes, this seems to be the way forward.



---

archive/issue_comments_581612.json:
```json
{
    "body": "<a id='comment:98'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|\n|[ffea765](https://github.com/sagemath/sagetrac-mirror/commit/ffea765dd285947817554d3a651364860a5a65b6)|`build/bin/sage-dist-helpers (sdh_pip_install): Handle new option --build-isolation`|\n|[ac93e7b](https://github.com/sagemath/sagetrac-mirror/commit/ac93e7bcd483b5ab72be655ce93df96e74542402)|`build/bin/sage-dist-helpers (sdh_pip_install): Pass options on to sdh_store_and_pip_install_wheel`|\n|[eb83e8b](https://github.com/sagemath/sagetrac-mirror/commit/eb83e8b6e27c84f7ecb9d6e10218c0366f529d87)|`build/bin/sage-dist-helpers: Only extract special ooptions --build-isolation and --no-deps from the front, pass --no-deps only to install`|\n|[41d65d5](https://github.com/sagemath/sagetrac-mirror/commit/41d65d5b30b0aad6f529c6cd97b66e4d44290b60)|`Trac #29665: support passing --ignore-installed to sdh_pip_install.`|\n|[f96b669](https://github.com/sagemath/sagetrac-mirror/commit/f96b66965dd29e7ba9567d4733f02f052a4dfc40)|`Trac #29665: set $SAGE_SDH_PIP_INSTALL_FLAGS for --enable-system-site-packages.`|\n|[0528df3](https://github.com/sagemath/sagetrac-mirror/commit/0528df324df55fa08e1cdac75313a257b9a26cce)|`build/pkgs/flit_core/spkg-install.in: Use sdh_pip_install --no-deps`|\n|[e91fd2f](https://github.com/sagemath/sagetrac-mirror/commit/e91fd2f6656982135ca904aa1bcb1964c3d5d4f8)|`Trac #29665: pass $SAGE_SDH_PIP_INSTALL_FLAGS to sdh_pip_install.`|",
    "created_at": "2021-11-10T01:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581612",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:98'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|
|[ffea765](https://github.com/sagemath/sagetrac-mirror/commit/ffea765dd285947817554d3a651364860a5a65b6)|`build/bin/sage-dist-helpers (sdh_pip_install): Handle new option --build-isolation`|
|[ac93e7b](https://github.com/sagemath/sagetrac-mirror/commit/ac93e7bcd483b5ab72be655ce93df96e74542402)|`build/bin/sage-dist-helpers (sdh_pip_install): Pass options on to sdh_store_and_pip_install_wheel`|
|[eb83e8b](https://github.com/sagemath/sagetrac-mirror/commit/eb83e8b6e27c84f7ecb9d6e10218c0366f529d87)|`build/bin/sage-dist-helpers: Only extract special ooptions --build-isolation and --no-deps from the front, pass --no-deps only to install`|
|[41d65d5](https://github.com/sagemath/sagetrac-mirror/commit/41d65d5b30b0aad6f529c6cd97b66e4d44290b60)|`Trac #29665: support passing --ignore-installed to sdh_pip_install.`|
|[f96b669](https://github.com/sagemath/sagetrac-mirror/commit/f96b66965dd29e7ba9567d4733f02f052a4dfc40)|`Trac #29665: set $SAGE_SDH_PIP_INSTALL_FLAGS for --enable-system-site-packages.`|
|[0528df3](https://github.com/sagemath/sagetrac-mirror/commit/0528df324df55fa08e1cdac75313a257b9a26cce)|`build/pkgs/flit_core/spkg-install.in: Use sdh_pip_install --no-deps`|
|[e91fd2f](https://github.com/sagemath/sagetrac-mirror/commit/e91fd2f6656982135ca904aa1bcb1964c3d5d4f8)|`Trac #29665: pass $SAGE_SDH_PIP_INSTALL_FLAGS to sdh_pip_install.`|



---

archive/issue_comments_581613.json:
```json
{
    "body": "Changing commit from \"178253d5b58a46fd8b428a6e3cc391d4ea790934\" to \"e91fd2f6656982135ca904aa1bcb1964c3d5d4f8\"",
    "created_at": "2021-11-10T01:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581613",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "178253d5b58a46fd8b428a6e3cc391d4ea790934" to "e91fd2f6656982135ca904aa1bcb1964c3d5d4f8"



---

archive/issue_comments_581614.json:
```json
{
    "body": "<a id='comment:99'></a>\nI've cherry-picked your changes from #32715, and added the ability to pass `--ignore-installed` to `sdh_pip_install`, too. Afterwards I pass the new variable `$SAGE_SDH_PIP_INSTALL_FLAGS` to every invocation of `sdh_pip_install` in an `spkg-install.in` file.\n\nI think this is a tiny bit cleaner than introducing a dependency upon `sage-build-env-config` within `sage-dist-helpers`, but the duplication is hard to overlook. If you prefer to have `sdh_pip_install` directly use `$SAGE_SDH_PIP_INSTALL_FLAGS`, I'm happy to do it that way too.",
    "created_at": "2021-11-10T01:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581614",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:99'></a>
I've cherry-picked your changes from #32715, and added the ability to pass `--ignore-installed` to `sdh_pip_install`, too. Afterwards I pass the new variable `$SAGE_SDH_PIP_INSTALL_FLAGS` to every invocation of `sdh_pip_install` in an `spkg-install.in` file.

I think this is a tiny bit cleaner than introducing a dependency upon `sage-build-env-config` within `sage-dist-helpers`, but the duplication is hard to overlook. If you prefer to have `sdh_pip_install` directly use `$SAGE_SDH_PIP_INSTALL_FLAGS`, I'm happy to do it that way too.



---

archive/issue_comments_581615.json:
```json
{
    "body": "<a id='comment:100'></a>\nReplying to [mjo](#comment%3A99):\n> the duplication is hard to overlook\n\n\nYes, this is too much",
    "created_at": "2021-11-10T01:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581615",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:100'></a>
Replying to [mjo](#comment%3A99):
> the duplication is hard to overlook


Yes, this is too much



---

archive/issue_comments_581616.json:
```json
{
    "body": "Changing commit from \"e91fd2f6656982135ca904aa1bcb1964c3d5d4f8\" to \"055dc93a17cc23db141d8bc354bd4d2257667328\"",
    "created_at": "2021-11-10T02:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581616",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e91fd2f6656982135ca904aa1bcb1964c3d5d4f8" to "055dc93a17cc23db141d8bc354bd4d2257667328"



---

archive/issue_comments_581617.json:
```json
{
    "body": "<a id='comment:1'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[0f50892](https://github.com/sagemath/sagetrac-mirror/commit/0f50892e5c72973981d4e79f64646ba5ca4b5bbd)|`build/pkgs/flit_core/spkg-install.in: Use sdh_pip_install --no-deps`|\n|[87f5223](https://github.com/sagemath/sagetrac-mirror/commit/87f52232c036c719b6bcd0d6db371be21d2c23e7)|`Trac #29665: set $SAGE_SDH_PIP_INSTALL_FLAGS for --enable-system-site-packages.`|\n|[055dc93](https://github.com/sagemath/sagetrac-mirror/commit/055dc93a17cc23db141d8bc354bd4d2257667328)|`Trac #29665: pass $SAGE_SDH_PIP_INSTALL_FLAGS to sdh_pip_install.`|",
    "created_at": "2021-11-10T02:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581617",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[0f50892](https://github.com/sagemath/sagetrac-mirror/commit/0f50892e5c72973981d4e79f64646ba5ca4b5bbd)|`build/pkgs/flit_core/spkg-install.in: Use sdh_pip_install --no-deps`|
|[87f5223](https://github.com/sagemath/sagetrac-mirror/commit/87f52232c036c719b6bcd0d6db371be21d2c23e7)|`Trac #29665: set $SAGE_SDH_PIP_INSTALL_FLAGS for --enable-system-site-packages.`|
|[055dc93](https://github.com/sagemath/sagetrac-mirror/commit/055dc93a17cc23db141d8bc354bd4d2257667328)|`Trac #29665: pass $SAGE_SDH_PIP_INSTALL_FLAGS to sdh_pip_install.`|



---

archive/issue_comments_581618.json:
```json
{
    "body": "<a id='comment:2'></a>\nOk, `sdh_pip_install` handles it now. I didn't even have to source `sage-build-env-config`, since in the context of `spkg-install.in` it will already have been sourced. And in any other context, an empty `$SAGE_SDH_PIP_INSTALL_OPTIONS` has no effect.",
    "created_at": "2021-11-10T02:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581618",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:2'></a>
Ok, `sdh_pip_install` handles it now. I didn't even have to source `sage-build-env-config`, since in the context of `spkg-install.in` it will already have been sourced. And in any other context, an empty `$SAGE_SDH_PIP_INSTALL_OPTIONS` has no effect.



---

archive/issue_comments_581619.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think this should go into `sdh_store_and_pip_install_wheel`, not `sdh_pip_install`",
    "created_at": "2021-11-10T02:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581619",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
I think this should go into `sdh_store_and_pip_install_wheel`, not `sdh_pip_install`



---

archive/issue_comments_581620.json:
```json
{
    "body": "Changing commit from \"055dc93a17cc23db141d8bc354bd4d2257667328\" to \"922473a9fa81db7664baa725b2db0ac745ce5f61\"",
    "created_at": "2021-11-10T18:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581620",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "055dc93a17cc23db141d8bc354bd4d2257667328" to "922473a9fa81db7664baa725b2db0ac745ce5f61"



---

archive/issue_comments_581621.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|\n|[08b201a](https://github.com/sagemath/sagetrac-mirror/commit/08b201a1078388b30560c9ba893ba97e1e2820ff)|`Trac #29665: set $SAGE_PIP_INSTALL_FLAGS for --enable-system-site-packages.`|\n|[c2b80fb](https://github.com/sagemath/sagetrac-mirror/commit/c2b80fbaaea0809f17ea1c0ba55a51b3e3804e02)|`Trac #29665: pass $SAGE_PIP_INSTALL_FLAGS to sdh_pip_install.`|\n|[f4c5839](https://github.com/sagemath/sagetrac-mirror/commit/f4c5839b2abea399a43bdbd80cf855230be5da2d)|`Trac #29665: add Gentoo package information for pexpect.`|\n|[d5f4fc7](https://github.com/sagemath/sagetrac-mirror/commit/d5f4fc7549490b23293a0fbb7b7b899ccf53ecda)|`Trac #29665: standard python spkg-configure.m4 for pexpect.`|\n|[0b860e8](https://github.com/sagemath/sagetrac-mirror/commit/0b860e8c0c34d43768b39c427fb596972afa84e5)|`Trac #29665: add Gentoo package information for docutils.`|\n|[c2b54ff](https://github.com/sagemath/sagetrac-mirror/commit/c2b54ff516931c4ff7711a2d59462898d0a96b5b)|`Trac #29665: standard python spkg-configure.m4 for docutils.`|\n|[d4855dd](https://github.com/sagemath/sagetrac-mirror/commit/d4855ddcbaa40babb2ba048ab5ddcfb9c84836cb)|`Trac #29665: add Gentoo package information for nbclient.`|\n|[b02c3f5](https://github.com/sagemath/sagetrac-mirror/commit/b02c3f51370709e9c9e5e017da4255418c70417f)|`Trac #29665: standard python spkg-configure.m4 for nbclient.`|\n|[fab328d](https://github.com/sagemath/sagetrac-mirror/commit/fab328d286094bad407bb9c853863266d3611821)|`Trac #29665: add Gentoo package information for argon2_cffi.`|\n|[922473a](https://github.com/sagemath/sagetrac-mirror/commit/922473a9fa81db7664baa725b2db0ac745ce5f61)|`Trac #29665: standard python spkg-configure.m4 for argon2-cffi.`|",
    "created_at": "2021-11-10T18:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581621",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
|[08b201a](https://github.com/sagemath/sagetrac-mirror/commit/08b201a1078388b30560c9ba893ba97e1e2820ff)|`Trac #29665: set $SAGE_PIP_INSTALL_FLAGS for --enable-system-site-packages.`|
|[c2b80fb](https://github.com/sagemath/sagetrac-mirror/commit/c2b80fbaaea0809f17ea1c0ba55a51b3e3804e02)|`Trac #29665: pass $SAGE_PIP_INSTALL_FLAGS to sdh_pip_install.`|
|[f4c5839](https://github.com/sagemath/sagetrac-mirror/commit/f4c5839b2abea399a43bdbd80cf855230be5da2d)|`Trac #29665: add Gentoo package information for pexpect.`|
|[d5f4fc7](https://github.com/sagemath/sagetrac-mirror/commit/d5f4fc7549490b23293a0fbb7b7b899ccf53ecda)|`Trac #29665: standard python spkg-configure.m4 for pexpect.`|
|[0b860e8](https://github.com/sagemath/sagetrac-mirror/commit/0b860e8c0c34d43768b39c427fb596972afa84e5)|`Trac #29665: add Gentoo package information for docutils.`|
|[c2b54ff](https://github.com/sagemath/sagetrac-mirror/commit/c2b54ff516931c4ff7711a2d59462898d0a96b5b)|`Trac #29665: standard python spkg-configure.m4 for docutils.`|
|[d4855dd](https://github.com/sagemath/sagetrac-mirror/commit/d4855ddcbaa40babb2ba048ab5ddcfb9c84836cb)|`Trac #29665: add Gentoo package information for nbclient.`|
|[b02c3f5](https://github.com/sagemath/sagetrac-mirror/commit/b02c3f51370709e9c9e5e017da4255418c70417f)|`Trac #29665: standard python spkg-configure.m4 for nbclient.`|
|[fab328d](https://github.com/sagemath/sagetrac-mirror/commit/fab328d286094bad407bb9c853863266d3611821)|`Trac #29665: add Gentoo package information for argon2_cffi.`|
|[922473a](https://github.com/sagemath/sagetrac-mirror/commit/922473a9fa81db7664baa725b2db0ac745ce5f61)|`Trac #29665: standard python spkg-configure.m4 for argon2-cffi.`|



---

archive/issue_comments_581622.json:
```json
{
    "body": "<a id='comment:5'></a>\nAdding more and more packages (whatever is available on Gentoo) and things still look OK.\n\nWhen you get a second, can you double-check if this should be \"dateutil\" or \"python-dateutil\"?\n\n```\n$ cat build/pkgs/dateutil/install-requires.txt \ndateutil >=2.8.1\n```\n\ncf. https://github.com/dateutil/dateutil/blob/master/setup.cfg",
    "created_at": "2021-11-10T18:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581622",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:5'></a>
Adding more and more packages (whatever is available on Gentoo) and things still look OK.

When you get a second, can you double-check if this should be "dateutil" or "python-dateutil"?

```
$ cat build/pkgs/dateutil/install-requires.txt 
dateutil >=2.8.1
```

cf. https://github.com/dateutil/dateutil/blob/master/setup.cfg



---

archive/issue_comments_581623.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt should be **python-dateutil** (https://pypi.org/project/python-dateutil/), thanks for catching this.\n\nMany of these `install-requires.txt` file are only decoration at the moment; only the `install-requires.txt` files of those packages that are named in files like `src/setup.cfg.m4` are used.",
    "created_at": "2021-11-10T20:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581623",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
It should be **python-dateutil** (https://pypi.org/project/python-dateutil/), thanks for catching this.

Many of these `install-requires.txt` file are only decoration at the moment; only the `install-requires.txt` files of those packages that are named in files like `src/setup.cfg.m4` are used.



---

archive/issue_comments_581624.json:
```json
{
    "body": "Changing commit from \"922473a9fa81db7664baa725b2db0ac745ce5f61\" to \"96f235862c31cdd992c0ee5b69a5e8f476fbfe2e\"",
    "created_at": "2021-11-11T10:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581624",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "922473a9fa81db7664baa725b2db0ac745ce5f61" to "96f235862c31cdd992c0ee5b69a5e8f476fbfe2e"



---

archive/issue_comments_581625.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[560248c](https://github.com/sagemath/sagetrac-mirror/commit/560248c4802b0a8c1e8c3479a996a8738b65ef3b)|`Trac #29665: add Gentoo package information for sphinxcontrib_devhelp.`|\n|[b6e94e4](https://github.com/sagemath/sagetrac-mirror/commit/b6e94e4db38b694d790dcb4ce5fecd9fdb068c44)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_devhelp.`|\n|[96579a6](https://github.com/sagemath/sagetrac-mirror/commit/96579a6b7d29aeac03602a230e3af5006fffb1ae)|`Trac #29665: add Gentoo package information for sphinxcontrib_qthelp.`|\n|[4c09309](https://github.com/sagemath/sagetrac-mirror/commit/4c093096c3951c417eed5f20a09e5a75eb081efb)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_qthelp.`|\n|[ed7ffc1](https://github.com/sagemath/sagetrac-mirror/commit/ed7ffc1cc47b505e6fd15dc40929ee6cf64fee26)|`Trac #29665: add Gentoo package information for sphinxcontrib_applehelp.`|\n|[bd90c66](https://github.com/sagemath/sagetrac-mirror/commit/bd90c66e3549b5351ee14b852eecc25697ecc349)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_applehelp.`|\n|[1e860dc](https://github.com/sagemath/sagetrac-mirror/commit/1e860dcc3b529b2df64c0e6a79ce0a3f9ff1a8f3)|`Trac #29665: add Gentoo package information for sphinxcontrib_htmlhelp.`|\n|[2ad9ed4](https://github.com/sagemath/sagetrac-mirror/commit/2ad9ed4355fccb8436e01980fab9a23ec9ad87c8)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_htmlhelp.`|\n|[c1c6e1e](https://github.com/sagemath/sagetrac-mirror/commit/c1c6e1e80fda3d242726f3faa8db6c10988f6f9e)|`Trac #29665: add Gentoo package information for jupyterlab_pygments.`|\n|[96f2358](https://github.com/sagemath/sagetrac-mirror/commit/96f235862c31cdd992c0ee5b69a5e8f476fbfe2e)|`Trac #29665: standard python spkg-configure.m4 for jupyterlab_pygments.`|",
    "created_at": "2021-11-11T10:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581625",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[560248c](https://github.com/sagemath/sagetrac-mirror/commit/560248c4802b0a8c1e8c3479a996a8738b65ef3b)|`Trac #29665: add Gentoo package information for sphinxcontrib_devhelp.`|
|[b6e94e4](https://github.com/sagemath/sagetrac-mirror/commit/b6e94e4db38b694d790dcb4ce5fecd9fdb068c44)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_devhelp.`|
|[96579a6](https://github.com/sagemath/sagetrac-mirror/commit/96579a6b7d29aeac03602a230e3af5006fffb1ae)|`Trac #29665: add Gentoo package information for sphinxcontrib_qthelp.`|
|[4c09309](https://github.com/sagemath/sagetrac-mirror/commit/4c093096c3951c417eed5f20a09e5a75eb081efb)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_qthelp.`|
|[ed7ffc1](https://github.com/sagemath/sagetrac-mirror/commit/ed7ffc1cc47b505e6fd15dc40929ee6cf64fee26)|`Trac #29665: add Gentoo package information for sphinxcontrib_applehelp.`|
|[bd90c66](https://github.com/sagemath/sagetrac-mirror/commit/bd90c66e3549b5351ee14b852eecc25697ecc349)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_applehelp.`|
|[1e860dc](https://github.com/sagemath/sagetrac-mirror/commit/1e860dcc3b529b2df64c0e6a79ce0a3f9ff1a8f3)|`Trac #29665: add Gentoo package information for sphinxcontrib_htmlhelp.`|
|[2ad9ed4](https://github.com/sagemath/sagetrac-mirror/commit/2ad9ed4355fccb8436e01980fab9a23ec9ad87c8)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_htmlhelp.`|
|[c1c6e1e](https://github.com/sagemath/sagetrac-mirror/commit/c1c6e1e80fda3d242726f3faa8db6c10988f6f9e)|`Trac #29665: add Gentoo package information for jupyterlab_pygments.`|
|[96f2358](https://github.com/sagemath/sagetrac-mirror/commit/96f235862c31cdd992c0ee5b69a5e8f476fbfe2e)|`Trac #29665: standard python spkg-configure.m4 for jupyterlab_pygments.`|



---

archive/issue_comments_581626.json:
```json
{
    "body": "<a id='comment:8'></a>\nI haven't been able to test ptyprocess yet due to a version mismatch on Gentoo, and importllib_resources will need some subsequent work (it's built-in to python >= 3.9, but the existing check will save you a pointless pip install if you happen to be running an older python). And I've avoided anything with patches for now.\n\nOtherwise, I think it's good.",
    "created_at": "2021-11-11T11:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581626",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>
I haven't been able to test ptyprocess yet due to a version mismatch on Gentoo, and importllib_resources will need some subsequent work (it's built-in to python >= 3.9, but the existing check will save you a pointless pip install if you happen to be running an older python). And I've avoided anything with patches for now.

Otherwise, I think it's good.



---

archive/issue_comments_581627.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe test suite still passes with all of those packages installed on the system.\n\nI did discover one more problem that we'll need to be aware of in the future. A lot of python packages have \"automagic\" dependencies that get used if they're available at runtime, rather than detected/configured at build-time. With python-3.9, for example, having an old version of ipyparallel installed will cause ipykernel to throw a deprecation warning that fails a doctest in `repl/ipython_kernel/kernel.py`.\n\nWe could try to address all of those (as they're reported) in `spkg-configure.m4`. Something like,\n\n```\nAC_DEFUN([SAGE_PYTHON_RUN_IFELSE], [dnl\ncat >conftest.py <<SAGE__EOF\n$1\nSAGE__EOF\nAS_IF([\"${PYTHON_FOR_VENV}\" conftest.py 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD],[$2],[$3])\n])\n```\n\ncan be used to detect serious problems that are amenable to such a test. But for cosmetic issues like deprecation warnings I think we're better off just hiding them from the test suite. Or letting them fail (what's the point of the test suite?). Regardless, we can only ever hope to address the problems that exist when sage is being built. If I build sage and *then* install the old ipyparallel, there's nothing sage can do to stop me. That's not really a new problem of course, but it will show up more often with python packages than with C packages due to the prevalence of automagic features in python.",
    "created_at": "2021-11-12T12:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581627",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:9'></a>
The test suite still passes with all of those packages installed on the system.

I did discover one more problem that we'll need to be aware of in the future. A lot of python packages have "automagic" dependencies that get used if they're available at runtime, rather than detected/configured at build-time. With python-3.9, for example, having an old version of ipyparallel installed will cause ipykernel to throw a deprecation warning that fails a doctest in `repl/ipython_kernel/kernel.py`.

We could try to address all of those (as they're reported) in `spkg-configure.m4`. Something like,

```
AC_DEFUN([SAGE_PYTHON_RUN_IFELSE], [dnl
cat >conftest.py <<SAGE__EOF
$1
SAGE__EOF
AS_IF(["${PYTHON_FOR_VENV}" conftest.py 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD],[$2],[$3])
])
```

can be used to detect serious problems that are amenable to such a test. But for cosmetic issues like deprecation warnings I think we're better off just hiding them from the test suite. Or letting them fail (what's the point of the test suite?). Regardless, we can only ever hope to address the problems that exist when sage is being built. If I build sage and *then* install the old ipyparallel, there's nothing sage can do to stop me. That's not really a new problem of course, but it will show up more often with python packages than with C packages due to the prevalence of automagic features in python.



---

archive/issue_comments_581628.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-12T12:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581628",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_581629.json:
```json
{
    "body": "<a id='comment:110'></a>\nReplying to [mjo](#comment%3A109):\n> A lot of python packages have \"automagic\" dependencies that get used if they're available at runtime, rather than detected/configured at build-time. \n\n\nYes, this is normal - with PEP 517/518, the build environment is separate from the runtime environment.",
    "created_at": "2021-11-12T18:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581629",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:110'></a>
Replying to [mjo](#comment%3A109):
> A lot of python packages have "automagic" dependencies that get used if they're available at runtime, rather than detected/configured at build-time. 


Yes, this is normal - with PEP 517/518, the build environment is separate from the runtime environment.



---

archive/issue_comments_581630.json:
```json
{
    "body": "<a id='comment:111'></a>\nBroken \"plugins\" break things, I don't think there's a need to do anything about it.",
    "created_at": "2021-11-12T18:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581630",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:111'></a>
Broken "plugins" break things, I don't think there's a need to do anything about it.



---

archive/issue_comments_581631.json:
```json
{
    "body": "<a id='comment:112'></a>\nReplying to [mjo](#comment%3A108):\n> I haven't been able to test ptyprocess yet due to a version mismatch on Gentoo\n\n\nFor `ptyprocess`, see #32147",
    "created_at": "2021-11-12T18:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581631",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:112'></a>
Replying to [mjo](#comment%3A108):
> I haven't been able to test ptyprocess yet due to a version mismatch on Gentoo


For `ptyprocess`, see #32147



---

archive/issue_comments_581632.json:
```json
{
    "body": "<a id='comment:3'></a>\nrebase please",
    "created_at": "2021-11-17T16:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581632",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
rebase please



---

archive/issue_comments_581633.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[3800e82](https://github.com/sagemath/sagetrac-mirror/commit/3800e825f933972abb00add39ae8f7ecb2186a1f)|`Trac #29665: add Gentoo package information for sphinxcontrib_devhelp.`|\n|[913b909](https://github.com/sagemath/sagetrac-mirror/commit/913b9093cd0be905c68e68b29ccfbb467364211b)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_devhelp.`|\n|[4bae2be](https://github.com/sagemath/sagetrac-mirror/commit/4bae2beb8901203dab4bd55e1368b36b5a25cb4d)|`Trac #29665: add Gentoo package information for sphinxcontrib_qthelp.`|\n|[e562430](https://github.com/sagemath/sagetrac-mirror/commit/e562430aee777c2803f8b8d24d6dc0d3f5e47a70)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_qthelp.`|\n|[4fa9bc6](https://github.com/sagemath/sagetrac-mirror/commit/4fa9bc6a75af8f5a6cf8039812ed119dda12c6f8)|`Trac #29665: add Gentoo package information for sphinxcontrib_applehelp.`|\n|[2345c47](https://github.com/sagemath/sagetrac-mirror/commit/2345c47729fe2ea96be56f2add6ecf40cb0c9f65)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_applehelp.`|\n|[32fd382](https://github.com/sagemath/sagetrac-mirror/commit/32fd3829d6dae9dbc3870695e5e3d3d8b64a1e7f)|`Trac #29665: add Gentoo package information for sphinxcontrib_htmlhelp.`|\n|[81c1e32](https://github.com/sagemath/sagetrac-mirror/commit/81c1e32b8b3d1d3f54e2ddac5a3a3ac8efa1521c)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_htmlhelp.`|\n|[17e378e](https://github.com/sagemath/sagetrac-mirror/commit/17e378ef77c1420cbb1610555543134a9b81e6d4)|`Trac #29665: add Gentoo package information for jupyterlab_pygments.`|\n|[bf94d3c](https://github.com/sagemath/sagetrac-mirror/commit/bf94d3cd3dd80195f4a167591cdb79de80333091)|`Trac #29665: standard python spkg-configure.m4 for jupyterlab_pygments.`|",
    "created_at": "2021-11-17T21:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581633",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[3800e82](https://github.com/sagemath/sagetrac-mirror/commit/3800e825f933972abb00add39ae8f7ecb2186a1f)|`Trac #29665: add Gentoo package information for sphinxcontrib_devhelp.`|
|[913b909](https://github.com/sagemath/sagetrac-mirror/commit/913b9093cd0be905c68e68b29ccfbb467364211b)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_devhelp.`|
|[4bae2be](https://github.com/sagemath/sagetrac-mirror/commit/4bae2beb8901203dab4bd55e1368b36b5a25cb4d)|`Trac #29665: add Gentoo package information for sphinxcontrib_qthelp.`|
|[e562430](https://github.com/sagemath/sagetrac-mirror/commit/e562430aee777c2803f8b8d24d6dc0d3f5e47a70)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_qthelp.`|
|[4fa9bc6](https://github.com/sagemath/sagetrac-mirror/commit/4fa9bc6a75af8f5a6cf8039812ed119dda12c6f8)|`Trac #29665: add Gentoo package information for sphinxcontrib_applehelp.`|
|[2345c47](https://github.com/sagemath/sagetrac-mirror/commit/2345c47729fe2ea96be56f2add6ecf40cb0c9f65)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_applehelp.`|
|[32fd382](https://github.com/sagemath/sagetrac-mirror/commit/32fd3829d6dae9dbc3870695e5e3d3d8b64a1e7f)|`Trac #29665: add Gentoo package information for sphinxcontrib_htmlhelp.`|
|[81c1e32](https://github.com/sagemath/sagetrac-mirror/commit/81c1e32b8b3d1d3f54e2ddac5a3a3ac8efa1521c)|`Trac #29665: standard python spkg-configure.m4 for sphinxcontrib_htmlhelp.`|
|[17e378e](https://github.com/sagemath/sagetrac-mirror/commit/17e378ef77c1420cbb1610555543134a9b81e6d4)|`Trac #29665: add Gentoo package information for jupyterlab_pygments.`|
|[bf94d3c](https://github.com/sagemath/sagetrac-mirror/commit/bf94d3cd3dd80195f4a167591cdb79de80333091)|`Trac #29665: standard python spkg-configure.m4 for jupyterlab_pygments.`|



---

archive/issue_comments_581634.json:
```json
{
    "body": "Changing commit from \"96f235862c31cdd992c0ee5b69a5e8f476fbfe2e\" to \"bf94d3cd3dd80195f4a167591cdb79de80333091\"",
    "created_at": "2021-11-17T21:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581634",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "96f235862c31cdd992c0ee5b69a5e8f476fbfe2e" to "bf94d3cd3dd80195f4a167591cdb79de80333091"



---

archive/issue_comments_581635.json:
```json
{
    "body": "<a id='comment:115'></a>\nReplying to [dimpase](#comment%3A113):\n> rebase please\n\n\nI'd love to know why these branches are going red... this one rebased cleanly just like #32037 did.",
    "created_at": "2021-11-17T21:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581635",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:115'></a>
Replying to [dimpase](#comment%3A113):
> rebase please


I'd love to know why these branches are going red... this one rebased cleanly just like #32037 did.



---

archive/issue_comments_581636.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#32703\"",
    "created_at": "2021-12-19T03:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581636",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#32703"



---

archive/issue_comments_581637.json:
```json
{
    "body": "Changing branch from \"u/mjo/ticket/29665\" to \"u/mkoeppe/ticket/29665\"",
    "created_at": "2021-12-19T03:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581637",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/mjo/ticket/29665" to "u/mkoeppe/ticket/29665"



---

archive/issue_comments_581638.json:
```json
{
    "body": "Changing dependencies from \"#32703\" to \"#32703, #33067\"",
    "created_at": "2021-12-22T19:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581638",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#32703" to "#32703, #33067"



---

archive/issue_comments_581639.json:
```json
{
    "body": "<a id='comment:8'></a>\nLast 10 new commits:\n|                                                                                                                                          |                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[afbd4fa](https://github.com/sagemath/sagetrac-mirror/commit/afbd4fa337fa7560267ea3b7f43f62634a6ed01d)|`github/workflows/tox.yml: Multi-stage local-macos`|\n|[57884a6](https://github.com/sagemath/sagetrac-mirror/commit/57884a631c5b092e08613e470e0f1cb4b515a465)|`.github/workflows/tox.yml [local-macos]: Run optional packages here`|\n|[49276f2](https://github.com/sagemath/sagetrac-mirror/commit/49276f2ef14cdfc6d6b338e5997e5f615fcaea0b)|`.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh`|\n|[c3e2467](https://github.com/sagemath/sagetrac-mirror/commit/c3e246781cc3063a15d9ed4db6bcd8954054ce8b)|`.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too`|\n|[55c83f5](https://github.com/sagemath/sagetrac-mirror/commit/55c83f519717daf027fec961a7f066ccf59146bd)|`.github/workflows/tox.yml [local-macos]: Run experimental packages here`|\n|[10de67a](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)|`.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal`|\n|[8617b6f](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)|`.github/workflows/tox.yml: Reduce/streamline macos environments`|\n|[2b5c97f](https://github.com/sagemath/sagetrac-mirror/commit/2b5c97fcf2a434b0e08a34c4332f32bd9c19fc5b)|`Merge #32703`|\n|[1d65ec5](https://github.com/sagemath/sagetrac-mirror/commit/1d65ec5903169ee2f17c2496ad708801b9395cc2)|`.github/workflows/tox.yml: Test with --enable-system-site-packages`|\n|[29e1e83](https://github.com/sagemath/sagetrac-mirror/commit/29e1e836d62cc14f04c9deb84932e3e5d7114827)|`.github/workflows/tox.yml: In enable-site build, remove old pyvenv.cfg first`|",
    "created_at": "2021-12-22T19:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581639",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Last 10 new commits:
|                                                                                                                                          |                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[afbd4fa](https://github.com/sagemath/sagetrac-mirror/commit/afbd4fa337fa7560267ea3b7f43f62634a6ed01d)|`github/workflows/tox.yml: Multi-stage local-macos`|
|[57884a6](https://github.com/sagemath/sagetrac-mirror/commit/57884a631c5b092e08613e470e0f1cb4b515a465)|`.github/workflows/tox.yml [local-macos]: Run optional packages here`|
|[49276f2](https://github.com/sagemath/sagetrac-mirror/commit/49276f2ef14cdfc6d6b338e5997e5f615fcaea0b)|`.github/workflows/tox.yml: Pass SAGE_LOCAL to extract-sage-local.sh`|
|[c3e2467](https://github.com/sagemath/sagetrac-mirror/commit/c3e246781cc3063a15d9ed4db6bcd8954054ce8b)|`.github/workflows/extract-sage-local.sh: Use short option with touch so it works on macOS; handle var/lib/sage/venv* too`|
|[55c83f5](https://github.com/sagemath/sagetrac-mirror/commit/55c83f519717daf027fec961a7f066ccf59146bd)|`.github/workflows/tox.yml [local-macos]: Run experimental packages here`|
|[10de67a](https://github.com/sagemath/sagetrac-mirror/commit/10de67a6f92ffe6bb7a19c61a5180b86a9cbd481)|`.github/workflows/tox.yml [local-macos]: Add tox_packages_factor=maximal`|
|[8617b6f](https://github.com/sagemath/sagetrac-mirror/commit/8617b6f7ab260bf528bc486dffcc4dab51222d12)|`.github/workflows/tox.yml: Reduce/streamline macos environments`|
|[2b5c97f](https://github.com/sagemath/sagetrac-mirror/commit/2b5c97fcf2a434b0e08a34c4332f32bd9c19fc5b)|`Merge #32703`|
|[1d65ec5](https://github.com/sagemath/sagetrac-mirror/commit/1d65ec5903169ee2f17c2496ad708801b9395cc2)|`.github/workflows/tox.yml: Test with --enable-system-site-packages`|
|[29e1e83](https://github.com/sagemath/sagetrac-mirror/commit/29e1e836d62cc14f04c9deb84932e3e5d7114827)|`.github/workflows/tox.yml: In enable-site build, remove old pyvenv.cfg first`|



---

archive/issue_comments_581640.json:
```json
{
    "body": "Changing commit from \"bf94d3cd3dd80195f4a167591cdb79de80333091\" to \"29e1e836d62cc14f04c9deb84932e3e5d7114827\"",
    "created_at": "2021-12-22T19:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581640",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "bf94d3cd3dd80195f4a167591cdb79de80333091" to "29e1e836d62cc14f04c9deb84932e3e5d7114827"



---

archive/issue_comments_581641.json:
```json
{
    "body": "Changing commit from \"29e1e836d62cc14f04c9deb84932e3e5d7114827\" to \"f44d45f9405860030bfbbe5fa30135d88dd8abc0\"",
    "created_at": "2021-12-22T19:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581641",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "29e1e836d62cc14f04c9deb84932e3e5d7114827" to "f44d45f9405860030bfbbe5fa30135d88dd8abc0"



---

archive/issue_comments_581642.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[02505ca](https://github.com/sagemath/sagetrac-mirror/commit/02505ca6d353e44253f8e461055fe1f2ca6bb995)|`pkgs/sage-conf_pypi/MANIFEST.in: Update from #31396`|\n|[aeca1a0](https://github.com/sagemath/sagetrac-mirror/commit/aeca1a03015f27b74c6641cb7bbcdd9c5e82bf16)|`Makefile (pypi-sdists): Add sage_setup`|\n|[cd3dce9](https://github.com/sagemath/sagetrac-mirror/commit/cd3dce9e076ba81febc4e8f838e1b5ca03b12459)|`pkgs/sage-conf_pypi/setup.py: Update directory of configured sage_conf.py`|\n|[c695921](https://github.com/sagemath/sagetrac-mirror/commit/c695921c3cee61a32a8d7ec9443bb4e315eb481b)|`pkgs/sage-conf/sage_conf.py.in (SAGE_SPKG_WHEELS): Update so it works if SAGE_VENV != SAGE_LOCAL`|\n|[cebcda3](https://github.com/sagemath/sagetrac-mirror/commit/cebcda3fa7e1ae0ecd0e7cbf1a0aba15bed1a010)|`Merge tag '9.5.beta4' into t/29039/pip_installable_package_sage_bootstrap`|\n|[0026892](https://github.com/sagemath/sagetrac-mirror/commit/0026892c983828c7925626d2bc9165967f0bebe5)|`Merge tag '9.5.beta5' into t/29039/pip_installable_package_sage_bootstrap`|\n|[2a4a323](https://github.com/sagemath/sagetrac-mirror/commit/2a4a32384133408ef05edb4f40b9d363697d3087)|`Merge tag '9.5.beta7' into t/29039/pip_installable_package_sage_bootstrap`|\n|[02234ce](https://github.com/sagemath/sagetrac-mirror/commit/02234ce0b51908c0dfa233da5942721428fe9f9b)|`Merge #29039`|\n|[b1413d4](https://github.com/sagemath/sagetrac-mirror/commit/b1413d45fe041d7e4b017961d8b273b2a97ddb18)|`build/bin/write-dockerfile.sh: Move 'ADD pkgs' earlier`|\n|[f44d45f](https://github.com/sagemath/sagetrac-mirror/commit/f44d45f9405860030bfbbe5fa30135d88dd8abc0)|`Merge #33067`|",
    "created_at": "2021-12-22T19:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581642",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[02505ca](https://github.com/sagemath/sagetrac-mirror/commit/02505ca6d353e44253f8e461055fe1f2ca6bb995)|`pkgs/sage-conf_pypi/MANIFEST.in: Update from #31396`|
|[aeca1a0](https://github.com/sagemath/sagetrac-mirror/commit/aeca1a03015f27b74c6641cb7bbcdd9c5e82bf16)|`Makefile (pypi-sdists): Add sage_setup`|
|[cd3dce9](https://github.com/sagemath/sagetrac-mirror/commit/cd3dce9e076ba81febc4e8f838e1b5ca03b12459)|`pkgs/sage-conf_pypi/setup.py: Update directory of configured sage_conf.py`|
|[c695921](https://github.com/sagemath/sagetrac-mirror/commit/c695921c3cee61a32a8d7ec9443bb4e315eb481b)|`pkgs/sage-conf/sage_conf.py.in (SAGE_SPKG_WHEELS): Update so it works if SAGE_VENV != SAGE_LOCAL`|
|[cebcda3](https://github.com/sagemath/sagetrac-mirror/commit/cebcda3fa7e1ae0ecd0e7cbf1a0aba15bed1a010)|`Merge tag '9.5.beta4' into t/29039/pip_installable_package_sage_bootstrap`|
|[0026892](https://github.com/sagemath/sagetrac-mirror/commit/0026892c983828c7925626d2bc9165967f0bebe5)|`Merge tag '9.5.beta5' into t/29039/pip_installable_package_sage_bootstrap`|
|[2a4a323](https://github.com/sagemath/sagetrac-mirror/commit/2a4a32384133408ef05edb4f40b9d363697d3087)|`Merge tag '9.5.beta7' into t/29039/pip_installable_package_sage_bootstrap`|
|[02234ce](https://github.com/sagemath/sagetrac-mirror/commit/02234ce0b51908c0dfa233da5942721428fe9f9b)|`Merge #29039`|
|[b1413d4](https://github.com/sagemath/sagetrac-mirror/commit/b1413d45fe041d7e4b017961d8b273b2a97ddb18)|`build/bin/write-dockerfile.sh: Move 'ADD pkgs' earlier`|
|[f44d45f](https://github.com/sagemath/sagetrac-mirror/commit/f44d45f9405860030bfbbe5fa30135d88dd8abc0)|`Merge #33067`|



---

archive/issue_comments_581643.json:
```json
{
    "body": "Changing commit from \"f44d45f9405860030bfbbe5fa30135d88dd8abc0\" to \"72fddad4a8f7e3379b2e7aaa597cd552cb273026\"",
    "created_at": "2021-12-22T20:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581643",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f44d45f9405860030bfbbe5fa30135d88dd8abc0" to "72fddad4a8f7e3379b2e7aaa597cd552cb273026"



---

archive/issue_comments_581644.json:
```json
{
    "body": "<a id='comment:0'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[859be3e](https://github.com/sagemath/sagetrac-mirror/commit/859be3ef9e3293f63fb18d8ac2a87e16f6f2114c)|`build/bin/write-dockerfile.sh: ADD src/*.m4 files for bootstrapping`|\n|[72fddad](https://github.com/sagemath/sagetrac-mirror/commit/72fddad4a8f7e3379b2e7aaa597cd552cb273026)|`Merge #33067`|",
    "created_at": "2021-12-22T20:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581644",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[859be3e](https://github.com/sagemath/sagetrac-mirror/commit/859be3ef9e3293f63fb18d8ac2a87e16f6f2114c)|`build/bin/write-dockerfile.sh: ADD src/*.m4 files for bootstrapping`|
|[72fddad](https://github.com/sagemath/sagetrac-mirror/commit/72fddad4a8f7e3379b2e7aaa597cd552cb273026)|`Merge #33067`|



---

archive/issue_comments_581645.json:
```json
{
    "body": "<a id='comment:1'></a>\nA few fixes in package names in `spkg-configure.m4`:\n\n```\ndiff --git a/build/pkgs/argon2_cffi/spkg-configure.m4 b/build/pkgs/argon2_cffi/spkg-configure.m4\nindex 9ae7f2ea0c..ff476db0b2 100644\n--- a/build/pkgs/argon2_cffi/spkg-configure.m4\n+++ b/build/pkgs/argon2_cffi/spkg-configure.m4\n@@ -1 +1 @@\n-SAGE_SPKG_CONFIGURE([argon2-cffi], [SAGE_PYTHON_PACKAGE_CHECK([argon2-cffi])])\n+SAGE_SPKG_CONFIGURE([argon2_cffi], [SAGE_PYTHON_PACKAGE_CHECK([argon2-cffi])])\ndiff --git a/build/pkgs/jupyter_client/spkg-configure.m4 b/build/pkgs/jupyter_client/spkg-configure.m4\nindex 3c9bb26bb0..1d2735de59 100644\n--- a/build/pkgs/jupyter_client/spkg-configure.m4\n+++ b/build/pkgs/jupyter_client/spkg-configure.m4\n@@ -1 +1 @@\n-SAGE_SPKG_CONFIGURE([bleach], [SAGE_PYTHON_PACKAGE_CHECK([bleach])])\n+SAGE_SPKG_CONFIGURE([jupyter_client], [SAGE_PYTHON_PACKAGE_CHECK([jupyter_client])])\ndiff --git a/build/pkgs/matplotlib_inline/spkg-configure.m4 b/build/pkgs/matplotlib_inline/spkg-configure.m4\nindex 3af724d674..f72fef4802 100644\n--- a/build/pkgs/matplotlib_inline/spkg-configure.m4\n+++ b/build/pkgs/matplotlib_inline/spkg-configure.m4\n@@ -1,3 +1,3 @@\n-SAGE_SPKG_CONFIGURE([matplotlib-inline], [\n+SAGE_SPKG_CONFIGURE([matplotlib_inline], [\n   SAGE_PYTHON_PACKAGE_CHECK([matplotlib-inline])\n ])\n```\n\nEdit: small fix.",
    "created_at": "2021-12-30T22:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581645",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:1'></a>
A few fixes in package names in `spkg-configure.m4`:

```
diff --git a/build/pkgs/argon2_cffi/spkg-configure.m4 b/build/pkgs/argon2_cffi/spkg-configure.m4
index 9ae7f2ea0c..ff476db0b2 100644
--- a/build/pkgs/argon2_cffi/spkg-configure.m4
+++ b/build/pkgs/argon2_cffi/spkg-configure.m4
@@ -1 +1 @@
-SAGE_SPKG_CONFIGURE([argon2-cffi], [SAGE_PYTHON_PACKAGE_CHECK([argon2-cffi])])
+SAGE_SPKG_CONFIGURE([argon2_cffi], [SAGE_PYTHON_PACKAGE_CHECK([argon2-cffi])])
diff --git a/build/pkgs/jupyter_client/spkg-configure.m4 b/build/pkgs/jupyter_client/spkg-configure.m4
index 3c9bb26bb0..1d2735de59 100644
--- a/build/pkgs/jupyter_client/spkg-configure.m4
+++ b/build/pkgs/jupyter_client/spkg-configure.m4
@@ -1 +1 @@
-SAGE_SPKG_CONFIGURE([bleach], [SAGE_PYTHON_PACKAGE_CHECK([bleach])])
+SAGE_SPKG_CONFIGURE([jupyter_client], [SAGE_PYTHON_PACKAGE_CHECK([jupyter_client])])
diff --git a/build/pkgs/matplotlib_inline/spkg-configure.m4 b/build/pkgs/matplotlib_inline/spkg-configure.m4
index 3af724d674..f72fef4802 100644
--- a/build/pkgs/matplotlib_inline/spkg-configure.m4
+++ b/build/pkgs/matplotlib_inline/spkg-configure.m4
@@ -1,3 +1,3 @@
-SAGE_SPKG_CONFIGURE([matplotlib-inline], [
+SAGE_SPKG_CONFIGURE([matplotlib_inline], [
   SAGE_PYTHON_PACKAGE_CHECK([matplotlib-inline])
 ])
```

Edit: small fix.



---

archive/issue_comments_581646.json:
```json
{
    "body": "<a id='comment:2'></a>\nA few more standard packages:\n\n```\ndiff --git a/build/pkgs/alabaster/spkg-configure.m4 b/build/pkgs/alabaster/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..4eca6e05a5\n--- /dev/null\n+++ b/build/pkgs/alabaster/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([alabaster], [SAGE_PYTHON_PACKAGE_CHECK([alabaster])])\ndiff --git a/build/pkgs/beniget/spkg-configure.m4 b/build/pkgs/beniget/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..8ae6101333\n--- /dev/null\n+++ b/build/pkgs/beniget/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([beniget], [SAGE_PYTHON_PACKAGE_CHECK([beniget])])\ndiff --git a/build/pkgs/gast/spkg-configure.m4 b/build/pkgs/gast/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..26ec59feae\n--- /dev/null\n+++ b/build/pkgs/gast/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([gast], [SAGE_PYTHON_PACKAGE_CHECK([gast])])\ndiff --git a/build/pkgs/gmpy2/spkg-configure.m4 b/build/pkgs/gmpy2/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..2d0390f7db\n--- /dev/null\n+++ b/build/pkgs/gmpy2/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([gmpy2], [SAGE_PYTHON_PACKAGE_CHECK([gmpy2])])\ndiff --git a/build/pkgs/importlib_metadata/spkg-configure.m4 b/build/pkgs/importlib_metadata/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..d940b101b8\n--- /dev/null\n+++ b/build/pkgs/importlib_metadata/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([importlib_metadata], [SAGE_PYTHON_PACKAGE_CHECK([importlib_metadata])])\ndiff --git a/build/pkgs/ply/spkg-configure.m4 b/build/pkgs/ply/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..ffb0030d01\n--- /dev/null\n+++ b/build/pkgs/ply/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([ply], [SAGE_PYTHON_PACKAGE_CHECK([ply])])\ndiff --git a/build/pkgs/pythran/spkg-configure.m4 b/build/pkgs/pythran/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..592e95bcb3\n--- /dev/null\n+++ b/build/pkgs/pythran/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([pythran], [SAGE_PYTHON_PACKAGE_CHECK([pythran])])\ndiff --git a/build/pkgs/typing_extensions/spkg-configure.m4 b/build/pkgs/typing_extensions/spkg-configure.m4\nnew file mode 100644\nindex 0000000000..d475fd8257\n--- /dev/null\n+++ b/build/pkgs/typing_extensions/spkg-configure.m4\n@@ -0,0 +1 @@\n+SAGE_SPKG_CONFIGURE([typing_extensions], [SAGE_PYTHON_PACKAGE_CHECK([typing_extensions])])\n```\n\nThere's also `cython` but it uses some patches so my system package, at the same version, doesn't work. The rest seems ok.",
    "created_at": "2021-12-30T23:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581646",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:2'></a>
A few more standard packages:

```
diff --git a/build/pkgs/alabaster/spkg-configure.m4 b/build/pkgs/alabaster/spkg-configure.m4
new file mode 100644
index 0000000000..4eca6e05a5
--- /dev/null
+++ b/build/pkgs/alabaster/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([alabaster], [SAGE_PYTHON_PACKAGE_CHECK([alabaster])])
diff --git a/build/pkgs/beniget/spkg-configure.m4 b/build/pkgs/beniget/spkg-configure.m4
new file mode 100644
index 0000000000..8ae6101333
--- /dev/null
+++ b/build/pkgs/beniget/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([beniget], [SAGE_PYTHON_PACKAGE_CHECK([beniget])])
diff --git a/build/pkgs/gast/spkg-configure.m4 b/build/pkgs/gast/spkg-configure.m4
new file mode 100644
index 0000000000..26ec59feae
--- /dev/null
+++ b/build/pkgs/gast/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([gast], [SAGE_PYTHON_PACKAGE_CHECK([gast])])
diff --git a/build/pkgs/gmpy2/spkg-configure.m4 b/build/pkgs/gmpy2/spkg-configure.m4
new file mode 100644
index 0000000000..2d0390f7db
--- /dev/null
+++ b/build/pkgs/gmpy2/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([gmpy2], [SAGE_PYTHON_PACKAGE_CHECK([gmpy2])])
diff --git a/build/pkgs/importlib_metadata/spkg-configure.m4 b/build/pkgs/importlib_metadata/spkg-configure.m4
new file mode 100644
index 0000000000..d940b101b8
--- /dev/null
+++ b/build/pkgs/importlib_metadata/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([importlib_metadata], [SAGE_PYTHON_PACKAGE_CHECK([importlib_metadata])])
diff --git a/build/pkgs/ply/spkg-configure.m4 b/build/pkgs/ply/spkg-configure.m4
new file mode 100644
index 0000000000..ffb0030d01
--- /dev/null
+++ b/build/pkgs/ply/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([ply], [SAGE_PYTHON_PACKAGE_CHECK([ply])])
diff --git a/build/pkgs/pythran/spkg-configure.m4 b/build/pkgs/pythran/spkg-configure.m4
new file mode 100644
index 0000000000..592e95bcb3
--- /dev/null
+++ b/build/pkgs/pythran/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([pythran], [SAGE_PYTHON_PACKAGE_CHECK([pythran])])
diff --git a/build/pkgs/typing_extensions/spkg-configure.m4 b/build/pkgs/typing_extensions/spkg-configure.m4
new file mode 100644
index 0000000000..d475fd8257
--- /dev/null
+++ b/build/pkgs/typing_extensions/spkg-configure.m4
@@ -0,0 +1 @@
+SAGE_SPKG_CONFIGURE([typing_extensions], [SAGE_PYTHON_PACKAGE_CHECK([typing_extensions])])
```

There's also `cython` but it uses some patches so my system package, at the same version, doesn't work. The rest seems ok.



---

archive/issue_comments_581647.json:
```json
{
    "body": "<a id='comment:3'></a>\nI should mention that I'm using a patch created from branch `u/mjo/ticket/29665` rather than the whole thing to make it more manageable for me. I hope I'm not missing anything important.\n\nI'll let you know if anything goes wrong with doctesting. I'm now building using all possible system packages and python site packages available on void.",
    "created_at": "2021-12-30T23:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581647",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:3'></a>
I should mention that I'm using a patch created from branch `u/mjo/ticket/29665` rather than the whole thing to make it more manageable for me. I hope I'm not missing anything important.

I'll let you know if anything goes wrong with doctesting. I'm now building using all possible system packages and python site packages available on void.



---

archive/issue_comments_581648.json:
```json
{
    "body": "<a id='comment:4'></a>\nEverything passes with the following patch which is neecessary if `alabaster` is used from system.\n\n```\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex 84f3d50de7..c7ad206959 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -386,9 +386,9 @@ def installed_packages(exclude_pip=True):\n     EXAMPLES::\n \n         sage: sorted(installed_packages().keys())  # optional - build\n-        [...'alabaster', ...'sage_conf', ...]\n-        sage: installed_packages()['alabaster']  # optional - build, random\n-        '0.7.12'\n+        [...'sage_conf', ...]\n+        sage: installed_packages()['sage_conf']  # optional - build, random\n+        '9.5'\n \n     .. SEEALSO::\n \n```",
    "created_at": "2021-12-31T02:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581648",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:4'></a>
Everything passes with the following patch which is neecessary if `alabaster` is used from system.

```
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index 84f3d50de7..c7ad206959 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -386,9 +386,9 @@ def installed_packages(exclude_pip=True):
     EXAMPLES::
 
         sage: sorted(installed_packages().keys())  # optional - build
-        [...'alabaster', ...'sage_conf', ...]
-        sage: installed_packages()['alabaster']  # optional - build, random
-        '0.7.12'
+        [...'sage_conf', ...]
+        sage: installed_packages()['sage_conf']  # optional - build, random
+        '9.5'
 
     .. SEEALSO::
 
```



---

archive/issue_comments_581649.json:
```json
{
    "body": "Changing commit from \"72fddad4a8f7e3379b2e7aaa597cd552cb273026\" to \"135f184f7498a2046065e669723e68efe2d65cee\"",
    "created_at": "2021-12-31T02:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581649",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "72fddad4a8f7e3379b2e7aaa597cd552cb273026" to "135f184f7498a2046065e669723e68efe2d65cee"



---

archive/issue_comments_581650.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/ticket/29665\" to \"u/mjo/ticket/29665\"",
    "created_at": "2021-12-31T02:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581650",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "u/mkoeppe/ticket/29665" to "u/mjo/ticket/29665"



---

archive/issue_comments_581651.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks, I fixed the existing packages and added most of the new ones. I've left out `gmpy2` and `typing_extensions` because they aren't available in Gentoo yet (chicken and egg problem) so I'm unable to test them easily. I also added your alabaster doctest fix.\n\nI'm not sure if there were any new commits on Matthias's branch (it's impossible to tell when merge commits are involved), or if his dependencies are only intended to make this easier to test. In any case, I've switched it back to my branch which works fine in real life if not on github.",
    "created_at": "2021-12-31T02:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581651",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:5'></a>
Thanks, I fixed the existing packages and added most of the new ones. I've left out `gmpy2` and `typing_extensions` because they aren't available in Gentoo yet (chicken and egg problem) so I'm unable to test them easily. I also added your alabaster doctest fix.

I'm not sure if there were any new commits on Matthias's branch (it's impossible to tell when merge commits are involved), or if his dependencies are only intended to make this easier to test. In any case, I've switched it back to my branch which works fine in real life if not on github.



---

archive/issue_comments_581652.json:
```json
{
    "body": "<a id='comment:126'></a>\nReplying to [mjo](#comment%3A125):\n> it's impossible to tell when merge commits are involved\n\n\ntry `git log --first-parent`",
    "created_at": "2021-12-31T02:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581652",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:126'></a>
Replying to [mjo](#comment%3A125):
> it's impossible to tell when merge commits are involved


try `git log --first-parent`



---

archive/issue_comments_581653.json:
```json
{
    "body": "<a id='comment:127'></a>\nReplying to [mkoeppe](#comment%3A126):\n> Replying to [mjo](#comment%3A125):\n> > it's impossible to tell when merge commits are involved\n\n> \n> try `git log --first-parent`\n\n\nThanks, I've been missing this my entire adult life. Can we teach trac to use it?",
    "created_at": "2021-12-31T03:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581653",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:127'></a>
Replying to [mkoeppe](#comment%3A126):
> Replying to [mjo](#comment%3A125):
> > it's impossible to tell when merge commits are involved

> 
> try `git log --first-parent`


Thanks, I've been missing this my entire adult life. Can we teach trac to use it?



---

archive/issue_comments_581654.json:
```json
{
    "body": "<a id='comment:8'></a>\nCan `pytest` be not isolated also?",
    "created_at": "2021-12-31T10:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581654",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:8'></a>
Can `pytest` be not isolated also?



---

archive/issue_comments_581655.json:
```json
{
    "body": "<a id='comment:129'></a>\nReplying to [gh-sheerluck](#comment%3A128):\n> Can `pytest` be not isolated also?\n\nOh, yes, I forgot: since pytest gives problems (see #31924) I had to disable it:\n\n```\ndiff --git a/src/bin/sage-runtests b/src/bin/sage-runtests\nindex 589dc8cd37..6bb8bf99a4 100755\n--- a/src/bin/sage-runtests\n+++ b/src/bin/sage-runtests\n@@ -154,21 +154,4 @@ if __name__ == \"__main__\":\n     DC = DocTestController(args, args.filenames)\n     err = DC.run()\n \n-    try:\n-        exit_code_pytest = 0\n-        import pytest\n-        pytest_options = [\"--import-mode\", \"importlib\"]\n-        if args.verbose:\n-            pytest_options.append(\"-v\")\n-        exit_code_pytest = pytest.main(pytest_options + args.filenames)\n-        if exit_code_pytest == 5:\n-            # Exit code 5 means there were no test files, pass in this case\n-            exit_code_pytest = 0\n-\n-    except ModuleNotFoundError:\n-        print(\"Pytest is not installed, skip checking tests that rely on it.\")\n-\n-    if err == 0:\n-        sys.exit(exit_code_pytest)\n-    else:\n-        sys.exit(err)\n+    sys.exit(err)\n```\n\nI don't know any other way to workaround this problem until #31924 is fixed.",
    "created_at": "2021-12-31T15:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581655",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:129'></a>
Replying to [gh-sheerluck](#comment%3A128):
> Can `pytest` be not isolated also?

Oh, yes, I forgot: since pytest gives problems (see #31924) I had to disable it:

```
diff --git a/src/bin/sage-runtests b/src/bin/sage-runtests
index 589dc8cd37..6bb8bf99a4 100755
--- a/src/bin/sage-runtests
+++ b/src/bin/sage-runtests
@@ -154,21 +154,4 @@ if __name__ == "__main__":
     DC = DocTestController(args, args.filenames)
     err = DC.run()
 
-    try:
-        exit_code_pytest = 0
-        import pytest
-        pytest_options = ["--import-mode", "importlib"]
-        if args.verbose:
-            pytest_options.append("-v")
-        exit_code_pytest = pytest.main(pytest_options + args.filenames)
-        if exit_code_pytest == 5:
-            # Exit code 5 means there were no test files, pass in this case
-            exit_code_pytest = 0
-
-    except ModuleNotFoundError:
-        print("Pytest is not installed, skip checking tests that rely on it.")
-
-    if err == 0:
-        sys.exit(exit_code_pytest)
-    else:
-        sys.exit(err)
+    sys.exit(err)
```

I don't know any other way to workaround this problem until #31924 is fixed.



---

archive/issue_comments_581656.json:
```json
{
    "body": "<a id='comment:0'></a>\nFor the record, in addition to what is in the current patch, I'm also using from system:\n- `gmpy2-2.1.1` (I had to patch `install-requires.txt` since it currently requires `2.1.0rc1`)\n- `sphinx-4.3.2` (I had to update it in void linux)\n- `typing_extensions-3.10.0.2`\n\nI also had to patch `ptyprocess/install-requires.txt` to allow `ptyprocess-0.7.0` since it currently requires `0.5.1` but this version seems to work ok.\n\nOf all the python packages added by this patch only three were not available for me on void linux: `cvxopt`, `importlib_resources` and `debugpy`, everything else was tested (note that `debugpy` is optional now)",
    "created_at": "2021-12-31T18:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581656",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:0'></a>
For the record, in addition to what is in the current patch, I'm also using from system:
- `gmpy2-2.1.1` (I had to patch `install-requires.txt` since it currently requires `2.1.0rc1`)
- `sphinx-4.3.2` (I had to update it in void linux)
- `typing_extensions-3.10.0.2`

I also had to patch `ptyprocess/install-requires.txt` to allow `ptyprocess-0.7.0` since it currently requires `0.5.1` but this version seems to work ok.

Of all the python packages added by this patch only three were not available for me on void linux: `cvxopt`, `importlib_resources` and `debugpy`, everything else was tested (note that `debugpy` is optional now)



---

archive/issue_comments_581657.json:
```json
{
    "body": "<a id='comment:131'></a>\nReplying to [tornaria](#comment%3A130):\n> I also had to patch `ptyprocess/install-requires.txt` to allow `ptyprocess-0.7.0` since it currently requires `0.5.1` but this version seems to work ok.\n\n\nSee #32147",
    "created_at": "2021-12-31T18:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581657",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:131'></a>
Replying to [tornaria](#comment%3A130):
> I also had to patch `ptyprocess/install-requires.txt` to allow `ptyprocess-0.7.0` since it currently requires `0.5.1` but this version seems to work ok.


See #32147



---

archive/issue_comments_581658.json:
```json
{
    "body": "<a id='comment:132'></a>\nReplying to [tornaria](#comment%3A130):\n> For the record, in addition to what is in the current patch, I'm also using from system:\n> - `gmpy2-2.1.1` (I had to patch `install-requires.txt` since it currently requires `2.1.0rc1`)\n\n\nThis is now done in the updated #33070",
    "created_at": "2022-01-01T04:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581658",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:132'></a>
Replying to [tornaria](#comment%3A130):
> For the record, in addition to what is in the current patch, I'm also using from system:
> - `gmpy2-2.1.1` (I had to patch `install-requires.txt` since it currently requires `2.1.0rc1`)


This is now done in the updated #33070



---

archive/issue_comments_581659.json:
```json
{
    "body": "Changing commit from \"135f184f7498a2046065e669723e68efe2d65cee\" to \"baf63017c93ffb135f33e49c5a15bda33a5ecffb\"",
    "created_at": "2022-02-07T12:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581659",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "135f184f7498a2046065e669723e68efe2d65cee" to "baf63017c93ffb135f33e49c5a15bda33a5ecffb"



---

archive/issue_comments_581660.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[dfb0918](https://github.com/sagemath/sagetrac-mirror/commit/dfb0918a9ec8da1486e8b8314da6e77eab0bafbd)|`Trac #29665: add Gentoo package information for gast.`|\n|[4440b33](https://github.com/sagemath/sagetrac-mirror/commit/4440b33292f5f9c49670c6300668d72d819f3f57)|`Trac #29665: standard python spkg-configure.m4 for pythran.`|\n|[72f05ac](https://github.com/sagemath/sagetrac-mirror/commit/72f05ace8503a1060afcc4e5de6f674210ac18b3)|`Trac #29665: add Gentoo package information for pythran.`|\n|[3b69262](https://github.com/sagemath/sagetrac-mirror/commit/3b69262df310016232830f34088b0ebd108dd826)|`Trac #29665: standard python spkg-configure.m4 for beniget.`|\n|[84e27c0](https://github.com/sagemath/sagetrac-mirror/commit/84e27c022e8be70c8dadb1f93dd26a6c36284bf2)|`Trac #29665: add Gentoo package information for beniget.`|\n|[5e30ff8](https://github.com/sagemath/sagetrac-mirror/commit/5e30ff80ab51af02e2f47f28b41f9c2c885d0cc3)|`Trac #29665: standard python spkg-configure.m4 for alabaster.`|\n|[20c35c1](https://github.com/sagemath/sagetrac-mirror/commit/20c35c1873955cc405aa3d8623c48648b2eef8a0)|`Trac #29665: add Gentoo package information for alabaster.`|\n|[be8b43c](https://github.com/sagemath/sagetrac-mirror/commit/be8b43cb3601488ee0a88b3be15bdae23a148a29)|`Trac #29665: standard python spkg-configure.m4 for importlib_metadata.`|\n|[afd682a](https://github.com/sagemath/sagetrac-mirror/commit/afd682a78c971c31142dd8b600178b355329002f)|`Trac #29665: add Gentoo package information for importlib_metadata.`|\n|[baf6301](https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb)|`Trac #29665: fix sage.misc.package doctest with system alabaster.`|",
    "created_at": "2022-02-07T12:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29665#issuecomment-581660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[dfb0918](https://github.com/sagemath/sagetrac-mirror/commit/dfb0918a9ec8da1486e8b8314da6e77eab0bafbd)|`Trac #29665: add Gentoo package information for gast.`|
|[4440b33](https://github.com/sagemath/sagetrac-mirror/commit/4440b33292f5f9c49670c6300668d72d819f3f57)|`Trac #29665: standard python spkg-configure.m4 for pythran.`|
|[72f05ac](https://github.com/sagemath/sagetrac-mirror/commit/72f05ace8503a1060afcc4e5de6f674210ac18b3)|`Trac #29665: add Gentoo package information for pythran.`|
|[3b69262](https://github.com/sagemath/sagetrac-mirror/commit/3b69262df310016232830f34088b0ebd108dd826)|`Trac #29665: standard python spkg-configure.m4 for beniget.`|
|[84e27c0](https://github.com/sagemath/sagetrac-mirror/commit/84e27c022e8be70c8dadb1f93dd26a6c36284bf2)|`Trac #29665: add Gentoo package information for beniget.`|
|[5e30ff8](https://github.com/sagemath/sagetrac-mirror/commit/5e30ff80ab51af02e2f47f28b41f9c2c885d0cc3)|`Trac #29665: standard python spkg-configure.m4 for alabaster.`|
|[20c35c1](https://github.com/sagemath/sagetrac-mirror/commit/20c35c1873955cc405aa3d8623c48648b2eef8a0)|`Trac #29665: add Gentoo package information for alabaster.`|
|[be8b43c](https://github.com/sagemath/sagetrac-mirror/commit/be8b43cb3601488ee0a88b3be15bdae23a148a29)|`Trac #29665: standard python spkg-configure.m4 for importlib_metadata.`|
|[afd682a](https://github.com/sagemath/sagetrac-mirror/commit/afd682a78c971c31142dd8b600178b355329002f)|`Trac #29665: add Gentoo package information for importlib_metadata.`|
|[baf6301](https://github.com/sagemath/sagetrac-mirror/commit/baf63017c93ffb135f33e49c5a15bda33a5ecffb)|`Trac #29665: fix sage.misc.package doctest with system alabaster.`|
