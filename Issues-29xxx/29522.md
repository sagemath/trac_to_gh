# Issue 29522: layout_planar fails on disconnected graphs

archive/issues_029285.json:
```json
{
    "body": "`layout_planar` fails on disconnected graphs\n\n```\nsage: g = Graph(2)\nsage: g.layout_planar()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-5-5590605c1dc8> in <module>()\n----> 1 g.layout_planar()\n\n/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n   5355                                  ''.format(external_face, self))\n   5356 \n-> 5357         _triangulate(G, G._embedding)\n   5358 \n   5359         # Optional error-checking\n\n/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)\n     68     # first make sure that the graph has at least 3 vertices, and that it is connected\n     69     if g.order() < 3:\n---> 70         raise ValueError(\"A Graph with less than 3 vertices doesn't have any triangulation.\")\n     71     if not g.is_connected():\n     72         raise NotImplementedError(\"_triangulate() only knows how to handle connected graphs.\")\n\nValueError: A Graph with less than 3 vertices doesn't have any triangulation.\n```\n\nThe error message is different when the graph has more vertices:\n\n```\nsage: g = Graph(3)\nsage: g.layout_planar()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-7-5590605c1dc8> in <module>()\n----> 1 g.layout_planar()\n\n/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n   5355                                  ''.format(external_face, self))\n   5356 \n-> 5357         _triangulate(G, G._embedding)\n   5358 \n   5359         # Optional error-checking\n\n/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)\n     70         raise ValueError(\"A Graph with less than 3 vertices doesn't have any triangulation.\")\n     71     if not g.is_connected():\n---> 72         raise NotImplementedError(\"_triangulate() only knows how to handle connected graphs.\")\n     73 \n     74     # At this point we know that the graph is connected, has at least 3\n\nNotImplementedError: _triangulate() only knows how to handle connected graphs.\n```\n\nWith this ticket the function `layout_planar` handles small graphs and graphs that are not connected. This is done by modifying the `spring_layout_fast_split` function used for the spring layout so that it can work with any layout function.\n\nThe ticket also fixes bugs of `layout_planar`\n- when called with `on_embedding` and an input graph that does not have an `_embedding` attribute,\n- when called on a non-planar graph,\n\nKeywords: layout planar embedding spring connected triangulate\n\nBranch/Commit: ba688144e7482475e9239bcb2dc4e539781e500e\n\nReviewer: David Coudert\n\nAuthor: Jean-Florent Raymond\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29522\n\n",
    "closed_at": "2020-04-23T22:32:40Z",
    "created_at": "2020-04-17T17:02:03Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "layout_planar fails on disconnected graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29522",
    "user": "https://github.com/jfraymond"
}
```
`layout_planar` fails on disconnected graphs

```
sage: g = Graph(2)
sage: g.layout_planar()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-5-5590605c1dc8> in <module>()
----> 1 g.layout_planar()

/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
   5355                                  ''.format(external_face, self))
   5356 
-> 5357         _triangulate(G, G._embedding)
   5358 
   5359         # Optional error-checking

/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)
     68     # first make sure that the graph has at least 3 vertices, and that it is connected
     69     if g.order() < 3:
---> 70         raise ValueError("A Graph with less than 3 vertices doesn't have any triangulation.")
     71     if not g.is_connected():
     72         raise NotImplementedError("_triangulate() only knows how to handle connected graphs.")

ValueError: A Graph with less than 3 vertices doesn't have any triangulation.
```

The error message is different when the graph has more vertices:

```
sage: g = Graph(3)
sage: g.layout_planar()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-7-5590605c1dc8> in <module>()
----> 1 g.layout_planar()

/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
   5355                                  ''.format(external_face, self))
   5356 
-> 5357         _triangulate(G, G._embedding)
   5358 
   5359         # Optional error-checking

/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)
     70         raise ValueError("A Graph with less than 3 vertices doesn't have any triangulation.")
     71     if not g.is_connected():
---> 72         raise NotImplementedError("_triangulate() only knows how to handle connected graphs.")
     73 
     74     # At this point we know that the graph is connected, has at least 3

NotImplementedError: _triangulate() only knows how to handle connected graphs.
```

With this ticket the function `layout_planar` handles small graphs and graphs that are not connected. This is done by modifying the `spring_layout_fast_split` function used for the spring layout so that it can work with any layout function.

The ticket also fixes bugs of `layout_planar`
- when called with `on_embedding` and an input graph that does not have an `_embedding` attribute,
- when called on a non-planar graph,

Keywords: layout planar embedding spring connected triangulate

Branch/Commit: ba688144e7482475e9239bcb2dc4e539781e500e

Reviewer: David Coudert

Author: Jean-Florent Raymond

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29522





---

archive/issue_comments_576961.json:
```json
{
    "body": "Changing author from \"\" to \"David Coudert\"",
    "created_at": "2020-04-18T10:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576961",
    "user": "https://github.com/dcoudert"
}
```

Changing author from "" to "David Coudert"



---

archive/issue_comments_576962.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-18T10:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576962",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_576963.json:
```json
{
    "body": "<a id='comment:1'></a>I changed the order of the first tests in method `_triangulate` of `schnyder.py`.\n\n---\nNew commits:",
    "created_at": "2020-04-18T10:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576963",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>I changed the order of the first tests in method `_triangulate` of `schnyder.py`.

---
New commits:



---

archive/issue_comments_576964.json:
```json
{
    "body": "Changing commit from \"\" to \"e688022665ceb0c54f19cc51fbe9da64c1a89c1f\"",
    "created_at": "2020-04-18T10:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576964",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "e688022665ceb0c54f19cc51fbe9da64c1a89c1f"



---

archive/issue_comments_576965.json:
```json
{
    "body": "Changing branch from \"\" to \"public/graphs/29522_schnyder\"",
    "created_at": "2020-04-18T10:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576965",
    "user": "https://github.com/dcoudert"
}
```

Changing branch from "" to "public/graphs/29522_schnyder"



---

archive/issue_comments_576966.json:
```json
{
    "body": "Changing commit from \"e688022665ceb0c54f19cc51fbe9da64c1a89c1f\" to \"9917e8c404b9901fbfdb5c90b96f13e7f1d42535\"",
    "created_at": "2020-04-18T21:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576966",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e688022665ceb0c54f19cc51fbe9da64c1a89c1f" to "9917e8c404b9901fbfdb5c90b96f13e7f1d42535"



---

archive/issue_comments_576967.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-18T21:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576967",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_576968.json:
```json
{
    "body": "Changing author from \"David Coudert\" to \"David Coudert, Jean-Florent Raymond\"",
    "created_at": "2020-04-18T21:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576968",
    "user": "https://github.com/jfraymond"
}
```

Changing author from "David Coudert" to "David Coudert, Jean-Florent Raymond"



---

archive/issue_comments_576969.json:
```json
{
    "body": "<a id='comment:3'></a>I changed the code of the function dealing with disconnected graphs for the spring layout (`spring_layout_fast_split`) so that it can work with any layout function.\nThe new function dealing with disconnected graphs and arbitrary layout functions is `layout_split`.\nThe `layout_planar` function now calls it when the graph is not connected.",
    "created_at": "2020-04-18T21:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576969",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:3'></a>I changed the code of the function dealing with disconnected graphs for the spring layout (`spring_layout_fast_split`) so that it can work with any layout function.
The new function dealing with disconnected graphs and arbitrary layout functions is `layout_split`.
The `layout_planar` function now calls it when the graph is not connected.



---

archive/issue_comments_576970.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-19T08:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576970",
    "user": "https://github.com/jfraymond"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_576971.json:
```json
{
    "body": "<a id='comment:4'></a>There are still some issues with my code. Working on it.",
    "created_at": "2020-04-19T08:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576971",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:4'></a>There are still some issues with my code. Working on it.



---

archive/issue_comments_576972.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-19T10:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576972",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_576973.json:
```json
{
    "body": "Changing commit from \"9917e8c404b9901fbfdb5c90b96f13e7f1d42535\" to \"4d6f2c3af6eaa7b7586d9860ae24d7545a164d4d\"",
    "created_at": "2020-04-19T10:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576973",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9917e8c404b9901fbfdb5c90b96f13e7f1d42535" to "4d6f2c3af6eaa7b7586d9860ae24d7545a164d4d"



---

archive/issue_comments_576974.json:
```json
{
    "body": "<a id='comment:6'></a>It should be good now. I also fixed the following bug of `layout_planar`:\n\n```\nH = graphs.LadderGraph(4)\nem = {0:[1,4], 4:[0,5], 1:[5,2,0], 5:[4,6,1], 2:[1,3,6], 6:[7,5,2], 3:[7,2], 7:[3,6]}\nH.layout_planar(on_embedding=em)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-fa5d8c0766a4> in <module>()\n      1 H = graphs.LadderGraph(Integer(4))\n      2 em = {Integer(0):[Integer(1),Integer(4)], Integer(4):[Integer(0),Integer(5)], Integer(1):[Integer(5),Integer(2),Integer(0)], Integer(5):[Integer(4),Integer(6),Integer(1)], Integer(2):[Integer(1),Integer(3),Integer(6)], Integer(6):[Integer(7),Integer(5),Integer(2)], Integer(3):[Integer(7),Integer(2)], Integer(7):[Integer(3),Integer(6)]}\n----> 3 H.layout_planar(on_embedding=em)\n\n/home/jf/recherche/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n   5355                                  ''.format(external_face, self))\n   5356 \n-> 5357         _triangulate(G, G._embedding)\n   5358 \n   5359         # Optional error-checking\n\nAttributeError: 'Graph' object has no attribute '_embedding'\n```",
    "created_at": "2020-04-19T10:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576974",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:6'></a>It should be good now. I also fixed the following bug of `layout_planar`:

```
H = graphs.LadderGraph(4)
em = {0:[1,4], 4:[0,5], 1:[5,2,0], 5:[4,6,1], 2:[1,3,6], 6:[7,5,2], 3:[7,2], 7:[3,6]}
H.layout_planar(on_embedding=em)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-fa5d8c0766a4> in <module>()
      1 H = graphs.LadderGraph(Integer(4))
      2 em = {Integer(0):[Integer(1),Integer(4)], Integer(4):[Integer(0),Integer(5)], Integer(1):[Integer(5),Integer(2),Integer(0)], Integer(5):[Integer(4),Integer(6),Integer(1)], Integer(2):[Integer(1),Integer(3),Integer(6)], Integer(6):[Integer(7),Integer(5),Integer(2)], Integer(3):[Integer(7),Integer(2)], Integer(7):[Integer(3),Integer(6)]}
----> 3 H.layout_planar(on_embedding=em)

/home/jf/recherche/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
   5355                                  ''.format(external_face, self))
   5356 
-> 5357         _triangulate(G, G._embedding)
   5358 
   5359         # Optional error-checking

AttributeError: 'Graph' object has no attribute '_embedding'
```



---

archive/issue_comments_576975.json:
```json
{
    "body": "Changing keywords from \"layout planar embedding connected triangulate\" to \"layout planar embedding spring connected triangulate\".",
    "created_at": "2020-04-19T10:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576975",
    "user": "https://github.com/jfraymond"
}
```

Changing keywords from "layout planar embedding connected triangulate" to "layout planar embedding spring connected triangulate".



---

archive/issue_comments_576976.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -52,7 +52,10 @@\n NotImplementedError: _triangulate() only knows how to handle connected graphs.\n ```\n \n-Keywords: layout planar embedding connected triangulate\n+With this ticket the function `layout_planar` handles small graphs and graphs that are not connected. This is done by modifying the `spring_layout_fast_split` function used for the spring layout so that it can work with any layout function.\n+\n+The ticket also fixes a bug of `layout_planar` when called with `on_embedding` and an input graph that does not have an `_embedding` attribute.\n+This ticket \n \n Comment: 1\n \n``````\n",
    "created_at": "2020-04-19T10:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576976",
    "user": "https://github.com/jfraymond"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -52,7 +52,10 @@
 NotImplementedError: _triangulate() only knows how to handle connected graphs.
 ```
 
-Keywords: layout planar embedding connected triangulate
+With this ticket the function `layout_planar` handles small graphs and graphs that are not connected. This is done by modifying the `spring_layout_fast_split` function used for the spring layout so that it can work with any layout function.
+
+The ticket also fixes a bug of `layout_planar` when called with `on_embedding` and an input graph that does not have an `_embedding` attribute.
+This ticket 
 
 Comment: 1
 
``````




---

archive/issue_comments_576977.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-19T10:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576977",
    "user": "https://github.com/jfraymond"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_576978.json:
```json
{
    "body": "<a id='comment:7'></a>I have 3 failing doctests\n\n```\nsage -t src/sage/graphs/schnyder.py\n**********************************************************************\nFile \"src/sage/graphs/schnyder.py\", line 73, in sage.graphs.schnyder._triangulate\nFailed example:\n    g.layout_planar()\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: _triangulate() only knows how to handle connected graphs\nGot:\n    {0: [0, 0], 1: [0, 1]}\n**********************************************************************\nFile \"src/sage/graphs/schnyder.py\", line 78, in sage.graphs.schnyder._triangulate\nFailed example:\n    g.layout_planar()\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: a Graph with less than 3 vertices doesn't have any triangulation\nGot:\n    {0: [0, 0], 1: [0, 1]}\n**********************************************************************\nFile \"src/sage/graphs/schnyder.py\", line 83, in sage.graphs.schnyder._triangulate\nFailed example:\n    g.layout_planar()\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: _triangulate() only knows how to handle connected graphs\nGot:\n    {0: [0.5773502691896258, 0],\n     1: [1.1547005383792517, 0],\n     2: [1.7320508075688776, 0]}\n```",
    "created_at": "2020-04-19T12:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576978",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>I have 3 failing doctests

```
sage -t src/sage/graphs/schnyder.py
**********************************************************************
File "src/sage/graphs/schnyder.py", line 73, in sage.graphs.schnyder._triangulate
Failed example:
    g.layout_planar()
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: _triangulate() only knows how to handle connected graphs
Got:
    {0: [0, 0], 1: [0, 1]}
**********************************************************************
File "src/sage/graphs/schnyder.py", line 78, in sage.graphs.schnyder._triangulate
Failed example:
    g.layout_planar()
Expected:
    Traceback (most recent call last):
    ...
    ValueError: a Graph with less than 3 vertices doesn't have any triangulation
Got:
    {0: [0, 0], 1: [0, 1]}
**********************************************************************
File "src/sage/graphs/schnyder.py", line 83, in sage.graphs.schnyder._triangulate
Failed example:
    g.layout_planar()
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: _triangulate() only knows how to handle connected graphs
Got:
    {0: [0.5773502691896258, 0],
     1: [1.1547005383792517, 0],
     2: [1.7320508075688776, 0]}
```



---

archive/issue_comments_576979.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-19T13:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576979",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_576980.json:
```json
{
    "body": "Changing commit from \"4d6f2c3af6eaa7b7586d9860ae24d7545a164d4d\" to \"e034cbd904de50c5a633233c2d1053042481ebc3\"",
    "created_at": "2020-04-19T13:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4d6f2c3af6eaa7b7586d9860ae24d7545a164d4d" to "e034cbd904de50c5a633233c2d1053042481ebc3"



---

archive/issue_comments_576981.json:
```json
{
    "body": "<a id='comment:9'></a>My bad, I only ran tests for `generic_graph.py`.\nTests now pass on the whole `graphs` folder.",
    "created_at": "2020-04-19T13:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576981",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:9'></a>My bad, I only ran tests for `generic_graph.py`.
Tests now pass on the whole `graphs` folder.



---

archive/issue_comments_576982.json:
```json
{
    "body": "<a id='comment:10'></a>The patchbot complains because you must add at least one doctest in `spring_layout_fast_split`.",
    "created_at": "2020-04-19T17:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576982",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>The patchbot complains because you must add at least one doctest in `spring_layout_fast_split`.



---

archive/issue_comments_576983.json:
```json
{
    "body": "Changing commit from \"e034cbd904de50c5a633233c2d1053042481ebc3\" to \"9159384a018a1c54bc19b0b41b8f89d35c857e60\"",
    "created_at": "2020-04-20T08:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576983",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e034cbd904de50c5a633233c2d1053042481ebc3" to "9159384a018a1c54bc19b0b41b8f89d35c857e60"



---

archive/issue_comments_576984.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-20T08:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576984",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_576985.json:
```json
{
    "body": "<a id='comment:12'></a>I added the missing test and also fixed the error message when one asks for a planar layout of a non-planar graph. Previously:\n\n```\nsage: G = graphs.PetersenGraph()\nsage: G.layout_planar()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-33ae44b2d717> in <module>()\n----> 1 G.layout_planar()\n\n/home/jf/recherche/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n   5355                                  ''.format(external_face, self))\n   5356 \n-> 5357         _triangulate(G, G._embedding)\n   5358 \n   5359         # Optional error-checking\n\nAttributeError: 'Graph' object has no attribute '_embedding'\n```\nNow it raises a `ValueError`.",
    "created_at": "2020-04-20T08:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576985",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:12'></a>I added the missing test and also fixed the error message when one asks for a planar layout of a non-planar graph. Previously:

```
sage: G = graphs.PetersenGraph()
sage: G.layout_planar()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-33ae44b2d717> in <module>()
----> 1 G.layout_planar()

/home/jf/recherche/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
   5355                                  ''.format(external_face, self))
   5356 
-> 5357         _triangulate(G, G._embedding)
   5358 
   5359         # Optional error-checking

AttributeError: 'Graph' object has no attribute '_embedding'
```
Now it raises a `ValueError`.



---

archive/issue_comments_576986.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,62 @@\n+`layout_planar` fails on disconnected graphs\n \n+```\n+sage: g = Graph(2)\n+sage: g.layout_planar()\n+---------------------------------------------------------------------------\n+ValueError                                Traceback (most recent call last)\n+<ipython-input-5-5590605c1dc8> in <module>()\n+----> 1 g.layout_planar()\n+\n+/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n+   5355                                  ''.format(external_face, self))\n+   5356 \n+-> 5357         _triangulate(G, G._embedding)\n+   5358 \n+   5359         # Optional error-checking\n+\n+/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)\n+     68     # first make sure that the graph has at least 3 vertices, and that it is connected\n+     69     if g.order() < 3:\n+---> 70         raise ValueError(\"A Graph with less than 3 vertices doesn't have any triangulation.\")\n+     71     if not g.is_connected():\n+     72         raise NotImplementedError(\"_triangulate() only knows how to handle connected graphs.\")\n+\n+ValueError: A Graph with less than 3 vertices doesn't have any triangulation.\n+```\n+\n+The error message is different when the graph has more vertices:\n+\n+```\n+sage: g = Graph(3)\n+sage: g.layout_planar()\n+---------------------------------------------------------------------------\n+NotImplementedError                       Traceback (most recent call last)\n+<ipython-input-7-5590605c1dc8> in <module>()\n+----> 1 g.layout_planar()\n+\n+/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n+   5355                                  ''.format(external_face, self))\n+   5356 \n+-> 5357         _triangulate(G, G._embedding)\n+   5358 \n+   5359         # Optional error-checking\n+\n+/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)\n+     70         raise ValueError(\"A Graph with less than 3 vertices doesn't have any triangulation.\")\n+     71     if not g.is_connected():\n+---> 72         raise NotImplementedError(\"_triangulate() only knows how to handle connected graphs.\")\n+     73 \n+     74     # At this point we know that the graph is connected, has at least 3\n+\n+NotImplementedError: _triangulate() only knows how to handle connected graphs.\n+```\n+\n+With this ticket the function `layout_planar` handles small graphs and graphs that are not connected. This is done by modifying the `spring_layout_fast_split` function used for the spring layout so that it can work with any layout function.\n+\n+The ticket also fixes bugs of `layout_planar`\n+- when called with `on_embedding` and an input graph that does not have an `_embedding` attribute,\n+- when called on a non-planar graph,\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-04-20T08:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576986",
    "user": "https://github.com/jfraymond"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,62 @@
+`layout_planar` fails on disconnected graphs
 
+```
+sage: g = Graph(2)
+sage: g.layout_planar()
+---------------------------------------------------------------------------
+ValueError                                Traceback (most recent call last)
+<ipython-input-5-5590605c1dc8> in <module>()
+----> 1 g.layout_planar()
+
+/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
+   5355                                  ''.format(external_face, self))
+   5356 
+-> 5357         _triangulate(G, G._embedding)
+   5358 
+   5359         # Optional error-checking
+
+/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)
+     68     # first make sure that the graph has at least 3 vertices, and that it is connected
+     69     if g.order() < 3:
+---> 70         raise ValueError("A Graph with less than 3 vertices doesn't have any triangulation.")
+     71     if not g.is_connected():
+     72         raise NotImplementedError("_triangulate() only knows how to handle connected graphs.")
+
+ValueError: A Graph with less than 3 vertices doesn't have any triangulation.
+```
+
+The error message is different when the graph has more vertices:
+
+```
+sage: g = Graph(3)
+sage: g.layout_planar()
+---------------------------------------------------------------------------
+NotImplementedError                       Traceback (most recent call last)
+<ipython-input-7-5590605c1dc8> in <module>()
+----> 1 g.layout_planar()
+
+/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
+   5355                                  ''.format(external_face, self))
+   5356 
+-> 5357         _triangulate(G, G._embedding)
+   5358 
+   5359         # Optional error-checking
+
+/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)
+     70         raise ValueError("A Graph with less than 3 vertices doesn't have any triangulation.")
+     71     if not g.is_connected():
+---> 72         raise NotImplementedError("_triangulate() only knows how to handle connected graphs.")
+     73 
+     74     # At this point we know that the graph is connected, has at least 3
+
+NotImplementedError: _triangulate() only knows how to handle connected graphs.
+```
+
+With this ticket the function `layout_planar` handles small graphs and graphs that are not connected. This is done by modifying the `spring_layout_fast_split` function used for the spring layout so that it can work with any layout function.
+
+The ticket also fixes bugs of `layout_planar`
+- when called with `on_embedding` and an input graph that does not have an `_embedding` attribute,
+- when called on a non-planar graph,
 
 Comment: 1
 
``````




---

archive/issue_comments_576987.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-20T09:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576987",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_576988.json:
```json
{
    "body": "Changing commit from \"9159384a018a1c54bc19b0b41b8f89d35c857e60\" to \"ba688144e7482475e9239bcb2dc4e539781e500e\"",
    "created_at": "2020-04-20T09:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9159384a018a1c54bc19b0b41b8f89d35c857e60" to "ba688144e7482475e9239bcb2dc4e539781e500e"



---

archive/issue_comments_576989.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Coudert\"",
    "created_at": "2020-04-20T09:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576989",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "" to "David Coudert"



---

archive/issue_comments_576990.json:
```json
{
    "body": "Changing author from \"David Coudert, Jean-Florent Raymond\" to \"Jean-Florent Raymond\"",
    "created_at": "2020-04-20T09:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576990",
    "user": "https://github.com/dcoudert"
}
```

Changing author from "David Coudert, Jean-Florent Raymond" to "Jean-Florent Raymond"



---

archive/issue_comments_576991.json:
```json
{
    "body": "<a id='comment:14'></a>I did a small pep8 commit.\n\nFor me this patch is good.",
    "created_at": "2020-04-20T09:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576991",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>I did a small pep8 commit.

For me this patch is good.



---

archive/issue_comments_576992.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-20T09:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576992",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_576993.json:
```json
{
    "body": "<a id='comment:15'></a>Thanks!",
    "created_at": "2020-04-20T09:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576993",
    "user": "https://github.com/jfraymond"
}
```

<a id='comment:15'></a>Thanks!



---

archive/issue_comments_576994.json:
```json
{
    "body": "Changing branch from \"public/graphs/29522_schnyder\" to \"ba688144e7482475e9239bcb2dc4e539781e500e\"",
    "created_at": "2020-04-23T22:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576994",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/graphs/29522_schnyder" to "ba688144e7482475e9239bcb2dc4e539781e500e"



---

archive/issue_comments_576995.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-23T22:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29522#issuecomment-576995",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_075308.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-23T22:32:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29522#event-75308"
}
```



---

archive/issue_events_075309.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-02T02:15:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29522",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29522#event-75309"
}
```
