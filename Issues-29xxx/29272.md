# Issue 29272: doctest in padic_lattice_element.py gives error in current develop branch

archive/issues_029035.json:
```json
{
    "body": "This is the error when doctesting in src/sage/rings/padics/padic_lattice_element.py:\n\n```\nFile \"src/sage/rings/padics/padic_lattice_element.py\", line 19, in sage.rings.padics.padic_lattice_element\nFailed example:\n    R = ZpLF(2) # py3\nExpected:\n    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.\n    See http://trac.sagemath.org/23505 for details.\nGot:\n    <BLANKLINE>\n**********************************************************************\nFile \"src/sage/rings/padics/padic_lattice_element.py\", line 25, in sage.rings.padics.padic_lattice_element\nFailed example:\n    R = QpLC(2) # py3\nExpected:\n    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.\n    See http://trac.sagemath.org/23505 for details.\nGot:\n    <BLANKLINE>\n**********************************************************************\nFile \"src/sage/rings/padics/padic_lattice_element.py\", line 31, in sage.rings.padics.padic_lattice_element\nFailed example:\n    R = QpLF(2) # py3\nExpected:\n    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.\n    See http://trac.sagemath.org/23505 for details.\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   3 of   5 in sage.rings.padics.padic_lattice_element\n    [270 tests, 3 failures, 0.61 s]\n----------------------------------------------------------------------\nsage -t --warn-long 68.1 src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.8 seconds\n    cpu time: 0.6 seconds\n    cumulative wall time: 0.6 seconds\n```\n\nProbably requires a simple change in the doctest.\n\nCC:  @kedlaya @edgarcosta @tscrim @roed314 @fchapoton @xcaruso @saraedum @dimpase dlucas @dkrenn tmonteil @johanrosenkilde @kliem\n\nBranch/Commit: 73e82fa42ef973e42011badc54a988afb1ae1bf7\n\nReviewer: Jonathan Kliem\n\nAuthor: Markus Wageringel\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29272\n\n",
    "closed_at": "2020-04-09T22:45:09Z",
    "created_at": "2020-03-03T10:15:49Z",
    "labels": [
        "component: padics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "doctest in padic_lattice_element.py gives error in current develop branch",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29272",
    "user": "https://github.com/SagnikDey92"
}
```
This is the error when doctesting in src/sage/rings/padics/padic_lattice_element.py:

```
File "src/sage/rings/padics/padic_lattice_element.py", line 19, in sage.rings.padics.padic_lattice_element
Failed example:
    R = ZpLF(2) # py3
Expected:
    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
    See http://trac.sagemath.org/23505 for details.
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/rings/padics/padic_lattice_element.py", line 25, in sage.rings.padics.padic_lattice_element
Failed example:
    R = QpLC(2) # py3
Expected:
    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
    See http://trac.sagemath.org/23505 for details.
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/rings/padics/padic_lattice_element.py", line 31, in sage.rings.padics.padic_lattice_element
Failed example:
    R = QpLF(2) # py3
Expected:
    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
    See http://trac.sagemath.org/23505 for details.
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   3 of   5 in sage.rings.padics.padic_lattice_element
    [270 tests, 3 failures, 0.61 s]
----------------------------------------------------------------------
sage -t --warn-long 68.1 src/sage/rings/padics/padic_lattice_element.py  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.8 seconds
    cpu time: 0.6 seconds
    cumulative wall time: 0.6 seconds
```

Probably requires a simple change in the doctest.

CC:  @kedlaya @edgarcosta @tscrim @roed314 @fchapoton @xcaruso @saraedum @dimpase dlucas @dkrenn tmonteil @johanrosenkilde @kliem

Branch/Commit: 73e82fa42ef973e42011badc54a988afb1ae1bf7

Reviewer: Jonathan Kliem

Author: Markus Wageringel

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29272





---

archive/issue_comments_563683.json:
```json
{
    "body": "<a id='comment:2'></a>\nsee #20601 for some old related ticket",
    "created_at": "2020-03-22T15:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563683",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
see #20601 for some old related ticket



---

archive/issue_comments_563684.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/doctest_in_padic_lattice_element_py_gives_error_in_current_develop_branch\"",
    "created_at": "2020-03-22T16:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563684",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/doctest_in_padic_lattice_element_py_gives_error_in_current_develop_branch"



---

archive/issue_comments_563685.json:
```json
{
    "body": "<a id='comment:4'></a>\nStrange that this would only be noticed now?\n\n---\nNew commits:\n|                                                                                                                                          |                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[371c0c9](https://github.com/sagemath/sagetrac-mirror/commit/371c0c93285fcdc3447ef2b2f929b23ace63da18)|`Remove repeated FutureWarnings in doctests`|",
    "created_at": "2020-03-22T16:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563685",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Strange that this would only be noticed now?

---
New commits:
|                                                                                                                                          |                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[371c0c9](https://github.com/sagemath/sagetrac-mirror/commit/371c0c93285fcdc3447ef2b2f929b23ace63da18)|`Remove repeated FutureWarnings in doctests`|



---

archive/issue_comments_563686.json:
```json
{
    "body": "Changing commit from \"\" to \"371c0c93285fcdc3447ef2b2f929b23ace63da18\"",
    "created_at": "2020-03-22T16:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563686",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "371c0c93285fcdc3447ef2b2f929b23ace63da18"



---

archive/issue_comments_563687.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-03-22T16:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563687",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_563688.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-22T16:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563688",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_563689.json:
```json
{
    "body": "<a id='comment:6'></a>\nWith this branch, we're getting test failures on the [patchbot](https://patchbot.sagemath.org/log/29272/Darwin/Darwin%20Kernel%20Version%2018.5.0:%20Mon%20Mar%2011%2020:40:32%20PDT%202019;%20root:xnu-4903.251.3~3/RELEASE_X86_64/x86_64/18.5.0/steenrod/2020-03-22%2017:00:26?short) where the FutureWarnings appear, so we clearly can't just remove them.  I'm not sure why they appear sometime and not other times....",
    "created_at": "2020-03-22T17:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563689",
    "user": "https://github.com/roed314"
}
```

<a id='comment:6'></a>
With this branch, we're getting test failures on the [patchbot](https://patchbot.sagemath.org/log/29272/Darwin/Darwin%20Kernel%20Version%2018.5.0:%20Mon%20Mar%2011%2020:40:32%20PDT%202019;%20root:xnu-4903.251.3~3/RELEASE_X86_64/x86_64/18.5.0/steenrod/2020-03-22%2017:00:26?short) where the FutureWarnings appear, so we clearly can't just remove them.  I'm not sure why they appear sometime and not other times....



---

archive/issue_comments_563690.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-03-22T17:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563690",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_563691.json:
```json
{
    "body": "<a id='comment:7'></a>\nAre the doctests in one block like this parallelized?",
    "created_at": "2020-03-24T17:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563691",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Are the doctests in one block like this parallelized?



---

archive/issue_comments_563692.json:
```json
{
    "body": "<a id='comment:8'></a>\nNo, they should be run in series since they're within one block.",
    "created_at": "2020-03-24T18:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563692",
    "user": "https://github.com/roed314"
}
```

<a id='comment:8'></a>
No, they should be run in series since they're within one block.



---

archive/issue_comments_563693.json:
```json
{
    "body": "<a id='comment:9'></a>\nAnother solution (that I should check with Xavier and Julian about) is to remove the experimental designation.  We haven't worked on the lattice precision interface for a while, so maybe we should just think about what interface changes we want to make, make them, and then remove these warnings.\n\nWe've got a work week planned in mid April where we could look into this.",
    "created_at": "2020-03-24T18:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563693",
    "user": "https://github.com/roed314"
}
```

<a id='comment:9'></a>
Another solution (that I should check with Xavier and Julian about) is to remove the experimental designation.  We haven't worked on the lattice precision interface for a while, so maybe we should just think about what interface changes we want to make, make them, and then remove these warnings.

We've got a work week planned in mid April where we could look into this.



---

archive/issue_comments_563694.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [roed](#comment%3A6):\n> With this branch, we're getting test failures on the [patchbot](https://patchbot.sagemath.org/log/29272/Darwin/Darwin%20Kernel%20Version%2018.5.0:%20Mon%20Mar%2011%2020:40:32%20PDT%202019;%20root:xnu-4903.251.3~3/RELEASE_X86_64/x86_64/18.5.0/steenrod/2020-03-22%2017:00:26?short) where the FutureWarnings appear, so we clearly can't just remove them.  I'm not sure why they appear sometime and not other times....\n\n\nwhat is so special about this bot?\nThese test errors are happening most everywhere, I believe I wrote about it on some of your tickets, without any replies",
    "created_at": "2020-03-25T01:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563694",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
Replying to [roed](#comment%3A6):
> With this branch, we're getting test failures on the [patchbot](https://patchbot.sagemath.org/log/29272/Darwin/Darwin%20Kernel%20Version%2018.5.0:%20Mon%20Mar%2011%2020:40:32%20PDT%202019;%20root:xnu-4903.251.3~3/RELEASE_X86_64/x86_64/18.5.0/steenrod/2020-03-22%2017:00:26?short) where the FutureWarnings appear, so we clearly can't just remove them.  I'm not sure why they appear sometime and not other times....


what is so special about this bot?
These test errors are happening most everywhere, I believe I wrote about it on some of your tickets, without any replies



---

archive/issue_comments_563695.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-03-31T16:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563695",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_563696.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis issue does not occur when running the long tests, but only when running the short tests, so this is not a problem on the patchbots. This might be a weird interaction between the doctest framework filtering duplicate warnings and the `experimental` decorator trying to avoid duplicate warnings.\n\nThis problem can be solved by reordering the doctests, so that the long test cases are executed after the short ones. Here is a branch that does this.\n\n---\nNew commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[73e82fa](https://github.com/sagemath/sagetrac-mirror/commit/73e82fa42ef973e42011badc54a988afb1ae1bf7)|`29272: reorder doctests to make long and short tests pass`|",
    "created_at": "2020-03-31T16:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563696",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:13'></a>
This issue does not occur when running the long tests, but only when running the short tests, so this is not a problem on the patchbots. This might be a weird interaction between the doctest framework filtering duplicate warnings and the `experimental` decorator trying to avoid duplicate warnings.

This problem can be solved by reordering the doctests, so that the long test cases are executed after the short ones. Here is a branch that does this.

---
New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[73e82fa](https://github.com/sagemath/sagetrac-mirror/commit/73e82fa42ef973e42011badc54a988afb1ae1bf7)|`29272: reorder doctests to make long and short tests pass`|



---

archive/issue_comments_563697.json:
```json
{
    "body": "Changing commit from \"371c0c93285fcdc3447ef2b2f929b23ace63da18\" to \"73e82fa42ef973e42011badc54a988afb1ae1bf7\"",
    "created_at": "2020-03-31T16:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563697",
    "user": "https://github.com/mwageringel"
}
```

Changing commit from "371c0c93285fcdc3447ef2b2f929b23ace63da18" to "73e82fa42ef973e42011badc54a988afb1ae1bf7"



---

archive/issue_comments_563698.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe\" to \"Markus Wageringel\"",
    "created_at": "2020-03-31T16:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563698",
    "user": "https://github.com/mwageringel"
}
```

Changing author from "Matthias Koeppe" to "Markus Wageringel"



---

archive/issue_comments_563699.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/doctest_in_padic_lattice_element_py_gives_error_in_current_develop_branch\" to \"u/gh-mwageringel/29272\"",
    "created_at": "2020-03-31T16:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563699",
    "user": "https://github.com/mwageringel"
}
```

Changing branch from "u/mkoeppe/doctest_in_padic_lattice_element_py_gives_error_in_current_develop_branch" to "u/gh-mwageringel/29272"



---

archive/issue_comments_563700.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-31T17:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563700",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_563701.json:
```json
{
    "body": "<a id='comment:14'></a>\nLGTM.\n\n(Lowering the stacklevel to 3 would have worked as well, but this is so much simpler).",
    "created_at": "2020-03-31T17:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563701",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>
LGTM.

(Lowering the stacklevel to 3 would have worked as well, but this is so much simpler).



---

archive/issue_comments_563702.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jonathan Kliem\"",
    "created_at": "2020-03-31T17:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563702",
    "user": "https://github.com/kliem"
}
```

Changing reviewer from "" to "Jonathan Kliem"



---

archive/issue_events_091920.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-09T22:45:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29272#event-91920"
}
```



---

archive/issue_comments_563703.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-09T22:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563703",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_563704.json:
```json
{
    "body": "Changing branch from \"u/gh-mwageringel/29272\" to \"73e82fa42ef973e42011badc54a988afb1ae1bf7\"",
    "created_at": "2020-04-09T22:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29272#issuecomment-563704",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-mwageringel/29272" to "73e82fa42ef973e42011badc54a988afb1ae1bf7"
