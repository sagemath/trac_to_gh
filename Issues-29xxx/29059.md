# Issue 29059: Issue with symbolic multiple integration (upstream?)

archive/issues_028822.json:
```json
{
    "body": "Keywords: integral\n\nThis symbolic double integral works fine:\n\n```\nsage: var('x,y')\n(x, y)\nsage: integral(integral(1, (y, 0, sqrt((1-x^2)/2))), (x,0,1))\n1/8*sqrt(2)*pi\n```\nbut the analogous triple integral breaks:\n\n```\nsage: var('x,y,z')\n(x, y, z)\nsage: assume(x<1,x>-1) # Complains otherwise\nsage: integral(integral(integral(1, (z, 0, sqrt((1-x^2-2*y^2)/3))), (y,0,sqrt((1-x^2)/2))), (x, 0, 1))\nRuntimeError                              Traceback (most recent call last)\n...\nRuntimeError: ECL says: Error executing code in Maxima: expt: undefined: 0 to a negative exponent.\n```\nOn the other hand, even for the same region of integration this does not arise for other choices of integrand:\n\n```\nsage: var('x,y,z')\n(x, y, z)\nsage: integral(integral(integral(x*y, (z, 0, sqrt((1-x^2-2*y^2)/3))), (y,0,sqrt((1-x^2)/2))), (x, 0, 1))\n1/90*sqrt(3)\n```\nIs this an upstream issue?\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29059\n\n",
    "created_at": "2020-01-21T02:39:45Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Issue with symbolic multiple integration (upstream?)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29059",
    "user": "https://github.com/kedlaya"
}
```
Keywords: integral

This symbolic double integral works fine:

```
sage: var('x,y')
(x, y)
sage: integral(integral(1, (y, 0, sqrt((1-x^2)/2))), (x,0,1))
1/8*sqrt(2)*pi
```
but the analogous triple integral breaks:

```
sage: var('x,y,z')
(x, y, z)
sage: assume(x<1,x>-1) # Complains otherwise
sage: integral(integral(integral(1, (z, 0, sqrt((1-x^2-2*y^2)/3))), (y,0,sqrt((1-x^2)/2))), (x, 0, 1))
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: ECL says: Error executing code in Maxima: expt: undefined: 0 to a negative exponent.
```
On the other hand, even for the same region of integration this does not arise for other choices of integrand:

```
sage: var('x,y,z')
(x, y, z)
sage: integral(integral(integral(x*y, (z, 0, sqrt((1-x^2-2*y^2)/3))), (y,0,sqrt((1-x^2)/2))), (x, 0, 1))
1/90*sqrt(3)
```
Is this an upstream issue?


Issue created by migration from https://trac.sagemath.org/ticket/29059





---

archive/issue_comments_407061.json:
```json
{
    "body": "It seems that this might be a Maxima antiderivative issue.\n\n```\nZ = integral(integral(1, (z, 0, sqrt((1-x^2-2*y^2)/3))), (y,0,sqrt((1-x^2)/2)))\nintegral(Z,x)  \n<same explosion>\n```\nIf we imitate the Sage Maxima,\n\n```\ndomain:complex;\nX:integrate(1,z,0,sqrt((1-x^2-2*y^2)/3));\nassume(x<1); \nassume(x>-1);\nY:integrate(X,y,0,sqrt((1-x^2)/2));\ndisplay2d:false;\nintegrate(Y,x,0,1);\n```\n\nThis reveals\n\n```\n%pi/(3*2^(3/2))\n```\nIs this what you would expect?\n\nI think we got rid of the `abs_integrate` package so I would not expect that to be part of the problem (try `load(abs_integrate)` to test), and I did get some related errors in some intermediate steps, but I am not finding this particular error in Maxima - yet.  Hopefully this initial debug helps somebody track it down further.",
    "created_at": "2020-01-22T15:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407061",
    "user": "https://github.com/kcrisman"
}
```

It seems that this might be a Maxima antiderivative issue.

```
Z = integral(integral(1, (z, 0, sqrt((1-x^2-2*y^2)/3))), (y,0,sqrt((1-x^2)/2)))
integral(Z,x)  
<same explosion>
```
If we imitate the Sage Maxima,

```
domain:complex;
X:integrate(1,z,0,sqrt((1-x^2-2*y^2)/3));
assume(x<1); 
assume(x>-1);
Y:integrate(X,y,0,sqrt((1-x^2)/2));
display2d:false;
integrate(Y,x,0,1);
```

This reveals

```
%pi/(3*2^(3/2))
```
Is this what you would expect?

I think we got rid of the `abs_integrate` package so I would not expect that to be part of the problem (try `load(abs_integrate)` to test), and I did get some related errors in some intermediate steps, but I am not finding this particular error in Maxima - yet.  Hopefully this initial debug helps somebody track it down further.



---

archive/issue_events_073654.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73654"
}
```



---

archive/issue_comments_407062.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407062",
    "user": "https://github.com/mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_events_073655.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73655"
}
```



---

archive/issue_events_073656.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73656"
}
```



---

archive/issue_comments_407063.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407063",
    "user": "https://github.com/mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_073657.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73657"
}
```



---

archive/issue_events_073658.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73658"
}
```



---

archive/issue_events_073659.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73659"
}
```



---

archive/issue_events_073660.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73660"
}
```



---

archive/issue_events_073661.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73661"
}
```



---

archive/issue_events_073662.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73662"
}
```



---

archive/issue_comments_407064.json:
```json
{
    "body": "Changing keywords from \"\" to \"integral\".",
    "created_at": "2021-12-21T08:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407064",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "integral".



---

archive/issue_comments_407065.json:
```json
{
    "body": "isolation of the issue in maxima integration:\n\n```\nsage: f=-1/12*(sqrt(3)*sqrt(2)*x^2 - sqrt(3)*sqrt(2))*arcsin(4/3*sqrt(-1/2*x^2 +1/2)/sqrt(-8/9*x^2 + 8/9))\nsage: f.integrate(x,0,1)\n1/36*sqrt(6)*pi\nsage: f.integrate(x,0,1,algorithm='maxima')\nBOUM!!\n```",
    "created_at": "2021-12-21T10:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407065",
    "user": "https://github.com/fchapoton"
}
```

isolation of the issue in maxima integration:

```
sage: f=-1/12*(sqrt(3)*sqrt(2)*x^2 - sqrt(3)*sqrt(2))*arcsin(4/3*sqrt(-1/2*x^2 +1/2)/sqrt(-8/9*x^2 + 8/9))
sage: f.integrate(x,0,1)
1/36*sqrt(6)*pi
sage: f.integrate(x,0,1,algorithm='maxima')
BOUM!!
```



---

archive/issue_comments_407066.json:
```json
{
    "body": "simplified bug\n\n```\nsage: f = x^2*arcsin(1/3*sqrt(-x^2 + 1)/sqrt(-1/9*x^2 + 1/9))\nsage: f.integrate(x,0,1,algorithm='maxima')\n```\nwhere in fact the square roots inside do cancel each other.",
    "created_at": "2021-12-21T10:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407066",
    "user": "https://github.com/fchapoton"
}
```

simplified bug

```
sage: f = x^2*arcsin(1/3*sqrt(-x^2 + 1)/sqrt(-1/9*x^2 + 1/9))
sage: f.integrate(x,0,1,algorithm='maxima')
```
where in fact the square roots inside do cancel each other.



---

archive/issue_comments_407067.json:
```json
{
    "body": "If you can try this inside of the most recent Sage Maxima (I think mine might be a little old), then we can report that upstream.\n\n```\nMaxima 5.42.2 http://maxima.sourceforge.net\nusing Lisp ECL 16.1.2\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) domain:complex;\n(%o1)                               complex\n(%i2) f:x^2*asin(1/3*sqrt(-x^2 + 1)/sqrt(-1/9*x^2 + 1/9));\n                                               2\n                             2       sqrt(1 - x )\n(%o2)                       x  asin(--------------)\n                                                2\n                                           1   x\n                                    3 sqrt(- - --)\n                                           9   9\n(%i3) integrate(f,x,0,1);\n\nexpt: undefined: 0 to a negative exponent.\n -- an error. To debug this try: debugmode(true);\n```\nNice tracking this down.",
    "created_at": "2021-12-21T12:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407067",
    "user": "https://github.com/kcrisman"
}
```

If you can try this inside of the most recent Sage Maxima (I think mine might be a little old), then we can report that upstream.

```
Maxima 5.42.2 http://maxima.sourceforge.net
using Lisp ECL 16.1.2
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) domain:complex;
(%o1)                               complex
(%i2) f:x^2*asin(1/3*sqrt(-x^2 + 1)/sqrt(-1/9*x^2 + 1/9));
                                               2
                             2       sqrt(1 - x )
(%o2)                       x  asin(--------------)
                                                2
                                           1   x
                                    3 sqrt(- - --)
                                           9   9
(%i3) integrate(f,x,0,1);

expt: undefined: 0 to a negative exponent.
 -- an error. To debug this try: debugmode(true);
```
Nice tracking this down.



---

archive/issue_comments_407068.json:
```json
{
    "body": "here it goes\n\n```\nMaxima 5.45.0 https://maxima.sourceforge.io\nusing Lisp ECL 21.2.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) domain:complex;\n(%o1)                               complex\n(%i2) f:x^2*asin(1/3*sqrt(-x^2 + 1)/sqrt(-1/9*x^2 + 1/9));\n                                               2\n                             2       sqrt(1 - x )\n(%o2)                       x  asin(--------------)\n                                                2\n                                           1   x\n                                    3 sqrt(- - --)\n                                           9   9\n(%i3) integrate(f,x,0,1);\n\nexpt: undefined: 0 to a negative exponent.\n -- an error. To debug this try: debugmode(true);\n```",
    "created_at": "2021-12-21T19:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407068",
    "user": "https://github.com/fchapoton"
}
```

here it goes

```
Maxima 5.45.0 https://maxima.sourceforge.io
using Lisp ECL 21.2.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) domain:complex;
(%o1)                               complex
(%i2) f:x^2*asin(1/3*sqrt(-x^2 + 1)/sqrt(-1/9*x^2 + 1/9));
                                               2
                             2       sqrt(1 - x )
(%o2)                       x  asin(--------------)
                                                2
                                           1   x
                                    3 sqrt(- - --)
                                           9   9
(%i3) integrate(f,x,0,1);

expt: undefined: 0 to a negative exponent.
 -- an error. To debug this try: debugmode(true);
```



---

archive/issue_comments_407069.json:
```json
{
    "body": "Thanks! This is now [Maxima bug 3906](https://sourceforge.net/p/maxima/bugs/3906/).",
    "created_at": "2021-12-22T00:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407069",
    "user": "https://github.com/kcrisman"
}
```

Thanks! This is now [Maxima bug 3906](https://sourceforge.net/p/maxima/bugs/3906/).



---

archive/issue_comments_407070.json:
```json
{
    "body": "one can even remove the `x**2` factor, the bug remains the same.",
    "created_at": "2021-12-31T20:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407070",
    "user": "https://github.com/fchapoton"
}
```

one can even remove the `x**2` factor, the bug remains the same.



---

archive/issue_comments_407071.json:
```json
{
    "body": "on the other hand,\n\n```\nmaxima: f:asin(2*sqrt(-x + 1)/sqrt(-4*x + 4));\nasin((2*sqrt(1-x))/sqrt(4-4*x))\nmaxima: integrate(f,x,0,1);\n```\ngives another error:\n\n```\nCODE:\n\tintegrate(f,x,0,1);\nMaxima ERROR:\n\t\n`quotient' by `zero'\n```",
    "created_at": "2022-01-05T18:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29059#issuecomment-407071",
    "user": "https://github.com/fchapoton"
}
```

on the other hand,

```
maxima: f:asin(2*sqrt(-x + 1)/sqrt(-4*x + 4));
asin((2*sqrt(1-x))/sqrt(4-4*x))
maxima: integrate(f,x,0,1);
```
gives another error:

```
CODE:
	integrate(f,x,0,1);
Maxima ERROR:
	
`quotient' by `zero'
```



---

archive/issue_events_073663.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73663"
}
```



---

archive/issue_events_073664.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73664"
}
```



---

archive/issue_events_073665.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73665"
}
```



---

archive/issue_events_073666.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29059",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29059#event-73666"
}
```
