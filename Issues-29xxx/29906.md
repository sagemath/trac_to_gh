# Issue 29906: Run tests for `an_affine_basis`

archive/issues_029669.json:
```json
{
    "body": "This ticket adds a method that tests `an_affine_basis` to `Polyhedron_base`.\n\nWe move some basic tests there.\n\nCC:  @jplab @laisrast\n\nKeywords: polyhedra, test suite\n\nBranch/Commit: f57e162f65b6f29c80a9e6d079cd3378cb122b85\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jonathan Kliem\n\nDependencies: #29903\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29906\n\n",
    "closed_at": "2020-07-08T19:33:50Z",
    "created_at": "2020-06-19T22:03:00Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Run tests for `an_affine_basis`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29906",
    "user": "https://github.com/kliem"
}
```
This ticket adds a method that tests `an_affine_basis` to `Polyhedron_base`.

We move some basic tests there.

CC:  @jplab @laisrast

Keywords: polyhedra, test suite

Branch/Commit: f57e162f65b6f29c80a9e6d079cd3378cb122b85

Reviewer: Travis Scrimshaw

Author: Jonathan Kliem

Dependencies: #29903

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29906





---

archive/issue_comments_587819.json:
```json
{
    "body": "Changing commit from \"5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987\" to \"af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac\"",
    "created_at": "2020-06-19T22:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987" to "af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac"



---

archive/issue_comments_587820.json:
```json
{
    "body": "<a id='comment:1'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[af2ba1f](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)|`test suite for an_affine_basis`|",
    "created_at": "2020-06-19T22:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[af2ba1f](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)|`test suite for an_affine_basis`|



---

archive/issue_comments_587821.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-19T22:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_587822.json:
```json
{
    "body": "Changing commit from \"af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac\" to \"5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987\"",
    "created_at": "2020-06-19T22:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac" to "5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987"



---

archive/issue_comments_587823.json:
```json
{
    "body": "Changing branch from \"public/29903\" to \"public/29906\"",
    "created_at": "2020-06-19T22:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587823",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29903" to "public/29906"



---

archive/issue_comments_587824.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29903\"",
    "created_at": "2020-06-19T22:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587824",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "" to "#29903"



---

archive/issue_comments_587825.json:
```json
{
    "body": "Changing commit from \"5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987\" to \"af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac\"",
    "created_at": "2020-06-19T22:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587825",
    "user": "https://github.com/kliem"
}
```

Changing commit from "5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987" to "af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac"



---

archive/issue_comments_587826.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-19T22:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587826",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_587827.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[af2ba1f](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)|`test suite for an_affine_basis`|",
    "created_at": "2020-06-19T22:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587827",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[af2ba1f](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)|`test suite for an_affine_basis`|



---

archive/issue_comments_587828.json:
```json
{
    "body": "<a id='comment:4'></a>\nIs there some way to improve this test:\n\n```python\nm = matrix(b).transpose().stack(matrix([[1]*len(b)]))\n```\nIt feels somewhat inefficient as you make a matrix then take its transpose. Plus you get a new matrix with the `stack` call. Wouldn't it be better to just add 1 to each of the vectors `b` then ask for the `rank`?",
    "created_at": "2020-06-21T23:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587828",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
Is there some way to improve this test:

```python
m = matrix(b).transpose().stack(matrix([[1]*len(b)]))
```
It feels somewhat inefficient as you make a matrix then take its transpose. Plus you get a new matrix with the `stack` call. Wouldn't it be better to just add 1 to each of the vectors `b` then ask for the `rank`?



---

archive/issue_comments_587829.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt does feel inefficient, but I think it is rather efficient (besides that it really doesn't matter as obtaining `an_affine_matrix` takes much longer than anything else here):\n\n```\nsage: P = polytopes.permutahedron(7)\n\nsage: \nsage: b = P.vertices()\nsage: len(b)\n5040\nsage: P = polytopes.permutahedron(7)\nsage: b = P.vertices()\nsage: len(b)\n5040\nsage: def hom_matrix1(b):\n....:     return matrix(b).transpose().stack(matrix([[1]*len(b)]))\n....: \nsage: def hom_matrix2(b):\n....:     return matrix([1] + list(x) for x in b)\n....: \nsage: def hom_matrix3(b):\n....:     return matrix(b).transpose().stack(vector([1]*len(b)))\n....: \n....: \nsage: %timeit hom_matrix1(b)\n10 loops, best of 5: 19.6 ms per loop\nsage: %timeit hom_matrix2(b)\n10 loops, best of 5: 23.4 ms per loop\nsage: %timeit hom_matrix3(b)\n10 loops, best of 5: 26 ms per loop\n\nsage: b = P.an_affine_basis()\nsage: len(b)\nsage: %timeit hom_matrix1(b)\nThe slowest run took 98.27 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 5: 46.1 \u00b5s per loop\nsage: %timeit hom_matrix2(b)\nThe slowest run took 12.89 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 5: 35.1 \u00b5s per loop\nsage: %timeit hom_matrix3(b)\nThe slowest run took 4.52 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 5: 103 \u00b5s per loop\n```\n\nSo it is a bit faster for small instances (which should always be true for `b` being an affine basis of any `TestSuite` polyhedron, but really not by much. Besides it is a meaningless time difference if you consider obtaining `an_affine_basis` first, even with #29841.\n\nIf you know argue that `matrix([1] + list(x) for x in b)` is much easier to understand, I agree with you and that is a good point.",
    "created_at": "2020-06-22T09:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587829",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>
It does feel inefficient, but I think it is rather efficient (besides that it really doesn't matter as obtaining `an_affine_matrix` takes much longer than anything else here):

```
sage: P = polytopes.permutahedron(7)

sage: 
sage: b = P.vertices()
sage: len(b)
5040
sage: P = polytopes.permutahedron(7)
sage: b = P.vertices()
sage: len(b)
5040
sage: def hom_matrix1(b):
....:     return matrix(b).transpose().stack(matrix([[1]*len(b)]))
....: 
sage: def hom_matrix2(b):
....:     return matrix([1] + list(x) for x in b)
....: 
sage: def hom_matrix3(b):
....:     return matrix(b).transpose().stack(vector([1]*len(b)))
....: 
....: 
sage: %timeit hom_matrix1(b)
10 loops, best of 5: 19.6 ms per loop
sage: %timeit hom_matrix2(b)
10 loops, best of 5: 23.4 ms per loop
sage: %timeit hom_matrix3(b)
10 loops, best of 5: 26 ms per loop

sage: b = P.an_affine_basis()
sage: len(b)
sage: %timeit hom_matrix1(b)
The slowest run took 98.27 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 5: 46.1 µs per loop
sage: %timeit hom_matrix2(b)
The slowest run took 12.89 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 5: 35.1 µs per loop
sage: %timeit hom_matrix3(b)
The slowest run took 4.52 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 5: 103 µs per loop
```

So it is a bit faster for small instances (which should always be true for `b` being an affine basis of any `TestSuite` polyhedron, but really not by much. Besides it is a meaningless time difference if you consider obtaining `an_affine_basis` first, even with #29841.

If you know argue that `matrix([1] + list(x) for x in b)` is much easier to understand, I agree with you and that is a good point.



---

archive/issue_comments_587830.json:
```json
{
    "body": "Changing commit from \"af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac\" to \"f57e162f65b6f29c80a9e6d079cd3378cb122b85\"",
    "created_at": "2020-06-22T10:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac" to "f57e162f65b6f29c80a9e6d079cd3378cb122b85"



---

archive/issue_comments_587831.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[f57e162](https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85)|`more transparent test for an_affine_basis`|",
    "created_at": "2020-06-22T10:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[f57e162](https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85)|`more transparent test for an_affine_basis`|



---

archive/issue_comments_587832.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2020-06-22T10:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587832",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_587833.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-22T10:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587833",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_587834.json:
```json
{
    "body": "<a id='comment:7'></a>\nLikely in the small cases you're seeing the benefit from everything being done in Cython rather than Python. I am not sure if I would say it is easier to understand. The transpose and stacking makes it more clear how things should be grouped, but it is not as clear that things are being realized as embedding in an affine space in a vector space. However, there are less moving parts, so I think that is a bonus with changing it. Plus it is better on the memory side if someone is working with a large polytope and wants to run this test.\n\nThank you for making the change.",
    "created_at": "2020-06-22T10:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587834",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Likely in the small cases you're seeing the benefit from everything being done in Cython rather than Python. I am not sure if I would say it is easier to understand. The transpose and stacking makes it more clear how things should be grouped, but it is not as clear that things are being realized as embedding in an affine space in a vector space. However, there are less moving parts, so I think that is a bonus with changing it. Plus it is better on the memory side if someone is working with a large polytope and wants to run this test.

Thank you for making the change.



---

archive/issue_comments_587835.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T19:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587835",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086522.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-08T19:33:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29906#event-86522"
}
```



---

archive/issue_comments_587836.json:
```json
{
    "body": "Changing branch from \"public/29906\" to \"f57e162f65b6f29c80a9e6d079cd3378cb122b85\"",
    "created_at": "2020-07-08T19:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29906#issuecomment-587836",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/29906" to "f57e162f65b6f29c80a9e6d079cd3378cb122b85"
