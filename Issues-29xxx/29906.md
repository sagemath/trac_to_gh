# Issue 29906: Run tests for `an_affine_basis`

archive/issues_029669.json:
```json
{
    "assignees": [],
    "body": "This ticket adds a method that tests `an_affine_basis` to `Polyhedron_base`.\n\nWe move some basic tests there.\n\nDepends on #29903\n\nCC:  @jplab @LaisRast\n\nKeywords: **polyhedra, test suite**\n\nBranch/Commit: **[`f57e162`](https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jonathan Kliem**\n\nComponent: **geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29906_\n\n",
    "closed_at": "2020-07-08T19:33:50Z",
    "created_at": "2020-06-19T22:03:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Run tests for `an_affine_basis`",
    "type": "issue",
    "updated_at": "2020-07-08T19:33:50Z",
    "url": "https://github.com/sagemath/sage/issues/29906",
    "user": "https://github.com/kliem"
}
```
This ticket adds a method that tests `an_affine_basis` to `Polyhedron_base`.

We move some basic tests there.

Depends on #29903

CC:  @jplab @LaisRast

Keywords: **polyhedra, test suite**

Branch/Commit: **[`f57e162`](https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85)**

Reviewer: **Travis Scrimshaw**

Author: **Jonathan Kliem**

Component: **geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/29906_





---

archive/issue_events_408579.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-19T22:03:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408579"
}
```



---

archive/issue_events_408580.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-19T22:03:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408580"
}
```



---

archive/issue_events_408581.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-19T22:03:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408581"
}
```



---

archive/issue_events_408582.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-19T22:03:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408582"
}
```



---

archive/issue_comments_472607.json:
```json
{
    "body": "Changed commit from **[`5d79b2b`](https://github.com/sagemath/sagetrac-mirror/commit/5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987)** to **[`af2ba1f`](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)**",
    "created_at": "2020-06-19T22:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472607",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5d79b2b`](https://github.com/sagemath/sagetrac-mirror/commit/5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987)** to **[`af2ba1f`](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)**



---

archive/issue_comments_472608.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac\"><code>af2ba1f</code></a></td><td><code>test suite for an_affine_basis</code></td></tr></table>\n",
    "created_at": "2020-06-19T22:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472608",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac"><code>af2ba1f</code></a></td><td><code>test suite for an_affine_basis</code></td></tr></table>




---

archive/issue_comments_472609.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-19T22:04:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472609",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_472610.json:
```json
{
    "body": "Changed commit from **[`af2ba1f`](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)** to **[`5d79b2b`](https://github.com/sagemath/sagetrac-mirror/commit/5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987)**",
    "created_at": "2020-06-19T22:04:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472610",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`af2ba1f`](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)** to **[`5d79b2b`](https://github.com/sagemath/sagetrac-mirror/commit/5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987)**



---

archive/issue_comments_472611.json:
```json
{
    "body": "Changed branch from **[public/29903](https://github.com/sagemath/sagetrac-mirror/tree/public/29903)** to **[public/29906](https://github.com/sagemath/sagetrac-mirror/tree/public/29906)**",
    "created_at": "2020-06-19T22:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472611",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[public/29903](https://github.com/sagemath/sagetrac-mirror/tree/public/29903)** to **[public/29906](https://github.com/sagemath/sagetrac-mirror/tree/public/29906)**



---

archive/issue_comments_472612.json:
```json
{
    "body": "Dependencies: **#29903**",
    "created_at": "2020-06-19T22:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472612",
    "user": "https://github.com/kliem"
}
```

Dependencies: **#29903**



---

archive/issue_comments_472613.json:
```json
{
    "body": "Changed commit from **[`5d79b2b`](https://github.com/sagemath/sagetrac-mirror/commit/5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987)** to **[`af2ba1f`](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)**",
    "created_at": "2020-06-19T22:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472613",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`5d79b2b`](https://github.com/sagemath/sagetrac-mirror/commit/5d79b2ba522c2f44aba5f5acbf3e5336b0b5f987)** to **[`af2ba1f`](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)**



---

archive/issue_events_408583.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-19T22:05:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408583"
}
```



---

archive/issue_comments_472614.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac\"><code>af2ba1f</code></a></td><td><code>test suite for an_affine_basis</code></td></tr></table>\n",
    "created_at": "2020-06-19T22:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472614",
    "user": "https://github.com/kliem"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac"><code>af2ba1f</code></a></td><td><code>test suite for an_affine_basis</code></td></tr></table>




---

archive/issue_comments_472615.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIs there some way to improve this test:\n\n```python\nm = matrix(b).transpose().stack(matrix([[1]*len(b)]))\n```\nIt feels somewhat inefficient as you make a matrix then take its transpose. Plus you get a new matrix with the `stack` call. Wouldn't it be better to just add 1 to each of the vectors `b` then ask for the `rank`?",
    "created_at": "2020-06-21T23:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472615",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

Is there some way to improve this test:

```python
m = matrix(b).transpose().stack(matrix([[1]*len(b)]))
```
It feels somewhat inefficient as you make a matrix then take its transpose. Plus you get a new matrix with the `stack` call. Wouldn't it be better to just add 1 to each of the vectors `b` then ask for the `rank`?



---

archive/issue_comments_472616.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIt does feel inefficient, but I think it is rather efficient (besides that it really doesn't matter as obtaining `an_affine_matrix` takes much longer than anything else here):\n\n```\nsage: P = polytopes.permutahedron(7)\n\nsage: \nsage: b = P.vertices()\nsage: len(b)\n5040\nsage: P = polytopes.permutahedron(7)\nsage: b = P.vertices()\nsage: len(b)\n5040\nsage: def hom_matrix1(b):\n....:     return matrix(b).transpose().stack(matrix([[1]*len(b)]))\n....: \nsage: def hom_matrix2(b):\n....:     return matrix([1] + list(x) for x in b)\n....: \nsage: def hom_matrix3(b):\n....:     return matrix(b).transpose().stack(vector([1]*len(b)))\n....: \n....: \nsage: %timeit hom_matrix1(b)\n10 loops, best of 5: 19.6 ms per loop\nsage: %timeit hom_matrix2(b)\n10 loops, best of 5: 23.4 ms per loop\nsage: %timeit hom_matrix3(b)\n10 loops, best of 5: 26 ms per loop\n\nsage: b = P.an_affine_basis()\nsage: len(b)\nsage: %timeit hom_matrix1(b)\nThe slowest run took 98.27 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 5: 46.1 \u00b5s per loop\nsage: %timeit hom_matrix2(b)\nThe slowest run took 12.89 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 5: 35.1 \u00b5s per loop\nsage: %timeit hom_matrix3(b)\nThe slowest run took 4.52 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 5: 103 \u00b5s per loop\n```\n\nSo it is a bit faster for small instances (which should always be true for `b` being an affine basis of any `TestSuite` polyhedron, but really not by much. Besides it is a meaningless time difference if you consider obtaining `an_affine_basis` first, even with #29841.\n\nIf you know argue that `matrix([1] + list(x) for x in b)` is much easier to understand, I agree with you and that is a good point.",
    "created_at": "2020-06-22T09:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472616",
    "user": "https://github.com/kliem"
}
```

<div id="comment:5" align="right">comment:5</div>

It does feel inefficient, but I think it is rather efficient (besides that it really doesn't matter as obtaining `an_affine_matrix` takes much longer than anything else here):

```
sage: P = polytopes.permutahedron(7)

sage: 
sage: b = P.vertices()
sage: len(b)
5040
sage: P = polytopes.permutahedron(7)
sage: b = P.vertices()
sage: len(b)
5040
sage: def hom_matrix1(b):
....:     return matrix(b).transpose().stack(matrix([[1]*len(b)]))
....: 
sage: def hom_matrix2(b):
....:     return matrix([1] + list(x) for x in b)
....: 
sage: def hom_matrix3(b):
....:     return matrix(b).transpose().stack(vector([1]*len(b)))
....: 
....: 
sage: %timeit hom_matrix1(b)
10 loops, best of 5: 19.6 ms per loop
sage: %timeit hom_matrix2(b)
10 loops, best of 5: 23.4 ms per loop
sage: %timeit hom_matrix3(b)
10 loops, best of 5: 26 ms per loop

sage: b = P.an_affine_basis()
sage: len(b)
sage: %timeit hom_matrix1(b)
The slowest run took 98.27 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 5: 46.1 µs per loop
sage: %timeit hom_matrix2(b)
The slowest run took 12.89 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 5: 35.1 µs per loop
sage: %timeit hom_matrix3(b)
The slowest run took 4.52 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 5: 103 µs per loop
```

So it is a bit faster for small instances (which should always be true for `b` being an affine basis of any `TestSuite` polyhedron, but really not by much. Besides it is a meaningless time difference if you consider obtaining `an_affine_basis` first, even with #29841.

If you know argue that `matrix([1] + list(x) for x in b)` is much easier to understand, I agree with you and that is a good point.



---

archive/issue_comments_472617.json:
```json
{
    "body": "Changed commit from **[`af2ba1f`](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)** to **[`f57e162`](https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85)**",
    "created_at": "2020-06-22T10:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472617",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`af2ba1f`](https://github.com/sagemath/sagetrac-mirror/commit/af2ba1f27e0bcfd1e46b4de0787d0b283c46cbac)** to **[`f57e162`](https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85)**



---

archive/issue_comments_472618.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85\"><code>f57e162</code></a></td><td><code>more transparent test for an_affine_basis</code></td></tr></table>\n",
    "created_at": "2020-06-22T10:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472618",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85"><code>f57e162</code></a></td><td><code>more transparent test for an_affine_basis</code></td></tr></table>




---

archive/issue_comments_472619.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2020-06-22T10:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472619",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_408584.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-06-22T10:34:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408584"
}
```



---

archive/issue_events_408585.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-06-22T10:34:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408585"
}
```



---

archive/issue_comments_472620.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nLikely in the small cases you're seeing the benefit from everything being done in Cython rather than Python. I am not sure if I would say it is easier to understand. The transpose and stacking makes it more clear how things should be grouped, but it is not as clear that things are being realized as embedding in an affine space in a vector space. However, there are less moving parts, so I think that is a bonus with changing it. Plus it is better on the memory side if someone is working with a large polytope and wants to run this test.\n\nThank you for making the change.",
    "created_at": "2020-06-22T10:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472620",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Likely in the small cases you're seeing the benefit from everything being done in Cython rather than Python. I am not sure if I would say it is easier to understand. The transpose and stacking makes it more clear how things should be grouped, but it is not as clear that things are being realized as embedding in an affine space in a vector space. However, there are less moving parts, so I think that is a bonus with changing it. Plus it is better on the memory side if someone is working with a large polytope and wants to run this test.

Thank you for making the change.



---

archive/issue_events_408586.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-08T19:33:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408586"
}
```



---

archive/issue_events_408587.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b0e01a320227f2b3c9b50f16fea068b5ae11d93a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-07-08T19:33:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29906#event-408587"
}
```



---

archive/issue_comments_472621.json:
```json
{
    "body": "Changed branch from **[public/29906](https://github.com/sagemath/sagetrac-mirror/tree/public/29906)** to **[`f57e162`](https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85)**",
    "created_at": "2020-07-08T19:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29906",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29906#issuecomment-472621",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/29906](https://github.com/sagemath/sagetrac-mirror/tree/public/29906)** to **[`f57e162`](https://github.com/sagemath/sagetrac-mirror/commit/f57e162f65b6f29c80a9e6d079cd3378cb122b85)**
