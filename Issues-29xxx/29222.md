# Issue 29222: Improvements to padic polylog

archive/issues_028985.json:
```json
{
    "body": "Two improvements for p-adic polylogarithms:\n\nPython2->3 broke range of a rational in a way that didn't trigger any doctest failures, fix it and add a doctest.\n\nAllow the user to specify the branch of the p-adic logarithm that is used, in the same way as for logarithm.\n\n**CC:**  @xcaruso\n\n**Keywords:** polylog, padic\n\n**Branch:** [528197349e2f6aee483ed2ebb5d18cc28b764ca7](https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton, David Roe\n\n**Author:** Alex J. Best\n\nIssue created by migration from https://trac.sagemath.org/ticket/29222\n\n",
    "closed_at": "2021-06-06T13:19:28Z",
    "created_at": "2020-02-19T21:02:00Z",
    "labels": [
        "component: padics",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "title": "Improvements to padic polylog",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/29222",
    "user": "https://github.com/alexjbest"
}
```
Two improvements for p-adic polylogarithms:

Python2->3 broke range of a rational in a way that didn't trigger any doctest failures, fix it and add a doctest.

Allow the user to specify the branch of the p-adic logarithm that is used, in the same way as for logarithm.

**CC:**  @xcaruso

**Keywords:** polylog, padic

**Branch:** [528197349e2f6aee483ed2ebb5d18cc28b764ca7](https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7)

**Reviewer:** Frédéric Chapoton, David Roe

**Author:** Alex J. Best

Issue created by migration from https://trac.sagemath.org/ticket/29222





---

archive/issue_events_259884.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-15T14:58:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259884"
}
```



---

archive/issue_events_259885.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-15T14:58:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259885"
}
```



---

archive/issue_comments_461076.json:
```json
{
    "body": "**Branch:** [u/alexjbest/lip](https://github.com/sagemath/sagetrac-mirror/tree/u/alexjbest/lip)",
    "created_at": "2020-04-16T22:32:18Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461076",
    "user": "https://github.com/alexjbest"
}
```

**Branch:** [u/alexjbest/lip](https://github.com/sagemath/sagetrac-mirror/tree/u/alexjbest/lip)



---

archive/issue_events_259886.json:
```json
{
    "actor": "https://github.com/alexjbest",
    "created_at": "2020-04-16T22:40:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259886"
}
```



---

archive/issue_comments_461077.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d2b3800a4697ae286f9389f36978604d54a1502\">0d2b380</a></td><td><code>fixes for polylogs</code></td></tr></table>\n",
    "created_at": "2020-04-16T22:40:39Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461077",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d2b3800a4697ae286f9389f36978604d54a1502">0d2b380</a></td><td><code>fixes for polylogs</code></td></tr></table>




---

archive/issue_comments_461078.json:
```json
{
    "body": "**Commit:** [0d2b3800a4697ae286f9389f36978604d54a1502](https://github.com/sagemath/sagetrac-mirror/commit/0d2b3800a4697ae286f9389f36978604d54a1502)",
    "created_at": "2020-04-16T22:40:39Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461078",
    "user": "https://github.com/alexjbest"
}
```

**Commit:** [0d2b3800a4697ae286f9389f36978604d54a1502](https://github.com/sagemath/sagetrac-mirror/commit/0d2b3800a4697ae286f9389f36978604d54a1502)



---

archive/issue_comments_461079.json:
```json
{
    "body": "<a id='comment:4'></a>\none failing doctest, see bot report",
    "created_at": "2020-05-17T16:27:31Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461079",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
one failing doctest, see bot report



---

archive/issue_events_259887.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-05-17T16:27:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259887"
}
```



---

archive/issue_events_259888.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-05-17T16:27:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259888"
}
```



---

archive/issue_events_259889.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-05-17T16:28:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "rename": {
        "from": "Improvements to padic poylog",
        "to": "Improvements to padic polylog"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259889"
}
```



---

archive/issue_comments_461080.json:
```json
{
    "body": "**Changing commit** from \"[0d2b3800a4697ae286f9389f36978604d54a1502](https://github.com/sagemath/sagetrac-mirror/commit/0d2b3800a4697ae286f9389f36978604d54a1502)\" to \"[e983616bfeca554868a277ff9bf99dca2853b002](https://github.com/sagemath/sagetrac-mirror/commit/e983616bfeca554868a277ff9bf99dca2853b002)\".",
    "created_at": "2020-05-17T17:27:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461080",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0d2b3800a4697ae286f9389f36978604d54a1502](https://github.com/sagemath/sagetrac-mirror/commit/0d2b3800a4697ae286f9389f36978604d54a1502)" to "[e983616bfeca554868a277ff9bf99dca2853b002](https://github.com/sagemath/sagetrac-mirror/commit/e983616bfeca554868a277ff9bf99dca2853b002)".



---

archive/issue_comments_461081.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e983616bfeca554868a277ff9bf99dca2853b002\">e983616</a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2020-05-17T17:27:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461081",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e983616bfeca554868a277ff9bf99dca2853b002">e983616</a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_comments_461082.json:
```json
{
    "body": "<a id='comment:7'></a>\nOoops how did I miss that, thanks for the heads up.",
    "created_at": "2020-05-17T17:28:26Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461082",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:7'></a>
Ooops how did I miss that, thanks for the heads up.



---

archive/issue_events_259890.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-05-22T11:59:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259890"
}
```



---

archive/issue_events_259891.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-05-22T11:59:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259891"
}
```



---

archive/issue_comments_461083.json:
```json
{
    "body": "<a id='comment:8'></a>\nrather ask an expert of the field",
    "created_at": "2020-05-22T11:59:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461083",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
rather ask an expert of the field



---

archive/issue_comments_461084.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f092ee0fb045282e2d5676576485dc95310d28dc\">f092ee0</a></td><td><code>define polylogs at 1 using duplication formula</code></td></tr></table>\n",
    "created_at": "2020-05-27T20:53:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461084",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f092ee0fb045282e2d5676576485dc95310d28dc">f092ee0</a></td><td><code>define polylogs at 1 using duplication formula</code></td></tr></table>




---

archive/issue_comments_461085.json:
```json
{
    "body": "**Changing commit** from \"[e983616bfeca554868a277ff9bf99dca2853b002](https://github.com/sagemath/sagetrac-mirror/commit/e983616bfeca554868a277ff9bf99dca2853b002)\" to \"[f092ee0fb045282e2d5676576485dc95310d28dc](https://github.com/sagemath/sagetrac-mirror/commit/f092ee0fb045282e2d5676576485dc95310d28dc)\".",
    "created_at": "2020-05-27T20:53:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461085",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e983616bfeca554868a277ff9bf99dca2853b002](https://github.com/sagemath/sagetrac-mirror/commit/e983616bfeca554868a277ff9bf99dca2853b002)" to "[f092ee0fb045282e2d5676576485dc95310d28dc](https://github.com/sagemath/sagetrac-mirror/commit/f092ee0fb045282e2d5676576485dc95310d28dc)".



---

archive/issue_comments_461086.json:
```json
{
    "body": "**Work Issues:** wait for patchbots",
    "created_at": "2020-05-27T20:54:34Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461086",
    "user": "https://github.com/alexjbest"
}
```

**Work Issues:** wait for patchbots



---

archive/issue_comments_461087.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe two new `raise ValueError` should be doctested.",
    "created_at": "2020-05-28T09:03:57Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461087",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
The two new `raise ValueError` should be doctested.



---

archive/issue_comments_461088.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/099e1faa8421c0e23fecf978397165ce89699926\">099e1fa</a></td><td><code>add test for new valueerror</code></td></tr></table>\n",
    "created_at": "2020-05-30T21:38:49Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/099e1faa8421c0e23fecf978397165ce89699926">099e1fa</a></td><td><code>add test for new valueerror</code></td></tr></table>




---

archive/issue_comments_461089.json:
```json
{
    "body": "**Changing commit** from \"[f092ee0fb045282e2d5676576485dc95310d28dc](https://github.com/sagemath/sagetrac-mirror/commit/f092ee0fb045282e2d5676576485dc95310d28dc)\" to \"[099e1faa8421c0e23fecf978397165ce89699926](https://github.com/sagemath/sagetrac-mirror/commit/099e1faa8421c0e23fecf978397165ce89699926)\".",
    "created_at": "2020-05-30T21:38:49Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f092ee0fb045282e2d5676576485dc95310d28dc](https://github.com/sagemath/sagetrac-mirror/commit/f092ee0fb045282e2d5676576485dc95310d28dc)" to "[099e1faa8421c0e23fecf978397165ce89699926](https://github.com/sagemath/sagetrac-mirror/commit/099e1faa8421c0e23fecf978397165ce89699926)".



---

archive/issue_comments_461090.json:
```json
{
    "body": "**Changing commit** from \"[099e1faa8421c0e23fecf978397165ce89699926](https://github.com/sagemath/sagetrac-mirror/commit/099e1faa8421c0e23fecf978397165ce89699926)\" to \"[c699a80a48352a18f856d0f8543c12dc6010385f](https://github.com/sagemath/sagetrac-mirror/commit/c699a80a48352a18f856d0f8543c12dc6010385f)\".",
    "created_at": "2020-05-30T21:46:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[099e1faa8421c0e23fecf978397165ce89699926](https://github.com/sagemath/sagetrac-mirror/commit/099e1faa8421c0e23fecf978397165ce89699926)" to "[c699a80a48352a18f856d0f8543c12dc6010385f](https://github.com/sagemath/sagetrac-mirror/commit/c699a80a48352a18f856d0f8543c12dc6010385f)".



---

archive/issue_comments_461091.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c699a80a48352a18f856d0f8543c12dc6010385f\">c699a80</a></td><td><code>other valueerror</code></td></tr></table>\n",
    "created_at": "2020-05-30T21:46:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461091",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c699a80a48352a18f856d0f8543c12dc6010385f">c699a80</a></td><td><code>other valueerror</code></td></tr></table>




---

archive/issue_comments_461092.json:
```json
{
    "body": "<a id='comment:14'></a>\none doctest for the ValueError does not pass, and seems to trigger the other one instead",
    "created_at": "2020-06-04T19:06:09Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461092",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
one doctest for the ValueError does not pass, and seems to trigger the other one instead



---

archive/issue_events_259892.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-07-02T19:48:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259892"
}
```



---

archive/issue_events_259893.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-07-02T19:48:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259893"
}
```



---

archive/issue_events_259894.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259894"
}
```



---

archive/issue_events_259895.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259895"
}
```



---

archive/issue_comments_461093.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c046b390e4dc6b21c729a9836bf015426870dd98\">c046b39</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage into lip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17099aba137872f8ccb9f19a0ec9429e92df0f4a\">17099ab</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into lip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de\">e0abdc0</a></td><td><code>use numerical comparisons for logs, fix doctests</code></td></tr></table>\n",
    "created_at": "2020-10-20T20:39:43Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461093",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c046b390e4dc6b21c729a9836bf015426870dd98">c046b39</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage into lip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17099aba137872f8ccb9f19a0ec9429e92df0f4a">17099ab</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into lip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de">e0abdc0</a></td><td><code>use numerical comparisons for logs, fix doctests</code></td></tr></table>




---

archive/issue_comments_461094.json:
```json
{
    "body": "**Changing commit** from \"[c699a80a48352a18f856d0f8543c12dc6010385f](https://github.com/sagemath/sagetrac-mirror/commit/c699a80a48352a18f856d0f8543c12dc6010385f)\" to \"[e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de](https://github.com/sagemath/sagetrac-mirror/commit/e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de)\".",
    "created_at": "2020-10-20T20:39:43Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c699a80a48352a18f856d0f8543c12dc6010385f](https://github.com/sagemath/sagetrac-mirror/commit/c699a80a48352a18f856d0f8543c12dc6010385f)" to "[e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de](https://github.com/sagemath/sagetrac-mirror/commit/e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de)".



---

archive/issue_comments_461095.json:
```json
{
    "body": "<a id='comment:18'></a>\nThere appears to be some memory leak type problems with the polylog functions as the code\n\n```\nfor p in prime_range(100):\n    K = Qp(p,prec=10)\n    print(p)\n    for t in K.teichmuller_system():\n        if t == 1:      \n            continue    \n        l = t.polylog(2)\n        print(p,l)\n```\neats more and more memory which isn't freed at the end.\n\nI don't think these problems were necessarily introduced in this ticket, but nevertheless I'd like to diagnose them if anyone has any suggestions how to find the leaks or advice about likely culprits in the code.",
    "created_at": "2020-10-20T21:45:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461095",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:18'></a>
There appears to be some memory leak type problems with the polylog functions as the code

```
for p in prime_range(100):
    K = Qp(p,prec=10)
    print(p)
    for t in K.teichmuller_system():
        if t == 1:      
            continue    
        l = t.polylog(2)
        print(p,l)
```
eats more and more memory which isn't freed at the end.

I don't think these problems were necessarily introduced in this ticket, but nevertheless I'd like to diagnose them if anyone has any suggestions how to find the leaks or advice about likely culprits in the code.



---

archive/issue_comments_461096.json:
```json
{
    "body": "**Changing work issues** from \"wait for patchbots\" to \"fix leaks?\".",
    "created_at": "2020-10-20T21:45:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461096",
    "user": "https://github.com/alexjbest"
}
```

**Changing work issues** from "wait for patchbots" to "fix leaks?".



---

archive/issue_events_259896.json:
```json
{
    "actor": "https://github.com/alexjbest",
    "created_at": "2020-10-20T21:45:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259896"
}
```



---

archive/issue_events_259897.json:
```json
{
    "actor": "https://github.com/alexjbest",
    "created_at": "2020-10-20T21:45:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259897"
}
```



---

archive/issue_comments_461097.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7\">5281973</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into lip</code></td></tr></table>\n",
    "created_at": "2020-10-20T21:50:14Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461097",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7">5281973</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into lip</code></td></tr></table>




---

archive/issue_comments_461098.json:
```json
{
    "body": "**Changing commit** from \"[e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de](https://github.com/sagemath/sagetrac-mirror/commit/e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de)\" to \"[528197349e2f6aee483ed2ebb5d18cc28b764ca7](https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7)\".",
    "created_at": "2020-10-20T21:50:14Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461098",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de](https://github.com/sagemath/sagetrac-mirror/commit/e0abdc0f7fe0aff9c7677430fcd1518ee55fe8de)" to "[528197349e2f6aee483ed2ebb5d18cc28b764ca7](https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7)".



---

archive/issue_comments_461099.json:
```json
{
    "body": "<a id='comment:20'></a>\nThe memory leaks could be the same issue as #27536 it appears there are many `sage.rings.real_mpfr.RealNumber` left on the heap.",
    "created_at": "2020-11-13T22:14:28Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461099",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:20'></a>
The memory leaks could be the same issue as #27536 it appears there are many `sage.rings.real_mpfr.RealNumber` left on the heap.



---

archive/issue_events_259898.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259898"
}
```



---

archive/issue_events_259899.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259899"
}
```



---

archive/issue_comments_461100.json:
```json
{
    "body": "<a id='comment:21'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461100",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_259900.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2021-04-28T21:08:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259900"
}
```



---

archive/issue_events_259901.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2021-04-28T21:08:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259901"
}
```



---

archive/issue_comments_461101.json:
```json
{
    "body": "<a id='comment:22'></a>\nOverall this looks good to me.\n\nHave you made any progress on the memory leak?  I don't have any suggestions off the top of my head.  I think it's fine to create another ticket for that issue.\n\nYou use the `.n()` numerical approximation extensively.  Would it be better to specify the precision of the real field to use?  I'm also not sure if people like seeing the symbolic expression in some cases.  Maybe have a precision parameter that defaults to 53, but if it's set to None uses symbolic logs?\n\nI'm happy giving this a positive review if you don't want to work on either of these.",
    "created_at": "2021-04-28T21:08:58Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461101",
    "user": "https://github.com/roed314"
}
```

<a id='comment:22'></a>
Overall this looks good to me.

Have you made any progress on the memory leak?  I don't have any suggestions off the top of my head.  I think it's fine to create another ticket for that issue.

You use the `.n()` numerical approximation extensively.  Would it be better to specify the precision of the real field to use?  I'm also not sure if people like seeing the symbolic expression in some cases.  Maybe have a precision parameter that defaults to 53, but if it's set to None uses symbolic logs?

I'm happy giving this a positive review if you don't want to work on either of these.



---

archive/issue_comments_461102.json:
```json
{
    "body": "**Reviewer:** Frederic Chapoton, David Roe",
    "created_at": "2021-04-28T21:08:58Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461102",
    "user": "https://github.com/roed314"
}
```

**Reviewer:** Frederic Chapoton, David Roe



---

archive/issue_comments_461103.json:
```json
{
    "body": "<a id='comment:23'></a>\nI haven't made progress on the leak, #27536 seems to have stalled too, so I think your suggestion of merging this as is and making a separate ticket sounds good.\n\nMost of the `.n()` parts are just for determining various cutoffs for correct precision bounds, for most of these numbers only the integer part of the result matters.\nI doubt anyone would want to look at them symbolically, or that more than 53 digits of precision would be needed. The motivation for the numerical approximations was that a lot of time was being wasted comparing various symbolic expressions to see which is larger, when comparing numerical approximations was far faster.\nI could write these sorts of things as `RR(gsl-1).log(p)` instead I suppose, but I don't think it would make too much difference?\n\nSo I don't propose making further changes, unless you have more thoughts on these two issues mentioned of course!",
    "created_at": "2021-05-10T22:51:36Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461103",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:23'></a>
I haven't made progress on the leak, #27536 seems to have stalled too, so I think your suggestion of merging this as is and making a separate ticket sounds good.

Most of the `.n()` parts are just for determining various cutoffs for correct precision bounds, for most of these numbers only the integer part of the result matters.
I doubt anyone would want to look at them symbolically, or that more than 53 digits of precision would be needed. The motivation for the numerical approximations was that a lot of time was being wasted comparing various symbolic expressions to see which is larger, when comparing numerical approximations was far faster.
I could write these sorts of things as `RR(gsl-1).log(p)` instead I suppose, but I don't think it would make too much difference?

So I don't propose making further changes, unless you have more thoughts on these two issues mentioned of course!



---

archive/issue_comments_461104.json:
```json
{
    "body": "<a id='comment:24'></a>\nSounds good to me.",
    "created_at": "2021-05-14T18:15:00Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461104",
    "user": "https://github.com/roed314"
}
```

<a id='comment:24'></a>
Sounds good to me.



---

archive/issue_comments_461105.json:
```json
{
    "body": "**Changing work issues** from \"fix leaks?\" to \"\".",
    "created_at": "2021-05-14T18:15:00Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461105",
    "user": "https://github.com/roed314"
}
```

**Changing work issues** from "fix leaks?" to "".



---

archive/issue_events_259902.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2021-05-14T18:15:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259902"
}
```



---

archive/issue_events_259903.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2021-05-14T18:15:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259903"
}
```



---

archive/issue_comments_461106.json:
```json
{
    "body": "<a id='comment:25'></a>\nLeak issue now tracked at #31826.",
    "created_at": "2021-05-15T11:37:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461106",
    "user": "https://github.com/slel"
}
```

<a id='comment:25'></a>
Leak issue now tracked at #31826.



---

archive/issue_events_259904.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-06T13:19:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259904"
}
```



---

archive/issue_events_259905.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "9f031cdb059a45622cc2791f68a78e230d2c86f8",
    "created_at": "2021-06-06T13:19:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29222#event-259905"
}
```



---

archive/issue_comments_461107.json:
```json
{
    "body": "**Changing branch** from \"[u/alexjbest/lip](https://github.com/sagemath/sagetrac-mirror/tree/u/alexjbest/lip)\" to \"[528197349e2f6aee483ed2ebb5d18cc28b764ca7](https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7)\".",
    "created_at": "2021-06-06T13:19:28Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461107",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/alexjbest/lip](https://github.com/sagemath/sagetrac-mirror/tree/u/alexjbest/lip)" to "[528197349e2f6aee483ed2ebb5d18cc28b764ca7](https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7)".



---

archive/issue_comments_461108.json:
```json
{
    "body": "**Changing commit** from \"[528197349e2f6aee483ed2ebb5d18cc28b764ca7](https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7)\" to \"\".",
    "created_at": "2021-08-22T20:45:20Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461108",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[528197349e2f6aee483ed2ebb5d18cc28b764ca7](https://github.com/sagemath/sagetrac-mirror/commit/528197349e2f6aee483ed2ebb5d18cc28b764ca7)" to "".



---

archive/issue_comments_461109.json:
```json
{
    "body": "**Changing reviewer** from \"Frederic Chapoton, David Roe\" to \"Fr\u00e9d\u00e9ric Chapoton, David Roe\".",
    "created_at": "2021-08-22T20:45:20Z",
    "issue": "https://github.com/sagemath/sage/issues/29222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29222#issuecomment-461109",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Frederic Chapoton, David Roe" to "Frédéric Chapoton, David Roe".
