# Issue 29355: Sagelib's scripts in src/bin should not use build/bin/sage-system-python; remove sage-pypkg-location

archive/issues_029118.json:
```json
{
    "body": "In previous tickets we have moved sage-the-distribution scripts out of `src/bin`.\n\nSome scripts that are (correctly) located in `src/bin` use `sage-system-python`, which is in `build/bin` and not installed and not available in distributions.\n\n```\nsrc/bin/sage-coverage:1:#!/usr/bin/env sage-system-python\nsrc/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python\nsrc/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python\nsrc/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python\n```\n\nWe change `sage-coverage*` to just use `python3`. If Sage's venv is in the front of the PATH, this is Sage's python. But these scripts work with \"any python3\", it does not have to be the one in which sage is installed.\n\nWe remove `src/bin/sage-pypkg-location`, which is undocumented and unused.\n\nWe move `src/bin/sage-num-threads.py` to `build/bin/sage-build-num-threads` (where it keeps using `sage-system-python`), leaving a much simplified version `src/bin/sage-num-threads.py` (which is using `python3`) behind.\n\nCC:  @dimpase @jhpalmieri @kiwifb @orlitzky @vbraun\n\nReviewer: Dima Pasechnik, S\u00e9bastien Labb\u00e9\n\nAuthor: Matthias Koeppe\n\nBranch: u/mkoeppe/sagelib_s_scripts_in_src_bin_should_not_use_build_bin_sage_system_python__remove_sage_pypkg_location\n\nCommit: a4e757e65628505736c69918c10e274b09469840\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29355\n\n",
    "closed_at": "2020-12-14T18:37:27Z",
    "created_at": "2020-03-17T23:46:43Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Sagelib's scripts in src/bin should not use build/bin/sage-system-python; remove sage-pypkg-location",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29355",
    "user": "https://github.com/mkoeppe"
}
```
In previous tickets we have moved sage-the-distribution scripts out of `src/bin`.

Some scripts that are (correctly) located in `src/bin` use `sage-system-python`, which is in `build/bin` and not installed and not available in distributions.

```
src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python
src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python
src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python
src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python
```

We change `sage-coverage*` to just use `python3`. If Sage's venv is in the front of the PATH, this is Sage's python. But these scripts work with "any python3", it does not have to be the one in which sage is installed.

We remove `src/bin/sage-pypkg-location`, which is undocumented and unused.

We move `src/bin/sage-num-threads.py` to `build/bin/sage-build-num-threads` (where it keeps using `sage-system-python`), leaving a much simplified version `src/bin/sage-num-threads.py` (which is using `python3`) behind.

CC:  @dimpase @jhpalmieri @kiwifb @orlitzky @vbraun

Reviewer: Dima Pasechnik, Sébastien Labbé

Author: Matthias Koeppe

Branch: u/mkoeppe/sagelib_s_scripts_in_src_bin_should_not_use_build_bin_sage_system_python__remove_sage_pypkg_location

Commit: a4e757e65628505736c69918c10e274b09469840

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29355





---

archive/issue_comments_438988.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -3,7 +3,20 @@\n This will require changes to some scripts in \\`src/bin\\`:\n \n \\`\\`\\`\n-src/bin/sage-pkg\n+This directory contains executables needed during building sage-the-distribution only. It should only be added to \\`PATH\\` by \\`sage-build-env\\` (see #29052 for \\`sage-build-env-config\\`).\n+\n+This will require changes to some scripts in \\`src/bin\\`:\n+{{{\n+src/bin/sage-pkg:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-unzip:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python\n+}}}\n+each of which should either be moved to \\`build/bin\\` (#21559) or changed to use the Sage python instead (#29090).\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2020-03-18T01:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438988",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -3,7 +3,20 @@
 This will require changes to some scripts in \`src/bin\`:
 
 \`\`\`
-src/bin/sage-pkg
+This directory contains executables needed during building sage-the-distribution only. It should only be added to \`PATH\` by \`sage-build-env\` (see #29052 for \`sage-build-env-config\`).
+
+This will require changes to some scripts in \`src/bin\`:
+{{{
+src/bin/sage-pkg:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python
+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-unzip:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python
+src/bin/sage-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python
+}}}
+each of which should either be moved to \`build/bin\` (#21559) or changed to use the Sage python instead (#29090).
+
 
 Comment: 1
 
```




---

archive/issue_comments_438989.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+This directory contains executables needed during building sage-the-distribution only. It should only be added to \\`PATH\\` by \\`sage-build-env\\` (see #29052 for \\`sage-build-env-config\\`).\n+\n+This will require changes to some scripts in \\`src/bin\\`:\n+\n+\\`\\`\\`\n+src/bin/sage-pkg:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-unzip:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python\n+\\`\\`\\`\n+each of which should either be moved to \\`build/bin\\` (#21559) or changed to use the Sage python instead (#29090).\n \n \n Comment: 1\n```\n",
    "created_at": "2020-03-18T01:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438989",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+This directory contains executables needed during building sage-the-distribution only. It should only be added to \`PATH\` by \`sage-build-env\` (see #29052 for \`sage-build-env-config\`).
+
+This will require changes to some scripts in \`src/bin\`:
+
+\`\`\`
+src/bin/sage-pkg:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python
+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-unzip:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python
+src/bin/sage-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python
+\`\`\`
+each of which should either be moved to \`build/bin\` (#21559) or changed to use the Sage python instead (#29090).
 
 
 Comment: 1
```




---

archive/issue_comments_438990.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+This directory contains executables needed during building sage-the-distribution only. It should only be added to \\`PATH\\` by \\`sage-build-env\\` (see #29052 for \\`sage-build-env-config\\`).\n+\n+This will require changes to some scripts in \\`src/bin\\`:\n+\n+\\`\\`\\`\n+src/bin/sage-pkg:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-unzip:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python\n+\\`\\`\\`\n+each of which should either be moved to \\`build/bin\\` or deleted (#21559) or changed to use the Sage python instead (#29090).\n \n \n Comment: 1\n```\n",
    "created_at": "2020-03-18T04:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438990",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+This directory contains executables needed during building sage-the-distribution only. It should only be added to \`PATH\` by \`sage-build-env\` (see #29052 for \`sage-build-env-config\`).
+
+This will require changes to some scripts in \`src/bin\`:
+
+\`\`\`
+src/bin/sage-pkg:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python
+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-unzip:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python
+src/bin/sage-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python
+\`\`\`
+each of which should either be moved to \`build/bin\` or deleted (#21559) or changed to use the Sage python instead (#29090).
 
 
 Comment: 1
```




---

archive/issue_events_074748.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:15:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29355#event-74748"
}
```



---

archive/issue_events_074749.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29355#event-74749"
}
```



---

archive/issue_events_074750.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29355#event-74750"
}
```



---

archive/issue_comments_438991.json:
```json
{
    "body": "<a id='comment:6'></a>#29951 will only put `$SAGE_ROOT/bin` in `$PATH` if `$SAGE_ROOT` is set and readable.\n\nRepurposing this ticket to change scripts in `src/bin` to not use `sage-system-python` (which is in `build/bin` and not installed and not available in distributions).",
    "created_at": "2020-09-18T22:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438991",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>#29951 will only put `$SAGE_ROOT/bin` in `$PATH` if `$SAGE_ROOT` is set and readable.

Repurposing this ticket to change scripts in `src/bin` to not use `sage-system-python` (which is in `build/bin` and not installed and not available in distributions).



---

archive/issue_events_074751.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-18T22:24:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29355#event-74751"
}
```



---

archive/issue_events_074752.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-18T22:24:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29355#event-74752"
}
```



---

archive/issue_comments_438992.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,19 @@\n+In previous tickets we have moved sage-the-distribution scripts out of \\`src/bin\\`.\n+\n+Some scripts that are (correctly) located in \\`src/bin\\` use \\`sage-system-python\\`, which is in \\`build/bin\\` and not installed and not available in distributions.\n+\n+We change them to just \\`python3\\`. If Sage's venv is in the front of the PATH, this is Sage's python. But these scripts work with \"any python3\", it does not have to be the one in which sage is installed.\n+\n+\\`\\`\\`\n+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python\n+\\`\\`\\`\n+\n+We also remove \\`src/bin/sage-pypkg-location\\`, which is undocumented and unused.\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-09-18T22:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438992",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,19 @@
+In previous tickets we have moved sage-the-distribution scripts out of \`src/bin\`.
+
+Some scripts that are (correctly) located in \`src/bin\` use \`sage-system-python\`, which is in \`build/bin\` and not installed and not available in distributions.
+
+We change them to just \`python3\`. If Sage's venv is in the front of the PATH, this is Sage's python. But these scripts work with "any python3", it does not have to be the one in which sage is installed.
+
+\`\`\`
+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python
+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python
+src/bin/sage-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python
+\`\`\`
+
+We also remove \`src/bin/sage-pypkg-location\`, which is undocumented and unused.
+
 
 
 Comment: 1
```




---

archive/issue_comments_438993.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,18 @@\n+In previous tickets we have moved sage-the-distribution scripts out of \\`src/bin\\`.\n+\n+Some scripts that are (correctly) located in \\`src/bin\\` use \\`sage-system-python\\`, which is in \\`build/bin\\` and not installed and not available in distributions.\n+\n+We change them to just \\`python3\\`. If Sage's venv is in the front of the PATH, this is Sage's python. But these scripts work with \"any python3\", it does not have to be the one in which sage is installed.\n+\n+\\`\\`\\`\n+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python\n+\\`\\`\\`\n+\n+We also remove \\`src/bin/sage-pypkg-location\\`, which is undocumented and unused.\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2020-09-18T22:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438993",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,18 @@
+In previous tickets we have moved sage-the-distribution scripts out of \`src/bin\`.
+
+Some scripts that are (correctly) located in \`src/bin\` use \`sage-system-python\`, which is in \`build/bin\` and not installed and not available in distributions.
+
+We change them to just \`python3\`. If Sage's venv is in the front of the PATH, this is Sage's python. But these scripts work with "any python3", it does not have to be the one in which sage is installed.
+
+\`\`\`
+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python
+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python
+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python
+\`\`\`
+
+We also remove \`src/bin/sage-pypkg-location\`, which is undocumented and unused.
+
 
 
 Comment: 1
```




---

archive/issue_comments_438994.json:
```json
{
    "body": "<a id='comment:9'></a>New commits:",
    "created_at": "2020-09-18T22:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438994",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>New commits:



---

archive/issue_comments_438995.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-18T22:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438995",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438996.json:
```json
{
    "body": "<a id='comment:11'></a>`sage-num-threads.py` gets used in the build process, I think: it gets used in `src/bin/sage-env`. So I think this change will break building on systems with no Python 3 anywhere. Do we need to support such systems?",
    "created_at": "2020-09-21T20:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438996",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>`sage-num-threads.py` gets used in the build process, I think: it gets used in `src/bin/sage-env`. So I think this change will break building on systems with no Python 3 anywhere. Do we need to support such systems?



---

archive/issue_comments_438997.json:
```json
{
    "body": "<a id='comment:12'></a>Thanks for catching this. This needs some thought",
    "created_at": "2020-09-21T20:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438997",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Thanks for catching this. This needs some thought



---

archive/issue_comments_438998.json:
```json
{
    "body": "<a id='comment:13'></a>I think the issue is that the line between build scripts and runtime scripts is blurred. sage-env and sage-num-threads.py, maybe others?",
    "created_at": "2020-09-21T20:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438998",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>I think the issue is that the line between build scripts and runtime scripts is blurred. sage-env and sage-num-threads.py, maybe others?



---

archive/issue_comments_438999.json:
```json
{
    "body": "<a id='comment:14'></a>Yes, I agree, I think the solution is to split the build-specific parts (parsing MAKEFLAGS) out from `sage-num-threads.py`. I'll work on it.",
    "created_at": "2020-09-21T20:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-438999",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Yes, I agree, I think the solution is to split the build-specific parts (parsing MAKEFLAGS) out from `sage-num-threads.py`. I'll work on it.



---

archive/issue_comments_439000.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-21T21:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439000",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_439001.json:
```json
{
    "body": "<a id='comment:16'></a>Sounds good to me.",
    "created_at": "2020-09-21T22:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439001",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>Sounds good to me.



---

archive/issue_comments_439002.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-22T00:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439002",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439003.json:
```json
{
    "body": "<a id='comment:18'></a>In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.",
    "created_at": "2020-09-22T00:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439003",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.



---

archive/issue_comments_439004.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-22T00:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439004",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_439005.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+In previous tickets we have moved sage-the-distribution scripts out of \\`src/bin\\`.\n \n+Some scripts that are (correctly) located in \\`src/bin\\` use \\`sage-system-python\\`, which is in \\`build/bin\\` and not installed and not available in distributions.\n+\n+\\`\\`\\`\n+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python\n+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python\n+\\`\\`\\`\n+\n+We change \\`sage-coverage*\\` to just use \\`python3\\`. If Sage's venv is in the front of the PATH, this is Sage's python. But these scripts work with \"any python3\", it does not have to be the one in which sage is installed.\n+\n+We remove \\`src/bin/sage-pypkg-location\\`, which is undocumented and unused.\n+\n+We move \\`src/bin/sage-num-threads.py\\` to \\`build/bin/sage-build-num-threads\\` (where it keeps using \\`sage-system-python\\`), leaving a much simplified version \\`src/bin/sage-num-threads.py\\` (which is using \\`python3\\`) behind.\n \n Comment: 1\n \n```\n",
    "created_at": "2020-09-22T00:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439005",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+In previous tickets we have moved sage-the-distribution scripts out of \`src/bin\`.
 
+Some scripts that are (correctly) located in \`src/bin\` use \`sage-system-python\`, which is in \`build/bin\` and not installed and not available in distributions.
+
+\`\`\`
+src/bin/sage-coverage:1:#!/usr/bin/env sage-system-python
+src/bin/sage-pypkg-location:1:#!/usr/bin/env sage-system-python
+src/bin/sage-coverageall:1:#!/usr/bin/env sage-system-python
+src/bin/sage-num-threads.py:1:#!/usr/bin/env sage-system-python
+\`\`\`
+
+We change \`sage-coverage*\` to just use \`python3\`. If Sage's venv is in the front of the PATH, this is Sage's python. But these scripts work with "any python3", it does not have to be the one in which sage is installed.
+
+We remove \`src/bin/sage-pypkg-location\`, which is undocumented and unused.
+
+We move \`src/bin/sage-num-threads.py\` to \`build/bin/sage-build-num-threads\` (where it keeps using \`sage-system-python\`), leaving a much simplified version \`src/bin/sage-num-threads.py\` (which is using \`python3\`) behind.
 
 Comment: 1
 
```




---

archive/issue_comments_439006.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 mkoeppe]:\n> In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.\n\n\nI have opened #30639 for that.",
    "created_at": "2020-09-23T04:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439006",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Replying to [comment:18 mkoeppe]:
> In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.


I have opened #30639 for that.



---

archive/issue_comments_439007.json:
```json
{
    "body": "<a id='comment:21'></a>I should probably know the answer to this, but is there a promise that \"python3\" is the official name for the python interpreter in the future? After 2.x is completely dead, they're not going to change it back to \"python\"?\n\n(This is also relevant when we're searching for (only) a system \"python3\")",
    "created_at": "2020-09-25T14:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439007",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:21'></a>I should probably know the answer to this, but is there a promise that "python3" is the official name for the python interpreter in the future? After 2.x is completely dead, they're not going to change it back to "python"?

(This is also relevant when we're searching for (only) a system "python3")



---

archive/issue_comments_439008.json:
```json
{
    "body": "<a id='comment:22'></a>The name \"python3\" should be OK for a long time:\n\n* https://www.python.org/dev/peps/pep-0394/\n* https://lwn.net/Articles/780737/",
    "created_at": "2020-09-25T14:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439008",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:22'></a>The name "python3" should be OK for a long time:

* https://www.python.org/dev/peps/pep-0394/
* https://lwn.net/Articles/780737/



---

archive/issue_comments_439009.json:
```json
{
    "body": "<a id='comment:23'></a>and https://twitter.com/gvanrossum/status/1306082472443084801",
    "created_at": "2020-09-25T15:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439009",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>and https://twitter.com/gvanrossum/status/1306082472443084801



---

archive/issue_comments_439010.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-02T02:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439010",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439011.json:
```json
{
    "body": "<a id='comment:25'></a>Needs review",
    "created_at": "2020-10-02T18:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439011",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Needs review



---

archive/issue_events_074753.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29355#event-74753"
}
```



---

archive/issue_events_074754.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29355#event-74754"
}
```



---

archive/issue_comments_439012.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-01T19:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439013.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-01T19:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439014.json:
```json
{
    "body": "<a id='comment:29'></a>Can we please get this ticket in?",
    "created_at": "2020-11-02T21:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439014",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Can we please get this ticket in?



---

archive/issue_comments_439015.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-03T17:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439015",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439016.json:
```json
{
    "body": "<a id='comment:30'></a>lgtm",
    "created_at": "2020-11-03T17:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439016",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>lgtm



---

archive/issue_comments_439017.json:
```json
{
    "body": "<a id='comment:31'></a>Thanks!",
    "created_at": "2020-11-03T17:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439017",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Thanks!



---

archive/issue_comments_439018.json:
```json
{
    "body": "<a id='comment:32'></a>I was currently checking it also. So, I confirm that `sage -coverage` and `sage -coverageall` still work. Also, `sage-num-threads.py` still seems to work:\n\n```\n(sage-sh) $ echo $SAGE_NUM_THREADS\n1\n(sage-sh) $ echo $SAGE_NUM_THREADS_PARALLEL\n8\n```\n\nor the above were defined from `build/make/install`?\n\nAnyway, I have:\n\n```\nsage: import os                                                                 \nsage: os.environ['SAGE_NUM_THREADS']                                            \n'1'\nsage: os.environ['SAGE_NUM_THREADS_PARALLEL']                                   \n'8'\n```\n\npositive review!",
    "created_at": "2020-11-03T20:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439018",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:32'></a>I was currently checking it also. So, I confirm that `sage -coverage` and `sage -coverageall` still work. Also, `sage-num-threads.py` still seems to work:

```
(sage-sh) $ echo $SAGE_NUM_THREADS
1
(sage-sh) $ echo $SAGE_NUM_THREADS_PARALLEL
8
```

or the above were defined from `build/make/install`?

Anyway, I have:

```
sage: import os                                                                 
sage: os.environ['SAGE_NUM_THREADS']                                            
'1'
sage: os.environ['SAGE_NUM_THREADS_PARALLEL']                                   
'8'
```

positive review!



---

archive/issue_events_074755.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-14T18:37:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29355#event-74755"
}
```



---

archive/issue_comments_439019.json:
```json
{
    "body": "<a id='comment:33'></a>Looks like this ticket was merged as part of #30627.",
    "created_at": "2020-12-14T18:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439019",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Looks like this ticket was merged as part of #30627.



---

archive/issue_comments_439020.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-14T18:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29355#issuecomment-439020",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: fixed
