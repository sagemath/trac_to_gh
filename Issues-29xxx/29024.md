# Issue 29024: spkg-configure.m4 for singular

archive/issues_028787.json:
```json
{
    "body": "1. For singular, the location of the dynamic library needs to be communicated to the sage runtime.\n\n   We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. \n\n   The filename can be found from `src/Singular/libSingular.la` (currently not installed): \n\n  ```\n  # The name that we can dlopen(3).\n  dlname='libSingular-4.1.1.dylib'\n  ...\n  # Directory that this library needs to be installed in:\n  libdir='/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib'\n```\n\n  This will:\n- reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),\n\n- enable venv builds of sagelib (#30578, #29013) -- for which `_get_shared_lib_filename` is wrong\n\n- provide preparation for adding an `spkg-configure.m4` for `singular`.\n\n\n2. `src/bin/sage-env` unconditionally sets environment variable `SINGULARPATH=\"$SAGE_LOCAL/share/singular\"` \n\n   If `SINGULARPATH` is already set by the user, perhaps the directory in $SAGE_LOCAL should be prepended instead of overwriting it.\n\n   (After #32254, `SINGULARPATH` is only used by `qepcad` -- this last use should be removed in #31275.)\n\n\n3. `src/bin/sage-env` unconditionally sets environment variable `SINGULAR_EXECUTABLE=\"$SAGE_LOCAL/bin/Singular\"`.  \n\n   It should be investigated whether this is actually needed in any supported configuration. If not, remove. \n\n   (Removed in #32302.)\n\n4. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):\n\n```\nsingular_docdir = SINGULARPATH + \"/../info/\"\n```\n\n  This should be fixed so that it works when `SINGULARPATH` is set by a user to a colon-separated list.\n\n  (Solved in #32254 - Obtain singular.hlp location via libsingular_resources)\n\n\n\n**CC:**  @dimpase @kiwifb @slel @isuruf @orlitzky @tobiasdiez @antonio-rojas @dkwo\n\n**Keywords:** sd111\n\n**Branch:** [f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023](https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023)\n\n**Upstream:** Reported upstream. No feedback yet.\n\n**Reviewer:** Dima Pasechnik, Matthias Koeppe\n\n**Author:** Michael Orlitzky, Samuel Leli\u00e8vre\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29024\n\n",
    "closed_at": "2021-10-24T18:39:14Z",
    "created_at": "2020-01-16T01:50:10Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "spkg-configure.m4 for singular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29024",
    "user": "https://github.com/mkoeppe"
}
```
1. For singular, the location of the dynamic library needs to be communicated to the sage runtime.

   We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. 

   The filename can be found from `src/Singular/libSingular.la` (currently not installed): 

  ```
  # The name that we can dlopen(3).
  dlname='libSingular-4.1.1.dylib'
  ...
  # Directory that this library needs to be installed in:
  libdir='/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib'
```

  This will:
- reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),

- enable venv builds of sagelib (#30578, #29013) -- for which `_get_shared_lib_filename` is wrong

- provide preparation for adding an `spkg-configure.m4` for `singular`.


2. `src/bin/sage-env` unconditionally sets environment variable `SINGULARPATH="$SAGE_LOCAL/share/singular"` 

   If `SINGULARPATH` is already set by the user, perhaps the directory in $SAGE_LOCAL should be prepended instead of overwriting it.

   (After #32254, `SINGULARPATH` is only used by `qepcad` -- this last use should be removed in #31275.)


3. `src/bin/sage-env` unconditionally sets environment variable `SINGULAR_EXECUTABLE="$SAGE_LOCAL/bin/Singular"`.  

   It should be investigated whether this is actually needed in any supported configuration. If not, remove. 

   (Removed in #32302.)

4. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):

```
singular_docdir = SINGULARPATH + "/../info/"
```

  This should be fixed so that it works when `SINGULARPATH` is set by a user to a colon-separated list.

  (Solved in #32254 - Obtain singular.hlp location via libsingular_resources)



**CC:**  @dimpase @kiwifb @slel @isuruf @orlitzky @tobiasdiez @antonio-rojas @dkwo

**Keywords:** sd111

**Branch:** [f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023](https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023)

**Upstream:** Reported upstream. No feedback yet.

**Reviewer:** Dima Pasechnik, Matthias Koeppe

**Author:** Michael Orlitzky, Samuel Leli√®vre

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/29024





---

archive/issue_comments_565331.json:
```json
{
    "body": "<a id='comment:1'></a>\nWhich versions of singular are good?",
    "created_at": "2020-01-16T03:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565331",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
Which versions of singular are good?



---

archive/issue_comments_565332.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [mkoeppe](#comment%3A1):\n> Which versions of singular are good?\n\n\nSage does not currently work correctly with any version of Singular, see #25993.",
    "created_at": "2020-01-16T07:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565332",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:2'></a>
Replying to [mkoeppe](#comment%3A1):
> Which versions of singular are good?


Sage does not currently work correctly with any version of Singular, see #25993.



---

archive/issue_comments_565333.json:
```json
{
    "body": "<a id='comment:3'></a>\nwell, Debian does have a Singular version which is compatible with their Sage package (v8.6 or so, I guess).",
    "created_at": "2020-01-16T11:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565333",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
well, Debian does have a Singular version which is compatible with their Sage package (v8.6 or so, I guess).



---

archive/issue_comments_565334.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks for the info. I'll check back when #25993 is done.",
    "created_at": "2020-01-16T16:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565334",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Thanks for the info. I'll check back when #25993 is done.



---

archive/issue_events_083010.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-16T16:00:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83010"
}
```



---

archive/issue_comments_565335.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis ticket should be listed in #27330 (ATM singular is listed in \"No Tickets yet\").",
    "created_at": "2020-04-16T12:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565335",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:5'></a>
This ticket should be listed in #27330 (ATM singular is listed in "No Tickets yet").



---

archive/issue_comments_565336.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [gh-thierry-FreeBSD](#comment%3A5):\n> This ticket should be listed in #27330 (ATM singular is listed in \"No Tickets yet\").\n\nI've added it",
    "created_at": "2020-04-16T13:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565336",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Replying to [gh-thierry-FreeBSD](#comment%3A5):
> This ticket should be listed in #27330 (ATM singular is listed in "No Tickets yet").

I've added it



---

archive/attachments_021294.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "spkg-configure.m4",
    "asset_url": "tarball://root/attachments/some-uuid/ticket29024/spkg-configure.m4",
    "created_at": "2020-04-17T15:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.m4",
    "user": "https://github.com/thierry-FreeBSD"
}
```



---

archive/issue_comments_565337.json:
```json
{
    "body": "spkg-configure.m4 to be put under /build/pkgs/singular/",
    "created_at": "2020-04-17T15:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565337",
    "user": "https://github.com/thierry-FreeBSD"
}
```

spkg-configure.m4 to be put under /build/pkgs/singular/



---

archive/issue_comments_565338.json:
```json
{
    "body": "<a id='comment:8'></a>\n[Copying elements from #29024]\n\n- my 1st problem was a build failure with Singular taken from an external package: to solve it, Singular must be built `--with-ntl`: it would be fine to add this check to `spkg-configure.m4` (but I do not know how!)\n\n- my 2nd error was when building dochtml: `NameError: Singular library 'freegb.lib' not found`. To solve it, `src/sage/env.py` and `src/bin/sage-env` must be modified so that `SINGULARPATH` is set to singlar's share dir (and not `SAGE_SHARE` / `DESTDIR`), and `SINGULAR_EXECUTABLE` is set to the real Singular and not under the `DESTDIR` directory.\n\nNow it is OK for me (on FreeBSD).",
    "created_at": "2020-04-17T16:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565338",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<a id='comment:8'></a>
[Copying elements from #29024]

- my 1st problem was a build failure with Singular taken from an external package: to solve it, Singular must be built `--with-ntl`: it would be fine to add this check to `spkg-configure.m4` (but I do not know how!)

- my 2nd error was when building dochtml: `NameError: Singular library 'freegb.lib' not found`. To solve it, `src/sage/env.py` and `src/bin/sage-env` must be modified so that `SINGULARPATH` is set to singlar's share dir (and not `SAGE_SHARE` / `DESTDIR`), and `SINGULAR_EXECUTABLE` is set to the real Singular and not under the `DESTDIR` directory.

Now it is OK for me (on FreeBSD).



---

archive/issue_comments_565339.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n This ticket adds an `spkg-configure.m4` for `singular`.\n \n-For singular, the location of the dynamic variable needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or (with #29022) to `src/sage/env_config.py.in`. See also #29013.\n+For singular, the location of the dynamic library needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or to `sage_conf.py.in`. See also #29013.\n \n``````\n",
    "created_at": "2020-06-28T20:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565339",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 This ticket adds an `spkg-configure.m4` for `singular`.
 
-For singular, the location of the dynamic variable needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or (with #29022) to `src/sage/env_config.py.in`. See also #29013.
+For singular, the location of the dynamic library needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or to `sage_conf.py.in`. See also #29013.
 
``````




---

archive/issue_events_083011.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83011"
}
```



---

archive/issue_events_083012.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83012"
}
```



---

archive/issue_comments_565340.json:
```json
{
    "body": "<a id='comment:12'></a>\nthe error message\n\n```\n        raise RuntimeError(\n            \"libSingular not found--a working Singular install in $SAGE_LOCAL \"\n            \"is required for Sage to work\")\n```\nshould be modified, too.\nPerhaps just remove `in $SAGE_LOCAL `",
    "created_at": "2020-09-11T16:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565340",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
the error message

```
        raise RuntimeError(
            "libSingular not found--a working Singular install in $SAGE_LOCAL "
            "is required for Sage to work")
```
should be modified, too.
Perhaps just remove `in $SAGE_LOCAL `



---

archive/issue_comments_565341.json:
```json
{
    "body": "<a id='comment:13'></a>\nMoving this ticket forward is great, but note that it is unrelated to the build problem on homebrew reported on sage-devel... and it is also unlikely that the homebrew version of singular actually works for us (homebrew does not like to patch).\n\nAs I explained in https://groups.google.com/d/msg/sage-devel/KXK_zxzfhIQ/RO3FryYWAwAJ, on the reporter's system the computed order of `-I` options is wrong -- something that I was not able reproduce on my system.",
    "created_at": "2020-09-11T16:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565341",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Moving this ticket forward is great, but note that it is unrelated to the build problem on homebrew reported on sage-devel... and it is also unlikely that the homebrew version of singular actually works for us (homebrew does not like to patch).

As I explained in https://groups.google.com/d/msg/sage-devel/KXK_zxzfhIQ/RO3FryYWAwAJ, on the reporter's system the computed order of `-I` options is wrong -- something that I was not able reproduce on my system.



---

archive/issue_comments_565342.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [gh-thierry-FreeBSD](#comment%3A8):\n> [Copying elements from #29024]\n> \n> - my 1st problem was a build failure with Singular taken from an external package: to solve it, Singular must be built `--with-ntl`: it would be fine to add this check to `spkg-configure.m4` (but I do not know how!)\n> \n> - my 2nd error was when building dochtml: `NameError: Singular library 'freegb.lib' not found`. To solve it, `src/sage/env.py` and `src/bin/sage-env` must be modified so that `SINGULARPATH` is set to singlar's share dir (and not `SAGE_SHARE` / `DESTDIR`), and `SINGULAR_EXECUTABLE` is set to the real Singular and not under the `DESTDIR` directory.\n> \n> Now it is OK for me (on FreeBSD).\n\n\nThe fix in [SageMath](SageMath) needs some programming - specifically, the code in singular.pyx calls dlopen on SINGULAR_SO,\nwhich is computed by _get_shared_lib_filename dynamically in env.py, and assuming that it is in SAGE_LOCAL.\nSo this probably can instead by handled using cython_aliases from the same module (which does compute\nall the needed info for Singular, it seems).\nOr by fixing _get_shared_lib_filename so that it also searches elsewhere.",
    "created_at": "2020-09-11T17:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565342",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
Replying to [gh-thierry-FreeBSD](#comment%3A8):
> [Copying elements from #29024]
> 
> - my 1st problem was a build failure with Singular taken from an external package: to solve it, Singular must be built `--with-ntl`: it would be fine to add this check to `spkg-configure.m4` (but I do not know how!)
> 
> - my 2nd error was when building dochtml: `NameError: Singular library 'freegb.lib' not found`. To solve it, `src/sage/env.py` and `src/bin/sage-env` must be modified so that `SINGULARPATH` is set to singlar's share dir (and not `SAGE_SHARE` / `DESTDIR`), and `SINGULAR_EXECUTABLE` is set to the real Singular and not under the `DESTDIR` directory.
> 
> Now it is OK for me (on FreeBSD).


The fix in [SageMath](SageMath) needs some programming - specifically, the code in singular.pyx calls dlopen on SINGULAR_SO,
which is computed by _get_shared_lib_filename dynamically in env.py, and assuming that it is in SAGE_LOCAL.
So this probably can instead by handled using cython_aliases from the same module (which does compute
all the needed info for Singular, it seems).
Or by fixing _get_shared_lib_filename so that it also searches elsewhere.



---

archive/issue_comments_565343.json:
```json
{
    "body": "<a id='comment:15'></a>\nIs it known whether this comment added in 2009 to singular.pyx is still valid:\n\n```\n    This initializes the SINGULAR library. This is a hack to some\n    extent.\n\n    SINGULAR has a concept of compiled extension modules similar to\n    Sage. For this, the compiled modules need to see the symbols from\n    the main program. However, SINGULAR is a shared library in this\n    context these symbols are not known globally. The work around so\n    far is to load the library again and to specify ``RTLD_GLOBAL``.\n```",
    "created_at": "2020-09-11T17:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565343",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Is it known whether this comment added in 2009 to singular.pyx is still valid:

```
    This initializes the SINGULAR library. This is a hack to some
    extent.

    SINGULAR has a concept of compiled extension modules similar to
    Sage. For this, the compiled modules need to see the symbols from
    the main program. However, SINGULAR is a shared library in this
    context these symbols are not known globally. The work around so
    far is to load the library again and to specify ``RTLD_GLOBAL``.
```



---

archive/issue_comments_565344.json:
```json
{
    "body": "<a id='comment:16'></a>\nSomeone working on innards of Singular might know.\n(I'd be surprised if it was changed).\n\nSingular is not alone - this hack is also applied to libgap.\nI'm inclined to fix `_get_shared_lib_filename` so that it can accept other libdirs, not only\nSAGE_LOCAL/lib",
    "created_at": "2020-09-11T17:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565344",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
Someone working on innards of Singular might know.
(I'd be surprised if it was changed).

Singular is not alone - this hack is also applied to libgap.
I'm inclined to fix `_get_shared_lib_filename` so that it can accept other libdirs, not only
SAGE_LOCAL/lib



---

archive/attachments_021295.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "homebrew-singular-experiment.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket29024/homebrew-singular-experiment.patch",
    "created_at": "2020-09-11T22:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/dimpase"
}
```



---

archive/issue_comments_565345.json:
```json
{
    "body": "",
    "created_at": "2020-09-11T22:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565345",
    "user": "https://github.com/dimpase"
}
```





---

archive/issue_comments_565346.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [dimpase](#comment%3A16):\n> I'm inclined to fix `_get_shared_lib_filename` so that it can accept other libdirs, not only\n> SAGE_LOCAL/lib\n\n\nYes, this function certainly would need changing if we continue to use it. \nFor example, `sysconfig.get_config_var('LIBDIR')` gives a directory of the system python, not of the current venv.\n\nBut I think better solution would be to wrap loading of modules that are linked to singular by [sys.setdlopenflags](https://docs.python.org/3/library/sys.html#sys.setdlopenflags).\n\nThis is what pytorch does when it has to use RTLD_GLOBAL (see https://github.com/pytorch/pytorch/blob/master/torch/__init__.py#L132)",
    "created_at": "2020-09-12T02:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565346",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Replying to [dimpase](#comment%3A16):
> I'm inclined to fix `_get_shared_lib_filename` so that it can accept other libdirs, not only
> SAGE_LOCAL/lib


Yes, this function certainly would need changing if we continue to use it. 
For example, `sysconfig.get_config_var('LIBDIR')` gives a directory of the system python, not of the current venv.

But I think better solution would be to wrap loading of modules that are linked to singular by [sys.setdlopenflags](https://docs.python.org/3/library/sys.html#sys.setdlopenflags).

This is what pytorch does when it has to use RTLD_GLOBAL (see https://github.com/pytorch/pytorch/blob/master/torch/__init__.py#L132)



---

archive/issue_comments_565347.json:
```json
{
    "body": "<a id='comment:18'></a>\nSame at https://github.com/tensorflow/tensorflow/blob/9590c4c32dd4346ea5c35673336f5912c6072bf2/tensorflow/python/pywrap_dlopen_global_flags.py\nand https://github.com/tensorflow/tensorflow/blob/9590c4c32dd4346ea5c35673336f5912c6072bf2/tensorflow/python/pywrap_tensorflow.py",
    "created_at": "2020-09-12T02:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565347",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Same at https://github.com/tensorflow/tensorflow/blob/9590c4c32dd4346ea5c35673336f5912c6072bf2/tensorflow/python/pywrap_dlopen_global_flags.py
and https://github.com/tensorflow/tensorflow/blob/9590c4c32dd4346ea5c35673336f5912c6072bf2/tensorflow/python/pywrap_tensorflow.py



---

archive/issue_comments_565348.json:
```json
{
    "body": "<a id='comment:19'></a>\nI have opened #30561 for this",
    "created_at": "2020-09-12T02:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565348",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
I have opened #30561 for this



---

archive/issue_comments_565349.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n-This ticket adds an `spkg-configure.m4` for `singular`.\n+For singular, the location of the dynamic library needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or to `sage_conf.py.in`. See also .\n \n-For singular, the location of the dynamic library needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or to `sage_conf.py.in`. See also #29013.\n+This will:\n+- reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),\n \n+- enable venv builds of sagelib (#30578, #29013),\n+\n+- provide preparation for adding an `spkg-configure.m4` for `singular`.\n+\n+\n``````\n",
    "created_at": "2020-09-16T21:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565349",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
-This ticket adds an `spkg-configure.m4` for `singular`.
+For singular, the location of the dynamic library needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or to `sage_conf.py.in`. See also .
 
-For singular, the location of the dynamic library needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or to `sage_conf.py.in`. See also #29013.
+This will:
+- reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),
 
+- enable venv builds of sagelib (#30578, #29013),
+
+- provide preparation for adding an `spkg-configure.m4` for `singular`.
+
+
``````




---

archive/issue_events_083013.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "rename": {
        "from": "spkg-configure.m4 for singular",
        "to": "Make location of the Singular shared library configurable through sage-config"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83013"
}
```



---

archive/issue_events_083014.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-16T21:50:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83014"
}
```



---

archive/issue_events_083015.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-16T21:50:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83015"
}
```



---

archive/issue_comments_565350.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,11 @@\n-For singular, the location of the dynamic library needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or to `sage_conf.py.in`. See also .\n+For singular, the location of the dynamic library needs to be communicated to the sage runtime.\n+\n+We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. \n \n This will:\n - reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),\n \n-- enable venv builds of sagelib (#30578, #29013),\n+- enable venv builds of sagelib (#30578, #29013) -- for which `_get_shared_lib_filename` is wrong\n \n - provide preparation for adding an `spkg-configure.m4` for `singular`.\n \n``````\n",
    "created_at": "2020-09-16T21:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565350",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,11 @@
-For singular, the location of the dynamic library needs to be communicated to the sage runtime, either by adding to `src/bin/sage-env-config.in` or to `sage_conf.py.in`. See also .
+For singular, the location of the dynamic library needs to be communicated to the sage runtime.
+
+We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. 
 
 This will:
 - reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),
 
-- enable venv builds of sagelib (#30578, #29013),
+- enable venv builds of sagelib (#30578, #29013) -- for which `_get_shared_lib_filename` is wrong
 
 - provide preparation for adding an `spkg-configure.m4` for `singular`.
 
``````




---

archive/issue_comments_565351.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,16 @@\n For singular, the location of the dynamic library needs to be communicated to the sage runtime.\n \n We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. \n+\n+The filename can be found from `src/Singular/libSingular.la` (currently not installed): \n+\n+```\n+# The name that we can dlopen(3).\n+dlname='libSingular-4.1.1.dylib'\n+...\n+# Directory that this library needs to be installed in:\n+libdir='/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib'\n+```\n \n This will:\n - reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),\n``````\n",
    "created_at": "2020-09-16T22:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565351",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,16 @@
 For singular, the location of the dynamic library needs to be communicated to the sage runtime.
 
 We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. 
+
+The filename can be found from `src/Singular/libSingular.la` (currently not installed): 
+
+```
+# The name that we can dlopen(3).
+dlname='libSingular-4.1.1.dylib'
+...
+# Directory that this library needs to be installed in:
+libdir='/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib'
+```
 
 This will:
 - reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),
``````




---

archive/issue_comments_565352.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-For singular, the location of the dynamic library needs to be communicated to the sage runtime.\n+1. For singular, the location of the dynamic library needs to be communicated to the sage runtime.\n \n We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. \n \n@@ -20,3 +20,20 @@\n - provide preparation for adding an `spkg-configure.m4` for `singular`.\n \n \n+2. `src/bin/sage-env` unconditionally sets environment variable `SINGULARPATH=\"$SAGE_LOCAL/share/singular\"` \n+\n+   If `SINGULARPATH` is already set by the user, perhaps the directory in $SAGE_LOCAL should be prepended instead of overwriting it.\n+\n+3. `src/bin/sage-env` unconditionally sets environment variable `SINGULAR_EXECUTABLE=\"$SAGE_LOCAL/bin/Singular\"`.  \n+\n+   It should be investigated whether this is actually needed in any supported configuration. If not, remove.\n+\n+3. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):\n+\n+```\n+singular_docdir = SINGULARPATH + \"/../info/\"\n+```\n+\n+  This should be fixed so that it works when `SINGULARPATH` is set by a user to a colon-separated list.\n+\n+\n``````\n",
    "created_at": "2020-10-23T00:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565352",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-For singular, the location of the dynamic library needs to be communicated to the sage runtime.
+1. For singular, the location of the dynamic library needs to be communicated to the sage runtime.
 
 We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. 
 
@@ -20,3 +20,20 @@
 - provide preparation for adding an `spkg-configure.m4` for `singular`.
 
 
+2. `src/bin/sage-env` unconditionally sets environment variable `SINGULARPATH="$SAGE_LOCAL/share/singular"` 
+
+   If `SINGULARPATH` is already set by the user, perhaps the directory in $SAGE_LOCAL should be prepended instead of overwriting it.
+
+3. `src/bin/sage-env` unconditionally sets environment variable `SINGULAR_EXECUTABLE="$SAGE_LOCAL/bin/Singular"`.  
+
+   It should be investigated whether this is actually needed in any supported configuration. If not, remove.
+
+3. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):
+
+```
+singular_docdir = SINGULARPATH + "/../info/"
+```
+
+  This should be fixed so that it works when `SINGULARPATH` is set by a user to a colon-separated list.
+
+
``````




---

archive/issue_comments_565353.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,18 +1,18 @@\n 1. For singular, the location of the dynamic library needs to be communicated to the sage runtime.\n \n-We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. \n+   We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. \n \n-The filename can be found from `src/Singular/libSingular.la` (currently not installed): \n+   The filename can be found from `src/Singular/libSingular.la` (currently not installed): \n \n-```\n-# The name that we can dlopen(3).\n-dlname='libSingular-4.1.1.dylib'\n-...\n-# Directory that this library needs to be installed in:\n-libdir='/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib'\n+  ```\n+  # The name that we can dlopen(3).\n+  dlname='libSingular-4.1.1.dylib'\n+  ...\n+  # Directory that this library needs to be installed in:\n+  libdir='/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib'\n ```\n \n-This will:\n+  This will:\n - reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),\n \n - enable venv builds of sagelib (#30578, #29013) -- for which `_get_shared_lib_filename` is wrong\n@@ -28,7 +28,7 @@\n \n    It should be investigated whether this is actually needed in any supported configuration. If not, remove.\n \n-3. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):\n+4. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):\n \n ```\n singular_docdir = SINGULARPATH + \"/../info/\"\n``````\n",
    "created_at": "2020-10-23T00:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565353",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,18 +1,18 @@
 1. For singular, the location of the dynamic library needs to be communicated to the sage runtime.
 
-We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. 
+   We add a configuration variable `SINGULAR_SO` to `sage_conf.py.in`. 
 
-The filename can be found from `src/Singular/libSingular.la` (currently not installed): 
+   The filename can be found from `src/Singular/libSingular.la` (currently not installed): 
 
-```
-# The name that we can dlopen(3).
-dlname='libSingular-4.1.1.dylib'
-...
-# Directory that this library needs to be installed in:
-libdir='/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib'
+  ```
+  # The name that we can dlopen(3).
+  dlname='libSingular-4.1.1.dylib'
+  ...
+  # Directory that this library needs to be installed in:
+  libdir='/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib'
 ```
 
-This will:
+  This will:
 - reduce the need for downstream patching (see for example https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-singular.patch),
 
 - enable venv builds of sagelib (#30578, #29013) -- for which `_get_shared_lib_filename` is wrong
@@ -28,7 +28,7 @@
 
    It should be investigated whether this is actually needed in any supported configuration. If not, remove.
 
-3. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):
+4. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):
 
 ```
 singular_docdir = SINGULARPATH + "/../info/"
``````




---

archive/issue_events_083016.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83016"
}
```



---

archive/issue_events_083017.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83017"
}
```



---

archive/issue_comments_565354.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565354",
    "user": "https://github.com/mkoeppe"
}
```

**Changing keywords** from "" to "sd111".



---

archive/issue_comments_565355.json:
```json
{
    "body": "<a id='comment:26'></a>\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565355",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_565356.json:
```json
{
    "body": "<a id='comment:28'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565356",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_083018.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83018"
}
```



---

archive/issue_events_083019.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83019"
}
```



---

archive/issue_comments_565357.json:
```json
{
    "body": "<a id='comment:29'></a>\nWith #31642 taking us to a released version of Singular, it is time to work on an `spkg-configure.m4` for using system singular.  Arch already has the latest version (https://repology.org/project/singular/versions)",
    "created_at": "2021-05-27T22:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565357",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
With #31642 taking us to a released version of Singular, it is time to work on an `spkg-configure.m4` for using system singular.  Arch already has the latest version (https://repology.org/project/singular/versions)



---

archive/issue_comments_565358.json:
```json
{
    "body": "**Dependencies:** #31642",
    "created_at": "2021-05-27T22:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565358",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #31642



---

archive/issue_events_083020.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "rename": {
        "from": "Make location of the Singular shared library configurable through sage-config",
        "to": "spkg-configure.m4 for singular"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83020"
}
```



---

archive/issue_comments_565359.json:
```json
{
    "body": "<a id='comment:31'></a>\nThe `SINGULARPATH` is being used to find the singular's docdir so that sage can manually parse its GNU info file and retrieve the docstring for Singular functions.\n\nCurrently the help file is mis-named (https://github.com/Singular/Singular/issues/1107), but even so, there's a much more reliable way to get this information without parsing the file ourselves (and therefore, without `SINGULARPATH`):\n\n```\n$ info \"(singular.hlp)align\" | tail -n+2\n\n5.1.1 align\n-----------\n\n`*Syntax:*'\n     `align (' vector_expression, int_expression `)'\n     `align (' module_expression, int_expression `)'\n\n`*Type:*'\n     type of the first argument\n\n`*Purpose:*'\n     maps module generators `gen(i)' to `gen(i+s)' for all i.\n\n`*Example:*'\n            ring r=0,(x,y,z),(c,dp);\n            align([1,2,3],3);\n          ==> [0,0,0,1,2,3]\n            align([0,0,1,2,3],-1);\n          ==> [0,1,2,3]\n            align(freemodule(2),1);\n          ==> _[1]=[0,1]\n          ==> _[2]=[0,0,1]\n\n```",
    "created_at": "2021-07-18T22:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565359",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:31'></a>
The `SINGULARPATH` is being used to find the singular's docdir so that sage can manually parse its GNU info file and retrieve the docstring for Singular functions.

Currently the help file is mis-named (https://github.com/Singular/Singular/issues/1107), but even so, there's a much more reliable way to get this information without parsing the file ourselves (and therefore, without `SINGULARPATH`):

```
$ info "(singular.hlp)align" | tail -n+2

5.1.1 align
-----------

`*Syntax:*'
     `align (' vector_expression, int_expression `)'
     `align (' module_expression, int_expression `)'

`*Type:*'
     type of the first argument

`*Purpose:*'
     maps module generators `gen(i)' to `gen(i+s)' for all i.

`*Example:*'
            ring r=0,(x,y,z),(c,dp);
            align([1,2,3],3);
          ==> [0,0,0,1,2,3]
            align([0,0,1,2,3],-1);
          ==> [0,1,2,3]
            align(freemodule(2),1);
          ==> _[1]=[0,1]
          ==> _[2]=[0,0,1]

```



---

archive/issue_comments_565360.json:
```json
{
    "body": "**Branch:** [u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)",
    "created_at": "2021-07-19T04:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565360",
    "user": "https://github.com/orlitzky"
}
```

**Branch:** [u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)



---

archive/issue_comments_565361.json:
```json
{
    "body": "<a id='comment:32'></a>\nThis branch is only half-baked, but it already eliminates problems 2, 3, and 4 from the description at the cost of requiring GNU Info to be installed.\n\nCan the first issue be avoided as well? Why are we using `dlopen` to load `SINGULAR_SO` instead of just linking to it?",
    "created_at": "2021-07-19T04:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565361",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:32'></a>
This branch is only half-baked, but it already eliminates problems 2, 3, and 4 from the description at the cost of requiring GNU Info to be installed.

Can the first issue be avoided as well? Why are we using `dlopen` to load `SINGULAR_SO` instead of just linking to it?



---

archive/issue_comments_565362.json:
```json
{
    "body": "**Commit:** [a8610506141953cd344b699ca01e329c4a67fe2b](https://github.com/sagemath/sagetrac-mirror/commit/a8610506141953cd344b699ca01e329c4a67fe2b)",
    "created_at": "2021-07-19T04:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565362",
    "user": "https://github.com/orlitzky"
}
```

**Commit:** [a8610506141953cd344b699ca01e329c4a67fe2b](https://github.com/sagemath/sagetrac-mirror/commit/a8610506141953cd344b699ca01e329c4a67fe2b)



---

archive/issue_comments_565363.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [mjo](#comment%3A32):\n> Why are we using `dlopen` to load `SINGULAR_SO` instead of just linking to it?\n\nSee #30561",
    "created_at": "2021-07-19T04:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565363",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Replying to [mjo](#comment%3A32):
> Why are we using `dlopen` to load `SINGULAR_SO` instead of just linking to it?

See #30561



---

archive/issue_comments_565364.json:
```json
{
    "body": "**Changing branch** from \"[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)\" to \"\".",
    "created_at": "2021-07-20T19:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565364",
    "user": "https://github.com/orlitzky"
}
```

**Changing branch** from "[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)" to "".



---

archive/issue_comments_565365.json:
```json
{
    "body": "**Changing commit** from \"[a8610506141953cd344b699ca01e329c4a67fe2b](https://github.com/sagemath/sagetrac-mirror/commit/a8610506141953cd344b699ca01e329c4a67fe2b)\" to \"\".",
    "created_at": "2021-07-20T19:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565365",
    "user": "https://github.com/orlitzky"
}
```

**Changing commit** from "[a8610506141953cd344b699ca01e329c4a67fe2b](https://github.com/sagemath/sagetrac-mirror/commit/a8610506141953cd344b699ca01e329c4a67fe2b)" to "".



---

archive/issue_comments_565366.json:
```json
{
    "body": "**Changing dependencies** from \"#31642\" to \"#32302\".",
    "created_at": "2021-08-01T23:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565366",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31642" to "#32302".



---

archive/issue_comments_565367.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -24,9 +24,14 @@\n \n    If `SINGULARPATH` is already set by the user, perhaps the directory in $SAGE_LOCAL should be prepended instead of overwriting it.\n \n+   (After #32254, `SINGULARPATH` is only used by `qepcad` -- this last use should be removed in #31275.)\n+\n+\n 3. `src/bin/sage-env` unconditionally sets environment variable `SINGULAR_EXECUTABLE=\"$SAGE_LOCAL/bin/Singular\"`.  \n \n-   It should be investigated whether this is actually needed in any supported configuration. If not, remove.\n+   It should be investigated whether this is actually needed in any supported configuration. If not, remove. \n+\n+   (Removed in #32302.)\n \n 4. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):\n \n@@ -36,4 +41,6 @@\n \n   This should be fixed so that it works when `SINGULARPATH` is set by a user to a colon-separated list.\n \n+  (Solved in #32254 - Obtain singular.hlp location via libsingular_resources)\n \n+\n``````\n",
    "created_at": "2021-08-01T23:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565367",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -24,9 +24,14 @@
 
    If `SINGULARPATH` is already set by the user, perhaps the directory in $SAGE_LOCAL should be prepended instead of overwriting it.
 
+   (After #32254, `SINGULARPATH` is only used by `qepcad` -- this last use should be removed in #31275.)
+
+
 3. `src/bin/sage-env` unconditionally sets environment variable `SINGULAR_EXECUTABLE="$SAGE_LOCAL/bin/Singular"`.  
 
-   It should be investigated whether this is actually needed in any supported configuration. If not, remove.
+   It should be investigated whether this is actually needed in any supported configuration. If not, remove. 
+
+   (Removed in #32302.)
 
 4. `src/sage/interfaces/singular.py` tries to use `SINGULARPATH` as if it is a directory name (it is a colon-separated list of directories):
 
@@ -36,4 +41,6 @@
 
   This should be fixed so that it works when `SINGULARPATH` is set by a user to a colon-separated list.
 
+  (Solved in #32254 - Obtain singular.hlp location via libsingular_resources)
 
+
``````




---

archive/issue_events_083021.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-01T23:17:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83021"
}
```



---

archive/issue_events_083022.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-01T23:17:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83022"
}
```



---

archive/issue_comments_565368.json:
```json
{
    "body": "**Changing dependencies** from \"#32302\" to \"#32302, #31275\".",
    "created_at": "2021-08-19T11:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565368",
    "user": "https://github.com/orlitzky"
}
```

**Changing dependencies** from "#32302" to "#32302, #31275".



---

archive/issue_comments_565369.json:
```json
{
    "body": "**Changing dependencies** from \"#32302, #31275\" to \"#32302, #31275, #32243\".",
    "created_at": "2021-08-19T11:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565369",
    "user": "https://github.com/orlitzky"
}
```

**Changing dependencies** from "#32302, #31275" to "#32302, #31275, #32243".



---

archive/issue_comments_565370.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-08-19T13:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565370",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_565371.json:
```json
{
    "body": "**Branch:** [u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)",
    "created_at": "2021-08-19T13:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565371",
    "user": "https://github.com/orlitzky"
}
```

**Branch:** [u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)



---

archive/issue_comments_565372.json:
```json
{
    "body": "<a id='comment:39'></a>\nI've left the `dlopen()` alone because I don't feel like trying to eliminate it. This branch uses autoconf to find out the extension of shared libraries on the system (`SHLIBEXT`), and then tries to `dlopen(\"libSingular.$SHLIBEXT\")`. If it works, we use the system copy, and use the same `dlopen()` strategy in `singular.pyx`. Otherwise we fall back to the SPKG and pass the full `SAGE_LOCAL` path to `dlopen()`. Works well enough on Gentoo.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fa11258c8c0df37c547f0234c376f5258165abd\">5fa1125</a></td><td><code>Trac #32302: drop SINGULAR_EXECUTABLE from src/bin/sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5395116843152c986052b4f655ac18939464403f\">5395116</a></td><td><code>Trac #32243: look for cddlib-0.94m headers in the right place.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea42a9bddae7a37729d552086b8be0a3cdd86e31\">ea42a9b</a></td><td><code>Trac #32243: patch gfan to look for cddlib headers in new location.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0340b328459f0d1c6c9dc9e488494e0921d66db\">c0340b3</a></td><td><code>Trac #29024: put the shared library extension in sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3919061abbdc8c3cf8e7ceeb7f11266d82805e61\">3919061</a></td><td><code>Trac #29024: new spkg-configure.m4 for singular.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc4dc8c517c7a09b2b070b739e68c41d57fa2d4b\">fc4dc8c</a></td><td><code>Trac #29024: don't set SINGULARPATH in sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae26f767acd2edb0c105b45033518f7c760ffbe2\">ae26f76</a></td><td><code>Trac #29024: use SINGULAR_LIB_BASE and SHLIBEXT to replace SINGULAR_SO.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2\">a3b5983</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr></table>\n",
    "created_at": "2021-08-19T13:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565372",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:39'></a>
I've left the `dlopen()` alone because I don't feel like trying to eliminate it. This branch uses autoconf to find out the extension of shared libraries on the system (`SHLIBEXT`), and then tries to `dlopen("libSingular.$SHLIBEXT")`. If it works, we use the system copy, and use the same `dlopen()` strategy in `singular.pyx`. Otherwise we fall back to the SPKG and pass the full `SAGE_LOCAL` path to `dlopen()`. Works well enough on Gentoo.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fa11258c8c0df37c547f0234c376f5258165abd">5fa1125</a></td><td><code>Trac #32302: drop SINGULAR_EXECUTABLE from src/bin/sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5395116843152c986052b4f655ac18939464403f">5395116</a></td><td><code>Trac #32243: look for cddlib-0.94m headers in the right place.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea42a9bddae7a37729d552086b8be0a3cdd86e31">ea42a9b</a></td><td><code>Trac #32243: patch gfan to look for cddlib headers in new location.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0340b328459f0d1c6c9dc9e488494e0921d66db">c0340b3</a></td><td><code>Trac #29024: put the shared library extension in sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3919061abbdc8c3cf8e7ceeb7f11266d82805e61">3919061</a></td><td><code>Trac #29024: new spkg-configure.m4 for singular.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc4dc8c517c7a09b2b070b739e68c41d57fa2d4b">fc4dc8c</a></td><td><code>Trac #29024: don't set SINGULARPATH in sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae26f767acd2edb0c105b45033518f7c760ffbe2">ae26f76</a></td><td><code>Trac #29024: use SINGULAR_LIB_BASE and SHLIBEXT to replace SINGULAR_SO.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2">a3b5983</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr></table>




---

archive/issue_comments_565373.json:
```json
{
    "body": "**Author:** Michael Orlitzky",
    "created_at": "2021-08-19T13:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565373",
    "user": "https://github.com/orlitzky"
}
```

**Author:** Michael Orlitzky



---

archive/issue_comments_565374.json:
```json
{
    "body": "**Commit:** [a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2](https://github.com/sagemath/sagetrac-mirror/commit/a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2)",
    "created_at": "2021-08-19T13:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565374",
    "user": "https://github.com/orlitzky"
}
```

**Commit:** [a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2](https://github.com/sagemath/sagetrac-mirror/commit/a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2)



---

archive/issue_comments_565375.json:
```json
{
    "body": "<a id='comment:40'></a>\nby the way, why there is no hint for `pkgconfig` in `build/pkgs/pkgconfig/distros/gentoo.txt` (and for many other obvious distros)?\n\nI only notices as Gentoo's `emerge` was telling be about the switch to `dev-util/pkgconf`.",
    "created_at": "2021-08-20T09:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565375",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>
by the way, why there is no hint for `pkgconfig` in `build/pkgs/pkgconfig/distros/gentoo.txt` (and for many other obvious distros)?

I only notices as Gentoo's `emerge` was telling be about the switch to `dev-util/pkgconf`.



---

archive/issue_comments_565376.json:
```json
{
    "body": "<a id='comment:41'></a>\nOK, what's this:\n\n```\n[dochtml] make doc-inventory--Bug\n[dochtml] cd /mnt/opt/Sage/sage-dev && ./sage --docbuild --no-pdf-links Bug inventory \n[dochtml] Bug >>Could not get expanded executable from \"libSingular.so\"<< at feResource.cc:434\n[dochtml] 'Bug' is not a recognized document. Type 'sage --docbuild -D' for a list\n[dochtml] of documents, or 'sage --docbuild --help' for more help.\n[dochtml] make[5]: *** [Makefile:20: doc-inventory--Bug] Error 1\n```\nalso, \n\n```\n$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.4.rc2, Release Date: 2021-08-12                 \u2502\n\u2502 Using Python 3.8.9. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nBug >>Could not get expanded executable from \"libSingular.so\"<< at feResource.cc:434\nsage: 2+2                                                                                                                            \n4\nsage:           \n```",
    "created_at": "2021-08-20T10:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565376",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'></a>
OK, what's this:

```
[dochtml] make doc-inventory--Bug
[dochtml] cd /mnt/opt/Sage/sage-dev && ./sage --docbuild --no-pdf-links Bug inventory 
[dochtml] Bug >>Could not get expanded executable from "libSingular.so"<< at feResource.cc:434
[dochtml] 'Bug' is not a recognized document. Type 'sage --docbuild -D' for a list
[dochtml] of documents, or 'sage --docbuild --help' for more help.
[dochtml] make[5]: *** [Makefile:20: doc-inventory--Bug] Error 1
```
also, 

```
$ ./sage
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SageMath version 9.4.rc2, Release Date: 2021-08-12                 ‚îÇ
‚îÇ Using Python 3.8.9. Type "help()" for help.                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Warning: this is a prerelease version, and it may be unstable.     ‚îÉ
‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
Bug >>Could not get expanded executable from "libSingular.so"<< at feResource.cc:434
sage: 2+2                                                                                                                            
4
sage:           
```



---

archive/issue_comments_565377.json:
```json
{
    "body": "<a id='comment:42'></a>\nCan this be coming from Gentoo's Singular install? Weird.",
    "created_at": "2021-08-20T11:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565377",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:42'></a>
Can this be coming from Gentoo's Singular install? Weird.



---

archive/issue_comments_565378.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [dimpase](#comment%3A42):\n> Can this be coming from Gentoo's Singular install? Weird.\n\n\nOh, right, I saw that too. Singular is trying to guess the path of its own executable and is failing. It doesn't hurt anything (that I noticed...), and is an upstream bug like the message says. I'll dig deeper as this gets closer to being merged and figure out what to report upstream.",
    "created_at": "2021-08-20T12:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565378",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:43'></a>
Replying to [dimpase](#comment%3A42):
> Can this be coming from Gentoo's Singular install? Weird.


Oh, right, I saw that too. Singular is trying to guess the path of its own executable and is failing. It doesn't hurt anything (that I noticed...), and is an upstream bug like the message says. I'll dig deeper as this gets closer to being merged and figure out what to report upstream.



---

archive/issue_comments_565379.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [dimpase](#comment%3A40):\n> by the way, why there is no hint for `pkgconfig` in `build/pkgs/pkgconfig/distros/gentoo.txt` (and for many other obvious distros)?\n> \n> I only notices as Gentoo's `emerge` was telling be about the switch to `dev-util/pkgconf`.\n\n\nThe Sage \"pkgconfig\" package is a python module and not the tool itself. There's nothing we can do with it yet, but eventually it's dev-python/pkgconfig.",
    "created_at": "2021-08-20T12:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565379",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:44'></a>
Replying to [dimpase](#comment%3A40):
> by the way, why there is no hint for `pkgconfig` in `build/pkgs/pkgconfig/distros/gentoo.txt` (and for many other obvious distros)?
> 
> I only notices as Gentoo's `emerge` was telling be about the switch to `dev-util/pkgconf`.


The Sage "pkgconfig" package is a python module and not the tool itself. There's nothing we can do with it yet, but eventually it's dev-python/pkgconfig.



---

archive/issue_comments_565380.json:
```json
{
    "body": "<a id='comment:45'></a>\nYou can make the BUG warning go away with,\n\n```\n$ SINGULAR_BIN_DIR=$(dirname $(type -P Singular)) sage\n```\n\nbut hopefully that is not needed long-term.",
    "created_at": "2021-08-20T13:43:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565380",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:45'></a>
You can make the BUG warning go away with,

```
$ SINGULAR_BIN_DIR=$(dirname $(type -P Singular)) sage
```

but hopefully that is not needed long-term.



---

archive/issue_comments_565381.json:
```json
{
    "body": "<a id='comment:46'></a>\nUpstream bug: https://github.com/Singular/Singular/issues/1113",
    "created_at": "2021-08-20T18:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565381",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:46'></a>
Upstream bug: https://github.com/Singular/Singular/issues/1113



---

archive/issue_comments_565382.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [mjo](#comment%3A44):\n> The Sage \"pkgconfig\" package is a python module and not the tool itself. There's nothing we can do with it yet, but eventually it's dev-python/pkgconfig.\n\n\n`build/pkgs/pkgconf/distros` also does not have an entry for gentoo (and neither for arch)",
    "created_at": "2021-08-20T22:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565382",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
Replying to [mjo](#comment%3A44):
> The Sage "pkgconfig" package is a python module and not the tool itself. There's nothing we can do with it yet, but eventually it's dev-python/pkgconfig.


`build/pkgs/pkgconf/distros` also does not have an entry for gentoo (and neither for arch)



---

archive/issue_comments_565383.json:
```json
{
    "body": "<a id='comment:48'></a>\n`build/pkgs/singular/distros` looks like it needs more entries for some distributions",
    "created_at": "2021-08-20T23:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565383",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
`build/pkgs/singular/distros` looks like it needs more entries for some distributions



---

archive/issue_comments_565384.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [mkoeppe](#comment%3A47):\n> Replying to [mjo](#comment%3A44):\n> > The Sage \"pkgconfig\" package is a python module and not the tool itself. There's nothing we can do with it yet, but eventually it's dev-python/pkgconfig.\n\n> \n> `build/pkgs/pkgconf/distros` also does not have an entry for gentoo (and neither for arch)\n\n\nYou can't bootstrap without pkgconf and you would be hard-pressed to find a Gentoo machine without it (being source-based), but it certainly can't hurt. The message that Dima saw says that we are getting rid of the old implementation, so now there's only `dev-util/pkgconf` to put in gentoo.txt.",
    "created_at": "2021-08-20T23:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565384",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:49'></a>
Replying to [mkoeppe](#comment%3A47):
> Replying to [mjo](#comment%3A44):
> > The Sage "pkgconfig" package is a python module and not the tool itself. There's nothing we can do with it yet, but eventually it's dev-python/pkgconfig.

> 
> `build/pkgs/pkgconf/distros` also does not have an entry for gentoo (and neither for arch)


You can't bootstrap without pkgconf and you would be hard-pressed to find a Gentoo machine without it (being source-based), but it certainly can't hurt. The message that Dima saw says that we are getting rid of the old implementation, so now there's only `dev-util/pkgconf` to put in gentoo.txt.



---

archive/issue_comments_565385.json:
```json
{
    "body": "**Changing branch** from \"[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)\" to \"[u/slelievre/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/slelievre/29024)\".",
    "created_at": "2021-08-21T18:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565385",
    "user": "https://github.com/slel"
}
```

**Changing branch** from "[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)" to "[u/slelievre/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/slelievre/29024)".



---

archive/issue_comments_565386.json:
```json
{
    "body": "**Changing commit** from \"[a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2](https://github.com/sagemath/sagetrac-mirror/commit/a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2)\" to \"[a5cfcec18a1eb65068151189b22dd0ba461ca2cf](https://github.com/sagemath/sagetrac-mirror/commit/a5cfcec18a1eb65068151189b22dd0ba461ca2cf)\".",
    "created_at": "2021-08-21T18:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565386",
    "user": "https://github.com/slel"
}
```

**Changing commit** from "[a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2](https://github.com/sagemath/sagetrac-mirror/commit/a3b5983adf9e89e75ce3295f0ace0307b5cdb2d2)" to "[a5cfcec18a1eb65068151189b22dd0ba461ca2cf](https://github.com/sagemath/sagetrac-mirror/commit/a5cfcec18a1eb65068151189b22dd0ba461ca2cf)".



---

archive/issue_comments_565387.json:
```json
{
    "body": "<a id='comment:50'></a>\nHere are Singular distro files for Arch Linux, Cygwin and Fedora.\n\nRevert to your branch if those are not helping.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5cfcec18a1eb65068151189b22dd0ba461ca2cf\">a5cfcec</a></td><td><code>29024: Add Singular distro info</code></td></tr></table>\n",
    "created_at": "2021-08-21T18:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565387",
    "user": "https://github.com/slel"
}
```

<a id='comment:50'></a>
Here are Singular distro files for Arch Linux, Cygwin and Fedora.

Revert to your branch if those are not helping.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5cfcec18a1eb65068151189b22dd0ba461ca2cf">a5cfcec</a></td><td><code>29024: Add Singular distro info</code></td></tr></table>




---

archive/issue_comments_565388.json:
```json
{
    "body": "<a id='comment:51'></a>\n\n```\n-# As of 2021-03-20, build of homebrew's singular from source fails\n+# [2021-03-20] building from source with Homebrew's singular fails\n```\nthis rewording changes the meaning. What failed at this time was really the from-source build of the homebrew package (via `brew install -s`, or implied when using `brew` with a non-standard prefix)",
    "created_at": "2021-08-21T20:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565388",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>

```
-# As of 2021-03-20, build of homebrew's singular from source fails
+# [2021-03-20] building from source with Homebrew's singular fails
```
this rewording changes the meaning. What failed at this time was really the from-source build of the homebrew package (via `brew install -s`, or implied when using `brew` with a non-standard prefix)



---

archive/issue_comments_565389.json:
```json
{
    "body": "**Changing commit** from \"[a5cfcec18a1eb65068151189b22dd0ba461ca2cf](https://github.com/sagemath/sagetrac-mirror/commit/a5cfcec18a1eb65068151189b22dd0ba461ca2cf)\" to \"[fe67a2174fb5076228c13a8b6b5b94a697002348](https://github.com/sagemath/sagetrac-mirror/commit/fe67a2174fb5076228c13a8b6b5b94a697002348)\".",
    "created_at": "2021-08-21T23:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a5cfcec18a1eb65068151189b22dd0ba461ca2cf](https://github.com/sagemath/sagetrac-mirror/commit/a5cfcec18a1eb65068151189b22dd0ba461ca2cf)" to "[fe67a2174fb5076228c13a8b6b5b94a697002348](https://github.com/sagemath/sagetrac-mirror/commit/fe67a2174fb5076228c13a8b6b5b94a697002348)".



---

archive/issue_comments_565390.json:
```json
{
    "body": "<a id='comment:52'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe67a2174fb5076228c13a8b6b5b94a697002348\">fe67a21</a></td><td><code>29024: Add Singular distro info</code></td></tr></table>\n",
    "created_at": "2021-08-21T23:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe67a2174fb5076228c13a8b6b5b94a697002348">fe67a21</a></td><td><code>29024: Add Singular distro info</code></td></tr></table>




---

archive/issue_comments_565391.json:
```json
{
    "body": "<a id='comment:53'></a>\nReplying to [dimpase](#comment%3A41):\n> OK, what's this:\n> \n> ```\n> [dochtml] make doc-inventory--Bug\n> ```\n\n\nThis is likely caused by unexpected output (on stdout!) from the command `./sage --docbuild --all-documents reference`",
    "created_at": "2021-08-22T00:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565391",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>
Replying to [dimpase](#comment%3A41):
> OK, what's this:
> 
> ```
> [dochtml] make doc-inventory--Bug
> ```


This is likely caused by unexpected output (on stdout!) from the command `./sage --docbuild --all-documents reference`



---

archive/issue_comments_565392.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-08-28T01:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565392",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_565393.json:
```json
{
    "body": "<a id='comment:55'></a>\nWe probably also need to do something with `SINGULARPATH`, a variable hold, if needed, paths to Singular's .lib files, something that may be installed by Sage's optional packages - it is done e.g. by `p_group_cohomology`. So to make the latter work with system-wide Singular one needs to export `SINGULARPATH=$SAGE_LOCAL/share/singular/LIB`.",
    "created_at": "2021-09-10T14:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565393",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:55'></a>
We probably also need to do something with `SINGULARPATH`, a variable hold, if needed, paths to Singular's .lib files, something that may be installed by Sage's optional packages - it is done e.g. by `p_group_cohomology`. So to make the latter work with system-wide Singular one needs to export `SINGULARPATH=$SAGE_LOCAL/share/singular/LIB`.



---

archive/issue_comments_565394.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [dimpase](#comment%3A55):\n> We probably also need to do something with `SINGULARPATH`, a variable hold, if needed, paths to Singular's .lib files, something that may be installed by Sage's optional packages - it is done e.g. by `p_group_cohomology`. So to make the latter work with system-wide Singular one needs to export `SINGULARPATH=$SAGE_LOCAL/share/singular/LIB`.\n\n\nWhat we really need is a system for optional packages to set their own environment variables, so we don't have to set every possible environment variable (for an unknowable number of optional packages) in sage-env. Of course Gentoo and everyone else already figured this out 20 years ago. We can have sage-env source any files in `local/etc/env.d`, and then tell optional packages to install what they need (e.g. a script that exports `SINGULARPATH`) there.\n\nI guess I will waste my time reimplementing that so that some day I can stop wasting my time rebuilding the same copy of singular that I already have installed.",
    "created_at": "2021-09-11T21:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565394",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:56'></a>
Replying to [dimpase](#comment%3A55):
> We probably also need to do something with `SINGULARPATH`, a variable hold, if needed, paths to Singular's .lib files, something that may be installed by Sage's optional packages - it is done e.g. by `p_group_cohomology`. So to make the latter work with system-wide Singular one needs to export `SINGULARPATH=$SAGE_LOCAL/share/singular/LIB`.


What we really need is a system for optional packages to set their own environment variables, so we don't have to set every possible environment variable (for an unknowable number of optional packages) in sage-env. Of course Gentoo and everyone else already figured this out 20 years ago. We can have sage-env source any files in `local/etc/env.d`, and then tell optional packages to install what they need (e.g. a script that exports `SINGULARPATH`) there.

I guess I will waste my time reimplementing that so that some day I can stop wasting my time rebuilding the same copy of singular that I already have installed.



---

archive/issue_comments_565395.json:
```json
{
    "body": "<a id='comment:57'></a>\nBest to plan to move away from any such dependence on setting environment variables.\n\nInstead, it should be set at runtime when initializing the singular interface / libsingular.",
    "created_at": "2021-09-11T21:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565395",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>
Best to plan to move away from any such dependence on setting environment variables.

Instead, it should be set at runtime when initializing the singular interface / libsingular.



---

archive/issue_comments_565396.json:
```json
{
    "body": "<a id='comment:58'></a>\n(see #30818, #21707)",
    "created_at": "2021-09-11T21:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565396",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
(see #30818, #21707)



---

archive/issue_comments_565397.json:
```json
{
    "body": "<a id='comment:59'></a>\nIn fact, do we actually install any custom Singular packages in `SAGE_LOCAL/share/singular/LIB`? I don't think we do.\n\n`src/sage/rings/function_field/function_field.py` uses the correct approach -- it loads its custom Singular library using a fully qualified path to the library, which is just in the installed package data of the Sage library.\n\nIf the `p_group_cohomology` Sage code relies on `SINGULARPATH`, it should be changed so it uses the same approach.",
    "created_at": "2021-09-11T22:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565397",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
In fact, do we actually install any custom Singular packages in `SAGE_LOCAL/share/singular/LIB`? I don't think we do.

`src/sage/rings/function_field/function_field.py` uses the correct approach -- it loads its custom Singular library using a fully qualified path to the library, which is just in the installed package data of the Sage library.

If the `p_group_cohomology` Sage code relies on `SINGULARPATH`, it should be changed so it uses the same approach.



---

archive/issue_comments_565398.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [mkoeppe](#comment%3A59):\n> In fact, do we actually install any custom Singular packages in `SAGE_LOCAL/share/singular/LIB`? I don't think we do.\n\n\nNot sure what \"we\" is here, but\n`p_group_cohomology` does install a custom Singular lib, called `dickson.lib`,\nand it ends up in `$SAGE_LOCAL/share/singular/LIB`, as `spkg-install` has\n\n```\nsdh_install singular_helper/dickson.lib \"$SAGE_SHARE/singular/LIB/\"\n```\n- which is fine if Singular is built by Sage, but not with the external Singular.\n\n> \n> `src/sage/rings/function_field/function_field.py` uses the correct approach -- it loads its custom Singular library using a fully qualified path to the library, which is just in the installed package data of the Sage library.\n> \n> If the `p_group_cohomology` Sage code relies on `SINGULARPATH`, it should be changed so it uses the same approach.\n\n\nIt doesn't rely on `SINGULARPATH` is seems to me. `SINGULARPATH` can be used by Singular,\nand system-wide Singular  doesn't know about `$SAGE_LOCAL/share/singular/LIB`, obviously, unless something is done.\n\nShould `p_group_cohomology` be using `$SAGE_SHARE/singular/LIB/` to install `dickson.lib`, or some\nother location?\n\nRegarding `src/sage/ext_data/singular/function_field/core.lib`,  one sees\n\n```\n            from sage.env import SAGE_EXTCODE\n            lib(SAGE_EXTCODE + '/singular/function_field/core.lib')\n```\nbut\n\n```\n$ find . -name core.lib\n./pkgs/sagemath-standard/build/lib.linux-x86_64-3.8/sage/ext_data/singular/function_field/core.lib\n./src/sage/ext_data/singular/function_field/core.lib\n./local/lib/python3.8/site-packages/sage/ext_data/singular/function_field/core.lib\n```\nso it also gets installed into site-packages. Is it a bug?",
    "created_at": "2021-09-12T08:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565398",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:60'></a>
Replying to [mkoeppe](#comment%3A59):
> In fact, do we actually install any custom Singular packages in `SAGE_LOCAL/share/singular/LIB`? I don't think we do.


Not sure what "we" is here, but
`p_group_cohomology` does install a custom Singular lib, called `dickson.lib`,
and it ends up in `$SAGE_LOCAL/share/singular/LIB`, as `spkg-install` has

```
sdh_install singular_helper/dickson.lib "$SAGE_SHARE/singular/LIB/"
```
- which is fine if Singular is built by Sage, but not with the external Singular.

> 
> `src/sage/rings/function_field/function_field.py` uses the correct approach -- it loads its custom Singular library using a fully qualified path to the library, which is just in the installed package data of the Sage library.
> 
> If the `p_group_cohomology` Sage code relies on `SINGULARPATH`, it should be changed so it uses the same approach.


It doesn't rely on `SINGULARPATH` is seems to me. `SINGULARPATH` can be used by Singular,
and system-wide Singular  doesn't know about `$SAGE_LOCAL/share/singular/LIB`, obviously, unless something is done.

Should `p_group_cohomology` be using `$SAGE_SHARE/singular/LIB/` to install `dickson.lib`, or some
other location?

Regarding `src/sage/ext_data/singular/function_field/core.lib`,  one sees

```
            from sage.env import SAGE_EXTCODE
            lib(SAGE_EXTCODE + '/singular/function_field/core.lib')
```
but

```
$ find . -name core.lib
./pkgs/sagemath-standard/build/lib.linux-x86_64-3.8/sage/ext_data/singular/function_field/core.lib
./src/sage/ext_data/singular/function_field/core.lib
./local/lib/python3.8/site-packages/sage/ext_data/singular/function_field/core.lib
```
so it also gets installed into site-packages. Is it a bug?



---

archive/issue_comments_565399.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [dimpase](#comment%3A60):\n> Regarding `src/sage/ext_data/singular/function_field/core.lib`,  one sees\n> \n> ```\n>             from sage.env import SAGE_EXTCODE\n>             lib(SAGE_EXTCODE + '/singular/function_field/core.lib')\n> ```\n> but\n> \n> ```\n> $ find . -name core.lib\n> ./pkgs/sagemath-standard/build/lib.linux-x86_64-3.8/sage/ext_data/singular/function_field/core.lib\n> ./src/sage/ext_data/singular/function_field/core.lib\n> ./local/lib/python3.8/site-packages/sage/ext_data/singular/function_field/core.lib\n> ```\n> so it also gets installed into site-packages.\n\n\n`core.lib` is `package_data` of the distribution package `sagemath-standard`.\nAs such it gets installed alongside the Python files, in `site-packages`.\n\nThis works as designed.",
    "created_at": "2021-09-12T08:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565399",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'></a>
Replying to [dimpase](#comment%3A60):
> Regarding `src/sage/ext_data/singular/function_field/core.lib`,  one sees
> 
> ```
>             from sage.env import SAGE_EXTCODE
>             lib(SAGE_EXTCODE + '/singular/function_field/core.lib')
> ```
> but
> 
> ```
> $ find . -name core.lib
> ./pkgs/sagemath-standard/build/lib.linux-x86_64-3.8/sage/ext_data/singular/function_field/core.lib
> ./src/sage/ext_data/singular/function_field/core.lib
> ./local/lib/python3.8/site-packages/sage/ext_data/singular/function_field/core.lib
> ```
> so it also gets installed into site-packages.


`core.lib` is `package_data` of the distribution package `sagemath-standard`.
As such it gets installed alongside the Python files, in `site-packages`.

This works as designed.



---

archive/issue_comments_565400.json:
```json
{
    "body": "<a id='comment:62'></a>\nReplying to [dimpase](#comment%3A60):\n> Replying to [mkoeppe](#comment%3A59):\n> > In fact, do we actually install any custom Singular packages in `SAGE_LOCAL/share/singular/LIB`? I don't think we do.\n\n> \n> Not sure what \"we\" is here\n\n\n... any package in the Sage distribution ...\n\n> Should `p_group_cohomology` be using `$SAGE_SHARE/singular/LIB/` to install `dickson.lib`, or some\n> other location?\n\n\nAs I said, this should be changed to follow the same model as `src/sage/ext_data/singular/function_field/core.lib`",
    "created_at": "2021-09-12T08:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565400",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>
Replying to [dimpase](#comment%3A60):
> Replying to [mkoeppe](#comment%3A59):
> > In fact, do we actually install any custom Singular packages in `SAGE_LOCAL/share/singular/LIB`? I don't think we do.

> 
> Not sure what "we" is here


... any package in the Sage distribution ...

> Should `p_group_cohomology` be using `$SAGE_SHARE/singular/LIB/` to install `dickson.lib`, or some
> other location?


As I said, this should be changed to follow the same model as `src/sage/ext_data/singular/function_field/core.lib`



---

archive/issue_comments_565401.json:
```json
{
    "body": "<a id='comment:63'></a>\nIs there any code that actually loads `dickson.lib`?",
    "created_at": "2021-09-12T08:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565401",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>
Is there any code that actually loads `dickson.lib`?



---

archive/issue_comments_565402.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [mkoeppe](#comment%3A63):\n> Is there any code that actually loads `dickson.lib`? \n\n\n`sage  -t src/sage/tests/modular_group_cohomology.py` will trigger loading it, if `p_group_cohomology` is installed.",
    "created_at": "2021-09-12T10:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565402",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:64'></a>
Replying to [mkoeppe](#comment%3A63):
> Is there any code that actually loads `dickson.lib`? 


`sage  -t src/sage/tests/modular_group_cohomology.py` will trigger loading it, if `p_group_cohomology` is installed.



---

archive/issue_comments_565403.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [mkoeppe](#comment%3A62):\n> Replying to [dimpase](#comment%3A60):\n> > Replying to [mkoeppe](#comment%3A59):\n> > > In fact, do we actually install any custom Singular packages in `SAGE_LOCAL/share/singular/LIB`? I don't think we do.\n\n> > \n> > Not sure what \"we\" is here\n\n> \n> ... any package in the Sage distribution ...\n> \n> > Should `p_group_cohomology` be using `$SAGE_SHARE/singular/LIB/` to install `dickson.lib`, or some\n> > other location?\n\n> \n> As I said, this should be changed to follow the same model as `src/sage/ext_data/singular/function_field/core.lib`\n\n\nI've opened https://github.com/sagemath/p_group_cohomology/issues/5 for this",
    "created_at": "2021-09-12T10:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565403",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:65'></a>
Replying to [mkoeppe](#comment%3A62):
> Replying to [dimpase](#comment%3A60):
> > Replying to [mkoeppe](#comment%3A59):
> > > In fact, do we actually install any custom Singular packages in `SAGE_LOCAL/share/singular/LIB`? I don't think we do.

> > 
> > Not sure what "we" is here

> 
> ... any package in the Sage distribution ...
> 
> > Should `p_group_cohomology` be using `$SAGE_SHARE/singular/LIB/` to install `dickson.lib`, or some
> > other location?

> 
> As I said, this should be changed to follow the same model as `src/sage/ext_data/singular/function_field/core.lib`


I've opened https://github.com/sagemath/p_group_cohomology/issues/5 for this



---

archive/issue_comments_565404.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2021-09-12T10:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565404",
    "user": "https://github.com/dimpase"
}
```

**Changing upstream** from "N/A" to "Reported upstream. No feedback yet.".



---

archive/issue_comments_565405.json:
```json
{
    "body": "<a id='comment:66'></a>\nAs `p_group_cohomology` is broken since Sage 9.4 anyway (https://github.com/sagemath/p_group_cohomology/issues/4), I think we can proceed here on the ticket without worrying about `SINGULARPATH`.",
    "created_at": "2021-09-12T16:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565405",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>
As `p_group_cohomology` is broken since Sage 9.4 anyway (https://github.com/sagemath/p_group_cohomology/issues/4), I think we can proceed here on the ticket without worrying about `SINGULARPATH`.



---

archive/issue_comments_565406.json:
```json
{
    "body": "<a id='comment:67'></a>\nSo are we waiting for the upstream fix here, or proceed with making sure that\n\n```\nexport SINGULAR_BIN_DIR=$(dirname $(type -P Singular))\n```\nis added at the correct place?",
    "created_at": "2021-09-14T14:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565406",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:67'></a>
So are we waiting for the upstream fix here, or proceed with making sure that

```
export SINGULAR_BIN_DIR=$(dirname $(type -P Singular))
```
is added at the correct place?



---

archive/issue_comments_565407.json:
```json
{
    "body": "<a id='comment:68'></a>\nI think we'll have to add it. Upstream started to work on the issue but we're nowhere near having a complete fix in a released version of Singular. The BUG warning is harmless I think; but if we don't hide it, we're going to have to deal with a million bug reports about it.\n\nI'll add the workaround and create a ticket to remove it whenever the fix is in an upstream release.",
    "created_at": "2021-09-14T16:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565407",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:68'></a>
I think we'll have to add it. Upstream started to work on the issue but we're nowhere near having a complete fix in a released version of Singular. The BUG warning is harmless I think; but if we don't hide it, we're going to have to deal with a million bug reports about it.

I'll add the workaround and create a ticket to remove it whenever the fix is in an upstream release.



---

archive/issue_comments_565408.json:
```json
{
    "body": "<a id='comment:69'></a>\nActually, I just looked at the upstream issue and see that I missed a notification about a new commit. Let me go test it. We may still want to add the workaround for a few months until a new release is made and distros catch up.",
    "created_at": "2021-09-14T16:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565408",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:69'></a>
Actually, I just looked at the upstream issue and see that I missed a notification about a new commit. Let me go test it. We may still want to add the workaround for a few months until a new release is made and distros catch up.



---

archive/issue_comments_565409.json:
```json
{
    "body": "<a id='comment:70'></a>\nReplying to [dimpase](#comment%3A67):\n> So are we waiting for the upstream fix here, or proceed with making sure that\n> \n> ```\n> export SINGULAR_BIN_DIR=$(dirname $(type -P Singular))\n> ```\n> is added at the correct place?\n\n\nCan we put this environment setting in `src/sage/libs/singular/singular.pyx` (`init_libsingular`)?",
    "created_at": "2021-09-14T17:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565409",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>
Replying to [dimpase](#comment%3A67):
> So are we waiting for the upstream fix here, or proceed with making sure that
> 
> ```
> export SINGULAR_BIN_DIR=$(dirname $(type -P Singular))
> ```
> is added at the correct place?


Can we put this environment setting in `src/sage/libs/singular/singular.pyx` (`init_libsingular`)?



---

archive/issue_comments_565410.json:
```json
{
    "body": "<a id='comment:71'></a>\nReplying to [mkoeppe](#comment%3A70):\n> Replying to [dimpase](#comment%3A67):\n> > So are we waiting for the upstream fix here, or proceed with making sure that\n> > \n> > ```\n> > export SINGULAR_BIN_DIR=$(dirname $(type -P Singular))\n> > ```\n> > is added at the correct place?\n\n> \n> Can we put this environment setting in `src/sage/libs/singular/singular.pyx` (`init_libsingular`)? \n\n\nBoth `type -P` and `command -v` are shell built-ins on my system, making them a bit hard to use from python code. Does putting it in sage-env cause a problem I've overlooked, or are you just thinking it would be more appropriate in `init_singular()`? I don't disagree -- but considering that this is a temporary workaround, it might just be easier to add the one line in sage-env instead of the python code to launch a full-blown shell and parse its output.",
    "created_at": "2021-09-15T01:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565410",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:71'></a>
Replying to [mkoeppe](#comment%3A70):
> Replying to [dimpase](#comment%3A67):
> > So are we waiting for the upstream fix here, or proceed with making sure that
> > 
> > ```
> > export SINGULAR_BIN_DIR=$(dirname $(type -P Singular))
> > ```
> > is added at the correct place?

> 
> Can we put this environment setting in `src/sage/libs/singular/singular.pyx` (`init_libsingular`)? 


Both `type -P` and `command -v` are shell built-ins on my system, making them a bit hard to use from python code. Does putting it in sage-env cause a problem I've overlooked, or are you just thinking it would be more appropriate in `init_singular()`? I don't disagree -- but considering that this is a temporary workaround, it might just be easier to add the one line in sage-env instead of the python code to launch a full-blown shell and parse its output.



---

archive/issue_comments_565411.json:
```json
{
    "body": "<a id='comment:72'></a>\nReplying to [mjo](#comment%3A71):\n> Does putting it in sage-env cause a problem I've overlooked\n\n\nYes, we are working on making sage pip-installable and importable into normal Python environments (`import sage.all`), and for this depending on `sage-env` needs to be removed",
    "created_at": "2021-09-15T02:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565411",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>
Replying to [mjo](#comment%3A71):
> Does putting it in sage-env cause a problem I've overlooked


Yes, we are working on making sage pip-installable and importable into normal Python environments (`import sage.all`), and for this depending on `sage-env` needs to be removed



---

archive/issue_comments_565412.json:
```json
{
    "body": "<a id='comment:73'></a>\nReplying to [mjo](#comment%3A71):\n> temporary workaround\n\nWell, versions of singular that need this workaround may be in relevant distributions for years...",
    "created_at": "2021-09-15T02:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565412",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>
Replying to [mjo](#comment%3A71):
> temporary workaround

Well, versions of singular that need this workaround may be in relevant distributions for years...



---

archive/issue_comments_565413.json:
```json
{
    "body": "<a id='comment:74'></a>\nAnd I think this just https://docs.python.org/3/library/shutil.html#shutil.which",
    "created_at": "2021-09-15T02:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565413",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'></a>
And I think this just https://docs.python.org/3/library/shutil.html#shutil.which



---

archive/issue_comments_565414.json:
```json
{
    "body": "**Changing commit** from \"[fe67a2174fb5076228c13a8b6b5b94a697002348](https://github.com/sagemath/sagetrac-mirror/commit/fe67a2174fb5076228c13a8b6b5b94a697002348)\" to \"[3cebd4f26aba00ed35aa6956e2a69e323353a4a3](https://github.com/sagemath/sagetrac-mirror/commit/3cebd4f26aba00ed35aa6956e2a69e323353a4a3)\".",
    "created_at": "2021-09-15T02:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565414",
    "user": "https://github.com/orlitzky"
}
```

**Changing commit** from "[fe67a2174fb5076228c13a8b6b5b94a697002348](https://github.com/sagemath/sagetrac-mirror/commit/fe67a2174fb5076228c13a8b6b5b94a697002348)" to "[3cebd4f26aba00ed35aa6956e2a69e323353a4a3](https://github.com/sagemath/sagetrac-mirror/commit/3cebd4f26aba00ed35aa6956e2a69e323353a4a3)".



---

archive/issue_comments_565415.json:
```json
{
    "body": "**Changing branch** from \"[u/slelievre/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/slelievre/29024)\" to \"[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)\".",
    "created_at": "2021-09-15T02:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565415",
    "user": "https://github.com/orlitzky"
}
```

**Changing branch** from "[u/slelievre/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/slelievre/29024)" to "[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)".



---

archive/issue_comments_565416.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [mkoeppe](#comment%3A74):\n> And I think this just https://docs.python.org/3/library/shutil.html#shutil.which\n\n\nYep, here's an untested branch. It's going to take me all night to rebuild sage after the rebase but I'll make sure it works in the morning. And report back to upstream... that last commit looks strange to me.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28837b9421e47cde965386653cd2db609e778893\">28837b9</a></td><td><code>Trac #29024: put the shared library extension in sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3837770fc32de97b641a649d3efe902a24671d3\">c383777</a></td><td><code>Trac #29024: new spkg-configure.m4 for singular.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e80875a570e5e7bf0ec7b493bc235dc5bb02266\">8e80875</a></td><td><code>Trac #29024: don't set SINGULARPATH in sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b8244fce21a43524d34f539cc06f59958f10f61\">9b8244f</a></td><td><code>Trac #29024: use SINGULAR_LIB_BASE and SHLIBEXT to replace SINGULAR_SO.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6e4f8910de2a0bca6ccb8caf45dc397fdda3ad6\">f6e4f89</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1055247f764cd670cdd16affe4f67e0c04fa5751\">1055247</a></td><td><code>29024: Add Singular distro info</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cebd4f26aba00ed35aa6956e2a69e323353a4a3\">3cebd4f</a></td><td><code>Trac #29024: work around Singular issue 1113 in init_libsingular().</code></td></tr></table>\n",
    "created_at": "2021-09-15T02:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565416",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:75'></a>
Replying to [mkoeppe](#comment%3A74):
> And I think this just https://docs.python.org/3/library/shutil.html#shutil.which


Yep, here's an untested branch. It's going to take me all night to rebuild sage after the rebase but I'll make sure it works in the morning. And report back to upstream... that last commit looks strange to me.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28837b9421e47cde965386653cd2db609e778893">28837b9</a></td><td><code>Trac #29024: put the shared library extension in sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3837770fc32de97b641a649d3efe902a24671d3">c383777</a></td><td><code>Trac #29024: new spkg-configure.m4 for singular.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e80875a570e5e7bf0ec7b493bc235dc5bb02266">8e80875</a></td><td><code>Trac #29024: don't set SINGULARPATH in sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b8244fce21a43524d34f539cc06f59958f10f61">9b8244f</a></td><td><code>Trac #29024: use SINGULAR_LIB_BASE and SHLIBEXT to replace SINGULAR_SO.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6e4f8910de2a0bca6ccb8caf45dc397fdda3ad6">f6e4f89</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1055247f764cd670cdd16affe4f67e0c04fa5751">1055247</a></td><td><code>29024: Add Singular distro info</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cebd4f26aba00ed35aa6956e2a69e323353a4a3">3cebd4f</a></td><td><code>Trac #29024: work around Singular issue 1113 in init_libsingular().</code></td></tr></table>




---

archive/issue_comments_565417.json:
```json
{
    "body": "<a id='comment:76'></a>\nIt works.",
    "created_at": "2021-09-15T13:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565417",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:76'></a>
It works.



---

archive/issue_comments_565418.json:
```json
{
    "body": "<a id='comment:77'></a>\nReady for review?",
    "created_at": "2021-09-15T19:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565418",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'></a>
Ready for review?



---

archive/issue_comments_565419.json:
```json
{
    "body": "**Changing author** from \"Michael Orlitzky\" to \"Michael Orlitzky, Samuel Leli\u00e8vre\".",
    "created_at": "2021-09-15T20:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565419",
    "user": "https://github.com/orlitzky"
}
```

**Changing author** from "Michael Orlitzky" to "Michael Orlitzky, Samuel Leli√®vre".



---

archive/issue_comments_565420.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-09-15T20:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565420",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_565421.json:
```json
{
    "body": "<a id='comment:79'></a>\nThis will need a GH Actions run",
    "created_at": "2021-09-15T20:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565421",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:79'></a>
This will need a GH Actions run



---

archive/issue_comments_565422.json:
```json
{
    "body": "<a id='comment:80'></a>\nI've started https://github.com/sagemath/sagetrac-mirror/actions/runs/1240853423",
    "created_at": "2021-09-16T08:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565422",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:80'></a>
I've started https://github.com/sagemath/sagetrac-mirror/actions/runs/1240853423



---

archive/issue_comments_565423.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik, https://github.com/sagemath/sagetrac-mirror/actions/runs/1240853423",
    "created_at": "2021-09-16T08:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565423",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik, https://github.com/sagemath/sagetrac-mirror/actions/runs/1240853423



---

archive/issue_comments_565424.json:
```json
{
    "body": "<a id='comment:82'></a>\nDoesn't accept singular on `cygwin-standard` (https://github.com/mkoeppe/sage/runs/3625055086)\n\n```\n-----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG singular...\nchecking whether any of gmp mpir ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no\nchecking for Singular... /usr/bin/Singular\nchecking for SINGULAR... no\nchecking if we can dlopen(libSingular.dll)... configure: no suitable system package found for SPKG singular\n```",
    "created_at": "2021-09-18T02:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565424",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:82'></a>
Doesn't accept singular on `cygwin-standard` (https://github.com/mkoeppe/sage/runs/3625055086)

```
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG singular...
checking whether any of gmp mpir ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no
checking for Singular... /usr/bin/Singular
checking for SINGULAR... no
checking if we can dlopen(libSingular.dll)... configure: no suitable system package found for SPKG singular
```



---

archive/issue_comments_565425.json:
```json
{
    "body": "<a id='comment:83'></a>\nWorks OK on `archlinux-latest-standard` (https://github.com/mkoeppe/sage/runs/3625059112)\n\n```\n----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG singular...\nchecking whether any of gmp mpir ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no\nchecking for Singular... /usr/sbin/Singular\nchecking for SINGULAR... yes\nchecking if we can dlopen(libSingular.so)... configure: will use system package and not install SPKG singular\n```\n\n(but looks like an `AC_MSG_RESULT` is missing)",
    "created_at": "2021-09-18T02:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565425",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:83'></a>
Works OK on `archlinux-latest-standard` (https://github.com/mkoeppe/sage/runs/3625059112)

```
----------------------------------------------------------------------------
Checking whether SageMath should install SPKG singular...
checking whether any of gmp mpir ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no
checking for Singular... /usr/sbin/Singular
checking for SINGULAR... yes
checking if we can dlopen(libSingular.so)... configure: will use system package and not install SPKG singular
```

(but looks like an `AC_MSG_RESULT` is missing)



---

archive/issue_comments_565426.json:
```json
{
    "body": "<a id='comment:84'></a>\nAlso OK (as expected) on `gentoo-standard`\n\nNo luck on `debian`, `fedora`, and `homebrew` because of the `cddlib` dependency. It works correctly but does not accept system singular.",
    "created_at": "2021-09-18T02:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565426",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:84'></a>
Also OK (as expected) on `gentoo-standard`

No luck on `debian`, `fedora`, and `homebrew` because of the `cddlib` dependency. It works correctly but does not accept system singular.



---

archive/issue_comments_565427.json:
```json
{
    "body": "<a id='comment:85'></a>\nReplying to [mkoeppe](#comment%3A82):\n> Doesn't accept singular on `cygwin-standard` (https://github.com/mkoeppe/sage/runs/3625055086)\n\n\nI think that's expected, since it has an older version of Singular than the pkg-config test looks for.",
    "created_at": "2021-09-18T03:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565427",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:85'></a>
Replying to [mkoeppe](#comment%3A82):
> Doesn't accept singular on `cygwin-standard` (https://github.com/mkoeppe/sage/runs/3625055086)


I think that's expected, since it has an older version of Singular than the pkg-config test looks for.



---

archive/issue_comments_565428.json:
```json
{
    "body": "<a id='comment:86'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8118acd08ade1751ad1ecd8394415d32a643c2d\">d8118ac</a></td><td><code>Trac #29024: add missing AC_MSG_RESULTs in singular/spkg-configure.m4.</code></td></tr></table>\n",
    "created_at": "2021-09-18T03:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:86'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8118acd08ade1751ad1ecd8394415d32a643c2d">d8118ac</a></td><td><code>Trac #29024: add missing AC_MSG_RESULTs in singular/spkg-configure.m4.</code></td></tr></table>




---

archive/issue_comments_565429.json:
```json
{
    "body": "**Changing commit** from \"[3cebd4f26aba00ed35aa6956e2a69e323353a4a3](https://github.com/sagemath/sagetrac-mirror/commit/3cebd4f26aba00ed35aa6956e2a69e323353a4a3)\" to \"[d8118acd08ade1751ad1ecd8394415d32a643c2d](https://github.com/sagemath/sagetrac-mirror/commit/d8118acd08ade1751ad1ecd8394415d32a643c2d)\".",
    "created_at": "2021-09-18T03:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565429",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3cebd4f26aba00ed35aa6956e2a69e323353a4a3](https://github.com/sagemath/sagetrac-mirror/commit/3cebd4f26aba00ed35aa6956e2a69e323353a4a3)" to "[d8118acd08ade1751ad1ecd8394415d32a643c2d](https://github.com/sagemath/sagetrac-mirror/commit/d8118acd08ade1751ad1ecd8394415d32a643c2d)".



---

archive/issue_comments_565430.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-09-18T04:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565430",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_565431.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik, https://github.com/sagemath/sagetrac-mirror/actions/runs/1240853423\" to \"Dima Pasechnik, Matthias Koeppe\".",
    "created_at": "2021-09-18T04:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565431",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Dima Pasechnik, https://github.com/sagemath/sagetrac-mirror/actions/runs/1240853423" to "Dima Pasechnik, Matthias Koeppe".



---

archive/issue_comments_565432.json:
```json
{
    "body": "<a id='comment:88'></a>\nActually this needs more work on Cygwin:\nhttps://github.com/mkoeppe/sage/runs/3638292833?check_suite_focus=true\n\n```\n./sage -t -p --all --logfile=logs/ptest.log\nno stored timings available\nRunning doctests with ID 2021-09-18-08-09-52-cb78f982.\nGit branch: HEAD\nUsing --optional=build,cygwin,dochtml,pip,sage,sage_spkg\nDoctesting entire Sage library.\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 4363 files using 3 threads.\nTraceback (most recent call last):\n  File \"/cygdrive/d/a/sage/sage/src/bin/sage-runtests\", line 144, in <module>\n    err = DC.run()\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/control.py\", line 1207, in run\n    self.run_doctests()\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/control.py\", line 904, in run_doctests\n    self.dispatcher = DocTestDispatcher(self)\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1624, in __init__\n    init_sage(controller)\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/forker.py\", line 192, in init_sage\n    controller.load_environment()\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/control.py\", line 525, in load_environment\n    return import_module(self.options.environment)\n  File \"/usr/lib/python3.8/importlib/__init__.py\", line 127, in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\n  File \"<frozen importlib._bootstrap>\", line 1014, in _gcd_import\n  File \"<frozen importlib._bootstrap>\", line 991, in _find_and_load\n  File \"<frozen importlib._bootstrap>\", line 975, in _find_and_load_unlocked\n  File \"<frozen importlib._bootstrap>\", line 671, in _load_unlocked\n  File \"<frozen importlib._bootstrap_external>\", line 848, in exec_module\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/repl/ipython_kernel/all_jupyter.py\", line 5, in <module>\n    from sage.all_cmdline import *\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/all_cmdline.py\", line 19, in <module>\n    from sage.all import *\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/all.py\", line 141, in <module>\n    from sage.rings.all      import *\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/rings/all.py\", line 83, in <module>\n    from .polynomial.all import *\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/rings/polynomial/all.py\", line 42, in <module>\n    from sage.rings.polynomial.laurent_polynomial_ring import LaurentPolynomialRing\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/rings/polynomial/laurent_polynomial_ring.py\", line 50, in <module>\n    from sage.rings.polynomial.laurent_polynomial import LaurentPolynomial_mpair, LaurentPolynomial_univariate\n  File \"sage/rings/polynomial/laurent_polynomial.pyx\", line 1, in init sage.rings.polynomial.laurent_polynomial (build/cythonized/sage/rings/polynomial/laurent_polynomial.c:40817)\n  File \"sage/matrix/matrix0.pyx\", line 28, in init sage.matrix.matrix0 (build/cythonized/sage/matrix/matrix0.c:44570)\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/modules/free_module.py\", line 167, in <module>\n    import sage.matrix.matrix_space\n  File \"/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/matrix/matrix_space.py\", line 55, in <module>\n    from . import matrix_mpolynomial_dense\n  File \"sage/matrix/matrix_mpolynomial_dense.pyx\", line 1, in init sage.matrix.matrix_mpolynomial_dense (build/cythonized/sage/matrix/matrix_mpolynomial_dense.cpp:8666)\n  File \"sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 1, in init sage.rings.polynomial.multi_polynomial_libsingular (build/cythonized/sage/rings/polynomial/multi_polynomial_libsingular.cpp:49840)\n  File \"sage/libs/singular/singular.pyx\", line 808, in init sage.libs.singular.singular (build/cythonized/sage/libs/singular/singular.cpp:11287)\n  File \"sage/libs/singular/singular.pyx\", line 785, in sage.libs.singular.singular.init_libsingular (build/cythonized/sage/libs/singular/singular.cpp:8697)\nImportError: cannot load Singular library from /opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/libSingular.dll (b'No such file or directory')\nmake: *** [Makefile:233: ptest-nodoc] Error 1\n```\n\nNote that on cygwin, dlls are installed in `bin/`, not in `lib/`",
    "created_at": "2021-09-18T17:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565432",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:88'></a>
Actually this needs more work on Cygwin:
https://github.com/mkoeppe/sage/runs/3638292833?check_suite_focus=true

```
./sage -t -p --all --logfile=logs/ptest.log
no stored timings available
Running doctests with ID 2021-09-18-08-09-52-cb78f982.
Git branch: HEAD
Using --optional=build,cygwin,dochtml,pip,sage,sage_spkg
Doctesting entire Sage library.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 4363 files using 3 threads.
Traceback (most recent call last):
  File "/cygdrive/d/a/sage/sage/src/bin/sage-runtests", line 144, in <module>
    err = DC.run()
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/control.py", line 1207, in run
    self.run_doctests()
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/control.py", line 904, in run_doctests
    self.dispatcher = DocTestDispatcher(self)
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/forker.py", line 1624, in __init__
    init_sage(controller)
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/forker.py", line 192, in init_sage
    controller.load_environment()
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/doctest/control.py", line 525, in load_environment
    return import_module(self.options.environment)
  File "/usr/lib/python3.8/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1014, in _gcd_import
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 671, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 848, in exec_module
  File "<frozen importlib._bootstrap>", line 219, in _call_with_frames_removed
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/repl/ipython_kernel/all_jupyter.py", line 5, in <module>
    from sage.all_cmdline import *
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/all_cmdline.py", line 19, in <module>
    from sage.all import *
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/all.py", line 141, in <module>
    from sage.rings.all      import *
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/rings/all.py", line 83, in <module>
    from .polynomial.all import *
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/rings/polynomial/all.py", line 42, in <module>
    from sage.rings.polynomial.laurent_polynomial_ring import LaurentPolynomialRing
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/rings/polynomial/laurent_polynomial_ring.py", line 50, in <module>
    from sage.rings.polynomial.laurent_polynomial import LaurentPolynomial_mpair, LaurentPolynomial_univariate
  File "sage/rings/polynomial/laurent_polynomial.pyx", line 1, in init sage.rings.polynomial.laurent_polynomial (build/cythonized/sage/rings/polynomial/laurent_polynomial.c:40817)
  File "sage/matrix/matrix0.pyx", line 28, in init sage.matrix.matrix0 (build/cythonized/sage/matrix/matrix0.c:44570)
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/modules/free_module.py", line 167, in <module>
    import sage.matrix.matrix_space
  File "/opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/python3.8/site-packages/sage/matrix/matrix_space.py", line 55, in <module>
    from . import matrix_mpolynomial_dense
  File "sage/matrix/matrix_mpolynomial_dense.pyx", line 1, in init sage.matrix.matrix_mpolynomial_dense (build/cythonized/sage/matrix/matrix_mpolynomial_dense.cpp:8666)
  File "sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 1, in init sage.rings.polynomial.multi_polynomial_libsingular (build/cythonized/sage/rings/polynomial/multi_polynomial_libsingular.cpp:49840)
  File "sage/libs/singular/singular.pyx", line 808, in init sage.libs.singular.singular (build/cythonized/sage/libs/singular/singular.cpp:11287)
  File "sage/libs/singular/singular.pyx", line 785, in sage.libs.singular.singular.init_libsingular (build/cythonized/sage/libs/singular/singular.cpp:8697)
ImportError: cannot load Singular library from /opt/sage-032178416da49f83f86c3b8ce2797134fbb97bd8/lib/libSingular.dll (b'No such file or directory')
make: *** [Makefile:233: ptest-nodoc] Error 1
```

Note that on cygwin, dlls are installed in `bin/`, not in `lib/`



---

archive/issue_comments_565433.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2021-09-18T17:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565433",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_565434.json:
```json
{
    "body": "**Changing commit** from \"[d8118acd08ade1751ad1ecd8394415d32a643c2d](https://github.com/sagemath/sagetrac-mirror/commit/d8118acd08ade1751ad1ecd8394415d32a643c2d)\" to \"[da802ef6c996c37611ef0be910b714e41acc68b7](https://github.com/sagemath/sagetrac-mirror/commit/da802ef6c996c37611ef0be910b714e41acc68b7)\".",
    "created_at": "2021-09-20T01:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d8118acd08ade1751ad1ecd8394415d32a643c2d](https://github.com/sagemath/sagetrac-mirror/commit/d8118acd08ade1751ad1ecd8394415d32a643c2d)" to "[da802ef6c996c37611ef0be910b714e41acc68b7](https://github.com/sagemath/sagetrac-mirror/commit/da802ef6c996c37611ef0be910b714e41acc68b7)".



---

archive/issue_comments_565435.json:
```json
{
    "body": "<a id='comment:89'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fbf01c492d8838946a70ad02dc6ce90a6ce4683c\">fbf01c4</a></td><td><code>Trac #29024: support libdir substitutions in sage_conf.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc2adfbcd5d7b0d53c2ea16b39018a0cf5949655\">fc2adfb</a></td><td><code>Trac #29024: use new SAGE_LIBDIR substitution for libSingular.so.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da802ef6c996c37611ef0be910b714e41acc68b7\">da802ef</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr></table>\n",
    "created_at": "2021-09-20T01:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565435",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:89'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fbf01c492d8838946a70ad02dc6ce90a6ce4683c">fbf01c4</a></td><td><code>Trac #29024: support libdir substitutions in sage_conf.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc2adfbcd5d7b0d53c2ea16b39018a0cf5949655">fc2adfb</a></td><td><code>Trac #29024: use new SAGE_LIBDIR substitution for libSingular.so.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da802ef6c996c37611ef0be910b714e41acc68b7">da802ef</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr></table>




---

archive/issue_comments_565436.json:
```json
{
    "body": "<a id='comment:90'></a>\nI think that will fix it. I thought about eliminating `SINGULAR_LIB_BASE` entirely, but I can't say for sure that we won't encounter a platform where `dlopen()` does not search the library path, so I've left it in and invented a way to reference the libdir.\n\nThe hacks in sage_conf are starting to pile up, so I've opened #32540 with a proposal to refactor things.",
    "created_at": "2021-09-20T02:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565436",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:90'></a>
I think that will fix it. I thought about eliminating `SINGULAR_LIB_BASE` entirely, but I can't say for sure that we won't encounter a platform where `dlopen()` does not search the library path, so I've left it in and invented a way to reference the libdir.

The hacks in sage_conf are starting to pile up, so I've opened #32540 with a proposal to refactor things.



---

archive/issue_comments_565437.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-09-20T02:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565437",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_565438.json:
```json
{
    "body": "<a id='comment:91'></a>\nHave you tested this on Cygwin?",
    "created_at": "2021-09-20T02:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565438",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:91'></a>
Have you tested this on Cygwin?



---

archive/issue_comments_565439.json:
```json
{
    "body": "<a id='comment:92'></a>\nAsking because the situation with DLLs on Cygwin is not really related to anything \"LIBDIR\". Only the naked DLLs end up in `bin/` on the platform, but `lib/` is still used for `.a` and `.dll.a` files",
    "created_at": "2021-09-20T03:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565439",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:92'></a>
Asking because the situation with DLLs on Cygwin is not really related to anything "LIBDIR". Only the naked DLLs end up in `bin/` on the platform, but `lib/` is still used for `.a` and `.dll.a` files



---

archive/issue_comments_565440.json:
```json
{
    "body": "<a id='comment:93'></a>\nHomebrew's Singular needs some fixes; 1st of all,\n\n```diff\n--- a/.homebrew-build-env\n+++ b/.homebrew-build-env\n@@ -23,7 +23,7 @@ export PKG_CONFIG_PATH\n LIBRARY_PATH=\"$HOMEBREW/lib$LIBRARY_PATH\"\n [ -z \"$CPATH\" ] || CPATH=\":${CPATH}\"\n CPATH=\"$HOMEBREW/include$CPATH\"\n-for l in readline bzip2 ntl; do\n+for l in readline bzip2 ntl singular; do\n     if [ -d \"$HOMEBREW/opt/$l/lib\" ]; then\n         LIBRARY_PATH=\"$HOMEBREW/opt/$l/lib:$LIBRARY_PATH\"\n     fi\n```\n\nThen, it appears that `dlopen()` call in `singular.pyx` needs a full path to .dylib on macOS.\n(it might be a Cython bug, or the plarform limitation, I don't know).\nThat is, if I make sure that\n\n```\nSINGULAR_LIB_BASE = \"/usr/local/opt/singular/lib/libSingular\"\n```\nin `sage_conf.py` then everything works. I am not sure how to achieve the latter automatically. \nOne way might be to export a special env. var. in  `.homebrew-build-env` and use it to set up the proper\n`SINGULAR_LIB_BASE` in `spkg-configure.m4` - but there could be a better way.",
    "created_at": "2021-09-20T09:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565440",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:93'></a>
Homebrew's Singular needs some fixes; 1st of all,

```diff
--- a/.homebrew-build-env
+++ b/.homebrew-build-env
@@ -23,7 +23,7 @@ export PKG_CONFIG_PATH
 LIBRARY_PATH="$HOMEBREW/lib$LIBRARY_PATH"
 [ -z "$CPATH" ] || CPATH=":${CPATH}"
 CPATH="$HOMEBREW/include$CPATH"
-for l in readline bzip2 ntl; do
+for l in readline bzip2 ntl singular; do
     if [ -d "$HOMEBREW/opt/$l/lib" ]; then
         LIBRARY_PATH="$HOMEBREW/opt/$l/lib:$LIBRARY_PATH"
     fi
```

Then, it appears that `dlopen()` call in `singular.pyx` needs a full path to .dylib on macOS.
(it might be a Cython bug, or the plarform limitation, I don't know).
That is, if I make sure that

```
SINGULAR_LIB_BASE = "/usr/local/opt/singular/lib/libSingular"
```
in `sage_conf.py` then everything works. I am not sure how to achieve the latter automatically. 
One way might be to export a special env. var. in  `.homebrew-build-env` and use it to set up the proper
`SINGULAR_LIB_BASE` in `spkg-configure.m4` - but there could be a better way.



---

archive/issue_comments_565441.json:
```json
{
    "body": "<a id='comment:94'></a>\nOnce the latter is fixed, we should apply\n\n```diff\n--- a/build/pkgs/singular/distros/homebrew.txt\n+++ b/build/pkgs/singular/distros/homebrew.txt\n@@ -1,5 +1 @@\n-# [2021-03-20] Homebrew's Singular can be built from source\n-# (via `brew install -s`, or implied when using `brew` with\n-# a non-standard prefix), but that currently fails.\n-\n-#singular\n+singular\n```",
    "created_at": "2021-09-20T09:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565441",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:94'></a>
Once the latter is fixed, we should apply

```diff
--- a/build/pkgs/singular/distros/homebrew.txt
+++ b/build/pkgs/singular/distros/homebrew.txt
@@ -1,5 +1 @@
-# [2021-03-20] Homebrew's Singular can be built from source
-# (via `brew install -s`, or implied when using `brew` with
-# a non-standard prefix), but that currently fails.
-
-#singular
+singular
```



---

archive/issue_comments_565442.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-09-20T11:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565442",
    "user": "https://github.com/antonio-rojas"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_565443.json:
```json
{
    "body": "<a id='comment:95'></a>\nThis breaks distro installs without `sage_conf`. Please keep the old `_get_shared_lib_path` code path as a fallback in case `sage_conf` gives an `ImportError`.",
    "created_at": "2021-09-20T11:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565443",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:95'></a>
This breaks distro installs without `sage_conf`. Please keep the old `_get_shared_lib_path` code path as a fallback in case `sage_conf` gives an `ImportError`.



---

archive/issue_comments_565444.json:
```json
{
    "body": "<a id='comment:96'></a>\nReplying to [arojas](#comment%3A95):\n> This breaks distro installs without `sage_conf`. Please keep the old `_get_shared_lib_path` code path as a fallback in case `sage_conf` gives an `ImportError`.\n\n\nDo distros use env. vars from `env.py`? (That's where the change was, the env. var. there is not computed any more.",
    "created_at": "2021-09-20T12:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565444",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:96'></a>
Replying to [arojas](#comment%3A95):
> This breaks distro installs without `sage_conf`. Please keep the old `_get_shared_lib_path` code path as a fallback in case `sage_conf` gives an `ImportError`.


Do distros use env. vars from `env.py`? (That's where the change was, the env. var. there is not computed any more.



---

archive/issue_comments_565445.json:
```json
{
    "body": "<a id='comment:97'></a>\nReplying to [dimpase](#comment%3A96):\n> Replying to [arojas](#comment%3A95):\n> > This breaks distro installs without `sage_conf`. Please keep the old `_get_shared_lib_path` code path as a fallback in case `sage_conf` gives an `ImportError`.\n\n> \n> Do distros use env. vars from `env.py`? (That's where the change was, the env. var. there is not computed any more.\n> \n\n\nYes, `env.py` is part of sagelib. Actually, a simple fallback to `SINGULAR_LIB_PATH=\"libSingular.so\"` would be fine for me (if any distro modifies the default library name, I guess it's their job to patch sage accordingly or provide a custom sage_conf)",
    "created_at": "2021-09-20T12:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565445",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:97'></a>
Replying to [dimpase](#comment%3A96):
> Replying to [arojas](#comment%3A95):
> > This breaks distro installs without `sage_conf`. Please keep the old `_get_shared_lib_path` code path as a fallback in case `sage_conf` gives an `ImportError`.

> 
> Do distros use env. vars from `env.py`? (That's where the change was, the env. var. there is not computed any more.
> 


Yes, `env.py` is part of sagelib. Actually, a simple fallback to `SINGULAR_LIB_PATH="libSingular.so"` would be fine for me (if any distro modifies the default library name, I guess it's their job to patch sage accordingly or provide a custom sage_conf)



---

archive/issue_comments_565446.json:
```json
{
    "body": "<a id='comment:98'></a>\nReplying to [mkoeppe](#comment%3A92):\n> Asking because the situation with DLLs on Cygwin is not really related to anything \"LIBDIR\". Only the naked DLLs end up in `bin/` on the platform, but `lib/` is still used for `.a` and `.dll.a` files \n\n\nNo, I haven't tested yet. I'll have to run it on GH.\n\nEven if $libdir isn't being used... at some point, the build system is deciding to put those dlls into a $directory, and $directory=bin on cygwin while $directory=lib everywhere else, no? I don't suppose you know where that decision is made?",
    "created_at": "2021-09-20T12:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565446",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:98'></a>
Replying to [mkoeppe](#comment%3A92):
> Asking because the situation with DLLs on Cygwin is not really related to anything "LIBDIR". Only the naked DLLs end up in `bin/` on the platform, but `lib/` is still used for `.a` and `.dll.a` files 


No, I haven't tested yet. I'll have to run it on GH.

Even if $libdir isn't being used... at some point, the build system is deciding to put those dlls into a $directory, and $directory=bin on cygwin while $directory=lib everywhere else, no? I don't suppose you know where that decision is made?



---

archive/issue_comments_565447.json:
```json
{
    "body": "<a id='comment:99'></a>\nReplying to [dimpase](#comment%3A93):\n> Then, it appears that `dlopen()` call in `singular.pyx` needs a full path to .dylib on macOS.\n> (it might be a Cython bug, or the plarform limitation, I don't know).\n\n\nThis was a conscious choice, as da802ef now makes explicit. POSIX doesn't say what will happen if you use a filename without a path in `dlopen()`, so the SPKG is still used as a fallback on systems where it doesn't work.\n\nThere are a couple options to improve this, of varying difficulty:\n\n* We could try to get the libdir from Singular itself. The `feResource.cc` file provides a bunch of other configuration information, but not the bare libdir at the moment. We could provide a patch upstream that lets us obtain its libdir. (However, the cygwin discussion is suggesting that libdir may not always be the right place?)\n* We can eliminate the `dlopen()`, if possible. We already link directly to libSingular and that's easy to do portably with `-lSingular`. I'm not entirely sure why `dlopen()` is needed, but the `init_libsingular()` documentation says\n\n```python\n\"\"\"                                                                                                                                                                      \nThis initializes the SINGULAR library. This is a hack to some                                                                                                            \nextent.                                                                                                                                                                  \n                                                                                                                                                                             \nSINGULAR has a concept of compiled extension modules similar to                                                                                                          \nSage. For this, the compiled modules need to see the symbols from                                                                                                        \nthe main program. However, SINGULAR is a shared library in this                                                                                                          \ncontext these symbols are not known globally. The work around so                                                                                                         \nfar is to load the library again and to specify ``RTLD_GLOBAL``.                                                                                                         \n\"\"\"\n```\n* We can invent some hacks that guess the right location on most of the platforms we support.",
    "created_at": "2021-09-20T12:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565447",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:99'></a>
Replying to [dimpase](#comment%3A93):
> Then, it appears that `dlopen()` call in `singular.pyx` needs a full path to .dylib on macOS.
> (it might be a Cython bug, or the plarform limitation, I don't know).


This was a conscious choice, as da802ef now makes explicit. POSIX doesn't say what will happen if you use a filename without a path in `dlopen()`, so the SPKG is still used as a fallback on systems where it doesn't work.

There are a couple options to improve this, of varying difficulty:

* We could try to get the libdir from Singular itself. The `feResource.cc` file provides a bunch of other configuration information, but not the bare libdir at the moment. We could provide a patch upstream that lets us obtain its libdir. (However, the cygwin discussion is suggesting that libdir may not always be the right place?)
* We can eliminate the `dlopen()`, if possible. We already link directly to libSingular and that's easy to do portably with `-lSingular`. I'm not entirely sure why `dlopen()` is needed, but the `init_libsingular()` documentation says

```python
"""                                                                                                                                                                      
This initializes the SINGULAR library. This is a hack to some                                                                                                            
extent.                                                                                                                                                                  
                                                                                                                                                                             
SINGULAR has a concept of compiled extension modules similar to                                                                                                          
Sage. For this, the compiled modules need to see the symbols from                                                                                                        
the main program. However, SINGULAR is a shared library in this                                                                                                          
context these symbols are not known globally. The work around so                                                                                                         
far is to load the library again and to specify ``RTLD_GLOBAL``.                                                                                                         
"""
```
* We can invent some hacks that guess the right location on most of the platforms we support.



---

archive/issue_comments_565448.json:
```json
{
    "body": "<a id='comment:100'></a>\nReplying to [mjo](#comment%3A98):\n\n> Even if $libdir isn't being used... at some point, the build system is deciding to put those dlls into a $directory, and $directory=bin on cygwin while $directory=lib everywhere else, no? I don't suppose you know where that decision is made?\n\n\nI think it has to do with cygwin fork() design, Windows address space, rebasing... DLL needs to get a fixed memory address allocation, for fork() to work), and so `bin/` is what's beging scanned by the corresponding Cygwin utility `rebaseall`.\n\nNot running away screaming yet?",
    "created_at": "2021-09-20T12:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565448",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:100'></a>
Replying to [mjo](#comment%3A98):

> Even if $libdir isn't being used... at some point, the build system is deciding to put those dlls into a $directory, and $directory=bin on cygwin while $directory=lib everywhere else, no? I don't suppose you know where that decision is made?


I think it has to do with cygwin fork() design, Windows address space, rebasing... DLL needs to get a fixed memory address allocation, for fork() to work), and so `bin/` is what's beging scanned by the corresponding Cygwin utility `rebaseall`.

Not running away screaming yet?



---

archive/issue_comments_565449.json:
```json
{
    "body": "<a id='comment:101'></a>\nReplying to [mjo](#comment%3A99):\n> Replying to [dimpase](#comment%3A93):\n> > Then, it appears that `dlopen()` call in `singular.pyx` needs a full path to .dylib on macOS.\n> > (it might be a Cython bug, or the plarform limitation, I don't know).\n\n> \n> This was a conscious choice, as da802ef now makes explicit. POSIX doesn't say what will happen if you use a filename without a path in `dlopen()`, so the SPKG is still used as a fallback on systems where it doesn't work.\n\n\nThis does not explain why no-full-path `dlopen()` succeeds in the test\n\n```\nconfigure:40299: checking if we can dlopen(libSingular.dylib)\nconfigure:40330: gcc -o conftest -g -O2   -Ddarwin -I/usr/local/opt/gmp/include  -I/usr/local/Cellar/ecl/21.2.1/include  conftest.c -lmpfi -lmpc -lnauty -lglpk -lpari -lncurses -lcurl -lcddgmp -lbz2 -larb -lflint -lmpfr -lgmp -lm  -lntl  -lppl -lgmpxx -lgmp -ldl >&5\nconfigure:40330: $? = 0\nconfigure:40330: ./conftest\nconfigure:40330: $? = 0\nconfigure:40333: result: yes\n```\n\nbut fails in `singular.pyx`.",
    "created_at": "2021-09-20T12:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565449",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:101'></a>
Replying to [mjo](#comment%3A99):
> Replying to [dimpase](#comment%3A93):
> > Then, it appears that `dlopen()` call in `singular.pyx` needs a full path to .dylib on macOS.
> > (it might be a Cython bug, or the plarform limitation, I don't know).

> 
> This was a conscious choice, as da802ef now makes explicit. POSIX doesn't say what will happen if you use a filename without a path in `dlopen()`, so the SPKG is still used as a fallback on systems where it doesn't work.


This does not explain why no-full-path `dlopen()` succeeds in the test

```
configure:40299: checking if we can dlopen(libSingular.dylib)
configure:40330: gcc -o conftest -g -O2   -Ddarwin -I/usr/local/opt/gmp/include  -I/usr/local/Cellar/ecl/21.2.1/include  conftest.c -lmpfi -lmpc -lnauty -lglpk -lpari -lncurses -lcurl -lcddgmp -lbz2 -larb -lflint -lmpfr -lgmp -lm  -lntl  -lppl -lgmpxx -lgmp -ldl >&5
configure:40330: $? = 0
configure:40330: ./conftest
configure:40330: $? = 0
configure:40333: result: yes
```

but fails in `singular.pyx`.



---

archive/issue_comments_565450.json:
```json
{
    "body": "<a id='comment:102'></a>\nReplying to [dimpase](#comment%3A100):\n> Replying to [mjo](#comment%3A98):\n> \n> > Even if $libdir isn't being used... at some point, the build system is deciding to put those dlls into a $directory, and $directory=bin on cygwin while $directory=lib everywhere else, no? I don't suppose you know where that decision is made?\n\n> \n> I think it has to do with cygwin fork() design, Windows address space, rebasing... DLL needs to get a fixed memory address allocation, for fork() to work), and so `bin/` is what's beging scanned by the corresponding Cygwin utility `rebaseall`.\n> \n> Not running away screaming yet?\n\n\nIs that an option? Can I wrap the whole thing in `if [ $(whoami) = \"mjo\" ]`?\n\nThe rebaseall thing makes some amount of sense to me (I used cygwin back when Windows XP was around), but I'm still not sure exactly when the dlls either get installed directly to bin, or moved from lib to bin.",
    "created_at": "2021-09-20T13:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565450",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:102'></a>
Replying to [dimpase](#comment%3A100):
> Replying to [mjo](#comment%3A98):
> 
> > Even if $libdir isn't being used... at some point, the build system is deciding to put those dlls into a $directory, and $directory=bin on cygwin while $directory=lib everywhere else, no? I don't suppose you know where that decision is made?

> 
> I think it has to do with cygwin fork() design, Windows address space, rebasing... DLL needs to get a fixed memory address allocation, for fork() to work), and so `bin/` is what's beging scanned by the corresponding Cygwin utility `rebaseall`.
> 
> Not running away screaming yet?


Is that an option? Can I wrap the whole thing in `if [ $(whoami) = "mjo" ]`?

The rebaseall thing makes some amount of sense to me (I used cygwin back when Windows XP was around), but I'm still not sure exactly when the dlls either get installed directly to bin, or moved from lib to bin.



---

archive/issue_comments_565451.json:
```json
{
    "body": "<a id='comment:103'></a>\nReplying to [dimpase](#comment%3A101):\n> \n> This does not explain why no-full-path `dlopen()` succeeds in the test... but fails in `singular.pyx`.\n> \n\n\nOh, no. That's interesting. What error message does it give you?",
    "created_at": "2021-09-20T13:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565451",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:103'></a>
Replying to [dimpase](#comment%3A101):
> 
> This does not explain why no-full-path `dlopen()` succeeds in the test... but fails in `singular.pyx`.
> 


Oh, no. That's interesting. What error message does it give you?



---

archive/issue_comments_565452.json:
```json
{
    "body": "<a id='comment:104'></a>\nReplying to [mjo](#comment%3A103):\n> Replying to [dimpase](#comment%3A101):\n> > \n> > This does not explain why no-full-path `dlopen()` succeeds in the test... but fails in `singular.pyx`.\n> > \n\n> \n> Oh, no. That's interesting. What error message does it give you?\n\n\n```\n ...\n --> 808 init_libsingular()\n ...\n     782     handle = dlopen(lib, RTLD_GLOBAL|RTLD_LAZY)\n     783     if not handle:\n     784         err = dlerror()\n --> 785         raise ImportError(f\"cannot load Singular library from {SINGULAR_LIB_PATH} ({err})\")\n         global ImportError = undefined\n     786 \n     787     # load SINGULAR\n     788     siInit(lib)\n     789 \n ...\n ImportError: cannot load Singular library from libSingular.dylib (b'dlopen(libSingular.dylib, 9): image not found')\n```\n\nI tried setting LD_LIBRARY_PATH or DYLD_FALLBACK_LIBRARY_PATH (cf. Apple's manpage on dlopen()), to no effect.\n\nPS. related reading https://developer.apple.com/forums/thread/13161 sounds as if Apple broke the latter stuff in the name of \"security\"...",
    "created_at": "2021-09-20T13:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565452",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:104'></a>
Replying to [mjo](#comment%3A103):
> Replying to [dimpase](#comment%3A101):
> > 
> > This does not explain why no-full-path `dlopen()` succeeds in the test... but fails in `singular.pyx`.
> > 

> 
> Oh, no. That's interesting. What error message does it give you?


```
 ...
 --> 808 init_libsingular()
 ...
     782     handle = dlopen(lib, RTLD_GLOBAL|RTLD_LAZY)
     783     if not handle:
     784         err = dlerror()
 --> 785         raise ImportError(f"cannot load Singular library from {SINGULAR_LIB_PATH} ({err})")
         global ImportError = undefined
     786 
     787     # load SINGULAR
     788     siInit(lib)
     789 
 ...
 ImportError: cannot load Singular library from libSingular.dylib (b'dlopen(libSingular.dylib, 9): image not found')
```

I tried setting LD_LIBRARY_PATH or DYLD_FALLBACK_LIBRARY_PATH (cf. Apple's manpage on dlopen()), to no effect.

PS. related reading https://developer.apple.com/forums/thread/13161 sounds as if Apple broke the latter stuff in the name of "security"...



---

archive/issue_comments_565453.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe cygwin magic happens in `libtool.m4`:\n\n```sh\ncygwin* | mingw* | pw32* | cegcc*)\n...\n  # DLL is installed to $(libdir)/../bin by postinstall_cmds                                                                                                               \n  postinstall_cmds='base_file=`basename \\$file`~\n    dlpath=`$SHELL 2>&1 -c '\\''. $dir/'\\''\\$base_file'\\''i; echo \\$dlname'\\''`~\n    dldir=$destdir/`dirname \\$dlpath`~\n    test -d \\$dldir || mkdir -p \\$dldir~\n    $install_prog $dir/$dlname \\$dldir/$dlname~\n    chmod a+x \\$dldir/$dlname~\n    if test -n '\\''$stripme'\\'' && test -n '\\''$striplib'\\''; then\n      eval '\\''$striplib \\$dldir/$dlname'\\'' || exit \\$?;\n    fi'\n```\n\nI guess I'll just undo the last few commits and special-case `cygwin*`.",
    "created_at": "2021-09-20T14:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565453",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:5'></a>
The cygwin magic happens in `libtool.m4`:

```sh
cygwin* | mingw* | pw32* | cegcc*)
...
  # DLL is installed to $(libdir)/../bin by postinstall_cmds                                                                                                               
  postinstall_cmds='base_file=`basename \$file`~
    dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\$base_file'\''i; echo \$dlname'\''`~
    dldir=$destdir/`dirname \$dlpath`~
    test -d \$dldir || mkdir -p \$dldir~
    $install_prog $dir/$dlname \$dldir/$dlname~
    chmod a+x \$dldir/$dlname~
    if test -n '\''$stripme'\'' && test -n '\''$striplib'\''; then
      eval '\''$striplib \$dldir/$dlname'\'' || exit \$?;
    fi'
```

I guess I'll just undo the last few commits and special-case `cygwin*`.



---

archive/issue_comments_565454.json:
```json
{
    "body": "<a id='comment:6'></a>\nAs far as I know, on Cygwin dlopen() looks up things in `$PATH` rather than `$LD_...`, so this appears to be good as it is, no?\n\nAlthough Conda and macOS still need an action.",
    "created_at": "2021-09-20T14:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565454",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
As far as I know, on Cygwin dlopen() looks up things in `$PATH` rather than `$LD_...`, so this appears to be good as it is, no?

Although Conda and macOS still need an action.



---

archive/issue_comments_565455.json:
```json
{
    "body": "**Changing commit** from \"[da802ef6c996c37611ef0be910b714e41acc68b7](https://github.com/sagemath/sagetrac-mirror/commit/da802ef6c996c37611ef0be910b714e41acc68b7)\" to \"[8cd60dde05a5421500ddcfdce3f48d1a3efe8a14](https://github.com/sagemath/sagetrac-mirror/commit/8cd60dde05a5421500ddcfdce3f48d1a3efe8a14)\".",
    "created_at": "2021-09-20T14:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565455",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[da802ef6c996c37611ef0be910b714e41acc68b7](https://github.com/sagemath/sagetrac-mirror/commit/da802ef6c996c37611ef0be910b714e41acc68b7)" to "[8cd60dde05a5421500ddcfdce3f48d1a3efe8a14](https://github.com/sagemath/sagetrac-mirror/commit/8cd60dde05a5421500ddcfdce3f48d1a3efe8a14)".



---

archive/issue_comments_565456.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3e635ae182eb329fbd61c86a58ba06f6316fef6\">c3e635a</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cd60dde05a5421500ddcfdce3f48d1a3efe8a14\">8cd60dd</a></td><td><code>Trac #29024: fix libSingular path on Cygwin.</code></td></tr></table>\n",
    "created_at": "2021-09-20T14:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565456",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3e635ae182eb329fbd61c86a58ba06f6316fef6">c3e635a</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cd60dde05a5421500ddcfdce3f48d1a3efe8a14">8cd60dd</a></td><td><code>Trac #29024: fix libSingular path on Cygwin.</code></td></tr></table>




---

archive/issue_comments_565457.json:
```json
{
    "body": "<a id='comment:8'></a>\nOn cygwin the SPKG will always be used because its Singular is too old. But even that was failing, because the absolute path involving \"lib\" was wrong. It should be fixed now.\n\nRemaining questions:\n\n1. Do I need to use \"cygSingular\" as the library name on Cygwin?\n2. WTF is happening on macOS?",
    "created_at": "2021-09-20T14:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565457",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>
On cygwin the SPKG will always be used because its Singular is too old. But even that was failing, because the absolute path involving "lib" was wrong. It should be fixed now.

Remaining questions:

1. Do I need to use "cygSingular" as the library name on Cygwin?
2. WTF is happening on macOS?



---

archive/issue_comments_565458.json:
```json
{
    "body": "<a id='comment:109'></a>\nReplying to [mjo](#comment%3A108):\n> On cygwin the SPKG will always be used because its Singular is too old.\n\nI've asked for an update: https://cygwin.com/pipermail/cygwin/2021-September/249449.html\n\n> But even that was failing, because the absolute path involving \"lib\" was wrong. It should be fixed now.\n> \n> Remaining questions:\n> \n> 1. Do I need to use \"cygSingular\" as the library name on Cygwin?\n  \nYes, I think so. \n\n> 2. WTF is happening on macOS?\n  \nI suppose we need to supply the full path to DLL (.e.g. .dylib), via an env. var in `.homebrew-build-env` and forget about it.\n(Not sure about Conda).\n\nOne discrepancy I noticed is that that singular.pyx is compiled as C++,\nwhile the test in spkg-configure is done with plain C; I tried with C++, saw no difference.",
    "created_at": "2021-09-20T15:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565458",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:109'></a>
Replying to [mjo](#comment%3A108):
> On cygwin the SPKG will always be used because its Singular is too old.

I've asked for an update: https://cygwin.com/pipermail/cygwin/2021-September/249449.html

> But even that was failing, because the absolute path involving "lib" was wrong. It should be fixed now.
> 
> Remaining questions:
> 
> 1. Do I need to use "cygSingular" as the library name on Cygwin?
  
Yes, I think so. 

> 2. WTF is happening on macOS?
  
I suppose we need to supply the full path to DLL (.e.g. .dylib), via an env. var in `.homebrew-build-env` and forget about it.
(Not sure about Conda).

One discrepancy I noticed is that that singular.pyx is compiled as C++,
while the test in spkg-configure is done with plain C; I tried with C++, saw no difference.



---

archive/issue_comments_565459.json:
```json
{
    "body": "<a id='comment:0'></a>\nHomebrew fix\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f72df456ba4c29b5b5353948af02d3ed9a8a66d3\">f72df45</a></td><td><code>macOS dlopen() prefers full path sometimes</code></td></tr></table>\n",
    "created_at": "2021-09-20T17:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565459",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
Homebrew fix

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f72df456ba4c29b5b5353948af02d3ed9a8a66d3">f72df45</a></td><td><code>macOS dlopen() prefers full path sometimes</code></td></tr></table>




---

archive/issue_comments_565460.json:
```json
{
    "body": "**Changing commit** from \"[8cd60dde05a5421500ddcfdce3f48d1a3efe8a14](https://github.com/sagemath/sagetrac-mirror/commit/8cd60dde05a5421500ddcfdce3f48d1a3efe8a14)\" to \"[f72df456ba4c29b5b5353948af02d3ed9a8a66d3](https://github.com/sagemath/sagetrac-mirror/commit/f72df456ba4c29b5b5353948af02d3ed9a8a66d3)\".",
    "created_at": "2021-09-20T17:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565460",
    "user": "https://github.com/dimpase"
}
```

**Changing commit** from "[8cd60dde05a5421500ddcfdce3f48d1a3efe8a14](https://github.com/sagemath/sagetrac-mirror/commit/8cd60dde05a5421500ddcfdce3f48d1a3efe8a14)" to "[f72df456ba4c29b5b5353948af02d3ed9a8a66d3](https://github.com/sagemath/sagetrac-mirror/commit/f72df456ba4c29b5b5353948af02d3ed9a8a66d3)".



---

archive/issue_comments_565461.json:
```json
{
    "body": "**Changing branch** from \"[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)\" to \"[u/dimpase/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/29024)\".",
    "created_at": "2021-09-20T17:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565461",
    "user": "https://github.com/dimpase"
}
```

**Changing branch** from "[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)" to "[u/dimpase/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/29024)".



---

archive/issue_comments_565462.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is not a good change.\n\n```\n--- a/.homebrew-build-env\n+++ b/.homebrew-build-env\n@@ -23,7 +23,7 @@ export PKG_CONFIG_PATH\n LIBRARY_PATH=\"$HOMEBREW/lib$LIBRARY_PATH\"\n [ -z \"$CPATH\" ] || CPATH=\":${CPATH}\"\n CPATH=\"$HOMEBREW/include$CPATH\"\n-for l in readline bzip2 ntl; do\n+for l in readline bzip2 ntl singular; do\n     if [ -d \"$HOMEBREW/opt/$l/lib\" ]; then\n         LIBRARY_PATH=\"$HOMEBREW/opt/$l/lib:$LIBRARY_PATH\"\n     fi\n```\nAdding to LIBRARY_PATH is only needed for \"keg-only\" packages.\n`singular` is a regular package, linked into `/usr/local`.\n\n```\n@@ -45,3 +45,5 @@ for l in gettext; do\n     fi\n done\n export ACLOCAL_PATH\n+SINGULAR_HOMEBREW_LIBDIR=\"$HOMEBREW/opt/singular/lib/\"\n+export SINGULAR_HOMEBREW_LIBDIR\n```\nPretty sure you can find the information you need during configure using `pkg-config`.",
    "created_at": "2021-09-20T17:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565462",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
This is not a good change.

```
--- a/.homebrew-build-env
+++ b/.homebrew-build-env
@@ -23,7 +23,7 @@ export PKG_CONFIG_PATH
 LIBRARY_PATH="$HOMEBREW/lib$LIBRARY_PATH"
 [ -z "$CPATH" ] || CPATH=":${CPATH}"
 CPATH="$HOMEBREW/include$CPATH"
-for l in readline bzip2 ntl; do
+for l in readline bzip2 ntl singular; do
     if [ -d "$HOMEBREW/opt/$l/lib" ]; then
         LIBRARY_PATH="$HOMEBREW/opt/$l/lib:$LIBRARY_PATH"
     fi
```
Adding to LIBRARY_PATH is only needed for "keg-only" packages.
`singular` is a regular package, linked into `/usr/local`.

```
@@ -45,3 +45,5 @@ for l in gettext; do
     fi
 done
 export ACLOCAL_PATH
+SINGULAR_HOMEBREW_LIBDIR="$HOMEBREW/opt/singular/lib/"
+export SINGULAR_HOMEBREW_LIBDIR
```
Pretty sure you can find the information you need during configure using `pkg-config`.



---

archive/issue_comments_565463.json:
```json
{
    "body": "<a id='comment:2'></a>\nIndeed, we can instead call `PKG_CHECK_VAR([SINGULAR_LIBDIR], [Singular], [libdir])` to get `SINGULAR_LIBDIR`.\nI suppose, to be on the safe side we should prepend it to `SINGULAR_LIB_BASE` unconditionally, not only on macOS.",
    "created_at": "2021-09-20T18:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565463",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
Indeed, we can instead call `PKG_CHECK_VAR([SINGULAR_LIBDIR], [Singular], [libdir])` to get `SINGULAR_LIBDIR`.
I suppose, to be on the safe side we should prepend it to `SINGULAR_LIB_BASE` unconditionally, not only on macOS.



---

archive/issue_comments_565464.json:
```json
{
    "body": "**Changing commit** from \"[f72df456ba4c29b5b5353948af02d3ed9a8a66d3](https://github.com/sagemath/sagetrac-mirror/commit/f72df456ba4c29b5b5353948af02d3ed9a8a66d3)\" to \"[f11791b35962276ae007802d5397572a58a0e3bd](https://github.com/sagemath/sagetrac-mirror/commit/f11791b35962276ae007802d5397572a58a0e3bd)\".",
    "created_at": "2021-09-20T19:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565464",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f72df456ba4c29b5b5353948af02d3ed9a8a66d3](https://github.com/sagemath/sagetrac-mirror/commit/f72df456ba4c29b5b5353948af02d3ed9a8a66d3)" to "[f11791b35962276ae007802d5397572a58a0e3bd](https://github.com/sagemath/sagetrac-mirror/commit/f11791b35962276ae007802d5397572a58a0e3bd)".



---

archive/issue_comments_565465.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f11791b35962276ae007802d5397572a58a0e3bd\">f11791b</a></td><td><code>pkg-config to get the libdir, properly nest tests</code></td></tr></table>\n",
    "created_at": "2021-09-20T19:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565465",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f11791b35962276ae007802d5397572a58a0e3bd">f11791b</a></td><td><code>pkg-config to get the libdir, properly nest tests</code></td></tr></table>




---

archive/issue_comments_565466.json:
```json
{
    "body": "<a id='comment:4'></a>\nI was working on this at the same time =(\n\nhttps://git.sagemath.org/sage.git/commit/?h=u/mjo/ticket/29024&id=5a494d5a6b96949c5744239a0c8f866f3c2d9ac2\n\nI've simplified the variables a bit, so the \"base\" and extension are no longer separate. I also added the special-case for cygwin into the system-singular code branch.",
    "created_at": "2021-09-20T19:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565466",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>
I was working on this at the same time =(

https://git.sagemath.org/sage.git/commit/?h=u/mjo/ticket/29024&id=5a494d5a6b96949c5744239a0c8f866f3c2d9ac2

I've simplified the variables a bit, so the "base" and extension are no longer separate. I also added the special-case for cygwin into the system-singular code branch.



---

archive/issue_comments_565467.json:
```json
{
    "body": "**Changing commit** from \"[f11791b35962276ae007802d5397572a58a0e3bd](https://github.com/sagemath/sagetrac-mirror/commit/f11791b35962276ae007802d5397572a58a0e3bd)\" to \"[e6c41f7d7d13fca5dd6f2802c75e8c829b040e92](https://github.com/sagemath/sagetrac-mirror/commit/e6c41f7d7d13fca5dd6f2802c75e8c829b040e92)\".",
    "created_at": "2021-09-21T19:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565467",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f11791b35962276ae007802d5397572a58a0e3bd](https://github.com/sagemath/sagetrac-mirror/commit/f11791b35962276ae007802d5397572a58a0e3bd)" to "[e6c41f7d7d13fca5dd6f2802c75e8c829b040e92](https://github.com/sagemath/sagetrac-mirror/commit/e6c41f7d7d13fca5dd6f2802c75e8c829b040e92)".



---

archive/issue_comments_565468.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6c41f7d7d13fca5dd6f2802c75e8c829b040e92\">e6c41f7</a></td><td><code>Fedora needs devel pkg</code></td></tr></table>\n",
    "created_at": "2021-09-21T19:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6c41f7d7d13fca5dd6f2802c75e8c829b040e92">e6c41f7</a></td><td><code>Fedora needs devel pkg</code></td></tr></table>




---

archive/issue_comments_565469.json:
```json
{
    "body": "<a id='comment:116'></a>\nReplying to [mjo](#comment%3A114):\n> I was working on this at the same time =(\n> \n> https://git.sagemath.org/sage.git/commit/?h=u/mjo/ticket/29024&id=5a494d5a6b96949c5744239a0c8f866f3c2d9ac2\n> \n> I've simplified the variables a bit, so the \"base\" and extension are no longer separate. I also added the special-case for cygwin into the system-singular code branch.\n\n\nI'll try to merge your improvements",
    "created_at": "2021-09-21T19:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565469",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:116'></a>
Replying to [mjo](#comment%3A114):
> I was working on this at the same time =(
> 
> https://git.sagemath.org/sage.git/commit/?h=u/mjo/ticket/29024&id=5a494d5a6b96949c5744239a0c8f866f3c2d9ac2
> 
> I've simplified the variables a bit, so the "base" and extension are no longer separate. I also added the special-case for cygwin into the system-singular code branch.


I'll try to merge your improvements



---

archive/issue_comments_565470.json:
```json
{
    "body": "**Changing dependencies** from \"#32302, #31275, #32243\" to \"#32302, #31275, #32243, #32549\".",
    "created_at": "2021-09-27T16:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565470",
    "user": "https://github.com/dimpase"
}
```

**Changing dependencies** from "#32302, #31275, #32243" to "#32302, #31275, #32243, #32549".



---

archive/issue_comments_565471.json:
```json
{
    "body": "<a id='comment:8'></a>\nthere is also #32549 removing `mpir` spkg, so `mpir` should disappear in `spkg-config.m4`",
    "created_at": "2021-09-27T16:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565471",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
there is also #32549 removing `mpir` spkg, so `mpir` should disappear in `spkg-config.m4`



---

archive/issue_comments_565472.json:
```json
{
    "body": "**Changing dependencies** from \"#32302, #31275, #32243, #32549\" to \"#32549\".",
    "created_at": "2021-10-01T10:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565472",
    "user": "https://github.com/dimpase"
}
```

**Changing dependencies** from "#32302, #31275, #32243, #32549" to "#32549".



---

archive/issue_comments_565473.json:
```json
{
    "body": "**Changing commit** from \"[e6c41f7d7d13fca5dd6f2802c75e8c829b040e92](https://github.com/sagemath/sagetrac-mirror/commit/e6c41f7d7d13fca5dd6f2802c75e8c829b040e92)\" to \"[3404652e8897d662a83953c32d9b1ef8266ef443](https://github.com/sagemath/sagetrac-mirror/commit/3404652e8897d662a83953c32d9b1ef8266ef443)\".",
    "created_at": "2021-10-01T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565473",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e6c41f7d7d13fca5dd6f2802c75e8c829b040e92](https://github.com/sagemath/sagetrac-mirror/commit/e6c41f7d7d13fca5dd6f2802c75e8c829b040e92)" to "[3404652e8897d662a83953c32d9b1ef8266ef443](https://github.com/sagemath/sagetrac-mirror/commit/3404652e8897d662a83953c32d9b1ef8266ef443)".



---

archive/issue_comments_565474.json:
```json
{
    "body": "<a id='comment:0'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5b8ac835fc6f700b1ddba090dee2ec9b62f6aef\">d5b8ac8</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9589a1d88ebae11eeb8f2b642311ca90fd902184\">9589a1d</a></td><td><code>29024: Add Singular distro info</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c76a975c84ffc0ec23f42fffb07b0f3420120d5b\">c76a975</a></td><td><code>Trac #29024: work around Singular issue 1113 in init_libsingular().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3730d72ff2ee80b9db319a80f35073eea067686e\">3730d72</a></td><td><code>Trac #29024: add missing AC_MSG_RESULTs in singular/spkg-configure.m4.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30e7fd64ad7e90f584dfa2d625eb11944c1463e6\">30e7fd6</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f64594cfb9fc0a10df1b4d3cf0ec113d789748fd\">f64594c</a></td><td><code>Trac #29024: fix libSingular path on Cygwin.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/73d301d0e457022d3bd841f7d0b1183945cf6cec\">73d301d</a></td><td><code>macOS dlopen() prefers full path sometimes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/604b0c4bd3fcc2ddc91d8c4bec9e6dd12fd97397\">604b0c4</a></td><td><code>pkg-config to get the libdir, properly nest tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca4aa03854ffed1625d877f2665d1a4ccae1becc\">ca4aa03</a></td><td><code>Fedora needs devel pkg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3404652e8897d662a83953c32d9b1ef8266ef443\">3404652</a></td><td><code>dependance on gmp/mpir already covered by mpfr</code></td></tr></table>\n",
    "created_at": "2021-10-01T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5b8ac835fc6f700b1ddba090dee2ec9b62f6aef">d5b8ac8</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9589a1d88ebae11eeb8f2b642311ca90fd902184">9589a1d</a></td><td><code>29024: Add Singular distro info</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c76a975c84ffc0ec23f42fffb07b0f3420120d5b">c76a975</a></td><td><code>Trac #29024: work around Singular issue 1113 in init_libsingular().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3730d72ff2ee80b9db319a80f35073eea067686e">3730d72</a></td><td><code>Trac #29024: add missing AC_MSG_RESULTs in singular/spkg-configure.m4.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30e7fd64ad7e90f584dfa2d625eb11944c1463e6">30e7fd6</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f64594cfb9fc0a10df1b4d3cf0ec113d789748fd">f64594c</a></td><td><code>Trac #29024: fix libSingular path on Cygwin.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/73d301d0e457022d3bd841f7d0b1183945cf6cec">73d301d</a></td><td><code>macOS dlopen() prefers full path sometimes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/604b0c4bd3fcc2ddc91d8c4bec9e6dd12fd97397">604b0c4</a></td><td><code>pkg-config to get the libdir, properly nest tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca4aa03854ffed1625d877f2665d1a4ccae1becc">ca4aa03</a></td><td><code>Fedora needs devel pkg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3404652e8897d662a83953c32d9b1ef8266ef443">3404652</a></td><td><code>dependance on gmp/mpir already covered by mpfr</code></td></tr></table>




---

archive/issue_comments_565475.json:
```json
{
    "body": "**Changing dependencies** from \"#32549\" to \"\".",
    "created_at": "2021-10-01T11:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565475",
    "user": "https://github.com/dimpase"
}
```

**Changing dependencies** from "#32549" to "".



---

archive/issue_comments_565476.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a61b3a5f284d5eb8253258cbc93066200e48cfae\">a61b3a5</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa65fa52bd6b245bcdbb8bf4c30fb5296527d27d\">fa65fa5</a></td><td><code>29024: Add Singular distro info</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0846173e4d555729723c2478b84d63f9bbd6d058\">0846173</a></td><td><code>Trac #29024: work around Singular issue 1113 in init_libsingular().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd69ac195689360d144caf171746a59f35e49915\">dd69ac1</a></td><td><code>Trac #29024: add missing AC_MSG_RESULTs in singular/spkg-configure.m4.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d6080fd16ad4ecca19e41b53b6ce86bce8e5c0f\">9d6080f</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0c0e050240cf2ba254b81d4232cd9f484e8104d\">e0c0e05</a></td><td><code>Trac #29024: fix libSingular path on Cygwin.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93b2f477c59df09909eeae182752f2aa1fcc64ff\">93b2f47</a></td><td><code>macOS dlopen() prefers full path sometimes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dca5125df0411700a1c5325b052b372de84db85d\">dca5125</a></td><td><code>pkg-config to get the libdir, properly nest tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f85d09ca3ee5011862a68c2de88d4f2a9c9294ef\">f85d09c</a></td><td><code>Fedora needs devel pkg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8db64bda6e1939e1af277b2925dddd0f8167d30\">d8db64b</a></td><td><code>dependance on gmp/mpir already covered by mpfr</code></td></tr></table>\n",
    "created_at": "2021-10-14T09:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565476",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a61b3a5f284d5eb8253258cbc93066200e48cfae">a61b3a5</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa65fa52bd6b245bcdbb8bf4c30fb5296527d27d">fa65fa5</a></td><td><code>29024: Add Singular distro info</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0846173e4d555729723c2478b84d63f9bbd6d058">0846173</a></td><td><code>Trac #29024: work around Singular issue 1113 in init_libsingular().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd69ac195689360d144caf171746a59f35e49915">dd69ac1</a></td><td><code>Trac #29024: add missing AC_MSG_RESULTs in singular/spkg-configure.m4.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d6080fd16ad4ecca19e41b53b6ce86bce8e5c0f">9d6080f</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0c0e050240cf2ba254b81d4232cd9f484e8104d">e0c0e05</a></td><td><code>Trac #29024: fix libSingular path on Cygwin.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93b2f477c59df09909eeae182752f2aa1fcc64ff">93b2f47</a></td><td><code>macOS dlopen() prefers full path sometimes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dca5125df0411700a1c5325b052b372de84db85d">dca5125</a></td><td><code>pkg-config to get the libdir, properly nest tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f85d09ca3ee5011862a68c2de88d4f2a9c9294ef">f85d09c</a></td><td><code>Fedora needs devel pkg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8db64bda6e1939e1af277b2925dddd0f8167d30">d8db64b</a></td><td><code>dependance on gmp/mpir already covered by mpfr</code></td></tr></table>




---

archive/issue_comments_565477.json:
```json
{
    "body": "**Changing commit** from \"[3404652e8897d662a83953c32d9b1ef8266ef443](https://github.com/sagemath/sagetrac-mirror/commit/3404652e8897d662a83953c32d9b1ef8266ef443)\" to \"[d8db64bda6e1939e1af277b2925dddd0f8167d30](https://github.com/sagemath/sagetrac-mirror/commit/d8db64bda6e1939e1af277b2925dddd0f8167d30)\".",
    "created_at": "2021-10-14T09:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3404652e8897d662a83953c32d9b1ef8266ef443](https://github.com/sagemath/sagetrac-mirror/commit/3404652e8897d662a83953c32d9b1ef8266ef443)" to "[d8db64bda6e1939e1af277b2925dddd0f8167d30](https://github.com/sagemath/sagetrac-mirror/commit/d8db64bda6e1939e1af277b2925dddd0f8167d30)".



---

archive/issue_comments_565478.json:
```json
{
    "body": "<a id='comment:3'></a>\nso what's exactly is different in functionality in the current ticket branch, `u/dimpase/ticket/29024` vs \n`u/mjo/ticket/29024` ?",
    "created_at": "2021-10-14T09:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565478",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
so what's exactly is different in functionality in the current ticket branch, `u/dimpase/ticket/29024` vs 
`u/mjo/ticket/29024` ?



---

archive/issue_comments_565479.json:
```json
{
    "body": "<a id='comment:4'></a>\nNow that we're just asking pkg-config for the correct location, the two variables `SINGULAR_LIB_BASE` and `SINGULAR_LIB_FILE` are redundant. (The \"base\" variable would be left empty in the past to let `dlopen()` search for the library.) I think the main difference in my branch is that I've refactored things to use only a single variable, `LIBSINGULAR_PATH`. The rest should be cosmetic.",
    "created_at": "2021-10-14T12:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565479",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>
Now that we're just asking pkg-config for the correct location, the two variables `SINGULAR_LIB_BASE` and `SINGULAR_LIB_FILE` are redundant. (The "base" variable would be left empty in the past to let `dlopen()` search for the library.) I think the main difference in my branch is that I've refactored things to use only a single variable, `LIBSINGULAR_PATH`. The rest should be cosmetic.



---

archive/issue_comments_565480.json:
```json
{
    "body": "<a id='comment:5'></a>\nyou do non-nested calls where they can and should be nested. slows down `./configure` for no reason.",
    "created_at": "2021-10-14T20:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565480",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
you do non-nested calls where they can and should be nested. slows down `./configure` for no reason.



---

archive/issue_comments_565481.json:
```json
{
    "body": "<a id='comment:126'></a>\nReplying to [dimpase](#comment%3A125):\n> you do non-nested calls where they can and should be nested. slows down `./configure` for no reason.\n\n\nI find the logic much easier to understand when the \"else\" branch of a test is not separated from the test by an entire page. Ideally I would be able to put something like `return;` after each `sage_spkg_install_singular=yes`, but I don't know of a reliable way to accomplish that.\n\nRunning \"make\" takes many hours, so an extra second or two on systems without Singular didn't seem like a huge problem. And those of us who work on the build system and run `./configure` repeatedly should be clever enough to install it. But I could still nest them if that's a deal-breaker for you.",
    "created_at": "2021-10-14T22:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565481",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:126'></a>
Replying to [dimpase](#comment%3A125):
> you do non-nested calls where they can and should be nested. slows down `./configure` for no reason.


I find the logic much easier to understand when the "else" branch of a test is not separated from the test by an entire page. Ideally I would be able to put something like `return;` after each `sage_spkg_install_singular=yes`, but I don't know of a reliable way to accomplish that.

Running "make" takes many hours, so an extra second or two on systems without Singular didn't seem like a huge problem. And those of us who work on the build system and run `./configure` repeatedly should be clever enough to install it. But I could still nest them if that's a deal-breaker for you.



---

archive/issue_comments_565482.json:
```json
{
    "body": "<a id='comment:127'></a>\nReplying to [mjo](#comment%3A126):\n> Replying to [dimpase](#comment%3A125):\n> > you do non-nested calls where they can and should be nested. slows down `./configure` for no reason.\n\n> \n> I find the logic much easier to understand when the \"else\" branch of a test is not separated from the test by an entire page. \n\n\nDo some coding in Lisp, then, for the training purposes ;-)\n\n> Ideally I would be able to put something like `return;` after each `sage_spkg_install_singular=yes`, but I don't know of a reliable way to accomplish that.\n> \n> Running \"make\" takes many hours, so an extra second or two on systems without Singular didn't seem like a huge problem. And those of us who work on the build system and run `./configure` repeatedly should be clever enough to install it. But I could still nest them if that's a deal-breaker for you.\n\n\nAlso, nesting makes sure that the output in case of errors is meaningful - it just errors on the 1st failing place, and that's it.",
    "created_at": "2021-10-18T08:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565482",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:127'></a>
Replying to [mjo](#comment%3A126):
> Replying to [dimpase](#comment%3A125):
> > you do non-nested calls where they can and should be nested. slows down `./configure` for no reason.

> 
> I find the logic much easier to understand when the "else" branch of a test is not separated from the test by an entire page. 


Do some coding in Lisp, then, for the training purposes ;-)

> Ideally I would be able to put something like `return;` after each `sage_spkg_install_singular=yes`, but I don't know of a reliable way to accomplish that.
> 
> Running "make" takes many hours, so an extra second or two on systems without Singular didn't seem like a huge problem. And those of us who work on the build system and run `./configure` repeatedly should be clever enough to install it. But I could still nest them if that's a deal-breaker for you.


Also, nesting makes sure that the output in case of errors is meaningful - it just errors on the 1st failing place, and that's it.



---

archive/issue_comments_565483.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'm willing to review a branch with nesting - or, you can review my branch...",
    "created_at": "2021-10-18T09:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565483",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
I'm willing to review a branch with nesting - or, you can review my branch...



---

archive/issue_comments_565484.json:
```json
{
    "body": "**Changing commit** from \"[d8db64bda6e1939e1af277b2925dddd0f8167d30](https://github.com/sagemath/sagetrac-mirror/commit/d8db64bda6e1939e1af277b2925dddd0f8167d30)\" to \"[eb3b4e559096605857584054ecdfe3556e6444ed](https://github.com/sagemath/sagetrac-mirror/commit/eb3b4e559096605857584054ecdfe3556e6444ed)\".",
    "created_at": "2021-10-19T01:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565484",
    "user": "https://github.com/orlitzky"
}
```

**Changing commit** from "[d8db64bda6e1939e1af277b2925dddd0f8167d30](https://github.com/sagemath/sagetrac-mirror/commit/d8db64bda6e1939e1af277b2925dddd0f8167d30)" to "[eb3b4e559096605857584054ecdfe3556e6444ed](https://github.com/sagemath/sagetrac-mirror/commit/eb3b4e559096605857584054ecdfe3556e6444ed)".



---

archive/issue_comments_565485.json:
```json
{
    "body": "**Changing branch** from \"[u/dimpase/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/29024)\" to \"[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)\".",
    "created_at": "2021-10-19T01:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565485",
    "user": "https://github.com/orlitzky"
}
```

**Changing branch** from "[u/dimpase/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/ticket/29024)" to "[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)".



---

archive/issue_comments_565486.json:
```json
{
    "body": "<a id='comment:9'></a>\nHere it is fully nested. I cherry-picked your fix for `fedora.txt`, but I left \"gmp\" in the DEPCHECK because it's easier to just list them all than it is to try to keep track of which DEPCHECKs need to be modified when e.g. mpfr loses a dependency.\n\n---\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfb586073a5d4cc288ef3016906f380de1330411\">dfb5860</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/175e6f60242d254cd4b740f35a8a4f0279aec40c\">175e6f6</a></td><td><code>29024: Add Singular distro info</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc1dcc336664e40dfda0015e19ff2999f76d1bd4\">dc1dcc3</a></td><td><code>Trac #29024: work around Singular issue 1113 in init_libsingular().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef79af8694275ed26bab03830e6bccb2cd5c2e13\">ef79af8</a></td><td><code>Trac #29024: add missing AC_MSG_RESULTs in singular/spkg-configure.m4.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f32b6920d4a029d94af9e7ede5fa91bbcff612e\">2f32b69</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ec888adb74c05a078c525cf382f9a1b4bca59ca\">8ec888a</a></td><td><code>Trac #29024: fix libSingular path on Cygwin.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62065de4b44c87638b561cd7ce8b8bbc19adc6ab\">62065de</a></td><td><code>Trac #29024: always obtain the absolute path to libSingular.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2aa55e7fb03a6c7ad8db80c779c9fb70b17d8290\">2aa55e7</a></td><td><code>Trac #29024: fully nest tests in Singular's spkg-configure.m4.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eecd43c457228ef2b05832ba11d40bc17127e5f4\">eecd43c</a></td><td><code>Fedora needs devel pkg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb3b4e559096605857584054ecdfe3556e6444ed\">eb3b4e5</a></td><td><code>Trac #29024: drop \"mpir\" from singular's DEPCHECK.</code></td></tr></table>\n",
    "created_at": "2021-10-19T01:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565486",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:9'></a>
Here it is fully nested. I cherry-picked your fix for `fedora.txt`, but I left "gmp" in the DEPCHECK because it's easier to just list them all than it is to try to keep track of which DEPCHECKs need to be modified when e.g. mpfr loses a dependency.

---
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfb586073a5d4cc288ef3016906f380de1330411">dfb5860</a></td><td><code>Trac #29024: add Gentoo package information.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/175e6f60242d254cd4b740f35a8a4f0279aec40c">175e6f6</a></td><td><code>29024: Add Singular distro info</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc1dcc336664e40dfda0015e19ff2999f76d1bd4">dc1dcc3</a></td><td><code>Trac #29024: work around Singular issue 1113 in init_libsingular().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef79af8694275ed26bab03830e6bccb2cd5c2e13">ef79af8</a></td><td><code>Trac #29024: add missing AC_MSG_RESULTs in singular/spkg-configure.m4.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f32b6920d4a029d94af9e7ede5fa91bbcff612e">2f32b69</a></td><td><code>Trac #29024: clarify a comment in singular's spkg-configure.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ec888adb74c05a078c525cf382f9a1b4bca59ca">8ec888a</a></td><td><code>Trac #29024: fix libSingular path on Cygwin.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62065de4b44c87638b561cd7ce8b8bbc19adc6ab">62065de</a></td><td><code>Trac #29024: always obtain the absolute path to libSingular.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2aa55e7fb03a6c7ad8db80c779c9fb70b17d8290">2aa55e7</a></td><td><code>Trac #29024: fully nest tests in Singular's spkg-configure.m4.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eecd43c457228ef2b05832ba11d40bc17127e5f4">eecd43c</a></td><td><code>Fedora needs devel pkg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb3b4e559096605857584054ecdfe3556e6444ed">eb3b4e5</a></td><td><code>Trac #29024: drop "mpir" from singular's DEPCHECK.</code></td></tr></table>




---

archive/issue_comments_565487.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-10-19T01:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565487",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_565488.json:
```json
{
    "body": "<a id='comment:0'></a>\n`build/pkgs/singular/distros/homebrew.txt` should be like in my branch:\n\n```diff\n--- a/build/pkgs/singular/distros/homebrew.txt\n+++ b/build/pkgs/singular/distros/homebrew.txt\n@@ -1,5 +1 @@\n-# [2021-03-20] Homebrew's Singular can be built from source\n-# (via `brew install -s`, or implied when using `brew` with\n-# a non-standard prefix), but that currently fails.\n-\n-#singular\n+singular\n```",
    "created_at": "2021-10-19T09:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565488",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
`build/pkgs/singular/distros/homebrew.txt` should be like in my branch:

```diff
--- a/build/pkgs/singular/distros/homebrew.txt
+++ b/build/pkgs/singular/distros/homebrew.txt
@@ -1,5 +1 @@
-# [2021-03-20] Homebrew's Singular can be built from source
-# (via `brew install -s`, or implied when using `brew` with
-# a non-standard prefix), but that currently fails.
-
-#singular
+singular
```



---

archive/issue_comments_565489.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd\">a3c5305</a></td><td><code>Trac #29024: re-enable the system singular hint on homebrew.</code></td></tr></table>\n",
    "created_at": "2021-10-19T11:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd">a3c5305</a></td><td><code>Trac #29024: re-enable the system singular hint on homebrew.</code></td></tr></table>




---

archive/issue_comments_565490.json:
```json
{
    "body": "**Changing commit** from \"[eb3b4e559096605857584054ecdfe3556e6444ed](https://github.com/sagemath/sagetrac-mirror/commit/eb3b4e559096605857584054ecdfe3556e6444ed)\" to \"[a3c53051a5961226700bdb8a40f831092f8dffcd](https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd)\".",
    "created_at": "2021-10-19T11:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565490",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[eb3b4e559096605857584054ecdfe3556e6444ed](https://github.com/sagemath/sagetrac-mirror/commit/eb3b4e559096605857584054ecdfe3556e6444ed)" to "[a3c53051a5961226700bdb8a40f831092f8dffcd](https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd)".



---

archive/issue_comments_565491.json:
```json
{
    "body": "<a id='comment:2'></a>\nlgtm",
    "created_at": "2021-10-19T14:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565491",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
lgtm



---

archive/issue_comments_565492.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-10-19T14:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565492",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_565493.json:
```json
{
    "body": "<a id='comment:3'></a>\ncomment:95 hasn't been addressed. This breaks `sage_conf`-less installs.",
    "created_at": "2021-10-19T16:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565493",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:3'></a>
comment:95 hasn't been addressed. This breaks `sage_conf`-less installs.



---

archive/issue_comments_565494.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2021-10-19T16:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565494",
    "user": "https://github.com/antonio-rojas"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_565495.json:
```json
{
    "body": "<a id='comment:134'></a>\nReplying to [arojas](#comment%3A133):\n> comment:95 hasn't been addressed. This breaks `sage_conf`-less installs.\n\n\nPlease open a followup ticket. It's not clear to me how or what exactly needs to be be fixed.",
    "created_at": "2021-10-19T16:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565495",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:134'></a>
Replying to [arojas](#comment%3A133):
> comment:95 hasn't been addressed. This breaks `sage_conf`-less installs.


Please open a followup ticket. It's not clear to me how or what exactly needs to be be fixed.



---

archive/issue_comments_565496.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2021-10-19T16:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565496",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_565497.json:
```json
{
    "body": "<a id='comment:135'></a>\nReplying to [git](#comment%3A131):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd\">a3c5305</a></td><td><code>Trac #29024: re-enable the system singular hint on homebrew.</code></td></tr></table>\n\n\nThis needs testing on GH Actions.",
    "created_at": "2021-10-19T16:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565497",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:135'></a>
Replying to [git](#comment%3A131):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd">a3c5305</a></td><td><code>Trac #29024: re-enable the system singular hint on homebrew.</code></td></tr></table>


This needs testing on GH Actions.



---

archive/issue_comments_565498.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2021-10-19T16:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565498",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_565499.json:
```json
{
    "body": "<a id='comment:6'></a>\nneeds *work* ? On what exactly?",
    "created_at": "2021-10-19T17:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565499",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
needs *work* ? On what exactly?



---

archive/issue_comments_565500.json:
```json
{
    "body": "<a id='comment:7'></a>\nI suggest we run tests on the followup ticket for `sage_conf`-less installs.\n\nThe most one might need to adjust here is the list of distros on which this works.",
    "created_at": "2021-10-19T17:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565500",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
I suggest we run tests on the followup ticket for `sage_conf`-less installs.

The most one might need to adjust here is the list of distros on which this works.



---

archive/issue_comments_565501.json:
```json
{
    "body": "<a id='comment:138'></a>\nReplying to [dimpase](#comment%3A134):\n> It's not clear to me how or what exactly needs to be be fixed.\n\n\nThis unconditionally imports `sage_conf` so it breaks on systems without it. As I said in [comment:97](#comment%3A97) adding a simple fallback should fix it, here is a patch that works for me\n\n```diff\ndiff --git a/src/sage/libs/singular/singular.pyx b/src/sage/libs/singular/singular.pyx\nindex ea6d0ab01d..8dfa490de5 100644\n--- a/src/sage/libs/singular/singular.pyx\n+++ b/src/sage/libs/singular/singular.pyx\n@@ -768,7 +768,11 @@ cdef init_libsingular():\n \n     cdef void *handle = NULL\n \n-    from sage_conf import LIBSINGULAR_PATH\n+    try:\n+        from sage_conf import LIBSINGULAR_PATH\n+    except ImportError:\n+    # No sage_conf, assume everything is properly set up by the distro\n+        LIBSINGULAR_PATH=\"libSingular.so\"\n     lib = str_to_bytes(LIBSINGULAR_PATH, FS_ENCODING, \"surrogateescape\")\n \n     # This is a workaround for https://github.com/Singular/Singular/issues/1113\n```",
    "created_at": "2021-10-19T17:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565501",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:138'></a>
Replying to [dimpase](#comment%3A134):
> It's not clear to me how or what exactly needs to be be fixed.


This unconditionally imports `sage_conf` so it breaks on systems without it. As I said in [comment:97](#comment%3A97) adding a simple fallback should fix it, here is a patch that works for me

```diff
diff --git a/src/sage/libs/singular/singular.pyx b/src/sage/libs/singular/singular.pyx
index ea6d0ab01d..8dfa490de5 100644
--- a/src/sage/libs/singular/singular.pyx
+++ b/src/sage/libs/singular/singular.pyx
@@ -768,7 +768,11 @@ cdef init_libsingular():
 
     cdef void *handle = NULL
 
-    from sage_conf import LIBSINGULAR_PATH
+    try:
+        from sage_conf import LIBSINGULAR_PATH
+    except ImportError:
+    # No sage_conf, assume everything is properly set up by the distro
+        LIBSINGULAR_PATH="libSingular.so"
     lib = str_to_bytes(LIBSINGULAR_PATH, FS_ENCODING, "surrogateescape")
 
     # This is a workaround for https://github.com/Singular/Singular/issues/1113
```



---

archive/issue_comments_565502.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-10-19T17:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565502",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_565503.json:
```json
{
    "body": "<a id='comment:9'></a>\nsee https://github.com/sagemath/sagetrac-mirror/actions/runs/1360343429",
    "created_at": "2021-10-19T17:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565503",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
see https://github.com/sagemath/sagetrac-mirror/actions/runs/1360343429



---

archive/issue_comments_565504.json:
```json
{
    "body": "<a id='comment:140'></a>\nReplying to [arojas](#comment%3A138):\n> Replying to [dimpase](#comment%3A134):\n> > It's not clear to me how or what exactly needs to be be fixed.\n\n> \n> This unconditionally imports `sage_conf` so it breaks on systems without it. As I said in [comment:97](#comment%3A97) adding a simple fallback should fix it, here is a patch that works for me\n> \n> ```diff\n> diff --git a/src/sage/libs/singular/singular.pyx b/src/sage/libs/singular/singular.pyx\n> index ea6d0ab01d..8dfa490de5 100644\n> --- a/src/sage/libs/singular/singular.pyx\n> +++ b/src/sage/libs/singular/singular.pyx\n> @@ -768,7 +768,11 @@ cdef init_libsingular():\n>  \n>      cdef void *handle = NULL\n>  \n> -    from sage_conf import LIBSINGULAR_PATH\n> +    try:\n> +        from sage_conf import LIBSINGULAR_PATH\n> +    except ImportError:\n> +    # No sage_conf, assume everything is properly set up by the distro\n> +        LIBSINGULAR_PATH=\"libSingular.so\"\n>      lib = str_to_bytes(LIBSINGULAR_PATH, FS_ENCODING, \"surrogateescape\")\n>  \n>      # This is a workaround for https://github.com/Singular/Singular/issues/1113\n> ```\n\n\n\nActually this should be rewritten so that it goes through a variable declared in `sage.env` instead of using `sage_conf` directly.\n\n`sage.env` already takes care of conditional import from `sage_conf`.",
    "created_at": "2021-10-19T18:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565504",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:140'></a>
Replying to [arojas](#comment%3A138):
> Replying to [dimpase](#comment%3A134):
> > It's not clear to me how or what exactly needs to be be fixed.

> 
> This unconditionally imports `sage_conf` so it breaks on systems without it. As I said in [comment:97](#comment%3A97) adding a simple fallback should fix it, here is a patch that works for me
> 
> ```diff
> diff --git a/src/sage/libs/singular/singular.pyx b/src/sage/libs/singular/singular.pyx
> index ea6d0ab01d..8dfa490de5 100644
> --- a/src/sage/libs/singular/singular.pyx
> +++ b/src/sage/libs/singular/singular.pyx
> @@ -768,7 +768,11 @@ cdef init_libsingular():
>  
>      cdef void *handle = NULL
>  
> -    from sage_conf import LIBSINGULAR_PATH
> +    try:
> +        from sage_conf import LIBSINGULAR_PATH
> +    except ImportError:
> +    # No sage_conf, assume everything is properly set up by the distro
> +        LIBSINGULAR_PATH="libSingular.so"
>      lib = str_to_bytes(LIBSINGULAR_PATH, FS_ENCODING, "surrogateescape")
>  
>      # This is a workaround for https://github.com/Singular/Singular/issues/1113
> ```



Actually this should be rewritten so that it goes through a variable declared in `sage.env` instead of using `sage_conf` directly.

`sage.env` already takes care of conditional import from `sage_conf`.



---

archive/issue_comments_565505.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2021-10-19T18:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565505",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_565506.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-10-22T09:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565506",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_565507.json:
```json
{
    "body": "<a id='comment:1'></a>\nPlease either propose a concrete patch, or move this over to a followup tiket.",
    "created_at": "2021-10-22T09:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565507",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
Please either propose a concrete patch, or move this over to a followup tiket.



---

archive/issue_comments_565508.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think what he means is that one should keep using `sage.env` instead of `sage_conf` here\nhttps://github.com/sagemath/sagetrac-mirror/compare/develop...u/mjo/ticket/29024#diff-25a6d752c56f179f8798c63d0938849853c5c6d61b21a171aae63bee0f6eb6cfL771-R773\n\nI'm not sure about the conventions but for cblas pkgconfig is used in `sage.env` and not in in the spk_configure script, see https://github.com/sagemath/sage/blob/056b8d4e7bcdc936af39a33d3885925f1c850f80/src/sage/env.py#L401-L407. I guess the latter is more flexible as it would also work outside of sage's build environment, i.e. without LIBSINGULAR_PATH set.",
    "created_at": "2021-10-22T10:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565508",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:2'></a>
I think what he means is that one should keep using `sage.env` instead of `sage_conf` here
https://github.com/sagemath/sagetrac-mirror/compare/develop...u/mjo/ticket/29024#diff-25a6d752c56f179f8798c63d0938849853c5c6d61b21a171aae63bee0f6eb6cfL771-R773

I'm not sure about the conventions but for cblas pkgconfig is used in `sage.env` and not in in the spk_configure script, see https://github.com/sagemath/sage/blob/056b8d4e7bcdc936af39a33d3885925f1c850f80/src/sage/env.py#L401-L407. I guess the latter is more flexible as it would also work outside of sage's build environment, i.e. without LIBSINGULAR_PATH set.



---

archive/issue_comments_565509.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis sounds more and more like \"move this over to a followup ticket\" --- for pkg-config and its generated files are a special can of worms to open.",
    "created_at": "2021-10-22T10:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565509",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
This sounds more and more like "move this over to a followup ticket" --- for pkg-config and its generated files are a special can of worms to open.



---

archive/issue_comments_565510.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023\">f01ff1f</a></td><td><code>Trac #29024: obtain LIBSINGULAR_PATH from sage.env instead of sage_conf.</code></td></tr></table>\n",
    "created_at": "2021-10-22T11:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023">f01ff1f</a></td><td><code>Trac #29024: obtain LIBSINGULAR_PATH from sage.env instead of sage_conf.</code></td></tr></table>




---

archive/issue_comments_565511.json:
```json
{
    "body": "**Changing commit** from \"[a3c53051a5961226700bdb8a40f831092f8dffcd](https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd)\" to \"[f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023](https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023)\".",
    "created_at": "2021-10-22T11:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a3c53051a5961226700bdb8a40f831092f8dffcd](https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd)" to "[f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023](https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023)".



---

archive/issue_comments_565512.json:
```json
{
    "body": "<a id='comment:5'></a>\narojas, does this work?",
    "created_at": "2021-10-22T11:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565512",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:5'></a>
arojas, does this work?



---

archive/issue_comments_565513.json:
```json
{
    "body": "<a id='comment:146'></a>\nReplying to [mjo](#comment%3A145):\n> arojas, does this work?\n\n\nAll good now. Thank you!",
    "created_at": "2021-10-22T11:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565513",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:146'></a>
Replying to [mjo](#comment%3A145):
> arojas, does this work?


All good now. Thank you!



---

archive/issue_comments_565514.json:
```json
{
    "body": "<a id='comment:7'></a>\nBy the way, while trying to combine this and `u/mkoeppe/spkg_configure_m4_for_polymake`\non Arch I see some messages about conflicting BLAS for Polymake (BLAS) and Singular (OpenBLAS). Is this normal?",
    "created_at": "2021-10-22T12:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565514",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
By the way, while trying to combine this and `u/mkoeppe/spkg_configure_m4_for_polymake`
on Arch I see some messages about conflicting BLAS for Polymake (BLAS) and Singular (OpenBLAS). Is this normal?



---

archive/issue_comments_565515.json:
```json
{
    "body": "<a id='comment:8'></a>\nOK, good, thanks.",
    "created_at": "2021-10-22T16:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565515",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
OK, good, thanks.



---

archive/issue_comments_565516.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-10-22T16:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565516",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_565517.json:
```json
{
    "body": "<a id='comment:149'></a>\nReplying to [mkoeppe](#comment%3A135):\n> Replying to [git](#comment%3A131):\n> > Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd\">a3c5305</a></td><td><code>Trac #29024: re-enable the system singular hint on homebrew.</code></td></tr></table>\n\n> \n> This needs testing on GH Actions.\n\n\nIn the cited commit, you removed the comment that explained why the `singular` package was not included on homebrew. Unless homebrew packaging of `singular` has changed in the meantime, this will break all of our automated tests on homebrew.\n\nThis is what would have needed testing.",
    "created_at": "2021-10-24T17:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565517",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:149'></a>
Replying to [mkoeppe](#comment%3A135):
> Replying to [git](#comment%3A131):
> > Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3c53051a5961226700bdb8a40f831092f8dffcd">a3c5305</a></td><td><code>Trac #29024: re-enable the system singular hint on homebrew.</code></td></tr></table>

> 
> This needs testing on GH Actions.


In the cited commit, you removed the comment that explained why the `singular` package was not included on homebrew. Unless homebrew packaging of `singular` has changed in the meantime, this will break all of our automated tests on homebrew.

This is what would have needed testing.



---

archive/issue_comments_565518.json:
```json
{
    "body": "<a id='comment:150'></a>\nReplying to [git](#comment%3A144):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023\">f01ff1f</a></td><td><code>Trac #29024: obtain LIBSINGULAR_PATH from sage.env instead of sage_conf.</code></td></tr></table>\n\n\nThanks for rewriting it \"so that it goes through a variable declared in `sage.env` instead of using `sage_conf` directly\", as suggested in [comment:140](#comment%3A140).\n\nThis is exactly what I meant.",
    "created_at": "2021-10-24T17:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565518",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:150'></a>
Replying to [git](#comment%3A144):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023">f01ff1f</a></td><td><code>Trac #29024: obtain LIBSINGULAR_PATH from sage.env instead of sage_conf.</code></td></tr></table>


Thanks for rewriting it "so that it goes through a variable declared in `sage.env` instead of using `sage_conf` directly", as suggested in [comment:140](#comment%3A140).

This is exactly what I meant.



---

archive/issue_comments_565519.json:
```json
{
    "body": "<a id='comment:151'></a>\nReplying to [dimpase](#comment%3A147):\n> By the way, while trying to combine this and `u/mkoeppe/spkg_configure_m4_for_polymake`\n> on Arch I see some messages about conflicting BLAS for Polymake (BLAS) and Singular (OpenBLAS). Is this normal?\n\n\nWhat messages are these, and when are they issued?",
    "created_at": "2021-10-24T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565519",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:151'></a>
Replying to [dimpase](#comment%3A147):
> By the way, while trying to combine this and `u/mkoeppe/spkg_configure_m4_for_polymake`
> on Arch I see some messages about conflicting BLAS for Polymake (BLAS) and Singular (OpenBLAS). Is this normal?


What messages are these, and when are they issued?



---

archive/issue_comments_565520.json:
```json
{
    "body": "<a id='comment:152'></a>\nReplying to [mkoeppe](#comment%3A149):\n> \n> In the cited commit, you removed the comment that explained why the `singular` package was not included on homebrew. Unless homebrew packaging of `singular` has changed in the meantime, this will break all of our automated tests on homebrew.\n> \n> This is what would have needed testing.\n\n\nThe impetus for the last round of major changes was [comment:93](#comment%3A93) which found that homebrew worked with some modification -- particularly using the full path to libSingular.",
    "created_at": "2021-10-24T17:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565520",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:152'></a>
Replying to [mkoeppe](#comment%3A149):
> 
> In the cited commit, you removed the comment that explained why the `singular` package was not included on homebrew. Unless homebrew packaging of `singular` has changed in the meantime, this will break all of our automated tests on homebrew.
> 
> This is what would have needed testing.


The impetus for the last round of major changes was [comment:93](#comment%3A93) which found that homebrew worked with some modification -- particularly using the full path to libSingular.



---

archive/issue_comments_565521.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2021-10-24T18:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565521",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_083023.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-24T18:39:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29024#event-83023"
}
```



---

archive/issue_comments_565522.json:
```json
{
    "body": "**Changing branch** from \"[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)\" to \"[f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023](https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023)\".",
    "created_at": "2021-10-24T18:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565522",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mjo/ticket/29024](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/29024)" to "[f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023](https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023)".



---

archive/issue_comments_565523.json:
```json
{
    "body": "**Changing commit** from \"[f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023](https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023)\" to \"\".",
    "created_at": "2021-10-24T20:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565523",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023](https://github.com/sagemath/sagetrac-mirror/commit/f01ff1f0f076fe550ffb6a6a657c5fda9dc0a023)" to "".



---

archive/issue_comments_565524.json:
```json
{
    "body": "<a id='comment:154'></a>\nReplying to [mjo](#comment%3A152):\n> Replying to [mkoeppe](#comment%3A149):\n> > \n> > In the cited commit, you removed the comment that explained why the `singular` package was not included on homebrew. Unless homebrew packaging of `singular` has changed in the meantime, this will break all of our automated tests on homebrew.\n> > \n> > This is what would have needed testing.\n\n> \n> The impetus for the last round of major changes was [comment:93](#comment%3A93) which found that homebrew worked with some modification -- particularly using the full path to libSingular.\n\n\nI don't have a comment on using the homebrew singular package; I haven't tested this ticket. \n\nThe issue lies in *installing* the singular package on homebrew when a non-standard prefix (= not /usr/local) is in use -- which is what our testing workflows on GH Actions do.",
    "created_at": "2021-10-24T20:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565524",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:154'></a>
Replying to [mjo](#comment%3A152):
> Replying to [mkoeppe](#comment%3A149):
> > 
> > In the cited commit, you removed the comment that explained why the `singular` package was not included on homebrew. Unless homebrew packaging of `singular` has changed in the meantime, this will break all of our automated tests on homebrew.
> > 
> > This is what would have needed testing.

> 
> The impetus for the last round of major changes was [comment:93](#comment%3A93) which found that homebrew worked with some modification -- particularly using the full path to libSingular.


I don't have a comment on using the homebrew singular package; I haven't tested this ticket. 

The issue lies in *installing* the singular package on homebrew when a non-standard prefix (= not /usr/local) is in use -- which is what our testing workflows on GH Actions do.



---

archive/issue_comments_565525.json:
```json
{
    "body": "<a id='comment:5'></a>\nusing Homebrew with non-standard prefix is  not something the upstream is keen on supporting.",
    "created_at": "2021-10-24T20:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565525",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
using Homebrew with non-standard prefix is  not something the upstream is keen on supporting.



---

archive/issue_comments_565526.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis is true, but for us it is a valuable mechanism to test homebrew configurations.",
    "created_at": "2021-10-24T20:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565526",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
This is true, but for us it is a valuable mechanism to test homebrew configurations.



---

archive/issue_comments_565527.json:
```json
{
    "body": "<a id='comment:7'></a>\nwell, one ends up running into homebrew bugs for no good reason this way.\n\n(I must say I looked at tox.ini and stuff in .github, and failed to see how this is done)",
    "created_at": "2021-10-26T20:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565527",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
well, one ends up running into homebrew bugs for no good reason this way.

(I must say I looked at tox.ini and stuff in .github, and failed to see how this is done)



---

archive/issue_comments_565528.json:
```json
{
    "body": "<a id='comment:8'></a>\nLet me explain the purpose in case it is really unclear: By using a local installation of homebrew, a developer can actually do testing against different homebrew package configurations without compromising the normal environment on one's machine that one uses for ... you know ... other work.",
    "created_at": "2021-10-26T21:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565528",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Let me explain the purpose in case it is really unclear: By using a local installation of homebrew, a developer can actually do testing against different homebrew package configurations without compromising the normal environment on one's machine that one uses for ... you know ... other work.



---

archive/issue_comments_565529.json:
```json
{
    "body": "<a id='comment:159'></a>\nReplying to [dimpase](#comment%3A157):\n> (I must say I looked at tox.ini and stuff in .github, and failed to see how this is done)\n\n\nThere are 2 lines around line 512 in tox.ini,\nwhich just follow the instructions at https://docs.brew.sh/Installation",
    "created_at": "2021-10-26T21:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565529",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:159'></a>
Replying to [dimpase](#comment%3A157):
> (I must say I looked at tox.ini and stuff in .github, and failed to see how this is done)


There are 2 lines around line 512 in tox.ini,
which just follow the instructions at https://docs.brew.sh/Installation



---

archive/issue_comments_565530.json:
```json
{
    "body": "<a id='comment:0'></a>\nwell, yes, what I don't understand is the purpose of having a nonstandard Homebrew location (as well as what this location actually is).",
    "created_at": "2021-10-26T22:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565530",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
well, yes, what I don't understand is the purpose of having a nonstandard Homebrew location (as well as what this location actually is).



---

archive/issue_comments_565531.json:
```json
{
    "body": "<a id='comment:161'></a>\nReplying to [mkoeppe](#comment%3A154):\n> \n> I don't have a comment on using the homebrew singular package; I haven't tested this ticket. \n> \n> The issue lies in *installing* the singular package on homebrew when a non-standard prefix (= not /usr/local) is in use -- which is what our testing workflows on GH Actions do.\n> \n\n\nThe homebrew docs pretty clearly say \"Pick another prefix at your peril!\"\n\nIf singular works well in a supported homebrew configuration, it's mean to hide the system package suggestion from everyone for the sake of an unsupported, non-user-facing test scenario.\n\nCan't we add a `sed \"/singular/d\"` somewhere in that GH action, closer to where the problem originates, to fix it?",
    "created_at": "2021-10-26T23:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565531",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:161'></a>
Replying to [mkoeppe](#comment%3A154):
> 
> I don't have a comment on using the homebrew singular package; I haven't tested this ticket. 
> 
> The issue lies in *installing* the singular package on homebrew when a non-standard prefix (= not /usr/local) is in use -- which is what our testing workflows on GH Actions do.
> 


The homebrew docs pretty clearly say "Pick another prefix at your peril!"

If singular works well in a supported homebrew configuration, it's mean to hide the system package suggestion from everyone for the sake of an unsupported, non-user-facing test scenario.

Can't we add a `sed "/singular/d"` somewhere in that GH action, closer to where the problem originates, to fix it?



---

archive/issue_comments_565532.json:
```json
{
    "body": "<a id='comment:2'></a>\nYes, this is a solution that I would support.",
    "created_at": "2021-10-26T23:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565532",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Yes, this is a solution that I would support.



---

archive/issue_comments_565533.json:
```json
{
    "body": "<a id='comment:3'></a>\nOn Debian 11 (a.k.a. bullseye, stable) Singular's libs have different names, and are failing to be picked up: they all are installed in `/usr/lib/x86_64-linux-gnu/` and we have the following: I add Sage's names next to their\n\n```\nDebian                             Sage\n\nlibsingular-factory.so             libfactory.so\nlibsingular-gfan.so                ???\nlibsingular-omalloc.so             libomalloc.so\nlibsingular-polys.so               libpolys.so\nlibsingular-resources.so           libsingular_resources.so\nlibsingular-Singular.so            libSingular.so            \n```\n\nWhile it's not hard to test for `libsingular-Singular.so` in place of `libSingular.so`, it's some more work to use it.\n\nLibrary names may be obtained from `$ pkg-config --libs-only-l singular`, which on Debian produces\n\n```\n-lsingular-Singular -ldl -lsingular-polys -lntl -lgmp -ldl -lsingular-factory -lntl -lgmp -lsingular-omalloc -lsingular-resources\n```\n\nI suppose this needs a followup ticket.",
    "created_at": "2021-10-28T09:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565533",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
On Debian 11 (a.k.a. bullseye, stable) Singular's libs have different names, and are failing to be picked up: they all are installed in `/usr/lib/x86_64-linux-gnu/` and we have the following: I add Sage's names next to their

```
Debian                             Sage

libsingular-factory.so             libfactory.so
libsingular-gfan.so                ???
libsingular-omalloc.so             libomalloc.so
libsingular-polys.so               libpolys.so
libsingular-resources.so           libsingular_resources.so
libsingular-Singular.so            libSingular.so            
```

While it's not hard to test for `libsingular-Singular.so` in place of `libSingular.so`, it's some more work to use it.

Library names may be obtained from `$ pkg-config --libs-only-l singular`, which on Debian produces

```
-lsingular-Singular -ldl -lsingular-polys -lntl -lgmp -ldl -lsingular-factory -lntl -lgmp -lsingular-omalloc -lsingular-resources
```

I suppose this needs a followup ticket.



---

archive/issue_comments_565534.json:
```json
{
    "body": "<a id='comment:164'></a>\nReplying to [dimpase](#comment%3A163):\n> \n> While it's not hard to test for `libsingular-Singular.so` in place of `libSingular.so`, it's some more work to use it.\n> \n\n\nFile a bug? Sometimes, people are going to want to use non-debian packages on debian. The name of the library is libSingular, and that's what everyone will (and should) try to use. It's as fundamental to the API as anything can be.\n\nThere's probably a name conflict with some other library that is better avoided some other way, e.g. by having the two packages with conflicting files block each other. Or at the very least, by renaming only the problematic library. I doubt some other package is installing `libSingular.so`.",
    "created_at": "2021-10-28T11:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565534",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:164'></a>
Replying to [dimpase](#comment%3A163):
> 
> While it's not hard to test for `libsingular-Singular.so` in place of `libSingular.so`, it's some more work to use it.
> 


File a bug? Sometimes, people are going to want to use non-debian packages on debian. The name of the library is libSingular, and that's what everyone will (and should) try to use. It's as fundamental to the API as anything can be.

There's probably a name conflict with some other library that is better avoided some other way, e.g. by having the two packages with conflicting files block each other. Or at the very least, by renaming only the problematic library. I doubt some other package is installing `libSingular.so`.



---

archive/issue_comments_565535.json:
```json
{
    "body": "<a id='comment:5'></a>\nother packages may be installing `libfactory.so` - I guess they wanted to prefix all the libs produced by Singular with `singular-`.\n\nbug report or not, knowing Debian pace it ought to be fixed regardless.",
    "created_at": "2021-10-28T12:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565535",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
other packages may be installing `libfactory.so` - I guess they wanted to prefix all the libs produced by Singular with `singular-`.

bug report or not, knowing Debian pace it ought to be fixed regardless.



---

archive/issue_comments_565536.json:
```json
{
    "body": "<a id='comment:166'></a>\nReplying to [dimpase](#comment%3A165):\n> other packages may be installing `libfactory.so` - I guess they wanted to prefix all the libs produced by Singular with `singular-`.\n> \n> bug report or not, knowing Debian pace it ought to be fixed regardless.\n\n\nLooks like a pre-emptive change:\n\nhttps://sources.debian.org/src/singular/1:4.1.1-p2+ds-4/debian/patches/debianization-rename-libraries.patch/",
    "created_at": "2021-10-29T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565536",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:166'></a>
Replying to [dimpase](#comment%3A165):
> other packages may be installing `libfactory.so` - I guess they wanted to prefix all the libs produced by Singular with `singular-`.
> 
> bug report or not, knowing Debian pace it ought to be fixed regardless.


Looks like a pre-emptive change:

https://sources.debian.org/src/singular/1:4.1.1-p2+ds-4/debian/patches/debianization-rename-libraries.patch/



---

archive/issue_comments_565537.json:
```json
{
    "body": "<a id='comment:7'></a>\nI have opened #32789 for the follow up. \nI'd suggest to give up on trying to educate Debian on doing things in the same that Gentoo does. This is not a viable approach for our project.",
    "created_at": "2021-10-29T02:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565537",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
I have opened #32789 for the follow up. 
I'd suggest to give up on trying to educate Debian on doing things in the same that Gentoo does. This is not a viable approach for our project.



---

archive/issue_comments_565538.json:
```json
{
    "body": "<a id='comment:8'></a>\nOn an OS X machine I used `homebrew` to install `cddlib` (ignoring the comment in `build/pkgs/cddlib/distros/homebrew.txt`) and `singular`, and now Sage does not build them anymore. I get a related doctest failure, though:\n\n```\nFile \"src/sage/env.py\", line 280, in sage.env._get_shared_lib_path\nFailed example:\n    fnmatch(str(lib_filename), pattern)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of   8 in sage.env._get_shared_lib_path\n    [47 tests, 1 failure, 2.57 s]\n```\nThis is because `lib_filename` is defined by `lib_filename = _get_shared_lib_path(\"Singular\", \"singular-Singular\")`, and on my machine it ends up being `None`. On other platforms that use an external Singular installation, how does this doctest pass?",
    "created_at": "2021-11-15T23:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565538",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
On an OS X machine I used `homebrew` to install `cddlib` (ignoring the comment in `build/pkgs/cddlib/distros/homebrew.txt`) and `singular`, and now Sage does not build them anymore. I get a related doctest failure, though:

```
File "src/sage/env.py", line 280, in sage.env._get_shared_lib_path
Failed example:
    fnmatch(str(lib_filename), pattern)
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of   8 in sage.env._get_shared_lib_path
    [47 tests, 1 failure, 2.57 s]
```
This is because `lib_filename` is defined by `lib_filename = _get_shared_lib_path("Singular", "singular-Singular")`, and on my machine it ends up being `None`. On other platforms that use an external Singular installation, how does this doctest pass?



---

archive/issue_comments_565539.json:
```json
{
    "body": "<a id='comment:9'></a>\ncould this be due to the path to `libsingular.dylib` not being added to `LIBRARY_PATH` in `.homebrew_env_config`?",
    "created_at": "2021-11-16T00:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565539",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
could this be due to the path to `libsingular.dylib` not being added to `LIBRARY_PATH` in `.homebrew_env_config`?



---

archive/issue_comments_565540.json:
```json
{
    "body": "<a id='comment:170'></a>\nReplying to [jhpalmieri](#comment%3A168):\n> On other platforms that use an external Singular installation, how does this doctest pass?\n\n\nAccidentally, like anything that uses `_get_shared_lib_path`. It's not a good function. This doctest should be replaced with one that looks for libgap, since we no longer care if it can find libSingular (the full path to libSingular is contained in `LIBSINGULAR_PATH`). Since GAP  -- at least for the moment -- is guaranteed to come from our SPKG, an analogous test has some chance of passing.",
    "created_at": "2021-11-16T01:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565540",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:170'></a>
Replying to [jhpalmieri](#comment%3A168):
> On other platforms that use an external Singular installation, how does this doctest pass?


Accidentally, like anything that uses `_get_shared_lib_path`. It's not a good function. This doctest should be replaced with one that looks for libgap, since we no longer care if it can find libSingular (the full path to libSingular is contained in `LIBSINGULAR_PATH`). Since GAP  -- at least for the moment -- is guaranteed to come from our SPKG, an analogous test has some chance of passing.



---

archive/issue_comments_565541.json:
```json
{
    "body": "<a id='comment:171'></a>\nReplying to [dimpase](#comment%3A169):\n> could this be due to the path to `libsingular.dylib` not being added to `LIBRARY_PATH` in `.homebrew_env_config`?\n\n`.homebrew-build-env` is for build time, not for run time",
    "created_at": "2021-11-16T01:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565541",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:171'></a>
Replying to [dimpase](#comment%3A169):
> could this be due to the path to `libsingular.dylib` not being added to `LIBRARY_PATH` in `.homebrew_env_config`?

`.homebrew-build-env` is for build time, not for run time



---

archive/issue_comments_565542.json:
```json
{
    "body": "<a id='comment:2'></a>\nWill fix it in #32880.",
    "created_at": "2021-11-16T01:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565542",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:2'></a>
Will fix it in #32880.



---

archive/issue_comments_565543.json:
```json
{
    "body": "<a id='comment:173'></a>\nReplying to [mjo](#comment%3A172):\n> Will fix it in #32880.\n\n\nGreat, thank you.",
    "created_at": "2021-11-16T03:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29024",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29024#issuecomment-565543",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:173'></a>
Replying to [mjo](#comment%3A172):
> Will fix it in #32880.


Great, thank you.
