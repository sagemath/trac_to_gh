# Issue 29241: gfortran installation on 32bit userland, 64bit kernel: Configure for the same ABI as gcc

archive/issues_029004.json:
```json
{
    "body": "The `i386-minimal` targets have build errors compiling `gfortran` (see for example https://github.com/mkoeppe/sage/runs/463683795) because of ABI mismatch. These tests are running 32-bit distributions on a 64-bit kernel. `gfortran` tries to build native (64-bit) but that fails because the corresponding architecture files are missing.\n\n\n\nCC:  @dimpase tmonteil @vbraun @jhpalmieri @orlitzky\n\nBranch/Commit: [c85c26f2beda594cfb6d8a5904ce7ecc39f28a18](https://github.com/sagemath/sagetrac-mirror/commit/c85c26f2beda594cfb6d8a5904ce7ecc39f28a18)\n\nReviewer: Michael Orlitzky\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29241\n\n",
    "closed_at": "2020-03-18T22:40:44Z",
    "created_at": "2020-02-24T08:00:12Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "gfortran installation on 32bit userland, 64bit kernel: Configure for the same ABI as gcc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29241",
    "user": "https://github.com/mkoeppe"
}
```
The `i386-minimal` targets have build errors compiling `gfortran` (see for example https://github.com/mkoeppe/sage/runs/463683795) because of ABI mismatch. These tests are running 32-bit distributions on a 64-bit kernel. `gfortran` tries to build native (64-bit) but that fails because the corresponding architecture files are missing.



CC:  @dimpase tmonteil @vbraun @jhpalmieri @orlitzky

Branch/Commit: [c85c26f2beda594cfb6d8a5904ce7ecc39f28a18](https://github.com/sagemath/sagetrac-mirror/commit/c85c26f2beda594cfb6d8a5904ce7ecc39f28a18)

Reviewer: Michael Orlitzky

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29241





---

archive/issue_comments_571248.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/gfortran_on_32bit__configure_for_the_same_abi_as_gcc\"",
    "created_at": "2020-03-03T03:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571248",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/gfortran_on_32bit__configure_for_the_same_abi_as_gcc"



---

archive/issue_comments_571249.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-03T03:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571249",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_571250.json:
```json
{
    "body": "Changing commit from \"\" to \"3972311748757b4795754b4f7d831ed2fccdfa1a\"",
    "created_at": "2020-03-03T03:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571250",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "3972311748757b4795754b4f7d831ed2fccdfa1a"



---

archive/issue_comments_571251.json:
```json
{
    "body": "<a id='comment:2'></a>\nTested on `docker-debian-buster-i386-minimal`, where the gfortran build now succeeds.\nNeeds review.\n\n---\nNew commits:\n|                                                                                                                                          |                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[749f83e](https://github.com/sagemath/sagetrac-mirror/commit/749f83e1a74b3b0628bc372c413199103f8188c7)|`tox.ini: Add other archs supported by docker`|\n|[e941bd5](https://github.com/sagemath/sagetrac-mirror/commit/e941bd55340543b822ab2088b0ca52f49dab5c40)|`fixup for llocal`|\n|[2441fe9](https://github.com/sagemath/sagetrac-mirror/commit/2441fe9c1443fbdcc9bfc50cca7f7a113ae2e545)|`tox.ini: Restructure docker image:tag construction, add multiarch for Linux Docker`|\n|[2f057cb](https://github.com/sagemath/sagetrac-mirror/commit/2f057cb8652617283ef27737b8e6b3e970d8d7c3)|`tox.ini: Add raspbian`|\n|[7f122bd](https://github.com/sagemath/sagetrac-mirror/commit/7f122bdda3253eeb23cef16c495491890f712959)|`build/bin/write-dockerfile.sh: src/ext has moved and is no longer needed for the configure phase`|\n|[3972311](https://github.com/sagemath/sagetrac-mirror/commit/3972311748757b4795754b4f7d831ed2fccdfa1a)|`gfortran on 32bit: Configure for the same ABI as gcc`|",
    "created_at": "2020-03-03T03:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571251",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Tested on `docker-debian-buster-i386-minimal`, where the gfortran build now succeeds.
Needs review.

---
New commits:
|                                                                                                                                          |                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[749f83e](https://github.com/sagemath/sagetrac-mirror/commit/749f83e1a74b3b0628bc372c413199103f8188c7)|`tox.ini: Add other archs supported by docker`|
|[e941bd5](https://github.com/sagemath/sagetrac-mirror/commit/e941bd55340543b822ab2088b0ca52f49dab5c40)|`fixup for llocal`|
|[2441fe9](https://github.com/sagemath/sagetrac-mirror/commit/2441fe9c1443fbdcc9bfc50cca7f7a113ae2e545)|`tox.ini: Restructure docker image:tag construction, add multiarch for Linux Docker`|
|[2f057cb](https://github.com/sagemath/sagetrac-mirror/commit/2f057cb8652617283ef27737b8e6b3e970d8d7c3)|`tox.ini: Add raspbian`|
|[7f122bd](https://github.com/sagemath/sagetrac-mirror/commit/7f122bdda3253eeb23cef16c495491890f712959)|`build/bin/write-dockerfile.sh: src/ext has moved and is no longer needed for the configure phase`|
|[3972311](https://github.com/sagemath/sagetrac-mirror/commit/3972311748757b4795754b4f7d831ed2fccdfa1a)|`gfortran on 32bit: Configure for the same ABI as gcc`|



---

archive/issue_comments_571252.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-03-03T03:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571252",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_events_083922.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "rename": {
        "from": "gfortran on 32bit: Configure for the same ABI as gcc",
        "to": "gfortran installation on 32bit userland, 64bit kernel: Configure for the same ABI as gcc"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29241#event-83922"
}
```



---

archive/issue_comments_571253.json:
```json
{
    "body": "<a id='comment:4'></a>\nAnyone interested in reviewing this?",
    "created_at": "2020-03-08T20:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571253",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Anyone interested in reviewing this?



---

archive/issue_comments_571254.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't know how to set up an environment where this change matters.",
    "created_at": "2020-03-08T20:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571254",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
I don't know how to set up an environment where this change matters.



---

archive/issue_comments_571255.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|\n|[7ae21c3](https://github.com/sagemath/sagetrac-mirror/commit/7ae21c3f35718808ddbba90431097d18e3f95e7b)|`Merge tag '9.1.beta7' into t/29241/gfortran_on_32bit__configure_for_the_same_abi_as_gcc`|",
    "created_at": "2020-03-08T22:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|
|[7ae21c3](https://github.com/sagemath/sagetrac-mirror/commit/7ae21c3f35718808ddbba90431097d18e3f95e7b)|`Merge tag '9.1.beta7' into t/29241/gfortran_on_32bit__configure_for_the_same_abi_as_gcc`|



---

archive/issue_comments_571256.json:
```json
{
    "body": "Changing commit from \"3972311748757b4795754b4f7d831ed2fccdfa1a\" to \"7ae21c3f35718808ddbba90431097d18e3f95e7b\"",
    "created_at": "2020-03-08T22:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3972311748757b4795754b4f7d831ed2fccdfa1a" to "7ae21c3f35718808ddbba90431097d18e3f95e7b"



---

archive/issue_comments_571257.json:
```json
{
    "body": "<a id='comment:7'></a>\nWill the gfortran `spkg-install` file ever be run on OS X?\n\n```\n$ gcc -print-multiarch\nclang: error: unknown argument: '-print-multiarch'\nclang: error: no input files\n```",
    "created_at": "2020-03-09T01:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571257",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Will the gfortran `spkg-install` file ever be run on OS X?

```
$ gcc -print-multiarch
clang: error: unknown argument: '-print-multiarch'
clang: error: no input files
```



---

archive/issue_comments_571258.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe equivalent option with clang is `gcc -print-target-triple`",
    "created_at": "2020-03-09T01:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571258",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
The equivalent option with clang is `gcc -print-target-triple`



---

archive/issue_comments_571259.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-03-09T01:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571259",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_571260.json:
```json
{
    "body": "<a id='comment:10'></a>\nWell, on OS X building for i386 no longer works. But I'll add clang support just in case for FreeBSD.",
    "created_at": "2020-03-09T03:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571260",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Well, on OS X building for i386 no longer works. But I'll add clang support just in case for FreeBSD.



---

archive/issue_comments_571261.json:
```json
{
    "body": "Changing commit from \"7ae21c3f35718808ddbba90431097d18e3f95e7b\" to \"35711aea44edb54e56b1c46ec6b09465fd4acc79\"",
    "created_at": "2020-03-09T03:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571261",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7ae21c3f35718808ddbba90431097d18e3f95e7b" to "35711aea44edb54e56b1c46ec6b09465fd4acc79"



---

archive/issue_comments_571262.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[35711ae](https://github.com/sagemath/sagetrac-mirror/commit/35711aea44edb54e56b1c46ec6b09465fd4acc79)|`Use gcc -print-target-triple for clang`|",
    "created_at": "2020-03-09T03:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[35711ae](https://github.com/sagemath/sagetrac-mirror/commit/35711aea44edb54e56b1c46ec6b09465fd4acc79)|`Use gcc -print-target-triple for clang`|



---

archive/issue_comments_571263.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-03-09T03:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571263",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_571264.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [dimpase](#comment%3A5):\n> I don't know how to set up an environment where this change matters.\n\nTests ran at https://github.com/mkoeppe/sage/runs/493828325\n\nFixed: `ubuntu-bionic-i386-minimal`, `ubuntu-eoan-i386-minimal`, `debian-buster-i386-minimal`.\n\nRemaining error: `centos-7-i386-minimal` (https://github.com/mkoeppe/sage/runs/493828336)",
    "created_at": "2020-03-09T21:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571264",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Replying to [dimpase](#comment%3A5):
> I don't know how to set up an environment where this change matters.

Tests ran at https://github.com/mkoeppe/sage/runs/493828325

Fixed: `ubuntu-bionic-i386-minimal`, `ubuntu-eoan-i386-minimal`, `debian-buster-i386-minimal`.

Remaining error: `centos-7-i386-minimal` (https://github.com/mkoeppe/sage/runs/493828336)



---

archive/issue_comments_571265.json:
```json
{
    "body": "Changing commit from \"35711aea44edb54e56b1c46ec6b09465fd4acc79\" to \"7847ee9dc264532c071b4930d022fb41512e8a10\"",
    "created_at": "2020-03-09T21:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "35711aea44edb54e56b1c46ec6b09465fd4acc79" to "7847ee9dc264532c071b4930d022fb41512e8a10"



---

archive/issue_comments_571266.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[7847ee9](https://github.com/sagemath/sagetrac-mirror/commit/7847ee9dc264532c071b4930d022fb41512e8a10)|`build/pkgs/gfortran/spkg-build: Treat i[4-6]86 like i386`|",
    "created_at": "2020-03-09T21:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[7847ee9](https://github.com/sagemath/sagetrac-mirror/commit/7847ee9dc264532c071b4930d022fb41512e8a10)|`build/pkgs/gfortran/spkg-build: Treat i[4-6]86 like i386`|



---

archive/issue_comments_571267.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[dcdb8ce](https://github.com/sagemath/sagetrac-mirror/commit/dcdb8cee9e31b937542e0f47d6f2d5d0d993dfbe)|`Usee gcc -dumpmachine`|",
    "created_at": "2020-03-10T23:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571267",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[dcdb8ce](https://github.com/sagemath/sagetrac-mirror/commit/dcdb8cee9e31b937542e0f47d6f2d5d0d993dfbe)|`Usee gcc -dumpmachine`|



---

archive/issue_comments_571268.json:
```json
{
    "body": "Changing commit from \"7847ee9dc264532c071b4930d022fb41512e8a10\" to \"dcdb8cee9e31b937542e0f47d6f2d5d0d993dfbe\"",
    "created_at": "2020-03-10T23:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7847ee9dc264532c071b4930d022fb41512e8a10" to "dcdb8cee9e31b937542e0f47d6f2d5d0d993dfbe"



---

archive/issue_comments_571269.json:
```json
{
    "body": "<a id='comment:16'></a>\nTests at https://github.com/mkoeppe/sage/actions/runs/53297072",
    "created_at": "2020-03-10T23:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571269",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Tests at https://github.com/mkoeppe/sage/actions/runs/53297072



---

archive/issue_comments_571270.json:
```json
{
    "body": "<a id='comment:17'></a>\nThis fixed the remaining platform `centos-7-i386-minimal`.\n\nReady for review.",
    "created_at": "2020-03-11T18:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571270",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
This fixed the remaining platform `centos-7-i386-minimal`.

Ready for review.



---

archive/issue_comments_571271.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[c830344](https://github.com/sagemath/sagetrac-mirror/commit/c830344820c40a8079d773a23c22378d10ce8e05)|`Use gcc -dumpmachine`|",
    "created_at": "2020-03-15T23:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571271",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[c830344](https://github.com/sagemath/sagetrac-mirror/commit/c830344820c40a8079d773a23c22378d10ce8e05)|`Use gcc -dumpmachine`|



---

archive/issue_comments_571272.json:
```json
{
    "body": "Changing commit from \"dcdb8cee9e31b937542e0f47d6f2d5d0d993dfbe\" to \"c830344820c40a8079d773a23c22378d10ce8e05\"",
    "created_at": "2020-03-15T23:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dcdb8cee9e31b937542e0f47d6f2d5d0d993dfbe" to "c830344820c40a8079d773a23c22378d10ce8e05"



---

archive/issue_comments_571273.json:
```json
{
    "body": "<a id='comment:20'></a>\nI'll have to take your word for it that this fixes the problem. Some implementation nitpicks:\n\n```\nARCH=`$CC -dumpmachine 2>/dev/null || echo unknown`\n```\n\nThe form `$(command)` should be preferred over backticks here (http://mywiki.wooledge.org/BashFAQ/082).\n\nAnd if you explicitly want to call GCC here, shouldn't you use \"gcc\" instead of $CC?\n\n```\n    x86_64,i[3-6]86*)\n```\n\nPersonally I would just write `[3456]` there. Ranges in globs are a bash extension, but more importantly they involve the system locale and collation, leading to rare problems that can be avoided by just listing the numbers you want to match.",
    "created_at": "2020-03-16T00:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571273",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:20'></a>
I'll have to take your word for it that this fixes the problem. Some implementation nitpicks:

```
ARCH=`$CC -dumpmachine 2>/dev/null || echo unknown`
```

The form `$(command)` should be preferred over backticks here (http://mywiki.wooledge.org/BashFAQ/082).

And if you explicitly want to call GCC here, shouldn't you use "gcc" instead of $CC?

```
    x86_64,i[3-6]86*)
```

Personally I would just write `[3456]` there. Ranges in globs are a bash extension, but more importantly they involve the system locale and collation, leading to rare problems that can be avoided by just listing the numbers you want to match.



---

archive/issue_comments_571274.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mjo](#comment%3A20):\n> I'll have to take your word for it that this fixes the problem. \n\n\nThe logs on the various machines are available at the links posted.\n\n> Some implementation nitpicks:\n> \n> \n> ```\n> ARCH=`$CC -dumpmachine 2>/dev/null || echo unknown`\n> ```\n> \n> The form `$(command)` should be preferred over backticks here (http://mywiki.wooledge.org/BashFAQ/082).\n\nOK will do.\n\n> \n> And if you explicitly want to call GCC here, shouldn't you use \"gcc\" instead of $CC?\n\n\nNo, this needs to run the specific compiler that is configured!\n\n> {{{\n>     x86_64,i[3-6]86*)\n> }}}\n> \n> Personally I would just write `[3456]` there. Ranges in globs are a bash extension, but more importantly they involve the system locale and collation, leading to rare problems that can be avoided by just listing the numbers you want to match.\n\n\nOK will do.",
    "created_at": "2020-03-16T00:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571274",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Replying to [mjo](#comment%3A20):
> I'll have to take your word for it that this fixes the problem. 


The logs on the various machines are available at the links posted.

> Some implementation nitpicks:
> 
> 
> ```
> ARCH=`$CC -dumpmachine 2>/dev/null || echo unknown`
> ```
> 
> The form `$(command)` should be preferred over backticks here (http://mywiki.wooledge.org/BashFAQ/082).

OK will do.

> 
> And if you explicitly want to call GCC here, shouldn't you use "gcc" instead of $CC?


No, this needs to run the specific compiler that is configured!

> {{{
>     x86_64,i[3-6]86*)
> }}}
> 
> Personally I would just write `[3456]` there. Ranges in globs are a bash extension, but more importantly they involve the system locale and collation, leading to rare problems that can be avoided by just listing the numbers you want to match.


OK will do.



---

archive/issue_comments_571275.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [mkoeppe](#comment%3A21):\n> > And if you explicitly want to call GCC here, shouldn't you use \"gcc\" instead of $CC?\n\n> \n> No, this needs to run the specific compiler that is configured!\n\n\nIn particular, this is supposed to work also if CC is configured to be \"gcc -m32\".",
    "created_at": "2020-03-16T00:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571275",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Replying to [mkoeppe](#comment%3A21):
> > And if you explicitly want to call GCC here, shouldn't you use "gcc" instead of $CC?

> 
> No, this needs to run the specific compiler that is configured!


In particular, this is supposed to work also if CC is configured to be "gcc -m32".



---

archive/issue_comments_571276.json:
```json
{
    "body": "Changing commit from \"c830344820c40a8079d773a23c22378d10ce8e05\" to \"c85c26f2beda594cfb6d8a5904ce7ecc39f28a18\"",
    "created_at": "2020-03-16T00:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c830344820c40a8079d773a23c22378d10ce8e05" to "c85c26f2beda594cfb6d8a5904ce7ecc39f28a18"



---

archive/issue_comments_571277.json:
```json
{
    "body": "<a id='comment:23'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|\n|[c85c26f](https://github.com/sagemath/sagetrac-mirror/commit/c85c26f2beda594cfb6d8a5904ce7ecc39f28a18)|`build/pkgs/gfortran/spkg-build: shell style fixes suggested by mjo`|",
    "created_at": "2020-03-16T00:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|
|[c85c26f](https://github.com/sagemath/sagetrac-mirror/commit/c85c26f2beda594cfb6d8a5904ce7ecc39f28a18)|`build/pkgs/gfortran/spkg-build: shell style fixes suggested by mjo`|



---

archive/issue_comments_571278.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [mkoeppe](#comment%3A22):\n> \n> In particular, this is supposed to work also if CC is configured to be \"gcc -m32\".\n> \n\n\nAh, ok. I was thinking more along the lines of, what if `CC` is e.g. clang or icc?",
    "created_at": "2020-03-16T00:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571278",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:24'></a>
Replying to [mkoeppe](#comment%3A22):
> 
> In particular, this is supposed to work also if CC is configured to be "gcc -m32".
> 


Ah, ok. I was thinking more along the lines of, what if `CC` is e.g. clang or icc?



---

archive/issue_comments_571279.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [mjo](#comment%3A24):\n> Replying to [mkoeppe](#comment%3A22):\n> > \n> > In particular, this is supposed to work also if CC is configured to be \"gcc -m32\".\n> > \n\n> \n> Ah, ok. I was thinking more along the lines of, what if `CC` is e.g. clang or icc?\n\n\nWell, clang supports the `-dumpmachine` option too.\n\nI have not tested with icc; I don't know if Sage is known to build at all with this compiler.",
    "created_at": "2020-03-16T00:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571279",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Replying to [mjo](#comment%3A24):
> Replying to [mkoeppe](#comment%3A22):
> > 
> > In particular, this is supposed to work also if CC is configured to be "gcc -m32".
> > 

> 
> Ah, ok. I was thinking more along the lines of, what if `CC` is e.g. clang or icc?


Well, clang supports the `-dumpmachine` option too.

I have not tested with icc; I don't know if Sage is known to build at all with this compiler.



---

archive/issue_comments_571280.json:
```json
{
    "body": "<a id='comment:26'></a>\nThere's some evidence (https://github.com/JuliaLang/julia/issues/9145) that icc supports this option too on Linux (but possibly not on macOS - which is not a problem because 32-bit builds are no longer supported; and the fallback to `unknown` should take care of it).",
    "created_at": "2020-03-16T00:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571280",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
There's some evidence (https://github.com/JuliaLang/julia/issues/9145) that icc supports this option too on Linux (but possibly not on macOS - which is not a problem because 32-bit builds are no longer supported; and the fallback to `unknown` should take care of it).



---

archive/issue_comments_571281.json:
```json
{
    "body": "<a id='comment:27'></a>\nMy concern isn't about the `-dumpmachine` flag per se. We need to build gfortran with the same ABI as gcc, because gfortran tries to use headers from GCC and they won't be where gfortran expects them to be if the ABIs are mismatched. But if `CC=clang`, why should we insist that the ABI of clang and gfortran are the same? In that case, you still want to ensure that the ABIs of gfortran/gcc agree, not gfortran/clang.",
    "created_at": "2020-03-16T00:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571281",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:27'></a>
My concern isn't about the `-dumpmachine` flag per se. We need to build gfortran with the same ABI as gcc, because gfortran tries to use headers from GCC and they won't be where gfortran expects them to be if the ABIs are mismatched. But if `CC=clang`, why should we insist that the ABI of clang and gfortran are the same? In that case, you still want to ensure that the ABIs of gfortran/gcc agree, not gfortran/clang.



---

archive/issue_comments_571282.json:
```json
{
    "body": "<a id='comment:28'></a>\nSimply because we cannot link 32bit & 64bit into one executable",
    "created_at": "2020-03-16T01:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571282",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Simply because we cannot link 32bit & 64bit into one executable



---

archive/issue_comments_571283.json:
```json
{
    "body": "<a id='comment:29'></a>\nWe need to build gfortran with the same ABI as the C compiler that is used, not some gcc that may be on the system.",
    "created_at": "2020-03-16T01:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571283",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
We need to build gfortran with the same ABI as the C compiler that is used, not some gcc that may be on the system.



---

archive/issue_comments_571284.json:
```json
{
    "body": "<a id='comment:30'></a>\nOk, that makes sense. I was focusing on the `bits/libc-header-start.h: No such file or directory` errors. I guess we could still get build failures if GCC is 32-bit but someone has built a 64-bit clang and sets `CC=clang`. These are pretty low return-on-investment scenarios, though. Feel free to set positive review if the CI and build bots are happy.",
    "created_at": "2020-03-16T01:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571284",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:30'></a>
Ok, that makes sense. I was focusing on the `bits/libc-header-start.h: No such file or directory` errors. I guess we could still get build failures if GCC is 32-bit but someone has built a 64-bit clang and sets `CC=clang`. These are pretty low return-on-investment scenarios, though. Feel free to set positive review if the CI and build bots are happy.



---

archive/issue_comments_571285.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Michael Orlitzky\"",
    "created_at": "2020-03-16T01:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571285",
    "user": "https://github.com/orlitzky"
}
```

Changing reviewer from "" to "Michael Orlitzky"



---

archive/issue_comments_571286.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [mjo](#comment%3A30):\n> Ok, that makes sense. I was focusing on the `bits/libc-header-start.h: No such file or directory` errors. I guess we could still get build failures if GCC is 32-bit but someone has built a 64-bit clang and sets `CC=clang`. \nRight. In this situation, probably we would have to build the full gcc, possibly with bootstrapping. \n\n> These are pretty low return-on-investment scenarios, though. \n\nI agree. If this ever becomes a problem, this can be fixed separately.\n\n> Feel free to set positive review if the CI and build bots are happy.\n\nThanks!",
    "created_at": "2020-03-16T01:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571286",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Replying to [mjo](#comment%3A30):
> Ok, that makes sense. I was focusing on the `bits/libc-header-start.h: No such file or directory` errors. I guess we could still get build failures if GCC is 32-bit but someone has built a 64-bit clang and sets `CC=clang`. 
Right. In this situation, probably we would have to build the full gcc, possibly with bootstrapping. 

> These are pretty low return-on-investment scenarios, though. 

I agree. If this ever becomes a problem, this can be fixed separately.

> Feel free to set positive review if the CI and build bots are happy.

Thanks!



---

archive/issue_comments_571287.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-16T01:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571287",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_083923.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-18T22:40:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29241#event-83923"
}
```



---

archive/issue_comments_571288.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-18T22:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571288",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_571289.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/gfortran_on_32bit__configure_for_the_same_abi_as_gcc\" to \"c85c26f2beda594cfb6d8a5904ce7ecc39f28a18\"",
    "created_at": "2020-03-18T22:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29241#issuecomment-571289",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/gfortran_on_32bit__configure_for_the_same_abi_as_gcc" to "c85c26f2beda594cfb6d8a5904ce7ecc39f28a18"
