# Issue 29338: Reduction from dancing links instance to SAT instance

archive/issues_029101.json:
```json
{
    "body": "The proposed branch adds 2 new methods which allows what follows:\n\n```\nsage: from sage.combinat.matrices.dancing_links import dlx_solver\nsage: rows = [[0,1,2], [3,4,5], [0,1], [2,3,4,5], [0], [1,2,3,4,5]]\nsage: d = dlx_solver(rows)\nsage: d.one_solution()\n[1, 0]\nsage: d.one_solution_using_sat_solver('cryptominisat')\n[2, 3]\nsage: d.one_solution_using_sat_solver('glucose')\n[2, 3]\nsage: d.one_solution_using_sat_solver('glucose-syrup')\n[2, 3]\nsage: d.one_solution_using_sat_solver('picosat')\n[4, 5]\nsage: d.one_solution_using_sat_solver('LP')\n[2, 3]\nsage: d.one_solution_using_sat_solver()\n[2, 3]\n```\n\nThis is based on the new method:\n\n```\nsage: d.to_sat_solver()\nCryptoMiniSat solver: 6 variables, 24 clauses.\n```\n\nBranch/Commit: 2e97345c41638ae8be5d8d7cac2737300883dfcf\n\nReviewer: Franco Saliola\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29338\n\n",
    "closed_at": "2020-06-26T15:38:17Z",
    "created_at": "2020-03-15T14:05:37Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Reduction from dancing links instance to SAT instance",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29338",
    "user": "https://github.com/seblabbe"
}
```
The proposed branch adds 2 new methods which allows what follows:

```
sage: from sage.combinat.matrices.dancing_links import dlx_solver
sage: rows = [[0,1,2], [3,4,5], [0,1], [2,3,4,5], [0], [1,2,3,4,5]]
sage: d = dlx_solver(rows)
sage: d.one_solution()
[1, 0]
sage: d.one_solution_using_sat_solver('cryptominisat')
[2, 3]
sage: d.one_solution_using_sat_solver('glucose')
[2, 3]
sage: d.one_solution_using_sat_solver('glucose-syrup')
[2, 3]
sage: d.one_solution_using_sat_solver('picosat')
[4, 5]
sage: d.one_solution_using_sat_solver('LP')
[2, 3]
sage: d.one_solution_using_sat_solver()
[2, 3]
```

This is based on the new method:

```
sage: d.to_sat_solver()
CryptoMiniSat solver: 6 variables, 24 clauses.
```

Branch/Commit: 2e97345c41638ae8be5d8d7cac2737300883dfcf

Reviewer: Franco Saliola

Author: Sébastien Labbé

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29338





---

archive/issue_comments_572231.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-15T14:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572231",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_572232.json:
```json
{
    "body": "Changing author from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2020-03-15T14:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572232",
    "user": "https://github.com/seblabbe"
}
```

Changing author from "" to "Sébastien Labbé"



---

archive/issue_comments_572233.json:
```json
{
    "body": "Changing branch from \"\" to \"u/slabbe/29338\"",
    "created_at": "2020-03-15T14:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572233",
    "user": "https://github.com/seblabbe"
}
```

Changing branch from "" to "u/slabbe/29338"



---

archive/issue_comments_572234.json:
```json
{
    "body": "Changing commit from \"\" to \"87c3057957495ee3ff135e88f792151b8c89cea9\"",
    "created_at": "2020-03-15T14:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572234",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "" to "87c3057957495ee3ff135e88f792151b8c89cea9"



---

archive/issue_comments_572235.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-15T14:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_572236.json:
```json
{
    "body": "Changing commit from \"87c3057957495ee3ff135e88f792151b8c89cea9\" to \"c368cc170ed7d08a5d6bf35d25f14c18d627bb3a\"",
    "created_at": "2020-03-15T14:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572236",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "87c3057957495ee3ff135e88f792151b8c89cea9" to "c368cc170ed7d08a5d6bf35d25f14c18d627bb3a"



---

archive/issue_comments_572237.json:
```json
{
    "body": "<a id='comment:3'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572237",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_074695.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29338#event-74695"
}
```



---

archive/issue_comments_572238.json:
```json
{
    "body": "<a id='comment:4'></a>This is really nice. Only one suggestion: make it so that `one_solution` and `one_solution_using_sat_solver` handle the case of no solutions consistently. The former returns `None` whereas the latter raises a `ValueError` in case there is no solution.\n\nPersonally, I prefer `None` since I can easily write `if soln is None: ...` instead of a `try/except`.",
    "created_at": "2020-06-23T20:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572238",
    "user": "https://github.com/saliola"
}
```

<a id='comment:4'></a>This is really nice. Only one suggestion: make it so that `one_solution` and `one_solution_using_sat_solver` handle the case of no solutions consistently. The former returns `None` whereas the latter raises a `ValueError` in case there is no solution.

Personally, I prefer `None` since I can easily write `if soln is None: ...` instead of a `try/except`.



---

archive/issue_comments_572239.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-24T12:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_572240.json:
```json
{
    "body": "Changing commit from \"c368cc170ed7d08a5d6bf35d25f14c18d627bb3a\" to \"2e97345c41638ae8be5d8d7cac2737300883dfcf\"",
    "created_at": "2020-06-24T12:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572240",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c368cc170ed7d08a5d6bf35d25f14c18d627bb3a" to "2e97345c41638ae8be5d8d7cac2737300883dfcf"



---

archive/issue_comments_572241.json:
```json
{
    "body": "<a id='comment:6'></a>I rebased on top of a more recent version of Sage. Needs review. I will implement `one_solution_using_milp_solver` in another ticket, probably on top of that branch to avoid conflicts.",
    "created_at": "2020-06-24T12:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572241",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:6'></a>I rebased on top of a more recent version of Sage. Needs review. I will implement `one_solution_using_milp_solver` in another ticket, probably on top of that branch to avoid conflicts.



---

archive/issue_comments_572242.json:
```json
{
    "body": "<a id='comment:7'></a>See #29955 for the reduction to MILP.",
    "created_at": "2020-06-24T13:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572242",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:7'></a>See #29955 for the reduction to MILP.



---

archive/issue_comments_572243.json:
```json
{
    "body": "<a id='comment:8'></a>A question about the interface. Since we are going to have:\n- `one_solution`\n- `one_solution_using_sat_solver`\n- `one_solution_using_milp_solver` # with #29955\nI think it would it be better to have only one method that dispatches to the various solvers. Then one can do the following:\n- `one_solution(solver=\"dlx\")`\n- `one_solution(solver=\"cryptominisat\")`\n- `one_solution(solver=\"picosat\")`\n- `one_solution(solver=\"Gurobi\")` # with #29955\n- `one_solution(solver=\"CLPLEX\")` # with #29955\nWhat do you think? (I can do this if you think it is a good idea.)",
    "created_at": "2020-06-24T13:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572243",
    "user": "https://github.com/saliola"
}
```

<a id='comment:8'></a>A question about the interface. Since we are going to have:
- `one_solution`
- `one_solution_using_sat_solver`
- `one_solution_using_milp_solver` # with #29955
I think it would it be better to have only one method that dispatches to the various solvers. Then one can do the following:
- `one_solution(solver="dlx")`
- `one_solution(solver="cryptominisat")`
- `one_solution(solver="picosat")`
- `one_solution(solver="Gurobi")` # with #29955
- `one_solution(solver="CLPLEX")` # with #29955
What do you think? (I can do this if you think it is a good idea.)



---

archive/issue_comments_572244.json:
```json
{
    "body": "<a id='comment:9'></a>I made that choice to make it explicit that we are not using the dlx solver (we can not compare timing (at least on the first call) for example, because of the initialization of the rows is already done when using \"dlx\") and to make explicit that there is a overhead in doing the translation of the thousands of rows into something else.\n\nI think `one_solution(solver='Gurobi')` should not be something so much desirable, since if this is really what is the most efficient, then one should just construct the `MILP` directly.\n\nWhat do you think is best to do?",
    "created_at": "2020-06-24T13:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572244",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:9'></a>I made that choice to make it explicit that we are not using the dlx solver (we can not compare timing (at least on the first call) for example, because of the initialization of the rows is already done when using "dlx") and to make explicit that there is a overhead in doing the translation of the thousands of rows into something else.

I think `one_solution(solver='Gurobi')` should not be something so much desirable, since if this is really what is the most efficient, then one should just construct the `MILP` directly.

What do you think is best to do?



---

archive/issue_comments_572245.json:
```json
{
    "body": "<a id='comment:10'></a>Ah, this is a very good point! So I should think of the principal goal of this ticket as the implementation of `to_sat_solver`, and `one_solution_using_sat_solver` is a shortcut for the following:\n\n```\nsage: d.to_sat_solver('glucose').solve()  # not the correct syntax; see below\n```\n[Note that `solve` is not a method for `sat`; the above should be `d.to_sat_solver('glucose')()` instead.]",
    "created_at": "2020-06-24T13:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572245",
    "user": "https://github.com/saliola"
}
```

<a id='comment:10'></a>Ah, this is a very good point! So I should think of the principal goal of this ticket as the implementation of `to_sat_solver`, and `one_solution_using_sat_solver` is a shortcut for the following:

```
sage: d.to_sat_solver('glucose').solve()  # not the correct syntax; see below
```
[Note that `solve` is not a method for `sat`; the above should be `d.to_sat_solver('glucose')()` instead.]



---

archive/issue_comments_572246.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-24T15:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572246",
    "user": "https://github.com/saliola"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_572247.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Franco Saliola\"",
    "created_at": "2020-06-24T15:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572247",
    "user": "https://github.com/saliola"
}
```

Changing reviewer from "" to "Franco Saliola"



---

archive/issue_comments_572248.json:
```json
{
    "body": "<a id='comment:12'></a>All doctests pass, including the optional doctests with 'glucose', 'picosat', etc.\n\nThank you, S\u00e9bastien!",
    "created_at": "2020-06-24T15:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572248",
    "user": "https://github.com/saliola"
}
```

<a id='comment:12'></a>All doctests pass, including the optional doctests with 'glucose', 'picosat', etc.

Thank you, Sébastien!



---

archive/issue_comments_572249.json:
```json
{
    "body": "<a id='comment:13'></a>> [Note that `solve` is not a method for `sat`; the above should be `d.to_sat_solver('glucose')()` instead.]\n\n\nBut this is not enough, because one need to translate the solution of the SAT problem into a solution to a DLX problem...",
    "created_at": "2020-06-24T15:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572249",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:13'></a>> [Note that `solve` is not a method for `sat`; the above should be `d.to_sat_solver('glucose')()` instead.]


But this is not enough, because one need to translate the solution of the SAT problem into a solution to a DLX problem...



---

archive/issue_comments_572250.json:
```json
{
    "body": "<a id='comment:14'></a>Thanks for the review!",
    "created_at": "2020-06-24T15:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572250",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:14'></a>Thanks for the review!



---

archive/issue_comments_572251.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-26T15:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572251",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_074696.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-06-26T15:38:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29338#event-74696"
}
```



---

archive/issue_comments_572252.json:
```json
{
    "body": "Changing branch from \"u/slabbe/29338\" to \"2e97345c41638ae8be5d8d7cac2737300883dfcf\"",
    "created_at": "2020-06-26T15:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29338#issuecomment-572252",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/slabbe/29338" to "2e97345c41638ae8be5d8d7cac2737300883dfcf"
