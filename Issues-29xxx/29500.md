# Issue 29500: Install all Python packages via pip wheel (or setup.py bdist_wheel), store wheels in $SAGE_LOCAL/var/lib/sage/wheels

archive/issues_029263.json:
```json
{
    "assignees": [],
    "body": "Our current version of pip already tries to install packages via `bdist_wheel`. \n\nIn this ticket, we break the build process into these steps by modifying `sdh_pip_install`:\n\n1. Build the wheel explicitly using `pip wheel --no-binary :all: --no-build-isolation -w \"$SAGE_SPKG_WHEELS\"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_SPKG_WHEELS=$SAGE_LOCAL/var/lib/sage/wheels`.\n\n2. Then install the wheel.\n\nThe wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the `DESTDIR` staging mechanism -- there will be exactly 1 wheel for each installed package (and removing a package removes the wheel). Example (after rebuilding a few packages on this branch):\n\n```\n$ ls -l local/var/lib/sage/wheels/\n...\n-rw-r--r--  1 mkoeppe  staff    545293 Sep  8 12:44 Pillow-7.2.0-cp37-cp37m-macosx_10_9_x86_64.whl\n-rw-r--r--  1 mkoeppe  staff   4573510 Sep  8 12:06 numpy-1.19.1-cp37-cp37m-macosx_10_9_x86_64.whl\n-rw-r--r--  1 mkoeppe  staff      2237 Sep  8 12:44 sage_conf-9.2b12-py3-none-any.whl\n-rw-r--r--  1 mkoeppe  staff  17981103 Sep  8 12:59 scipy-1.5.2-cp37-cp37m-macosx_10_9_x86_64.whl\n```\n\nUsers can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.\n\n- Example:\n\n      ```\n      $ python3 -m venv some-venv\n      $ cd some-venv/\n      $ bin/pip3 install -v --no-index --find-links=../local/var/lib/sage/wheels/ Pillow    \n    ```\n- In follow-up ticket #30527, we create a PEP 503 simple repository for the wheels built during installation, which enables more convenient installation options for users.\n\n\nIn this ticket, we keep using the `DESTDIR` staging mechanism also for the installation of the package from the wheel. \n\n- In a follow-up ticket, we can change this -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). \n\n---\n\nReferences:\n\n- https://pip.pypa.io/en/stable/user_guide/#installing-from-local-packages\n\n- https://pip.pypa.io/en/stable/reference/pip_cache/\n\n\nCC:  @slel @tobiasdiez @embray @jhpalmieri @tscrim\n\nBranch: **[`f2e7075`](https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8)**\n\nReviewer: **Tobias Diez, John Palmieri**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29500_\n\n",
    "closed_at": "2020-09-27T09:09:52Z",
    "created_at": "2020-04-13T02:40:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Install all Python packages via pip wheel (or setup.py bdist_wheel), store wheels in $SAGE_LOCAL/var/lib/sage/wheels",
    "type": "issue",
    "updated_at": "2020-10-22T15:21:53Z",
    "url": "https://github.com/sagemath/sage/issues/29500",
    "user": "https://github.com/mkoeppe"
}
```
Our current version of pip already tries to install packages via `bdist_wheel`. 

In this ticket, we break the build process into these steps by modifying `sdh_pip_install`:

1. Build the wheel explicitly using `pip wheel --no-binary :all: --no-build-isolation -w "$SAGE_SPKG_WHEELS"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_SPKG_WHEELS=$SAGE_LOCAL/var/lib/sage/wheels`.

2. Then install the wheel.

The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the `DESTDIR` staging mechanism -- there will be exactly 1 wheel for each installed package (and removing a package removes the wheel). Example (after rebuilding a few packages on this branch):

```
$ ls -l local/var/lib/sage/wheels/
...
-rw-r--r--  1 mkoeppe  staff    545293 Sep  8 12:44 Pillow-7.2.0-cp37-cp37m-macosx_10_9_x86_64.whl
-rw-r--r--  1 mkoeppe  staff   4573510 Sep  8 12:06 numpy-1.19.1-cp37-cp37m-macosx_10_9_x86_64.whl
-rw-r--r--  1 mkoeppe  staff      2237 Sep  8 12:44 sage_conf-9.2b12-py3-none-any.whl
-rw-r--r--  1 mkoeppe  staff  17981103 Sep  8 12:59 scipy-1.5.2-cp37-cp37m-macosx_10_9_x86_64.whl
```

Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.

- Example:

      ```
      $ python3 -m venv some-venv
      $ cd some-venv/
      $ bin/pip3 install -v --no-index --find-links=../local/var/lib/sage/wheels/ Pillow    
    ```
- In follow-up ticket #30527, we create a PEP 503 simple repository for the wheels built during installation, which enables more convenient installation options for users.


In this ticket, we keep using the `DESTDIR` staging mechanism also for the installation of the package from the wheel. 

- In a follow-up ticket, we can change this -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). 

---

References:

- https://pip.pypa.io/en/stable/user_guide/#installing-from-local-packages

- https://pip.pypa.io/en/stable/reference/pip_cache/


CC:  @slel @tobiasdiez @embray @jhpalmieri @tscrim

Branch: **[`f2e7075`](https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8)**

Reviewer: **Tobias Diez, John Palmieri**

Author: **Matthias Koeppe**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/29500_





---

archive/issue_events_402695.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-13T02:40:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402695"
}
```



---

archive/issue_events_402696.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-13T02:40:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402696"
}
```



---

archive/issue_events_402697.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-13T02:40:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402697"
}
```



---

archive/issue_events_402698.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-13T02:40:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402698"
}
```



---

archive/issue_comments_463693.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWould that be `gambit`, `numpy` and `pillow`?\n\nAnd is this how to find them?\n\n```\n$ git grep \"setup.py\" build/pkgs\n```",
    "created_at": "2020-05-09T23:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463693",
    "user": "https://github.com/slel"
}
```

<div id="comment:1" align="right">comment:1</div>

Would that be `gambit`, `numpy` and `pillow`?

And is this how to find them?

```
$ git grep "setup.py" build/pkgs
```



---

archive/issue_events_402699.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402699"
}
```



---

archive/issue_events_402700.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402700"
}
```



---

archive/issue_comments_463694.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n-Some of our Python packages are still installed by calling setup.py directly. This should be fixed\n+Some of our Python packages are still installed by calling `setup.py` directly. This should be fixed.\n+\n+pip tries to install packages via `bdist_wheel`. We should build the wheel explicitly using `pipand then install the wheel -- replacing (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation.\n+\n+\n``````\n",
    "created_at": "2020-08-27T04:07:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463694",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
-Some of our Python packages are still installed by calling setup.py directly. This should be fixed
+Some of our Python packages are still installed by calling `setup.py` directly. This should be fixed.
+
+pip tries to install packages via `bdist_wheel`. We should build the wheel explicitly using `pipand then install the wheel -- replacing (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation.
+
+
``````




---

archive/issue_events_402701.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-27T04:07:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "title_is": "Install all Python packages via pip wheel",
    "title_was": "Install all Python packages using pip",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402701"
}
```



---

archive/issue_comments_463695.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n... Also consider pipenv + pipfile as suggested in #30317 ...",
    "created_at": "2020-08-30T19:31:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463695",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

... Also consider pipenv + pipfile as suggested in #30317 ...



---

archive/issue_comments_463696.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI would prefer not to have two separate package installation and management systems.  If the only motivation of this is the race condition, like I said this can be solved with an additional file lock to prevent multiple Python packages from being installed simultaneously.",
    "created_at": "2020-09-01T13:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463696",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

I would prefer not to have two separate package installation and management systems.  If the only motivation of this is the race condition, like I said this can be solved with an additional file lock to prevent multiple Python packages from being installed simultaneously.



---

archive/issue_events_402702.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-06T04:53:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "title_is": "Install all Python packages via pip wheel, create PEP 503 simple repository for wheels",
    "title_was": "Install all Python packages via pip wheel",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402702"
}
```



---

archive/issue_comments_463697.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,25 @@\n-Some of our Python packages are still installed by calling `setup.py` directly. This should be fixed.\n+Our current version of pip already tries to install packages via `bdist_wheel`. \n \n-pip tries to install packages via `bdist_wheel`. We should build the wheel explicitly using `pipand then install the wheel -- replacing (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation.\n+In this ticket, we break the build process into these steps:\n+\n+1. In `spkg-build`, build the wheel explicitly using `pip wheel` (or `setup.py bdist_wheel`); store the wheel in `SAGE_ROOT/repo`.\n+\n+2. In `spkg-install`, install the wheel.\n+\n+We drop (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation (step 2).\n+\n+Optionally, the wheels in `SAGE_ROOT/repo` will persist after the completed build.  Then we can create a PEP 503 compliant Simple Repository index in `SAGE_ROOT/repo`. Then users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --find-links` or `pip install --index-url`.\n+\n+---\n+\n+References:\n+\n+- https://github.com/pytorch/pytorch/issues/25639 \"Implement pep 503 Simple Repository API for deployment\"\n+\n+- https://pypi.org/project/piprepo/ - create PEP 503 package repo\n+\n+- https://stackoverflow.com/questions/45744937/how-do-install-packages-from-a-local-python-package-index\n+\n+- https://pipenv-fork.readthedocs.io/en/latest/advanced.html#specifying-package-indexes\n \n \n``````\n",
    "created_at": "2020-09-06T04:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463697",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,25 @@
-Some of our Python packages are still installed by calling `setup.py` directly. This should be fixed.
+Our current version of pip already tries to install packages via `bdist_wheel`. 
 
-pip tries to install packages via `bdist_wheel`. We should build the wheel explicitly using `pipand then install the wheel -- replacing (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation.
+In this ticket, we break the build process into these steps:
+
+1. In `spkg-build`, build the wheel explicitly using `pip wheel` (or `setup.py bdist_wheel`); store the wheel in `SAGE_ROOT/repo`.
+
+2. In `spkg-install`, install the wheel.
+
+We drop (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation (step 2).
+
+Optionally, the wheels in `SAGE_ROOT/repo` will persist after the completed build.  Then we can create a PEP 503 compliant Simple Repository index in `SAGE_ROOT/repo`. Then users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --find-links` or `pip install --index-url`.
+
+---
+
+References:
+
+- https://github.com/pytorch/pytorch/issues/25639 "Implement pep 503 Simple Repository API for deployment"
+
+- https://pypi.org/project/piprepo/ - create PEP 503 package repo
+
+- https://stackoverflow.com/questions/45744937/how-do-install-packages-from-a-local-python-package-index
+
+- https://pipenv-fork.readthedocs.io/en/latest/advanced.html#specifying-package-indexes
 
 
``````




---

archive/issue_comments_463698.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,13 +2,13 @@\n \n In this ticket, we break the build process into these steps:\n \n-1. In `spkg-build`, build the wheel explicitly using `pip wheel` (or `setup.py bdist_wheel`); store the wheel in `SAGE_ROOT/repo`.\n+1. In `spkg-build`, build the wheel explicitly using `pip wheel` (or `setup.py bdist_wheel`); store the wheel in `SAGE_ROOT/wheelhouse`.\n \n 2. In `spkg-install`, install the wheel.\n \n We drop (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation (step 2).\n \n-Optionally, the wheels in `SAGE_ROOT/repo` will persist after the completed build.  Then we can create a PEP 503 compliant Simple Repository index in `SAGE_ROOT/repo`. Then users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --find-links` or `pip install --index-url`.\n+Optionally, the wheels in `SAGE_ROOT/wheelhouse` will persist after the completed build.  Then we can create a PEP 503 compliant Simple Repository index in `SAGE_ROOT/wheelhouse`. Then users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --find-links` or `pip install --index-url`.\n \n ---\n \n``````\n",
    "created_at": "2020-09-06T05:08:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463698",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,13 +2,13 @@
 
 In this ticket, we break the build process into these steps:
 
-1. In `spkg-build`, build the wheel explicitly using `pip wheel` (or `setup.py bdist_wheel`); store the wheel in `SAGE_ROOT/repo`.
+1. In `spkg-build`, build the wheel explicitly using `pip wheel` (or `setup.py bdist_wheel`); store the wheel in `SAGE_ROOT/wheelhouse`.
 
 2. In `spkg-install`, install the wheel.
 
 We drop (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation (step 2).
 
-Optionally, the wheels in `SAGE_ROOT/repo` will persist after the completed build.  Then we can create a PEP 503 compliant Simple Repository index in `SAGE_ROOT/repo`. Then users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --find-links` or `pip install --index-url`.
+Optionally, the wheels in `SAGE_ROOT/wheelhouse` will persist after the completed build.  Then we can create a PEP 503 compliant Simple Repository index in `SAGE_ROOT/wheelhouse`. Then users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --find-links` or `pip install --index-url`.
 
 ---
 
``````




---

archive/issue_comments_463699.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n In this ticket, we break the build process into these steps:\n \n-1. In `spkg-build`, build the wheel explicitly using `pip wheel` (or `setup.py bdist_wheel`); store the wheel in `SAGE_ROOT/wheelhouse`.\n+1. In `spkg-build`, build the wheel explicitly using `pip wheel --no-binary --no-build-isolation -w \"$SAGE_ROOT/wheelhouse\"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_ROOT/wheelhouse`.\n \n 2. In `spkg-install`, install the wheel.\n \n``````\n",
    "created_at": "2020-09-06T05:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463699",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 In this ticket, we break the build process into these steps:
 
-1. In `spkg-build`, build the wheel explicitly using `pip wheel` (or `setup.py bdist_wheel`); store the wheel in `SAGE_ROOT/wheelhouse`.
+1. In `spkg-build`, build the wheel explicitly using `pip wheel --no-binary --no-build-isolation -w "$SAGE_ROOT/wheelhouse"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_ROOT/wheelhouse`.
 
 2. In `spkg-install`, install the wheel.
 
``````




---

archive/issue_comments_463700.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n In this ticket, we break the build process into these steps:\n \n-1. In `spkg-build`, build the wheel explicitly using `pip wheel --no-binary --no-build-isolation -w \"$SAGE_ROOT/wheelhouse\"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_ROOT/wheelhouse`.\n+1. In `spkg-build`, build the wheel explicitly using `pip wheel --no-binary :all: --no-build-isolation -w \"$SAGE_ROOT/wheelhouse\"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_ROOT/wheelhouse`.\n \n 2. In `spkg-install`, install the wheel.\n \n``````\n",
    "created_at": "2020-09-06T05:20:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463700",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 In this ticket, we break the build process into these steps:
 
-1. In `spkg-build`, build the wheel explicitly using `pip wheel --no-binary --no-build-isolation -w "$SAGE_ROOT/wheelhouse"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_ROOT/wheelhouse`.
+1. In `spkg-build`, build the wheel explicitly using `pip wheel --no-binary :all: --no-build-isolation -w "$SAGE_ROOT/wheelhouse"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_ROOT/wheelhouse`.
 
 2. In `spkg-install`, install the wheel.
 
``````




---

archive/issue_comments_463701.json:
```json
{
    "body": "Dependencies: **#30024**",
    "created_at": "2020-09-06T23:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463701",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30024**



---

archive/issue_comments_463702.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,4 +22,5 @@\n \n - https://pipenv-fork.readthedocs.io/en/latest/advanced.html#specifying-package-indexes\n \n+- https://pip.pypa.io/en/stable/reference/pip_cache/\n \n``````\n",
    "created_at": "2020-09-07T03:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463702",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,4 +22,5 @@
 
 - https://pipenv-fork.readthedocs.io/en/latest/advanced.html#specifying-package-indexes
 
+- https://pip.pypa.io/en/stable/reference/pip_cache/
 
``````




---

archive/issue_comments_463703.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,8 @@\n \n References:\n \n+- https://pip.pypa.io/en/stable/user_guide/#installing-from-local-packages\n+\n - https://github.com/pytorch/pytorch/issues/25639 \"Implement pep 503 Simple Repository API for deployment\"\n \n - https://pypi.org/project/piprepo/ - create PEP 503 package repo\n``````\n",
    "created_at": "2020-09-08T00:45:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463703",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,8 @@
 
 References:
 
+- https://pip.pypa.io/en/stable/user_guide/#installing-from-local-packages
+
 - https://github.com/pytorch/pytorch/issues/25639 "Implement pep 503 Simple Repository API for deployment"
 
 - https://pypi.org/project/piprepo/ - create PEP 503 package repo
``````




---

archive/issue_comments_463704.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,18 @@\n Our current version of pip already tries to install packages via `bdist_wheel`. \n \n-In this ticket, we break the build process into these steps:\n+In this ticket, we break the build process into these steps by modifying `sdh_pip_install`:\n \n-1. In `spkg-build`, build the wheel explicitly using `pip wheel --no-binary :all: --no-build-isolation -w \"$SAGE_ROOT/wheelhouse\"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_ROOT/wheelhouse`.\n+1. Build the wheel explicitly using `pip wheel --no-binary :all: --no-build-isolation -w \"$SAGE_SPKG_WHEELS\"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_SPKG_WHEELS=$SAGE_LOCAL/var/lib/sage/wheels`.\n \n-2. In `spkg-install`, install the wheel.\n+2. Then install the wheel.\n \n-We drop (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation (step 2).\n+The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the DESTDIR staging mechanism -- there will be exactly 1 wheel for each installed package.\n \n-Optionally, the wheels in `SAGE_ROOT/wheelhouse` will persist after the completed build.  Then we can create a PEP 503 compliant Simple Repository index in `SAGE_ROOT/wheelhouse`. Then users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --find-links` or `pip install --index-url`.\n+Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.\n+\n+Optionally, we can create a PEP 503 compliant Simple Repository index in `$SAGE_SPKG_WHEELS`. Then users can create their virtual environment using tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --index-url`.\n+\n+In this ticket, we keep using the DESTDIR staging mechanism also for the installation of the package from the wheel. This can be changed later -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). \n \n ---\n \n``````\n",
    "created_at": "2020-09-08T02:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463704",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,18 @@
 Our current version of pip already tries to install packages via `bdist_wheel`. 
 
-In this ticket, we break the build process into these steps:
+In this ticket, we break the build process into these steps by modifying `sdh_pip_install`:
 
-1. In `spkg-build`, build the wheel explicitly using `pip wheel --no-binary :all: --no-build-isolation -w "$SAGE_ROOT/wheelhouse"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_ROOT/wheelhouse`.
+1. Build the wheel explicitly using `pip wheel --no-binary :all: --no-build-isolation -w "$SAGE_SPKG_WHEELS"` (or `setup.py bdist_wheel`), which stores the wheel in `SAGE_SPKG_WHEELS=$SAGE_LOCAL/var/lib/sage/wheels`.
 
-2. In `spkg-install`, install the wheel.
+2. Then install the wheel.
 
-We drop (for Python packages only) the problematic use of the DESTDIR staging mechanism (#29585). The pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) will only need to be held during the wheel installation (step 2).
+The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the DESTDIR staging mechanism -- there will be exactly 1 wheel for each installed package.
 
-Optionally, the wheels in `SAGE_ROOT/wheelhouse` will persist after the completed build.  Then we can create a PEP 503 compliant Simple Repository index in `SAGE_ROOT/wheelhouse`. Then users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --find-links` or `pip install --index-url`.
+Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.
+
+Optionally, we can create a PEP 503 compliant Simple Repository index in `$SAGE_SPKG_WHEELS`. Then users can create their virtual environment using tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --index-url`.
+
+In this ticket, we keep using the DESTDIR staging mechanism also for the installation of the package from the wheel. This can be changed later -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). 
 
 ---
 
``````




---

archive/issue_comments_463705.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nNarrowed the scope of the ticket.",
    "created_at": "2020-09-08T02:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463705",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Narrowed the scope of the ticket.



---

archive/issue_comments_463706.json:
```json
{
    "body": "Branch: **[u/mkoeppe/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels)**",
    "created_at": "2020-09-08T05:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463706",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels)**



---

archive/issue_comments_463707.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8aa6fd96607c207a0f9563c583978cd50ddc52a7\"><code>8aa6fd9</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Build a wheel, store it</code></td></tr></table>\n",
    "created_at": "2020-09-08T05:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463707",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8aa6fd96607c207a0f9563c583978cd50ddc52a7"><code>8aa6fd9</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_pip_install): Build a wheel, store it</code></td></tr></table>




---

archive/issue_events_402703.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T05:29:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "title_is": "Install all Python packages via pip wheel, store wheels in $SAGE_LOCAL/var/lib/sage/wheels",
    "title_was": "Install all Python packages via pip wheel, create PEP 503 simple repository for wheels",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402703"
}
```



---

archive/issue_comments_463708.json:
```json
{
    "body": "Commit: **[`8aa6fd9`](https://github.com/sagemath/sagetrac-mirror/commit/8aa6fd96607c207a0f9563c583978cd50ddc52a7)**",
    "created_at": "2020-09-08T05:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463708",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`8aa6fd9`](https://github.com/sagemath/sagetrac-mirror/commit/8aa6fd96607c207a0f9563c583978cd50ddc52a7)**



---

archive/issue_comments_463709.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,9 +10,9 @@\n \n Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.\n \n-Optionally, we can create a PEP 503 compliant Simple Repository index in `$SAGE_SPKG_WHEELS`. Then users can create their virtual environment using tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --index-url`.\n+In this ticket, we keep using the DESTDIR staging mechanism also for the installation of the package from the wheel. This can be changed later -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). \n \n-In this ticket, we keep using the DESTDIR staging mechanism also for the installation of the package from the wheel. This can be changed later -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). \n+Follow-up: #30527 Create PEP 503 simple repository for wheels built during installation\n \n ---\n \n@@ -20,13 +20,5 @@\n \n - https://pip.pypa.io/en/stable/user_guide/#installing-from-local-packages\n \n-- https://github.com/pytorch/pytorch/issues/25639 \"Implement pep 503 Simple Repository API for deployment\"\n-\n-- https://pypi.org/project/piprepo/ - create PEP 503 package repo\n-\n-- https://stackoverflow.com/questions/45744937/how-do-install-packages-from-a-local-python-package-index\n-\n-- https://pipenv-fork.readthedocs.io/en/latest/advanced.html#specifying-package-indexes\n-\n - https://pip.pypa.io/en/stable/reference/pip_cache/\n \n``````\n",
    "created_at": "2020-09-08T05:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463709",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,9 +10,9 @@
 
 Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.
 
-Optionally, we can create a PEP 503 compliant Simple Repository index in `$SAGE_SPKG_WHEELS`. Then users can create their virtual environment using tools such as `pipenv` `[This is the Trac macro *source* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#source-macro)` or `pip install --index-url`.
+In this ticket, we keep using the DESTDIR staging mechanism also for the installation of the package from the wheel. This can be changed later -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). 
 
-In this ticket, we keep using the DESTDIR staging mechanism also for the installation of the package from the wheel. This can be changed later -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). 
+Follow-up: #30527 Create PEP 503 simple repository for wheels built during installation
 
 ---
 
@@ -20,13 +20,5 @@
 
 - https://pip.pypa.io/en/stable/user_guide/#installing-from-local-packages
 
-- https://github.com/pytorch/pytorch/issues/25639 "Implement pep 503 Simple Repository API for deployment"
-
-- https://pypi.org/project/piprepo/ - create PEP 503 package repo
-
-- https://stackoverflow.com/questions/45744937/how-do-install-packages-from-a-local-python-package-index
-
-- https://pipenv-fork.readthedocs.io/en/latest/advanced.html#specifying-package-indexes
-
 - https://pip.pypa.io/en/stable/reference/pip_cache/
 
``````




---

archive/issue_comments_463710.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-09-08T05:33:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463710",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_463711.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,13 +6,16 @@\n \n 2. Then install the wheel.\n \n-The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the DESTDIR staging mechanism -- there will be exactly 1 wheel for each installed package.\n+The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the `DESTDIR` staging mechanism -- there will be exactly 1 wheel for each installed package (and removing a package removes the wheel).\n \n Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.\n \n-In this ticket, we keep using the DESTDIR staging mechanism also for the installation of the package from the wheel. This can be changed later -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). \n+- In follow-up ticket #30527, we create a PEP 503 simple repository for the wheels built during installation, which enables more convenient installation options for users.\n \n-Follow-up: #30527 Create PEP 503 simple repository for wheels built during installation\n+\n+In this ticket, we keep using the `DESTDIR` staging mechanism also for the installation of the package from the wheel. \n+\n+- In a follow-up ticket, we can change this -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). \n \n ---\n \n``````\n",
    "created_at": "2020-09-08T05:33:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463711",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,13 +6,16 @@
 
 2. Then install the wheel.
 
-The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the DESTDIR staging mechanism -- there will be exactly 1 wheel for each installed package.
+The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the `DESTDIR` staging mechanism -- there will be exactly 1 wheel for each installed package (and removing a package removes the wheel).
 
 Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.
 
-In this ticket, we keep using the DESTDIR staging mechanism also for the installation of the package from the wheel. This can be changed later -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). 
+- In follow-up ticket #30527, we create a PEP 503 simple repository for the wheels built during installation, which enables more convenient installation options for users.
 
-Follow-up: #30527 Create PEP 503 simple repository for wheels built during installation
+
+In this ticket, we keep using the `DESTDIR` staging mechanism also for the installation of the package from the wheel. 
+
+- In a follow-up ticket, we can change this -- to remove the problems described in #29585 -- by just holding the pip lock (if it is at all still necessary after the major pip upgrades in the 9.2 series) during the wheel installation (step 2). 
 
 ---
 
``````




---

archive/issue_events_402704.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T05:33:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402704"
}
```



---

archive/issue_comments_463712.json:
```json
{
    "body": "Changed dependencies from **#30024** to none",
    "created_at": "2020-09-08T05:36:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463712",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30024** to none



---

archive/issue_comments_463713.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@slel](#comment%3A1):\n> Would that be `gambit`, `numpy` and `pillow`?\n> \n> And is this how to find them?\n> \n> ```\n> $ git grep \"setup.py\" build/pkgs\n> ```\n\nYes, still need to take care of these.",
    "created_at": "2020-09-08T05:46:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463713",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@slel](#comment%3A1):
> Would that be `gambit`, `numpy` and `pillow`?
> 
> And is this how to find them?
> 
> ```
> $ git grep "setup.py" build/pkgs
> ```

Yes, still need to take care of these.



---

archive/issue_events_402705.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T05:46:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402705"
}
```



---

archive/issue_events_402706.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T05:46:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402706"
}
```



---

archive/issue_comments_463714.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d369aabcda2feff14b4f1d14fe824e591d8c5c36\"><code>d369aab</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): New, factored out from sdh_pip_install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d435ab90d74d86264d681371034700a8214e6d3\"><code>2d435ab</code></a></td><td><code>build/pkgs/numpy/spkg-install.in: Install via setup.py bdist_wheel</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55993b6e25560af5e582aed7fcfbb56d317b92fe\"><code>55993b6</code></a></td><td><code>build/bin/sage-dist-helpers: Fixup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a646747dbf7c823030e1b23419348ff795a0661\"><code>0a64674</code></a></td><td><code>build/pkgs/gambit/spkg-install.in: Install via bdist_wheel</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca586938cbdd91114a10dd3364201c8076412485\"><code>ca58693</code></a></td><td><code>build/pkgs/pillow/spkg-install.in: Install via bdist_wheel</code></td></tr></table>\n",
    "created_at": "2020-09-08T19:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463714",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d369aabcda2feff14b4f1d14fe824e591d8c5c36"><code>d369aab</code></a></td><td><code>build/bin/sage-dist-helpers (sdh_store_and_pip_install_wheel): New, factored out from sdh_pip_install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d435ab90d74d86264d681371034700a8214e6d3"><code>2d435ab</code></a></td><td><code>build/pkgs/numpy/spkg-install.in: Install via setup.py bdist_wheel</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55993b6e25560af5e582aed7fcfbb56d317b92fe"><code>55993b6</code></a></td><td><code>build/bin/sage-dist-helpers: Fixup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a646747dbf7c823030e1b23419348ff795a0661"><code>0a64674</code></a></td><td><code>build/pkgs/gambit/spkg-install.in: Install via bdist_wheel</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca586938cbdd91114a10dd3364201c8076412485"><code>ca58693</code></a></td><td><code>build/pkgs/pillow/spkg-install.in: Install via bdist_wheel</code></td></tr></table>




---

archive/issue_comments_463715.json:
```json
{
    "body": "Changed commit from **[`8aa6fd9`](https://github.com/sagemath/sagetrac-mirror/commit/8aa6fd96607c207a0f9563c583978cd50ddc52a7)** to **[`ca58693`](https://github.com/sagemath/sagetrac-mirror/commit/ca586938cbdd91114a10dd3364201c8076412485)**",
    "created_at": "2020-09-08T19:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463715",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8aa6fd9`](https://github.com/sagemath/sagetrac-mirror/commit/8aa6fd96607c207a0f9563c583978cd50ddc52a7)** to **[`ca58693`](https://github.com/sagemath/sagetrac-mirror/commit/ca586938cbdd91114a10dd3364201c8076412485)**



---

archive/issue_comments_463716.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,16 @@\n \n 2. Then install the wheel.\n \n-The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the `DESTDIR` staging mechanism -- there will be exactly 1 wheel for each installed package (and removing a package removes the wheel).\n+The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the `DESTDIR` staging mechanism -- there will be exactly 1 wheel for each installed package (and removing a package removes the wheel). Example (after rebuilding a few packages on this branch):\n+\n+```\n+$ ls -l local/var/lib/sage/wheels/\n+...\n+-rw-r--r--  1 mkoeppe  staff    545293 Sep  8 12:44 Pillow-7.2.0-cp37-cp37m-macosx_10_9_x86_64.whl\n+-rw-r--r--  1 mkoeppe  staff   4573510 Sep  8 12:06 numpy-1.19.1-cp37-cp37m-macosx_10_9_x86_64.whl\n+-rw-r--r--  1 mkoeppe  staff      2237 Sep  8 12:44 sage_conf-9.2b12-py3-none-any.whl\n+-rw-r--r--  1 mkoeppe  staff  17981103 Sep  8 12:59 scipy-1.5.2-cp37-cp37m-macosx_10_9_x86_64.whl\n+```\n \n Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.\n \n``````\n",
    "created_at": "2020-09-08T20:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463716",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,16 @@
 
 2. Then install the wheel.
 
-The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the `DESTDIR` staging mechanism -- there will be exactly 1 wheel for each installed package (and removing a package removes the wheel).
+The wheels in `$SAGE_SPKG_WHEELS` persist after the completed build. We manage them using the `DESTDIR` staging mechanism -- there will be exactly 1 wheel for each installed package (and removing a package removes the wheel). Example (after rebuilding a few packages on this branch):
+
+```
+$ ls -l local/var/lib/sage/wheels/
+...
+-rw-r--r--  1 mkoeppe  staff    545293 Sep  8 12:44 Pillow-7.2.0-cp37-cp37m-macosx_10_9_x86_64.whl
+-rw-r--r--  1 mkoeppe  staff   4573510 Sep  8 12:06 numpy-1.19.1-cp37-cp37m-macosx_10_9_x86_64.whl
+-rw-r--r--  1 mkoeppe  staff      2237 Sep  8 12:44 sage_conf-9.2b12-py3-none-any.whl
+-rw-r--r--  1 mkoeppe  staff  17981103 Sep  8 12:59 scipy-1.5.2-cp37-cp37m-macosx_10_9_x86_64.whl
+```
 
 Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.
 
``````




---

archive/issue_events_402707.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T20:04:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402707"
}
```



---

archive/issue_events_402708.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T20:04:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402708"
}
```



---

archive/issue_comments_463717.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,6 +19,13 @@\n \n Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.\n \n+- Example:\n+\n+      ```\n+      $ python3 -m venv some-venv\n+      $ cd some-venv/\n+      $ bin/pip3 install -v --no-index --find-links=../local/var/lib/sage/wheels/ Pillow    \n+    ```\n - In follow-up ticket #30527, we create a PEP 503 simple repository for the wheels built during installation, which enables more convenient installation options for users.\n \n \n``````\n",
    "created_at": "2020-09-08T20:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463717",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,6 +19,13 @@
 
 Users can create virtual environments and install the wheels built by the Sage distribution into them, using standard tools such as `pip install --find-links`.
 
+- Example:
+
+      ```
+      $ python3 -m venv some-venv
+      $ cd some-venv/
+      $ bin/pip3 install -v --no-index --find-links=../local/var/lib/sage/wheels/ Pillow    
+    ```
 - In follow-up ticket #30527, we create a PEP 503 simple repository for the wheels built during installation, which enables more convenient installation options for users.
 
 
``````




---

archive/issue_comments_463718.json:
```json
{
    "body": "Reviewer: **Tobias Diez, ...**",
    "created_at": "2020-09-09T17:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463718",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Tobias Diez, ...**



---

archive/issue_events_402709.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T17:25:10Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "title_is": "Install all Python packages via pip wheel (or setup.py bdist_wheel), store wheels in $SAGE_LOCAL/var/lib/sage/wheels",
    "title_was": "Install all Python packages via pip wheel, store wheels in $SAGE_LOCAL/var/lib/sage/wheels",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402709"
}
```



---

archive/issue_comments_463719.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a747c48eca1be0104c202e4922e5386aa794d08\"><code>5a747c4</code></a></td><td><code>build/bin/sage-pip-{install,uninstall}: Remove pip2 support</code></td></tr></table>\n",
    "created_at": "2020-09-09T17:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463719",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a747c48eca1be0104c202e4922e5386aa794d08"><code>5a747c4</code></a></td><td><code>build/bin/sage-pip-{install,uninstall}: Remove pip2 support</code></td></tr></table>




---

archive/issue_comments_463720.json:
```json
{
    "body": "Changed commit from **[`ca58693`](https://github.com/sagemath/sagetrac-mirror/commit/ca586938cbdd91114a10dd3364201c8076412485)** to **[`5a747c4`](https://github.com/sagemath/sagetrac-mirror/commit/5a747c48eca1be0104c202e4922e5386aa794d08)**",
    "created_at": "2020-09-09T17:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463720",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ca58693`](https://github.com/sagemath/sagetrac-mirror/commit/ca586938cbdd91114a10dd3364201c8076412485)** to **[`5a747c4`](https://github.com/sagemath/sagetrac-mirror/commit/5a747c48eca1be0104c202e4922e5386aa794d08)**



---

archive/issue_comments_463721.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n- Why `sdh_store_and_pip_install_wheel requires . as only argument`? Why not just call it with no arguments?\n\n- This function should be documented in `developer/packaging.rst`.\n\n- Does `sage-pip-uninstall` leave the old wheels lying around?\n\n- Typo in `sage-pip-uninstall` (copied from `sage-pip-install`): \"this command hould use\"",
    "created_at": "2020-09-17T00:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463721",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

- Why `sdh_store_and_pip_install_wheel requires . as only argument`? Why not just call it with no arguments?

- This function should be documented in `developer/packaging.rst`.

- Does `sage-pip-uninstall` leave the old wheels lying around?

- Typo in `sage-pip-uninstall` (copied from `sage-pip-install`): "this command hould use"



---

archive/issue_comments_463722.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jhpalmieri](#comment%3A28):\n> - Why `sdh_store_and_pip_install_wheel requires . as only argument`? Why not just call it with no arguments?\n\nI did this to emphasize the analogy to `sage-pip-install`.\n\n> - This function should be documented in `developer/packaging.rst`.\n\nGood idea, will do.\n\n> - Does `sage-pip-uninstall` leave the old wheels lying around?\n\n`sage-pip-uninstall` is not really used for regular uninstalls. Rather, it \"force-uninstalls\" previously installed versions - in case the site-packages directory was somehow messed up. (This code was previously part of `sage-pip-install`.)\n\nThe wheels are installed with the staging mechanism (DESTDIR), which records the installed files. In this way, the `-clean` targets etc. automatically install the wheel.\n\n> - Typo in `sage-pip-uninstall` (copied from `sage-pip-install`): \"this command hould use\"\n\nThanks",
    "created_at": "2020-09-17T00:40:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463722",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jhpalmieri](#comment%3A28):
> - Why `sdh_store_and_pip_install_wheel requires . as only argument`? Why not just call it with no arguments?

I did this to emphasize the analogy to `sage-pip-install`.

> - This function should be documented in `developer/packaging.rst`.

Good idea, will do.

> - Does `sage-pip-uninstall` leave the old wheels lying around?

`sage-pip-uninstall` is not really used for regular uninstalls. Rather, it "force-uninstalls" previously installed versions - in case the site-packages directory was somehow messed up. (This code was previously part of `sage-pip-install`.)

The wheels are installed with the staging mechanism (DESTDIR), which records the installed files. In this way, the `-clean` targets etc. automatically install the wheel.

> - Typo in `sage-pip-uninstall` (copied from `sage-pip-install`): "this command hould use"

Thanks



---

archive/issue_comments_463723.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@mkoeppe](#comment%3A29):\n> The wheels are installed with the staging mechanism (DESTDIR), which records the installed files. In this way, the `-clean` targets etc. automatically install the wheel.\n\nTo clarify, both the wheels and the installation made from the wheels uses the staging mechanism.",
    "created_at": "2020-09-17T00:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463723",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@mkoeppe](#comment%3A29):
> The wheels are installed with the staging mechanism (DESTDIR), which records the installed files. In this way, the `-clean` targets etc. automatically install the wheel.

To clarify, both the wheels and the installation made from the wheels uses the staging mechanism.



---

archive/issue_comments_463724.json:
```json
{
    "body": "Changed commit from **[`5a747c4`](https://github.com/sagemath/sagetrac-mirror/commit/5a747c48eca1be0104c202e4922e5386aa794d08)** to **[`4135e8b`](https://github.com/sagemath/sagetrac-mirror/commit/4135e8b236d2e5491b3ee96cbd00196dc5b6e036)**",
    "created_at": "2020-09-17T01:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463724",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5a747c4`](https://github.com/sagemath/sagetrac-mirror/commit/5a747c48eca1be0104c202e4922e5386aa794d08)** to **[`4135e8b`](https://github.com/sagemath/sagetrac-mirror/commit/4135e8b236d2e5491b3ee96cbd00196dc5b6e036)**



---

archive/issue_comments_463725.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ee21109dfb001feec2b032c197defb91cc75783\"><code>9ee2110</code></a></td><td><code>build/bin/sage-dist-helpers: Also use $sudo for storing the wheel file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7aac84ab4dd86ad6203a99eb82371c1d2a46363\"><code>d7aac84</code></a></td><td><code>src/doc/en/developer/packaging.rst: Update sdh_... documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b7c7a04d658838ce511e352edb9c03f42c4a7f2\"><code>9b7c7a0</code></a></td><td><code>build/bin/sage-pip-{install,uninstall}: Fix typo in comment</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4135e8b236d2e5491b3ee96cbd00196dc5b6e036\"><code>4135e8b</code></a></td><td><code>build/bin/sage-pip-install: Remove an outdated comment</code></td></tr></table>\n",
    "created_at": "2020-09-17T01:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463725",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ee21109dfb001feec2b032c197defb91cc75783"><code>9ee2110</code></a></td><td><code>build/bin/sage-dist-helpers: Also use $sudo for storing the wheel file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7aac84ab4dd86ad6203a99eb82371c1d2a46363"><code>d7aac84</code></a></td><td><code>src/doc/en/developer/packaging.rst: Update sdh_... documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b7c7a04d658838ce511e352edb9c03f42c4a7f2"><code>9b7c7a0</code></a></td><td><code>build/bin/sage-pip-{install,uninstall}: Fix typo in comment</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4135e8b236d2e5491b3ee96cbd00196dc5b6e036"><code>4135e8b</code></a></td><td><code>build/bin/sage-pip-install: Remove an outdated comment</code></td></tr></table>




---

archive/issue_events_402710.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-09-18T03:16:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402710"
}
```



---

archive/issue_events_402711.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-09-18T03:16:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402711"
}
```



---

archive/issue_comments_463726.json:
```json
{
    "body": "Changed reviewer from **Tobias Diez, ...** to **Tobias Diez, John Palmieri**",
    "created_at": "2020-09-18T03:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463726",
    "user": "https://github.com/jhpalmieri"
}
```

Changed reviewer from **Tobias Diez, ...** to **Tobias Diez, John Palmieri**



---

archive/issue_comments_463727.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSeems okay to me, and it built and passed tests before, so I think it's okay. Of course, I can [no longer build Sage](https://github.com/sagemath/sage/issues/30494#comment:9) anymore, so perhaps take this review with a grain of salt.",
    "created_at": "2020-09-18T03:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463727",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">comment:32</div>

Seems okay to me, and it built and passed tests before, so I think it's okay. Of course, I can [no longer build Sage](https://github.com/sagemath/sage/issues/30494#comment:9) anymore, so perhaps take this review with a grain of salt.



---

archive/issue_comments_463728.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThanks!",
    "created_at": "2020-09-18T03:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463728",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

Thanks!



---

archive/issue_events_402712.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-21T21:14:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402712"
}
```



---

archive/issue_events_402713.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-21T21:14:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402713"
}
```



---

archive/issue_comments_463729.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nMerge conflict",
    "created_at": "2020-09-21T21:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463729",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">comment:34</div>

Merge conflict



---

archive/issue_comments_463730.json:
```json
{
    "body": "Changed commit from **[`4135e8b`](https://github.com/sagemath/sagetrac-mirror/commit/4135e8b236d2e5491b3ee96cbd00196dc5b6e036)** to **[`f2e7075`](https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8)**",
    "created_at": "2020-09-21T21:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463730",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4135e8b`](https://github.com/sagemath/sagetrac-mirror/commit/4135e8b236d2e5491b3ee96cbd00196dc5b6e036)** to **[`f2e7075`](https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8)**



---

archive/issue_comments_463731.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8\"><code>f2e7075</code></a></td><td><code>Merge tag '9.2.beta13' into t/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels</code></td></tr></table>\n",
    "created_at": "2020-09-21T21:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463731",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8"><code>f2e7075</code></a></td><td><code>Merge tag '9.2.beta13' into t/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels</code></td></tr></table>




---

archive/issue_events_402714.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T21:49:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402714"
}
```



---

archive/issue_events_402715.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T21:49:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402715"
}
```



---

archive/issue_comments_463732.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels)** to **[`f2e7075`](https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8)**",
    "created_at": "2020-09-27T09:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463732",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels)** to **[`f2e7075`](https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8)**



---

archive/issue_events_402716.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-27T09:09:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402716"
}
```



---

archive/issue_events_402717.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "82a9e2d091a0bf7a951c7f0016681f26e24b1971",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-09-27T09:09:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402717"
}
```



---

archive/issue_events_402718.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-27T16:18:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402718"
}
```



---

archive/issue_events_402719.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-27T16:18:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29500#event-402719"
}
```



---

archive/issue_comments_463733.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nFollow-up: #30771",
    "created_at": "2020-10-15T04:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463733",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

Follow-up: #30771



---

archive/issue_comments_463734.json:
```json
{
    "body": "Changed commit from **[`f2e7075`](https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8)** to none",
    "created_at": "2020-10-15T04:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463734",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`f2e7075`](https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8)** to none



---

archive/issue_comments_463735.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI'm not really sure what the advantage is of this complication. For the follow-up do you propose eliminating the installation manifests installed to `/var/lib/sage/installed/`? I would very much prefer to not do that. I see no reason for Python packages to be arbitrarily treated differently in this regard. But I'm not sure if that is really the plan.",
    "created_at": "2020-10-22T13:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463735",
    "user": "https://github.com/embray"
}
```

<div id="comment:40" align="right">comment:40</div>

I'm not really sure what the advantage is of this complication. For the follow-up do you propose eliminating the installation manifests installed to `/var/lib/sage/installed/`? I would very much prefer to not do that. I see no reason for Python packages to be arbitrarily treated differently in this regard. But I'm not sure if that is really the plan.



---

archive/issue_comments_463736.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@embray](#comment%3A40):\n> I'm not really sure what the advantage is of this complication. \n\nhttps://wiki.sagemath.org/ReleaseTours/sage-9.2#Reusable_wheels_for_the_Python_packages_built_by_the_Sage_distribution explains an immediate use case.",
    "created_at": "2020-10-22T15:12:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463736",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@embray](#comment%3A40):
> I'm not really sure what the advantage is of this complication. 

https://wiki.sagemath.org/ReleaseTours/sage-9.2#Reusable_wheels_for_the_Python_packages_built_by_the_Sage_distribution explains an immediate use case.



---

archive/issue_comments_463737.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@embray](#comment%3A40):\n> For the follow-up do you propose eliminating the installation manifests installed to `/var/lib/sage/installed/`?\n\nI don't have a ticket for this at the moment. But I think it's unavoidable to make some changes. Already now these installation manifests (which duplicate the `.egg-info` record in `site-packages`) can fall out of sync with the actual installation when the user uses `sage -pip install`, which could lead to upgrades of some python package dependencies. It's best to use standard Python tools to manage Python packages.",
    "created_at": "2020-10-22T15:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29500#issuecomment-463737",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@embray](#comment%3A40):
> For the follow-up do you propose eliminating the installation manifests installed to `/var/lib/sage/installed/`?

I don't have a ticket for this at the moment. But I think it's unavoidable to make some changes. Already now these installation manifests (which duplicate the `.egg-info` record in `site-packages`) can fall out of sync with the actual installation when the user uses `sage -pip install`, which could lead to upgrades of some python package dependencies. It's best to use standard Python tools to manage Python packages.
