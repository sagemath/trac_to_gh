# Issue 29127: Implement an affine basis for polytopes

archive/issues_028890.json:
```json
{
    "body": "Sometimes it is useful to obtain `dim + 1` vertices of a polytope in general position -- an affine basis.\n\nWith #29117, which provides a maximal chain of faces, we can easily obtain those vertices that are even guaranteed to be in general position for any realization of the polytope.\n\nWe apply this affine basis to simplify `is_inscribed`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):\n\nTime without this ticket:\n\n```\nsage: P = polytopes.hypercube(8)\nsage: %time P.is_inscribed()\nCPU times: user 17.5 s, sys: 32.4 ms, total: 17.5 s\nWall time: 17.5 s\nTrue\n```\nTime with this ticket:\n\n```\nsage: P = polytopes.hypercube(8)\nsage: %time P.is_inscribed()\nCPU times: user 17.5 ms, sys: 10 \u00b5s, total: 17.5 ms\nWall time: 17.4 ms\nTrue\n```\n\nWhile we are at it, we fix a bug for the empty polyhedron, so that `a_maximal_chain` returns just a list of one empty face, instead of two.\n\nFollow ups:\n\n- We use this to fix #29116.\n- We implement `is_affinely_isomorphic`.\n\nCC:  @jplab @laisrast\n\nKeywords: polytopes, affine basis\n\nBranch/Commit: ba31a5e505bb23ca2de502250bcc98352b66446b\n\nReviewer: Laith Rastanawi\n\nAuthor: Jonathan Kliem\n\nDependencies: #29117\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29127\n\n",
    "closed_at": "2020-03-01T23:46:02Z",
    "created_at": "2020-01-31T20:39:53Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Implement an affine basis for polytopes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29127",
    "user": "https://github.com/kliem"
}
```
Sometimes it is useful to obtain `dim + 1` vertices of a polytope in general position -- an affine basis.

With #29117, which provides a maximal chain of faces, we can easily obtain those vertices that are even guaranteed to be in general position for any realization of the polytope.

We apply this affine basis to simplify `is_inscribed`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):

Time without this ticket:

```
sage: P = polytopes.hypercube(8)
sage: %time P.is_inscribed()
CPU times: user 17.5 s, sys: 32.4 ms, total: 17.5 s
Wall time: 17.5 s
True
```
Time with this ticket:

```
sage: P = polytopes.hypercube(8)
sage: %time P.is_inscribed()
CPU times: user 17.5 ms, sys: 10 Âµs, total: 17.5 ms
Wall time: 17.4 ms
True
```

While we are at it, we fix a bug for the empty polyhedron, so that `a_maximal_chain` returns just a list of one empty face, instead of two.

Follow ups:

- We use this to fix #29116.
- We implement `is_affinely_isomorphic`.

CC:  @jplab @laisrast

Keywords: polytopes, affine basis

Branch/Commit: ba31a5e505bb23ca2de502250bcc98352b66446b

Reviewer: Laith Rastanawi

Author: Jonathan Kliem

Dependencies: #29117

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29127





---

archive/issue_comments_567801.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n With #29117, which provides a maximal chain of faces, we can easily obtain those vertices that are even guaranteed to be in general position for any realization of the polytope.\n \n-We apply this affine basis to simplify `is_inscribable`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):\n+We apply this affine basis to simplify `is_inscribed`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):\n \n Time without this ticket:\n \n``````\n",
    "created_at": "2020-01-31T20:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567801",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 With #29117, which provides a maximal chain of faces, we can easily obtain those vertices that are even guaranteed to be in general position for any realization of the polytope.
 
-We apply this affine basis to simplify `is_inscribable`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):
+We apply this affine basis to simplify `is_inscribed`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):
 
 Time without this ticket:
 
``````




---

archive/issue_comments_567802.json:
```json
{
    "body": "Changing commit from \"\" to \"231c16f3a948591183cf21bfff83226997201fea\"",
    "created_at": "2020-01-31T20:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567802",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "231c16f3a948591183cf21bfff83226997201fea"



---

archive/issue_comments_567803.json:
```json
{
    "body": "Changing branch from \"\" to \"public/29127\"",
    "created_at": "2020-01-31T20:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567803",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/29127"



---

archive/issue_comments_567804.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2020-01-31T20:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567804",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_567805.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-31T20:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567805",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_567806.json:
```json
{
    "body": "Changing commit from \"231c16f3a948591183cf21bfff83226997201fea\" to \"4fb0f6ba4cfd36da8f5f41a499c78aa82cccca4b\"",
    "created_at": "2020-01-31T21:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "231c16f3a948591183cf21bfff83226997201fea" to "4fb0f6ba4cfd36da8f5f41a499c78aa82cccca4b"



---

archive/issue_comments_567807.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-31T21:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_567808.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2020-02-19T08:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567808",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_567809.json:
```json
{
    "body": "Changing commit from \"4fb0f6ba4cfd36da8f5f41a499c78aa82cccca4b\" to \"d2d2a8a4ebc544f986cb38744eee91047371bca6\"",
    "created_at": "2020-02-19T08:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567809",
    "user": "https://github.com/kliem"
}
```

Changing commit from "4fb0f6ba4cfd36da8f5f41a499c78aa82cccca4b" to "d2d2a8a4ebc544f986cb38744eee91047371bca6"



---

archive/issue_comments_567810.json:
```json
{
    "body": "Changing branch from \"public/29127\" to \"public/29127-reb\"",
    "created_at": "2020-02-19T08:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567810",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/29127" to "public/29127-reb"



---

archive/issue_comments_567811.json:
```json
{
    "body": "Changing dependencies from \"#29117, #29125\" to \"#29117\"",
    "created_at": "2020-02-19T08:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567811",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "#29117, #29125" to "#29117"



---

archive/issue_comments_567812.json:
```json
{
    "body": "<a id='comment:6'></a>Some typos\n\n```diff\n-        in the face lattices and picking for each cover relation\n-        on vertex that is in the difference. Thus this method\n+        in the face lattice and picking for each cover relationa\n+        one vertex that is in the difference. Thus this method\n```\n\n```\n        # We just in the folling that element in ``chain_indices`` is a sorted list\n        # of V-indices.\n```\n\nSince you also implemented an_affine_basis for Polyhedron, maybe it is better to use it.\nDoing so, you can remove the following part of your code and thus making the code easier to read.\nI am saying this because if you use an_affine_basis for Polyhedron, you will have the whole polyhedron as a face.\n\n```\n        # Finally append some vertex not contained in ``face``,\n        # which is a facet of ``self`` now.\n        for i in range(len(face)):\n            if face[i] != i:\n                basis_indices.append(i)\n                break\n        else:  # no break\n            basis_indices.append(len(face))\n+}}}",
    "created_at": "2020-02-28T10:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567812",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:6'></a>Some typos

```diff
-        in the face lattices and picking for each cover relation
-        on vertex that is in the difference. Thus this method
+        in the face lattice and picking for each cover relationa
+        one vertex that is in the difference. Thus this method
```

```
        # We just in the folling that element in ``chain_indices`` is a sorted list
        # of V-indices.
```

Since you also implemented an_affine_basis for Polyhedron, maybe it is better to use it.
Doing so, you can remove the following part of your code and thus making the code easier to read.
I am saying this because if you use an_affine_basis for Polyhedron, you will have the whole polyhedron as a face.

```
        # Finally append some vertex not contained in ``face``,
        # which is a facet of ``self`` now.
        for i in range(len(face)):
            if face[i] != i:
                basis_indices.append(i)
                break
        else:  # no break
            basis_indices.append(len(face))
+}}}



---

archive/issue_comments_567813.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-02-28T10:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567813",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_567814.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,34 @@\n+Sometimes it is useful to obtain `dim + 1` vertices of a polytope in general position -- an affine basis.\n \n+With #29117, which provides a maximal chain of faces, we can easily obtain those vertices that are even guaranteed to be in general position for any realization of the polytope.\n+\n+We apply this affine basis to simplify `is_inscribed`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):\n+\n+Time without this ticket:\n+\n+```\n+sage: P = polytopes.hypercube(8)\n+sage: %time P.is_inscribed()\n+CPU times: user 17.5 s, sys: 32.4 ms, total: 17.5 s\n+Wall time: 17.5 s\n+True\n+```\n+Time with this ticket:\n+\n+```\n+sage: P = polytopes.hypercube(8)\n+sage: %time P.is_inscribed()\n+CPU times: user 17.5 ms, sys: 10 \u00b5s, total: 17.5 ms\n+Wall time: 17.4 ms\n+True\n+```\n+\n+While we are at it, we fix a bug for the empty polyhedron, so that `a_maximal_chain` returns just a list of one empty face, instead of two.\n+\n+Follow ups:\n+\n+- We use this to fix #29116.\n+- We implement `is_affinely_isomorphic`.\n \n Author: Jonathan Kliem\n \n``````\n",
    "created_at": "2020-02-28T10:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567814",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,34 @@
+Sometimes it is useful to obtain `dim + 1` vertices of a polytope in general position -- an affine basis.
 
+With #29117, which provides a maximal chain of faces, we can easily obtain those vertices that are even guaranteed to be in general position for any realization of the polytope.
+
+We apply this affine basis to simplify `is_inscribed`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):
+
+Time without this ticket:
+
+```
+sage: P = polytopes.hypercube(8)
+sage: %time P.is_inscribed()
+CPU times: user 17.5 s, sys: 32.4 ms, total: 17.5 s
+Wall time: 17.5 s
+True
+```
+Time with this ticket:
+
+```
+sage: P = polytopes.hypercube(8)
+sage: %time P.is_inscribed()
+CPU times: user 17.5 ms, sys: 10 Âµs, total: 17.5 ms
+Wall time: 17.4 ms
+True
+```
+
+While we are at it, we fix a bug for the empty polyhedron, so that `a_maximal_chain` returns just a list of one empty face, instead of two.
+
+Follow ups:
+
+- We use this to fix #29116.
+- We implement `is_affinely_isomorphic`.
 
 Author: Jonathan Kliem
 
``````




---

archive/issue_comments_567815.json:
```json
{
    "body": "Changing commit from \"d2d2a8a4ebc544f986cb38744eee91047371bca6\" to \"b5f9be530140ad827cbdec2164103a44dc4caaf9\"",
    "created_at": "2020-02-28T10:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d2d2a8a4ebc544f986cb38744eee91047371bca6" to "b5f9be530140ad827cbdec2164103a44dc4caaf9"



---

archive/issue_comments_567816.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-28T10:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_567817.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-28T10:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567817",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_567818.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-28T10:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_567819.json:
```json
{
    "body": "Changing commit from \"b5f9be530140ad827cbdec2164103a44dc4caaf9\" to \"ba31a5e505bb23ca2de502250bcc98352b66446b\"",
    "created_at": "2020-02-28T10:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b5f9be530140ad827cbdec2164103a44dc4caaf9" to "ba31a5e505bb23ca2de502250bcc98352b66446b"



---

archive/issue_comments_567820.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Laith Rastanawi\"",
    "created_at": "2020-02-28T10:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567820",
    "user": "https://github.com/LaisRast"
}
```

Changing reviewer from "" to "Laith Rastanawi"



---

archive/issue_comments_567821.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-28T10:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567821",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_073877.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-01T23:46:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29127#event-73877"
}
```



---

archive/issue_comments_567822.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-01T23:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567822",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_567823.json:
```json
{
    "body": "Changing branch from \"public/29127-reb\" to \"ba31a5e505bb23ca2de502250bcc98352b66446b\"",
    "created_at": "2020-03-01T23:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-567823",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/29127-reb" to "ba31a5e505bb23ca2de502250bcc98352b66446b"
