# Issue 29127: Implement an affine basis for polytopes

archive/issues_028890.json:
```json
{
    "body": "CC:  @jplab @laisrast\n\nKeywords: polytopes, affine basis\n\nSometimes it is useful to obtain `dim + 1` vertices of a polytope in general position -- an affine basis.\n\nWith #29117, which provides a maximal chain of faces, we can easily obtain those vertices that are even guaranteed to be in general position for any realization of the polytope.\n\nWe apply this affine basis to simplify `is_inscribed`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):\n\nTime without this ticket:\n\n```\nsage: P = polytopes.hypercube(8)\nsage: %time P.is_inscribed()\nCPU times: user 17.5 s, sys: 32.4 ms, total: 17.5 s\nWall time: 17.5 s\nTrue\n```\nTime with this ticket:\n\n```\nsage: P = polytopes.hypercube(8)\nsage: %time P.is_inscribed()\nCPU times: user 17.5 ms, sys: 10 \u00b5s, total: 17.5 ms\nWall time: 17.4 ms\nTrue\n```\n\nWhile we are at it, we fix a bug for the empty polyhedron, so that `a_maximal_chain` returns just a list of one empty face, instead of two.\n\nFollow ups:\n\n- We use this to fix #29116.\n- We implement `is_affinely_isomorphic`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29127\n\n",
    "closed_at": "2020-03-01T23:46:02Z",
    "created_at": "2020-01-31T20:39:53Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Implement an affine basis for polytopes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29127",
    "user": "https://github.com/kliem"
}
```
CC:  @jplab @laisrast

Keywords: polytopes, affine basis

Sometimes it is useful to obtain `dim + 1` vertices of a polytope in general position -- an affine basis.

With #29117, which provides a maximal chain of faces, we can easily obtain those vertices that are even guaranteed to be in general position for any realization of the polytope.

We apply this affine basis to simplify `is_inscribed`. This is also faster, as the current approach requires to compute all neighbors of a vertex (which can be pretty hard, even once this is done efficiently through combinatorial polyhedron):

Time without this ticket:

```
sage: P = polytopes.hypercube(8)
sage: %time P.is_inscribed()
CPU times: user 17.5 s, sys: 32.4 ms, total: 17.5 s
Wall time: 17.5 s
True
```
Time with this ticket:

```
sage: P = polytopes.hypercube(8)
sage: %time P.is_inscribed()
CPU times: user 17.5 ms, sys: 10 Âµs, total: 17.5 ms
Wall time: 17.4 ms
True
```

While we are at it, we fix a bug for the empty polyhedron, so that `a_maximal_chain` returns just a list of one empty face, instead of two.

Follow ups:

- We use this to fix #29116.
- We implement `is_affinely_isomorphic`.

Issue created by migration from https://trac.sagemath.org/ticket/29127





---

archive/issue_comments_408547.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-01-31T20:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408547",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_408548.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-31T20:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408548",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_408549.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-31T21:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408550.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-02-19T08:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408550",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_408551.json:
```json
{
    "body": "Some typos\n\n```diff\n-        in the face lattices and picking for each cover relation\n-        on vertex that is in the difference. Thus this method\n+        in the face lattice and picking for each cover relationa\n+        one vertex that is in the difference. Thus this method\n```\n\n```\n        # We just in the folling that element in ``chain_indices`` is a sorted list\n        # of V-indices.\n```\n\nSince you also implemented an_affine_basis for Polyhedron, maybe it is better to use it.\nDoing so, you can remove the following part of your code and thus making the code easier to read.\nI am saying this because if you use an_affine_basis for Polyhedron, you will have the whole polyhedron as a face.\n\n```\n        # Finally append some vertex not contained in ``face``,\n        # which is a facet of ``self`` now.\n        for i in range(len(face)):\n            if face[i] != i:\n                basis_indices.append(i)\n                break\n        else:  # no break\n            basis_indices.append(len(face))\n+}}}",
    "created_at": "2020-02-28T10:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408551",
    "user": "https://github.com/LaisRast"
}
```

Some typos

```diff
-        in the face lattices and picking for each cover relation
-        on vertex that is in the difference. Thus this method
+        in the face lattice and picking for each cover relationa
+        one vertex that is in the difference. Thus this method
```

```
        # We just in the folling that element in ``chain_indices`` is a sorted list
        # of V-indices.
```

Since you also implemented an_affine_basis for Polyhedron, maybe it is better to use it.
Doing so, you can remove the following part of your code and thus making the code easier to read.
I am saying this because if you use an_affine_basis for Polyhedron, you will have the whole polyhedron as a face.

```
        # Finally append some vertex not contained in ``face``,
        # which is a facet of ``self`` now.
        for i in range(len(face)):
            if face[i] != i:
                basis_indices.append(i)
                break
        else:  # no break
            basis_indices.append(len(face))
+}}}



---

archive/issue_comments_408552.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-02-28T10:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408552",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_408553.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-28T10:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408554.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-28T10:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408554",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_408555.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-28T10:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408556.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-28T10:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408556",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_073877.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-01T23:46:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29127#event-73877"
}
```



---

archive/issue_comments_408557.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-01T23:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29127#issuecomment-408557",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
