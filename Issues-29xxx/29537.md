# Issue 29537: build not portable despite using SAGE_FAT_BINARY=yes, NTL/openblas/numpy-related

archive/issues_029300.json:
```json
{
    "body": "We fix several issues involving `SAGE_FAT_BINARY`:\n\n- `numpy` intrinsics need a special build flag in this mode\n\n- `ntl` needs to disable use of a problematic instruction set\n\n- After #31064, the GH Actions tests for `cygwin` did not pass SAGE_FAT_BINARY to the actual build, randomly causing SIGILLs when a partial build was passed to the next stage through the `sage-local` artifact\n\n\n\nCC:  @dimpase @orlitzky @kiwifb @embray @darijgr @tscrim @kliem @seblabbe\n\nKeywords: sd111\n\nReviewer: Matthias Koeppe, Jonathan Kliem\n\nAuthor: Jonathan Kliem, Matthias Koeppe\n\nBranch: d6dced2457b7c3a6b645f2e56b9ca44c4b09e437\n\nDependencies: #31493\n\nCommit: d6dced2457b7c3a6b645f2e56b9ca44c4b09e437\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29537\n\n",
    "closed_at": "2021-03-22T23:54:13Z",
    "created_at": "2020-04-20T07:47:56Z",
    "labels": [
        "component: porting",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "build not portable despite using SAGE_FAT_BINARY=yes, NTL/openblas/numpy-related",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29537",
    "user": "https://github.com/mkoeppe"
}
```
We fix several issues involving `SAGE_FAT_BINARY`:

- `numpy` intrinsics need a special build flag in this mode

- `ntl` needs to disable use of a problematic instruction set

- After #31064, the GH Actions tests for `cygwin` did not pass SAGE_FAT_BINARY to the actual build, randomly causing SIGILLs when a partial build was passed to the next stage through the `sage-local` artifact



CC:  @dimpase @orlitzky @kiwifb @embray @darijgr @tscrim @kliem @seblabbe

Keywords: sd111

Reviewer: Matthias Koeppe, Jonathan Kliem

Author: Jonathan Kliem, Matthias Koeppe

Branch: d6dced2457b7c3a6b645f2e56b9ca44c4b09e437

Dependencies: #31493

Commit: d6dced2457b7c3a6b645f2e56b9ca44c4b09e437

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29537





---

archive/issue_comments_414799.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2020-04-20T07:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414799",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_414800.json:
```json
{
    "body": "<a id='comment:3'></a>could it be some kind of hardware mismatch?",
    "created_at": "2020-04-20T08:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414800",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>could it be some kind of hardware mismatch?



---

archive/issue_comments_414801.json:
```json
{
    "body": "<a id='comment:4'></a>Possibly, I'll investigate",
    "created_at": "2020-04-20T15:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414801",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Possibly, I'll investigate



---

archive/issue_comments_414802.json:
```json
{
    "body": "<a id='comment:5'></a>I will try with the configuration that Erik's https://github.com/sagemath/sage-windows/blob/master/Makefile\nuses",
    "created_at": "2020-04-20T17:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414802",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>I will try with the configuration that Erik's https://github.com/sagemath/sage-windows/blob/master/Makefile
uses



---

archive/issue_comments_414803.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2020-05-05T01:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414803",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from blocker to critical.



---

archive/issue_events_075377.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-05T01:06:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29537#event-75377"
}
```



---

archive/issue_comments_414804.json:
```json
{
    "body": "<a id='comment:7'></a>I looked at one of the build logs on [GitHub](GitHub) and it does look like `SAGE_FAT_BINARY=yes` is being passed down, so other than that I'm not aware of any issue that would cause this unless there's a new issue with NTL I haven't seen before.",
    "created_at": "2020-06-26T12:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414804",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>I looked at one of the build logs on [GitHub](GitHub) and it does look like `SAGE_FAT_BINARY=yes` is being passed down, so other than that I'm not aware of any issue that would cause this unless there's a new issue with NTL I haven't seen before.



---

archive/issue_comments_414805.json:
```json
{
    "body": "<a id='comment:8'></a>Possibly related: #29109",
    "created_at": "2020-06-26T12:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414805",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>Possibly related: #29109



---

archive/issue_events_075378.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29537#event-75378"
}
```



---

archive/issue_events_075379.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29537#event-75379"
}
```



---

archive/issue_comments_414806.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-09T20:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414806",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_414807.json:
```json
{
    "body": "<a id='comment:11'></a>It's quite possible that this also affects our Docker builds.",
    "created_at": "2020-12-25T19:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414807",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>It's quite possible that this also affects our Docker builds.



---

archive/issue_comments_414808.json:
```json
{
    "body": "<a id='comment:12'></a>A report regarding the Docker builds: https://groups.google.com/g/sage-devel/c/Dbd4nFi8R7I (but no NTL involvement visible)",
    "created_at": "2020-12-28T18:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414808",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>A report regarding the Docker builds: https://groups.google.com/g/sage-devel/c/Dbd4nFi8R7I (but no NTL involvement visible)



---

archive/issue_comments_414809.json:
```json
{
    "body": "Changing component from porting: Cygwin to porting.",
    "created_at": "2020-12-28T18:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414809",
    "user": "https://github.com/mkoeppe"
}
```

Changing component from porting: Cygwin to porting.



---

archive/issue_comments_414810.json:
```json
{
    "body": "<a id='comment:13'></a>From `NTL/doc/tour-win.html`:\n\n```\n152 Configuration flags.\n153 </b>\n154 <p>\n155 \n156 Also in directory \"<tt>include/NTL</tt>\" is a file called \"<tt>config.h</tt>\".\n157 You can edit this file to override some of NTL's default options\n158 for basic configuration and performance.\n159 Again, the defaults should be good for\n160 Windows with MSVC++.\n```\n\nIn `config.h` there is a couple of flags that needs to be set by hand apparently.\n\nThose look like they might make problems:\n\n```\n195 #if 0\n196 #define NTL_CLEAN_INT\n197 \n198 /*\n199  *   This will disallow the use of some non-standard integer arithmetic\n200  *   that may improve performance somewhat.\n201  *\n202  */\n203 \n204 #endif\n205 \n206 #if 1\n207 #define NTL_CLEAN_PTR\n208 \n209 /*\n210  *   This will disallow the use of some non-standard pointer arithmetic\n211  *   that may improve performance somewhat.\n212  *\n213  */\n214 \n215 #endif\n216 \n217 #if 1\n218 #define NTL_SAFE_VECTORS\n219 \n220 /*\n221  * This will compile NTL in \"safe vector\" mode, only assuming\n222  * the relocatability property for trivial types and types\n223  * explicitly declared relocatable.  See vector.txt for more details.\n224  */\n225 \n226 #endif\n227 \n228 #if 0\n229 #define NTL_ENABLE_AVX_FFT\n230 \n231 /*\n232  * This will compile NTL in a way that enables an AVX implemention\n233  * of the small-prime FFT.\n234  */\n235 \n236 #endif\n237 \n238 \n239 #if 0\n240 #define NTL_AVOID_AVX512\n241  \n242 /*\n243  * This will compile NTL in a way that avoids 512-bit operations,\n244  * even if AVX512 is available.\n245  */\n246 \n247 #endif\n248  \n249 #if 0\n250 #define NTL_RANGE_CHECK\n251 \n252 /*\n253  *   This will generate vector subscript range-check code.\n254  *   Useful for debugging, but it slows things down of course.\n255  *\n256  */\n257 \n258 #endif\n```",
    "created_at": "2020-12-29T08:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414810",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>From `NTL/doc/tour-win.html`:

```
152 Configuration flags.
153 </b>
154 <p>
155 
156 Also in directory "<tt>include/NTL</tt>" is a file called "<tt>config.h</tt>".
157 You can edit this file to override some of NTL's default options
158 for basic configuration and performance.
159 Again, the defaults should be good for
160 Windows with MSVC++.
```

In `config.h` there is a couple of flags that needs to be set by hand apparently.

Those look like they might make problems:

```
195 #if 0
196 #define NTL_CLEAN_INT
197 
198 /*
199  *   This will disallow the use of some non-standard integer arithmetic
200  *   that may improve performance somewhat.
201  *
202  */
203 
204 #endif
205 
206 #if 1
207 #define NTL_CLEAN_PTR
208 
209 /*
210  *   This will disallow the use of some non-standard pointer arithmetic
211  *   that may improve performance somewhat.
212  *
213  */
214 
215 #endif
216 
217 #if 1
218 #define NTL_SAFE_VECTORS
219 
220 /*
221  * This will compile NTL in "safe vector" mode, only assuming
222  * the relocatability property for trivial types and types
223  * explicitly declared relocatable.  See vector.txt for more details.
224  */
225 
226 #endif
227 
228 #if 0
229 #define NTL_ENABLE_AVX_FFT
230 
231 /*
232  * This will compile NTL in a way that enables an AVX implemention
233  * of the small-prime FFT.
234  */
235 
236 #endif
237 
238 
239 #if 0
240 #define NTL_AVOID_AVX512
241  
242 /*
243  * This will compile NTL in a way that avoids 512-bit operations,
244  * even if AVX512 is available.
245  */
246 
247 #endif
248  
249 #if 0
250 #define NTL_RANGE_CHECK
251 
252 /*
253  *   This will generate vector subscript range-check code.
254  *   Useful for debugging, but it slows things down of course.
255  *
256  */
257 
258 #endif
```



---

archive/issue_comments_414811.json:
```json
{
    "body": "<a id='comment:14'></a>So I guess we have to patch NTL as to avoid those flags by configuration.",
    "created_at": "2020-12-29T09:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414811",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>So I guess we have to patch NTL as to avoid those flags by configuration.



---

archive/issue_comments_414812.json:
```json
{
    "body": "<a id='comment:15'></a>The relevant configuration is done in `src/DoConfig`, which is unfortunately perl (yet another language whichs syntax I do not understand).\n\nBut one might even define those things as environment variables and this might be passed through??\n\nIn `src/DoConfig` there is the following list:\n\n```\n 55 %ConfigFlag = (\n 56 \n 57 'NTL_LEGACY_NO_NAMESPACE' => 'off',\n 58 'NTL_LEGACY_INPUT_ERROR'  => 'off',\n 59 'NTL_DISABLE_LONGDOUBLE'  => 'off',\n 60 'NTL_DISABLE_LONGLONG'    => 'off',\n 61 'NTL_DISABLE_LL_ASM'      => 'off',\n 62 'NTL_MAXIMIZE_SP_NBITS'   => 'off',\n 63 'NTL_LEGACY_SP_MULMOD'    => 'off',\n 64 'NTL_THREADS'             => 'on',\n 65 'NTL_TLS_HACK'            => 'on',\n 66 'NTL_EXCEPTIONS'          => 'off',\n 67 'NTL_STD_CXX11'           => 'on',\n 68 'NTL_STD_CXX14'           => 'off',\n 69 'NTL_DISABLE_MOVE_ASSIGN' => 'on',\n 70 'NTL_DISABLE_MOVE'        => 'off',\n 71 'NTL_THREAD_BOOST'        => 'on',\n 72 'NTL_GMP_LIP'             => 'on',\n 73 'NTL_GF2X_LIB'            => 'off',\n 74 'NTL_X86_FIX'             => 'off',\n 75 'NTL_NO_X86_FIX'          => 'off',\n 76 'NTL_NO_INIT_TRANS'       => 'on',\n 77 'NTL_CLEAN_INT'           => 'off',\n 78 'NTL_CLEAN_PTR'           => 'on',\n 79 'NTL_SAFE_VECTORS'        => 'on',\n 80 'NTL_RANGE_CHECK'         => 'off',\n 81 'NTL_ENABLE_AVX_FFT'      => 'off',\n 82 'NTL_AVOID_AVX512'        => 'off',\n 83 \n 84 \n 85 'NTL_SPMM_ULL'            => 'off',\n 86 'NTL_AVOID_BRANCHING'     => 'off',\n 87 'NTL_FFT_BIGTAB'          => 'off',\n 88 'NTL_FFT_LAZYMUL'         => 'off',\n 89 'NTL_TBL_REM'             => 'off',\n 90 'NTL_CRT_ALTCODE'         => 'off',\n 91 'NTL_CRT_ALTCODE_SMALL'   => 'off',\n 92 'NTL_GF2X_NOINLINE'       => 'off',\n 93 'NTL_GF2X_ALTCODE'        => 'off',\n 94 'NTL_GF2X_ALTCODE1'       => 'off',\n 95 \n 96 \n 97 );\n```\n\nWhat makes me thing that it might be AVX512 related, is that we haven't encountered this before. Github workflows is the only place where I encountered processors capable of AVX512.",
    "created_at": "2020-12-29T09:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414812",
    "user": "https://github.com/kliem"
}
```

<a id='comment:15'></a>The relevant configuration is done in `src/DoConfig`, which is unfortunately perl (yet another language whichs syntax I do not understand).

But one might even define those things as environment variables and this might be passed through??

In `src/DoConfig` there is the following list:

```
 55 %ConfigFlag = (
 56 
 57 'NTL_LEGACY_NO_NAMESPACE' => 'off',
 58 'NTL_LEGACY_INPUT_ERROR'  => 'off',
 59 'NTL_DISABLE_LONGDOUBLE'  => 'off',
 60 'NTL_DISABLE_LONGLONG'    => 'off',
 61 'NTL_DISABLE_LL_ASM'      => 'off',
 62 'NTL_MAXIMIZE_SP_NBITS'   => 'off',
 63 'NTL_LEGACY_SP_MULMOD'    => 'off',
 64 'NTL_THREADS'             => 'on',
 65 'NTL_TLS_HACK'            => 'on',
 66 'NTL_EXCEPTIONS'          => 'off',
 67 'NTL_STD_CXX11'           => 'on',
 68 'NTL_STD_CXX14'           => 'off',
 69 'NTL_DISABLE_MOVE_ASSIGN' => 'on',
 70 'NTL_DISABLE_MOVE'        => 'off',
 71 'NTL_THREAD_BOOST'        => 'on',
 72 'NTL_GMP_LIP'             => 'on',
 73 'NTL_GF2X_LIB'            => 'off',
 74 'NTL_X86_FIX'             => 'off',
 75 'NTL_NO_X86_FIX'          => 'off',
 76 'NTL_NO_INIT_TRANS'       => 'on',
 77 'NTL_CLEAN_INT'           => 'off',
 78 'NTL_CLEAN_PTR'           => 'on',
 79 'NTL_SAFE_VECTORS'        => 'on',
 80 'NTL_RANGE_CHECK'         => 'off',
 81 'NTL_ENABLE_AVX_FFT'      => 'off',
 82 'NTL_AVOID_AVX512'        => 'off',
 83 
 84 
 85 'NTL_SPMM_ULL'            => 'off',
 86 'NTL_AVOID_BRANCHING'     => 'off',
 87 'NTL_FFT_BIGTAB'          => 'off',
 88 'NTL_FFT_LAZYMUL'         => 'off',
 89 'NTL_TBL_REM'             => 'off',
 90 'NTL_CRT_ALTCODE'         => 'off',
 91 'NTL_CRT_ALTCODE_SMALL'   => 'off',
 92 'NTL_GF2X_NOINLINE'       => 'off',
 93 'NTL_GF2X_ALTCODE'        => 'off',
 94 'NTL_GF2X_ALTCODE1'       => 'off',
 95 
 96 
 97 );
```

What makes me thing that it might be AVX512 related, is that we haven't encountered this before. Github workflows is the only place where I encountered processors capable of AVX512.



---

archive/issue_comments_414813.json:
```json
{
    "body": "<a id='comment:16'></a>I agree that `NTL_AVOID_AVX512` is a top suspect here. \nPerhaps it can be passed to `configure`, like we already pass `NATIVE=off` when `SAGE_FAT_BINARY=yes`?",
    "created_at": "2020-12-29T18:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414813",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>I agree that `NTL_AVOID_AVX512` is a top suspect here. 
Perhaps it can be passed to `configure`, like we already pass `NATIVE=off` when `SAGE_FAT_BINARY=yes`?



---

archive/issue_comments_414814.json:
```json
{
    "body": "<a id='comment:17'></a>Ok. Lets try that. How do I test it? Do I just start the cygwin actions with that? What tickets do I need to pull yet?\n  \n---\nNew commits:",
    "created_at": "2020-12-29T21:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414814",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>Ok. Lets try that. How do I test it? Do I just start the cygwin actions with that? What tickets do I need to pull yet?
  
---
New commits:



---

archive/issue_comments_414815.json:
```json
{
    "body": "<a id='comment:18'></a>Run it with #31064 (or #29152)",
    "created_at": "2020-12-29T21:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414815",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Run it with #31064 (or #29152)



---

archive/issue_comments_414816.json:
```json
{
    "body": "<a id='comment:19'></a>https://github.com/kliem/sage/actions/runs/451492157",
    "created_at": "2020-12-29T21:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414816",
    "user": "https://github.com/kliem"
}
```

<a id='comment:19'></a>https://github.com/kliem/sage/actions/runs/451492157



---

archive/issue_comments_414817.json:
```json
{
    "body": "<a id='comment:20'></a>iii-a already failed. Is this permanent? Should I just rerun?\n\nhttps://github.com/kliem/sage/runs/1625789472?check_suite_focus=true",
    "created_at": "2020-12-31T09:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414817",
    "user": "https://github.com/kliem"
}
```

<a id='comment:20'></a>iii-a already failed. Is this permanent? Should I just rerun?

https://github.com/kliem/sage/runs/1625789472?check_suite_focus=true



---

archive/issue_comments_414818.json:
```json
{
    "body": "<a id='comment:21'></a>Hm. This failure is from `fpylll` - I have created #31146 for this.\n\nNote that `cygwin-standard` does not build `ntl` because it finds the package provided by `cygwin`. Would need to test `cygwin-minimal`",
    "created_at": "2021-01-01T20:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414818",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>Hm. This failure is from `fpylll` - I have created #31146 for this.

Note that `cygwin-standard` does not build `ntl` because it finds the package provided by `cygwin`. Would need to test `cygwin-minimal`



---

archive/issue_comments_414819.json:
```json
{
    "body": "<a id='comment:22'></a>ok, I started cygwin-minimal.\n\nBut now I'm confused. How does this relate to the ticket description?\n\nBy default the github workflow does not set `SAGE_FAT_BINARY` it seems, so of course one cannot use it locally.",
    "created_at": "2021-01-01T21:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414819",
    "user": "https://github.com/kliem"
}
```

<a id='comment:22'></a>ok, I started cygwin-minimal.

But now I'm confused. How does this relate to the ticket description?

By default the github workflow does not set `SAGE_FAT_BINARY` it seems, so of course one cannot use it locally.



---

archive/issue_comments_414820.json:
```json
{
    "body": "<a id='comment:23'></a>Looks like the ticket description is outdated and cygwin's ntl package is accepted in current sage.",
    "created_at": "2021-01-01T21:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414820",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Looks like the ticket description is outdated and cygwin's ntl package is accepted in current sage.



---

archive/issue_comments_414821.json:
```json
{
    "body": "<a id='comment:24'></a>This is also related to [this issue](https://github.com/sagemath/sage-windows/issues/53) with Sage Windows, due to the fact that the NTL package for Cygwin is not built with `NATIVE=off` (and I was building Sage with the system package).\n\nI reported the issue to the package maintainer who has rebuilt the package: https://cygwin.com/pipermail/cygwin/2020-December/247206.html",
    "created_at": "2021-01-05T09:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414821",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>This is also related to [this issue](https://github.com/sagemath/sage-windows/issues/53) with Sage Windows, due to the fact that the NTL package for Cygwin is not built with `NATIVE=off` (and I was building Sage with the system package).

I reported the issue to the package maintainer who has rebuilt the package: https://cygwin.com/pipermail/cygwin/2020-December/247206.html



---

archive/issue_comments_414822.json:
```json
{
    "body": "<a id='comment:25'></a>I have encountered a similar problem again on Cygwin. This time it seems to come from OpenBLAS. \n\nThe Cygwin build takes place in multiple stages, passing on partial builds of $SAGE_LOCAL to the next stages via artifacts.\nI have now seen several instances (latest: \nin which the artifacts contain native instructions that lead to SIGILL on use in the next stage.\n\nFor example, in https://github.com/mkoeppe/sage/runs/2029013426?check_suite_focus=true aborts early in the sagelib build. On a local machine I can reproduce it as well by downloading the artifact. Using `gdb` it can be seen that merely importing some `numpy` modules already gives `SIGILL`.\n\nPerhaps the latest change to OpenBLAS in #22179 needs revisiting.",
    "created_at": "2021-03-04T17:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414822",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>I have encountered a similar problem again on Cygwin. This time it seems to come from OpenBLAS. 

The Cygwin build takes place in multiple stages, passing on partial builds of $SAGE_LOCAL to the next stages via artifacts.
I have now seen several instances (latest: 
in which the artifacts contain native instructions that lead to SIGILL on use in the next stage.

For example, in https://github.com/mkoeppe/sage/runs/2029013426?check_suite_focus=true aborts early in the sagelib build. On a local machine I can reproduce it as well by downloading the artifact. Using `gdb` it can be seen that merely importing some `numpy` modules already gives `SIGILL`.

Perhaps the latest change to OpenBLAS in #22179 needs revisiting.



---

archive/issue_comments_414823.json:
```json
{
    "body": "<a id='comment:26'></a>Testing with revert of #22179 (for Cygwin) in https://github.com/mkoeppe/sage/actions/runs/628022275",
    "created_at": "2021-03-06T20:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414823",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Testing with revert of #22179 (for Cygwin) in https://github.com/mkoeppe/sage/actions/runs/628022275



---

archive/issue_comments_414824.json:
```json
{
    "body": "<a id='comment:27'></a>This might also be related to https://github.com/sagemath/sage-windows/issues/57\n\nNTL is working now on sage-windows, but I suspect there is a portability issue with OpenBLAS (thought it is resulting in segfaults, apparently, not illegal instructions).",
    "created_at": "2021-03-08T13:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414824",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>This might also be related to https://github.com/sagemath/sage-windows/issues/57

NTL is working now on sage-windows, but I suspect there is a portability issue with OpenBLAS (thought it is resulting in segfaults, apparently, not illegal instructions).



---

archive/issue_comments_414825.json:
```json
{
    "body": "<a id='comment:28'></a>Thanks for the pointer. \n\nEven with reverting #22179 (for Cygwin), I'm still getting SIGILL, but (apparently) from numpy itself, in `PyInit__multiarray_umath`. It should be checked if numpy is somehow configuring itself using different CFLAGS",
    "created_at": "2021-03-08T13:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414825",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Thanks for the pointer. 

Even with reverting #22179 (for Cygwin), I'm still getting SIGILL, but (apparently) from numpy itself, in `PyInit__multiarray_umath`. It should be checked if numpy is somehow configuring itself using different CFLAGS



---

archive/issue_comments_414826.json:
```json
{
    "body": "<a id='comment:29'></a>I think we may have to use `-march=...` explicitly to fix numpy",
    "created_at": "2021-03-09T08:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414826",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>I think we may have to use `-march=...` explicitly to fix numpy



---

archive/issue_comments_414827.json:
```json
{
    "body": "<a id='comment:30'></a>https://github.com/numpy/numpy/blob/cb557b79fa0ce467c881830f8e8e042c484ccfaa/doc/source/reference/simd/simd-optimizations.rst\n\nThis is the page to look at, I guess. If I understand correctly, we need to build numpy with `--cpu-baseline=NONE` if `SAGE_FAT_BINARY`.",
    "created_at": "2021-03-09T11:06:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414827",
    "user": "https://github.com/kliem"
}
```

<a id='comment:30'></a>https://github.com/numpy/numpy/blob/cb557b79fa0ce467c881830f8e8e042c484ccfaa/doc/source/reference/simd/simd-optimizations.rst

This is the page to look at, I guess. If I understand correctly, we need to build numpy with `--cpu-baseline=NONE` if `SAGE_FAT_BINARY`.



---

archive/issue_comments_414828.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 gh-kliem]:\n> https://github.com/numpy/numpy/blob/cb557b79fa0ce467c881830f8e8e042c484ccfaa/doc/source/reference/simd/simd-optimizations.rst\n> \n> This is the page to look at, I guess. If I understand correctly, we need to build numpy with `--cpu-baseline=NONE` if `SAGE_FAT_BINARY`.\n\n\nThanks for finding that.  I knew about the new SIMD stuff in Numpy, but not about the new associated compilation options (nor the fact that we weren't using them yet).\n\nI think `--cpu-baseline=MIN` should also be good-enough to run on the vast, vast majority of machines that are modern enough to even be capable of running Sage.\n\nWe should also look into `--cpu-dispatch`.  It will result in larger binaries, but IIUC will allow Numpy to perform runtime CPU feature detection and call the correct implementations.",
    "created_at": "2021-03-09T15:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414828",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>Replying to [comment:30 gh-kliem]:
> https://github.com/numpy/numpy/blob/cb557b79fa0ce467c881830f8e8e042c484ccfaa/doc/source/reference/simd/simd-optimizations.rst
> 
> This is the page to look at, I guess. If I understand correctly, we need to build numpy with `--cpu-baseline=NONE` if `SAGE_FAT_BINARY`.


Thanks for finding that.  I knew about the new SIMD stuff in Numpy, but not about the new associated compilation options (nor the fact that we weren't using them yet).

I think `--cpu-baseline=MIN` should also be good-enough to run on the vast, vast majority of machines that are modern enough to even be capable of running Sage.

We should also look into `--cpu-dispatch`.  It will result in larger binaries, but IIUC will allow Numpy to perform runtime CPU feature detection and call the correct implementations.



---

archive/issue_comments_414829.json:
```json
{
    "body": "<a id='comment:32'></a>I agree that we should consider `--cpu-dispatch` for our binaries.\n\nI don't think `--cpu-baseline=MIN` will work. If compiled on an `x86` this will return `SSE SSE2`, but that won't work on apples M1.\n\nThe problem is that `--cpu-baseline=MIN` still assumes a similar architecture.",
    "created_at": "2021-03-09T15:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414829",
    "user": "https://github.com/kliem"
}
```

<a id='comment:32'></a>I agree that we should consider `--cpu-dispatch` for our binaries.

I don't think `--cpu-baseline=MIN` will work. If compiled on an `x86` this will return `SSE SSE2`, but that won't work on apples M1.

The problem is that `--cpu-baseline=MIN` still assumes a similar architecture.



---

archive/issue_comments_414830.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 gh-kliem]:\n> I don't think `--cpu-baseline=MIN` will work. If compiled on an `x86` this will return `SSE SSE2`, but that won't work on apples M1.\n> \n> The problem is that `--cpu-baseline=MIN` still assumes a similar architecture.\n\n\nI don't think that's true.  If you look at the docs you linked, the meaning of baseline=MIN is architecture-dependent.  It won't enable features that are not relevant for the target architecture.\n\nOf course, that means we need to build Sage binaries for aarch64 but that's already the case anyways I assume.",
    "created_at": "2021-03-09T15:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414830",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>Replying to [comment:32 gh-kliem]:
> I don't think `--cpu-baseline=MIN` will work. If compiled on an `x86` this will return `SSE SSE2`, but that won't work on apples M1.
> 
> The problem is that `--cpu-baseline=MIN` still assumes a similar architecture.


I don't think that's true.  If you look at the docs you linked, the meaning of baseline=MIN is architecture-dependent.  It won't enable features that are not relevant for the target architecture.

Of course, that means we need to build Sage binaries for aarch64 but that's already the case anyways I assume.



---

archive/issue_comments_414831.json:
```json
{
    "body": "<a id='comment:34'></a>Let's ignore the harder problem of building universal binaries that work on both `x86_64` and `arm`.\n\nUsing `--cpu-dispatch` when `SAGE_FAT_BINARY` is set sounds like the right solution. Could one of you prepare a branch please?",
    "created_at": "2021-03-09T19:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414831",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>Let's ignore the harder problem of building universal binaries that work on both `x86_64` and `arm`.

Using `--cpu-dispatch` when `SAGE_FAT_BINARY` is set sounds like the right solution. Could one of you prepare a branch please?



---

archive/issue_comments_414832.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-03-09T19:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414832",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_414833.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-09T20:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_414834.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-09T20:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414835.json:
```json
{
    "body": "<a id='comment:40'></a>I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)\nand I am still getting SIGSEGVs from plotting and SIGILLs",
    "created_at": "2021-03-10T18:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414835",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)
and I am still getting SIGSEGVs from plotting and SIGILLs



---

archive/issue_comments_414836.json:
```json
{
    "body": "<a id='comment:41'></a>Erik, in https://groups.google.com/g/sage-devel/c/s_inhvSxLp8/m/Vtb35oYcAgAJ you say you have fixed it in the windows binary build --- what's the solution?",
    "created_at": "2021-03-10T18:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414836",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>Erik, in https://groups.google.com/g/sage-devel/c/s_inhvSxLp8/m/Vtb35oYcAgAJ you say you have fixed it in the windows binary build --- what's the solution?



---

archive/issue_comments_414837.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:41 mkoeppe]:\n> Erik, in https://groups.google.com/g/sage-devel/c/s_inhvSxLp8/m/Vtb35oYcAgAJ you say you have fixed it in the windows binary build --- what's the solution?\n\n\nThe issue on the NTL side was fixed: https://github.com/sagemath/sage-windows/issues/53\n\nThe solution was to not use the NTL package from Cygwin and custom compile it instead.\n\nI also brought the issue up with the package maintainer: https://cygwin.com/pipermail/cygwin/2020-December/247196.html\n\nHe has released a new version of the package to address it: https://cygwin.com/pipermail/cygwin/2020-December/247205.html\n\nHe still rebuilt it, with my perhaps fault suggestion of including `CXXFLAGS=-mavx`, which others have rightfully pointed out will still make it less portable, though I think that's how I built it as well.\n\nHe released another new NTL package in January but I'm not sure whether or not it changes anything about this: https://cygwin.com/pipermail/cygwin/2021-January/247439.html\n\nThe NTL fix definitely worked for some, but others are still reporting segfaults in plotting, so I think that has to do either with OpenBLAS or Numpy, but I haven't been able to gather enough details: https://github.com/sagemath/sage-windows/issues/57",
    "created_at": "2021-03-12T11:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414837",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>Replying to [comment:41 mkoeppe]:
> Erik, in https://groups.google.com/g/sage-devel/c/s_inhvSxLp8/m/Vtb35oYcAgAJ you say you have fixed it in the windows binary build --- what's the solution?


The issue on the NTL side was fixed: https://github.com/sagemath/sage-windows/issues/53

The solution was to not use the NTL package from Cygwin and custom compile it instead.

I also brought the issue up with the package maintainer: https://cygwin.com/pipermail/cygwin/2020-December/247196.html

He has released a new version of the package to address it: https://cygwin.com/pipermail/cygwin/2020-December/247205.html

He still rebuilt it, with my perhaps fault suggestion of including `CXXFLAGS=-mavx`, which others have rightfully pointed out will still make it less portable, though I think that's how I built it as well.

He released another new NTL package in January but I'm not sure whether or not it changes anything about this: https://cygwin.com/pipermail/cygwin/2021-January/247439.html

The NTL fix definitely worked for some, but others are still reporting segfaults in plotting, so I think that has to do either with OpenBLAS or Numpy, but I haven't been able to gather enough details: https://github.com/sagemath/sage-windows/issues/57



---

archive/issue_comments_414838.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:40 mkoeppe]:\n> I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)\n> and I am still getting SIGSEGVs from plotting and SIGILLs \n\n\nDo we know anything about the CPU architecture of the machines these builds are being run on?  I looked through the logs but didn't find anything.  It might be helpful to add a `cat /proc/cpuinfo` somewhere.",
    "created_at": "2021-03-12T11:59:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414838",
    "user": "https://github.com/embray"
}
```

<a id='comment:43'></a>Replying to [comment:40 mkoeppe]:
> I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)
> and I am still getting SIGSEGVs from plotting and SIGILLs 


Do we know anything about the CPU architecture of the machines these builds are being run on?  I looked through the logs but didn't find anything.  It might be helpful to add a `cat /proc/cpuinfo` somewhere.



---

archive/issue_comments_414839.json:
```json
{
    "body": "<a id='comment:44'></a>Possibly related but I'm not sure since others are reporting it's fixed in 1.19.4.  I didn't know Numpy was now installing its own copies of libraries in `numpy.libs` when you install from a wheel.  I don't think that should be affecting Sage, but it's worth a look: https://github.com/numpy/numpy/issues/17674",
    "created_at": "2021-03-12T12:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414839",
    "user": "https://github.com/embray"
}
```

<a id='comment:44'></a>Possibly related but I'm not sure since others are reporting it's fixed in 1.19.4.  I didn't know Numpy was now installing its own copies of libraries in `numpy.libs` when you install from a wheel.  I don't think that should be affecting Sage, but it's worth a look: https://github.com/numpy/numpy/issues/17674



---

archive/issue_comments_414840.json:
```json
{
    "body": "<a id='comment:45'></a>Worth a look in part because Numpy with OpenBLAS 0.3.12 was causing segfaults, so they reverted to OpenBLAS 0.3.9: https://github.com/numpy/numpy/pull/17680 \n\nWe are using 0.3.13 which might also have problems with Numpy, though I wish I had more insight into what those problems actually are.",
    "created_at": "2021-03-12T12:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414840",
    "user": "https://github.com/embray"
}
```

<a id='comment:45'></a>Worth a look in part because Numpy with OpenBLAS 0.3.12 was causing segfaults, so they reverted to OpenBLAS 0.3.9: https://github.com/numpy/numpy/pull/17680 

We are using 0.3.13 which might also have problems with Numpy, though I wish I had more insight into what those problems actually are.



---

archive/issue_comments_414841.json:
```json
{
    "body": "<a id='comment:46'></a>Many seem to have suggested it might have to do with OpenBLAS threading.  Could we try setting `export OPENBLAS_NUM_THREADS=1` and see if it makes any difference?",
    "created_at": "2021-03-12T12:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414841",
    "user": "https://github.com/embray"
}
```

<a id='comment:46'></a>Many seem to have suggested it might have to do with OpenBLAS threading.  Could we try setting `export OPENBLAS_NUM_THREADS=1` and see if it makes any difference?



---

archive/issue_comments_414842.json:
```json
{
    "body": "<a id='comment:47'></a>Alas, Sage 9.2 has OpenBLAS 0.3.9, so I guess this is not directly related to the people reporting this against Sage 9.2 for Windows :/",
    "created_at": "2021-03-12T12:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414842",
    "user": "https://github.com/embray"
}
```

<a id='comment:47'></a>Alas, Sage 9.2 has OpenBLAS 0.3.9, so I guess this is not directly related to the people reporting this against Sage 9.2 for Windows :/



---

archive/issue_comments_414843.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:46 embray]:\n> Many seem to have suggested it might have to do with OpenBLAS threading.  Could we try setting `export OPENBLAS_NUM_THREADS=1` and see if it makes any difference?\n\n\nWe already set this in `src/bin/sage-env`",
    "created_at": "2021-03-12T16:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414843",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>Replying to [comment:46 embray]:
> Many seem to have suggested it might have to do with OpenBLAS threading.  Could we try setting `export OPENBLAS_NUM_THREADS=1` and see if it makes any difference?


We already set this in `src/bin/sage-env`



---

archive/issue_comments_414844.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-12T16:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414845.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:43 embray]:\n> Replying to [comment:40 mkoeppe]:\n> > I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)\n> > and I am still getting SIGSEGVs from plotting and SIGILLs \n\n> \n> Do we know anything about the CPU architecture of the machines these builds are being run on? \n\n\nOnly that it varies even within one run.\n\n> I looked through the logs but didn't find anything.  It might be helpful to add a `cat /proc/cpuinfo` somewhere.\n\n\nI have added it at the beginning of each job",
    "created_at": "2021-03-12T16:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414845",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>Replying to [comment:43 embray]:
> Replying to [comment:40 mkoeppe]:
> > I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)
> > and I am still getting SIGSEGVs from plotting and SIGILLs 

> 
> Do we know anything about the CPU architecture of the machines these builds are being run on? 


Only that it varies even within one run.

> I looked through the logs but didn't find anything.  It might be helpful to add a `cat /proc/cpuinfo` somewhere.


I have added it at the beginning of each job



---

archive/issue_comments_414846.json:
```json
{
    "body": "<a id='comment:51'></a>Replying to [comment:42 embray]:\n> The issue on the NTL side was fixed: https://github.com/sagemath/sage-windows/issues/53\n> \n> The solution was to not use the NTL package from Cygwin and custom compile it instead.\n> \n> I also brought the issue up with the package maintainer: [...]\n> He released another new NTL package in January but I'm not sure whether or not it changes anything about this: https://cygwin.com/pipermail/cygwin/2021-January/247439.html\n> \n> The NTL fix definitely worked for some [...]\n\n\nThanks a lot for the details on NTL. I haven't seen the NTL-related failures in a while, so let's assume it is fixed by the changes to the Cygwin package.  (But unrelated issues currently block the `cygwin-minimal` build -- so we cannot be sure yet that our NTL works in this configuration.)",
    "created_at": "2021-03-12T16:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414846",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>Replying to [comment:42 embray]:
> The issue on the NTL side was fixed: https://github.com/sagemath/sage-windows/issues/53
> 
> The solution was to not use the NTL package from Cygwin and custom compile it instead.
> 
> I also brought the issue up with the package maintainer: [...]
> He released another new NTL package in January but I'm not sure whether or not it changes anything about this: https://cygwin.com/pipermail/cygwin/2021-January/247439.html
> 
> The NTL fix definitely worked for some [...]


Thanks a lot for the details on NTL. I haven't seen the NTL-related failures in a while, so let's assume it is fixed by the changes to the Cygwin package.  (But unrelated issues currently block the `cygwin-minimal` build -- so we cannot be sure yet that our NTL works in this configuration.)



---

archive/issue_comments_414847.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-12T21:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414848.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-12T21:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414848",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_414849.json:
```json
{
    "body": "<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-12T21:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414849",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414850.json:
```json
{
    "body": "<a id='comment:58'></a>In https://github.com/mkoeppe/sage/runs/2099002937?check_suite_focus=true I see a build failure:\n\n```\n  ...\n  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatm6_: symbol not defined\n  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatm6_: symbol not defined\n  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatme_: symbol not defined\n  ...\n```",
    "created_at": "2021-03-13T06:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414850",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>In https://github.com/mkoeppe/sage/runs/2099002937?check_suite_focus=true I see a build failure:

```
  ...
  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatm6_: symbol not defined
  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatm6_: symbol not defined
  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatme_: symbol not defined
  ...
```



---

archive/issue_comments_414851.json:
```json
{
    "body": "<a id='comment:59'></a>The full log does not reveal a specific error message, but building one object fails, it looks like gcc crashes. \n\nAnd in a second attempt in the same run, the build succeeds.",
    "created_at": "2021-03-13T06:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414851",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>The full log does not reveal a specific error message, but building one object fails, it looks like gcc crashes. 

And in a second attempt in the same run, the build succeeds.



---

archive/issue_comments_414852.json:
```json
{
    "body": "Attachment [openblas-0.3.13.log](tarball://root/attachments/some-uuid/ticket29537/openblas-0.3.13.log) by @mkoeppe created at 2021-03-13 16:54:32",
    "created_at": "2021-03-13T16:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414852",
    "user": "https://github.com/mkoeppe"
}
```

Attachment [openblas-0.3.13.log](tarball://root/attachments/some-uuid/ticket29537/openblas-0.3.13.log) by @mkoeppe created at 2021-03-13 16:54:32



---

archive/issue_comments_414853.json:
```json
{
    "body": "<a id='comment:60'></a>Upon restarting the workflow, the `openblas` build succeeds without issues. \nRunning into rebasing issues again (haven't seen this in a while!) https://github.com/mkoeppe/sage/runs/2103478775?check_suite_focus=true\n\n```\n  [pillow-8.0.1]         0 [main] python3 47699 child_info_fork::abort: address space needed by 'Scanners.cpython-38-x86_64-cygwin.dll' (0x400000) is already occupied\n  [pillow-8.0.1]         0 [main] python3 47700 child_info_fork::abort: address space needed by 'Scanners.cpython-38-x86_64-cygwin.dll' (0x400000) is already occupied\n```",
    "created_at": "2021-03-13T20:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414853",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>Upon restarting the workflow, the `openblas` build succeeds without issues. 
Running into rebasing issues again (haven't seen this in a while!) https://github.com/mkoeppe/sage/runs/2103478775?check_suite_focus=true

```
  [pillow-8.0.1]         0 [main] python3 47699 child_info_fork::abort: address space needed by 'Scanners.cpython-38-x86_64-cygwin.dll' (0x400000) is already occupied
  [pillow-8.0.1]         0 [main] python3 47700 child_info_fork::abort: address space needed by 'Scanners.cpython-38-x86_64-cygwin.dll' (0x400000) is already occupied
```



---

archive/issue_comments_414854.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-14T20:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414854",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414855.json:
```json
{
    "body": "<a id='comment:62'></a>That's weird.  `Scanners.cpython-38-x86_64-cygwin.dll` is part of Cython.  This suggests that rebase failed after installing Cython, or possibly that Cython had just been installed but the rebase lock was still held.  It doesn't look that way from the logs though; I would have thought Cython was installed in an earlier stage.",
    "created_at": "2021-03-17T16:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414855",
    "user": "https://github.com/embray"
}
```

<a id='comment:62'></a>That's weird.  `Scanners.cpython-38-x86_64-cygwin.dll` is part of Cython.  This suggests that rebase failed after installing Cython, or possibly that Cython had just been installed but the rebase lock was still held.  It doesn't look that way from the logs though; I would have thought Cython was installed in an earlier stage.



---

archive/issue_comments_414856.json:
```json
{
    "body": "<a id='comment:63'></a>From the logs from the previous stage of that run:\n\n```\nCopying package files from temporary location /opt/sage-461876e6c77b59756ad9db557c884486eb40881e/var/tmp/sage/build/cython-0.29.21/inst to /opt/sage-461876e6c77b59756ad9db557c884486eb40881e\nWaiting for rebase lock\nGetting list of dlls. This may take a while...\nNow rebasing...\nSuccessfully installed cython-0.29.21\n```\n\nSo that's mysterious.",
    "created_at": "2021-03-17T16:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414856",
    "user": "https://github.com/embray"
}
```

<a id='comment:63'></a>From the logs from the previous stage of that run:

```
Copying package files from temporary location /opt/sage-461876e6c77b59756ad9db557c884486eb40881e/var/tmp/sage/build/cython-0.29.21/inst to /opt/sage-461876e6c77b59756ad9db557c884486eb40881e
Waiting for rebase lock
Getting list of dlls. This may take a while...
Now rebasing...
Successfully installed cython-0.29.21
```

So that's mysterious.



---

archive/issue_comments_414857.json:
```json
{
    "body": "<a id='comment:64'></a>Thanks for looking into this -- I really need your expertise here! \n\nI run rebasing at the end of `.github/workflows/extract-sage-local.sh` - to make sure that the downloaded stages that have been built in parallel can work together.",
    "created_at": "2021-03-17T16:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414857",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>Thanks for looking into this -- I really need your expertise here! 

I run rebasing at the end of `.github/workflows/extract-sage-local.sh` - to make sure that the downloaded stages that have been built in parallel can work together.



---

archive/issue_comments_414858.json:
```json
{
    "body": "<a id='comment:65'></a>On [this build](https://github.com/mkoeppe/sage/runs/2129378838?check_suite_focus=true) I notice during \"Extract sage-local artifact\":\n\n```\nFilesystem       Size  Used Avail Use% Mounted on\nC:/tools/cygwin  256G  170G   86G  67% /\nD:                14G  2.2G   12G  16% /cygdrive/d\nGetting list of dlls. This may take a while...\nNow rebasing...\nrebaseall: only ash or dash processes are allowed during rebasing\n    Exit all Cygwin processes and stop all Cygwin services.\n    Execute ash (or dash) from Start/Run... or a cmd or command window.\n    Execute '/bin/rebaseall' from ash (or dash).\nError: Process completed with exit code 1.\n```\n\nIf you want to do a full rebase in this step it can't be called from a shell script run with /bin/bash.  The script either needs to be run with dash, or as a separate command with dash.",
    "created_at": "2021-03-17T16:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414858",
    "user": "https://github.com/embray"
}
```

<a id='comment:65'></a>On [this build](https://github.com/mkoeppe/sage/runs/2129378838?check_suite_focus=true) I notice during "Extract sage-local artifact":

```
Filesystem       Size  Used Avail Use% Mounted on
C:/tools/cygwin  256G  170G   86G  67% /
D:                14G  2.2G   12G  16% /cygdrive/d
Getting list of dlls. This may take a while...
Now rebasing...
rebaseall: only ash or dash processes are allowed during rebasing
    Exit all Cygwin processes and stop all Cygwin services.
    Execute ash (or dash) from Start/Run... or a cmd or command window.
    Execute '/bin/rebaseall' from ash (or dash).
Error: Process completed with exit code 1.
```

If you want to do a full rebase in this step it can't be called from a shell script run with /bin/bash.  The script either needs to be run with dash, or as a separate command with dash.



---

archive/issue_comments_414859.json:
```json
{
    "body": "<a id='comment:66'></a>Yes, in this run I tried to fix the problem by changing to `rebaseall`...",
    "created_at": "2021-03-17T16:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414859",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>Yes, in this run I tried to fix the problem by changing to `rebaseall`...



---

archive/issue_comments_414860.json:
```json
{
    "body": "<a id='comment:67'></a>Replying to [comment:66 mkoeppe]:\n> Yes, in this run I tried to fix the problem by changing to `rebaseall`...\n\n\nAh, OK.  I think that's a good idea.  It just needs to be run outside a Cygwin process with no other Cygwin processes running (since it can also modify the cygwin DLL itself and other support libraries that are not normally touched by plain `rebase`).",
    "created_at": "2021-03-17T16:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414860",
    "user": "https://github.com/embray"
}
```

<a id='comment:67'></a>Replying to [comment:66 mkoeppe]:
> Yes, in this run I tried to fix the problem by changing to `rebaseall`...


Ah, OK.  I think that's a good idea.  It just needs to be run outside a Cygwin process with no other Cygwin processes running (since it can also modify the cygwin DLL itself and other support libraries that are not normally touched by plain `rebase`).



---

archive/issue_comments_414861.json:
```json
{
    "body": "<a id='comment:68'></a>Is this the cygwin `dash` that should be used?",
    "created_at": "2021-03-17T16:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414861",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>Is this the cygwin `dash` that should be used?



---

archive/issue_comments_414862.json:
```json
{
    "body": "<a id='comment:69'></a>Yes, or you can just call `C:\\cygwin64\\bin\\rebaseall` directly without going through a shell, I think.",
    "created_at": "2021-03-17T17:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414862",
    "user": "https://github.com/embray"
}
```

<a id='comment:69'></a>Yes, or you can just call `C:\cygwin64\bin\rebaseall` directly without going through a shell, I think.



---

archive/issue_comments_414863.json:
```json
{
    "body": "<a id='comment:70'></a>Right, but I want to keep it in the extraction script so that it is easy to use manually too",
    "created_at": "2021-03-17T18:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414863",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>Right, but I want to keep it in the extraction script so that it is easy to use manually too



---

archive/issue_comments_414864.json:
```json
{
    "body": "<a id='comment:71'></a>OK, testing with dash at https://github.com/mkoeppe/sage/actions/runs/662065807",
    "created_at": "2021-03-17T18:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414864",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>OK, testing with dash at https://github.com/mkoeppe/sage/actions/runs/662065807



---

archive/issue_comments_414865.json:
```json
{
    "body": "<a id='comment:72'></a>This worked! https://github.com/mkoeppe/sage/runs/2134463553\n\nI'll push the fixes to this ticket.",
    "created_at": "2021-03-17T21:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414865",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>This worked! https://github.com/mkoeppe/sage/runs/2134463553

I'll push the fixes to this ticket.



---

archive/issue_comments_414866.json:
```json
{
    "body": "<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-17T22:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414867.json:
```json
{
    "body": "<a id='comment:74'></a>Now testing at https://github.com/mkoeppe/sage/actions/runs/662602246",
    "created_at": "2021-03-17T22:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414867",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'></a>Now testing at https://github.com/mkoeppe/sage/actions/runs/662602246



---

archive/issue_comments_414868.json:
```json
{
    "body": "<a id='comment:75'></a>With the rebasing fixes applied, I am getting again to `sage-iii` (https://github.com/mkoeppe/sage/runs/2140904387?check_suite_focus=true)\n\n```\n  [sagelib-9.3.beta9]   Generating auto-generated sources\n  [sagelib-9.3.beta9]   Building interpreters for fast_callable\n  [sagelib-9.3.beta9]   -> First build of interpreters\n  [sagelib-9.3.beta9]   running build_cython\n  [sagelib-9.3.beta9]   Enabling Cython debugging support\n  [sagelib-9.3.beta9]   /cygdrive/d/a/sage/sage/build/pkgs/sagelib/spkg-install: line 58: 61038 Illegal instruction     (core dumped) python3 -u setup.py --no-user-cfg build install\n```\nwhich is again coming from `numpy`, I think.\nHelp....",
    "created_at": "2021-03-18T22:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414868",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>With the rebasing fixes applied, I am getting again to `sage-iii` (https://github.com/mkoeppe/sage/runs/2140904387?check_suite_focus=true)

```
  [sagelib-9.3.beta9]   Generating auto-generated sources
  [sagelib-9.3.beta9]   Building interpreters for fast_callable
  [sagelib-9.3.beta9]   -> First build of interpreters
  [sagelib-9.3.beta9]   running build_cython
  [sagelib-9.3.beta9]   Enabling Cython debugging support
  [sagelib-9.3.beta9]   /cygdrive/d/a/sage/sage/build/pkgs/sagelib/spkg-install: line 58: 61038 Illegal instruction     (core dumped) python3 -u setup.py --no-user-cfg build install
```
which is again coming from `numpy`, I think.
Help....



---

archive/issue_comments_414869.json:
```json
{
    "body": "<a id='comment:76'></a>But the current branch is already an improvement, so let's get this in...",
    "created_at": "2021-03-19T03:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414869",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'></a>But the current branch is already an improvement, so let's get this in...



---

archive/issue_comments_414870.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-19T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414870",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414871.json:
```json
{
    "body": "<a id='comment:77'></a>LGTM.",
    "created_at": "2021-03-19T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414871",
    "user": "https://github.com/kliem"
}
```

<a id='comment:77'></a>LGTM.



---

archive/issue_comments_414872.json:
```json
{
    "body": "<a id='comment:78'></a>Thanks!",
    "created_at": "2021-03-19T15:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414872",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'></a>Thanks!



---

archive/issue_comments_414873.json:
```json
{
    "body": "<a id='comment:79'></a>Follow-up in #31521",
    "created_at": "2021-03-19T16:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414873",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:79'></a>Follow-up in #31521



---

archive/issue_comments_414874.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-03-20T15:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414874",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_414875.json:
```json
{
    "body": "<a id='comment:80'></a>Merge conflict\n\n```\n    STDOUT: Auto-merging tox.ini\n    STDOUT: Auto-merging .github/workflows/ci-cygwin-standard.yml\n    STDOUT: CONFLICT (content): Merge conflict in .github/workflows/ci-cygwin-standard.yml\n    STDOUT: Auto-merging .github/workflows/ci-cygwin-minimal.yml\n    STDOUT: CONFLICT (content): Merge conflict in .github/workflows/ci-cygwin-minimal.yml\n    STDOUT: Automatic merge failed; fix conflicts and then commit the result.\n```",
    "created_at": "2021-03-20T15:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414875",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:80'></a>Merge conflict

```
    STDOUT: Auto-merging tox.ini
    STDOUT: Auto-merging .github/workflows/ci-cygwin-standard.yml
    STDOUT: CONFLICT (content): Merge conflict in .github/workflows/ci-cygwin-standard.yml
    STDOUT: Auto-merging .github/workflows/ci-cygwin-minimal.yml
    STDOUT: CONFLICT (content): Merge conflict in .github/workflows/ci-cygwin-minimal.yml
    STDOUT: Automatic merge failed; fix conflicts and then commit the result.
```



---

archive/issue_comments_414876.json:
```json
{
    "body": "<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-20T16:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414877.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-03-20T16:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414877",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_075380.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-22T23:54:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29537#event-75380"
}
```



---

archive/issue_comments_414878.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-22T23:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29537#issuecomment-414878",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
