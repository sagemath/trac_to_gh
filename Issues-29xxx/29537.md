# Issue 29537: build not portable despite using SAGE_FAT_BINARY=yes, NTL/openblas/numpy-related

archive/issues_029300.json:
```json
{
    "body": "We fix several issues involving `SAGE_FAT_BINARY`:\n\n- `numpy` intrinsics need a special build flag in this mode\n\n- `ntl` needs to disable use of a problematic instruction set\n\n- After #31064, the GH Actions tests for `cygwin` did not pass SAGE_FAT_BINARY to the actual build, randomly causing SIGILLs when a partial build was passed to the next stage through the `sage-local` artifact\n\n\n\nDepends on #31493\n\n**CC:**  @dimpase @orlitzky @kiwifb @embray @darijgr @tscrim @kliem @seblabbe\n\n**Keywords:** sd111\n\n**Branch/Commit:** [d6dced2457b7c3a6b645f2e56b9ca44c4b09e437](https://github.com/sagemath/sagetrac-mirror/commit/d6dced2457b7c3a6b645f2e56b9ca44c4b09e437)\n\n**Reviewer:** Matthias Koeppe, Jonathan Kliem\n\n**Author:** Jonathan Kliem, Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/29537\n\n",
    "closed_at": "2021-03-22T23:54:13Z",
    "created_at": "2020-04-20T07:47:56Z",
    "labels": [
        "component: porting",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "title": "build not portable despite using SAGE_FAT_BINARY=yes, NTL/openblas/numpy-related",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/29537",
    "user": "https://github.com/mkoeppe"
}
```
We fix several issues involving `SAGE_FAT_BINARY`:

- `numpy` intrinsics need a special build flag in this mode

- `ntl` needs to disable use of a problematic instruction set

- After #31064, the GH Actions tests for `cygwin` did not pass SAGE_FAT_BINARY to the actual build, randomly causing SIGILLs when a partial build was passed to the next stage through the `sage-local` artifact



Depends on #31493

**CC:**  @dimpase @orlitzky @kiwifb @embray @darijgr @tscrim @kliem @seblabbe

**Keywords:** sd111

**Branch/Commit:** [d6dced2457b7c3a6b645f2e56b9ca44c4b09e437](https://github.com/sagemath/sagetrac-mirror/commit/d6dced2457b7c3a6b645f2e56b9ca44c4b09e437)

**Reviewer:** Matthias Koeppe, Jonathan Kliem

**Author:** Jonathan Kliem, Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/29537





---

archive/issue_events_263034.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-20T07:48:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263034"
}
```



---

archive/issue_comments_467216.json:
```json
{
    "body": "<a id='comment:3'></a>\ncould it be some kind of hardware mismatch?",
    "created_at": "2020-04-20T08:48:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467216",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
could it be some kind of hardware mismatch?



---

archive/issue_comments_467217.json:
```json
{
    "body": "<a id='comment:4'></a>\nPossibly, I'll investigate",
    "created_at": "2020-04-20T15:54:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467217",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Possibly, I'll investigate



---

archive/issue_comments_467218.json:
```json
{
    "body": "<a id='comment:5'></a>\nI will try with the configuration that Erik's https://github.com/sagemath/sage-windows/blob/master/Makefile\nuses",
    "created_at": "2020-04-20T17:10:37Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467218",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
I will try with the configuration that Erik's https://github.com/sagemath/sage-windows/blob/master/Makefile
uses



---

archive/issue_events_263035.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-05T01:06:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263035"
}
```



---

archive/issue_events_263036.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-05T01:06:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263036"
}
```



---

archive/issue_events_263037.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-05T01:06:47Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "rename": {
        "from": "Crash on building documentation and on startup, NTL-related, on cygwin-standard",
        "to": "cygwin-standard: build not portable despite using SAGE_FAT_BINARY=yes, NTL-related"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263037"
}
```



---

archive/issue_events_263038.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-05T01:06:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263038"
}
```



---

archive/issue_events_263039.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-05T01:06:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263039"
}
```



---

archive/issue_comments_467219.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,25 +1,6 @@\n-\n-```\n-[dochtml] Traceback (most recent call last):\n-[dochtml]   File \"/usr/lib/python3.7/runpy.py\", line 183, in _run_module_as_main\n-[dochtml]     mod_name, mod_spec, code = _get_module_details(mod_name, _Error)\n-[dochtml]   File \"/usr/lib/python3.7/runpy.py\", line 142, in _get_module_details\n-[dochtml]     return _get_module_details(pkg_main_name, error)\n-[dochtml]   File \"/usr/lib/python3.7/runpy.py\", line 109, in _get_module_details\n-[dochtml]     __import__(pkg_name)\n-[dochtml]   File \"/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py\", line 59, in <module>\n-[dochtml]     import sage.all\n-[dochtml]   File \"/sage/local/lib/python3.7/site-packages/sage/all.py\", line 125, in <module>\n-[dochtml]     from sage.libs.all       import *\n-[dochtml]   File \"/sage/local/lib/python3.7/site-packages/sage/libs/all.py\", line 3, in <module>\n-[dochtml]     import sage.libs.ntl.all as ntl\n-[dochtml]   File \"/sage/local/lib/python3.7/site-packages/sage/libs/ntl/all.py\", line 24, in <module>\n-[dochtml]     from sage.libs.ntl.ntl_ZZ import (\n-[dochtml]   File \"sage/libs/ntl/ntl_ZZ.pyx\", line 458, in init sage.libs.ntl.ntl_ZZ (build/cythonized/sage/libs/ntl/ntl_ZZ.cpp:9100)\n-[dochtml]   File \"sage/libs/ntl/ntl_ZZ.pyx\", line 454, in sage.libs.ntl.ntl_ZZ.ntl_setSeed (build/cythonized/sage/libs/ntl/ntl_ZZ.cpp:6106)\n-[dochtml] cysignals.signals.SignalError: Illegal instruction\n-```\n-\n+After getting `sage-local-iii.tar` from the sage-local artifact produced by GitHub Actions, extracting it using `.github/workflows/extract-sage-local.sh` to the same directory (`/sage/local`) on a local machine, the resulting sage does not run.\n+\n+It looks like this:\n \n ```\n \n``````\n",
    "created_at": "2020-05-05T01:06:47Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467219",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,25 +1,6 @@
-
-```
-[dochtml] Traceback (most recent call last):
-[dochtml]   File "/usr/lib/python3.7/runpy.py", line 183, in _run_module_as_main
-[dochtml]     mod_name, mod_spec, code = _get_module_details(mod_name, _Error)
-[dochtml]   File "/usr/lib/python3.7/runpy.py", line 142, in _get_module_details
-[dochtml]     return _get_module_details(pkg_main_name, error)
-[dochtml]   File "/usr/lib/python3.7/runpy.py", line 109, in _get_module_details
-[dochtml]     __import__(pkg_name)
-[dochtml]   File "/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 59, in <module>
-[dochtml]     import sage.all
-[dochtml]   File "/sage/local/lib/python3.7/site-packages/sage/all.py", line 125, in <module>
-[dochtml]     from sage.libs.all       import *
-[dochtml]   File "/sage/local/lib/python3.7/site-packages/sage/libs/all.py", line 3, in <module>
-[dochtml]     import sage.libs.ntl.all as ntl
-[dochtml]   File "/sage/local/lib/python3.7/site-packages/sage/libs/ntl/all.py", line 24, in <module>
-[dochtml]     from sage.libs.ntl.ntl_ZZ import (
-[dochtml]   File "sage/libs/ntl/ntl_ZZ.pyx", line 458, in init sage.libs.ntl.ntl_ZZ (build/cythonized/sage/libs/ntl/ntl_ZZ.cpp:9100)
-[dochtml]   File "sage/libs/ntl/ntl_ZZ.pyx", line 454, in sage.libs.ntl.ntl_ZZ.ntl_setSeed (build/cythonized/sage/libs/ntl/ntl_ZZ.cpp:6106)
-[dochtml] cysignals.signals.SignalError: Illegal instruction
-```
-
+After getting `sage-local-iii.tar` from the sage-local artifact produced by GitHub Actions, extracting it using `.github/workflows/extract-sage-local.sh` to the same directory (`/sage/local`) on a local machine, the resulting sage does not run.
+
+It looks like this:
 
 ```
 
``````




---

archive/issue_comments_467220.json:
```json
{
    "body": "<a id='comment:7'></a>\nI looked at one of the build logs on [GitHub](GitHub) and it does look like `SAGE_FAT_BINARY=yes` is being passed down, so other than that I'm not aware of any issue that would cause this unless there's a new issue with NTL I haven't seen before.",
    "created_at": "2020-06-26T12:05:05Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467220",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
I looked at one of the build logs on [GitHub](GitHub) and it does look like `SAGE_FAT_BINARY=yes` is being passed down, so other than that I'm not aware of any issue that would cause this unless there's a new issue with NTL I haven't seen before.



---

archive/issue_comments_467221.json:
```json
{
    "body": "<a id='comment:8'></a>\nPossibly related: #29109",
    "created_at": "2020-06-26T12:11:46Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467221",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Possibly related: #29109



---

archive/issue_events_263040.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263040"
}
```



---

archive/issue_events_263041.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263041"
}
```



---

archive/issue_comments_467222.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd111\".",
    "created_at": "2020-12-09T20:56:59Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467222",
    "user": "https://github.com/mkoeppe"
}
```

**Changing keywords** from "" to "sd111".



---

archive/issue_comments_467223.json:
```json
{
    "body": "<a id='comment:11'></a>\nIt's quite possible that this also affects our Docker builds.",
    "created_at": "2020-12-25T19:42:25Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467223",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
It's quite possible that this also affects our Docker builds.



---

archive/issue_comments_467224.json:
```json
{
    "body": "<a id='comment:12'></a>\nA report regarding the Docker builds: https://groups.google.com/g/sage-devel/c/Dbd4nFi8R7I (but no NTL involvement visible)",
    "created_at": "2020-12-28T18:08:25Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467224",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
A report regarding the Docker builds: https://groups.google.com/g/sage-devel/c/Dbd4nFi8R7I (but no NTL involvement visible)



---

archive/issue_events_263042.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-28T18:08:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "component: porting: cygwin",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263042"
}
```



---

archive/issue_events_263043.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-28T18:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "component: porting",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263043"
}
```



---

archive/issue_events_263044.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-28T18:08:25Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "rename": {
        "from": "cygwin-standard: build not portable despite using SAGE_FAT_BINARY=yes, NTL-related",
        "to": "build not portable despite using SAGE_FAT_BINARY=yes, NTL-related"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263044"
}
```



---

archive/issue_comments_467225.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-After getting `sage-local-iii.tar` from the sage-local artifact produced by GitHub Actions, extracting it using `.github/workflows/extract-sage-local.sh` to the same directory (`/sage/local`) on a local machine, the resulting sage does not run.\n+On `cygwin-standard`: After getting `sage-local-iii.tar` from the sage-local artifact produced by GitHub Actions, extracting it using `.github/workflows/extract-sage-local.sh` to the same directory (`/sage/local`) on a local machine, the resulting sage does not run.\n \n It looks like this:\n \n``````\n",
    "created_at": "2020-12-28T18:08:25Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467225",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-After getting `sage-local-iii.tar` from the sage-local artifact produced by GitHub Actions, extracting it using `.github/workflows/extract-sage-local.sh` to the same directory (`/sage/local`) on a local machine, the resulting sage does not run.
+On `cygwin-standard`: After getting `sage-local-iii.tar` from the sage-local artifact produced by GitHub Actions, extracting it using `.github/workflows/extract-sage-local.sh` to the same directory (`/sage/local`) on a local machine, the resulting sage does not run.
 
 It looks like this:
 
``````




---

archive/issue_comments_467226.json:
```json
{
    "body": "<a id='comment:13'></a>\nFrom `NTL/doc/tour-win.html`:\n\n```\n152 Configuration flags.\n153 </b>\n154 <p>\n155 \n156 Also in directory \"<tt>include/NTL</tt>\" is a file called \"<tt>config.h</tt>\".\n157 You can edit this file to override some of NTL's default options\n158 for basic configuration and performance.\n159 Again, the defaults should be good for\n160 Windows with MSVC++.\n```\n\nIn `config.h` there is a couple of flags that needs to be set by hand apparently.\n\nThose look like they might make problems:\n\n```\n195 #if 0\n196 #define NTL_CLEAN_INT\n197 \n198 /*\n199  *   This will disallow the use of some non-standard integer arithmetic\n200  *   that may improve performance somewhat.\n201  *\n202  */\n203 \n204 #endif\n205 \n206 #if 1\n207 #define NTL_CLEAN_PTR\n208 \n209 /*\n210  *   This will disallow the use of some non-standard pointer arithmetic\n211  *   that may improve performance somewhat.\n212  *\n213  */\n214 \n215 #endif\n216 \n217 #if 1\n218 #define NTL_SAFE_VECTORS\n219 \n220 /*\n221  * This will compile NTL in \"safe vector\" mode, only assuming\n222  * the relocatability property for trivial types and types\n223  * explicitly declared relocatable.  See vector.txt for more details.\n224  */\n225 \n226 #endif\n227 \n228 #if 0\n229 #define NTL_ENABLE_AVX_FFT\n230 \n231 /*\n232  * This will compile NTL in a way that enables an AVX implemention\n233  * of the small-prime FFT.\n234  */\n235 \n236 #endif\n237 \n238 \n239 #if 0\n240 #define NTL_AVOID_AVX512\n241  \n242 /*\n243  * This will compile NTL in a way that avoids 512-bit operations,\n244  * even if AVX512 is available.\n245  */\n246 \n247 #endif\n248  \n249 #if 0\n250 #define NTL_RANGE_CHECK\n251 \n252 /*\n253  *   This will generate vector subscript range-check code.\n254  *   Useful for debugging, but it slows things down of course.\n255  *\n256  */\n257 \n258 #endif\n```",
    "created_at": "2020-12-29T08:57:11Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467226",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>
From `NTL/doc/tour-win.html`:

```
152 Configuration flags.
153 </b>
154 <p>
155 
156 Also in directory "<tt>include/NTL</tt>" is a file called "<tt>config.h</tt>".
157 You can edit this file to override some of NTL's default options
158 for basic configuration and performance.
159 Again, the defaults should be good for
160 Windows with MSVC++.
```

In `config.h` there is a couple of flags that needs to be set by hand apparently.

Those look like they might make problems:

```
195 #if 0
196 #define NTL_CLEAN_INT
197 
198 /*
199  *   This will disallow the use of some non-standard integer arithmetic
200  *   that may improve performance somewhat.
201  *
202  */
203 
204 #endif
205 
206 #if 1
207 #define NTL_CLEAN_PTR
208 
209 /*
210  *   This will disallow the use of some non-standard pointer arithmetic
211  *   that may improve performance somewhat.
212  *
213  */
214 
215 #endif
216 
217 #if 1
218 #define NTL_SAFE_VECTORS
219 
220 /*
221  * This will compile NTL in "safe vector" mode, only assuming
222  * the relocatability property for trivial types and types
223  * explicitly declared relocatable.  See vector.txt for more details.
224  */
225 
226 #endif
227 
228 #if 0
229 #define NTL_ENABLE_AVX_FFT
230 
231 /*
232  * This will compile NTL in a way that enables an AVX implemention
233  * of the small-prime FFT.
234  */
235 
236 #endif
237 
238 
239 #if 0
240 #define NTL_AVOID_AVX512
241  
242 /*
243  * This will compile NTL in a way that avoids 512-bit operations,
244  * even if AVX512 is available.
245  */
246 
247 #endif
248  
249 #if 0
250 #define NTL_RANGE_CHECK
251 
252 /*
253  *   This will generate vector subscript range-check code.
254  *   Useful for debugging, but it slows things down of course.
255  *
256  */
257 
258 #endif
```



---

archive/issue_comments_467227.json:
```json
{
    "body": "<a id='comment:14'></a>\nSo I guess we have to patch NTL as to avoid those flags by configuration.",
    "created_at": "2020-12-29T09:00:15Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467227",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>
So I guess we have to patch NTL as to avoid those flags by configuration.



---

archive/issue_comments_467228.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe relevant configuration is done in `src/DoConfig`, which is unfortunately perl (yet another language whichs syntax I do not understand).\n\nBut one might even define those things as environment variables and this might be passed through??\n\nIn `src/DoConfig` there is the following list:\n\n```\n 55 %ConfigFlag = (\n 56 \n 57 'NTL_LEGACY_NO_NAMESPACE' => 'off',\n 58 'NTL_LEGACY_INPUT_ERROR'  => 'off',\n 59 'NTL_DISABLE_LONGDOUBLE'  => 'off',\n 60 'NTL_DISABLE_LONGLONG'    => 'off',\n 61 'NTL_DISABLE_LL_ASM'      => 'off',\n 62 'NTL_MAXIMIZE_SP_NBITS'   => 'off',\n 63 'NTL_LEGACY_SP_MULMOD'    => 'off',\n 64 'NTL_THREADS'             => 'on',\n 65 'NTL_TLS_HACK'            => 'on',\n 66 'NTL_EXCEPTIONS'          => 'off',\n 67 'NTL_STD_CXX11'           => 'on',\n 68 'NTL_STD_CXX14'           => 'off',\n 69 'NTL_DISABLE_MOVE_ASSIGN' => 'on',\n 70 'NTL_DISABLE_MOVE'        => 'off',\n 71 'NTL_THREAD_BOOST'        => 'on',\n 72 'NTL_GMP_LIP'             => 'on',\n 73 'NTL_GF2X_LIB'            => 'off',\n 74 'NTL_X86_FIX'             => 'off',\n 75 'NTL_NO_X86_FIX'          => 'off',\n 76 'NTL_NO_INIT_TRANS'       => 'on',\n 77 'NTL_CLEAN_INT'           => 'off',\n 78 'NTL_CLEAN_PTR'           => 'on',\n 79 'NTL_SAFE_VECTORS'        => 'on',\n 80 'NTL_RANGE_CHECK'         => 'off',\n 81 'NTL_ENABLE_AVX_FFT'      => 'off',\n 82 'NTL_AVOID_AVX512'        => 'off',\n 83 \n 84 \n 85 'NTL_SPMM_ULL'            => 'off',\n 86 'NTL_AVOID_BRANCHING'     => 'off',\n 87 'NTL_FFT_BIGTAB'          => 'off',\n 88 'NTL_FFT_LAZYMUL'         => 'off',\n 89 'NTL_TBL_REM'             => 'off',\n 90 'NTL_CRT_ALTCODE'         => 'off',\n 91 'NTL_CRT_ALTCODE_SMALL'   => 'off',\n 92 'NTL_GF2X_NOINLINE'       => 'off',\n 93 'NTL_GF2X_ALTCODE'        => 'off',\n 94 'NTL_GF2X_ALTCODE1'       => 'off',\n 95 \n 96 \n 97 );\n```\n\nWhat makes me thing that it might be AVX512 related, is that we haven't encountered this before. Github workflows is the only place where I encountered processors capable of AVX512.",
    "created_at": "2020-12-29T09:10:42Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467228",
    "user": "https://github.com/kliem"
}
```

<a id='comment:15'></a>
The relevant configuration is done in `src/DoConfig`, which is unfortunately perl (yet another language whichs syntax I do not understand).

But one might even define those things as environment variables and this might be passed through??

In `src/DoConfig` there is the following list:

```
 55 %ConfigFlag = (
 56 
 57 'NTL_LEGACY_NO_NAMESPACE' => 'off',
 58 'NTL_LEGACY_INPUT_ERROR'  => 'off',
 59 'NTL_DISABLE_LONGDOUBLE'  => 'off',
 60 'NTL_DISABLE_LONGLONG'    => 'off',
 61 'NTL_DISABLE_LL_ASM'      => 'off',
 62 'NTL_MAXIMIZE_SP_NBITS'   => 'off',
 63 'NTL_LEGACY_SP_MULMOD'    => 'off',
 64 'NTL_THREADS'             => 'on',
 65 'NTL_TLS_HACK'            => 'on',
 66 'NTL_EXCEPTIONS'          => 'off',
 67 'NTL_STD_CXX11'           => 'on',
 68 'NTL_STD_CXX14'           => 'off',
 69 'NTL_DISABLE_MOVE_ASSIGN' => 'on',
 70 'NTL_DISABLE_MOVE'        => 'off',
 71 'NTL_THREAD_BOOST'        => 'on',
 72 'NTL_GMP_LIP'             => 'on',
 73 'NTL_GF2X_LIB'            => 'off',
 74 'NTL_X86_FIX'             => 'off',
 75 'NTL_NO_X86_FIX'          => 'off',
 76 'NTL_NO_INIT_TRANS'       => 'on',
 77 'NTL_CLEAN_INT'           => 'off',
 78 'NTL_CLEAN_PTR'           => 'on',
 79 'NTL_SAFE_VECTORS'        => 'on',
 80 'NTL_RANGE_CHECK'         => 'off',
 81 'NTL_ENABLE_AVX_FFT'      => 'off',
 82 'NTL_AVOID_AVX512'        => 'off',
 83 
 84 
 85 'NTL_SPMM_ULL'            => 'off',
 86 'NTL_AVOID_BRANCHING'     => 'off',
 87 'NTL_FFT_BIGTAB'          => 'off',
 88 'NTL_FFT_LAZYMUL'         => 'off',
 89 'NTL_TBL_REM'             => 'off',
 90 'NTL_CRT_ALTCODE'         => 'off',
 91 'NTL_CRT_ALTCODE_SMALL'   => 'off',
 92 'NTL_GF2X_NOINLINE'       => 'off',
 93 'NTL_GF2X_ALTCODE'        => 'off',
 94 'NTL_GF2X_ALTCODE1'       => 'off',
 95 
 96 
 97 );
```

What makes me thing that it might be AVX512 related, is that we haven't encountered this before. Github workflows is the only place where I encountered processors capable of AVX512.



---

archive/issue_comments_467229.json:
```json
{
    "body": "<a id='comment:16'></a>\nI agree that `NTL_AVOID_AVX512` is a top suspect here. \nPerhaps it can be passed to `configure`, like we already pass `NATIVE=off` when `SAGE_FAT_BINARY=yes`?",
    "created_at": "2020-12-29T18:54:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467229",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
I agree that `NTL_AVOID_AVX512` is a top suspect here. 
Perhaps it can be passed to `configure`, like we already pass `NATIVE=off` when `SAGE_FAT_BINARY=yes`?



---

archive/issue_comments_467230.json:
```json
{
    "body": "**Commit:** [f053669ecdaae1ea48dce00819e0c8f4de6a3f9d](https://github.com/sagemath/sagetrac-mirror/commit/f053669ecdaae1ea48dce00819e0c8f4de6a3f9d)",
    "created_at": "2020-12-29T21:05:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467230",
    "user": "https://github.com/kliem"
}
```

**Commit:** [f053669ecdaae1ea48dce00819e0c8f4de6a3f9d](https://github.com/sagemath/sagetrac-mirror/commit/f053669ecdaae1ea48dce00819e0c8f4de6a3f9d)



---

archive/issue_comments_467231.json:
```json
{
    "body": "**Branch:** [public/29537](https://github.com/sagemath/sagetrac-mirror/tree/public/29537)",
    "created_at": "2020-12-29T21:05:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467231",
    "user": "https://github.com/kliem"
}
```

**Branch:** [public/29537](https://github.com/sagemath/sagetrac-mirror/tree/public/29537)



---

archive/issue_comments_467232.json:
```json
{
    "body": "<a id='comment:17'></a>\nOk. Lets try that. How do I test it? Do I just start the cygwin actions with that? What tickets do I need to pull yet?\n  \n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f053669ecdaae1ea48dce00819e0c8f4de6a3f9d\">f053669</a></td><td><code>try to build portable ntl by disabling avx512</code></td></tr></table>\n",
    "created_at": "2020-12-29T21:05:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467232",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>
Ok. Lets try that. How do I test it? Do I just start the cygwin actions with that? What tickets do I need to pull yet?
  
---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f053669ecdaae1ea48dce00819e0c8f4de6a3f9d">f053669</a></td><td><code>try to build portable ntl by disabling avx512</code></td></tr></table>




---

archive/issue_comments_467233.json:
```json
{
    "body": "<a id='comment:18'></a>\nRun it with #31064 (or #29152)",
    "created_at": "2020-12-29T21:11:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467233",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Run it with #31064 (or #29152)



---

archive/issue_comments_467234.json:
```json
{
    "body": "<a id='comment:19'></a>\nhttps://github.com/kliem/sage/actions/runs/451492157",
    "created_at": "2020-12-29T21:15:44Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467234",
    "user": "https://github.com/kliem"
}
```

<a id='comment:19'></a>
https://github.com/kliem/sage/actions/runs/451492157



---

archive/issue_comments_467235.json:
```json
{
    "body": "<a id='comment:20'></a>\niii-a already failed. Is this permanent? Should I just rerun?\n\nhttps://github.com/kliem/sage/runs/1625789472?check_suite_focus=true",
    "created_at": "2020-12-31T09:56:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467235",
    "user": "https://github.com/kliem"
}
```

<a id='comment:20'></a>
iii-a already failed. Is this permanent? Should I just rerun?

https://github.com/kliem/sage/runs/1625789472?check_suite_focus=true



---

archive/issue_comments_467236.json:
```json
{
    "body": "<a id='comment:21'></a>\nHm. This failure is from `fpylll` - I have created #31146 for this.\n\nNote that `cygwin-standard` does not build `ntl` because it finds the package provided by `cygwin`. Would need to test `cygwin-minimal`",
    "created_at": "2021-01-01T20:56:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467236",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Hm. This failure is from `fpylll` - I have created #31146 for this.

Note that `cygwin-standard` does not build `ntl` because it finds the package provided by `cygwin`. Would need to test `cygwin-minimal`



---

archive/issue_comments_467237.json:
```json
{
    "body": "<a id='comment:22'></a>\nok, I started cygwin-minimal.\n\nBut now I'm confused. How does this relate to the ticket description?\n\nBy default the github workflow does not set `SAGE_FAT_BINARY` it seems, so of course one cannot use it locally.",
    "created_at": "2021-01-01T21:47:49Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467237",
    "user": "https://github.com/kliem"
}
```

<a id='comment:22'></a>
ok, I started cygwin-minimal.

But now I'm confused. How does this relate to the ticket description?

By default the github workflow does not set `SAGE_FAT_BINARY` it seems, so of course one cannot use it locally.



---

archive/issue_comments_467238.json:
```json
{
    "body": "<a id='comment:23'></a>\nLooks like the ticket description is outdated and cygwin's ntl package is accepted in current sage.",
    "created_at": "2021-01-01T21:58:44Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467238",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Looks like the ticket description is outdated and cygwin's ntl package is accepted in current sage.



---

archive/issue_comments_467239.json:
```json
{
    "body": "<a id='comment:24'></a>\nThis is also related to [this issue](https://github.com/sagemath/sage-windows/issues/53) with Sage Windows, due to the fact that the NTL package for Cygwin is not built with `NATIVE=off` (and I was building Sage with the system package).\n\nI reported the issue to the package maintainer who has rebuilt the package: https://cygwin.com/pipermail/cygwin/2020-December/247206.html",
    "created_at": "2021-01-05T09:46:46Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467239",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
This is also related to [this issue](https://github.com/sagemath/sage-windows/issues/53) with Sage Windows, due to the fact that the NTL package for Cygwin is not built with `NATIVE=off` (and I was building Sage with the system package).

I reported the issue to the package maintainer who has rebuilt the package: https://cygwin.com/pipermail/cygwin/2020-December/247206.html



---

archive/issue_comments_467240.json:
```json
{
    "body": "<a id='comment:25'></a>\nI have encountered a similar problem again on Cygwin. This time it seems to come from OpenBLAS. \n\nThe Cygwin build takes place in multiple stages, passing on partial builds of $SAGE_LOCAL to the next stages via artifacts.\nI have now seen several instances (latest: \nin which the artifacts contain native instructions that lead to SIGILL on use in the next stage.\n\nFor example, in https://github.com/mkoeppe/sage/runs/2029013426?check_suite_focus=true aborts early in the sagelib build. On a local machine I can reproduce it as well by downloading the artifact. Using `gdb` it can be seen that merely importing some `numpy` modules already gives `SIGILL`.\n\nPerhaps the latest change to OpenBLAS in #22179 needs revisiting.",
    "created_at": "2021-03-04T17:02:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467240",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
I have encountered a similar problem again on Cygwin. This time it seems to come from OpenBLAS. 

The Cygwin build takes place in multiple stages, passing on partial builds of $SAGE_LOCAL to the next stages via artifacts.
I have now seen several instances (latest: 
in which the artifacts contain native instructions that lead to SIGILL on use in the next stage.

For example, in https://github.com/mkoeppe/sage/runs/2029013426?check_suite_focus=true aborts early in the sagelib build. On a local machine I can reproduce it as well by downloading the artifact. Using `gdb` it can be seen that merely importing some `numpy` modules already gives `SIGILL`.

Perhaps the latest change to OpenBLAS in #22179 needs revisiting.



---

archive/issue_events_263045.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-04T17:02:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "rename": {
        "from": "build not portable despite using SAGE_FAT_BINARY=yes, NTL-related",
        "to": "build not portable despite using SAGE_FAT_BINARY=yes, NTL-related / openblas-related"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263045"
}
```



---

archive/issue_comments_467241.json:
```json
{
    "body": "<a id='comment:26'></a>\nTesting with revert of #22179 (for Cygwin) in https://github.com/mkoeppe/sage/actions/runs/628022275",
    "created_at": "2021-03-06T20:41:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467241",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
Testing with revert of #22179 (for Cygwin) in https://github.com/mkoeppe/sage/actions/runs/628022275



---

archive/issue_comments_467242.json:
```json
{
    "body": "<a id='comment:27'></a>\nThis might also be related to https://github.com/sagemath/sage-windows/issues/57\n\nNTL is working now on sage-windows, but I suspect there is a portability issue with OpenBLAS (thought it is resulting in segfaults, apparently, not illegal instructions).",
    "created_at": "2021-03-08T13:20:05Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467242",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
This might also be related to https://github.com/sagemath/sage-windows/issues/57

NTL is working now on sage-windows, but I suspect there is a portability issue with OpenBLAS (thought it is resulting in segfaults, apparently, not illegal instructions).



---

archive/issue_comments_467243.json:
```json
{
    "body": "<a id='comment:28'></a>\nThanks for the pointer. \n\nEven with reverting #22179 (for Cygwin), I'm still getting SIGILL, but (apparently) from numpy itself, in `PyInit__multiarray_umath`. It should be checked if numpy is somehow configuring itself using different CFLAGS",
    "created_at": "2021-03-08T13:29:57Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467243",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Thanks for the pointer. 

Even with reverting #22179 (for Cygwin), I'm still getting SIGILL, but (apparently) from numpy itself, in `PyInit__multiarray_umath`. It should be checked if numpy is somehow configuring itself using different CFLAGS



---

archive/issue_comments_467244.json:
```json
{
    "body": "<a id='comment:29'></a>\nI think we may have to use `-march=...` explicitly to fix numpy",
    "created_at": "2021-03-09T08:27:14Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467244",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
I think we may have to use `-march=...` explicitly to fix numpy



---

archive/issue_comments_467245.json:
```json
{
    "body": "<a id='comment:30'></a>\nhttps://github.com/numpy/numpy/blob/cb557b79fa0ce467c881830f8e8e042c484ccfaa/doc/source/reference/simd/simd-optimizations.rst\n\nThis is the page to look at, I guess. If I understand correctly, we need to build numpy with `--cpu-baseline=NONE` if `SAGE_FAT_BINARY`.",
    "created_at": "2021-03-09T11:06:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467245",
    "user": "https://github.com/kliem"
}
```

<a id='comment:30'></a>
https://github.com/numpy/numpy/blob/cb557b79fa0ce467c881830f8e8e042c484ccfaa/doc/source/reference/simd/simd-optimizations.rst

This is the page to look at, I guess. If I understand correctly, we need to build numpy with `--cpu-baseline=NONE` if `SAGE_FAT_BINARY`.



---

archive/issue_comments_467246.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [gh-kliem](#comment%3A30):\n> https://github.com/numpy/numpy/blob/cb557b79fa0ce467c881830f8e8e042c484ccfaa/doc/source/reference/simd/simd-optimizations.rst\n> \n> This is the page to look at, I guess. If I understand correctly, we need to build numpy with `--cpu-baseline=NONE` if `SAGE_FAT_BINARY`.\n\nThanks for finding that.  I knew about the new SIMD stuff in Numpy, but not about the new associated compilation options (nor the fact that we weren't using them yet).\n\nI think `--cpu-baseline=MIN` should also be good-enough to run on the vast, vast majority of machines that are modern enough to even be capable of running Sage.\n\nWe should also look into `--cpu-dispatch`.  It will result in larger binaries, but IIUC will allow Numpy to perform runtime CPU feature detection and call the correct implementations.",
    "created_at": "2021-03-09T15:04:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467246",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>
Replying to [gh-kliem](#comment%3A30):
> https://github.com/numpy/numpy/blob/cb557b79fa0ce467c881830f8e8e042c484ccfaa/doc/source/reference/simd/simd-optimizations.rst
> 
> This is the page to look at, I guess. If I understand correctly, we need to build numpy with `--cpu-baseline=NONE` if `SAGE_FAT_BINARY`.

Thanks for finding that.  I knew about the new SIMD stuff in Numpy, but not about the new associated compilation options (nor the fact that we weren't using them yet).

I think `--cpu-baseline=MIN` should also be good-enough to run on the vast, vast majority of machines that are modern enough to even be capable of running Sage.

We should also look into `--cpu-dispatch`.  It will result in larger binaries, but IIUC will allow Numpy to perform runtime CPU feature detection and call the correct implementations.



---

archive/issue_comments_467247.json:
```json
{
    "body": "<a id='comment:32'></a>\nI agree that we should consider `--cpu-dispatch` for our binaries.\n\nI don't think `--cpu-baseline=MIN` will work. If compiled on an `x86` this will return `SSE SSE2`, but that won't work on apples M1.\n\nThe problem is that `--cpu-baseline=MIN` still assumes a similar architecture.",
    "created_at": "2021-03-09T15:11:52Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467247",
    "user": "https://github.com/kliem"
}
```

<a id='comment:32'></a>
I agree that we should consider `--cpu-dispatch` for our binaries.

I don't think `--cpu-baseline=MIN` will work. If compiled on an `x86` this will return `SSE SSE2`, but that won't work on apples M1.

The problem is that `--cpu-baseline=MIN` still assumes a similar architecture.



---

archive/issue_comments_467248.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [gh-kliem](#comment%3A32):\n> I don't think `--cpu-baseline=MIN` will work. If compiled on an `x86` this will return `SSE SSE2`, but that won't work on apples M1.\n> \n> The problem is that `--cpu-baseline=MIN` still assumes a similar architecture.\n\nI don't think that's true.  If you look at the docs you linked, the meaning of baseline=MIN is architecture-dependent.  It won't enable features that are not relevant for the target architecture.\n\nOf course, that means we need to build Sage binaries for aarch64 but that's already the case anyways I assume.",
    "created_at": "2021-03-09T15:44:09Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467248",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>
Replying to [gh-kliem](#comment%3A32):
> I don't think `--cpu-baseline=MIN` will work. If compiled on an `x86` this will return `SSE SSE2`, but that won't work on apples M1.
> 
> The problem is that `--cpu-baseline=MIN` still assumes a similar architecture.

I don't think that's true.  If you look at the docs you linked, the meaning of baseline=MIN is architecture-dependent.  It won't enable features that are not relevant for the target architecture.

Of course, that means we need to build Sage binaries for aarch64 but that's already the case anyways I assume.



---

archive/issue_comments_467249.json:
```json
{
    "body": "<a id='comment:34'></a>\nLet's ignore the harder problem of building universal binaries that work on both `x86_64` and `arm`.\n\nUsing `--cpu-dispatch` when `SAGE_FAT_BINARY` is set sounds like the right solution. Could one of you prepare a branch please?",
    "created_at": "2021-03-09T19:31:12Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467249",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
Let's ignore the harder problem of building universal binaries that work on both `x86_64` and `arm`.

Using `--cpu-dispatch` when `SAGE_FAT_BINARY` is set sounds like the right solution. Could one of you prepare a branch please?



---

archive/issue_events_263046.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-09T19:31:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "rename": {
        "from": "build not portable despite using SAGE_FAT_BINARY=yes, NTL-related / openblas-related",
        "to": "build not portable despite using SAGE_FAT_BINARY=yes, NTL/openblas/numpy-related"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263046"
}
```



---

archive/issue_events_263047.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-09T19:58:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263047"
}
```



---

archive/issue_events_263048.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-09T19:58:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263048"
}
```



---

archive/issue_comments_467250.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9587b4013735a01c0f84eb9455bfa0e03663ebf3\">9587b40</a></td><td><code>try to build portable ntl by disabling avx512</code></td></tr></table>\n",
    "created_at": "2021-03-09T20:17:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467250",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9587b4013735a01c0f84eb9455bfa0e03663ebf3">9587b40</a></td><td><code>try to build portable ntl by disabling avx512</code></td></tr></table>




---

archive/issue_comments_467251.json:
```json
{
    "body": "**Changing commit** from \"[f053669ecdaae1ea48dce00819e0c8f4de6a3f9d](https://github.com/sagemath/sagetrac-mirror/commit/f053669ecdaae1ea48dce00819e0c8f4de6a3f9d)\" to \"[9587b4013735a01c0f84eb9455bfa0e03663ebf3](https://github.com/sagemath/sagetrac-mirror/commit/9587b4013735a01c0f84eb9455bfa0e03663ebf3)\".",
    "created_at": "2021-03-09T20:17:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f053669ecdaae1ea48dce00819e0c8f4de6a3f9d](https://github.com/sagemath/sagetrac-mirror/commit/f053669ecdaae1ea48dce00819e0c8f4de6a3f9d)" to "[9587b4013735a01c0f84eb9455bfa0e03663ebf3](https://github.com/sagemath/sagetrac-mirror/commit/9587b4013735a01c0f84eb9455bfa0e03663ebf3)".



---

archive/issue_comments_467252.json:
```json
{
    "body": "<a id='comment:38'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/468395d340ffeacaad551fd0301bb07ffc8d6252\">468395d</a></td><td><code>do not allow numpy intrinsics when building fat binary</code></td></tr></table>\n",
    "created_at": "2021-03-09T20:29:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/468395d340ffeacaad551fd0301bb07ffc8d6252">468395d</a></td><td><code>do not allow numpy intrinsics when building fat binary</code></td></tr></table>




---

archive/issue_comments_467253.json:
```json
{
    "body": "**Changing commit** from \"[9587b4013735a01c0f84eb9455bfa0e03663ebf3](https://github.com/sagemath/sagetrac-mirror/commit/9587b4013735a01c0f84eb9455bfa0e03663ebf3)\" to \"[468395d340ffeacaad551fd0301bb07ffc8d6252](https://github.com/sagemath/sagetrac-mirror/commit/468395d340ffeacaad551fd0301bb07ffc8d6252)\".",
    "created_at": "2021-03-09T20:29:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9587b4013735a01c0f84eb9455bfa0e03663ebf3](https://github.com/sagemath/sagetrac-mirror/commit/9587b4013735a01c0f84eb9455bfa0e03663ebf3)" to "[468395d340ffeacaad551fd0301bb07ffc8d6252](https://github.com/sagemath/sagetrac-mirror/commit/468395d340ffeacaad551fd0301bb07ffc8d6252)".



---

archive/issue_comments_467254.json:
```json
{
    "body": "**Reviewer:** https://github.com/kliem/sage/pull/41/checks",
    "created_at": "2021-03-09T20:30:28Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467254",
    "user": "https://github.com/kliem"
}
```

**Reviewer:** https://github.com/kliem/sage/pull/41/checks



---

archive/issue_comments_467255.json:
```json
{
    "body": "<a id='comment:40'></a>\nI ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)\nand I am still getting SIGSEGVs from plotting and SIGILLs",
    "created_at": "2021-03-10T18:58:41Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467255",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)
and I am still getting SIGSEGVs from plotting and SIGILLs



---

archive/issue_comments_467256.json:
```json
{
    "body": "<a id='comment:41'></a>\nErik, in https://groups.google.com/g/sage-devel/c/s_inhvSxLp8/m/Vtb35oYcAgAJ you say you have fixed it in the windows binary build --- what's the solution?",
    "created_at": "2021-03-10T18:59:42Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467256",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Erik, in https://groups.google.com/g/sage-devel/c/s_inhvSxLp8/m/Vtb35oYcAgAJ you say you have fixed it in the windows binary build --- what's the solution?



---

archive/issue_comments_467257.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [mkoeppe](#comment%3A41):\n> Erik, in https://groups.google.com/g/sage-devel/c/s_inhvSxLp8/m/Vtb35oYcAgAJ you say you have fixed it in the windows binary build --- what's the solution?\n\nThe issue on the NTL side was fixed: https://github.com/sagemath/sage-windows/issues/53\n\nThe solution was to not use the NTL package from Cygwin and custom compile it instead.\n\nI also brought the issue up with the package maintainer: https://cygwin.com/pipermail/cygwin/2020-December/247196.html\n\nHe has released a new version of the package to address it: https://cygwin.com/pipermail/cygwin/2020-December/247205.html\n\nHe still rebuilt it, with my perhaps fault suggestion of including `CXXFLAGS=-mavx`, which others have rightfully pointed out will still make it less portable, though I think that's how I built it as well.\n\nHe released another new NTL package in January but I'm not sure whether or not it changes anything about this: https://cygwin.com/pipermail/cygwin/2021-January/247439.html\n\nThe NTL fix definitely worked for some, but others are still reporting segfaults in plotting, so I think that has to do either with OpenBLAS or Numpy, but I haven't been able to gather enough details: https://github.com/sagemath/sage-windows/issues/57",
    "created_at": "2021-03-12T11:51:07Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467257",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>
Replying to [mkoeppe](#comment%3A41):
> Erik, in https://groups.google.com/g/sage-devel/c/s_inhvSxLp8/m/Vtb35oYcAgAJ you say you have fixed it in the windows binary build --- what's the solution?

The issue on the NTL side was fixed: https://github.com/sagemath/sage-windows/issues/53

The solution was to not use the NTL package from Cygwin and custom compile it instead.

I also brought the issue up with the package maintainer: https://cygwin.com/pipermail/cygwin/2020-December/247196.html

He has released a new version of the package to address it: https://cygwin.com/pipermail/cygwin/2020-December/247205.html

He still rebuilt it, with my perhaps fault suggestion of including `CXXFLAGS=-mavx`, which others have rightfully pointed out will still make it less portable, though I think that's how I built it as well.

He released another new NTL package in January but I'm not sure whether or not it changes anything about this: https://cygwin.com/pipermail/cygwin/2021-January/247439.html

The NTL fix definitely worked for some, but others are still reporting segfaults in plotting, so I think that has to do either with OpenBLAS or Numpy, but I haven't been able to gather enough details: https://github.com/sagemath/sage-windows/issues/57



---

archive/issue_comments_467258.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [mkoeppe](#comment%3A40):\n> I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)\n> and I am still getting SIGSEGVs from plotting and SIGILLs \n\nDo we know anything about the CPU architecture of the machines these builds are being run on?  I looked through the logs but didn't find anything.  It might be helpful to add a `cat /proc/cpuinfo` somewhere.",
    "created_at": "2021-03-12T11:59:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467258",
    "user": "https://github.com/embray"
}
```

<a id='comment:43'></a>
Replying to [mkoeppe](#comment%3A40):
> I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)
> and I am still getting SIGSEGVs from plotting and SIGILLs 

Do we know anything about the CPU architecture of the machines these builds are being run on?  I looked through the logs but didn't find anything.  It might be helpful to add a `cat /proc/cpuinfo` somewhere.



---

archive/issue_comments_467259.json:
```json
{
    "body": "<a id='comment:44'></a>\nPossibly related but I'm not sure since others are reporting it's fixed in 1.19.4.  I didn't know Numpy was now installing its own copies of libraries in `numpy.libs` when you install from a wheel.  I don't think that should be affecting Sage, but it's worth a look: https://github.com/numpy/numpy/issues/17674",
    "created_at": "2021-03-12T12:17:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467259",
    "user": "https://github.com/embray"
}
```

<a id='comment:44'></a>
Possibly related but I'm not sure since others are reporting it's fixed in 1.19.4.  I didn't know Numpy was now installing its own copies of libraries in `numpy.libs` when you install from a wheel.  I don't think that should be affecting Sage, but it's worth a look: https://github.com/numpy/numpy/issues/17674



---

archive/issue_comments_467260.json:
```json
{
    "body": "<a id='comment:45'></a>\nWorth a look in part because Numpy with OpenBLAS 0.3.12 was causing segfaults, so they reverted to OpenBLAS 0.3.9: https://github.com/numpy/numpy/pull/17680 \n\nWe are using 0.3.13 which might also have problems with Numpy, though I wish I had more insight into what those problems actually are.",
    "created_at": "2021-03-12T12:19:22Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467260",
    "user": "https://github.com/embray"
}
```

<a id='comment:45'></a>
Worth a look in part because Numpy with OpenBLAS 0.3.12 was causing segfaults, so they reverted to OpenBLAS 0.3.9: https://github.com/numpy/numpy/pull/17680 

We are using 0.3.13 which might also have problems with Numpy, though I wish I had more insight into what those problems actually are.



---

archive/issue_comments_467261.json:
```json
{
    "body": "<a id='comment:46'></a>\nMany seem to have suggested it might have to do with OpenBLAS threading.  Could we try setting `export OPENBLAS_NUM_THREADS=1` and see if it makes any difference?",
    "created_at": "2021-03-12T12:25:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467261",
    "user": "https://github.com/embray"
}
```

<a id='comment:46'></a>
Many seem to have suggested it might have to do with OpenBLAS threading.  Could we try setting `export OPENBLAS_NUM_THREADS=1` and see if it makes any difference?



---

archive/issue_comments_467262.json:
```json
{
    "body": "<a id='comment:47'></a>\nAlas, Sage 9.2 has OpenBLAS 0.3.9, so I guess this is not directly related to the people reporting this against Sage 9.2 for Windows :/",
    "created_at": "2021-03-12T12:30:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467262",
    "user": "https://github.com/embray"
}
```

<a id='comment:47'></a>
Alas, Sage 9.2 has OpenBLAS 0.3.9, so I guess this is not directly related to the people reporting this against Sage 9.2 for Windows :/



---

archive/issue_comments_467263.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [embray](#comment%3A46):\n> Many seem to have suggested it might have to do with OpenBLAS threading.  Could we try setting `export OPENBLAS_NUM_THREADS=1` and see if it makes any difference?\n\nWe already set this in `src/bin/sage-env`",
    "created_at": "2021-03-12T16:02:42Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467263",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
Replying to [embray](#comment%3A46):
> Many seem to have suggested it might have to do with OpenBLAS threading.  Could we try setting `export OPENBLAS_NUM_THREADS=1` and see if it makes any difference?

We already set this in `src/bin/sage-env`



---

archive/issue_comments_467264.json:
```json
{
    "body": "**Changing commit** from \"[468395d340ffeacaad551fd0301bb07ffc8d6252](https://github.com/sagemath/sagetrac-mirror/commit/468395d340ffeacaad551fd0301bb07ffc8d6252)\" to \"[86f4c345a8b8bfe3ab235337d35443771da5c965](https://github.com/sagemath/sagetrac-mirror/commit/86f4c345a8b8bfe3ab235337d35443771da5c965)\".",
    "created_at": "2021-03-12T16:17:04Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[468395d340ffeacaad551fd0301bb07ffc8d6252](https://github.com/sagemath/sagetrac-mirror/commit/468395d340ffeacaad551fd0301bb07ffc8d6252)" to "[86f4c345a8b8bfe3ab235337d35443771da5c965](https://github.com/sagemath/sagetrac-mirror/commit/86f4c345a8b8bfe3ab235337d35443771da5c965)".



---

archive/issue_comments_467265.json:
```json
{
    "body": "<a id='comment:49'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86f4c345a8b8bfe3ab235337d35443771da5c965\">86f4c34</a></td><td><code>.github/workflows/ci-cygwin-*.yml: Print cpuinfo</code></td></tr></table>\n",
    "created_at": "2021-03-12T16:17:04Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86f4c345a8b8bfe3ab235337d35443771da5c965">86f4c34</a></td><td><code>.github/workflows/ci-cygwin-*.yml: Print cpuinfo</code></td></tr></table>




---

archive/issue_comments_467266.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [embray](#comment%3A43):\n> Replying to [mkoeppe](#comment%3A40):\n> > I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)\n> > and I am still getting SIGSEGVs from plotting and SIGILLs \n\n> \n> Do we know anything about the CPU architecture of the machines these builds are being run on? \n\nOnly that it varies even within one run.\n\n> I looked through the logs but didn't find anything.  It might be helpful to add a `cat /proc/cpuinfo` somewhere.\n\nI have added it at the beginning of each job",
    "created_at": "2021-03-12T16:18:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467266",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
Replying to [embray](#comment%3A43):
> Replying to [mkoeppe](#comment%3A40):
> > I ran this also in https://github.com/mkoeppe/sage/actions/runs/637210121 (on top of #25993 and other tickets - https://github.com/mkoeppe/sage/tree/ci-25993-2021-03-05-29827-29537)
> > and I am still getting SIGSEGVs from plotting and SIGILLs 

> 
> Do we know anything about the CPU architecture of the machines these builds are being run on? 

Only that it varies even within one run.

> I looked through the logs but didn't find anything.  It might be helpful to add a `cat /proc/cpuinfo` somewhere.

I have added it at the beginning of each job



---

archive/issue_comments_467267.json:
```json
{
    "body": "<a id='comment:51'></a>\nReplying to [embray](#comment%3A42):\n> The issue on the NTL side was fixed: https://github.com/sagemath/sage-windows/issues/53\n> \n> The solution was to not use the NTL package from Cygwin and custom compile it instead.\n> \n> I also brought the issue up with the package maintainer: [...]\n> He released another new NTL package in January but I'm not sure whether or not it changes anything about this: https://cygwin.com/pipermail/cygwin/2021-January/247439.html\n> \n> The NTL fix definitely worked for some [...]\n\nThanks a lot for the details on NTL. I haven't seen the NTL-related failures in a while, so let's assume it is fixed by the changes to the Cygwin package.  (But unrelated issues currently block the `cygwin-minimal` build -- so we cannot be sure yet that our NTL works in this configuration.)",
    "created_at": "2021-03-12T16:24:15Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467267",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>
Replying to [embray](#comment%3A42):
> The issue on the NTL side was fixed: https://github.com/sagemath/sage-windows/issues/53
> 
> The solution was to not use the NTL package from Cygwin and custom compile it instead.
> 
> I also brought the issue up with the package maintainer: [...]
> He released another new NTL package in January but I'm not sure whether or not it changes anything about this: https://cygwin.com/pipermail/cygwin/2021-January/247439.html
> 
> The NTL fix definitely worked for some [...]

Thanks a lot for the details on NTL. I haven't seen the NTL-related failures in a while, so let's assume it is fixed by the changes to the Cygwin package.  (But unrelated issues currently block the `cygwin-minimal` build -- so we cannot be sure yet that our NTL works in this configuration.)



---

archive/issue_comments_467268.json:
```json
{
    "body": "**Changing commit** from \"[86f4c345a8b8bfe3ab235337d35443771da5c965](https://github.com/sagemath/sagetrac-mirror/commit/86f4c345a8b8bfe3ab235337d35443771da5c965)\" to \"[f6ec2c962e79469275f1d99c79524bfe4eac6be5](https://github.com/sagemath/sagetrac-mirror/commit/f6ec2c962e79469275f1d99c79524bfe4eac6be5)\".",
    "created_at": "2021-03-12T21:29:01Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[86f4c345a8b8bfe3ab235337d35443771da5c965](https://github.com/sagemath/sagetrac-mirror/commit/86f4c345a8b8bfe3ab235337d35443771da5c965)" to "[f6ec2c962e79469275f1d99c79524bfe4eac6be5](https://github.com/sagemath/sagetrac-mirror/commit/f6ec2c962e79469275f1d99c79524bfe4eac6be5)".



---

archive/issue_comments_467269.json:
```json
{
    "body": "<a id='comment:52'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1092d4bca3b553673975f7d25af13fe0f4aa138f\">1092d4b</a></td><td><code>.github/workflows/ci-cygwin-*.yml: Use configure --enable-fat-binary - the environment variable SAGE_FAT_BINARY is not passed through tox</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67b01ecaa00b38b07e66abbf6203d1f1bc5bde3c\">67b01ec</a></td><td><code>tox.ini: Pass through SAGE_NUM_THREADS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6ec2c962e79469275f1d99c79524bfe4eac6be5\">f6ec2c9</a></td><td><code>github/workflows/ci-cygwin-*.yml: Remove setting of SAGE_CHECK* variables which duplicates what tox does</code></td></tr></table>\n",
    "created_at": "2021-03-12T21:29:01Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1092d4bca3b553673975f7d25af13fe0f4aa138f">1092d4b</a></td><td><code>.github/workflows/ci-cygwin-*.yml: Use configure --enable-fat-binary - the environment variable SAGE_FAT_BINARY is not passed through tox</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67b01ecaa00b38b07e66abbf6203d1f1bc5bde3c">67b01ec</a></td><td><code>tox.ini: Pass through SAGE_NUM_THREADS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6ec2c962e79469275f1d99c79524bfe4eac6be5">f6ec2c9</a></td><td><code>github/workflows/ci-cygwin-*.yml: Remove setting of SAGE_CHECK* variables which duplicates what tox does</code></td></tr></table>




---

archive/issue_comments_467270.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/kliem/sage/pull/41/checks\" to \"https://github.com/mkoeppe/sage/actions/runs/647496577\".",
    "created_at": "2021-03-12T21:36:36Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467270",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/kliem/sage/pull/41/checks" to "https://github.com/mkoeppe/sage/actions/runs/647496577".



---

archive/issue_events_263049.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-12T21:37:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263049"
}
```



---

archive/issue_comments_467271.json:
```json
{
    "body": "**Author:** Jonathan Kliem, Matthias Koeppe",
    "created_at": "2021-03-12T21:37:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467271",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Jonathan Kliem, Matthias Koeppe



---

archive/issue_comments_467272.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,531 +1,9 @@\n-On `cygwin-standard`: After getting `sage-local-iii.tar` from the sage-local artifact produced by GitHub Actions, extracting it using `.github/workflows/extract-sage-local.sh` to the same directory (`/sage/local`) on a local machine, the resulting sage does not run.\n+We fix several issues involving `SAGE_FAT_BINARY`:\n \n-It looks like this:\n+- `numpy` intrinsics need a special build flag in this mode\n \n-```\n+- `ntl` needs to disable use of a problematic instruction set\n \n-$ ./sage\n-This looks like the first time you are running Sage.\n-Cleaning up, do not interrupt this.\n-Done cleaning.\n-\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n-\u2502 SageMath version 9.1.rc0, Release Date: 2020-04-12                 \u2502\n-\u2502 Using Python 3.7.4. Type \"help()\" for help.                        \u2502\n-\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n-\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n-\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n-\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n----------------------------------------------------------------------------\n----------------------------------------------------------------------------\n-SignalError                           Python 3.7.4: /sage/local/bin/python3\n-                                                   Mon Apr 20 00:31:18 2020\n-A problem occurred executing Python code.  Here is the sequence of function\n-calls leading up to the error, with the most recent (innermost) call last.\n-/cygdrive/c/sage/sage2/src/bin/sage-ipython in <module>()\n-      1 #!/usr/bin/env sage-python\n-      2 # -*- coding: utf-8 -*-\n-      3 \"\"\"\n-      4 Sage IPython startup script.\n-      5 \"\"\"\n-      6\n-      7 # Display startup banner. Do this before anything else to give the user\n-      8 # early feedback that Sage is starting.\n-      9 from sage.misc.banner import banner\n-     10 banner()\n-     11\n-     12 from sage.repl.interpreter import SageTerminalApp\n-     13\n-     14 app = SageTerminalApp.instance()\n----> 15 app.initialize()\n-        global app.initialize = <bound method TerminalIPythonApp.initialize of <sage.repl.interpreter.SageTerminalApp object at 0x6fffffec7710>>\n-     16 app.start()\n+- After #31064, the GH Actions tests for `cygwin` did not pass SAGE_FAT_BINARY to the actual build, randomly causing SIGILLs when a partial build was passed to the next stage through the `sage-local` artifact\n \n-</sage/local/lib/python3.7/site-packages/decorator.py:decorator-gen-110> in initialize(self=<sage.repl.interpreter.SageTerminalApp object>, argv=None)\n \n-/sage/local/lib/python3.7/site-packages/traitlets/config/application.py in catch_config_error(method=<function TerminalIPythonApp.initialize>, app=<sage.repl.interpreter.SageTerminalApp object>, *args=(None,), **kwargs={})\n-     72     TRAITLETS_APPLICATION_RAISE_CONFIG_FILE_ERROR = False\n-     73 else:\n-     74     raise ValueError(\"Unsupported value for environment variable: 'TRAITLETS_APPLICATION_RAISE_CONFIG_FILE_ERROR' is set to '%s' which is none of  {'0', '1', 'false', 'true', ''}.\"% _envvar )\n-     75\n-     76\n-     77 @decorator\n-     78 def catch_config_error(method, app, *args, **kwargs):\n-     79     \"\"\"Method decorator for catching invalid config (Trait/ArgumentErrors) during init.\n-     80\n-     81     On a TraitError (generally caused by bad config), this will print the trait's\n-     82     message, and exit the app.\n-     83\n-     84     For use on init methods, to prevent invoking excepthook on invalid input.\n-     85     \"\"\"\n-     86     try:\n----> 87         return method(app, *args, **kwargs)\n-        method = <function TerminalIPythonApp.initialize at 0x6ffffec18560>\n-        app = <sage.repl.interpreter.SageTerminalApp object at 0x6fffffec7710>\n-        args = (None,)\n-        kwargs = {}\n-     88     except (TraitError, ArgumentError) as e:\n-     89         app.print_help()\n-     90         app.log.fatal(\"Bad config encountered during initialization:\")\n-     91         app.log.fatal(str(e))\n-     92         app.log.debug(\"Config at the time: %s\", app.config)\n-     93         app.exit(1)\n-     94\n-     95\n-     96 class ApplicationError(Exception):\n-     97     pass\n-     98\n-     99\n-    100 class LevelFormatter(logging.Formatter):\n-    101     \"\"\"Formatter with additional `highlevel` record\n-    102\n-\n-/sage/local/lib/python3.7/site-packages/IPython/terminal/ipapp.py in initialize(self=<sage.repl.interpreter.SageTerminalApp object>, argv=None)\n-    301\n-    302         return super(TerminalIPythonApp, self).parse_command_line(argv)\n-    303\n-    304     @catch_config_error\n-    305     def initialize(self, argv=None):\n-    306         \"\"\"Do actions after construct, but before starting the app.\"\"\"\n-    307         super(TerminalIPythonApp, self).initialize(argv)\n-    308         if self.subapp is not None:\n-    309             # don't bother initializing further, starting subapp\n-    310             return\n-    311         # print self.extra_args\n-    312         if self.extra_args and not self.something_to_run:\n-    313             self.file_to_run = self.extra_args[0]\n-    314         self.init_path()\n-    315         # create the shell\n---> 316         self.init_shell()\n-        self.init_shell = <bound method SageTerminalApp.init_shell of <sage.repl.interpreter.SageTerminalApp object at 0x6fffffec7710>>\n-    317         # and draw the banner\n-    318         self.init_banner()\n-    319         # Now a variety of things that happen after the banner is printed.\n-    320         self.init_gui_pylab()\n-    321         self.init_extensions()\n-    322         self.init_code()\n-    323\n-    324     def init_shell(self):\n-    325         \"\"\"initialize the InteractiveShell instance\"\"\"\n-    326         # Create an InteractiveShell instance.\n-    327         # shell.display_banner should always be False for the terminal\n-    328         # based app, because we call shell.show_banner() by hand below\n-    329         # so the banner shows *before* all extension loading stuff.\n-    330         self.shell = self.interactive_shell_class.instance(parent=self,\n-    331                         profile_dir=self.profile_dir,\n-\n-/sage/local/lib/python3.7/site-packages/sage/repl/interpreter.py in init_shell(self=<sage.repl.interpreter.SageTerminalApp object>)\n-    772         self.shell.has_sage_extensions = SAGE_EXTENSION in self.extensions\n-    773\n-    774         # Load the %lprun extension if available\n-    775         try:\n-    776             import line_profiler\n-    777         except ImportError:\n-    778             pass\n-    779         else:\n-    780             self.extensions.append('line_profiler')\n-    781\n-    782         if self.shell.has_sage_extensions:\n-    783             self.extensions.remove(SAGE_EXTENSION)\n-    784\n-    785             # load sage extension here to get a crash if\n-    786             # something is wrong with the sage library\n---> 787             self.shell.extension_manager.load_extension(SAGE_EXTENSION)\n-        self.shell.extension_manager.load_extension = <bound method ExtensionManager.load_extension of <IPython.core.extensions.ExtensionManager object at 0x6ffffec1dc90>>\n-        global SAGE_EXTENSION = 'sage'\n-    788\n-    789\n-\n-/sage/local/lib/python3.7/site-packages/IPython/core/extensions.py in load_extension(self=<IPython.core.extensions.ExtensionManager object>, module_str='sage')\n-     70\n-     71         Returns the string \"already loaded\" if the extension is already loaded,\n-     72         \"no load function\" if the module doesn't have a load_ipython_extension\n-     73         function, or None if it succeeded.\n-     74         \"\"\"\n-     75         if module_str in self.loaded:\n-     76             return \"already loaded\"\n-     77\n-     78         from IPython.utils.syspathcontext import prepended_to_syspath\n-     79\n-     80         with self.shell.builtin_trap:\n-     81             if module_str not in sys.modules:\n-     82                 with prepended_to_syspath(self.ipython_extension_dir):\n-     83                     __import__(module_str)\n-     84             mod = sys.modules[module_str]\n----> 85             if self._call_load_ipython_extension(mod):\n-        self._call_load_ipython_extension = <bound method ExtensionManager._call_load_ipython_extension of <IPython.core.extensions.ExtensionManager object at 0x6ffffec1dc90>>\n-        mod = <module 'sage' from '/sage/local/lib/python3.7/site-packages/sage/__init__.py'>\n-     86                 self.loaded.add(module_str)\n-     87             else:\n-     88                 return \"no load function\"\n-     89\n-     90     def unload_extension(self, module_str):\n-     91         \"\"\"Unload an IPython extension by its module name.\n-     92\n-     93         This function looks up the extension's name in ``sys.modules`` and\n-     94         simply calls ``mod.unload_ipython_extension(self)``.\n-     95\n-     96         Returns the string \"no unload function\" if the extension doesn't define\n-     97         a function to unload itself, \"not loaded\" if the extension isn't loaded,\n-     98         otherwise None.\n-     99         \"\"\"\n-    100         if module_str not in self.loaded:\n-\n-/sage/local/lib/python3.7/site-packages/IPython/core/extensions.py in _call_load_ipython_extension(self=<IPython.core.extensions.ExtensionManager object>, mod=<module 'sage' from '/sage/local/lib/python3.7/site-packages/sage/__init__.py'>)\n-    117         \"\"\"\n-    118         from IPython.utils.syspathcontext import prepended_to_syspath\n-    119\n-    120         if (module_str in self.loaded) and (module_str in sys.modules):\n-    121             self.unload_extension(module_str)\n-    122             mod = sys.modules[module_str]\n-    123             with prepended_to_syspath(self.ipython_extension_dir):\n-    124                 reload(mod)\n-    125             if self._call_load_ipython_extension(mod):\n-    126                 self.loaded.add(module_str)\n-    127         else:\n-    128             self.load_extension(module_str)\n-    129\n-    130     def _call_load_ipython_extension(self, mod):\n-    131         if hasattr(mod, 'load_ipython_extension'):\n---> 132             mod.load_ipython_extension(self.shell)\n-        mod.load_ipython_extension = <function load_ipython_extension at 0x6fffffde1710>\n-        self.shell = <sage.repl.interpreter.SageTerminalInteractiveShell object at 0x6fffffec79d0>\n-    133             return True\n-    134\n-    135     def _call_unload_ipython_extension(self, mod):\n-    136         if hasattr(mod, 'unload_ipython_extension'):\n-    137             mod.unload_ipython_extension(self.shell)\n-    138             return True\n-    139\n-    140     def install_extension(self, url, filename=None):\n-    141         \"\"\"Download and install an IPython extension.\n-    142\n-    143         If filename is given, the file will be so named (inside the extension\n-    144         directory). Otherwise, the name from the URL will be used. The file must\n-    145         have a .py or .zip extension; otherwise, a ValueError will be raised.\n-    146\n-    147         Returns the full path to the installed file.\n-\n-/sage/local/lib/python3.7/site-packages/sage/__init__.py in load_ipython_extension(*args=(<sage.repl.interpreter.SageTerminalInteractiveShell object>,))\n-      1 __all__ = ['all']\n-      2\n-      3 # Set sage.__version__ to the current version number. This is analogous\n-      4 # to many other Python packages.\n-      5 from sage.version import version as __version__\n-      6\n-      7 # Make sure that the correct zlib library is loaded. This is needed\n-      8 # to prevent the system zlib to be loaded instead of the Sage one.\n-      9 # See https://trac.sagemath.org/ticket/23122\n-     10 import zlib\n-     11\n-     12 # IPython calls this when starting up\n-     13 def load_ipython_extension(*args):\n-     14     import sage.repl.ipython_extension\n----> 15     sage.repl.ipython_extension.load_ipython_extension(*args)\n-        sage.repl.ipython_extension.load_ipython_extension = <function load_ipython_extension at 0x6ffffe3f27a0>\n-        args = (<sage.repl.interpreter.SageTerminalInteractiveShell object at 0x6fffffec79d0>,)\n-     16\n-     17\n-     18 # Monkey-patch inspect.isfunction() to support Cython functions.\n-     19 def isfunction(obj):\n-     20     \"\"\"\n-     21     Check whether something is a function.\n-     22\n-     23     We assume that anything which has a genuine ``__code__``\n-     24     attribute (not using ``__getattr__`` overrides) is a function.\n-     25     This is meant to support Cython functions.\n-     26\n-     27     EXAMPLES::\n-     28\n-     29         sage: from inspect import isfunction\n-     30         sage: def f(): pass\n-     31         sage: isfunction(f)\n-\n-/sage/local/lib/python3.7/site-packages/sage/repl/ipython_extension.py in wrapper(*args=(<sage.repl.interpreter.SageTerminalInteractiveShell object>,), **kwargs={})\n-    549         ....:     if work:\n-    550         ....:         return 'foo worked'\n-    551         ....:     raise RuntimeError(\"foo didn't work\")\n-    552         sage: foo(False)\n-    553         Traceback (most recent call last):\n-    554         ...\n-    555         RuntimeError: foo didn't work\n-    556         sage: foo(True)\n-    557         'foo worked'\n-    558         sage: foo(False)\n-    559         sage: foo(True)\n-    560     \"\"\"\n-    561     @wraps(func)\n-    562     def wrapper(*args, **kwargs):\n-    563         if not wrapper.has_run:\n---> 564             result = func(*args, **kwargs)\n-        result = undefined\n-        global func = undefined\n-        args = (<sage.repl.interpreter.SageTerminalInteractiveShell object at 0x6fffffec79d0>,)\n-        kwargs = {}\n-    565             wrapper.has_run = True\n-    566             return result\n-    567     wrapper.has_run = False\n-    568     return wrapper\n-    569\n-    570\n-    571 @run_once\n-    572 def load_ipython_extension(ip):\n-    573     \"\"\"\n-    574     Load the extension in IPython.\n-    575     \"\"\"\n-    576     # this modifies ip\n-    577     SageCustomizations(shell=ip)\n-\n-/sage/local/lib/python3.7/site-packages/sage/repl/ipython_extension.py in load_ipython_extension(ip=<sage.repl.interpreter.SageTerminalInteractiveShell object>)\n-    562     def wrapper(*args, **kwargs):\n-    563         if not wrapper.has_run:\n-    564             result = func(*args, **kwargs)\n-    565             wrapper.has_run = True\n-    566             return result\n-    567     wrapper.has_run = False\n-    568     return wrapper\n-    569\n-    570\n-    571 @run_once\n-    572 def load_ipython_extension(ip):\n-    573     \"\"\"\n-    574     Load the extension in IPython.\n-    575     \"\"\"\n-    576     # this modifies ip\n---> 577     SageCustomizations(shell=ip)\n-        global SageCustomizations = <class 'sage.repl.ipython_extension.SageCustomizations'>\n-        global shell = undefined\n-        ip = <sage.repl.interpreter.SageTerminalInteractiveShell object at 0x6fffffec79d0>\n-\n-/sage/local/lib/python3.7/site-packages/sage/repl/ipython_extension.py in __init__(self=<sage.repl.ipython_extension.SageCustomizations object>, shell=<sage.repl.interpreter.SageTerminalInteractiveShell object>)\n-    420     def __init__(self, shell=None):\n-    421         \"\"\"\n-    422         Initialize the Sage plugin.\n-    423         \"\"\"\n-    424         self.shell = shell\n-    425\n-    426         self.auto_magics = SageMagics(shell)\n-    427         self.shell.register_magics(self.auto_magics)\n-    428\n-    429         import sage.misc.edit_module as edit_module\n-    430         self.shell.set_hook('editor', edit_module.edit_devel)\n-    431\n-    432         self.init_inspector()\n-    433         self.init_line_transforms()\n-    434\n---> 435         import sage.all # until sage's import hell is fixed\n-        sage.all = undefined\n-    436\n-    437         self.shell.verbose_quit = True\n-    438         self.set_quit_hook()\n-    439\n-    440         self.register_interface_magics()\n-    441\n-    442         if SAGE_IMPORTALL == 'yes':\n-    443             self.init_environment()\n-    444\n-    445     def register_interface_magics(self):\n-    446         \"\"\"\n-    447         Register magics for each of the Sage interfaces\n-    448         \"\"\"\n-    449         from sage.repl.interface_magic import InterfaceMagic\n-    450         InterfaceMagic.register_all(self.shell)\n-\n-/sage/local/lib/python3.7/site-packages/sage/all.py in <module>()\n-    110 # This import also sets up the interrupt handler\n-    111 from cysignals.signals import (AlarmInterrupt, SignalError,\n-    112         sig_on_reset as sig_on_count)\n-    113\n-    114 from time                import sleep\n-    115 from functools import reduce  # in order to keep reduce in python3\n-    116\n-    117 import sage.misc.lazy_import\n-    118\n-    119 from sage.misc.all       import *         # takes a while\n-    120 from sage.typeset.all    import *\n-    121 from sage.repl.all       import *\n-    122\n-    123 from sage.misc.sh import sh\n-    124\n---> 125 from sage.libs.all       import *\n-        global sage.libs.all = undefined\n-    126 from sage.data_structures.all import *\n-    127 from sage.doctest.all    import *\n-    128\n-    129 from sage.structure.all  import *\n-    130 from sage.rings.all      import *\n-    131 from sage.arith.all      import *\n-    132 from sage.matrix.all     import *\n-    133\n-    134 from sage.symbolic.all   import *\n-    135 from sage.modules.all    import *\n-    136 from sage.monoids.all    import *\n-    137 from sage.algebras.all   import *\n-    138 from sage.modular.all    import *\n-    139 from sage.sat.all        import *\n-    140 from sage.schemes.all    import *\n-\n-/sage/local/lib/python3.7/site-packages/sage/libs/all.py in <module>()\n-      1 from __future__ import absolute_import\n-      2\n-----> 3 import sage.libs.ntl.all as ntl\n-        global sage.libs.ntl.all = undefined\n-        global ntl = undefined\n-      4\n-      5 from sage.libs.pari.all import pari, pari_gen, PariError\n-      6\n-      7 import sage.libs.symmetrica.all as symmetrica\n-      8\n-      9 from sage.misc.lazy_import import lazy_import\n-     10 lazy_import('sage.libs.gap.libgap', 'libgap')\n-     11\n-     12 lazy_import('sage.libs.eclib.all', ('mwrank_EllipticCurve',\n-     13         'mwrank_MordellWeil', 'mwrank_initprimes', 'CremonaModularSymbols'))\n-     14 lazy_import('sage.libs.eclib.all', 'get_precision', 'mwrank_get_precision')\n-     15 lazy_import('sage.libs.eclib.all', 'set_precision', 'mwrank_set_precision')\n-\n-/sage/local/lib/python3.7/site-packages/sage/libs/ntl/all.py in <module>()\n-      9 #*****************************************************************************\n-     10 #       Copyright (C) 2005 William Stein <wstein@gmail.com>\n-     11 #\n-     12 #  Distributed under the terms of the GNU General Public License (GPL)\n-     13 #\n-     14 #    This code is distributed in the hope that it will be useful,\n-     15 #    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-     16 #    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-     17 #    General Public License for more details.\n-     18 #\n-     19 #  The full text of the GPL is available at:\n-     20 #\n-     21 #                  http://www.gnu.org/licenses/\n-     22 #*****************************************************************************\n-     23\n----> 24 from sage.libs.ntl.ntl_ZZ import (\n-        global sage.libs.ntl.ntl_ZZ = undefined\n-        global ntl_setSeed = undefined\n-        global ntl_ZZ = undefined\n-        global ZZ = undefined\n-        global randomBnd = undefined\n-        global ZZ_random = undefined\n-        global randomBits = undefined\n-        global ZZ_random_bits = undefined\n-     25                  ntl_setSeed, \\\n-     26                  ntl_ZZ as ZZ,\n-     27                  randomBnd as ZZ_random,\n-     28                  randomBits as ZZ_random_bits )\n-     29\n-     30 from sage.libs.ntl.ntl_ZZ_pContext import ntl_ZZ_pContext as ZZ_pContext\n-     31\n-     32 from sage.libs.ntl.ntl_ZZ_p import (\n-     33                  ntl_ZZ_p as ZZ_p,\n-     34                  ntl_ZZ_p_random_element as ZZ_p_random )\n-     35\n-     36 from sage.libs.ntl.ntl_ZZX import (\n-     37                  ntl_ZZX as ZZX,\n-     38                  zero_ZZX, one_ZZX )\n-     39\n-\n-/sage/local/lib/python3.7/site-packages/sage/libs/ntl/ntl_ZZ.pyx in init sage.libs.ntl.ntl_ZZ (build/cythonized/sage/libs/ntl/ntl_ZZ.cpp:9100)()\n-    443\n-    444         sage: ntl.ntl_setSeed(10)\n-    445         sage: ntl.ZZ_random(1000)\n-    446         935\n-    447     \"\"\"\n-    448     cdef ntl_ZZ seed = ntl_ZZ(1)\n-    449     if x is None:\n-    450         from random import randint\n-    451         seed = ntl_ZZ(randint(0,int(2)**64))\n-    452     else:\n-    453         seed = ntl_ZZ(x)\n-    454     sig_on()\n-    455     ZZ_SetSeed(seed.x)\n-    456     sig_off()\n-    457\n---> 458 ntl_setSeed()\n-        global ntl_setSeed = <built-in function ntl_setSeed>\n-    459\n-    460\n-    461 def randomBnd(q):\n-    462     r\"\"\"\n-    463     Return a random number in the range [0,n).\n-    464\n-    465     According to the NTL documentation, these numbers are\n-    466     \"cryptographically strong\"; of course, that depends in part on\n-    467     how they are seeded.\n-    468\n-    469     EXAMPLES::\n-    470\n-    471         sage: [ntl.ZZ_random(99999) for i in range(5)]\n-    472         [30675, 84282, 80559, 6939, 44798]\n-    473\n-\n-/sage/local/lib/python3.7/site-packages/sage/libs/ntl/ntl_ZZ.pyx in sage.libs.ntl.ntl_ZZ.ntl_setSeed (build/cythonized/sage/libs/ntl/ntl_ZZ.cpp:6106)()\n-    439         979\n-    440\n-    441     Now you can call this function, and it will not be overridden until\n-    442     the next time the main Sage random number seed is changed::\n-    443\n-    444         sage: ntl.ntl_setSeed(10)\n-    445         sage: ntl.ZZ_random(1000)\n-    446         935\n-    447     \"\"\"\n-    448     cdef ntl_ZZ seed = ntl_ZZ(1)\n-    449     if x is None:\n-    450         from random import randint\n-    451         seed = ntl_ZZ(randint(0,int(2)**64))\n-    452     else:\n-    453         seed = ntl_ZZ(x)\n---> 454     sig_on()\n-        global sig_on = undefined\n-    455     ZZ_SetSeed(seed.x)\n-    456     sig_off()\n-    457\n-    458 ntl_setSeed()\n-    459\n-    460\n-    461 def randomBnd(q):\n-    462     r\"\"\"\n-    463     Return a random number in the range [0,n).\n-    464\n-    465     According to the NTL documentation, these numbers are\n-    466     \"cryptographically strong\"; of course, that depends in part on\n-    467     how they are seeded.\n-    468\n-    469     EXAMPLES::\n-\n-SignalError: Illegal instruction\n-\n-**********************************************************************\n-\n-Oops, Sage crashed. We do our best to make it stable, but...\n-\n-A crash report was automatically generated with the following information:\n-  - A verbatim copy of the crash traceback.\n-  - A copy of your input history during this session.\n-  - Data on your current Sage configuration.\n-\n-It was left in the file named:\n-        '/home/Matthias Koeppe/.sage/ipython-5.0.0/Sage_crash_report.txt'\n-If you can email this file to the developers, the information in it will help\n-them in understanding and correcting the problem.\n-\n-You can mail it to: sage-support at sage-support@googlegroups.com\n-with the subject 'Sage Crash Report'.\n-\n-If you want to do it now, the following command will work (under Unix):\n-mail -s 'Sage Crash Report' sage-support@googlegroups.com < /home/Matthias Koeppe/.sage/ipython-5.0.0/Sage_crash_report.txt\n-\n-In your email, please also include information about:\n-- The operating system under which the crash happened: Linux, macOS, Windows,\n-  other, and which exact version (for example: Ubuntu 16.04.3, macOS 10.13.2,\n-  Windows 10 Pro), and whether it is 32-bit or 64-bit;\n-- How Sage was installed: using pip or conda, from GitHub, as part of\n-  a Docker container, or other, providing more detail if possible;\n-- How to reproduce the crash: what exact sequence of instructions can one\n-  input to get the same crash? Ideally, find a minimal yet complete sequence\n-  of instructions that yields the crash.\n-\n-To ensure accurate tracking of this issue, please file a report about it at:\n-http://trac.sagemath.org\n-\n-Hit <Enter> to quit (your terminal may close):\n-```\n``````\n",
    "created_at": "2021-03-12T21:41:30Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467272",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,531 +1,9 @@
-On `cygwin-standard`: After getting `sage-local-iii.tar` from the sage-local artifact produced by GitHub Actions, extracting it using `.github/workflows/extract-sage-local.sh` to the same directory (`/sage/local`) on a local machine, the resulting sage does not run.
+We fix several issues involving `SAGE_FAT_BINARY`:
 
-It looks like this:
+- `numpy` intrinsics need a special build flag in this mode
 
-```
+- `ntl` needs to disable use of a problematic instruction set
 
-$ ./sage
-This looks like the first time you are running Sage.
-Cleaning up, do not interrupt this.
-Done cleaning.
-
- SageMath version 9.1.rc0, Release Date: 2020-04-12                 
- Using Python 3.7.4. Type "help()" for help.                        
-
-
- Warning: this is a prerelease version, and it may be unstable.     
-
----------------------------------------------------------------------------
----------------------------------------------------------------------------
-SignalError                           Python 3.7.4: /sage/local/bin/python3
-                                                   Mon Apr 20 00:31:18 2020
-A problem occurred executing Python code.  Here is the sequence of function
-calls leading up to the error, with the most recent (innermost) call last.
-/cygdrive/c/sage/sage2/src/bin/sage-ipython in <module>()
-      1 #!/usr/bin/env sage-python
-      2 # -*- coding: utf-8 -*-
-      3 """
-      4 Sage IPython startup script.
-      5 """
-      6
-      7 # Display startup banner. Do this before anything else to give the user
-      8 # early feedback that Sage is starting.
-      9 from sage.misc.banner import banner
-     10 banner()
-     11
-     12 from sage.repl.interpreter import SageTerminalApp
-     13
-     14 app = SageTerminalApp.instance()
----> 15 app.initialize()
-        global app.initialize = <bound method TerminalIPythonApp.initialize of <sage.repl.interpreter.SageTerminalApp object at 0x6fffffec7710>>
-     16 app.start()
+- After #31064, the GH Actions tests for `cygwin` did not pass SAGE_FAT_BINARY to the actual build, randomly causing SIGILLs when a partial build was passed to the next stage through the `sage-local` artifact
 
-</sage/local/lib/python3.7/site-packages/decorator.py:decorator-gen-110> in initialize(self=<sage.repl.interpreter.SageTerminalApp object>, argv=None)
 
-/sage/local/lib/python3.7/site-packages/traitlets/config/application.py in catch_config_error(method=<function TerminalIPythonApp.initialize>, app=<sage.repl.interpreter.SageTerminalApp object>, *args=(None,), **kwargs={})
-     72     TRAITLETS_APPLICATION_RAISE_CONFIG_FILE_ERROR = False
-     73 else:
-     74     raise ValueError("Unsupported value for environment variable: 'TRAITLETS_APPLICATION_RAISE_CONFIG_FILE_ERROR' is set to '%s' which is none of  {'0', '1', 'false', 'true', ''}."% _envvar )
-     75
-     76
-     77 @decorator
-     78 def catch_config_error(method, app, *args, **kwargs):
-     79     """Method decorator for catching invalid config (Trait/ArgumentErrors) during init.
-     80
-     81     On a TraitError (generally caused by bad config), this will print the trait's
-     82     message, and exit the app.
-     83
-     84     For use on init methods, to prevent invoking excepthook on invalid input.
-     85     """
-     86     try:
----> 87         return method(app, *args, **kwargs)
-        method = <function TerminalIPythonApp.initialize at 0x6ffffec18560>
-        app = <sage.repl.interpreter.SageTerminalApp object at 0x6fffffec7710>
-        args = (None,)
-        kwargs = {}
-     88     except (TraitError, ArgumentError) as e:
-     89         app.print_help()
-     90         app.log.fatal("Bad config encountered during initialization:")
-     91         app.log.fatal(str(e))
-     92         app.log.debug("Config at the time: %s", app.config)
-     93         app.exit(1)
-     94
-     95
-     96 class ApplicationError(Exception):
-     97     pass
-     98
-     99
-    100 class LevelFormatter(logging.Formatter):
-    101     """Formatter with additional `highlevel` record
-    102
-
-/sage/local/lib/python3.7/site-packages/IPython/terminal/ipapp.py in initialize(self=<sage.repl.interpreter.SageTerminalApp object>, argv=None)
-    301
-    302         return super(TerminalIPythonApp, self).parse_command_line(argv)
-    303
-    304     @catch_config_error
-    305     def initialize(self, argv=None):
-    306         """Do actions after construct, but before starting the app."""
-    307         super(TerminalIPythonApp, self).initialize(argv)
-    308         if self.subapp is not None:
-    309             # don't bother initializing further, starting subapp
-    310             return
-    311         # print self.extra_args
-    312         if self.extra_args and not self.something_to_run:
-    313             self.file_to_run = self.extra_args[0]
-    314         self.init_path()
-    315         # create the shell
---> 316         self.init_shell()
-        self.init_shell = <bound method SageTerminalApp.init_shell of <sage.repl.interpreter.SageTerminalApp object at 0x6fffffec7710>>
-    317         # and draw the banner
-    318         self.init_banner()
-    319         # Now a variety of things that happen after the banner is printed.
-    320         self.init_gui_pylab()
-    321         self.init_extensions()
-    322         self.init_code()
-    323
-    324     def init_shell(self):
-    325         """initialize the InteractiveShell instance"""
-    326         # Create an InteractiveShell instance.
-    327         # shell.display_banner should always be False for the terminal
-    328         # based app, because we call shell.show_banner() by hand below
-    329         # so the banner shows *before* all extension loading stuff.
-    330         self.shell = self.interactive_shell_class.instance(parent=self,
-    331                         profile_dir=self.profile_dir,
-
-/sage/local/lib/python3.7/site-packages/sage/repl/interpreter.py in init_shell(self=<sage.repl.interpreter.SageTerminalApp object>)
-    772         self.shell.has_sage_extensions = SAGE_EXTENSION in self.extensions
-    773
-    774         # Load the %lprun extension if available
-    775         try:
-    776             import line_profiler
-    777         except ImportError:
-    778             pass
-    779         else:
-    780             self.extensions.append('line_profiler')
-    781
-    782         if self.shell.has_sage_extensions:
-    783             self.extensions.remove(SAGE_EXTENSION)
-    784
-    785             # load sage extension here to get a crash if
-    786             # something is wrong with the sage library
---> 787             self.shell.extension_manager.load_extension(SAGE_EXTENSION)
-        self.shell.extension_manager.load_extension = <bound method ExtensionManager.load_extension of <IPython.core.extensions.ExtensionManager object at 0x6ffffec1dc90>>
-        global SAGE_EXTENSION = 'sage'
-    788
-    789
-
-/sage/local/lib/python3.7/site-packages/IPython/core/extensions.py in load_extension(self=<IPython.core.extensions.ExtensionManager object>, module_str='sage')
-     70
-     71         Returns the string "already loaded" if the extension is already loaded,
-     72         "no load function" if the module doesn't have a load_ipython_extension
-     73         function, or None if it succeeded.
-     74         """
-     75         if module_str in self.loaded:
-     76             return "already loaded"
-     77
-     78         from IPython.utils.syspathcontext import prepended_to_syspath
-     79
-     80         with self.shell.builtin_trap:
-     81             if module_str not in sys.modules:
-     82                 with prepended_to_syspath(self.ipython_extension_dir):
-     83                     __import__(module_str)
-     84             mod = sys.modules[module_str]
----> 85             if self._call_load_ipython_extension(mod):
-        self._call_load_ipython_extension = <bound method ExtensionManager._call_load_ipython_extension of <IPython.core.extensions.ExtensionManager object at 0x6ffffec1dc90>>
-        mod = <module 'sage' from '/sage/local/lib/python3.7/site-packages/sage/__init__.py'>
-     86                 self.loaded.add(module_str)
-     87             else:
-     88                 return "no load function"
-     89
-     90     def unload_extension(self, module_str):
-     91         """Unload an IPython extension by its module name.
-     92
-     93         This function looks up the extension's name in ``sys.modules`` and
-     94         simply calls ``mod.unload_ipython_extension(self)``.
-     95
-     96         Returns the string "no unload function" if the extension doesn't define
-     97         a function to unload itself, "not loaded" if the extension isn't loaded,
-     98         otherwise None.
-     99         """
-    100         if module_str not in self.loaded:
-
-/sage/local/lib/python3.7/site-packages/IPython/core/extensions.py in _call_load_ipython_extension(self=<IPython.core.extensions.ExtensionManager object>, mod=<module 'sage' from '/sage/local/lib/python3.7/site-packages/sage/__init__.py'>)
-    117         """
-    118         from IPython.utils.syspathcontext import prepended_to_syspath
-    119
-    120         if (module_str in self.loaded) and (module_str in sys.modules):
-    121             self.unload_extension(module_str)
-    122             mod = sys.modules[module_str]
-    123             with prepended_to_syspath(self.ipython_extension_dir):
-    124                 reload(mod)
-    125             if self._call_load_ipython_extension(mod):
-    126                 self.loaded.add(module_str)
-    127         else:
-    128             self.load_extension(module_str)
-    129
-    130     def _call_load_ipython_extension(self, mod):
-    131         if hasattr(mod, 'load_ipython_extension'):
---> 132             mod.load_ipython_extension(self.shell)
-        mod.load_ipython_extension = <function load_ipython_extension at 0x6fffffde1710>
-        self.shell = <sage.repl.interpreter.SageTerminalInteractiveShell object at 0x6fffffec79d0>
-    133             return True
-    134
-    135     def _call_unload_ipython_extension(self, mod):
-    136         if hasattr(mod, 'unload_ipython_extension'):
-    137             mod.unload_ipython_extension(self.shell)
-    138             return True
-    139
-    140     def install_extension(self, url, filename=None):
-    141         """Download and install an IPython extension.
-    142
-    143         If filename is given, the file will be so named (inside the extension
-    144         directory). Otherwise, the name from the URL will be used. The file must
-    145         have a .py or .zip extension; otherwise, a ValueError will be raised.
-    146
-    147         Returns the full path to the installed file.
-
-/sage/local/lib/python3.7/site-packages/sage/__init__.py in load_ipython_extension(*args=(<sage.repl.interpreter.SageTerminalInteractiveShell object>,))
-      1 __all__ = ['all']
-      2
-      3 # Set sage.__version__ to the current version number. This is analogous
-      4 # to many other Python packages.
-      5 from sage.version import version as __version__
-      6
-      7 # Make sure that the correct zlib library is loaded. This is needed
-      8 # to prevent the system zlib to be loaded instead of the Sage one.
-      9 # See https://trac.sagemath.org/ticket/23122
-     10 import zlib
-     11
-     12 # IPython calls this when starting up
-     13 def load_ipython_extension(*args):
-     14     import sage.repl.ipython_extension
----> 15     sage.repl.ipython_extension.load_ipython_extension(*args)
-        sage.repl.ipython_extension.load_ipython_extension = <function load_ipython_extension at 0x6ffffe3f27a0>
-        args = (<sage.repl.interpreter.SageTerminalInteractiveShell object at 0x6fffffec79d0>,)
-     16
-     17
-     18 # Monkey-patch inspect.isfunction() to support Cython functions.
-     19 def isfunction(obj):
-     20     """
-     21     Check whether something is a function.
-     22
-     23     We assume that anything which has a genuine ``__code__``
-     24     attribute (not using ``__getattr__`` overrides) is a function.
-     25     This is meant to support Cython functions.
-     26
-     27     EXAMPLES::
-     28
-     29         sage: from inspect import isfunction
-     30         sage: def f(): pass
-     31         sage: isfunction(f)
-
-/sage/local/lib/python3.7/site-packages/sage/repl/ipython_extension.py in wrapper(*args=(<sage.repl.interpreter.SageTerminalInteractiveShell object>,), **kwargs={})
-    549         ....:     if work:
-    550         ....:         return 'foo worked'
-    551         ....:     raise RuntimeError("foo didn't work")
-    552         sage: foo(False)
-    553         Traceback (most recent call last):
-    554         ...
-    555         RuntimeError: foo didn't work
-    556         sage: foo(True)
-    557         'foo worked'
-    558         sage: foo(False)
-    559         sage: foo(True)
-    560     """
-    561     @wraps(func)
-    562     def wrapper(*args, **kwargs):
-    563         if not wrapper.has_run:
---> 564             result = func(*args, **kwargs)
-        result = undefined
-        global func = undefined
-        args = (<sage.repl.interpreter.SageTerminalInteractiveShell object at 0x6fffffec79d0>,)
-        kwargs = {}
-    565             wrapper.has_run = True
-    566             return result
-    567     wrapper.has_run = False
-    568     return wrapper
-    569
-    570
-    571 @run_once
-    572 def load_ipython_extension(ip):
-    573     """
-    574     Load the extension in IPython.
-    575     """
-    576     # this modifies ip
-    577     SageCustomizations(shell=ip)
-
-/sage/local/lib/python3.7/site-packages/sage/repl/ipython_extension.py in load_ipython_extension(ip=<sage.repl.interpreter.SageTerminalInteractiveShell object>)
-    562     def wrapper(*args, **kwargs):
-    563         if not wrapper.has_run:
-    564             result = func(*args, **kwargs)
-    565             wrapper.has_run = True
-    566             return result
-    567     wrapper.has_run = False
-    568     return wrapper
-    569
-    570
-    571 @run_once
-    572 def load_ipython_extension(ip):
-    573     """
-    574     Load the extension in IPython.
-    575     """
-    576     # this modifies ip
---> 577     SageCustomizations(shell=ip)
-        global SageCustomizations = <class 'sage.repl.ipython_extension.SageCustomizations'>
-        global shell = undefined
-        ip = <sage.repl.interpreter.SageTerminalInteractiveShell object at 0x6fffffec79d0>
-
-/sage/local/lib/python3.7/site-packages/sage/repl/ipython_extension.py in __init__(self=<sage.repl.ipython_extension.SageCustomizations object>, shell=<sage.repl.interpreter.SageTerminalInteractiveShell object>)
-    420     def __init__(self, shell=None):
-    421         """
-    422         Initialize the Sage plugin.
-    423         """
-    424         self.shell = shell
-    425
-    426         self.auto_magics = SageMagics(shell)
-    427         self.shell.register_magics(self.auto_magics)
-    428
-    429         import sage.misc.edit_module as edit_module
-    430         self.shell.set_hook('editor', edit_module.edit_devel)
-    431
-    432         self.init_inspector()
-    433         self.init_line_transforms()
-    434
---> 435         import sage.all # until sage's import hell is fixed
-        sage.all = undefined
-    436
-    437         self.shell.verbose_quit = True
-    438         self.set_quit_hook()
-    439
-    440         self.register_interface_magics()
-    441
-    442         if SAGE_IMPORTALL == 'yes':
-    443             self.init_environment()
-    444
-    445     def register_interface_magics(self):
-    446         """
-    447         Register magics for each of the Sage interfaces
-    448         """
-    449         from sage.repl.interface_magic import InterfaceMagic
-    450         InterfaceMagic.register_all(self.shell)
-
-/sage/local/lib/python3.7/site-packages/sage/all.py in <module>()
-    110 # This import also sets up the interrupt handler
-    111 from cysignals.signals import (AlarmInterrupt, SignalError,
-    112         sig_on_reset as sig_on_count)
-    113
-    114 from time                import sleep
-    115 from functools import reduce  # in order to keep reduce in python3
-    116
-    117 import sage.misc.lazy_import
-    118
-    119 from sage.misc.all       import *         # takes a while
-    120 from sage.typeset.all    import *
-    121 from sage.repl.all       import *
-    122
-    123 from sage.misc.sh import sh
-    124
---> 125 from sage.libs.all       import *
-        global sage.libs.all = undefined
-    126 from sage.data_structures.all import *
-    127 from sage.doctest.all    import *
-    128
-    129 from sage.structure.all  import *
-    130 from sage.rings.all      import *
-    131 from sage.arith.all      import *
-    132 from sage.matrix.all     import *
-    133
-    134 from sage.symbolic.all   import *
-    135 from sage.modules.all    import *
-    136 from sage.monoids.all    import *
-    137 from sage.algebras.all   import *
-    138 from sage.modular.all    import *
-    139 from sage.sat.all        import *
-    140 from sage.schemes.all    import *
-
-/sage/local/lib/python3.7/site-packages/sage/libs/all.py in <module>()
-      1 from __future__ import absolute_import
-      2
-----> 3 import sage.libs.ntl.all as ntl
-        global sage.libs.ntl.all = undefined
-        global ntl = undefined
-      4
-      5 from sage.libs.pari.all import pari, pari_gen, PariError
-      6
-      7 import sage.libs.symmetrica.all as symmetrica
-      8
-      9 from sage.misc.lazy_import import lazy_import
-     10 lazy_import('sage.libs.gap.libgap', 'libgap')
-     11
-     12 lazy_import('sage.libs.eclib.all', ('mwrank_EllipticCurve',
-     13         'mwrank_MordellWeil', 'mwrank_initprimes', 'CremonaModularSymbols'))
-     14 lazy_import('sage.libs.eclib.all', 'get_precision', 'mwrank_get_precision')
-     15 lazy_import('sage.libs.eclib.all', 'set_precision', 'mwrank_set_precision')
-
-/sage/local/lib/python3.7/site-packages/sage/libs/ntl/all.py in <module>()
-      9 #*****************************************************************************
-     10 #       Copyright (C) 2005 William Stein <wstein@gmail.com>
-     11 #
-     12 #  Distributed under the terms of the GNU General Public License (GPL)
-     13 #
-     14 #    This code is distributed in the hope that it will be useful,
-     15 #    but WITHOUT ANY WARRANTY; without even the implied warranty of
-     16 #    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-     17 #    General Public License for more details.
-     18 #
-     19 #  The full text of the GPL is available at:
-     20 #
-     21 #                  http://www.gnu.org/licenses/
-     22 #*****************************************************************************
-     23
----> 24 from sage.libs.ntl.ntl_ZZ import (
-        global sage.libs.ntl.ntl_ZZ = undefined
-        global ntl_setSeed = undefined
-        global ntl_ZZ = undefined
-        global ZZ = undefined
-        global randomBnd = undefined
-        global ZZ_random = undefined
-        global randomBits = undefined
-        global ZZ_random_bits = undefined
-     25                  ntl_setSeed, \
-     26                  ntl_ZZ as ZZ,
-     27                  randomBnd as ZZ_random,
-     28                  randomBits as ZZ_random_bits )
-     29
-     30 from sage.libs.ntl.ntl_ZZ_pContext import ntl_ZZ_pContext as ZZ_pContext
-     31
-     32 from sage.libs.ntl.ntl_ZZ_p import (
-     33                  ntl_ZZ_p as ZZ_p,
-     34                  ntl_ZZ_p_random_element as ZZ_p_random )
-     35
-     36 from sage.libs.ntl.ntl_ZZX import (
-     37                  ntl_ZZX as ZZX,
-     38                  zero_ZZX, one_ZZX )
-     39
-
-/sage/local/lib/python3.7/site-packages/sage/libs/ntl/ntl_ZZ.pyx in init sage.libs.ntl.ntl_ZZ (build/cythonized/sage/libs/ntl/ntl_ZZ.cpp:9100)()
-    443
-    444         sage: ntl.ntl_setSeed(10)
-    445         sage: ntl.ZZ_random(1000)
-    446         935
-    447     """
-    448     cdef ntl_ZZ seed = ntl_ZZ(1)
-    449     if x is None:
-    450         from random import randint
-    451         seed = ntl_ZZ(randint(0,int(2)**64))
-    452     else:
-    453         seed = ntl_ZZ(x)
-    454     sig_on()
-    455     ZZ_SetSeed(seed.x)
-    456     sig_off()
-    457
---> 458 ntl_setSeed()
-        global ntl_setSeed = <built-in function ntl_setSeed>
-    459
-    460
-    461 def randomBnd(q):
-    462     r"""
-    463     Return a random number in the range [0,n).
-    464
-    465     According to the NTL documentation, these numbers are
-    466     "cryptographically strong"; of course, that depends in part on
-    467     how they are seeded.
-    468
-    469     EXAMPLES::
-    470
-    471         sage: [ntl.ZZ_random(99999) for i in range(5)]
-    472         [30675, 84282, 80559, 6939, 44798]
-    473
-
-/sage/local/lib/python3.7/site-packages/sage/libs/ntl/ntl_ZZ.pyx in sage.libs.ntl.ntl_ZZ.ntl_setSeed (build/cythonized/sage/libs/ntl/ntl_ZZ.cpp:6106)()
-    439         979
-    440
-    441     Now you can call this function, and it will not be overridden until
-    442     the next time the main Sage random number seed is changed::
-    443
-    444         sage: ntl.ntl_setSeed(10)
-    445         sage: ntl.ZZ_random(1000)
-    446         935
-    447     """
-    448     cdef ntl_ZZ seed = ntl_ZZ(1)
-    449     if x is None:
-    450         from random import randint
-    451         seed = ntl_ZZ(randint(0,int(2)**64))
-    452     else:
-    453         seed = ntl_ZZ(x)
---> 454     sig_on()
-        global sig_on = undefined
-    455     ZZ_SetSeed(seed.x)
-    456     sig_off()
-    457
-    458 ntl_setSeed()
-    459
-    460
-    461 def randomBnd(q):
-    462     r"""
-    463     Return a random number in the range [0,n).
-    464
-    465     According to the NTL documentation, these numbers are
-    466     "cryptographically strong"; of course, that depends in part on
-    467     how they are seeded.
-    468
-    469     EXAMPLES::
-
-SignalError: Illegal instruction
-
-**********************************************************************
-
-Oops, Sage crashed. We do our best to make it stable, but...
-
-A crash report was automatically generated with the following information:
-  - A verbatim copy of the crash traceback.
-  - A copy of your input history during this session.
-  - Data on your current Sage configuration.
-
-It was left in the file named:
-        '/home/Matthias Koeppe/.sage/ipython-5.0.0/Sage_crash_report.txt'
-If you can email this file to the developers, the information in it will help
-them in understanding and correcting the problem.
-
-You can mail it to: sage-support at sage-support@googlegroups.com
-with the subject 'Sage Crash Report'.
-
-If you want to do it now, the following command will work (under Unix):
-mail -s 'Sage Crash Report' sage-support@googlegroups.com < /home/Matthias Koeppe/.sage/ipython-5.0.0/Sage_crash_report.txt
-
-In your email, please also include information about:
-- The operating system under which the crash happened: Linux, macOS, Windows,
-  other, and which exact version (for example: Ubuntu 16.04.3, macOS 10.13.2,
-  Windows 10 Pro), and whether it is 32-bit or 64-bit;
-- How Sage was installed: using pip or conda, from GitHub, as part of
-  a Docker container, or other, providing more detail if possible;
-- How to reproduce the crash: what exact sequence of instructions can one
-  input to get the same crash? Ideally, find a minimal yet complete sequence
-  of instructions that yields the crash.
-
-To ensure accurate tracking of this issue, please file a report about it at:
-http://trac.sagemath.org
-
-Hit <Enter> to quit (your terminal may close):
-```
``````




---

archive/issue_comments_467273.json:
```json
{
    "body": "<a id='comment:56'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c76bd917e4d36b0414af9875cdb75f1cf4be5aa1\">c76bd91</a></td><td><code>.github/workflows/ci-cygwin*.yml: Fix up for cpuinfo output</code></td></tr></table>\n",
    "created_at": "2021-03-12T21:54:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c76bd917e4d36b0414af9875cdb75f1cf4be5aa1">c76bd91</a></td><td><code>.github/workflows/ci-cygwin*.yml: Fix up for cpuinfo output</code></td></tr></table>




---

archive/issue_comments_467274.json:
```json
{
    "body": "**Changing commit** from \"[f6ec2c962e79469275f1d99c79524bfe4eac6be5](https://github.com/sagemath/sagetrac-mirror/commit/f6ec2c962e79469275f1d99c79524bfe4eac6be5)\" to \"[c76bd917e4d36b0414af9875cdb75f1cf4be5aa1](https://github.com/sagemath/sagetrac-mirror/commit/c76bd917e4d36b0414af9875cdb75f1cf4be5aa1)\".",
    "created_at": "2021-03-12T21:54:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f6ec2c962e79469275f1d99c79524bfe4eac6be5](https://github.com/sagemath/sagetrac-mirror/commit/f6ec2c962e79469275f1d99c79524bfe4eac6be5)" to "[c76bd917e4d36b0414af9875cdb75f1cf4be5aa1](https://github.com/sagemath/sagetrac-mirror/commit/c76bd917e4d36b0414af9875cdb75f1cf4be5aa1)".



---

archive/issue_comments_467275.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/647496577\" to \"https://github.com/mkoeppe/sage/actions/runs/647547421\".",
    "created_at": "2021-03-12T21:57:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467275",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/647496577" to "https://github.com/mkoeppe/sage/actions/runs/647547421".



---

archive/issue_comments_467276.json:
```json
{
    "body": "<a id='comment:58'></a>\nIn https://github.com/mkoeppe/sage/runs/2099002937?check_suite_focus=true I see a build failure:\n\n```\n  ...\n  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatm6_: symbol not defined\n  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatm6_: symbol not defined\n  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatme_: symbol not defined\n  ...\n```",
    "created_at": "2021-03-13T06:25:57Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467276",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
In https://github.com/mkoeppe/sage/runs/2099002937?check_suite_focus=true I see a build failure:

```
  ...
  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatm6_: symbol not defined
  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatm6_: symbol not defined
  [openblas-0.3.13]   /usr/lib/gcc/x86_64-pc-cygwin/10/../../../../x86_64-pc-cygwin/bin/ld: cannot export zlatme_: symbol not defined
  ...
```



---

archive/issue_comments_467277.json:
```json
{
    "body": "<a id='comment:59'></a>\nThe full log does not reveal a specific error message, but building one object fails, it looks like gcc crashes. \n\nAnd in a second attempt in the same run, the build succeeds.",
    "created_at": "2021-03-13T06:44:21Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467277",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
The full log does not reveal a specific error message, but building one object fails, it looks like gcc crashes. 

And in a second attempt in the same run, the build succeeds.



---

archive/attachments_022058.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "openblas-0.3.13.log",
    "asset_url": "tarball://root/attachments/ticket29537/openblas-0.3.13.log",
    "created_at": "2021-03-13T16:54:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket29537/openblas-0.3.13.log",
    "user": "https://github.com/mkoeppe"
}
```



---

archive/issue_comments_467278.json:
```json
{
    "body": "**Attachment:** [openblas-0.3.13.log](https://github.com/sagemath/sage/files/ticket29537/openblas-0.3.13.log)",
    "created_at": "2021-03-13T16:54:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467278",
    "user": "https://github.com/mkoeppe"
}
```

**Attachment:** [openblas-0.3.13.log](https://github.com/sagemath/sage/files/ticket29537/openblas-0.3.13.log)



---

archive/issue_comments_467279.json:
```json
{
    "body": "<a id='comment:60'></a>\nUpon restarting the workflow, the `openblas` build succeeds without issues. \nRunning into rebasing issues again (haven't seen this in a while!) https://github.com/mkoeppe/sage/runs/2103478775?check_suite_focus=true\n\n```\n  [pillow-8.0.1]         0 [main] python3 47699 child_info_fork::abort: address space needed by 'Scanners.cpython-38-x86_64-cygwin.dll' (0x400000) is already occupied\n  [pillow-8.0.1]         0 [main] python3 47700 child_info_fork::abort: address space needed by 'Scanners.cpython-38-x86_64-cygwin.dll' (0x400000) is already occupied\n```",
    "created_at": "2021-03-13T20:37:42Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467279",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>
Upon restarting the workflow, the `openblas` build succeeds without issues. 
Running into rebasing issues again (haven't seen this in a while!) https://github.com/mkoeppe/sage/runs/2103478775?check_suite_focus=true

```
  [pillow-8.0.1]         0 [main] python3 47699 child_info_fork::abort: address space needed by 'Scanners.cpython-38-x86_64-cygwin.dll' (0x400000) is already occupied
  [pillow-8.0.1]         0 [main] python3 47700 child_info_fork::abort: address space needed by 'Scanners.cpython-38-x86_64-cygwin.dll' (0x400000) is already occupied
```



---

archive/issue_comments_467280.json:
```json
{
    "body": "<a id='comment:61'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2037d68daf7c7389b7ba9357499b538969604b74\">2037d68</a></td><td><code>build/bin/sage-print-system-package-command [CYGWIN]: Fix typo</code></td></tr></table>\n",
    "created_at": "2021-03-14T20:19:35Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2037d68daf7c7389b7ba9357499b538969604b74">2037d68</a></td><td><code>build/bin/sage-print-system-package-command [CYGWIN]: Fix typo</code></td></tr></table>




---

archive/issue_comments_467281.json:
```json
{
    "body": "**Changing commit** from \"[c76bd917e4d36b0414af9875cdb75f1cf4be5aa1](https://github.com/sagemath/sagetrac-mirror/commit/c76bd917e4d36b0414af9875cdb75f1cf4be5aa1)\" to \"[2037d68daf7c7389b7ba9357499b538969604b74](https://github.com/sagemath/sagetrac-mirror/commit/2037d68daf7c7389b7ba9357499b538969604b74)\".",
    "created_at": "2021-03-14T20:19:35Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c76bd917e4d36b0414af9875cdb75f1cf4be5aa1](https://github.com/sagemath/sagetrac-mirror/commit/c76bd917e4d36b0414af9875cdb75f1cf4be5aa1)" to "[2037d68daf7c7389b7ba9357499b538969604b74](https://github.com/sagemath/sagetrac-mirror/commit/2037d68daf7c7389b7ba9357499b538969604b74)".



---

archive/issue_comments_467282.json:
```json
{
    "body": "<a id='comment:62'></a>\nThat's weird.  `Scanners.cpython-38-x86_64-cygwin.dll` is part of Cython.  This suggests that rebase failed after installing Cython, or possibly that Cython had just been installed but the rebase lock was still held.  It doesn't look that way from the logs though; I would have thought Cython was installed in an earlier stage.",
    "created_at": "2021-03-17T16:04:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467282",
    "user": "https://github.com/embray"
}
```

<a id='comment:62'></a>
That's weird.  `Scanners.cpython-38-x86_64-cygwin.dll` is part of Cython.  This suggests that rebase failed after installing Cython, or possibly that Cython had just been installed but the rebase lock was still held.  It doesn't look that way from the logs though; I would have thought Cython was installed in an earlier stage.



---

archive/issue_comments_467283.json:
```json
{
    "body": "<a id='comment:63'></a>\nFrom the logs from the previous stage of that run:\n\n```\nCopying package files from temporary location /opt/sage-461876e6c77b59756ad9db557c884486eb40881e/var/tmp/sage/build/cython-0.29.21/inst to /opt/sage-461876e6c77b59756ad9db557c884486eb40881e\nWaiting for rebase lock\nGetting list of dlls. This may take a while...\nNow rebasing...\nSuccessfully installed cython-0.29.21\n```\n\nSo that's mysterious.",
    "created_at": "2021-03-17T16:12:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467283",
    "user": "https://github.com/embray"
}
```

<a id='comment:63'></a>
From the logs from the previous stage of that run:

```
Copying package files from temporary location /opt/sage-461876e6c77b59756ad9db557c884486eb40881e/var/tmp/sage/build/cython-0.29.21/inst to /opt/sage-461876e6c77b59756ad9db557c884486eb40881e
Waiting for rebase lock
Getting list of dlls. This may take a while...
Now rebasing...
Successfully installed cython-0.29.21
```

So that's mysterious.



---

archive/issue_comments_467284.json:
```json
{
    "body": "<a id='comment:64'></a>\nThanks for looking into this -- I really need your expertise here! \n\nI run rebasing at the end of `.github/workflows/extract-sage-local.sh` - to make sure that the downloaded stages that have been built in parallel can work together.",
    "created_at": "2021-03-17T16:36:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467284",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>
Thanks for looking into this -- I really need your expertise here! 

I run rebasing at the end of `.github/workflows/extract-sage-local.sh` - to make sure that the downloaded stages that have been built in parallel can work together.



---

archive/issue_comments_467285.json:
```json
{
    "body": "<a id='comment:65'></a>\nOn [this build](https://github.com/mkoeppe/sage/runs/2129378838?check_suite_focus=true) I notice during \"Extract sage-local artifact\":\n\n```\nFilesystem       Size  Used Avail Use% Mounted on\nC:/tools/cygwin  256G  170G   86G  67% /\nD:                14G  2.2G   12G  16% /cygdrive/d\nGetting list of dlls. This may take a while...\nNow rebasing...\nrebaseall: only ash or dash processes are allowed during rebasing\n    Exit all Cygwin processes and stop all Cygwin services.\n    Execute ash (or dash) from Start/Run... or a cmd or command window.\n    Execute '/bin/rebaseall' from ash (or dash).\nError: Process completed with exit code 1.\n```\n\nIf you want to do a full rebase in this step it can't be called from a shell script run with /bin/bash.  The script either needs to be run with dash, or as a separate command with dash.",
    "created_at": "2021-03-17T16:36:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467285",
    "user": "https://github.com/embray"
}
```

<a id='comment:65'></a>
On [this build](https://github.com/mkoeppe/sage/runs/2129378838?check_suite_focus=true) I notice during "Extract sage-local artifact":

```
Filesystem       Size  Used Avail Use% Mounted on
C:/tools/cygwin  256G  170G   86G  67% /
D:                14G  2.2G   12G  16% /cygdrive/d
Getting list of dlls. This may take a while...
Now rebasing...
rebaseall: only ash or dash processes are allowed during rebasing
    Exit all Cygwin processes and stop all Cygwin services.
    Execute ash (or dash) from Start/Run... or a cmd or command window.
    Execute '/bin/rebaseall' from ash (or dash).
Error: Process completed with exit code 1.
```

If you want to do a full rebase in this step it can't be called from a shell script run with /bin/bash.  The script either needs to be run with dash, or as a separate command with dash.



---

archive/issue_comments_467286.json:
```json
{
    "body": "<a id='comment:66'></a>\nYes, in this run I tried to fix the problem by changing to `rebaseall`...",
    "created_at": "2021-03-17T16:37:34Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467286",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>
Yes, in this run I tried to fix the problem by changing to `rebaseall`...



---

archive/issue_comments_467287.json:
```json
{
    "body": "<a id='comment:67'></a>\nReplying to [mkoeppe](#comment%3A66):\n> Yes, in this run I tried to fix the problem by changing to `rebaseall`...\n\nAh, OK.  I think that's a good idea.  It just needs to be run outside a Cygwin process with no other Cygwin processes running (since it can also modify the cygwin DLL itself and other support libraries that are not normally touched by plain `rebase`).",
    "created_at": "2021-03-17T16:41:57Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467287",
    "user": "https://github.com/embray"
}
```

<a id='comment:67'></a>
Replying to [mkoeppe](#comment%3A66):
> Yes, in this run I tried to fix the problem by changing to `rebaseall`...

Ah, OK.  I think that's a good idea.  It just needs to be run outside a Cygwin process with no other Cygwin processes running (since it can also modify the cygwin DLL itself and other support libraries that are not normally touched by plain `rebase`).



---

archive/issue_comments_467288.json:
```json
{
    "body": "<a id='comment:68'></a>\nIs this the cygwin `dash` that should be used?",
    "created_at": "2021-03-17T16:51:01Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467288",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>
Is this the cygwin `dash` that should be used?



---

archive/issue_comments_467289.json:
```json
{
    "body": "<a id='comment:69'></a>\nYes, or you can just call `C:\\cygwin64\\bin\\rebaseall` directly without going through a shell, I think.",
    "created_at": "2021-03-17T17:19:20Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467289",
    "user": "https://github.com/embray"
}
```

<a id='comment:69'></a>
Yes, or you can just call `C:\cygwin64\bin\rebaseall` directly without going through a shell, I think.



---

archive/issue_comments_467290.json:
```json
{
    "body": "<a id='comment:70'></a>\nRight, but I want to keep it in the extraction script so that it is easy to use manually too",
    "created_at": "2021-03-17T18:18:35Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467290",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>
Right, but I want to keep it in the extraction script so that it is easy to use manually too



---

archive/issue_comments_467291.json:
```json
{
    "body": "<a id='comment:71'></a>\nOK, testing with dash at https://github.com/mkoeppe/sage/actions/runs/662065807",
    "created_at": "2021-03-17T18:33:11Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467291",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>
OK, testing with dash at https://github.com/mkoeppe/sage/actions/runs/662065807



---

archive/issue_comments_467292.json:
```json
{
    "body": "<a id='comment:72'></a>\nThis worked! https://github.com/mkoeppe/sage/runs/2134463553\n\nI'll push the fixes to this ticket.",
    "created_at": "2021-03-17T21:58:22Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467292",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>
This worked! https://github.com/mkoeppe/sage/runs/2134463553

I'll push the fixes to this ticket.



---

archive/issue_comments_467293.json:
```json
{
    "body": "<a id='comment:73'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0df00cdb0843e917a14817c778e235cb8399246\">d0df00c</a></td><td><code>.github/workflows/extract-sage-local.sh: Use sage-rebase.sh --all</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da978f85227ad4380b54f471b131bb82d48524bd\">da978f8</a></td><td><code>.github/workflows/{extract-sage-local.sh, ci-cygwin-*.yml): Use /bin/dash for scripts invoking rebaseall</code></td></tr></table>\n",
    "created_at": "2021-03-17T22:06:46Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467293",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:73'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0df00cdb0843e917a14817c778e235cb8399246">d0df00c</a></td><td><code>.github/workflows/extract-sage-local.sh: Use sage-rebase.sh --all</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da978f85227ad4380b54f471b131bb82d48524bd">da978f8</a></td><td><code>.github/workflows/{extract-sage-local.sh, ci-cygwin-*.yml): Use /bin/dash for scripts invoking rebaseall</code></td></tr></table>




---

archive/issue_comments_467294.json:
```json
{
    "body": "**Changing commit** from \"[2037d68daf7c7389b7ba9357499b538969604b74](https://github.com/sagemath/sagetrac-mirror/commit/2037d68daf7c7389b7ba9357499b538969604b74)\" to \"[da978f85227ad4380b54f471b131bb82d48524bd](https://github.com/sagemath/sagetrac-mirror/commit/da978f85227ad4380b54f471b131bb82d48524bd)\".",
    "created_at": "2021-03-17T22:06:46Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2037d68daf7c7389b7ba9357499b538969604b74](https://github.com/sagemath/sagetrac-mirror/commit/2037d68daf7c7389b7ba9357499b538969604b74)" to "[da978f85227ad4380b54f471b131bb82d48524bd](https://github.com/sagemath/sagetrac-mirror/commit/da978f85227ad4380b54f471b131bb82d48524bd)".



---

archive/issue_comments_467295.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/647547421\" to \"https://github.com/mkoeppe/sage/actions/runs/662602246\".",
    "created_at": "2021-03-17T22:14:31Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467295",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/647547421" to "https://github.com/mkoeppe/sage/actions/runs/662602246".



---

archive/issue_comments_467296.json:
```json
{
    "body": "<a id='comment:74'></a>\nNow testing at https://github.com/mkoeppe/sage/actions/runs/662602246",
    "created_at": "2021-03-17T22:14:31Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467296",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'></a>
Now testing at https://github.com/mkoeppe/sage/actions/runs/662602246



---

archive/issue_comments_467297.json:
```json
{
    "body": "<a id='comment:75'></a>\nWith the rebasing fixes applied, I am getting again to `sage-iii` (https://github.com/mkoeppe/sage/runs/2140904387?check_suite_focus=true)\n\n```\n  [sagelib-9.3.beta9]   Generating auto-generated sources\n  [sagelib-9.3.beta9]   Building interpreters for fast_callable\n  [sagelib-9.3.beta9]   -> First build of interpreters\n  [sagelib-9.3.beta9]   running build_cython\n  [sagelib-9.3.beta9]   Enabling Cython debugging support\n  [sagelib-9.3.beta9]   /cygdrive/d/a/sage/sage/build/pkgs/sagelib/spkg-install: line 58: 61038 Illegal instruction     (core dumped) python3 -u setup.py --no-user-cfg build install\n```\nwhich is again coming from `numpy`, I think.\nHelp....",
    "created_at": "2021-03-18T22:19:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467297",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>
With the rebasing fixes applied, I am getting again to `sage-iii` (https://github.com/mkoeppe/sage/runs/2140904387?check_suite_focus=true)

```
  [sagelib-9.3.beta9]   Generating auto-generated sources
  [sagelib-9.3.beta9]   Building interpreters for fast_callable
  [sagelib-9.3.beta9]   -> First build of interpreters
  [sagelib-9.3.beta9]   running build_cython
  [sagelib-9.3.beta9]   Enabling Cython debugging support
  [sagelib-9.3.beta9]   /cygdrive/d/a/sage/sage/build/pkgs/sagelib/spkg-install: line 58: 61038 Illegal instruction     (core dumped) python3 -u setup.py --no-user-cfg build install
```
which is again coming from `numpy`, I think.
Help....



---

archive/issue_comments_467298.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/662602246\" to \"Matthias Koeppe, ..., https://github.com/mkoeppe/sage/actions/runs/662602246\".",
    "created_at": "2021-03-19T03:32:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467298",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/662602246" to "Matthias Koeppe, ..., https://github.com/mkoeppe/sage/actions/runs/662602246".



---

archive/issue_comments_467299.json:
```json
{
    "body": "<a id='comment:76'></a>\nBut the current branch is already an improvement, so let's get this in...",
    "created_at": "2021-03-19T03:32:02Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467299",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'></a>
But the current branch is already an improvement, so let's get this in...



---

archive/issue_events_263050.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-19T08:33:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263050"
}
```



---

archive/issue_events_263051.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-19T08:33:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263051"
}
```



---

archive/issue_comments_467300.json:
```json
{
    "body": "<a id='comment:77'></a>\nLGTM.",
    "created_at": "2021-03-19T08:33:58Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467300",
    "user": "https://github.com/kliem"
}
```

<a id='comment:77'></a>
LGTM.



---

archive/issue_comments_467301.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe, ..., https://github.com/mkoeppe/sage/actions/runs/662602246\" to \"Matthias Koeppe, Jonathan Kliem\".",
    "created_at": "2021-03-19T08:33:58Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467301",
    "user": "https://github.com/kliem"
}
```

**Changing reviewer** from "Matthias Koeppe, ..., https://github.com/mkoeppe/sage/actions/runs/662602246" to "Matthias Koeppe, Jonathan Kliem".



---

archive/issue_comments_467302.json:
```json
{
    "body": "<a id='comment:78'></a>\nThanks!",
    "created_at": "2021-03-19T15:47:48Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467302",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'></a>
Thanks!



---

archive/issue_comments_467303.json:
```json
{
    "body": "<a id='comment:79'></a>\nFollow-up in #31521",
    "created_at": "2021-03-19T16:49:28Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467303",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:79'></a>
Follow-up in #31521



---

archive/issue_events_263052.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-20T15:31:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263052"
}
```



---

archive/issue_events_263053.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-20T15:31:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263053"
}
```



---

archive/issue_comments_467304.json:
```json
{
    "body": "<a id='comment:80'></a>\nMerge conflict\n\n```\n    STDOUT: Auto-merging tox.ini\n    STDOUT: Auto-merging .github/workflows/ci-cygwin-standard.yml\n    STDOUT: CONFLICT (content): Merge conflict in .github/workflows/ci-cygwin-standard.yml\n    STDOUT: Auto-merging .github/workflows/ci-cygwin-minimal.yml\n    STDOUT: CONFLICT (content): Merge conflict in .github/workflows/ci-cygwin-minimal.yml\n    STDOUT: Automatic merge failed; fix conflicts and then commit the result.\n```",
    "created_at": "2021-03-20T15:31:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467304",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:80'></a>
Merge conflict

```
    STDOUT: Auto-merging tox.ini
    STDOUT: Auto-merging .github/workflows/ci-cygwin-standard.yml
    STDOUT: CONFLICT (content): Merge conflict in .github/workflows/ci-cygwin-standard.yml
    STDOUT: Auto-merging .github/workflows/ci-cygwin-minimal.yml
    STDOUT: CONFLICT (content): Merge conflict in .github/workflows/ci-cygwin-minimal.yml
    STDOUT: Automatic merge failed; fix conflicts and then commit the result.
```



---

archive/issue_comments_467305.json:
```json
{
    "body": "<a id='comment:81'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70811892cc73edd8e0d2b14438c5c6f8a82780f1\">7081189</a></td><td><code>tox.ini, build/bin/write-dockerfile.sh: Use configure --enable-download-from-upstream-url --enable-experimental-packages instead of setting SAGE_SPKG directly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6dced2457b7c3a6b645f2e56b9ca44c4b09e437\">d6dced2</a></td><td><code>Merge #31493</code></td></tr></table>\n",
    "created_at": "2021-03-20T16:04:44Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:81'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70811892cc73edd8e0d2b14438c5c6f8a82780f1">7081189</a></td><td><code>tox.ini, build/bin/write-dockerfile.sh: Use configure --enable-download-from-upstream-url --enable-experimental-packages instead of setting SAGE_SPKG directly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6dced2457b7c3a6b645f2e56b9ca44c4b09e437">d6dced2</a></td><td><code>Merge #31493</code></td></tr></table>




---

archive/issue_comments_467306.json:
```json
{
    "body": "**Changing commit** from \"[da978f85227ad4380b54f471b131bb82d48524bd](https://github.com/sagemath/sagetrac-mirror/commit/da978f85227ad4380b54f471b131bb82d48524bd)\" to \"[d6dced2457b7c3a6b645f2e56b9ca44c4b09e437](https://github.com/sagemath/sagetrac-mirror/commit/d6dced2457b7c3a6b645f2e56b9ca44c4b09e437)\".",
    "created_at": "2021-03-20T16:04:44Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467306",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[da978f85227ad4380b54f471b131bb82d48524bd](https://github.com/sagemath/sagetrac-mirror/commit/da978f85227ad4380b54f471b131bb82d48524bd)" to "[d6dced2457b7c3a6b645f2e56b9ca44c4b09e437](https://github.com/sagemath/sagetrac-mirror/commit/d6dced2457b7c3a6b645f2e56b9ca44c4b09e437)".



---

archive/issue_events_263054.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-20T16:05:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263054"
}
```



---

archive/issue_events_263055.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-20T16:05:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263055"
}
```



---

archive/issue_comments_467307.json:
```json
{
    "body": "**Dependencies:** #31493",
    "created_at": "2021-03-20T16:05:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467307",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #31493



---

archive/issue_comments_467308.json:
```json
{
    "body": "**Changing branch** from \"[public/29537](https://github.com/sagemath/sagetrac-mirror/tree/public/29537)\" to \"[d6dced2457b7c3a6b645f2e56b9ca44c4b09e437](https://github.com/sagemath/sagetrac-mirror/commit/d6dced2457b7c3a6b645f2e56b9ca44c4b09e437)\".",
    "created_at": "2021-03-22T23:54:13Z",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29537#issuecomment-467308",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/29537](https://github.com/sagemath/sagetrac-mirror/tree/public/29537)" to "[d6dced2457b7c3a6b645f2e56b9ca44c4b09e437](https://github.com/sagemath/sagetrac-mirror/commit/d6dced2457b7c3a6b645f2e56b9ca44c4b09e437)".



---

archive/issue_events_263056.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-22T23:54:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263056"
}
```



---

archive/issue_events_263057.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b80a47c7e6f5f0a8813e5a13360e975f6d696806",
    "created_at": "2021-03-22T23:54:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29537",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29537#event-263057"
}
```
