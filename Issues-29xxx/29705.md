# Issue 29705: Meta-ticket: Modularize sagelib into separate distributions (pip-installable packages) sagemath-... for Sage 10.0

archive/issues_029468.json:
```json
{
    "body": "Modularize sagelib into separate distributions (pip-installable packages), so that these can be built and run with a much smaller set of libraries. The packages can be made available individually on PyPI using the naming scheme **sagemath-...**. \n\nThe goal is do this **without changing the overall structure of the source tree**.\n\n- **Section [Packaging the Sage Library](https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#packaging-the-sage-library)** in the Sage Developer's Guide (added in Sage 9.5)\n- Presentation video: \n  https://researchseminars.org/talk/SageDays112358/17/ (2022-06)\n- [Master plan of sage modularization](https://groups.google.com/g/sage-devel/c/cTifWZOAfH8/m/niyTcAjCBAAJ) (sage-devel, 2021-11)\n- [How to modularize for fun and profit, IV: Testing subset distributions in virtual envs](https://groups.google.com/g/sage-devel/c/rpwoN3WwHao/m/0JsbVVxSBAAJ) (sage-devel, 2021-10)\n- [How to modularize for fun and profit, III: Dependencies, in 4 special flavors](https://groups.google.com/g/sage-devel/c/0q4abzOCsIM/m/9793dUwvBAAJ) (sage-devel, 2021-10)\n- [How to modularize for fun and profit, II: MONOREPO vs. MULTIREPO](https://groups.google.com/g/sage-devel/c/AaKxoNQAWMg/m/smcnaPoZBAAJ) (sage-devel, 2021-10)\n- [How to modularize for fun and profit, I: Namespace vs. distribution name](https://groups.google.com/g/sage-devel/c/p4MO6L95s7E/m/yZF93ewIBAAJ) (sage-devel, 2021-10)\n- [Refactoring tasks in the Sage library to support modularization](https://groups.google.com/g/sage-devel/c/T0A4JCOg9DY/m/q6WKsI1yBAAJ) (sage-devel, 2021-09)\n- [Current status of pip-installability](https://wiki.sagemath.org/ReleaseTours/sage-9.4#Alternative_installation_methods_using_pip) (Sage 9.4 release tour, 2021-08)\n- [Schematics](https://drive.google.com/file/d/18ptPi1s6YCj8jm_em8bFBlqjDYK6Eapm/view) (2020-10)\n- Presentation video: https://researchseminars.org/talk/SageDays110/11/ (2020-10)\n- [Initial proposal](https://groups.google.com/d/msg/sage-devel/M9QTWtln6zU/UHwkrmTKBQAJ) (sage-devel, 2020-05)\n\nInitial steps:\n\n1. In particular, create a package [sagemath-objects](https://pypi.org/project/sagemath-objects/) that makes Sage objects, the element/parent framework, categories, the coercion system and the related metaclasses available. This package would, for example, not provide or know about integers, polynomials, or matrices (thus avoiding all the dependencies on the various libraries implementing these). Ideally it would only have a build dependency on Cython and no runtime dependencies. \n\n   (Doctesting **sagemath-objects** would still need more of Sage, but some it could also be done by mocking instead of with the real classes.)\n\n   a) These facilities could see a wider use in the mathematical Python community, and in this way we could hope to benefit from a larger developer base. For example, we would hope that **sagemath-objects** could be ported for use with PyPy instead of CPython.\n\n   b) Building and deploying a user package would be easier if it could depend on a small package such as **sagemath-objects** only instead of the whole multigigabyteness of Sage.\n\n   This has been completed in Sage 9.6 (#29865).\n\n2. Remove the mechanism of `OptionalExtension`s from `sagelib`.\n\n   Currently, a user would install, for example, the optional package `tdlib` and then rebuild `sagelib` so that the `OptionalExtension` `sage.graphs.graph_decompositions.tdlib` is built and installed.\n\n   With this ticket, the user would instead install a new optional package **sagemath-tdlib** (which has `tdlib` as a dependency); this installs the `Extension` `sage.graphs.graph_decompositions.tdlib` (as a namespace package).\n\n   This has been completed in Sage 9.2 (#29701).\n\n**Not** within the scope of this ticket:\n\n- We will not change the overall structure of the source tree (`SAGE_ROOT/src/sage`). We will achieve this by using the mechanism of native namespace packages introduced in Python 3.3 (PEP 420, see #28925).\n\n- It is not a prerequisite to fight against all circular imports. In particular, a parent class and its corresponding element class would certainly not be separated into separate distribution packages. \n\n**Initially noted constraints and challenges:**\n\n- Inconsistent handling of symlinks by `pip`/`setuptools`. We cannot simply create a distribution of a subset of the files in `src` by creating a flock of symlinks (see #29850) and expect everything to work; notably, pip fails because of longstanding issues with installs from local directories (see discussion in #29854).\n\n  Solution (implemented in Sage 9.2, #29500): Do not use pip for installations from local source directories.  Use `setup.py bdist_wheel`, followed by `pip install` of the wheel. pip 21.1's `--use-feature=in-tree-build` makes this workaround unnecessary (#32046, Sage 9.5).\n\n- The category framework can not really be separated from the `Parent`/`Element`/`CategoryObject` (e.g. coercion is involved in comparisons and binary operations).\n\n  Solution: Therefore they are in the same distribution **sagemath-objects**.\n\n- The category framework cannot live without the integers (e.g. the output of `.cardinality()` expects an integer). \n\n  Near term solution: #32432 makes **sagemath-categories** larger, to include integers and some other basic rings.\n\n  Possible future solution: The coercion system already has the notion of a global coercion model - which is determined at runtime, not compile time (`sage.structure.element.get_coercion_model`). When methods in `sagemath-objects` need to create an integer, they should obtain the appropriate class of integers in the same way. An existing function provides this interface already (but has a static implementation):\n   {{{\n   sage: py_scalar_parent(int)\n   Integer Ring\n   }}}\n  #29875 will make this implementation dynamic.\n\n- Imports in `sage.categories`:\n\n```\n  bimodules imports QQ, RR\n  classical_crystals imports SR\n  finite_coxeter_groups imports QQbar\n```\n  Such imports can be removed using the techniques described in section [Module-level runtime dependencies](https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies) in the Sage developer's guide.  \n\n**Tickets for Sage 9.2:**\n\nsee also [Modularization changes in Sage 9.2](https://wiki.sagemath.org/ReleaseTours/sage-9.2#System_package_information_for_optional_packages_at_runtime) (release tour)\n\n- #29411: make sagelib a script package\n- #29702: Move all code from `src/setup.py` to `sage_setup`\n- #29706, #29720, #29721, #29785, #29786, #29790, #29791: Move `Extension` options from `src/module_list.py` to `distutils:` directives in the individual files\n- #29701 (depends on all of the above): Replace use of `module_list` and `OptionalExtension` by extending `sage_setup.find_python_sources`\n- #28197: upgrade to ipython 7 (old ipython completer crashes on namespace packages)\n- #29803: Upgrade `setuptools`, `setuptools_scm`, `pip` (2020-06), add package `wheel`; remove `zope_interface`\n- #21559: Install `src/bin` scripts by sagelib's `setup.py`, not make\n- #29950: Build sagelib from build/pkgs/sagelib/src, fix `setup.py sdist`, add `spkg-src` and `tox.ini` (supersedes: #21516: Fix sagelib sdist (src/setup.py sdist), #13190: make `sagelib` use `setuptools` instead of `distutils`)\n- #29869, #29873, #29892, #29883, #16351, #29881, #29880, #29916, #29922: Improve/repair filtered structure of sagelib.\n- #29171: Move `giacpy_sage` into sage source code\n- #30332: Merge `sage_brial` into sagelib\n- #29500 Install all Python packages via `pip wheel`, store wheels in $SAGE_LOCAL/var/lib/sage/wheels\n- #30606: `sage.features.Feature.resolution`: If `SAGE_ROOT` is available, recommend system packages\n- #30616: Replace use of `sage.misc.package.PackageNotFoundError` (2); lazy_import: Add keyword argument 'feature'\n\n**Tickets for Sage 9.3:**\n\nsee also [Modularization changes in Sage 9.3](https://wiki.sagemath.org/ReleaseTours/sage-9.3#Modularization_and_packaging_of_sagelib) (release tour)\n\n- #30715 Remove a few `.all` imports\n- #30739 Remove a few more `.all` imports\n- #30784 `sage.matrix`: Resolve circular imports without using `__init__.py`\n- #30779 Duplicate `src/setup.py`\n- #30780 `sage_setup`: Separate installing and cleaning\n- #30579 Clean up `sage_setup.library_order`\n- #30580 `sage_setup`: Remove import-time dependency (`setup_requires`) on `pkgconfig`, `numpy`\n- #29355 Sagelib's scripts in `src/bin` should not use `build/bin/sage-system-python`; remove `sage-pypkg-location`\n- #30780 `sage_setup`: Separate installing and cleaning\n- #30719 Add `build/pkgs/SPKG/install-requires.txt` for all Python packages, remove some unneeded packages\n- #29951 `src/bin/sage-env`: Make `SAGE_ROOT` and `SAGE_LOCAL` optional\n- #29852 sage: Determine `SAGE_LOCAL`, `SAGE_ROOT` via sage-config if it exists\n- #22731: Replace `$SAGE_LOCAL/bin` by more specific variables to make Sage easier to package, use in venvs\n- #30013: `src/bin/sage-env`: Make sure `$SAGE_VENV/bin` is at the beginning of the `PATH`\n- #30587: Remove import of `ppl` at startup\n- #31261: Update `pplpy` to 0.8.6\n- #29850: Install `sage-env-config` as part of `sage_conf`\n- #31025: FPLLL 5.4.0 and FPyLLL 0.5.4\n- #31058: `src/bin/sage-venv-config`: Do not fail if `sage_conf` is not available\n- #31218: bootstrap: Fix \"sage-venv-config: /doesnotexist/python3: bad interpreter\"\n- #31270: Remove `sage-location`'s \"sage-force-relocate\" mechanism, fix script to work without `SAGE_ROOT`\n- #31321: `build/pkgs`: Add some missing install-requires metadata, add some documentation to the developer's guide\n- #30912: sagelib: Update metadata for PyPI deployment as distribution **sagemath-standard**\n- #31357: Fixup `src/VERSION.txt` added in #30912\n- #31332: `sage.misc.persist`: Import `SAGE_DB` on need only\n- #31334: `sage.doctest.control`: Do not fail if `sage.libs.arb` cannot be imported\n- #30984: `sage_setup`: Replace imports from `distutils` by `setuptools`\n- #31365: Add NTL to `cython_aliases` and `sage.misc.cython` library search dirs\n- #31279: Add package `argon2-cffi` (dependency of Jupyter notebook)\n- #31362: `make build-local`, make `build-venv`\n- #31377 `./configure --enable-editable`\n- #31045: `pip`, `wheel`, `setuptools`: Make wheels available in `SAGE_SPKG_WHEELS`\n- #30010: Split sage_setup.docbuild out to a separate distribution **sage-docbuild**\n- #31278: `widgetsnbextension` should not depend on `notebook`\n- #30383: Add `configure --disable-notebook`; show descriptions of optional packages in `configure --help`\n- #31523: Fix dependencies of `ipywidgets`\n- #31409: Make it possible to disable build of `r`, `rpy2` using `./configure --disable-r`\n\n**Tickets for Sage 9.4:**\n\nsee also [Modularization changes in Sage 9.4](https://wiki.sagemath.org/ReleaseTours/sage-9.4#New_location_for_distribution_package_sources:_SAGE_ROOT.2Fpkgs) (release tour)\n\n- #30913: Generate pyproject.toml and setup.cfg [install_requires], requirements.txt, Pipfile, and src/Pipfile (supersedes #30578, #30581)\n- #31384: `cython_aliases`: Do not fail if one of the listed libraries is not known to pkgconfig\n- #29013: Add configure option `--with-sage-venv=SAGE_VENV` to create venv there instead of in SAGE_LOCAL\n- #31593: `configure`: Paths within `$SAGE_LOCAL` (`$prefix`) for `sage_conf`\n- #31338: `sage_setup`: Use paths within `SAGE_LOCAL` when provided via sage_conf\n- #31562: Patch `giac` so that `libintl` from `/usr/local` does not leak in on macOS\n- #28890: Install fewer static libraries\n- #32045 `sage-env`, `sage.env`: Remove unused environment and Python variables `SAGE_ETC`, `SAGE_INC`\n- #32036 `sage.env`: Remove direct uses of SAGE_LOCAL from the Sage library\n- #32057 `sage_setup.setenv`: Only set `...PATH` variables and `LDFLAGS` if `SAGE_LOCAL` differs from `SAGE_VENV`\n- #31577: Move `SAGE_ROOT/build/pkgs/*/src` to `SAGE_ROOT/pkgs/*`\n- #31333: `sage.env.sage_include_directories`: Remove hard dependency on `numpy`\n- #32073: Remove `sage.libs.readline`\n\n\n**Tickets for Sage 9.5:** \n\nsee also [Modularization changes in Sage 9.5](https://wiki.sagemath.org/ReleaseTours/sage-9.5#For_developers_and_packagers:_Modularization_and_packaging_changes) (release tour)\n\n- #32046 Use `pip --use-feature=in-tree-build`, replace use of `sdh_setup_bdist_wheel` by `sdh_pip_install`\n- #29847: Install `sage_setup` with `setuptools` as a build prerequisite for building/installing sagelib. Deploy distribution **sage-setup** to PyPI.\n- #32371 `ptyprocess`: Pin version to 0.5.1 in install-requires.txt\n- #31031 Change `sage_setup: distribution` headers from `sage-...` to `sagemath-...`\n- #32386 Merge `pynac` sources as `src/sage/symbolic/ginac` (supersedes #30534)\n- #32412: Deprecate `sage.libs.primecount`/`sage.interfaces.primecount`\n- #32373: `sage_setup.library_order`: Skip libraries that were not detected\n- #32501: Meta-ticket: Clear out `__init__.py` files in preparation for namespace packages\n  - #31420/#32479/#32489: Review/remove monkey patching in `src/sage/__init__.py`\n  - #32506/#32507/#32508/#32509: `__init__.py` in other packages\n  - #32840 Fix `unpickle_global` when `register_unpickle_override` appears in a module not loaded at startup\n- #32414 Meta-ticket: New modules providing abstract base classes to enable modularization\n  - #32566/#32610/#32612/#32660/#32750 `sage.rings.abc`\n  - #32600 `sage.arith`: Use `sage.rings.abc` and move some module-level imports into methods\n  - #32606 Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n  - #32742 Use `sage.rings.abc.RealField`, `sage.rings.abc.ComplexField` more\n- #32534/#32591/#32620/#32734/#32733: Remove `.all` imports\n- #32442 `./configure`: Make `--with-sage-venv=auto` the default\n- #32062: GH Actions: Deploy sdists to PyPI\n- #29039: pip-installable version of package **sage-conf** - installs non-Python bits of the Sage distribution in `~/.sage/`\n- #32601: Modularization of sagelib: Break out a separate package **sagemath-standard-no-symbolics**\n  - #32411/#32413/#32415/#32416: Remove unnecessary uses of `SR` and symbolic functions\n  - #32599: `sage.structure`, `sage.sets`: Remove hard dependencies on the symbolic ring / polynomial rings\n  - #32593: `sage.modules`, `sage.matrix`: Remove import-time dependencies on the symbolic ring\n  - #32638: `sage.structure.element`: Add abc `Expression`; deprecate `is_Expression` etc.\n  - #32665: Deprecate `is_[Callable]SymbolicExpressionRing`, remove use of `is_Symbolic{Equation,Variable}`, `is_CallableSymbolicExpression`\n  - #32708: `sage.tensor.modules`: remove dependency on `sage.manifolds`\n  - #32712: `sage.tensor.modules`: make doctests involving `SR` optional\n  - #32725: Modularization changes in `sage.modules`, `sage.matrix`\n  - #32730: Import `Expression` from `sage.structure.element`\n  - #32717: Move `sage.functions.other.sqrt` to `sage.misc.functional`\n  - #32731: Avoid `ceil`, `floor` from `sage.functions.other` in non-symbolic uses\n- #32585 `sage.doctest`: Eliminate hard dependency on `RealIntervalField`\n- #32614 Features and optional tags for sage modules provided by separate distributions\n- #30778 `sage.doctest.control`: Exclude doctests in files via file-level directives\n- #32649 Replace `sage.doctest.external.has_*` functions by `Feature`s\n- #32650 `sage.misc.latex`: Replace `have_...` functions by `Feature`s\n- #32619 `lazy_import`: Muffle diagnostic messages for `at_startup`\n- #32432: Modularization of sagelib: Break out a separate package **sagemath-polyhedra**\n  - #30022/#32441/#32455/#32775/#32701 Remove compile-time dependency on `cypari2` and `flint` from some modules\n  - #32592 `sage.geometry.polyhedron`: Split out `backend_cdd_rdf` from `backend_cdd`\n  - #32628 `ConvexSet_base`, `Polyhedron_base`: In `_test` methods, do not fail if some modules are unavailable\n  - #32634 `sage.misc.latex`, `sage.repl.display.fancy_repr`: Make imports more local\n  - #32652/#32653/#32732 `sage.geometry.polyhedron`: Mark doctests `# optional - sage.rings.number_field` etc.\n  - #32635 `sage.matrix.matrix_space`: Import element classes on demand, fall back to generic on `ImportError`\n  - #32666 `Polyhedron_base.vertex_adjacency_matrix`: Do not use `face_lattice`\n  - #32677 `sage.rings.real_double`: Move methods using GSL to a separate extension module\n  - #32625 `Parent._is_numerical`, `_is_real_numerical` - remove hard dependency on `real_mpfr`, `complex_mpfr`\n  - #32641 Decentralize `sage.rings.numbers_abc`\n  - #32769 `sage.categories.coxeter_groups`: Remove module-level imports from `sage.rings`, `sage.graphs`\n  - #32777 Allow some imports of `RLF` to fail\n  - #32780 `sage.geometry.polyhedron.library`: Delay import of rings\n  - #32778 `sage.rings.infinity`: Remove hard dependency on `real_lazy` and `real_mpfi`\n- #31386: Move list of scripts from `setup.py` to `setup.cfg`\n- #32899: Developer's guide: Add section on modularization\n- #25009/#32894: Split out `sage.libs.primecount`/`sage.interfaces.primecount` as a separate Python library\n\n\n**Tickets for Sage 9.6:**\n\nsee also [Modularization changes in Sage 9.6](https://wiki.sagemath.org/ReleaseTours/sage-9.6#For_developers:_Refactoring_and_modularization) (release tour)\n\n- #29865: Modularization of sagelib: Prepare experimental subset distributions **sagemath-objects**, **sagemath-categories**, depending on Cython, pkgconfig, cysignals, gmpy2.  Use them as a testsuite for testing the filtered structure of sagelib.\n- #31013 Remove unused class from `sage_setup.optional_extension`\n- #32846 `sage.geometry`: More `# optional`\n- #32847 Use `lazy_import` for module-level import from `sage.plot` (outside of `sage.plot`)\n- #31306 `sage.repl`: Replace use of `SAGE_EXTCODE` by `importlib.resources`\n- #32881/#32888 Feature for `sage.rings.padics` etc.\n- #33033 Prepare `sage.doctest` for namespace packages\n- #32465 Refactor `{Matrix,Vector}_double_dense` through `..._numpy_dense`, add `..._numpy_integer_dense`\n- #33402 `sage.geometry.polyhedron`: More `# optional`\n- #33403 `Polyhedron._test_product`, `_test_dilation`: Skip tests if test prereqs cannot be imported\n- #33392 `sage.matrix`: Modularization fixes after #33159\n- #32989/#32999/#33000/#33007/#33146/#33199 Remove imports from `sage.*.all`\n- #32609 Remove more unnecessary uses of SR and symbolic functions in `sage.combinat`\n- #32893 Feature for palp\n- #31296 `sage.features.Executable`: Prepend `$SAGE_VENV/bin:$SAGE_LOCAL/bin` to `PATH`\n- #33440 `sage.libs.singular`: Do not fail if the Singular binary is not in `PATH`\n- #33465, #33466, #32645, #33467: Use `Executable.absolute_filename`\n- #33017 `LazyImport.__instancecheck__`, `__subclasscheck__`: Return `False` on `ImportError`\n\n\n**Tickets for Sage 9.7:**\n\nsee also [Modularization changes in Sage 9.7](https://trac.sagemath.org/wiki/ReleaseTours/sage-9.7#Modularizationchanges) (release tour)\n\n- #33797/#33799 Remove some uses of `SAGE_TMP` (supersedes #32986)\n- #33801 `sage.misc.sage_input`: Remove import from sage.all\n- #33803 Fixes for the distributions sagemath-objects, sagemath-categories\n- #32716 `pkgs/sagemath-standard/tox.ini`: Create environment that uses Sage's python as the basepython\n- #29941: Modularization of sagelib: Break out a separate packages **sagemath-environment**, **sagemath-repl**\n- #28925 Modify `find_python_sources` to support modularization of `sagelib` by native namespace packages (PEP 420), rework **sagemath-objects**, **sagemath-categories** as namespace packages\n- #33822 `python3` `spkg-configure.m4`: Require `ensurepip`\n- #33795 Move handling of `sage --docbuild` back to `src/bin/sage`\n- #33821 Remove use of `SAGE_LIB` in `sage.misc`\n- #33295: Refactor `sage_conf`\n- #33029 Feature and doctest tag for runtime cython\n- #33800 cibuildwheel workflow for sagemath-objects, sagemath-categories etc.\n- #33011 Remove `__init__.py` files for packages designated to be namespace packages\n- #34187 Remove `src/sage/__init__.py`\n- #32406: Make `./configure --enable-editable` the default\n- #33817 GH Actions: Add test of the modularized distributions\n- #34221 Backport PEP420 namespace package support from Cython 3\n- #34189/#34190/#34191/#34192/#34428: Remove `.all` imports\n- #34296 GH Actions: Upload wheels to PyPI\n\n**Tickets for Sage 9.8:**\n\n- #33812 Refactor distributions sage-setup, sagemath-{objects,categories} through sagemath-{environment,repl}\n- #32874 New option `./configure --enable-wheels` (supersedes #32927, #30152)\n- #34770/#34823/#34804 Deprecate `sage.interfaces` `is_...Element` functions\n- #32664 Deprecate `is_FiniteField` etc., make `sage.rings.finite_rings` a namespace package\n- #32709 `sage.structure.element`: Add ABCs `Polynomial`, `MPolynomial` for `isinstance` testing\n- #16522 `lazy_import` doesn't resolve properly when indirectly imported\n- #34547 Interface issues: should use more lazy imports\n- #34858 Fix sagemath-standard sdist\n- #34855 Remove direct use of `setup.py sdist`, add targets `make SPKG-sdist`\n- #34346 Distributions with optional extension modules: **sagemath-meataxe**, **sagemath-tdlib**, **sagemath-sirocco**, **sagemath-bliss**, ... \n- #30666 Distributions **sagemath-{flint-arb,homfly,giac,gap}**, add `sage_setup: distribution` to Cython modules\n- #33577 Migrate from `setup.cfg` to `pyproject.toml`\n- #31444 Modularization of sagelib: Break out separate package **sagemath-linbox**\n- #33037 Remove use of `SAGE_LIB` variable\n- #32432: Modularization of sagelib: Break out a separate package **sagemath-polyhedra**\n- #31396: relocatable wheel version of package **sage-conf**\n- #32601: Modularization of sagelib: Break out a separate package **sagemath-standard-no-symbolics**\n  - #32718 Remove module-level imports from `sage.symbolic` etc. (outside of `sage.symbolic`, `sage.calculus` etc.)\n  - #32721 Remove abuse of predefined x in doctests\n\n**Tickets for Sage 9.9**\n\n- #32586: Prepare use of `sage.all` in `sage.structure.factory.lookup_global` for modularized distributions\n- #34633 Use `src/setup.py` for the installation mode `--disable-editable --disable-wheels`\n- #34590 Use python-build instead of `pip wheel`\n- #34209 Use PEP 660 editable wheels for sagelib\n- #34631 `sage_setup`: Output depfiles\n- #34587 Refactor sagemath-standard through sagemath-{categories,environment,repl}\n- #33820 `eager_import`\n- #33575 Feature for fricas\n- #33802 Remove runtime dependency on everything via `sage_eval`\n- #32360 Merge `cypari`, `cypari2`; replace `cysignals`' optional PARI dependency by a general hook\n  - #32431 `cysignals`: Replace compile-time dependency on pari by run-time dispatch\n- #33202 Do not complain about `sage.categories.all`\n- #29870: `Move sage.structure.formal_sum` to `sage.modules`\n- #30746 `sage.doctest.control`: Replace use of sage.misc.package.list_packages\n- #30848 `sage.doctest.control`, `sage_setup`: Do not check versions of installed packages\n- #30911: src/tox.ini: Add \"develop\" environment\n- possibly move `pkgs/sage-conf/sage_conf.py[.in]` into `src/`, mark it (and also `src/bin/sage-env-config[.in]`) `# sage_setup: distribution = sage-conf`.\n- #29868: pip-installable packages **sagemath-doc-...**\n- #31543: Eliminate use of patches for Python packages\n- #30647: Make `lazy_import` more friendly to pyflakes and other static checkers\n- #33405 Eliminate direct use of `os.getenv` in `sage.interfaces`, use `Executable.absolute_filename`\n- #30036: `sage_conf-pypi`: API for incremental builds\n- #29041 `sage_bootstrap`: Add command `sage -package list --output={install-requires,requirements,pipfile,debian,....}`\n- Further modularization:\n   - #32700: Modularization of sagelib: Distribution **sagemath-gsl**\n   - **sagemath-brial** (ex `sage-brial` in `sage.rings.polynomial.pbori` +  `sage.libs.polybori`, `sage.crypto.boolean_function`)\n   - #30716 Towards making Arb library optional\n    - #32433 Refactor `sage.matrix.misc`\n   - #33660 Modularization of sagelib: Break out separate package **sagemath-combinat**\n   - #32702 Modularization of sagelib: Distribution **sagemath-plot**\n   - #29912: Modularization of sagelib: Break out a separate package `sagemath-ntl`\n   - #31695 Modularization of sagelib: Break out separate package **sagemath-symbolics** (depends on ecl and maxima, packages `sage.interfaces.maxima*`, `sage.libs.ecl`)\n- #32613: pynac: Replace direct use of singular's libfactory by a Python call\n- #32908 Eliminate use of FLINT's NTL interface\n- #30371: In-place (editable) installs of sagelib in a venv\n\n**Wishlist tickets, loose ends**\n- #30527: Create PEP 503 simple repository for wheels built during installation\n- #29877: `sage.categories`: Replace import of `ZZ` by `py_scalar_parent(int)`\n- #29875: `sage.structure.coerce.py_scalar_parent`, `py_scalar_to_element`: Make dynamic\n- #29874: Mock integer class\n- #29845: PEP 517 `buildapi` for `sage_setup`\n- #31602: modularized relocatable wheel version of `sage_conf`\n- #30748 Convert startup methods to context manager\n- #30896: `./configure --with-sage-venv=none`\n\n\n**Related:**\n- #21508 Meta-ticket: Clean up `src/setup.py` to bring it to standard distutils behavior\n- https://wiki.sagemath.org/CodeSharingWorkflow\n- #30914 Meta-ticket: Create upstream repositories, pip-installable packages for database packages\n- #30922 Meta-ticket: Fix dependencies of upstream Python packages\n- #30818 Meta-ticket: Set environment for subprocesses invoked by Sage\n  - #31041 Set environment for `sage.misc.cython`\n- #31251 Meta-ticket: Distribution as wheels\n- #33580 Meta-ticket: make all modules importable without sage.all\n- #34201 Meta-ticket: Replace imports from sage.*.all for namespace packages\n\n\nCC:  @videlec @orlitzky @kiwifb @isuruf @tscrim @kliem @jhpalmieri @tobiasdiez @defeo @thierry-freebsd @anneschilling\n\nKeywords: sd109, sd110, sd111\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/29705\n\n",
    "created_at": "2020-05-17T19:27:41Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Modularize sagelib into separate distributions (pip-installable packages) sagemath-... for Sage 10.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29705",
    "user": "https://github.com/mkoeppe"
}
```
Modularize sagelib into separate distributions (pip-installable packages), so that these can be built and run with a much smaller set of libraries. The packages can be made available individually on PyPI using the naming scheme **sagemath-...**. 

The goal is do this **without changing the overall structure of the source tree**.

- **Section [Packaging the Sage Library](https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#packaging-the-sage-library)** in the Sage Developer's Guide (added in Sage 9.5)
- Presentation video: 
  https://researchseminars.org/talk/SageDays112358/17/ (2022-06)
- [Master plan of sage modularization](https://groups.google.com/g/sage-devel/c/cTifWZOAfH8/m/niyTcAjCBAAJ) (sage-devel, 2021-11)
- [How to modularize for fun and profit, IV: Testing subset distributions in virtual envs](https://groups.google.com/g/sage-devel/c/rpwoN3WwHao/m/0JsbVVxSBAAJ) (sage-devel, 2021-10)
- [How to modularize for fun and profit, III: Dependencies, in 4 special flavors](https://groups.google.com/g/sage-devel/c/0q4abzOCsIM/m/9793dUwvBAAJ) (sage-devel, 2021-10)
- [How to modularize for fun and profit, II: MONOREPO vs. MULTIREPO](https://groups.google.com/g/sage-devel/c/AaKxoNQAWMg/m/smcnaPoZBAAJ) (sage-devel, 2021-10)
- [How to modularize for fun and profit, I: Namespace vs. distribution name](https://groups.google.com/g/sage-devel/c/p4MO6L95s7E/m/yZF93ewIBAAJ) (sage-devel, 2021-10)
- [Refactoring tasks in the Sage library to support modularization](https://groups.google.com/g/sage-devel/c/T0A4JCOg9DY/m/q6WKsI1yBAAJ) (sage-devel, 2021-09)
- [Current status of pip-installability](https://wiki.sagemath.org/ReleaseTours/sage-9.4#Alternative_installation_methods_using_pip) (Sage 9.4 release tour, 2021-08)
- [Schematics](https://drive.google.com/file/d/18ptPi1s6YCj8jm_em8bFBlqjDYK6Eapm/view) (2020-10)
- Presentation video: https://researchseminars.org/talk/SageDays110/11/ (2020-10)
- [Initial proposal](https://groups.google.com/d/msg/sage-devel/M9QTWtln6zU/UHwkrmTKBQAJ) (sage-devel, 2020-05)

Initial steps:

1. In particular, create a package [sagemath-objects](https://pypi.org/project/sagemath-objects/) that makes Sage objects, the element/parent framework, categories, the coercion system and the related metaclasses available. This package would, for example, not provide or know about integers, polynomials, or matrices (thus avoiding all the dependencies on the various libraries implementing these). Ideally it would only have a build dependency on Cython and no runtime dependencies. 

   (Doctesting **sagemath-objects** would still need more of Sage, but some it could also be done by mocking instead of with the real classes.)

   a) These facilities could see a wider use in the mathematical Python community, and in this way we could hope to benefit from a larger developer base. For example, we would hope that **sagemath-objects** could be ported for use with PyPy instead of CPython.

   b) Building and deploying a user package would be easier if it could depend on a small package such as **sagemath-objects** only instead of the whole multigigabyteness of Sage.

   This has been completed in Sage 9.6 (#29865).

2. Remove the mechanism of `OptionalExtension`s from `sagelib`.

   Currently, a user would install, for example, the optional package `tdlib` and then rebuild `sagelib` so that the `OptionalExtension` `sage.graphs.graph_decompositions.tdlib` is built and installed.

   With this ticket, the user would instead install a new optional package **sagemath-tdlib** (which has `tdlib` as a dependency); this installs the `Extension` `sage.graphs.graph_decompositions.tdlib` (as a namespace package).

   This has been completed in Sage 9.2 (#29701).

**Not** within the scope of this ticket:

- We will not change the overall structure of the source tree (`SAGE_ROOT/src/sage`). We will achieve this by using the mechanism of native namespace packages introduced in Python 3.3 (PEP 420, see #28925).

- It is not a prerequisite to fight against all circular imports. In particular, a parent class and its corresponding element class would certainly not be separated into separate distribution packages. 

**Initially noted constraints and challenges:**

- Inconsistent handling of symlinks by `pip`/`setuptools`. We cannot simply create a distribution of a subset of the files in `src` by creating a flock of symlinks (see #29850) and expect everything to work; notably, pip fails because of longstanding issues with installs from local directories (see discussion in #29854).

  Solution (implemented in Sage 9.2, #29500): Do not use pip for installations from local source directories.  Use `setup.py bdist_wheel`, followed by `pip install` of the wheel. pip 21.1's `--use-feature=in-tree-build` makes this workaround unnecessary (#32046, Sage 9.5).

- The category framework can not really be separated from the `Parent`/`Element`/`CategoryObject` (e.g. coercion is involved in comparisons and binary operations).

  Solution: Therefore they are in the same distribution **sagemath-objects**.

- The category framework cannot live without the integers (e.g. the output of `.cardinality()` expects an integer). 

  Near term solution: #32432 makes **sagemath-categories** larger, to include integers and some other basic rings.

  Possible future solution: The coercion system already has the notion of a global coercion model - which is determined at runtime, not compile time (`sage.structure.element.get_coercion_model`). When methods in `sagemath-objects` need to create an integer, they should obtain the appropriate class of integers in the same way. An existing function provides this interface already (but has a static implementation):
   {{{
   sage: py_scalar_parent(int)
   Integer Ring
   }}}
  #29875 will make this implementation dynamic.

- Imports in `sage.categories`:

```
  bimodules imports QQ, RR
  classical_crystals imports SR
  finite_coxeter_groups imports QQbar
```
  Such imports can be removed using the techniques described in section [Module-level runtime dependencies](https://doc.sagemath.org/html/en/developer/packaging_sage_library.html#module-level-runtime-dependencies) in the Sage developer's guide.  

**Tickets for Sage 9.2:**

see also [Modularization changes in Sage 9.2](https://wiki.sagemath.org/ReleaseTours/sage-9.2#System_package_information_for_optional_packages_at_runtime) (release tour)

- #29411: make sagelib a script package
- #29702: Move all code from `src/setup.py` to `sage_setup`
- #29706, #29720, #29721, #29785, #29786, #29790, #29791: Move `Extension` options from `src/module_list.py` to `distutils:` directives in the individual files
- #29701 (depends on all of the above): Replace use of `module_list` and `OptionalExtension` by extending `sage_setup.find_python_sources`
- #28197: upgrade to ipython 7 (old ipython completer crashes on namespace packages)
- #29803: Upgrade `setuptools`, `setuptools_scm`, `pip` (2020-06), add package `wheel`; remove `zope_interface`
- #21559: Install `src/bin` scripts by sagelib's `setup.py`, not make
- #29950: Build sagelib from build/pkgs/sagelib/src, fix `setup.py sdist`, add `spkg-src` and `tox.ini` (supersedes: #21516: Fix sagelib sdist (src/setup.py sdist), #13190: make `sagelib` use `setuptools` instead of `distutils`)
- #29869, #29873, #29892, #29883, #16351, #29881, #29880, #29916, #29922: Improve/repair filtered structure of sagelib.
- #29171: Move `giacpy_sage` into sage source code
- #30332: Merge `sage_brial` into sagelib
- #29500 Install all Python packages via `pip wheel`, store wheels in $SAGE_LOCAL/var/lib/sage/wheels
- #30606: `sage.features.Feature.resolution`: If `SAGE_ROOT` is available, recommend system packages
- #30616: Replace use of `sage.misc.package.PackageNotFoundError` (2); lazy_import: Add keyword argument 'feature'

**Tickets for Sage 9.3:**

see also [Modularization changes in Sage 9.3](https://wiki.sagemath.org/ReleaseTours/sage-9.3#Modularization_and_packaging_of_sagelib) (release tour)

- #30715 Remove a few `.all` imports
- #30739 Remove a few more `.all` imports
- #30784 `sage.matrix`: Resolve circular imports without using `__init__.py`
- #30779 Duplicate `src/setup.py`
- #30780 `sage_setup`: Separate installing and cleaning
- #30579 Clean up `sage_setup.library_order`
- #30580 `sage_setup`: Remove import-time dependency (`setup_requires`) on `pkgconfig`, `numpy`
- #29355 Sagelib's scripts in `src/bin` should not use `build/bin/sage-system-python`; remove `sage-pypkg-location`
- #30780 `sage_setup`: Separate installing and cleaning
- #30719 Add `build/pkgs/SPKG/install-requires.txt` for all Python packages, remove some unneeded packages
- #29951 `src/bin/sage-env`: Make `SAGE_ROOT` and `SAGE_LOCAL` optional
- #29852 sage: Determine `SAGE_LOCAL`, `SAGE_ROOT` via sage-config if it exists
- #22731: Replace `$SAGE_LOCAL/bin` by more specific variables to make Sage easier to package, use in venvs
- #30013: `src/bin/sage-env`: Make sure `$SAGE_VENV/bin` is at the beginning of the `PATH`
- #30587: Remove import of `ppl` at startup
- #31261: Update `pplpy` to 0.8.6
- #29850: Install `sage-env-config` as part of `sage_conf`
- #31025: FPLLL 5.4.0 and FPyLLL 0.5.4
- #31058: `src/bin/sage-venv-config`: Do not fail if `sage_conf` is not available
- #31218: bootstrap: Fix "sage-venv-config: /doesnotexist/python3: bad interpreter"
- #31270: Remove `sage-location`'s "sage-force-relocate" mechanism, fix script to work without `SAGE_ROOT`
- #31321: `build/pkgs`: Add some missing install-requires metadata, add some documentation to the developer's guide
- #30912: sagelib: Update metadata for PyPI deployment as distribution **sagemath-standard**
- #31357: Fixup `src/VERSION.txt` added in #30912
- #31332: `sage.misc.persist`: Import `SAGE_DB` on need only
- #31334: `sage.doctest.control`: Do not fail if `sage.libs.arb` cannot be imported
- #30984: `sage_setup`: Replace imports from `distutils` by `setuptools`
- #31365: Add NTL to `cython_aliases` and `sage.misc.cython` library search dirs
- #31279: Add package `argon2-cffi` (dependency of Jupyter notebook)
- #31362: `make build-local`, make `build-venv`
- #31377 `./configure --enable-editable`
- #31045: `pip`, `wheel`, `setuptools`: Make wheels available in `SAGE_SPKG_WHEELS`
- #30010: Split sage_setup.docbuild out to a separate distribution **sage-docbuild**
- #31278: `widgetsnbextension` should not depend on `notebook`
- #30383: Add `configure --disable-notebook`; show descriptions of optional packages in `configure --help`
- #31523: Fix dependencies of `ipywidgets`
- #31409: Make it possible to disable build of `r`, `rpy2` using `./configure --disable-r`

**Tickets for Sage 9.4:**

see also [Modularization changes in Sage 9.4](https://wiki.sagemath.org/ReleaseTours/sage-9.4#New_location_for_distribution_package_sources:_SAGE_ROOT.2Fpkgs) (release tour)

- #30913: Generate pyproject.toml and setup.cfg [install_requires], requirements.txt, Pipfile, and src/Pipfile (supersedes #30578, #30581)
- #31384: `cython_aliases`: Do not fail if one of the listed libraries is not known to pkgconfig
- #29013: Add configure option `--with-sage-venv=SAGE_VENV` to create venv there instead of in SAGE_LOCAL
- #31593: `configure`: Paths within `$SAGE_LOCAL` (`$prefix`) for `sage_conf`
- #31338: `sage_setup`: Use paths within `SAGE_LOCAL` when provided via sage_conf
- #31562: Patch `giac` so that `libintl` from `/usr/local` does not leak in on macOS
- #28890: Install fewer static libraries
- #32045 `sage-env`, `sage.env`: Remove unused environment and Python variables `SAGE_ETC`, `SAGE_INC`
- #32036 `sage.env`: Remove direct uses of SAGE_LOCAL from the Sage library
- #32057 `sage_setup.setenv`: Only set `...PATH` variables and `LDFLAGS` if `SAGE_LOCAL` differs from `SAGE_VENV`
- #31577: Move `SAGE_ROOT/build/pkgs/*/src` to `SAGE_ROOT/pkgs/*`
- #31333: `sage.env.sage_include_directories`: Remove hard dependency on `numpy`
- #32073: Remove `sage.libs.readline`


**Tickets for Sage 9.5:** 

see also [Modularization changes in Sage 9.5](https://wiki.sagemath.org/ReleaseTours/sage-9.5#For_developers_and_packagers:_Modularization_and_packaging_changes) (release tour)

- #32046 Use `pip --use-feature=in-tree-build`, replace use of `sdh_setup_bdist_wheel` by `sdh_pip_install`
- #29847: Install `sage_setup` with `setuptools` as a build prerequisite for building/installing sagelib. Deploy distribution **sage-setup** to PyPI.
- #32371 `ptyprocess`: Pin version to 0.5.1 in install-requires.txt
- #31031 Change `sage_setup: distribution` headers from `sage-...` to `sagemath-...`
- #32386 Merge `pynac` sources as `src/sage/symbolic/ginac` (supersedes #30534)
- #32412: Deprecate `sage.libs.primecount`/`sage.interfaces.primecount`
- #32373: `sage_setup.library_order`: Skip libraries that were not detected
- #32501: Meta-ticket: Clear out `__init__.py` files in preparation for namespace packages
  - #31420/#32479/#32489: Review/remove monkey patching in `src/sage/__init__.py`
  - #32506/#32507/#32508/#32509: `__init__.py` in other packages
  - #32840 Fix `unpickle_global` when `register_unpickle_override` appears in a module not loaded at startup
- #32414 Meta-ticket: New modules providing abstract base classes to enable modularization
  - #32566/#32610/#32612/#32660/#32750 `sage.rings.abc`
  - #32600 `sage.arith`: Use `sage.rings.abc` and move some module-level imports into methods
  - #32606 Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`
  - #32742 Use `sage.rings.abc.RealField`, `sage.rings.abc.ComplexField` more
- #32534/#32591/#32620/#32734/#32733: Remove `.all` imports
- #32442 `./configure`: Make `--with-sage-venv=auto` the default
- #32062: GH Actions: Deploy sdists to PyPI
- #29039: pip-installable version of package **sage-conf** - installs non-Python bits of the Sage distribution in `~/.sage/`
- #32601: Modularization of sagelib: Break out a separate package **sagemath-standard-no-symbolics**
  - #32411/#32413/#32415/#32416: Remove unnecessary uses of `SR` and symbolic functions
  - #32599: `sage.structure`, `sage.sets`: Remove hard dependencies on the symbolic ring / polynomial rings
  - #32593: `sage.modules`, `sage.matrix`: Remove import-time dependencies on the symbolic ring
  - #32638: `sage.structure.element`: Add abc `Expression`; deprecate `is_Expression` etc.
  - #32665: Deprecate `is_[Callable]SymbolicExpressionRing`, remove use of `is_Symbolic{Equation,Variable}`, `is_CallableSymbolicExpression`
  - #32708: `sage.tensor.modules`: remove dependency on `sage.manifolds`
  - #32712: `sage.tensor.modules`: make doctests involving `SR` optional
  - #32725: Modularization changes in `sage.modules`, `sage.matrix`
  - #32730: Import `Expression` from `sage.structure.element`
  - #32717: Move `sage.functions.other.sqrt` to `sage.misc.functional`
  - #32731: Avoid `ceil`, `floor` from `sage.functions.other` in non-symbolic uses
- #32585 `sage.doctest`: Eliminate hard dependency on `RealIntervalField`
- #32614 Features and optional tags for sage modules provided by separate distributions
- #30778 `sage.doctest.control`: Exclude doctests in files via file-level directives
- #32649 Replace `sage.doctest.external.has_*` functions by `Feature`s
- #32650 `sage.misc.latex`: Replace `have_...` functions by `Feature`s
- #32619 `lazy_import`: Muffle diagnostic messages for `at_startup`
- #32432: Modularization of sagelib: Break out a separate package **sagemath-polyhedra**
  - #30022/#32441/#32455/#32775/#32701 Remove compile-time dependency on `cypari2` and `flint` from some modules
  - #32592 `sage.geometry.polyhedron`: Split out `backend_cdd_rdf` from `backend_cdd`
  - #32628 `ConvexSet_base`, `Polyhedron_base`: In `_test` methods, do not fail if some modules are unavailable
  - #32634 `sage.misc.latex`, `sage.repl.display.fancy_repr`: Make imports more local
  - #32652/#32653/#32732 `sage.geometry.polyhedron`: Mark doctests `# optional - sage.rings.number_field` etc.
  - #32635 `sage.matrix.matrix_space`: Import element classes on demand, fall back to generic on `ImportError`
  - #32666 `Polyhedron_base.vertex_adjacency_matrix`: Do not use `face_lattice`
  - #32677 `sage.rings.real_double`: Move methods using GSL to a separate extension module
  - #32625 `Parent._is_numerical`, `_is_real_numerical` - remove hard dependency on `real_mpfr`, `complex_mpfr`
  - #32641 Decentralize `sage.rings.numbers_abc`
  - #32769 `sage.categories.coxeter_groups`: Remove module-level imports from `sage.rings`, `sage.graphs`
  - #32777 Allow some imports of `RLF` to fail
  - #32780 `sage.geometry.polyhedron.library`: Delay import of rings
  - #32778 `sage.rings.infinity`: Remove hard dependency on `real_lazy` and `real_mpfi`
- #31386: Move list of scripts from `setup.py` to `setup.cfg`
- #32899: Developer's guide: Add section on modularization
- #25009/#32894: Split out `sage.libs.primecount`/`sage.interfaces.primecount` as a separate Python library


**Tickets for Sage 9.6:**

see also [Modularization changes in Sage 9.6](https://wiki.sagemath.org/ReleaseTours/sage-9.6#For_developers:_Refactoring_and_modularization) (release tour)

- #29865: Modularization of sagelib: Prepare experimental subset distributions **sagemath-objects**, **sagemath-categories**, depending on Cython, pkgconfig, cysignals, gmpy2.  Use them as a testsuite for testing the filtered structure of sagelib.
- #31013 Remove unused class from `sage_setup.optional_extension`
- #32846 `sage.geometry`: More `# optional`
- #32847 Use `lazy_import` for module-level import from `sage.plot` (outside of `sage.plot`)
- #31306 `sage.repl`: Replace use of `SAGE_EXTCODE` by `importlib.resources`
- #32881/#32888 Feature for `sage.rings.padics` etc.
- #33033 Prepare `sage.doctest` for namespace packages
- #32465 Refactor `{Matrix,Vector}_double_dense` through `..._numpy_dense`, add `..._numpy_integer_dense`
- #33402 `sage.geometry.polyhedron`: More `# optional`
- #33403 `Polyhedron._test_product`, `_test_dilation`: Skip tests if test prereqs cannot be imported
- #33392 `sage.matrix`: Modularization fixes after #33159
- #32989/#32999/#33000/#33007/#33146/#33199 Remove imports from `sage.*.all`
- #32609 Remove more unnecessary uses of SR and symbolic functions in `sage.combinat`
- #32893 Feature for palp
- #31296 `sage.features.Executable`: Prepend `$SAGE_VENV/bin:$SAGE_LOCAL/bin` to `PATH`
- #33440 `sage.libs.singular`: Do not fail if the Singular binary is not in `PATH`
- #33465, #33466, #32645, #33467: Use `Executable.absolute_filename`
- #33017 `LazyImport.__instancecheck__`, `__subclasscheck__`: Return `False` on `ImportError`


**Tickets for Sage 9.7:**

see also [Modularization changes in Sage 9.7](https://trac.sagemath.org/wiki/ReleaseTours/sage-9.7#Modularizationchanges) (release tour)

- #33797/#33799 Remove some uses of `SAGE_TMP` (supersedes #32986)
- #33801 `sage.misc.sage_input`: Remove import from sage.all
- #33803 Fixes for the distributions sagemath-objects, sagemath-categories
- #32716 `pkgs/sagemath-standard/tox.ini`: Create environment that uses Sage's python as the basepython
- #29941: Modularization of sagelib: Break out a separate packages **sagemath-environment**, **sagemath-repl**
- #28925 Modify `find_python_sources` to support modularization of `sagelib` by native namespace packages (PEP 420), rework **sagemath-objects**, **sagemath-categories** as namespace packages
- #33822 `python3` `spkg-configure.m4`: Require `ensurepip`
- #33795 Move handling of `sage --docbuild` back to `src/bin/sage`
- #33821 Remove use of `SAGE_LIB` in `sage.misc`
- #33295: Refactor `sage_conf`
- #33029 Feature and doctest tag for runtime cython
- #33800 cibuildwheel workflow for sagemath-objects, sagemath-categories etc.
- #33011 Remove `__init__.py` files for packages designated to be namespace packages
- #34187 Remove `src/sage/__init__.py`
- #32406: Make `./configure --enable-editable` the default
- #33817 GH Actions: Add test of the modularized distributions
- #34221 Backport PEP420 namespace package support from Cython 3
- #34189/#34190/#34191/#34192/#34428: Remove `.all` imports
- #34296 GH Actions: Upload wheels to PyPI

**Tickets for Sage 9.8:**

- #33812 Refactor distributions sage-setup, sagemath-{objects,categories} through sagemath-{environment,repl}
- #32874 New option `./configure --enable-wheels` (supersedes #32927, #30152)
- #34770/#34823/#34804 Deprecate `sage.interfaces` `is_...Element` functions
- #32664 Deprecate `is_FiniteField` etc., make `sage.rings.finite_rings` a namespace package
- #32709 `sage.structure.element`: Add ABCs `Polynomial`, `MPolynomial` for `isinstance` testing
- #16522 `lazy_import` doesn't resolve properly when indirectly imported
- #34547 Interface issues: should use more lazy imports
- #34858 Fix sagemath-standard sdist
- #34855 Remove direct use of `setup.py sdist`, add targets `make SPKG-sdist`
- #34346 Distributions with optional extension modules: **sagemath-meataxe**, **sagemath-tdlib**, **sagemath-sirocco**, **sagemath-bliss**, ... 
- #30666 Distributions **sagemath-{flint-arb,homfly,giac,gap}**, add `sage_setup: distribution` to Cython modules
- #33577 Migrate from `setup.cfg` to `pyproject.toml`
- #31444 Modularization of sagelib: Break out separate package **sagemath-linbox**
- #33037 Remove use of `SAGE_LIB` variable
- #32432: Modularization of sagelib: Break out a separate package **sagemath-polyhedra**
- #31396: relocatable wheel version of package **sage-conf**
- #32601: Modularization of sagelib: Break out a separate package **sagemath-standard-no-symbolics**
  - #32718 Remove module-level imports from `sage.symbolic` etc. (outside of `sage.symbolic`, `sage.calculus` etc.)
  - #32721 Remove abuse of predefined x in doctests

**Tickets for Sage 9.9**

- #32586: Prepare use of `sage.all` in `sage.structure.factory.lookup_global` for modularized distributions
- #34633 Use `src/setup.py` for the installation mode `--disable-editable --disable-wheels`
- #34590 Use python-build instead of `pip wheel`
- #34209 Use PEP 660 editable wheels for sagelib
- #34631 `sage_setup`: Output depfiles
- #34587 Refactor sagemath-standard through sagemath-{categories,environment,repl}
- #33820 `eager_import`
- #33575 Feature for fricas
- #33802 Remove runtime dependency on everything via `sage_eval`
- #32360 Merge `cypari`, `cypari2`; replace `cysignals`' optional PARI dependency by a general hook
  - #32431 `cysignals`: Replace compile-time dependency on pari by run-time dispatch
- #33202 Do not complain about `sage.categories.all`
- #29870: `Move sage.structure.formal_sum` to `sage.modules`
- #30746 `sage.doctest.control`: Replace use of sage.misc.package.list_packages
- #30848 `sage.doctest.control`, `sage_setup`: Do not check versions of installed packages
- #30911: src/tox.ini: Add "develop" environment
- possibly move `pkgs/sage-conf/sage_conf.py[.in]` into `src/`, mark it (and also `src/bin/sage-env-config[.in]`) `# sage_setup: distribution = sage-conf`.
- #29868: pip-installable packages **sagemath-doc-...**
- #31543: Eliminate use of patches for Python packages
- #30647: Make `lazy_import` more friendly to pyflakes and other static checkers
- #33405 Eliminate direct use of `os.getenv` in `sage.interfaces`, use `Executable.absolute_filename`
- #30036: `sage_conf-pypi`: API for incremental builds
- #29041 `sage_bootstrap`: Add command `sage -package list --output={install-requires,requirements,pipfile,debian,....}`
- Further modularization:
   - #32700: Modularization of sagelib: Distribution **sagemath-gsl**
   - **sagemath-brial** (ex `sage-brial` in `sage.rings.polynomial.pbori` +  `sage.libs.polybori`, `sage.crypto.boolean_function`)
   - #30716 Towards making Arb library optional
    - #32433 Refactor `sage.matrix.misc`
   - #33660 Modularization of sagelib: Break out separate package **sagemath-combinat**
   - #32702 Modularization of sagelib: Distribution **sagemath-plot**
   - #29912: Modularization of sagelib: Break out a separate package `sagemath-ntl`
   - #31695 Modularization of sagelib: Break out separate package **sagemath-symbolics** (depends on ecl and maxima, packages `sage.interfaces.maxima*`, `sage.libs.ecl`)
- #32613: pynac: Replace direct use of singular's libfactory by a Python call
- #32908 Eliminate use of FLINT's NTL interface
- #30371: In-place (editable) installs of sagelib in a venv

**Wishlist tickets, loose ends**
- #30527: Create PEP 503 simple repository for wheels built during installation
- #29877: `sage.categories`: Replace import of `ZZ` by `py_scalar_parent(int)`
- #29875: `sage.structure.coerce.py_scalar_parent`, `py_scalar_to_element`: Make dynamic
- #29874: Mock integer class
- #29845: PEP 517 `buildapi` for `sage_setup`
- #31602: modularized relocatable wheel version of `sage_conf`
- #30748 Convert startup methods to context manager
- #30896: `./configure --with-sage-venv=none`


**Related:**
- #21508 Meta-ticket: Clean up `src/setup.py` to bring it to standard distutils behavior
- https://wiki.sagemath.org/CodeSharingWorkflow
- #30914 Meta-ticket: Create upstream repositories, pip-installable packages for database packages
- #30922 Meta-ticket: Fix dependencies of upstream Python packages
- #30818 Meta-ticket: Set environment for subprocesses invoked by Sage
  - #31041 Set environment for `sage.misc.cython`
- #31251 Meta-ticket: Distribution as wheels
- #33580 Meta-ticket: make all modules importable without sage.all
- #34201 Meta-ticket: Replace imports from sage.*.all for namespace packages


CC:  @videlec @orlitzky @kiwifb @isuruf @tscrim @kliem @jhpalmieri @tobiasdiez @defeo @thierry-freebsd @anneschilling

Keywords: sd109, sd110, sd111

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/29705





---

archive/issue_comments_417757.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd109\".",
    "created_at": "2020-05-28T06:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417757",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd109".



---

archive/issue_comments_417758.json:
```json
{
    "body": "<a id='comment:9'></a>Last 10 new commits:",
    "created_at": "2020-06-03T18:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417758",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Last 10 new commits:



---

archive/issue_comments_417759.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T19:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417760.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T19:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417760",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417761.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-03T20:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_417762.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T21:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417763.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-03T23:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417763",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417764.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-04T06:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417764",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417765.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-06-11T01:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417765",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_417766.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T02:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417767.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T03:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417767",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417768.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T06:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417769.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-11T07:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_417770.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-15T01:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417771.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-15T02:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417772.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-15T04:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417773.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-15T04:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417773",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_075962.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-25T07:05:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75962"
}
```



---

archive/issue_events_075963.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T04:27:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75963"
}
```



---

archive/issue_events_075964.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T04:27:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75964"
}
```



---

archive/issue_comments_417774.json:
```json
{
    "body": "Changing keywords from \"sd109\" to \"sd109, sd110\".",
    "created_at": "2020-10-26T21:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417774",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "sd109" to "sd109, sd110".



---

archive/issue_comments_417775.json:
```json
{
    "body": "Changing keywords from \"sd109, sd110\" to \"sd109, sd110, sd111\".",
    "created_at": "2020-11-22T19:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29705#issuecomment-417775",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "sd109, sd110" to "sd109, sd110, sd111".



---

archive/issue_events_075965.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-15T02:16:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75965"
}
```



---

archive/issue_events_075966.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-15T02:16:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75966"
}
```



---

archive/issue_events_075967.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75967"
}
```



---

archive/issue_events_075968.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75968"
}
```



---

archive/issue_events_075969.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75969"
}
```



---

archive/issue_events_075970.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75970"
}
```



---

archive/issue_events_075971.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-27T21:04:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75971"
}
```



---

archive/issue_events_075972.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-27T21:04:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75972"
}
```



---

archive/issue_events_075973.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75973"
}
```



---

archive/issue_events_075974.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29705",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29705#event-75974"
}
```
