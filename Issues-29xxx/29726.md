# Issue 29726: hash for reflection groups

archive/issues_029489.json:
```json
{
    "body": "This ticket implements a hash for reflection group elements that takes the group into account. This is done to distinguish between type B/C reflection group elements.\n\nCC:  @fchapoton @tscrim\n\nKeywords: reflection groups\n\nBranch/Commit: 12def0bb92bc69247cb6362d91a9ca6d3d768e47\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\n\nAuthor: Christian Stump\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29726\n\n",
    "closed_at": "2020-05-29T21:16:02Z",
    "created_at": "2020-05-22T13:20:00Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "hash for reflection groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29726",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```
This ticket implements a hash for reflection group elements that takes the group into account. This is done to distinguish between type B/C reflection group elements.

CC:  @fchapoton @tscrim

Keywords: reflection groups

Branch/Commit: 12def0bb92bc69247cb6362d91a9ca6d3d768e47

Reviewer: Frédéric Chapoton, Travis Scrimshaw

Author: Christian Stump

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29726





---

archive/issue_comments_575411.json:
```json
{
    "body": "Changing branch from \"\" to \"u/stumpc5/hash_for_reflection_groups\"",
    "created_at": "2020-05-22T13:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575411",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing branch from "" to "u/stumpc5/hash_for_reflection_groups"



---

archive/issue_comments_575412.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[837b1aa](https://github.com/sagemath/sagetrac-mirror/commit/837b1aabbc03d8634f16a269e11be5ac32db5693)|`added hash docstring`|",
    "created_at": "2020-05-22T13:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[837b1aa](https://github.com/sagemath/sagetrac-mirror/commit/837b1aabbc03d8634f16a269e11be5ac32db5693)|`added hash docstring`|



---

archive/issue_comments_575413.json:
```json
{
    "body": "Changing commit from \"\" to \"837b1aabbc03d8634f16a269e11be5ac32db5693\"",
    "created_at": "2020-05-22T13:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "837b1aabbc03d8634f16a269e11be5ac32db5693"



---

archive/issue_comments_575414.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[e811e33](https://github.com/sagemath/sagetrac-mirror/commit/e811e33b20142ba33fb396207f94db9ca3c6387d)|`added hash docstring`|",
    "created_at": "2020-05-22T13:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[e811e33](https://github.com/sagemath/sagetrac-mirror/commit/e811e33b20142ba33fb396207f94db9ca3c6387d)|`added hash docstring`|



---

archive/issue_comments_575415.json:
```json
{
    "body": "Changing commit from \"837b1aabbc03d8634f16a269e11be5ac32db5693\" to \"e811e33b20142ba33fb396207f94db9ca3c6387d\"",
    "created_at": "2020-05-22T13:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575415",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "837b1aabbc03d8634f16a269e11be5ac32db5693" to "e811e33b20142ba33fb396207f94db9ca3c6387d"



---

archive/issue_comments_575416.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-22T13:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575416",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_575417.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[e811e33](https://github.com/sagemath/sagetrac-mirror/commit/e811e33b20142ba33fb396207f94db9ca3c6387d)|`added hash docstring`|",
    "created_at": "2020-05-22T13:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575417",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                      |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[e811e33](https://github.com/sagemath/sagetrac-mirror/commit/e811e33b20142ba33fb396207f94db9ca3c6387d)|`added hash docstring`|



---

archive/issue_comments_575418.json:
```json
{
    "body": "Changing keywords from \"\" to \"reflection groups\".",
    "created_at": "2020-05-22T13:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575418",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing keywords from "" to "reflection groups".



---

archive/issue_comments_575419.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+This ticket implements a hash for reflection group elements that takes the group into account. This is done to distinguish between type B/C reflection group elements.\n``````\n",
    "created_at": "2020-05-22T13:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575419",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+This ticket implements a hash for reflection group elements that takes the group into account. This is done to distinguish between type B/C reflection group elements.
``````




---

archive/issue_comments_575420.json:
```json
{
    "body": "Changing author from \"\" to \"Christian Stump\"",
    "created_at": "2020-05-22T13:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575420",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing author from "" to "Christian Stump"



---

archive/issue_comments_575421.json:
```json
{
    "body": "<a id='comment:5'></a>\n* would be much better not to check for the explicit value of hash, that is no longer deterministic and depend on 32 vs 64 bits\n\nI would suggest to take another element in the same group and check it has another hash.\n\nSame thing for the second part of the doctest, check that the sorted lists are not the same, or maybe simply just that the same word gives different hashes in different groups.\n\n* please add one missing empty line after the first line of the doc",
    "created_at": "2020-05-22T13:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575421",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
* would be much better not to check for the explicit value of hash, that is no longer deterministic and depend on 32 vs 64 bits

I would suggest to take another element in the same group and check it has another hash.

Same thing for the second part of the doctest, check that the sorted lists are not the same, or maybe simply just that the same word gives different hashes in different groups.

* please add one missing empty line after the first line of the doc



---

archive/issue_comments_575422.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[8b3cee5](https://github.com/sagemath/sagetrac-mirror/commit/8b3cee5ca2f39a996651ca80f2830ce36f98d934)|`updated doctests according to Frederic's suggestions`|",
    "created_at": "2020-05-22T13:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[8b3cee5](https://github.com/sagemath/sagetrac-mirror/commit/8b3cee5ca2f39a996651ca80f2830ce36f98d934)|`updated doctests according to Frederic's suggestions`|



---

archive/issue_comments_575423.json:
```json
{
    "body": "Changing commit from \"e811e33b20142ba33fb396207f94db9ca3c6387d\" to \"8b3cee5ca2f39a996651ca80f2830ce36f98d934\"",
    "created_at": "2020-05-22T13:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575423",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e811e33b20142ba33fb396207f94db9ca3c6387d" to "8b3cee5ca2f39a996651ca80f2830ce36f98d934"



---

archive/issue_comments_575424.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[d9a5866](https://github.com/sagemath/sagetrac-mirror/commit/d9a58666bfb4030f7bd4c2d9135d18657f74662c)|`updated doctests according to Frederic's suggestions`|",
    "created_at": "2020-05-22T13:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[d9a5866](https://github.com/sagemath/sagetrac-mirror/commit/d9a58666bfb4030f7bd4c2d9135d18657f74662c)|`updated doctests according to Frederic's suggestions`|



---

archive/issue_comments_575425.json:
```json
{
    "body": "Changing commit from \"8b3cee5ca2f39a996651ca80f2830ce36f98d934\" to \"d9a58666bfb4030f7bd4c2d9135d18657f74662c\"",
    "created_at": "2020-05-22T13:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8b3cee5ca2f39a996651ca80f2830ce36f98d934" to "d9a58666bfb4030f7bd4c2d9135d18657f74662c"



---

archive/issue_comments_575426.json:
```json
{
    "body": "<a id='comment:8'></a>\nBetter?",
    "created_at": "2020-05-22T13:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575426",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:8'></a>
Better?



---

archive/issue_comments_575427.json:
```json
{
    "body": "<a id='comment:9'></a>\nyes, much\n\nstill one thing : use the trac role in the doc\n\n```\nsee :trac:`29726`\n```",
    "created_at": "2020-05-22T14:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575427",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
yes, much

still one thing : use the trac role in the doc

```
see :trac:`29726`
```



---

archive/issue_comments_575428.json:
```json
{
    "body": "Changing commit from \"d9a58666bfb4030f7bd4c2d9135d18657f74662c\" to \"2c9d4f06655bdd6c241887fe4597df8f77b1fc56\"",
    "created_at": "2020-05-22T15:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d9a58666bfb4030f7bd4c2d9135d18657f74662c" to "2c9d4f06655bdd6c241887fe4597df8f77b1fc56"



---

archive/issue_comments_575429.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[2c9d4f0](https://github.com/sagemath/sagetrac-mirror/commit/2c9d4f06655bdd6c241887fe4597df8f77b1fc56)|`used proper trac link`|",
    "created_at": "2020-05-22T15:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575429",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[2c9d4f0](https://github.com/sagemath/sagetrac-mirror/commit/2c9d4f06655bdd6c241887fe4597df8f77b1fc56)|`used proper trac link`|



---

archive/issue_comments_575430.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-22T16:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575430",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_575431.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2020-05-22T16:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575431",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_575432.json:
```json
{
    "body": "<a id='comment:11'></a>\ngut, danke sch\u00f6n",
    "created_at": "2020-05-22T16:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575432",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
gut, danke schön



---

archive/issue_comments_575433.json:
```json
{
    "body": "<a id='comment:12'></a>\nSorry I didn't get a chance to comment on this before the positive review (I was asleep), but I would make the hash faster and more safe against overflow errors by\n\n```\nreturn hash((self._parent,) + tuple(self._reduced_word))\n```\nor\n\n```\nreturn hash(self._parent) | hash(tuple(self._reduced_word))\n```\nIf you have the parent as part of the hash, there is no need to include the map to the index set for the reduced word.",
    "created_at": "2020-05-23T00:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575433",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Sorry I didn't get a chance to comment on this before the positive review (I was asleep), but I would make the hash faster and more safe against overflow errors by

```
return hash((self._parent,) + tuple(self._reduced_word))
```
or

```
return hash(self._parent) | hash(tuple(self._reduced_word))
```
If you have the parent as part of the hash, there is no need to include the map to the index set for the reduced word.



---

archive/issue_comments_575434.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                           |                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|\n|[12def0b](https://github.com/sagemath/sagetrac-mirror/commit/12def0bb92bc69247cb6362d91a9ca6d3d768e47)|`updated hash according to Travis' suggesion, speed factor 2`|",
    "created_at": "2020-05-26T17:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                           |                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
|[12def0b](https://github.com/sagemath/sagetrac-mirror/commit/12def0bb92bc69247cb6362d91a9ca6d3d768e47)|`updated hash according to Travis' suggesion, speed factor 2`|



---

archive/issue_comments_575435.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-05-26T17:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575435",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_575436.json:
```json
{
    "body": "Changing commit from \"2c9d4f06655bdd6c241887fe4597df8f77b1fc56\" to \"12def0bb92bc69247cb6362d91a9ca6d3d768e47\"",
    "created_at": "2020-05-26T17:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2c9d4f06655bdd6c241887fe4597df8f77b1fc56" to "12def0bb92bc69247cb6362d91a9ca6d3d768e47"



---

archive/issue_comments_575437.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-26T22:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575437",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_575438.json:
```json
{
    "body": "Changing reviewer from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\"",
    "created_at": "2020-05-26T22:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575438",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "Frédéric Chapoton" to "Frédéric Chapoton, Travis Scrimshaw"



---

archive/issue_comments_575439.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-29T21:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575439",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_093716.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-29T21:16:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29726#event-93716"
}
```



---

archive/issue_comments_575440.json:
```json
{
    "body": "Changing branch from \"u/stumpc5/hash_for_reflection_groups\" to \"12def0bb92bc69247cb6362d91a9ca6d3d768e47\"",
    "created_at": "2020-05-29T21:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29726#issuecomment-575440",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/stumpc5/hash_for_reflection_groups" to "12def0bb92bc69247cb6362d91a9ca6d3d768e47"
