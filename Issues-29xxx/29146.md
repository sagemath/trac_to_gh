# Issue 29146: Meta-ticket: Refactor and improve system package related scripts, tox.ini, build/bin/write_dockerfile.sh

archive/issues_028909.json:
```json
{
    "body": "Improvements to low-level system packages scripts:\n- #30861, #30865, #30947, #30951, #30968: Refactor system package code in `tox.ini`, `build/bin/write_dockerfile.sh` by extending and using `sage_bootstrap`\n- #33873: Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` \n- #29041 sage_bootstrap: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n- #33860 sage-package: Add commands \"dependencies\", \"trees\"\n\nImprovements to the system package database:\n- #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap\n- define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one, fix up passing installation options when `IGNORE_MISSING_PACKAGES=yes`\n\nImprovements to `tox docker`:\n- #29536 Make docker images from [GitHub](../wikis/GitHub) CI workflow and regular Sage Docker images interoperable\n- optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n- cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n- move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)\n- system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached\n- Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)\n- setenv/passenv SAGE_SERVER\n- Remove `TARGETS_PRE`/`TARGETS` distinction: Instead leave a stamp file and exit from make with an error to trigger the ADD of src/; for example, add `sagelib` dependency on `$(SAGE_SRC)/sage`, and add the rule to Makefile:\n\n```\n$(SAGE_SRC)/sage:\n\ttouch .need_src; exit 1\n```\n- use environment variable `MAKE` for docker builds as well, instead of asking users to pass the `USE_MAKEFLAGS` variable\n\nImprovements to `tox local`:\n- #31216: tox.ini (local): Add environment variables to skip system package installs, mechanism for a local interactive shell\n- #31064: `ci-cygwin*.yml`: delegate to `tox`, add more stages, use more specific `SAGE_LOCAL`\n- #21469: Enable VPATH builds (several independent build trees connected to one source tree)\n- #29416: tox.ini: Add local-copy\n- the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved in our `Makefile`s:\n   - #30721: `build/make/Makefile.in`: `base-toolchain` should be a dependency of every non-base, non-toolchain package\n   - #32785: `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).\n   - #31535 New make targets \"sagelib-sdist\", \"sage_docbuild-sdist\", ... and \"sagelib-tox-...\", ...\nOther improvements to `tox.ini`:\n- #32764: Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)\n- #31574: `tox.ini`, `build/bin/write-dockerfile.sh`: Do not use `make -k` by default\n\nImprovements to auto-generated parts of the manuals:\n- #29558 Autogenerated parts of installation guide\n- #29557 Add script package `_recommended` and generate \"recommended system packages\" info\n\nImprovements for messages at the end of a `./configure` run:\n- #29560 `sage-guess-package-system`: Ignore conda if no environment is activated\n- Perhaps `sage-guess-package-system` should report several package systems such as `conda ubuntu` or `homebrew cpan` when that makes sense\n- #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed\n- #30624: Improve wording and formatting of configure's recommendation message\n- #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n- Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n- #32060 `configure`: Change defaults to `--with-system-gcc=force`, `--with-system-python3=force`\n- #29586: Improve configure's recommendations\n- #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4\n\nTickets regarding `sage_bootstrap`:\n- #20023 `sage_bootstrap`: Remove Python 2.6 support\n- #20104 `sage --package`: Add commands `list :standard:`, `update-latest` (for packages from PyPI), `upload`\n- #29919 Restore \"huge\" package type\n\nSee also: \n- #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n\n\nDepends on #29417\n\n**CC:**  @embray @vbraun @dimpase @jhpalmieri @sheerluck @slel @tobiasdiez @seblabbe\n\n**Branch:** [u/mkoeppe/meta_ticket__refactor_and_improve_system_package_related_scripts__tox_ini__build_bin_write_dockerfile_sh](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/meta_ticket__refactor_and_improve_system_package_related_scripts__tox_ini__build_bin_write_dockerfile_sh)\n\n**Commit:** [fd9b928d573b6740a9aadb1dca04a066d268cc26](https://github.com/sagemath/sagetrac-mirror/commit/fd9b928d573b6740a9aadb1dca04a066d268cc26)\n\nIssue created by migration from https://trac.sagemath.org/ticket/29146\n\n",
    "created_at": "2020-02-03T14:05:35Z",
    "labels": [
        "component: build",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Meta-ticket: Refactor and improve system package related scripts, tox.ini, build/bin/write_dockerfile.sh",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/29146",
    "user": "https://github.com/mkoeppe"
}
```
Improvements to low-level system packages scripts:
- #30861, #30865, #30947, #30951, #30968: Refactor system package code in `tox.ini`, `build/bin/write_dockerfile.sh` by extending and using `sage_bootstrap`
- #33873: Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` 
- #29041 sage_bootstrap: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
- #33860 sage-package: Add commands "dependencies", "trees"

Improvements to the system package database:
- #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap
- define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one, fix up passing installation options when `IGNORE_MISSING_PACKAGES=yes`

Improvements to `tox docker`:
- #29536 Make docker images from [GitHub](../wikis/GitHub) CI workflow and regular Sage Docker images interoperable
- optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
- cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
- move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)
- system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached
- Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)
- setenv/passenv SAGE_SERVER
- Remove `TARGETS_PRE`/`TARGETS` distinction: Instead leave a stamp file and exit from make with an error to trigger the ADD of src/; for example, add `sagelib` dependency on `$(SAGE_SRC)/sage`, and add the rule to Makefile:

```
$(SAGE_SRC)/sage:
	touch .need_src; exit 1
```
- use environment variable `MAKE` for docker builds as well, instead of asking users to pass the `USE_MAKEFLAGS` variable

Improvements to `tox local`:
- #31216: tox.ini (local): Add environment variables to skip system package installs, mechanism for a local interactive shell
- #31064: `ci-cygwin*.yml`: delegate to `tox`, add more stages, use more specific `SAGE_LOCAL`
- #21469: Enable VPATH builds (several independent build trees connected to one source tree)
- #29416: tox.ini: Add local-copy
- the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved in our `Makefile`s:
   - #30721: `build/make/Makefile.in`: `base-toolchain` should be a dependency of every non-base, non-toolchain package
   - #32785: `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).
   - #31535 New make targets "sagelib-sdist", "sage_docbuild-sdist", ... and "sagelib-tox-...", ...
Other improvements to `tox.ini`:
- #32764: Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)
- #31574: `tox.ini`, `build/bin/write-dockerfile.sh`: Do not use `make -k` by default

Improvements to auto-generated parts of the manuals:
- #29558 Autogenerated parts of installation guide
- #29557 Add script package `_recommended` and generate "recommended system packages" info

Improvements for messages at the end of a `./configure` run:
- #29560 `sage-guess-package-system`: Ignore conda if no environment is activated
- Perhaps `sage-guess-package-system` should report several package systems such as `conda ubuntu` or `homebrew cpan` when that makes sense
- #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed
- #30624: Improve wording and formatting of configure's recommendation message
- #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
- Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
- #32060 `configure`: Change defaults to `--with-system-gcc=force`, `--with-system-python3=force`
- #29586: Improve configure's recommendations
- #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4

Tickets regarding `sage_bootstrap`:
- #20023 `sage_bootstrap`: Remove Python 2.6 support
- #20104 `sage --package`: Add commands `list :standard:`, `update-latest` (for packages from PyPI), `upload`
- #29919 Restore "huge" package type

See also: 
- #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages


Depends on #29417

**CC:**  @embray @vbraun @dimpase @jhpalmieri @sheerluck @slel @tobiasdiez @seblabbe

**Branch:** [u/mkoeppe/meta_ticket__refactor_and_improve_system_package_related_scripts__tox_ini__build_bin_write_dockerfile_sh](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/meta_ticket__refactor_and_improve_system_package_related_scripts__tox_ini__build_bin_write_dockerfile_sh)

**Commit:** [fd9b928d573b6740a9aadb1dca04a066d268cc26](https://github.com/sagemath/sagetrac-mirror/commit/fd9b928d573b6740a9aadb1dca04a066d268cc26)

Issue created by migration from https://trac.sagemath.org/ticket/29146





---

archive/issue_comments_459699.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,3 +4,6 @@\n - helper scripts for extracting lists of packages according to criteria\n - possibly, by extending and using `sage_bootstrap`\n \n+Also:\n+- distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc.\n+\n``````\n",
    "created_at": "2020-02-05T20:19:11Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459699",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,3 +4,6 @@
 - helper scripts for extracting lists of packages according to criteria
 - possibly, by extending and using `sage_bootstrap`
 
+Also:
+- distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc.
+
``````




---

archive/issue_comments_459700.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,6 +3,7 @@\n - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.\n - helper scripts for extracting lists of packages according to criteria\n - possibly, by extending and using `sage_bootstrap`\n+- optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n \n Also:\n - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc.\n``````\n",
    "created_at": "2020-02-06T20:16:11Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459700",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,6 +3,7 @@
 - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.
 - helper scripts for extracting lists of packages according to criteria
 - possibly, by extending and using `sage_bootstrap`
+- optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 
 Also:
 - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc.
``````




---

archive/issue_comments_459701.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,5 +6,5 @@\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n \n Also:\n-- distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc.\n+- distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964\n \n``````\n",
    "created_at": "2020-02-09T22:40:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459701",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,5 +6,5 @@
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 
 Also:
-- distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc.
+- distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964
 
``````




---

archive/issue_comments_459702.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,6 +4,7 @@\n - helper scripts for extracting lists of packages according to criteria\n - possibly, by extending and using `sage_bootstrap`\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n+- cache Docker images with system packages installed \n \n Also:\n - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964\n``````\n",
    "created_at": "2020-03-09T16:24:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459702",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,6 +4,7 @@
 - helper scripts for extracting lists of packages according to criteria
 - possibly, by extending and using `sage_bootstrap`
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
+- cache Docker images with system packages installed 
 
 Also:
 - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964
``````




---

archive/issue_comments_459703.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - helper scripts for extracting lists of packages according to criteria\n - possibly, by extending and using `sage_bootstrap`\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n-- cache Docker images with system packages installed \n+- cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n \n Also:\n - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964\n``````\n",
    "created_at": "2020-03-14T21:43:05Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459703",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - helper scripts for extracting lists of packages according to criteria
 - possibly, by extending and using `sage_bootstrap`
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
-- cache Docker images with system packages installed 
+- cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
 
 Also:
 - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964
``````




---

archive/issue_events_259102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-20T02:57:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "rename": {
        "from": "Refactor build/bin/write_dockerfile.sh",
        "to": "Refactor tox.ini and build/bin/write_dockerfile.sh"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259102"
}
```



---

archive/issue_comments_459704.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,6 +6,9 @@\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n \n+tox.ini:\n+- Add user option for configuring number of threads used \n+\n Also:\n - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964\n \n``````\n",
    "created_at": "2020-03-20T02:57:40Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459704",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,6 +6,9 @@
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
 
+tox.ini:
+- Add user option for configuring number of threads used 
+
 Also:
 - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964
 
``````




---

archive/issue_comments_459705.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,6 +5,7 @@\n - possibly, by extending and using `sage_bootstrap`\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n+- define shell quoting in debian .txt, handle options correctly when installing packages one by one \n \n tox.ini:\n - Add user option for configuring number of threads used \n``````\n",
    "created_at": "2020-03-22T09:30:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459705",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,6 +5,7 @@
 - possibly, by extending and using `sage_bootstrap`
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
+- define shell quoting in debian .txt, handle options correctly when installing packages one by one 
 
 tox.ini:
 - Add user option for configuring number of threads used 
``````




---

archive/issue_events_259103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-29T04:02:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "rename": {
        "from": "Refactor tox.ini and build/bin/write_dockerfile.sh",
        "to": "Meta-ticket: Refactor tox.ini and build/bin/write_dockerfile.sh"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259103"
}
```



---

archive/issue_events_259104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-29T04:03:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "rename": {
        "from": "Meta-ticket: Refactor tox.ini and build/bin/write_dockerfile.sh",
        "to": "Meta-ticket: Refactor system package related scripts, tox.ini, build/bin/write_dockerfile.sh"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259104"
}
```



---

archive/issue_comments_459706.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n - possibly, by extending and using `sage_bootstrap`\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n-- define shell quoting in debian .txt, handle options correctly when installing packages one by one \n+- define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one \n \n tox.ini:\n - Add user option for configuring number of threads used \n@@ -13,3 +13,9 @@\n Also:\n - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964\n \n+Related:\n+- #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed\n+- #29372 - At the end of configure, show installation hints for disabled optional packages separately\n+- #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)\n+- #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual\n+\n``````\n",
    "created_at": "2020-03-29T04:07:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459706",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 - possibly, by extending and using `sage_bootstrap`
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
-- define shell quoting in debian .txt, handle options correctly when installing packages one by one 
+- define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one 
 
 tox.ini:
 - Add user option for configuring number of threads used 
@@ -13,3 +13,9 @@
 Also:
 - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964
 
+Related:
+- #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed
+- #29372 - At the end of configure, show installation hints for disabled optional packages separately
+- #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)
+- #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual
+
``````




---

archive/issue_comments_459707.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n - define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one \n+- Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n \n tox.ini:\n - Add user option for configuring number of threads used \n``````\n",
    "created_at": "2020-03-29T04:08:44Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459707",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
 - define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one 
+- Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 
 tox.ini:
 - Add user option for configuring number of threads used 
``````




---

archive/issue_events_259105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:16:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259105"
}
```



---

archive/issue_events_259106.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:16:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259106"
}
```



---

archive/issue_comments_459708.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,6 +15,7 @@\n - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964\n \n Related:\n+- #29417 - has various improvements already \n - #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed\n - #29372 - At the end of configure, show installation hints for disabled optional packages separately\n - #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)\n``````\n",
    "created_at": "2020-04-09T23:16:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459708",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,6 +15,7 @@
 - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964
 
 Related:
+- #29417 - has various improvements already 
 - #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed
 - #29372 - At the end of configure, show installation hints for disabled optional packages separately
 - #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)
``````




---

archive/issue_comments_459709.json:
```json
{
    "body": "**Dependencies:** #29417",
    "created_at": "2020-04-09T23:16:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459709",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #29417



---

archive/issue_comments_459710.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n \n tox.ini:\n-- Add user option for configuring number of threads used \n+- Obtain image from container of failing builds. Move&improve code from tox.yml. Use `docker ps --filter label=.... ` to look up the image more reliably (https://docs.docker.com/engine/reference/commandline/ps/)\n \n Also:\n - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964\n``````\n",
    "created_at": "2020-04-22T00:26:25Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459710",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 
 tox.ini:
-- Add user option for configuring number of threads used 
+- Obtain image from container of failing builds. Move&improve code from tox.yml. Use `docker ps --filter label=.... ` to look up the image more reliably (https://docs.docker.com/engine/reference/commandline/ps/)
 
 Also:
 - distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964
``````




---

archive/issue_comments_459711.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,8 +16,10 @@\n \n Related:\n - #29417 - has various improvements already \n-- #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed\n-- #29372 - At the end of configure, show installation hints for disabled optional packages separately\n - #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)\n - #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual\n \n+Wishlist items:\n+- #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed\n+- #29372 - At the end of configure, show installation hints for disabled optional packages separately\n+\n``````\n",
    "created_at": "2020-04-25T17:53:27Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459711",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,8 +16,10 @@
 
 Related:
 - #29417 - has various improvements already 
-- #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed
-- #29372 - At the end of configure, show installation hints for disabled optional packages separately
 - #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)
 - #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual
 
+Wishlist items:
+- #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed
+- #29372 - At the end of configure, show installation hints for disabled optional packages separately
+
``````




---

archive/issue_events_259107.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-25T17:53:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "rename": {
        "from": "Meta-ticket: Refactor system package related scripts, tox.ini, build/bin/write_dockerfile.sh",
        "to": "Meta-ticket: Refactor and improve system package related scripts, tox.ini, build/bin/write_dockerfile.sh"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259107"
}
```



---

archive/issue_comments_459712.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n - #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)\n - #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual\n \n-Wishlist items:\n+Wishlist items for messages at the end of configure:\n - #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed\n - #29372 - At the end of configure, show installation hints for disabled optional packages separately\n \n``````\n",
    "created_at": "2020-04-25T17:54:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459712",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
 - #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)
 - #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual
 
-Wishlist items:
+Wishlist items for messages at the end of configure:
 - #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed
 - #29372 - At the end of configure, show installation hints for disabled optional packages separately
 
``````




---

archive/issue_comments_459713.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,7 +19,11 @@\n - #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)\n - #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual\n \n-Wishlist items for messages at the end of configure:\n-- #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed\n-- #29372 - At the end of configure, show installation hints for disabled optional packages separately\n+Improvements to auto-generated parts of the manuals:\n+- #29558 Autogenerated parts of installation guide\n \n+Improvements for messages at the end of a `./configure` run:\n+- #29560 `sage-guess-package-system`: Ignore conda if no environment is activated\n+- #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed\n+- #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n+\n``````\n",
    "created_at": "2020-04-25T18:08:15Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459713",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,7 +19,11 @@
 - #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)
 - #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual
 
-Wishlist items for messages at the end of configure:
-- #29363 - At the end of configure, indicate which optional/experimental packages are configured to be installed
-- #29372 - At the end of configure, show installation hints for disabled optional packages separately
+Improvements to auto-generated parts of the manuals:
+- #29558 Autogenerated parts of installation guide
 
+Improvements for messages at the end of a `./configure` run:
+- #29560 `sage-guess-package-system`: Ignore conda if no environment is activated
+- #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed
+- #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
+
``````




---

archive/issue_comments_459714.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,7 +6,6 @@\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n - define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one \n-- Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n \n tox.ini:\n - Obtain image from container of failing builds. Move&improve code from tox.yml. Use `docker ps --filter label=.... ` to look up the image more reliably (https://docs.docker.com/engine/reference/commandline/ps/)\n@@ -26,4 +25,5 @@\n - #29560 `sage-guess-package-system`: Ignore conda if no environment is activated\n - #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed\n - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n+- Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n \n``````\n",
    "created_at": "2020-04-25T18:16:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459714",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,7 +6,6 @@
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
 - define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one 
-- Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 
 tox.ini:
 - Obtain image from container of failing builds. Move&improve code from tox.yml. Use `docker ps --filter label=.... ` to look up the image more reliably (https://docs.docker.com/engine/reference/commandline/ps/)
@@ -26,4 +25,5 @@
 - #29560 `sage-guess-package-system`: Ignore conda if no environment is activated
 - #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed
 - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
+- Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 
``````




---

archive/issue_comments_459715.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,25 +1,26 @@\n-`build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved.\n-\n+Improvements to low-level system packages scripts:\n+- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved.\n - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.\n - helper scripts for extracting lists of packages according to criteria\n - possibly, by extending and using `sage_bootstrap`\n+- Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` \n+\n+Improvements to the system package database:\n+- define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one, fix up passing installation options when `IGNORE_MISSING_PACKAGES=yes`\n+- #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap\n+\n+Improvements to `tox docker`:\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n-- define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one \n+- move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)\n+- Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)\n \n-tox.ini:\n-- Obtain image from container of failing builds. Move&improve code from tox.yml. Use `docker ps --filter label=.... ` to look up the image more reliably (https://docs.docker.com/engine/reference/commandline/ps/)\n-\n-Also:\n-- distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964\n-\n-Related:\n-- #29417 - has various improvements already \n-- #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)\n-- #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual\n+Improvements to `tox local`:\n+- \n \n Improvements to auto-generated parts of the manuals:\n - #29558 Autogenerated parts of installation guide\n+- #29557 Add script package `_recommended` and generate \"recommended system packages\" info\n \n Improvements for messages at the end of a `./configure` run:\n - #29560 `sage-guess-package-system`: Ignore conda if no environment is activated\n@@ -27,3 +28,6 @@\n - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n \n+See also: \n+- #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n+\n``````\n",
    "created_at": "2020-04-25T18:42:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459715",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,25 +1,26 @@
-`build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved.
-
+Improvements to low-level system packages scripts:
+- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved.
 - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.
 - helper scripts for extracting lists of packages according to criteria
 - possibly, by extending and using `sage_bootstrap`
+- Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` 
+
+Improvements to the system package database:
+- define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one, fix up passing installation options when `IGNORE_MISSING_PACKAGES=yes`
+- #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap
+
+Improvements to `tox docker`:
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
-- define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one 
+- move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)
+- Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)
 
-tox.ini:
-- Obtain image from container of failing builds. Move&improve code from tox.yml. Use `docker ps --filter label=.... ` to look up the image more reliably (https://docs.docker.com/engine/reference/commandline/ps/)
-
-Also:
-- distribution-specific commands such as `apt-get install` are in both `build/bin/write_dockerfile.sh` and `build/bin/sage-spkg`. This could be unified as well, or be obtained from another text file etc., by using/extending `build/bin/sage-print-system-package-command` from #26964
-
-Related:
-- #29417 - has various improvements already 
-- #29087 - Add [GitHub](../wikis/GitHub) Actions workflow for testing the build on various Linux distributions via docker; macOS with homebrew; and Windows (cygwin)
-- #29401 - Add documentation of tox and [GitHub](../wikis/GitHub) actions workflow to developer's manual
+Improvements to `tox local`:
+- 
 
 Improvements to auto-generated parts of the manuals:
 - #29558 Autogenerated parts of installation guide
+- #29557 Add script package `_recommended` and generate "recommended system packages" info
 
 Improvements for messages at the end of a `./configure` run:
 - #29560 `sage-guess-package-system`: Ignore conda if no environment is activated
@@ -27,3 +28,6 @@
 - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 
+See also: 
+- #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages
+
``````




---

archive/issue_comments_459716.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,7 +16,11 @@\n - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)\n \n Improvements to `tox local`:\n-- \n+- #29416: tox.ini: Add local-copy\n+- #21469: Enable VPATH builds (several independent build trees connected to one source tree)\n+\n+Other improvements to `tox.ini`:\n+- Make `tox -p auto` useful again (it does not understand the nested braces)\n \n Improvements to auto-generated parts of the manuals:\n - #29558 Autogenerated parts of installation guide\n``````\n",
    "created_at": "2020-04-25T18:45:13Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459716",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,7 +16,11 @@
 - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)
 
 Improvements to `tox local`:
-- 
+- #29416: tox.ini: Add local-copy
+- #21469: Enable VPATH builds (several independent build trees connected to one source tree)
+
+Other improvements to `tox.ini`:
+- Make `tox -p auto` useful again (it does not understand the nested braces)
 
 Improvements to auto-generated parts of the manuals:
 - #29558 Autogenerated parts of installation guide
``````




---

archive/issue_comments_459717.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -28,6 +28,7 @@\n \n Improvements for messages at the end of a `./configure` run:\n - #29560 `sage-guess-package-system`: Ignore conda if no environment is activated\n+- Perhaps `sage-guess-package-system` should report several package systems such as `conda ubuntu` or `homebrew cpan` when that makes sense\n - #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed\n - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n``````\n",
    "created_at": "2020-04-25T22:51:00Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459717",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -28,6 +28,7 @@
 
 Improvements for messages at the end of a `./configure` run:
 - #29560 `sage-guess-package-system`: Ignore conda if no environment is activated
+- Perhaps `sage-guess-package-system` should report several package systems such as `conda ubuntu` or `homebrew cpan` when that makes sense
 - #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed
 - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
``````




---

archive/issue_comments_459718.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -32,6 +32,7 @@\n - #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed\n - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n+- #29586: Improve configure's recommendations\n \n See also: \n - #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n``````\n",
    "created_at": "2020-04-26T03:47:19Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459718",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -32,6 +32,7 @@
 - #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed
 - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
+- #29586: Improve configure's recommendations
 
 See also: 
 - #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages
``````




---

archive/issue_comments_459719.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,6 +13,7 @@\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n - move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)\n+- system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached\n - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)\n \n Improvements to `tox local`:\n``````\n",
    "created_at": "2020-04-27T05:10:29Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459719",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,6 +13,7 @@
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
 - move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)
+- system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached
 - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)
 
 Improvements to `tox local`:
``````




---

archive/issue_comments_459720.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,6 +15,7 @@\n - move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)\n - system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached\n - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)\n+- setenv/passenv SAGE_SERVER\n \n Improvements to `tox local`:\n - #29416: tox.ini: Add local-copy\n``````\n",
    "created_at": "2020-04-28T00:12:24Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459720",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,6 +15,7 @@
 - move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)
 - system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached
 - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)
+- setenv/passenv SAGE_SERVER
 
 Improvements to `tox local`:
 - #29416: tox.ini: Add local-copy
``````




---

archive/issue_comments_459721.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,6 +16,7 @@\n - system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached\n - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)\n - setenv/passenv SAGE_SERVER\n+- Remove TARGETS_PRE/TARGETS distinction: Instead exit from make with a distinctive error code to trigger the ADD of src/\n \n Improvements to `tox local`:\n - #29416: tox.ini: Add local-copy\n``````\n",
    "created_at": "2020-04-28T17:26:31Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459721",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,6 +16,7 @@
 - system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached
 - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)
 - setenv/passenv SAGE_SERVER
+- Remove TARGETS_PRE/TARGETS distinction: Instead exit from make with a distinctive error code to trigger the ADD of src/
 
 Improvements to `tox local`:
 - #29416: tox.ini: Add local-copy
``````




---

archive/issue_comments_459722.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/meta_ticket__refactor_and_improve_system_package_related_scripts__tox_ini__build_bin_write_dockerfile_sh](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/meta_ticket__refactor_and_improve_system_package_related_scripts__tox_ini__build_bin_write_dockerfile_sh)",
    "created_at": "2020-05-15T19:39:23Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459722",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/meta_ticket__refactor_and_improve_system_package_related_scripts__tox_ini__build_bin_write_dockerfile_sh](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/meta_ticket__refactor_and_improve_system_package_related_scripts__tox_ini__build_bin_write_dockerfile_sh)



---

archive/issue_comments_459723.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd9b928d573b6740a9aadb1dca04a066d268cc26\">fd9b928</a></td><td><code>build/bin/sage-logger [V=0]: Show build times of successful builds</code></td></tr></table>\n",
    "created_at": "2020-05-15T19:43:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459723",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd9b928d573b6740a9aadb1dca04a066d268cc26">fd9b928</a></td><td><code>build/bin/sage-logger [V=0]: Show build times of successful builds</code></td></tr></table>




---

archive/issue_comments_459724.json:
```json
{
    "body": "**Commit:** [fd9b928d573b6740a9aadb1dca04a066d268cc26](https://github.com/sagemath/sagetrac-mirror/commit/fd9b928d573b6740a9aadb1dca04a066d268cc26)",
    "created_at": "2020-05-15T19:43:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [fd9b928d573b6740a9aadb1dca04a066d268cc26](https://github.com/sagemath/sagetrac-mirror/commit/fd9b928d573b6740a9aadb1dca04a066d268cc26)



---

archive/issue_comments_459725.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -37,6 +37,11 @@\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n - #29586: Improve configure's recommendations\n \n+Tickets regarding `sage_bootstrap`:\n+- #29919 Restore \"huge\" package type\n+- #20023 `sage_bootstrap`: Remove Python 2.6 support\n+- #20104 `sage --package`: Add commands `list :standard:`, `update-latest` (for packages from PyPI), `upload`\n+\n See also: \n - #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n \n``````\n",
    "created_at": "2020-06-20T17:27:39Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459725",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -37,6 +37,11 @@
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 - #29586: Improve configure's recommendations
 
+Tickets regarding `sage_bootstrap`:
+- #29919 Restore "huge" package type
+- #20023 `sage_bootstrap`: Remove Python 2.6 support
+- #20104 `sage --package`: Add commands `list :standard:`, `update-latest` (for packages from PyPI), `upload`
+
 See also: 
 - #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages
 
``````




---

archive/issue_events_259108.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259108"
}
```



---

archive/issue_events_259109.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259109"
}
```



---

archive/issue_comments_459726.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,8 @@\n Improvements to low-level system packages scripts:\n-- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved.\n-- instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.\n-- helper scripts for extracting lists of packages according to criteria\n-- possibly, by extending and using `sage_bootstrap`\n+- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861\n+   - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.\n+   - helper scripts for extracting lists of packages according to criteria\n+   - possibly, by extending and using `sage_bootstrap`\n - Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` \n \n Improvements to the system package database:\n``````\n",
    "created_at": "2020-11-03T23:29:50Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459726",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,8 @@
 Improvements to low-level system packages scripts:
-- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved.
-- instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.
-- helper scripts for extracting lists of packages according to criteria
-- possibly, by extending and using `sage_bootstrap`
+- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861
+   - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.
+   - helper scripts for extracting lists of packages according to criteria
+   - possibly, by extending and using `sage_bootstrap`
 - Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` 
 
 Improvements to the system package database:
``````




---

archive/issue_comments_459727.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -36,6 +36,7 @@\n - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n - #29586: Improve configure's recommendations\n+- #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4\n \n Tickets regarding `sage_bootstrap`:\n - #29919 Restore \"huge\" package type\n``````\n",
    "created_at": "2020-11-04T20:23:15Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459727",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -36,6 +36,7 @@
 - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 - #29586: Improve configure's recommendations
+- #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4
 
 Tickets regarding `sage_bootstrap`:
 - #29919 Restore "huge" package type
``````




---

archive/issue_comments_459728.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Improvements to low-level system packages scripts:\n-- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861\n+- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861, #30865\n    - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.\n    - helper scripts for extracting lists of packages according to criteria\n    - possibly, by extending and using `sage_bootstrap`\n``````\n",
    "created_at": "2020-11-04T22:01:37Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459728",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Improvements to low-level system packages scripts:
-- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861
+- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861, #30865
    - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.
    - helper scripts for extracting lists of packages according to criteria
    - possibly, by extending and using `sage_bootstrap`
``````




---

archive/issue_comments_459729.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -36,6 +36,7 @@\n - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n - #29586: Improve configure's recommendations\n+- #30624: Improve wording and formatting of configure's recommendation message\n - #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4\n \n Tickets regarding `sage_bootstrap`:\n``````\n",
    "created_at": "2020-11-17T02:47:45Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459729",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -36,6 +36,7 @@
 - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 - #29586: Improve configure's recommendations
+- #30624: Improve wording and formatting of configure's recommendation message
 - #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4
 
 Tickets regarding `sage_bootstrap`:
``````




---

archive/issue_comments_459730.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Improvements to low-level system packages scripts:\n-- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861, #30865\n+- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861, #30865, #30947, #30951, #30968\n    - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.\n    - helper scripts for extracting lists of packages according to criteria\n    - possibly, by extending and using `sage_bootstrap`\n``````\n",
    "created_at": "2020-11-29T20:31:05Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459730",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Improvements to low-level system packages scripts:
-- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861, #30865
+- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861, #30865, #30947, #30951, #30968
    - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.
    - helper scripts for extracting lists of packages according to criteria
    - possibly, by extending and using `sage_bootstrap`
``````




---

archive/issue_comments_459731.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -21,9 +21,11 @@\n Improvements to `tox local`:\n - #29416: tox.ini: Add local-copy\n - #21469: Enable VPATH builds (several independent build trees connected to one source tree)\n+- #31216: tox.ini (local): Add environment variables to skip system package installs, mechanism for a local interactive shell\n+- #31064: `ci-cygwin*.yml`: delegate to `tox`, add more stages, use more specific `SAGE_LOCAL`\n \n Other improvements to `tox.ini`:\n-- Make `tox -p auto` useful again (it does not understand the nested braces)\n+- Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)\n \n Improvements to auto-generated parts of the manuals:\n - #29558 Autogenerated parts of installation guide\n``````\n",
    "created_at": "2021-01-10T00:19:11Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459731",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -21,9 +21,11 @@
 Improvements to `tox local`:
 - #29416: tox.ini: Add local-copy
 - #21469: Enable VPATH builds (several independent build trees connected to one source tree)
+- #31216: tox.ini (local): Add environment variables to skip system package installs, mechanism for a local interactive shell
+- #31064: `ci-cygwin*.yml`: delegate to `tox`, add more stages, use more specific `SAGE_LOCAL`
 
 Other improvements to `tox.ini`:
-- Make `tox -p auto` useful again (it does not understand the nested braces)
+- Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)
 
 Improvements to auto-generated parts of the manuals:
 - #29558 Autogenerated parts of installation guide
``````




---

archive/issue_comments_459732.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -23,6 +23,9 @@\n - #21469: Enable VPATH builds (several independent build trees connected to one source tree)\n - #31216: tox.ini (local): Add environment variables to skip system package installs, mechanism for a local interactive shell\n - #31064: `ci-cygwin*.yml`: delegate to `tox`, add more stages, use more specific `SAGE_LOCAL`\n+- the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved in our `Makefile`s:\n+   - #30721: `build/make/Makefile.in`: `base-toolchain` should be a dependency of every non-base, non-toolchain package\n+   - `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).\n \n Other improvements to `tox.ini`:\n - Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)\n``````\n",
    "created_at": "2021-01-10T00:24:56Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459732",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -23,6 +23,9 @@
 - #21469: Enable VPATH builds (several independent build trees connected to one source tree)
 - #31216: tox.ini (local): Add environment variables to skip system package installs, mechanism for a local interactive shell
 - #31064: `ci-cygwin*.yml`: delegate to `tox`, add more stages, use more specific `SAGE_LOCAL`
+- the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved in our `Makefile`s:
+   - #30721: `build/make/Makefile.in`: `base-toolchain` should be a dependency of every non-base, non-toolchain package
+   - `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).
 
 Other improvements to `tox.ini`:
 - Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)
``````




---

archive/issue_comments_459733.json:
```json
{
    "body": "<a id='comment:39'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459733",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_259110.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259110"
}
```



---

archive/issue_events_259111.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259111"
}
```



---

archive/issue_comments_459734.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,7 +16,12 @@\n - system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached\n - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)\n - setenv/passenv SAGE_SERVER\n-- Remove TARGETS_PRE/TARGETS distinction: Instead exit from make with a distinctive error code to trigger the ADD of src/\n+- Remove `TARGETS_PRE`/`TARGETS` distinction: Instead exit from make with a distinctive error code to trigger the ADD of src/; for example, add `sagelib` dependency on `$(SAGE_SRC)/sage`, and add the rule to Makefile:\n+\n+```\n+$(SAGE_SRC)/sage:\n+\texit 76\n+```\n \n Improvements to `tox local`:\n - #29416: tox.ini: Add local-copy\n``````\n",
    "created_at": "2021-03-28T05:06:05Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459734",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,7 +16,12 @@
 - system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached
 - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)
 - setenv/passenv SAGE_SERVER
-- Remove TARGETS_PRE/TARGETS distinction: Instead exit from make with a distinctive error code to trigger the ADD of src/
+- Remove `TARGETS_PRE`/`TARGETS` distinction: Instead exit from make with a distinctive error code to trigger the ADD of src/; for example, add `sagelib` dependency on `$(SAGE_SRC)/sage`, and add the rule to Makefile:
+
+```
+$(SAGE_SRC)/sage:
+	exit 76
+```
 
 Improvements to `tox local`:
 - #29416: tox.ini: Add local-copy
``````




---

archive/issue_comments_459735.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,11 +16,11 @@\n - system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached\n - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)\n - setenv/passenv SAGE_SERVER\n-- Remove `TARGETS_PRE`/`TARGETS` distinction: Instead exit from make with a distinctive error code to trigger the ADD of src/; for example, add `sagelib` dependency on `$(SAGE_SRC)/sage`, and add the rule to Makefile:\n+- Remove `TARGETS_PRE`/`TARGETS` distinction: Instead leave a stamp file and exit from make with an error to trigger the ADD of src/; for example, add `sagelib` dependency on `$(SAGE_SRC)/sage`, and add the rule to Makefile:\n \n ```\n $(SAGE_SRC)/sage:\n-\texit 76\n+\ttouch .need_src; exit 1\n ```\n \n Improvements to `tox local`:\n``````\n",
    "created_at": "2021-03-28T05:09:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459735",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,11 +16,11 @@
 - system package installation should retry a few times when installation errors because of network errors occur. In particular for docker because an incomplete step will be cached
 - Make obtaining image from container of failing builds more robust: Use LABEL commands in dockerfiles, use `docker ps --filter label=.... ` to look up the container (https://docs.docker.com/engine/reference/commandline/ps/)
 - setenv/passenv SAGE_SERVER
-- Remove `TARGETS_PRE`/`TARGETS` distinction: Instead exit from make with a distinctive error code to trigger the ADD of src/; for example, add `sagelib` dependency on `$(SAGE_SRC)/sage`, and add the rule to Makefile:
+- Remove `TARGETS_PRE`/`TARGETS` distinction: Instead leave a stamp file and exit from make with an error to trigger the ADD of src/; for example, add `sagelib` dependency on `$(SAGE_SRC)/sage`, and add the rule to Makefile:
 
 ```
 $(SAGE_SRC)/sage:
-	exit 76
+	touch .need_src; exit 1
 ```
 
 Improvements to `tox local`:
``````




---

archive/issue_comments_459736.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,5 @@\n Improvements to low-level system packages scripts:\n-- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861, #30865, #30947, #30951, #30968\n-   - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.\n-   - helper scripts for extracting lists of packages according to criteria\n-   - possibly, by extending and using `sage_bootstrap`\n+- #30861, #30865, #30947, #30951, #30968: Refactor system package code in `tox.ini`, `build/bin/write_dockerfile.sh` by extending and using `sage_bootstrap`\n - Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` \n \n Improvements to the system package database:\n@@ -22,6 +19,7 @@\n $(SAGE_SRC)/sage:\n \ttouch .need_src; exit 1\n ```\n+- use environment variable `MAKE` for docker builds as well, instead of asking users to pass the `USE_MAKEFLAGS` variable\n \n Improvements to `tox local`:\n - #29416: tox.ini: Add local-copy\n@@ -34,6 +32,8 @@\n \n Other improvements to `tox.ini`:\n - Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)\n+- #31574: `tox.ini`, `build/bin/write-dockerfile.sh`: Do not use `make -k` by default\n+- \n \n Improvements to auto-generated parts of the manuals:\n - #29558 Autogenerated parts of installation guide\n``````\n",
    "created_at": "2021-03-28T18:38:41Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459736",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,5 @@
 Improvements to low-level system packages scripts:
-- `build/bin/write_dockerfile.sh`, introduced in #29053, determines lists of system packages in a rather crude way. This should be improved. #30861, #30865, #30947, #30951, #30968
-   - instead of passing `TYPE_PATTERN` to `build/bin/write_dockerfile.sh`, do the work in `tox.ini`.
-   - helper scripts for extracting lists of packages according to criteria
-   - possibly, by extending and using `sage_bootstrap`
+- #30861, #30865, #30947, #30951, #30968: Refactor system package code in `tox.ini`, `build/bin/write_dockerfile.sh` by extending and using `sage_bootstrap`
 - Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` 
 
 Improvements to the system package database:
@@ -22,6 +19,7 @@
 $(SAGE_SRC)/sage:
 	touch .need_src; exit 1
 ```
+- use environment variable `MAKE` for docker builds as well, instead of asking users to pass the `USE_MAKEFLAGS` variable
 
 Improvements to `tox local`:
 - #29416: tox.ini: Add local-copy
@@ -34,6 +32,8 @@
 
 Other improvements to `tox.ini`:
 - Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)
+- #31574: `tox.ini`, `build/bin/write-dockerfile.sh`: Do not use `make -k` by default
+- 
 
 Improvements to auto-generated parts of the manuals:
 - #29558 Autogenerated parts of installation guide
``````




---

archive/issue_comments_459737.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,10 +3,11 @@\n - Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` \n \n Improvements to the system package database:\n+- #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap\n - define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one, fix up passing installation options when `IGNORE_MISSING_PACKAGES=yes`\n-- #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap\n \n Improvements to `tox docker`:\n+- #29536 Make docker images from [GitHub](../wikis/GitHub) CI workflow and regular Sage Docker images interoperable\n - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)\n - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache\n - move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)\n@@ -22,18 +23,17 @@\n - use environment variable `MAKE` for docker builds as well, instead of asking users to pass the `USE_MAKEFLAGS` variable\n \n Improvements to `tox local`:\n-- #29416: tox.ini: Add local-copy\n-- #21469: Enable VPATH builds (several independent build trees connected to one source tree)\n - #31216: tox.ini (local): Add environment variables to skip system package installs, mechanism for a local interactive shell\n - #31064: `ci-cygwin*.yml`: delegate to `tox`, add more stages, use more specific `SAGE_LOCAL`\n+- #21469: Enable VPATH builds (several independent build trees connected to one source tree)\n+- #29416: tox.ini: Add local-copy\n - the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved in our `Makefile`s:\n    - #30721: `build/make/Makefile.in`: `base-toolchain` should be a dependency of every non-base, non-toolchain package\n    - `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).\n-\n+   - #31535 New make targets \"sagelib-sdist\", \"sage_docbuild-sdist\", ... and \"sagelib-tox-...\", ...\n Other improvements to `tox.ini`:\n - Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)\n - #31574: `tox.ini`, `build/bin/write-dockerfile.sh`: Do not use `make -k` by default\n-- \n \n Improvements to auto-generated parts of the manuals:\n - #29558 Autogenerated parts of installation guide\n@@ -43,16 +43,16 @@\n - #29560 `sage-guess-package-system`: Ignore conda if no environment is activated\n - Perhaps `sage-guess-package-system` should report several package systems such as `conda ubuntu` or `homebrew cpan` when that makes sense\n - #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed\n+- #30624: Improve wording and formatting of configure's recommendation message\n - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n - #29586: Improve configure's recommendations\n-- #30624: Improve wording and formatting of configure's recommendation message\n - #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4\n \n Tickets regarding `sage_bootstrap`:\n-- #29919 Restore \"huge\" package type\n - #20023 `sage_bootstrap`: Remove Python 2.6 support\n - #20104 `sage --package`: Add commands `list :standard:`, `update-latest` (for packages from PyPI), `upload`\n+- #29919 Restore \"huge\" package type\n \n See also: \n - #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages\n``````\n",
    "created_at": "2021-03-28T19:51:37Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459737",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,10 +3,11 @@
 - Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` 
 
 Improvements to the system package database:
+- #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap
 - define shell quoting in files like `debian.txt`, handle options correctly when installing packages one by one, fix up passing installation options when `IGNORE_MISSING_PACKAGES=yes`
-- #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap
 
 Improvements to `tox docker`:
+- #29536 Make docker images from [GitHub](../wikis/GitHub) CI workflow and regular Sage Docker images interoperable
 - optionally create a script for `docker run` instead of a `Dockerfile` (this gives more flexibility for multiarch - see #29143)
 - cache Docker images with system packages installed ... https://github.com/marketplace/actions/build-docker-images-using-cache
 - move log extraction code from tox.yml to tox.ini (#29530 did some preparation already)
@@ -22,18 +23,17 @@
 - use environment variable `MAKE` for docker builds as well, instead of asking users to pass the `USE_MAKEFLAGS` variable
 
 Improvements to `tox local`:
-- #29416: tox.ini: Add local-copy
-- #21469: Enable VPATH builds (several independent build trees connected to one source tree)
 - #31216: tox.ini (local): Add environment variables to skip system package installs, mechanism for a local interactive shell
 - #31064: `ci-cygwin*.yml`: delegate to `tox`, add more stages, use more specific `SAGE_LOCAL`
+- #21469: Enable VPATH builds (several independent build trees connected to one source tree)
+- #29416: tox.ini: Add local-copy
 - the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved in our `Makefile`s:
    - #30721: `build/make/Makefile.in`: `base-toolchain` should be a dependency of every non-base, non-toolchain package
    - `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).
-
+   - #31535 New make targets "sagelib-sdist", "sage_docbuild-sdist", ... and "sagelib-tox-...", ...
 Other improvements to `tox.ini`:
 - Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)
 - #31574: `tox.ini`, `build/bin/write-dockerfile.sh`: Do not use `make -k` by default
-- 
 
 Improvements to auto-generated parts of the manuals:
 - #29558 Autogenerated parts of installation guide
@@ -43,16 +43,16 @@
 - #29560 `sage-guess-package-system`: Ignore conda if no environment is activated
 - Perhaps `sage-guess-package-system` should report several package systems such as `conda ubuntu` or `homebrew cpan` when that makes sense
 - #29363 - At the end of `configure`, indicate which optional/experimental packages are configured to be installed
+- #30624: Improve wording and formatting of configure's recommendation message
 - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
 - #29586: Improve configure's recommendations
-- #30624: Improve wording and formatting of configure's recommendation message
 - #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4
 
 Tickets regarding `sage_bootstrap`:
-- #29919 Restore "huge" package type
 - #20023 `sage_bootstrap`: Remove Python 2.6 support
 - #20104 `sage --package`: Add commands `list :standard:`, `update-latest` (for packages from PyPI), `upload`
+- #29919 Restore "huge" package type
 
 See also: 
 - #29060 Meta-ticket: Add Dockerfiles and CI scripts for integration testing of source and binary distributions and of downstream packages
``````




---

archive/issue_comments_459738.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -46,6 +46,7 @@\n - #30624: Improve wording and formatting of configure's recommendation message\n - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately\n - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)\n+- #32060 `configure`: Change defaults to `--with-system-gcc=force`, `--with-system-python3=force`\n - #29586: Improve configure's recommendations\n - #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4\n \n``````\n",
    "created_at": "2021-06-25T18:32:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459738",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -46,6 +46,7 @@
 - #30624: Improve wording and formatting of configure's recommendation message
 - #29372 - At the end of `configure`, show installation hints for disabled optional packages separately
 - Hints after ./configure: maybe sort and remove duplicates (https://groups.google.com/d/msg/sage-devel/EWTVN-Fmc8w/y9933Zo1AQAJ)
+- #32060 `configure`: Change defaults to `--with-system-gcc=force`, `--with-system-python3=force`
 - #29586: Improve configure's recommendations
 - #30863: refine definition of variable SAGE_NEED_SYSTEM_PACKAGES in m4/sage_spkg_collect.m4
 
``````




---

archive/issue_events_259112.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259112"
}
```



---

archive/issue_events_259113.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259113"
}
```



---

archive/issue_comments_459739.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -32,7 +32,7 @@\n    - `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).\n    - #31535 New make targets \"sagelib-sdist\", \"sage_docbuild-sdist\", ... and \"sagelib-tox-...\", ...\n Other improvements to `tox.ini`:\n-- Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)\n+- #32764: Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)\n - #31574: `tox.ini`, `build/bin/write-dockerfile.sh`: Do not use `make -k` by default\n \n Improvements to auto-generated parts of the manuals:\n``````\n",
    "created_at": "2021-10-25T15:52:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459739",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -32,7 +32,7 @@
    - `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).
    - #31535 New make targets "sagelib-sdist", "sage_docbuild-sdist", ... and "sagelib-tox-...", ...
 Other improvements to `tox.ini`:
-- Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)
+- #32764: Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)
 - #31574: `tox.ini`, `build/bin/write-dockerfile.sh`: Do not use `make -k` by default
 
 Improvements to auto-generated parts of the manuals:
``````




---

archive/issue_comments_459740.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -29,7 +29,7 @@\n - #29416: tox.ini: Add local-copy\n - the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved in our `Makefile`s:\n    - #30721: `build/make/Makefile.in`: `base-toolchain` should be a dependency of every non-base, non-toolchain package\n-   - `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).\n+   - #32785: `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).\n    - #31535 New make targets \"sagelib-sdist\", \"sage_docbuild-sdist\", ... and \"sagelib-tox-...\", ...\n Other improvements to `tox.ini`:\n - #32764: Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)\n``````\n",
    "created_at": "2021-10-28T06:11:46Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459740",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -29,7 +29,7 @@
 - #29416: tox.ini: Add local-copy
 - the complicated rule for the commands of `local` consists entirely of workarounds for things that should really be fixed/improved in our `Makefile`s:
    - #30721: `build/make/Makefile.in`: `base-toolchain` should be a dependency of every non-base, non-toolchain package
-   - `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).
+   - #32785: `tox.ini` and `build/bin/write-dockerfile.sh` use better defaults for `SAGE_CHECK_PACKAGES`; this should be moved to `build/make/Makefile.in` (`SAGE_CHECK_PACKAGES_DEFAULT_yes`).
    - #31535 New make targets "sagelib-sdist", "sage_docbuild-sdist", ... and "sagelib-tox-...", ...
 Other improvements to `tox.ini`:
 - #32764: Make `tox -p auto` and `tox --listenvs` useful again (it does not understand the nested braces)
``````




---

archive/issue_events_259114.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259114"
}
```



---

archive/issue_events_259115.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259115"
}
```



---

archive/issue_events_259116.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259116"
}
```



---

archive/issue_events_259117.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259117"
}
```



---

archive/issue_comments_459741.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n Improvements to low-level system packages scripts:\n - #30861, #30865, #30947, #30951, #30968: Refactor system package code in `tox.ini`, `build/bin/write_dockerfile.sh` by extending and using `sage_bootstrap`\n - Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` \n+- #29041 sage_bootstrap: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- #33860 sage-package: Add commands \"dependencies\", \"trees\"\n \n Improvements to the system package database:\n - #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap\n``````\n",
    "created_at": "2022-05-17T05:40:55Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459741",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 Improvements to low-level system packages scripts:
 - #30861, #30865, #30947, #30951, #30968: Refactor system package code in `tox.ini`, `build/bin/write_dockerfile.sh` by extending and using `sage_bootstrap`
 - Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` 
+- #29041 sage_bootstrap: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- #33860 sage-package: Add commands "dependencies", "trees"
 
 Improvements to the system package database:
 - #29124 Add script packages build/pkgs/_prereq, build/pkgs/_toolchain, build/pkgs/_bootstrap
``````




---

archive/issue_comments_459742.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Improvements to low-level system packages scripts:\n - #30861, #30865, #30947, #30951, #30968: Refactor system package code in `tox.ini`, `build/bin/write_dockerfile.sh` by extending and using `sage_bootstrap`\n-- Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` \n+- #33873: Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` \n - #29041 sage_bootstrap: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n - #33860 sage-package: Add commands \"dependencies\", \"trees\"\n \n``````\n",
    "created_at": "2022-05-20T03:43:07Z",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29146#issuecomment-459742",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Improvements to low-level system packages scripts:
 - #30861, #30865, #30947, #30951, #30968: Refactor system package code in `tox.ini`, `build/bin/write_dockerfile.sh` by extending and using `sage_bootstrap`
-- Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` 
+- #33873: Extend `build/bin/sage-print-system-package-command` so that it can provide all distribution-specific commands such as `apt-get install` for `build/bin/write_dockerfile.sh` 
 - #29041 sage_bootstrap: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
 - #33860 sage-package: Add commands "dependencies", "trees"
 
``````




---

archive/issue_events_259118.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259118"
}
```



---

archive/issue_events_259119.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29146",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29146#event-259119"
}
```
