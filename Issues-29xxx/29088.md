# Issue 29088: Fix BLAS-related installation errors on various systems

archive/issues_028851.json:
```json
{
    "body": "Errors on various platforms tested at https://github.com/mkoeppe/sage/actions/runs/31716135. Examples:\n\n- archlinux-latest-standard at https://github.com/mkoeppe/sage/runs/410329835:\n  \n   ```\n  * package: fflas_ffpack-2.4.3\n  log file: /sage/logs/pkgs/fflas_ffpack-2.4.3.log\n  build directory: /sage/local/var/tmp/sage/build/fflas_ffpack-2.4.3\n\n* package: iml-1.0.4p1.p2\n  log file: /sage/logs/pkgs/iml-1.0.4p1.p2.log\n  build directory: /sage/local/var/tmp/sage/build/iml-1.0.4p1.p2\n\n* package: r-3.6.2\n  log file: /sage/logs/pkgs/r-3.6.2.log\n  build directory: /sage/local/var/tmp/sage/build/r-3.6.2\n\n* package: suitesparse-5.6.0\n  log file: /sage/logs/pkgs/suitesparse-5.6.0.log\n  build directory: /sage/local/var/tmp/sage/build/suitesparse-5.6.0\n  ```\n  Of these, at least the  fflas_ffpack error comes from openblas.\n\n- ubuntu-bionic-minimal (https://github.com/mkoeppe/sage/runs/410329574)\n   builds openblas from source, then installing R from source fails with openblas-related errors\n\n- fedora-32-standard (https://github.com/mkoeppe/sage/runs/410329823)\n   configure fails to detect openblas, error building openblas from source\n\n**CC:**  @dimpase @kiwifb @mwageringel @orlitzky\n\n**Reviewer:** Marc Mezzarobba\n\n**Dependencies:** #29051, #29071\n\n**Resolution:** invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/29088\n\n",
    "closed_at": "2021-09-18T17:51:47Z",
    "created_at": "2020-01-27T19:56:48Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Fix BLAS-related installation errors on various systems",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29088",
    "user": "https://github.com/mkoeppe"
}
```
Errors on various platforms tested at https://github.com/mkoeppe/sage/actions/runs/31716135. Examples:

- archlinux-latest-standard at https://github.com/mkoeppe/sage/runs/410329835:
  
   ```
  * package: fflas_ffpack-2.4.3
  log file: /sage/logs/pkgs/fflas_ffpack-2.4.3.log
  build directory: /sage/local/var/tmp/sage/build/fflas_ffpack-2.4.3

* package: iml-1.0.4p1.p2
  log file: /sage/logs/pkgs/iml-1.0.4p1.p2.log
  build directory: /sage/local/var/tmp/sage/build/iml-1.0.4p1.p2

* package: r-3.6.2
  log file: /sage/logs/pkgs/r-3.6.2.log
  build directory: /sage/local/var/tmp/sage/build/r-3.6.2

* package: suitesparse-5.6.0
  log file: /sage/logs/pkgs/suitesparse-5.6.0.log
  build directory: /sage/local/var/tmp/sage/build/suitesparse-5.6.0
  ```
  Of these, at least the  fflas_ffpack error comes from openblas.

- ubuntu-bionic-minimal (https://github.com/mkoeppe/sage/runs/410329574)
   builds openblas from source, then installing R from source fails with openblas-related errors

- fedora-32-standard (https://github.com/mkoeppe/sage/runs/410329823)
   configure fails to detect openblas, error building openblas from source

**CC:**  @dimpase @kiwifb @mwageringel @orlitzky

**Reviewer:** Marc Mezzarobba

**Dependencies:** #29051, #29071

**Resolution:** invalid

Issue created by migration from https://trac.sagemath.org/ticket/29088





---

archive/issue_comments_567453.json:
```json
{
    "body": "<a id='comment:1'></a>\nI don't see how the R error on archlinux-latest-standard: \n\n```\n2020-01-27T09:05:30.3588775Z byte-compiling package 'graphics'\n2020-01-27T09:05:30.3589064Z Error : .onLoad failed in loadNamespace() for 'utils', details:\n2020-01-27T09:05:30.3589172Z   call: system(paste(which, shQuote(names[i])), intern = TRUE, ignore.stderr = TRUE)\n2020-01-27T09:05:30.3589286Z   error: error in running command\n2020-01-27T09:05:30.3589557Z Error: unable to load R code in package 'graphics'\n2020-01-27T09:05:30.3589663Z Execution halted\n2020-01-27T09:05:30.3589762Z make[6]: *** [../../../share/make/lazycomp.mk:9: ../../../library/graphics/R/graphics.rdb] Error 1\n2020-01-27T09:05:30.3590303Z make[6]: Target 'mklazycomp' not remade because of errors.\n2020-01-27T09:05:30.3590634Z make[6]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src/src/library/graphics'\n2020-01-27T09:05:30.3590756Z make[5]: *** [Makefile:27: all] Error 2\n2020-01-27T09:05:30.3591062Z make[5]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src/src/library/graphics'\n2020-01-27T09:05:30.3591191Z make[4]: *** [Makefile:39: R] Error 1\n2020-01-27T09:05:30.3591507Z make[4]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src/src/library'\n2020-01-27T09:05:30.3591627Z make[3]: *** [Makefile:28: R] Error 1\n2020-01-27T09:05:30.3591927Z make[3]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src/src'\n2020-01-27T09:05:30.3592029Z make[2]: *** [Makefile:61: R] Error 1\n2020-01-27T09:05:30.3592328Z make[2]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src'\n2020-01-27T09:05:30.3592443Z Error building R.\n2020-01-27T09:05:30.3592496Z \n2020-01-27T09:05:30.3592594Z real\t2m31.753s\n2020-01-27T09:05:30.3592692Z user\t3m18.995s\n2020-01-27T09:05:30.3592773Z sys\t0m19.046s\n2020-01-27T09:05:30.3592876Z ************************************************************************\n2020-01-27T09:05:30.3593142Z Error installing package r-3.6.2\n```\nhas anything to do with openblas.",
    "created_at": "2020-01-27T21:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567453",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
I don't see how the R error on archlinux-latest-standard: 

```
2020-01-27T09:05:30.3588775Z byte-compiling package 'graphics'
2020-01-27T09:05:30.3589064Z Error : .onLoad failed in loadNamespace() for 'utils', details:
2020-01-27T09:05:30.3589172Z   call: system(paste(which, shQuote(names[i])), intern = TRUE, ignore.stderr = TRUE)
2020-01-27T09:05:30.3589286Z   error: error in running command
2020-01-27T09:05:30.3589557Z Error: unable to load R code in package 'graphics'
2020-01-27T09:05:30.3589663Z Execution halted
2020-01-27T09:05:30.3589762Z make[6]: *** [../../../share/make/lazycomp.mk:9: ../../../library/graphics/R/graphics.rdb] Error 1
2020-01-27T09:05:30.3590303Z make[6]: Target 'mklazycomp' not remade because of errors.
2020-01-27T09:05:30.3590634Z make[6]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src/src/library/graphics'
2020-01-27T09:05:30.3590756Z make[5]: *** [Makefile:27: all] Error 2
2020-01-27T09:05:30.3591062Z make[5]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src/src/library/graphics'
2020-01-27T09:05:30.3591191Z make[4]: *** [Makefile:39: R] Error 1
2020-01-27T09:05:30.3591507Z make[4]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src/src/library'
2020-01-27T09:05:30.3591627Z make[3]: *** [Makefile:28: R] Error 1
2020-01-27T09:05:30.3591927Z make[3]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src/src'
2020-01-27T09:05:30.3592029Z make[2]: *** [Makefile:61: R] Error 1
2020-01-27T09:05:30.3592328Z make[2]: Leaving directory '/sage/local/var/tmp/sage/build/r-3.6.2/src'
2020-01-27T09:05:30.3592443Z Error building R.
2020-01-27T09:05:30.3592496Z 
2020-01-27T09:05:30.3592594Z real	2m31.753s
2020-01-27T09:05:30.3592692Z user	3m18.995s
2020-01-27T09:05:30.3592773Z sys	0m19.046s
2020-01-27T09:05:30.3592876Z ************************************************************************
2020-01-27T09:05:30.3593142Z Error installing package r-3.6.2
```
has anything to do with openblas.



---

archive/issue_comments_567454.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,25 @@\n Errors on various platforms tested at https://github.com/mkoeppe/sage/actions/runs/31716135. Examples:\n \n - archlinux-latest-standard at https://github.com/mkoeppe/sage/runs/410329835:\n-  configure finds system openblas, then installing R from source fails with openblas-related errors\n+  \n+   ```\n+  * package: fflas_ffpack-2.4.3\n+  log file: /sage/logs/pkgs/fflas_ffpack-2.4.3.log\n+  build directory: /sage/local/var/tmp/sage/build/fflas_ffpack-2.4.3\n+\n+* package: iml-1.0.4p1.p2\n+  log file: /sage/logs/pkgs/iml-1.0.4p1.p2.log\n+  build directory: /sage/local/var/tmp/sage/build/iml-1.0.4p1.p2\n+\n+* package: r-3.6.2\n+  log file: /sage/logs/pkgs/r-3.6.2.log\n+  build directory: /sage/local/var/tmp/sage/build/r-3.6.2\n+\n+* package: suitesparse-5.6.0\n+  log file: /sage/logs/pkgs/suitesparse-5.6.0.log\n+  build directory: /sage/local/var/tmp/sage/build/suitesparse-5.6.0\n+  ```\n+  Of these, at least the  fflas_ffpack error comes from openblas.\n \n - ubuntu-bionic-minimal\n    builds openblas from source, then installing R from source fails with openblas-related errors\n``````\n",
    "created_at": "2020-01-27T22:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567454",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,25 @@
 Errors on various platforms tested at https://github.com/mkoeppe/sage/actions/runs/31716135. Examples:
 
 - archlinux-latest-standard at https://github.com/mkoeppe/sage/runs/410329835:
-  configure finds system openblas, then installing R from source fails with openblas-related errors
+  
+   ```
+  * package: fflas_ffpack-2.4.3
+  log file: /sage/logs/pkgs/fflas_ffpack-2.4.3.log
+  build directory: /sage/local/var/tmp/sage/build/fflas_ffpack-2.4.3
+
+* package: iml-1.0.4p1.p2
+  log file: /sage/logs/pkgs/iml-1.0.4p1.p2.log
+  build directory: /sage/local/var/tmp/sage/build/iml-1.0.4p1.p2
+
+* package: r-3.6.2
+  log file: /sage/logs/pkgs/r-3.6.2.log
+  build directory: /sage/local/var/tmp/sage/build/r-3.6.2
+
+* package: suitesparse-5.6.0
+  log file: /sage/logs/pkgs/suitesparse-5.6.0.log
+  build directory: /sage/local/var/tmp/sage/build/suitesparse-5.6.0
+  ```
+  Of these, at least the  fflas_ffpack error comes from openblas.
 
 - ubuntu-bionic-minimal
    builds openblas from source, then installing R from source fails with openblas-related errors
``````




---

archive/issue_comments_567455.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [dimpase](#comment%3A1):\n> I don't see how the R error on archlinux-latest-standard [...]\n> has anything to do with openblas.\n\nYou are right, I mixed it up. In this run it is fflas_ffpack that has the openblas problems.\nI've updated the ticket description.",
    "created_at": "2020-01-27T22:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567455",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Replying to [dimpase](#comment%3A1):
> I don't see how the R error on archlinux-latest-standard [...]
> has anything to do with openblas.

You are right, I mixed it up. In this run it is fflas_ffpack that has the openblas problems.
I've updated the ticket description.



---

archive/issue_comments_567456.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -21,8 +21,8 @@\n   ```\n   Of these, at least the  fflas_ffpack error comes from openblas.\n \n-- ubuntu-bionic-minimal\n+- ubuntu-bionic-minimal (https://github.com/mkoeppe/sage/runs/410329574)\n    builds openblas from source, then installing R from source fails with openblas-related errors\n \n-- fedora-32-standard\n+- fedora-32-standard (https://github.com/mkoeppe/sage/runs/410329823)\n    configure fails to detect openblas, error building openblas from source\n``````\n",
    "created_at": "2020-01-27T22:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567456",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -21,8 +21,8 @@
   ```
   Of these, at least the  fflas_ffpack error comes from openblas.
 
-- ubuntu-bionic-minimal
+- ubuntu-bionic-minimal (https://github.com/mkoeppe/sage/runs/410329574)
    builds openblas from source, then installing R from source fails with openblas-related errors
 
-- fedora-32-standard
+- fedora-32-standard (https://github.com/mkoeppe/sage/runs/410329823)
    configure fails to detect openblas, error building openblas from source
``````




---

archive/issue_comments_567457.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think it might be #27444 in the case of fflas_ffpack; not sure about suitesparse, which seem to miss liblapack linked for some reason.",
    "created_at": "2020-01-27T23:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567457",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
I think it might be #27444 in the case of fflas_ffpack; not sure about suitesparse, which seem to miss liblapack linked for some reason.



---

archive/issue_comments_567458.json:
```json
{
    "body": "<a id='comment:6'></a>\nFor suitesparse that's because the correct linking options is `-llapack -lopenblas`. That's because Arch's openblas is not integrated with lapack but provided separately. R spots it correctly\n\n```\n  Interfaces supported:        X11\n  External libraries:          readline, BLAS(OpenBLAS), LAPACK(generic), curl\n  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU\n  Options enabled:             shared R library, R profiling\n```",
    "created_at": "2020-01-27T23:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567458",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
For suitesparse that's because the correct linking options is `-llapack -lopenblas`. That's because Arch's openblas is not integrated with lapack but provided separately. R spots it correctly

```
  Interfaces supported:        X11
  External libraries:          readline, BLAS(OpenBLAS), LAPACK(generic), curl
  Additional capabilities:     PNG, JPEG, TIFF, NLS, ICU
  Options enabled:             shared R library, R profiling
```



---

archive/issue_comments_567459.json:
```json
{
    "body": "<a id='comment:7'></a>\nWe need more details on the openblas package in arch. The problem in `iml` is bound to happen if libopenblas doesn't contain cblas symbols (which would be real weird since openblas is primarily a cblas implementation with an optional fortran interface).",
    "created_at": "2020-01-28T00:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567459",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
We need more details on the openblas package in arch. The problem in `iml` is bound to happen if libopenblas doesn't contain cblas symbols (which would be real weird since openblas is primarily a cblas implementation with an optional fortran interface).



---

archive/issue_comments_567460.json:
```json
{
    "body": "<a id='comment:8'></a>\non arch cblas symbols are not in libopenblas. and lapack symbols are not there either, as we found on #29071",
    "created_at": "2020-01-28T00:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567460",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
on arch cblas symbols are not in libopenblas. and lapack symbols are not there either, as we found on #29071



---

archive/issue_comments_567461.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [dimpase](#comment%3A8):\n> on arch cblas symbols are not in libopenblas. and lapack symbols are not there either, as we found on #29071\n\n\nOK that's two issues explained on arch (iml and suitesparse). You are correct in your assessment about fflas-ffpack - which may be due to some function name change in openblas between versions, that would need to be checked.\n\nThat leaves R which is mysterious but could be down to blas/lapack issue. `graphics` is the first R package to be built, the failure comes when the build system check that the package can be loaded by R. If R is not functional then of course the package will fail to load. Which would mean that it being `graphics` is just incidental.",
    "created_at": "2020-01-28T00:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567461",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Replying to [dimpase](#comment%3A8):
> on arch cblas symbols are not in libopenblas. and lapack symbols are not there either, as we found on #29071


OK that's two issues explained on arch (iml and suitesparse). You are correct in your assessment about fflas-ffpack - which may be due to some function name change in openblas between versions, that would need to be checked.

That leaves R which is mysterious but could be down to blas/lapack issue. `graphics` is the first R package to be built, the failure comes when the build system check that the package can be loaded by R. If R is not functional then of course the package will fail to load. Which would mean that it being `graphics` is just incidental.



---

archive/issue_comments_567462.json:
```json
{
    "body": "<a id='comment:10'></a>\neverything that is related to problems with using system OpenBLAS on ARch should be fixed by #29071 - at least with the latter on Arch I am able to build Sage's R with system's OpenBLAS.",
    "created_at": "2020-01-28T07:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567462",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
everything that is related to problems with using system OpenBLAS on ARch should be fixed by #29071 - at least with the latter on Arch I am able to build Sage's R with system's OpenBLAS.



---

archive/issue_comments_567463.json:
```json
{
    "body": "**Dependencies:** #29071",
    "created_at": "2020-01-28T07:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567463",
    "user": "https://github.com/dimpase"
}
```

**Dependencies:** #29071



---

archive/issue_comments_567464.json:
```json
{
    "body": "<a id='comment:12'></a>\nOne fedora-32, I don't quite know what kind of openblas configuration one \n\n```\n2020-01-27T08:33:14.3793913Z (220/459): openblas-0.3.7-2.fc32.x86_64.rpm     332 kB/s |  29 kB     00:00    \n2020-01-27T08:33:14.3970448Z (221/459): openblas-devel-0.3.7-2.fc32.x86_64.r 735 kB/s |  73 kB     00:00    \n2020-01-27T08:33:14.5942412Z (222/459): openblas-openmp-0.3.7-2.fc32.x86_64.  16 MB/s | 4.4 MB     00:00    \n2020-01-27T08:33:14.6190047Z (223/459): openblas-openmp64-0.3.7-2.fc32.x86_6  18 MB/s | 4.3 MB     00:00    \n2020-01-27T08:33:14.6564200Z (224/459): openblas-openmp64_-0.3.7-2.fc32.x86_  17 MB/s | 4.3 MB     00:00    \n2020-01-27T08:33:14.8431058Z (225/459): openblas-serial64-0.3.7-2.fc32.x86_6  19 MB/s | 4.2 MB     00:00    \n2020-01-27T08:33:14.8613987Z (226/459): openblas-serial-0.3.7-2.fc32.x86_64.  16 MB/s | 4.3 MB     00:00    \n2020-01-27T08:33:14.9043436Z (227/459): openblas-serial64_-0.3.7-2.fc32.x86_  17 MB/s | 4.1 MB     00:00    \n2020-01-27T08:33:14.9262666Z (228/459): openblas-srpm-macros-2-6.fc31.noarch  88 kB/s | 7.3 kB     00:00    \n2020-01-27T08:33:15.1461271Z (229/459): openblas-threads64-0.3.7-2.fc32.x86_  18 MB/s | 4.3 MB     00:00    \n2020-01-27T08:33:15.1608599Z (230/459): openblas-threads-0.3.7-2.fc32.x86_64  15 MB/s | 4.4 MB     00:00    \n2020-01-27T08:33:15.1782235Z (231/459): openblas-threads64_-0.3.7-2.fc32.x86  17 MB/s | 4.3 MB     00:00    \n```\n\nI guess one ends up with the last one, `openblas-threads64_` - which I don't know and certainly never tested with. (the difference with ``openblas-threads64` is a symbol name suffix, whatever it means) - Is it a script bug, can we control a bit better what's getting installed on the runner?\n\n\nI guess  it's got a different pkg-config \"name\".\n\n---\n\nIt's not surprise that openblas 0.3.6 doesn't build, it might be just too old for Fedora 32.",
    "created_at": "2020-01-28T08:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567464",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
One fedora-32, I don't quite know what kind of openblas configuration one 

```
2020-01-27T08:33:14.3793913Z (220/459): openblas-0.3.7-2.fc32.x86_64.rpm     332 kB/s |  29 kB     00:00    
2020-01-27T08:33:14.3970448Z (221/459): openblas-devel-0.3.7-2.fc32.x86_64.r 735 kB/s |  73 kB     00:00    
2020-01-27T08:33:14.5942412Z (222/459): openblas-openmp-0.3.7-2.fc32.x86_64.  16 MB/s | 4.4 MB     00:00    
2020-01-27T08:33:14.6190047Z (223/459): openblas-openmp64-0.3.7-2.fc32.x86_6  18 MB/s | 4.3 MB     00:00    
2020-01-27T08:33:14.6564200Z (224/459): openblas-openmp64_-0.3.7-2.fc32.x86_  17 MB/s | 4.3 MB     00:00    
2020-01-27T08:33:14.8431058Z (225/459): openblas-serial64-0.3.7-2.fc32.x86_6  19 MB/s | 4.2 MB     00:00    
2020-01-27T08:33:14.8613987Z (226/459): openblas-serial-0.3.7-2.fc32.x86_64.  16 MB/s | 4.3 MB     00:00    
2020-01-27T08:33:14.9043436Z (227/459): openblas-serial64_-0.3.7-2.fc32.x86_  17 MB/s | 4.1 MB     00:00    
2020-01-27T08:33:14.9262666Z (228/459): openblas-srpm-macros-2-6.fc31.noarch  88 kB/s | 7.3 kB     00:00    
2020-01-27T08:33:15.1461271Z (229/459): openblas-threads64-0.3.7-2.fc32.x86_  18 MB/s | 4.3 MB     00:00    
2020-01-27T08:33:15.1608599Z (230/459): openblas-threads-0.3.7-2.fc32.x86_64  15 MB/s | 4.4 MB     00:00    
2020-01-27T08:33:15.1782235Z (231/459): openblas-threads64_-0.3.7-2.fc32.x86  17 MB/s | 4.3 MB     00:00    
```

I guess one ends up with the last one, `openblas-threads64_` - which I don't know and certainly never tested with. (the difference with ``openblas-threads64` is a symbol name suffix, whatever it means) - Is it a script bug, can we control a bit better what's getting installed on the runner?


I guess  it's got a different pkg-config "name".

---

It's not surprise that openblas 0.3.6 doesn't build, it might be just too old for Fedora 32.



---

archive/issue_comments_567465.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [fbissey](#comment%3A9):\n> Replying to [dimpase](#comment%3A8):\n> > on arch cblas symbols are not in libopenblas. and lapack symbols are not there either, as we found on #29071\n\n> \n> OK that's two issues explained on arch (iml and suitesparse). You are correct in your assessment about fflas-ffpack - which may be due to some function name change in openblas between versions, that would need to be checked.\n> \n> That leaves R which is mysterious but could be down to blas/lapack issue. `graphics` is the first R package to be built, the failure comes when the build system check that the package can be loaded by R. If R is not functional then of course the package will fail to load. Which would mean that it being `graphics` is just incidental. \n\n\nalso #29084 might be relevant - it looks that there are more packages, apart from `fflas_ffpack` where one\nmight be calling `pkg-config --libs cblas blas` in spkg-install, not just `pkg-config --libs cblas`",
    "created_at": "2020-01-28T10:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567465",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
Replying to [fbissey](#comment%3A9):
> Replying to [dimpase](#comment%3A8):
> > on arch cblas symbols are not in libopenblas. and lapack symbols are not there either, as we found on #29071

> 
> OK that's two issues explained on arch (iml and suitesparse). You are correct in your assessment about fflas-ffpack - which may be due to some function name change in openblas between versions, that would need to be checked.
> 
> That leaves R which is mysterious but could be down to blas/lapack issue. `graphics` is the first R package to be built, the failure comes when the build system check that the package can be loaded by R. If R is not functional then of course the package will fail to load. Which would mean that it being `graphics` is just incidental. 


also #29084 might be relevant - it looks that there are more packages, apart from `fflas_ffpack` where one
might be calling `pkg-config --libs cblas blas` in spkg-install, not just `pkg-config --libs cblas`



---

archive/issue_comments_567466.json:
```json
{
    "body": "**Changing dependencies** from \"#29071\" to \"#29051, #29071\".",
    "created_at": "2020-01-28T16:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567466",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29071" to "#29051, #29071".



---

archive/issue_comments_567467.json:
```json
{
    "body": "<a id='comment:15'></a>\nFedora 31 (and, I guess, 32 too) has no *.pc files for its multiple openblas. (As the reason, they give that they cannot choose the default, that's why)\n\nThey do have reference implememtations of BLAS, CBLAS, and LAPACK, with *.pc files\n\nMeanwhile, libR on Fedora comes with its own BLAS, so it's quite a mess.",
    "created_at": "2020-01-28T23:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567467",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Fedora 31 (and, I guess, 32 too) has no *.pc files for its multiple openblas. (As the reason, they give that they cannot choose the default, that's why)

They do have reference implememtations of BLAS, CBLAS, and LAPACK, with *.pc files

Meanwhile, libR on Fedora comes with its own BLAS, so it's quite a mess.



---

archive/issue_comments_567468.json:
```json
{
    "body": "<a id='comment:16'></a>\nAn update on the `fedora-32-standard` configuration (see https://github.com/mkoeppe/sage/runs/509834243): openblas-0.3.9-1.fc32.x86_64 and related packages are installed, but `openblas/spkg-configure.m4` does not recognize it:\n\n```\nChecking whether SageMath should install SPKG openblas...\nchecking BLAS library... openblas\nchecking whether any of gfortran is installed or will be installed as SPKG... no\nchecking for OPENBLAS... no\nconfigure: no suitable system package found for SPKG openblas\n```\nThen Sage installs openblas-0.3.6.p0 successfully, but various BLAS-using packages (numpy, iml, gsl) fail to build.",
    "created_at": "2020-03-16T02:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567468",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
An update on the `fedora-32-standard` configuration (see https://github.com/mkoeppe/sage/runs/509834243): openblas-0.3.9-1.fc32.x86_64 and related packages are installed, but `openblas/spkg-configure.m4` does not recognize it:

```
Checking whether SageMath should install SPKG openblas...
checking BLAS library... openblas
checking whether any of gfortran is installed or will be installed as SPKG... no
checking for OPENBLAS... no
configure: no suitable system package found for SPKG openblas
```
Then Sage installs openblas-0.3.6.p0 successfully, but various BLAS-using packages (numpy, iml, gsl) fail to build.



---

archive/issue_comments_567469.json:
```json
{
    "body": "<a id='comment:18'></a>\ngsl problems are  different here:\n\n```\n2020-03-16T00:53:19.3875570Z   [gsl-2.5] error installing, exit status 1. End of log file:\n2020-03-16T00:53:19.3920355Z   [gsl-2.5]   checking for a BSD-compatible install... /usr/bin/install -c\n2020-03-16T00:53:19.3920646Z   [gsl-2.5]   checking whether build environment is sane... yes\n2020-03-16T00:53:19.3920901Z   [gsl-2.5]   checking for a thread-safe mkdir -p... /usr/bin/mkdir -p\n2020-03-16T00:53:19.3921129Z   [gsl-2.5]   checking for gawk... gawk\n2020-03-16T00:53:19.3921367Z   [gsl-2.5]   checking whether make sets $(MAKE)... yes\n2020-03-16T00:53:19.3921615Z   [gsl-2.5]   checking whether make supports nested variables... yes\n2020-03-16T00:53:19.3921909Z   [gsl-2.5]   checking whether to enable maintainer-specific portions of Makefiles... no\n2020-03-16T00:53:19.3922177Z   [gsl-2.5]   checking for a sed that does not truncate output... /usr/bin/sed\n2020-03-16T00:53:19.3922428Z   [gsl-2.5]   checking whether make sets $(MAKE)... (cached) yes\n2020-03-16T00:53:19.3922679Z   [gsl-2.5]   checking build system type... x86_64-unknown-linux-gnu\n2020-03-16T00:53:19.3923079Z   [gsl-2.5]   checking host system type... x86_64-unknown-linux-gnu\n2020-03-16T00:53:19.3923302Z   [gsl-2.5]   checking for gcc... gcc\n2020-03-16T00:53:19.3923539Z   [gsl-2.5]   checking whether the C compiler works... no\n2020-03-16T00:53:19.3923803Z   [gsl-2.5]   configure: error: in `/sage/local/var/tmp/sage/build/gsl-2.5/src':\n2020-03-16T00:53:19.3924057Z   [gsl-2.5]   configure: error: C compiler cannot create executables\n2020-03-16T00:53:19.3924294Z   [gsl-2.5]   See `config.log' for more details\n```",
    "created_at": "2020-03-16T05:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567469",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
gsl problems are  different here:

```
2020-03-16T00:53:19.3875570Z   [gsl-2.5] error installing, exit status 1. End of log file:
2020-03-16T00:53:19.3920355Z   [gsl-2.5]   checking for a BSD-compatible install... /usr/bin/install -c
2020-03-16T00:53:19.3920646Z   [gsl-2.5]   checking whether build environment is sane... yes
2020-03-16T00:53:19.3920901Z   [gsl-2.5]   checking for a thread-safe mkdir -p... /usr/bin/mkdir -p
2020-03-16T00:53:19.3921129Z   [gsl-2.5]   checking for gawk... gawk
2020-03-16T00:53:19.3921367Z   [gsl-2.5]   checking whether make sets $(MAKE)... yes
2020-03-16T00:53:19.3921615Z   [gsl-2.5]   checking whether make supports nested variables... yes
2020-03-16T00:53:19.3921909Z   [gsl-2.5]   checking whether to enable maintainer-specific portions of Makefiles... no
2020-03-16T00:53:19.3922177Z   [gsl-2.5]   checking for a sed that does not truncate output... /usr/bin/sed
2020-03-16T00:53:19.3922428Z   [gsl-2.5]   checking whether make sets $(MAKE)... (cached) yes
2020-03-16T00:53:19.3922679Z   [gsl-2.5]   checking build system type... x86_64-unknown-linux-gnu
2020-03-16T00:53:19.3923079Z   [gsl-2.5]   checking host system type... x86_64-unknown-linux-gnu
2020-03-16T00:53:19.3923302Z   [gsl-2.5]   checking for gcc... gcc
2020-03-16T00:53:19.3923539Z   [gsl-2.5]   checking whether the C compiler works... no
2020-03-16T00:53:19.3923803Z   [gsl-2.5]   configure: error: in `/sage/local/var/tmp/sage/build/gsl-2.5/src':
2020-03-16T00:53:19.3924057Z   [gsl-2.5]   configure: error: C compiler cannot create executables
2020-03-16T00:53:19.3924294Z   [gsl-2.5]   See `config.log' for more details
```



---

archive/issue_comments_567470.json:
```json
{
    "body": "<a id='comment:19'></a>\niml does not find cblas\n\n```\n2020-03-16T00:53:23.6337896Z   [iml-1.0.4p1.p2]   checking for CBLAS... configure: WARNING: CBLAS not found!\n2020-03-16T00:53:23.6338470Z   [iml-1.0.4p1.p2]   Please make sure that --with-cblas=<linker flags> and optional --with-cblas-include=<path> and --with-cblas-lib=<path> are correctly set.\n2020-03-16T00:53:23.6338910Z   [iml-1.0.4p1.p2]   Trying legacy ATLAS configuration.\n2020-03-16T00:53:23.6339385Z   [iml-1.0.4p1.p2]   checking for ATLAS >= 3.0... configure: error: ATLAS not found!\n```\n\nnot sure why.Could it be that re-worked installation of *.pc files is broken?\nIf so, this should be seen on the other platforms which install Sage's openblas, though. \n\nAnd the same with numpy, I think - an error saying that cblas cannot be found.\n\nCould be a too old openblas - the current upstream is 0.3.9.",
    "created_at": "2020-03-16T05:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567470",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
iml does not find cblas

```
2020-03-16T00:53:23.6337896Z   [iml-1.0.4p1.p2]   checking for CBLAS... configure: WARNING: CBLAS not found!
2020-03-16T00:53:23.6338470Z   [iml-1.0.4p1.p2]   Please make sure that --with-cblas=<linker flags> and optional --with-cblas-include=<path> and --with-cblas-lib=<path> are correctly set.
2020-03-16T00:53:23.6338910Z   [iml-1.0.4p1.p2]   Trying legacy ATLAS configuration.
2020-03-16T00:53:23.6339385Z   [iml-1.0.4p1.p2]   checking for ATLAS >= 3.0... configure: error: ATLAS not found!
```

not sure why.Could it be that re-worked installation of *.pc files is broken?
If so, this should be seen on the other platforms which install Sage's openblas, though. 

And the same with numpy, I think - an error saying that cblas cannot be found.

Could be a too old openblas - the current upstream is 0.3.9.



---

archive/issue_comments_567471.json:
```json
{
    "body": "<a id='comment:20'></a>\nperhaps we need to update gsl too, GSL 2.6 was released in Aug 2019.",
    "created_at": "2020-03-16T07:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567471",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
perhaps we need to update gsl too, GSL 2.6 was released in Aug 2019.



---

archive/issue_comments_567472.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [dimpase](#comment%3A19):\n> iml does not find cblas\n> \n> ```\n> 2020-03-16T00:53:23.6337896Z   [iml-1.0.4p1.p2]   checking for CBLAS... configure: WARNING: CBLAS not found!\n> 2020-03-16T00:53:23.6338470Z   [iml-1.0.4p1.p2]   Please make sure that --with-cblas=<linker flags> and optional --with-cblas-include=<path> and --with-cblas-lib=<path> are correctly set.\n> 2020-03-16T00:53:23.6338910Z   [iml-1.0.4p1.p2]   Trying legacy ATLAS configuration.\n> 2020-03-16T00:53:23.6339385Z   [iml-1.0.4p1.p2]   checking for ATLAS >= 3.0... configure: error: ATLAS not found!\n> ```\n> \n> not sure why.Could it be that re-worked installation of *.pc files is broken?\n\n\nQuite possible - please help with reviewing #29082",
    "created_at": "2020-03-17T03:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567472",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Replying to [dimpase](#comment%3A19):
> iml does not find cblas
> 
> ```
> 2020-03-16T00:53:23.6337896Z   [iml-1.0.4p1.p2]   checking for CBLAS... configure: WARNING: CBLAS not found!
> 2020-03-16T00:53:23.6338470Z   [iml-1.0.4p1.p2]   Please make sure that --with-cblas=<linker flags> and optional --with-cblas-include=<path> and --with-cblas-lib=<path> are correctly set.
> 2020-03-16T00:53:23.6338910Z   [iml-1.0.4p1.p2]   Trying legacy ATLAS configuration.
> 2020-03-16T00:53:23.6339385Z   [iml-1.0.4p1.p2]   checking for ATLAS >= 3.0... configure: error: ATLAS not found!
> ```
> 
> not sure why.Could it be that re-worked installation of *.pc files is broken?


Quite possible - please help with reviewing #29082



---

archive/issue_comments_567473.json:
```json
{
    "body": "<a id='comment:22'></a>\nI think we can close this one as outdated",
    "created_at": "2020-04-25T06:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567473",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
I think we can close this one as outdated



---

archive/issue_comments_567474.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-04-25T06:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567474",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_events_083260.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-25T06:39:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29088#event-83260"
}
```



---

archive/issue_comments_567475.json:
```json
{
    "body": "**Reviewer:** Marc Mezzarobba",
    "created_at": "2021-09-18T09:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567475",
    "user": "https://github.com/mezzarobba"
}
```

**Reviewer:** Marc Mezzarobba



---

archive/issue_comments_567476.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-09-18T09:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567476",
    "user": "https://github.com/mezzarobba"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_567477.json:
```json
{
    "body": "**Resolution:** invalid",
    "created_at": "2021-09-18T17:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29088#issuecomment-567477",
    "user": "https://github.com/mkoeppe"
}
```

**Resolution:** invalid



---

archive/issue_events_083261.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-18T17:51:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29088",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29088#event-83261"
}
```
