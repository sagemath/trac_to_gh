# Issue 29394: Drop the python2 patch sys_path_security-issue_16202

archive/issues_029157.json:
```json
{
    "body": "This patch, applied by #13579 (\"Python sys.path security risk\") 7 years ago was never accepted in upstream Python. We do not bother to do the same in python3; and it causes build problems (#29367).\n\nRelated tickets:\n- #25358 Test safe directory without python subprocess\n- #26457 Do not depend on a patched Python\n\nDepends on #25358\n\n**CC:**  @vbraun @jdemeyer @embray @slel @timokau @kiwifb @antonio-rojas @nthiery @isuruf pcpa @tobihan @infinity0 snark cschwan @jhpalmieri\n\n**Branch/Commit:** [cbdce1cef6350482d9ec65c878188e0f6530bc22](https://github.com/sagemath/sagetrac-mirror/commit/cbdce1cef6350482d9ec65c878188e0f6530bc22)\n\n**Reviewer:** Fran\u00e7ois Bissey, Dima Pasechnik\n\n**Author:** Matthias Koeppe, John Palmieri\n\nIssue created by migration from https://trac.sagemath.org/ticket/29394\n\n",
    "closed_at": "2020-03-29T00:23:53Z",
    "created_at": "2020-03-22T21:00:33Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "Drop the python2 patch sys_path_security-issue_16202",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/29394",
    "user": "https://github.com/mkoeppe"
}
```
This patch, applied by #13579 ("Python sys.path security risk") 7 years ago was never accepted in upstream Python. We do not bother to do the same in python3; and it causes build problems (#29367).

Related tickets:
- #25358 Test safe directory without python subprocess
- #26457 Do not depend on a patched Python

Depends on #25358

**CC:**  @vbraun @jdemeyer @embray @slel @timokau @kiwifb @antonio-rojas @nthiery @isuruf pcpa @tobihan @infinity0 snark cschwan @jhpalmieri

**Branch/Commit:** [cbdce1cef6350482d9ec65c878188e0f6530bc22](https://github.com/sagemath/sagetrac-mirror/commit/cbdce1cef6350482d9ec65c878188e0f6530bc22)

**Reviewer:** François Bissey, Dima Pasechnik

**Author:** Matthias Koeppe, John Palmieri

Issue created by migration from https://trac.sagemath.org/ticket/29394





---

archive/issue_comments_464096.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202)",
    "created_at": "2020-03-22T21:19:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464096",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202)



---

archive/issue_comments_464097.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a578e4e520b1becde150ff7ca1ae61bf85296d9\">1a578e4</a></td><td><code>Remove python2 patch sys_path_security-issue_16202</code></td></tr></table>\n",
    "created_at": "2020-03-22T21:20:03Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464097",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a578e4e520b1becde150ff7ca1ae61bf85296d9">1a578e4</a></td><td><code>Remove python2 patch sys_path_security-issue_16202</code></td></tr></table>




---

archive/issue_comments_464098.json:
```json
{
    "body": "**Commit:** [1a578e4e520b1becde150ff7ca1ae61bf85296d9](https://github.com/sagemath/sagetrac-mirror/commit/1a578e4e520b1becde150ff7ca1ae61bf85296d9)",
    "created_at": "2020-03-22T21:20:03Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464098",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [1a578e4e520b1becde150ff7ca1ae61bf85296d9](https://github.com/sagemath/sagetrac-mirror/commit/1a578e4e520b1becde150ff7ca1ae61bf85296d9)



---

archive/issue_events_261572.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T21:20:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261572"
}
```



---

archive/issue_comments_464099.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-03-22T21:20:03Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464099",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_464100.json:
```json
{
    "body": "<a id='comment:4'></a>\nGood riddance.",
    "created_at": "2020-03-22T21:21:21Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464100",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Good riddance.



---

archive/issue_comments_464101.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey",
    "created_at": "2020-03-22T21:21:21Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464101",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** François Bissey



---

archive/issue_events_261573.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-03-22T21:21:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261573"
}
```



---

archive/issue_events_261574.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-03-22T21:21:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261574"
}
```



---

archive/issue_events_261575.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-22T22:33:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261575"
}
```



---

archive/issue_events_261576.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-22T22:33:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261576"
}
```



---

archive/issue_comments_464102.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202)\" to \"[u/jhpalmieri/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/drop_the_python2_patch_sys_path_security_issue_16202)\".",
    "created_at": "2020-03-22T22:35:43Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464102",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing branch** from "[u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202)" to "[u/jhpalmieri/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/drop_the_python2_patch_sys_path_security_issue_16202)".



---

archive/issue_comments_464103.json:
```json
{
    "body": "**Changing commit** from \"[1a578e4e520b1becde150ff7ca1ae61bf85296d9](https://github.com/sagemath/sagetrac-mirror/commit/1a578e4e520b1becde150ff7ca1ae61bf85296d9)\" to \"[fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05](https://github.com/sagemath/sagetrac-mirror/commit/fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05)\".",
    "created_at": "2020-03-22T22:36:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464103",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing commit** from "[1a578e4e520b1becde150ff7ca1ae61bf85296d9](https://github.com/sagemath/sagetrac-mirror/commit/1a578e4e520b1becde150ff7ca1ae61bf85296d9)" to "[fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05](https://github.com/sagemath/sagetrac-mirror/commit/fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05)".



---

archive/issue_comments_464104.json:
```json
{
    "body": "<a id='comment:7'></a>\nDoctest failures with a Python 2 build, so let's get rid of the offending doctests.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05\">fd4e408</a></td><td><code>trac 29394: get rid of corresponding doctest</code></td></tr></table>\n",
    "created_at": "2020-03-22T22:36:17Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464104",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Doctest failures with a Python 2 build, so let's get rid of the offending doctests.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05">fd4e408</a></td><td><code>trac 29394: get rid of corresponding doctest</code></td></tr></table>




---

archive/issue_events_261577.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-22T22:36:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261577"
}
```



---

archive/issue_events_261578.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-22T22:36:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261578"
}
```



---

archive/issue_comments_464105.json:
```json
{
    "body": "<a id='comment:8'></a>\nHum, I thought it was going to be handled in a different ticket, but yes that test should go, of course. And that's the only place I know where the issue would crop up.",
    "created_at": "2020-03-22T22:38:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464105",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Hum, I thought it was going to be handled in a different ticket, but yes that test should go, of course. And that's the only place I know where the issue would crop up.



---

archive/issue_events_261579.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-03-22T22:38:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261579"
}
```



---

archive/issue_events_261580.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2020-03-22T22:38:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261580"
}
```



---

archive/issue_comments_464106.json:
```json
{
    "body": "<a id='comment:9'></a>\nDo we need to delete the function `test_safe_directory` in `doctest/control.py`?",
    "created_at": "2020-03-22T22:39:44Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464106",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Do we need to delete the function `test_safe_directory` in `doctest/control.py`?



---

archive/issue_comments_464107.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jhpalmieri](#comment%3A9):\n> Do we need to delete the function `test_safe_directory` in `doctest/control.py`?\n\nI wouldn't think it is needed. After all it works well with python without change. Let me double check.",
    "created_at": "2020-03-22T22:41:57Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464107",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Replying to [jhpalmieri](#comment%3A9):
> Do we need to delete the function `test_safe_directory` in `doctest/control.py`?

I wouldn't think it is needed. After all it works well with python without change. Let me double check.



---

archive/issue_events_261581.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-22T22:42:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261581"
}
```



---

archive/issue_events_261582.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-03-22T22:42:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261582"
}
```



---

archive/issue_comments_464108.json:
```json
{
    "body": "<a id='comment:11'></a>\nTo partially answer my own question: that function gives another doctest failure with a Python 2 build. Its docstring also says \"This is only relevant with Python 2, because Sage's Python 2 is patched to give a warning when the current directory is unsafe, but Python 3 is not.\" So I think we should remove the function entirely.",
    "created_at": "2020-03-22T22:42:27Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464108",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
To partially answer my own question: that function gives another doctest failure with a Python 2 build. Its docstring also says "This is only relevant with Python 2, because Sage's Python 2 is patched to give a warning when the current directory is unsafe, but Python 3 is not." So I think we should remove the function entirely.



---

archive/issue_comments_464109.json:
```json
{
    "body": "<a id='comment:12'></a>\nOh right, I am forgetting we are still doing py2 builds here. Yes it should go.",
    "created_at": "2020-03-22T22:45:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464109",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Oh right, I am forgetting we are still doing py2 builds here. Yes it should go.



---

archive/issue_comments_464110.json:
```json
{
    "body": "<a id='comment:13'></a>\nI'll provide a branch which removes it. If you're happy with that, once I run tests successfully with Python 2, I can set to positive review on your behalf.",
    "created_at": "2020-03-22T22:46:38Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464110",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
I'll provide a branch which removes it. If you're happy with that, once I run tests successfully with Python 2, I can set to positive review on your behalf.



---

archive/issue_comments_464111.json:
```json
{
    "body": "<a id='comment:14'></a>\n#25358 has a better fix for test_safe_directory",
    "created_at": "2020-03-22T22:47:41Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464111",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
#25358 has a better fix for test_safe_directory



---

archive/issue_comments_464112.json:
```json
{
    "body": "**Changing commit** from \"[fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05](https://github.com/sagemath/sagetrac-mirror/commit/fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05)\" to \"[c1f6dcded4ce720d67c0be89b44d40a76bc6eef3](https://github.com/sagemath/sagetrac-mirror/commit/c1f6dcded4ce720d67c0be89b44d40a76bc6eef3)\".",
    "created_at": "2020-03-22T22:48:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05](https://github.com/sagemath/sagetrac-mirror/commit/fd4e4086d60f3b7212bcbee03e0f360ecd8d3a05)" to "[c1f6dcded4ce720d67c0be89b44d40a76bc6eef3](https://github.com/sagemath/sagetrac-mirror/commit/c1f6dcded4ce720d67c0be89b44d40a76bc6eef3)".



---

archive/issue_comments_464113.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1f6dcded4ce720d67c0be89b44d40a76bc6eef3\">c1f6dcd</a></td><td><code>trac 29395: remove test_safe_directory</code></td></tr></table>\n",
    "created_at": "2020-03-22T22:48:08Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1f6dcded4ce720d67c0be89b44d40a76bc6eef3">c1f6dcd</a></td><td><code>trac 29395: remove test_safe_directory</code></td></tr></table>




---

archive/issue_comments_464114.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [mkoeppe](#comment%3A14):\n> #25358 has a better fix for test_safe_directory\n\nSo, that's why I thought that stuff was dealt with in another ticket. I am not completely losing my marbles.",
    "created_at": "2020-03-22T22:50:49Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464114",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Replying to [mkoeppe](#comment%3A14):
> #25358 has a better fix for test_safe_directory

So, that's why I thought that stuff was dealt with in another ticket. I am not completely losing my marbles.



---

archive/issue_comments_464115.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [fbissey](#comment%3A16):\n> Replying to [mkoeppe](#comment%3A14):\n> > #25358 has a better fix for test_safe_directory\n\nIf you want to try to revive that, you can. It can be done on #25358, with this ticket as a prerequisite, since one of the main obstacles there was the patched Python. Once we remove this patch to Python, the current incarnation of `test_safe_directory` is no longer relevant, as far as I can tell.\n \n> So, that's why I thought that stuff was dealt with in another ticket. I am not completely losing my marbles.\n\nThat ticket had completely stalled, though.",
    "created_at": "2020-03-22T22:53:58Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464115",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
Replying to [fbissey](#comment%3A16):
> Replying to [mkoeppe](#comment%3A14):
> > #25358 has a better fix for test_safe_directory

If you want to try to revive that, you can. It can be done on #25358, with this ticket as a prerequisite, since one of the main obstacles there was the patched Python. Once we remove this patch to Python, the current incarnation of `test_safe_directory` is no longer relevant, as far as I can tell.
 
> So, that's why I thought that stuff was dealt with in another ticket. I am not completely losing my marbles.

That ticket had completely stalled, though.



---

archive/issue_comments_464116.json:
```json
{
    "body": "<a id='comment:18'></a>\nThanks John, we have to make a decision on what we do with #25358 (and how fast) before we proceed with the current changes. Plain removal is attractive to me. Less code.",
    "created_at": "2020-03-22T23:00:11Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464116",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
Thanks John, we have to make a decision on what we do with #25358 (and how fast) before we proceed with the current changes. Plain removal is attractive to me. Less code.



---

archive/issue_comments_464117.json:
```json
{
    "body": "<a id='comment:19'></a>\nI think test_safe_directory is a useful security mechanism.\nIts current **implementation** depends on the patch that we are now dropping (and hence on Python2)",
    "created_at": "2020-03-22T23:01:33Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464117",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
I think test_safe_directory is a useful security mechanism.
Its current **implementation** depends on the patch that we are now dropping (and hence on Python2)



---

archive/issue_comments_464118.json:
```json
{
    "body": "**Dependencies:** #25358",
    "created_at": "2020-03-22T23:04:52Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464118",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #25358



---

archive/issue_comments_464119.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [jhpalmieri](#comment%3A17):\n> Replying to [fbissey](#comment%3A16):\n> > Replying to [mkoeppe](#comment%3A14):\n> > > #25358 has a better fix for test_safe_directory\n\n> \n> If you want to try to revive that, you can.\n\nDone\n\n> It can be done on #25358, with this ticket as a prerequisite\n\nNo, present ticket depends on #25358",
    "created_at": "2020-03-22T23:05:32Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464119",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Replying to [jhpalmieri](#comment%3A17):
> Replying to [fbissey](#comment%3A16):
> > Replying to [mkoeppe](#comment%3A14):
> > > #25358 has a better fix for test_safe_directory

> 
> If you want to try to revive that, you can.

Done

> It can be done on #25358, with this ticket as a prerequisite

No, present ticket depends on #25358



---

archive/issue_comments_464120.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/drop_the_python2_patch_sys_path_security_issue_16202)\" to \"[u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202)\".",
    "created_at": "2020-03-22T23:09:46Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464120",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/jhpalmieri/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/drop_the_python2_patch_sys_path_security_issue_16202)" to "[u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202)".



---

archive/issue_comments_464121.json:
```json
{
    "body": "<a id='comment:23'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68\">904b1a1</a></td><td><code>Test safe directory without subprocess</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f5d8dcbcd9834ade79152693e6df5616bb9645e\">7f5d8dc</a></td><td><code>Remove python2 patch sys_path_security-issue_16202</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbdce1cef6350482d9ec65c878188e0f6530bc22\">cbdce1c</a></td><td><code>trac 29394: get rid of corresponding doctest</code></td></tr></table>\n",
    "created_at": "2020-03-22T23:10:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464121",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/904b1a18742e5677aa8de02920b7bf3a13ae4c68">904b1a1</a></td><td><code>Test safe directory without subprocess</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f5d8dcbcd9834ade79152693e6df5616bb9645e">7f5d8dc</a></td><td><code>Remove python2 patch sys_path_security-issue_16202</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbdce1cef6350482d9ec65c878188e0f6530bc22">cbdce1c</a></td><td><code>trac 29394: get rid of corresponding doctest</code></td></tr></table>




---

archive/issue_events_261583.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T23:10:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261583"
}
```



---

archive/issue_events_261584.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-22T23:10:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261584"
}
```



---

archive/issue_comments_464122.json:
```json
{
    "body": "**Changing commit** from \"[c1f6dcded4ce720d67c0be89b44d40a76bc6eef3](https://github.com/sagemath/sagetrac-mirror/commit/c1f6dcded4ce720d67c0be89b44d40a76bc6eef3)\" to \"[cbdce1cef6350482d9ec65c878188e0f6530bc22](https://github.com/sagemath/sagetrac-mirror/commit/cbdce1cef6350482d9ec65c878188e0f6530bc22)\".",
    "created_at": "2020-03-22T23:10:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464122",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[c1f6dcded4ce720d67c0be89b44d40a76bc6eef3](https://github.com/sagemath/sagetrac-mirror/commit/c1f6dcded4ce720d67c0be89b44d40a76bc6eef3)" to "[cbdce1cef6350482d9ec65c878188e0f6530bc22](https://github.com/sagemath/sagetrac-mirror/commit/cbdce1cef6350482d9ec65c878188e0f6530bc22)".



---

archive/issue_comments_464123.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"Matthias Koeppe, John Palmieri\".",
    "created_at": "2020-03-22T23:10:16Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464123",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "Matthias Koeppe, John Palmieri".



---

archive/issue_comments_464124.json:
```json
{
    "body": "<a id='comment:24'></a>\nFor what it's worth I gave up on #25358 because jdmeyer had a pretty strong opinion on that. I'm not sure if that has changed. If it was up to me, I think I'd vote complete removal too. #25358 was intended as a compromise.",
    "created_at": "2020-03-22T23:33:34Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464124",
    "user": "https://github.com/timokau"
}
```

<a id='comment:24'></a>
For what it's worth I gave up on #25358 because jdmeyer had a pretty strong opinion on that. I'm not sure if that has changed. If it was up to me, I think I'd vote complete removal too. #25358 was intended as a compromise.



---

archive/issue_comments_464125.json:
```json
{
    "body": "<a id='comment:25'></a>\nIf we want, we can of course keep *both* tests in #25358. Keeping py2 as \"secure\" as it was; and adding security to py3.",
    "created_at": "2020-03-22T23:34:51Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464125",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
If we want, we can of course keep *both* tests in #25358. Keeping py2 as "secure" as it was; and adding security to py3.



---

archive/issue_comments_464126.json:
```json
{
    "body": "<a id='comment:26'></a>\nWe can't keep the secure py2 test if we're getting rid of the patch, or am I misunderstanding you?",
    "created_at": "2020-03-22T23:46:36Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464126",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
We can't keep the secure py2 test if we're getting rid of the patch, or am I misunderstanding you?



---

archive/issue_comments_464127.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jhpalmieri](#comment%3A26):\n> We can't keep the secure py2 test if we're getting rid of the patch, or am I misunderstanding you?\n\nRight, it would be purely decorative or for the hypothetical situation that someone decides to run sagelib with a patched python2.",
    "created_at": "2020-03-23T00:05:54Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Replying to [jhpalmieri](#comment%3A26):
> We can't keep the secure py2 test if we're getting rid of the patch, or am I misunderstanding you?

Right, it would be purely decorative or for the hypothetical situation that someone decides to run sagelib with a patched python2.



---

archive/issue_comments_464128.json:
```json
{
    "body": "<a id='comment:28'></a>\nTesting this branch at https://github.com/mkoeppe/sage/actions/runs/61077298\n(on top of other tickets)",
    "created_at": "2020-03-23T00:46:01Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464128",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Testing this branch at https://github.com/mkoeppe/sage/actions/runs/61077298
(on top of other tickets)



---

archive/issue_comments_464129.json:
```json
{
    "body": "<a id='comment:29'></a>\nThis passes tests for me on OS X with builds based on Python 2 and Python 3.",
    "created_at": "2020-03-23T04:45:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464129",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>
This passes tests for me on OS X with builds based on Python 2 and Python 3.



---

archive/issue_events_261585.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-24T14:18:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261585"
}
```



---

archive/issue_events_261586.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-03-24T14:18:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261586"
}
```



---

archive/issue_comments_464130.json:
```json
{
    "body": "**Changing reviewer** from \"Fran\u00e7ois Bissey\" to \"Fran\u00e7ois Bissey, Dima Pasechnik\".",
    "created_at": "2020-03-24T14:18:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464130",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "François Bissey" to "François Bissey, Dima Pasechnik".



---

archive/issue_comments_464131.json:
```json
{
    "body": "<a id='comment:30'></a>\nlgtm",
    "created_at": "2020-03-24T14:18:06Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464131",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>
lgtm



---

archive/issue_comments_464132.json:
```json
{
    "body": "<a id='comment:31'></a>\nThanks",
    "created_at": "2020-03-24T16:24:37Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464132",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Thanks



---

archive/issue_comments_464133.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202)\" to \"[cbdce1cef6350482d9ec65c878188e0f6530bc22](https://github.com/sagemath/sagetrac-mirror/commit/cbdce1cef6350482d9ec65c878188e0f6530bc22)\".",
    "created_at": "2020-03-29T00:23:53Z",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29394#issuecomment-464133",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/drop_the_python2_patch_sys_path_security_issue_16202)" to "[cbdce1cef6350482d9ec65c878188e0f6530bc22](https://github.com/sagemath/sagetrac-mirror/commit/cbdce1cef6350482d9ec65c878188e0f6530bc22)".



---

archive/issue_events_261587.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-29T00:23:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261587"
}
```



---

archive/issue_events_261588.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "efb4d84db10d4b00f03b1becf1605c73bdfefb71",
    "created_at": "2020-03-29T00:23:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29394",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29394#event-261588"
}
```
