# Issue 29868: pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf

archive/issues_029631.json:
```json
{
    "assignees": [],
    "body": "Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the build/installation scheme of the sage documentation.\n\nWe create pip-installable packages `sagemath-doc-html` and `sagemath-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.\n\nWe create a package `sagemath-doc-inventory`, which is in charge of building and installing the inventory files.\nIt is a build dependency of `sagemath-doc-html` and `sagemath-doc-pdf`.\n\nAll of these packages depend on `sagemath-doc-src`. It has a build-system dependency on sagelib. An `sdist` of it consists of `SAGE_SRC/doc`. A `wheel` of `sagemath-doc-src` (and thus an installation) contains a copy of the sources (including the auto-generated rst files) in `share/doc/sage/src/` and the doctrees in `share/doc/sage/doctrees`.\nThe incremental build features of the docbuild will only be active when the package `sagemath-doc-src` is installed directly using `setup.py install`, `setup.py develop` or `pip install --editable`.  In these cases, the doctrees (including environment pickes) are kept in the source directory.\n`pip wheel` will always make a from-scratch build of the documentation, eliminating incremental build errors.\n\nThe script `sage-grepdoc` will be provided by `sagemath-doc-html`.\n\nFollow-up tickets:\n- When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n   - https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html\n- Or alternatively as a JupyterLab extension\n   - https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html\n\n\nSee also: \n- #30010: Split `sage_setup.docbuild` out to a separate package\n- #29097: `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`\n- #29231: Add intersphinx mapping for SciPy -- with discussion about docbuild and inventory files\n\n\nDepends on #33852\n\nCC:  @isuruf @kiwifb @antonio-rojas @timokau @nbruin @dimpase @jhpalmieri @mwageringel @zlscherr\n\nKeywords: **sd111**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29868_\n\n",
    "created_at": "2020-06-15T15:57:37Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/29868",
    "user": "https://github.com/mkoeppe"
}
```
Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the build/installation scheme of the sage documentation.

We create pip-installable packages `sagemath-doc-html` and `sagemath-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.

We create a package `sagemath-doc-inventory`, which is in charge of building and installing the inventory files.
It is a build dependency of `sagemath-doc-html` and `sagemath-doc-pdf`.

All of these packages depend on `sagemath-doc-src`. It has a build-system dependency on sagelib. An `sdist` of it consists of `SAGE_SRC/doc`. A `wheel` of `sagemath-doc-src` (and thus an installation) contains a copy of the sources (including the auto-generated rst files) in `share/doc/sage/src/` and the doctrees in `share/doc/sage/doctrees`.
The incremental build features of the docbuild will only be active when the package `sagemath-doc-src` is installed directly using `setup.py install`, `setup.py develop` or `pip install --editable`.  In these cases, the doctrees (including environment pickes) are kept in the source directory.
`pip wheel` will always make a from-scratch build of the documentation, eliminating incremental build errors.

The script `sage-grepdoc` will be provided by `sagemath-doc-html`.

Follow-up tickets:
- When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
   - https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html
- Or alternatively as a JupyterLab extension
   - https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html


See also: 
- #30010: Split `sage_setup.docbuild` out to a separate package
- #29097: `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`
- #29231: Add intersphinx mapping for SciPy -- with discussion about docbuild and inventory files


Depends on #33852

CC:  @isuruf @kiwifb @antonio-rojas @timokau @nbruin @dimpase @jhpalmieri @mwageringel @zlscherr

Keywords: **sd111**

_Issue created by migration from https://trac.sagemath.org/ticket/29868_





---

archive/issue_events_379303.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-15T15:57:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379303"
}
```



---

archive/issue_events_379304.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-15T15:57:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379304"
}
```



---

archive/issue_events_379305.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-15T15:57:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379305"
}
```



---

archive/issue_events_379306.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-15T15:57:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379306"
}
```



---

archive/issue_comments_475021.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Similar to #29411, which makes sagelib a script package, we make the sage docbuild a script package.\n \n \n+See also: #30010 - Split `sage_setup.docbuild` out to a separate package\n+\n``````\n",
    "created_at": "2020-06-28T19:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475021",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Similar to #29411, which makes sagelib a script package, we make the sage docbuild a script package.
 
 
+See also: #30010 - Split `sage_setup.docbuild` out to a separate package
+
``````




---

archive/issue_events_379307.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-08T17:23:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "title_is": "pip-installable packages sage-doc-html, sage-doc-pdf",
    "title_was": "Make sage docbuild a script package",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379307"
}
```



---

archive/issue_comments_475022.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,8 @@\n-Similar to #29411, which makes sagelib a script package, we make the sage docbuild a script package.\n+Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the installation scheme of the sage documentation.\n \n+We create pip-installable packages `sage-doc-html` and `sage-doc-pdf`. \n+\n+When installed using pip, they provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n \n See also: #30010 - Split `sage_setup.docbuild` out to a separate package\n \n``````\n",
    "created_at": "2020-08-08T17:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475022",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,8 @@
-Similar to #29411, which makes sagelib a script package, we make the sage docbuild a script package.
+Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the installation scheme of the sage documentation.
 
+We create pip-installable packages `sage-doc-html` and `sage-doc-pdf`. 
+
+When installed using pip, they provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
 
 See also: #30010 - Split `sage_setup.docbuild` out to a separate package
 
``````




---

archive/issue_comments_475023.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,5 +4,7 @@\n \n When installed using pip, they provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n \n+Also, the script `sage-grepdoc` will be provided by `sage-doc-html`.\n+\n See also: #30010 - Split `sage_setup.docbuild` out to a separate package\n \n``````\n",
    "created_at": "2020-08-09T03:48:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475023",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,5 +4,7 @@
 
 When installed using pip, they provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
 
+Also, the script `sage-grepdoc` will be provided by `sage-doc-html`.
+
 See also: #30010 - Split `sage_setup.docbuild` out to a separate package
 
``````




---

archive/issue_comments_475024.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,7 @@\n \n Also, the script `sage-grepdoc` will be provided by `sage-doc-html`.\n \n-See also: #30010 - Split `sage_setup.docbuild` out to a separate package\n+See also: \n+- #30010 - Split `sage_setup.docbuild` out to a separate package\n+- #29097 - `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`\n \n``````\n",
    "created_at": "2020-08-10T01:18:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475024",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,7 @@
 
 Also, the script `sage-grepdoc` will be provided by `sage-doc-html`.
 
-See also: #30010 - Split `sage_setup.docbuild` out to a separate package
+See also: 
+- #30010 - Split `sage_setup.docbuild` out to a separate package
+- #29097 - `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`
 
``````




---

archive/issue_comments_475025.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,8 @@\n Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the installation scheme of the sage documentation.\n \n-We create pip-installable packages `sage-doc-html` and `sage-doc-pdf`. \n+We create pip-installable packages `sage-doc-html` and `sage-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.\n \n-When installed using pip, they provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n+When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n \n Also, the script `sage-grepdoc` will be provided by `sage-doc-html`.\n \n``````\n",
    "created_at": "2020-08-10T01:30:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475025",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,8 @@
 Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the installation scheme of the sage documentation.
 
-We create pip-installable packages `sage-doc-html` and `sage-doc-pdf`. 
+We create pip-installable packages `sage-doc-html` and `sage-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.
 
-When installed using pip, they provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
+When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
 
 Also, the script `sage-grepdoc` will be provided by `sage-doc-html`.
 
``````




---

archive/issue_events_379308.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379308"
}
```



---

archive/issue_events_379309.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379309"
}
```



---

archive/issue_comments_475026.json:
```json
{
    "body": "Changed keywords from **** to **sd111**",
    "created_at": "2020-12-06T17:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475026",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from **** to **sd111**



---

archive/issue_comments_475027.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the installation scheme of the sage documentation.\n \n-We create pip-installable packages `sage-doc-html` and `sage-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.\n+We create pip-installable packages `sagemath-doc-html` and `sagemath-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.\n \n When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n \n-Also, the script `sage-grepdoc` will be provided by `sage-doc-html`.\n+Also, the script `sage-grepdoc` will be provided by `sagemath-doc-html`.\n \n See also: \n - #30010 - Split `sage_setup.docbuild` out to a separate package\n``````\n",
    "created_at": "2020-12-09T01:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475027",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
 Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the installation scheme of the sage documentation.
 
-We create pip-installable packages `sage-doc-html` and `sage-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.
+We create pip-installable packages `sagemath-doc-html` and `sagemath-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.
 
 When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
 
-Also, the script `sage-grepdoc` will be provided by `sage-doc-html`.
+Also, the script `sage-grepdoc` will be provided by `sagemath-doc-html`.
 
 See also: 
 - #30010 - Split `sage_setup.docbuild` out to a separate package
``````




---

archive/issue_events_379310.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-09T01:50:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "title_is": "pip-installable packages sagemath-doc-html, sagemath-doc-pdf",
    "title_was": "pip-installable packages sage-doc-html, sage-doc-pdf",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379310"
}
```



---

archive/issue_comments_475028.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,4 +9,5 @@\n See also: \n - #30010 - Split `sage_setup.docbuild` out to a separate package\n - #29097 - `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`\n+- #29231 (add intersphinx mapping for SciPy) - with discussion about docbuild and inventory files\n \n``````\n",
    "created_at": "2020-12-30T18:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475028",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,4 +9,5 @@
 See also: 
 - #30010 - Split `sage_setup.docbuild` out to a separate package
 - #29097 - `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`
+- #29231 (add intersphinx mapping for SciPy) - with discussion about docbuild and inventory files
 
``````




---

archive/issue_comments_475029.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,18 @@\n-Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the installation scheme of the sage documentation.\n+Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the build/installation scheme of the sage documentation.\n \n We create pip-installable packages `sagemath-doc-html` and `sagemath-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.\n \n-When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n+We create a package `sagemath-doc-inventory`, which is in charge of building and installing the inventory files.\n+It is a build dependency of `sagemath-doc-html` and `sagemath-doc-pdf`.\n \n-Also, the script `sage-grepdoc` will be provided by `sagemath-doc-html`.\n+We no longer install `doctrees` in `$SAGE_LOCAL/share/doc/sage/`.\n+The incremental build features of the docbuild will only be active when the package is installed directly using `setup.py install`, `setup.py develop` or `pip install --editable`.  In these cases, the doctrees (including environment pickes) are kept in the source directory.\n+`pip wheel` will always make a from-scratch build of the documentation, eliminating incremental build errors.\n+\n+The script `sage-grepdoc` will be provided by `sagemath-doc-html`.\n+\n+Follow-up tickets:\n+- When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n \n See also: \n - #30010 - Split `sage_setup.docbuild` out to a separate package\n``````\n",
    "created_at": "2021-02-06T03:22:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475029",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,18 @@
-Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the installation scheme of the sage documentation.
+Similar to #29411 + #29950, which made `sagelib` a pip-installable distribution (which is then installed by the sage-the-distribution script package `sagelib`), we change the build/installation scheme of the sage documentation.
 
 We create pip-installable packages `sagemath-doc-html` and `sagemath-doc-pdf`. By providing wheels on pypi, users can get access to an offline copy of the documentation without having to build it themselves.
 
-When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
+We create a package `sagemath-doc-inventory`, which is in charge of building and installing the inventory files.
+It is a build dependency of `sagemath-doc-html` and `sagemath-doc-pdf`.
 
-Also, the script `sage-grepdoc` will be provided by `sagemath-doc-html`.
+We no longer install `doctrees` in `$SAGE_LOCAL/share/doc/sage/`.
+The incremental build features of the docbuild will only be active when the package is installed directly using `setup.py install`, `setup.py develop` or `pip install --editable`.  In these cases, the doctrees (including environment pickes) are kept in the source directory.
+`pip wheel` will always make a from-scratch build of the documentation, eliminating incremental build errors.
+
+The script `sage-grepdoc` will be provided by `sagemath-doc-html`.
+
+Follow-up tickets:
+- When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
 
 See also: 
 - #30010 - Split `sage_setup.docbuild` out to a separate package
``````




---

archive/issue_events_379311.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-06T03:22:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "title_is": "pip-installable packages sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf",
    "title_was": "pip-installable packages sagemath-doc-html, sagemath-doc-pdf",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379311"
}
```



---

archive/issue_events_379312.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-06T05:45:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "title_is": "pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf",
    "title_was": "pip-installable packages sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379312"
}
```



---

archive/issue_comments_475030.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,8 +5,8 @@\n We create a package `sagemath-doc-inventory`, which is in charge of building and installing the inventory files.\n It is a build dependency of `sagemath-doc-html` and `sagemath-doc-pdf`.\n \n-We no longer install `doctrees` in `$SAGE_LOCAL/share/doc/sage/`.\n-The incremental build features of the docbuild will only be active when the package is installed directly using `setup.py install`, `setup.py develop` or `pip install --editable`.  In these cases, the doctrees (including environment pickes) are kept in the source directory.\n+All of these packages depend on `sagemath-doc-src`. It has a build-system dependency on sagelib. An `sdist` of it consists of `SAGE_SRC/doc`. A `wheel` of `sagemath-doc-src` (and thus an installation) contains a copy of the sources (including the auto-generated rst files) in `share/doc/sage/src/` and the doctrees in `share/doc/sage/doctrees`.\n+The incremental build features of the docbuild will only be active when the package `sagemath-doc-src` is installed directly using `setup.py install`, `setup.py develop` or `pip install --editable`.  In these cases, the doctrees (including environment pickes) are kept in the source directory.\n `pip wheel` will always make a from-scratch build of the documentation, eliminating incremental build errors.\n \n The script `sage-grepdoc` will be provided by `sagemath-doc-html`.\n``````\n",
    "created_at": "2021-02-06T05:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475030",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,8 +5,8 @@
 We create a package `sagemath-doc-inventory`, which is in charge of building and installing the inventory files.
 It is a build dependency of `sagemath-doc-html` and `sagemath-doc-pdf`.
 
-We no longer install `doctrees` in `$SAGE_LOCAL/share/doc/sage/`.
-The incremental build features of the docbuild will only be active when the package is installed directly using `setup.py install`, `setup.py develop` or `pip install --editable`.  In these cases, the doctrees (including environment pickes) are kept in the source directory.
+All of these packages depend on `sagemath-doc-src`. It has a build-system dependency on sagelib. An `sdist` of it consists of `SAGE_SRC/doc`. A `wheel` of `sagemath-doc-src` (and thus an installation) contains a copy of the sources (including the auto-generated rst files) in `share/doc/sage/src/` and the doctrees in `share/doc/sage/doctrees`.
+The incremental build features of the docbuild will only be active when the package `sagemath-doc-src` is installed directly using `setup.py install`, `setup.py develop` or `pip install --editable`.  In these cases, the doctrees (including environment pickes) are kept in the source directory.
 `pip wheel` will always make a from-scratch build of the documentation, eliminating incremental build errors.
 
 The script `sage-grepdoc` will be provided by `sagemath-doc-html`.
``````




---

archive/issue_comments_475031.json:
```json
{
    "body": "Dependencies: **#31356**",
    "created_at": "2021-02-07T18:33:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475031",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31356**



---

archive/issue_comments_475032.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475032",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'>Comment 14:</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_379313.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379313"
}
```



---

archive/issue_events_379314.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379314"
}
```



---

archive/issue_comments_475033.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nInput and help from docbuild experts is very welcome.",
    "created_at": "2021-04-14T04:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475033",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'>Comment 15:</a>
Input and help from docbuild experts is very welcome.



---

archive/issue_comments_475034.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nSome questions: \n\n- Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?\n\n- Is there a way to only generate the doctrees but not build HTML or PDF?\n\n- Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?",
    "created_at": "2021-04-15T00:49:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475034",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'>Comment 16:</a>
Some questions: 

- Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?

- Is there a way to only generate the doctrees but not build HTML or PDF?

- Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?



---

archive/issue_comments_475035.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@mkoeppe](#comment%3A16):\n> Some questions: \n> \n> - Is there a way to only generate the doctrees but not build HTML or PDF?\n\nI do believe there is a sphinx option for doing just that.\n\n> \n> - Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?\n\nAs far as I know they need to be able to run the sage library. In particular all graphs/plots are generated during the documentation build.",
    "created_at": "2021-04-15T01:33:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475035",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@mkoeppe](#comment%3A16):
> Some questions: 
> 
> - Is there a way to only generate the doctrees but not build HTML or PDF?

I do believe there is a sphinx option for doing just that.

> 
> - Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?

As far as I know they need to be able to run the sage library. In particular all graphs/plots are generated during the documentation build.



---

archive/issue_comments_475036.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@kiwifb](#comment%3A17):\n> Replying to [@mkoeppe](#comment%3A16):\n> > Some questions: \n> > \n> > - Is there a way to only generate the doctrees but not build HTML or PDF?\n\n> \n> I do believe there is a sphinx option for doing just that.\n> \n\nI cannot find such an option anymore. If it existed. There is an option to say where the doctrees should be stored and found, but nothing on producing it in isolation.",
    "created_at": "2021-04-15T04:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475036",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@kiwifb](#comment%3A17):
> Replying to [@mkoeppe](#comment%3A16):
> > Some questions: 
> > 
> > - Is there a way to only generate the doctrees but not build HTML or PDF?

> 
> I do believe there is a sphinx option for doing just that.
> 

I cannot find such an option anymore. If it existed. There is an option to say where the doctrees should be stored and found, but nothing on producing it in isolation.



---

archive/issue_comments_475037.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nWell, `./sage --docbuild all inventory` builds the inventory files and the doctree files, but not html or pdf.",
    "created_at": "2021-04-15T05:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475037",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'>Comment 19:</a>
Well, `./sage --docbuild all inventory` builds the inventory files and the doctree files, but not html or pdf.



---

archive/issue_comments_475038.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@mkoeppe](#comment%3A16):\n> Some questions: \n> \n> - Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?\n\nThe `autodoc` procedure does this, with `sage/monoids/free_monoid.py` as input. (Edit: or maybe just `src/doc/en/reference/monoids/index.rst` as input?) I'm not sure precisely how this is done, but the file `sage_docbuild/ext/sage_autodoc.py` is certainly relevant. (This is Sage's fork of the Sphinx autodoc module.)",
    "created_at": "2021-04-15T05:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475038",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@mkoeppe](#comment%3A16):
> Some questions: 
> 
> - Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?

The `autodoc` procedure does this, with `sage/monoids/free_monoid.py` as input. (Edit: or maybe just `src/doc/en/reference/monoids/index.rst` as input?) I'm not sure precisely how this is done, but the file `sage_docbuild/ext/sage_autodoc.py` is certainly relevant. (This is Sage's fork of the Sphinx autodoc module.)



---

archive/issue_comments_475039.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nNo, I'm wrong about that. It's done in `sage_docbuild/__init__.py`, in the `write_auto_rest_file` method.",
    "created_at": "2021-04-15T05:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475039",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'>Comment 21:</a>
No, I'm wrong about that. It's done in `sage_docbuild/__init__.py`, in the `write_auto_rest_file` method.



---

archive/issue_events_379315.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379315"
}
```



---

archive/issue_events_379316.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379316"
}
```



---

archive/issue_comments_475040.json:
```json
{
    "body": "Changed dependencies from **#31356** to **#31356, #32713**",
    "created_at": "2021-11-09T21:02:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475040",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31356** to **#31356, #32713**



---

archive/issue_events_379317.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379317"
}
```



---

archive/issue_events_379318.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379318"
}
```



---

archive/issue_comments_475041.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nAccording to [#33064 comment:19](https://github.com/sagemath/sage/issues/33064#comment:19), there is no need to install doctrees in `SAGE_LOCAL`, not even for introspection (`sage.misc.sphinxify`)",
    "created_at": "2022-01-12T02:54:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475041",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'>Comment 25:</a>
According to [#33064 comment:19](https://github.com/sagemath/sage/issues/33064#comment:19), there is no need to install doctrees in `SAGE_LOCAL`, not even for introspection (`sage.misc.sphinxify`)



---

archive/issue_comments_475042.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n - When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n \n See also: \n-- #30010 - Split `sage_setup.docbuild` out to a separate package\n-- #29097 - `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`\n-- #29231 (add intersphinx mapping for SciPy) - with discussion about docbuild and inventory files\n+- #30010: Split `sage_setup.docbuild` out to a separate package\n+- #29097: `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`\n+- #29231: Add intersphinx mapping for SciPy -- with discussion about docbuild and inventory files\n \n``````\n",
    "created_at": "2022-01-12T08:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475042",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,7 +15,7 @@
 - When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
 
 See also: 
-- #30010 - Split `sage_setup.docbuild` out to a separate package
-- #29097 - `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`
-- #29231 (add intersphinx mapping for SciPy) - with discussion about docbuild and inventory files
+- #30010: Split `sage_setup.docbuild` out to a separate package
+- #29097: `build/make/Makefile.in`: Rename make targets `SPKG-clean` to `SPKG-uninstall`
+- #29231: Add intersphinx mapping for SciPy -- with discussion about docbuild and inventory files
 
``````




---

archive/issue_events_379319.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379319"
}
```



---

archive/issue_events_379320.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379320"
}
```



---

archive/issue_comments_475043.json:
```json
{
    "body": "Changed dependencies from **#31356, #32713** to **#33852**",
    "created_at": "2022-05-15T07:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475043",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31356, #32713** to **#33852**



---

archive/issue_comments_475044.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,6 +13,10 @@\n \n Follow-up tickets:\n - When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).\n+   - https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html\n+- Or alternatively as a JupyterLab extension\n+   - https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html\n+\n \n See also: \n - #30010: Split `sage_setup.docbuild` out to a separate package\n``````\n",
    "created_at": "2022-05-17T03:43:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29868#issuecomment-475044",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,6 +13,10 @@
 
 Follow-up tickets:
 - When installed using pip, the packages provide `nbextension`s that provide offline help in a Jupyter notebook. This is useful in particular with local notebooks connecting to remote sage kernels (see  #30306 (3)).
+   - https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html
+- Or alternatively as a JupyterLab extension
+   - https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html
+
 
 See also: 
 - #30010: Split `sage_setup.docbuild` out to a separate package
``````




---

archive/issue_events_379321.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-01T20:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379321"
}
```



---

archive/issue_events_379322.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-01T20:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379322"
}
```



---

archive/issue_events_379323.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379323"
}
```



---

archive/issue_events_379324.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29868",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29868#event-379324"
}
```
