# Issue 29445: Reject broken system PARI 2.11.3 and re-enable PARI library test in spkg-configure

archive/issues_029208.json:
```json
{
    "assignees": [],
    "body": "There are several failing doctests depending on the PARI version of the system, e.g.\n\n```\nFile \"src/sage/rings/number_field/number_field_ideal.py\", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor\nFailed example:\n    fact = F.factor(2); fact\nExpected:\n    (Fractional ideal (2*a^2 + 1))^2 * (Fractional ideal (-2*a^2))\nGot:\n    (Fractional ideal (-2*a^2 - 1))^2 * (Fractional ideal (2*a^2))\n```\n\nsee e.g.\n\n[https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)\n\nThis is the case because debian bullseye uses pari 2.11.3 (instead of pari 2.11.3). Many instances seem to fail, just because the choice of generators has changed. However, there is at least one thing really strange when upgrading to pari 2.11.3:\n\n```\nsage: y = var('y')\nsage: pK = pari.bnfinit(y^3+3)\nsage: pK.bnfisunit(pK.bnfunit()[0])\n[1, Mod(1, 2)]~\n```\n\nCC:  @mkoeppe @jdemeyer @orlitzky @dimpase\n\nKeywords: **PARI, number fields**\n\nBranch: **[c4a0a22](https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41)**\n\nReviewer: **Matthias Koeppe, Jonathan Kliem**\n\nAuthor: **Jonathan Kliem, Matthias Koeppe**\n\nComponent: **number fields**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/29445_\n\n",
    "closed_at": "2020-04-09T22:45:05Z",
    "created_at": "2020-04-01T16:46:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Reject broken system PARI 2.11.3 and re-enable PARI library test in spkg-configure",
    "type": "issue",
    "updated_at": "2020-04-23T10:27:26Z",
    "url": "https://github.com/sagemath/sage/issues/29445",
    "user": "https://github.com/kliem"
}
```
There are several failing doctests depending on the PARI version of the system, e.g.

```
File "src/sage/rings/number_field/number_field_ideal.py", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor
Failed example:
    fact = F.factor(2); fact
Expected:
    (Fractional ideal (2*a^2 + 1))^2 * (Fractional ideal (-2*a^2))
Got:
    (Fractional ideal (-2*a^2 - 1))^2 * (Fractional ideal (2*a^2))
```

see e.g.

[https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)

This is the case because debian bullseye uses pari 2.11.3 (instead of pari 2.11.3). Many instances seem to fail, just because the choice of generators has changed. However, there is at least one thing really strange when upgrading to pari 2.11.3:

```
sage: y = var('y')
sage: pK = pari.bnfinit(y^3+3)
sage: pK.bnfisunit(pK.bnfunit()[0])
[1, Mod(1, 2)]~
```

CC:  @mkoeppe @jdemeyer @orlitzky @dimpase

Keywords: **PARI, number fields**

Branch: **[c4a0a22](https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41)**

Reviewer: **Matthias Koeppe, Jonathan Kliem**

Author: **Jonathan Kliem, Matthias Koeppe**

Component: **number fields**

_Issue created by migration from https://trac.sagemath.org/ticket/29445_





---

archive/issue_events_405000.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-01T16:46:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405000"
}
```



---

archive/issue_events_405001.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-01T16:46:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405001"
}
```



---

archive/issue_events_405002.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-01T16:46:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405002"
}
```



---

archive/issue_events_405003.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-01T16:46:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405003"
}
```



---

archive/issue_comments_462814.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe following tests currently fail (depending on the PARI version):\n\n```\nsage -t src/sage/rings/number_field/number_field.py\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field.py\", line 3426, in sage.rings.number_field.number_field.NumberField_generic.ideals_of_bdd_norm\nFailed example:\n    for n in d:\n        print(n)\n        for I in d[n]:\n            print(I)\nExpected:\n    1\n    Fractional ideal (1)\n    2\n    Fractional ideal (2, 1/2*a - 1/2)\n    Fractional ideal (2, 1/2*a + 1/2)\n    3\n    Fractional ideal (3, 1/2*a - 1/2)\n    Fractional ideal (3, 1/2*a + 1/2)\n    4\n...\nGot:\n    1\n    Fractional ideal (1)\n    2\n    Fractional ideal (2, 1/2*a - 1/2)\n    Fractional ideal (2, 1/2*a + 1/2)\n    3\n    Fractional ideal (3, 1/2*a + 1/2)\n    Fractional ideal (3, 1/2*a - 1/2)\n...\n```\n\n```\n File \"src/sage/rings/number_field/number_field.py\", line 4547, in sage.rings.number_field.number_field.NumberField_generic._S_class_group_and_units\nFailed example:\n    K._S_class_group_and_units(tuple(K.primes_above(13)))\nExpected:\n    ([2/13*a^2 + 1/13*a - 677/13,\n      1/13*a^2 + 7/13*a - 332/13,\n      -1/13*a^2 + 6/13*a + 345/13,\n      -1,\n      2/13*a^2 + 1/13*a - 755/13,\n      1/13*a^2 - 19/13*a - 7/13],\n     [(Fractional ideal (11, a - 2), 2), (Fractional ideal (19, a + 7), 2)])\nGot:\n    ([2/13*a^2 + 1/13*a - 677/13,\n      1/13*a^2 + 7/13*a - 332/13,\n      -1/13*a^2 + 6/13*a + 345/13,\n      -1,\n      2/13*a^2 + 1/13*a - 755/13,\n      1/13*a^2 + 20/13*a - 7/13],\n     [(Fractional ideal (11, a - 2), 2), (Fractional ideal (19, a + 7), 2)])\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 4705, in sage.rings.number_field.number_field.NumberField_generic.selmer_group\nFailed example:\n    K.selmer_group(K.primes_above(13), 2)\nExpected:\n    [2/13*a^2 + 1/13*a - 677/13,\n     1/13*a^2 + 7/13*a - 332/13,\n     -1/13*a^2 + 6/13*a + 345/13,\n     -1,\n     2/13*a^2 + 1/13*a - 755/13,\n     1/13*a^2 - 19/13*a - 7/13,\n     -1/13*a^2 + 45/13*a - 97/13,\n     2/13*a^2 + 40/13*a - 27/13]\nGot:\n    [2/13*a^2 + 1/13*a - 677/13,\n     1/13*a^2 + 7/13*a - 332/13,\n     -1/13*a^2 + 6/13*a + 345/13,\n     -1,\n     2/13*a^2 + 1/13*a - 755/13,\n     1/13*a^2 + 20/13*a - 7/13,\n     1/13*a^2 - 45/13*a + 97/13,\n     -2/13*a^2 - 40/13*a + 27/13]\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 5357, in sage.rings.number_field.number_field.NumberField_generic.elements_of_norm\nFailed example:\n    K.elements_of_norm(7)\nExpected:\n    [7/225*a^2 - 7/75*a - 42/25]\nGot:\n    [28/225*a^2 + 77/75*a - 133/25]\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 5460, in sage.rings.number_field.number_field.NumberField_generic.factor\nFailed example:\n    f = L.factor(a + 1); f\nExpected:\n    (Fractional ideal (1/2*a*b - a + 1/2)) * (Fractional ideal (-1/2*a*b - a + 1/2))\nGot:\n    (Fractional ideal (-1/2*b + 1/2*a + 1)) * (Fractional ideal (-1/2*a*b - a + 1/2))\n```\n\n```\n File \"src/sage/rings/number_field/number_field.py\", line 6537, in sage.rings.number_field.number_field.NumberField_generic.uniformizer\nFailed example:\n    [K.uniformizer(P) for P,e in factor(K.ideal(7))]\nExpected:\n    [t^2 + 3*t + 1]\nGot:\n    [t^2 - 4*t + 1]\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 6793, in sage.rings.number_field.number_field.NumberField_generic.S_unit_group\nFailed example:\n    U.log(u)\nExpected:\n    (1, 1, 4, 1, 5)\nGot:\n    (0, 1, 4, 1, 5)\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 7803, in sage.rings.number_field.number_field.NumberField_absolute.optimized_representation\nFailed example:\n    K.optimized_representation()\nExpected:\n    (Number Field in a1 with defining polynomial x^3 - 7*x - 7,\n     Ring morphism:\n       From: Number Field in a1 with defining polynomial x^3 - 7*x - 7\n       To:   Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123\n       Defn: a1 |--> 7/225*a^2 - 7/75*a - 42/25,\n     Ring morphism:\n       From: Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123\n       To:   Number Field in a1 with defining polynomial x^3 - 7*x - 7\n       Defn: a |--> -15/7*a1^2 + 9)\nGot:\n    (Number Field in a1 with defining polynomial x^3 - 7*x - 7, Ring morphism:\n       From: Number Field in a1 with defining polynomial x^3 - 7*x - 7\n       To:   Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123\n       Defn: a1 |--> 28/225*a^2 + 77/75*a - 133/25, Ring morphism:\n       From: Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123\n       To:   Number Field in a1 with defining polynomial x^3 - 7*x - 7\n       Defn: a |--> -60/7*a1^2 + 15*a1 + 39)\n```\n\n```\n File \"src/sage/rings/number_field/number_field_ideal.py\", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor\nFailed example:\n    fact = F.factor(2); fact\nExpected:\n    (Fractional ideal (2*a^2 + 1))^2 * (Fractional ideal (-2*a^2))\nGot:\n    (Fractional ideal (-2*a^2 - 1))^2 * (Fractional ideal (2*a^2))\n```\n\n```\n File \"src/sage/rings/number_field/number_field_ideal.py\", line 2420, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.idealcoprime\nFailed example:\n    lam = A.idealcoprime(B); lam\nExpected:\n    -1/6*a + 1/6\nGot:\n    1/6*a - 1/6\n```\n\n```\n File \"src/sage/rings/number_field/unit_group.py\", line 281, in sage.rings.number_field.unit_group.UnitGroup.__init__\nFailed example:\n    UnitGroup(K, S=tuple(K.primes_above(7)))\nExpected:\n    S-unit group with structure C2 x Z x Z x Z of Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123 with S = (Fractional ideal (7/225*a^2 - 7/75*a - 42/25),)\nGot:\n    S-unit group with structure C2 x Z x Z x Z of Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123 with S = (Fractional ideal (28/225*a^2 + 77/75*a - 133/25),)\n```\n\n```\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1284, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_class_group\nFailed example:\n    S.S_class_group([])\nExpected:\n    [((1/4*xbar^2 + 31/4,\n       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,\n       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,\n       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),\n      6),\n      ((-1/4*xbar^2 - 23/4,\n       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,\n       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,\n       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),\n      6),\n     ((-5/4*xbar^2 - 115/4,\n       1/4*a*xbar^2 + 23/4*a,\n       -1/16*xbar^3 - 7/16*xbar^2 - 23/16*xbar - 161/16,\n       1/16*a*xbar^3 - 1/16*a*xbar^2 + 23/16*a*xbar - 23/16*a),\n      2)]\nGot:\n     [((1/4*xbar^2 + 31/4,\n       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,\n       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,\n       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),\n      6),\n     ((-1/4*xbar^2 - 23/4,\n       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,\n       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,\n       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),\n      6),\n     ((-5/4*xbar^2 - 115/4,\n       (1/8*a - 5/8)*xbar^2 + 23/8*a - 115/8,\n       -1/16*xbar^3 - 17/16*xbar^2 - 23/16*xbar - 391/16,\n       1/16*a*xbar^3 + (-1/16*a - 5/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 115/8),\n      2)]\n```\n\n```\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1416, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.class_group\nFailed example:\n    S.class_group()\nExpected:\n    [((1/4*xbar^2 + 31/4,\n       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,\n       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,\n       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),\n      6),\n     ((-1/4*xbar^2 - 23/4,\n       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,\n       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,\n       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),\n      6),\n     ((-5/4*xbar^2 - 115/4,\n       1/4*a*xbar^2 + 23/4*a,\n       -1/16*xbar^3 - 7/16*xbar^2 - 23/16*xbar - 161/16,\n       1/16*a*xbar^3 - 1/16*a*xbar^2 + 23/16*a*xbar - 23/16*a),\n      2)]\nGot:\n    [((1/4*xbar^2 + 31/4,\n       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,\n       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,\n       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),\n      6),\n     ((-1/4*xbar^2 - 23/4,\n       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,\n       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,\n       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),\n      6),\n     ((-5/4*xbar^2 - 115/4,\n       (1/8*a - 5/8)*xbar^2 + 23/8*a - 115/8,\n       -1/16*xbar^3 - 17/16*xbar^2 - 23/16*xbar - 391/16,\n       1/16*a*xbar^3 + (-1/16*a - 5/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 115/8),\n      2)]\n```\n\nThere are some other tests that seem PARI related, e.g.\n\n```\nFile \"src/sage/lfunctions/dokchitser.py\", line 112, in sage.lfunctions.dokchitser.Dokchitser\nFailed example:\n    L.check_functional_equation()\nExpected:\n    6.04442711160669e-18                            \nGot:\n    6.11218974738703e-18\n```\n\nand\n\n```\n File \"src/sage/lfunctions/dokchitser.py\", line 671, in sage.lfunctions.dokchitser.Dokchitser.check_functional_equation\nFailed example:\n    L.check_functional_equation()\nExpected:\n    -2.71050543121376e-20                        \nGot:\n    -1.35525271560688e-20\n```\n\n```\nFile \"src/sage/lfunctions/pari.py\", line 425, in sage.lfunctions.pari.LFunction\nFailed example:\n    L.check_functional_equation()\nExpected:\n    1.08420217248550e-19\nGot:\n    4.33680868994202e-19\n```\n\nThose tests could be repaired by just checking that the numerical noise is reasonable.",
    "created_at": "2020-04-01T20:13:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462814",
    "user": "https://github.com/kliem"
}
```

<div id="comment:1" align="right">comment:1</div>

The following tests currently fail (depending on the PARI version):

```
sage -t src/sage/rings/number_field/number_field.py
**********************************************************************
File "src/sage/rings/number_field/number_field.py", line 3426, in sage.rings.number_field.number_field.NumberField_generic.ideals_of_bdd_norm
Failed example:
    for n in d:
        print(n)
        for I in d[n]:
            print(I)
Expected:
    1
    Fractional ideal (1)
    2
    Fractional ideal (2, 1/2*a - 1/2)
    Fractional ideal (2, 1/2*a + 1/2)
    3
    Fractional ideal (3, 1/2*a - 1/2)
    Fractional ideal (3, 1/2*a + 1/2)
    4
...
Got:
    1
    Fractional ideal (1)
    2
    Fractional ideal (2, 1/2*a - 1/2)
    Fractional ideal (2, 1/2*a + 1/2)
    3
    Fractional ideal (3, 1/2*a + 1/2)
    Fractional ideal (3, 1/2*a - 1/2)
...
```

```
 File "src/sage/rings/number_field/number_field.py", line 4547, in sage.rings.number_field.number_field.NumberField_generic._S_class_group_and_units
Failed example:
    K._S_class_group_and_units(tuple(K.primes_above(13)))
Expected:
    ([2/13*a^2 + 1/13*a - 677/13,
      1/13*a^2 + 7/13*a - 332/13,
      -1/13*a^2 + 6/13*a + 345/13,
      -1,
      2/13*a^2 + 1/13*a - 755/13,
      1/13*a^2 - 19/13*a - 7/13],
     [(Fractional ideal (11, a - 2), 2), (Fractional ideal (19, a + 7), 2)])
Got:
    ([2/13*a^2 + 1/13*a - 677/13,
      1/13*a^2 + 7/13*a - 332/13,
      -1/13*a^2 + 6/13*a + 345/13,
      -1,
      2/13*a^2 + 1/13*a - 755/13,
      1/13*a^2 + 20/13*a - 7/13],
     [(Fractional ideal (11, a - 2), 2), (Fractional ideal (19, a + 7), 2)])
```

```
File "src/sage/rings/number_field/number_field.py", line 4705, in sage.rings.number_field.number_field.NumberField_generic.selmer_group
Failed example:
    K.selmer_group(K.primes_above(13), 2)
Expected:
    [2/13*a^2 + 1/13*a - 677/13,
     1/13*a^2 + 7/13*a - 332/13,
     -1/13*a^2 + 6/13*a + 345/13,
     -1,
     2/13*a^2 + 1/13*a - 755/13,
     1/13*a^2 - 19/13*a - 7/13,
     -1/13*a^2 + 45/13*a - 97/13,
     2/13*a^2 + 40/13*a - 27/13]
Got:
    [2/13*a^2 + 1/13*a - 677/13,
     1/13*a^2 + 7/13*a - 332/13,
     -1/13*a^2 + 6/13*a + 345/13,
     -1,
     2/13*a^2 + 1/13*a - 755/13,
     1/13*a^2 + 20/13*a - 7/13,
     1/13*a^2 - 45/13*a + 97/13,
     -2/13*a^2 - 40/13*a + 27/13]
```

```
File "src/sage/rings/number_field/number_field.py", line 5357, in sage.rings.number_field.number_field.NumberField_generic.elements_of_norm
Failed example:
    K.elements_of_norm(7)
Expected:
    [7/225*a^2 - 7/75*a - 42/25]
Got:
    [28/225*a^2 + 77/75*a - 133/25]
```

```
File "src/sage/rings/number_field/number_field.py", line 5460, in sage.rings.number_field.number_field.NumberField_generic.factor
Failed example:
    f = L.factor(a + 1); f
Expected:
    (Fractional ideal (1/2*a*b - a + 1/2)) * (Fractional ideal (-1/2*a*b - a + 1/2))
Got:
    (Fractional ideal (-1/2*b + 1/2*a + 1)) * (Fractional ideal (-1/2*a*b - a + 1/2))
```

```
 File "src/sage/rings/number_field/number_field.py", line 6537, in sage.rings.number_field.number_field.NumberField_generic.uniformizer
Failed example:
    [K.uniformizer(P) for P,e in factor(K.ideal(7))]
Expected:
    [t^2 + 3*t + 1]
Got:
    [t^2 - 4*t + 1]
```

```
File "src/sage/rings/number_field/number_field.py", line 6793, in sage.rings.number_field.number_field.NumberField_generic.S_unit_group
Failed example:
    U.log(u)
Expected:
    (1, 1, 4, 1, 5)
Got:
    (0, 1, 4, 1, 5)
```

```
File "src/sage/rings/number_field/number_field.py", line 7803, in sage.rings.number_field.number_field.NumberField_absolute.optimized_representation
Failed example:
    K.optimized_representation()
Expected:
    (Number Field in a1 with defining polynomial x^3 - 7*x - 7,
     Ring morphism:
       From: Number Field in a1 with defining polynomial x^3 - 7*x - 7
       To:   Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123
       Defn: a1 |--> 7/225*a^2 - 7/75*a - 42/25,
     Ring morphism:
       From: Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123
       To:   Number Field in a1 with defining polynomial x^3 - 7*x - 7
       Defn: a |--> -15/7*a1^2 + 9)
Got:
    (Number Field in a1 with defining polynomial x^3 - 7*x - 7, Ring morphism:
       From: Number Field in a1 with defining polynomial x^3 - 7*x - 7
       To:   Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123
       Defn: a1 |--> 28/225*a^2 + 77/75*a - 133/25, Ring morphism:
       From: Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123
       To:   Number Field in a1 with defining polynomial x^3 - 7*x - 7
       Defn: a |--> -60/7*a1^2 + 15*a1 + 39)
```

```
 File "src/sage/rings/number_field/number_field_ideal.py", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor
Failed example:
    fact = F.factor(2); fact
Expected:
    (Fractional ideal (2*a^2 + 1))^2 * (Fractional ideal (-2*a^2))
Got:
    (Fractional ideal (-2*a^2 - 1))^2 * (Fractional ideal (2*a^2))
```

```
 File "src/sage/rings/number_field/number_field_ideal.py", line 2420, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.idealcoprime
Failed example:
    lam = A.idealcoprime(B); lam
Expected:
    -1/6*a + 1/6
Got:
    1/6*a - 1/6
```

```
 File "src/sage/rings/number_field/unit_group.py", line 281, in sage.rings.number_field.unit_group.UnitGroup.__init__
Failed example:
    UnitGroup(K, S=tuple(K.primes_above(7)))
Expected:
    S-unit group with structure C2 x Z x Z x Z of Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123 with S = (Fractional ideal (7/225*a^2 - 7/75*a - 42/25),)
Got:
    S-unit group with structure C2 x Z x Z x Z of Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123 with S = (Fractional ideal (28/225*a^2 + 77/75*a - 133/25),)
```

```
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1284, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_class_group
Failed example:
    S.S_class_group([])
Expected:
    [((1/4*xbar^2 + 31/4,
       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,
       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,
       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),
      6),
      ((-1/4*xbar^2 - 23/4,
       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,
       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,
       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),
      6),
     ((-5/4*xbar^2 - 115/4,
       1/4*a*xbar^2 + 23/4*a,
       -1/16*xbar^3 - 7/16*xbar^2 - 23/16*xbar - 161/16,
       1/16*a*xbar^3 - 1/16*a*xbar^2 + 23/16*a*xbar - 23/16*a),
      2)]
Got:
     [((1/4*xbar^2 + 31/4,
       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,
       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,
       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),
      6),
     ((-1/4*xbar^2 - 23/4,
       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,
       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,
       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),
      6),
     ((-5/4*xbar^2 - 115/4,
       (1/8*a - 5/8)*xbar^2 + 23/8*a - 115/8,
       -1/16*xbar^3 - 17/16*xbar^2 - 23/16*xbar - 391/16,
       1/16*a*xbar^3 + (-1/16*a - 5/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 115/8),
      2)]
```

```
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1416, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.class_group
Failed example:
    S.class_group()
Expected:
    [((1/4*xbar^2 + 31/4,
       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,
       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,
       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),
      6),
     ((-1/4*xbar^2 - 23/4,
       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,
       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,
       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),
      6),
     ((-5/4*xbar^2 - 115/4,
       1/4*a*xbar^2 + 23/4*a,
       -1/16*xbar^3 - 7/16*xbar^2 - 23/16*xbar - 161/16,
       1/16*a*xbar^3 - 1/16*a*xbar^2 + 23/16*a*xbar - 23/16*a),
      2)]
Got:
    [((1/4*xbar^2 + 31/4,
       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,
       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,
       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),
      6),
     ((-1/4*xbar^2 - 23/4,
       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,
       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,
       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),
      6),
     ((-5/4*xbar^2 - 115/4,
       (1/8*a - 5/8)*xbar^2 + 23/8*a - 115/8,
       -1/16*xbar^3 - 17/16*xbar^2 - 23/16*xbar - 391/16,
       1/16*a*xbar^3 + (-1/16*a - 5/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 115/8),
      2)]
```

There are some other tests that seem PARI related, e.g.

```
File "src/sage/lfunctions/dokchitser.py", line 112, in sage.lfunctions.dokchitser.Dokchitser
Failed example:
    L.check_functional_equation()
Expected:
    6.04442711160669e-18                            
Got:
    6.11218974738703e-18
```

and

```
 File "src/sage/lfunctions/dokchitser.py", line 671, in sage.lfunctions.dokchitser.Dokchitser.check_functional_equation
Failed example:
    L.check_functional_equation()
Expected:
    -2.71050543121376e-20                        
Got:
    -1.35525271560688e-20
```

```
File "src/sage/lfunctions/pari.py", line 425, in sage.lfunctions.pari.LFunction
Failed example:
    L.check_functional_equation()
Expected:
    1.08420217248550e-19
Got:
    4.33680868994202e-19
```

Those tests could be repaired by just checking that the numerical noise is reasonable.



---

archive/issue_comments_462815.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-There are several failing doctests depending on the PARI version of the system, see e.g.\n+There are several failing doctests depending on the PARI version of the system, e.g.\n \n ```\n File \"src/sage/rings/number_field/number_field_ideal.py\", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor\n@@ -15,3 +15,5 @@\n [https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)\n \n We fix those tests.\n+\n+Sage currently installs pari 2.11.2 (if nothing suitable is found), but debian bullseye has 2.11.3.\n``````\n",
    "created_at": "2020-04-02T09:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462815",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-There are several failing doctests depending on the PARI version of the system, see e.g.
+There are several failing doctests depending on the PARI version of the system, e.g.
 
 ```
 File "src/sage/rings/number_field/number_field_ideal.py", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor
@@ -15,3 +15,5 @@
 [https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)
 
 We fix those tests.
+
+Sage currently installs pari 2.11.2 (if nothing suitable is found), but debian bullseye has 2.11.3.
``````




---

archive/issue_comments_462816.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI have upgraded to pari 2.11.3 and that reproduces the problems. So I confirm that this is the problem.",
    "created_at": "2020-04-02T09:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462816",
    "user": "https://github.com/kliem"
}
```

<div id="comment:3" align="right">comment:3</div>

I have upgraded to pari 2.11.3 and that reproduces the problems. So I confirm that this is the problem.



---

archive/issue_comments_462817.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSomething seems to be messed up when installing PARI 2.11.3\n\n```\nsage: y = var('y')\nsage: pK = pari.bnfinit(y^3+3)\nsage: pK.bnfisunit(pK.bnfunit()[0])\n[1, Mod(1, 2)]~\n```\n\nBut the expected output is `[1, Mod(0, 2)]`.",
    "created_at": "2020-04-02T14:42:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462817",
    "user": "https://github.com/kliem"
}
```

<div id="comment:4" align="right">comment:4</div>

Something seems to be messed up when installing PARI 2.11.3

```
sage: y = var('y')
sage: pK = pari.bnfinit(y^3+3)
sage: pK.bnfisunit(pK.bnfunit()[0])
[1, Mod(1, 2)]~
```

But the expected output is `[1, Mod(0, 2)]`.



---

archive/issue_comments_462818.json:
```json
{
    "body": "Changed author from **Jonathan Kliem** to none",
    "created_at": "2020-04-02T14:42:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462818",
    "user": "https://github.com/kliem"
}
```

Changed author from **Jonathan Kliem** to none



---

archive/issue_events_405004.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-04-02T14:42:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405004"
}
```



---

archive/issue_comments_462819.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,11 @@\n \n [https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)\n \n-We fix those tests.\n+This is the case because debian bullseye uses pari 2.11.3 (instead of pari 2.11.3). Many instances seem to fail, just because the choice of generators has changed. However, there is at least one thing really strange when upgrading to pari 2.11.3:\n \n-Sage currently installs pari 2.11.2 (if nothing suitable is found), but debian bullseye has 2.11.3.\n+```\n+sage: y = var('y')\n+sage: pK = pari.bnfinit(y^3+3)\n+sage: pK.bnfisunit(pK.bnfunit()[0])\n+[1, Mod(1, 2)]~\n+```\n``````\n",
    "created_at": "2020-04-02T14:54:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462819",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,11 @@
 
 [https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)
 
-We fix those tests.
+This is the case because debian bullseye uses pari 2.11.3 (instead of pari 2.11.3). Many instances seem to fail, just because the choice of generators has changed. However, there is at least one thing really strange when upgrading to pari 2.11.3:
 
-Sage currently installs pari 2.11.2 (if nothing suitable is found), but debian bullseye has 2.11.3.
+```
+sage: y = var('y')
+sage: pK = pari.bnfinit(y^3+3)
+sage: pK.bnfisunit(pK.bnfunit()[0])
+[1, Mod(1, 2)]~
+```
``````




---

archive/issue_comments_462820.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nMaybe cypari 2.1.1 just cannot deal with pari 2.11.3, but maybe there is also a bug in pari 2.11.3.",
    "created_at": "2020-04-02T14:54:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462820",
    "user": "https://github.com/kliem"
}
```

<div id="comment:5" align="right">comment:5</div>

Maybe cypari 2.1.1 just cannot deal with pari 2.11.3, but maybe there is also a bug in pari 2.11.3.



---

archive/issue_comments_462821.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nBefore I forget,\n\nthis also looks serious\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 5357, in sage.rings.number_field.number_field.NumberField_generic.elements_of_norm\nFailed example:\n    K.elements_of_norm(7)\nExpected:\n    [7/225*a^2 - 7/75*a - 42/25]\nGot:\n    [28/225*a^2 + 77/75*a - 133/25]\n```\n\nI don't think this element has norm `7` in `K.<a> = NumberField(7/9*x^3 + 7/3*x^2 - 56*x + 123)`.",
    "created_at": "2020-04-02T17:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462821",
    "user": "https://github.com/kliem"
}
```

<div id="comment:6" align="right">comment:6</div>

Before I forget,

this also looks serious

```
File "src/sage/rings/number_field/number_field.py", line 5357, in sage.rings.number_field.number_field.NumberField_generic.elements_of_norm
Failed example:
    K.elements_of_norm(7)
Expected:
    [7/225*a^2 - 7/75*a - 42/25]
Got:
    [28/225*a^2 + 77/75*a - 133/25]
```

I don't think this element has norm `7` in `K.<a> = NumberField(7/9*x^3 + 7/3*x^2 - 56*x + 123)`.



---

archive/issue_comments_462822.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\npari 2.11.3 is broken, see #29313. The test in the previous comment is ok though, both elements have norm 7.",
    "created_at": "2020-04-02T20:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462822",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:7" align="right">comment:7</div>

pari 2.11.3 is broken, see #29313. The test in the previous comment is ok though, both elements have norm 7.



---

archive/issue_comments_462823.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOk, I'm stupid. I redifined `a` and than parsed `28/225*a^2 + 77/75*a - 133/25`. This did of course produce nonsense.\n\nSo what do we do. Reject pari 2.11.3 from system until this is fixed?\n\nReplying to [@antonio-rojas](#comment:7):\n> pari 2.11.3 is broken, see #29313. The test in the previous comment is ok though, both elements have norm 7.",
    "created_at": "2020-04-03T05:32:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462823",
    "user": "https://github.com/kliem"
}
```

<div id="comment:8" align="right">comment:8</div>

Ok, I'm stupid. I redifined `a` and than parsed `28/225*a^2 + 77/75*a - 133/25`. This did of course produce nonsense.

So what do we do. Reject pari 2.11.3 from system until this is fixed?

Replying to [@antonio-rojas](#comment:7):
> pari 2.11.3 is broken, see #29313. The test in the previous comment is ok though, both elements have norm 7.



---

archive/issue_comments_462824.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@kliem](#comment:8):\n\n> So what do we do. Reject pari 2.11.3 from system until this is fixed?\n\nYes, IMO that's what we should do - unpatched 2.11.3 gives incorrect answers which is not acceptable.",
    "created_at": "2020-04-03T09:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462824",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@kliem](#comment:8):

> So what do we do. Reject pari 2.11.3 from system until this is fixed?

Yes, IMO that's what we should do - unpatched 2.11.3 gives incorrect answers which is not acceptable.



---

archive/issue_events_405005.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T10:16:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405005"
}
```



---

archive/issue_events_405006.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T10:16:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405006"
}
```



---

archive/issue_comments_462825.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nDevil's advocate: we shouldn't be in the business of detecting system versions down to the backported-commit-patch level. Distros should be in charge of not shipping broken software to their users, who probably don't want to be using a PARI that gives the wrong answer outside of Sage, either. If people hit this, they should complain to their distro to either backport the patch or mask the busted version.",
    "created_at": "2020-04-03T10:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462825",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:12" align="right">comment:12</div>

Devil's advocate: we shouldn't be in the business of detecting system versions down to the backported-commit-patch level. Distros should be in charge of not shipping broken software to their users, who probably don't want to be using a PARI that gives the wrong answer outside of Sage, either. If people hit this, they should complain to their distro to either backport the patch or mask the busted version.



---

archive/issue_comments_462826.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nspkg-configure is exactly this business, by definition\n\nBut it shouldn't detect versions. It should detect absence of known bugs.",
    "created_at": "2020-04-03T11:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462826",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

spkg-configure is exactly this business, by definition

But it shouldn't detect versions. It should detect absence of known bugs.



---

archive/issue_comments_462827.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAs far as I understand, the patch in the branch #29313 also includes a small doctest.\n\nCan we include this in spkg-configure?\n\nThis is probably wrong syntax, but something like this might work:\n\n```\n    AC_MSG_CHECKING([does pari have known bug? ])\n    bug_check=`echo \"bnf = bnfinit(y^4-y-1); bnfisunit(bnf,-y^3+2*y^2-1)\" | $GP -qf 2>> config.log`\n    expected=\"[0, 2, Mod(0, 2)]~\"\n    if test x$bug_check=x$expected; then\n        AC_MSG_RESULT([no])\n    else\n        AC_MSG_RESULT([yes; cannot use system pari/GP with known bug])\n        AC_MSG_NOTICE([Patch/upgrade yoour package and reconfigure.])\n        AC_MSG_NOTICE([Otherwise Sage will build its own pari/GP.])\n        sage_spkg_install_pari=yes\n    fi\n```",
    "created_at": "2020-04-03T15:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462827",
    "user": "https://github.com/kliem"
}
```

<div id="comment:14" align="right">comment:14</div>

As far as I understand, the patch in the branch #29313 also includes a small doctest.

Can we include this in spkg-configure?

This is probably wrong syntax, but something like this might work:

```
    AC_MSG_CHECKING([does pari have known bug? ])
    bug_check=`echo "bnf = bnfinit(y^4-y-1); bnfisunit(bnf,-y^3+2*y^2-1)" | $GP -qf 2>> config.log`
    expected="[0, 2, Mod(0, 2)]~"
    if test x$bug_check=x$expected; then
        AC_MSG_RESULT([no])
    else
        AC_MSG_RESULT([yes; cannot use system pari/GP with known bug])
        AC_MSG_NOTICE([Patch/upgrade yoour package and reconfigure.])
        AC_MSG_NOTICE([Otherwise Sage will build its own pari/GP.])
        sage_spkg_install_pari=yes
    fi
```



---

archive/issue_comments_462828.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOn the broken pari the output of this is `[0, 2, Mod(1, 2)]~`. On the working pari the output is as above.",
    "created_at": "2020-04-03T15:09:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462828",
    "user": "https://github.com/kliem"
}
```

<div id="comment:15" align="right">comment:15</div>

On the broken pari the output of this is `[0, 2, Mod(1, 2)]~`. On the working pari the output is as above.



---

archive/issue_comments_462829.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nyes, that's the right way to fix it. Careful with the brackets - they are m4 quoting characters",
    "created_at": "2020-04-03T15:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462829",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

yes, that's the right way to fix it. Careful with the brackets - they are m4 quoting characters



---

archive/issue_comments_462830.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nCan you are someone put it in the right place? I can try to, but I'm really guessing here.",
    "created_at": "2020-04-03T15:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462830",
    "user": "https://github.com/kliem"
}
```

<div id="comment:17" align="right">comment:17</div>

Can you are someone put it in the right place? I can try to, but I'm really guessing here.



---

archive/issue_comments_462831.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOK, will do",
    "created_at": "2020-04-03T15:42:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462831",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

OK, will do



---

archive/issue_comments_462832.json:
```json
{
    "body": "Branch: **[u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version)**",
    "created_at": "2020-04-03T17:10:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462832",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version)**



---

archive/issue_comments_462833.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6341dbf62b8726f55080bc2198f3c3c952ba5ff\">f6341db</a></td><td><code>build/pkgs/pari/spkg-configure.m4: Add test for bnfisunit bug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41\">c4a0a22</a></td><td><code>build/pkgs/pari/spkg-configure.m4: Re-enable main PARI test (lost in SAGE_SPKG_CONFIGURE macro change); remove duplicate AC_MSG</code></td></tr></table>\n",
    "created_at": "2020-04-03T17:12:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462833",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6341dbf62b8726f55080bc2198f3c3c952ba5ff">f6341db</a></td><td><code>build/pkgs/pari/spkg-configure.m4: Add test for bnfisunit bug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41">c4a0a22</a></td><td><code>build/pkgs/pari/spkg-configure.m4: Re-enable main PARI test (lost in SAGE_SPKG_CONFIGURE macro change); remove duplicate AC_MSG</code></td></tr></table>




---

archive/issue_comments_462834.json:
```json
{
    "body": "Commit: **[c4a0a22](https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41)**",
    "created_at": "2020-04-03T17:12:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462834",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[c4a0a22](https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41)**



---

archive/issue_comments_462835.json:
```json
{
    "body": "Author: **Jonathan Kliem, Matthias Koeppe**",
    "created_at": "2020-04-03T17:12:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462835",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Jonathan Kliem, Matthias Koeppe**



---

archive/issue_events_405007.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T17:12:47Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "title_is": "Reject broken system PARI 2.11.3",
    "title_was": "Fix failing doctests because of representation depending on PARI version",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405007"
}
```



---

archive/issue_events_405008.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T17:13:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405008"
}
```



---

archive/issue_events_405009.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T17:13:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405009"
}
```



---

archive/issue_events_405010.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-03T17:13:57Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "title_is": "Reject broken system PARI 2.11.3 and re-enable PARI library test in spkg-configure",
    "title_was": "Reject broken system PARI 2.11.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405010"
}
```



---

archive/issue_comments_462836.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n@mkoeppe: Thanks. Should I start a github workflow? Are you already doing it?",
    "created_at": "2020-04-03T17:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462836",
    "user": "https://github.com/kliem"
}
```

<div id="comment:24" align="right">comment:24</div>

@mkoeppe: Thanks. Should I start a github workflow? Are you already doing it?



---

archive/issue_comments_462837.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nPlease do. #29417 has the latest version",
    "created_at": "2020-04-03T17:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462837",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Please do. #29417 has the latest version



---

archive/issue_comments_462838.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nWhat about the original aim of this ticket (make tests pass regardless of the system pari version)? When using a patched 2.11.3 you'd still get many doctest failures (but correct nevertheless)",
    "created_at": "2020-04-03T17:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462838",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:26" align="right">comment:26</div>

What about the original aim of this ticket (make tests pass regardless of the system pari version)? When using a patched 2.11.3 you'd still get many doctest failures (but correct nevertheless)



---

archive/issue_comments_462839.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nShould probably be taken care of in the same ticket",
    "created_at": "2020-04-03T17:40:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462839",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Should probably be taken care of in the same ticket



---

archive/issue_comments_462840.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI would wait and see.\n\nI'm still willing to change the doctests such that both pari versions work, but I guess on a new ticket once this problem occurs.\n\n(I also wasn't sure how many of those things would disappear once this is patched, e.g. the +/- failures.)",
    "created_at": "2020-04-03T17:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462840",
    "user": "https://github.com/kliem"
}
```

<div id="comment:28" align="right">comment:28</div>

I would wait and see.

I'm still willing to change the doctests such that both pari versions work, but I guess on a new ticket once this problem occurs.

(I also wasn't sure how many of those things would disappear once this is patched, e.g. the +/- failures.)



---

archive/issue_comments_462841.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nYou can see the exact failures in the patch for #29313 (but that patch only changes them to the 2.11.3 answer, so they would fail with <2.11.3)",
    "created_at": "2020-04-03T17:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462841",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:29" align="right">comment:29</div>

You can see the exact failures in the patch for #29313 (but that patch only changes them to the 2.11.3 answer, so they would fail with <2.11.3)



---

archive/issue_comments_462842.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nOk, seems to work\n\n[https://github.com/kliem/sage-test-27122/actions](https://github.com/kliem/sage-test-27122/actions)\n\nSpecifically for debian bulleye standard it detects the bug and doesn't use system pari (and those failures are gone).\nFor debian buster it checks for the bug and detects that the system pari is fine to use.",
    "created_at": "2020-04-04T05:41:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462842",
    "user": "https://github.com/kliem"
}
```

<div id="comment:30" align="right">comment:30</div>

Ok, seems to work

[https://github.com/kliem/sage-test-27122/actions](https://github.com/kliem/sage-test-27122/actions)

Specifically for debian bulleye standard it detects the bug and doesn't use system pari (and those failures are gone).
For debian buster it checks for the bug and detects that the system pari is fine to use.



---

archive/issue_comments_462843.json:
```json
{
    "body": "Reviewer: **Jonathan Kliem**",
    "created_at": "2020-04-04T13:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462843",
    "user": "https://github.com/kliem"
}
```

Reviewer: **Jonathan Kliem**



---

archive/issue_comments_462844.json:
```json
{
    "body": "Changed reviewer from **Jonathan Kliem** to **Matthias Koeppe, Jonathan Kliem**",
    "created_at": "2020-04-04T14:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462844",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Jonathan Kliem** to **Matthias Koeppe, Jonathan Kliem**



---

archive/issue_events_405011.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-04T14:01:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405011"
}
```



---

archive/issue_events_405012.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-04T14:01:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405012"
}
```



---

archive/issue_comments_462845.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version)** to **[c4a0a22](https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41)**",
    "created_at": "2020-04-09T22:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462845",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version)** to **[c4a0a22](https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41)**



---

archive/issue_events_405013.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-09T22:45:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405013"
}
```



---

archive/issue_events_405014.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f3631bbfd7b02809e3ee8b39308cce2c3ec1f66c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-04-09T22:45:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/29445#event-405014"
}
```



---

archive/issue_comments_462846.json:
```json
{
    "body": "Changed commit from **[c4a0a22](https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41)** to none",
    "created_at": "2020-04-23T10:27:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462846",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[c4a0a22](https://github.com/sagemath/sagetrac-mirror/commit/c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41)** to none



---

archive/issue_comments_462847.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nit is a buggy test\n\n```\nconfigure:17249: checking whether hyperellcharpoly bug is fixed\n  ***   too many arguments: ...lcharpoly(x^10+x^9+x^8+x,0*Mod(1,3))\n  ***                                                   ^-----------\nconfigure:17257: result: no; cannot use system pari/GP with known bug\n\n```\n\nDon't mix up `AS_IF` and shell `if` :-(\n\nSee #29554 for a fix",
    "created_at": "2020-04-23T10:27:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/29445#issuecomment-462847",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">comment:34</div>

it is a buggy test

```
configure:17249: checking whether hyperellcharpoly bug is fixed
  ***   too many arguments: ...lcharpoly(x^10+x^9+x^8+x,0*Mod(1,3))
  ***                                                   ^-----------
configure:17257: result: no; cannot use system pari/GP with known bug

```

Don't mix up `AS_IF` and shell `if` :-(

See #29554 for a fix
