# Issue 29445: Reject broken system PARI 2.11.3 and re-enable PARI library test in spkg-configure

archive/issues_029208.json:
```json
{
    "body": "There are several failing doctests depending on the PARI version of the system, e.g.\n\n```\nFile \"src/sage/rings/number_field/number_field_ideal.py\", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor\nFailed example:\n    fact = F.factor(2); fact\nExpected:\n    (Fractional ideal (2*a^2 + 1))^2 * (Fractional ideal (-2*a^2))\nGot:\n    (Fractional ideal (-2*a^2 - 1))^2 * (Fractional ideal (2*a^2))\n```\n\nsee e.g.\n\n[https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)\n\nThis is the case because debian bullseye uses pari 2.11.3 (instead of pari 2.11.3). Many instances seem to fail, just because the choice of generators has changed. However, there is at least one thing really strange when upgrading to pari 2.11.3:\n\n```\nsage: y = var('y')\nsage: pK = pari.bnfinit(y^3+3)\nsage: pK.bnfisunit(pK.bnfunit()[0])\n[1, Mod(1, 2)]~\n```\n\nCC:  @mkoeppe @jdemeyer @orlitzky @dimpase\n\nKeywords: PARI, number fields\n\nReviewer: Matthias Koeppe, Jonathan Kliem\n\nAuthor: Jonathan Kliem, Matthias Koeppe\n\nBranch: c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29445\n\n",
    "closed_at": "2020-04-09T22:45:05Z",
    "created_at": "2020-04-01T16:46:46Z",
    "labels": [
        "component: number fields",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Reject broken system PARI 2.11.3 and re-enable PARI library test in spkg-configure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29445",
    "user": "https://github.com/kliem"
}
```
There are several failing doctests depending on the PARI version of the system, e.g.

```
File "src/sage/rings/number_field/number_field_ideal.py", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor
Failed example:
    fact = F.factor(2); fact
Expected:
    (Fractional ideal (2*a^2 + 1))^2 * (Fractional ideal (-2*a^2))
Got:
    (Fractional ideal (-2*a^2 - 1))^2 * (Fractional ideal (2*a^2))
```

see e.g.

[https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)

This is the case because debian bullseye uses pari 2.11.3 (instead of pari 2.11.3). Many instances seem to fail, just because the choice of generators has changed. However, there is at least one thing really strange when upgrading to pari 2.11.3:

```
sage: y = var('y')
sage: pK = pari.bnfinit(y^3+3)
sage: pK.bnfisunit(pK.bnfunit()[0])
[1, Mod(1, 2)]~
```

CC:  @mkoeppe @jdemeyer @orlitzky @dimpase

Keywords: PARI, number fields

Reviewer: Matthias Koeppe, Jonathan Kliem

Author: Jonathan Kliem, Matthias Koeppe

Branch: c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29445





---

archive/issue_comments_575219.json:
```json
{
    "body": "<a id='comment:1'></a>The following tests currently fail (depending on the PARI version):\n\n```\nsage -t src/sage/rings/number_field/number_field.py\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field.py\", line 3426, in sage.rings.number_field.number_field.NumberField_generic.ideals_of_bdd_norm\nFailed example:\n    for n in d:\n        print(n)\n        for I in d[n]:\n            print(I)\nExpected:\n    1\n    Fractional ideal (1)\n    2\n    Fractional ideal (2, 1/2*a - 1/2)\n    Fractional ideal (2, 1/2*a + 1/2)\n    3\n    Fractional ideal (3, 1/2*a - 1/2)\n    Fractional ideal (3, 1/2*a + 1/2)\n    4\n...\nGot:\n    1\n    Fractional ideal (1)\n    2\n    Fractional ideal (2, 1/2*a - 1/2)\n    Fractional ideal (2, 1/2*a + 1/2)\n    3\n    Fractional ideal (3, 1/2*a + 1/2)\n    Fractional ideal (3, 1/2*a - 1/2)\n...\n```\n\n```\n File \"src/sage/rings/number_field/number_field.py\", line 4547, in sage.rings.number_field.number_field.NumberField_generic._S_class_group_and_units\nFailed example:\n    K._S_class_group_and_units(tuple(K.primes_above(13)))\nExpected:\n    ([2/13*a^2 + 1/13*a - 677/13,\n      1/13*a^2 + 7/13*a - 332/13,\n      -1/13*a^2 + 6/13*a + 345/13,\n      -1,\n      2/13*a^2 + 1/13*a - 755/13,\n      1/13*a^2 - 19/13*a - 7/13],\n     [(Fractional ideal (11, a - 2), 2), (Fractional ideal (19, a + 7), 2)])\nGot:\n    ([2/13*a^2 + 1/13*a - 677/13,\n      1/13*a^2 + 7/13*a - 332/13,\n      -1/13*a^2 + 6/13*a + 345/13,\n      -1,\n      2/13*a^2 + 1/13*a - 755/13,\n      1/13*a^2 + 20/13*a - 7/13],\n     [(Fractional ideal (11, a - 2), 2), (Fractional ideal (19, a + 7), 2)])\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 4705, in sage.rings.number_field.number_field.NumberField_generic.selmer_group\nFailed example:\n    K.selmer_group(K.primes_above(13), 2)\nExpected:\n    [2/13*a^2 + 1/13*a - 677/13,\n     1/13*a^2 + 7/13*a - 332/13,\n     -1/13*a^2 + 6/13*a + 345/13,\n     -1,\n     2/13*a^2 + 1/13*a - 755/13,\n     1/13*a^2 - 19/13*a - 7/13,\n     -1/13*a^2 + 45/13*a - 97/13,\n     2/13*a^2 + 40/13*a - 27/13]\nGot:\n    [2/13*a^2 + 1/13*a - 677/13,\n     1/13*a^2 + 7/13*a - 332/13,\n     -1/13*a^2 + 6/13*a + 345/13,\n     -1,\n     2/13*a^2 + 1/13*a - 755/13,\n     1/13*a^2 + 20/13*a - 7/13,\n     1/13*a^2 - 45/13*a + 97/13,\n     -2/13*a^2 - 40/13*a + 27/13]\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 5357, in sage.rings.number_field.number_field.NumberField_generic.elements_of_norm\nFailed example:\n    K.elements_of_norm(7)\nExpected:\n    [7/225*a^2 - 7/75*a - 42/25]\nGot:\n    [28/225*a^2 + 77/75*a - 133/25]\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 5460, in sage.rings.number_field.number_field.NumberField_generic.factor\nFailed example:\n    f = L.factor(a + 1); f\nExpected:\n    (Fractional ideal (1/2*a*b - a + 1/2)) * (Fractional ideal (-1/2*a*b - a + 1/2))\nGot:\n    (Fractional ideal (-1/2*b + 1/2*a + 1)) * (Fractional ideal (-1/2*a*b - a + 1/2))\n```\n\n```\n File \"src/sage/rings/number_field/number_field.py\", line 6537, in sage.rings.number_field.number_field.NumberField_generic.uniformizer\nFailed example:\n    [K.uniformizer(P) for P,e in factor(K.ideal(7))]\nExpected:\n    [t^2 + 3*t + 1]\nGot:\n    [t^2 - 4*t + 1]\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 6793, in sage.rings.number_field.number_field.NumberField_generic.S_unit_group\nFailed example:\n    U.log(u)\nExpected:\n    (1, 1, 4, 1, 5)\nGot:\n    (0, 1, 4, 1, 5)\n```\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 7803, in sage.rings.number_field.number_field.NumberField_absolute.optimized_representation\nFailed example:\n    K.optimized_representation()\nExpected:\n    (Number Field in a1 with defining polynomial x^3 - 7*x - 7,\n     Ring morphism:\n       From: Number Field in a1 with defining polynomial x^3 - 7*x - 7\n       To:   Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123\n       Defn: a1 |--> 7/225*a^2 - 7/75*a - 42/25,\n     Ring morphism:\n       From: Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123\n       To:   Number Field in a1 with defining polynomial x^3 - 7*x - 7\n       Defn: a |--> -15/7*a1^2 + 9)\nGot:\n    (Number Field in a1 with defining polynomial x^3 - 7*x - 7, Ring morphism:\n       From: Number Field in a1 with defining polynomial x^3 - 7*x - 7\n       To:   Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123\n       Defn: a1 |--> 28/225*a^2 + 77/75*a - 133/25, Ring morphism:\n       From: Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123\n       To:   Number Field in a1 with defining polynomial x^3 - 7*x - 7\n       Defn: a |--> -60/7*a1^2 + 15*a1 + 39)\n```\n\n```\n File \"src/sage/rings/number_field/number_field_ideal.py\", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor\nFailed example:\n    fact = F.factor(2); fact\nExpected:\n    (Fractional ideal (2*a^2 + 1))^2 * (Fractional ideal (-2*a^2))\nGot:\n    (Fractional ideal (-2*a^2 - 1))^2 * (Fractional ideal (2*a^2))\n```\n\n```\n File \"src/sage/rings/number_field/number_field_ideal.py\", line 2420, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.idealcoprime\nFailed example:\n    lam = A.idealcoprime(B); lam\nExpected:\n    -1/6*a + 1/6\nGot:\n    1/6*a - 1/6\n```\n\n```\n File \"src/sage/rings/number_field/unit_group.py\", line 281, in sage.rings.number_field.unit_group.UnitGroup.__init__\nFailed example:\n    UnitGroup(K, S=tuple(K.primes_above(7)))\nExpected:\n    S-unit group with structure C2 x Z x Z x Z of Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123 with S = (Fractional ideal (7/225*a^2 - 7/75*a - 42/25),)\nGot:\n    S-unit group with structure C2 x Z x Z x Z of Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123 with S = (Fractional ideal (28/225*a^2 + 77/75*a - 133/25),)\n```\n\n```\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1284, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_class_group\nFailed example:\n    S.S_class_group([])\nExpected:\n    [((1/4*xbar^2 + 31/4,\n       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,\n       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,\n       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),\n      6),\n      ((-1/4*xbar^2 - 23/4,\n       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,\n       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,\n       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),\n      6),\n     ((-5/4*xbar^2 - 115/4,\n       1/4*a*xbar^2 + 23/4*a,\n       -1/16*xbar^3 - 7/16*xbar^2 - 23/16*xbar - 161/16,\n       1/16*a*xbar^3 - 1/16*a*xbar^2 + 23/16*a*xbar - 23/16*a),\n      2)]\nGot:\n     [((1/4*xbar^2 + 31/4,\n       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,\n       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,\n       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),\n      6),\n     ((-1/4*xbar^2 - 23/4,\n       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,\n       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,\n       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),\n      6),\n     ((-5/4*xbar^2 - 115/4,\n       (1/8*a - 5/8)*xbar^2 + 23/8*a - 115/8,\n       -1/16*xbar^3 - 17/16*xbar^2 - 23/16*xbar - 391/16,\n       1/16*a*xbar^3 + (-1/16*a - 5/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 115/8),\n      2)]\n```\n\n```\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1416, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.class_group\nFailed example:\n    S.class_group()\nExpected:\n    [((1/4*xbar^2 + 31/4,\n       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,\n       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,\n       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),\n      6),\n     ((-1/4*xbar^2 - 23/4,\n       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,\n       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,\n       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),\n      6),\n     ((-5/4*xbar^2 - 115/4,\n       1/4*a*xbar^2 + 23/4*a,\n       -1/16*xbar^3 - 7/16*xbar^2 - 23/16*xbar - 161/16,\n       1/16*a*xbar^3 - 1/16*a*xbar^2 + 23/16*a*xbar - 23/16*a),\n      2)]\nGot:\n    [((1/4*xbar^2 + 31/4,\n       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,\n       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,\n       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),\n      6),\n     ((-1/4*xbar^2 - 23/4,\n       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,\n       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,\n       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),\n      6),\n     ((-5/4*xbar^2 - 115/4,\n       (1/8*a - 5/8)*xbar^2 + 23/8*a - 115/8,\n       -1/16*xbar^3 - 17/16*xbar^2 - 23/16*xbar - 391/16,\n       1/16*a*xbar^3 + (-1/16*a - 5/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 115/8),\n      2)]\n```\n\nThere are some other tests that seem PARI related, e.g.\n\n```\nFile \"src/sage/lfunctions/dokchitser.py\", line 112, in sage.lfunctions.dokchitser.Dokchitser\nFailed example:\n    L.check_functional_equation()\nExpected:\n    6.04442711160669e-18                            \nGot:\n    6.11218974738703e-18\n```\n\nand\n\n```\n File \"src/sage/lfunctions/dokchitser.py\", line 671, in sage.lfunctions.dokchitser.Dokchitser.check_functional_equation\nFailed example:\n    L.check_functional_equation()\nExpected:\n    -2.71050543121376e-20                        \nGot:\n    -1.35525271560688e-20\n```\n\n```\nFile \"src/sage/lfunctions/pari.py\", line 425, in sage.lfunctions.pari.LFunction\nFailed example:\n    L.check_functional_equation()\nExpected:\n    1.08420217248550e-19\nGot:\n    4.33680868994202e-19\n```\n\nThose tests could be repaired by just checking that the numerical noise is reasonable.",
    "created_at": "2020-04-01T20:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575219",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>The following tests currently fail (depending on the PARI version):

```
sage -t src/sage/rings/number_field/number_field.py
**********************************************************************
File "src/sage/rings/number_field/number_field.py", line 3426, in sage.rings.number_field.number_field.NumberField_generic.ideals_of_bdd_norm
Failed example:
    for n in d:
        print(n)
        for I in d[n]:
            print(I)
Expected:
    1
    Fractional ideal (1)
    2
    Fractional ideal (2, 1/2*a - 1/2)
    Fractional ideal (2, 1/2*a + 1/2)
    3
    Fractional ideal (3, 1/2*a - 1/2)
    Fractional ideal (3, 1/2*a + 1/2)
    4
...
Got:
    1
    Fractional ideal (1)
    2
    Fractional ideal (2, 1/2*a - 1/2)
    Fractional ideal (2, 1/2*a + 1/2)
    3
    Fractional ideal (3, 1/2*a + 1/2)
    Fractional ideal (3, 1/2*a - 1/2)
...
```

```
 File "src/sage/rings/number_field/number_field.py", line 4547, in sage.rings.number_field.number_field.NumberField_generic._S_class_group_and_units
Failed example:
    K._S_class_group_and_units(tuple(K.primes_above(13)))
Expected:
    ([2/13*a^2 + 1/13*a - 677/13,
      1/13*a^2 + 7/13*a - 332/13,
      -1/13*a^2 + 6/13*a + 345/13,
      -1,
      2/13*a^2 + 1/13*a - 755/13,
      1/13*a^2 - 19/13*a - 7/13],
     [(Fractional ideal (11, a - 2), 2), (Fractional ideal (19, a + 7), 2)])
Got:
    ([2/13*a^2 + 1/13*a - 677/13,
      1/13*a^2 + 7/13*a - 332/13,
      -1/13*a^2 + 6/13*a + 345/13,
      -1,
      2/13*a^2 + 1/13*a - 755/13,
      1/13*a^2 + 20/13*a - 7/13],
     [(Fractional ideal (11, a - 2), 2), (Fractional ideal (19, a + 7), 2)])
```

```
File "src/sage/rings/number_field/number_field.py", line 4705, in sage.rings.number_field.number_field.NumberField_generic.selmer_group
Failed example:
    K.selmer_group(K.primes_above(13), 2)
Expected:
    [2/13*a^2 + 1/13*a - 677/13,
     1/13*a^2 + 7/13*a - 332/13,
     -1/13*a^2 + 6/13*a + 345/13,
     -1,
     2/13*a^2 + 1/13*a - 755/13,
     1/13*a^2 - 19/13*a - 7/13,
     -1/13*a^2 + 45/13*a - 97/13,
     2/13*a^2 + 40/13*a - 27/13]
Got:
    [2/13*a^2 + 1/13*a - 677/13,
     1/13*a^2 + 7/13*a - 332/13,
     -1/13*a^2 + 6/13*a + 345/13,
     -1,
     2/13*a^2 + 1/13*a - 755/13,
     1/13*a^2 + 20/13*a - 7/13,
     1/13*a^2 - 45/13*a + 97/13,
     -2/13*a^2 - 40/13*a + 27/13]
```

```
File "src/sage/rings/number_field/number_field.py", line 5357, in sage.rings.number_field.number_field.NumberField_generic.elements_of_norm
Failed example:
    K.elements_of_norm(7)
Expected:
    [7/225*a^2 - 7/75*a - 42/25]
Got:
    [28/225*a^2 + 77/75*a - 133/25]
```

```
File "src/sage/rings/number_field/number_field.py", line 5460, in sage.rings.number_field.number_field.NumberField_generic.factor
Failed example:
    f = L.factor(a + 1); f
Expected:
    (Fractional ideal (1/2*a*b - a + 1/2)) * (Fractional ideal (-1/2*a*b - a + 1/2))
Got:
    (Fractional ideal (-1/2*b + 1/2*a + 1)) * (Fractional ideal (-1/2*a*b - a + 1/2))
```

```
 File "src/sage/rings/number_field/number_field.py", line 6537, in sage.rings.number_field.number_field.NumberField_generic.uniformizer
Failed example:
    [K.uniformizer(P) for P,e in factor(K.ideal(7))]
Expected:
    [t^2 + 3*t + 1]
Got:
    [t^2 - 4*t + 1]
```

```
File "src/sage/rings/number_field/number_field.py", line 6793, in sage.rings.number_field.number_field.NumberField_generic.S_unit_group
Failed example:
    U.log(u)
Expected:
    (1, 1, 4, 1, 5)
Got:
    (0, 1, 4, 1, 5)
```

```
File "src/sage/rings/number_field/number_field.py", line 7803, in sage.rings.number_field.number_field.NumberField_absolute.optimized_representation
Failed example:
    K.optimized_representation()
Expected:
    (Number Field in a1 with defining polynomial x^3 - 7*x - 7,
     Ring morphism:
       From: Number Field in a1 with defining polynomial x^3 - 7*x - 7
       To:   Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123
       Defn: a1 |--> 7/225*a^2 - 7/75*a - 42/25,
     Ring morphism:
       From: Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123
       To:   Number Field in a1 with defining polynomial x^3 - 7*x - 7
       Defn: a |--> -15/7*a1^2 + 9)
Got:
    (Number Field in a1 with defining polynomial x^3 - 7*x - 7, Ring morphism:
       From: Number Field in a1 with defining polynomial x^3 - 7*x - 7
       To:   Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123
       Defn: a1 |--> 28/225*a^2 + 77/75*a - 133/25, Ring morphism:
       From: Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123
       To:   Number Field in a1 with defining polynomial x^3 - 7*x - 7
       Defn: a |--> -60/7*a1^2 + 15*a1 + 39)
```

```
 File "src/sage/rings/number_field/number_field_ideal.py", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor
Failed example:
    fact = F.factor(2); fact
Expected:
    (Fractional ideal (2*a^2 + 1))^2 * (Fractional ideal (-2*a^2))
Got:
    (Fractional ideal (-2*a^2 - 1))^2 * (Fractional ideal (2*a^2))
```

```
 File "src/sage/rings/number_field/number_field_ideal.py", line 2420, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.idealcoprime
Failed example:
    lam = A.idealcoprime(B); lam
Expected:
    -1/6*a + 1/6
Got:
    1/6*a - 1/6
```

```
 File "src/sage/rings/number_field/unit_group.py", line 281, in sage.rings.number_field.unit_group.UnitGroup.__init__
Failed example:
    UnitGroup(K, S=tuple(K.primes_above(7)))
Expected:
    S-unit group with structure C2 x Z x Z x Z of Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123 with S = (Fractional ideal (7/225*a^2 - 7/75*a - 42/25),)
Got:
    S-unit group with structure C2 x Z x Z x Z of Number Field in a with defining polynomial 7/9*x^3 + 7/3*x^2 - 56*x + 123 with S = (Fractional ideal (28/225*a^2 + 77/75*a - 133/25),)
```

```
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1284, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_class_group
Failed example:
    S.S_class_group([])
Expected:
    [((1/4*xbar^2 + 31/4,
       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,
       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,
       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),
      6),
      ((-1/4*xbar^2 - 23/4,
       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,
       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,
       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),
      6),
     ((-5/4*xbar^2 - 115/4,
       1/4*a*xbar^2 + 23/4*a,
       -1/16*xbar^3 - 7/16*xbar^2 - 23/16*xbar - 161/16,
       1/16*a*xbar^3 - 1/16*a*xbar^2 + 23/16*a*xbar - 23/16*a),
      2)]
Got:
     [((1/4*xbar^2 + 31/4,
       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,
       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,
       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),
      6),
     ((-1/4*xbar^2 - 23/4,
       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,
       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,
       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),
      6),
     ((-5/4*xbar^2 - 115/4,
       (1/8*a - 5/8)*xbar^2 + 23/8*a - 115/8,
       -1/16*xbar^3 - 17/16*xbar^2 - 23/16*xbar - 391/16,
       1/16*a*xbar^3 + (-1/16*a - 5/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 115/8),
      2)]
```

```
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1416, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.class_group
Failed example:
    S.class_group()
Expected:
    [((1/4*xbar^2 + 31/4,
       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,
       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,
       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),
      6),
     ((-1/4*xbar^2 - 23/4,
       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,
       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,
       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),
      6),
     ((-5/4*xbar^2 - 115/4,
       1/4*a*xbar^2 + 23/4*a,
       -1/16*xbar^3 - 7/16*xbar^2 - 23/16*xbar - 161/16,
       1/16*a*xbar^3 - 1/16*a*xbar^2 + 23/16*a*xbar - 23/16*a),
      2)]
Got:
    [((1/4*xbar^2 + 31/4,
       (-1/8*a + 1/8)*xbar^2 - 31/8*a + 31/8,
       1/16*xbar^3 + 1/16*xbar^2 + 31/16*xbar + 31/16,
       -1/16*a*xbar^3 + (1/16*a + 1/8)*xbar^2 - 31/16*a*xbar + 31/16*a + 31/8),
      6),
     ((-1/4*xbar^2 - 23/4,
       (1/8*a - 1/8)*xbar^2 + 23/8*a - 23/8,
       -1/16*xbar^3 - 1/16*xbar^2 - 23/16*xbar - 23/16,
       1/16*a*xbar^3 + (-1/16*a - 1/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 23/8),
      6),
     ((-5/4*xbar^2 - 115/4,
       (1/8*a - 5/8)*xbar^2 + 23/8*a - 115/8,
       -1/16*xbar^3 - 17/16*xbar^2 - 23/16*xbar - 391/16,
       1/16*a*xbar^3 + (-1/16*a - 5/8)*xbar^2 + 23/16*a*xbar - 23/16*a - 115/8),
      2)]
```

There are some other tests that seem PARI related, e.g.

```
File "src/sage/lfunctions/dokchitser.py", line 112, in sage.lfunctions.dokchitser.Dokchitser
Failed example:
    L.check_functional_equation()
Expected:
    6.04442711160669e-18                            
Got:
    6.11218974738703e-18
```

and

```
 File "src/sage/lfunctions/dokchitser.py", line 671, in sage.lfunctions.dokchitser.Dokchitser.check_functional_equation
Failed example:
    L.check_functional_equation()
Expected:
    -2.71050543121376e-20                        
Got:
    -1.35525271560688e-20
```

```
File "src/sage/lfunctions/pari.py", line 425, in sage.lfunctions.pari.LFunction
Failed example:
    L.check_functional_equation()
Expected:
    1.08420217248550e-19
Got:
    4.33680868994202e-19
```

Those tests could be repaired by just checking that the numerical noise is reasonable.



---

archive/issue_comments_575220.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-There are several failing doctests depending on the PARI version of the system, see e.g.\n+There are several failing doctests depending on the PARI version of the system, e.g.\n \n ```\n File \"src/sage/rings/number_field/number_field_ideal.py\", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor\n@@ -15,3 +15,5 @@\n [https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)\n \n We fix those tests.\n+\n+Sage currently installs pari 2.11.2 (if nothing suitable is found), but debian bullseye has 2.11.3.\n``````\n",
    "created_at": "2020-04-02T09:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575220",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-There are several failing doctests depending on the PARI version of the system, see e.g.
+There are several failing doctests depending on the PARI version of the system, e.g.
 
 ```
 File "src/sage/rings/number_field/number_field_ideal.py", line 1829, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.factor
@@ -15,3 +15,5 @@
 [https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)
 
 We fix those tests.
+
+Sage currently installs pari 2.11.2 (if nothing suitable is found), but debian bullseye has 2.11.3.
``````




---

archive/issue_comments_575221.json:
```json
{
    "body": "<a id='comment:3'></a>I have upgraded to pari 2.11.3 and that reproduces the problems. So I confirm that this is the problem.",
    "created_at": "2020-04-02T09:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575221",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>I have upgraded to pari 2.11.3 and that reproduces the problems. So I confirm that this is the problem.



---

archive/issue_comments_575222.json:
```json
{
    "body": "<a id='comment:4'></a>Something seems to be messed up when installing PARI 2.11.3\n\n```\nsage: y = var('y')\nsage: pK = pari.bnfinit(y^3+3)\nsage: pK.bnfisunit(pK.bnfunit()[0])\n[1, Mod(1, 2)]~\n```\n\nBut the expected output is `[1, Mod(0, 2)]`.",
    "created_at": "2020-04-02T14:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575222",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>Something seems to be messed up when installing PARI 2.11.3

```
sage: y = var('y')
sage: pK = pari.bnfinit(y^3+3)
sage: pK.bnfisunit(pK.bnfunit()[0])
[1, Mod(1, 2)]~
```

But the expected output is `[1, Mod(0, 2)]`.



---

archive/issue_comments_575223.json:
```json
{
    "body": "Changing author from \"Jonathan Kliem\" to \"\"",
    "created_at": "2020-04-02T14:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575223",
    "user": "https://github.com/kliem"
}
```

Changing author from "Jonathan Kliem" to ""



---

archive/issue_comments_575224.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2020-04-02T14:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575224",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_575225.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,11 @@\n \n [https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)\n \n-We fix those tests.\n+This is the case because debian bullseye uses pari 2.11.3 (instead of pari 2.11.3). Many instances seem to fail, just because the choice of generators has changed. However, there is at least one thing really strange when upgrading to pari 2.11.3:\n \n-Sage currently installs pari 2.11.2 (if nothing suitable is found), but debian bullseye has 2.11.3.\n+```\n+sage: y = var('y')\n+sage: pK = pari.bnfinit(y^3+3)\n+sage: pK.bnfisunit(pK.bnfunit()[0])\n+[1, Mod(1, 2)]~\n+```\n``````\n",
    "created_at": "2020-04-02T14:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575225",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,11 @@
 
 [https://github.com/mkoeppe/sage/runs/542655863](https://github.com/mkoeppe/sage/runs/542655863)
 
-We fix those tests.
+This is the case because debian bullseye uses pari 2.11.3 (instead of pari 2.11.3). Many instances seem to fail, just because the choice of generators has changed. However, there is at least one thing really strange when upgrading to pari 2.11.3:
 
-Sage currently installs pari 2.11.2 (if nothing suitable is found), but debian bullseye has 2.11.3.
+```
+sage: y = var('y')
+sage: pK = pari.bnfinit(y^3+3)
+sage: pK.bnfisunit(pK.bnfunit()[0])
+[1, Mod(1, 2)]~
+```
``````




---

archive/issue_comments_575226.json:
```json
{
    "body": "<a id='comment:5'></a>Maybe cypari 2.1.1 just cannot deal with pari 2.11.3, but maybe there is also a bug in pari 2.11.3.",
    "created_at": "2020-04-02T14:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575226",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>Maybe cypari 2.1.1 just cannot deal with pari 2.11.3, but maybe there is also a bug in pari 2.11.3.



---

archive/issue_comments_575227.json:
```json
{
    "body": "<a id='comment:6'></a>Before I forget,\n\nthis also looks serious\n\n```\nFile \"src/sage/rings/number_field/number_field.py\", line 5357, in sage.rings.number_field.number_field.NumberField_generic.elements_of_norm\nFailed example:\n    K.elements_of_norm(7)\nExpected:\n    [7/225*a^2 - 7/75*a - 42/25]\nGot:\n    [28/225*a^2 + 77/75*a - 133/25]\n```\n\nI don't think this element has norm `7` in `K.<a> = NumberField(7/9*x^3 + 7/3*x^2 - 56*x + 123)`.",
    "created_at": "2020-04-02T17:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575227",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>Before I forget,

this also looks serious

```
File "src/sage/rings/number_field/number_field.py", line 5357, in sage.rings.number_field.number_field.NumberField_generic.elements_of_norm
Failed example:
    K.elements_of_norm(7)
Expected:
    [7/225*a^2 - 7/75*a - 42/25]
Got:
    [28/225*a^2 + 77/75*a - 133/25]
```

I don't think this element has norm `7` in `K.<a> = NumberField(7/9*x^3 + 7/3*x^2 - 56*x + 123)`.



---

archive/issue_comments_575228.json:
```json
{
    "body": "<a id='comment:7'></a>pari 2.11.3 is broken, see #29313. The test in the previous comment is ok though, both elements have norm 7.",
    "created_at": "2020-04-02T20:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575228",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:7'></a>pari 2.11.3 is broken, see #29313. The test in the previous comment is ok though, both elements have norm 7.



---

archive/issue_comments_575229.json:
```json
{
    "body": "<a id='comment:8'></a>Ok, I'm stupid. I redifined `a` and than parsed `28/225*a^2 + 77/75*a - 133/25`. This did of course produce nonsense.\n\nSo what do we do. Reject pari 2.11.3 from system until this is fixed?\n\nReplying to [comment:7 arojas]:\n> pari 2.11.3 is broken, see #29313. The test in the previous comment is ok though, both elements have norm 7.",
    "created_at": "2020-04-03T05:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575229",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>Ok, I'm stupid. I redifined `a` and than parsed `28/225*a^2 + 77/75*a - 133/25`. This did of course produce nonsense.

So what do we do. Reject pari 2.11.3 from system until this is fixed?

Replying to [comment:7 arojas]:
> pari 2.11.3 is broken, see #29313. The test in the previous comment is ok though, both elements have norm 7.



---

archive/issue_comments_575230.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 gh-kliem]:\n\n> So what do we do. Reject pari 2.11.3 from system until this is fixed?\n\n\nYes, IMO that's what we should do - unpatched 2.11.3 gives incorrect answers which is not acceptable.",
    "created_at": "2020-04-03T09:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575230",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:9'></a>Replying to [comment:8 gh-kliem]:

> So what do we do. Reject pari 2.11.3 from system until this is fixed?


Yes, IMO that's what we should do - unpatched 2.11.3 gives incorrect answers which is not acceptable.



---

archive/issue_comments_575231.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-04-03T10:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575231",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_575232.json:
```json
{
    "body": "<a id='comment:12'></a>Devil's advocate: we shouldn't be in the business of detecting system versions down to the backported-commit-patch level. Distros should be in charge of not shipping broken software to their users, who probably don't want to be using a PARI that gives the wrong answer outside of Sage, either. If people hit this, they should complain to their distro to either backport the patch or mask the busted version.",
    "created_at": "2020-04-03T10:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575232",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'></a>Devil's advocate: we shouldn't be in the business of detecting system versions down to the backported-commit-patch level. Distros should be in charge of not shipping broken software to their users, who probably don't want to be using a PARI that gives the wrong answer outside of Sage, either. If people hit this, they should complain to their distro to either backport the patch or mask the busted version.



---

archive/issue_comments_575233.json:
```json
{
    "body": "<a id='comment:13'></a>spkg-configure is exactly this business, by definition\n\nBut it shouldn't detect versions. It should detect absence of known bugs.",
    "created_at": "2020-04-03T11:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575233",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>spkg-configure is exactly this business, by definition

But it shouldn't detect versions. It should detect absence of known bugs.



---

archive/issue_comments_575234.json:
```json
{
    "body": "<a id='comment:14'></a>As far as I understand, the patch in the branch #29313 also includes a small doctest.\n\nCan we include this in spkg-configure?\n\nThis is probably wrong syntax, but something like this might work:\n\n```\n    AC_MSG_CHECKING([does pari have known bug? ])\n    bug_check=`echo \"bnf = bnfinit(y^4-y-1); bnfisunit(bnf,-y^3+2*y^2-1)\" | $GP -qf 2>> config.log`\n    expected=\"[0, 2, Mod(0, 2)]~\"\n    if test x$bug_check=x$expected; then\n        AC_MSG_RESULT([no])\n    else\n        AC_MSG_RESULT([yes; cannot use system pari/GP with known bug])\n        AC_MSG_NOTICE([Patch/upgrade yoour package and reconfigure.])\n        AC_MSG_NOTICE([Otherwise Sage will build its own pari/GP.])\n        sage_spkg_install_pari=yes\n    fi\n```",
    "created_at": "2020-04-03T15:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575234",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>As far as I understand, the patch in the branch #29313 also includes a small doctest.

Can we include this in spkg-configure?

This is probably wrong syntax, but something like this might work:

```
    AC_MSG_CHECKING([does pari have known bug? ])
    bug_check=`echo "bnf = bnfinit(y^4-y-1); bnfisunit(bnf,-y^3+2*y^2-1)" | $GP -qf 2>> config.log`
    expected="[0, 2, Mod(0, 2)]~"
    if test x$bug_check=x$expected; then
        AC_MSG_RESULT([no])
    else
        AC_MSG_RESULT([yes; cannot use system pari/GP with known bug])
        AC_MSG_NOTICE([Patch/upgrade yoour package and reconfigure.])
        AC_MSG_NOTICE([Otherwise Sage will build its own pari/GP.])
        sage_spkg_install_pari=yes
    fi
```



---

archive/issue_comments_575235.json:
```json
{
    "body": "<a id='comment:15'></a>On the broken pari the output of this is `[0, 2, Mod(1, 2)]~`. On the working pari the output is as above.",
    "created_at": "2020-04-03T15:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575235",
    "user": "https://github.com/kliem"
}
```

<a id='comment:15'></a>On the broken pari the output of this is `[0, 2, Mod(1, 2)]~`. On the working pari the output is as above.



---

archive/issue_comments_575236.json:
```json
{
    "body": "<a id='comment:16'></a>yes, that's the right way to fix it. Careful with the brackets - they are m4 quoting characters",
    "created_at": "2020-04-03T15:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575236",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>yes, that's the right way to fix it. Careful with the brackets - they are m4 quoting characters



---

archive/issue_comments_575237.json:
```json
{
    "body": "<a id='comment:17'></a>Can you are someone put it in the right place? I can try to, but I'm really guessing here.",
    "created_at": "2020-04-03T15:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575237",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>Can you are someone put it in the right place? I can try to, but I'm really guessing here.



---

archive/issue_comments_575238.json:
```json
{
    "body": "<a id='comment:18'></a>OK, will do",
    "created_at": "2020-04-03T15:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575238",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>OK, will do



---

archive/issue_comments_575239.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version\"",
    "created_at": "2020-04-03T17:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575239",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version"



---

archive/issue_comments_575240.json:
```json
{
    "body": "<a id='comment:20'></a>New commits:",
    "created_at": "2020-04-03T17:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575240",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>New commits:



---

archive/issue_comments_575241.json:
```json
{
    "body": "Changing commit from \"\" to \"c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41\"",
    "created_at": "2020-04-03T17:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575241",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41"



---

archive/issue_comments_575242.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Kliem, Matthias Koeppe\"",
    "created_at": "2020-04-03T17:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575242",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Jonathan Kliem, Matthias Koeppe"



---

archive/issue_comments_575243.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-04-03T17:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575243",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_575244.json:
```json
{
    "body": "<a id='comment:24'></a>`@`mkoeppe: Thanks. Should I start a github workflow? Are you already doing it?",
    "created_at": "2020-04-03T17:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575244",
    "user": "https://github.com/kliem"
}
```

<a id='comment:24'></a>`@`mkoeppe: Thanks. Should I start a github workflow? Are you already doing it?



---

archive/issue_comments_575245.json:
```json
{
    "body": "<a id='comment:25'></a>Please do. #29417 has the latest version",
    "created_at": "2020-04-03T17:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575245",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Please do. #29417 has the latest version



---

archive/issue_comments_575246.json:
```json
{
    "body": "<a id='comment:26'></a>What about the original aim of this ticket (make tests pass regardless of the system pari version)? When using a patched 2.11.3 you'd still get many doctest failures (but correct nevertheless)",
    "created_at": "2020-04-03T17:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575246",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:26'></a>What about the original aim of this ticket (make tests pass regardless of the system pari version)? When using a patched 2.11.3 you'd still get many doctest failures (but correct nevertheless)



---

archive/issue_comments_575247.json:
```json
{
    "body": "<a id='comment:27'></a>Should probably be taken care of in the same ticket",
    "created_at": "2020-04-03T17:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575247",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Should probably be taken care of in the same ticket



---

archive/issue_comments_575248.json:
```json
{
    "body": "<a id='comment:28'></a>I would wait and see.\n\nI'm still willing to change the doctests such that both pari versions work, but I guess on a new ticket once this problem occurs.\n\n(I also wasn't sure how many of those things would disappear once this is patched, e.g. the +/- failures.)",
    "created_at": "2020-04-03T17:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575248",
    "user": "https://github.com/kliem"
}
```

<a id='comment:28'></a>I would wait and see.

I'm still willing to change the doctests such that both pari versions work, but I guess on a new ticket once this problem occurs.

(I also wasn't sure how many of those things would disappear once this is patched, e.g. the +/- failures.)



---

archive/issue_comments_575249.json:
```json
{
    "body": "<a id='comment:29'></a>You can see the exact failures in the patch for #29313 (but that patch only changes them to the 2.11.3 answer, so they would fail with <2.11.3)",
    "created_at": "2020-04-03T17:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575249",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:29'></a>You can see the exact failures in the patch for #29313 (but that patch only changes them to the 2.11.3 answer, so they would fail with <2.11.3)



---

archive/issue_comments_575250.json:
```json
{
    "body": "<a id='comment:30'></a>Ok, seems to work\n\n[https://github.com/kliem/sage-test-27122/actions](https://github.com/kliem/sage-test-27122/actions)\n\nSpecifically for debian bulleye standard it detects the bug and doesn't use system pari (and those failures are gone).\nFor debian buster it checks for the bug and detects that the system pari is fine to use.",
    "created_at": "2020-04-04T05:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575250",
    "user": "https://github.com/kliem"
}
```

<a id='comment:30'></a>Ok, seems to work

[https://github.com/kliem/sage-test-27122/actions](https://github.com/kliem/sage-test-27122/actions)

Specifically for debian bulleye standard it detects the bug and doesn't use system pari (and those failures are gone).
For debian buster it checks for the bug and detects that the system pari is fine to use.



---

archive/issue_comments_575251.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jonathan Kliem\"",
    "created_at": "2020-04-04T13:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575251",
    "user": "https://github.com/kliem"
}
```

Changing reviewer from "" to "Jonathan Kliem"



---

archive/issue_comments_575252.json:
```json
{
    "body": "Changing reviewer from \"Jonathan Kliem\" to \"Matthias Koeppe, Jonathan Kliem\"",
    "created_at": "2020-04-04T14:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575252",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "Jonathan Kliem" to "Matthias Koeppe, Jonathan Kliem"



---

archive/issue_comments_575253.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-04T14:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575253",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_575254.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-09T22:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575254",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_575255.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version\" to \"c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41\"",
    "created_at": "2020-04-09T22:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575255",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/fix_failing_doctests_because_of_representation_depending_on_pari_version" to "c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41"



---

archive/issue_events_075062.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-09T22:45:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29445#event-75062"
}
```



---

archive/issue_comments_575256.json:
```json
{
    "body": "Changing commit from \"c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41\" to \"\"",
    "created_at": "2020-04-23T10:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575256",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "c4a0a22a9b6a47df266b9f06dbb0c8ae2e9ebf41" to ""



---

archive/issue_comments_575257.json:
```json
{
    "body": "<a id='comment:34'></a>it is a buggy test\n\n```\nconfigure:17249: checking whether hyperellcharpoly bug is fixed\n  ***   too many arguments: ...lcharpoly(x^10+x^9+x^8+x,0*Mod(1,3))\n  ***                                                   ^-----------\nconfigure:17257: result: no; cannot use system pari/GP with known bug\n\n```\n\nDon't mix up `AS_IF` and shell `if` :-(\n\nSee #29554 for a fix",
    "created_at": "2020-04-23T10:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29445#issuecomment-575257",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>it is a buggy test

```
configure:17249: checking whether hyperellcharpoly bug is fixed
  ***   too many arguments: ...lcharpoly(x^10+x^9+x^8+x,0*Mod(1,3))
  ***                                                   ^-----------
configure:17257: result: no; cannot use system pari/GP with known bug

```

Don't mix up `AS_IF` and shell `if` :-(

See #29554 for a fix
