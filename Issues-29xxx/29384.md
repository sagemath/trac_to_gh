# Issue 29384: Clean up src/bin/sage-env-config.in: Move logic to src/bin/sage-env, move non-environment configuration variables to sage_conf.py

archive/issues_029147.json:
```json
{
    "body": "Follow-up from #29038.\n\nWe clean up `sage-env-config`, intended for setting direct values only, by moving conditional settings of other environment variables to `sage-env` instead.\n\nMoreover, we move configuration variables that are only needed by the Sage python process but not as environment variables by its child processes, to `sage_conf.py`. In this way they become available in the `sage.all` module even when invoked outside of a `sage-env`.\n\n(part of #21707.)\n\n\nCC:  @orlitzky @dimpase @jhpalmieri\n\nBranch/Commit: 7364e2ab9aadd51cc57a487d8d378ba95481a14e\n\nReviewer: Michael Orlitzky\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29384\n\n",
    "closed_at": "2020-04-16T22:33:25Z",
    "created_at": "2020-03-20T21:53:20Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Clean up src/bin/sage-env-config.in: Move logic to src/bin/sage-env, move non-environment configuration variables to sage_conf.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29384",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #29038.

We clean up `sage-env-config`, intended for setting direct values only, by moving conditional settings of other environment variables to `sage-env` instead.

Moreover, we move configuration variables that are only needed by the Sage python process but not as environment variables by its child processes, to `sage_conf.py`. In this way they become available in the `sage.all` module even when invoked outside of a `sage-env`.

(part of #21707.)


CC:  @orlitzky @dimpase @jhpalmieri

Branch/Commit: 7364e2ab9aadd51cc57a487d8d378ba95481a14e

Reviewer: Michael Orlitzky

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29384





---

archive/issue_comments_439410.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,11 @@\n Follow-up from #29038.\n \n-By moving variables to sage_conf, they become available in the `sage.all` module even when invoked outside of a sage-env.\n+We clean up `sage-env-config`, intended for setting direct values only, by moving conditional settings of other environment variables to `sage-env` instead.\n+\n+Moreover, we move configuration variables that are only needed by the Sage python process but not as environment variables by its child processes, to `sage_conf.py`. In this way they become available in the `sage.all` module even when invoked outside of a `sage-env`.\n+\n+(part of #21707.)\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-04-10T21:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439410",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,11 @@
 Follow-up from #29038.
 
-By moving variables to sage_conf, they become available in the `sage.all` module even when invoked outside of a sage-env.
+We clean up `sage-env-config`, intended for setting direct values only, by moving conditional settings of other environment variables to `sage-env` instead.
+
+Moreover, we move configuration variables that are only needed by the Sage python process but not as environment variables by its child processes, to `sage_conf.py`. In this way they become available in the `sage.all` module even when invoked outside of a `sage-env`.
+
+(part of #21707.)
+
 
 Comment: 1
 
``````




---

archive/issue_comments_439411.json:
```json
{
    "body": "<a id='comment:4'></a>Do we still need\n\n```\nvar('SAGE_NAUTY_BINS_PREFIX',        '')\n```\n\nin `src/sage/env.py` after this?\n\n---\nNew commits:",
    "created_at": "2020-04-10T22:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439411",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>Do we still need

```
var('SAGE_NAUTY_BINS_PREFIX',        '')
```

in `src/sage/env.py` after this?

---
New commits:



---

archive/issue_comments_439412.json:
```json
{
    "body": "<a id='comment:5'></a>Yes, this is what makes the variable available in the module `sage.env`.",
    "created_at": "2020-04-10T22:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439412",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Yes, this is what makes the variable available in the module `sage.env`.



---

archive/issue_comments_439413.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 mkoeppe]:\n> Yes, this is what makes the variable available in the module `sage.env`.\n\n\nOh, I see. Updated question: is there any reason to be going through sage.env still, as opposed to importing the value directly from `sage_conf`? Something to do with distro packaging?\n\n(I've probably asked this same question three times by now, sorry.)",
    "created_at": "2020-04-10T23:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439413",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:6'></a>Replying to [comment:5 mkoeppe]:
> Yes, this is what makes the variable available in the module `sage.env`.


Oh, I see. Updated question: is there any reason to be going through sage.env still, as opposed to importing the value directly from `sage_conf`? Something to do with distro packaging?

(I've probably asked this same question three times by now, sorry.)



---

archive/issue_comments_439414.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 mjo]:\n> Replying to [comment:5 mkoeppe]:\n> > Yes, this is what makes the variable available in the module `sage.env`.\n\n> \n> Oh, I see. Updated question: is there any reason to be going through sage.env still, as opposed to importing the value directly from `sage_conf`? Something to do with distro packaging?\n\n\nWell, sage_conf is still \"optional\". It's yet to be seen what distribution packagers will be doing with it. For now it's best to keep the logic of handling the situation when sage_conf does not exist centrally, rather than in every place that needs a variable.",
    "created_at": "2020-04-10T23:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439414",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Replying to [comment:6 mjo]:
> Replying to [comment:5 mkoeppe]:
> > Yes, this is what makes the variable available in the module `sage.env`.

> 
> Oh, I see. Updated question: is there any reason to be going through sage.env still, as opposed to importing the value directly from `sage_conf`? Something to do with distro packaging?


Well, sage_conf is still "optional". It's yet to be seen what distribution packagers will be doing with it. For now it's best to keep the logic of handling the situation when sage_conf does not exist centrally, rather than in every place that needs a variable.



---

archive/issue_comments_439415.json:
```json
{
    "body": "<a id='comment:8'></a>Ok, my curiosity is satisfied. Needs review, or still working on it?",
    "created_at": "2020-04-10T23:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439415",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>Ok, my curiosity is satisfied. Needs review, or still working on it?



---

archive/issue_comments_439416.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-11T00:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439416",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439417.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-11T00:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439417",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439418.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks!",
    "created_at": "2020-04-11T00:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439418",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Thanks!



---

archive/issue_comments_439419.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-16T22:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29384#issuecomment-439419",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_074871.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-16T22:33:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29384",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29384#event-74871"
}
```
