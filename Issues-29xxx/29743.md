# Issue 29743: is_unit() fails for power-series-ring element: O(t^0)

archive/issues_029506.json:
```json
{
    "body": "Using version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. \n\nThis induces failure on elements O(t<sup>n</sup>) (for any n) of Laurent-series rings, since checking those elements results in checking their unit-part (valuation_zero_part), which is the element O(t<sup>0</sup>) of the appropriate power-series.\n\nThe bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. \n\nExample is attached.\n\nThere are 2 possible approaches to address the problem:\n\n1. make is_unit() return False for O(t<sup>0</sup>). This maintains consistency with the fact that O(t<sup>0</sup>).is_zero() returns True, and this is the approach currently implemented on the ticket-branch.\n\n2. Decide that is_unit() should fail on O(t<sup>0</sup>), because O(t<sup>0</sup>) is a family of elements, some of which are units and some are not. Under this approach, however, it should be taken into account that the failure is induced on other cases, such as checking invertibility of a matrix over a laurent-series ring with determinant O(t<sup>n</sup>). Therefore I propose to raise a more informative error-message, such as \"precision not enough to determine\", bearing in mind that the message would propagate onwards.\n\n\n\n\nKeywords: power series, is_unit\n\nBranch/Commit: 9eaa277bf3622b8b6950a95e3c795d9f56b4f0bf\n\nReviewer: Markus Wageringel\n\nAuthor: Noa Viner\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29743\n\n",
    "closed_at": "2020-09-15T22:00:47Z",
    "created_at": "2020-05-27T12:43:00Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "is_unit() fails for power-series-ring element: O(t^0)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29743",
    "user": "https://github.com/n-vi"
}
```
Using version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. 

This induces failure on elements O(t<sup>n</sup>) (for any n) of Laurent-series rings, since checking those elements results in checking their unit-part (valuation_zero_part), which is the element O(t<sup>0</sup>) of the appropriate power-series.

The bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. 

Example is attached.

There are 2 possible approaches to address the problem:

1. make is_unit() return False for O(t<sup>0</sup>). This maintains consistency with the fact that O(t<sup>0</sup>).is_zero() returns True, and this is the approach currently implemented on the ticket-branch.

2. Decide that is_unit() should fail on O(t<sup>0</sup>), because O(t<sup>0</sup>) is a family of elements, some of which are units and some are not. Under this approach, however, it should be taken into account that the failure is induced on other cases, such as checking invertibility of a matrix over a laurent-series ring with determinant O(t<sup>n</sup>). Therefore I propose to raise a more informative error-message, such as "precision not enough to determine", bearing in mind that the message would propagate onwards.




Keywords: power series, is_unit

Branch/Commit: 9eaa277bf3622b8b6950a95e3c795d9f56b4f0bf

Reviewer: Markus Wageringel

Author: Noa Viner

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29743





---

archive/issue_comments_446313.json:
```json
{
    "body": "Attachment [is_unit_power_series_output.txt](tarball://root/attachments/some-uuid/ticket29743/is_unit_power_series_output.txt) by @n-vi created at 2020-05-27 12:43:24",
    "created_at": "2020-05-27T12:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446313",
    "user": "https://github.com/n-vi"
}
```

Attachment [is_unit_power_series_output.txt](tarball://root/attachments/some-uuid/ticket29743/is_unit_power_series_output.txt) by @n-vi created at 2020-05-27 12:43:24



---

archive/issue_comments_446314.json:
```json
{
    "body": "<a id='comment:2'></a>needs review ? if yes, set the status to \"needs review\" and fill the Authors field with your real full name\n\n---\nNew commits:",
    "created_at": "2020-06-04T11:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446314",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>needs review ? if yes, set the status to "needs review" and fill the Authors field with your real full name

---
New commits:



---

archive/issue_comments_446315.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-04T13:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446315",
    "user": "https://github.com/n-vi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_446316.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,9 +1,20 @@\n Using version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. \n+\n+This induces failure on elements O(t<sup>n</sup>) (for any n) of Laurent-series rings, since checking those elements results in checking their unit-part (valuation_zero_part), which is the element O(t<sup>0</sup>) of the appropriate power-series.\n \n The bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. \n \n Example is attached.\n \n+There are 2 possible approaches to address the problem:\n+\n+1. make is_unit() return False for O(t<sup>0</sup>). This maintains consistency with the fact that O(t<sup>0</sup>).is_zero() returns True, and this is the approach currently implemented on the ticket-branch.\n+\n+2. Decide that is_unit() should fail on O(t<sup>0</sup>), because O(t<sup>0</sup>) is a family of elements, some of which are units and some are not. Under this approach, however, it should be taken into account that the failure is induced on other cases, such as checking invertibility of a matrix over a laurent-series ring with determinant O(t<sup>n</sup>). Therefore I propose to raise a more informative error-message, such as \"precision not enough to determine\", bearing in mind that the message would propagate onwards.\n+\n+\n+\n+\n Issue created by migration from https://trac.sagemath.org/ticket/29743\n \n \n```\n",
    "created_at": "2020-06-04T13:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446316",
    "user": "https://github.com/n-vi"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,9 +1,20 @@
 Using version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. 
+
+This induces failure on elements O(t<sup>n</sup>) (for any n) of Laurent-series rings, since checking those elements results in checking their unit-part (valuation_zero_part), which is the element O(t<sup>0</sup>) of the appropriate power-series.
 
 The bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. 
 
 Example is attached.
 
+There are 2 possible approaches to address the problem:
+
+1. make is_unit() return False for O(t<sup>0</sup>). This maintains consistency with the fact that O(t<sup>0</sup>).is_zero() returns True, and this is the approach currently implemented on the ticket-branch.
+
+2. Decide that is_unit() should fail on O(t<sup>0</sup>), because O(t<sup>0</sup>) is a family of elements, some of which are units and some are not. Under this approach, however, it should be taken into account that the failure is induced on other cases, such as checking invertibility of a matrix over a laurent-series ring with determinant O(t<sup>n</sup>). Therefore I propose to raise a more informative error-message, such as "precision not enough to determine", bearing in mind that the message would propagate onwards.
+
+
+
+
 Issue created by migration from https://trac.sagemath.org/ticket/29743
 
 
```




---

archive/issue_comments_446317.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:2 chapoton]:\n> needs review ? if yes, set the status to \"needs review\" and fill the Authors field with your real full name\n> \n> ---\n> New commits:\n> |                                                                                                                                          |                                              |\n> |------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n> |[74b9be6](https://git.sagemath.org/sage.git/commit?id=74b9be671d8db2bd2d087e733d59a3a5ff033fcf)|`fix is_unit for power-series element: O(t^0)`|\n\n\nThanks, I updated the ticket and changed status to 'needs review'.",
    "created_at": "2020-06-04T13:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446317",
    "user": "https://github.com/n-vi"
}
```

<a id='comment:4'></a>Replying to [comment:2 chapoton]:
> needs review ? if yes, set the status to "needs review" and fill the Authors field with your real full name
> 
> ---
> New commits:
> |                                                                                                                                          |                                              |
> |------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
> |[74b9be6](https://git.sagemath.org/sage.git/commit?id=74b9be671d8db2bd2d087e733d59a3a5ff033fcf)|`fix is_unit for power-series element: O(t^0)`|


Thanks, I updated the ticket and changed status to 'needs review'.



---

archive/issue_comments_446318.json:
```json
{
    "body": "<a id='comment:5'></a>Maybe you should rather check that the **precision** is not zero.\n\nAnd you need to add a doctest for the modified behaviour.",
    "created_at": "2020-06-04T18:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446318",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>Maybe you should rather check that the **precision** is not zero.

And you need to add a doctest for the modified behaviour.



---

archive/issue_comments_446319.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-04T21:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446320.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-15T17:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446320",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_446321.json:
```json
{
    "body": "<a id='comment:7'></a>Thank you for the fix. This approach looks correct to me. Since O(t<sup>0</sup>) does not have a multiplicative inverse, `is_unit` should be `False`.\n\nA similar fix should be applied to multivariate power series as well, so I am setting this back to *needs work*.\n\n```\nsage: R.<x,y> = QQ[[]]\nsage: y.O(0)\n0 + O(x, y)^0\nsage: _.is_unit()\n...\nIndexError: coefficient not known\n```",
    "created_at": "2020-08-15T17:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446321",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:7'></a>Thank you for the fix. This approach looks correct to me. Since O(t<sup>0</sup>) does not have a multiplicative inverse, `is_unit` should be `False`.

A similar fix should be applied to multivariate power series as well, so I am setting this back to *needs work*.

```
sage: R.<x,y> = QQ[[]]
sage: y.O(0)
0 + O(x, y)^0
sage: _.is_unit()
...
IndexError: coefficient not known
```



---

archive/issue_comments_446322.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-08T21:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446323.json:
```json
{
    "body": "<a id='comment:9'></a>Thank you for the review.\nI applied a similar fix to multivariate power series as you suggested.",
    "created_at": "2020-09-08T21:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446323",
    "user": "https://github.com/n-vi"
}
```

<a id='comment:9'></a>Thank you for the review.
I applied a similar fix to multivariate power series as you suggested.



---

archive/issue_comments_446324.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-08T21:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446324",
    "user": "https://github.com/n-vi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_446325.json:
```json
{
    "body": "<a id='comment:11'></a>This looks good. Thank you.",
    "created_at": "2020-09-09T17:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446325",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:11'></a>This looks good. Thank you.



---

archive/issue_comments_446326.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-09T17:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446326",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_446327.json:
```json
{
    "body": "<a id='comment:12'></a>Great, thanks!",
    "created_at": "2020-09-10T00:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446327",
    "user": "https://github.com/n-vi"
}
```

<a id='comment:12'></a>Great, thanks!



---

archive/issue_comments_446328.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T22:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29743#issuecomment-446328",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076103.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T22:00:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29743",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29743#event-76103"
}
```
