# Issue 29899: Two bugs with dilation

archive/issues_029662.json:
```json
{
    "body": "The new dilation with #29200 discovered two bugs:\n\n```\nsage: 2*Polyhedron([[]], backend='cdd')\n...\nTypeError ...\n```\n\nand\n\n```\nsage: K.<sqrt2> = QuadraticField(2)\nsage: sqrt2*Polyhedron(backend='normaliz')\n...\nAttributeError\n```\n\nThe underlying errors are the following:\n\n```\nsage: from sage.geometry.polyhedron.backend_cdd import Polyhedron_QQ_cdd\nsage: from sage.geometry.polyhedron.parent import Polyhedra_QQ_cdd\nsage: parent = Polyhedra_QQ_cdd(QQ, 0, 'cdd')\nsage: p = Polyhedron_QQ_cdd(parent, [iter([]), iter([]), iter([])], None)\nTraceback (most recent call last):\n...\nTypeError: can't multiply sequence by non-int of type 'NoneType'\n\nsage: Polyhedron(ieqs=[], ambient_dim=5, backend='cdd')\nTraceback (most recent call last):\n...\nTypeError: unsupported operand type(s) for -=: 'NoneType' and 'int'\n\nsage: from sage.geometry.polyhedron.parent import Polyhedra_RDF_cdd\nsage: from sage.geometry.polyhedron.backend_cdd import Polyhedron_RDF_cdd\nsage: parent = Polyhedra_RDF_cdd(RDF, 1, 'cdd')\nsage: Vrep = [[], [], [[1.0]]]\nsage: Hrep = [[], []]\nsage: p = Polyhedron_RDF_cdd(parent, Vrep, Hrep,\n....:                        Vrep_minimal=True, Hrep_minimal=True) \nTraceback (most recent call last):\n...\nTypeError: unsupported operand type(s) for -=: 'NoneType' and 'int'\n```\n\nThere are two tiny fixes to it:\n- Make sure to special-case the empty polyhedron in `Polyhedron_base.__init__`.\n- Add a trivial inequality for initialization of the universe polyhedron with backend `cdd`.\n\nWe add doctests for each fix. Note that #29907 will also indirectly test this.\n\nCC:  @jplab @laisrast\n\nKeywords: polyhedra, dilation\n\nReviewer: Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nBranch: 0bb641359527cb77f74d373c95a0c90c65f6f117\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/29899\n\n",
    "closed_at": "2020-07-25T22:51:16Z",
    "created_at": "2020-06-19T15:47:29Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Two bugs with dilation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29899",
    "user": "https://github.com/kliem"
}
```
The new dilation with #29200 discovered two bugs:

```
sage: 2*Polyhedron([[]], backend='cdd')
...
TypeError ...
```

and

```
sage: K.<sqrt2> = QuadraticField(2)
sage: sqrt2*Polyhedron(backend='normaliz')
...
AttributeError
```

The underlying errors are the following:

```
sage: from sage.geometry.polyhedron.backend_cdd import Polyhedron_QQ_cdd
sage: from sage.geometry.polyhedron.parent import Polyhedra_QQ_cdd
sage: parent = Polyhedra_QQ_cdd(QQ, 0, 'cdd')
sage: p = Polyhedron_QQ_cdd(parent, [iter([]), iter([]), iter([])], None)
Traceback (most recent call last):
...
TypeError: can't multiply sequence by non-int of type 'NoneType'

sage: Polyhedron(ieqs=[], ambient_dim=5, backend='cdd')
Traceback (most recent call last):
...
TypeError: unsupported operand type(s) for -=: 'NoneType' and 'int'

sage: from sage.geometry.polyhedron.parent import Polyhedra_RDF_cdd
sage: from sage.geometry.polyhedron.backend_cdd import Polyhedron_RDF_cdd
sage: parent = Polyhedra_RDF_cdd(RDF, 1, 'cdd')
sage: Vrep = [[], [], [[1.0]]]
sage: Hrep = [[], []]
sage: p = Polyhedron_RDF_cdd(parent, Vrep, Hrep,
....:                        Vrep_minimal=True, Hrep_minimal=True) 
Traceback (most recent call last):
...
TypeError: unsupported operand type(s) for -=: 'NoneType' and 'int'
```

There are two tiny fixes to it:
- Make sure to special-case the empty polyhedron in `Polyhedron_base.__init__`.
- Add a trivial inequality for initialization of the universe polyhedron with backend `cdd`.

We add doctests for each fix. Note that #29907 will also indirectly test this.

CC:  @jplab @laisrast

Keywords: polyhedra, dilation

Reviewer: Matthias Koeppe

Author: Jonathan Kliem

Branch: 0bb641359527cb77f74d373c95a0c90c65f6f117

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/29899





---

archive/issue_comments_420797.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2020-06-19T15:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420797",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_420798.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-19T15:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420798",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_420799.json:
```json
{
    "body": "<a id='comment:2'></a>What also doesn't work for `cdd` and this is how the `TestSuite` detected the problem is `2*Polyhedron(backend='cdd')`. The problem is that it tries to discover the action via\n\n`parent(Polyhedron(backend='cdd')).an_element()`, which is `Polyhedron([[]], backend='cdd')`.",
    "created_at": "2020-06-19T15:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420799",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>What also doesn't work for `cdd` and this is how the `TestSuite` detected the problem is `2*Polyhedron(backend='cdd')`. The problem is that it tries to discover the action via

`parent(Polyhedron(backend='cdd')).an_element()`, which is `Polyhedron([[]], backend='cdd')`.



---

archive/issue_comments_420800.json:
```json
{
    "body": "<a id='comment:3'></a>There is no thing as a trivial equation of course.",
    "created_at": "2020-06-19T16:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420800",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>There is no thing as a trivial equation of course.



---

archive/issue_comments_420801.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-19T16:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420802.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-19T16:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420802",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420803.json:
```json
{
    "body": "<a id='comment:6'></a>Again, the branch that I push into public/29842 in a second really tests those things. Otherwise, I wouldn't have discovered this stuff in the first place.",
    "created_at": "2020-06-19T16:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420803",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>Again, the branch that I push into public/29842 in a second really tests those things. Otherwise, I wouldn't have discovered this stuff in the first place.



---

archive/issue_comments_420804.json:
```json
{
    "body": "<a id='comment:8'></a>I think you should add a doctest that more specifically illustrates this subtle point of the behavior of `Polyhedron_base.__init__` when generators are involved.",
    "created_at": "2020-06-22T04:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420804",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>I think you should add a doctest that more specifically illustrates this subtle point of the behavior of `Polyhedron_base.__init__` when generators are involved.



---

archive/issue_comments_420805.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-22T08:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_420806.json:
```json
{
    "body": "<a id='comment:11'></a>inequalites -> inequalities.\n\nAlso could you rephrase/expand the comment involving \"The damage is limited.\" I don't fully understand it",
    "created_at": "2020-06-22T17:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420806",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>inequalites -> inequalities.

Also could you rephrase/expand the comment involving "The damage is limited." I don't fully understand it



---

archive/issue_comments_420807.json:
```json
{
    "body": "<a id='comment:12'></a>I will improve this.\n\nThe reason for using generators is that we don't have to build a list/tuple that is possibly discarded. Once we are there, we need to generate all the generators. Of course it might be better if you can really just generate them, when you feed them to the backend, but the backends require that you don't call `_init_from_Vrepresentation`, when vertices and rays and lines are empty. So we should respect that.",
    "created_at": "2020-06-22T17:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420807",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'></a>I will improve this.

The reason for using generators is that we don't have to build a list/tuple that is possibly discarded. Once we are there, we need to generate all the generators. Of course it might be better if you can really just generate them, when you feed them to the backend, but the backends require that you don't call `_init_from_Vrepresentation`, when vertices and rays and lines are empty. So we should respect that.



---

archive/issue_comments_420808.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-04T19:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420808",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_420809.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-05T07:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420809",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_420810.json:
```json
{
    "body": "<a id='comment:14'></a>New commits:",
    "created_at": "2020-07-05T07:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420810",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>New commits:



---

archive/issue_comments_420811.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-19T05:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420811",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_420812.json:
```json
{
    "body": "<a id='comment:16'></a>Thank you.",
    "created_at": "2020-07-19T06:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420812",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>Thank you.



---

archive/issue_comments_420813.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-25T22:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29899#issuecomment-420813",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076663.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-25T22:51:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29899",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29899#event-76663"
}
```
