# Issue 17896: Implement Orlik-Solomon algebra of an arrangement

Issue created by migration from https://trac.sagemath.org/ticket/18133

Original creator: kcrisman

Original creation time: 2015-04-07 13:11:09

CC:  tscrim stefan yomcat chaoxu

Keywords: hyperplane arrangements

The Orlik-Solomon algebra is a fundamental invariant for an arrangement, which also enables computing scads of useful information about e.g. the complement.  But it's purely algebraic.  So we should have it (see also #17506).


---

Comment by dimpase created at 2015-04-10 20:43:52

how about algebras generated by reciprocals of linear forms of hyperplanes of the arrangement (cf e.g. http://arxiv.org/abs/math/0105095) ?


---

Comment by kcrisman created at 2015-04-11 01:27:40

Sure, anything you want!  I'm not actually implementing this ticket :-) Basically anything in Orlik/Terao is great, so much of it is computational - I was kind of hoping the matroid folks would see this too.  Actually, I thought some of this stuff was going to be in a 'next-gen' book by Alex, Dan and others but all I could find was a draft at Hal Schenck's website.  It would be great to get Sage "officially" in that book in the same way it's in the Toric Varieties book he coauthored.


---

Comment by tscrim created at 2015-11-01 21:36:34

Here is an implementation based upon code given to me by William Slofstra.
----
New commits:


---

Comment by tscrim created at 2015-11-01 21:36:34

Changing status from new to needs_review.


---

Comment by git created at 2015-11-01 21:40:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-14 18:01:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-20 01:44:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-20 02:18:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2016-01-20 02:42:16

I didn't know that this algebra could be defined for any matroid! That's really nice.

On the other hand, I'm afraid the code doesn't properly iterate the reduction.

```
            sage: M4 = matroids.CompleteGraphic(4)
            sage: OS = M4.orlik_solomon_algebra(QQ)
            sage: OS._reduce_broken_circuit(frozenset({2,3,4}))
            OS{1, 3, 4} + OS{1, 2, 3} - OS{1, 2, 4}
```

The result is malformed: {1, 3, 4} itself contains a broken circuit, so one of the monomials isn't actually a monomial. Now you could argue that this is an underscored method and might do with malformed results if the method calling it knows what it's doing, but first of all I'm not sure whether the CombinatorialFreeModule framework will keep accepting such monomials in the future, and second I cannot guarantee that the multiplication as you implemented it still works with this implementation of `_reduce_broken_circuit`.

The point is, reducing an element modulo the ideal J(M) is a multistep process, as clearing out one broken circuit might create another. If you do it until no more broken circuits remain, then I think your product is correct (though I'll have to take another look).

Another issue is the `algebra_generators`: You're setting the `i`-th generator to be `self.monomial(frozenset([i]))`, but this too might be malformed. (For example, if `M` is a uniform matroid `U_{n,1} = matroids.Uniform(1,n)`, then all basis elements are equal, which means that they cannot be distinct basis elements.)

I think both of these issues can be fixed at once. Let me do it.


---

Comment by git created at 2016-01-20 03:24:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-20 03:26:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2016-01-20 03:28:52

OK, the above points are done.

I am out of time now, so if anyone wants to take this over, feel free to do so. If not, I'll probably return to this in a week or so.

Meanwhile, here is one more question: Your implementation of the Orlik-Solomon algebra for a hyperplane arrangement assumes that the base field of the algebra is that of the arrangement. Is that a reasonable assumption? (To me it sounds wrong -- like studying the homology of real manifolds only with real coefficients.)


---

Comment by git created at 2016-01-20 03:33:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-01-20 16:30:31

Replying to [comment:10 darij]:
> On the other hand, I'm afraid the code doesn't properly iterate the reduction.
> {{{
>             sage: M4 = matroids.CompleteGraphic(4)
>             sage: OS = M4.orlik_solomon_algebra(QQ)
>             sage: OS._reduce_broken_circuit(frozenset({2,3,4}))
>             OS{1, 3, 4} + OS{1, 2, 3} - OS{1, 2, 4}
> }}}
> The result is malformed: {1, 3, 4} itself contains a broken circuit, so one of the monomials isn't actually a monomial. Now you could argue that this is an underscored method and might do with malformed results if the method calling it knows what it's doing,

That was going to be my argument.

> but first of all I'm not sure whether the CombinatorialFreeModule framework will keep accepting such monomials in the future,

It should because those checks are expensive and there has to be a way to tell this proposed CFM that you know what you're doing (especially in internal methods like `_from_dict`).

> and second I cannot guarantee that the multiplication as you implemented it still works with this implementation of `_reduce_broken_circuit`.
> 
> The point is, reducing an element modulo the ideal J(M) is a multistep process, as clearing out one broken circuit might create another. If you do it until no more broken circuits remain, then I think your product is correct (though I'll have to take another look).

That is how the product was designed and why it worked. Although now you've basically pushed that into the recursive step. This also has an effect of making it recursive. Have you done some timing benchmarks between the two implementations?

Also this is bad:

```
if not type(S) == frozenset:
```

You should use the pythonic (and more robust if we replace it by some subclass of `frozenset`):

```
if not isinstance(S, frozenset):
```

I can change this though.

> Another issue is the `algebra_generators`: You're setting the `i`-th generator to be `self.monomial(frozenset([i]))`, but this too might be malformed. (For example, if `M` is a uniform matroid `U_{n,1} = matroids.Uniform(1,n)`, then all basis elements are equal, which means that they cannot be distinct basis elements.)

This is a good point. Good catch.


---

Comment by tscrim created at 2016-01-20 16:32:23

Replying to [comment:13 darij]:
> OK, the above points are done.
> 
> I am out of time now, so if anyone wants to take this over, feel free to do so. If not, I'll probably return to this in a week or so.

Thank you for taking a look at it and pushing some changes.

> Meanwhile, here is one more question: Your implementation of the Orlik-Solomon algebra for a hyperplane arrangement assumes that the base field of the algebra is that of the arrangement. Is that a reasonable assumption? (To me it sounds wrong -- like studying the homology of real manifolds only with real coefficients.)

I can easily change this so the default is the base ring of the arrangement, but it can take another base ring as input. Although I think it carries less meaning in terms of studying the arrangement, but I'm not that much of an expert to know for certain.


---

Comment by kcrisman created at 2016-01-20 18:59:30

> I can easily change this so the default is the base ring of the arrangement, but it can take another base ring as input. Although I think it carries less meaning in terms of studying the arrangement, but I'm not that much of an expert to know for certain.

I don't have a copy of !Orlik/Terao around to check but usually everything was complex anyway.  But I did find [this](http://pages.uoregon.edu/njp/os.pdf) wherein the coefficients are in the field of two elements, though the definitions are not _quite_ the same as just taking the OS algebra over two elements as its base field.  Wikipedia says you can take any subring of the base field but I don't know I'd trust that without reading the final version of [this](http://www.math.uiuc.edu/~schenck/cxarr.pdf) a bit more.  If one of you knows one of these guys one could ask; I haven't talked to any of them in quite a while.


---

Comment by darij created at 2016-01-20 19:03:57

The Proudfoot reference you linked makes it clear to me that the base ring of the algerba should not have anything to do with the base ring of the arrangement.


---

Comment by darij created at 2016-01-21 03:53:18

Technical question... can we rely on frozensets being indices of a combinatorial free module? They don't compare well:


```
sage: frozenset([2]) < frozenset([3])
False
sage: frozenset([3]) < frozenset([2])
False
sage: frozenset([3]) == frozenset([2])
False
sage: frozenset([2]) > frozenset([3])
False
```



---

Comment by git created at 2016-01-21 03:56:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-21 04:20:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-21 04:25:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2016-01-21 04:26:38

In other news, I've math-reviewed the ticket. What remains to be done:

- Better doctests, e.g., one that would have caught my bug in `subset_image`. We don't have any nonstandard orderings, and we don't have any interesting matroids. I'd like an example with a matroid given by a graph with 3 vertices and 2 edges between each two distinct vertices.

- The frozenset issue mentioned above. Maybe switch to sorted lists?


---

Comment by git created at 2016-01-21 21:03:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-21 21:04:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-01-21 21:07:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-01-21 21:08:23

Whoops, sorry; bad merge. You can safely ignore comment:24.

I fixed any issues with comparisons using `frozenset` by implementing a term comparison function. I also added a few more doctests. Thanks for changing the behavior for creating the Orlik-Solomon. I'm happy with the current version. If you are too (and there are no other objectios), then we can set a positive review.


---

Comment by git created at 2016-01-22 02:41:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2016-01-22 02:42:25

Thanks! This fixes it.

The code looks good to me now. Feel free to set it to positive_review, or wait for others to comment, if you feel so inclined.


---

Comment by git created at 2016-01-22 02:47:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-22 02:50:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-01-22 02:51:17

Back to you; if you're happy with my changes, then you can set a positive review. Thanks.


---

Comment by darij created at 2016-01-22 02:51:56

Perfect!


---

Comment by darij created at 2016-01-22 02:51:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-23 17:01:05

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-01-23 17:01:05


```
sage -t --long src/sage/matroids/matroid.pyx
**********************************************************************
File "src/sage/matroids/matroid.pyx", line 2912, in sage.matroids.matroid.Matroid.orlik_solomon_algebra
Failed example:
    OS = M.orlik_solomon_algebra(QQ)
Expected:
    Orlik-Solomon algebra of U(3, 4): Matroid of rank 3 on 4 elements
     with circuit-closures
     {3: {{0, 1, 2, 3}}}
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of   3 in sage.matroids.matroid.Matroid.orlik_solomon_algebra
    [775 tests, 1 failure, 2.64 s]
```



---

Comment by git created at 2016-01-23 17:33:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-01-23 17:34:19

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2016-01-23 17:34:19

Stupid me; trivial doctest fix.


---

Comment by darij created at 2016-01-23 17:36:57

Oops, that was me being stupid too. The only file I've run the tests on was orlik-solomon.py...


---

Comment by vbraun created at 2016-01-24 12:52:52

Resolution: fixed
