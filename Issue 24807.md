# Issue 24807: Add DESTDIR support for gap

Issue created by migration from https://trac.sagemath.org/ticket/25044

Original creator: embray

Original creation time: 2018-03-27 14:58:12

Keywords: destdir gap

Implements #24024 for gap; this one is slightly non-trivial.


---

Comment by embray created at 2018-03-27 14:58:22

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-03-29 12:22:40

Why not use `sdh_configure` here?


---

Comment by embray created at 2018-03-29 13:47:49

Hmm, for some reason I thought it wasn't a standard autoconf configure, but it looks like it is, actually.  I don't know why it's being passed some `PREFIX` argument.  That doesn't seem to do anything.


---

Comment by git created at 2018-03-29 13:53:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-04-04 08:13:47

(already merges without conflict with #23733)


---

Comment by embray created at 2018-04-05 11:41:04

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-04-05 11:41:04

This appears to have some kind of problem installing `gap.sh`...


---

Comment by git created at 2018-04-05 12:01:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-04-05 12:02:03

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2018-07-17 15:41:22

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-07-17 17:44:10

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-07-17 17:44:38

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-07-17 17:44:38

I think it should be good now.


---

Comment by embray created at 2018-07-18 11:47:03

I believe this issue can reasonably be addressed for Sage 8.4.


---

Comment by jdemeyer created at 2018-08-07 16:14:01

Since `SAGE_GAP` is no longer used in the script, it would be more clear to replace

```
SAGE_GAP="$SAGE_LOCAL/gap"
INSTALL_DIR="$SAGE_GAP/$GAP_DIR"
```

by

```
INSTALL_DIR="$SAGE_LOCAL/gap/$GAP_DIR"
```



---

Comment by jdemeyer created at 2018-08-07 16:21:30

I would remove

```
[ -f bin/gap.sh ] || sdh_die "Error building GAP ('gap.sh' not found)."
```


You have a commit message `turns out bin/gap.sh is a symlink to either gap-default64.sh or gap-default32.sh (only one or the other should exist). rather than add explicit support for dereferencing symlinks, for now just copy the real file`. I would rather see something like that in a comment in the script, otherwise it's quite obscure what `sdh_install -T bin/gap-default*.sh "$SAGE_LOCAL/bin/gap"` does.

Given that we have `sage-legacy-uninstall`, shouldn't this be moved there?

```
rm -rf "$INSTALL_DIR"
rm -f "$SAGE_LOCAL/gap/latest"
rm -f "$SAGE_LOCAL/bin/gap"
```

(just a question, if there is a good reason to keep it there: fine for me)


---

Comment by jdemeyer created at 2018-08-08 08:04:00

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-08-08 11:00:21

Replying to [comment:15 jdemeyer]:
> Given that we have `sage-legacy-uninstall`, shouldn't this be moved there?
> {{{
> rm -rf "$INSTALL_DIR"
> rm -f "$SAGE_LOCAL/gap/latest"
> rm -f "$SAGE_LOCAL/bin/gap"
> }}}
> (just a question, if there is a good reason to keep it there: fine for me)

Yes, this ticket just predates that being merged; as long as this is still open it makes sense to go ahead and move that stuff into an spkg-legacy-uninstall.


---

Comment by git created at 2018-08-08 11:09:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-08-08 11:09:51

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-08-08 11:09:51

Done all of the above.


---

Comment by embray created at 2018-09-06 09:43:11

Bump.


---

Comment by embray created at 2018-12-20 14:13:05

Resolution: duplicate


---

Comment by embray created at 2018-12-20 14:13:05

This is also implemented by #22626 which supersedes this.
