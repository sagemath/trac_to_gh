# Issue 31921: Make ppl backend somewhat lazy

Issue created by migration from https://trac.sagemath.org/ticket/32158

Original creator: @kliem

Original creation time: 2021-07-07 22:35:56

CC:  jipilab mkoeppe yzh

Keywords: ppl, lazy double description

We make the ppl backend somewhat lazy.

This is a preparation for allowing interactive modification.

The goal is that `normaliz` and `polymake` use `Polyhedron_interactive` as well and allow adding generators/inequalities.


---

Comment by @kliem created at 2021-07-07 22:36:04

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-07-07 23:11:37

How about "mutable" instead of "interactive"


---

Comment by mkoeppe created at 2021-07-07 23:25:37

And surely by default, polyhedra should remain immutable, right?


---

Comment by mkoeppe created at 2021-07-07 23:34:12

IMO, the constructor `Polyhedron` should get an additional keyword argument `immutable=True` (unfortunately there's a bit of inconsistency - in the Sage library one finds all three of `immutable=`, `is_mutable=`, `is_immutable=`).
When `False`, it should select a suitable backend


---

Comment by mkoeppe created at 2021-07-07 23:34:50

See also #29101 for my proposed "Refined protocol for `_element_constructor_` in element classes with mutability"


---

Comment by @kliem created at 2021-07-08 08:07:17

Thanks for the comments. Yes, using `immutable` is much better. I would prefer to not have another backend though. It's the same with vectors and matrices. One can just make them immutable, if one likes to, but not the other way around.


---

Comment by mkoeppe created at 2021-07-08 20:29:14

Replying to [comment:6 gh-kliem]:
> I would prefer to not have another backend though.

I'm just saying that `Polyhedron`, if no backend is given and `is_mutable=True` is passed, should select one of the backends that support mutation. As of this or a follow-up ticket, I guess that's only ppl.


---

Comment by @kliem created at 2021-07-09 07:11:15

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-07-13 09:07:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-13 11:12:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-07-13 11:14:03

Changing status from needs_work to needs_review.


---

Comment by git created at 2021-07-13 13:51:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-07-13 13:55:44

I fixed faces to be unhashable when taken from a mutable polyhedron (or that actually happens automatically). This means that in particular we cannot create graphs or hasse diagrams for faces.

I also invalidate all objects that point towards the polyhedron, when the polyhedron is changed. I don't know if this is good or if a user is responsible for not keeping objects pointing on polyhedra that might change.

I also changed the behavior to not recycle Vrepresentation and Hrepresentation objects when clearing the cache. This why I at least prevent that an representation object that a user keeps changes at some point.


---

Comment by git created at 2021-07-15 07:30:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-16 21:57:34

LGTM.


---

Comment by mkoeppe created at 2021-07-16 21:57:34

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2021-07-16 22:54:27

Thank you.


---

Comment by vbraun created at 2021-07-24 15:28:06

Resolution: fixed
