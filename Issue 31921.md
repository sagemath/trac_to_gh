# Issue 31921: Make ppl backend somewhat lazy

archive/issues_031921.json:
```json
{
    "body": "CC:  @jplab @mkoeppe @yuan-zhou\n\nKeywords: ppl, lazy double description\n\nWe make the ppl backend somewhat lazy.\n\nThis is a preparation for allowing interactive modification.\n\nThe goal is that `normaliz` and `polymake` use `Polyhedron_interactive` as well and allow adding generators/inequalities.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32158\n\n",
    "created_at": "2021-07-07T22:35:56Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Make ppl backend somewhat lazy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31921",
    "user": "https://github.com/kliem"
}
```
CC:  @jplab @mkoeppe @yuan-zhou

Keywords: ppl, lazy double description

We make the ppl backend somewhat lazy.

This is a preparation for allowing interactive modification.

The goal is that `normaliz` and `polymake` use `Polyhedron_interactive` as well and allow adding generators/inequalities.

Issue created by migration from https://trac.sagemath.org/ticket/32158





---

archive/issue_comments_455488.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-07T22:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455488",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_455489.json:
```json
{
    "body": "How about \"mutable\" instead of \"interactive\"",
    "created_at": "2021-07-07T23:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455489",
    "user": "https://github.com/mkoeppe"
}
```

How about "mutable" instead of "interactive"



---

archive/issue_comments_455490.json:
```json
{
    "body": "And surely by default, polyhedra should remain immutable, right?",
    "created_at": "2021-07-07T23:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455490",
    "user": "https://github.com/mkoeppe"
}
```

And surely by default, polyhedra should remain immutable, right?



---

archive/issue_comments_455491.json:
```json
{
    "body": "IMO, the constructor `Polyhedron` should get an additional keyword argument `immutable=True` (unfortunately there's a bit of inconsistency - in the Sage library one finds all three of `immutable=`, `is_mutable=`, `is_immutable=`).\nWhen `False`, it should select a suitable backend",
    "created_at": "2021-07-07T23:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455491",
    "user": "https://github.com/mkoeppe"
}
```

IMO, the constructor `Polyhedron` should get an additional keyword argument `immutable=True` (unfortunately there's a bit of inconsistency - in the Sage library one finds all three of `immutable=`, `is_mutable=`, `is_immutable=`).
When `False`, it should select a suitable backend



---

archive/issue_comments_455492.json:
```json
{
    "body": "See also #29101 for my proposed \"Refined protocol for `_element_constructor_` in element classes with mutability\"",
    "created_at": "2021-07-07T23:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455492",
    "user": "https://github.com/mkoeppe"
}
```

See also #29101 for my proposed "Refined protocol for `_element_constructor_` in element classes with mutability"



---

archive/issue_comments_455493.json:
```json
{
    "body": "Thanks for the comments. Yes, using `immutable` is much better. I would prefer to not have another backend though. It's the same with vectors and matrices. One can just make them immutable, if one likes to, but not the other way around.",
    "created_at": "2021-07-08T08:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455493",
    "user": "https://github.com/kliem"
}
```

Thanks for the comments. Yes, using `immutable` is much better. I would prefer to not have another backend though. It's the same with vectors and matrices. One can just make them immutable, if one likes to, but not the other way around.



---

archive/issue_comments_455494.json:
```json
{
    "body": "Replying to [comment:6 gh-kliem]:\n> I would prefer to not have another backend though.\n\nI'm just saying that `Polyhedron`, if no backend is given and `is_mutable=True` is passed, should select one of the backends that support mutation. As of this or a follow-up ticket, I guess that's only ppl.",
    "created_at": "2021-07-08T20:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455494",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:6 gh-kliem]:
> I would prefer to not have another backend though.

I'm just saying that `Polyhedron`, if no backend is given and `is_mutable=True` is passed, should select one of the backends that support mutation. As of this or a follow-up ticket, I guess that's only ppl.



---

archive/issue_comments_455495.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-09T07:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455495",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_455496.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T09:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455496",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455497.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T11:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455497",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455498.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-13T11:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455498",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_455499.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T13:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455499",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455500.json:
```json
{
    "body": "I fixed faces to be unhashable when taken from a mutable polyhedron (or that actually happens automatically). This means that in particular we cannot create graphs or hasse diagrams for faces.\n\nI also invalidate all objects that point towards the polyhedron, when the polyhedron is changed. I don't know if this is good or if a user is responsible for not keeping objects pointing on polyhedra that might change.\n\nI also changed the behavior to not recycle Vrepresentation and Hrepresentation objects when clearing the cache. This why I at least prevent that an representation object that a user keeps changes at some point.",
    "created_at": "2021-07-13T13:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455500",
    "user": "https://github.com/kliem"
}
```

I fixed faces to be unhashable when taken from a mutable polyhedron (or that actually happens automatically). This means that in particular we cannot create graphs or hasse diagrams for faces.

I also invalidate all objects that point towards the polyhedron, when the polyhedron is changed. I don't know if this is good or if a user is responsible for not keeping objects pointing on polyhedra that might change.

I also changed the behavior to not recycle Vrepresentation and Hrepresentation objects when clearing the cache. This why I at least prevent that an representation object that a user keeps changes at some point.



---

archive/issue_comments_455501.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-15T07:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455501",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455502.json:
```json
{
    "body": "LGTM.",
    "created_at": "2021-07-16T21:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455502",
    "user": "https://github.com/mkoeppe"
}
```

LGTM.



---

archive/issue_comments_455503.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-16T21:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455503",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_455504.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-07-16T22:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455504",
    "user": "https://github.com/kliem"
}
```

Thank you.



---

archive/issue_comments_455505.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-24T15:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31921#issuecomment-455505",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_085147.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-24T15:28:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31921",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31921#event-85147"
}
```
