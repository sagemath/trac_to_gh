# Issue 10876: Create elementary matrices

archive/issues_010806.json:
```json
{
    "body": "Patch adds a matrix constructor to build elementary matrices, which correspond to row operations.  These matrices are very useful when teaching properties of determinants.\n\n---\nApply [attachment:trac_10876-elementary-matrices-v4.patch]\n\n**Assignee:** @jasongrout, @williamstein\n\n**Author:** Rob Beezer\n\n**Reviewer:** Karl-Dieter Crisman\n\n**Merged:** sage-4.7.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/10876\n\n",
    "closed_at": "2011-04-05T12:00:44Z",
    "created_at": "2011-03-04T23:33:41Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "Create elementary matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10876",
    "user": "https://github.com/rbeezer"
}
```
Patch adds a matrix constructor to build elementary matrices, which correspond to row operations.  These matrices are very useful when teaching properties of determinants.

---
Apply [attachment:trac_10876-elementary-matrices-v4.patch]

**Assignee:** @jasongrout, @williamstein

**Author:** Rob Beezer

**Reviewer:** Karl-Dieter Crisman

**Merged:** sage-4.7.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/10876





---

archive/attachments_014260.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10876-elementary-matrices.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10876/trac_10876-elementary-matrices.patch",
    "created_at": "2011-03-04T23:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_107374.json:
```json
{
    "body": "",
    "created_at": "2011-03-04T23:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107374",
    "user": "https://github.com/rbeezer"
}
```





---

archive/issue_events_084615.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-04T23:39:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84615"
}
```



---

archive/issue_comments_107375.json:
```json
{
    "body": "**Author:** Rob Beezer",
    "created_at": "2011-03-04T23:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107375",
    "user": "https://github.com/rbeezer"
}
```

**Author:** Rob Beezer



---

archive/issue_comments_107376.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis looks really nice, Rob - comprehensive, useful, well-organized and tested.  I like your using the Python 3 string formatting, which I have yet to learn - didn't realize it was already supported. \n\nJust a few questions, and then a 'needs work':\n\n* Think we need to remind people that the rows are numbered from 0 to n-1?  Up to your discretion; if one actually reads and understands the doc, it's clear, but just asking since we sometimes like to remind of things like this that are not standard math notation.\n* Super-picky - `FORMAT` is hardly ever used in Sage, rather `INPUT` is used, even for `matrix?`.  Any particular reasoning behind this one?  I'm asking just in terms of consistency.\n\nI fear that the notion that the ring is optional will lead to incorrect use of that without keywords.  Can you think of any other way to word the first few things? \n\nHere is an example of what it can lead to.\n\n```\nsage: elementary_matrix(4,3,3,3)\n[1 0 0 0]\n[0 1 0 0]\n[0 0 1 0]\n[0 0 0 1]\n```\nAnd this:\n\n```\nsage: elementary_matrix(4,3,scale=4)\n[4 0 0 0]\n[0 1 0 0]\n[0 0 1 0]\n[0 0 0 1]\nsage: elementary_matrix(4,scale=4)\n[4 0 0 0]\n[0 1 0 0]\n[0 0 1 0]\n[0 0 0 1]\n```\nI don't think that either of these are 'allowed', but the second of these in particular is very tempting, with n=4, row 3, scale by 4.\n\nBecause of the audience of this patch, I think it is really important to make sure we catch things like this, esp. plausible use cases.  It would be nice to not need the ring at all, but I understand that for consistency with other matrix invocations this needs to be the first (optional) argument.\n\nAnyway, none of this takes away from this being a nice addition for LA teaching with Sage.",
    "created_at": "2011-03-13T03:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107376",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>
This looks really nice, Rob - comprehensive, useful, well-organized and tested.  I like your using the Python 3 string formatting, which I have yet to learn - didn't realize it was already supported. 

Just a few questions, and then a 'needs work':

* Think we need to remind people that the rows are numbered from 0 to n-1?  Up to your discretion; if one actually reads and understands the doc, it's clear, but just asking since we sometimes like to remind of things like this that are not standard math notation.
* Super-picky - `FORMAT` is hardly ever used in Sage, rather `INPUT` is used, even for `matrix?`.  Any particular reasoning behind this one?  I'm asking just in terms of consistency.

I fear that the notion that the ring is optional will lead to incorrect use of that without keywords.  Can you think of any other way to word the first few things? 

Here is an example of what it can lead to.

```
sage: elementary_matrix(4,3,3,3)
[1 0 0 0]
[0 1 0 0]
[0 0 1 0]
[0 0 0 1]
```
And this:

```
sage: elementary_matrix(4,3,scale=4)
[4 0 0 0]
[0 1 0 0]
[0 0 1 0]
[0 0 0 1]
sage: elementary_matrix(4,scale=4)
[4 0 0 0]
[0 1 0 0]
[0 0 1 0]
[0 0 0 1]
```
I don't think that either of these are 'allowed', but the second of these in particular is very tempting, with n=4, row 3, scale by 4.

Because of the audience of this patch, I think it is really important to make sure we catch things like this, esp. plausible use cases.  It would be nice to not need the ring at all, but I understand that for consistency with other matrix invocations this needs to be the first (optional) argument.

Anyway, none of this takes away from this being a nice addition for LA teaching with Sage.



---

archive/issue_events_084616.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-13T03:40:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84616"
}
```



---

archive/issue_events_084617.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-13T03:40:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84617"
}
```



---

archive/issue_comments_107377.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2011-03-13T03:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107377",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/issue_comments_107378.json:
```json
{
    "body": "<a id='comment:3'></a>\nOh, and the additional docs look fine :)",
    "created_at": "2011-03-13T03:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107378",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
Oh, and the additional docs look fine :)



---

archive/issue_comments_107379.json:
```json
{
    "body": "<a id='comment:4'></a>\nKDC,\n\nThanks for the testing.  I was trying to figure out how to consolidate all three elementary matrices into one function - the problem is when you want to scale a row by an integer scalar, how can you distinguish that from swapping two rows indexed by integers?  Maybe I was being too clever, I'll have to study your examples.\n\nSearch `sage/matrix/constructor.py` which has things like `FORMAT` and `CALL FORMAT`.  I have edited many of them recently, but they were there before I got there.  These constructors are tricky with the optional ring and then various items that get inferred, or options, or...  I don't think it is bad to have a concise summary of what will work right up front - it certainly makes coding them easier!\n\nA reminder about row numbering won't hurt - I agree that this is a place to be careful about that.\n\nRob",
    "created_at": "2011-03-13T05:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107379",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:4'></a>
KDC,

Thanks for the testing.  I was trying to figure out how to consolidate all three elementary matrices into one function - the problem is when you want to scale a row by an integer scalar, how can you distinguish that from swapping two rows indexed by integers?  Maybe I was being too clever, I'll have to study your examples.

Search `sage/matrix/constructor.py` which has things like `FORMAT` and `CALL FORMAT`.  I have edited many of them recently, but they were there before I got there.  These constructors are tricky with the optional ring and then various items that get inferred, or options, or...  I don't think it is bad to have a concise summary of what will work right up front - it certainly makes coding them easier!

A reminder about row numbering won't hurt - I agree that this is a place to be careful about that.

Rob



---

archive/issue_comments_107380.json:
```json
{
    "body": "<a id='comment:5'></a>\nKDC,\n\nI'm thinking there is no way to have an optional ring, like so many of the other constructors, *and* consolidate all three matrices into one function.\n\nI think adding just one function to the global namespace is preferable to the optional ring.  But if you have any great ideas about how to accomplish both, let me know.  Otherwise I'll make a new version that requires a ring.\n\nAnd which won't allow the same row for the \"add a multiple of a row to a row\" version.\n\nRob",
    "created_at": "2011-03-13T23:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107380",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:5'></a>
KDC,

I'm thinking there is no way to have an optional ring, like so many of the other constructors, *and* consolidate all three matrices into one function.

I think adding just one function to the global namespace is preferable to the optional ring.  But if you have any great ideas about how to accomplish both, let me know.  Otherwise I'll make a new version that requires a ring.

And which won't allow the same row for the "add a multiple of a row to a row" version.

Rob



---

archive/issue_comments_107381.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [rbeezer](#comment%3A5):\n> KDC,\n> \n> I'm thinking there is no way to have an optional ring, like so many of the other constructors, *and* consolidate all three matrices into one function.\n\nUnless you make the arguments mandatory (I guess making them keywords).  Which, for a pedagogical function, is actually not so bad.  I think that would be preferable to having instructors of LA who are not so knowledgeable about rings, or don't want to bother students with them, being forced to use the ring.  \n\nI usually like flexibility, but keeping these all in one function seems good, and asking for 'row1' and 'scale' seems very appropriate if you're learning what the elementary matrices are in the first place.  I really doubt any heavy user is going to be using this function instead of writing a small script to generate their own (possible sparse) matrices!\n\nAlso, if you were to do this, I figure that in the case of scaling a single row, one could allow the keyword 'row' instead of 'rows'.  Any interest in also providing column elementary matrices?  I guess one could just multiply on the right... ;)\n> And which won't allow the same row for the \"add a multiple of a row to a row\" version.\n\n\nHaha, yes!",
    "created_at": "2011-03-14T12:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107381",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
Replying to [rbeezer](#comment%3A5):
> KDC,
> 
> I'm thinking there is no way to have an optional ring, like so many of the other constructors, *and* consolidate all three matrices into one function.

Unless you make the arguments mandatory (I guess making them keywords).  Which, for a pedagogical function, is actually not so bad.  I think that would be preferable to having instructors of LA who are not so knowledgeable about rings, or don't want to bother students with them, being forced to use the ring.  

I usually like flexibility, but keeping these all in one function seems good, and asking for 'row1' and 'scale' seems very appropriate if you're learning what the elementary matrices are in the first place.  I really doubt any heavy user is going to be using this function instead of writing a small script to generate their own (possible sparse) matrices!

Also, if you were to do this, I figure that in the case of scaling a single row, one could allow the keyword 'row' instead of 'rows'.  Any interest in also providing column elementary matrices?  I guess one could just multiply on the right... ;)
> And which won't allow the same row for the "add a multiple of a row to a row" version.


Haha, yes!



---

archive/issue_events_084618.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-15T00:43:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84618"
}
```



---

archive/issue_events_084619.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-15T00:43:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84619"
}
```



---

archive/attachments_014261.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10876-elementary-matrices-v2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10876/trac_10876-elementary-matrices-v2.patch",
    "created_at": "2011-03-15T00:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_107382.json:
```json
{
    "body": "<a id='comment:7'></a>\nKDC,\n\nOK, see if you can shoot a hole or two in this one.  ;-)  Ring is still optional, but rows/columns, and scale factor *must* be given by keywords.  Column operations are implemented by building the equivalent row operation version and then transposing it.\n\nDocstring leans towards rows, but I think there is enough info on the column variants.  Two small reminders about 0-based indexing.  New doctest showing dense implementation as default, but now has sparse keyword added.\n\nThanks for the help with this one.\n\nRob",
    "created_at": "2011-03-15T00:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107382",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>
KDC,

OK, see if you can shoot a hole or two in this one.  ;-)  Ring is still optional, but rows/columns, and scale factor *must* be given by keywords.  Column operations are implemented by building the equivalent row operation version and then transposing it.

Docstring leans towards rows, but I think there is enough info on the column variants.  Two small reminders about 0-based indexing.  New doctest showing dense implementation as default, but now has sparse keyword added.

Thanks for the help with this one.

Rob



---

archive/issue_events_084620.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-16T12:34:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84620"
}
```



---

archive/issue_events_084621.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-16T12:34:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84621"
}
```



---

archive/issue_comments_107383.json:
```json
{
    "body": "<a id='comment:8'></a>\nNice addition of the column stuff/doc.  \n\nThis functionality would be especially valuable as an interact - you choose the elementary matrix type, the row1, row2, scale, and it creates the matrix - or, better, changes the unit circle or a pair of vectors *based* on your elementary matrix.  If only we could get interact controls to depend on other interact controls... (yes, there is a ticket for this)\n\nHoles coming up!\n\n---\nFirst, illegal/unwanted input.\n\n* This should be caught.  Though see my comments below about keywords versus arguments.\n\n```\nsage: E = elementary_matrix(ZZ, 5, row1=3, col2=3, scale=12)\nsage: E\n[ 1  0  0  0  0]\n[ 0  1  0  0  0]\n[ 0  0  1  0  0]\n[ 0  0  0 12  0]\n[ 0  0  0  0  1]\n```\n\n* Here is a similar example from your own doctests.  Either we require named arguments, or we don't; this is confusing.\n\n```\nsage: elementary_matrix(QQ, 1, 0, 0)\n[1]\n```\n* This still works, which it probably shouldn't at all:\n\n```\nsage: elementary_matrix(4,3,3,3)\n[1 0 0 0]\n[0 1 0 0]\n[0 0 1 0]\n[0 0 0 1]\n```\n* To deal with all this in general, couldn't you do something like the following, and then look for for the specific keywords row1, sparse, etc?  (And raise an error if any others appear in the dictionary.) \n\n```\ndef elementary_matrix(arg0, arg1=None, **kwds):\n```\n   I think this would make checking for illegal cases easier, too.\n\n\n---\nThen, examples and tests which could be useful.\n\n* An example with a negative scale would be nice, though certainly not necessary.  Similarly with a rational scale, so that people know it's ok to do so (the doctests scare one away from it):\n\n```\nsage: elementary_matrix(4,row1=3,row2=2,scale=-4)\nsage: elementary_matrix(QQ,4,row1=3,row2=2,scale=4/3)\n```\n* Other possibilities I don't use, but might be fun if they are intended behavior, which I presume they are:\n\n```\nsage: elementary_matrix(SR,4,row1=3,row2=2,scale=sqrt(3))\nsage: elementary_matrix(SR,4,row1=3,row2=2,scale=i)\nsage: elementary_matrix(CC,4,row1=3,row2=2,scale=i)\n```\n* The following is something people DO use, though, all the time in Gaussian elimination say, and will wonder why it gives an error:\n\n```\nsage: sage: elementary_matrix(4,row1=3,scale=4/3)\n---------------------------------------------------------------------------\nTypeError: scale parameter of elementary matrix must an element of\nInteger Ring, not 4/3\n```\n   You should be able to massage the default ring so that if there IS a scale keyword, its parent chooses the ring:\n\n```\nsage: elementary_matrix(parent(4/3),4,row1=3,scale=4/3)\n[  1   0   0   0]\n[  0   1   0   0]\n[  0   0   1   0]\n[  0   0   0 4/3]\n```\n\n---\n\nIteration 3 will be the bomb!",
    "created_at": "2011-03-16T12:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107383",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'></a>
Nice addition of the column stuff/doc.  

This functionality would be especially valuable as an interact - you choose the elementary matrix type, the row1, row2, scale, and it creates the matrix - or, better, changes the unit circle or a pair of vectors *based* on your elementary matrix.  If only we could get interact controls to depend on other interact controls... (yes, there is a ticket for this)

Holes coming up!

---
First, illegal/unwanted input.

* This should be caught.  Though see my comments below about keywords versus arguments.

```
sage: E = elementary_matrix(ZZ, 5, row1=3, col2=3, scale=12)
sage: E
[ 1  0  0  0  0]
[ 0  1  0  0  0]
[ 0  0  1  0  0]
[ 0  0  0 12  0]
[ 0  0  0  0  1]
```

* Here is a similar example from your own doctests.  Either we require named arguments, or we don't; this is confusing.

```
sage: elementary_matrix(QQ, 1, 0, 0)
[1]
```
* This still works, which it probably shouldn't at all:

```
sage: elementary_matrix(4,3,3,3)
[1 0 0 0]
[0 1 0 0]
[0 0 1 0]
[0 0 0 1]
```
* To deal with all this in general, couldn't you do something like the following, and then look for for the specific keywords row1, sparse, etc?  (And raise an error if any others appear in the dictionary.) 

```
def elementary_matrix(arg0, arg1=None, **kwds):
```
   I think this would make checking for illegal cases easier, too.


---
Then, examples and tests which could be useful.

* An example with a negative scale would be nice, though certainly not necessary.  Similarly with a rational scale, so that people know it's ok to do so (the doctests scare one away from it):

```
sage: elementary_matrix(4,row1=3,row2=2,scale=-4)
sage: elementary_matrix(QQ,4,row1=3,row2=2,scale=4/3)
```
* Other possibilities I don't use, but might be fun if they are intended behavior, which I presume they are:

```
sage: elementary_matrix(SR,4,row1=3,row2=2,scale=sqrt(3))
sage: elementary_matrix(SR,4,row1=3,row2=2,scale=i)
sage: elementary_matrix(CC,4,row1=3,row2=2,scale=i)
```
* The following is something people DO use, though, all the time in Gaussian elimination say, and will wonder why it gives an error:

```
sage: sage: elementary_matrix(4,row1=3,scale=4/3)
---------------------------------------------------------------------------
TypeError: scale parameter of elementary matrix must an element of
Integer Ring, not 4/3
```
   You should be able to massage the default ring so that if there IS a scale keyword, its parent chooses the ring:

```
sage: elementary_matrix(parent(4/3),4,row1=3,scale=4/3)
[  1   0   0   0]
[  0   1   0   0]
[  0   0   1   0]
[  0   0   0 4/3]
```

---

Iteration 3 will be the bomb!



---

archive/issue_events_084622.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-17T05:03:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84622"
}
```



---

archive/issue_events_084623.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-17T05:03:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84623"
}
```



---

archive/attachments_014262.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10876-elementary-matrices-v3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10876/trac_10876-elementary-matrices-v3.patch",
    "created_at": "2011-03-17T05:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_107384.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [kcrisman](#comment%3A8):\n> First, illegal/unwanted input.\n\n>\n>  * This should be caught.  Though see my comments below about keywords versus arguments.\n \n> {{{\n> sage: E = elementary_matrix(ZZ, 5, row1=3, col2=3, scale=12)\n> sage: E\n> [ 1  0  0  0  0]\n> [ 0  1  0  0  0]\n> [ 0  0  1  0  0]\n> [ 0  0  0 12  0]\n> [ 0  0  0  0  1]\n> }}}\n\n>\n\nNow a doctest, raises an error.\n\n>  * Here is a similar example from your own doctests.  Either we require named arguments, or we don't; this is confusing.\n\n\nJust forgot these, now fixed.\n\n>  * To deal with all this in general, couldn't you do something like the following, and then look for for the specific keywords row1, sparse, etc?  (And raise an error if any others appear in the dictionary.)\n \n> {{{\n> def elementary_matrix(arg0, arg1=None, **kwds):\n> }}}\n\n\nYes, much better.\n\n>  * An example with a negative scale would be nice, though certainly not necessary.  Similarly with a rational scale, so that people know it's ok to do so (the doctests scare one away from it):\n \n> {{{\n> sage: elementary_matrix(4,row1=3,row2=2,scale=-4)\n> sage: elementary_matrix(QQ,4,row1=3,row2=2,scale=4/3)\n> }}}\n\n\nChanged one doctest over QQ to a scale factor of 1/2.  Did not add a negative.\n\n>  * Other possibilities I don't use, but might be fun if they are intended behavior, which I presume they are:\n \n> {{{\n> sage: elementary_matrix(SR,4,row1=3,row2=2,scale=sqrt(3))\n> sage: elementary_matrix(SR,4,row1=3,row2=2,scale=i)\n> sage: elementary_matrix(CC,4,row1=3,row2=2,scale=i)\n> }}}\n\n\nSeveral different rings appear when testing automated ring defaults.\n\n>  * The following is something people DO use, though, all the time in Gaussian elimination say, and will wonder why it gives an error:\n \n> {{{\n> sage: sage: elementary_matrix(4,row1=3,scale=4/3)\n> \n> ---\n> TypeError: scale parameter of elementary matrix must an element of\n> Integer Ring, not 4/3\n> }}}\n>    You should be able to massage the default ring so that if there IS a scale keyword, its parent chooses the ring:\n> \n> ```\n> sage: elementary_matrix(parent(4/3),4,row1=3,scale=4/3)\n> [  1   0   0   0]\n> [  0   1   0   0]\n> [  0   0   1   0]\n> [  0   0   0 4/3]\n> ```\n\n\nThis is working now, see new doctests.\n\n> Iteration 3 will be the bomb!\n\n\nYes?",
    "created_at": "2011-03-17T05:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107384",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:9'></a>
Replying to [kcrisman](#comment%3A8):
> First, illegal/unwanted input.

>
>  * This should be caught.  Though see my comments below about keywords versus arguments.
 
> {{{
> sage: E = elementary_matrix(ZZ, 5, row1=3, col2=3, scale=12)
> sage: E
> [ 1  0  0  0  0]
> [ 0  1  0  0  0]
> [ 0  0  1  0  0]
> [ 0  0  0 12  0]
> [ 0  0  0  0  1]
> }}}

>

Now a doctest, raises an error.

>  * Here is a similar example from your own doctests.  Either we require named arguments, or we don't; this is confusing.


Just forgot these, now fixed.

>  * To deal with all this in general, couldn't you do something like the following, and then look for for the specific keywords row1, sparse, etc?  (And raise an error if any others appear in the dictionary.)
 
> {{{
> def elementary_matrix(arg0, arg1=None, **kwds):
> }}}


Yes, much better.

>  * An example with a negative scale would be nice, though certainly not necessary.  Similarly with a rational scale, so that people know it's ok to do so (the doctests scare one away from it):
 
> {{{
> sage: elementary_matrix(4,row1=3,row2=2,scale=-4)
> sage: elementary_matrix(QQ,4,row1=3,row2=2,scale=4/3)
> }}}


Changed one doctest over QQ to a scale factor of 1/2.  Did not add a negative.

>  * Other possibilities I don't use, but might be fun if they are intended behavior, which I presume they are:
 
> {{{
> sage: elementary_matrix(SR,4,row1=3,row2=2,scale=sqrt(3))
> sage: elementary_matrix(SR,4,row1=3,row2=2,scale=i)
> sage: elementary_matrix(CC,4,row1=3,row2=2,scale=i)
> }}}


Several different rings appear when testing automated ring defaults.

>  * The following is something people DO use, though, all the time in Gaussian elimination say, and will wonder why it gives an error:
 
> {{{
> sage: sage: elementary_matrix(4,row1=3,scale=4/3)
> 
> ---
> TypeError: scale parameter of elementary matrix must an element of
> Integer Ring, not 4/3
> }}}
>    You should be able to massage the default ring so that if there IS a scale keyword, its parent chooses the ring:
> 
> ```
> sage: elementary_matrix(parent(4/3),4,row1=3,scale=4/3)
> [  1   0   0   0]
> [  0   1   0   0]
> [  0   0   1   0]
> [  0   0   0 4/3]
> ```


This is working now, see new doctests.

> Iteration 3 will be the bomb!


Yes?



---

archive/issue_comments_107385.json:
```json
{
    "body": "<a id='comment:10'></a>\n\n```\nTypeError: scale must be an element of some ring, not junk \n```\nNice.\n> >  * To deal with all this in general, couldn't you do something like the following, and then look for for the specific keywords row1, sparse, etc?  (And raise an error if any others appear in the dictionary.)\n \n> > {{{\n> > def elementary_matrix(arg0, arg1=None, **kwds):\n> > }}}\n\n> \n> Yes, much better.\n> \n\nA few programming ideas to make it more tight, though I don't think these are strictly necessary.  Take what you want.\n* Couldn't the following just be `n<=0`, since you catch that later?  Then you don't have to worry about the thing later.\n\n```\nif n < 0: \n    raise ValueError('size of elementary matrix must be positive, not {0}'.format(n)) \n```\n* I'd move the checks like\n\n```\nif row2 is None and scale is None:\n```\n   to right after where you turn `col1` and `col2` into `row1` and `row2`, to improve readability later.\n* I think it might be possible to use simultaneous assignment for what comes after\n\n```\nelif not row2 is None and scale is None:\n```\n   in the same way that\n\n```\na,b = 2,3\n```\nworks.\n> > Iteration 3 will be the bomb!\n\n> \n> Yes?\n\nCode checks out, passes tests, weird input doesn't slow it down...\n\nOne more weird result:\n\n```\nsage: elementary_matrix(4,2,row1=1,row2=3)\n[1 0 0 0]\n[0 0 0 1]\n[0 0 1 0]\n[0 1 0 0]\n```\nIf the first argument isn't a ring, you just automatically make the ring the integer ring, the size the first argument, and ignore the second argument.  Probably this should be caught.   Needs work :(\n\nOh, and you didn't capitalize a letter:\n\n```\nto determine the representation used.  the default is ``False`` which \n```\n\nOn the plus side, this will have the biggest error test to example ratio ever!",
    "created_at": "2011-03-17T15:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107385",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:10'></a>

```
TypeError: scale must be an element of some ring, not junk 
```
Nice.
> >  * To deal with all this in general, couldn't you do something like the following, and then look for for the specific keywords row1, sparse, etc?  (And raise an error if any others appear in the dictionary.)
 
> > {{{
> > def elementary_matrix(arg0, arg1=None, **kwds):
> > }}}

> 
> Yes, much better.
> 

A few programming ideas to make it more tight, though I don't think these are strictly necessary.  Take what you want.
* Couldn't the following just be `n<=0`, since you catch that later?  Then you don't have to worry about the thing later.

```
if n < 0: 
    raise ValueError('size of elementary matrix must be positive, not {0}'.format(n)) 
```
* I'd move the checks like

```
if row2 is None and scale is None:
```
   to right after where you turn `col1` and `col2` into `row1` and `row2`, to improve readability later.
* I think it might be possible to use simultaneous assignment for what comes after

```
elif not row2 is None and scale is None:
```
   in the same way that

```
a,b = 2,3
```
works.
> > Iteration 3 will be the bomb!

> 
> Yes?

Code checks out, passes tests, weird input doesn't slow it down...

One more weird result:

```
sage: elementary_matrix(4,2,row1=1,row2=3)
[1 0 0 0]
[0 0 0 1]
[0 0 1 0]
[0 1 0 0]
```
If the first argument isn't a ring, you just automatically make the ring the integer ring, the size the first argument, and ignore the second argument.  Probably this should be caught.   Needs work :(

Oh, and you didn't capitalize a letter:

```
to determine the representation used.  the default is ``False`` which 
```

On the plus side, this will have the biggest error test to example ratio ever!



---

archive/issue_events_084624.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-17T15:36:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84624"
}
```



---

archive/issue_events_084625.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-17T15:36:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84625"
}
```



---

archive/issue_comments_107386.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n Patch adds a matrix constructor to build elementary matrices, which correspond to row operations.  These matrices are very useful when teaching properties of determinants.\n+\n+---\n+Apply attachment:trac_10876-elementary-matrices-v3.patch\n``````\n",
    "created_at": "2011-03-17T15:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107386",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,4 @@
 Patch adds a matrix constructor to build elementary matrices, which correspond to row operations.  These matrices are very useful when teaching properties of determinants.
+
+---
+Apply attachment:trac_10876-elementary-matrices-v3.patch
``````




---

archive/issue_comments_107387.json:
```json
{
    "body": "<a id='comment:11'></a>\nAnd ref output looks fine.  Just about positive review!",
    "created_at": "2011-03-17T15:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107387",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
And ref output looks fine.  Just about positive review!



---

archive/attachments_014263.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10876-elementary-matrices-v4.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10876/trac_10876-elementary-matrices-v4.patch",
    "created_at": "2011-03-18T05:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_107388.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [kcrisman](#comment%3A10):\n>  * Couldn't the following just be `n<=0`, since you catch that later?  Then you don't have to worry about the thing later.\n \n> {{{\n> if n < 0:\n>     raise ValueError('size of elementary matrix must be positive, not {0}'.format(n))\n> }}}\n\n\nYes.  Changed this, edited error message, edited two doctests to conform.\n\n>  * I'd move the checks like\n \n> {{{\n> if row2 is None and scale is None:\n> }}}\n>    to right after where you turn `col1` and `col2` into `row1` and `row2`, to improve readability later.\n\n\nI like these where they are.  Lots of error-checking above to get right inputs.  Then the analysis of what we have makes the decision on which of the three elementary matrix types to create.  This is how we avoid creating three functions in the global namespace.  So I'd like to have it divorced from the other stuff, and split off as the next step.\n\n>  * I think it might be possible to use simultaneous assignment for what comes after\n \n> {{{\n> elif not row2 is None and scale is None:\n> }}}\n>    in the same way that\n> \n> ```\n> a,b = 2,3\n> ```\n\n\nAgain, I like the four statements laid out like they are, I think the symmetry of it is a bit easier to read.\n\n> One more weird result:\n> \n> ```\n> sage: elementary_matrix(4,2,row1=1,row2=3)\n> [1 0 0 0]\n> [0 0 0 1]\n> [0 0 1 0]\n> [0 1 0 0]\n> ```\n> If the first argument isn't a ring, you just automatically make the ring the integer ring, the size the first argument, and ignore the second argument.  Probably this should be caught.   Needs work :(\n\n\nFixed with new check as very first two lines of routine.  New doctest (first of error checks) will exercise it.  Your example is caught as well.\n\n> Oh, and you didn't capitalize a letter:\n> \n> ```\n> to determine the representation used.  the default is ``False`` which\n> ```\n\n\nFixed.\n\nThree for five.  Hope that does it.  Highest ratio of error-checks to code ever, and a v4 patch is a new personal best.  Thanks for your help - this is much better than the original conception.\n\nRob",
    "created_at": "2011-03-18T05:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107388",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:12'></a>
Replying to [kcrisman](#comment%3A10):
>  * Couldn't the following just be `n<=0`, since you catch that later?  Then you don't have to worry about the thing later.
 
> {{{
> if n < 0:
>     raise ValueError('size of elementary matrix must be positive, not {0}'.format(n))
> }}}


Yes.  Changed this, edited error message, edited two doctests to conform.

>  * I'd move the checks like
 
> {{{
> if row2 is None and scale is None:
> }}}
>    to right after where you turn `col1` and `col2` into `row1` and `row2`, to improve readability later.


I like these where they are.  Lots of error-checking above to get right inputs.  Then the analysis of what we have makes the decision on which of the three elementary matrix types to create.  This is how we avoid creating three functions in the global namespace.  So I'd like to have it divorced from the other stuff, and split off as the next step.

>  * I think it might be possible to use simultaneous assignment for what comes after
 
> {{{
> elif not row2 is None and scale is None:
> }}}
>    in the same way that
> 
> ```
> a,b = 2,3
> ```


Again, I like the four statements laid out like they are, I think the symmetry of it is a bit easier to read.

> One more weird result:
> 
> ```
> sage: elementary_matrix(4,2,row1=1,row2=3)
> [1 0 0 0]
> [0 0 0 1]
> [0 0 1 0]
> [0 1 0 0]
> ```
> If the first argument isn't a ring, you just automatically make the ring the integer ring, the size the first argument, and ignore the second argument.  Probably this should be caught.   Needs work :(


Fixed with new check as very first two lines of routine.  New doctest (first of error checks) will exercise it.  Your example is caught as well.

> Oh, and you didn't capitalize a letter:
> 
> ```
> to determine the representation used.  the default is ``False`` which
> ```


Fixed.

Three for five.  Hope that does it.  Highest ratio of error-checks to code ever, and a v4 patch is a new personal best.  Thanks for your help - this is much better than the original conception.

Rob



---

archive/issue_comments_107389.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n Patch adds a matrix constructor to build elementary matrices, which correspond to row operations.  These matrices are very useful when teaching properties of determinants.\n \n ---\n-Apply attachment:trac_10876-elementary-matrices-v3.patch\n+Apply [attachment:trac_10876-elementary-matrices-v4.patch]\n``````\n",
    "created_at": "2011-03-18T05:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107389",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 Patch adds a matrix constructor to build elementary matrices, which correspond to row operations.  These matrices are very useful when teaching properties of determinants.
 
 ---
-Apply attachment:trac_10876-elementary-matrices-v3.patch
+Apply [attachment:trac_10876-elementary-matrices-v4.patch]
``````




---

archive/issue_events_084626.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-18T05:35:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84626"
}
```



---

archive/issue_events_084627.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-18T05:35:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84627"
}
```



---

archive/issue_comments_107390.json:
```json
{
    "body": "<a id='comment:13'></a>\nOkay, that's all fine.  Passes tests, fixed that example, and I really don't want to ache more about this.  As they say, there are bugs in all software, but there sure aren't a lot more in this, unless we both got the math itself wrong!  Hopefully not.  Positive review.\n\n---\n\nFor patchbot - apply only [attachment:trac_10876-elementary-matrices-v4.patch].",
    "created_at": "2011-03-18T14:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107390",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'></a>
Okay, that's all fine.  Passes tests, fixed that example, and I really don't want to ache more about this.  As they say, there are bugs in all software, but there sure aren't a lot more in this, unless we both got the math itself wrong!  Hopefully not.  Positive review.

---

For patchbot - apply only [attachment:trac_10876-elementary-matrices-v4.patch].



---

archive/issue_events_084628.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-18T14:40:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84628"
}
```



---

archive/issue_events_084629.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-18T14:40:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84629"
}
```



---

archive/issue_events_084630.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-05T12:00:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84630"
}
```



---

archive/issue_events_084631.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-05T12:00:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10876#event-84631"
}
```



---

archive/issue_comments_107391.json:
```json
{
    "body": "**Merged:** sage-4.7.alpha4",
    "created_at": "2011-04-05T12:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10876#issuecomment-107391",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.alpha4
