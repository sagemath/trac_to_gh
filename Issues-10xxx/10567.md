# Issue 10567: Parentheses break implicit_multiplication

archive/issues_010514.json:
```json
{
    "body": "Parentheses (brackets) seem to break implicit_multiplication, but only in some cases. This seems to be when a non-bracketed factor is followed by a bracketed. It seems to be a problem with the preparser. Here are a few examples:\n\n```\nsage: implicit_multiplication(True)\n\nWorking examples:\n\nsage: (x+3)(x+4)\n(x + 3)*(x + 4)\nsage: (3) x\n3*x\nsage: 3(x+3)\n3*x + 9\n\nNon-working examples:\n\nsage: x(x+3)\nx + 3\nsage: x (3)\n3\n\nPreparser does not work:\n\nsage: preparse('x(x+3)')\n'x(x+Integer(3))'\n```\nThis is quite a major issue for implicit_multiplication.\n\n**Assignee:** @williamstein\n\n**Author:** Eviatar Bach\n\nIssue created by migration from https://trac.sagemath.org/ticket/10567\n\n",
    "closed_at": "2018-08-14T17:35:53Z",
    "created_at": "2011-01-07T03:07:24Z",
    "labels": [
        "component: user interface",
        "bug",
        "wontfix"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Parentheses break implicit_multiplication",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10567",
    "user": "https://github.com/eviatarbach"
}
```
Parentheses (brackets) seem to break implicit_multiplication, but only in some cases. This seems to be when a non-bracketed factor is followed by a bracketed. It seems to be a problem with the preparser. Here are a few examples:

```
sage: implicit_multiplication(True)

Working examples:

sage: (x+3)(x+4)
(x + 3)*(x + 4)
sage: (3) x
3*x
sage: 3(x+3)
3*x + 9

Non-working examples:

sage: x(x+3)
x + 3
sage: x (3)
3

Preparser does not work:

sage: preparse('x(x+3)')
'x(x+Integer(3))'
```
This is quite a major issue for implicit_multiplication.

**Assignee:** @williamstein

**Author:** Eviatar Bach

Issue created by migration from https://trac.sagemath.org/ticket/10567





---

archive/issue_comments_128431.json:
```json
{
    "body": "<a id='comment:1'></a>\nWell,\n\nI think that \"x(x+3)\" and \"x(3)\" will never work, since this is the syntax of function call.\n\nIf you made the preparser to transform \"x(3)\" to \"x*3\". How will you be able to use a function named x to value 3?",
    "created_at": "2011-01-07T09:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10567#issuecomment-128431",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:1'></a>
Well,

I think that "x(x+3)" and "x(3)" will never work, since this is the syntax of function call.

If you made the preparser to transform "x(3)" to "x*3". How will you be able to use a function named x to value 3?



---

archive/issue_comments_128432.json:
```json
{
    "body": "<a id='comment:2'></a>\nOh, that's why! I can't believe I didn't notice that.",
    "created_at": "2011-01-08T04:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10567#issuecomment-128432",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:2'></a>
Oh, that's why! I can't believe I didn't notice that.



---

archive/issue_events_032103.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2011-01-08T04:36:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10567#event-32103"
}
```



---

archive/issue_events_032104.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10567#event-32104"
}
```



---

archive/issue_events_032105.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10567#event-32105"
}
```



---

archive/issue_comments_128433.json:
```json
{
    "body": "<a id='comment:3'></a>\nHowever, here are some examples where this doesn't work when it should.\n\n```\nsage: (5) (3*5)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/eviatar/<ipython console> in <module>()\n\nTypeError: 'sage.rings.integer.Integer' object is not callable\nsage: (x+3) (x+3)\nx + 6\n```",
    "created_at": "2011-01-08T04:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10567#issuecomment-128433",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:3'></a>
However, here are some examples where this doesn't work when it should.

```
sage: (5) (3*5)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/eviatar/<ipython console> in <module>()

TypeError: 'sage.rings.integer.Integer' object is not callable
sage: (x+3) (x+3)
x + 6
```



---

archive/issue_comments_128434.json:
```json
{
    "body": "**Changing status** from closed to new.",
    "created_at": "2011-01-08T04:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10567#issuecomment-128434",
    "user": "https://github.com/eviatarbach"
}
```

**Changing status** from closed to new.



---

archive/issue_comments_128435.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-05-21T18:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10567#issuecomment-128435",
    "user": "https://github.com/black-stones"
}
```

**Changing status** from new to needs_review.



---

archive/issue_events_032106.json:
```json
{
    "actor": "https://github.com/black-stones",
    "created_at": "2018-05-21T18:03:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10567#event-32106"
}
```



---

archive/issue_comments_128436.json:
```json
{
    "body": "<a id='comment:4'></a>\nThere's nothing wrong with either example\n\n(5) (3*5) is still a function call and therefore invalid because \"(5)\" is not a function\n\n(x+3) (x+3) - the first (x + 3) creates an expression, and then you call the expression with the argument (x + 3). So for example (x + 3)(2) would be 2 + 3 = 5, (x + 3)(y) = y + 3, and (x + 3)(x + 3) = x + 3 + 3 = x + 6",
    "created_at": "2018-05-21T18:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10567#issuecomment-128436",
    "user": "https://github.com/black-stones"
}
```

<a id='comment:4'></a>
There's nothing wrong with either example

(5) (3*5) is still a function call and therefore invalid because "(5)" is not a function

(x+3) (x+3) - the first (x + 3) creates an expression, and then you call the expression with the argument (x + 3). So for example (x + 3)(2) would be 2 + 3 = 5, (x + 3)(y) = y + 3, and (x + 3)(x + 3) = x + 3 + 3 = x + 6



---

archive/issue_comments_128437.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [gh-black-stones](#comment%3A4):\n\n> (5) (3*5) is still a function call and therefore invalid because \"(5)\" is not a function\n> \n> (x+3) (x+3) - the first (x + 3) creates an expression, and then you call the expression with the argument (x + 3). So for example (x + 3)(2) would be 2 + 3 = 5, (x + 3)(y) = y + 3, and (x + 3)(x + 3) = x + 3 + 3 = x + 6\n\n\nThese are not examples the ticket complains about. These are in fact handled as multiplication if one sets `implicit_multiplication(level=10)` (so `(sin)(x)` and `sin(x)` get preparsed differently depending on level)\n\nThe ticket can probably still be closed as \"wontfix\" because the preparser can't see the difference between `x` and `sin`, and hence parsing `x(1)` as multiplication would make function calls indeed impossible.",
    "created_at": "2018-05-21T21:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10567#issuecomment-128437",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:5'></a>
Replying to [gh-black-stones](#comment%3A4):

> (5) (3*5) is still a function call and therefore invalid because "(5)" is not a function
> 
> (x+3) (x+3) - the first (x + 3) creates an expression, and then you call the expression with the argument (x + 3). So for example (x + 3)(2) would be 2 + 3 = 5, (x + 3)(y) = y + 3, and (x + 3)(x + 3) = x + 3 + 3 = x + 6


These are not examples the ticket complains about. These are in fact handled as multiplication if one sets `implicit_multiplication(level=10)` (so `(sin)(x)` and `sin(x)` get preparsed differently depending on level)

The ticket can probably still be closed as "wontfix" because the preparser can't see the difference between `x` and `sin`, and hence parsing `x(1)` as multiplication would make function calls indeed impossible.



---

archive/issue_comments_128438.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [nbruin](#comment%3A5):\n> These are not examples the ticket complains about. \n\n\nSee comment 3\n\nI am just saying that when the level is set to True, the two examples are not treated as multiplication and this is intentional. To treat them as multiplication, as you pointed out, we should set the level to 10. Anyways, I concur that we should close this ticket as wontfix.",
    "created_at": "2018-05-21T22:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10567#issuecomment-128438",
    "user": "https://github.com/black-stones"
}
```

<a id='comment:6'></a>
Replying to [nbruin](#comment%3A5):
> These are not examples the ticket complains about. 


See comment 3

I am just saying that when the level is set to True, the two examples are not treated as multiplication and this is intentional. To treat them as multiplication, as you pointed out, we should set the level to 10. Anyways, I concur that we should close this ticket as wontfix.



---

archive/issue_events_032107.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-14T17:35:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10567#event-32107"
}
```
