# Issue 10181: speed up AbelianGroup().subgroups()

archive/issues_010180.json:
```json
{
    "body": "This was reported by Emmanuel Thome:\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: time len(AbelianGroup([2,4,8]).subgroups())\nCPU times: user 2.35 s, sys: 0.14 s, total: 2.49 s\nWall time: 14.75 s\n81\n```\nWith Magma:\n| Sage Version 4.5.2, Release Date: 2010-08-05                       |\n| Type notebook() for the GUI, and license() for information.        |\n```\nMagma V2.16-10    Thu Oct 28 2010 11:25:26 on andouille [Seed = 3141449269]\nType ? for help.  Type <Ctrl>-D to quit.\n\nLoading startup file \"/users/caramel/zimmerma/.magmarc\"\n\n> time #Subgroups(AbelianGroup([2,4,8]));\n81\nTime: 0.020\n```\nMaybe #9773 helps, I did not try.\n\nPaul Zimmermann\n\n\nAssignee: joyner\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/10181\n\n",
    "created_at": "2010-10-28T09:28:43Z",
    "labels": [
        "component: group theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "speed up AbelianGroup().subgroups()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10181",
    "user": "https://github.com/zimmermann6"
}
```
This was reported by Emmanuel Thome:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: time len(AbelianGroup([2,4,8]).subgroups())
CPU times: user 2.35 s, sys: 0.14 s, total: 2.49 s
Wall time: 14.75 s
81
```
With Magma:
| Sage Version 4.5.2, Release Date: 2010-08-05                       |
| Type notebook() for the GUI, and license() for information.        |
```
Magma V2.16-10    Thu Oct 28 2010 11:25:26 on andouille [Seed = 3141449269]
Type ? for help.  Type <Ctrl>-D to quit.

Loading startup file "/users/caramel/zimmerma/.magmarc"

> time #Subgroups(AbelianGroup([2,4,8]));
81
Time: 0.020
```
Maybe #9773 helps, I did not try.

Paul Zimmermann


Assignee: joyner

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/10181





---

archive/issue_comments_107990.json:
```json
{
    "body": "<a id='comment:1'></a>Just a comment.\nI did notice the oddity, but OTOH I'm not yelling to have it fixed.\n\nE.",
    "created_at": "2010-10-28T09:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10181#issuecomment-107990",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:1'></a>Just a comment.
I did notice the oddity, but OTOH I'm not yelling to have it fixed.

E.



---

archive/issue_comments_107991.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [subgroups.sage](tarball://root/attachments/some-uuid/ticket10181/subgroups.sage) by @emmanuelthome created at 2010-10-28 15:45:03\n\nThe culprit is really the constructor AbelianGroup_subgroup. It does the work again and again and again... Only for expository purpose, in the attached code (which does about the same thing as the subgroups() method anyway), the data shipped to the constructor is already in smith form, yet it takes ages to chat with gap, have it compute the smith form again, parse, etc, etc.",
    "created_at": "2010-10-28T15:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10181#issuecomment-107991",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:2'></a>Attachment [subgroups.sage](tarball://root/attachments/some-uuid/ticket10181/subgroups.sage) by @emmanuelthome created at 2010-10-28 15:45:03

The culprit is really the constructor AbelianGroup_subgroup. It does the work again and again and again... Only for expository purpose, in the attached code (which does about the same thing as the subgroups() method anyway), the data shipped to the constructor is already in smith form, yet it takes ages to chat with gap, have it compute the smith form again, parse, etc, etc.



---

archive/issue_comments_107992.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2010-10-28T15:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10181#issuecomment-107992",
    "user": "https://github.com/emmanuelthome"
}
```

Changing priority from major to minor.



---

archive/issue_comments_107993.json:
```json
{
    "body": "<a id='comment:3'></a>In response to a question by Paul Zimmerman on #9773, the implementation of finitely-generated abelian groups there could possibly speed up subgroup generation by something like 8x.  Current `subgroups()` routine calls `subgroups_reduced())`, I think once per subgroup, maybe more.  It would appear to be responsible for most of the computation time.  this does not exactly jibe with the observations of thome, but I have not spent the time to follow his explanation (though it wouldn't surprise me if it was similar, plausible or the same as what I'm presenting).\n\n```\nsage: G=AbelianGroup([2,4,8])\nsage: len(G.subgroups())\n81\nsage: G.subgroup_reduced( [ [1,0,4], [1,2,4] ])\nMultiplicative Abelian Group isomorphic to C2 x C2, which is the subgroup of\nMultiplicative Abelian Group isomorphic to C2 x C4 x C8\ngenerated by [f1^2, f0*f2^4]\nsage: timeit(\"G.subgroup_reduced( [ [1,0,4], [1,2,4] ])\")\n5 loops, best of 3: 81.2 ms per loop\nsage: timeit(\"G.subgroups()\")\n5 loops, best of 3: 7.52 s per loop\n```\n\nDraft patch at #9773 builds on finitely-generated modules, so the \"reduction\" to invariants is computed there, about 8x faster it would appear.  Patch does not have a `subgroups()` routine yet, but could be easy to add.  Maybe more efficiencies could be found.  Using code in #9773:\n\n```\nsage: G=AdditiveAbelianFGGroup([2,4,8])\nsage: H=G.subgroup([[1,0,4],[1,2,4]])\nsage: H\nAdditive abelian group of order 4, isomorphic to Z_2 + Z_2 with generator(s): (0, 2, 0), (1, 0, 4)\nsage: timeit(\"G.subgroup([[1,0,4],[1,2,4]])\")\n25 loops, best of 3: 10.2 ms per loop\n```",
    "created_at": "2010-10-31T17:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10181#issuecomment-107993",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>In response to a question by Paul Zimmerman on #9773, the implementation of finitely-generated abelian groups there could possibly speed up subgroup generation by something like 8x.  Current `subgroups()` routine calls `subgroups_reduced())`, I think once per subgroup, maybe more.  It would appear to be responsible for most of the computation time.  this does not exactly jibe with the observations of thome, but I have not spent the time to follow his explanation (though it wouldn't surprise me if it was similar, plausible or the same as what I'm presenting).

```
sage: G=AbelianGroup([2,4,8])
sage: len(G.subgroups())
81
sage: G.subgroup_reduced( [ [1,0,4], [1,2,4] ])
Multiplicative Abelian Group isomorphic to C2 x C2, which is the subgroup of
Multiplicative Abelian Group isomorphic to C2 x C4 x C8
generated by [f1^2, f0*f2^4]
sage: timeit("G.subgroup_reduced( [ [1,0,4], [1,2,4] ])")
5 loops, best of 3: 81.2 ms per loop
sage: timeit("G.subgroups()")
5 loops, best of 3: 7.52 s per loop
```

Draft patch at #9773 builds on finitely-generated modules, so the "reduction" to invariants is computed there, about 8x faster it would appear.  Patch does not have a `subgroups()` routine yet, but could be easy to add.  Maybe more efficiencies could be found.  Using code in #9773:

```
sage: G=AdditiveAbelianFGGroup([2,4,8])
sage: H=G.subgroup([[1,0,4],[1,2,4]])
sage: H
Additive abelian group of order 4, isomorphic to Z_2 + Z_2 with generator(s): (0, 2, 0), (1, 0, 4)
sage: timeit("G.subgroup([[1,0,4],[1,2,4]])")
25 loops, best of 3: 10.2 ms per loop
```



---

archive/issue_comments_107994.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 rbeezer]:\n> It would appear to be responsible for most of the computation time.  this does not exactly jibe with the observations of thome, but I have not spent the time to follow his explanation (though it wouldn't surprise me if it was similar, plausible or the same as what I'm presenting).\n\n\nIn fact, I realize I've been considering both as a combo. So maybe indeed subgroup_reduced, which is the middle man between subgroups() and the ctor, is responsible for the computation time. I'm not claiming the contrary. I just haven't tried to tell apart the subgroup_reduced() part and the AbelianGroup_subgroup part, w.r.t. timings.",
    "created_at": "2010-11-01T20:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10181#issuecomment-107994",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:4'></a>Replying to [comment:3 rbeezer]:
> It would appear to be responsible for most of the computation time.  this does not exactly jibe with the observations of thome, but I have not spent the time to follow his explanation (though it wouldn't surprise me if it was similar, plausible or the same as what I'm presenting).


In fact, I realize I've been considering both as a combo. So maybe indeed subgroup_reduced, which is the middle man between subgroups() and the ctor, is responsible for the computation time. I'm not claiming the contrary. I just haven't tried to tell apart the subgroup_reduced() part and the AbelianGroup_subgroup part, w.r.t. timings.



---

archive/issue_events_026070.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10181#event-26070"
}
```



---

archive/issue_events_026071.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10181#event-26071"
}
```



---

archive/issue_events_026072.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10181#event-26072"
}
```



---

archive/issue_events_026073.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10181#event-26073"
}
```



---

archive/issue_events_026074.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10181#event-26074"
}
```



---

archive/issue_events_026075.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10181#event-26075"
}
```



---

archive/issue_events_026076.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10181",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10181#event-26076"
}
```
