# Issue 10892: lcalc fails to build with gcc-4.6

archive/issues_010821.json:
```json
{
    "body": "lcalc fails to build with the gcc-4.6 version in Fedora 15 alpha:\n\n```\nIn file included from ../include/Lglobals.h:51:0,\n                 from Lglobals.cc:23:\n/usr/lib/gcc/x86_64-redhat-linux/4.6.0/../../../../include/c++/4.6.0/limits: In static member function \u2018static\n double std::numeric_limits<double>::min()\u2019:\n/usr/lib/gcc/x86_64-redhat-linux/4.6.0/../../../../include/c++/4.6.0/limits:1479:83: error: call of overloaded \u2018lcalc_to_double(long double)\u2019 is ambiguous\n/usr/lib/gcc/x86_64-redhat-linux/4.6.0/../../../../include/c++/4.6.0/limits:1479:83: note: candidates are:\n../include/Lcommon.h:18:15: note: double lcalc_to_double(const Double&)\n../include/Lcommon.h:29:15: note: double lcalc_to_double(const int&)\n../include/Lcommon.h:30:15: note: double lcalc_to_double(const long long int&)\n../include/Lcommon.h:31:15: note: double lcalc_to_double(const short int&)\n../include/Lcommon.h:32:15: note: double lcalc_to_double(const char&)\n../include/Lcommon.h:33:15: note: double lcalc_to_double(const long int&)\n../include/Lcommon.h:34:15: note: double lcalc_to_double(const unsigned int&)\n../include/Lcommon.h:35:15: note: double lcalc_to_double(const long unsigned int&)\n```\nThe reason is the following code horror from `src/src/include/Lcommon.h` (some editing for clarity):\n\n```\ninline double lcalc_to_double(const Double& x) { return x; }\ninline double lcalc_to_double(const double& x) { return x; }\n//inline double lcalc_to_double(const long double& x) { return x; }\ninline double lcalc_to_double(const int& x) { return x; }\ninline double lcalc_to_double(const long long& x) { return x; }\ninline double lcalc_to_double(const short& x) { return x; }\ninline double lcalc_to_double(const char& x) { return x; }\ninline double lcalc_to_double(const long int& x) { return x; }\ninline double lcalc_to_double(const unsigned int& x) { return x; }\ninline double lcalc_to_double(const long unsigned int& x) { return x; }\n#define Int(x) (int)(lcalc_to_double(x))\n#define Long(x) (Long)(lcalc_to_double(x))\n#define double(x) (double)(lcalc_to_double(x))\n```\nThe last three lines are clearly a bad idea to define before including system headers! As a bandaid, I uncommented the `inline double lcalc_to_double(const long double& x)`, and it compiles fine now. But somebody who is familiar with the codebase should really rewrite lcalc to not redefine the `double()` cast, thats just fragile and will sooner or later again fail inside some system headers.\n\n**Updated spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg)\n\n**Assignee:** tbd\n\n**CC:**  rishikesh\n\n**Resolution:** fixed\n\n**Author:** Volker Braun\n\n**Reviewer:** David Kirkby\n\n**Upstream:** Reported upstream. Developers acknowledge bug.\n\n**Merged:** sage-4.7.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/10892\n\n",
    "closed_at": "2011-04-05T15:57:15Z",
    "created_at": "2011-03-08T21:45:34Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "lcalc fails to build with gcc-4.6",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10892",
    "user": "https://github.com/vbraun"
}
```
lcalc fails to build with the gcc-4.6 version in Fedora 15 alpha:

```
In file included from ../include/Lglobals.h:51:0,
                 from Lglobals.cc:23:
/usr/lib/gcc/x86_64-redhat-linux/4.6.0/../../../../include/c++/4.6.0/limits: In static member function ‘static
 double std::numeric_limits<double>::min()’:
/usr/lib/gcc/x86_64-redhat-linux/4.6.0/../../../../include/c++/4.6.0/limits:1479:83: error: call of overloaded ‘lcalc_to_double(long double)’ is ambiguous
/usr/lib/gcc/x86_64-redhat-linux/4.6.0/../../../../include/c++/4.6.0/limits:1479:83: note: candidates are:
../include/Lcommon.h:18:15: note: double lcalc_to_double(const Double&)
../include/Lcommon.h:29:15: note: double lcalc_to_double(const int&)
../include/Lcommon.h:30:15: note: double lcalc_to_double(const long long int&)
../include/Lcommon.h:31:15: note: double lcalc_to_double(const short int&)
../include/Lcommon.h:32:15: note: double lcalc_to_double(const char&)
../include/Lcommon.h:33:15: note: double lcalc_to_double(const long int&)
../include/Lcommon.h:34:15: note: double lcalc_to_double(const unsigned int&)
../include/Lcommon.h:35:15: note: double lcalc_to_double(const long unsigned int&)
```
The reason is the following code horror from `src/src/include/Lcommon.h` (some editing for clarity):

```
inline double lcalc_to_double(const Double& x) { return x; }
inline double lcalc_to_double(const double& x) { return x; }
//inline double lcalc_to_double(const long double& x) { return x; }
inline double lcalc_to_double(const int& x) { return x; }
inline double lcalc_to_double(const long long& x) { return x; }
inline double lcalc_to_double(const short& x) { return x; }
inline double lcalc_to_double(const char& x) { return x; }
inline double lcalc_to_double(const long int& x) { return x; }
inline double lcalc_to_double(const unsigned int& x) { return x; }
inline double lcalc_to_double(const long unsigned int& x) { return x; }
#define Int(x) (int)(lcalc_to_double(x))
#define Long(x) (Long)(lcalc_to_double(x))
#define double(x) (double)(lcalc_to_double(x))
```
The last three lines are clearly a bad idea to define before including system headers! As a bandaid, I uncommented the `inline double lcalc_to_double(const long double& x)`, and it compiles fine now. But somebody who is familiar with the codebase should really rewrite lcalc to not redefine the `double()` cast, thats just fragile and will sooner or later again fail inside some system headers.

**Updated spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg)

**Assignee:** tbd

**CC:**  rishikesh

**Resolution:** fixed

**Author:** Volker Braun

**Reviewer:** David Kirkby

**Upstream:** Reported upstream. Developers acknowledge bug.

**Merged:** sage-4.7.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/10892





---

archive/issue_comments_144713.json:
```json
{
    "body": "<a id='comment:1'></a>\n> \n> ```\n> [Volker Braun wrote]}}} The reason is the following code horror from src/src/include/Lcommon.h\n\n\nThe poor quality of the lcalc source code appears to have put off one Sage user when she looked at it. To quote her:\n\n\"''Unfortunately, lcalc was the part of Sage I intended using - now I think I\nwill look at other software.''\"\n\nhttp://groups.google.com/group/sage-support/browse_thread/thread/fab46afe7a8ac1c2/e43f31d452dfbfbe?lnk=gst&q=Warning+messages+when+compiling+%27lcalc%27#e43f31d452dfbfbe\n\nI'm also very unimpressed. Even with your changes lcalc generates over 200 compiler warnings from gcc 4.6.0 \n\nSun Studio would never compile lcalc (see #7065) - I doubt it will do even with your changes. \n\nLcalc used to refuse to compile on Solaris with g++ as the Makefile has a compiler option to suppress warnings from the assembler, which works with the GNU assembler, but which the Sun assembler does not understand. (The \"{{{-W}}}\" option was sent directly to the assembler with the g++ option \"{{{-Wa W}}}\".)\n\nLcalc will not install on HP-UX (#7178). I've never tried on AIX, but I would not be surprised if it failed on that too.  \n\nYour code builds OK with gcc 4.6.0 on !OpenSolaris and passes all the doctests. So I'm assuming you want it reviewed, in which case I'll give it a positive review. \n\nIt would really help if you attached a Mercurial patch showing the changes you have made. It makes review easier, and is useful when people look back at tickets. I've attached a patch which shows your changes. \n\nI've changed the ''Reported Upstream'' pull-down on trac from ''N/A'' to ''Not yet reported upstream. Will do shortly'' as clearly this is an upstream bug. I'll report it to \nMicheal Rubinstein. \n\nDave",
    "created_at": "2011-03-30T08:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144713",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:1'></a>
> 
> ```
> [Volker Braun wrote]}}} The reason is the following code horror from src/src/include/Lcommon.h


The poor quality of the lcalc source code appears to have put off one Sage user when she looked at it. To quote her:

"''Unfortunately, lcalc was the part of Sage I intended using - now I think I
will look at other software.''"

http://groups.google.com/group/sage-support/browse_thread/thread/fab46afe7a8ac1c2/e43f31d452dfbfbe?lnk=gst&q=Warning+messages+when+compiling+%27lcalc%27#e43f31d452dfbfbe

I'm also very unimpressed. Even with your changes lcalc generates over 200 compiler warnings from gcc 4.6.0 

Sun Studio would never compile lcalc (see #7065) - I doubt it will do even with your changes. 

Lcalc used to refuse to compile on Solaris with g++ as the Makefile has a compiler option to suppress warnings from the assembler, which works with the GNU assembler, but which the Sun assembler does not understand. (The "{{{-W}}}" option was sent directly to the assembler with the g++ option "{{{-Wa W}}}".)

Lcalc will not install on HP-UX (#7178). I've never tried on AIX, but I would not be surprised if it failed on that too.  

Your code builds OK with gcc 4.6.0 on !OpenSolaris and passes all the doctests. So I'm assuming you want it reviewed, in which case I'll give it a positive review. 

It would really help if you attached a Mercurial patch showing the changes you have made. It makes review easier, and is useful when people look back at tickets. I've attached a patch which shows your changes. 

I've changed the ''Reported Upstream'' pull-down on trac from ''N/A'' to ''Not yet reported upstream. Will do shortly'' as clearly this is an upstream bug. I'll report it to 
Micheal Rubinstein. 

Dave



---

archive/issue_comments_144714.json:
```json
{
    "body": "**Reviewer:** David Kirkby",
    "created_at": "2011-03-30T08:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144714",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Reviewer:** David Kirkby



---

archive/issue_comments_144715.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Not yet reported upstream; Will do shortly.\".",
    "created_at": "2011-03-30T08:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144715",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing upstream** from "N/A" to "Not yet reported upstream; Will do shortly.".



---

archive/issue_comments_144716.json:
```json
{
    "body": "Attachment [10892-lcalc-fails-with-gcc.4.6.0.patch](tarball://root/attachments/some-uuid/ticket10892/10892-lcalc-fails-with-gcc.4.6.0.patch) by drkirkby created at 2011-03-30 08:37:21\n\nPatch for review purposes only - does not need to be applied.",
    "created_at": "2011-03-30T08:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144716",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Attachment [10892-lcalc-fails-with-gcc.4.6.0.patch](tarball://root/attachments/some-uuid/ticket10892/10892-lcalc-fails-with-gcc.4.6.0.patch) by drkirkby created at 2011-03-30 08:37:21

Patch for review purposes only - does not need to be applied.



---

archive/issue_comments_144717.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-03-30T08:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144717",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_144718.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-03-30T08:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144718",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_144719.json:
```json
{
    "body": "<a id='comment:4'></a>\nHas this been reported upstream already?",
    "created_at": "2011-04-05T12:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144719",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Has this been reported upstream already?



---

archive/issue_comments_144720.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jdemeyer](#comment%3A4):\n> Has this been reported upstream already?\n\n\nIt had not before you reminded me, but I have now done it. I reported it to Michael Rubinstein (mrubinst <<<ATT> uwaterloo.ca) today `@` 1307 GMT. I've changed the \"reported upstream\" pull-down to reflect this. \n\nDave",
    "created_at": "2011-04-05T13:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144720",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:5'></a>
Replying to [jdemeyer](#comment%3A4):
> Has this been reported upstream already?


It had not before you reminded me, but I have now done it. I reported it to Michael Rubinstein (mrubinst <<<ATT> uwaterloo.ca) today `@` 1307 GMT. I've changed the "reported upstream" pull-down to reflect this. 

Dave



---

archive/issue_comments_144721.json:
```json
{
    "body": "**Changing upstream** from \"Not yet reported upstream; Will do shortly.\" to \"Reported upstream. Little or no feedback.\".",
    "created_at": "2011-04-05T13:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144721",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing upstream** from "Not yet reported upstream; Will do shortly." to "Reported upstream. Little or no feedback.".



---

archive/issue_comments_144722.json:
```json
{
    "body": "**Merged:** sage-4.7.alpha4",
    "created_at": "2011-04-05T15:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144722",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.alpha4



---

archive/issue_events_033665.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-05T15:57:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10892#event-33665"
}
```



---

archive/issue_comments_144723.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2011-04-05T15:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144723",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_144724.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. Little or no feedback.\" to \"Reported upstream. Developers acknowledge bug.\".",
    "created_at": "2011-04-05T19:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144724",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing upstream** from "Reported upstream. Little or no feedback." to "Reported upstream. Developers acknowledge bug.".



---

archive/issue_comments_144725.json:
```json
{
    "body": "<a id='comment:7'></a>\nI got this from Mike a couple of hours ago, after I suggested he make his latest code available in it's current state, which is clearly not due for release yet. \n\n---\nI'll make that available to you later today, and thanks for keeping me updated about the compile issue.\n\nBest,\nMike\n\n---",
    "created_at": "2011-04-05T19:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144725",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:7'></a>
I got this from Mike a couple of hours ago, after I suggested he make his latest code available in it's current state, which is clearly not due for release yet. 

---
I'll make that available to you later today, and thanks for keeping me updated about the compile issue.

Best,
Mike

---



---

archive/issue_comments_144726.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -35,8 +35,4 @@\n ```\n The last three lines are clearly a bad idea to define before including system headers! As a bandaid, I uncommented the `inline double lcalc_to_double(const long double& x)`, and it compiles fine now. But somebody who is familiar with the codebase should really rewrite lcalc to not redefine the `double()` cast, thats just fragile and will sooner or later again fail inside some system headers.\n \n-My updated spkg is here: \n-\n-http://www.stp.dias.ie/~vbraun/Sage/spkg/lcalc-20100428-1.23.p6.spkg\n-\n-It would be nice if we could update the spkg before Fedora 15 is released!\n+**Updated spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg)\n``````\n",
    "created_at": "2011-04-12T08:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144726",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -35,8 +35,4 @@
 ```
 The last three lines are clearly a bad idea to define before including system headers! As a bandaid, I uncommented the `inline double lcalc_to_double(const long double& x)`, and it compiles fine now. But somebody who is familiar with the codebase should really rewrite lcalc to not redefine the `double()` cast, thats just fragile and will sooner or later again fail inside some system headers.
 
-My updated spkg is here: 
-
-http://www.stp.dias.ie/~vbraun/Sage/spkg/lcalc-20100428-1.23.p6.spkg
-
-It would be nice if we could update the spkg before Fedora 15 is released!
+**Updated spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg)
``````




---

archive/issue_comments_144727.json:
```json
{
    "body": "<a id='comment:8'></a>\n`www.stp.dias.ie` seems to be down, so I'm mirroring the spkg myself.",
    "created_at": "2011-04-12T08:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144727",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
`www.stp.dias.ie` seems to be down, so I'm mirroring the spkg myself.



---

archive/issue_comments_144728.json:
```json
{
    "body": "Attachment [lcalc-SPKG.txt.diff](tarball://root/attachments/some-uuid/ticket10892/lcalc-SPKG.txt.diff) by @jdemeyer created at 2011-05-04 09:32:30\n\nDiff for SPKG.txt",
    "created_at": "2011-05-04T09:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144728",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [lcalc-SPKG.txt.diff](tarball://root/attachments/some-uuid/ticket10892/lcalc-SPKG.txt.diff) by @jdemeyer created at 2011-05-04 09:32:30

Diff for SPKG.txt



---

archive/issue_comments_144729.json:
```json
{
    "body": "<a id='comment:9'></a>\nNew spkg with updated SPKG.txt, same place: [http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg)",
    "created_at": "2011-05-04T09:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144729",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
New spkg with updated SPKG.txt, same place: [http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/lcalc-20100428-1.23.p6.spkg)



---

archive/issue_comments_144730.json:
```json
{
    "body": "<a id='comment:10'></a>\nAny more feedback from upstream?",
    "created_at": "2011-05-12T15:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10892#issuecomment-144730",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Any more feedback from upstream?
