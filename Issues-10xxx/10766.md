# Issue 10766: Update ECL to the latest upstream release.

archive/issues_010702.json:
```json
{
    "assignees": [],
    "body": "The latest version of the Lisp interpreter ECL, (which is used by Maxima) is 11.1.1, but the version of ECL in Sage is 10.4.1. \n\nVersion 10.4.1 is the source of one really major problem on 64-bit OpenSolaris (see #9840), as it creates a broken library libecl.so, which can't be linked to. This stops Sage building as a 64-bit application. \n\nThe failure of ECL to build a fully functional 64-bit library is due to non-PIC code being present, which itself was the result of the use of a GCC extension of \"computed gotos\" in the ECL source code. \n\nhttp://gcc.gnu.org/onlinedocs/gcc-4.5.2/gcc/Labels-as-Values.html\n\nThe updated ECL avoids this GCC extension on Solaris, with a result the library has no text relocation issues. \n\n**Apply:**\n1. The new spkg [http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg](http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg)\n2. [attachment: trac_10766-fix_doctest.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_doctest.patch.gz)\n3. [attachment: trac_10766-fix_symbolic_integration_integral.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_symbolic_integration_integral.patch.gz)\n\nIt is also necessary to update Maxima at the same time. The ticket for Maxima is #10773 which already has positive review.\n\nAssignee: **@aghitza**\n\nCC:  @kcrisman jpflori\n\nAuthor: **Fran\u00e7ois Bissey**\n\nReviewer: **David Kirkby, Karl-Dieter Crisman**\n\nMerged: **sage-4.7.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10766_\n\n",
    "closed_at": "2011-03-08T21:47:22Z",
    "created_at": "2011-02-10T13:47:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update ECL to the latest upstream release.",
    "type": "issue",
    "updated_at": "2011-03-08T21:47:22Z",
    "url": "https://github.com/sagemath/sage/issues/10766",
    "user": "https://github.com/sagetrac-drkirkby"
}
```
The latest version of the Lisp interpreter ECL, (which is used by Maxima) is 11.1.1, but the version of ECL in Sage is 10.4.1. 

Version 10.4.1 is the source of one really major problem on 64-bit OpenSolaris (see #9840), as it creates a broken library libecl.so, which can't be linked to. This stops Sage building as a 64-bit application. 

The failure of ECL to build a fully functional 64-bit library is due to non-PIC code being present, which itself was the result of the use of a GCC extension of "computed gotos" in the ECL source code. 

http://gcc.gnu.org/onlinedocs/gcc-4.5.2/gcc/Labels-as-Values.html

The updated ECL avoids this GCC extension on Solaris, with a result the library has no text relocation issues. 

**Apply:**
1. The new spkg [http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg](http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg)
2. [attachment: trac_10766-fix_doctest.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_doctest.patch.gz)
3. [attachment: trac_10766-fix_symbolic_integration_integral.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_symbolic_integration_integral.patch.gz)

It is also necessary to update Maxima at the same time. The ticket for Maxima is #10773 which already has positive review.

Assignee: **@aghitza**

CC:  @kcrisman jpflori

Author: **Fran√ßois Bissey**

Reviewer: **David Kirkby, Karl-Dieter Crisman**

Merged: **sage-4.7.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/10766_





---

archive/issue_events_125466.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-02-10T13:47:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125466"
}
```



---

archive/issue_events_125467.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-02-10T13:47:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125467"
}
```



---

archive/issue_events_125468.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-02-10T13:47:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125468"
}
```



---

archive/issue_events_125469.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-02-10T13:47:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125469"
}
```



---

archive/issue_comments_105607.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nList of doctests in need of fixing for this to happen:\n\n```\nsage -t -force_lib \"devel/sage-main/sage/modules/free_module_element.pyx\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/modules/free_module_element.pyx\", line 2487:\n    sage: answers\nExpected:\n    [(0.5, 5.5511151231257843e-15, 21, 0),\n    (0.33333333333333343, 3.7007434154171903e-15, 21, 0),\n    (0.45969769413186018, 5.1036696439228408e-15, 21, 0)]\nGot:\n    [(0.5, 5.5511151231257843e-15, 21, 0), (0.33333333333333337, 3.7007434154171903e-15, 21, 0), (0.45969769413186023, 5.1036696439228408e-15, 21, 0)]\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/modules/free_module_element.pyx\", line 2493:\n    sage: r.nintegral(t,0,1)\nExpected:\n    ((0.5, 0.0, 1.0),\n    {0: (0.5, 5.5511151231257843e-15, 21, 0),\n    2: (1.0, 1.110223024625157e-14, 21, 0)})\nGot:\n    ((0.5, 0.0, 1.0), {0: (0.5, 5.5511151231257843e-15, 21, 0), 2: (1.0, 1.1102230246251569e-14, 21, 0)})\n**********************************************************************\n1 items had failures:\n   2 of  10 in __main__.example_70\n```\nformatting and numeric noise\n\n```\nsage -t -force_lib \"devel/sage-main/sage/interfaces/lisp.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/interfaces/lisp.py\", line 378:\n    sage: lisp.function_call('sin', ['2'])\nExpected:\n    0.90929741\nGot:\n    0.9092974\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/interfaces/lisp.py\", line 380:\n    sage: lisp.sin(2)\nExpected:\n    0.90929741\nGot:\n    0.9092974\n**********************************************************************\n1 items had failures:\n   2 of   4 in __main__.example_23\n```\nNumeric noise\n\n```\nsage -t -force_lib \"devel/sage-main/sage/interfaces/maxima.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py\", line 934:\n    sage: maxima.example('arrays')\nExpected:\n    a[n]:=n*a[n-1]\n                                    a  := n a\n                                     n       n - 1\n    a[0]:1\n    a[5]\n                                          120\n    a[n]:=n\n    a[6]\n                                           6\n    a[4]\n                                          24\n                                         done\nGot:\n                                    a  := n a\n                                     n       n - 1\n    a[0]:1\n    a[5]\n                                          120\n    a[n]:=n\n    a[6]\n                                           6\n    a[4]\n                                          24\n                                         done\n    <BLANKLINE>\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py\", line 1128:\n    sage: f(3.2)\nExpected:\n    -.05837414342758009\nGot:\n    -.058374143427580086\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py\", line 1925:\n    sage: a = maxima('sqrt(2)').numer(); a\nExpected:\n    1.414213562373095\nGot:\n    1.4142135623730951\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py\", line 2077:\n    sage: maxima('exp(-sqrt(x))').nintegral('x',0,1)\nExpected:\n    (.5284822353142306, 4.163314137883845e-11, 231, 0)\nGot:\n    (.5284822353142306, 4.1633141378838445e-11, 231, 0)\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py\", line 2131:\n    sage: f.numer()\nExpected:\n    1.462651745907182\nGot:\n    1.4626517459071817\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py\", line 2251:\n    sage: maxima('sqrt(2) + I').comma('numer')\nExpected:\n    I+1.414213562373095\nGot:\n    I+1.4142135623730951\n**********************************************************************\n```\nNumerical and format. The first one should be closely looked at.\n\n```\nsage -t -force_lib \"devel/sage-main/sage/symbolic/integration/integral.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/symbolic/integration/integral.py\", line 541:\n    sage: integrate( (F(x)-G(x))^2, x, -infinity, infinity).n()\nExpected:\n    0\nGot:\n    -6.26376265908397e-17\n**********************************************************************\n```\nNumerical noise.\n\n```\nsage -t -force_lib \"devel/sage-main/sage/symbolic/expression.pyx\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/symbolic/expression.pyx\", line 5517:\n    sage: maxima('cosh(1.0)')\nExpected:\n    1.543080634815244\nGot:\n    1.5430806348152437\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/symbolic/expression.pyx\", line 5626:\n    sage: maxima('asinh(2.0)')\nExpected:\n    1.44363547517881\nGot:\n    1.4436354751788103\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/symbolic/expression.pyx\", line 5680:\n    sage: maxima('acosh(0.5)')\nExpected:\n    1.047197551196598*%i\nGot:\n    1.0471975511965979*%i\n**********************************************************************\n```\nNumerical noise\n\n```\nsage -t -force_lib \"devel/sage-main/sage/calculus/calculus.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/calculus.py\", line 677:\n    sage: f.nintegrate(x,0,1)\nExpected:\n    (-480.00000000000011, 5.3290705182007538e-12, 21, 0)\nGot:\n    (-480.00000000000006, 5.3290705182007538e-12, 21, 0)\n**********************************************************************\n```\nNumerical noise.\nSame as reported by David on sage-devel. It all should be straightforward if tedious.",
    "created_at": "2011-02-10T22:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105607",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'>Comment 1:</a>
List of doctests in need of fixing for this to happen:

```
sage -t -force_lib "devel/sage-main/sage/modules/free_module_element.pyx"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/modules/free_module_element.pyx", line 2487:
    sage: answers
Expected:
    [(0.5, 5.5511151231257843e-15, 21, 0),
    (0.33333333333333343, 3.7007434154171903e-15, 21, 0),
    (0.45969769413186018, 5.1036696439228408e-15, 21, 0)]
Got:
    [(0.5, 5.5511151231257843e-15, 21, 0), (0.33333333333333337, 3.7007434154171903e-15, 21, 0), (0.45969769413186023, 5.1036696439228408e-15, 21, 0)]
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/modules/free_module_element.pyx", line 2493:
    sage: r.nintegral(t,0,1)
Expected:
    ((0.5, 0.0, 1.0),
    {0: (0.5, 5.5511151231257843e-15, 21, 0),
    2: (1.0, 1.110223024625157e-14, 21, 0)})
Got:
    ((0.5, 0.0, 1.0), {0: (0.5, 5.5511151231257843e-15, 21, 0), 2: (1.0, 1.1102230246251569e-14, 21, 0)})
**********************************************************************
1 items had failures:
   2 of  10 in __main__.example_70
```
formatting and numeric noise

```
sage -t -force_lib "devel/sage-main/sage/interfaces/lisp.py"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/interfaces/lisp.py", line 378:
    sage: lisp.function_call('sin', ['2'])
Expected:
    0.90929741
Got:
    0.9092974
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/interfaces/lisp.py", line 380:
    sage: lisp.sin(2)
Expected:
    0.90929741
Got:
    0.9092974
**********************************************************************
1 items had failures:
   2 of   4 in __main__.example_23
```
Numeric noise

```
sage -t -force_lib "devel/sage-main/sage/interfaces/maxima.py"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py", line 934:
    sage: maxima.example('arrays')
Expected:
    a[n]:=n*a[n-1]
                                    a  := n a
                                     n       n - 1
    a[0]:1
    a[5]
                                          120
    a[n]:=n
    a[6]
                                           6
    a[4]
                                          24
                                         done
Got:
                                    a  := n a
                                     n       n - 1
    a[0]:1
    a[5]
                                          120
    a[n]:=n
    a[6]
                                           6
    a[4]
                                          24
                                         done
    <BLANKLINE>
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py", line 1128:
    sage: f(3.2)
Expected:
    -.05837414342758009
Got:
    -.058374143427580086
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py", line 1925:
    sage: a = maxima('sqrt(2)').numer(); a
Expected:
    1.414213562373095
Got:
    1.4142135623730951
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py", line 2077:
    sage: maxima('exp(-sqrt(x))').nintegral('x',0,1)
Expected:
    (.5284822353142306, 4.163314137883845e-11, 231, 0)
Got:
    (.5284822353142306, 4.1633141378838445e-11, 231, 0)
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py", line 2131:
    sage: f.numer()
Expected:
    1.462651745907182
Got:
    1.4626517459071817
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/interfaces/maxima.py", line 2251:
    sage: maxima('sqrt(2) + I').comma('numer')
Expected:
    I+1.414213562373095
Got:
    I+1.4142135623730951
**********************************************************************
```
Numerical and format. The first one should be closely looked at.

```
sage -t -force_lib "devel/sage-main/sage/symbolic/integration/integral.py"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/symbolic/integration/integral.py", line 541:
    sage: integrate( (F(x)-G(x))^2, x, -infinity, infinity).n()
Expected:
    0
Got:
    -6.26376265908397e-17
**********************************************************************
```
Numerical noise.

```
sage -t -force_lib "devel/sage-main/sage/symbolic/expression.pyx"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/symbolic/expression.pyx", line 5517:
    sage: maxima('cosh(1.0)')
Expected:
    1.543080634815244
Got:
    1.5430806348152437
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/symbolic/expression.pyx", line 5626:
    sage: maxima('asinh(2.0)')
Expected:
    1.44363547517881
Got:
    1.4436354751788103
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/symbolic/expression.pyx", line 5680:
    sage: maxima('acosh(0.5)')
Expected:
    1.047197551196598*%i
Got:
    1.0471975511965979*%i
**********************************************************************
```
Numerical noise

```
sage -t -force_lib "devel/sage-main/sage/calculus/calculus.py"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/calculus.py", line 677:
    sage: f.nintegrate(x,0,1)
Expected:
    (-480.00000000000011, 5.3290705182007538e-12, 21, 0)
Got:
    (-480.00000000000006, 5.3290705182007538e-12, 21, 0)
**********************************************************************
```
Numerical noise.
Same as reported by David on sage-devel. It all should be straightforward if tedious.



---

archive/issue_comments_105608.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nOnly 4 lines of to comment out for that particular one.\n\n```\nmaxima --very-quiet -r \"example(\"arrays\");\"\n;;; Loading #P\"/usr/lib64/ecl-11.1.1/sb-bsd-sockets.fas\"\n;;; Loading #P\"/usr/lib64/ecl-11.1.1/sockets.fas\"\n;;; Loading #P\"/usr/lib64/ecl-11.1.1/defsystem.fas\"\n;;; Loading #P\"/usr/lib64/ecl-11.1.1/cmp.fas\"\na[n]:=n*a[n-1]\n                                a  := n a\n                                 n       n - 1\na[0]:1\na[5]\n                                      120\na[n]:=n\na[6]\n                                       6\na[4]\n                                      24\n                                     done\n```\nwith ecl-10.4.1\n\n```\nmaxima --very-quiet -r \"example(\"arrays\");\"\n;;; Loading #P\"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/SB-BSD-SOCKETS.fas\"\n;;; Loading #P\"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/SOCKETS.fas\"\n;;; Loading #P\"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/DEFSYSTEM.fas\"\n;;; Loading #P\"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/cmp.fas\"\n;;; Loading #P\"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/sysfun.lsp\"\na[n]:=n*a[n-1]\n                                a  := n a\n                                 n       n - 1\na[0]:1\na[5]\n                                      120\na[n]:=n\na[6]\n                                       6\na[4]\n                                      24\n                                     done\n```",
    "created_at": "2011-02-10T22:31:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105608",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'>Comment 2:</a>
Only 4 lines of to comment out for that particular one.

```
maxima --very-quiet -r "example("arrays");"
;;; Loading #P"/usr/lib64/ecl-11.1.1/sb-bsd-sockets.fas"
;;; Loading #P"/usr/lib64/ecl-11.1.1/sockets.fas"
;;; Loading #P"/usr/lib64/ecl-11.1.1/defsystem.fas"
;;; Loading #P"/usr/lib64/ecl-11.1.1/cmp.fas"
a[n]:=n*a[n-1]
                                a  := n a
                                 n       n - 1
a[0]:1
a[5]
                                      120
a[n]:=n
a[6]
                                       6
a[4]
                                      24
                                     done
```
with ecl-10.4.1

```
maxima --very-quiet -r "example("arrays");"
;;; Loading #P"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/SB-BSD-SOCKETS.fas"
;;; Loading #P"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/SOCKETS.fas"
;;; Loading #P"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/DEFSYSTEM.fas"
;;; Loading #P"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/cmp.fas"
;;; Loading #P"/Users/frb15/Desktop/Gentoo/usr/lib/ecl-10.4.1/sysfun.lsp"
a[n]:=n*a[n-1]
                                a  := n a
                                 n       n - 1
a[0]:1
a[5]
                                      120
a[n]:=n
a[6]
                                       6
a[4]
                                      24
                                     done
```



---

archive/issue_comments_105609.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nSince a serious problem has been reported with ECL 11.1.1 with both the version of Maxima currently in Sage (5.21.1) as well as the latest Maxima (5.23.2)\n\nhttp://www.math.utexas.edu/pipermail/maxima/2011/023868.html\n\nwe should probably postpone this until a fix is known.",
    "created_at": "2011-02-10T23:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105609",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:3'>Comment 3:</a>
Since a serious problem has been reported with ECL 11.1.1 with both the version of Maxima currently in Sage (5.21.1) as well as the latest Maxima (5.23.2)

http://www.math.utexas.edu/pipermail/maxima/2011/023868.html

we should probably postpone this until a fix is known.



---

archive/issue_comments_105610.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nIf you want to wait rather than fixing maxima that's fine. In the meantime I just finished a patch set. So I am attaching it for future reference.",
    "created_at": "2011-02-10T23:34:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105610",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'>Comment 4:</a>
If you want to wait rather than fixing maxima that's fine. In the meantime I just finished a patch set. So I am attaching it for future reference.



---

archive/issue_comments_105611.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nThere is apparently a fix in ECL's CVS for this. \n\nhttp://www.mail-archive.com/ecls-list@lists.sourceforge.net/msg00671.html\n\nand was due to a typo by the ECL developer. So it should be possible to upgrade ECL to the latest version after the doctest problems are resolved.  \n\nDave",
    "created_at": "2011-02-10T23:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105611",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:5'>Comment 5:</a>
There is apparently a fix in ECL's CVS for this. 

http://www.mail-archive.com/ecls-list@lists.sourceforge.net/msg00671.html

and was due to a typo by the ECL developer. So it should be possible to upgrade ECL to the latest version after the doctest problems are resolved.  

Dave



---

archive/issue_comments_105612.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n The latest version of the Lisp interpreter ECL, (which is used by Maxima) is 11.1.1, but the version of ECL in Sage is 10.4.1. \n \n-Version 10.4.1 is the source of one really major problem on 64-bit OpenSolaris (see #9840), as it stops ECL building at all. This stops Sage building as a 64-bit application. \n+Version 10.4.1 is the source of one really major problem on 64-bit OpenSolaris (see #9840), as it creates a broken library libecl.so, which can't be linked to. This stops Sage building as a 64-bit application. \n \n The failure of ECL to build is due to non-PIC code being present, which itself was the result of the use of a GCC extension of \"computed gotos\" using in the ECL source code. \n \n``````\n",
    "created_at": "2011-02-11T00:00:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105612",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 The latest version of the Lisp interpreter ECL, (which is used by Maxima) is 11.1.1, but the version of ECL in Sage is 10.4.1. 
 
-Version 10.4.1 is the source of one really major problem on 64-bit OpenSolaris (see #9840), as it stops ECL building at all. This stops Sage building as a 64-bit application. 
+Version 10.4.1 is the source of one really major problem on 64-bit OpenSolaris (see #9840), as it creates a broken library libecl.so, which can't be linked to. This stops Sage building as a 64-bit application. 
 
 The failure of ECL to build is due to non-PIC code being present, which itself was the result of the use of a GCC extension of "computed gotos" using in the ECL source code. 
 
``````




---

archive/issue_comments_105613.json:
```json
{
    "body": "Attachment: **[trac_10766-fix_doctest.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_doctest.patch.gz)**\n\npatch to fix the doctest due to ecl-11.1.1 upgrade",
    "created_at": "2011-02-11T01:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105613",
    "user": "https://github.com/kiwifb"
}
```

Attachment: **[trac_10766-fix_doctest.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_doctest.patch.gz)**

patch to fix the doctest due to ecl-11.1.1 upgrade



---

archive/issue_comments_105614.json:
```json
{
    "body": "Attachment: **[trac_10766-fix_symbolic_integration_integral.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_symbolic_integration_integral.patch.gz)**\n\nForgotten one doctest",
    "created_at": "2011-02-11T01:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105614",
    "user": "https://github.com/kiwifb"
}
```

Attachment: **[trac_10766-fix_symbolic_integration_integral.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_symbolic_integration_integral.patch.gz)**

Forgotten one doctest



---

archive/issue_comments_105615.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nCorrected patch for white space problems and found I had forgotten one doctest.\nThere is an interesting change in behaviour here. In the old test we have\n\n```\n        sage: integrate( ((F(x)-G(x))^2).expand(), x, -infinity, infinity).n()\n        -6.26376265908397e-17\n        sage: integrate( (F(x)-G(x))^2, x, -infinity, infinity).n()\n        0\n```\nBut in the new one the results are not different, expansion or not. So the expression is probably always expanded now.",
    "created_at": "2011-02-11T01:20:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105615",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'>Comment 7:</a>
Corrected patch for white space problems and found I had forgotten one doctest.
There is an interesting change in behaviour here. In the old test we have

```
        sage: integrate( ((F(x)-G(x))^2).expand(), x, -infinity, infinity).n()
        -6.26376265908397e-17
        sage: integrate( (F(x)-G(x))^2, x, -infinity, infinity).n()
        0
```
But in the new one the results are not different, expansion or not. So the expression is probably always expanded now.



---

archive/issue_comments_105616.json:
```json
{
    "body": "Attachment: **[ecls-11.1.1-cmploc.lisp.patch.gz](https://github.com/sagemath/sage/files/ticket10766/ecls-11.1.1-cmploc.lisp.patch.gz)**\n\npatch for ecl",
    "created_at": "2011-02-12T08:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105616",
    "user": "https://github.com/kiwifb"
}
```

Attachment: **[ecls-11.1.1-cmploc.lisp.patch.gz](https://github.com/sagemath/sage/files/ticket10766/ecls-11.1.1-cmploc.lisp.patch.gz)**

patch for ecl



---

archive/issue_comments_105617.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nAdded the patch correcting the problem reported earlier. I got it for the following\ncommit [http://ecls.git.sourceforge.net/git/gitweb.cgi?p=ecls/ecl;a=commit;h=ce19c67a1b9f63cd232e7c0a621b6ca87aaa7214](http://ecls.git.sourceforge.net/git/gitweb.cgi?p=ecls/ecl;a=commit;h=ce19c67a1b9f63cd232e7c0a621b6ca87aaa7214)",
    "created_at": "2011-02-12T08:40:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105617",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'>Comment 8:</a>
Added the patch correcting the problem reported earlier. I got it for the following
commit [http://ecls.git.sourceforge.net/git/gitweb.cgi?p=ecls/ecl;a=commit;h=ce19c67a1b9f63cd232e7c0a621b6ca87aaa7214](http://ecls.git.sourceforge.net/git/gitweb.cgi?p=ecls/ecl;a=commit;h=ce19c67a1b9f63cd232e7c0a621b6ca87aaa7214)



---

archive/issue_comments_105618.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@kiwifb](#comment%3A8):\n> Added the patch correcting the problem reported earlier. I got it for the following\n> commit [http://ecls.git.sourceforge.net/git/gitweb.cgi?p=ecls/ecl;a=commit;h=ce19c67a1b9f63cd232e7c0a621b6ca87aaa7214](http://ecls.git.sourceforge.net/git/gitweb.cgi?p=ecls/ecl;a=commit;h=ce19c67a1b9f63cd232e7c0a621b6ca87aaa7214)\n\nCan you explain how you convert that git patch to one using GNU patch that can be used to update the package - since we have now agreed to make GNU patch a standard package, we should use that to update the file and not use 'cp' as before. \n\nCan you post an spkg for review. \n\nI've created a ticket for the Maxima upgrade (#10773) and have posted an .spkg on that ticket, which now needs review. \n\nDave",
    "created_at": "2011-02-12T11:19:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105618",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@kiwifb](#comment%3A8):
> Added the patch correcting the problem reported earlier. I got it for the following
> commit [http://ecls.git.sourceforge.net/git/gitweb.cgi?p=ecls/ecl;a=commit;h=ce19c67a1b9f63cd232e7c0a621b6ca87aaa7214](http://ecls.git.sourceforge.net/git/gitweb.cgi?p=ecls/ecl;a=commit;h=ce19c67a1b9f63cd232e7c0a621b6ca87aaa7214)

Can you explain how you convert that git patch to one using GNU patch that can be used to update the package - since we have now agreed to make GNU patch a standard package, we should use that to update the file and not use 'cp' as before. 

Can you post an spkg for review. 

I've created a ticket for the Maxima upgrade (#10773) and have posted an .spkg on that ticket, which now needs review. 

Dave



---

archive/issue_comments_105619.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nOK, I will put things in motion to upload an spkg. The patch I posted works fairly well with GNU patch as far as I am concerned. But path may need adjusting to follow standard sage procedure. I'll to look up a spkg that uses patch to make sure.",
    "created_at": "2011-02-12T20:17:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105619",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'>Comment 10:</a>
OK, I will put things in motion to upload an spkg. The patch I posted works fairly well with GNU patch as far as I am concerned. But path may need adjusting to follow standard sage procedure. I'll to look up a spkg that uses patch to make sure.



---

archive/issue_comments_105620.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThe new spkg can be found here:\n[http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg](http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg)\n\nTwo more things to really think about: what to do about the symbolic/integration/integral.py test and should we add a test to make sure that the problem solved by the included patch is/stay fixed.",
    "created_at": "2011-02-13T08:19:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105620",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'>Comment 11:</a>
The new spkg can be found here:
[http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg](http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg)

Two more things to really think about: what to do about the symbolic/integration/integral.py test and should we add a test to make sure that the problem solved by the included patch is/stay fixed.



---

archive/issue_comments_105621.json:
```json
{
    "body": "Attachment: **[ecl-11.1.1-update.patch.gz](https://github.com/sagemath/sage/files/ticket10766/ecl-11.1.1-update.patch.gz)**\n\nshow changes to SPKG.txt, spkg-install and the patch for reviewer only - do not apply.",
    "created_at": "2011-02-13T08:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105621",
    "user": "https://github.com/kiwifb"
}
```

Attachment: **[ecl-11.1.1-update.patch.gz](https://github.com/sagemath/sage/files/ticket10766/ecl-11.1.1-update.patch.gz)**

show changes to SPKG.txt, spkg-install and the patch for reviewer only - do not apply.



---

archive/issue_comments_105622.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nCurrently testing the ECL/Maxima update here on OS X 10.4 PPC.  \n\nJust a couple questions - most doctests seem to be fixed with ellipses, but a couple not.  Any particular reason?  Also, have these been checked on sage.math or some other Linux system, or an Intel system?  Just curious.\n\nAlso, the last patch has the same type of issue as has been raised on sage-devel in the past about 0 versus very small epsilon.  I don't know if it's worth bothering about, but anyway in case someone remembers what has been done with such in the past...",
    "created_at": "2011-02-14T13:46:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105622",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'>Comment 13:</a>
Currently testing the ECL/Maxima update here on OS X 10.4 PPC.  

Just a couple questions - most doctests seem to be fixed with ellipses, but a couple not.  Any particular reason?  Also, have these been checked on sage.math or some other Linux system, or an Intel system?  Just curious.

Also, the last patch has the same type of issue as has been raised on sage-devel in the past about 0 versus very small epsilon.  I don't know if it's worth bothering about, but anyway in case someone remembers what has been done with such in the past...



---

archive/issue_comments_105623.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@kcrisman](#comment%3A13):\n> Currently testing the ECL/Maxima update here on OS X 10.4 PPC.  \n\nGood. Let us know how you got on. \n\n> Just a couple questions - most doctests seem to be fixed with ellipses, but a couple not.  Any particular reason?  Also, have these been checked on sage.math or some other Linux system, or an Intel system?  Just curious.\n\nThese ellipses really bother me, as very often we permit changes 1000 or more times greater than necessary. If we expect `1.82`, but a system gives `1.81999999999999` then changing the doctest to `1.8...` is just permitting differences **far** greater than we have observed. That would cause `1.85` to pass, which seems stupid to me, but it seems to be the Sage way of doing things. As such, I think the doctest changes are ok. \n\nFrancois checked on an Intel Linux system and got the same results as me on an Intel OpenSolaris system. We have not to my knowledge checked on any other Intel system, such as sage.math. \n\nIf anything, I would have expected numerical issues to show up on the SPARC processor, as the floating point processor is very different to AMD/Intel. However, there are no issues on SPARC - I checked on t2.math. \n\nI think this is a case of where the buildbot can be useful - just test on all machines and note any issues. \n\n> Also, the last patch has the same type of issue as has been raised on sage-devel in the past about 0 versus very small epsilon.  I don't know if it's worth bothering about, but anyway in case someone remembers what has been done with such in the past...\n\nI don't have a strong opinion on this. I think such small numbers can be expected. I think we should report this to the ECL list, as it was the ECL update which caused this, not the Maxima upgrade. But unless the ECL developers acknowledges a bug and fixes it, I would just leave it as it is now.",
    "created_at": "2011-02-14T15:51:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105623",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@kcrisman](#comment%3A13):
> Currently testing the ECL/Maxima update here on OS X 10.4 PPC.  

Good. Let us know how you got on. 

> Just a couple questions - most doctests seem to be fixed with ellipses, but a couple not.  Any particular reason?  Also, have these been checked on sage.math or some other Linux system, or an Intel system?  Just curious.

These ellipses really bother me, as very often we permit changes 1000 or more times greater than necessary. If we expect `1.82`, but a system gives `1.81999999999999` then changing the doctest to `1.8...` is just permitting differences **far** greater than we have observed. That would cause `1.85` to pass, which seems stupid to me, but it seems to be the Sage way of doing things. As such, I think the doctest changes are ok. 

Francois checked on an Intel Linux system and got the same results as me on an Intel OpenSolaris system. We have not to my knowledge checked on any other Intel system, such as sage.math. 

If anything, I would have expected numerical issues to show up on the SPARC processor, as the floating point processor is very different to AMD/Intel. However, there are no issues on SPARC - I checked on t2.math. 

I think this is a case of where the buildbot can be useful - just test on all machines and note any issues. 

> Also, the last patch has the same type of issue as has been raised on sage-devel in the past about 0 versus very small epsilon.  I don't know if it's worth bothering about, but anyway in case someone remembers what has been done with such in the past...

I don't have a strong opinion on this. I think such small numbers can be expected. I think we should report this to the ECL list, as it was the ECL update which caused this, not the Maxima upgrade. But unless the ECL developers acknowledges a bug and fixes it, I would just leave it as it is now.



---

archive/issue_comments_105624.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nAs far as I'm aware, all the issues are resolved, so this is due for review. I'm personally happy with it, but lets see what happens on PPC before giving it a positive review. If PPC passes ok, then I suggest this gets a positive review. \n\nIn the event there are issues on one of the buildbot machines, which includes sage.math, we will be made aware of it. There seems no point in testing on lots of machines now, when the buildbot can do it with far less effort. \n\nDave",
    "created_at": "2011-02-14T16:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105624",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:15'>Comment 15:</a>
As far as I'm aware, all the issues are resolved, so this is due for review. I'm personally happy with it, but lets see what happens on PPC before giving it a positive review. If PPC passes ok, then I suggest this gets a positive review. 

In the event there are issues on one of the buildbot machines, which includes sage.math, we will be made aware of it. There seems no point in testing on lots of machines now, when the buildbot can do it with far less effort. 

Dave



---

archive/issue_comments_105625.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey**",
    "created_at": "2011-02-14T16:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105625",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Author: **Fran√ßois Bissey**



---

archive/issue_comments_105626.json:
```json
{
    "body": "Reviewer: **David Kirkby**",
    "created_at": "2011-02-14T16:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105626",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Reviewer: **David Kirkby**



---

archive/issue_events_125470.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-02-14T16:14:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125470"
}
```



---

archive/issue_comments_105627.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,12 +2,14 @@\n \n Version 10.4.1 is the source of one really major problem on 64-bit OpenSolaris (see #9840), as it creates a broken library libecl.so, which can't be linked to. This stops Sage building as a 64-bit application. \n \n-The failure of ECL to build is due to non-PIC code being present, which itself was the result of the use of a GCC extension of \"computed gotos\" using in the ECL source code. \n+The failure of ECL to build a fully functional 64-bit library is due to non-PIC code being present, which itself was the result of the use of a GCC extension of \"computed gotos\" in the ECL source code. \n \n http://gcc.gnu.org/onlinedocs/gcc-4.5.2/gcc/Labels-as-Values.html\n \n The updated ECL avoids this GCC extension on Solaris, with a result the library has no text relocation issues. \n \n-I'll create a new .spkg later. \n+An updated .spkg can be found at:\n+\n+http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg\n \n Dave \n``````\n",
    "created_at": "2011-02-14T17:49:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105627",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,12 +2,14 @@
 
 Version 10.4.1 is the source of one really major problem on 64-bit OpenSolaris (see #9840), as it creates a broken library libecl.so, which can't be linked to. This stops Sage building as a 64-bit application. 
 
-The failure of ECL to build is due to non-PIC code being present, which itself was the result of the use of a GCC extension of "computed gotos" using in the ECL source code. 
+The failure of ECL to build a fully functional 64-bit library is due to non-PIC code being present, which itself was the result of the use of a GCC extension of "computed gotos" in the ECL source code. 
 
 http://gcc.gnu.org/onlinedocs/gcc-4.5.2/gcc/Labels-as-Values.html
 
 The updated ECL avoids this GCC extension on Solaris, with a result the library has no text relocation issues. 
 
-I'll create a new .spkg later. 
+An updated .spkg can be found at:
+
+http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg
 
 Dave 
``````




---

archive/issue_comments_105628.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,8 +8,9 @@\n \n The updated ECL avoids this GCC extension on Solaris, with a result the library has no text relocation issues. \n \n-An updated .spkg can be found at:\n+An updated .spkg for ECL can be found at:\n \n http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg\n \n+It is also necessary to update Maxima at the same time. The ticket for Maxima is #10773 which already has positive review. \n Dave \n``````\n",
    "created_at": "2011-02-14T17:52:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105628",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,8 +8,9 @@
 
 The updated ECL avoids this GCC extension on Solaris, with a result the library has no text relocation issues. 
 
-An updated .spkg can be found at:
+An updated .spkg for ECL can be found at:
 
 http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg
 
+It is also necessary to update Maxima at the same time. The ticket for Maxima is #10773 which already has positive review. 
 Dave 
``````




---

archive/issue_comments_105629.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nYeah, I looked at the few changes and our patch, and all seems in order.  I don't have a problem with any of the doctest changes either, but thought I'd ask since opinions may differ.  Passes as many relevant tests as I had time to ask it to do today.",
    "created_at": "2011-02-14T19:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105629",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'>Comment 19:</a>
Yeah, I looked at the few changes and our patch, and all seems in order.  I don't have a problem with any of the doctest changes either, but thought I'd ask since opinions may differ.  Passes as many relevant tests as I had time to ask it to do today.



---

archive/issue_events_125471.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-02-14T19:11:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125471"
}
```



---

archive/issue_events_125472.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-02-14T19:11:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125472"
}
```



---

archive/issue_comments_105630.json:
```json
{
    "body": "Changed reviewer from **David Kirkby** to **David Kirkby, Karl-Dieter Crisman**",
    "created_at": "2011-02-14T19:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105630",
    "user": "https://github.com/kcrisman"
}
```

Changed reviewer from **David Kirkby** to **David Kirkby, Karl-Dieter Crisman**



---

archive/issue_comments_105631.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nChanging milestone in the hopes it will get in for 4.7 :)",
    "created_at": "2011-02-14T19:12:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105631",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:20'>Comment 20:</a>
Changing milestone in the hopes it will get in for 4.7 :)



---

archive/issue_events_125473.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-02-14T19:12:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125473"
}
```



---

archive/issue_events_125474.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-02-14T19:12:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125474"
}
```



---

archive/issue_comments_105632.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nSince I have put them I think I should explain my choices of ellipses (or not).\n\nFirst we are doing numerical computation here, and as far as I can see, not in arbitrary precision. In that context having a lot of significant figures is usually useless. It just test your FPU and your implementation. So for example we now have\n1.5430806348152437 instead of \n\n1.543080634815244, big deal, next iteration will probably have something different there, it may very well revert to print one less decimal which is probably the only difference here. If we had printed as many decimals with the old ecl we may have had the same result. By putting ellipses here I am taking away the last few significant figures which are quite possibly arbitrary. I guess I could check with wolfram alpha at an arbitrary precision as well.\n\nIf we had something like 1.85 and 1.849999999 that would more problematic. But it is a symptom of the fact that we probably should just test a number of significant figures. Instead of having the raw results print 10 significant figures for example, more if you do arbitrary precision computations.\n\nFor this one I put the exact answer returned by maxima:\n\n```\nsage -t -force_lib \"devel/sage-main/sage/calculus/calculus.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/calculus.py\", line 677:\n    sage: f.nintegrate(x,0,1)\nExpected:\n    (-480.00000000000011, 5.3290705182007538e-12, 21, 0)\nGot:\n    (-480.00000000000006, 5.3290705182007538e-12, 21, 0)\n**********************************************************************\n```\nI did that because of the text that goes with the test:\n\n```\n    Despite appearance, `f` is really very close to 0, but one\n    gets a nonzero value since the definition of\n    ``float(f)`` is that it makes all constants inside the\n    expression floats, then evaluates each function and each arithmetic\n    operation using float arithmetic::\n\n        sage: float(f)\n        -480.0\n\n    Computing to higher precision we see the truth::\n\n        sage: f.n(200)\n        -7.4992740280181431112064614366622348652078895136533593355718e-13\n        sage: f.n(300)\n        -7.49927402801814311120646143662663009137292462589621789352095066181709095575681963967103004e-13\n\n    Now numerically integrating, we see why the answer is wrong::\n\n        sage: f.nintegrate(x,0,1)\n        (-480.00000000000006, 5.3290705182007538e-12, 21, 0)\n\n    It is just because every floating point evaluation of return -480.0\n    in floating point.\n```\nI thought it would be best to have the exact value. However anything starting with -480.00 would clearly have been good enough.\n\nThe test in symbolic/integration/integral.py is more interesting. It documented a behavior of ecl/maxima when you used \".expand\" or not and the influence it had on results, before the patch:\n\n```\n    Check if #6189 is fixed (which, by the way, also\n    demonstrates it's not always good to expand)::\n\n        sage: n = N; n\n        <function numerical_approx at ...>\n        sage: F(x) = 1/sqrt(2*pi*1^2)*exp(-1/(2*1^2)*(x-0)^2)\n        sage: G(x) = 1/sqrt(2*pi*n(1)^2)*exp(-1/(2*n(1)^2)*(x-n(0))^2)\n        sage: integrate( (F(x)-F(x))^2, x, -infinity, infinity).n()\n        0.000000000000000\n        sage: integrate( ((F(x)-G(x))^2).expand(), x, -infinity, infinity).n()\n        -6.26376265908397e-17\n        sage: integrate( (F(x)-G(x))^2, x, -infinity, infinity).n()\n        0\n```\nNow the result is the same whether we expand or not. So the test is \n\n1) moot\n\n2) virtually reopen #6189 since we now always have a non-zero result\n\nI think for this one we need a better example and a way of making this integral behave.\n\nIn summary most of the numerical noise observed is due to the fact that ecl-11.1.1 print one more decimal place by default. Because this may change and the level of precision doesn't make any sense for most purpose I decided to put ellipses. The more juicy bits where I didn't do that are open to interesting discussion.",
    "created_at": "2011-02-14T22:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105632",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'>Comment 21:</a>
Since I have put them I think I should explain my choices of ellipses (or not).

First we are doing numerical computation here, and as far as I can see, not in arbitrary precision. In that context having a lot of significant figures is usually useless. It just test your FPU and your implementation. So for example we now have
1.5430806348152437 instead of 

1.543080634815244, big deal, next iteration will probably have something different there, it may very well revert to print one less decimal which is probably the only difference here. If we had printed as many decimals with the old ecl we may have had the same result. By putting ellipses here I am taking away the last few significant figures which are quite possibly arbitrary. I guess I could check with wolfram alpha at an arbitrary precision as well.

If we had something like 1.85 and 1.849999999 that would more problematic. But it is a symptom of the fact that we probably should just test a number of significant figures. Instead of having the raw results print 10 significant figures for example, more if you do arbitrary precision computations.

For this one I put the exact answer returned by maxima:

```
sage -t -force_lib "devel/sage-main/sage/calculus/calculus.py"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/calculus.py", line 677:
    sage: f.nintegrate(x,0,1)
Expected:
    (-480.00000000000011, 5.3290705182007538e-12, 21, 0)
Got:
    (-480.00000000000006, 5.3290705182007538e-12, 21, 0)
**********************************************************************
```
I did that because of the text that goes with the test:

```
    Despite appearance, `f` is really very close to 0, but one
    gets a nonzero value since the definition of
    ``float(f)`` is that it makes all constants inside the
    expression floats, then evaluates each function and each arithmetic
    operation using float arithmetic::

        sage: float(f)
        -480.0

    Computing to higher precision we see the truth::

        sage: f.n(200)
        -7.4992740280181431112064614366622348652078895136533593355718e-13
        sage: f.n(300)
        -7.49927402801814311120646143662663009137292462589621789352095066181709095575681963967103004e-13

    Now numerically integrating, we see why the answer is wrong::

        sage: f.nintegrate(x,0,1)
        (-480.00000000000006, 5.3290705182007538e-12, 21, 0)

    It is just because every floating point evaluation of return -480.0
    in floating point.
```
I thought it would be best to have the exact value. However anything starting with -480.00 would clearly have been good enough.

The test in symbolic/integration/integral.py is more interesting. It documented a behavior of ecl/maxima when you used ".expand" or not and the influence it had on results, before the patch:

```
    Check if #6189 is fixed (which, by the way, also
    demonstrates it's not always good to expand)::

        sage: n = N; n
        <function numerical_approx at ...>
        sage: F(x) = 1/sqrt(2*pi*1^2)*exp(-1/(2*1^2)*(x-0)^2)
        sage: G(x) = 1/sqrt(2*pi*n(1)^2)*exp(-1/(2*n(1)^2)*(x-n(0))^2)
        sage: integrate( (F(x)-F(x))^2, x, -infinity, infinity).n()
        0.000000000000000
        sage: integrate( ((F(x)-G(x))^2).expand(), x, -infinity, infinity).n()
        -6.26376265908397e-17
        sage: integrate( (F(x)-G(x))^2, x, -infinity, infinity).n()
        0
```
Now the result is the same whether we expand or not. So the test is 

1) moot

2) virtually reopen #6189 since we now always have a non-zero result

I think for this one we need a better example and a way of making this integral behave.

In summary most of the numerical noise observed is due to the fact that ecl-11.1.1 print one more decimal place by default. Because this may change and the level of precision doesn't make any sense for most purpose I decided to put ellipses. The more juicy bits where I didn't do that are open to interesting discussion.



---

archive/issue_comments_105633.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\n## Note to the release manager\n\nThis must be merged with #10773, which updates Maxima. Updating just Maxima or just ECL will cause problems - they must be done together. \n\nDave",
    "created_at": "2011-02-15T01:24:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105633",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:22'>Comment 22:</a>
## Note to the release manager

This must be merged with #10773, which updates Maxima. Updating just Maxima or just ECL will cause problems - they must be done together. 

Dave



---

archive/issue_comments_105634.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nTo my knowledge 4.6.2 is not in any sort of \"feature freeze\" yet, with no release candidates released - only alphas. So I've set this back to 4.6.2. I've asked on sage-devel if it can go in 4.6.2, but so far no response.",
    "created_at": "2011-02-15T09:07:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105634",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:23'>Comment 23:</a>
To my knowledge 4.6.2 is not in any sort of "feature freeze" yet, with no release candidates released - only alphas. So I've set this back to 4.6.2. I've asked on sage-devel if it can go in 4.6.2, but so far no response.



---

archive/issue_events_125475.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-02-15T09:07:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125475"
}
```



---

archive/issue_events_125476.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-02-15T09:07:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125476"
}
```



---

archive/issue_comments_105635.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nI installed the new ECL and Maxima spkgs and related patches and ran \"make ptest\" (running on Ubuntu 10.10, intel x86_64) and everything was fine.",
    "created_at": "2011-02-15T11:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105635",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:24'>Comment 24:</a>
I installed the new ECL and Maxima spkgs and related patches and ran "make ptest" (running on Ubuntu 10.10, intel x86_64) and everything was fine.



---

archive/issue_events_125477.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-15T13:23:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125477"
}
```



---

archive/issue_events_125478.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-15T13:23:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125478"
}
```



---

archive/issue_comments_105636.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nMy bad, I meant everything was ok after successfully building Maxima.\n\nTo build Maxima, I need to install texinfo package on my system.\n\nAfterwards everything runs fine.\n\nSorry for the misunderstanding.",
    "created_at": "2011-02-15T13:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105636",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:26'>Comment 26:</a>
My bad, I meant everything was ok after successfully building Maxima.

To build Maxima, I need to install texinfo package on my system.

Afterwards everything runs fine.

Sorry for the misunderstanding.



---

archive/issue_comments_105637.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [drkirkby](#comment%3A23):\n> To my knowledge 4.6.2 is not in any sort of \"feature freeze\" yet, with no release candidates released - only alphas.\n\nsage-4.6.2.rc0 is scheduled to be tested any time now.  So I would rather not merge this in the 4.6.2 cycle (unless you give me a very good reason).",
    "created_at": "2011-02-15T13:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105637",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [drkirkby](#comment%3A23):
> To my knowledge 4.6.2 is not in any sort of "feature freeze" yet, with no release candidates released - only alphas.

sage-4.6.2.rc0 is scheduled to be tested any time now.  So I would rather not merge this in the 4.6.2 cycle (unless you give me a very good reason).



---

archive/issue_comments_105638.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nReplying to [@jdemeyer](#comment%3A27):\n> Replying to [drkirkby](#comment%3A23):\n> > To my knowledge 4.6.2 is not in any sort of \"feature freeze\" yet, with no release candidates released - only alphas.\n\nTrue, but...\n> sage-4.6.2.rc0 is scheduled to be tested any time now.  So I would rather not merge this in the 4.6.2 cycle (unless you give me a very good reason).\n\nUsually spkg upgrades are best for early in the cycle, I agree, especially ones like Maxima that have a fair amount of use.  I'm sure this will be first up in 4.7 - assuming we can get the texinfo issue resolved.",
    "created_at": "2011-02-15T13:57:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105638",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:28'>Comment 28:</a>
Replying to [@jdemeyer](#comment%3A27):
> Replying to [drkirkby](#comment%3A23):
> > To my knowledge 4.6.2 is not in any sort of "feature freeze" yet, with no release candidates released - only alphas.

True, but...
> sage-4.6.2.rc0 is scheduled to be tested any time now.  So I would rather not merge this in the 4.6.2 cycle (unless you give me a very good reason).

Usually spkg upgrades are best for early in the cycle, I agree, especially ones like Maxima that have a fair amount of use.  I'm sure this will be first up in 4.7 - assuming we can get the texinfo issue resolved.



---

archive/issue_events_125479.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-18T08:44:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125479"
}
```



---

archive/issue_events_125480.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-18T08:44:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages",
    "label_color": "000080",
    "label_name": "component: packages",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125480"
}
```



---

archive/issue_comments_105639.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,9 +8,9 @@\n \n The updated ECL avoids this GCC extension on Solaris, with a result the library has no text relocation issues. \n \n-An updated .spkg for ECL can be found at:\n+**Apply:**\n+1. The new spkg [http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg](http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg)\n+2. [attachment: trac_10766-fix_doctest.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_doctest.patch.gz)\n+3. [attachment: trac_10766-fix_symbolic_integration_integral.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_symbolic_integration_integral.patch.gz)\n \n-http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg\n-\n-It is also necessary to update Maxima at the same time. The ticket for Maxima is #10773 which already has positive review. \n-Dave \n+It is also necessary to update Maxima at the same time. The ticket for Maxima is #10773 which already has positive review.\n``````\n",
    "created_at": "2011-02-22T16:44:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105639",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,9 +8,9 @@
 
 The updated ECL avoids this GCC extension on Solaris, with a result the library has no text relocation issues. 
 
-An updated .spkg for ECL can be found at:
+**Apply:**
+1. The new spkg [http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg](http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg)
+2. [attachment: trac_10766-fix_doctest.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_doctest.patch.gz)
+3. [attachment: trac_10766-fix_symbolic_integration_integral.patch.gz](https://github.com/sagemath/sage/files/ticket10766/trac_10766-fix_symbolic_integration_integral.patch.gz)
 
-http://spkg-upload.googlecode.com/files/ecl-11.1.1.spkg
-
-It is also necessary to update Maxima at the same time. The ticket for Maxima is #10773 which already has positive review. 
-Dave 
+It is also necessary to update Maxima at the same time. The ticket for Maxima is #10773 which already has positive review.
``````




---

archive/issue_comments_105640.json:
```json
{
    "body": "Merged: **sage-4.7.alpha1**",
    "created_at": "2011-03-08T21:47:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10766#issuecomment-105640",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.alpha1**



---

archive/issue_events_125481.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-08T21:47:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125481"
}
```



---

archive/issue_events_125482.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-08T21:47:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10766",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10766#event-125482"
}
```
