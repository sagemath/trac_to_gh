# Issue 10731: IndexError in toric sheaf cohomology

archive/issues_010668.json:
```json
{
    "body": "Assignee: @aghitza\n\nCC:  @novoselt\n\nThis computation dies unnecessarily:\n\n```\nsage: cell24 = Polyhedron(vertices=[   \n...    (1,0,0,0),(0,1,0,0),(0,0,1,0),(0,0,0,1),(1,-1,-1,1),(0,0,-1,1),          \n...    (0,-1,0,1),(-1,0,0,1),(1,0,0,-1),(0,1,0,-1),(0,0,1,-1),(-1,1,1,-1),\n...    (1,-1,-1,0),(0,0,-1,0),(0,-1,0,0),(-1,0,0,0),(1,-1,0,0),(1,0,-1,0),\n...    (0,1,1,-1),(-1,1,1,0),(-1,1,0,0),(-1,0,1,0),(0,-1,-1,1),(0,0,0,-1)])\nsage: X = ToricVariety(FaceFan(cell24.lattice_polytope()))\nsage: D = -X.divisor(0)\nsage: D.cohomology()\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n\n/home/vbraun/Sage/24cell/<ipython console> in <module>()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/schemes/generic/toric_divisor.pyc in _sheaf_cohomology(self, cplx)\n   1544                 assert(h[1].dimension()==0)\n   1545                 continue\n-> 1546             HH_list[ h[0]+1 ] = h[1].dimension()\n   1547 \n   1548         return vector(ZZ, HH_list)\n\nIndexError: list assignment index out of range\n```\nInside, the homology of an auxiliary simplicial complex is computed. For sufficiently complicated cases, vector spaces of dimension 0 are sometimes returned even if all higher-dimensional homology groups vanish. My sheaf cohomology code wrongly assumed that this would not be the case.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10731\n\n",
    "closed_at": "2011-02-07T08:16:46Z",
    "created_at": "2011-02-02T18:30:14Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "IndexError in toric sheaf cohomology",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10731",
    "user": "https://github.com/vbraun"
}
```
Assignee: @aghitza

CC:  @novoselt

This computation dies unnecessarily:

```
sage: cell24 = Polyhedron(vertices=[   
...    (1,0,0,0),(0,1,0,0),(0,0,1,0),(0,0,0,1),(1,-1,-1,1),(0,0,-1,1),          
...    (0,-1,0,1),(-1,0,0,1),(1,0,0,-1),(0,1,0,-1),(0,0,1,-1),(-1,1,1,-1),
...    (1,-1,-1,0),(0,0,-1,0),(0,-1,0,0),(-1,0,0,0),(1,-1,0,0),(1,0,-1,0),
...    (0,1,1,-1),(-1,1,1,0),(-1,1,0,0),(-1,0,1,0),(0,-1,-1,1),(0,0,0,-1)])
sage: X = ToricVariety(FaceFan(cell24.lattice_polytope()))
sage: D = -X.divisor(0)
sage: D.cohomology()
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)

/home/vbraun/Sage/24cell/<ipython console> in <module>()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/schemes/generic/toric_divisor.pyc in _sheaf_cohomology(self, cplx)
   1544                 assert(h[1].dimension()==0)
   1545                 continue
-> 1546             HH_list[ h[0]+1 ] = h[1].dimension()
   1547 
   1548         return vector(ZZ, HH_list)

IndexError: list assignment index out of range
```
Inside, the homology of an auxiliary simplicial complex is computed. For sufficiently complicated cases, vector spaces of dimension 0 are sometimes returned even if all higher-dimensional homology groups vanish. My sheaf cohomology code wrongly assumed that this would not be the case.



Issue created by migration from https://trac.sagemath.org/ticket/10731





---

archive/issue_comments_111883.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-02T18:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10731#issuecomment-111883",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_111884.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-02-02T19:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10731#issuecomment-111884",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_111885.json:
```json
{
    "body": "Looks good, but misses the reference to this ticket.\n\nIs it possible to get these 0-dimensional spaces even in negative degree? In general, is it how homology of this associated complex should behave? I.e. was it really a defect of toric code or there should be a follow-up ticket open for homology computation?",
    "created_at": "2011-02-02T19:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10731#issuecomment-111885",
    "user": "https://github.com/novoselt"
}
```

Looks good, but misses the reference to this ticket.

Is it possible to get these 0-dimensional spaces even in negative degree? In general, is it how homology of this associated complex should behave? I.e. was it really a defect of toric code or there should be a follow-up ticket open for homology computation?



---

archive/issue_comments_111886.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-02-02T19:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10731#issuecomment-111886",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_111887.json:
```json
{
    "body": "Attachment [trac_10731_fix_toric_sheaf_cohomology.patch](tarball://root/attachments/some-uuid/ticket10731/trac_10731_fix_toric_sheaf_cohomology.patch) by @vbraun created at 2011-02-02 19:57:48\n\nI've added a reference to this trac ticket.\n\nI don't think that the homology every returns negative degrees, but even if that were the case it would be mathematically correct as long as the homology group is zero-dimensional. As is, the auxiliary simplicial complex is higher-dimensional (but of course has no homology in degrees larger) than the dimension of the variety. So we can't blame the homology code...",
    "created_at": "2011-02-02T19:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10731#issuecomment-111887",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_10731_fix_toric_sheaf_cohomology.patch](tarball://root/attachments/some-uuid/ticket10731/trac_10731_fix_toric_sheaf_cohomology.patch) by @vbraun created at 2011-02-02 19:57:48

I've added a reference to this trac ticket.

I don't think that the homology every returns negative degrees, but even if that were the case it would be mathematically correct as long as the homology group is zero-dimensional. As is, the auxiliary simplicial complex is higher-dimensional (but of course has no homology in degrees larger) than the dimension of the variety. So we can't blame the homology code...



---

archive/issue_comments_111888.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-02-02T19:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10731#issuecomment-111888",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_111889.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-02T20:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10731#issuecomment-111889",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_027644.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-07T08:16:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10731#event-27644"
}
```



---

archive/issue_comments_111890.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-02-07T08:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10731#issuecomment-111890",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
