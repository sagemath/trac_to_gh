# Issue 10479: Nef-partitions rewrite

archive/issues_010426.json:
```json
{
    "body": "The current support of nef-partitions in Sage is very limited and not very well designed.\n\nThe patch provides a new implementation with convenient access to all associated polytopes. It breaks backward compatibility for nef-partitions, but it is very unlikely that anyone could seriously use the present version.\n\nSee also http://groups.google.com/group/sage-devel/browse_thread/thread/76ede735be799d1d\n\n**Assignee:** mhampton\n\n**CC:**  @vbraun\n\n**Author:** Andrey Novoseltsev\n\n**Reviewer:** Volker Braun\n\n**Merged:** sage-4.6.2.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/10479\n\n",
    "closed_at": "2011-01-19T22:24:39Z",
    "created_at": "2010-12-15T20:35:51Z",
    "labels": [
        "component: geometry",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Nef-partitions rewrite",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10479",
    "user": "https://github.com/novoselt"
}
```
The current support of nef-partitions in Sage is very limited and not very well designed.

The patch provides a new implementation with convenient access to all associated polytopes. It breaks backward compatibility for nef-partitions, but it is very unlikely that anyone could seriously use the present version.

See also http://groups.google.com/group/sage-devel/browse_thread/thread/76ede735be799d1d

**Assignee:** mhampton

**CC:**  @vbraun

**Author:** Andrey Novoseltsev

**Reviewer:** Volker Braun

**Merged:** sage-4.6.2.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/10479





---

archive/issue_comments_101919.json:
```json
{
    "body": "<a id='comment:1'></a>\nIn principle, it is ready, but there are some issues building documentation, I'll resolve them shortly.\n\nThe patch looks big, but half of it is documentation and the other half doctests adjustments ;-)",
    "created_at": "2010-12-16T04:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101919",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:1'></a>
In principle, it is ready, but there are some issues building documentation, I'll resolve them shortly.

The patch looks big, but half of it is documentation and the other half doctests adjustments ;-)



---

archive/issue_events_081908.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-16T04:49:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81908"
}
```



---

archive/issue_comments_101920.json:
```json
{
    "body": "**Work_Issues:** documentation build",
    "created_at": "2010-12-16T04:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101920",
    "user": "https://github.com/novoselt"
}
```

**Work_Issues:** documentation build



---

archive/issue_events_081909.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-16T16:50:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81909"
}
```



---

archive/issue_events_081910.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-16T16:50:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81910"
}
```



---

archive/issue_comments_101921.json:
```json
{
    "body": "<a id='comment:2'></a>\nOK, the documentation builds and look fine.\n\nInteractive help for `NefPartition?` in the notebook is not so great: the second $i$ in the input description is not recognized for some reason and the pretty aligned block of polytopes shows\n\n```\nUnknown control sequence '\\['\n```\nThis is due to `\\\\[1ex]`, removing `[1ex]` would display all four equations on the same line. Everything looks great if I replace `\\\\` with `\\\\\\`, but then the HTML documentation does not build and it is wrong from LaTeX/Sphinx point of view anyway. Instead of figuring out workarounds, I propose merging this patch in its current version and opening documentation-related tickets to fix these general issues.\n\nOn the command line `NefPartition?` also has the problem with $i$ and the displayed block is rendered completely ununderstandable with some inequalities creeping in. Again, I claim that this is a general documentation problem that should be solved elsewhere. Meanwhile all definitions are given in the text anyway in a readable form, it just would be nice to have the displayed block in addition.",
    "created_at": "2010-12-16T16:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101921",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'></a>
OK, the documentation builds and look fine.

Interactive help for `NefPartition?` in the notebook is not so great: the second $i$ in the input description is not recognized for some reason and the pretty aligned block of polytopes shows

```
Unknown control sequence '\['
```
This is due to `\\[1ex]`, removing `[1ex]` would display all four equations on the same line. Everything looks great if I replace `\\` with `\\\`, but then the HTML documentation does not build and it is wrong from LaTeX/Sphinx point of view anyway. Instead of figuring out workarounds, I propose merging this patch in its current version and opening documentation-related tickets to fix these general issues.

On the command line `NefPartition?` also has the problem with $i$ and the displayed block is rendered completely ununderstandable with some inequalities creeping in. Again, I claim that this is a general documentation problem that should be solved elsewhere. Meanwhile all definitions are given in the text anyway in a readable form, it just would be nice to have the displayed block in addition.



---

archive/issue_comments_101922.json:
```json
{
    "body": "<a id='comment:3'></a>\nIn principle I'm happy with the implementation. Just two minor details:\n\nAbout the four equations, I think it would be better to avoid explicit spacing. Whats 1ex in a web browser, in a terminal??. You can just split it into two equations and say something like nef partition blah (equation) is dual to the nef partition (equation). \n\nMy other suggestion would be to explain the INPUT section of the `nef_partition()` method in more detail. I realize that you are just refactoring that part, but it would be very helpful if you would spell out what the options do. Whats a symmetric partition?",
    "created_at": "2010-12-31T20:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101922",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
In principle I'm happy with the implementation. Just two minor details:

About the four equations, I think it would be better to avoid explicit spacing. Whats 1ex in a web browser, in a terminal??. You can just split it into two equations and say something like nef partition blah (equation) is dual to the nef partition (equation). 

My other suggestion would be to explain the INPUT section of the `nef_partition()` method in more detail. I realize that you are just refactoring that part, but it would be very helpful if you would spell out what the options do. Whats a symmetric partition?



---

archive/issue_comments_101923.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2010-12-31T20:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101923",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_events_081911.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-12-31T20:39:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81911"
}
```



---

archive/issue_events_081912.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-12-31T20:39:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81912"
}
```



---

archive/issue_comments_101924.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [vbraun](#comment%3A3):\n> About the four equations, I think it would be better to avoid explicit spacing. Whats 1ex in a web browser, in a terminal??. You can just split it into two equations and say something like nef partition blah (equation) is dual to the nef partition (equation). \n\n\nWell, in the terminal these equations are hard to comprehend anyway and a reasonable choice for 1ex spacing would be a blank line perhaps. In a browser the whole block is rendered as a LaTeX expression using some font, so 1ex means what it should mean in LaTeX. So I would prefer to keep it as is, since it pleases my eyes when rendered properly ;-) But if you really want I'll break it into two blocks.\n\n> My other suggestion would be to explain the INPUT section of the `nef_partition()` method in more detail. I realize that you are just refactoring that part, but it would be very helpful if you would spell out what the options do. Whats a symmetric partition? \n\n\nI'll try to make it more clear. The most accurate explanation is that a certain option is passed to nef.x. As far as I understand, two partitions are symmetric if one is the image of another under a lattice symmetry of the polytope.",
    "created_at": "2011-01-12T01:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101924",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>
Replying to [vbraun](#comment%3A3):
> About the four equations, I think it would be better to avoid explicit spacing. Whats 1ex in a web browser, in a terminal??. You can just split it into two equations and say something like nef partition blah (equation) is dual to the nef partition (equation). 


Well, in the terminal these equations are hard to comprehend anyway and a reasonable choice for 1ex spacing would be a blank line perhaps. In a browser the whole block is rendered as a LaTeX expression using some font, so 1ex means what it should mean in LaTeX. So I would prefer to keep it as is, since it pleases my eyes when rendered properly ;-) But if you really want I'll break it into two blocks.

> My other suggestion would be to explain the INPUT section of the `nef_partition()` method in more detail. I realize that you are just refactoring that part, but it would be very helpful if you would spell out what the options do. Whats a symmetric partition? 


I'll try to make it more clear. The most accurate explanation is that a certain option is passed to nef.x. As far as I understand, two partitions are symmetric if one is the image of another under a lattice symmetry of the polytope.



---

archive/attachments_013659.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10479_nef_partitions_rewrite.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10479/trac_10479_nef_partitions_rewrite.patch",
    "created_at": "2011-01-13T05:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/novoselt"
}
```



---

archive/issue_comments_101925.json:
```json
{
    "body": "<a id='comment:5'></a>\nI tried to clarify options of `nef_partitions`.\n\nI also replaced `\\\\[1ex]` with `\\\\ & \\\\` to make \"just a blank line\" but keep four equations aligned together. This works fine for the compiled HTML documentation and the interactive help in the notebook does not produce an error. It does not look as it should however, because the documentation parser incorrectly processes slashes. Command line help also does not look good, but no surprise here. My opinion is that I am using correct and appropriate formatting, so it is not my bug if the result does not look as expected.\n\nPlaying with\n\n```\ndef g():\n    r\"\"\"\n    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2\n    \n    plain text\n    \n    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2\n\n    ``code``\n        \n    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2        \n    \"\"\"\n    pass\ng?\n```\nin the notebook shows that slashes are fine as long as there is no code or math insertions, but ones there is one - the original number of slashes somehow decreases despite of \"r\" in the beginning of the string.",
    "created_at": "2011-01-13T05:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101925",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>
I tried to clarify options of `nef_partitions`.

I also replaced `\\[1ex]` with `\\ & \\` to make "just a blank line" but keep four equations aligned together. This works fine for the compiled HTML documentation and the interactive help in the notebook does not produce an error. It does not look as it should however, because the documentation parser incorrectly processes slashes. Command line help also does not look good, but no surprise here. My opinion is that I am using correct and appropriate formatting, so it is not my bug if the result does not look as expected.

Playing with

```
def g():
    r"""
    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2
    
    plain text
    
    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2

    ``code``
        
    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2        
    """
    pass
g?
```
in the notebook shows that slashes are fine as long as there is no code or math insertions, but ones there is one - the original number of slashes somehow decreases despite of "r" in the beginning of the string.



---

archive/issue_events_081913.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-01-13T05:19:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81913"
}
```



---

archive/issue_events_081914.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-01-13T05:19:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81914"
}
```



---

archive/issue_comments_101926.json:
```json
{
    "body": "**Changing work_issues** from \"documentation build\" to \"\".",
    "created_at": "2011-01-13T05:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101926",
    "user": "https://github.com/novoselt"
}
```

**Changing work_issues** from "documentation build" to "".



---

archive/issue_comments_101927.json:
```json
{
    "body": "<a id='comment:6'></a>\nI still don't get why we can't break up the huge equation if *none* of the backends renders it correctly. Saying that its not your problem is a cop out, jsmath will never be 100% compatible with LaTeX. \n\nIn any case, functionally its fine and I'll give it a positive review. If Andrey changes his mind and wants a readable documentation then he's welcome to update it.",
    "created_at": "2011-01-13T08:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101927",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
I still don't get why we can't break up the huge equation if *none* of the backends renders it correctly. Saying that its not your problem is a cop out, jsmath will never be 100% compatible with LaTeX. 

In any case, functionally its fine and I'll give it a positive review. If Andrey changes his mind and wants a readable documentation then he's welcome to update it.



---

archive/issue_events_081915.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-01-13T08:51:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81915"
}
```



---

archive/issue_events_081916.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-01-13T08:51:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81916"
}
```



---

archive/issue_comments_101928.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [vbraun](#comment%3A6):\n> I still don't get why we can't break up the huge equation if *none* of the backends renders it correctly. Saying that its not your problem is a cop out, jsmath will never be 100% compatible with LaTeX. \n\n\nWhy *none*?\n* HTML from Sphynx looks great!\n* In the notebook all equations now also appear in a clear way but on one line and with a little bit weird spacing. As far as I understand this is not jsmath problem - if I replace `\\\\` with `\\\\\\` for the line breaks, then they get placed on separate lines and are aligned as they should, so the problem is that slashes mysteriously disappear before they are processed by jsmath. I will open a ticket for this.\n* As for the command line - each line of the block is probably harder to understand by humans than the preceding plain text explanation that still has all detail, so whether these lines are together or not does not make much difference.\n \n> In any case, functionally its fine and I'll give it a positive review. If Andrey changes his mind and wants a readable documentation then he's welcome to update it.\n\n\nThank you ;-)",
    "created_at": "2011-01-13T16:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101928",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:7'></a>
Replying to [vbraun](#comment%3A6):
> I still don't get why we can't break up the huge equation if *none* of the backends renders it correctly. Saying that its not your problem is a cop out, jsmath will never be 100% compatible with LaTeX. 


Why *none*?
* HTML from Sphynx looks great!
* In the notebook all equations now also appear in a clear way but on one line and with a little bit weird spacing. As far as I understand this is not jsmath problem - if I replace `\\` with `\\\` for the line breaks, then they get placed on separate lines and are aligned as they should, so the problem is that slashes mysteriously disappear before they are processed by jsmath. I will open a ticket for this.
* As for the command line - each line of the block is probably harder to understand by humans than the preceding plain text explanation that still has all detail, so whether these lines are together or not does not make much difference.
 
> In any case, functionally its fine and I'll give it a positive review. If Andrey changes his mind and wants a readable documentation then he's welcome to update it.


Thank you ;-)



---

archive/issue_comments_101929.json:
```json
{
    "body": "<a id='comment:8'></a>\n#10624 reports the documentation problem.",
    "created_at": "2011-01-13T17:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101929",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>
#10624 reports the documentation problem.



---

archive/issue_comments_101930.json:
```json
{
    "body": "<a id='comment:9'></a>\nIn the notebook all 4 equations end up on one very long line. At least on Chrome the text is then as wide as the equation line, which is a good deal wider than my screen. I can zoom out until the equation fits, but then the text is tiny.",
    "created_at": "2011-01-13T17:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101930",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
In the notebook all 4 equations end up on one very long line. At least on Chrome the text is then as wide as the equation line, which is a good deal wider than my screen. I can zoom out until the equation fits, but then the text is tiny.



---

archive/issue_comments_101931.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis is exactly why I try to fight long lines in examples and their output...\n\nI opened\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/5af60a53b2618833#\nand if there will be no solution I'll think again about breaking the block into pieces.",
    "created_at": "2011-01-13T17:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101931",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'></a>
This is exactly why I try to fight long lines in examples and their output...

I opened
http://groups.google.com/group/sage-devel/browse_thread/thread/5af60a53b2618833#
and if there will be no solution I'll think again about breaking the block into pieces.



---

archive/issue_comments_101932.json:
```json
{
    "body": "**Merged:** sage-4.6.2.alpha1",
    "created_at": "2011-01-19T22:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10479#issuecomment-101932",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.6.2.alpha1



---

archive/issue_events_081917.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:24:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81917"
}
```



---

archive/issue_events_081918.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:24:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10479",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10479#event-81918"
}
```
