# Issue 10164: Few digits of precision in N().

archive/issues_010163.json:
```json
{
    "body": "For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n\nThe suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n\n---\n\nApply: [attachment:trac_10164_folder_sans_whitespace.patch] to Sage library\n\n**Assignee:** @jasongrout\n\n**CC:**  @kcrisman\n\n**Keywords:** N, digits, numerical approximation\n\n**Reviewer:** Karl-Dieter Crisman, Benjamin Jones\n\n**Author:** Robert Gerbicz, Douglas McNeil\n\n**Merged:** sage-5.1.beta3\n\nIssue created by migration from https://trac.sagemath.org/ticket/10164\n\n",
    "closed_at": "2012-06-05T11:49:59Z",
    "created_at": "2010-10-24T12:51:06Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Few digits of precision in N().",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10164",
    "user": "https://trac.sagemath.org/admin/accounts/users/gerbicz"
}
```
For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.

The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.

---

Apply: [attachment:trac_10164_folder_sans_whitespace.patch] to Sage library

**Assignee:** @jasongrout

**CC:**  @kcrisman

**Keywords:** N, digits, numerical approximation

**Reviewer:** Karl-Dieter Crisman, Benjamin Jones

**Author:** Robert Gerbicz, Douglas McNeil

**Merged:** sage-5.1.beta3

Issue created by migration from https://trac.sagemath.org/ticket/10164





---

archive/attachments_013269.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "10164.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10164/10164.patch",
    "created_at": "2011-12-14T18:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_120196.json:
```json
{
    "body": "<a id='comment:1'></a>\nSee also this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/abe39e9167ab386c/b46d91a618b06e20).   Doug reports the following evil lines:\n\n```\nmisc/functional.py:            prec = int((digits+1) * 3.32192) + 1 \nrings/complex_interval.pyx:    bits = \nmax(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) \nrings/complex_number.pyx:    bits = \nmax(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) \nrings/real_mpfi.pyx:        bits = int(3.32192*len(s)) \nrings/real_mpfr.pyx:            bits = int(3.32192*sigfigs)+1 \nsymbolic/expression.pyx:                prec = int((digits+1) * 3.32192) + 1 \n```\nSo a full patch would fix all of these, though we **definitely** want to keep the original author on.  Also need doctests for these large cases, of course.\n\nI can't believe I never saw this ticket.",
    "created_at": "2011-12-14T18:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120196",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>
See also this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/abe39e9167ab386c/b46d91a618b06e20).   Doug reports the following evil lines:

```
misc/functional.py:            prec = int((digits+1) * 3.32192) + 1 
rings/complex_interval.pyx:    bits = 
max(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) 
rings/complex_number.pyx:    bits = 
max(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) 
rings/real_mpfi.pyx:        bits = int(3.32192*len(s)) 
rings/real_mpfr.pyx:            bits = int(3.32192*sigfigs)+1 
symbolic/expression.pyx:                prec = int((digits+1) * 3.32192) + 1 
```
So a full patch would fix all of these, though we **definitely** want to keep the original author on.  Also need doctests for these large cases, of course.

I can't believe I never saw this ticket.



---

archive/issue_comments_120197.json:
```json
{
    "body": "**Changing keywords** from \"N, digits, numerical approximation\" to \"N, digits, numerical approximation beginner\".",
    "created_at": "2011-12-14T18:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120197",
    "user": "https://github.com/kcrisman"
}
```

**Changing keywords** from "N, digits, numerical approximation" to "N, digits, numerical approximation beginner".



---

archive/issue_comments_120198.json:
```json
{
    "body": "<a id='comment:2'></a>\nI'm on this one.",
    "created_at": "2011-12-14T22:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120198",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:2'></a>
I'm on this one.



---

archive/issue_comments_120199.json:
```json
{
    "body": "<a id='comment:3'></a>\nOkay, I have a patch.  Testing now.  Turns out it's a little trickier to doctest than I thought, because some of the bugs can't be triggered yet because of other limitations. :-/",
    "created_at": "2011-12-15T02:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120199",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:3'></a>
Okay, I have a patch.  Testing now.  Turns out it's a little trickier to doctest than I thought, because some of the bugs can't be triggered yet because of other limitations. :-/



---

archive/attachments_013270.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10164_round_up_log10_2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10164/trac_10164_round_up_log10_2.patch",
    "created_at": "2011-12-15T03:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```



---

archive/issue_comments_120200.json:
```json
{
    "body": "roud up log(10,2)",
    "created_at": "2011-12-15T03:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120200",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

roud up log(10,2)



---

archive/issue_comments_120201.json:
```json
{
    "body": "round up log(10,2)",
    "created_at": "2011-12-15T03:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120201",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

round up log(10,2)



---

archive/attachments_013271.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10164_round_up_log10_2.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10164/trac_10164_round_up_log10_2.2.patch",
    "created_at": "2011-12-15T03:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```



---

archive/issue_comments_120202.json:
```json
{
    "body": "<a id='comment:4'></a>\nOkay, so I've changed all six instances of \"3.32192\" (which seems to be the most common approximation to log(10,2) in use).  There are three  other references matching 3.32* (in rings/arith.py, interfaces/gp.py, and libs/pari/gen.pyx) I left alone.  Those all have at least 10 digits, so the problem would be pushed to higher levels even if it occurs, and there was in every case something I wasn't confident enough of to change.  I don't know much about how pari's precision works, for example.\n\nI think it's a step in the right direction, anyhow.",
    "created_at": "2011-12-15T03:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120202",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:4'></a>
Okay, so I've changed all six instances of "3.32192" (which seems to be the most common approximation to log(10,2) in use).  There are three  other references matching 3.32* (in rings/arith.py, interfaces/gp.py, and libs/pari/gen.pyx) I left alone.  Those all have at least 10 digits, so the problem would be pushed to higher levels even if it occurs, and there was in every case something I wasn't confident enough of to change.  I don't know much about how pari's precision works, for example.

I think it's a step in the right direction, anyhow.



---

archive/issue_comments_120203.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-12-15T03:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120203",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_120204.json:
```json
{
    "body": "**Changing author** from \"Robert Gerbicz\" to \"Robert Gerbicz, Douglas McNeil\".",
    "created_at": "2011-12-15T03:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120204",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

**Changing author** from "Robert Gerbicz" to "Robert Gerbicz, Douglas McNeil".



---

archive/issue_comments_120205.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-12-16T04:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120205",
    "user": "https://github.com/kcrisman"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_120206.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2011-12-16T04:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120206",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/issue_comments_120207.json:
```json
{
    "body": "<a id='comment:5'></a>\n> I think it's a step in the right direction, anyhow.\n\nVery clever testing.  \n\nVery minor 'needs work' issues:\n* I think you could also add as a doctest the example at #12163 (a dup, more or less).  We do like doctesting problems people officially put on tickets.  That sort of example has the added benefit of being a little easier to read :) Of course, if more than one person disagrees, it's not a big deal.\n* Needs to be done - your doc lines are really long.  Compare\n\n```\ns_real -- a string that defines a real number (or something whose\n```\n   to \n\n```\nMake sure we've rounded up log(10,2) enough to guarantee sufficient precision (trac #10164).\n```\n   Try to shorten those puppies up to the 80-character limit (if I recall correctly) for fine terminal viewing.\n\nBecause this has the potential to do weird things to doctests, I'm not going to give positive review in any case until I run long tests.  But looks good other than those tiny issues.\n\nAlso, a question: I assume it's okay (and already the case, in fact) that we have MORE digits than \"officially requested\" by the user.",
    "created_at": "2011-12-16T04:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120207",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
> I think it's a step in the right direction, anyhow.

Very clever testing.  

Very minor 'needs work' issues:
* I think you could also add as a doctest the example at #12163 (a dup, more or less).  We do like doctesting problems people officially put on tickets.  That sort of example has the added benefit of being a little easier to read :) Of course, if more than one person disagrees, it's not a big deal.
* Needs to be done - your doc lines are really long.  Compare

```
s_real -- a string that defines a real number (or something whose
```
   to 

```
Make sure we've rounded up log(10,2) enough to guarantee sufficient precision (trac #10164).
```
   Try to shorten those puppies up to the 80-character limit (if I recall correctly) for fine terminal viewing.

Because this has the potential to do weird things to doctests, I'm not going to give positive review in any case until I run long tests.  But looks good other than those tiny issues.

Also, a question: I assume it's okay (and already the case, in fact) that we have MORE digits than "officially requested" by the user.



---

archive/issue_events_030853.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-16T04:06:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10164#event-30853"
}
```



---

archive/issue_comments_120208.json:
```json
{
    "body": "<a id='comment:6'></a>\nI like this so far, but I have a maybe dumb question. Why not use more digits? in \"raw\" python, `3.3219280948873626` is the answer on my 64bit machine. changing the last digit from 6 to 7 should be just perfect.",
    "created_at": "2011-12-16T11:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120208",
    "user": "https://github.com/haraldschilly"
}
```

<a id='comment:6'></a>
I like this so far, but I have a maybe dumb question. Why not use more digits? in "raw" python, `3.3219280948873626` is the answer on my 64bit machine. changing the last digit from 6 to 7 should be just perfect.



---

archive/issue_comments_120209.json:
```json
{
    "body": "<a id='comment:7'></a>\nLong doctests are a-ok, so just the patch itself would be treated differently based on comments.\n\n---\nHarald's comment seems quite reasonable.  One could go either way, though, unless we are really trying to get *exactly* the 'right' number of digits, which apparently hasn't been the case (we treat as lower bound).",
    "created_at": "2011-12-16T21:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120209",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
Long doctests are a-ok, so just the patch itself would be treated differently based on comments.

---
Harald's comment seems quite reasonable.  One could go either way, though, unless we are really trying to get *exactly* the 'right' number of digits, which apparently hasn't been the case (we treat as lower bound).



---

archive/issue_comments_120210.json:
```json
{
    "body": "<a id='comment:8'></a>\nWhy not get exactly the correct number of digits? Certainly the added precision will fix the problem for much larger numbers.\n\nThe question is how many digits we can feasibly expect people to want to calculate. 3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.\n\nTo calculate the precision error with different approximations of log(10, 2):\n\n(floor((n + 1) * a) + 1) - (floor((n + 1) * log(10,2).n(100000)) + 1),\n\nwhere n is the number of digits you want, and a is the approximation. log(10,2).n(100000) is just used for comparison.",
    "created_at": "2011-12-17T02:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120210",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:8'></a>
Why not get exactly the correct number of digits? Certainly the added precision will fix the problem for much larger numbers.

The question is how many digits we can feasibly expect people to want to calculate. 3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.

To calculate the precision error with different approximations of log(10, 2):

(floor((n + 1) * a) + 1) - (floor((n + 1) * log(10,2).n(100000)) + 1),

where n is the number of digits you want, and a is the approximation. log(10,2).n(100000) is just used for comparison.



---

archive/issue_comments_120211.json:
```json
{
    "body": "<a id='comment:9'></a>\nI simply followed the OP's suggestion, which works just fine: adding more digits would only change things by ~1e-7 or so.\n\n\"Why not get exactly the correct number of digits?\"\n\nWell, since I don't know if the last digits are guaranteed to be correct anyway, I'm not sure how important it is to be precise when we're not accurate, esp. given that we don't seem to have been in the past.  Of the two, not using as much precision as requested is a far more serious problem than using a (very tiny) bit more.  But it's probably easier for us simply to change it than to waste time arguing about the use case. :-)\n\nAs for: \"3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.\"\n\nI think there's some confusion here.  3.32193 works for `_any_` number of digits, because it's an over-estimate.  It's already completely future-proofed.",
    "created_at": "2011-12-17T02:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120211",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:9'></a>
I simply followed the OP's suggestion, which works just fine: adding more digits would only change things by ~1e-7 or so.

"Why not get exactly the correct number of digits?"

Well, since I don't know if the last digits are guaranteed to be correct anyway, I'm not sure how important it is to be precise when we're not accurate, esp. given that we don't seem to have been in the past.  Of the two, not using as much precision as requested is a far more serious problem than using a (very tiny) bit more.  But it's probably easier for us simply to change it than to waste time arguing about the use case. :-)

As for: "3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it."

I think there's some confusion here.  3.32193 works for `_any_` number of digits, because it's an over-estimate.  It's already completely future-proofed.



---

archive/issue_comments_120212.json:
```json
{
    "body": "<a id='comment:10'></a>\nI see your point. I guess the way to do it would be to use the overestimate and slice to the correct number of digits, but this may be difficult since there doesn't seem to be an index method for RealNumber.",
    "created_at": "2011-12-17T04:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120212",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:10'></a>
I see your point. I guess the way to do it would be to use the overestimate and slice to the correct number of digits, but this may be difficult since there doesn't seem to be an index method for RealNumber.



---

archive/issue_comments_120213.json:
```json
{
    "body": "**Changing keywords** from \"N, digits, numerical approximation beginner\" to \"N, digits, numerical approximation\".",
    "created_at": "2012-01-09T17:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120213",
    "user": "https://trac.sagemath.org/admin/accounts/users/ncarter"
}
```

**Changing keywords** from "N, digits, numerical approximation beginner" to "N, digits, numerical approximation".



---

archive/issue_comments_120214.json:
```json
{
    "body": "<a id='comment:11'></a>\nThis has gone beyond beginner capacities, due to the extended discussion above.",
    "created_at": "2012-01-09T17:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120214",
    "user": "https://trac.sagemath.org/admin/accounts/users/ncarter"
}
```

<a id='comment:11'></a>
This has gone beyond beginner capacities, due to the extended discussion above.



---

archive/issue_comments_120215.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-01-09T18:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120215",
    "user": "https://github.com/eviatarbach"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_120216.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe patch needs review.",
    "created_at": "2012-01-09T18:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120216",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:12'></a>
The patch needs review.



---

archive/issue_comments_120217.json:
```json
{
    "body": "<a id='comment:13'></a>\ndsm, would you object to having a more precise overestimation, such as 3.32192809488736235?",
    "created_at": "2012-01-09T18:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120217",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:13'></a>
dsm, would you object to having a more precise overestimation, such as 3.32192809488736235?



---

archive/issue_comments_120218.json:
```json
{
    "body": "<a id='comment:14'></a>\nI don't really object, although putting the overestimate right at the end might cause problems for people with more digits than they can possibly have memory for, as it's hard to trust arithmetic down at the lsb level unless you think harder about things than this problem warrants.  For example, `float(\"3.32192809488736235\") < math.log(10,2)`, even though `3.32192809488736235 > log(10,2)`, which might not be what you'd guess.\n\nAnyway, I'm fine with adding more digits, as long as it's still an overestimate w.r.t. math.log.  If `3.321928094887363` is okay, then I'll update the patch, fix the docs, and we can put this to bed.",
    "created_at": "2012-02-05T04:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120218",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:14'></a>
I don't really object, although putting the overestimate right at the end might cause problems for people with more digits than they can possibly have memory for, as it's hard to trust arithmetic down at the lsb level unless you think harder about things than this problem warrants.  For example, `float("3.32192809488736235") < math.log(10,2)`, even though `3.32192809488736235 > log(10,2)`, which might not be what you'd guess.

Anyway, I'm fine with adding more digits, as long as it's still an overestimate w.r.t. math.log.  If `3.321928094887363` is okay, then I'll update the patch, fix the docs, and we can put this to bed.



---

archive/issue_comments_120219.json:
```json
{
    "body": "<a id='comment:15'></a>\nSounds good!",
    "created_at": "2012-02-05T07:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120219",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:15'></a>
Sounds good!



---

archive/issue_comments_120220.json:
```json
{
    "body": "v3: use a more precise approx",
    "created_at": "2012-02-13T04:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120220",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

v3: use a more precise approx



---

archive/attachments_013272.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10164_round_up_log10_2_v3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10164/trac_10164_round_up_log10_2_v3.patch",
    "created_at": "2012-02-13T04:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```



---

archive/issue_comments_120221.json:
```json
{
    "body": "<a id='comment:16'></a>\nOkay; anyone want to have a look and make sure I didn't break anything while changing it?",
    "created_at": "2012-02-13T04:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120221",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:16'></a>
Okay; anyone want to have a look and make sure I didn't break anything while changing it?



---

archive/issue_comments_120222.json:
```json
{
    "body": "<a id='comment:17'></a>\nOh, yeah.  And unfortunately putting in the test from trac #12163 doubles the runtime of testing functional.py from ~9s to ~22s for me.  I asked on IRC and the response was that we could probably get away without marking it up as a long test, but that's easily changed.",
    "created_at": "2012-02-13T05:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120222",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:17'></a>
Oh, yeah.  And unfortunately putting in the test from trac #12163 doubles the runtime of testing functional.py from ~9s to ~22s for me.  I asked on IRC and the response was that we could probably get away without marking it up as a long test, but that's easily changed.



---

archive/issue_comments_120223.json:
```json
{
    "body": "<a id='comment:18'></a>\nI don't see why you couldn't just mark the second (huge) test as `# long time`.  That seems like a decent compromise.",
    "created_at": "2012-02-13T18:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120223",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'></a>
I don't see why you couldn't just mark the second (huge) test as `# long time`.  That seems like a decent compromise.



---

archive/issue_comments_120224.json:
```json
{
    "body": "<a id='comment:19'></a>\nApply trac_10164_round_up_log10_2_v3.patch\n\n(for patchbot)",
    "created_at": "2012-03-13T13:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120224",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:19'></a>
Apply trac_10164_round_up_log10_2_v3.patch

(for patchbot)



---

archive/issue_comments_120225.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-For N(1+10**-400000,digits=400001) the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: prec = int((digits+1) * 3.32192) + 1. However log(10)/log(2)~3.3219280948874>3.32192, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n+For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n \n The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n``````\n",
    "created_at": "2012-03-26T15:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120225",
    "user": "https://github.com/loefflerd"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-For N(1+10**-400000,digits=400001) the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: prec = int((digits+1) * 3.32192) + 1. However log(10)/log(2)~3.3219280948874>3.32192, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
+For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
 
 The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.
``````




---

archive/issue_comments_120226.json:
```json
{
    "body": "<a id='comment:21'></a>\nThe v3 patch looks very good. I added a reviewer patch that defined a constant `LOG_TEN_TWO_PLUS_EPSILON` in order to name the magic number used to overestimate log(10, 2). I'm running tests now.",
    "created_at": "2012-05-28T20:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120226",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:21'></a>
The v3 patch looks very good. I added a reviewer patch that defined a constant `LOG_TEN_TWO_PLUS_EPSILON` in order to name the magic number used to overestimate log(10, 2). I'm running tests now.



---

archive/issue_comments_120227.json:
```json
{
    "body": "**Changing reviewer** from \"Karl-Dieter Crisman\" to \"Karl-Dieter Crisman, Benjamin Jones\".",
    "created_at": "2012-05-28T20:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120227",
    "user": "https://github.com/benjaminfjones"
}
```

**Changing reviewer** from "Karl-Dieter Crisman" to "Karl-Dieter Crisman, Benjamin Jones".



---

archive/issue_comments_120228.json:
```json
{
    "body": "<a id='comment:22'></a>\nHello,\n\nGreat that this patch is moving forward!\n\nDo you think you could just add a comment on the tests explaining that the decimal point adds an extra 1 to the length? Otherwise it seems inaccurate until further inspection.\n\nThanks.",
    "created_at": "2012-05-28T20:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120228",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:22'></a>
Hello,

Great that this patch is moving forward!

Do you think you could just add a comment on the tests explaining that the decimal point adds an extra 1 to the length? Otherwise it seems inaccurate until further inspection.

Thanks.



---

archive/attachments_013273.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10164_reviewer.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10164/trac_10164_reviewer.patch",
    "created_at": "2012-05-28T20:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/benjaminfjones"
}
```



---

archive/issue_comments_120229.json:
```json
{
    "body": "name the magic 3.23... number, remove trailing whitespace",
    "created_at": "2012-05-28T20:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120229",
    "user": "https://github.com/benjaminfjones"
}
```

name the magic 3.23... number, remove trailing whitespace



---

archive/issue_comments_120230.json:
```json
{
    "body": "<a id='comment:23'></a>\nThanks eviatar, I added the comment to the docstring. \n\nI ran doc tests on all files that were touched and those passed, no problems. I'll wait on the patchbot's approval before giving positive review. \n\nPatchbot, apply:\n1. [attachment:trac_10164_round_up_log10_2_v3.patch]\n2. [attachment:trac_10164_reviewer.patch]",
    "created_at": "2012-05-28T20:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120230",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:23'></a>
Thanks eviatar, I added the comment to the docstring. 

I ran doc tests on all files that were touched and those passed, no problems. I'll wait on the patchbot's approval before giving positive review. 

Patchbot, apply:
1. [attachment:trac_10164_round_up_log10_2_v3.patch]
2. [attachment:trac_10164_reviewer.patch]



---

archive/issue_comments_120231.json:
```json
{
    "body": "last two patches folded togethers with whitespace removed",
    "created_at": "2012-05-28T21:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120231",
    "user": "https://github.com/benjaminfjones"
}
```

last two patches folded togethers with whitespace removed



---

archive/issue_comments_120232.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n \n The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n+\n+---\n+\n+Apply: [attachment:trac_10164_folder_sans_whitespace.patch] to Sage library\n``````\n",
    "created_at": "2012-05-28T21:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120232",
    "user": "https://github.com/benjaminfjones"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
 For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
 
 The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.
+
+---
+
+Apply: [attachment:trac_10164_folder_sans_whitespace.patch] to Sage library
``````




---

archive/attachments_013274.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10164_folder_sans_whitespace.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10164/trac_10164_folder_sans_whitespace.patch",
    "created_at": "2012-05-28T21:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/benjaminfjones"
}
```



---

archive/issue_comments_120233.json:
```json
{
    "body": "<a id='comment:24'></a>\nPatchbot: apply only [attachment:trac_10164_folder_sans_whitespace.patch]",
    "created_at": "2012-05-28T21:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120233",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:24'></a>
Patchbot: apply only [attachment:trac_10164_folder_sans_whitespace.patch]



---

archive/issue_comments_120234.json:
```json
{
    "body": "<a id='comment:25'></a>\nPatchbot is refusing to cooperate. I'm running `make ptestlong` manually.",
    "created_at": "2012-05-28T22:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120234",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:25'></a>
Patchbot is refusing to cooperate. I'm running `make ptestlong` manually.



---

archive/issue_comments_120235.json:
```json
{
    "body": "<a id='comment:26'></a>\nAll tests pass, positive review.",
    "created_at": "2012-05-28T22:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120235",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:26'></a>
All tests pass, positive review.



---

archive/issue_comments_120236.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-05-28T22:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120236",
    "user": "https://github.com/benjaminfjones"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_030854.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-05T11:49:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10164#event-30854"
}
```



---

archive/issue_comments_120237.json:
```json
{
    "body": "**Merged:** sage-5.1.beta3",
    "created_at": "2012-06-05T11:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10164#issuecomment-120237",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta3
