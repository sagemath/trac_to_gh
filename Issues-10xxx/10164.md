# Issue 10164: Few digits of precision in N().

archive/issues_010163.json:
```json
{
    "assignees": [],
    "body": "For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n\nThe suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n\n---\n\nApply: [attachment:trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch) to Sage library\n\n**Assignee:** @jasongrout\n\n**CC:**  @kcrisman\n\n**Keywords:** N, digits, numerical approximation\n\n**Reviewer:** Karl-Dieter Crisman, Benjamin Jones\n\n**Author:** Robert Gerbicz, Douglas McNeil\n\n**Merged:** sage-5.1.beta3\n\nIssue created by migration from https://trac.sagemath.org/ticket/10164\n\n",
    "closed_at": "2012-06-05T11:49:59Z",
    "created_at": "2010-10-24T12:51:06Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20misc",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Few digits of precision in N().",
    "type": "issue",
    "updated_at": "2012-06-05T11:49:59Z",
    "url": "https://github.com/sagemath/sage/issues/10164",
    "user": "https://github.com/sagetrac-gerbicz"
}
```
For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.

The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.

---

Apply: [attachment:trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch) to Sage library

**Assignee:** @jasongrout

**CC:**  @kcrisman

**Keywords:** N, digits, numerical approximation

**Reviewer:** Karl-Dieter Crisman, Benjamin Jones

**Author:** Robert Gerbicz, Douglas McNeil

**Merged:** sage-5.1.beta3

Issue created by migration from https://trac.sagemath.org/ticket/10164





---

archive/issue_events_111750.json:
```json
{
    "actor": "https://github.com/sagetrac-gerbicz",
    "created_at": "2010-10-24T12:51:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111750"
}
```



---

archive/issue_events_111751.json:
```json
{
    "actor": "https://github.com/sagetrac-gerbicz",
    "created_at": "2010-10-24T12:51:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20misc",
    "label_color": "08517b",
    "label_name": "component: misc",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111751"
}
```



---

archive/issue_events_111752.json:
```json
{
    "actor": "https://github.com/sagetrac-gerbicz",
    "created_at": "2010-10-24T12:51:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111752"
}
```



---

archive/issue_comments_095806.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\n**Attachment:** [10164.patch.gz](https://github.com/sagemath/sage/files/ticket10164/10164.patch.gz)\n\nSee also this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/abe39e9167ab386c/b46d91a618b06e20).   Doug reports the following evil lines:\n\n```\nmisc/functional.py:            prec = int((digits+1) * 3.32192) + 1 \nrings/complex_interval.pyx:    bits = \nmax(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) \nrings/complex_number.pyx:    bits = \nmax(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) \nrings/real_mpfi.pyx:        bits = int(3.32192*len(s)) \nrings/real_mpfr.pyx:            bits = int(3.32192*sigfigs)+1 \nsymbolic/expression.pyx:                prec = int((digits+1) * 3.32192) + 1 \n```\nSo a full patch would fix all of these, though we **definitely** want to keep the original author on.  Also need doctests for these large cases, of course.\n\nI can't believe I never saw this ticket.",
    "created_at": "2011-12-14T18:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95806",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'>**Comment 1:**</a>
**Attachment:** [10164.patch.gz](https://github.com/sagemath/sage/files/ticket10164/10164.patch.gz)

See also this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/abe39e9167ab386c/b46d91a618b06e20).   Doug reports the following evil lines:

```
misc/functional.py:            prec = int((digits+1) * 3.32192) + 1 
rings/complex_interval.pyx:    bits = 
max(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) 
rings/complex_number.pyx:    bits = 
max(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) 
rings/real_mpfi.pyx:        bits = int(3.32192*len(s)) 
rings/real_mpfr.pyx:            bits = int(3.32192*sigfigs)+1 
symbolic/expression.pyx:                prec = int((digits+1) * 3.32192) + 1 
```
So a full patch would fix all of these, though we **definitely** want to keep the original author on.  Also need doctests for these large cases, of course.

I can't believe I never saw this ticket.



---

archive/issue_comments_095807.json:
```json
{
    "body": "**Changing keywords** from \"N, digits, numerical approximation\" to \"N, digits, numerical approximation beginner\".",
    "created_at": "2011-12-14T18:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95807",
    "user": "https://github.com/kcrisman"
}
```

**Changing keywords** from "N, digits, numerical approximation" to "N, digits, numerical approximation beginner".



---

archive/issue_comments_095808.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nI'm on this one.",
    "created_at": "2011-12-14T22:41:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95808",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:2'>**Comment 2:**</a>
I'm on this one.



---

archive/issue_comments_095809.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nOkay, I have a patch.  Testing now.  Turns out it's a little trickier to doctest than I thought, because some of the bugs can't be triggered yet because of other limitations. :-/",
    "created_at": "2011-12-15T02:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95809",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:3'>**Comment 3:**</a>
Okay, I have a patch.  Testing now.  Turns out it's a little trickier to doctest than I thought, because some of the bugs can't be triggered yet because of other limitations. :-/



---

archive/issue_comments_095810.json:
```json
{
    "body": "**Attachment:** [trac_10164_round_up_log10_2.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2.patch.gz)\n\nroud up log(10,2)",
    "created_at": "2011-12-15T03:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95810",
    "user": "https://github.com/sagetrac-dsm"
}
```

**Attachment:** [trac_10164_round_up_log10_2.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2.patch.gz)

roud up log(10,2)



---

archive/issue_comments_095811.json:
```json
{
    "body": "round up log(10,2)",
    "created_at": "2011-12-15T03:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95811",
    "user": "https://github.com/sagetrac-dsm"
}
```

round up log(10,2)



---

archive/issue_comments_095812.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n**Attachment:** [trac_10164_round_up_log10_2.2.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2.2.patch.gz)\n\nOkay, so I've changed all six instances of \"3.32192\" (which seems to be the most common approximation to log(10,2) in use).  There are three  other references matching 3.32* (in rings/arith.py, interfaces/gp.py, and libs/pari/gen.pyx) I left alone.  Those all have at least 10 digits, so the problem would be pushed to higher levels even if it occurs, and there was in every case something I wasn't confident enough of to change.  I don't know much about how pari's precision works, for example.\n\nI think it's a step in the right direction, anyhow.",
    "created_at": "2011-12-15T03:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95812",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:4'>**Comment 4:**</a>
**Attachment:** [trac_10164_round_up_log10_2.2.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2.2.patch.gz)

Okay, so I've changed all six instances of "3.32192" (which seems to be the most common approximation to log(10,2) in use).  There are three  other references matching 3.32* (in rings/arith.py, interfaces/gp.py, and libs/pari/gen.pyx) I left alone.  Those all have at least 10 digits, so the problem would be pushed to higher levels even if it occurs, and there was in every case something I wasn't confident enough of to change.  I don't know much about how pari's precision works, for example.

I think it's a step in the right direction, anyhow.



---

archive/issue_events_111753.json:
```json
{
    "actor": "https://github.com/sagetrac-dsm",
    "created_at": "2011-12-15T03:36:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111753"
}
```



---

archive/issue_comments_095813.json:
```json
{
    "body": "**Changing author** from \"Robert Gerbicz\" to \"Robert Gerbicz, Douglas McNeil\".",
    "created_at": "2011-12-15T03:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95813",
    "user": "https://github.com/sagetrac-dsm"
}
```

**Changing author** from "Robert Gerbicz" to "Robert Gerbicz, Douglas McNeil".



---

archive/issue_events_111754.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-16T04:06:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111754"
}
```



---

archive/issue_events_111755.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-16T04:06:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111755"
}
```



---

archive/issue_comments_095814.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2011-12-16T04:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95814",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/issue_comments_095815.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\n> I think it's a step in the right direction, anyhow.\n\nVery clever testing.  \n\nVery minor 'needs work' issues:\n* I think you could also add as a doctest the example at #12163 (a dup, more or less).  We do like doctesting problems people officially put on tickets.  That sort of example has the added benefit of being a little easier to read :) Of course, if more than one person disagrees, it's not a big deal.\n* Needs to be done - your doc lines are really long.  Compare\n\n```\ns_real -- a string that defines a real number (or something whose\n```\n   to \n\n```\nMake sure we've rounded up log(10,2) enough to guarantee sufficient precision (trac #10164).\n```\n   Try to shorten those puppies up to the 80-character limit (if I recall correctly) for fine terminal viewing.\n\nBecause this has the potential to do weird things to doctests, I'm not going to give positive review in any case until I run long tests.  But looks good other than those tiny issues.\n\nAlso, a question: I assume it's okay (and already the case, in fact) that we have MORE digits than \"officially requested\" by the user.",
    "created_at": "2011-12-16T04:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95815",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'>**Comment 5:**</a>
> I think it's a step in the right direction, anyhow.

Very clever testing.  

Very minor 'needs work' issues:
* I think you could also add as a doctest the example at #12163 (a dup, more or less).  We do like doctesting problems people officially put on tickets.  That sort of example has the added benefit of being a little easier to read :) Of course, if more than one person disagrees, it's not a big deal.
* Needs to be done - your doc lines are really long.  Compare

```
s_real -- a string that defines a real number (or something whose
```
   to 

```
Make sure we've rounded up log(10,2) enough to guarantee sufficient precision (trac #10164).
```
   Try to shorten those puppies up to the 80-character limit (if I recall correctly) for fine terminal viewing.

Because this has the potential to do weird things to doctests, I'm not going to give positive review in any case until I run long tests.  But looks good other than those tiny issues.

Also, a question: I assume it's okay (and already the case, in fact) that we have MORE digits than "officially requested" by the user.



---

archive/issue_events_111756.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-16T04:06:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111756"
}
```



---

archive/issue_comments_095816.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nI like this so far, but I have a maybe dumb question. Why not use more digits? in \"raw\" python, `3.3219280948873626` is the answer on my 64bit machine. changing the last digit from 6 to 7 should be just perfect.",
    "created_at": "2011-12-16T11:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95816",
    "user": "https://github.com/haraldschilly"
}
```

<a id='comment:6'>**Comment 6:**</a>
I like this so far, but I have a maybe dumb question. Why not use more digits? in "raw" python, `3.3219280948873626` is the answer on my 64bit machine. changing the last digit from 6 to 7 should be just perfect.



---

archive/issue_comments_095817.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nLong doctests are a-ok, so just the patch itself would be treated differently based on comments.\n\n---\nHarald's comment seems quite reasonable.  One could go either way, though, unless we are really trying to get *exactly* the 'right' number of digits, which apparently hasn't been the case (we treat as lower bound).",
    "created_at": "2011-12-16T21:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95817",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'>**Comment 7:**</a>
Long doctests are a-ok, so just the patch itself would be treated differently based on comments.

---
Harald's comment seems quite reasonable.  One could go either way, though, unless we are really trying to get *exactly* the 'right' number of digits, which apparently hasn't been the case (we treat as lower bound).



---

archive/issue_comments_095818.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nWhy not get exactly the correct number of digits? Certainly the added precision will fix the problem for much larger numbers.\n\nThe question is how many digits we can feasibly expect people to want to calculate. 3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.\n\nTo calculate the precision error with different approximations of log(10, 2):\n\n(floor((n + 1) * a) + 1) - (floor((n + 1) * log(10,2).n(100000)) + 1),\n\nwhere n is the number of digits you want, and a is the approximation. log(10,2).n(100000) is just used for comparison.",
    "created_at": "2011-12-17T02:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95818",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:8'>**Comment 8:**</a>
Why not get exactly the correct number of digits? Certainly the added precision will fix the problem for much larger numbers.

The question is how many digits we can feasibly expect people to want to calculate. 3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.

To calculate the precision error with different approximations of log(10, 2):

(floor((n + 1) * a) + 1) - (floor((n + 1) * log(10,2).n(100000)) + 1),

where n is the number of digits you want, and a is the approximation. log(10,2).n(100000) is just used for comparison.



---

archive/issue_comments_095819.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nI simply followed the OP's suggestion, which works just fine: adding more digits would only change things by ~1e-7 or so.\n\n\"Why not get exactly the correct number of digits?\"\n\nWell, since I don't know if the last digits are guaranteed to be correct anyway, I'm not sure how important it is to be precise when we're not accurate, esp. given that we don't seem to have been in the past.  Of the two, not using as much precision as requested is a far more serious problem than using a (very tiny) bit more.  But it's probably easier for us simply to change it than to waste time arguing about the use case. :-)\n\nAs for: \"3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.\"\n\nI think there's some confusion here.  3.32193 works for `_any_` number of digits, because it's an over-estimate.  It's already completely future-proofed.",
    "created_at": "2011-12-17T02:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95819",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:9'>**Comment 9:**</a>
I simply followed the OP's suggestion, which works just fine: adding more digits would only change things by ~1e-7 or so.

"Why not get exactly the correct number of digits?"

Well, since I don't know if the last digits are guaranteed to be correct anyway, I'm not sure how important it is to be precise when we're not accurate, esp. given that we don't seem to have been in the past.  Of the two, not using as much precision as requested is a far more serious problem than using a (very tiny) bit more.  But it's probably easier for us simply to change it than to waste time arguing about the use case. :-)

As for: "3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it."

I think there's some confusion here.  3.32193 works for `_any_` number of digits, because it's an over-estimate.  It's already completely future-proofed.



---

archive/issue_comments_095820.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nI see your point. I guess the way to do it would be to use the overestimate and slice to the correct number of digits, but this may be difficult since there doesn't seem to be an index method for RealNumber.",
    "created_at": "2011-12-17T04:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95820",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:10'>**Comment 10:**</a>
I see your point. I guess the way to do it would be to use the overestimate and slice to the correct number of digits, but this may be difficult since there doesn't seem to be an index method for RealNumber.



---

archive/issue_comments_095821.json:
```json
{
    "body": "**Changing keywords** from \"N, digits, numerical approximation beginner\" to \"N, digits, numerical approximation\".",
    "created_at": "2012-01-09T17:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95821",
    "user": "https://github.com/sagetrac-ncarter"
}
```

**Changing keywords** from "N, digits, numerical approximation beginner" to "N, digits, numerical approximation".



---

archive/issue_comments_095822.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nThis has gone beyond beginner capacities, due to the extended discussion above.",
    "created_at": "2012-01-09T17:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95822",
    "user": "https://github.com/sagetrac-ncarter"
}
```

<a id='comment:11'>**Comment 11:**</a>
This has gone beyond beginner capacities, due to the extended discussion above.



---

archive/issue_events_111757.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2012-01-09T18:05:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111757"
}
```



---

archive/issue_events_111758.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2012-01-09T18:05:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111758"
}
```



---

archive/issue_comments_095823.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nThe patch needs review.",
    "created_at": "2012-01-09T18:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95823",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:12'>**Comment 12:**</a>
The patch needs review.



---

archive/issue_comments_095824.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\ndsm, would you object to having a more precise overestimation, such as 3.32192809488736235?",
    "created_at": "2012-01-09T18:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95824",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:13'>**Comment 13:**</a>
dsm, would you object to having a more precise overestimation, such as 3.32192809488736235?



---

archive/issue_comments_095825.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nI don't really object, although putting the overestimate right at the end might cause problems for people with more digits than they can possibly have memory for, as it's hard to trust arithmetic down at the lsb level unless you think harder about things than this problem warrants.  For example, `float(\"3.32192809488736235\") < math.log(10,2)`, even though `3.32192809488736235 > log(10,2)`, which might not be what you'd guess.\n\nAnyway, I'm fine with adding more digits, as long as it's still an overestimate w.r.t. math.log.  If `3.321928094887363` is okay, then I'll update the patch, fix the docs, and we can put this to bed.",
    "created_at": "2012-02-05T04:17:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95825",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:14'>**Comment 14:**</a>
I don't really object, although putting the overestimate right at the end might cause problems for people with more digits than they can possibly have memory for, as it's hard to trust arithmetic down at the lsb level unless you think harder about things than this problem warrants.  For example, `float("3.32192809488736235") < math.log(10,2)`, even though `3.32192809488736235 > log(10,2)`, which might not be what you'd guess.

Anyway, I'm fine with adding more digits, as long as it's still an overestimate w.r.t. math.log.  If `3.321928094887363` is okay, then I'll update the patch, fix the docs, and we can put this to bed.



---

archive/issue_comments_095826.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nSounds good!",
    "created_at": "2012-02-05T07:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95826",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:15'>**Comment 15:**</a>
Sounds good!



---

archive/issue_comments_095827.json:
```json
{
    "body": "v3: use a more precise approx",
    "created_at": "2012-02-13T04:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95827",
    "user": "https://github.com/sagetrac-dsm"
}
```

v3: use a more precise approx



---

archive/issue_comments_095828.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\n**Attachment:** [trac_10164_round_up_log10_2_v3.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2_v3.patch.gz)\n\nOkay; anyone want to have a look and make sure I didn't break anything while changing it?",
    "created_at": "2012-02-13T04:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95828",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:16'>**Comment 16:**</a>
**Attachment:** [trac_10164_round_up_log10_2_v3.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2_v3.patch.gz)

Okay; anyone want to have a look and make sure I didn't break anything while changing it?



---

archive/issue_comments_095829.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nOh, yeah.  And unfortunately putting in the test from trac #12163 doubles the runtime of testing functional.py from ~9s to ~22s for me.  I asked on IRC and the response was that we could probably get away without marking it up as a long test, but that's easily changed.",
    "created_at": "2012-02-13T05:15:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95829",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:17'>**Comment 17:**</a>
Oh, yeah.  And unfortunately putting in the test from trac #12163 doubles the runtime of testing functional.py from ~9s to ~22s for me.  I asked on IRC and the response was that we could probably get away without marking it up as a long test, but that's easily changed.



---

archive/issue_comments_095830.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nI don't see why you couldn't just mark the second (huge) test as `# long time`.  That seems like a decent compromise.",
    "created_at": "2012-02-13T18:13:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95830",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'>**Comment 18:**</a>
I don't see why you couldn't just mark the second (huge) test as `# long time`.  That seems like a decent compromise.



---

archive/issue_comments_095831.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nApply trac_10164_round_up_log10_2_v3.patch\n\n(for patchbot)",
    "created_at": "2012-03-13T13:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95831",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:19'>**Comment 19:**</a>
Apply trac_10164_round_up_log10_2_v3.patch

(for patchbot)



---

archive/issue_comments_095832.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-For N(1+10**-400000,digits=400001) the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: prec = int((digits+1) * 3.32192) + 1. However log(10)/log(2)~3.3219280948874>3.32192, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n+For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n \n The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n``````\n",
    "created_at": "2012-03-26T15:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95832",
    "user": "https://github.com/loefflerd"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-For N(1+10**-400000,digits=400001) the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: prec = int((digits+1) * 3.32192) + 1. However log(10)/log(2)~3.3219280948874>3.32192, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
+For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
 
 The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.
``````




---

archive/issue_comments_095833.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nThe v3 patch looks very good. I added a reviewer patch that defined a constant `LOG_TEN_TWO_PLUS_EPSILON` in order to name the magic number used to overestimate log(10, 2). I'm running tests now.",
    "created_at": "2012-05-28T20:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95833",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:21'>**Comment 21:**</a>
The v3 patch looks very good. I added a reviewer patch that defined a constant `LOG_TEN_TWO_PLUS_EPSILON` in order to name the magic number used to overestimate log(10, 2). I'm running tests now.



---

archive/issue_comments_095834.json:
```json
{
    "body": "**Changing reviewer** from \"Karl-Dieter Crisman\" to \"Karl-Dieter Crisman, Benjamin Jones\".",
    "created_at": "2012-05-28T20:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95834",
    "user": "https://github.com/benjaminfjones"
}
```

**Changing reviewer** from "Karl-Dieter Crisman" to "Karl-Dieter Crisman, Benjamin Jones".



---

archive/issue_comments_095835.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nHello,\n\nGreat that this patch is moving forward!\n\nDo you think you could just add a comment on the tests explaining that the decimal point adds an extra 1 to the length? Otherwise it seems inaccurate until further inspection.\n\nThanks.",
    "created_at": "2012-05-28T20:16:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95835",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:22'>**Comment 22:**</a>
Hello,

Great that this patch is moving forward!

Do you think you could just add a comment on the tests explaining that the decimal point adds an extra 1 to the length? Otherwise it seems inaccurate until further inspection.

Thanks.



---

archive/issue_comments_095836.json:
```json
{
    "body": "**Attachment:** [trac_10164_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_reviewer.patch.gz)\n\nname the magic 3.23... number, remove trailing whitespace",
    "created_at": "2012-05-28T20:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95836",
    "user": "https://github.com/benjaminfjones"
}
```

**Attachment:** [trac_10164_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_reviewer.patch.gz)

name the magic 3.23... number, remove trailing whitespace



---

archive/issue_comments_095837.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nThanks eviatar, I added the comment to the docstring. \n\nI ran doc tests on all files that were touched and those passed, no problems. I'll wait on the patchbot's approval before giving positive review. \n\nPatchbot, apply:\n1. [attachment:trac_10164_round_up_log10_2_v3.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2_v3.patch)\n2. [attachment:trac_10164_reviewer.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_reviewer.patch)",
    "created_at": "2012-05-28T20:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95837",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:23'>**Comment 23:**</a>
Thanks eviatar, I added the comment to the docstring. 

I ran doc tests on all files that were touched and those passed, no problems. I'll wait on the patchbot's approval before giving positive review. 

Patchbot, apply:
1. [attachment:trac_10164_round_up_log10_2_v3.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2_v3.patch)
2. [attachment:trac_10164_reviewer.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_reviewer.patch)



---

archive/issue_comments_095838.json:
```json
{
    "body": "last two patches folded togethers with whitespace removed",
    "created_at": "2012-05-28T21:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95838",
    "user": "https://github.com/benjaminfjones"
}
```

last two patches folded togethers with whitespace removed



---

archive/issue_comments_095839.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n \n The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n+\n+---\n+\n+Apply: [attachment:trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch) to Sage library\n``````\n",
    "created_at": "2012-05-28T21:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95839",
    "user": "https://github.com/benjaminfjones"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
 For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
 
 The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.
+
+---
+
+Apply: [attachment:trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch) to Sage library
``````




---

archive/issue_comments_095840.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\n**Attachment:** [trac_10164_folder_sans_whitespace.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz)\n\nPatchbot: apply only [attachment:trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch)",
    "created_at": "2012-05-28T21:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95840",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:24'>**Comment 24:**</a>
**Attachment:** [trac_10164_folder_sans_whitespace.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz)

Patchbot: apply only [attachment:trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch)



---

archive/issue_comments_095841.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nPatchbot is refusing to cooperate. I'm running `make ptestlong` manually.",
    "created_at": "2012-05-28T22:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95841",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:25'>**Comment 25:**</a>
Patchbot is refusing to cooperate. I'm running `make ptestlong` manually.



---

archive/issue_comments_095842.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nAll tests pass, positive review.",
    "created_at": "2012-05-28T22:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95842",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:26'>**Comment 26:**</a>
All tests pass, positive review.



---

archive/issue_events_111759.json:
```json
{
    "actor": "https://github.com/benjaminfjones",
    "created_at": "2012-05-28T22:41:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111759"
}
```



---

archive/issue_events_111760.json:
```json
{
    "actor": "https://github.com/benjaminfjones",
    "created_at": "2012-05-28T22:41:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111760"
}
```



---

archive/issue_events_111761.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-05T11:49:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111761"
}
```



---

archive/issue_events_111762.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-05T11:49:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-111762"
}
```



---

archive/issue_comments_095843.json:
```json
{
    "body": "**Merged:** sage-5.1.beta3",
    "created_at": "2012-06-05T11:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-95843",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta3
