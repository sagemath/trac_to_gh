# Issue 10164: Few digits of precision in N().

archive/issues_010163.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout"
    ],
    "body": "For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n\nThe suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n\n---\n\nApply: [attachment: trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz) to Sage library\n\nCC:  @kcrisman\n\nKeywords: **N, digits, numerical approximation**\n\nReviewer: **Karl-Dieter Crisman, Benjamin Jones**\n\nAuthor: **Robert Gerbicz, Douglas McNeil**\n\nMerged: **sage-5.1.beta3**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10164_\n\n",
    "closed_at": "2012-06-05T11:49:59Z",
    "created_at": "2010-10-24T12:51:06Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Few digits of precision in N().",
    "type": "issue",
    "updated_at": "2012-06-05T11:49:59Z",
    "url": "https://github.com/sagemath/sage/issues/10164",
    "user": "https://github.com/sagetrac-gerbicz"
}
```
For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.

The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.

---

Apply: [attachment: trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz) to Sage library

CC:  @kcrisman

Keywords: **N, digits, numerical approximation**

Reviewer: **Karl-Dieter Crisman, Benjamin Jones**

Author: **Robert Gerbicz, Douglas McNeil**

Merged: **sage-5.1.beta3**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/10164_





---

archive/issue_events_131749.json:
```json
{
    "actor": "https://github.com/sagetrac-gerbicz",
    "created_at": "2010-10-24T12:51:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131749"
}
```



---

archive/issue_events_131750.json:
```json
{
    "actor": "https://github.com/sagetrac-gerbicz",
    "created_at": "2010-10-24T12:51:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131750"
}
```



---

archive/issue_events_131751.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-10-24T12:51:06Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "subject": "https://github.com/sagetrac-gerbicz",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131751"
}
```



---

archive/issue_comments_093823.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[10164.patch.gz](https://github.com/sagemath/sage/files/ticket10164/10164.patch.gz)**\n\nSee also this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/abe39e9167ab386c/b46d91a618b06e20).   Doug reports the following evil lines:\n\n```\nmisc/functional.py:            prec = int((digits+1) * 3.32192) + 1 \nrings/complex_interval.pyx:    bits = \nmax(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) \nrings/complex_number.pyx:    bits = \nmax(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) \nrings/real_mpfi.pyx:        bits = int(3.32192*len(s)) \nrings/real_mpfr.pyx:            bits = int(3.32192*sigfigs)+1 \nsymbolic/expression.pyx:                prec = int((digits+1) * 3.32192) + 1 \n```\nSo a full patch would fix all of these, though we **definitely** want to keep the original author on.  Also need doctests for these large cases, of course.\n\nI can't believe I never saw this ticket.",
    "created_at": "2011-12-14T18:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93823",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[10164.patch.gz](https://github.com/sagemath/sage/files/ticket10164/10164.patch.gz)**

See also this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/abe39e9167ab386c/b46d91a618b06e20).   Doug reports the following evil lines:

```
misc/functional.py:            prec = int((digits+1) * 3.32192) + 1 
rings/complex_interval.pyx:    bits = 
max(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) 
rings/complex_number.pyx:    bits = 
max(int(3.32192*len(s_real)),int(3.32192*len(s_imag))) 
rings/real_mpfi.pyx:        bits = int(3.32192*len(s)) 
rings/real_mpfr.pyx:            bits = int(3.32192*sigfigs)+1 
symbolic/expression.pyx:                prec = int((digits+1) * 3.32192) + 1 
```
So a full patch would fix all of these, though we **definitely** want to keep the original author on.  Also need doctests for these large cases, of course.

I can't believe I never saw this ticket.



---

archive/issue_comments_093824.json:
```json
{
    "body": "Changed keywords from **N, digits, numerical approximation** to **N, digits, numerical approximation beginner**",
    "created_at": "2011-12-14T18:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93824",
    "user": "https://github.com/kcrisman"
}
```

Changed keywords from **N, digits, numerical approximation** to **N, digits, numerical approximation beginner**



---

archive/issue_comments_093825.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI'm on this one.",
    "created_at": "2011-12-14T22:41:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93825",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:2" align="right">comment:2</div>

I'm on this one.



---

archive/issue_comments_093826.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOkay, I have a patch.  Testing now.  Turns out it's a little trickier to doctest than I thought, because some of the bugs can't be triggered yet because of other limitations. :-/",
    "created_at": "2011-12-15T02:32:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93826",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:3" align="right">comment:3</div>

Okay, I have a patch.  Testing now.  Turns out it's a little trickier to doctest than I thought, because some of the bugs can't be triggered yet because of other limitations. :-/



---

archive/issue_comments_093827.json:
```json
{
    "body": "Attachment: **[trac_10164_round_up_log10_2.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2.patch.gz)**\n\nroud up log(10,2)",
    "created_at": "2011-12-15T03:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93827",
    "user": "https://github.com/sagetrac-dsm"
}
```

Attachment: **[trac_10164_round_up_log10_2.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2.patch.gz)**

roud up log(10,2)



---

archive/issue_comments_093828.json:
```json
{
    "body": "round up log(10,2)",
    "created_at": "2011-12-15T03:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93828",
    "user": "https://github.com/sagetrac-dsm"
}
```

round up log(10,2)



---

archive/issue_comments_093829.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAttachment: **[trac_10164_round_up_log10_2.2.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2.2.patch.gz)**\n\nOkay, so I've changed all six instances of \"3.32192\" (which seems to be the most common approximation to log(10,2) in use).  There are three  other references matching 3.32* (in rings/arith.py, interfaces/gp.py, and libs/pari/gen.pyx) I left alone.  Those all have at least 10 digits, so the problem would be pushed to higher levels even if it occurs, and there was in every case something I wasn't confident enough of to change.  I don't know much about how pari's precision works, for example.\n\nI think it's a step in the right direction, anyhow.",
    "created_at": "2011-12-15T03:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93829",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:4" align="right">comment:4</div>

Attachment: **[trac_10164_round_up_log10_2.2.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2.2.patch.gz)**

Okay, so I've changed all six instances of "3.32192" (which seems to be the most common approximation to log(10,2) in use).  There are three  other references matching 3.32* (in rings/arith.py, interfaces/gp.py, and libs/pari/gen.pyx) I left alone.  Those all have at least 10 digits, so the problem would be pushed to higher levels even if it occurs, and there was in every case something I wasn't confident enough of to change.  I don't know much about how pari's precision works, for example.

I think it's a step in the right direction, anyhow.



---

archive/issue_events_131752.json:
```json
{
    "actor": "https://github.com/sagetrac-dsm",
    "created_at": "2011-12-15T03:36:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131752"
}
```



---

archive/issue_comments_093830.json:
```json
{
    "body": "Changed author from **Robert Gerbicz** to **Robert Gerbicz, Douglas McNeil**",
    "created_at": "2011-12-15T03:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93830",
    "user": "https://github.com/sagetrac-dsm"
}
```

Changed author from **Robert Gerbicz** to **Robert Gerbicz, Douglas McNeil**



---

archive/issue_events_131753.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-16T04:06:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131753"
}
```



---

archive/issue_events_131754.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-16T04:06:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131754"
}
```



---

archive/issue_comments_093831.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2011-12-16T04:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93831",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_comments_093832.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n> I think it's a step in the right direction, anyhow.\n\nVery clever testing.  \n\nVery minor 'needs work' issues:\n* I think you could also add as a doctest the example at #12163 (a dup, more or less).  We do like doctesting problems people officially put on tickets.  That sort of example has the added benefit of being a little easier to read :) Of course, if more than one person disagrees, it's not a big deal.\n* Needs to be done - your doc lines are really long.  Compare\n\n```\ns_real -- a string that defines a real number (or something whose\n```\n   to \n\n```\nMake sure we've rounded up log(10,2) enough to guarantee sufficient precision (trac #10164).\n```\n   Try to shorten those puppies up to the 80-character limit (if I recall correctly) for fine terminal viewing.\n\nBecause this has the potential to do weird things to doctests, I'm not going to give positive review in any case until I run long tests.  But looks good other than those tiny issues.\n\nAlso, a question: I assume it's okay (and already the case, in fact) that we have MORE digits than \"officially requested\" by the user.",
    "created_at": "2011-12-16T04:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93832",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:5" align="right">comment:5</div>

> I think it's a step in the right direction, anyhow.

Very clever testing.  

Very minor 'needs work' issues:
* I think you could also add as a doctest the example at #12163 (a dup, more or less).  We do like doctesting problems people officially put on tickets.  That sort of example has the added benefit of being a little easier to read :) Of course, if more than one person disagrees, it's not a big deal.
* Needs to be done - your doc lines are really long.  Compare

```
s_real -- a string that defines a real number (or something whose
```
   to 

```
Make sure we've rounded up log(10,2) enough to guarantee sufficient precision (trac #10164).
```
   Try to shorten those puppies up to the 80-character limit (if I recall correctly) for fine terminal viewing.

Because this has the potential to do weird things to doctests, I'm not going to give positive review in any case until I run long tests.  But looks good other than those tiny issues.

Also, a question: I assume it's okay (and already the case, in fact) that we have MORE digits than "officially requested" by the user.



---

archive/issue_events_131755.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-16T04:06:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131755"
}
```



---

archive/issue_comments_093833.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI like this so far, but I have a maybe dumb question. Why not use more digits? in \"raw\" python, `3.3219280948873626` is the answer on my 64bit machine. changing the last digit from 6 to 7 should be just perfect.",
    "created_at": "2011-12-16T11:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93833",
    "user": "https://github.com/haraldschilly"
}
```

<div id="comment:6" align="right">comment:6</div>

I like this so far, but I have a maybe dumb question. Why not use more digits? in "raw" python, `3.3219280948873626` is the answer on my 64bit machine. changing the last digit from 6 to 7 should be just perfect.



---

archive/issue_comments_093834.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nLong doctests are a-ok, so just the patch itself would be treated differently based on comments.\n\n---\nHarald's comment seems quite reasonable.  One could go either way, though, unless we are really trying to get *exactly* the 'right' number of digits, which apparently hasn't been the case (we treat as lower bound).",
    "created_at": "2011-12-16T21:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93834",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

Long doctests are a-ok, so just the patch itself would be treated differently based on comments.

---
Harald's comment seems quite reasonable.  One could go either way, though, unless we are really trying to get *exactly* the 'right' number of digits, which apparently hasn't been the case (we treat as lower bound).



---

archive/issue_comments_093835.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWhy not get exactly the correct number of digits? Certainly the added precision will fix the problem for much larger numbers.\n\nThe question is how many digits we can feasibly expect people to want to calculate. 3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.\n\nTo calculate the precision error with different approximations of log(10, 2):\n\n(floor((n + 1) * a) + 1) - (floor((n + 1) * log(10,2).n(100000)) + 1),\n\nwhere n is the number of digits you want, and a is the approximation. log(10,2).n(100000) is just used for comparison.",
    "created_at": "2011-12-17T02:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93835",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:8" align="right">comment:8</div>

Why not get exactly the correct number of digits? Certainly the added precision will fix the problem for much larger numbers.

The question is how many digits we can feasibly expect people to want to calculate. 3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.

To calculate the precision error with different approximations of log(10, 2):

(floor((n + 1) * a) + 1) - (floor((n + 1) * log(10,2).n(100000)) + 1),

where n is the number of digits you want, and a is the approximation. log(10,2).n(100000) is just used for comparison.



---

archive/issue_comments_093836.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI simply followed the OP's suggestion, which works just fine: adding more digits would only change things by ~1e-7 or so.\n\n\"Why not get exactly the correct number of digits?\"\n\nWell, since I don't know if the last digits are guaranteed to be correct anyway, I'm not sure how important it is to be precise when we're not accurate, esp. given that we don't seem to have been in the past.  Of the two, not using as much precision as requested is a far more serious problem than using a (very tiny) bit more.  But it's probably easier for us simply to change it than to waste time arguing about the use case. :-)\n\nAs for: \"3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it.\"\n\nI think there's some confusion here.  3.32193 works for `_any_` number of digits, because it's an over-estimate.  It's already completely future-proofed.",
    "created_at": "2011-12-17T02:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93836",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:9" align="right">comment:9</div>

I simply followed the OP's suggestion, which works just fine: adding more digits would only change things by ~1e-7 or so.

"Why not get exactly the correct number of digits?"

Well, since I don't know if the last digits are guaranteed to be correct anyway, I'm not sure how important it is to be precise when we're not accurate, esp. given that we don't seem to have been in the past.  Of the two, not using as much precision as requested is a far more serious problem than using a (very tiny) bit more.  But it's probably easier for us simply to change it than to waste time arguing about the use case. :-)

As for: "3.32193 works for 1000000 digits, 3.3219281 works for 10000000, but I don't see why we can't use 3.3219280948873627 to future-proof it."

I think there's some confusion here.  3.32193 works for `_any_` number of digits, because it's an over-estimate.  It's already completely future-proofed.



---

archive/issue_comments_093837.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI see your point. I guess the way to do it would be to use the overestimate and slice to the correct number of digits, but this may be difficult since there doesn't seem to be an index method for RealNumber.",
    "created_at": "2011-12-17T04:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93837",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:10" align="right">comment:10</div>

I see your point. I guess the way to do it would be to use the overestimate and slice to the correct number of digits, but this may be difficult since there doesn't seem to be an index method for RealNumber.



---

archive/issue_comments_093838.json:
```json
{
    "body": "Changed keywords from **N, digits, numerical approximation beginner** to **N, digits, numerical approximation**",
    "created_at": "2012-01-09T17:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93838",
    "user": "https://github.com/nathancarter"
}
```

Changed keywords from **N, digits, numerical approximation beginner** to **N, digits, numerical approximation**



---

archive/issue_comments_093839.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThis has gone beyond beginner capacities, due to the extended discussion above.",
    "created_at": "2012-01-09T17:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93839",
    "user": "https://github.com/nathancarter"
}
```

<div id="comment:11" align="right">comment:11</div>

This has gone beyond beginner capacities, due to the extended discussion above.



---

archive/issue_events_131756.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2012-01-09T18:05:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131756"
}
```



---

archive/issue_events_131757.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2012-01-09T18:05:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131757"
}
```



---

archive/issue_comments_093840.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe patch needs review.",
    "created_at": "2012-01-09T18:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93840",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:12" align="right">comment:12</div>

The patch needs review.



---

archive/issue_comments_093841.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\ndsm, would you object to having a more precise overestimation, such as 3.32192809488736235?",
    "created_at": "2012-01-09T18:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93841",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:13" align="right">comment:13</div>

dsm, would you object to having a more precise overestimation, such as 3.32192809488736235?



---

archive/issue_comments_093842.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI don't really object, although putting the overestimate right at the end might cause problems for people with more digits than they can possibly have memory for, as it's hard to trust arithmetic down at the lsb level unless you think harder about things than this problem warrants.  For example, `float(\"3.32192809488736235\") < math.log(10,2)`, even though `3.32192809488736235 > log(10,2)`, which might not be what you'd guess.\n\nAnyway, I'm fine with adding more digits, as long as it's still an overestimate w.r.t. math.log.  If `3.321928094887363` is okay, then I'll update the patch, fix the docs, and we can put this to bed.",
    "created_at": "2012-02-05T04:17:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93842",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:14" align="right">comment:14</div>

I don't really object, although putting the overestimate right at the end might cause problems for people with more digits than they can possibly have memory for, as it's hard to trust arithmetic down at the lsb level unless you think harder about things than this problem warrants.  For example, `float("3.32192809488736235") < math.log(10,2)`, even though `3.32192809488736235 > log(10,2)`, which might not be what you'd guess.

Anyway, I'm fine with adding more digits, as long as it's still an overestimate w.r.t. math.log.  If `3.321928094887363` is okay, then I'll update the patch, fix the docs, and we can put this to bed.



---

archive/issue_comments_093843.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nSounds good!",
    "created_at": "2012-02-05T07:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93843",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:15" align="right">comment:15</div>

Sounds good!



---

archive/issue_comments_093844.json:
```json
{
    "body": "v3: use a more precise approx",
    "created_at": "2012-02-13T04:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93844",
    "user": "https://github.com/sagetrac-dsm"
}
```

v3: use a more precise approx



---

archive/issue_comments_093845.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[trac_10164_round_up_log10_2_v3.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2_v3.patch.gz)**\n\nOkay; anyone want to have a look and make sure I didn't break anything while changing it?",
    "created_at": "2012-02-13T04:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93845",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[trac_10164_round_up_log10_2_v3.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2_v3.patch.gz)**

Okay; anyone want to have a look and make sure I didn't break anything while changing it?



---

archive/issue_comments_093846.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOh, yeah.  And unfortunately putting in the test from trac #12163 doubles the runtime of testing functional.py from ~9s to ~22s for me.  I asked on IRC and the response was that we could probably get away without marking it up as a long test, but that's easily changed.",
    "created_at": "2012-02-13T05:15:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93846",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:17" align="right">comment:17</div>

Oh, yeah.  And unfortunately putting in the test from trac #12163 doubles the runtime of testing functional.py from ~9s to ~22s for me.  I asked on IRC and the response was that we could probably get away without marking it up as a long test, but that's easily changed.



---

archive/issue_comments_093847.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI don't see why you couldn't just mark the second (huge) test as `# long time`.  That seems like a decent compromise.",
    "created_at": "2012-02-13T18:13:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93847",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">comment:18</div>

I don't see why you couldn't just mark the second (huge) test as `# long time`.  That seems like a decent compromise.



---

archive/issue_comments_093848.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nApply trac_10164_round_up_log10_2_v3.patch\n\n(for patchbot)",
    "created_at": "2012-03-13T13:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93848",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:19" align="right">comment:19</div>

Apply trac_10164_round_up_log10_2_v3.patch

(for patchbot)



---

archive/issue_comments_093849.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-For N(1+10**-400000,digits=400001) the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: prec = int((digits+1) * 3.32192) + 1. However log(10)/log(2)~3.3219280948874>3.32192, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n+For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n \n The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n``````\n",
    "created_at": "2012-03-26T15:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93849",
    "user": "https://github.com/loefflerd"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-For N(1+10**-400000,digits=400001) the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: prec = int((digits+1) * 3.32192) + 1. However log(10)/log(2)~3.3219280948874>3.32192, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
+For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
 
 The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.
``````




---

archive/issue_comments_093850.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe v3 patch looks very good. I added a reviewer patch that defined a constant `LOG_TEN_TWO_PLUS_EPSILON` in order to name the magic number used to overestimate log(10, 2). I'm running tests now.",
    "created_at": "2012-05-28T20:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93850",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:21" align="right">comment:21</div>

The v3 patch looks very good. I added a reviewer patch that defined a constant `LOG_TEN_TWO_PLUS_EPSILON` in order to name the magic number used to overestimate log(10, 2). I'm running tests now.



---

archive/issue_comments_093851.json:
```json
{
    "body": "Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Benjamin Jones**",
    "created_at": "2012-05-28T20:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93851",
    "user": "https://github.com/benjaminfjones"
}
```

Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Benjamin Jones**



---

archive/issue_comments_093852.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nHello,\n\nGreat that this patch is moving forward!\n\nDo you think you could just add a comment on the tests explaining that the decimal point adds an extra 1 to the length? Otherwise it seems inaccurate until further inspection.\n\nThanks.",
    "created_at": "2012-05-28T20:16:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93852",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:22" align="right">comment:22</div>

Hello,

Great that this patch is moving forward!

Do you think you could just add a comment on the tests explaining that the decimal point adds an extra 1 to the length? Otherwise it seems inaccurate until further inspection.

Thanks.



---

archive/issue_comments_093853.json:
```json
{
    "body": "Attachment: **[trac_10164_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_reviewer.patch.gz)**\n\nname the magic 3.23... number, remove trailing whitespace",
    "created_at": "2012-05-28T20:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93853",
    "user": "https://github.com/benjaminfjones"
}
```

Attachment: **[trac_10164_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_reviewer.patch.gz)**

name the magic 3.23... number, remove trailing whitespace



---

archive/issue_comments_093854.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThanks eviatar, I added the comment to the docstring. \n\nI ran doc tests on all files that were touched and those passed, no problems. I'll wait on the patchbot's approval before giving positive review. \n\nPatchbot, apply:\n1. [attachment: trac_10164_round_up_log10_2_v3.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2_v3.patch.gz)\n2. [attachment: trac_10164_reviewer.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_reviewer.patch.gz)",
    "created_at": "2012-05-28T20:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93854",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:23" align="right">comment:23</div>

Thanks eviatar, I added the comment to the docstring. 

I ran doc tests on all files that were touched and those passed, no problems. I'll wait on the patchbot's approval before giving positive review. 

Patchbot, apply:
1. [attachment: trac_10164_round_up_log10_2_v3.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_round_up_log10_2_v3.patch.gz)
2. [attachment: trac_10164_reviewer.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_reviewer.patch.gz)



---

archive/issue_comments_093855.json:
```json
{
    "body": "last two patches folded togethers with whitespace removed",
    "created_at": "2012-05-28T21:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93855",
    "user": "https://github.com/benjaminfjones"
}
```

last two patches folded togethers with whitespace removed



---

archive/issue_comments_093856.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.\n \n The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.\n+\n+---\n+\n+Apply: [attachment: trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz) to Sage library\n``````\n",
    "created_at": "2012-05-28T21:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93856",
    "user": "https://github.com/benjaminfjones"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
 For ` N(1+10**-400000,digits=400001)` the displayed number of digits is only 400000, it is printing 1. followed by 399999 zeroes. The reason is that in functional.py: ` prec = int((digits+1) * 3.32192) + 1`. However `log(10)/log(2)~3.3219280948874>3.32192`, so if digits is large the used precision will be smaller by some digits than the requested number of digits.
 
 The suggestion is to use 3.32193 instead of 3.32192, see the trivial patch.
+
+---
+
+Apply: [attachment: trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz) to Sage library
``````




---

archive/issue_comments_093857.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAttachment: **[trac_10164_folder_sans_whitespace.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz)**\n\nPatchbot: apply only [attachment: trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz)",
    "created_at": "2012-05-28T21:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93857",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:24" align="right">comment:24</div>

Attachment: **[trac_10164_folder_sans_whitespace.patch.gz](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz)**

Patchbot: apply only [attachment: trac_10164_folder_sans_whitespace.patch](https://github.com/sagemath/sage/files/ticket10164/trac_10164_folder_sans_whitespace.patch.gz)



---

archive/issue_comments_093858.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nPatchbot is refusing to cooperate. I'm running `make ptestlong` manually.",
    "created_at": "2012-05-28T22:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93858",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:25" align="right">comment:25</div>

Patchbot is refusing to cooperate. I'm running `make ptestlong` manually.



---

archive/issue_comments_093859.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAll tests pass, positive review.",
    "created_at": "2012-05-28T22:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93859",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:26" align="right">comment:26</div>

All tests pass, positive review.



---

archive/issue_events_131758.json:
```json
{
    "actor": "https://github.com/benjaminfjones",
    "created_at": "2012-05-28T22:41:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131758"
}
```



---

archive/issue_events_131759.json:
```json
{
    "actor": "https://github.com/benjaminfjones",
    "created_at": "2012-05-28T22:41:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131759"
}
```



---

archive/issue_events_131760.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-05T11:49:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131760"
}
```



---

archive/issue_events_131761.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-05T11:49:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10164#event-131761"
}
```



---

archive/issue_comments_093860.json:
```json
{
    "body": "Merged: **sage-5.1.beta3**",
    "created_at": "2012-06-05T11:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10164#issuecomment-93860",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.1.beta3**
