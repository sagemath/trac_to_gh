# Issue 10112: random_prime  does not handle erroneous input gracefully - it hangs

archive/issues_010111.json:
```json
{
    "assignees": [],
    "body": "As noted at #10111 and \n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/6e8d6f28c915830d?hl=en\n\n`random_prime()` is not well documented. \n\nBut `random_prime()` is also broken for some erroneous input. Programs should always handle poor input properly, which is the case of Sage probably means generating an error message. \n\n```\nsage: random_prime(0,True,-1) # Hangs\nsage: random_prime(0,False,-1) # Hangs\nsage: random_prime(1,0,-23) # Hangs\nsage: random_prime(-12,0,-12) # Hangs\nsage: random_prime(0, proof=False, lbound=-12) # Hangs\n```\n\nHaving a negative lower bound can cause the function to hang, but this is not always the case, as the example below shows. Here an error message is generated. \n\n```\nsage: random_prime(-12,0,-4)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/export/home/drkirkby/sage-4.6.alpha3/<ipython console> in <module>()\n\n/export/home/drkirkby/sage-4.6.alpha3/local/lib/python2.6/site-packages/sage/rings/arith.pyc in random_prime(n, proof, lbound)\n   1144     n = ZZ(n)\n   1145     if n < lbound:\n-> 1146         raise ValueError, \"n must be greater than lbound: %s\"%(lbound)\n   1147     elif n == 2:\n   1148         return ZZ(n)\n\nValueError: n must be greater than lbound: -4\n```\n\nDave \n\nApply\n1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz) (merged in sage-4.8.alpha1)\n2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz) (merged in sage-4.8.alpha1)\n3. [attachment: trac_10112-ascii.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz) (merged in sage-4.8.alpha2)\nto the Sage library.\n\nAssignee: **@williamstein**\n\nAuthor: **Mike Hansen, Francis Clarke**\n\nReviewer: **David Kirkby, Johan Bosman**\n\nMerged: **sage-4.8.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10112_\n\n",
    "closed_at": "2011-11-11T22:55:52Z",
    "created_at": "2010-10-09T23:29:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "random_prime  does not handle erroneous input gracefully - it hangs",
    "type": "issue",
    "updated_at": "2011-11-11T22:55:52Z",
    "url": "https://github.com/sagemath/sage/issues/10112",
    "user": "https://github.com/sagetrac-drkirkby"
}
```
As noted at #10111 and 

http://groups.google.com/group/sage-devel/browse_thread/thread/6e8d6f28c915830d?hl=en

`random_prime()` is not well documented. 

But `random_prime()` is also broken for some erroneous input. Programs should always handle poor input properly, which is the case of Sage probably means generating an error message. 

```
sage: random_prime(0,True,-1) # Hangs
sage: random_prime(0,False,-1) # Hangs
sage: random_prime(1,0,-23) # Hangs
sage: random_prime(-12,0,-12) # Hangs
sage: random_prime(0, proof=False, lbound=-12) # Hangs
```

Having a negative lower bound can cause the function to hang, but this is not always the case, as the example below shows. Here an error message is generated. 

```
sage: random_prime(-12,0,-4)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/export/home/drkirkby/sage-4.6.alpha3/<ipython console> in <module>()

/export/home/drkirkby/sage-4.6.alpha3/local/lib/python2.6/site-packages/sage/rings/arith.pyc in random_prime(n, proof, lbound)
   1144     n = ZZ(n)
   1145     if n < lbound:
-> 1146         raise ValueError, "n must be greater than lbound: %s"%(lbound)
   1147     elif n == 2:
   1148         return ZZ(n)

ValueError: n must be greater than lbound: -4
```

Dave 

Apply
1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz) (merged in sage-4.8.alpha1)
2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz) (merged in sage-4.8.alpha1)
3. [attachment: trac_10112-ascii.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz) (merged in sage-4.8.alpha2)
to the Sage library.

Assignee: **@williamstein**

Author: **Mike Hansen, Francis Clarke**

Reviewer: **David Kirkby, Johan Bosman**

Merged: **sage-4.8.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/10112_





---

archive/issue_events_120611.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-10-09T23:29:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120611"
}
```



---

archive/issue_events_120612.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-10-09T23:29:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "component: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120612"
}
```



---

archive/issue_events_120613.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-10-09T23:29:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120613"
}
```



---

archive/issue_events_120614.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-10-09T23:29:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120614"
}
```



---

archive/issue_comments_094949.json:
```json
{
    "body": "Author: **Mike Hansen**",
    "created_at": "2010-10-11T03:05:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94949",
    "user": "https://github.com/mwhansen"
}
```

Author: **Mike Hansen**



---

archive/issue_events_120615.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-10-11T03:05:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120615"
}
```



---

archive/issue_comments_094950.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nMike, \nthank you for fixing this. I'll try this later today, but here's a few comments from reading the patch only - I've not tested it in Sage yet. \n\nShould the example on line 1127 be\n\n`random_prime(200, proof=False, lbound=100) ` ? \n\nCurrently it's the same as the previous example. \n\nOne thing that would be nice is if you did like John did at #10105 and have doctests for the commands that currently hang Sage. Then if there are any regressions, and the bug(s) get back in, this will be detected. \n\nPerhaps I'll get bored of running my little script that supplies junk to commands to see what ones crash sage (like #10113) or hang Sage like this ticket, #10108 and #10105.",
    "created_at": "2010-10-11T05:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94950",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:2" align="right">Comment 2</div>

Mike, 
thank you for fixing this. I'll try this later today, but here's a few comments from reading the patch only - I've not tested it in Sage yet. 

Should the example on line 1127 be

`random_prime(200, proof=False, lbound=100) ` ? 

Currently it's the same as the previous example. 

One thing that would be nice is if you did like John did at #10105 and have doctests for the commands that currently hang Sage. Then if there are any regressions, and the bug(s) get back in, this will be detected. 

Perhaps I'll get bored of running my little script that supplies junk to commands to see what ones crash sage (like #10113) or hang Sage like this ticket, #10108 and #10105.



---

archive/issue_comments_094951.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nAttachment: **[trac_10112.patch.gz](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz)**\n\nI've updated the patch.",
    "created_at": "2010-10-11T06:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94951",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:3" align="right">Comment 3</div>

Attachment: **[trac_10112.patch.gz](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz)**

I've updated the patch.



---

archive/issue_comments_094952.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThank you, I will take a look later today and test it.",
    "created_at": "2010-10-11T07:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94952",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:4" align="right">Comment 4</div>

Thank you, I will take a look later today and test it.



---

archive/issue_comments_094953.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nThe patch deals with the cases listed.  But there are other cases which hang, like\n\n```\nsage: random_prime(8, lbound=8)\n```\nand some that almost do, like\n\n```\nsage: random_prime(3, lbound=-10^8)\n```\nThey can be very easily dealt with.  The additional patch does this.",
    "created_at": "2010-11-15T20:46:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94953",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:5" align="right">Comment 5</div>

The patch deals with the cases listed.  But there are other cases which hang, like

```
sage: random_prime(8, lbound=8)
```
and some that almost do, like

```
sage: random_prime(3, lbound=-10^8)
```
They can be very easily dealt with.  The additional patch does this.



---

archive/issue_comments_094954.json:
```json
{
    "body": "Attachment: **[trac_10112-extra.patch.gz](https://github.com/sagemath/sage/files/ticket10112/trac_10112-extra.patch.gz)**\n\nto apply after trac_10112.patch",
    "created_at": "2010-11-15T20:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94954",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Attachment: **[trac_10112-extra.patch.gz](https://github.com/sagemath/sage/files/ticket10112/trac_10112-extra.patch.gz)**

to apply after trac_10112.patch



---

archive/issue_comments_094955.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nThose two patches are a definite improvement, so I'm giving it a positive review.\n\nI've opened #10277 for another issue with `random_prime`\n\nSage's implementation is also incredibly slow compared to Mathematica. After 20 minutes of CPU time on a 3.33 GHz machine I was unable to generate one up to 10<sup>1000</sup> with Sage. Yet Mathematica can do that in 7 seconds! \n\nDave",
    "created_at": "2010-11-16T01:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94955",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:6" align="right">Comment 6</div>

Those two patches are a definite improvement, so I'm giving it a positive review.

I've opened #10277 for another issue with `random_prime`

Sage's implementation is also incredibly slow compared to Mathematica. After 20 minutes of CPU time on a 3.33 GHz machine I was unable to generate one up to 10<sup>1000</sup> with Sage. Yet Mathematica can do that in 7 seconds! 

Dave



---

archive/issue_events_120616.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-11-16T01:12:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120616"
}
```



---

archive/issue_events_120617.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-11-16T01:12:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120617"
}
```



---

archive/issue_comments_094956.json:
```json
{
    "body": "Reviewer: **David Kirkby**",
    "created_at": "2010-11-16T01:47:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94956",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Reviewer: **David Kirkby**



---

archive/issue_comments_094957.json:
```json
{
    "body": "Changed author from **Mike Hansen** to **Mike Hansen, Francis Clarke**",
    "created_at": "2010-11-16T01:47:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94957",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Changed author from **Mike Hansen** to **Mike Hansen, Francis Clarke**



---

archive/issue_comments_094958.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI'm setting this to 'needs info', as William remarked on sage-devel that he did not see this issue with 4,6 that I  get at. It seems **highly** unlikely, but these patches could just be whats casing that problem for me.",
    "created_at": "2010-11-16T09:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94958",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:8" align="right">Comment 8</div>

I'm setting this to 'needs info', as William remarked on sage-devel that he did not see this issue with 4,6 that I  get at. It seems **highly** unlikely, but these patches could just be whats casing that problem for me.



---

archive/issue_events_120618.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-11-16T09:12:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120618"
}
```



---

archive/issue_events_120619.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-11-16T09:12:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120619"
}
```



---

archive/issue_comments_094959.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nThe issue raised in\u00a0#10277 (which surely arises from using `random_prime` as patched here)\u00a0shows the weakness of using\u00a0`prime_pi`.  There is a much better way of checking that there are some primes in the range in question.  A replacement alternative patch will be posted very soon.",
    "created_at": "2010-11-16T09:24:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94959",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:9" align="right">Comment 9</div>

The issue raised in #10277 (which surely arises from using `random_prime` as patched here) shows the weakness of using `prime_pi`.  There is a much better way of checking that there are some primes in the range in question.  A replacement alternative patch will be posted very soon.



---

archive/issue_events_120620.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2010-11-16T09:24:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120620"
}
```



---

archive/issue_events_120621.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2010-11-16T09:24:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120621"
}
```



---

archive/issue_events_120622.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2010-11-16T11:15:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120622"
}
```



---

archive/issue_events_120623.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2010-11-16T11:15:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120623"
}
```



---

archive/issue_comments_094960.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nA replacement patch is attached. \u00a0It uses Betrand's postulate and refinements due to Nakura and Schoenfield. \u00a0Only when the ratio of the upper and lower bounds is quite close to one is the smallest prime in the interval computed.",
    "created_at": "2010-11-16T11:15:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94960",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:10" align="right">Comment 10</div>

A replacement patch is attached.  It uses Betrand's postulate and refinements due to Nakura and Schoenfield.  Only when the ratio of the upper and lower bounds is quite close to one is the smallest prime in the interval computed.



---

archive/issue_comments_094961.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nCan we create a fast but unsafe function `random_prime_unsafe()` and make the `random_prime()` function exposed to the users call that?\n\nATM, the `random_prime()` function is used in speed critical code. See `sage/ext/multi_modular.pyx` for example. In this use case, the checks are unnecessary and they would cause a dramatic slow down. We should be able to bypass the checks when we know the input makes sense. I suggest separating the core of the function from the code that makes it idiot-proof, and using the core directly in places like `sage/ext/multi_modular.pyx`.\n\nWhen this change is made, there should be a clear and loud warning in the release notes to notify people who rely on the current behavior of `random_prime()` to switch to this unsafe version in their personal codebase as well.",
    "created_at": "2010-11-16T11:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94961",
    "user": "https://github.com/burcin"
}
```

<div id="comment:11" align="right">Comment 11</div>

Can we create a fast but unsafe function `random_prime_unsafe()` and make the `random_prime()` function exposed to the users call that?

ATM, the `random_prime()` function is used in speed critical code. See `sage/ext/multi_modular.pyx` for example. In this use case, the checks are unnecessary and they would cause a dramatic slow down. We should be able to bypass the checks when we know the input makes sense. I suggest separating the core of the function from the code that makes it idiot-proof, and using the core directly in places like `sage/ext/multi_modular.pyx`.

When this change is made, there should be a clear and loud warning in the release notes to notify people who rely on the current behavior of `random_prime()` to switch to this unsafe version in their personal codebase as well.



---

archive/issue_events_120624.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-11-16T11:18:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120624"
}
```



---

archive/issue_events_120625.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-11-16T11:18:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120625"
}
```



---

archive/issue_comments_094962.json:
```json
{
    "body": "Attachment: **[trac_10112-replacement-extra.patch.gz](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz)**\n\nApply after trac_10112.patch INSTEAD of trac_10112-extra.patch",
    "created_at": "2010-11-16T11:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94962",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Attachment: **[trac_10112-replacement-extra.patch.gz](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz)**

Apply after trac_10112.patch INSTEAD of trac_10112-extra.patch



---

archive/issue_comments_094963.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@burcin](#comment%3A11):\n\n> Can we create a fast but unsafe function `random_prime_unsafe()` and make the `random_prime()` function exposed to the users call that? ATM, the `random_prime()` function is used in speed critical code. See `sage/ext/multi_modular.pyx` for example. In this use case, the checks are unnecessary and they would cause a dramatic slow down. [... ...]\n\nA good idea.  But the slowdown is, for most cases, far less significant with the new patch.",
    "created_at": "2010-11-16T12:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94963",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@burcin](#comment%3A11):

> Can we create a fast but unsafe function `random_prime_unsafe()` and make the `random_prime()` function exposed to the users call that? ATM, the `random_prime()` function is used in speed critical code. See `sage/ext/multi_modular.pyx` for example. In this use case, the checks are unnecessary and they would cause a dramatic slow down. [... ...]

A good idea.  But the slowdown is, for most cases, far less significant with the new patch.



---

archive/issue_comments_094964.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nProbably the way forward would be to have a \"check\" option.  But to quantify my earlier remark, I note that for the default bounds used in `sage/ext/multi_modular.pyx` (`10^15` and `10^10`),  the code checking that there are primes in that interval adds, on my machine, about 50 microseconds to the 1325 microseconds taken to find a random prime.",
    "created_at": "2010-11-16T22:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94964",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:13" align="right">Comment 13</div>

Probably the way forward would be to have a "check" option.  But to quantify my earlier remark, I note that for the default bounds used in `sage/ext/multi_modular.pyx` (`10^15` and `10^10`),  the code checking that there are primes in that interval adds, on my machine, about 50 microseconds to the 1325 microseconds taken to find a random prime.



---

archive/issue_comments_094965.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nIs there any reason this should not be changed to  positive review if the slowdown is very small? \n\nUnless there's universal agreement on this, I suggest the changes in documentation, are put on #10111. That ticket was supposed to address the deficiencies in the documentation. The only comment on that ticket is from Mike, and is *See the patch at #10112.* But if Mikes patch here, which changes both the documentation and the code is going to stall, we might as well just fix the documentation for now on #10111. The changes needed to the documentation appear to be\n\n* The example `random_prime(200, lbound=100)` is added \n* The example `random_prime(200, proof=False, lbound=100)` is added.\n* The error message in the code (which I guess is code not documentation), which changes *n must be greater than lbound* to *n must be at least lbound*. Clearly looking at the code, fwclarke's change is correct, since the test before the error message is `if n < lbound`. Therefore n=lbound is permitted by the code, so the correct error message should be *n must be at least lbound*\n\nIf there is no agreement to merge the two patches here, I'll create one patch which just fixes the above 3 documentation problems and add that to #10111. Does that make sense? \n\nDave",
    "created_at": "2011-03-28T08:47:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94965",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:14" align="right">Comment 14</div>

Is there any reason this should not be changed to  positive review if the slowdown is very small? 

Unless there's universal agreement on this, I suggest the changes in documentation, are put on #10111. That ticket was supposed to address the deficiencies in the documentation. The only comment on that ticket is from Mike, and is *See the patch at #10112.* But if Mikes patch here, which changes both the documentation and the code is going to stall, we might as well just fix the documentation for now on #10111. The changes needed to the documentation appear to be

* The example `random_prime(200, lbound=100)` is added 
* The example `random_prime(200, proof=False, lbound=100)` is added.
* The error message in the code (which I guess is code not documentation), which changes *n must be greater than lbound* to *n must be at least lbound*. Clearly looking at the code, fwclarke's change is correct, since the test before the error message is `if n < lbound`. Therefore n=lbound is permitted by the code, so the correct error message should be *n must be at least lbound*

If there is no agreement to merge the two patches here, I'll create one patch which just fixes the above 3 documentation problems and add that to #10111. Does that make sense? 

Dave



---

archive/issue_events_120626.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-03-28T08:47:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120626"
}
```



---

archive/issue_events_120627.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2011-03-28T08:47:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120627"
}
```



---

archive/issue_comments_094966.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -34,3 +34,8 @@\n ```\n \n Dave \n+\n+Apply\n+1. [attachment: trac_10112.patch]\n+2. [attachment: trac_10112-replacement-extra.patch]\n+to the Sage library.\n``````\n",
    "created_at": "2011-11-06T20:48:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94966",
    "user": "https://github.com/sagetrac-johanbosman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -34,3 +34,8 @@
 ```
 
 Dave 
+
+Apply
+1. [attachment: trac_10112.patch]
+2. [attachment: trac_10112-replacement-extra.patch]
+to the Sage library.
``````




---

archive/issue_comments_094967.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@sagetrac-drkirkby](#comment%3A14):\n> Is there any reason this should not be changed to  positive review if the slowdown is very small? \n> \n\nI don't think so.  The code looks okay, is well documented, and passes all tests.",
    "created_at": "2011-11-06T20:48:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94967",
    "user": "https://github.com/sagetrac-johanbosman"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@sagetrac-drkirkby](#comment%3A14):
> Is there any reason this should not be changed to  positive review if the slowdown is very small? 
> 

I don't think so.  The code looks okay, is well documented, and passes all tests.



---

archive/issue_events_120628.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2011-11-06T20:48:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120628"
}
```



---

archive/issue_events_120629.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2011-11-06T20:48:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120629"
}
```



---

archive/issue_comments_094968.json:
```json
{
    "body": "Changed reviewer from **David Kirkby** to **David Kirkby, Johan Bosman**",
    "created_at": "2011-11-06T20:48:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94968",
    "user": "https://github.com/sagetrac-johanbosman"
}
```

Changed reviewer from **David Kirkby** to **David Kirkby, Johan Bosman**



---

archive/issue_comments_094969.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -36,6 +36,6 @@\n Dave \n \n Apply\n-1. [attachment: trac_10112.patch]\n-2. [attachment: trac_10112-replacement-extra.patch]\n+1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz)\n+2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz)\n to the Sage library.\n``````\n",
    "created_at": "2011-11-07T10:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94969",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -36,6 +36,6 @@
 Dave 
 
 Apply
-1. [attachment: trac_10112.patch]
-2. [attachment: trac_10112-replacement-extra.patch]
+1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz)
+2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz)
 to the Sage library.
``````




---

archive/issue_comments_094970.json:
```json
{
    "body": "Merged: **sage-4.8.alpha1**",
    "created_at": "2011-11-07T20:25:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94970",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.8.alpha1**



---

archive/issue_events_120630.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-07T20:25:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120630"
}
```



---

archive/issue_events_120631.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-07T20:25:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120631"
}
```



---

archive/issue_comments_094971.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nThe patch contains non-ASCII characters which Sphinx 1.1.2 (#10620) rejects.",
    "created_at": "2011-11-11T18:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94971",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">Comment 18</div>

The patch contains non-ASCII characters which Sphinx 1.1.2 (#10620) rejects.



---

archive/issue_comments_094972.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nWe could put `# -*- coding: utf-8 -*-` at the top of the file arith.py -- I think the sagenb project has done this with all of their files -- but I prefer the attached patch.",
    "created_at": "2011-11-11T22:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94972",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">Comment 19</div>

We could put `# -*- coding: utf-8 -*-` at the top of the file arith.py -- I think the sagenb project has done this with all of their files -- but I prefer the attached patch.



---

archive/issue_events_120632.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-11-11T22:47:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120632"
}
```



---

archive/issue_comments_094973.json:
```json
{
    "body": "apply on top of other patches",
    "created_at": "2011-11-11T22:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94973",
    "user": "https://github.com/jhpalmieri"
}
```

apply on top of other patches



---

archive/issue_comments_094974.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nAttachment: **[trac_10112-ascii.patch.gz](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz)**",
    "created_at": "2011-11-11T22:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94974",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">Comment 20</div>

Attachment: **[trac_10112-ascii.patch.gz](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz)**



---

archive/issue_comments_094975.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -38,4 +38,5 @@\n Apply\n 1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz)\n 2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz)\n+3. [attachment: trac_10112-ascii.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz)\n to the Sage library.\n``````\n",
    "created_at": "2011-11-11T22:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94975",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -38,4 +38,5 @@
 Apply
 1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz)
 2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz)
+3. [attachment: trac_10112-ascii.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz)
 to the Sage library.
``````




---

archive/issue_comments_094976.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -36,7 +36,7 @@\n Dave \n \n Apply\n-1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz)\n-2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz)\n-3. [attachment: trac_10112-ascii.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz)\n+1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz) (merged in sage-4.8.alpha1)\n+2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz) (merged in sage-4.8.alpha1)\n+3. [attachment: trac_10112-ascii.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz) (merged in sage-4.8.alpha2)\n to the Sage library.\n``````\n",
    "created_at": "2011-11-11T22:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10112#issuecomment-94976",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -36,7 +36,7 @@
 Dave 
 
 Apply
-1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz)
-2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz)
-3. [attachment: trac_10112-ascii.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz)
+1. [attachment: trac_10112.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112.patch.gz) (merged in sage-4.8.alpha1)
+2. [attachment: trac_10112-replacement-extra.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-replacement-extra.patch.gz) (merged in sage-4.8.alpha1)
+3. [attachment: trac_10112-ascii.patch](https://github.com/sagemath/sage/files/ticket10112/trac_10112-ascii.patch.gz) (merged in sage-4.8.alpha2)
 to the Sage library.
``````




---

archive/issue_events_120633.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-11T22:55:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120633"
}
```



---

archive/issue_events_120634.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-11T22:55:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10112",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10112#event-120634"
}
```
