# Issue 10809: Cartesian products of toric varieties

archive/issues_010743.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "The two attached patches implement cartesian products for cones/fans and toric varieties, respectively. \n\nDepends on #10675.\n\n**Apply:**\n1. [attachment: trac_10809_fan_cartesian_product.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_fan_cartesian_product.patch.gz)\n2. [attachment: trac_10809_toric_varieties_cartesian_product.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_toric_varieties_cartesian_product.patch.gz)\n3. [attachment: trac_10809_reviewer.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_reviewer.patch.gz)\n\n\nCC:  @novoselt\n\nKeywords: **toric geometry**\n\nComponent: **algebraic geometry**\n\nAuthor: **Volker Braun, Andrey Novoseltsev**\n\nReviewer: **Andrey Novoseltsev, Volker Braun**\n\nMerged: **sage-4.7.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10809_\n\n",
    "closed_at": "2011-03-25T12:30:26Z",
    "created_at": "2011-02-20T21:45:50Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20geometry"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Cartesian products of toric varieties",
    "type": "issue",
    "updated_at": "2011-03-25T12:30:26Z",
    "url": "https://github.com/sagemath/sage/issues/10809",
    "user": "https://github.com/vbraun"
}
```
The two attached patches implement cartesian products for cones/fans and toric varieties, respectively. 

Depends on #10675.

**Apply:**
1. [attachment: trac_10809_fan_cartesian_product.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_fan_cartesian_product.patch.gz)
2. [attachment: trac_10809_toric_varieties_cartesian_product.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_toric_varieties_cartesian_product.patch.gz)
3. [attachment: trac_10809_reviewer.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_reviewer.patch.gz)


CC:  @novoselt

Keywords: **toric geometry**

Component: **algebraic geometry**

Author: **Volker Braun, Andrey Novoseltsev**

Reviewer: **Andrey Novoseltsev, Volker Braun**

Merged: **sage-4.7.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/10809_





---

archive/issue_events_141606.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-20T21:45:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141606"
}
```



---

archive/issue_events_141607.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-20T21:45:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
    "label_color": "0000ff",
    "label_name": "c: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141607"
}
```



---

archive/issue_events_141608.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-20T21:45:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141608"
}
```



---

archive/issue_events_141609.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-20T21:45:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141609"
}
```



---

archive/issue_events_141610.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2011-02-20T21:45:50Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141610"
}
```



---

archive/issue_comments_104327.json:
```json
{
    "body": "Changed keywords from none to **toric geometry**",
    "created_at": "2011-02-20T21:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104327",
    "user": "https://github.com/vbraun"
}
```

Changed keywords from none to **toric geometry**



---

archive/issue_events_141611.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-20T21:49:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141611"
}
```



---

archive/issue_events_141612.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-20T21:49:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141612"
}
```



---

archive/issue_events_141613.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-20T22:13:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141613"
}
```



---

archive/issue_events_141614.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-20T22:13:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141614"
}
```



---

archive/issue_comments_104328.json:
```json
{
    "body": "Reviewer: **Andrey Novoseltsev**",
    "created_at": "2011-02-20T22:13:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104328",
    "user": "https://github.com/novoselt"
}
```

Reviewer: **Andrey Novoseltsev**



---

archive/issue_comments_104329.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThat's a neat addition, but I don't quite like lattice name decoration and I think it will not look nice with repeated direct sums. Unfortunately, I am not sure what would be better.\n\nOne solution is to replace default names with \"N3\" for a 3-d lattice N, with `N^{3}` for LaTeX purposes so that `N^3_\\RR` looks nicely. This is actually handy when one works with many lattices of different dimensions, and we can then shorten the current `_repr_` of lattices from \"3-d lattice N\" to just \"N3\" with cones printed as \"2-d cone in N3\". I think I am in favour of such a change, the major problem here is that we'll have to fix a lot of doctests, but better now than later ;-)\n\nAs a lazier alternative I propose not to change names at all - if a user does not like names \"N+N\", there is an option to provide custom ones.",
    "created_at": "2011-02-20T22:13:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104329",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:2" align="right">comment:2</div>

That's a neat addition, but I don't quite like lattice name decoration and I think it will not look nice with repeated direct sums. Unfortunately, I am not sure what would be better.

One solution is to replace default names with "N3" for a 3-d lattice N, with `N^{3}` for LaTeX purposes so that `N^3_\RR` looks nicely. This is actually handy when one works with many lattices of different dimensions, and we can then shorten the current `_repr_` of lattices from "3-d lattice N" to just "N3" with cones printed as "2-d cone in N3". I think I am in favour of such a change, the major problem here is that we'll have to fix a lot of doctests, but better now than later ;-)

As a lazier alternative I propose not to change names at all - if a user does not like names "N+N", there is an option to provide custom ones.



---

archive/issue_comments_104330.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI thought about decorating the lattices with their dimension, but often the two lattices have the same dimension (e.g. P1 x P1). Thats why I didn't implement it to begin with.\n\nThe current approach really only doesn't work with repeated direct sums of lattices. I don't think that there is any good automated solution in that case, and you'll have to manually set the name or live with ugly ones.",
    "created_at": "2011-02-20T22:49:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104330",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

I thought about decorating the lattices with their dimension, but often the two lattices have the same dimension (e.g. P1 x P1). Thats why I didn't implement it to begin with.

The current approach really only doesn't work with repeated direct sums of lattices. I don't think that there is any good automated solution in that case, and you'll have to manually set the name or live with ugly ones.



---

archive/issue_comments_104331.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWell, I still think it is better not to decorate names at all. If I see N1+N2 I expect that there is N1 and N2 and their direct sum. Instead, there is only N and its Cartesian square is denoted differently. I mean, people write `\\ZZ \\oplus \\ZZ`, but not `\\ZZ_1 \\oplus \\ZZ_2` with indices added just to distinguish copies. You can already see that one is first and the other is second ;-)\n\nIn our case N+N can be a bit misleading if one N is of dimension 2 and the other is of dimension 3, but naming the sum N1+N2 does not make it better. On the other hand, N2+N3 or even N2+N2 would be meaningful, but I don't insist on that.",
    "created_at": "2011-02-21T03:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104331",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:4" align="right">comment:4</div>

Well, I still think it is better not to decorate names at all. If I see N1+N2 I expect that there is N1 and N2 and their direct sum. Instead, there is only N and its Cartesian square is denoted differently. I mean, people write `\ZZ \oplus \ZZ`, but not `\ZZ_1 \oplus \ZZ_2` with indices added just to distinguish copies. You can already see that one is first and the other is second ;-)

In our case N+N can be a bit misleading if one N is of dimension 2 and the other is of dimension 3, but naming the sum N1+N2 does not make it better. On the other hand, N2+N3 or even N2+N2 would be meaningful, but I don't insist on that.



---

archive/issue_comments_104332.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nOk I've removed the decorations. If both lattices were already called `N` then I think its fair to say that the user has no particular interest in giving them names, so I'm naming the sum `N` as well. Thats still nicer than `N+N`, I think.",
    "created_at": "2011-02-21T20:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104332",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:5" align="right">comment:5</div>

Ok I've removed the decorations. If both lattices were already called `N` then I think its fair to say that the user has no particular interest in giving them names, so I'm naming the sum `N` as well. Thats still nicer than `N+N`, I think.



---

archive/issue_events_141615.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-21T20:04:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141615"
}
```



---

archive/issue_events_141616.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-21T20:04:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141616"
}
```



---

archive/issue_events_141617.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-21T21:15:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141617"
}
```



---

archive/issue_events_141618.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-21T21:15:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141618"
}
```



---

archive/issue_comments_104333.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIn the P2xP2 example I'd say that one should expect the product fan to live exactly in `N+N` so I think that\n\n```\n        rank = self.rank() + other.rank()\n        if self._name==other._name:\n            name=None\n            dual_name=None\n        else:\n            name = make_name(self, other, False)\n            dual_name = make_name(self.dual(), other.dual(), False)\n        if latex(self)==latex(other):\n            latex_name=None\n            latex_dual_name=None\n        else:\n            latex_name = make_name(self, other, True)\n            latex_dual_name = make_name(self.dual(), other.dual(), True)\n        return ToricLattice(rank, name, dual_name, latex_name, latex_dual_name)\n```\ncan be replaced with\n\n```\n        rank = self.rank() + other.rank()\n        name = make_name(self, other, False)\n        dual_name = make_name(self.dual(), other.dual(), False)\n        latex_name = make_name(self, other, True)\n        latex_dual_name = make_name(self.dual(), other.dual(), True)\n        return ToricLattice(rank, name, dual_name, latex_name, latex_dual_name)\n```\nfor simplicity and consistency. Note that if the user makes \"lattice N\" explicitly, then\n\n```\nsage: myN = ToricLattice(3, \"N\")\nsage: myN.dual()\n3-d lattice N*\n```\nso if I try to take the sum `N + myN`, the result has names\n\n```\nN, M, N, M\n```\nbut `N.dual() + myN.dual()` will give\n\n```\nM+N*, N+N, M \\oplus N^*, N \\oplus N\n```\nin particular, the sum of duals is not the dual of the sum. With the simpler code that does not try to be intelligent, the first set of names would be\n\n```\nN+N, M+N*, N \\oplus N, M \\oplus N^*\n```\nand the duality will work nicely.\n\nSince duality is important not just for pretty printing, but also for action on lattices, I now strongly feel that the sum should always be called just \"left+right\".\n\nOf course, it is not difficult to add a few more checks to your code to avoid the above problem. One can also ask if we should identify 4-d N with 2-d N + 2-d N or treat these lattices as different. I guess with my suggestions they will be different, but 2-d N + 2-d N would be the same as 1-d N + 3-d N. I think they all better be different, but that brings us back to the necessity of including ranks into lattice names. Kind of a compromise would be to allow user to provide all names as optional input to `direct_sum` and if any names were given - pass them to the lattice constructor instead of concatenating existing names. But as a default I still think `N+N` is the best.\n\nMinor point: it seems that there is no need to import `LatexExpr` inside the sum function.",
    "created_at": "2011-02-21T21:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104333",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:6" align="right">comment:6</div>

In the P2xP2 example I'd say that one should expect the product fan to live exactly in `N+N` so I think that

```
        rank = self.rank() + other.rank()
        if self._name==other._name:
            name=None
            dual_name=None
        else:
            name = make_name(self, other, False)
            dual_name = make_name(self.dual(), other.dual(), False)
        if latex(self)==latex(other):
            latex_name=None
            latex_dual_name=None
        else:
            latex_name = make_name(self, other, True)
            latex_dual_name = make_name(self.dual(), other.dual(), True)
        return ToricLattice(rank, name, dual_name, latex_name, latex_dual_name)
```
can be replaced with

```
        rank = self.rank() + other.rank()
        name = make_name(self, other, False)
        dual_name = make_name(self.dual(), other.dual(), False)
        latex_name = make_name(self, other, True)
        latex_dual_name = make_name(self.dual(), other.dual(), True)
        return ToricLattice(rank, name, dual_name, latex_name, latex_dual_name)
```
for simplicity and consistency. Note that if the user makes "lattice N" explicitly, then

```
sage: myN = ToricLattice(3, "N")
sage: myN.dual()
3-d lattice N*
```
so if I try to take the sum `N + myN`, the result has names

```
N, M, N, M
```
but `N.dual() + myN.dual()` will give

```
M+N*, N+N, M \oplus N^*, N \oplus N
```
in particular, the sum of duals is not the dual of the sum. With the simpler code that does not try to be intelligent, the first set of names would be

```
N+N, M+N*, N \oplus N, M \oplus N^*
```
and the duality will work nicely.

Since duality is important not just for pretty printing, but also for action on lattices, I now strongly feel that the sum should always be called just "left+right".

Of course, it is not difficult to add a few more checks to your code to avoid the above problem. One can also ask if we should identify 4-d N with 2-d N + 2-d N or treat these lattices as different. I guess with my suggestions they will be different, but 2-d N + 2-d N would be the same as 1-d N + 3-d N. I think they all better be different, but that brings us back to the necessity of including ranks into lattice names. Kind of a compromise would be to allow user to provide all names as optional input to `direct_sum` and if any names were given - pass them to the lattice constructor instead of concatenating existing names. But as a default I still think `N+N` is the best.

Minor point: it seems that there is no need to import `LatexExpr` inside the sum function.



---

archive/issue_comments_104334.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-02-27T12:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104334",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_events_141619.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-27T12:59:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141619"
}
```



---

archive/issue_events_141620.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-27T12:59:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141620"
}
```



---

archive/issue_comments_104335.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac_10809_toric_varieties_cartesian_product.patch.gz](https://github.com/sagemath/sage/files/ticket10809/trac_10809_toric_varieties_cartesian_product.patch.gz)**",
    "created_at": "2011-02-27T12:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104335",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac_10809_toric_varieties_cartesian_product.patch.gz](https://github.com/sagemath/sage/files/ticket10809/trac_10809_toric_varieties_cartesian_product.patch.gz)**



---

archive/issue_comments_104336.json:
```json
{
    "body": "Changed author from **Volker Braun** to **Volker Braun, Andrey Novoseltsev**",
    "created_at": "2011-03-02T02:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104336",
    "user": "https://github.com/novoselt"
}
```

Changed author from **Volker Braun** to **Volker Braun, Andrey Novoseltsev**



---

archive/issue_comments_104337.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHi Volker,\n\nTechnical note: the patch applies almost fine on top of 4.6.2.rc0+10522+10675 which are positively reviewed. \"Almost\" disappears if the very first hunk in your patch for cones is removed. Since it is just a white space issue, I propose that you remove it and this ticket becomes next in line after 10675.\n\nI was unifying documentation and optimizing code, so now you need to review the result ;-) Changes that I have made:\n1. Ray collections can compute their products and the result is used by cones and fans.\n2. Default dual lattices are now `ZZ^n`, as we have agreed to do on some ticket but it was never done.\n3. Fans are now computing their product using \"internal representation of fans\" rather then products of cones. This should be much faster and more memory efficient then constructing all separate cones and then using them to generate a fan. I have also included optimization for products of complete fans (the product will know that it is complete as well).\n4. CPR-Fano toric varieties can now handle products with common toric varieties.\n5. It is possible to give custom names to variables of the product varieties.\n\nI also thought that `Cartesian_product` is more in the spirit of other names in our modules, but I have discovered that toric varieties already have `CartesianProduct` and `cartesian_product` inherited from general categories framework. I think that it would be confusing to add `Cartesian_product` as well. I also don't quite feel comfortable overriding `cartesian_product` with something that has nothing to do with the base method (I mean - they both are Cartesian products, but treated quite differently). So, I am not quite sure what to do... What are your thoughts about it? Did you know about these methods? Maybe new methods should be called just `product`? Once we settle on something, I will update my patch.",
    "created_at": "2011-03-02T02:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104337",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:8" align="right">comment:8</div>

Hi Volker,

Technical note: the patch applies almost fine on top of 4.6.2.rc0+10522+10675 which are positively reviewed. "Almost" disappears if the very first hunk in your patch for cones is removed. Since it is just a white space issue, I propose that you remove it and this ticket becomes next in line after 10675.

I was unifying documentation and optimizing code, so now you need to review the result ;-) Changes that I have made:
1. Ray collections can compute their products and the result is used by cones and fans.
2. Default dual lattices are now `ZZ^n`, as we have agreed to do on some ticket but it was never done.
3. Fans are now computing their product using "internal representation of fans" rather then products of cones. This should be much faster and more memory efficient then constructing all separate cones and then using them to generate a fan. I have also included optimization for products of complete fans (the product will know that it is complete as well).
4. CPR-Fano toric varieties can now handle products with common toric varieties.
5. It is possible to give custom names to variables of the product varieties.

I also thought that `Cartesian_product` is more in the spirit of other names in our modules, but I have discovered that toric varieties already have `CartesianProduct` and `cartesian_product` inherited from general categories framework. I think that it would be confusing to add `Cartesian_product` as well. I also don't quite feel comfortable overriding `cartesian_product` with something that has nothing to do with the base method (I mean - they both are Cartesian products, but treated quite differently). So, I am not quite sure what to do... What are your thoughts about it? Did you know about these methods? Maybe new methods should be called just `product`? Once we settle on something, I will update my patch.



---

archive/issue_comments_104338.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n The two attached patches implement cartesian products for cones/fans and toric varieties, respectively. \n+\n+Depends on #10675.\n+\n+Apply all patches in order.\n``````\n",
    "created_at": "2011-03-02T02:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104338",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
 The two attached patches implement cartesian products for cones/fans and toric varieties, respectively. 
+
+Depends on #10675.
+
+Apply all patches in order.
``````




---

archive/issue_comments_104339.json:
```json
{
    "body": "Changed reviewer from **Andrey Novoseltsev** to **Andrey Novoseltsev, Volker Braun**",
    "created_at": "2011-03-02T02:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104339",
    "user": "https://github.com/novoselt"
}
```

Changed reviewer from **Andrey Novoseltsev** to **Andrey Novoseltsev, Volker Braun**



---

archive/issue_events_141621.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-03-02T02:02:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141621"
}
```



---

archive/issue_events_141622.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-03-02T02:02:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141622"
}
```



---

archive/issue_comments_104340.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI think we should override the base `cartesian_product`. The category framework provides some default implementations but here it doesn't make much sense to use it.",
    "created_at": "2011-03-02T10:19:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104340",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

I think we should override the base `cartesian_product`. The category framework provides some default implementations but here it doesn't make much sense to use it.



---

archive/issue_comments_104341.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI've asked on sage-combinat if that's OK:\nhttp://groups.google.com/group/sage-combinat-devel/browse_thread/thread/c8dce426c4c5a00f\nIf they are fine, I'll change the names back to `cartesian_product`. I currently don't need the generic version personally, but I don't want to break things without need.",
    "created_at": "2011-03-02T18:01:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104341",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:10" align="right">comment:10</div>

I've asked on sage-combinat if that's OK:
http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/c8dce426c4c5a00f
If they are fine, I'll change the names back to `cartesian_product`. I currently don't need the generic version personally, but I don't want to break things without need.



---

archive/issue_comments_104342.json:
```json
{
    "body": "Work Issues: **names for product methods**",
    "created_at": "2011-03-02T18:01:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104342",
    "user": "https://github.com/novoselt"
}
```

Work Issues: **names for product methods**



---

archive/issue_comments_104343.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nJudging from what Nicolas said on sage-combinat-devel, I don't think that we should cover generic `cartesian_product`.\n\nSo as a somewhat dirty but quick solution I propose changing names of new methods to just `product`.\n\nAs a potentially better but longer alternative I think we should\n* Learn a bit more about current Cartesian products framework.\n* Implement classes `CartesianProductOfToricVarieties(ToricVariety_field, maybe-some-standard-product-class)` and `CartesianProductOfCPRFanoToricVarieties(CPRFanoToricVariety_field, CartesianProductOfToricVarieties)` that will behave like varieties but at the same time will know their product structure and in particular have projection methods.\n* Make `cartesian_product` methods return objects of these classes.\nI think such functionality would be great, but I'd rather leave its implementation to the future...",
    "created_at": "2011-03-04T02:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104343",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:11" align="right">comment:11</div>

Judging from what Nicolas said on sage-combinat-devel, I don't think that we should cover generic `cartesian_product`.

So as a somewhat dirty but quick solution I propose changing names of new methods to just `product`.

As a potentially better but longer alternative I think we should
* Learn a bit more about current Cartesian products framework.
* Implement classes `CartesianProductOfToricVarieties(ToricVariety_field, maybe-some-standard-product-class)` and `CartesianProductOfCPRFanoToricVarieties(CPRFanoToricVariety_field, CartesianProductOfToricVarieties)` that will behave like varieties but at the same time will know their product structure and in particular have projection methods.
* Make `cartesian_product` methods return objects of these classes.
I think such functionality would be great, but I'd rather leave its implementation to the future...



---

archive/issue_events_141623.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-03-05T02:45:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141623"
}
```



---

archive/issue_events_141624.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-03-05T02:45:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141624"
}
```



---

archive/issue_comments_104344.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAttachment: **[trac_10809_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket10809/trac_10809_reviewer.patch.gz)**\n\nOK, names are back to `cartesian_product` and we will hope to add projection maps later. Feel free to set to it positive review if you are OK with other changes.",
    "created_at": "2011-03-05T02:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104344",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:12" align="right">comment:12</div>

Attachment: **[trac_10809_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket10809/trac_10809_reviewer.patch.gz)**

OK, names are back to `cartesian_product` and we will hope to add projection maps later. Feel free to set to it positive review if you are OK with other changes.



---

archive/issue_comments_104345.json:
```json
{
    "body": "Changed work issues from **names for product methods** to none",
    "created_at": "2011-03-05T02:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104345",
    "user": "https://github.com/novoselt"
}
```

Changed work issues from **names for product methods** to none



---

archive/issue_comments_104346.json:
```json
{
    "body": "Rebased patch",
    "created_at": "2011-03-16T15:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104346",
    "user": "https://github.com/vbraun"
}
```

Rebased patch



---

archive/issue_comments_104347.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[trac_10809_fan_cartesian_product.patch.gz](https://github.com/sagemath/sage/files/ticket10809/trac_10809_fan_cartesian_product.patch.gz)**\n\nOk good. Applies fine on top of sage-4.7.alpha1",
    "created_at": "2011-03-16T15:51:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104347",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[trac_10809_fan_cartesian_product.patch.gz](https://github.com/sagemath/sage/files/ticket10809/trac_10809_fan_cartesian_product.patch.gz)**

Ok good. Applies fine on top of sage-4.7.alpha1



---

archive/issue_events_141625.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-03-16T15:51:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141625"
}
```



---

archive/issue_events_141626.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-03-16T15:51:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141626"
}
```



---

archive/issue_comments_104348.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nUm, what was wrong with the patch here? My suggestion was to keep it as is and rebase #10140 on top of this one... Does this one still apply after #10675?",
    "created_at": "2011-03-16T16:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104348",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:14" align="right">comment:14</div>

Um, what was wrong with the patch here? My suggestion was to keep it as is and rebase #10140 on top of this one... Does this one still apply after #10675?



---

archive/issue_comments_104349.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,8 @@\n \n Depends on #10675.\n \n-Apply all patches in order.\n+Apply\n+trac_10809_fan_cartesian_product.patch,\n+trac_10809_toric_varieties_cartesian_product.patch,\n+trac_10809_reviewer.patch\n+\n``````\n",
    "created_at": "2011-03-16T16:23:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104349",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,8 @@
 
 Depends on #10675.
 
-Apply all patches in order.
+Apply
+trac_10809_fan_cartesian_product.patch,
+trac_10809_toric_varieties_cartesian_product.patch,
+trac_10809_reviewer.patch
+
``````




---

archive/issue_comments_104350.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI reordered my patches as in #9604 and got some fuzz here, so I rediffed it. My patch queue has now\n\n```\ntrac_10675_nef_complete_intersections.patch\ntrac_10039_parma_polyhedra_library.patch\ntrac_10943_fan_morphism_non_full_dim_fan.patch\ntrac_10809_fan_cartesian_product.patch\ntrac_10809_toric_varieties_cartesian_product.patch\ntrac_10809_reviewer.patch\ntrac_10882_kernel_fan.patch\ntrac_10529_toric_variety_library_names.patch\ntrac_10529_MPolynomialIdeal_subs.patch\ntrac_10529_QuotientRingElement_call.patch\ntrac_10529_SubschemeMorphisms_without_QuotientRing.patch\ntrac_10529_smoothness_of_algebraic_subschemes.patch\ntrac_10140_base_cone_on_ppl.patch\ntrac_10140_fix_toric_variety_doctests.patch\ntrac_10023_Hilbert_basis.patch\ntrac_10540_toric_ideals.patch\ntrac_10540_Spec_of_affine_toric_variety.patch\n```",
    "created_at": "2011-03-16T16:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104350",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:16" align="right">comment:16</div>

I reordered my patches as in #9604 and got some fuzz here, so I rediffed it. My patch queue has now

```
trac_10675_nef_complete_intersections.patch
trac_10039_parma_polyhedra_library.patch
trac_10943_fan_morphism_non_full_dim_fan.patch
trac_10809_fan_cartesian_product.patch
trac_10809_toric_varieties_cartesian_product.patch
trac_10809_reviewer.patch
trac_10882_kernel_fan.patch
trac_10529_toric_variety_library_names.patch
trac_10529_MPolynomialIdeal_subs.patch
trac_10529_QuotientRingElement_call.patch
trac_10529_SubschemeMorphisms_without_QuotientRing.patch
trac_10529_smoothness_of_algebraic_subschemes.patch
trac_10140_base_cone_on_ppl.patch
trac_10140_fix_toric_variety_doctests.patch
trac_10023_Hilbert_basis.patch
trac_10540_toric_ideals.patch
trac_10540_Spec_of_affine_toric_variety.patch
```



---

archive/issue_comments_104351.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOK!",
    "created_at": "2011-03-16T17:06:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104351",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:17" align="right">comment:17</div>

OK!



---

archive/issue_comments_104352.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,8 +2,8 @@\n \n Depends on #10675.\n \n-Apply\n-trac_10809_fan_cartesian_product.patch,\n-trac_10809_toric_varieties_cartesian_product.patch,\n-trac_10809_reviewer.patch\n+**Apply:**\n+1. [attachment: trac_10809_fan_cartesian_product.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_fan_cartesian_product.patch.gz)\n+2. [attachment: trac_10809_toric_varieties_cartesian_product.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_toric_varieties_cartesian_product.patch.gz)\n+3. [attachment: trac_10809_reviewer.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_reviewer.patch.gz)\n \n``````\n",
    "created_at": "2011-03-24T20:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104352",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,8 +2,8 @@
 
 Depends on #10675.
 
-Apply
-trac_10809_fan_cartesian_product.patch,
-trac_10809_toric_varieties_cartesian_product.patch,
-trac_10809_reviewer.patch
+**Apply:**
+1. [attachment: trac_10809_fan_cartesian_product.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_fan_cartesian_product.patch.gz)
+2. [attachment: trac_10809_toric_varieties_cartesian_product.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_toric_varieties_cartesian_product.patch.gz)
+3. [attachment: trac_10809_reviewer.patch](https://github.com/sagemath/sage/files/ticket10809/trac_10809_reviewer.patch.gz)
 
``````




---

archive/issue_events_141627.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-25T12:30:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141627"
}
```



---

archive/issue_events_141628.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-25T12:30:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10809#event-141628"
}
```



---

archive/issue_comments_104353.json:
```json
{
    "body": "Merged: **sage-4.7.alpha3**",
    "created_at": "2011-03-25T12:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10809#issuecomment-104353",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.alpha3**
