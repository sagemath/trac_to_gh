# Issue 10108: Calling mwrank(-10) hangs Sage, but uses very little CPU time

archive/issues_010107.json:
```json
{
    "body": "Following some very quick hacks at using \"fuzz testing\" techniques, I found that\n\n```\nsage: mwrank(-10)\n```\n\njust hangs, but does not appear to be using any CPU time. Although I don't know what this is supposed to do, from discussions on sage-devel, I understand my suspicions this behavior is an error were correct. \n\nCan someone please select the component appropriately, as I don't have a clue myself. \n\n\n**Assignee:** @JohnCremona\n\n**CC:**  @JohnCremona\n\n**Keywords:** mwrank\n\n**Branch:** [u/wuthrich/ticket/10108](https://github.com/sagemath/sagetrac-mirror/tree/u/wuthrich/ticket/10108)\n\n**Commit:** [0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4](https://github.com/sagemath/sagetrac-mirror/commit/0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4)\n\n**Reviewer:** Mike Hansen, Chris Wuthrich\n\n**Author:** John Cremona\n\nIssue created by migration from https://trac.sagemath.org/ticket/10108\n\n",
    "closed_at": "2014-02-01T15:16:59Z",
    "created_at": "2010-10-09T19:53:29Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "title": "Calling mwrank(-10) hangs Sage, but uses very little CPU time",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/10108",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
Following some very quick hacks at using "fuzz testing" techniques, I found that

```
sage: mwrank(-10)
```

just hangs, but does not appear to be using any CPU time. Although I don't know what this is supposed to do, from discussions on sage-devel, I understand my suspicions this behavior is an error were correct. 

Can someone please select the component appropriately, as I don't have a clue myself. 


**Assignee:** @JohnCremona

**CC:**  @JohnCremona

**Keywords:** mwrank

**Branch:** [u/wuthrich/ticket/10108](https://github.com/sagemath/sagetrac-mirror/tree/u/wuthrich/ticket/10108)

**Commit:** [0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4](https://github.com/sagemath/sagetrac-mirror/commit/0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4)

**Reviewer:** Mike Hansen, Chris Wuthrich

**Author:** John Cremona

Issue created by migration from https://trac.sagemath.org/ticket/10108





---

archive/issue_comments_094840.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"mwrank\".",
    "created_at": "2010-10-09T19:55:25Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94840",
    "user": "https://github.com/JohnCremona"
}
```

**Changing keywords** from "" to "mwrank".



---

archive/issue_events_076497.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-10-09T19:55:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "component: elliptic curves",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76497"
}
```



---

archive/issue_comments_094841.json:
```json
{
    "body": "**Assignee:** @JohnCremona",
    "created_at": "2010-10-09T19:55:25Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94841",
    "user": "https://github.com/JohnCremona"
}
```

**Assignee:** @JohnCremona



---

archive/issue_comments_094842.json:
```json
{
    "body": "<a id='comment:1'></a>\nI have a patch for this which I will post soon.",
    "created_at": "2010-10-09T19:55:25Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94842",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
I have a patch for this which I will post soon.



---

archive/issue_comments_094843.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [cremona](#comment%3A1):\n> I have a patch for this which I will post soon.\n\n\nDelays caused by break in internet access -- hope to post patch Sunday.",
    "created_at": "2010-10-09T22:21:00Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94843",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
Replying to [cremona](#comment%3A1):
> I have a patch for this which I will post soon.


Delays caused by break in internet access -- hope to post patch Sunday.



---

archive/issue_comments_094844.json:
```json
{
    "body": "applies to 4.6.alpha3",
    "created_at": "2010-10-10T20:18:19Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94844",
    "user": "https://github.com/JohnCremona"
}
```

applies to 4.6.alpha3



---

archive/attachments_013179.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10108-mwrank.patch",
    "asset_url": "tarball://root/attachments/ticket10108/trac_10108-mwrank.patch",
    "created_at": "2010-10-10T20:23:20Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.patch",
    "user": "https://github.com/JohnCremona"
}
```



---

archive/issue_comments_094845.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_10108-mwrank.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.patch) by @JohnCremona created at 2010-10-10 20:23:20\n\nThis was harder than expected.  Without either (1) rewriting mwrank's in put parser or (2) writing a full parser within Sage and only sending to mwrank when certainly correct, which I do not want to do.  If you feed mwrank correct but incomplete input (such as <5 integers separated by whitespace) it quietly waits for the rest of the input (with no prompts).\n\nTo get around this I pad the strings sent to mwrank with ' 0 0 0 0 0 ' which means that this never happens, and then to get repeated calls to mwrank to work properly need a bit of fiddling.  I tested the patch on two machines (4.6.alpha3).",
    "created_at": "2010-10-10T20:23:20Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94845",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
Attachment [trac_10108-mwrank.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.patch) by @JohnCremona created at 2010-10-10 20:23:20

This was harder than expected.  Without either (1) rewriting mwrank's in put parser or (2) writing a full parser within Sage and only sending to mwrank when certainly correct, which I do not want to do.  If you feed mwrank correct but incomplete input (such as <5 integers separated by whitespace) it quietly waits for the rest of the input (with no prompts).

To get around this I pad the strings sent to mwrank with ' 0 0 0 0 0 ' which means that this never happens, and then to get repeated calls to mwrank to work properly need a bit of fiddling.  I tested the patch on two machines (4.6.alpha3).



---

archive/issue_comments_094846.json:
```json
{
    "body": "**Author:** John Cremona",
    "created_at": "2010-10-10T20:23:20Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94846",
    "user": "https://github.com/JohnCremona"
}
```

**Author:** John Cremona



---

archive/issue_events_076498.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-10-10T20:23:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76498"
}
```



---

archive/issue_comments_094847.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [cremona](#comment%3A3):\n> This was harder than expected.  Without either (1) rewriting mwrank's in put parser or (2) writing a full parser within Sage and only sending to mwrank when certainly correct, which I do not want to do.  If you feed mwrank correct but incomplete input (such as <5 integers separated by whitespace) it quietly waits for the rest of the input (with no prompts).\n\n\n\nIf this hard, then perhaps it's more effort to fix properly than it is worth. You are a better judge of that than me. \n\nI can't help feeling if this is supposed to take 5 integers then it should take 5, and not accept fewer or more, as it does. For example:\n\n```\nsage: mwrank('1 2 3')\n\"Curve [0,0,0,1,2] :     \\n1 points of order 2:\\n[-1:0:1]\\n\\nUsing 2-isogenous curve [0,6,0,-7,0] (minimal model [0,0,0,-19,30])\\n-------------------------------------------------------\\nFirst step, determining 1st descent Selmer groups\\n-------------------------------------------------------\\nAfter first local descent, rank bound = 0\\nrk(S^{phi}(E'))=        1\\nrk(S^{phi'}(E))=        1\\n\\n-------------------------------------------------------\\nSecond step, determining 2nd descent Selmer groups\\n-------------------------------------------------------\\n...skipping since we already know rank=0\\nAfter second local descent, rank bound = 0\\nrk(phi'(S^{2}(E)))=     1\\nrk(phi(S^{2}(E')))=     1\\nrk(S^{2}(E))=   1\\nrk(S^{2}(E'))=  2\\n\\nThird step, determining E(Q)/phi(E'(Q)) and E'(Q)/phi'(E(Q))\\n-------------------------------------------------------\\n1. E(Q)/phi(E'(Q))\\n-------------------------------------------------------\\n(c,d)  =(-3,4)\\n(c',d')=(6,-7)\\nThis component of the rank is 0\\n-------------------------------------------------------\\n2. E'(Q)/phi'(E(Q))\\n-------------------------------------------------------\\nThis component of the rank is 0\\n\\n-------------------------------------------------------\\nSummary of results:\\n-------------------------------------------------------\\n        rank(E) = 0\\n        #E(Q)/2E(Q) = 2\\n\\nInformation on III(E/Q):\\n        #III(E/Q)[phi']    = 1\\n        #III(E/Q)[2]       = 1\\n\\nInformation on III(E'/Q):\\n        #phi'(III(E/Q)[2]) = 1\\n        #III(E'/Q)[phi]    = 1\\n        #III(E'/Q)[2]      = 1\\n\\n\\nUsed descent via 2-isogeny with isogenous curve E' = [0,0,0,-19,30]\\nRank = 0\\nRank of S^2(E)  = 1\\nRank of S^2(E') = 2\\nRank of S^phi(E') = 1\\nRank of S^phi'(E) = 1\\n\\nSearching for points (bound = 8)...done:\\n  found points of rank 0\\n  and regulator 1\\nProcessing points found during 2-descent...done:\\n  now regulator = 1\\nSaturating (bound = 100)...done:\\n  points were already saturated.\\n\\n\\nRegulator = 1\\n\\nThe rank and full Mordell-Weil basis have been determined unconditionally.\\n (0.055625 seconds)\"\n```\n\n(It would also be nice if those `\\n`'s actually created a new line, as I expect they are supposed to do, but that's another issue entirely.)\n\nAgain, I don't feel able to review the Python.",
    "created_at": "2010-10-11T01:56:49Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94847",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:4'></a>
Replying to [cremona](#comment%3A3):
> This was harder than expected.  Without either (1) rewriting mwrank's in put parser or (2) writing a full parser within Sage and only sending to mwrank when certainly correct, which I do not want to do.  If you feed mwrank correct but incomplete input (such as <5 integers separated by whitespace) it quietly waits for the rest of the input (with no prompts).



If this hard, then perhaps it's more effort to fix properly than it is worth. You are a better judge of that than me. 

I can't help feeling if this is supposed to take 5 integers then it should take 5, and not accept fewer or more, as it does. For example:

```
sage: mwrank('1 2 3')
"Curve [0,0,0,1,2] :     \n1 points of order 2:\n[-1:0:1]\n\nUsing 2-isogenous curve [0,6,0,-7,0] (minimal model [0,0,0,-19,30])\n-------------------------------------------------------\nFirst step, determining 1st descent Selmer groups\n-------------------------------------------------------\nAfter first local descent, rank bound = 0\nrk(S^{phi}(E'))=        1\nrk(S^{phi'}(E))=        1\n\n-------------------------------------------------------\nSecond step, determining 2nd descent Selmer groups\n-------------------------------------------------------\n...skipping since we already know rank=0\nAfter second local descent, rank bound = 0\nrk(phi'(S^{2}(E)))=     1\nrk(phi(S^{2}(E')))=     1\nrk(S^{2}(E))=   1\nrk(S^{2}(E'))=  2\n\nThird step, determining E(Q)/phi(E'(Q)) and E'(Q)/phi'(E(Q))\n-------------------------------------------------------\n1. E(Q)/phi(E'(Q))\n-------------------------------------------------------\n(c,d)  =(-3,4)\n(c',d')=(6,-7)\nThis component of the rank is 0\n-------------------------------------------------------\n2. E'(Q)/phi'(E(Q))\n-------------------------------------------------------\nThis component of the rank is 0\n\n-------------------------------------------------------\nSummary of results:\n-------------------------------------------------------\n        rank(E) = 0\n        #E(Q)/2E(Q) = 2\n\nInformation on III(E/Q):\n        #III(E/Q)[phi']    = 1\n        #III(E/Q)[2]       = 1\n\nInformation on III(E'/Q):\n        #phi'(III(E/Q)[2]) = 1\n        #III(E'/Q)[phi]    = 1\n        #III(E'/Q)[2]      = 1\n\n\nUsed descent via 2-isogeny with isogenous curve E' = [0,0,0,-19,30]\nRank = 0\nRank of S^2(E)  = 1\nRank of S^2(E') = 2\nRank of S^phi(E') = 1\nRank of S^phi'(E) = 1\n\nSearching for points (bound = 8)...done:\n  found points of rank 0\n  and regulator 1\nProcessing points found during 2-descent...done:\n  now regulator = 1\nSaturating (bound = 100)...done:\n  points were already saturated.\n\n\nRegulator = 1\n\nThe rank and full Mordell-Weil basis have been determined unconditionally.\n (0.055625 seconds)"
```

(It would also be nice if those `\n`'s actually created a new line, as I expect they are supposed to do, but that's another issue entirely.)

Again, I don't feel able to review the Python.



---

archive/attachments_013180.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10108-mwrank.2.patch",
    "asset_url": "tarball://root/attachments/ticket10108/trac_10108-mwrank.2.patch",
    "created_at": "2010-10-11T03:19:15Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.2.patch",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_094848.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [trac_10108-mwrank.2.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.2.patch) by @mwhansen created at 2010-10-11 03:19:15\n\nLooks good to me.  I added a patch which fixes the indentation of the options blocks.",
    "created_at": "2010-10-11T03:19:15Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94848",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:5'></a>
Attachment [trac_10108-mwrank.2.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.2.patch) by @mwhansen created at 2010-10-11 03:19:15

Looks good to me.  I added a patch which fixes the indentation of the options blocks.



---

archive/issue_comments_094849.json:
```json
{
    "body": "**Reviewer:** Mike Hansen",
    "created_at": "2010-10-11T03:19:15Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94849",
    "user": "https://github.com/mwhansen"
}
```

**Reviewer:** Mike Hansen



---

archive/issue_events_076499.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-10-11T03:19:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76499"
}
```



---

archive/issue_events_076500.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-10-11T03:19:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76500"
}
```



---

archive/issue_comments_094850.json:
```json
{
    "body": "<a id='comment:6'></a>\nPlease fix the ticket number (10108, NOT 10105) in the patch",
    "created_at": "2010-10-23T12:28:08Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94850",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Please fix the ticket number (10108, NOT 10105) in the patch



---

archive/issue_events_076501.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T12:28:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76501"
}
```



---

archive/issue_events_076502.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T12:28:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76502"
}
```



---

archive/attachments_013181.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10105-mwrank.patch",
    "asset_url": "tarball://root/attachments/ticket10108/trac_10105-mwrank.patch",
    "created_at": "2010-10-23T12:53:53Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10108/trac_10105-mwrank.patch",
    "user": "https://github.com/JohnCremona"
}
```



---

archive/issue_comments_094851.json:
```json
{
    "body": "Attachment [trac_10105-mwrank.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10105-mwrank.patch) by @JohnCremona created at 2010-10-23 12:53:53\n\nrenamed version of previous -- applies to 4.6.rc0",
    "created_at": "2010-10-23T12:53:53Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94851",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [trac_10105-mwrank.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10105-mwrank.patch) by @JohnCremona created at 2010-10-23 12:53:53

renamed version of previous -- applies to 4.6.rc0



---

archive/issue_events_076503.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-10-23T12:58:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76503"
}
```



---

archive/issue_events_076504.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-10-23T12:58:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76504"
}
```



---

archive/attachments_013182.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10108-mwrank.3.patch",
    "asset_url": "tarball://root/attachments/ticket10108/trac_10108-mwrank.3.patch",
    "created_at": "2010-10-23T12:58:16Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.3.patch",
    "user": "https://github.com/JohnCremona"
}
```



---

archive/issue_comments_094852.json:
```json
{
    "body": "<a id='comment:7'></a>\nAttachment [trac_10108-mwrank.3.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.3.patch) by @JohnCremona created at 2010-10-23 12:58:16\n\nApply only trac_10108-mwrank.3.patch (and sorry for the mess -- previous ones can be deleted).",
    "created_at": "2010-10-23T12:58:16Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94852",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>
Attachment [trac_10108-mwrank.3.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.3.patch) by @JohnCremona created at 2010-10-23 12:58:16

Apply only trac_10108-mwrank.3.patch (and sorry for the mess -- previous ones can be deleted).



---

archive/issue_comments_094853.json:
```json
{
    "body": "Ticket number fixed, apply only this patch",
    "created_at": "2010-10-23T16:03:47Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94853",
    "user": "https://github.com/jdemeyer"
}
```

Ticket number fixed, apply only this patch



---

archive/attachments_013183.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10108-mwrank.4.patch",
    "asset_url": "tarball://root/attachments/ticket10108/trac_10108-mwrank.4.patch",
    "created_at": "2010-10-23T16:05:06Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.4.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_094854.json:
```json
{
    "body": "<a id='comment:8'></a>\nAttachment [trac_10108-mwrank.4.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.4.patch) by @jdemeyer created at 2010-10-23 16:05:06\n\nJohn, I seem to have confused you :-)\nNever mind, I made the fix myself.",
    "created_at": "2010-10-23T16:05:06Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94854",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Attachment [trac_10108-mwrank.4.patch](https://github.com/sagemath/sage/files/ticket10108/trac_10108-mwrank.4.patch) by @jdemeyer created at 2010-10-23 16:05:06

John, I seem to have confused you :-)
Never mind, I made the fix myself.



---

archive/issue_events_076505.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T16:05:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76505"
}
```



---

archive/issue_events_076506.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T16:05:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76506"
}
```



---

archive/issue_comments_094855.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jdemeyer](#comment%3A8):\n> John, I seem to have confused you :-)\n> Never mind, I made the fix myself.\n\n\nVery sorry - -first I thought it was the patch's name, then the comment in the doctest...  but at least the bugfix works!",
    "created_at": "2010-10-23T16:58:26Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94855",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>
Replying to [jdemeyer](#comment%3A8):
> John, I seem to have confused you :-)
> Never mind, I made the fix myself.


Very sorry - -first I thought it was the patch's name, then the comment in the doctest...  but at least the bugfix works!



---

archive/issue_events_076507.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T20:59:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76507"
}
```



---

archive/issue_events_076508.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T20:59:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76508"
}
```



---

archive/issue_comments_094856.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis patch gives trouble for me when merging it as part of a potential sage-4.6.1.alpha0.  For some reason I cannot explain, I get the following error when running `sage -t devel/sage/sage/interfaces/mwrank.py`:\n\n```\nsage -t  \"devel/sage/sage/interfaces/mwrank.py\"\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/devel/sage/sage/interfaces/mwrank.py\", line 111:\n    sage: mwrank([0,-1,1,0,0])\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_4[3]>\", line 1, in <module>\n        mwrank([Integer(0),-Integer(1),Integer(1),Integer(0),Integer(0)])###line 111:\n    sage: mwrank([0,-1,1,0,0])\n      File \"/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/mwrank.py\", line 139, in __call__\n        raise ValueError, 'Invalid input (%s) to mwrank'%cmd\n    ValueError: Invalid input ([0, -1, 1, 0, 0]) to mwrank\n**********************************************************************\n```\n\nWhat is strange is that simply doing\n\n```\nsage: mwrank([0,-1,1,0,0])\n```\nin a \"real\" Sage session works.  So it works in Sage, but not in a doctest.  I will need to investigate further.",
    "created_at": "2010-10-23T20:59:09Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94856",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
This patch gives trouble for me when merging it as part of a potential sage-4.6.1.alpha0.  For some reason I cannot explain, I get the following error when running `sage -t devel/sage/sage/interfaces/mwrank.py`:

```
sage -t  "devel/sage/sage/interfaces/mwrank.py"
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/devel/sage/sage/interfaces/mwrank.py", line 111:
    sage: mwrank([0,-1,1,0,0])
Exception raised:
    Traceback (most recent call last):
      File "/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_4[3]>", line 1, in <module>
        mwrank([Integer(0),-Integer(1),Integer(1),Integer(0),Integer(0)])###line 111:
    sage: mwrank([0,-1,1,0,0])
      File "/mnt/usb1/scratch/jdemeyer/sage-4.6.1.alpha0-x86_64-Linux/local/lib/python/site-packages/sage/interfaces/mwrank.py", line 139, in __call__
        raise ValueError, 'Invalid input (%s) to mwrank'%cmd
    ValueError: Invalid input ([0, -1, 1, 0, 0]) to mwrank
**********************************************************************
```

What is strange is that simply doing

```
sage: mwrank([0,-1,1,0,0])
```
in a "real" Sage session works.  So it works in Sage, but not in a doctest.  I will need to investigate further.



---

archive/issue_comments_094857.json:
```json
{
    "body": "<a id='comment:11'></a>\nI think I can explain this.  The problem to be solved for this ticket was that if mwrank is given incomplete but otherwise correct input, it just waits for the rest of the input, making Sage appear to hang.  To fix this I made sure that the input provided by Sage always has some other stuff appended to it, so mwrank never has insufficient input.  But then,  the *next* time input is sent to mwrank, there is likely to be still some of that extra stuff in its input buffer.  To get around that (I thought) I made sure that mwrank was restarted at every call.\n\nClearly what I did was insufficient, but this does explain who the order of executing commands does matter.",
    "created_at": "2010-10-23T21:50:37Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94857",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'></a>
I think I can explain this.  The problem to be solved for this ticket was that if mwrank is given incomplete but otherwise correct input, it just waits for the rest of the input, making Sage appear to hang.  To fix this I made sure that the input provided by Sage always has some other stuff appended to it, so mwrank never has insufficient input.  But then,  the *next* time input is sent to mwrank, there is likely to be still some of that extra stuff in its input buffer.  To get around that (I thought) I made sure that mwrank was restarted at every call.

Clearly what I did was insufficient, but this does explain who the order of executing commands does matter.



---

archive/issue_events_076509.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76509"
}
```



---

archive/issue_events_076510.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76510"
}
```



---

archive/issue_comments_094858.json:
```json
{
    "body": "**Branch:** [u/cremona/ticket/10108](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/ticket/10108)",
    "created_at": "2014-01-13T12:00:05Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94858",
    "user": "https://github.com/JohnCremona"
}
```

**Branch:** [u/cremona/ticket/10108](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/ticket/10108)



---

archive/issue_comments_094859.json:
```json
{
    "body": "**Commit:** [5b664d97bd33efcdc415b1e0342f8e3922658f26](https://github.com/sagemath/sagetrac-mirror/commit/5b664d97bd33efcdc415b1e0342f8e3922658f26)",
    "created_at": "2014-01-13T12:29:03Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94859",
    "user": "https://github.com/JohnCremona"
}
```

**Commit:** [5b664d97bd33efcdc415b1e0342f8e3922658f26](https://github.com/sagemath/sagetrac-mirror/commit/5b664d97bd33efcdc415b1e0342f8e3922658f26)



---

archive/issue_comments_094860.json:
```json
{
    "body": "<a id='comment:14'></a>\nThe git commit does a better jpb than the old patch:  I implemented a new function `validate_mwrank_input` which accepts (and to a small degree standardises) valid mwrank inputs using some regular expression analysis.  This means that mwrank will only get sent a valid string.\n\nThis is now ready for review.\n\n---\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/520cfca7cdd1734c1694a63abb3b74b654f7cfb5\">520cfca</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage into build_system</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38d22b794f2febb5ad4cfcebdfebcd4be60f4c93\">38d22b7</a></td><td><code>Merge branch 'master' of ssh://trac.sagemath.org:2222/sage into build_system</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/139dcf5c9eed42069d260cf01f52ce84032038ac\">139dcf5</a></td><td><code>Merge branch 'build_system' of git://github.com/sagemath/sage into build_system</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17e17ddc5bae00a52ed1eeb69d2518bb05e5c9f7\">17e17dd</a></td><td><code>Merge branch 'master' of ssh://trac.sagemath.org:2222/sage into build_system</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b06bd7c4c0b22d891023a30fc10ec4d2dd33a4ab\">b06bd7c</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/858bb9582d4e7bff3ab6dc5572d1d14a32cae6f7\">858bb95</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0523e0ddae40720246f5b357c09e78fa88d4671a\">0523e0d</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88ffd55b76c68cc1b462c6fe473545d8856d1464\">88ffd55</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68d0a5d1f1852db83b575d3ac93210cb291ad84f\">68d0a5d</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/057b3cda7e5b1c7f11d94506197e196c7a492d54\">057b3cd</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr></table>\n",
    "created_at": "2014-01-13T12:29:03Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94860",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>
The git commit does a better jpb than the old patch:  I implemented a new function `validate_mwrank_input` which accepts (and to a small degree standardises) valid mwrank inputs using some regular expression analysis.  This means that mwrank will only get sent a valid string.

This is now ready for review.

---
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/520cfca7cdd1734c1694a63abb3b74b654f7cfb5">520cfca</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage into build_system</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38d22b794f2febb5ad4cfcebdfebcd4be60f4c93">38d22b7</a></td><td><code>Merge branch 'master' of ssh://trac.sagemath.org:2222/sage into build_system</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/139dcf5c9eed42069d260cf01f52ce84032038ac">139dcf5</a></td><td><code>Merge branch 'build_system' of git://github.com/sagemath/sage into build_system</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17e17ddc5bae00a52ed1eeb69d2518bb05e5c9f7">17e17dd</a></td><td><code>Merge branch 'master' of ssh://trac.sagemath.org:2222/sage into build_system</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b06bd7c4c0b22d891023a30fc10ec4d2dd33a4ab">b06bd7c</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/858bb9582d4e7bff3ab6dc5572d1d14a32cae6f7">858bb95</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0523e0ddae40720246f5b357c09e78fa88d4671a">0523e0d</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88ffd55b76c68cc1b462c6fe473545d8856d1464">88ffd55</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68d0a5d1f1852db83b575d3ac93210cb291ad84f">68d0a5d</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/057b3cda7e5b1c7f11d94506197e196c7a492d54">057b3cd</a></td><td><code>Merge branch 'master' of git://github.com/sagemath/sage</code></td></tr></table>




---

archive/issue_events_076511.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-01-13T12:29:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76511"
}
```



---

archive/issue_events_076512.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-01-13T12:29:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76512"
}
```



---

archive/issue_comments_094861.json:
```json
{
    "body": "<a id='comment:15'></a>\nI have two tests that do not pass. (I have rebased the branch to 6.1.rc0; so maybe mwrank changed in the meantime.) I looks like\n\n```\n**********************************************************************\nFile \"mwrank.py\", line 233, in sage.interfaces.mwrank.Mwrank_class.__call__\nFailed example:\n    mwrank('0 -1 1 0 0')\nExpected:\n    'Curve [0,-1,1,0,0] :\\tBasic pair: I=16, J=-304\\ndisc=-76032\\n2-adic index bound = 2\\nBy Lemma 5.1(a), 2-adic index = 1\\n2-adic index = 1\\nOne (I,J) pair\\nLooking for quartics with I = 16, J = -304\\nLooking for Type 3 quartics:\\nTrying positive a from 1 up to 1 (square a first...)\\n(1,0,-4,4,0)\\t--trivial\\n(1,0,2,4,1)\\t--trivial\\nTrying positive a from 1 up to 1 (...then non-square a)\\nFinished looking for Type 3 quartics.\\nMordell rank contribution from B=im(eps) = 0\\nSelmer  rank contribution from B=im(eps) = 0\\nSha     rank contribution from B=im(eps) = 0\\nMordell rank contribution from A=ker(eps) = 0\\nSelmer  rank contribution from A=ker(eps) = 0\\nSha     rank contribution from A=ker(eps) = 0\\n\\nUsed full 2-descent via multiplication-by-2 map\\nRank = 0\\nRank of S^2(E)  = 0\\n\\nProcessing points found during 2-descent...done:\\n  now regulator = 1\\n\\n\\nRegulator = 1\\n\\nThe rank has been determined unconditionally.\\n\\n...'\nGot:\n    'Curve [0,-1,1,0,0] :\\tBasic pair: I=16, J=-304\\ndisc=-76032\\n2-adic index bound = 2\\nBy Lemma 5.1(a), 2-adic index = 1\\n2-adic index = 1\\nOne (I,J) pair\\nLooking for quartics with I = 16, J = -304\\nLooking for Type 3 quartics:\\nTrying positive a from 1 up to 1 (square a first...)\\n(1,0,-4,4,0)\\t--trivial\\n(1,0,2,4,1)\\t--trivial\\nTrying positive a from 1 up to 1 (...then non-square a)\\nFinished looking for Type 3 quartics.\\nMordell rank contribution from B=im(eps) = 0\\nSelmer  rank contribution from B=im(eps) = 0\\nSha     rank contribution from B=im(eps) = 0\\nMordell rank contribution from A=ker(eps) = 0\\nSelmer  rank contribution from A=ker(eps) = 0\\nSha     rank contribution from A=ker(eps) = 0\\n\\nUsed full 2-descent via multiplication-by-2 map\\nRank = 0\\nRank of S^2(E)  = 0\\n\\nProcessing points found during 2-descent...done:\\n  now regulator = 1\\n\\n\\nRegulator = 1\\n\\nThe rank and full Mordell-Weil basis have been determined unconditionally.\\n (0.006 seconds)'\n**********************************************************************\nFile \"mwrank.py\", line 239, in sage.interfaces.mwrank.Mwrank_class.__call__\nFailed example:\n    \"Rank = 0\" in s and \"The rank has been determined unconditionally\" in s\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```",
    "created_at": "2014-01-25T22:37:53Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94861",
    "user": "https://github.com/categorie"
}
```

<a id='comment:15'></a>
I have two tests that do not pass. (I have rebased the branch to 6.1.rc0; so maybe mwrank changed in the meantime.) I looks like

```
**********************************************************************
File "mwrank.py", line 233, in sage.interfaces.mwrank.Mwrank_class.__call__
Failed example:
    mwrank('0 -1 1 0 0')
Expected:
    'Curve [0,-1,1,0,0] :\tBasic pair: I=16, J=-304\ndisc=-76032\n2-adic index bound = 2\nBy Lemma 5.1(a), 2-adic index = 1\n2-adic index = 1\nOne (I,J) pair\nLooking for quartics with I = 16, J = -304\nLooking for Type 3 quartics:\nTrying positive a from 1 up to 1 (square a first...)\n(1,0,-4,4,0)\t--trivial\n(1,0,2,4,1)\t--trivial\nTrying positive a from 1 up to 1 (...then non-square a)\nFinished looking for Type 3 quartics.\nMordell rank contribution from B=im(eps) = 0\nSelmer  rank contribution from B=im(eps) = 0\nSha     rank contribution from B=im(eps) = 0\nMordell rank contribution from A=ker(eps) = 0\nSelmer  rank contribution from A=ker(eps) = 0\nSha     rank contribution from A=ker(eps) = 0\n\nUsed full 2-descent via multiplication-by-2 map\nRank = 0\nRank of S^2(E)  = 0\n\nProcessing points found during 2-descent...done:\n  now regulator = 1\n\n\nRegulator = 1\n\nThe rank has been determined unconditionally.\n\n...'
Got:
    'Curve [0,-1,1,0,0] :\tBasic pair: I=16, J=-304\ndisc=-76032\n2-adic index bound = 2\nBy Lemma 5.1(a), 2-adic index = 1\n2-adic index = 1\nOne (I,J) pair\nLooking for quartics with I = 16, J = -304\nLooking for Type 3 quartics:\nTrying positive a from 1 up to 1 (square a first...)\n(1,0,-4,4,0)\t--trivial\n(1,0,2,4,1)\t--trivial\nTrying positive a from 1 up to 1 (...then non-square a)\nFinished looking for Type 3 quartics.\nMordell rank contribution from B=im(eps) = 0\nSelmer  rank contribution from B=im(eps) = 0\nSha     rank contribution from B=im(eps) = 0\nMordell rank contribution from A=ker(eps) = 0\nSelmer  rank contribution from A=ker(eps) = 0\nSha     rank contribution from A=ker(eps) = 0\n\nUsed full 2-descent via multiplication-by-2 map\nRank = 0\nRank of S^2(E)  = 0\n\nProcessing points found during 2-descent...done:\n  now regulator = 1\n\n\nRegulator = 1\n\nThe rank and full Mordell-Weil basis have been determined unconditionally.\n (0.006 seconds)'
**********************************************************************
File "mwrank.py", line 239, in sage.interfaces.mwrank.Mwrank_class.__call__
Failed example:
    "Rank = 0" in s and "The rank has been determined unconditionally" in s
Expected:
    True
Got:
    False
**********************************************************************
```



---

archive/issue_comments_094862.json:
```json
{
    "body": "**Changing reviewer** from \"Mike Hansen\" to \"Mike Hansen, Chris Wuthrich\".",
    "created_at": "2014-01-25T22:37:53Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94862",
    "user": "https://github.com/categorie"
}
```

**Changing reviewer** from "Mike Hansen" to "Mike Hansen, Chris Wuthrich".



---

archive/issue_events_076513.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2014-01-25T22:37:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76513"
}
```



---

archive/issue_events_076514.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2014-01-25T22:37:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76514"
}
```



---

archive/issue_comments_094863.json:
```json
{
    "body": "**Changing commit** from \"[5b664d97bd33efcdc415b1e0342f8e3922658f26](https://github.com/sagemath/sagetrac-mirror/commit/5b664d97bd33efcdc415b1e0342f8e3922658f26)\" to \"[e4f365ae32a8804072b839205566fede75066431](https://github.com/sagemath/sagetrac-mirror/commit/e4f365ae32a8804072b839205566fede75066431)\".",
    "created_at": "2014-01-25T22:38:44Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94863",
    "user": "https://github.com/categorie"
}
```

**Changing commit** from "[5b664d97bd33efcdc415b1e0342f8e3922658f26](https://github.com/sagemath/sagetrac-mirror/commit/5b664d97bd33efcdc415b1e0342f8e3922658f26)" to "[e4f365ae32a8804072b839205566fede75066431](https://github.com/sagemath/sagetrac-mirror/commit/e4f365ae32a8804072b839205566fede75066431)".



---

archive/issue_comments_094864.json:
```json
{
    "body": "**Changing branch** from \"[u/cremona/ticket/10108](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/ticket/10108)\" to \"[u/wuthrich/ticket/10108](https://github.com/sagemath/sagetrac-mirror/tree/u/wuthrich/ticket/10108)\".",
    "created_at": "2014-01-25T22:38:44Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94864",
    "user": "https://github.com/categorie"
}
```

**Changing branch** from "[u/cremona/ticket/10108](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/ticket/10108)" to "[u/wuthrich/ticket/10108](https://github.com/sagemath/sagetrac-mirror/tree/u/wuthrich/ticket/10108)".



---

archive/issue_comments_094865.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks.  Since you did a rebase I can't see what you changed additionally, but I seem to have slipped up in testing (in one example) that the long-winded mwrank output is good where because of the time output one cannot just do a literal comparison.\nTesting...",
    "created_at": "2014-01-26T09:21:48Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94865",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:17'></a>
Thanks.  Since you did a rebase I can't see what you changed additionally, but I seem to have slipped up in testing (in one example) that the long-winded mwrank output is good where because of the time output one cannot just do a literal comparison.
Testing...



---

archive/issue_events_076515.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-01-26T09:33:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76515"
}
```



---

archive/issue_events_076516.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-01-26T09:33:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76516"
}
```



---

archive/issue_comments_094866.json:
```json
{
    "body": "<a id='comment:18'></a>\nOK, works for me (though I think my earlier branch did too!).  I have set this back to \"needs review\" and Chris you can set it to positive review.",
    "created_at": "2014-01-26T09:33:35Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94866",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:18'></a>
OK, works for me (though I think my earlier branch did too!).  I have set this back to "needs review" and Chris you can set it to positive review.



---

archive/issue_comments_094867.json:
```json
{
    "body": "<a id='comment:19'></a>\nAh interesting.\n\nI did not change anything. I litterally took your mwrank.py and copied it into a branch based at develop, checking that this file was not touch on since then.\n\nSo I get the above errors and you do not get them. So it seems that mwrank does not give back the same string for you than for me. The issue (in both failures) is the final sentence. I get\n\n\"The rank and full Mordell-Weil basis have been determined unconditionally.\"\n\nwhile we test for\n\n\"The rank has been determined unconditionally.\"\n\nIs there a change in mwrank that I have missed?\n\n(I revert back to needs_work).",
    "created_at": "2014-01-26T11:49:38Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94867",
    "user": "https://github.com/categorie"
}
```

<a id='comment:19'></a>
Ah interesting.

I did not change anything. I litterally took your mwrank.py and copied it into a branch based at develop, checking that this file was not touch on since then.

So I get the above errors and you do not get them. So it seems that mwrank does not give back the same string for you than for me. The issue (in both failures) is the final sentence. I get

"The rank and full Mordell-Weil basis have been determined unconditionally."

while we test for

"The rank has been determined unconditionally."

Is there a change in mwrank that I have missed?

(I revert back to needs_work).



---

archive/issue_events_076517.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2014-01-26T11:49:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76517"
}
```



---

archive/issue_events_076518.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2014-01-26T11:49:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76518"
}
```



---

archive/issue_comments_094868.json:
```json
{
    "body": "<a id='comment:20'></a>\nThat is weird;  I misunderstood.  No changes at all in mwrank.  But when I switch branches there is more recompilation than I would have expected (mpir rebuilds) for this.  Very odd!  I'll look into it further.",
    "created_at": "2014-01-26T12:57:29Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94868",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:20'></a>
That is weird;  I misunderstood.  No changes at all in mwrank.  But when I switch branches there is more recompilation than I would have expected (mpir rebuilds) for this.  Very odd!  I'll look into it further.



---

archive/issue_comments_094869.json:
```json
{
    "body": "<a id='comment:21'></a>\nFrom my develop to this branch u/wuthrich/..., it only compiles mwrank.py (as I would expect).",
    "created_at": "2014-01-26T13:41:42Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94869",
    "user": "https://github.com/categorie"
}
```

<a id='comment:21'></a>
From my develop to this branch u/wuthrich/..., it only compiles mwrank.py (as I would expect).



---

archive/issue_comments_094870.json:
```json
{
    "body": "<a id='comment:22'></a>\nI think there was some conflict between the state of the original branch of mine called ticket/10108 and the branch I had after checking out yours.  So I switched back to develop, deleted the branch ticket/10108 altogether and re-pulled it.  Now my git log has the right look to it:\n\n```\ncommit e4f365ae32a8804072b839205566fede75066431\nAuthor: Chris Wuthrich <christian.wuthrich@gmail.com>\nDate:   Sat Jan 25 20:33:23 2014 +0000\n\n    Trac #10108: more robust interface to mwrank\n\ncommit 1bd331978c99681b70e4877fa3149b0c9adf47ce\nAuthor: Volker Braun <vbraun.name@gmail.com>\nDate:   Sat Jan 25 01:41:12 2014 +0000\n\n    Updated Sage version to 6.1.rc0\n```\nso I rebuild (i.e. \"make\").  And sage/interfaces/mwrank.py passes its tests.  And specifically when in Sage I run\n\n```\nsage: mwrank('0 -1 1 0 0')\n```\nthe output string is\n\n```\n'Curve [0,-1,1,0,0] :\\tBasic pair: I=16, J=-304\\ndisc=-76032\\n2-adic index bound = 2\\nBy Lemma 5.1(a), 2-adic index = 1\\n2-adic index = 1\\nOne (I,J) pair\\nLooking for quartics with I = 16, J = -304\\nLooking for Type 3 quartics:\\nTrying positive a from 1 up to 1 (square a first...)\\n(1,0,-4,4,0)\\t--trivial\\n(1,0,2,4,1)\\t--trivial\\nTrying positive a from 1 up to 1 (...then non-square a)\\nFinished looking for Type 3 quartics.\\nMordell rank contribution from B=im(eps) = 0\\nSelmer  rank contribution from B=im(eps) = 0\\nSha     rank contribution from B=im(eps) = 0\\nMordell rank contribution from A=ker(eps) = 0\\nSelmer  rank contribution from A=ker(eps) = 0\\nSha     rank contribution from A=ker(eps) = 0\\n\\nUsed full 2-descent via multiplication-by-2 map\\nRank = 0\\nRank of S^2(E)  = 0\\n\\nProcessing points found during 2-descent...done:\\n  now regulator = 1\\n\\n\\nRegulator = 1\\n\\nThe rank has been determined unconditionally.\\n\\n (0.004001 seconds)'\n```\n\n\nNow I see what is happening!    The curve has rank 0;  so mwrank does not do the usual saturation step of making sure that we have the full MW group and not a subgroup of finite index;  there is a flag (in my C++ code) called sat_ok which is set to 1 if saturation suceeds, 0 if it fails -- and is uninitialized otherwise!  So it will be random for a rank 0 curve where one sees the additional string \"The rank and full Mordell-Weil basis have been determined\" or \"The rank and full Mordell-Weil basis have been determined\".\n\nObviously I will correct this in eclib, which is timely since I was planning tp update Sage's version sson anyway.  Meanwhile we'll have to sidestep this by changing that doctest sneakily.  I suggest first deleting the variable sentence, effectively moving the \"...\" forward; and in the next line just test for \"Rank = 0\" in s.\n\nShall I do that or will you?",
    "created_at": "2014-01-26T14:39:30Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94870",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:22'></a>
I think there was some conflict between the state of the original branch of mine called ticket/10108 and the branch I had after checking out yours.  So I switched back to develop, deleted the branch ticket/10108 altogether and re-pulled it.  Now my git log has the right look to it:

```
commit e4f365ae32a8804072b839205566fede75066431
Author: Chris Wuthrich <christian.wuthrich@gmail.com>
Date:   Sat Jan 25 20:33:23 2014 +0000

    Trac #10108: more robust interface to mwrank

commit 1bd331978c99681b70e4877fa3149b0c9adf47ce
Author: Volker Braun <vbraun.name@gmail.com>
Date:   Sat Jan 25 01:41:12 2014 +0000

    Updated Sage version to 6.1.rc0
```
so I rebuild (i.e. "make").  And sage/interfaces/mwrank.py passes its tests.  And specifically when in Sage I run

```
sage: mwrank('0 -1 1 0 0')
```
the output string is

```
'Curve [0,-1,1,0,0] :\tBasic pair: I=16, J=-304\ndisc=-76032\n2-adic index bound = 2\nBy Lemma 5.1(a), 2-adic index = 1\n2-adic index = 1\nOne (I,J) pair\nLooking for quartics with I = 16, J = -304\nLooking for Type 3 quartics:\nTrying positive a from 1 up to 1 (square a first...)\n(1,0,-4,4,0)\t--trivial\n(1,0,2,4,1)\t--trivial\nTrying positive a from 1 up to 1 (...then non-square a)\nFinished looking for Type 3 quartics.\nMordell rank contribution from B=im(eps) = 0\nSelmer  rank contribution from B=im(eps) = 0\nSha     rank contribution from B=im(eps) = 0\nMordell rank contribution from A=ker(eps) = 0\nSelmer  rank contribution from A=ker(eps) = 0\nSha     rank contribution from A=ker(eps) = 0\n\nUsed full 2-descent via multiplication-by-2 map\nRank = 0\nRank of S^2(E)  = 0\n\nProcessing points found during 2-descent...done:\n  now regulator = 1\n\n\nRegulator = 1\n\nThe rank has been determined unconditionally.\n\n (0.004001 seconds)'
```


Now I see what is happening!    The curve has rank 0;  so mwrank does not do the usual saturation step of making sure that we have the full MW group and not a subgroup of finite index;  there is a flag (in my C++ code) called sat_ok which is set to 1 if saturation suceeds, 0 if it fails -- and is uninitialized otherwise!  So it will be random for a rank 0 curve where one sees the additional string "The rank and full Mordell-Weil basis have been determined" or "The rank and full Mordell-Weil basis have been determined".

Obviously I will correct this in eclib, which is timely since I was planning tp update Sage's version sson anyway.  Meanwhile we'll have to sidestep this by changing that doctest sneakily.  I suggest first deleting the variable sentence, effectively moving the "..." forward; and in the next line just test for "Rank = 0" in s.

Shall I do that or will you?



---

archive/issue_comments_094871.json:
```json
{
    "body": "<a id='comment:23'></a>\nI can do it. \n\nDo you want to keep the lengthy output to be tested ? Or would not \n'Curve [0,-1,1,0,0] :\\tBasic pair: I=16, J=-304 ... determined unconditionally ...'\nbe enough ?",
    "created_at": "2014-01-26T15:06:04Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94871",
    "user": "https://github.com/categorie"
}
```

<a id='comment:23'></a>
I can do it. 

Do you want to keep the lengthy output to be tested ? Or would not 
'Curve [0,-1,1,0,0] :\tBasic pair: I=16, J=-304 ... determined unconditionally ...'
be enough ?



---

archive/issue_comments_094872.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [wuthrich](#comment%3A23):\n> I can do it. \n> \n\n\nThanks.\n\n> Do you want to keep the lengthy output to be tested ? Or would not \n> 'Curve [0,-1,1,0,0] :\\tBasic pair: I=16, J=-304 ... determined unconditionally ...'\n> be enough ?\n\n\nThat would be enough, certainly as we also check that \"Rank = 0\" is in there.",
    "created_at": "2014-01-26T15:09:32Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94872",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:24'></a>
Replying to [wuthrich](#comment%3A23):
> I can do it. 
> 


Thanks.

> Do you want to keep the lengthy output to be tested ? Or would not 
> 'Curve [0,-1,1,0,0] :\tBasic pair: I=16, J=-304 ... determined unconditionally ...'
> be enough ?


That would be enough, certainly as we also check that "Rank = 0" is in there.



---

archive/issue_comments_094873.json:
```json
{
    "body": "**Changing commit** from \"[e4f365ae32a8804072b839205566fede75066431](https://github.com/sagemath/sagetrac-mirror/commit/e4f365ae32a8804072b839205566fede75066431)\" to \"[0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4](https://github.com/sagemath/sagetrac-mirror/commit/0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4)\".",
    "created_at": "2014-01-26T16:50:54Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94873",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e4f365ae32a8804072b839205566fede75066431](https://github.com/sagemath/sagetrac-mirror/commit/e4f365ae32a8804072b839205566fede75066431)" to "[0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4](https://github.com/sagemath/sagetrac-mirror/commit/0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4)".



---

archive/issue_comments_094874.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4\">0fb4c7d</a></td><td><code>Trac 10108: Change and shorten one doctest</code></td></tr></table>\n",
    "created_at": "2014-01-26T16:50:54Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94874",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0fb4c7dadbe5b82ffccff51cccfc03b33ca895f4">0fb4c7d</a></td><td><code>Trac 10108: Change and shorten one doctest</code></td></tr></table>




---

archive/issue_comments_094875.json:
```json
{
    "body": "<a id='comment:26'></a>\nI run the tests now.",
    "created_at": "2014-01-26T16:51:48Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94875",
    "user": "https://github.com/categorie"
}
```

<a id='comment:26'></a>
I run the tests now.



---

archive/issue_comments_094876.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [cremona](#comment%3A22):\n\n> Obviously I will correct this in eclib, which is timely since I was planning to update Sage's version soon anyway. \n\n\nThe eclib patch is visible here:\n\nhttps://github.com/JohnCremona/eclib/commit/d1ab6a59103fb86730f1e668e70ecf010ee37b2d\n\nand the new version (with a lot more than just this change) is in a new spkg at #15738.  But this ticket does not need that.",
    "created_at": "2014-01-26T20:29:08Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94876",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:27'></a>
Replying to [cremona](#comment%3A22):

> Obviously I will correct this in eclib, which is timely since I was planning to update Sage's version soon anyway. 


The eclib patch is visible here:

https://github.com/JohnCremona/eclib/commit/d1ab6a59103fb86730f1e668e70ecf010ee37b2d

and the new version (with a lot more than just this change) is in a new spkg at #15738.  But this ticket does not need that.



---

archive/issue_events_076519.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2014-01-26T23:22:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76519"
}
```



---

archive/issue_events_076520.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2014-01-26T23:22:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76520"
}
```



---

archive/issue_events_076521.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76521"
}
```



---

archive/issue_events_076522.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76522"
}
```



---

archive/issue_events_076523.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-01T15:16:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76523"
}
```



---

archive/issue_events_076524.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-01T15:16:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10108#event-76524"
}
```



---

archive/issue_comments_094877.json:
```json
{
    "body": "<a id='comment:31'></a>\nSee #15798 for a followup ticket",
    "created_at": "2014-02-08T13:01:58Z",
    "issue": "https://github.com/sagemath/sage/issues/10108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10108#issuecomment-94877",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>
See #15798 for a followup ticket
