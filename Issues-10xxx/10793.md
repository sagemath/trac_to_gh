# Issue 10793: Matrices can be "constructed" from matrices of wrong dimensions

archive/issues_010728.json:
```json
{
    "body": "Let's make a matrix and use it to define a morphism:\n\n```\nsage: projection = matrix(ZZ,[[1,0,0],[0,1,0]])\nsage: projection\n[1 0 0]\n[0 1 0]\nsage: H = Hom(ZZ^3, ZZ^2)\nsage: H(projection)\nFree module morphism defined by the matrix\n[1 0]\n[0 0]\n[1 0]\nDomain: Ambient free module of rank 3 over the principal ideal domain ...\nCodomain: Ambient free module of rank 2 over the principal ideal domain ...\n```\nAs we see, the matrix of the morphism is very unlikely to be what it should be. Here is the source of the problem:\n\n```\nsage: projection.parent()\nFull MatrixSpace of 2 by 3 dense matrices over Integer Ring\nsage: M = MatrixSpace(ZZ, 3 , 2)\nsage: M\nFull MatrixSpace of 3 by 2 dense matrices over Integer Ring\nsage: M(projection)\n[1 0]\n[0 0]\n[1 0]\n```\nSo the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.\n\n\nApply trac_10793_bug_in_matrix_construction.patch, trac_10793_fixing_existing_bugs.patch\n\n\nAssignee: jason, was\n\nCC:  @rbeezer @kcrisman\n\nKeywords: sd31\n\nResolution: fixed\n\nDependencies: #11200, #11552\n\nAuthor: Andrey Novoseltsev\n\nReviewer: Volker Braun\n\nMerged: sage-4.7.2.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/10793\n\n",
    "closed_at": "2011-08-18T22:02:18Z",
    "created_at": "2011-02-17T11:52:58Z",
    "labels": [
        "component: linear algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Matrices can be \"constructed\" from matrices of wrong dimensions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10793",
    "user": "https://github.com/vbraun"
}
```
Let's make a matrix and use it to define a morphism:

```
sage: projection = matrix(ZZ,[[1,0,0],[0,1,0]])
sage: projection
[1 0 0]
[0 1 0]
sage: H = Hom(ZZ^3, ZZ^2)
sage: H(projection)
Free module morphism defined by the matrix
[1 0]
[0 0]
[1 0]
Domain: Ambient free module of rank 3 over the principal ideal domain ...
Codomain: Ambient free module of rank 2 over the principal ideal domain ...
```
As we see, the matrix of the morphism is very unlikely to be what it should be. Here is the source of the problem:

```
sage: projection.parent()
Full MatrixSpace of 2 by 3 dense matrices over Integer Ring
sage: M = MatrixSpace(ZZ, 3 , 2)
sage: M
Full MatrixSpace of 3 by 2 dense matrices over Integer Ring
sage: M(projection)
[1 0]
[0 0]
[1 0]
```
So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.


Apply trac_10793_bug_in_matrix_construction.patch, trac_10793_fixing_existing_bugs.patch


Assignee: jason, was

CC:  @rbeezer @kcrisman

Keywords: sd31

Resolution: fixed

Dependencies: #11200, #11552

Author: Andrey Novoseltsev

Reviewer: Volker Braun

Merged: sage-4.7.2.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/10793





---

archive/issue_comments_136731.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,36 +1,31 @@\n-Here I use a projection matrix to map a 3d cone to a 2d cone:\n+Let's make a matrix and use it to define a morphism:\n \n ```\n sage: projection = matrix(ZZ,[[1,0,0],[0,1,0]])\n sage: projection\n [1 0 0]\n [0 1 0]\n-sage: cone3d = Cone([(1,0,0),(0,1,0)])\n-sage: cone2d = Cone([ projection*r for r in cone3d.rays() ])\n-sage: cone2d.rays()\n-(N(0, 1), N(1, 0))\n-```\n-If you use the same matrix in `FanMorphism`, you get an unexpected result:\n-\n-```\n-sage: FanMorphism( projection, Fan([cone3d]), Fan([cone2d]) )\n-Fan morphism defined by the matrix\n+sage: H = Hom(ZZ^3, ZZ^2)\n+sage: H(projection)\n+Free module morphism defined by the matrix\n [1 0]\n [0 0]\n [1 0]\n-Domain fan: Rational polyhedral fan in 3-d lattice N\n-Codomain fan: Rational polyhedral fan in 2-d lattice N\n+Domain: Ambient free module of rank 3 over the principal ideal domain ...\n+Codomain: Ambient free module of rank 2 over the principal ideal domain ...\n ```\n-Sharp eyes reveal that the matrix is not the one I wanted; I understand that Sage expects a left matrix action.  But having gotten a matrix of the wrong shape, no error is produced. Only a nonsensical output? Expected behavior would be an error, stating that the matrix dimensions do not match.\n-\n-For reference, the correct way to construct the morphism is with the transposed matrix.\n+As we see, the matrix of the morphism is very unlikely to be what it should be. Here is the source of the problem:\n \n ```\n-sage: FanMorphism( projection.transpose(), Fan([cone3d]), Fan([cone2d]) )\n-Fan morphism defined by the matrix\n+sage: projection.parent()\n+Full MatrixSpace of 2 by 3 dense matrices over Integer Ring\n+sage: M = MatrixSpace(ZZ, 3 , 2)\n+sage: M\n+Full MatrixSpace of 3 by 2 dense matrices over Integer Ring\n+sage: M(projection)\n [1 0]\n-[0 1]\n [0 0]\n-Domain fan: Rational polyhedral fan in 3-d lattice N\n-Codomain fan: Rational polyhedral fan in 2-d lattice N\n+[1 0]\n ```\n+So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.\n+\n``````\n",
    "created_at": "2011-02-17T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136731",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,36 +1,31 @@
-Here I use a projection matrix to map a 3d cone to a 2d cone:
+Let's make a matrix and use it to define a morphism:
 
 ```
 sage: projection = matrix(ZZ,[[1,0,0],[0,1,0]])
 sage: projection
 [1 0 0]
 [0 1 0]
-sage: cone3d = Cone([(1,0,0),(0,1,0)])
-sage: cone2d = Cone([ projection*r for r in cone3d.rays() ])
-sage: cone2d.rays()
-(N(0, 1), N(1, 0))
-```
-If you use the same matrix in `FanMorphism`, you get an unexpected result:
-
-```
-sage: FanMorphism( projection, Fan([cone3d]), Fan([cone2d]) )
-Fan morphism defined by the matrix
+sage: H = Hom(ZZ^3, ZZ^2)
+sage: H(projection)
+Free module morphism defined by the matrix
 [1 0]
 [0 0]
 [1 0]
-Domain fan: Rational polyhedral fan in 3-d lattice N
-Codomain fan: Rational polyhedral fan in 2-d lattice N
+Domain: Ambient free module of rank 3 over the principal ideal domain ...
+Codomain: Ambient free module of rank 2 over the principal ideal domain ...
 ```
-Sharp eyes reveal that the matrix is not the one I wanted; I understand that Sage expects a left matrix action.  But having gotten a matrix of the wrong shape, no error is produced. Only a nonsensical output? Expected behavior would be an error, stating that the matrix dimensions do not match.
-
-For reference, the correct way to construct the morphism is with the transposed matrix.
+As we see, the matrix of the morphism is very unlikely to be what it should be. Here is the source of the problem:
 
 ```
-sage: FanMorphism( projection.transpose(), Fan([cone3d]), Fan([cone2d]) )
-Fan morphism defined by the matrix
+sage: projection.parent()
+Full MatrixSpace of 2 by 3 dense matrices over Integer Ring
+sage: M = MatrixSpace(ZZ, 3 , 2)
+sage: M
+Full MatrixSpace of 3 by 2 dense matrices over Integer Ring
+sage: M(projection)
 [1 0]
-[0 1]
 [0 0]
-Domain fan: Rational polyhedral fan in 3-d lattice N
-Codomain fan: Rational polyhedral fan in 2-d lattice N
+[1 0]
 ```
+So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.
+
``````




---

archive/issue_comments_136732.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2011-02-17T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136732",
    "user": "https://github.com/novoselt"
}
```

Changing priority from major to critical.



---

archive/issue_comments_136733.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2011-02-17T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136733",
    "user": "https://github.com/novoselt"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_136734.json:
```json
{
    "body": "Changing assignee from @aghitza to jason, was.",
    "created_at": "2011-02-17T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136734",
    "user": "https://github.com/novoselt"
}
```

Changing assignee from @aghitza to jason, was.



---

archive/issue_comments_136735.json:
```json
{
    "body": "<a id='comment:1'></a>\nI have completely replaced the original Volker's description since the problem is unrelated to fan morphisms themselves.\n\nAlso I think that this is an extremely dangerous bug and will take the liberty to elevate its priority...",
    "created_at": "2011-02-17T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136735",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:1'></a>
I have completely replaced the original Volker's description since the problem is unrelated to fan morphisms themselves.

Also I think that this is an extremely dangerous bug and will take the liberty to elevate its priority...



---

archive/issue_comments_136736.json:
```json
{
    "body": "Changing component from algebraic geometry to linear algebra.",
    "created_at": "2011-02-17T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136736",
    "user": "https://github.com/novoselt"
}
```

Changing component from algebraic geometry to linear algebra.



---

archive/issue_comments_136737.json:
```json
{
    "body": "<a id='comment:2'></a>\nSo it seems that the problem here is that in converting to an element of the matrix space, it views the entries of the matrix (or indeed, the entries of a nested list as well) as a flattened list:\n\n```\nsage: M\nFull MatrixSpace of 3 by 2 dense matrices over Integer Ring\nsage: M([[1,2,3],[4,5,6]])\n[1 2]\n[3 4]\n[5 6]\n```\n\nSo I guess you're saying that MatrixSpace shouldn't flatten the list, but instead should throw an error?",
    "created_at": "2011-02-17T16:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136737",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>
So it seems that the problem here is that in converting to an element of the matrix space, it views the entries of the matrix (or indeed, the entries of a nested list as well) as a flattened list:

```
sage: M
Full MatrixSpace of 3 by 2 dense matrices over Integer Ring
sage: M([[1,2,3],[4,5,6]])
[1 2]
[3 4]
[5 6]
```

So I guess you're saying that MatrixSpace shouldn't flatten the list, but instead should throw an error?



---

archive/issue_comments_136738.json:
```json
{
    "body": "<a id='comment:3'></a>\nAround line 361 in `matrix/matrix_space.py`, we see:\n\n```\n        if isinstance(entries, (list, tuple)) and len(entries) > 0 and \\\n           sage.modules.free_module_element.is_FreeModuleElement(entries[0]):\n            #Try to determine whether or not the entries should\n            #be rows or columns\n            if rows is None:\n                #If the matrix is square, default to rows\n                if self.__ncols == self.__nrows:\n                    rows = True\n                elif len(entries[0]) == self.__ncols:\n                    rows = True\n                elif len(entries[0]) == self.__nrows:\n                    rows = False\n                else:\n                    raise ValueError, \"incorrect dimensions\"\n            \n            if self.__is_sparse:\n                e = {}\n                zero = self.base_ring()(0)\n                for i in xrange(len(entries)):\n                    for j, x in entries[i].iteritems():\n                        if x != zero:\n                            if rows:\n                                e[(i,j)] = x\n                            else:\n                                e[(j,i)] = x\n                entries = e\n            else:\n                entries = sum([v.list() for v in entries],[])\n```\n\nSo:\n\n1. I think it tries to be too intelligent about guessing whether you have rows or columns.  That leads to inconsistent behavior when you have code dealing with different matrix spaces with different dimensions.\n\n2. It indeed does flatten the list if all else fails (that's the sum([v.list()... line).  I agree that that looks dangerous as well.",
    "created_at": "2011-02-17T16:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136738",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
Around line 361 in `matrix/matrix_space.py`, we see:

```
        if isinstance(entries, (list, tuple)) and len(entries) > 0 and \
           sage.modules.free_module_element.is_FreeModuleElement(entries[0]):
            #Try to determine whether or not the entries should
            #be rows or columns
            if rows is None:
                #If the matrix is square, default to rows
                if self.__ncols == self.__nrows:
                    rows = True
                elif len(entries[0]) == self.__ncols:
                    rows = True
                elif len(entries[0]) == self.__nrows:
                    rows = False
                else:
                    raise ValueError, "incorrect dimensions"
            
            if self.__is_sparse:
                e = {}
                zero = self.base_ring()(0)
                for i in xrange(len(entries)):
                    for j, x in entries[i].iteritems():
                        if x != zero:
                            if rows:
                                e[(i,j)] = x
                            else:
                                e[(j,i)] = x
                entries = e
            else:
                entries = sum([v.list() for v in entries],[])
```

So:

1. I think it tries to be too intelligent about guessing whether you have rows or columns.  That leads to inconsistent behavior when you have code dealing with different matrix spaces with different dimensions.

2. It indeed does flatten the list if all else fails (that's the sum([v.list()... line).  I agree that that looks dangerous as well.



---

archive/issue_comments_136739.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [jason](#comment%3A2):\n> So it seems that the problem here is that in converting to an element of the matrix space, it views the entries of the matrix (or indeed, the entries of a nested list as well) as a flattened list:\n> \n> \n> ```\n> sage: M\n> Full MatrixSpace of 3 by 2 dense matrices over Integer Ring\n> sage: M([[1,2,3],[4,5,6]])\n> [1 2]\n> [3 4]\n> [5 6]\n> ```\n> \n> So I guess you're saying that MatrixSpace shouldn't flatten the list, but instead should throw an error?\n\n\nAbsolutely! I see no reason why such flattening can make sense, so even if there some - I think they should do it explicitly.\n\nI find it a bit confusing that Sage uses right matrix action, so in the description I tend to think that `projection` itself is the matrix of the morphism, not its transpose. I suspect I am not the only one who can fall into this trap: it is accepted as an input, but some other not-very-related matrix is then used in the morphism.",
    "created_at": "2011-02-17T16:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136739",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>
Replying to [jason](#comment%3A2):
> So it seems that the problem here is that in converting to an element of the matrix space, it views the entries of the matrix (or indeed, the entries of a nested list as well) as a flattened list:
> 
> 
> ```
> sage: M
> Full MatrixSpace of 3 by 2 dense matrices over Integer Ring
> sage: M([[1,2,3],[4,5,6]])
> [1 2]
> [3 4]
> [5 6]
> ```
> 
> So I guess you're saying that MatrixSpace shouldn't flatten the list, but instead should throw an error?


Absolutely! I see no reason why such flattening can make sense, so even if there some - I think they should do it explicitly.

I find it a bit confusing that Sage uses right matrix action, so in the description I tend to think that `projection` itself is the matrix of the morphism, not its transpose. I suspect I am not the only one who can fall into this trap: it is accepted as an input, but some other not-very-related matrix is then used in the morphism.



---

archive/issue_comments_136740.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Rob, this is the ticket I was talking about!",
    "created_at": "2011-06-14T16:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136740",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>
Hi Rob, this is the ticket I was talking about!



---

archive/issue_comments_136741.json:
```json
{
    "body": "Attachment [trac_10793_bug_in_matrix_construction.patch](tarball://root/attachments/some-uuid/ticket10793/trac_10793_bug_in_matrix_construction.patch) by @novoselt created at 2011-06-16 22:54:49",
    "created_at": "2011-06-16T22:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136741",
    "user": "https://github.com/novoselt"
}
```

Attachment [trac_10793_bug_in_matrix_construction.patch](tarball://root/attachments/some-uuid/ticket10793/trac_10793_bug_in_matrix_construction.patch) by @novoselt created at 2011-06-16 22:54:49



---

archive/issue_comments_136742.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-06-16T22:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136742",
    "user": "https://github.com/novoselt"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_136743.json:
```json
{
    "body": "Changing author from \"\" to \"Andrey Novoseltsev\"",
    "created_at": "2011-06-16T22:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136743",
    "user": "https://github.com/novoselt"
}
```

Changing author from "" to "Andrey Novoseltsev"



---

archive/issue_comments_136744.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd31\".",
    "created_at": "2011-06-16T22:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136744",
    "user": "https://github.com/novoselt"
}
```

Changing keywords from "" to "sd31".



---

archive/issue_comments_136745.json:
```json
{
    "body": "Changing work_issues from \"\" to \"doctest failures\"",
    "created_at": "2011-06-16T23:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136745",
    "user": "https://github.com/novoselt"
}
```

Changing work_issues from "" to "doctest failures"



---

archive/issue_comments_136746.json:
```json
{
    "body": "<a id='comment:8'></a>\nThere are doctest failures that have to be addressed. I suspect that all places that are affected were just kind of wrong. For Nx1 and 1xN matrices nothing too horrible is going on, hopefully there are no other cases.",
    "created_at": "2011-06-16T23:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136746",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>
There are doctest failures that have to be addressed. I suspect that all places that are affected were just kind of wrong. For Nx1 and 1xN matrices nothing too horrible is going on, hopefully there are no other cases.



---

archive/issue_comments_136747.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-16T23:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136747",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136748.json:
```json
{
    "body": "<a id='comment:9'></a>\nHere is the list of offenders:\n\n```\n\tsage -t -long devel/sage-main/sage/crypto/mq/sr.py # 15 doctests failed\n\tsage -t -long devel/sage-main/sage/interfaces/sage0.py # 2 doctests failed\n\tsage -t -long devel/sage-main/sage/crypto/mq/mpolynomialsystem.py # 50 doctests failed\n\tsage -t -long devel/sage-main/sage/geometry/fan_morphism.py # 4 doctests failed\n\tsage -t -long devel/sage-main/sage/rings/polynomial/multi_polynomial_sequence.py # 33 doctests failed\n\tsage -t -long devel/sage-main/sage/categories/map.pyx # 16 doctests failed\n\tsage -t -long devel/sage-main/sage/interfaces/magma.py # 2 doctests failed\n\tsage -t -long devel/sage-main/sage/modules/matrix_morphism.py # 9 doctests failed\n```\n\nIMHO, all these files are full of bugs!",
    "created_at": "2011-06-17T00:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136748",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:9'></a>
Here is the list of offenders:

```
	sage -t -long devel/sage-main/sage/crypto/mq/sr.py # 15 doctests failed
	sage -t -long devel/sage-main/sage/interfaces/sage0.py # 2 doctests failed
	sage -t -long devel/sage-main/sage/crypto/mq/mpolynomialsystem.py # 50 doctests failed
	sage -t -long devel/sage-main/sage/geometry/fan_morphism.py # 4 doctests failed
	sage -t -long devel/sage-main/sage/rings/polynomial/multi_polynomial_sequence.py # 33 doctests failed
	sage -t -long devel/sage-main/sage/categories/map.pyx # 16 doctests failed
	sage -t -long devel/sage-main/sage/interfaces/magma.py # 2 doctests failed
	sage -t -long devel/sage-main/sage/modules/matrix_morphism.py # 9 doctests failed
```

IMHO, all these files are full of bugs!



---

archive/issue_comments_136749.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-17T00:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136749",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136750.json:
```json
{
    "body": "<a id='comment:10'></a>\nOK, it turned out to be not as scary as it seemed to me originally. Most of the errors were due to forgetting that matrices act from the right. In crypto I have added explicit conversion of matrices to lists since it seems that they wanted it. I don't understand that code to make sure that this is indeed correct, but at the very least I didn't introduce a new bug ;-)",
    "created_at": "2011-06-17T00:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136750",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'></a>
OK, it turned out to be not as scary as it seemed to me originally. Most of the errors were due to forgetting that matrices act from the right. In crypto I have added explicit conversion of matrices to lists since it seems that they wanted it. I don't understand that code to make sure that this is indeed correct, but at the very least I didn't introduce a new bug ;-)



---

archive/issue_comments_136751.json:
```json
{
    "body": "Changing work_issues from \"doctest failures\" to \"\"",
    "created_at": "2011-06-17T00:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136751",
    "user": "https://github.com/novoselt"
}
```

Changing work_issues from "doctest failures" to ""



---

archive/issue_comments_136752.json:
```json
{
    "body": "<a id='comment:11'></a>\nPatches should apply fine on top of sage-4.7.1.alpha4, as #11200 (and other patches modifying fan morphisms) was merged.",
    "created_at": "2011-07-06T00:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136752",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:11'></a>
Patches should apply fine on top of sage-4.7.1.alpha4, as #11200 (and other patches modifying fan morphisms) was merged.



---

archive/issue_comments_136753.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#11200\"",
    "created_at": "2011-07-06T00:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136753",
    "user": "https://github.com/novoselt"
}
```

Changing dependencies from "" to "#11200"



---

archive/issue_comments_136754.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-14T02:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136754",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136755.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,3 +29,6 @@\n ```\n So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.\n \n+\n+Apply trac_10793_bug_in_matrix_construction.patch, trac_10793_fixing_existing_bugs.patch\n+\n``````\n",
    "created_at": "2011-08-14T02:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136755",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,3 +29,6 @@
 ```
 So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.
 
+
+Apply trac_10793_bug_in_matrix_construction.patch, trac_10793_fixing_existing_bugs.patch
+
``````




---

archive/issue_events_027843.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-08-14T02:58:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10793#event-27843"
}
```



---

archive/issue_comments_136756.json:
```json
{
    "body": "<a id='comment:13'></a>\nI totally forgot that we haven't merged this ticket yet. Applies fine on Sage-4.7.1.rc2. Positive review.",
    "created_at": "2011-08-14T02:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136756",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
I totally forgot that we haven't merged this ticket yet. Applies fine on Sage-4.7.1.rc2. Positive review.



---

archive/issue_comments_136757.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Volker Braun\"",
    "created_at": "2011-08-14T02:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136757",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Volker Braun"



---

archive/issue_comments_136758.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-08-17T20:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136758",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_136759.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis patch conflicts with #11552.  Since the latter is older, I propose that this patch is rebased to #11552.",
    "created_at": "2011-08-17T20:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136759",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
This patch conflicts with #11552.  Since the latter is older, I propose that this patch is rebased to #11552.



---

archive/issue_comments_136760.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-17T21:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136760",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136761.json:
```json
{
    "body": "<a id='comment:15'></a>\nAttachment [trac_10793_fixing_existing_bugs.patch](tarball://root/attachments/some-uuid/ticket10793/trac_10793_fixing_existing_bugs.patch) by @novoselt created at 2011-08-17 21:41:13\n\nRebased on top of #11552, needs review.",
    "created_at": "2011-08-17T21:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136761",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:15'></a>
Attachment [trac_10793_fixing_existing_bugs.patch](tarball://root/attachments/some-uuid/ticket10793/trac_10793_fixing_existing_bugs.patch) by @novoselt created at 2011-08-17 21:41:13

Rebased on top of #11552, needs review.



---

archive/issue_comments_136762.json:
```json
{
    "body": "Changing dependencies from \"#11200\" to \"#11200, #11552\"",
    "created_at": "2011-08-17T21:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136762",
    "user": "https://github.com/novoselt"
}
```

Changing dependencies from "#11200" to "#11200, #11552"



---

archive/issue_comments_136763.json:
```json
{
    "body": "<a id='comment:16'></a>\nI think that if a rebase is straightforward (ie there is no real change to code), then it does not need to be reviewed.  I can't tell here, since the rebased patch replaced the old patch.\n\nNo matter - I've applied it and done minimal tests.  All looks good.  I'm running all tests right now and then will flip to positive review.\n\nI'm glad this got fixed.  While doing work on free module morphisms I ran into this frequently, where domains and codomains got confused, and so on.  I'm surprised it survived this long.  Thanks Volker and Andrey for the fix!\n\nRob",
    "created_at": "2011-08-17T23:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136763",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:16'></a>
I think that if a rebase is straightforward (ie there is no real change to code), then it does not need to be reviewed.  I can't tell here, since the rebased patch replaced the old patch.

No matter - I've applied it and done minimal tests.  All looks good.  I'm running all tests right now and then will flip to positive review.

I'm glad this got fixed.  While doing work on free module morphisms I ran into this frequently, where domains and codomains got confused, and so on.  I'm surprised it survived this long.  Thanks Volker and Andrey for the fix!

Rob



---

archive/issue_comments_136764.json:
```json
{
    "body": "<a id='comment:17'></a>\nIt was straightforward, your patch added spaces after commas in two lines that I have altered...",
    "created_at": "2011-08-18T00:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136764",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:17'></a>
It was straightforward, your patch added spaces after commas in two lines that I have altered...



---

archive/issue_comments_136765.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-18T00:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136765",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136766.json:
```json
{
    "body": "<a id='comment:18'></a>\nSorry.  ;-)  Thanks for the rebase.  Passes all tests.\n\nRob",
    "created_at": "2011-08-18T00:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136766",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:18'></a>
Sorry.  ;-)  Thanks for the rebase.  Passes all tests.

Rob



---

archive/issue_events_027844.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-18T22:02:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10793#event-27844"
}
```



---

archive/issue_comments_136767.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.2.alpha2\"",
    "created_at": "2011-08-18T22:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136767",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.7.2.alpha2"



---

archive/issue_comments_136768.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-08-18T22:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10793#issuecomment-136768",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
