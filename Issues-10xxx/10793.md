# Issue 10793: Matrices can be "constructed" from matrices of wrong dimensions

archive/issues_010728.json:
```json
{
    "assignees": [],
    "body": "Let's make a matrix and use it to define a morphism:\n\n```\nsage: projection = matrix(ZZ,[[1,0,0],[0,1,0]])\nsage: projection\n[1 0 0]\n[0 1 0]\nsage: H = Hom(ZZ^3, ZZ^2)\nsage: H(projection)\nFree module morphism defined by the matrix\n[1 0]\n[0 0]\n[1 0]\nDomain: Ambient free module of rank 3 over the principal ideal domain ...\nCodomain: Ambient free module of rank 2 over the principal ideal domain ...\n```\nAs we see, the matrix of the morphism is very unlikely to be what it should be. Here is the source of the problem:\n\n```\nsage: projection.parent()\nFull MatrixSpace of 2 by 3 dense matrices over Integer Ring\nsage: M = MatrixSpace(ZZ, 3 , 2)\nsage: M\nFull MatrixSpace of 3 by 2 dense matrices over Integer Ring\nsage: M(projection)\n[1 0]\n[0 0]\n[1 0]\n```\nSo the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.\n\n\nApply trac_10793_bug_in_matrix_construction.patch, trac_10793_fixing_existing_bugs.patch\n\n\nDepends on #11200\n\nDepends on #11552\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @rbeezer @kcrisman\n\n**Keywords:** sd31\n\n**Author:** Andrey Novoseltsev\n\n**Reviewer:** Volker Braun\n\n**Merged:** sage-4.7.2.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/10793\n\n",
    "closed_at": "2011-08-18T22:02:18Z",
    "created_at": "2011-02-17T11:52:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Matrices can be \"constructed\" from matrices of wrong dimensions",
    "type": "issue",
    "updated_at": "2011-08-18T22:02:18Z",
    "url": "https://github.com/sagemath/sage/issues/10793",
    "user": "https://github.com/vbraun"
}
```
Let's make a matrix and use it to define a morphism:

```
sage: projection = matrix(ZZ,[[1,0,0],[0,1,0]])
sage: projection
[1 0 0]
[0 1 0]
sage: H = Hom(ZZ^3, ZZ^2)
sage: H(projection)
Free module morphism defined by the matrix
[1 0]
[0 0]
[1 0]
Domain: Ambient free module of rank 3 over the principal ideal domain ...
Codomain: Ambient free module of rank 2 over the principal ideal domain ...
```
As we see, the matrix of the morphism is very unlikely to be what it should be. Here is the source of the problem:

```
sage: projection.parent()
Full MatrixSpace of 2 by 3 dense matrices over Integer Ring
sage: M = MatrixSpace(ZZ, 3 , 2)
sage: M
Full MatrixSpace of 3 by 2 dense matrices over Integer Ring
sage: M(projection)
[1 0]
[0 0]
[1 0]
```
So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.


Apply trac_10793_bug_in_matrix_construction.patch, trac_10793_fixing_existing_bugs.patch


Depends on #11200

Depends on #11552

**Assignee:** @jasongrout, @williamstein

**CC:**  @rbeezer @kcrisman

**Keywords:** sd31

**Author:** Andrey Novoseltsev

**Reviewer:** Volker Braun

**Merged:** sage-4.7.2.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/10793





---

archive/issue_events_120011.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-17T11:52:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120011"
}
```



---

archive/issue_events_120012.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-17T11:52:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
    "label_color": "08517b",
    "label_name": "component: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120012"
}
```



---

archive/issue_comments_106081.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,36 +1,31 @@\n-Here I use a projection matrix to map a 3d cone to a 2d cone:\n+Let's make a matrix and use it to define a morphism:\n \n ```\n sage: projection = matrix(ZZ,[[1,0,0],[0,1,0]])\n sage: projection\n [1 0 0]\n [0 1 0]\n-sage: cone3d = Cone([(1,0,0),(0,1,0)])\n-sage: cone2d = Cone([ projection*r for r in cone3d.rays() ])\n-sage: cone2d.rays()\n-(N(0, 1), N(1, 0))\n-```\n-If you use the same matrix in `FanMorphism`, you get an unexpected result:\n-\n-```\n-sage: FanMorphism( projection, Fan([cone3d]), Fan([cone2d]) )\n-Fan morphism defined by the matrix\n+sage: H = Hom(ZZ^3, ZZ^2)\n+sage: H(projection)\n+Free module morphism defined by the matrix\n [1 0]\n [0 0]\n [1 0]\n-Domain fan: Rational polyhedral fan in 3-d lattice N\n-Codomain fan: Rational polyhedral fan in 2-d lattice N\n+Domain: Ambient free module of rank 3 over the principal ideal domain ...\n+Codomain: Ambient free module of rank 2 over the principal ideal domain ...\n ```\n-Sharp eyes reveal that the matrix is not the one I wanted; I understand that Sage expects a left matrix action.  But having gotten a matrix of the wrong shape, no error is produced. Only a nonsensical output? Expected behavior would be an error, stating that the matrix dimensions do not match.\n-\n-For reference, the correct way to construct the morphism is with the transposed matrix.\n+As we see, the matrix of the morphism is very unlikely to be what it should be. Here is the source of the problem:\n \n ```\n-sage: FanMorphism( projection.transpose(), Fan([cone3d]), Fan([cone2d]) )\n-Fan morphism defined by the matrix\n+sage: projection.parent()\n+Full MatrixSpace of 2 by 3 dense matrices over Integer Ring\n+sage: M = MatrixSpace(ZZ, 3 , 2)\n+sage: M\n+Full MatrixSpace of 3 by 2 dense matrices over Integer Ring\n+sage: M(projection)\n [1 0]\n-[0 1]\n [0 0]\n-Domain fan: Rational polyhedral fan in 3-d lattice N\n-Codomain fan: Rational polyhedral fan in 2-d lattice N\n+[1 0]\n ```\n+So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.\n+\n``````\n",
    "created_at": "2011-02-17T15:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106081",
    "user": "https://github.com/novoselt"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,36 +1,31 @@
-Here I use a projection matrix to map a 3d cone to a 2d cone:
+Let's make a matrix and use it to define a morphism:
 
 ```
 sage: projection = matrix(ZZ,[[1,0,0],[0,1,0]])
 sage: projection
 [1 0 0]
 [0 1 0]
-sage: cone3d = Cone([(1,0,0),(0,1,0)])
-sage: cone2d = Cone([ projection*r for r in cone3d.rays() ])
-sage: cone2d.rays()
-(N(0, 1), N(1, 0))
-```
-If you use the same matrix in `FanMorphism`, you get an unexpected result:
-
-```
-sage: FanMorphism( projection, Fan([cone3d]), Fan([cone2d]) )
-Fan morphism defined by the matrix
+sage: H = Hom(ZZ^3, ZZ^2)
+sage: H(projection)
+Free module morphism defined by the matrix
 [1 0]
 [0 0]
 [1 0]
-Domain fan: Rational polyhedral fan in 3-d lattice N
-Codomain fan: Rational polyhedral fan in 2-d lattice N
+Domain: Ambient free module of rank 3 over the principal ideal domain ...
+Codomain: Ambient free module of rank 2 over the principal ideal domain ...
 ```
-Sharp eyes reveal that the matrix is not the one I wanted; I understand that Sage expects a left matrix action.  But having gotten a matrix of the wrong shape, no error is produced. Only a nonsensical output? Expected behavior would be an error, stating that the matrix dimensions do not match.
-
-For reference, the correct way to construct the morphism is with the transposed matrix.
+As we see, the matrix of the morphism is very unlikely to be what it should be. Here is the source of the problem:
 
 ```
-sage: FanMorphism( projection.transpose(), Fan([cone3d]), Fan([cone2d]) )
-Fan morphism defined by the matrix
+sage: projection.parent()
+Full MatrixSpace of 2 by 3 dense matrices over Integer Ring
+sage: M = MatrixSpace(ZZ, 3 , 2)
+sage: M
+Full MatrixSpace of 3 by 2 dense matrices over Integer Ring
+sage: M(projection)
 [1 0]
-[0 1]
 [0 0]
-Domain fan: Rational polyhedral fan in 3-d lattice N
-Codomain fan: Rational polyhedral fan in 2-d lattice N
+[1 0]
 ```
+So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.
+
``````




---

archive/issue_events_120013.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-17T15:43:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/critical",
    "label_color": "ff0000",
    "label_name": "critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120013"
}
```



---

archive/issue_events_120014.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-17T15:43:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120014"
}
```



---

archive/issue_comments_106082.json:
```json
{
    "body": "**Changing assignee** from @aghitza to @jasongrout, @williamstein.",
    "created_at": "2011-02-17T15:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106082",
    "user": "https://github.com/novoselt"
}
```

**Changing assignee** from @aghitza to @jasongrout, @williamstein.



---

archive/issue_comments_106083.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\nI have completely replaced the original Volker's description since the problem is unrelated to fan morphisms themselves.\n\nAlso I think that this is an extremely dangerous bug and will take the liberty to elevate its priority...",
    "created_at": "2011-02-17T15:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106083",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:1'>**Comment 1:**</a>
I have completely replaced the original Volker's description since the problem is unrelated to fan morphisms themselves.

Also I think that this is an extremely dangerous bug and will take the liberty to elevate its priority...



---

archive/issue_events_120015.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-17T15:43:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "rename": {
        "from": "FanMorphism defined by matrices are dangerous",
        "to": "Matrices can be \"constructed\" from matrices of wrong dimensions"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120015"
}
```



---

archive/issue_events_120016.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-17T15:43:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
    "label_color": "08517b",
    "label_name": "component: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120016"
}
```



---

archive/issue_events_120017.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-02-17T15:43:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "08517b",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120017"
}
```



---

archive/issue_comments_106084.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nSo it seems that the problem here is that in converting to an element of the matrix space, it views the entries of the matrix (or indeed, the entries of a nested list as well) as a flattened list:\n\n```\nsage: M\nFull MatrixSpace of 3 by 2 dense matrices over Integer Ring\nsage: M([[1,2,3],[4,5,6]])\n[1 2]\n[3 4]\n[5 6]\n```\n\nSo I guess you're saying that MatrixSpace shouldn't flatten the list, but instead should throw an error?",
    "created_at": "2011-02-17T16:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106084",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'>**Comment 2:**</a>
So it seems that the problem here is that in converting to an element of the matrix space, it views the entries of the matrix (or indeed, the entries of a nested list as well) as a flattened list:

```
sage: M
Full MatrixSpace of 3 by 2 dense matrices over Integer Ring
sage: M([[1,2,3],[4,5,6]])
[1 2]
[3 4]
[5 6]
```

So I guess you're saying that MatrixSpace shouldn't flatten the list, but instead should throw an error?



---

archive/issue_comments_106085.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nAround line 361 in `matrix/matrix_space.py`, we see:\n\n```\n        if isinstance(entries, (list, tuple)) and len(entries) > 0 and \\\n           sage.modules.free_module_element.is_FreeModuleElement(entries[0]):\n            #Try to determine whether or not the entries should\n            #be rows or columns\n            if rows is None:\n                #If the matrix is square, default to rows\n                if self.__ncols == self.__nrows:\n                    rows = True\n                elif len(entries[0]) == self.__ncols:\n                    rows = True\n                elif len(entries[0]) == self.__nrows:\n                    rows = False\n                else:\n                    raise ValueError, \"incorrect dimensions\"\n            \n            if self.__is_sparse:\n                e = {}\n                zero = self.base_ring()(0)\n                for i in xrange(len(entries)):\n                    for j, x in entries[i].iteritems():\n                        if x != zero:\n                            if rows:\n                                e[(i,j)] = x\n                            else:\n                                e[(j,i)] = x\n                entries = e\n            else:\n                entries = sum([v.list() for v in entries],[])\n```\n\nSo:\n\n1. I think it tries to be too intelligent about guessing whether you have rows or columns.  That leads to inconsistent behavior when you have code dealing with different matrix spaces with different dimensions.\n\n2. It indeed does flatten the list if all else fails (that's the sum([v.list()... line).  I agree that that looks dangerous as well.",
    "created_at": "2011-02-17T16:05:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106085",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'>**Comment 3:**</a>
Around line 361 in `matrix/matrix_space.py`, we see:

```
        if isinstance(entries, (list, tuple)) and len(entries) > 0 and \
           sage.modules.free_module_element.is_FreeModuleElement(entries[0]):
            #Try to determine whether or not the entries should
            #be rows or columns
            if rows is None:
                #If the matrix is square, default to rows
                if self.__ncols == self.__nrows:
                    rows = True
                elif len(entries[0]) == self.__ncols:
                    rows = True
                elif len(entries[0]) == self.__nrows:
                    rows = False
                else:
                    raise ValueError, "incorrect dimensions"
            
            if self.__is_sparse:
                e = {}
                zero = self.base_ring()(0)
                for i in xrange(len(entries)):
                    for j, x in entries[i].iteritems():
                        if x != zero:
                            if rows:
                                e[(i,j)] = x
                            else:
                                e[(j,i)] = x
                entries = e
            else:
                entries = sum([v.list() for v in entries],[])
```

So:

1. I think it tries to be too intelligent about guessing whether you have rows or columns.  That leads to inconsistent behavior when you have code dealing with different matrix spaces with different dimensions.

2. It indeed does flatten the list if all else fails (that's the sum([v.list()... line).  I agree that that looks dangerous as well.



---

archive/issue_comments_106086.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nReplying to [@jasongrout](#comment%3A2):\n> So it seems that the problem here is that in converting to an element of the matrix space, it views the entries of the matrix (or indeed, the entries of a nested list as well) as a flattened list:\n> \n> ```\n> sage: M\n> Full MatrixSpace of 3 by 2 dense matrices over Integer Ring\n> sage: M([[1,2,3],[4,5,6]])\n> [1 2]\n> [3 4]\n> [5 6]\n> ```\n> \n> So I guess you're saying that MatrixSpace shouldn't flatten the list, but instead should throw an error?\n\nAbsolutely! I see no reason why such flattening can make sense, so even if there some - I think they should do it explicitly.\n\nI find it a bit confusing that Sage uses right matrix action, so in the description I tend to think that `projection` itself is the matrix of the morphism, not its transpose. I suspect I am not the only one who can fall into this trap: it is accepted as an input, but some other not-very-related matrix is then used in the morphism.",
    "created_at": "2011-02-17T16:08:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106086",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'>**Comment 4:**</a>
Replying to [@jasongrout](#comment%3A2):
> So it seems that the problem here is that in converting to an element of the matrix space, it views the entries of the matrix (or indeed, the entries of a nested list as well) as a flattened list:
> 
> ```
> sage: M
> Full MatrixSpace of 3 by 2 dense matrices over Integer Ring
> sage: M([[1,2,3],[4,5,6]])
> [1 2]
> [3 4]
> [5 6]
> ```
> 
> So I guess you're saying that MatrixSpace shouldn't flatten the list, but instead should throw an error?

Absolutely! I see no reason why such flattening can make sense, so even if there some - I think they should do it explicitly.

I find it a bit confusing that Sage uses right matrix action, so in the description I tend to think that `projection` itself is the matrix of the morphism, not its transpose. I suspect I am not the only one who can fall into this trap: it is accepted as an input, but some other not-very-related matrix is then used in the morphism.



---

archive/issue_comments_106087.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nHi Rob, this is the ticket I was talking about!",
    "created_at": "2011-06-14T16:52:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106087",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'>**Comment 5:**</a>
Hi Rob, this is the ticket I was talking about!



---

archive/issue_comments_106088.json:
```json
{
    "body": "**Attachment:** [trac_10793_bug_in_matrix_construction.patch.gz](https://github.com/sagemath/sage/files/ticket10793/trac_10793_bug_in_matrix_construction.patch.gz)",
    "created_at": "2011-06-16T22:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106088",
    "user": "https://github.com/novoselt"
}
```

**Attachment:** [trac_10793_bug_in_matrix_construction.patch.gz](https://github.com/sagemath/sage/files/ticket10793/trac_10793_bug_in_matrix_construction.patch.gz)



---

archive/issue_events_120018.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-06-16T22:55:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120018"
}
```



---

archive/issue_comments_106089.json:
```json
{
    "body": "**Author:** Andrey Novoseltsev",
    "created_at": "2011-06-16T22:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106089",
    "user": "https://github.com/novoselt"
}
```

**Author:** Andrey Novoseltsev



---

archive/issue_comments_106090.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd31\".",
    "created_at": "2011-06-16T22:56:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106090",
    "user": "https://github.com/novoselt"
}
```

**Changing keywords** from "" to "sd31".



---

archive/issue_comments_106091.json:
```json
{
    "body": "**Work Issues:** doctest failures",
    "created_at": "2011-06-16T23:04:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106091",
    "user": "https://github.com/novoselt"
}
```

**Work Issues:** doctest failures



---

archive/issue_comments_106092.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nThere are doctest failures that have to be addressed. I suspect that all places that are affected were just kind of wrong. For Nx1 and 1xN matrices nothing too horrible is going on, hopefully there are no other cases.",
    "created_at": "2011-06-16T23:04:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106092",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'>**Comment 8:**</a>
There are doctest failures that have to be addressed. I suspect that all places that are affected were just kind of wrong. For Nx1 and 1xN matrices nothing too horrible is going on, hopefully there are no other cases.



---

archive/issue_events_120019.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-06-16T23:04:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120019"
}
```



---

archive/issue_events_120020.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-06-16T23:04:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120020"
}
```



---

archive/issue_comments_106093.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nHere is the list of offenders:\n\n```\n\tsage -t -long devel/sage-main/sage/crypto/mq/sr.py # 15 doctests failed\n\tsage -t -long devel/sage-main/sage/interfaces/sage0.py # 2 doctests failed\n\tsage -t -long devel/sage-main/sage/crypto/mq/mpolynomialsystem.py # 50 doctests failed\n\tsage -t -long devel/sage-main/sage/geometry/fan_morphism.py # 4 doctests failed\n\tsage -t -long devel/sage-main/sage/rings/polynomial/multi_polynomial_sequence.py # 33 doctests failed\n\tsage -t -long devel/sage-main/sage/categories/map.pyx # 16 doctests failed\n\tsage -t -long devel/sage-main/sage/interfaces/magma.py # 2 doctests failed\n\tsage -t -long devel/sage-main/sage/modules/matrix_morphism.py # 9 doctests failed\n```\n\nIMHO, all these files are full of bugs!",
    "created_at": "2011-06-17T00:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106093",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:9'>**Comment 9:**</a>
Here is the list of offenders:

```
	sage -t -long devel/sage-main/sage/crypto/mq/sr.py # 15 doctests failed
	sage -t -long devel/sage-main/sage/interfaces/sage0.py # 2 doctests failed
	sage -t -long devel/sage-main/sage/crypto/mq/mpolynomialsystem.py # 50 doctests failed
	sage -t -long devel/sage-main/sage/geometry/fan_morphism.py # 4 doctests failed
	sage -t -long devel/sage-main/sage/rings/polynomial/multi_polynomial_sequence.py # 33 doctests failed
	sage -t -long devel/sage-main/sage/categories/map.pyx # 16 doctests failed
	sage -t -long devel/sage-main/sage/interfaces/magma.py # 2 doctests failed
	sage -t -long devel/sage-main/sage/modules/matrix_morphism.py # 9 doctests failed
```

IMHO, all these files are full of bugs!



---

archive/issue_events_120021.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-06-17T00:34:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120021"
}
```



---

archive/issue_events_120022.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-06-17T00:34:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120022"
}
```



---

archive/issue_comments_106094.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nOK, it turned out to be not as scary as it seemed to me originally. Most of the errors were due to forgetting that matrices act from the right. In crypto I have added explicit conversion of matrices to lists since it seems that they wanted it. I don't understand that code to make sure that this is indeed correct, but at the very least I didn't introduce a new bug ;-)",
    "created_at": "2011-06-17T00:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106094",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'>**Comment 10:**</a>
OK, it turned out to be not as scary as it seemed to me originally. Most of the errors were due to forgetting that matrices act from the right. In crypto I have added explicit conversion of matrices to lists since it seems that they wanted it. I don't understand that code to make sure that this is indeed correct, but at the very least I didn't introduce a new bug ;-)



---

archive/issue_comments_106095.json:
```json
{
    "body": "**Changing work issues** from \"doctest failures\" to \"\".",
    "created_at": "2011-06-17T00:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106095",
    "user": "https://github.com/novoselt"
}
```

**Changing work issues** from "doctest failures" to "".



---

archive/issue_comments_106096.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nPatches should apply fine on top of sage-4.7.1.alpha4, as #11200 (and other patches modifying fan morphisms) was merged.",
    "created_at": "2011-07-06T00:15:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106096",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:11'>**Comment 11:**</a>
Patches should apply fine on top of sage-4.7.1.alpha4, as #11200 (and other patches modifying fan morphisms) was merged.



---

archive/issue_comments_106097.json:
```json
{
    "body": "**Dependencies:** #11200",
    "created_at": "2011-07-06T00:15:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106097",
    "user": "https://github.com/novoselt"
}
```

**Dependencies:** #11200



---

archive/issue_events_120023.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-08-14T02:58:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120023"
}
```



---

archive/issue_events_120024.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-08-14T02:58:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120024"
}
```



---

archive/issue_comments_106098.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -29,3 +29,6 @@\n ```\n So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.\n \n+\n+Apply trac_10793_bug_in_matrix_construction.patch, trac_10793_fixing_existing_bugs.patch\n+\n``````\n",
    "created_at": "2011-08-14T02:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106098",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -29,3 +29,6 @@
 ```
 So the matrix space converts the input to the matrix no matter what (same with `matrix` command, but inside morphisms matrix spaces are used). I suppose this will work any time the number of entries in the original and in the destination is matching. I think that if one really wants to do it, then this one is very welcome to insert an explicit conversion of a matrix to a list and then back to a matrix, but the above should raise exceptions.
 
+
+Apply trac_10793_bug_in_matrix_construction.patch, trac_10793_fixing_existing_bugs.patch
+
``````




---

archive/issue_events_120025.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-08-14T02:58:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120025"
}
```



---

archive/issue_events_120026.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-08-14T02:58:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120026"
}
```



---

archive/issue_comments_106099.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nI totally forgot that we haven't merged this ticket yet. Applies fine on Sage-4.7.1.rc2. Positive review.",
    "created_at": "2011-08-14T02:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106099",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'>**Comment 13:**</a>
I totally forgot that we haven't merged this ticket yet. Applies fine on Sage-4.7.1.rc2. Positive review.



---

archive/issue_comments_106100.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2011-08-14T02:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106100",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_events_120027.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-17T20:34:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120027"
}
```



---

archive/issue_events_120028.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-17T20:34:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120028"
}
```



---

archive/issue_comments_106101.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nThis patch conflicts with #11552.  Since the latter is older, I propose that this patch is rebased to #11552.",
    "created_at": "2011-08-17T20:34:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106101",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'>**Comment 14:**</a>
This patch conflicts with #11552.  Since the latter is older, I propose that this patch is rebased to #11552.



---

archive/issue_events_120029.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-08-17T21:41:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120029"
}
```



---

archive/issue_events_120030.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-08-17T21:41:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120030"
}
```



---

archive/issue_comments_106102.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\n**Attachment:** [trac_10793_fixing_existing_bugs.patch.gz](https://github.com/sagemath/sage/files/ticket10793/trac_10793_fixing_existing_bugs.patch.gz)\n\nRebased on top of #11552, needs review.",
    "created_at": "2011-08-17T21:41:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106102",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:15'>**Comment 15:**</a>
**Attachment:** [trac_10793_fixing_existing_bugs.patch.gz](https://github.com/sagemath/sage/files/ticket10793/trac_10793_fixing_existing_bugs.patch.gz)

Rebased on top of #11552, needs review.



---

archive/issue_comments_106103.json:
```json
{
    "body": "**Changing dependencies** from \"#11200\" to \"#11200, #11552\".",
    "created_at": "2011-08-17T21:41:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106103",
    "user": "https://github.com/novoselt"
}
```

**Changing dependencies** from "#11200" to "#11200, #11552".



---

archive/issue_comments_106104.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nI think that if a rebase is straightforward (ie there is no real change to code), then it does not need to be reviewed.  I can't tell here, since the rebased patch replaced the old patch.\n\nNo matter - I've applied it and done minimal tests.  All looks good.  I'm running all tests right now and then will flip to positive review.\n\nI'm glad this got fixed.  While doing work on free module morphisms I ran into this frequently, where domains and codomains got confused, and so on.  I'm surprised it survived this long.  Thanks Volker and Andrey for the fix!\n\nRob",
    "created_at": "2011-08-17T23:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106104",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:16'>**Comment 16:**</a>
I think that if a rebase is straightforward (ie there is no real change to code), then it does not need to be reviewed.  I can't tell here, since the rebased patch replaced the old patch.

No matter - I've applied it and done minimal tests.  All looks good.  I'm running all tests right now and then will flip to positive review.

I'm glad this got fixed.  While doing work on free module morphisms I ran into this frequently, where domains and codomains got confused, and so on.  I'm surprised it survived this long.  Thanks Volker and Andrey for the fix!

Rob



---

archive/issue_comments_106105.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nIt was straightforward, your patch added spaces after commas in two lines that I have altered...",
    "created_at": "2011-08-18T00:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106105",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:17'>**Comment 17:**</a>
It was straightforward, your patch added spaces after commas in two lines that I have altered...



---

archive/issue_events_120031.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-18T00:05:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120031"
}
```



---

archive/issue_events_120032.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-18T00:05:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120032"
}
```



---

archive/issue_comments_106106.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nSorry.  ;-)  Thanks for the rebase.  Passes all tests.\n\nRob",
    "created_at": "2011-08-18T00:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106106",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:18'>**Comment 18:**</a>
Sorry.  ;-)  Thanks for the rebase.  Passes all tests.

Rob



---

archive/issue_events_120033.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-18T22:02:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120033"
}
```



---

archive/issue_events_120034.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-18T22:02:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10793#event-120034"
}
```



---

archive/issue_comments_106107.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha2",
    "created_at": "2011-08-18T22:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10793",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10793#issuecomment-106107",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.2.alpha2
