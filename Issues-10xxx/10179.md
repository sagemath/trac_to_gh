# Issue 10179: LLL memory leak

archive/issues_010178.json:
```json
{
    "body": "The following code demonstrates a memory leak in the fpLLL wrapper. I looked at the source code for a few minutes and haven't been able to find out where the leak is.\n\n```\ndef leak():\n    M = MatrixSpace(ZZ, 10)\n    A = M.random_element()\n    n = 0\n    old_m = get_memory_usage()\n    old_n = 1\n    from sage.libs.fplll.fplll import FP_LLL\n    while 1:\n        n = n + 1\n        C = sage.libs.fplll.fplll.FP_LLL(A)\n        C.wrapper(0, .501, .99)\n        B = C._sage_()\n        m = get_memory_usage()\n        if m != old_m:\n            print n, n - old_n, \": current memory usage:\", get_memory_usage()\n            sys.stdout.flush()\n            old_m = m\n            old_n = n\n```\n\nWhen run, the output on my machine looks something like\n\n```\nsage: leak()\n2666 2665 : current memory usage: 815.63671875\n3503 837 : current memory usage: 815.765625\n4327 824 : current memory usage: 815.89453125\n5160 833 : current memory usage: 816.0234375\n5990 830 : current memory usage: 816.15234375\n6829 839 : current memory usage: 816.28125\n7661 832 : current memory usage: 816.41015625\n8492 831 : current memory usage: 816.5390625\n9332 840 : current memory usage: 816.66796875\n10160 828 : current memory usage: 816.796875\n10989 829 : current memory usage: 816.92578125\n11824 835 : current memory usage: 817.0546875\n12648 824 : current memory usage: 817.18359375\n13478 830 : current memory usage: 817.3125\n14315 837 : current memory usage: 817.44140625\n15142 827 : current memory usage: 817.5703125\n15980 838 : current memory usage: 817.69921875\n16817 837 : current memory usage: 817.828125\n17636 819 : current memory usage: 817.95703125\n18466 830 : current memory usage: 818.0859375\n19292 826 : current memory usage: 818.21484375\n20128 836 : current memory usage: 818.34375\n20961 833 : current memory usage: 818.47265625\n21792 831 : current memory usage: 818.6015625\n22628 836 : current memory usage: 818.73046875\n23465 837 : current memory usage: 818.859375\n24301 836 : current memory usage: 818.98828125\n25133 832 : current memory usage: 819.1171875\n25957 824 : current memory usage: 819.24609375\n26789 832 : current memory usage: 819.375\n27621 832 : current memory usage: 819.50390625\n28456 835 : current memory usage: 819.6328125\n29287 831 : current memory usage: 819.76171875\n30127 840 : current memory usage: 819.890625\n30955 828 : current memory usage: 820.01953125\n31782 827 : current memory usage: 820.1484375\n32608 826 : current memory usage: 820.27734375\n33442 834 : current memory usage: 820.40625\n34275 833 : current memory usage: 820.53515625\n35113 838 : current memory usage: 820.6640625\n[...]\n```\n\nAssignee: @rlmill\n\nCC:  @malb\n\nReviewer: Andr\u00e9 Apitzsch, Peter Bruin\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/10179\n\n",
    "closed_at": "2014-08-20T20:35:21Z",
    "created_at": "2010-10-27T20:36:25Z",
    "labels": [
        "component: memleak",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "LLL memory leak",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10179",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```
The following code demonstrates a memory leak in the fpLLL wrapper. I looked at the source code for a few minutes and haven't been able to find out where the leak is.

```
def leak():
    M = MatrixSpace(ZZ, 10)
    A = M.random_element()
    n = 0
    old_m = get_memory_usage()
    old_n = 1
    from sage.libs.fplll.fplll import FP_LLL
    while 1:
        n = n + 1
        C = sage.libs.fplll.fplll.FP_LLL(A)
        C.wrapper(0, .501, .99)
        B = C._sage_()
        m = get_memory_usage()
        if m != old_m:
            print n, n - old_n, ": current memory usage:", get_memory_usage()
            sys.stdout.flush()
            old_m = m
            old_n = n
```

When run, the output on my machine looks something like

```
sage: leak()
2666 2665 : current memory usage: 815.63671875
3503 837 : current memory usage: 815.765625
4327 824 : current memory usage: 815.89453125
5160 833 : current memory usage: 816.0234375
5990 830 : current memory usage: 816.15234375
6829 839 : current memory usage: 816.28125
7661 832 : current memory usage: 816.41015625
8492 831 : current memory usage: 816.5390625
9332 840 : current memory usage: 816.66796875
10160 828 : current memory usage: 816.796875
10989 829 : current memory usage: 816.92578125
11824 835 : current memory usage: 817.0546875
12648 824 : current memory usage: 817.18359375
13478 830 : current memory usage: 817.3125
14315 837 : current memory usage: 817.44140625
15142 827 : current memory usage: 817.5703125
15980 838 : current memory usage: 817.69921875
16817 837 : current memory usage: 817.828125
17636 819 : current memory usage: 817.95703125
18466 830 : current memory usage: 818.0859375
19292 826 : current memory usage: 818.21484375
20128 836 : current memory usage: 818.34375
20961 833 : current memory usage: 818.47265625
21792 831 : current memory usage: 818.6015625
22628 836 : current memory usage: 818.73046875
23465 837 : current memory usage: 818.859375
24301 836 : current memory usage: 818.98828125
25133 832 : current memory usage: 819.1171875
25957 824 : current memory usage: 819.24609375
26789 832 : current memory usage: 819.375
27621 832 : current memory usage: 819.50390625
28456 835 : current memory usage: 819.6328125
29287 831 : current memory usage: 819.76171875
30127 840 : current memory usage: 819.890625
30955 828 : current memory usage: 820.01953125
31782 827 : current memory usage: 820.1484375
32608 826 : current memory usage: 820.27734375
33442 834 : current memory usage: 820.40625
34275 833 : current memory usage: 820.53515625
35113 838 : current memory usage: 820.6640625
[...]
```

Assignee: @rlmill

CC:  @malb

Reviewer: Andr√© Apitzsch, Peter Bruin

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/10179





---

archive/issue_events_026064.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2014-08-18T21:01:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10179",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10179#event-26064"
}
```



---

archive/issue_comments_103047.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-18T21:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10179#issuecomment-103047",
    "user": "https://github.com/a-andre"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_103048.json:
```json
{
    "body": "<a id='comment:1'></a>Leak seems to be gone.",
    "created_at": "2014-08-18T21:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10179#issuecomment-103048",
    "user": "https://github.com/a-andre"
}
```

<a id='comment:1'></a>Leak seems to be gone.



---

archive/issue_comments_103049.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 aapitzsch]:\n> Leak seems to be gone.\n\nIndeed, I let it run for half an hour and nothing happened.",
    "created_at": "2014-08-19T15:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10179#issuecomment-103049",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:2'></a>Replying to [comment:1 aapitzsch]:
> Leak seems to be gone.

Indeed, I let it run for half an hour and nothing happened.



---

archive/issue_comments_103050.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-19T15:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10179#issuecomment-103050",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_103051.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-20T20:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10179#issuecomment-103051",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_026065.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-20T20:35:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10179",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10179#event-26065"
}
```
