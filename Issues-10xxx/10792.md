# Issue 10792: Upgrade numpy to 1.5.1

archive/issues_010727.json:
```json
{
    "assignees": [],
    "body": "New version of numpy is out: 1.5.1\n\nSPKG: http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg\n\nApply:\n1. [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)\n2. [attachment: trac_10792-fix_riemann_doctest.patch](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)\n\nCC:  @sagetrac-evanandel @kcrisman\n\nAuthor: **Fran\u00e7ois Bissey, Jason Grout**\n\nReviewer: **David Kirkby, Karl-Dieter Crisman, Ethan Van Andel**\n\nMerged: **sage-4.7.alpha2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10792_\n\n",
    "closed_at": "2011-03-18T13:41:16Z",
    "created_at": "2011-02-17T00:16:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade numpy to 1.5.1",
    "type": "issue",
    "updated_at": "2011-05-03T13:23:15Z",
    "url": "https://github.com/sagemath/sage/issues/10792",
    "user": "https://github.com/jasongrout"
}
```
New version of numpy is out: 1.5.1

SPKG: http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg

Apply:
1. [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)
2. [attachment: trac_10792-fix_riemann_doctest.patch](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)

CC:  @sagetrac-evanandel @kcrisman

Author: **François Bissey, Jason Grout**

Reviewer: **David Kirkby, Karl-Dieter Crisman, Ethan Van Andel**

Merged: **sage-4.7.alpha2**

_Issue created by migration from https://trac.sagemath.org/ticket/10792_





---

archive/issue_events_130153.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-02-17T00:16:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130153"
}
```



---

archive/issue_events_130154.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-02-17T00:16:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130154"
}
```



---

archive/issue_events_130155.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-02-17T00:16:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130155"
}
```



---

archive/issue_events_130156.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2011-02-17T02:00:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130156"
}
```



---

archive/issue_events_130157.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2011-02-17T02:00:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130157"
}
```



---

archive/issue_comments_106053.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nUpdating should be straightforward but some doctest will break because of some extra verbosity:\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/calculus/riemann.pyx\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 102:\n    sage: m = Riemann_Map([lambda t: e^(I*t)], [lambda t: I*e^(I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 563:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 613:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 676:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 760:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 822:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 152:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginaWarning: invalid value encountered in divide\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 102:\n    sage: m = Riemann_Map([lambda t: e^(I*t)], [lambda t: I*e^(I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 563:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 613:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 676:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 760:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 822:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 152:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 196:\n    sage: isinstance(Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)._repr_(), str)  # lo\nng time\nExpected:\n    True\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n    True\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 208:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 308:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 376:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 417:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 487:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx\", line 513:\n    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\n14 items had failures:\n```\nand\n\n```\nsage -t -long \"devel/sage-main/sage/calculus/interpolators.pyx\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/interpolators.pyx\", line 52:\n    sage: m = Riemann_Map([lambda x: ps.value(x)], [lambda x: ps.derivative(x)],0)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/calculus/interpolators.pyx\", line 183:\n    sage: m = Riemann_Map([lambda x: cs.value(x)], [lambda x: cs.derivative(x)], 0)\nExpected nothing\nGot:\n    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part\n**********************************************************************\n2 items had failures:\n```\nI think that's all the failures related to numpy-1.5.1",
    "created_at": "2011-02-17T02:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106053",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:1" align="right">Comment 1</div>

Updating should be straightforward but some doctest will break because of some extra verbosity:

```
sage -t -long -force_lib "devel/sage-main/sage/calculus/riemann.pyx"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 102:
    sage: m = Riemann_Map([lambda t: e^(I*t)], [lambda t: I*e^(I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 563:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 613:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 676:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 760:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 822:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 152:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginaWarning: invalid value encountered in divide
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 102:
    sage: m = Riemann_Map([lambda t: e^(I*t)], [lambda t: I*e^(I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 563:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 613:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 676:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 760:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 822:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 152:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 196:
    sage: isinstance(Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)._repr_(), str)  # lo
ng time
Expected:
    True
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
    True
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 208:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 308:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 376:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 417:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 487:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/riemann.pyx", line 513:
    sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
14 items had failures:
```
and

```
sage -t -long "devel/sage-main/sage/calculus/interpolators.pyx"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/interpolators.pyx", line 52:
    sage: m = Riemann_Map([lambda x: ps.value(x)], [lambda x: ps.derivative(x)],0)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/calculus/interpolators.pyx", line 183:
    sage: m = Riemann_Map([lambda x: cs.value(x)], [lambda x: cs.derivative(x)], 0)
Expected nothing
Got:
    doctest:1: ComplexWarning: Casting complex values to real discards the imaginary part
**********************************************************************
2 items had failures:
```
I think that's all the failures related to numpy-1.5.1



---

archive/issue_comments_106054.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nIt sounds like there may be just a small change we should make to the Riemann map function.  Do you know line it is complaining about?",
    "created_at": "2011-02-17T04:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106054",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:2" align="right">Comment 2</div>

It sounds like there may be just a small change we should make to the Riemann map function.  Do you know line it is complaining about?



---

archive/issue_comments_106055.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nI am not sure. I don't understand the code very well in Riemann map. The only thing suspect to me is this\n\n```\n        pt1 = np.complex(pt)\n```\non line 499 in riemann.pyx. pt1 type has never been defined so I don't know if cython automatically give it the type of the right hand side or if it defaults to something else. In which case it would have to be cast.",
    "created_at": "2011-02-17T10:37:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106055",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">Comment 3</div>

I am not sure. I don't understand the code very well in Riemann map. The only thing suspect to me is this

```
        pt1 = np.complex(pt)
```
on line 499 in riemann.pyx. pt1 type has never been defined so I don't know if cython automatically give it the type of the right hand side or if it defaults to something else. In which case it would have to be cast.



---

archive/issue_comments_106056.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nOkay.  I'll try to do some printf debugging to see if I can find it \"soon\".",
    "created_at": "2011-02-17T15:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106056",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">Comment 4</div>

Okay.  I'll try to do some printf debugging to see if I can find it "soon".



---

archive/issue_comments_106057.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nDo you have a 1.5.1 spkg that you could post?  It sounds like you already made one.",
    "created_at": "2011-02-17T15:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106057",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:5" align="right">Comment 5</div>

Do you have a 1.5.1 spkg that you could post?  It sounds like you already made one.



---

archive/issue_comments_106058.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@jasongrout](#comment%3A5):\n> Do you have a 1.5.1 spkg that you could post?  It sounds like you already made one.\n\nI get that a lot. I will prepare one soon. But I don't need a new spkg to test things in sage-on-gentoo because I can use the system version, which is how I am aware of this issue and a few others regarding upgrading components.",
    "created_at": "2011-02-17T19:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106058",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@jasongrout](#comment%3A5):
> Do you have a 1.5.1 spkg that you could post?  It sounds like you already made one.

I get that a lot. I will prepare one soon. But I don't need a new spkg to test things in sage-on-gentoo because I can use the system version, which is how I am aware of this issue and a few others regarding upgrading components.



---

archive/issue_comments_106059.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nYou can find a numpy-1.5.1 spkg here\n[http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg)",
    "created_at": "2011-02-17T22:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106059",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">Comment 7</div>

You can find a numpy-1.5.1 spkg here
[http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg)



---

archive/issue_comments_106060.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI don't understand the riemann code very well either, but it seems like the warning is coming from the line where temp (a real array?) is being assigned a value from self.cps (a complex array)---see the code that is deleted in the trac-10792-riemann.patch file.  I simplified the code a lot to avoid having a temporary array, but this changed lots of numerical results.  So one question is: are the results it returns now better or worse than before?\n\nI also seem to get a huge number of `Warning: invalid value encountered in divide` warnings when doing `Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)`.  These come from NaN values popping up in the array.  Does anyone else see those?",
    "created_at": "2011-02-22T07:46:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106060",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:8" align="right">Comment 8</div>

I don't understand the riemann code very well either, but it seems like the warning is coming from the line where temp (a real array?) is being assigned a value from self.cps (a complex array)---see the code that is deleted in the trac-10792-riemann.patch file.  I simplified the code a lot to avoid having a temporary array, but this changed lots of numerical results.  So one question is: are the results it returns now better or worse than before?

I also seem to get a huge number of `Warning: invalid value encountered in divide` warnings when doing `Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0)`.  These come from NaN values popping up in the array.  Does anyone else see those?



---

archive/issue_events_130158.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-02-22T07:46:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130158"
}
```



---

archive/issue_comments_106061.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThe warnings have been there since cython-0.13 has landed. The code itself is numerically sensitive to various details including lapack implementation.\nYou may have seen something about it on sage-release.\n\nI will take a few slow days because the town where I live (Christchurch, New Zealand) has been hit by a 6.3 earthquake. Where I live is ok, where I work isn't.",
    "created_at": "2011-02-22T08:03:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106061",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">Comment 10</div>

The warnings have been there since cython-0.13 has landed. The code itself is numerically sensitive to various details including lapack implementation.
You may have seen something about it on sage-release.

I will take a few slow days because the town where I live (Christchurch, New Zealand) has been hit by a 6.3 earthquake. Where I live is ok, where I work isn't.



---

archive/issue_comments_106062.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nCCing Ethan, since he was the original author on the riemann.pyx file.\n\nEthan: I've been looking at the code that seems to cause two problems.  First is a ComplexWarnings that now appears in numpy 1.5.1, which I believe comes from a temporary array that was assumed to be real, but maybe should be complex.  I've rewritten the affected lines to not use a temporary array.\n\nThe other problem seems like it is a problem even before the upgrade---I keep getting `Warning: invalid value encountered in divide`, and the error happens in these lines in the `_generate_theta_array` function in calculus/riemann.pyx:\n\n```\n        K = np.array(\n            [-TWOPI / N * sadp * sadp[t] * 1 / (TWOPI * I) *\n              ((dp / adp) / (cp - cp[t]) -\n               ((dp[t] / adp[t]) / (cp - cp[t])).conjugate())\n              for t in np.arange(NB)], dtype=np.complex128)\n```\n\nI noticed several things that could be pulled out of the inner loop, and so rewrote this line in the attached patch (which I'll update shortly).  However, I don't know this code or the algorithms very well---can you look at the patch?\n\nIt appears that the warnings happen when there is a division by zero, as in this test case:\n\n```\nsage: import numpy as np\nsage: a=np.array([1,2],dtype=np.complex128)\nsage: b=np.array([0,1],dtype=np.complex128)\nsage: a/b\nWarning: invalid value encountered in divide\narray([ nan nanj,   2. +0.j])\nsage: a[0]/b[0]\n(nan+nan*j)\n```\n\nSo should we turn off the error checking for this error when doing this operation since at least one entry in cp-cp[t] will be zero?  Or should we check for this entry and not calculate it?",
    "created_at": "2011-02-22T18:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106062",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:11" align="right">Comment 11</div>

CCing Ethan, since he was the original author on the riemann.pyx file.

Ethan: I've been looking at the code that seems to cause two problems.  First is a ComplexWarnings that now appears in numpy 1.5.1, which I believe comes from a temporary array that was assumed to be real, but maybe should be complex.  I've rewritten the affected lines to not use a temporary array.

The other problem seems like it is a problem even before the upgrade---I keep getting `Warning: invalid value encountered in divide`, and the error happens in these lines in the `_generate_theta_array` function in calculus/riemann.pyx:

```
        K = np.array(
            [-TWOPI / N * sadp * sadp[t] * 1 / (TWOPI * I) *
              ((dp / adp) / (cp - cp[t]) -
               ((dp[t] / adp[t]) / (cp - cp[t])).conjugate())
              for t in np.arange(NB)], dtype=np.complex128)
```

I noticed several things that could be pulled out of the inner loop, and so rewrote this line in the attached patch (which I'll update shortly).  However, I don't know this code or the algorithms very well---can you look at the patch?

It appears that the warnings happen when there is a division by zero, as in this test case:

```
sage: import numpy as np
sage: a=np.array([1,2],dtype=np.complex128)
sage: b=np.array([0,1],dtype=np.complex128)
sage: a/b
Warning: invalid value encountered in divide
array([ nan nanj,   2. +0.j])
sage: a[0]/b[0]
(nan+nan*j)
```

So should we turn off the error checking for this error when doing this operation since at least one entry in cp-cp[t] will be zero?  Or should we check for this entry and not calculate it?



---

archive/issue_comments_106063.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nAttachment: **[trac-10792-riemann-complexwarnings.patch.gz](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)**\n\nEthan,\n\nI've split the issue into two problems: the ComplexWarnings problem that I hopefully fixed with the patch on this ticket and the invalid division warning, which I've made #10821.  Can you check this code and the numerical differences in output?  I now get these failures:\n\n```\n% sage -t -long riemann.pyx | grep -v \"Warning: invalid value encountered in divide\"                                                     E:128\nDetected SAGE64 flag\nBuilding Sage on OS X in 64-bit mode\nsage -t -long \"trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx\"\n**********************************************************************\nFile \"/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx\", line 123:\n    sage: print \"error =\", m.inverse_riemann_map(m.riemann_map(x)) - x  # long time\nExpected:\n    error = (-0.0001211863...+0.001606139...j)\nGot:\n    error = (-0.000291742263558+0.00160874617675j)\n**********************************************************************\nFile \"/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx\", line 484:\n    sage: m.riemann_map(0.25 + sqrt(-0.5))  # long time\nExpected:\n    (0.137514137885...+0.876696023004...j)\nGot:\n    (0.13751414123737432+0.87669602715226935j)\n**********************************************************************\nFile \"/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx\", line 486:\n    sage: m.riemann_map(1.3*I)  # long time\nExpected:\n    (-1.561029396...+0.989694535737...j)\nGot:\n    (-1.560925774791804e-05+0.98969453688560927j)\n**********************************************************************\nFile \"/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx\", line 489:\n    sage: m.riemann_map(0.4)  # long time\nExpected:\n    (0.733242677182...+3.50767714...j)\nGot:\n    (0.73324267718110436+3.2076771460460016e-06j)\n**********************************************************************\nFile \"/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx\", line 492:\n    sage: m.riemann_map(np.complex(-3, 0.0001))  # long time\nExpected:\n    (1.405757135...+1.05106...j)\nGot:\n    (1.4057571374988058e-05+8.0616369487397992e-10j)\n**********************************************************************\n2 items had failures:\n   1 of  15 in __main__.example_1\n   4 of   9 in __main__.example_8\n***Test Failed*** 5 failures.\nFor whitespace errors, see the file /Users/grout/.sage//tmp/.doctest_riemann.py\n\t [105.0 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t -long \"trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx\"\nTotal time for all tests: 105.1 seconds\n\n```\n\nIt looks like the errors are all slight numerical errors.  Can someone confirm that?",
    "created_at": "2011-02-22T18:52:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106063",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:12" align="right">Comment 12</div>

Attachment: **[trac-10792-riemann-complexwarnings.patch.gz](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)**

Ethan,

I've split the issue into two problems: the ComplexWarnings problem that I hopefully fixed with the patch on this ticket and the invalid division warning, which I've made #10821.  Can you check this code and the numerical differences in output?  I now get these failures:

```
% sage -t -long riemann.pyx | grep -v "Warning: invalid value encountered in divide"                                                     E:128
Detected SAGE64 flag
Building Sage on OS X in 64-bit mode
sage -t -long "trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx"
**********************************************************************
File "/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx", line 123:
    sage: print "error =", m.inverse_riemann_map(m.riemann_map(x)) - x  # long time
Expected:
    error = (-0.0001211863...+0.001606139...j)
Got:
    error = (-0.000291742263558+0.00160874617675j)
**********************************************************************
File "/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx", line 484:
    sage: m.riemann_map(0.25 + sqrt(-0.5))  # long time
Expected:
    (0.137514137885...+0.876696023004...j)
Got:
    (0.13751414123737432+0.87669602715226935j)
**********************************************************************
File "/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx", line 486:
    sage: m.riemann_map(1.3*I)  # long time
Expected:
    (-1.561029396...+0.989694535737...j)
Got:
    (-1.560925774791804e-05+0.98969453688560927j)
**********************************************************************
File "/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx", line 489:
    sage: m.riemann_map(0.4)  # long time
Expected:
    (0.733242677182...+3.50767714...j)
Got:
    (0.73324267718110436+3.2076771460460016e-06j)
**********************************************************************
File "/Users/grout/sage-trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx", line 492:
    sage: m.riemann_map(np.complex(-3, 0.0001))  # long time
Expected:
    (1.405757135...+1.05106...j)
Got:
    (1.4057571374988058e-05+8.0616369487397992e-10j)
**********************************************************************
2 items had failures:
   1 of  15 in __main__.example_1
   4 of   9 in __main__.example_8
***Test Failed*** 5 failures.
For whitespace errors, see the file /Users/grout/.sage//tmp/.doctest_riemann.py
	 [105.0 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t -long "trees/sage-4.6.1/devel/sage-main/sage/calculus/riemann.pyx"
Total time for all tests: 105.1 seconds

```

It looks like the errors are all slight numerical errors.  Can someone confirm that?



---

archive/issue_comments_106064.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n New version of numpy is out: 1.5.1\n \n-\n+New spkg at  http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg\n``````\n",
    "created_at": "2011-03-01T18:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106064",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 New version of numpy is out: 1.5.1
 
-
+New spkg at  http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg
``````




---

archive/issue_events_130159.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-03-01T18:54:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130159"
}
```



---

archive/issue_events_130160.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-03-01T18:54:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130160"
}
```



---

archive/issue_comments_106065.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nSorry for the slow response.\n\nIt looks like everything is slight numerical problems, which is expected given (as mentioned above) the numerical sensitivity. I'll happily test, but I'm not sure how to upgrade Sage's numpy. If someone can tell me how to get that running, I'll be able to confirm this patch and\u00a0#10821.\u00a0\n\nSide Note 1: I see that my code is apparently quite incomprehensible to people. The underlying mathematics is quite a bear, so it'll never be nice and accessible, but is there anything I can do to improve the documentation?\n\nSide Note 2: What's the status of fast_callable these days? Patch\u00a0#8867\u00a0is still out there, and if fast_callable is ready, I think we might be able to merge that as well (otherwise, I can try amending it to work with fast_callable as is)",
    "created_at": "2011-03-03T21:26:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106065",
    "user": "https://github.com/sagetrac-evanandel"
}
```

<div id="comment:15" align="right">Comment 15</div>

Sorry for the slow response.

It looks like everything is slight numerical problems, which is expected given (as mentioned above) the numerical sensitivity. I'll happily test, but I'm not sure how to upgrade Sage's numpy. If someone can tell me how to get that running, I'll be able to confirm this patch and #10821. 

Side Note 1: I see that my code is apparently quite incomprehensible to people. The underlying mathematics is quite a bear, so it'll never be nice and accessible, but is there anything I can do to improve the documentation?

Side Note 2: What's the status of fast_callable these days? Patch #8867 is still out there, and if fast_callable is ready, I think we might be able to merge that as well (otherwise, I can try amending it to work with fast_callable as is)



---

archive/issue_comments_106066.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@sagetrac-evanandel](#comment%3A15):\n> Sorry for the slow response.\n> \n> It looks like everything is slight numerical problems, which is expected given (as mentioned above) the numerical sensitivity. I'll happily test, but I'm not sure how to upgrade Sage's numpy. If someone can tell me how to get that running, I'll be able to confirm this patch and\u00a0#10821.\u00a0\n\nYou can go through the following steps:\n\n1) drop the numpy spkg in the spkg/standard folder\n\n2) sage -f numpy-1.5.1\n\n3) apply the patches (from here and #10821 ) the easiest way is to follow the procedure from the developer's manual [http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch](http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch)\n\n4) sage -b\n\n5) test\n> \n> Side Note 1: I see that my code is apparently quite incomprehensible to people. The underlying mathematics is quite a bear, so it'll never be nice and accessible, but is there anything I can do to improve the documentation?\n\ncould you refer to a review of it in a journal or an online resource?\n\n> \n> Side Note 2: What's the status of fast_callable these days? Patch\u00a0#8867\u00a0is still out there, and if fast_callable is ready, I think we might be able to merge that as well (otherwise, I can try amending it to work with fast_callable as is)\n\nNo idea.",
    "created_at": "2011-03-04T01:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106066",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@sagetrac-evanandel](#comment%3A15):
> Sorry for the slow response.
> 
> It looks like everything is slight numerical problems, which is expected given (as mentioned above) the numerical sensitivity. I'll happily test, but I'm not sure how to upgrade Sage's numpy. If someone can tell me how to get that running, I'll be able to confirm this patch and #10821. 

You can go through the following steps:

1) drop the numpy spkg in the spkg/standard folder

2) sage -f numpy-1.5.1

3) apply the patches (from here and #10821 ) the easiest way is to follow the procedure from the developer's manual [http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch](http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch)

4) sage -b

5) test
> 
> Side Note 1: I see that my code is apparently quite incomprehensible to people. The underlying mathematics is quite a bear, so it'll never be nice and accessible, but is there anything I can do to improve the documentation?

could you refer to a review of it in a journal or an online resource?

> 
> Side Note 2: What's the status of fast_callable these days? Patch #8867 is still out there, and if fast_callable is ready, I think we might be able to merge that as well (otherwise, I can try amending it to work with fast_callable as is)

No idea.



---

archive/issue_comments_106067.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n New version of numpy is out: 1.5.1\n \n-New spkg at  http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg\n+SPKG: http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg\n+\n+Apply: [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)\n``````\n",
    "created_at": "2011-03-04T01:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106067",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 New version of numpy is out: 1.5.1
 
-New spkg at  http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg
+SPKG: http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg
+
+Apply: [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)
``````




---

archive/issue_comments_106068.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nAs for fast-callable, #5572 is still on my todo list, but isn't likely to get done in the near future (e.g., this semester).  If someone else wants to work on it, they are more than welcome.",
    "created_at": "2011-03-04T01:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106068",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:17" align="right">Comment 17</div>

As for fast-callable, #5572 is still on my todo list, but isn't likely to get done in the near future (e.g., this semester).  If someone else wants to work on it, they are more than welcome.



---

archive/issue_comments_106069.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nReplying to [@jasongrout](#comment%3A8):\n> I don't understand the riemann code very well either, but it seems like the warning is coming from the line where temp (a real array?) is being assigned a value from self.cps (a complex array)---see the code that is deleted in the trac-10792-riemann.patch file.  I simplified the code a lot to avoid having a temporary array, but this changed lots of numerical results.  So one question is: are the results it returns now better or worse than before?\n\nThis is where it would be helpful doctests actually documented why the particular value is correct. I've seen *sooooo* many doctests where the \"expected value\" is whatever someone got on their computer and is not substantiated in any way as a comment in the code. \n\nAlso, if the algorithm, or its implementation in Sage is has poor numerical stability, this should be documented. \n\nCould this be computed with Mathematica or Wolfram|Alpha to arbitrary precision? Just as thought. If so, that could be documented - we have permission from Wolfram Research to use Wolfram|Alpha for the purpose of comparing results and documenting those compassions.",
    "created_at": "2011-03-07T11:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106069",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:18" align="right">Comment 18</div>

Replying to [@jasongrout](#comment%3A8):
> I don't understand the riemann code very well either, but it seems like the warning is coming from the line where temp (a real array?) is being assigned a value from self.cps (a complex array)---see the code that is deleted in the trac-10792-riemann.patch file.  I simplified the code a lot to avoid having a temporary array, but this changed lots of numerical results.  So one question is: are the results it returns now better or worse than before?

This is where it would be helpful doctests actually documented why the particular value is correct. I've seen *sooooo* many doctests where the "expected value" is whatever someone got on their computer and is not substantiated in any way as a comment in the code. 

Also, if the algorithm, or its implementation in Sage is has poor numerical stability, this should be documented. 

Could this be computed with Mathematica or Wolfram|Alpha to arbitrary precision? Just as thought. If so, that could be documented - we have permission from Wolfram Research to use Wolfram|Alpha for the purpose of comparing results and documenting those compassions.



---

archive/issue_comments_106070.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@sagetrac-drkirkby](#comment%3A18):\n\n> This is where it would be helpful doctests actually documented why the particular value is correct. I've seen *sooooo* many doctests where the \"expected value\" is whatever someone got on their computer and is not substantiated in any way as a comment in the code.\n\nUnfortunately to my knowledge, this is the only extant tool that performs this sort of Riemann map. I believe that there are one or two cases where the analytic map is known, so I can probably add some tests that check accuracy against that.\n\n> Also, if the algorithm, or its implementation in Sage is has poor numerical stability, this should be documented.\n\nAs far as I've seen, it's not unstable in the sense of dramatically losing accuracy, but the many numerical calculations are sensitive to slight differences in machine-level implementation. This results in slight differences in the final error. I should be able to do some error analysis and see if these deviations are within the bounds of the algorithm.\n\n> Could this be computed with Mathematica or Wolfram|Alpha to arbitrary precision? Just as thought. If so, that could be documented - we have permission from Wolfram Research to use Wolfram|Alpha for the purpose of comparing results and documenting those compassions.\n\nNot without complete reimplementation, and I know of no reason why their performance should be better than ours. You can increase the numerical precision of the computation by increasing N (the number of collocation points on the boundary.) I'll can create a couple of comparision tests that can be run on different machines to see if that decreases the numerical deviation.",
    "created_at": "2011-03-07T15:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106070",
    "user": "https://github.com/sagetrac-evanandel"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@sagetrac-drkirkby](#comment%3A18):

> This is where it would be helpful doctests actually documented why the particular value is correct. I've seen *sooooo* many doctests where the "expected value" is whatever someone got on their computer and is not substantiated in any way as a comment in the code.

Unfortunately to my knowledge, this is the only extant tool that performs this sort of Riemann map. I believe that there are one or two cases where the analytic map is known, so I can probably add some tests that check accuracy against that.

> Also, if the algorithm, or its implementation in Sage is has poor numerical stability, this should be documented.

As far as I've seen, it's not unstable in the sense of dramatically losing accuracy, but the many numerical calculations are sensitive to slight differences in machine-level implementation. This results in slight differences in the final error. I should be able to do some error analysis and see if these deviations are within the bounds of the algorithm.

> Could this be computed with Mathematica or Wolfram|Alpha to arbitrary precision? Just as thought. If so, that could be documented - we have permission from Wolfram Research to use Wolfram|Alpha for the purpose of comparing results and documenting those compassions.

Not without complete reimplementation, and I know of no reason why their performance should be better than ours. You can increase the numerical precision of the computation by increasing N (the number of collocation points on the boundary.) I'll can create a couple of comparision tests that can be run on different machines to see if that decreases the numerical deviation.



---

archive/issue_comments_106071.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nCould someone run a test where after upgrading numpy they rebuild scipy before doing sage -b. Technically rebuilding scipy can be done after sage -b as it is a pure runtime dependency. Then test sage/matrix/matrix_double_dense.py to see if there are more warnings in there. I have one appearing after updating to scipy-0.9 and I just want to check if it wasn't hiding before. I am fairly sure it isn't but it has to be checked and I am still quite stretched resource wise after the earthquake.",
    "created_at": "2011-03-09T01:15:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106071",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">Comment 20</div>

Could someone run a test where after upgrading numpy they rebuild scipy before doing sage -b. Technically rebuilding scipy can be done after sage -b as it is a pure runtime dependency. Then test sage/matrix/matrix_double_dense.py to see if there are more warnings in there. I have one appearing after updating to scipy-0.9 and I just want to check if it wasn't hiding before. I am fairly sure it isn't but it has to be checked and I am still quite stretched resource wise after the earthquake.



---

archive/issue_comments_106072.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nSee also #7831 for a fix for FreeBSD that perhaps can be part of this spkg, assuming we can find people to test on FreeBSD.",
    "created_at": "2011-03-12T04:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106072",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:22" align="right">Comment 22</div>

See also #7831 for a fix for FreeBSD that perhaps can be part of this spkg, assuming we can find people to test on FreeBSD.



---

archive/issue_comments_106073.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@kcrisman](#comment%3A22):\n> See also #7831 for a fix for FreeBSD that perhaps can be part of this spkg, assuming we can find people to test on FreeBSD.  \n\nSure, I'll have a look at incorporating it. Did you have a go at the patch in the present ticket? I am not impressed by the results but it could be a fluck.",
    "created_at": "2011-03-12T04:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106073",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@kcrisman](#comment%3A22):
> See also #7831 for a fix for FreeBSD that perhaps can be part of this spkg, assuming we can find people to test on FreeBSD.  

Sure, I'll have a look at incorporating it. Did you have a go at the patch in the present ticket? I am not impressed by the results but it could be a fluck.



---

archive/issue_comments_106074.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@kiwifb](#comment%3A23):\n> Replying to [@kcrisman](#comment%3A22):\n> > See also #7831 for a fix for FreeBSD that perhaps can be part of this spkg, assuming we can find people to test on FreeBSD.  \n\n> \n> Sure, I'll have a look at incorporating it. Did you have a go at the patch in the present ticket? I am not impressed by the results but it could be a fluck.\n\nNo, I haven't had a chance to do this, and I won't be at the machine I use for testing this sort of thing (the older PPC Mac) for several days.  Just wanting to point it out, in case it makes things easy.",
    "created_at": "2011-03-12T05:16:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106074",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@kiwifb](#comment%3A23):
> Replying to [@kcrisman](#comment%3A22):
> > See also #7831 for a fix for FreeBSD that perhaps can be part of this spkg, assuming we can find people to test on FreeBSD.  

> 
> Sure, I'll have a look at incorporating it. Did you have a go at the patch in the present ticket? I am not impressed by the results but it could be a fluck.

No, I haven't had a chance to do this, and I won't be at the machine I use for testing this sort of thing (the older PPC Mac) for several days.  Just wanting to point it out, in case it makes things easy.



---

archive/issue_comments_106075.json:
```json
{
    "body": "Reviewer: **David Kirkby**",
    "created_at": "2011-03-12T07:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106075",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Reviewer: **David Kirkby**



---

archive/issue_comments_106076.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nReplying to [@sagetrac-evanandel](#comment%3A19):\n> Replying to [@sagetrac-drkirkby](#comment%3A18):\n> \n> > This is where it would be helpful doctests actually documented why the particular value is correct. I've seen *sooooo* many doctests where the \"expected value\" is whatever someone got on their computer and is not substantiated in any way as a comment in the code.\n\n> \n> Unfortunately to my knowledge, this is the only extant tool that performs this sort of Riemann map. I believe that there are one or two cases where the analytic map is known, so I can probably add some tests that check accuracy against that.\n\nSo essentially the \"test\" in its current form just demonstrates that the result on different machines is approximately the same. It does not demonstrate that the result on these machines is approximately correct - the code could be incorrect and be giving results 1000 times what they should be. \n\nI'd feel a lot happier if the doctest used an example where the result is known, and cited a reference to the result. \n\nConsider for example the approach I took to testing some finite difference software I wrote for computing the impedance of electrical transmission lines of arbitrary cross section. \n\nhttp://atlc.sourceforge.net/\n\nAlthough there are a few **examples** demonstrating the answer from strange cross sections, where I have no chance of computing the result analytically\n\nhttp://atlc.sourceforge.net/examples.html\n\nfor the purposes of *testing* \n\nhttp://atlc.sourceforge.net/accuracy.html\n\nthe tests were based on cases where analytical results were known. The results were checked on a variety of CPUs (AMD, Cray, Intel Itanium, Intel x86, PA-RISC, PPC, Sun SPARC etc) on a variety of operating systems (AIX, Irix, HP-UX, OS X, Solaris, tru64, Unicos, Unixware, plus various Linux distributions)\n\n> > Also, if the algorithm, or its implementation in Sage is has poor numerical stability, this should be documented.\n\n> \n> As far as I've seen, it's not unstable in the sense of dramatically losing accuracy, but the many numerical calculations are sensitive to slight differences in machine-level implementation. This results in slight differences in the final error. I should be able to do some error analysis and see if these deviations are within the bounds of the algorithm.\n> \n> > Could this be computed with Mathematica or Wolfram|Alpha to arbitrary precision? Just as thought. If so, that could be documented - we have permission from Wolfram Research to use Wolfram|Alpha for the purpose of comparing results and documenting those compassions.\n\n> \n> Not without complete reimplementation, and I know of no reason why their performance should be better than ours. You can increase the numerical precision of the computation by increasing N (the number of collocation points on the boundary.) I'll can create a couple of comparison tests that can be run on different machines to see if that decreases the numerical deviation.\n\nWell as far as I know Numpy will use machine precision, whereas anything you do in Mathematica can be done to arbitrary precision. There are many things in Sage that can only be done on an FPU, so use of an arbitrary precision floating point maths is not supported. Mathematica does not suffer that limitation. \n\nLets say for example a doctest of Sage's factorial function used 50! as an example, and gave the result `30414093201713378043612608166064768844377641568960522000000000000`. If every machine it was tried on, using a variety of CPUs (PPC, SPARC, Intel x86, AMD x86, Intel Itanium processors) gave the same result, it does not prove Sage is correct. That would only demonstrate the reproducibility of Sage's factorial function, which is something very different from a good *test* in my opinion. Performing the same calculation in MATLAB, which can only do the calculation on the floating point processor, would increase confidence in the result. Performing the calculation on Mathematica would show a difference in one of the digits, which would lead one to question what of the two packages is wrong. (I purposely changed one of the digits, introducing a relative error of 3.28 x 10<sup>-52</sup>, which would not be seen on an FPU).\n\nI was reading only recently about when a new Mersenne prime was found. That was found on a x86 chip, but it was also verified by other software on an x86 chip and also by yet more software on a SPARC processor. \n\nIt seems to me that many doctests in Sage, just show reproducibly, and don't actually test the algorithm or the implementation. This appears to be one such *test*. \n\nPS, the \"author\" field needs to be filled in.\n\nDave",
    "created_at": "2011-03-12T07:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106076",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:25" align="right">Comment 25</div>

Replying to [@sagetrac-evanandel](#comment%3A19):
> Replying to [@sagetrac-drkirkby](#comment%3A18):
> 
> > This is where it would be helpful doctests actually documented why the particular value is correct. I've seen *sooooo* many doctests where the "expected value" is whatever someone got on their computer and is not substantiated in any way as a comment in the code.

> 
> Unfortunately to my knowledge, this is the only extant tool that performs this sort of Riemann map. I believe that there are one or two cases where the analytic map is known, so I can probably add some tests that check accuracy against that.

So essentially the "test" in its current form just demonstrates that the result on different machines is approximately the same. It does not demonstrate that the result on these machines is approximately correct - the code could be incorrect and be giving results 1000 times what they should be. 

I'd feel a lot happier if the doctest used an example where the result is known, and cited a reference to the result. 

Consider for example the approach I took to testing some finite difference software I wrote for computing the impedance of electrical transmission lines of arbitrary cross section. 

http://atlc.sourceforge.net/

Although there are a few **examples** demonstrating the answer from strange cross sections, where I have no chance of computing the result analytically

http://atlc.sourceforge.net/examples.html

for the purposes of *testing* 

http://atlc.sourceforge.net/accuracy.html

the tests were based on cases where analytical results were known. The results were checked on a variety of CPUs (AMD, Cray, Intel Itanium, Intel x86, PA-RISC, PPC, Sun SPARC etc) on a variety of operating systems (AIX, Irix, HP-UX, OS X, Solaris, tru64, Unicos, Unixware, plus various Linux distributions)

> > Also, if the algorithm, or its implementation in Sage is has poor numerical stability, this should be documented.

> 
> As far as I've seen, it's not unstable in the sense of dramatically losing accuracy, but the many numerical calculations are sensitive to slight differences in machine-level implementation. This results in slight differences in the final error. I should be able to do some error analysis and see if these deviations are within the bounds of the algorithm.
> 
> > Could this be computed with Mathematica or Wolfram|Alpha to arbitrary precision? Just as thought. If so, that could be documented - we have permission from Wolfram Research to use Wolfram|Alpha for the purpose of comparing results and documenting those compassions.

> 
> Not without complete reimplementation, and I know of no reason why their performance should be better than ours. You can increase the numerical precision of the computation by increasing N (the number of collocation points on the boundary.) I'll can create a couple of comparison tests that can be run on different machines to see if that decreases the numerical deviation.

Well as far as I know Numpy will use machine precision, whereas anything you do in Mathematica can be done to arbitrary precision. There are many things in Sage that can only be done on an FPU, so use of an arbitrary precision floating point maths is not supported. Mathematica does not suffer that limitation. 

Lets say for example a doctest of Sage's factorial function used 50! as an example, and gave the result `30414093201713378043612608166064768844377641568960522000000000000`. If every machine it was tried on, using a variety of CPUs (PPC, SPARC, Intel x86, AMD x86, Intel Itanium processors) gave the same result, it does not prove Sage is correct. That would only demonstrate the reproducibility of Sage's factorial function, which is something very different from a good *test* in my opinion. Performing the same calculation in MATLAB, which can only do the calculation on the floating point processor, would increase confidence in the result. Performing the calculation on Mathematica would show a difference in one of the digits, which would lead one to question what of the two packages is wrong. (I purposely changed one of the digits, introducing a relative error of 3.28 x 10<sup>-52</sup>, which would not be seen on an FPU).

I was reading only recently about when a new Mersenne prime was found. That was found on a x86 chip, but it was also verified by other software on an x86 chip and also by yet more software on a SPARC processor. 

It seems to me that many doctests in Sage, just show reproducibly, and don't actually test the algorithm or the implementation. This appears to be one such *test*. 

PS, the "author" field needs to be filled in.

Dave



---

archive/issue_comments_106077.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nDave you're absolutely right. This is a numerical algorithm including Simpson's method and Nystrom method integration etc. so even if the numerics are done to arbitrary precision, it will still be numeric and will verify only itself. There are, however, a few cases where the analytic Riemann Map is computable, and I intend to add a clearly labeled test case for that. Note also that the last two doctests are signficant failures, the numpy upgrade seems to have changed the way it handles obscure complex types.\n\nI will be travelling for a few days, but I should have a patch up that improves the doctests and fixes that error by Thursday or Friday.\n\nEthan",
    "created_at": "2011-03-12T12:38:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106077",
    "user": "https://github.com/sagetrac-evanandel"
}
```

<div id="comment:26" align="right">Comment 26</div>

Dave you're absolutely right. This is a numerical algorithm including Simpson's method and Nystrom method integration etc. so even if the numerics are done to arbitrary precision, it will still be numeric and will verify only itself. There are, however, a few cases where the analytic Riemann Map is computable, and I intend to add a clearly labeled test case for that. Note also that the last two doctests are signficant failures, the numpy upgrade seems to have changed the way it handles obscure complex types.

I will be travelling for a few days, but I should have a patch up that improves the doctests and fixes that error by Thursday or Friday.

Ethan



---

archive/issue_comments_106078.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nOK, I have tried a more minimal change and get basically the same result on the riemann.pyx doctest. The interpolator.pyx doctest is fine.\n\nI will leave Ethan work his magic before commenting again.",
    "created_at": "2011-03-14T01:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106078",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:27" align="right">Comment 27</div>

OK, I have tried a more minimal change and get basically the same result on the riemann.pyx doctest. The interpolator.pyx doctest is fine.

I will leave Ethan work his magic before commenting again.



---

archive/issue_comments_106079.json:
```json
{
    "body": "Work Issues: **doctest changes for patch, verify a couple analytic cases**",
    "created_at": "2011-03-16T13:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106079",
    "user": "https://github.com/kcrisman"
}
```

Work Issues: **doctest changes for patch, verify a couple analytic cases**



---

archive/issue_comments_106080.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nEthan, I think you are too hard on yourself with saying 'the last two doctests are significant failures', as the previous ones did not end in `j`, but in `e-xyj`.  In both cases that means the change in values are just as small as for the other ones.\n\n```\nsage:             sage: m.riemann_map(0.4)  # long time\n(0.73324267718245451+3.5076771459132302e-06j)\nsage:             sage: import numpy as np  # long time\nsage:             sage: m.riemann_map(np.complex(-3, 0.0001))  # long time\n(1.4057571354958995e-05+1.051061653044145e-09j)\n```\nIs there any way to check for that pattern in a doctest?  It would be convenient to guard against what Ethan thought was happening.\n\nUpdating the work issues.  We still need\n* doctest change for Jason's patch\n* some type of confirmation of one or two analytic examples of this\n\nThough in my opinion, this second one could be moved to #10821, since the problem was there before.\n\nAlso, seeing this made me look through riemann.pyx, and it turns out that file could use some general TLC. Esp. with regard to a few doc things and some fairly massive redundancy with complex plots. See #10945.",
    "created_at": "2011-03-16T13:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106080",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:28" align="right">Comment 28</div>

Ethan, I think you are too hard on yourself with saying 'the last two doctests are significant failures', as the previous ones did not end in `j`, but in `e-xyj`.  In both cases that means the change in values are just as small as for the other ones.

```
sage:             sage: m.riemann_map(0.4)  # long time
(0.73324267718245451+3.5076771459132302e-06j)
sage:             sage: import numpy as np  # long time
sage:             sage: m.riemann_map(np.complex(-3, 0.0001))  # long time
(1.4057571354958995e-05+1.051061653044145e-09j)
```
Is there any way to check for that pattern in a doctest?  It would be convenient to guard against what Ethan thought was happening.

Updating the work issues.  We still need
* doctest change for Jason's patch
* some type of confirmation of one or two analytic examples of this

Though in my opinion, this second one could be moved to #10821, since the problem was there before.

Also, seeing this made me look through riemann.pyx, and it turns out that file could use some general TLC. Esp. with regard to a few doc things and some fairly massive redundancy with complex plots. See #10945.



---

archive/issue_comments_106081.json:
```json
{
    "body": "Author: **Jason Grout**",
    "created_at": "2011-03-16T13:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106081",
    "user": "https://github.com/kcrisman"
}
```

Author: **Jason Grout**



---

archive/issue_events_130161.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-16T13:30:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130161"
}
```



---

archive/issue_events_130162.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-16T13:30:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130162"
}
```



---

archive/issue_comments_106082.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nJason's patch is correct.  Positive review on that part.\n\nHere's another thought.\n\n```\n        self.cps = np.zeros([self.B, N], dtype=np.complex128)\n        # Find the points on the boundaries and their derivatives.\n        for k in xrange(self.B):\n            for i in xrange(N):\n                self.cps[k, i] = np.complex(fs[k](self.tk[i]))\n```\nSo when the original code does\n\n```\n        temp = np.zeros([self.B, 1])\n        for k in xrange(self.B):\n            temp[k, 0] = self.cps[k, 0]\n```\nthen I would say the problem is in taking np.zeros and assigning complex numbers to that temp array, which is defined to be real a priori.  Maybe that is the change in how Numpy did things - it now complains?   \n\nMy point being that if we change \n\n```\n-        temp = np.zeros([self.B, 1])\n+        temp = np.zeros([self.B, 1],dtype=np.complex128)\n```\nand that also removes the errors, and we get the same doctest changes, then we can be sure that the problem is simply that this is a really hard numerical thing to get right, and Ethan should be commended for even getting within epsilon.",
    "created_at": "2011-03-16T13:54:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106082",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:29" align="right">Comment 29</div>

Jason's patch is correct.  Positive review on that part.

Here's another thought.

```
        self.cps = np.zeros([self.B, N], dtype=np.complex128)
        # Find the points on the boundaries and their derivatives.
        for k in xrange(self.B):
            for i in xrange(N):
                self.cps[k, i] = np.complex(fs[k](self.tk[i]))
```
So when the original code does

```
        temp = np.zeros([self.B, 1])
        for k in xrange(self.B):
            temp[k, 0] = self.cps[k, 0]
```
then I would say the problem is in taking np.zeros and assigning complex numbers to that temp array, which is defined to be real a priori.  Maybe that is the change in how Numpy did things - it now complains?   

My point being that if we change 

```
-        temp = np.zeros([self.B, 1])
+        temp = np.zeros([self.B, 1],dtype=np.complex128)
```
and that also removes the errors, and we get the same doctest changes, then we can be sure that the problem is simply that this is a really hard numerical thing to get right, and Ethan should be commended for even getting within epsilon.



---

archive/issue_comments_106083.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nHoo boy, testing it out definitely shows some serious numerical instability even for many more plot points.  Notice this is before the numpy upgrade or the patch.\n\n```\nsage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0, N=2000)\nsage: m.riemann_map(.45)\n(0.8585664030690745+7.4218379456630256e-07j)\nsage: m.riemann_map(.46)\n(0.88541813465210162+3.4358512148266537e-07j)\nsage: m.riemann_map(.47)\n(0.91294518302491301-2.6212328466317408e-06j)\nsage: m.riemann_map(.48)\n(0.94117262428806991-3.5456252284863065e-05j)\nsage: m.riemann_map(.49)\n(0.96930329181581476-0.00016029304727194931j)\nsage: m.riemann_map(.491)\n(0.97166253445139428-5.3770138915852049e-05j)\nsage: m.riemann_map(.492)\n(0.97361488824863462+0.00018530315147004251j)\nsage: m.riemann_map(.493)\n(0.97486154873554642+0.00065056144560648023j)\nsage: m.riemann_map(.494)\n(0.97491963265632509+0.0014788861938800405j)\nsage: m.riemann_map(.495)\n(0.97313345395283191+0.0028473636237802834j)\nsage: m.riemann_map(.496)\n(0.96917007545329004+0.0049319541164373499j)\nsage: m.riemann_map(.497)\n(0.96580931231079858+0.0077812018516007905j)\nsage: m.riemann_map(.498)\n(0.98261586147447211+0.011068697234118194j)\nsage: m.riemann_map(.499)\n(1.1489715720875546+0.013786517516344927j)\n```\nThere is nothing wrong with what the values are doing, though, and that's the important part.  Taking a hint from the doc:\n\n```\nsage: \"error =\", m.inverse_riemann_map(m.riemann_map(.49)) - .49\n('error =', (-0.00032080499713899036-5.4888563828232042e-05j))\nsage: \"error =\", m.inverse_riemann_map(m.riemann_map(.495)) - .495\n('error =', (-0.0040172648041303383+0.00096565040731113271j))\nsage: \"error =\", m.inverse_riemann_map(m.riemann_map(.499)) - .499\n('error =', (-0.95337317730092064-0.0038944237237982667j))\n```\nAnd honestly, the documentation is clear that near boundaries there are problems.\n\nIt is clear to me that at least for simple examples this performs as advertised, so I don't think Ethan needs to justify the error; it's just a very unstable thing, which probably can be improved by using something more sophisticated than trapezoid or Simpson (maybe?) - but that's not this ticket.  I love the plots; I tried to do this with Grapher when I taught complex analysis in some random naive ways, and it never worked very well.  This is a great addition.  \n\nSo, as far as I'm concerned, positive review once someone actually uploads a patch that corrects the doctests.  I recommend that the analytic examples go on #10945, unless Ethan has the time to add them here.  The Numpy upgrade should go in sooner rather than later.",
    "created_at": "2011-03-16T14:17:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106083",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:30" align="right">Comment 30</div>

Hoo boy, testing it out definitely shows some serious numerical instability even for many more plot points.  Notice this is before the numpy upgrade or the patch.

```
sage: m = Riemann_Map([lambda t: e^(I*t) - 0.5*e^(-I*t)], [lambda t: I*e^(I*t) + 0.5*I*e^(-I*t)], 0, N=2000)
sage: m.riemann_map(.45)
(0.8585664030690745+7.4218379456630256e-07j)
sage: m.riemann_map(.46)
(0.88541813465210162+3.4358512148266537e-07j)
sage: m.riemann_map(.47)
(0.91294518302491301-2.6212328466317408e-06j)
sage: m.riemann_map(.48)
(0.94117262428806991-3.5456252284863065e-05j)
sage: m.riemann_map(.49)
(0.96930329181581476-0.00016029304727194931j)
sage: m.riemann_map(.491)
(0.97166253445139428-5.3770138915852049e-05j)
sage: m.riemann_map(.492)
(0.97361488824863462+0.00018530315147004251j)
sage: m.riemann_map(.493)
(0.97486154873554642+0.00065056144560648023j)
sage: m.riemann_map(.494)
(0.97491963265632509+0.0014788861938800405j)
sage: m.riemann_map(.495)
(0.97313345395283191+0.0028473636237802834j)
sage: m.riemann_map(.496)
(0.96917007545329004+0.0049319541164373499j)
sage: m.riemann_map(.497)
(0.96580931231079858+0.0077812018516007905j)
sage: m.riemann_map(.498)
(0.98261586147447211+0.011068697234118194j)
sage: m.riemann_map(.499)
(1.1489715720875546+0.013786517516344927j)
```
There is nothing wrong with what the values are doing, though, and that's the important part.  Taking a hint from the doc:

```
sage: "error =", m.inverse_riemann_map(m.riemann_map(.49)) - .49
('error =', (-0.00032080499713899036-5.4888563828232042e-05j))
sage: "error =", m.inverse_riemann_map(m.riemann_map(.495)) - .495
('error =', (-0.0040172648041303383+0.00096565040731113271j))
sage: "error =", m.inverse_riemann_map(m.riemann_map(.499)) - .499
('error =', (-0.95337317730092064-0.0038944237237982667j))
```
And honestly, the documentation is clear that near boundaries there are problems.

It is clear to me that at least for simple examples this performs as advertised, so I don't think Ethan needs to justify the error; it's just a very unstable thing, which probably can be improved by using something more sophisticated than trapezoid or Simpson (maybe?) - but that's not this ticket.  I love the plots; I tried to do this with Grapher when I taught complex analysis in some random naive ways, and it never worked very well.  This is a great addition.  

So, as far as I'm concerned, positive review once someone actually uploads a patch that corrects the doctests.  I recommend that the analytic examples go on #10945, unless Ethan has the time to add them here.  The Numpy upgrade should go in sooner rather than later.



---

archive/issue_comments_106084.json:
```json
{
    "body": "Changed work issues from **doctest changes for patch, verify a couple analytic cases** to **doctest changes for patch**",
    "created_at": "2011-03-16T14:17:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106084",
    "user": "https://github.com/kcrisman"
}
```

Changed work issues from **doctest changes for patch, verify a couple analytic cases** to **doctest changes for patch**



---

archive/issue_comments_106085.json:
```json
{
    "body": "Attachment: **[trac_10792-fix_riemann_doctest.patch.gz](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)**\n\nfix the doctests in calculus/riemann.pyx",
    "created_at": "2011-03-16T22:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106085",
    "user": "https://github.com/kiwifb"
}
```

Attachment: **[trac_10792-fix_riemann_doctest.patch.gz](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)**

fix the doctests in calculus/riemann.pyx



---

archive/issue_comments_106086.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nOK I attached a patch to adjust the riemann.pyx doctests. Since some of these tests are very sensitive I reduced the precision to which the results are tested. I also preserved any \"e-xx\" in the results so we know they are meant to be small values close to zero. \n\nIf they move again it should be easier to figure if we just have changed the value of the small number that in a perfect world would go to zero.\n\nFor integration I like to use quadratures personally. We could get them from gsl. It would depends of the number of sample points. Of course for any methods you choose you can find pitfalls with a given function.",
    "created_at": "2011-03-16T22:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106086",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">Comment 31</div>

OK I attached a patch to adjust the riemann.pyx doctests. Since some of these tests are very sensitive I reduced the precision to which the results are tested. I also preserved any "e-xx" in the results so we know they are meant to be small values close to zero. 

If they move again it should be easier to figure if we just have changed the value of the small number that in a perfect world would go to zero.

For integration I like to use quadratures personally. We could get them from gsl. It would depends of the number of sample points. Of course for any methods you choose you can find pitfalls with a given function.



---

archive/issue_comments_106087.json:
```json
{
    "body": "Changed author from **Jason Grout** to **Fran\u00e7ois Bissey, Jason Grout**",
    "created_at": "2011-03-16T22:30:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106087",
    "user": "https://github.com/kiwifb"
}
```

Changed author from **Jason Grout** to **François Bissey, Jason Grout**



---

archive/issue_events_130163.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-16T23:20:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130163"
}
```



---

archive/issue_events_130164.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-16T23:20:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130164"
}
```



---

archive/issue_comments_106088.json:
```json
{
    "body": "Changed reviewer from **David Kirkby** to **David Kirkby, Karl-DIeter Crisman, Ethan Van Andel**",
    "created_at": "2011-03-16T23:20:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106088",
    "user": "https://github.com/kcrisman"
}
```

Changed reviewer from **David Kirkby** to **David Kirkby, Karl-DIeter Crisman, Ethan Van Andel**



---

archive/issue_comments_106089.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n SPKG: http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg\n \n-Apply: [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)\n+Apply: [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz) and [attachment: trac_10792-fix_riemann_doctest.patch](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)\n``````\n",
    "created_at": "2011-03-16T23:20:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106089",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 SPKG: http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg
 
-Apply: [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)
+Apply: [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz) and [attachment: trac_10792-fix_riemann_doctest.patch](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)
``````




---

archive/issue_comments_106090.json:
```json
{
    "body": "Changed work issues from **doctest changes for patch** to none",
    "created_at": "2011-03-17T00:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106090",
    "user": "https://github.com/kcrisman"
}
```

Changed work issues from **doctest changes for patch** to none



---

archive/issue_comments_106091.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nThis fixes it for me, and in general this is good teamwork.  I'm running long doctests now, but don't anticipate trouble, given that so many others have tested this already except for this patch which clearly affects only one file.  \n\nTomorrow I will try to test this on a PPC machine, which could conceivably lead to some noise issues or weirdness, but I know Francois has access to such a machine as well and probably wouldn't have suggested upgrading if that was a problem, so for now it's 'positive review'.",
    "created_at": "2011-03-17T00:11:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106091",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:34" align="right">Comment 34</div>

This fixes it for me, and in general this is good teamwork.  I'm running long doctests now, but don't anticipate trouble, given that so many others have tested this already except for this patch which clearly affects only one file.  

Tomorrow I will try to test this on a PPC machine, which could conceivably lead to some noise issues or weirdness, but I know Francois has access to such a machine as well and probably wouldn't have suggested upgrading if that was a problem, so for now it's 'positive review'.



---

archive/issue_events_130165.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-17T00:11:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130165"
}
```



---

archive/issue_events_130166.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-17T00:11:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130166"
}
```



---

archive/issue_comments_106092.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nReplying to [@kcrisman](#comment%3A34):\n> Tomorrow I will try to test this on a PPC machine, which could conceivably lead to some noise issues or weirdness, but I know Francois has access to such a machine as well and probably wouldn't have suggested upgrading if that was a problem, so for now it's 'positive review'.\n\nI don't have my iMac G4 anymore. It is the property of Massey University and I had to leave it behind when I left for the university of Canterbury in December. \n\nOn the other hand I have access to IBM power 5 hardware now (running both linux and aix - to be upgraded to power 7 this year). But I haven't managed to get sage running on that yet. The linux side is running suse-9 (SLES) and is a right old mess. I probably shouldn't bother fixing the toolchain before the new gear arrives with fresh software. On the aix side I have to sort out compilers since CC default to XLC and fortran seems to default to GNU (never mind the fact XL fortran is present as well) and it stops at prereq. On the bright side gentoo prefix is \"supported\" on aix - so I may get somewhere that way :)",
    "created_at": "2011-03-17T00:27:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106092",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:35" align="right">Comment 35</div>

Replying to [@kcrisman](#comment%3A34):
> Tomorrow I will try to test this on a PPC machine, which could conceivably lead to some noise issues or weirdness, but I know Francois has access to such a machine as well and probably wouldn't have suggested upgrading if that was a problem, so for now it's 'positive review'.

I don't have my iMac G4 anymore. It is the property of Massey University and I had to leave it behind when I left for the university of Canterbury in December. 

On the other hand I have access to IBM power 5 hardware now (running both linux and aix - to be upgraded to power 7 this year). But I haven't managed to get sage running on that yet. The linux side is running suse-9 (SLES) and is a right old mess. I probably shouldn't bother fixing the toolchain before the new gear arrives with fresh software. On the aix side I have to sort out compilers since CC default to XLC and fortran seems to default to GNU (never mind the fact XL fortran is present as well) and it stops at prereq. On the bright side gentoo prefix is "supported" on aix - so I may get somewhere that way :)



---

archive/issue_comments_106093.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\n> > Tomorrow I will try to test this on a PPC machine, which could conceivably lead to some noise issues or weirdness, but I know Francois has access to such a machine as well and probably wouldn't have suggested upgrading if that was a problem, so for now it's 'positive review'.\n\n> \n> I don't have my iMac G4 anymore. It is the property of Massey University and I had to leave it behind when I left for the university of Canterbury in December. \n\nOkay, that makes my machine more valuable then.  I'll definitely do my best to test this tomorrow, though of course it's extremely slow.  But since the patches specific to these things are now in upstream, I feel confident.\n> On the other hand I have access to IBM power 5 hardware now (running both linux and aix - to be upgraded to power 7 this year). But I haven't managed to get sage running on that yet. The linux side is running suse-9 (SLES) and is a right old mess. I \n\nWow, Dave Kirkby will love you - another AIX machine!",
    "created_at": "2011-03-17T00:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106093",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:36" align="right">Comment 36</div>

> > Tomorrow I will try to test this on a PPC machine, which could conceivably lead to some noise issues or weirdness, but I know Francois has access to such a machine as well and probably wouldn't have suggested upgrading if that was a problem, so for now it's 'positive review'.

> 
> I don't have my iMac G4 anymore. It is the property of Massey University and I had to leave it behind when I left for the university of Canterbury in December. 

Okay, that makes my machine more valuable then.  I'll definitely do my best to test this tomorrow, though of course it's extremely slow.  But since the patches specific to these things are now in upstream, I feel confident.
> On the other hand I have access to IBM power 5 hardware now (running both linux and aix - to be upgraded to power 7 this year). But I haven't managed to get sage running on that yet. The linux side is running suse-9 (SLES) and is a right old mess. I 

Wow, Dave Kirkby will love you - another AIX machine!



---

archive/issue_comments_106094.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nReplying to [@kiwifb](#comment%3A35):\n\n> On the other hand I have access to IBM power 5 hardware now (running both linux and aix - to be upgraded to power 7 this year). But I haven't managed to get sage running on that yet. The linux side is running suse-9 (SLES) and is a right old mess. I probably shouldn't bother fixing the toolchain before the new gear arrives with fresh software. On the aix side I have to sort out compilers since CC default to XLC and fortran seems to default to GNU (never mind the fact XL fortran is present as well) and it stops at prereq. On the bright side gentoo prefix is \"supported\" on aix - so I may get somewhere that way :)\n\nI very much doubt you could build Sage on AIX. #9999 list at least some of the issues. \n\nSince I happened to create the 10,000<sup>th</sup> Sage trac ticket (#10000), I guess I should fix the fact the GSL library fails to install on AIX 5.3. I create a patch, which has been accepted upstream, but never got around to actually creating a new Sage package for GSL. Perhaps I can convince someone to review it if I do - there's an extra test in the configure script, and changes to a file with aix in the name, so is only used on AIX.\n\nDave",
    "created_at": "2011-03-17T01:25:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106094",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:37" align="right">Comment 37</div>

Replying to [@kiwifb](#comment%3A35):

> On the other hand I have access to IBM power 5 hardware now (running both linux and aix - to be upgraded to power 7 this year). But I haven't managed to get sage running on that yet. The linux side is running suse-9 (SLES) and is a right old mess. I probably shouldn't bother fixing the toolchain before the new gear arrives with fresh software. On the aix side I have to sort out compilers since CC default to XLC and fortran seems to default to GNU (never mind the fact XL fortran is present as well) and it stops at prereq. On the bright side gentoo prefix is "supported" on aix - so I may get somewhere that way :)

I very much doubt you could build Sage on AIX. #9999 list at least some of the issues. 

Since I happened to create the 10,000<sup>th</sup> Sage trac ticket (#10000), I guess I should fix the fact the GSL library fails to install on AIX 5.3. I create a patch, which has been accepted upstream, but never got around to actually creating a new Sage package for GSL. Perhaps I can convince someone to review it if I do - there's an extra test in the configure script, and changes to a file with aix in the name, so is only used on AIX.

Dave



---

archive/issue_comments_106095.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nIn any case thanks for the positive review Dave. I expect aix to hurt, I don't know how much of the gentoo tree is aix safe to do a sage-on-gentoo install compared to a vanilla one but that will be interesting.\n\nWhile I am thinking about it, I may completely disappear for a week or 2 without warning any time now. I'll be on \"paternal leave\".",
    "created_at": "2011-03-17T01:39:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106095",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:38" align="right">Comment 38</div>

In any case thanks for the positive review Dave. I expect aix to hurt, I don't know how much of the gentoo tree is aix safe to do a sage-on-gentoo install compared to a vanilla one but that will be interesting.

While I am thinking about it, I may completely disappear for a week or 2 without warning any time now. I'll be on "paternal leave".



---

archive/issue_comments_106096.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\n> While I am thinking about it, I may completely disappear for a week or 2 without warning any time now. I'll be on \"paternal leave\". \n\nHow wonderful!  Another Sage devel is also on that right now, so to speak.   Enjoy the experience; by the time our third came along, the hospital stay actually felt like a vacation :-)",
    "created_at": "2011-03-17T01:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106096",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:39" align="right">Comment 39</div>

> While I am thinking about it, I may completely disappear for a week or 2 without warning any time now. I'll be on "paternal leave". 

How wonderful!  Another Sage devel is also on that right now, so to speak.   Enjoy the experience; by the time our third came along, the hospital stay actually felt like a vacation :-)



---

archive/issue_comments_106097.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nReplying to [@kcrisman](#comment%3A39):\n> > While I am thinking about it, I may completely disappear for a week or 2 without warning any time now. I'll be on \"paternal leave\". \n\n> How wonderful!  Another Sage devel is also on that right now, so to speak.   Enjoy the experience; by the time our third came along, the hospital stay actually felt like a vacation :-)\n\nNumber #2, my wife was counting on the hospital stay to have a break from number #1. Unfortunately because of the earthquake the stay will have to be short (2 maternity units are shot). This is wonderfully off-topic.",
    "created_at": "2011-03-17T02:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106097",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:40" align="right">Comment 40</div>

Replying to [@kcrisman](#comment%3A39):
> > While I am thinking about it, I may completely disappear for a week or 2 without warning any time now. I'll be on "paternal leave". 

> How wonderful!  Another Sage devel is also on that right now, so to speak.   Enjoy the experience; by the time our third came along, the hospital stay actually felt like a vacation :-)

Number #2, my wife was counting on the hospital stay to have a break from number #1. Unfortunately because of the earthquake the stay will have to be short (2 maternity units are shot). This is wonderfully off-topic.



---

archive/issue_comments_106098.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nReplying to [@kiwifb](#comment%3A40):\n> Replying to [@kcrisman](#comment%3A39):\n> > > While I am thinking about it, I may completely disappear for a week or 2 without warning any time now. I'll be on \"paternal leave\". \n\n> > How wonderful!  Another Sage devel is also on that right now, so to speak.   Enjoy the experience; by the time our third came along, the hospital stay actually felt like a vacation :-)\n\n> \n> Number #2, my wife was counting on the hospital stay to have a break from number #1. Unfortunately because of the earthquake the stay will have to be short (2 maternity units are shot). This is wonderfully off-topic.\n\n \n:-)",
    "created_at": "2011-03-17T02:04:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106098",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:41" align="right">Comment 41</div>

Replying to [@kiwifb](#comment%3A40):
> Replying to [@kcrisman](#comment%3A39):
> > > While I am thinking about it, I may completely disappear for a week or 2 without warning any time now. I'll be on "paternal leave". 

> > How wonderful!  Another Sage devel is also on that right now, so to speak.   Enjoy the experience; by the time our third came along, the hospital stay actually felt like a vacation :-)

> 
> Number #2, my wife was counting on the hospital stay to have a break from number #1. Unfortunately because of the earthquake the stay will have to be short (2 maternity units are shot). This is wonderfully off-topic.

 
:-)



---

archive/issue_comments_106099.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nWow, this is the best off-topic side-thread on a ticket I've seen yet!  Congrats!  And I hope things are getting back to normal after the earthquake(s).",
    "created_at": "2011-03-17T02:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106099",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:42" align="right">Comment 42</div>

Wow, this is the best off-topic side-thread on a ticket I've seen yet!  Congrats!  And I hope things are getting back to normal after the earthquake(s).



---

archive/issue_comments_106100.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nWell, after 1172 seconds, long doctests on riemann.pyx pass on my PPC machine.  I'm running most tests of modules where the phrase 'import numpy' occurs as well, but this should remain robust.",
    "created_at": "2011-03-17T15:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106100",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:43" align="right">Comment 43</div>

Well, after 1172 seconds, long doctests on riemann.pyx pass on my PPC machine.  I'm running most tests of modules where the phrase 'import numpy' occurs as well, but this should remain robust.



---

archive/issue_comments_106101.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nEverything passed in calculus/, functions/, matrix/, numerical/, plot/, modules/, and stats/.  That's nearly all of Numpy in Sage (rings/ has some, and a few elsewhere.  PPC is fine.",
    "created_at": "2011-03-17T18:23:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106101",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:44" align="right">Comment 44</div>

Everything passed in calculus/, functions/, matrix/, numerical/, plot/, modules/, and stats/.  That's nearly all of Numpy in Sage (rings/ has some, and a few elsewhere.  PPC is fine.



---

archive/issue_comments_106102.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,6 @@\n \n SPKG: http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg\n \n-Apply: [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz) and [attachment: trac_10792-fix_riemann_doctest.patch](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)\n+Apply:\n+1. [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)\n+2. [attachment: trac_10792-fix_riemann_doctest.patch](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)\n``````\n",
    "created_at": "2011-03-17T19:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106102",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,6 @@
 
 SPKG: http://spkg-upload.googlecode.com/files/numpy-1.5.1.spkg
 
-Apply: [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz) and [attachment: trac_10792-fix_riemann_doctest.patch](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)
+Apply:
+1. [attachment: trac-10792-riemann-complexwarnings.patch](https://github.com/sagemath/sage/files/ticket10792/trac-10792-riemann-complexwarnings.patch.gz)
+2. [attachment: trac_10792-fix_riemann_doctest.patch](https://github.com/sagemath/sage/files/ticket10792/trac_10792-fix_riemann_doctest.patch.gz)
``````




---

archive/issue_comments_106103.json:
```json
{
    "body": "Merged: **sage-4.7.alpha2**",
    "created_at": "2011-03-18T13:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106103",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.alpha2**



---

archive/issue_events_130167.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-18T13:41:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130167"
}
```



---

archive/issue_events_130168.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-18T13:41:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10792#event-130168"
}
```



---

archive/issue_comments_106104.json:
```json
{
    "body": "Changed reviewer from **David Kirkby, Karl-DIeter Crisman, Ethan Van Andel** to **David Kirkby, Karl-Dieter Crisman, Ethan Van Andel**",
    "created_at": "2011-05-03T13:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10792#issuecomment-106104",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **David Kirkby, Karl-DIeter Crisman, Ethan Van Andel** to **David Kirkby, Karl-Dieter Crisman, Ethan Van Andel**
