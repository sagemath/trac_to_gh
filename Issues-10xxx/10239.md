# Issue 10239: Bessel method forces bessel_Y to use pari algorithm

archive/issues_010238.json:
```json
{
    "body": "Assignee: jason, jkantor\n\nKeywords: functions, bessel, pari\n\nWhen computing the Bessel Y-function, the `Bessel` function calls `bessel_Y` with a default argument of `algorithm='pari'`.  However, `bessel_Y` throws an exception when using anything else than scipy or maxima.\n\n\n```\nsage: f = Bessel(0, typ='Y')\nsage: f(1.5)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/Users/Joris/Desktop/sage/build/sage-4.6.alpha2/<ipython console> in <module>()\n\n/Users/Joris/Desktop/sage/build/sage-4.6.alpha2/local/lib/python2.6/site-packages/sage/functions/special.pyc in __call__(self, z)\n   1084             return bessel_K(nu,z,algorithm=s,prec=p)\n   1085         if t == \"Y\":\n-> 1086             return bessel_Y(nu,z,algorithm=s,prec=p)\n   1087         \n   1088     def plot(self,a,b):\n\n/Users/Joris/Desktop/sage/build/sage-4.6.alpha2/local/lib/python2.6/site-packages/sage/functions/special.pyc in bessel_Y(nu, z, algorithm, prec)\n    938         return RR(maxima.eval(\"bessel_y(%s,%s)\"%(float(nu),float(z))))\n    939     else:\n--> 940         raise ValueError, \"unknown algorithm '%s'\"%algorithm\n    941     \n    942 class Bessel():\n\nValueError: unknown algorithm 'pari'\n```\n\nThe following works fine: \n\n```\nsage: f = Bessel(0, typ='Y', algorithm='scipy')\nsage: f(1.5)\n0.382448923798000\nsage: g = Bessel(0, typ='Y', algorithm='maxima')\nsage: g(1.5)\n0.382448923797759\n```\n\nAs a first solution, it would be easy to change the calling convention of `bessel_Y` to ensure that maxima or scipy is used.  However, it seems like pari does a better job at computing the Bessel functions, and therefore it might be better in the long run to extend `bessel_Y` to use pari (if at all possible).\n\nIssue created by migration from https://trac.sagemath.org/ticket/10239\n\n",
    "closed_at": "2010-11-15T23:25:24Z",
    "created_at": "2010-11-08T18:48:14Z",
    "labels": [
        "component: numerical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "Bessel method forces bessel_Y to use pari algorithm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10239",
    "user": "https://github.com/jvkersch"
}
```
Assignee: jason, jkantor

Keywords: functions, bessel, pari

When computing the Bessel Y-function, the `Bessel` function calls `bessel_Y` with a default argument of `algorithm='pari'`.  However, `bessel_Y` throws an exception when using anything else than scipy or maxima.


```
sage: f = Bessel(0, typ='Y')
sage: f(1.5)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/Users/Joris/Desktop/sage/build/sage-4.6.alpha2/<ipython console> in <module>()

/Users/Joris/Desktop/sage/build/sage-4.6.alpha2/local/lib/python2.6/site-packages/sage/functions/special.pyc in __call__(self, z)
   1084             return bessel_K(nu,z,algorithm=s,prec=p)
   1085         if t == "Y":
-> 1086             return bessel_Y(nu,z,algorithm=s,prec=p)
   1087         
   1088     def plot(self,a,b):

/Users/Joris/Desktop/sage/build/sage-4.6.alpha2/local/lib/python2.6/site-packages/sage/functions/special.pyc in bessel_Y(nu, z, algorithm, prec)
    938         return RR(maxima.eval("bessel_y(%s,%s)"%(float(nu),float(z))))
    939     else:
--> 940         raise ValueError, "unknown algorithm '%s'"%algorithm
    941     
    942 class Bessel():

ValueError: unknown algorithm 'pari'
```

The following works fine: 

```
sage: f = Bessel(0, typ='Y', algorithm='scipy')
sage: f(1.5)
0.382448923798000
sage: g = Bessel(0, typ='Y', algorithm='maxima')
sage: g(1.5)
0.382448923797759
```

As a first solution, it would be easy to change the calling convention of `bessel_Y` to ensure that maxima or scipy is used.  However, it seems like pari does a better job at computing the Bessel functions, and therefore it might be better in the long run to extend `bessel_Y` to use pari (if at all possible).

Issue created by migration from https://trac.sagemath.org/ticket/10239





---

archive/issue_events_026302.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-08T21:11:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10239#event-26302"
}
```



---

archive/issue_comments_104185.json:
```json
{
    "body": "The problem is that PARI has no function to compute the Y Bessel function.  It seems that PARI can compute the following Bessel functions:\n\n```\nbesselh1  besselh2  besseli   besselj   besseljh  besselk   besseln\n```\n\nI can make a patch which simply changes the default algorithm to \"maxima\" for `bessel_Y`.",
    "created_at": "2010-11-08T21:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104185",
    "user": "https://github.com/jdemeyer"
}
```

The problem is that PARI has no function to compute the Y Bessel function.  It seems that PARI can compute the following Bessel functions:

```
besselh1  besselh2  besseli   besselj   besseljh  besselk   besseln
```

I can make a patch which simply changes the default algorithm to "maxima" for `bessel_Y`.



---

archive/issue_comments_104186.json:
```json
{
    "body": "Changing component from misc to numerical.",
    "created_at": "2010-11-08T21:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104186",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from misc to numerical.



---

archive/issue_comments_104187.json:
```json
{
    "body": "Changing assignee from @jasongrout to jason, jkantor.",
    "created_at": "2010-11-08T21:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104187",
    "user": "https://github.com/jdemeyer"
}
```

Changing assignee from @jasongrout to jason, jkantor.



---

archive/issue_comments_104188.json:
```json
{
    "body": "Attachment [10239_bessel_Y.patch](tarball://root/attachments/some-uuid/ticket10239/10239_bessel_Y.patch) by @jvkersch created at 2010-11-08 21:42:10\n\nToo bad that there's no pari implementation: for Bessel-J it is just so fast:\n\n```\nsage: timeit(r\"bessel_J(1, 2.3, algorithm='pari')\")\n625 loops, best of 3: 110 \u00b5s per loop\nsage: timeit(r\"bessel_J(1, 2.3, algorithm='scipy')\")\n625 loops, best of 3: 480 \u00b5s per loop\nsage: timeit(r\"bessel_J(1, 2.3, algorithm='maxima')\")\n125 loops, best of 3: 5.27 ms per loop\n```\n\nStill, using the maxima implementation would be good for now, as the docs mention that there are some accuracy issues with scipy.  Also, thanks for your quick response -- it feels like I never left Ghent and we are still talking about Sage in the backyard of the department!",
    "created_at": "2010-11-08T21:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104188",
    "user": "https://github.com/jvkersch"
}
```

Attachment [10239_bessel_Y.patch](tarball://root/attachments/some-uuid/ticket10239/10239_bessel_Y.patch) by @jvkersch created at 2010-11-08 21:42:10

Too bad that there's no pari implementation: for Bessel-J it is just so fast:

```
sage: timeit(r"bessel_J(1, 2.3, algorithm='pari')")
625 loops, best of 3: 110 µs per loop
sage: timeit(r"bessel_J(1, 2.3, algorithm='scipy')")
625 loops, best of 3: 480 µs per loop
sage: timeit(r"bessel_J(1, 2.3, algorithm='maxima')")
125 loops, best of 3: 5.27 ms per loop
```

Still, using the maxima implementation would be good for now, as the docs mention that there are some accuracy issues with scipy.  Also, thanks for your quick response -- it feels like I never left Ghent and we are still talking about Sage in the backyard of the department!



---

archive/issue_comments_104189.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2010-11-09T07:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104189",
    "user": "https://github.com/jvkersch"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_104190.json:
```json
{
    "body": "The patch seems to work well.  The `Bessel` method now behaves as intended, and the patch also addresses some other inconsistencies in the code (checking the precision for the scipy code, and some documentation issues).   \n\nThere is one doctest that fails on my machine (64bit macbook pro, sage 4.6):\n\n```\nsage: Bessel(6, algorithm=\"scipy\")(pi)\nExpected:\n    0.0145459669825000 + 5.34392507678000e-18*I\nGot:\n    0.0145459669825000 + 5.34410157169000e-18*I\n```\n\nThis looks like inevitable round-off error in the complex part.  Can we hit this doctest with the `#random` tag or is there a more subtle way of dealing with this?  IMHO, this is also a bug in scipy: for real input, the Bessel functions of the first and second kind should be exactly real, not up to some small complex drift.  This will cause all sorts of problems with plotting, etc.",
    "created_at": "2010-11-09T07:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104190",
    "user": "https://github.com/jvkersch"
}
```

The patch seems to work well.  The `Bessel` method now behaves as intended, and the patch also addresses some other inconsistencies in the code (checking the precision for the scipy code, and some documentation issues).   

There is one doctest that fails on my machine (64bit macbook pro, sage 4.6):

```
sage: Bessel(6, algorithm="scipy")(pi)
Expected:
    0.0145459669825000 + 5.34392507678000e-18*I
Got:
    0.0145459669825000 + 5.34410157169000e-18*I
```

This looks like inevitable round-off error in the complex part.  Can we hit this doctest with the `#random` tag or is there a more subtle way of dealing with this?  IMHO, this is also a bug in scipy: for real input, the Bessel functions of the first and second kind should be exactly real, not up to some small complex drift.  This will cause all sorts of problems with plotting, etc.



---

archive/issue_comments_104191.json:
```json
{
    "body": "The problem with scipy is the way in which the argument is presented to the Bessel function: when the argument is real, scipy returns a real value for the Bessel function: \n\n```\nsage: import scipy.special\nsage: scipy.special.jv(6, complex(float(pi)))\n(0.014545966982505558+5.3441015716885544e-18j)\nsage: scipy.special.jv(6, float(pi))\n0.014545966982505555\n```\n\nFor now I would suggest adding an ellipsis to the doctest to obscure the complex part (e.g write the output as `0.0145459669825000...`).  I've modified the patch to take this into account.\n\nAs everything else works fine, I would change the status to positive review but I want to hear your opinion about the modification first.",
    "created_at": "2010-11-09T21:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104191",
    "user": "https://github.com/jvkersch"
}
```

The problem with scipy is the way in which the argument is presented to the Bessel function: when the argument is real, scipy returns a real value for the Bessel function: 

```
sage: import scipy.special
sage: scipy.special.jv(6, complex(float(pi)))
(0.014545966982505558+5.3441015716885544e-18j)
sage: scipy.special.jv(6, float(pi))
0.014545966982505555
```

For now I would suggest adding an ellipsis to the doctest to obscure the complex part (e.g write the output as `0.0145459669825000...`).  I've modified the patch to take this into account.

As everything else works fine, I would change the status to positive review but I want to hear your opinion about the modification first.



---

archive/issue_comments_104192.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-09T21:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104192",
    "user": "https://github.com/jvkersch"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_104193.json:
```json
{
    "body": "Attachment [10239_bessel_Y_reviewer.patch](tarball://root/attachments/some-uuid/ticket10239/10239_bessel_Y_reviewer.patch) by @jdemeyer created at 2010-11-11 11:42:25\n\nJoris, I agree with your change.  I'm now testing on a 32-bit system...",
    "created_at": "2010-11-11T11:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104193",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10239_bessel_Y_reviewer.patch](tarball://root/attachments/some-uuid/ticket10239/10239_bessel_Y_reviewer.patch) by @jdemeyer created at 2010-11-11 11:42:25

Joris, I agree with your change.  I'm now testing on a 32-bit system...



---

archive/issue_comments_104194.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-11T17:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104194",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_104195.json:
```json
{
    "body": "Tests successful, positive review as suggested by Joris.",
    "created_at": "2010-11-11T17:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104195",
    "user": "https://github.com/jdemeyer"
}
```

Tests successful, positive review as suggested by Joris.



---

archive/issue_comments_104196.json:
```json
{
    "body": "Sounds good, `make ptestlong` reports no failures here as well.",
    "created_at": "2010-11-11T19:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104196",
    "user": "https://github.com/jvkersch"
}
```

Sounds good, `make ptestlong` reports no failures here as well.



---

archive/issue_comments_104197.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-11-15T23:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10239#issuecomment-104197",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_026303.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-15T23:25:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10239",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10239#event-26303"
}
```
