# Issue 10562: class ECPP added to sage: provides primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP)

archive/issues_010509.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "Class ECPP (file ecpp.pyx) added to devel/sage/sage/rings\nFile provides new functionality: primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP=Elliptic Curves Primality Proving)\n\n\nCC:  @nexttime\n\nKeywords: **ecpp, goldwasser, kilian, primality, proving**\n\nComponent: **number theory**\n\nAuthor: **Georg Hahn**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10562_\n\n",
    "closed_at": "2011-04-03T11:21:21Z",
    "created_at": "2011-01-05T19:16:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "class ECPP added to sage: provides primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP)",
    "type": "issue",
    "updated_at": "2011-06-18T19:32:37Z",
    "url": "https://github.com/sagemath/sage/issues/10562",
    "user": "ghahn@cantab.net"
}
```
Class ECPP (file ecpp.pyx) added to devel/sage/sage/rings
File provides new functionality: primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP=Elliptic Curves Primality Proving)


CC:  @nexttime

Keywords: **ecpp, goldwasser, kilian, primality, proving**

Component: **number theory**

Author: **Georg Hahn**

_Issue created by migration from https://trac.sagemath.org/ticket/10562_





---

archive/issue_events_139060.json:
```json
{
    "actor": null,
    "created_at": "2011-01-05T19:16:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139060"
}
```



---

archive/issue_events_139061.json:
```json
{
    "actor": null,
    "created_at": "2011-01-05T19:16:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139061"
}
```



---

archive/issue_events_139062.json:
```json
{
    "actor": null,
    "created_at": "2011-01-05T19:16:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139062"
}
```



---

archive/issue_events_139063.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-01-05T19:16:25Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "subject": null,
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139063"
}
```



---

archive/issue_comments_100712.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[ecpp.py.gz](https://github.com/sagemath/sage/files/ticket10562/ecpp.py.gz)**",
    "created_at": "2011-01-05T19:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100712",
    "user": "ghahn@cantab.net"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[ecpp.py.gz](https://github.com/sagemath/sage/files/ticket10562/ecpp.py.gz)**



---

archive/issue_comments_100713.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-File ecpp.pyx added to devel/sage/sage/functions\n+File ecpp.py added to devel/sage/sage/functions\n File provides new functionality: primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP=Elliptic Curves Primality Proving)\n \n``````\n",
    "created_at": "2011-01-05T19:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100713",
    "user": "ghahn@cantab.net"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-File ecpp.pyx added to devel/sage/sage/functions
+File ecpp.py added to devel/sage/sage/functions
 File provides new functionality: primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP=Elliptic Curves Primality Proving)
 
``````




---

archive/issue_events_139064.json:
```json
{
    "actor": null,
    "created_at": "2011-01-05T19:54:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "title_is": "File ecpp.py added to sage: provides primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP)",
    "title_was": "File ecpp.pyx added to sage: provides primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139064"
}
```



---

archive/issue_events_139065.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-01-06T01:20:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139065"
}
```



---

archive/issue_comments_100714.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks. To add a file do \"hg add\" and then your patch can contain all the code. Here's a couple of comments I have: \n\n* I'm not sure that sage/functions is the best place for this. Probably sage/rings (or perhaps there should be a subdirectory of that for number-theoretic functions). sage/functions is for symbolic stuff. \n\n* It probably doesn't make sense to import everything into the global namespace--you probably should only import a couple of functions. Some (e.g. verify_certificate) only have meaning in this specific context. Also, for others (e.g. squarefree) it would make more sense (and would be faster) to use the already available Integer.is_squarefree() function.",
    "created_at": "2011-01-06T01:20:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100714",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks. To add a file do "hg add" and then your patch can contain all the code. Here's a couple of comments I have: 

* I'm not sure that sage/functions is the best place for this. Probably sage/rings (or perhaps there should be a subdirectory of that for number-theoretic functions). sage/functions is for symbolic stuff. 

* It probably doesn't make sense to import everything into the global namespace--you probably should only import a couple of functions. Some (e.g. verify_certificate) only have meaning in this specific context. Also, for others (e.g. squarefree) it would make more sense (and would be faster) to use the already available Integer.is_squarefree() function.



---

archive/issue_comments_100715.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThanks for all remarks!\n\nThe file is now added to sage as .pyx file in the directory devel/sage/sage/rings.\nThe file SAGE_ROOT/devel/sage/module_list.py is updated by the patch.\n\nThe new patch \"trac_10562_ecpp.patch\" now contains all the code (changes in \"sage/rings/all.py\", \"sage/module_list.py\" and the new file \"sage/rings/ecpp.pyx\" itself)\n\n[remark: in case I don't import all functions to the global namespace, the error check \".\\sage -t <path to file>\" says that all those functions which I haven't imported don't pass the error check any more !?]",
    "created_at": "2011-01-11T00:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100715",
    "user": "ghahn@cantab.net"
}
```

<div id="comment:4" align="right">comment:4</div>

Thanks for all remarks!

The file is now added to sage as .pyx file in the directory devel/sage/sage/rings.
The file SAGE_ROOT/devel/sage/module_list.py is updated by the patch.

The new patch "trac_10562_ecpp.patch" now contains all the code (changes in "sage/rings/all.py", "sage/module_list.py" and the new file "sage/rings/ecpp.pyx" itself)

[remark: in case I don't import all functions to the global namespace, the error check ".\sage -t <path to file>" says that all those functions which I haven't imported don't pass the error check any more !?]



---

archive/issue_events_139066.json:
```json
{
    "actor": null,
    "created_at": "2011-01-11T00:32:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139066"
}
```



---

archive/issue_events_139067.json:
```json
{
    "actor": null,
    "created_at": "2011-01-11T00:32:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139067"
}
```



---

archive/issue_comments_100716.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-File ecpp.py added to devel/sage/sage/functions\n+File ecpp.pyx added to devel/sage/sage/rings\n File provides new functionality: primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP=Elliptic Curves Primality Proving)\n \n``````\n",
    "created_at": "2011-01-11T00:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100716",
    "user": "ghahn@cantab.net"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-File ecpp.py added to devel/sage/sage/functions
+File ecpp.pyx added to devel/sage/sage/rings
 File provides new functionality: primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP=Elliptic Curves Primality Proving)
 
``````




---

archive/issue_comments_100717.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [ghahn@\u2026](#comment:4):\n> Thanks for all remarks!\n> \n> The file is now added to sage as .pyx file in the directory devel/sage/sage/rings.\n> The file SAGE_ROOT/devel/sage/module_list.py is updated by the patch.\n> \n> The new patch \"trac_10562_ecpp.patch\" now contains all the code (changes in \"sage/rings/all.py\", \"sage/module_list.py\" and the new file \"sage/rings/ecpp.pyx\" itself)\n\nIt doesn't look like you're using anything specific to Cython, any reason why this isn't a simple .py file? \n\n> [remark: in case I don't import all functions to the global namespace, the error check \".\\sage -t <path to file>\" says that all those functions which I haven't imported don't pass the error check any more !?]\n\nYou don't want to do a \"from ecpp import *\" as that will put every name in your module into the global namespace--if everyone did this there would be a very cluttered namespace not to mention thousands of collisions. For testing anything but the top-level functions, you should have an explicit \"from sage.rings.ecpp import X\" in your doctest before using it. \n\nIn terms of code organization, I think it would be better if a certificate was a Python class with a verify method (that returned True or False), and perhaps a nice `__repr__` method as well.",
    "created_at": "2011-01-11T00:50:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100717",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [ghahn@…](#comment:4):
> Thanks for all remarks!
> 
> The file is now added to sage as .pyx file in the directory devel/sage/sage/rings.
> The file SAGE_ROOT/devel/sage/module_list.py is updated by the patch.
> 
> The new patch "trac_10562_ecpp.patch" now contains all the code (changes in "sage/rings/all.py", "sage/module_list.py" and the new file "sage/rings/ecpp.pyx" itself)

It doesn't look like you're using anything specific to Cython, any reason why this isn't a simple .py file? 

> [remark: in case I don't import all functions to the global namespace, the error check ".\sage -t <path to file>" says that all those functions which I haven't imported don't pass the error check any more !?]

You don't want to do a "from ecpp import *" as that will put every name in your module into the global namespace--if everyone did this there would be a very cluttered namespace not to mention thousands of collisions. For testing anything but the top-level functions, you should have an explicit "from sage.rings.ecpp import X" in your doctest before using it. 

In terms of code organization, I think it would be better if a certificate was a Python class with a verify method (that returned True or False), and perhaps a nice `__repr__` method as well.



---

archive/issue_comments_100718.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHi!\n\n* thanks for your help on \"from ... import\": it makes sense only to import top-level functions. I'll change that.\n\n* concerning Cython: computing primality proofs can take a long time for large numbers, so I used to load my file \"ecpp.py\" (the same as appended to this ticket) as .pyx file (command load \"ecpp.pyx\") to make sage compile it (loading it as .py or .pyx made a huge difference in speed on my computer). Therefore, it made sense to me to include it into sage as .pyx as well.\nIt's no problem to add ecpp as devel/sage/sage/rings/ecpp.py again, but won't it be much slower afterwards?\n\n* I could rewrite it as Python class, but normally I'd prefer to use basic data structures and a normal list is enough to store a certificate. I'll prepare a class for ecpp... Is it possible to include the class in a Cython file (and thus to make it run fast again)?",
    "created_at": "2011-01-11T16:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100718",
    "user": "ghahn@cantab.net"
}
```

<div id="comment:6" align="right">comment:6</div>

Hi!

* thanks for your help on "from ... import": it makes sense only to import top-level functions. I'll change that.

* concerning Cython: computing primality proofs can take a long time for large numbers, so I used to load my file "ecpp.py" (the same as appended to this ticket) as .pyx file (command load "ecpp.pyx") to make sage compile it (loading it as .py or .pyx made a huge difference in speed on my computer). Therefore, it made sense to me to include it into sage as .pyx as well.
It's no problem to add ecpp as devel/sage/sage/rings/ecpp.py again, but won't it be much slower afterwards?

* I could rewrite it as Python class, but normally I'd prefer to use basic data structures and a normal list is enough to store a certificate. I'll prepare a class for ecpp... Is it possible to include the class in a Cython file (and thus to make it run fast again)?



---

archive/issue_comments_100719.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [ghahn@\u2026](#comment:6):\n> Hi!\n> \n> * thanks for your help on \"from ... import\": it makes sense only to import top-level \n\nfunctions. I'll change that.\n\nThanks. \n\n> * concerning Cython: computing primality proofs can take a long time for large numbers, so I used to load my file \"ecpp.py\" (the same as appended to this ticket) as .pyx file (command load \"ecpp.pyx\") to make sage compile it (loading it as .py or .pyx made a huge difference in speed on my computer). Therefore, it made sense to me to include it into sage as .pyx as well.\n> It's no problem to add ecpp as devel/sage/sage/rings/ecpp.py again, but won't it be much slower afterwards?\n\nI am (very pleasantly) surprised that Cython was able to make your code significantly faster with no work on your part. In that case, .pyx is fine. \n\n> * I could rewrite it as Python class, but normally I'd prefer to use basic data structures and a normal list is enough to store a certificate. \n\nIn general, classes are preferred in Sage, as a list is rather meaningless without context. For example, [1,0,1,0,35] could be an elliptic curve, polynomial, point counts, or whatever. It also is a good place to put a method for verification (as verify_certificate is more likely to invoke recollections of ssl than primality proving).\n\nAlso, it'd probably be more Pythonic to return None or raise an exception if the number is not prime. \n\n> I'll prepare a class for ecpp... Is it possible to include the class in a Cython file (and thus to make it run fast again)?\n\nYes, classes work just fine in Cython. \n\n- Robert",
    "created_at": "2011-01-11T21:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100719",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [ghahn@…](#comment:6):
> Hi!
> 
> * thanks for your help on "from ... import": it makes sense only to import top-level 

functions. I'll change that.

Thanks. 

> * concerning Cython: computing primality proofs can take a long time for large numbers, so I used to load my file "ecpp.py" (the same as appended to this ticket) as .pyx file (command load "ecpp.pyx") to make sage compile it (loading it as .py or .pyx made a huge difference in speed on my computer). Therefore, it made sense to me to include it into sage as .pyx as well.
> It's no problem to add ecpp as devel/sage/sage/rings/ecpp.py again, but won't it be much slower afterwards?

I am (very pleasantly) surprised that Cython was able to make your code significantly faster with no work on your part. In that case, .pyx is fine. 

> * I could rewrite it as Python class, but normally I'd prefer to use basic data structures and a normal list is enough to store a certificate. 

In general, classes are preferred in Sage, as a list is rather meaningless without context. For example, [1,0,1,0,35] could be an elliptic curve, polynomial, point counts, or whatever. It also is a good place to put a method for verification (as verify_certificate is more likely to invoke recollections of ssl than primality proving).

Also, it'd probably be more Pythonic to return None or raise an exception if the number is not prime. 

> I'll prepare a class for ecpp... Is it possible to include the class in a Cython file (and thus to make it run fast again)?

Yes, classes work just fine in Cython. 

- Robert



---

archive/issue_events_139068.json:
```json
{
    "actor": null,
    "created_at": "2011-01-12T19:59:09Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "title_is": "class ECPP added to sage: provides primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP)",
    "title_was": "File ecpp.py added to sage: provides primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139068"
}
```



---

archive/issue_comments_100720.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-File ecpp.pyx added to devel/sage/sage/rings\n+Class ECPP (file ecpp.pyx) added to devel/sage/sage/rings\n File provides new functionality: primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP=Elliptic Curves Primality Proving)\n \n``````\n",
    "created_at": "2011-01-12T19:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100720",
    "user": "ghahn@cantab.net"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-File ecpp.pyx added to devel/sage/sage/rings
+Class ECPP (file ecpp.pyx) added to devel/sage/sage/rings
 File provides new functionality: primality proving via Goldwasser-Kilian and Atkin-Morain (ECPP=Elliptic Curves Primality Proving)
 
``````




---

archive/issue_comments_100721.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAttachment: **[trac_10562_ecpp.patch.gz](https://github.com/sagemath/sage/files/ticket10562/trac_10562_ecpp.patch.gz)**\n\nHi,\n\necpp.pyx has now been changed into a class ECPP() which stores a certificate and provides primality proving by one of the following commands:\nECPP(<number>) [constructor], ECPP().goldwasser_kilian(<number>), ECPP().atkin_morain(<number>) and ECPP().ecpp(<number>).\n\nFor composite numbers, a StandardError is raised (and a RuntimeError in case the primality proof fails during the \"downrun\").\n\nCertificates can be verified as follows:\ne = ECPP(<number>)\ne.verify_certificate()\n\nThe file is added to sage/rings as .pyx again. It contains a latex() and repr() function. Reviews are appreciated!",
    "created_at": "2011-01-12T19:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100721",
    "user": "ghahn@cantab.net"
}
```

<div id="comment:8" align="right">comment:8</div>

Attachment: **[trac_10562_ecpp.patch.gz](https://github.com/sagemath/sage/files/ticket10562/trac_10562_ecpp.patch.gz)**

Hi,

ecpp.pyx has now been changed into a class ECPP() which stores a certificate and provides primality proving by one of the following commands:
ECPP(<number>) [constructor], ECPP().goldwasser_kilian(<number>), ECPP().atkin_morain(<number>) and ECPP().ecpp(<number>).

For composite numbers, a StandardError is raised (and a RuntimeError in case the primality proof fails during the "downrun").

Certificates can be verified as follows:
e = ECPP(<number>)
e.verify_certificate()

The file is added to sage/rings as .pyx again. It contains a latex() and repr() function. Reviews are appreciated!



---

archive/issue_comments_100722.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHi,\n\nI have been implementing an ECPP certificate verification sage script in the latest days as well. I am pleased to see that such a procedure is being incorporated in Sage.\n\nDuring my work I noticed an issue that seems to be still present in the current code base. (I have been using an older sage install...) When creating an elliptic curve over Z_N using the Elliptic Curve constructor, the primality of N is proven through calls to the is_prime function. Several such calls are performed in the `EllipticCurve` constructor, the `EllipticCurve_generic` constructor...\n\nIn Sage, it doesn't seem possible for the time being to build an `EllipticCurve` object without proving/disproving the primality of the characteristic of the underlying Ring. This slows down the ECPP certificate verification, and makes it pointless since another proven method is used behind the scenes on the integer we want to prove the primality of.\n\nIs this an issue for your code? When profiling your (verification) code, does the computation spend a significant amount of its running time in method 'is_prime' of 'sage.rings.integer.Integer'. (profile with %prun e.verify_certificate())\n\nAs a side comment, the is_prime method of the Integer class is probably also a good place to call your code from.\n\nI apologize for not being able to perform more in depth tests before reporting this potential issue (I am not able to set up a sage development environment at short notice).\n\nBest wishes,\n\nJean-Ren\u00e9",
    "created_at": "2011-01-13T16:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100722",
    "user": "https://github.com/sagetrac-jrreinhard"
}
```

<div id="comment:9" align="right">comment:9</div>

Hi,

I have been implementing an ECPP certificate verification sage script in the latest days as well. I am pleased to see that such a procedure is being incorporated in Sage.

During my work I noticed an issue that seems to be still present in the current code base. (I have been using an older sage install...) When creating an elliptic curve over Z_N using the Elliptic Curve constructor, the primality of N is proven through calls to the is_prime function. Several such calls are performed in the `EllipticCurve` constructor, the `EllipticCurve_generic` constructor...

In Sage, it doesn't seem possible for the time being to build an `EllipticCurve` object without proving/disproving the primality of the characteristic of the underlying Ring. This slows down the ECPP certificate verification, and makes it pointless since another proven method is used behind the scenes on the integer we want to prove the primality of.

Is this an issue for your code? When profiling your (verification) code, does the computation spend a significant amount of its running time in method 'is_prime' of 'sage.rings.integer.Integer'. (profile with %prun e.verify_certificate())

As a side comment, the is_prime method of the Integer class is probably also a good place to call your code from.

I apologize for not being able to perform more in depth tests before reporting this potential issue (I am not able to set up a sage development environment at short notice).

Best wishes,

Jean-René



---

archive/issue_comments_100723.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHi,\n\nthanks for your helpful comment! I didn't know about the is_prime() call within the EllipticCurve constructor. Up to now, I haven't noticed any slowdown due to EllipticCurve() (although I haven't paid attention either...).\n\nIsn't it the case that is_prime() switches over to a pseudoprimality test as soon as the input number exceeds a certain bound (which will be probably the case for numbers tested via ECPP) and is thus very fast again? If not, it would indeed make the code pointless somehow (as computations on elliptic curves are vital for ECPP and it wouldn't make that much sense to me to re-implement EllipticCurve, Schoof-Elkies-Atkin etc just for this single file ecpp.pyx)\nBest,\nGeorg",
    "created_at": "2011-01-13T16:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100723",
    "user": "ghahn@cantab.net"
}
```

<div id="comment:10" align="right">comment:10</div>

Hi,

thanks for your helpful comment! I didn't know about the is_prime() call within the EllipticCurve constructor. Up to now, I haven't noticed any slowdown due to EllipticCurve() (although I haven't paid attention either...).

Isn't it the case that is_prime() switches over to a pseudoprimality test as soon as the input number exceeds a certain bound (which will be probably the case for numbers tested via ECPP) and is thus very fast again? If not, it would indeed make the code pointless somehow (as computations on elliptic curves are vital for ECPP and it wouldn't make that much sense to me to re-implement EllipticCurve, Schoof-Elkies-Atkin etc just for this single file ecpp.pyx)
Best,
Georg



---

archive/issue_comments_100724.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [ghahn@\u2026](#comment:10):\n> Hi,\n> \n> thanks for your helpful comment! I didn't know about the is_prime() call within the EllipticCurve constructor. Up to now, I haven't noticed any slowdown due to EllipticCurve() (although I haven't paid attention either...).\n> \n\nI only perform verification of certificates obtained by other means. My code spends more than 90% of its running time in is_prime, which is called several times from `EllipticCurve` constructor. The behaviour of this constructor has an huge impact on the performance.\n\n> Isn't it the case that is_prime() switches over to a pseudoprimality test as soon as the input number exceeds a certain bound (which will be probably the case for numbers tested via ECPP) and is thus very fast again? If not, it would indeed make the code pointless somehow\n\nis_prime doesn't perform the switch from proven behaviour to probable behaviour unless asked for. (cf sage: ?is_prime )\n\n> (as computations on elliptic curves are vital for ECPP and it wouldn't make that much sense to me to re-implement EllipticCurve, Schoof-Elkies-Atkin etc just for this single file ecpp.pyx)\n\nI think the best option would be to add a flag to the `EllipticCurve` and `EllipticCurve_generic` constructors determining whether primality tests are performed or not. This should enable to continue using the existing codebase on elliptic curves.\n\nFinally, I have been working on an old version of Sage (4.0.2), my claims may be false in the latest versions, although reading the elliptic curve constructor code in the sage repository leads me to believe that the issue is still there.\n\n> Best,\n> Georg\n\nBest wishes,\nJean-Ren\u00e9",
    "created_at": "2011-01-13T17:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100724",
    "user": "https://github.com/sagetrac-jrreinhard"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [ghahn@…](#comment:10):
> Hi,
> 
> thanks for your helpful comment! I didn't know about the is_prime() call within the EllipticCurve constructor. Up to now, I haven't noticed any slowdown due to EllipticCurve() (although I haven't paid attention either...).
> 

I only perform verification of certificates obtained by other means. My code spends more than 90% of its running time in is_prime, which is called several times from `EllipticCurve` constructor. The behaviour of this constructor has an huge impact on the performance.

> Isn't it the case that is_prime() switches over to a pseudoprimality test as soon as the input number exceeds a certain bound (which will be probably the case for numbers tested via ECPP) and is thus very fast again? If not, it would indeed make the code pointless somehow

is_prime doesn't perform the switch from proven behaviour to probable behaviour unless asked for. (cf sage: ?is_prime )

> (as computations on elliptic curves are vital for ECPP and it wouldn't make that much sense to me to re-implement EllipticCurve, Schoof-Elkies-Atkin etc just for this single file ecpp.pyx)

I think the best option would be to add a flag to the `EllipticCurve` and `EllipticCurve_generic` constructors determining whether primality tests are performed or not. This should enable to continue using the existing codebase on elliptic curves.

Finally, I have been working on an old version of Sage (4.0.2), my claims may be false in the latest versions, although reading the elliptic curve constructor code in the sage repository leads me to believe that the issue is still there.

> Best,
> Georg

Best wishes,
Jean-René



---

archive/issue_comments_100725.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nan erratum on the last message : is_prime returns a proven result all the time. is_pseudoprime has to be called to perform pseudo-primality tests.",
    "created_at": "2011-01-13T17:34:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100725",
    "user": "https://github.com/sagetrac-jrreinhard"
}
```

<div id="comment:12" align="right">comment:12</div>

an erratum on the last message : is_prime returns a proven result all the time. is_pseudoprime has to be called to perform pseudo-primality tests.



---

archive/issue_comments_100726.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHi Jean-Ren\u00e9,\n\nin case that is_prime doesn't switch its behaviour, I totally agree that the best way to solve this problem would be adding a flag to EllipticCurve for disabling the primality test. Then, all existing code would still be usable and everyone could decide for himself whether he/she wants to do possibly undefined computations (at own risk).\nI posted the question on sage-devel yesterday\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/c9fcfba8f222644f\nand hope that such a flag could be included as this would solve the ECPP problem.\nBest,\nGeorg",
    "created_at": "2011-01-16T21:13:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100726",
    "user": "ghahn@cantab.net"
}
```

<div id="comment:13" align="right">comment:13</div>

Hi Jean-René,

in case that is_prime doesn't switch its behaviour, I totally agree that the best way to solve this problem would be adding a flag to EllipticCurve for disabling the primality test. Then, all existing code would still be usable and everyone could decide for himself whether he/she wants to do possibly undefined computations (at own risk).
I posted the question on sage-devel yesterday
http://groups.google.com/group/sage-devel/browse_thread/thread/c9fcfba8f222644f
and hope that such a flag could be included as this would solve the ECPP problem.
Best,
Georg



---

archive/issue_comments_100727.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHi,\nmay this ticket be closed? Further changes (if any) will affect the \"Elliptic Curve\" class, not the class ECPP itself.\nBest, Georg",
    "created_at": "2011-03-26T23:07:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100727",
    "user": "ghahn@cantab.net"
}
```

<div id="comment:14" align="right">comment:14</div>

Hi,
may this ticket be closed? Further changes (if any) will affect the "Elliptic Curve" class, not the class ECPP itself.
Best, Georg



---

archive/issue_events_139069.json:
```json
{
    "actor": null,
    "created_at": "2011-04-03T11:21:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139069"
}
```



---

archive/issue_events_139070.json:
```json
{
    "actor": null,
    "created_at": "2011-04-03T11:21:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10562#event-139070"
}
```



---

archive/issue_comments_100728.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [ghahn@\u2026](#comment:15):\nWhy is this ticket closed as fixed? Has the patch above been merged yet and, if so, which version of Sage? You need to provide clear reasons to close any ticket.",
    "created_at": "2011-04-04T08:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100728",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [ghahn@…](#comment:15):
Why is this ticket closed as fixed? Has the patch above been merged yet and, if so, which version of Sage? You need to provide clear reasons to close any ticket.



---

archive/issue_comments_100729.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@nexttime](#comment:17):\nHi! Is this patch now eligible to be added to any future release of SAGE? The webpage http://www.sagemath.org/doc/developer/trac.html reads that every ticket must have a milestone assigned: may I assign it to sage-4.7.1? Thanks, Georg",
    "created_at": "2011-06-18T17:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100729",
    "user": "ghahn@cantab.net"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@nexttime](#comment:17):
Hi! Is this patch now eligible to be added to any future release of SAGE? The webpage http://www.sagemath.org/doc/developer/trac.html reads that every ticket must have a milestone assigned: may I assign it to sage-4.7.1? Thanks, Georg



---

archive/issue_comments_100730.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [ghahn@\u2026](#comment:18):\n> Is this patch now eligible to be added to any future release of SAGE? The webpage http://www.sagemath.org/doc/developer/trac.html reads that every ticket must have a milestone assigned: may I assign it to sage-4.7.1?\n\nWell, I don't know. You didn't answer Minh's question why you closed this ticket (as \"fixed\"(!), and especially while needing review). \n\nSetting milestones (or more precisely, the decision when to actually merge a *positively reviewed* ticket) is up to the release manager, as well as [usually] closing tickets - see http://www.sagemath.org/doc/developer/trac.html#closing-tickets, also http://wiki.sagemath.org/devel/TracGuidelines.\n\nIf you want this to get into Sage, you should reopen the ticket (or ask someone to do so) and set its status back to \"needs review\" s.t. others take a look at and test your code, finally hopefully giving it a positive review. The milestone is by default the next release, and gets updated whenever newer Sage version are released without merging the ticket. One can of course always target tickets to later releases than the current, but that's usually made by the release manager (who also closes tickets as \"fixed\" *after they've been included into a release*).",
    "created_at": "2011-06-18T18:32:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100730",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [ghahn@…](#comment:18):
> Is this patch now eligible to be added to any future release of SAGE? The webpage http://www.sagemath.org/doc/developer/trac.html reads that every ticket must have a milestone assigned: may I assign it to sage-4.7.1?

Well, I don't know. You didn't answer Minh's question why you closed this ticket (as "fixed"(!), and especially while needing review). 

Setting milestones (or more precisely, the decision when to actually merge a *positively reviewed* ticket) is up to the release manager, as well as [usually] closing tickets - see http://www.sagemath.org/doc/developer/trac.html#closing-tickets, also http://wiki.sagemath.org/devel/TracGuidelines.

If you want this to get into Sage, you should reopen the ticket (or ask someone to do so) and set its status back to "needs review" s.t. others take a look at and test your code, finally hopefully giving it a positive review. The milestone is by default the next release, and gets updated whenever newer Sage version are released without merging the ticket. One can of course always target tickets to later releases than the current, but that's usually made by the release manager (who also closes tickets as "fixed" *after they've been included into a release*).



---

archive/issue_comments_100731.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nPerhaps also re-advertise the ticket / ECPP on sage-devel; [ticket:11421 NZMATH] e.g. is still an optional package.",
    "created_at": "2011-06-18T19:32:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10562#issuecomment-100731",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">comment:20</div>

Perhaps also re-advertise the ticket / ECPP on sage-devel; [ticket:11421 NZMATH] e.g. is still an optional package.
