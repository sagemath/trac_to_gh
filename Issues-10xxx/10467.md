# Issue 10467: Improve lookup of private attributes

archive/issues_010414.json:
```json
{
    "body": "By a private attribute, I mean an attribute whose name starts with two underscores and does not end with an underscore. Such an attribute is used, e.g., in the default `__repr__` method of Sage objects.\n\nIt should be reasonable to assume that private attributes belong to a particular instance, not to its class or its category; after all, they are subject to Python's name mangling.\n\nIn particular, if `P` is a parent/element, then `P.__foo` is either defined for the instance `P` or will not be available from `P.category().parent_class` resp. from `P.category().element_class`.\n\nIt turns out that this assumption holds thorought Sage: When one lets the `__getattr__` methods of Parent/Element immediately raise an `AttributeError` when a private attribute is requested, then all doc tests still pass.\n\nThat is what my patch mainly does. In addition, it removes several occurences of an idiom like\n\n```\nif hasattr(self,'foo'):\n    return self.foo\n```\nand replaces it with\n\n```\ntry:\n    return self.foo\nexcept AttributeError:\n    pass\n```\nwhich saves half of the computation time when the attribute actually exists.\n\nThe advantage is a considerable speedup. Here are two examples (the last is actually a serious computation):\n\nWithout the patch:\n\n```\nsage: P.<x> = QQ[]\nsage: timeit('a=repr(x)')\n625 loops, best of 3: 74.7 \u00c2\u00b5s per loop\nsage: R.<x,y> = InfinitePolynomialRing(QQ)\nsage: I = R.ideal([x[1]^2+y[2]*y[3], x[2]*y[1]*x[3]-y[1]*y[2]])\nsage: %time I.groebner_basis()\nCPU times: user 23.09 s, sys: 0.02 s, total: 23.11 s\nWall time: 23.67 s\n[y_2*y_1^3 + y_2*y_1^2, y_2^2*y_1 - y_2*y_1^2, y_3*y_1 - y_2*y_1, x_1*y_2*y_1^2 + x_1*y_2*y_1, x_1^2 + y_2*y_1, x_2*y_2*y_1 - x_1*y_2*y_1, x_2*x_1*y_3 - y_2*y_1, x_3*y_2*y_1 - x_1*y_2*y_1, x_3*x_1*y_2 - y_2*y_1, x_3*x_2*y_1 - y_2*y_1]\n```\n\nWith the patch:\n\n```\nsage: P.<x> = QQ[]\nsage: timeit('a=repr(x)')\n625 loops, best of 3: 40.5 \u00c2\u00b5s per loop\nsage: R.<x,y> = InfinitePolynomialRing(QQ)\nsage: I = R.ideal([x[1]^2+y[2]*y[3], x[2]*y[1]*x[3]-y[1]*y[2]])\nsage: %time I.groebner_basis()\nCPU times: user 14.43 s, sys: 0.03 s, total: 14.46 s\nWall time: 14.53 s\n[y_2*y_1^3 + y_2*y_1^2, y_2^2*y_1 - y_2*y_1^2, y_3*y_1 - y_2*y_1, x_1*y_2*y_1^2 + x_1*y_2*y_1, x_1^2 + y_2*y_1, x_2*y_2*y_1 - x_1*y_2*y_1, x_2*x_1*y_3 - y_2*y_1, x_3*y_2*y_1 - x_1*y_2*y_1, x_3*x_1*y_2 - y_2*y_1, x_3*x_2*y_1 - y_2*y_1]\n```\n\nThe patch also adds doctests in `Parent.__getattr__`, `Element.__getattr__` and several methods of `SageObject`.\n\n\n**Keywords:** private attribute lookup\n\n**Reviewer:** Robert Bradshaw\n\n**Author:** Simon King\n\n**Merged:** sage-4.6.2.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/10467\n\n",
    "closed_at": "2011-01-19T22:24:02Z",
    "created_at": "2010-12-12T11:08:43Z",
    "labels": [
        "component: categories",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Improve lookup of private attributes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10467",
    "user": "https://github.com/simon-king-jena"
}
```
By a private attribute, I mean an attribute whose name starts with two underscores and does not end with an underscore. Such an attribute is used, e.g., in the default `__repr__` method of Sage objects.

It should be reasonable to assume that private attributes belong to a particular instance, not to its class or its category; after all, they are subject to Python's name mangling.

In particular, if `P` is a parent/element, then `P.__foo` is either defined for the instance `P` or will not be available from `P.category().parent_class` resp. from `P.category().element_class`.

It turns out that this assumption holds thorought Sage: When one lets the `__getattr__` methods of Parent/Element immediately raise an `AttributeError` when a private attribute is requested, then all doc tests still pass.

That is what my patch mainly does. In addition, it removes several occurences of an idiom like

```
if hasattr(self,'foo'):
    return self.foo
```
and replaces it with

```
try:
    return self.foo
except AttributeError:
    pass
```
which saves half of the computation time when the attribute actually exists.

The advantage is a considerable speedup. Here are two examples (the last is actually a serious computation):

Without the patch:

```
sage: P.<x> = QQ[]
sage: timeit('a=repr(x)')
625 loops, best of 3: 74.7 Âµs per loop
sage: R.<x,y> = InfinitePolynomialRing(QQ)
sage: I = R.ideal([x[1]^2+y[2]*y[3], x[2]*y[1]*x[3]-y[1]*y[2]])
sage: %time I.groebner_basis()
CPU times: user 23.09 s, sys: 0.02 s, total: 23.11 s
Wall time: 23.67 s
[y_2*y_1^3 + y_2*y_1^2, y_2^2*y_1 - y_2*y_1^2, y_3*y_1 - y_2*y_1, x_1*y_2*y_1^2 + x_1*y_2*y_1, x_1^2 + y_2*y_1, x_2*y_2*y_1 - x_1*y_2*y_1, x_2*x_1*y_3 - y_2*y_1, x_3*y_2*y_1 - x_1*y_2*y_1, x_3*x_1*y_2 - y_2*y_1, x_3*x_2*y_1 - y_2*y_1]
```

With the patch:

```
sage: P.<x> = QQ[]
sage: timeit('a=repr(x)')
625 loops, best of 3: 40.5 Âµs per loop
sage: R.<x,y> = InfinitePolynomialRing(QQ)
sage: I = R.ideal([x[1]^2+y[2]*y[3], x[2]*y[1]*x[3]-y[1]*y[2]])
sage: %time I.groebner_basis()
CPU times: user 14.43 s, sys: 0.03 s, total: 14.46 s
Wall time: 14.53 s
[y_2*y_1^3 + y_2*y_1^2, y_2^2*y_1 - y_2*y_1^2, y_3*y_1 - y_2*y_1, x_1*y_2*y_1^2 + x_1*y_2*y_1, x_1^2 + y_2*y_1, x_2*y_2*y_1 - x_1*y_2*y_1, x_2*x_1*y_3 - y_2*y_1, x_3*y_2*y_1 - x_1*y_2*y_1, x_3*x_1*y_2 - y_2*y_1, x_3*x_2*y_1 - y_2*y_1]
```

The patch also adds doctests in `Parent.__getattr__`, `Element.__getattr__` and several methods of `SageObject`.


**Keywords:** private attribute lookup

**Reviewer:** Robert Bradshaw

**Author:** Simon King

**Merged:** sage-4.6.2.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/10467





---

archive/issue_comments_101724.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n By a private attribute, I mean an attribute whose name starts with two underscores and does not end with an underscore. Such an attribute is used, e.g., in the default `__repr__` method of Sage objects.\n \n-It should be reasonable to assume that private attributes belong to a particular instance, not to its class or its category. In particular, if `P` is a parent/element, then `P.__foo` is either defined for the instance `P` or will not be available from `P.category().parent_class` resp. from `P.category().element_class`.\n+It should be reasonable to assume that private attributes belong to a particular instance, not to its class or its category; after all, they are subject to Python's name mangling.\n+\n+In particular, if `P` is a parent/element, then `P.__foo` is either defined for the instance `P` or will not be available from `P.category().parent_class` resp. from `P.category().element_class`.\n \n It turns out that this assumption holds thorought Sage: When one lets the `__getattr__` methods of Parent/Element immediately raise an `AttributeError` when a private attribute is requested, then all doc tests still pass.\n \n``````\n",
    "created_at": "2010-12-12T11:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101724",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 By a private attribute, I mean an attribute whose name starts with two underscores and does not end with an underscore. Such an attribute is used, e.g., in the default `__repr__` method of Sage objects.
 
-It should be reasonable to assume that private attributes belong to a particular instance, not to its class or its category. In particular, if `P` is a parent/element, then `P.__foo` is either defined for the instance `P` or will not be available from `P.category().parent_class` resp. from `P.category().element_class`.
+It should be reasonable to assume that private attributes belong to a particular instance, not to its class or its category; after all, they are subject to Python's name mangling.
+
+In particular, if `P` is a parent/element, then `P.__foo` is either defined for the instance `P` or will not be available from `P.category().parent_class` resp. from `P.category().element_class`.
 
 It turns out that this assumption holds thorought Sage: When one lets the `__getattr__` methods of Parent/Element immediately raise an `AttributeError` when a private attribute is requested, then all doc tests still pass.
 
``````




---

archive/issue_events_081776.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-12T11:35:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81776"
}
```



---

archive/issue_comments_101725.json:
```json
{
    "body": "<a id='comment:2'></a>\nOn [sage-algebra](http://groups.google.com/group/sage-algebra/browse_thread/thread/2c6adc1f746063ac), Nicolas Thi\u00e9ry wrote:\n  \"Just please make a quick benchmark (and post the result on track) to verify that the extra check does not induce an overhead for usual lookups (probably not).\"\n\nHere are two data points.\n\n(1)\nI compared \"`sage -tp 4 sage/`\" before and after applying the patch. It is 1810.3 seconds without the patch, but 1792.5 seconds with the patch. So, on average, it became quicker.\n\n(2)\nThe timings improve if a non-existing private attribute is requested. So, let us test a situation where an *existing* categorical attribute is requested. For example, the method `summation` method of the rational field is only defined in its category.\n\nWithout the patch, I obtained\n\n```\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 553 ns per loop\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 563 ns per loop\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 559 ns per loop\n```\n\nWith the patch, I obtain\n\n```\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 530 ns per loop\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 514 ns per loop\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 539 ns per loop\n```\n\nSo, that's a situation where it might expect a slight deceleration with the patch, but in fact it is as quick as before.",
    "created_at": "2010-12-13T12:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101725",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
On [sage-algebra](http://groups.google.com/group/sage-algebra/browse_thread/thread/2c6adc1f746063ac), Nicolas Thiéry wrote:
  "Just please make a quick benchmark (and post the result on track) to verify that the extra check does not induce an overhead for usual lookups (probably not)."

Here are two data points.

(1)
I compared "`sage -tp 4 sage/`" before and after applying the patch. It is 1810.3 seconds without the patch, but 1792.5 seconds with the patch. So, on average, it became quicker.

(2)
The timings improve if a non-existing private attribute is requested. So, let us test a situation where an *existing* categorical attribute is requested. For example, the method `summation` method of the rational field is only defined in its category.

Without the patch, I obtained

```
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 553 ns per loop
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 563 ns per loop
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 559 ns per loop
```

With the patch, I obtain

```
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 530 ns per loop
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 514 ns per loop
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 539 ns per loop
```

So, that's a situation where it might expect a slight deceleration with the patch, but in fact it is as quick as before.



---

archive/issue_comments_101726.json:
```json
{
    "body": "<a id='comment:3'></a>\nI found yet another way to speed things up!\n\nTypically, in Python one requests an attribute and catches an `AttributeError` (this is also done in Python's `hasattr`, IIRC). That happens very often during computations. Hence, it is very important that *raising* the error happens quickly. \n\nThe `__getattr__` methods of sage.structure.parent.Parent and sage.structure.element.Element call a Python method sage.structure.parent.raise_attribute_error, that first creates the error message and then raises the `AttributeError`. Interpreted Python is too slow for that purpose!\n\nTherefore I updated my patch (will post it in a few minutes). Trick: Instead of\n\n```\ndef raise_attribute_error(self, name)\n```\nit is now\n\n```\ncdef inline raise_attribute_error(self,name)\n```\n\nThe effect of this little trick, compared with the benchmarks above, is:\n\n(1) Saves almost 20% compared with the old patch, and more than 50% compared with unpatched Sage:\n\n```\nsage: P.<x> = QQ[]\nsage: timeit('a=repr(x)')\n625 loops, best of 3: 33.8 \u00c2\u00b5s per loop\n```\n\n(2) Saves almost 10% compared with the old patch and almost 50% compared with unpatched Sage: \n\n```\nsage: R.<x,y> = InfinitePolynomialRing(QQ)\nsage: I = R.ideal([x[1]^2+y[2]*y[3], x[2]*y[1]*x[3]-y[1]*y[2]])\nsage: %time I.groebner_basis()\nCPU times: user 13.30 s, sys: 0.02 s, total: 13.32 s\nWall time: 13.38 s\n[y_2*y_1^3 + y_2*y_1^2, y_2^2*y_1 - y_2*y_1^2, y_3*y_1 - y_2*y_1, x_1*y_2*y_1^2 + x_1*y_2*y_1, x_1^2 + y_2*y_1, x_2*y_2*y_1 - x_1*y_2*y_1, x_2*x_1*y_3 - y_2*y_1, x_3*y_2*y_1 - x_1*y_2*y_1, x_3*x_1*y_2 - y_2*y_1, x_3*x_2*y_1 - y_2*y_1]\n```\n\n(3) No significant difference in the third benchmark:\n\n```\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 526 ns per loop\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 524 ns per loop\nsage: timeit('a=QQ.summation',number=50000)\n50000 loops, best of 3: 527 ns per loop\n```",
    "created_at": "2010-12-13T19:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101726",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>
I found yet another way to speed things up!

Typically, in Python one requests an attribute and catches an `AttributeError` (this is also done in Python's `hasattr`, IIRC). That happens very often during computations. Hence, it is very important that *raising* the error happens quickly. 

The `__getattr__` methods of sage.structure.parent.Parent and sage.structure.element.Element call a Python method sage.structure.parent.raise_attribute_error, that first creates the error message and then raises the `AttributeError`. Interpreted Python is too slow for that purpose!

Therefore I updated my patch (will post it in a few minutes). Trick: Instead of

```
def raise_attribute_error(self, name)
```
it is now

```
cdef inline raise_attribute_error(self,name)
```

The effect of this little trick, compared with the benchmarks above, is:

(1) Saves almost 20% compared with the old patch, and more than 50% compared with unpatched Sage:

```
sage: P.<x> = QQ[]
sage: timeit('a=repr(x)')
625 loops, best of 3: 33.8 Âµs per loop
```

(2) Saves almost 10% compared with the old patch and almost 50% compared with unpatched Sage: 

```
sage: R.<x,y> = InfinitePolynomialRing(QQ)
sage: I = R.ideal([x[1]^2+y[2]*y[3], x[2]*y[1]*x[3]-y[1]*y[2]])
sage: %time I.groebner_basis()
CPU times: user 13.30 s, sys: 0.02 s, total: 13.32 s
Wall time: 13.38 s
[y_2*y_1^3 + y_2*y_1^2, y_2^2*y_1 - y_2*y_1^2, y_3*y_1 - y_2*y_1, x_1*y_2*y_1^2 + x_1*y_2*y_1, x_1^2 + y_2*y_1, x_2*y_2*y_1 - x_1*y_2*y_1, x_2*x_1*y_3 - y_2*y_1, x_3*y_2*y_1 - x_1*y_2*y_1, x_3*x_1*y_2 - y_2*y_1, x_3*x_2*y_1 - y_2*y_1]
```

(3) No significant difference in the third benchmark:

```
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 526 ns per loop
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 524 ns per loop
sage: timeit('a=QQ.summation',number=50000)
50000 loops, best of 3: 527 ns per loop
```



---

archive/issue_comments_101727.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe (updated) patch avoids looking up private attributes in the category, avoids some needless \"hasattr\" calls, and gains additional speed by cythenising \"raise_attribute_error\".",
    "created_at": "2010-12-13T19:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101727",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>
The (updated) patch avoids looking up private attributes in the category, avoids some needless "hasattr" calls, and gains additional speed by cythenising "raise_attribute_error".



---

archive/issue_comments_101728.json:
```json
{
    "body": "**Work_Issues:** Test  for raise_attribute_error",
    "created_at": "2010-12-13T20:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101728",
    "user": "https://github.com/simon-king-jena"
}
```

**Work_Issues:** Test  for raise_attribute_error



---

archive/issue_comments_101729.json:
```json
{
    "body": "<a id='comment:5'></a>\nI need to further update the patch: Of course, after cythonising `raise_attribute_error`, the doctest of that function fails, because one needs a Python function calling it.",
    "created_at": "2010-12-13T20:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101729",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
I need to further update the patch: Of course, after cythonising `raise_attribute_error`, the doctest of that function fails, because one needs a Python function calling it.



---

archive/issue_events_081777.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-13T20:30:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81777"
}
```



---

archive/issue_events_081778.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-13T20:30:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81778"
}
```



---

archive/issue_comments_101730.json:
```json
{
    "body": "Speedup for attribute lookup of Parents and Elements",
    "created_at": "2010-12-13T20:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101730",
    "user": "https://github.com/simon-king-jena"
}
```

Speedup for attribute lookup of Parents and Elements



---

archive/attachments_013636.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "10467attribute_lookup.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10467/10467attribute_lookup.patch",
    "created_at": "2010-12-13T20:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/simon-king-jena"
}
```



---

archive/issue_comments_101731.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe patch is updated, the doctests should now pass.",
    "created_at": "2010-12-13T20:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101731",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
The patch is updated, the doctests should now pass.



---

archive/issue_events_081779.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-13T20:41:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81779"
}
```



---

archive/issue_events_081780.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-13T20:41:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81780"
}
```



---

archive/issue_comments_101732.json:
```json
{
    "body": "**Changing work_issues** from \"Test  for raise_attribute_error\" to \"\".",
    "created_at": "2010-12-13T20:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101732",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing work_issues** from "Test  for raise_attribute_error" to "".



---

archive/issue_comments_101733.json:
```json
{
    "body": "<a id='comment:7'></a>\nMostly looks good. My only request is that in the `__repr__` and interface_init functions that an attribute error not be caught over the call into the sub-function, as that is not the intended behavior (and, speaking from first-hand experience, leads to un-intuitive to debug errors, particularly in methods like repr).",
    "created_at": "2010-12-14T04:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101733",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:7'></a>
Mostly looks good. My only request is that in the `__repr__` and interface_init functions that an attribute error not be caught over the call into the sub-function, as that is not the intended behavior (and, speaking from first-hand experience, leads to un-intuitive to debug errors, particularly in methods like repr).



---

archive/issue_events_081781.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-12-14T04:55:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81781"
}
```



---

archive/issue_events_081782.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-12-14T04:55:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81782"
}
```



---

archive/issue_events_081783.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-12-14T05:22:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81783"
}
```



---

archive/issue_events_081784.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-12-14T05:22:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81784"
}
```



---

archive/attachments_013637.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "10467-attribute-referee.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10467/10467-attribute-referee.patch",
    "created_at": "2010-12-14T05:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_101734.json:
```json
{
    "body": "<a id='comment:8'></a>\nPositive review to everything but my own (tiny) patch.",
    "created_at": "2010-12-14T05:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101734",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:8'></a>
Positive review to everything but my own (tiny) patch.



---

archive/issue_comments_101735.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [robertwb](#comment%3A7):\n> Mostly looks good. My only request is that in the `__repr__` and interface_init functions that an attribute error not be caught over the call into the sub-function, ...\n\n\nYou are right, that needs to be changed.\n\nI applied your referee patch and (to be on the safe side) am running doctests. If it works then (if I understood correctly) I am entitled to change it into positive review, inserting your name as reviewer, right?\n\nBest regards,\n\nSimon",
    "created_at": "2010-12-14T06:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101735",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>
Replying to [robertwb](#comment%3A7):
> Mostly looks good. My only request is that in the `__repr__` and interface_init functions that an attribute error not be caught over the call into the sub-function, ...


You are right, that needs to be changed.

I applied your referee patch and (to be on the safe side) am running doctests. If it works then (if I understood correctly) I am entitled to change it into positive review, inserting your name as reviewer, right?

Best regards,

Simon



---

archive/issue_events_081785.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-14T07:23:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81785"
}
```



---

archive/issue_events_081786.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-14T07:23:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81786"
}
```



---

archive/issue_comments_101736.json:
```json
{
    "body": "<a id='comment:10'></a>\nAll tests pass with the referee patch. Hence, I change it to \"positive review\" and insert Robert as reviewer.\n\nTo the patchbot/release managaer:\n\nApply 10467attribute_lookup.patch 10467-attribute-referee.patch\n\nCheers,\n\nSimon",
    "created_at": "2010-12-14T07:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101736",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>
All tests pass with the referee patch. Hence, I change it to "positive review" and insert Robert as reviewer.

To the patchbot/release managaer:

Apply 10467attribute_lookup.patch 10467-attribute-referee.patch

Cheers,

Simon



---

archive/issue_comments_101737.json:
```json
{
    "body": "**Reviewer:** Robert Bradshaw",
    "created_at": "2010-12-14T07:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101737",
    "user": "https://github.com/simon-king-jena"
}
```

**Reviewer:** Robert Bradshaw



---

archive/issue_comments_101738.json:
```json
{
    "body": "<a id='comment:11'></a>\nYes, that's all kosher. Thanks. BTW, the buildbot would pick up both patches just fine (though it only runs on needs-review tickets).",
    "created_at": "2010-12-14T08:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101738",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:11'></a>
Yes, that's all kosher. Thanks. BTW, the buildbot would pick up both patches just fine (though it only runs on needs-review tickets).



---

archive/issue_events_081787.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-14T15:45:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81787"
}
```



---

archive/issue_events_081788.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-14T15:45:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81788"
}
```



---

archive/issue_comments_101739.json:
```json
{
    "body": "<a id='comment:13'></a>\nWill the patch be merged, after meanwhile 5 weeks?",
    "created_at": "2011-01-18T07:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101739",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'></a>
Will the patch be merged, after meanwhile 5 weeks?



---

archive/issue_comments_101740.json:
```json
{
    "body": "<a id='comment:14'></a>\nYou should give the patch a proper commit message (use `hg qrefresh -e` for that).  Make sure the ticket number appears on the first line.",
    "created_at": "2011-01-18T13:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101740",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
You should give the patch a proper commit message (use `hg qrefresh -e` for that).  Make sure the ticket number appears on the first line.



---

archive/issue_events_081789.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-18T13:38:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81789"
}
```



---

archive/issue_events_081790.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-18T13:38:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81790"
}
```



---

archive/attachments_013638.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "10467-attribute-referee.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10467/10467-attribute-referee.2.patch",
    "created_at": "2011-01-18T13:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/simon-king-jena"
}
```



---

archive/issue_comments_101741.json:
```json
{
    "body": "<a id='comment:15'></a>\nApply 10467attribute_lookup.patch 10467-attribute-referee.2.patch\n\nNote: My patch had a proper commit message, and I hope that the referee does not mind that I added a commit message to the referee patch.",
    "created_at": "2011-01-18T13:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101741",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:15'></a>
Apply 10467attribute_lookup.patch 10467-attribute-referee.2.patch

Note: My patch had a proper commit message, and I hope that the referee does not mind that I added a commit message to the referee patch.



---

archive/issue_events_081791.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-01-18T13:48:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81791"
}
```



---

archive/issue_events_081792.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-01-18T13:48:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81792"
}
```



---

archive/issue_comments_101742.json:
```json
{
    "body": "Same patch, fixed commit message properly",
    "created_at": "2011-01-19T02:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101742",
    "user": "https://github.com/jdemeyer"
}
```

Same patch, fixed commit message properly



---

archive/attachments_013639.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "10467-attribute-referee.3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10467/10467-attribute-referee.3.patch",
    "created_at": "2011-01-19T22:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_101743.json:
```json
{
    "body": "<a id='comment:16'></a>\n",
    "created_at": "2011-01-19T22:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101743",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>




---

archive/issue_comments_101744.json:
```json
{
    "body": "**Merged:** sage-4.6.2.alpha1",
    "created_at": "2011-01-19T22:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101744",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.6.2.alpha1



---

archive/issue_events_081793.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:24:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81793"
}
```



---

archive/issue_events_081794.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:24:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81794"
}
```



---

archive/issue_comments_101745.json:
```json
{
    "body": "<a id='comment:17'></a>\nI'm undoing a large part of this patch of #20686. See that ticket for the rationale.",
    "created_at": "2016-06-15T18:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101745",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
I'm undoing a large part of this patch of #20686. See that ticket for the rationale.



---

archive/issue_comments_101746.json:
```json
{
    "body": "<a id='comment:18'></a>\nHi, I am sitting next to Jeroen.\n\n`__getattr__` as implemented in this ticket makes it so that an error\nis raised in the following situation:\n\n```\n    sage: C = EuclideanDomains()\n    sage: P.<x> = QQ[]\n    sage: C.element_class.__foo = 'bar'\n    sage: x.parent() in C\n    True\n    sage: x.__foo\n```\n\nHowever, when using plain Python inheritance, no error is raised in\nthis equivalent situation:\n\n```\n    sage: C = Semigroups()\n    sage: S = C.example()\n    sage: S.category() is C\n    True\n    sage: C.element_class.__foo = 'bar'\n    sage: x = S.an_element()\n    sage: x.__foo\n    'bar'\n```\n\nGiven that the role of `__getattr__` is to emulate Python inheritance\nas closely as possible, I agree with Jeroen that the above behavior of\nraising an error is not desirable. Especially since it has a cost.\n\nOr would there be a use case for this behavior? I don't expect to see\nprivate methods in element_class'es; they probably would not work\nanyway.\n\nCheers,\n                             Nicolas",
    "created_at": "2016-06-15T21:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101746",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:18'></a>
Hi, I am sitting next to Jeroen.

`__getattr__` as implemented in this ticket makes it so that an error
is raised in the following situation:

```
    sage: C = EuclideanDomains()
    sage: P.<x> = QQ[]
    sage: C.element_class.__foo = 'bar'
    sage: x.parent() in C
    True
    sage: x.__foo
```

However, when using plain Python inheritance, no error is raised in
this equivalent situation:

```
    sage: C = Semigroups()
    sage: S = C.example()
    sage: S.category() is C
    True
    sage: C.element_class.__foo = 'bar'
    sage: x = S.an_element()
    sage: x.__foo
    'bar'
```

Given that the role of `__getattr__` is to emulate Python inheritance
as closely as possible, I agree with Jeroen that the above behavior of
raising an error is not desirable. Especially since it has a cost.

Or would there be a use case for this behavior? I don't expect to see
private methods in element_class'es; they probably would not work
anyway.

Cheers,
                             Nicolas



---

archive/issue_comments_101747.json:
```json
{
    "body": "<a id='comment:19'></a>\nJust checking that I can post a comment.",
    "created_at": "2016-06-16T07:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101747",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
Just checking that I can post a comment.



---

archive/issue_comments_101748.json:
```json
{
    "body": "**Changing keywords** from \"private attribute lookup\" to \"private attribute lookup just testing\".",
    "created_at": "2016-06-16T07:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101748",
    "user": "https://github.com/jdemeyer"
}
```

**Changing keywords** from "private attribute lookup" to "private attribute lookup just testing".



---

archive/issue_comments_101749.json:
```json
{
    "body": "**Changing keywords** from \"private attribute lookup just testing\" to \"private attribute lookup\".",
    "created_at": "2016-06-16T07:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101749",
    "user": "https://github.com/jdemeyer"
}
```

**Changing keywords** from "private attribute lookup just testing" to "private attribute lookup".



---

archive/issue_events_081795.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-16T07:09:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "component: performance",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81795"
}
```



---

archive/issue_events_081796.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-16T07:09:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "label": "component: categories",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10467#event-81796"
}
```



---

archive/issue_comments_101750.json:
```json
{
    "body": "<a id='comment:22'></a>\nI can post here, but not on #20686...",
    "created_at": "2016-06-16T07:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10467#issuecomment-101750",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
I can post here, but not on #20686...
