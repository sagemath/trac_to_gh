# Issue 10682: Upgrade maxima to 5.26

archive/issues_010629.json:
```json
{
    "assignees": [
        "https://github.com/burcin"
    ],
    "body": "I test\n\n```\nsage: var ('n,k')\nsage: sum (binomial(n,k)*k^2, k, 0, n)  # is right\nsage: sum (binomial(n,k)*k^2, k, 1, n)  # is right n(n+1)2^(n-2)\nsage: sum (binomial(n,k)*k^2, k, 2, n)  # is false : I get 0 \n```\nThis works correctly on Maxima 5.26 - we need to upgrade! The new spkg is at\n\nhttp://perso.telecom-paristech.fr/~flori/sage/maxima-5.26.0.p0.spkg\n\nInstall the spkg and apply:\n\n* [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz)\n* [attachment: trac_10682-reviewer-local.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer-local.patch.gz)\n\nCC:  @orlitzky\n\nKeywords: **maxima 5.26.0 binomial sum**\n\nReviewer: **Jean-Pierre Flori, Nils Bruin**\n\nAuthor: **Dmitrii Pasechnik**\n\nMerged: **sage-5.0.beta8**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10682_\n\n",
    "closed_at": "2012-03-13T08:22:00Z",
    "created_at": "2011-01-24T18:49:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade maxima to 5.26",
    "type": "issue",
    "updated_at": "2012-03-20T07:36:23Z",
    "url": "https://github.com/sagemath/sage/issues/10682",
    "user": "https://github.com/sagetrac-fmaltey"
}
```
I test

```
sage: var ('n,k')
sage: sum (binomial(n,k)*k^2, k, 0, n)  # is right
sage: sum (binomial(n,k)*k^2, k, 1, n)  # is right n(n+1)2^(n-2)
sage: sum (binomial(n,k)*k^2, k, 2, n)  # is false : I get 0 
```
This works correctly on Maxima 5.26 - we need to upgrade! The new spkg is at

http://perso.telecom-paristech.fr/~flori/sage/maxima-5.26.0.p0.spkg

Install the spkg and apply:

* [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz)
* [attachment: trac_10682-reviewer-local.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer-local.patch.gz)

CC:  @orlitzky

Keywords: **maxima 5.26.0 binomial sum**

Reviewer: **Jean-Pierre Flori, Nils Bruin**

Author: **Dmitrii Pasechnik**

Merged: **sage-5.0.beta8**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/10682_





---

archive/issue_events_141616.json:
```json
{
    "actor": "https://github.com/sagetrac-fmaltey",
    "created_at": "2011-01-24T18:49:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141616"
}
```



---

archive/issue_events_141617.json:
```json
{
    "actor": "https://github.com/sagetrac-fmaltey",
    "created_at": "2011-01-24T18:49:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141617"
}
```



---

archive/issue_events_141618.json:
```json
{
    "actor": "https://github.com/sagetrac-fmaltey",
    "created_at": "2011-01-24T18:49:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141618"
}
```



---

archive/issue_events_141619.json:
```json
{
    "actor": "https://github.com/sagetrac-fmaltey",
    "created_at": "2011-01-24T18:49:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141619"
}
```



---

archive/issue_events_141620.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2011-01-24T18:49:14Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "subject": "https://github.com/sagetrac-fmaltey",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141620"
}
```



---

archive/issue_comments_102464.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n ```\n sage: var ('n,k')\n-sage: sum (binomial(n,k)*k2, k, 0, n)  # is right\n-sage: sum (binomial(n,k)*k2, k, 1, n)  # is right n(n+1)2^(n-2)\n-sage: sum (binomial(n,k)*k2, k, 2, n)  # is false : I get 0 \n+sage: sum (binomial(n,k)*k^2, k, 0, n)  # is right\n+sage: sum (binomial(n,k)*k^2, k, 1, n)  # is right n(n+1)2^(n-2)\n+sage: sum (binomial(n,k)*k^2, k, 2, n)  # is false : I get 0 \n ```\n``````\n",
    "created_at": "2011-11-17T07:33:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102464",
    "user": "https://github.com/mboratko"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 ```
 sage: var ('n,k')
-sage: sum (binomial(n,k)*k2, k, 0, n)  # is right
-sage: sum (binomial(n,k)*k2, k, 1, n)  # is right n(n+1)2^(n-2)
-sage: sum (binomial(n,k)*k2, k, 2, n)  # is false : I get 0 
+sage: sum (binomial(n,k)*k^2, k, 0, n)  # is right
+sage: sum (binomial(n,k)*k^2, k, 1, n)  # is right n(n+1)2^(n-2)
+sage: sum (binomial(n,k)*k^2, k, 2, n)  # is false : I get 0 
 ```
``````




---

archive/issue_comments_102465.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis is not some general issue where sum fails on all inputs with lower bound != 0, 1.  For example, this is fine:\n\n```\nsage: var('n,k')\n(n, k)\nsage: sum(k, k, 1, n)  \n1/2*n^2 + 1/2*n\nsage: sum(k, k, 2, n)  \n1/2*n^2 + 1/2*n - 1\n```\n\nStarting at 2, I guess this should be the answer:\n\n```\nsage: (sum (binomial(n,k)*k^2, k, 1, n) - sum (binomial(n,k)*k^2, k, 1, 1))\n(n^2 + n)*2^(n - 2) - n\n```\n\nThe answer seems fine for starting at 3,4, by the way:\n\n```\nsage: a = (sum (binomial(n,k)*k^2, k, 1, n) - sum (binomial(n,k)*k^2, k, 1, 2))\nsage: b = sum (binomial(n,k)*k^2, k, 3, n)\nsage: bool(a==b)\nTrue\nsage: a = (sum (binomial(n,k)*k^2, k, 1, n) - sum (binomial(n,k)*k^2, k, 1, 3))\nsage: b = sum (binomial(n,k)*k^2, k, 4, n)\nsage: bool(a==b)\nTrue\n```\n\nThis is probably a serious bug in Maxima, since the real work is done by the function\n\n```\nsage.calculus.calculus.maxima.sr_sum\n```\nwhich just calls maxima in some complicated way.\n\nI am raising the priority since this is a subtle and very serious mathematically incorrect result.   Also, somebody needs to isolate this to a pure-maxima session exhibiting the bug (if it is in maxima!) and report upstream.  I tried for a minute and failed.",
    "created_at": "2012-02-26T19:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102465",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:2" align="right">comment:2</div>

This is not some general issue where sum fails on all inputs with lower bound != 0, 1.  For example, this is fine:

```
sage: var('n,k')
(n, k)
sage: sum(k, k, 1, n)  
1/2*n^2 + 1/2*n
sage: sum(k, k, 2, n)  
1/2*n^2 + 1/2*n - 1
```

Starting at 2, I guess this should be the answer:

```
sage: (sum (binomial(n,k)*k^2, k, 1, n) - sum (binomial(n,k)*k^2, k, 1, 1))
(n^2 + n)*2^(n - 2) - n
```

The answer seems fine for starting at 3,4, by the way:

```
sage: a = (sum (binomial(n,k)*k^2, k, 1, n) - sum (binomial(n,k)*k^2, k, 1, 2))
sage: b = sum (binomial(n,k)*k^2, k, 3, n)
sage: bool(a==b)
True
sage: a = (sum (binomial(n,k)*k^2, k, 1, n) - sum (binomial(n,k)*k^2, k, 1, 3))
sage: b = sum (binomial(n,k)*k^2, k, 4, n)
sage: bool(a==b)
True
```

This is probably a serious bug in Maxima, since the real work is done by the function

```
sage.calculus.calculus.maxima.sr_sum
```
which just calls maxima in some complicated way.

I am raising the priority since this is a subtle and very serious mathematically incorrect result.   Also, somebody needs to isolate this to a pure-maxima session exhibiting the bug (if it is in maxima!) and report upstream.  I tried for a minute and failed.



---

archive/issue_events_141621.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-02-26T19:55:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141621"
}
```



---

archive/issue_events_141622.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-02-26T19:55:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141622"
}
```



---

archive/issue_comments_102466.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n\n```\nMaxima 5.23.2 http://maxima.sourceforge.net\nusing Lisp ECL 11.1.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) load(simplify_sum);\n(%o1) /usr/local/sage/4.7.1/local/share/maxima/5.23.2/share/contrib/solve_rec/simplify_sum.mac\n(%i2) simplify_sum(sum(binomial(n,k)*k^2,k,2,n));\n(%o2)                                  0\n```",
    "created_at": "2012-02-26T20:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102466",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:3" align="right">comment:3</div>


```
Maxima 5.23.2 http://maxima.sourceforge.net
using Lisp ECL 11.1.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) load(simplify_sum);
(%o1) /usr/local/sage/4.7.1/local/share/maxima/5.23.2/share/contrib/solve_rec/simplify_sum.mac
(%i2) simplify_sum(sum(binomial(n,k)*k^2,k,2,n));
(%o2)                                  0
```



---

archive/issue_comments_102467.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nPossibly the following ticket is relevant:\n\n[maxima: binomial sums - ID: 2919296](http://sourceforge.net/tracker/index.php?func=detail&aid=2919296&group_id=4933&atid=104933)\n\nIf so, it might be fixed. I don't have access to maxima 5.26 to test.",
    "created_at": "2012-02-26T21:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102467",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:4" align="right">comment:4</div>

Possibly the following ticket is relevant:

[maxima: binomial sums - ID: 2919296](http://sourceforge.net/tracker/index.php?func=detail&aid=2919296&group_id=4933&atid=104933)

If so, it might be fixed. I don't have access to maxima 5.26 to test.



---

archive/issue_events_141623.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-02-27T01:43:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141623"
}
```



---

archive/issue_comments_102468.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@nbruin](#comment:4):\n> Possibly the following ticket is relevant:\n> \n> [maxima: binomial sums - ID: 2919296](http://sourceforge.net/tracker/index.php?func=detail&aid=2919296&group_id=4933&atid=104933)\n> \n> If so, it might be fixed. I don't have access to maxima 5.26 to test.\n\nIt is fixed. (What's a big deal of having access to maxima 5.26? It compiles with ECL supplied with Sage 4.8):\n\n```\n$ ./maxima-local\n;;; Loading #P\"/usr/local/src/sage/sage-4.8.alpha4/local/lib/ecl-11.1.1/sb-bsd-sockets.fas\"\n;;; Loading #P\"/usr/local/src/sage/sage-4.8.alpha4/local/lib/ecl-11.1.1/sockets.fas\"\n;;; Loading #P\"/usr/local/src/sage/sage-4.8.alpha4/local/lib/ecl-11.1.1/defsystem.fas\"\n;;; Loading #P\"/usr/local/src/sage/sage-4.8.alpha4/local/lib/ecl-11.1.1/cmp.fas\"\nMaxima 5.26.0_41_gbc6210e http://maxima.sourceforge.net\nusing Lisp ECL 11.1.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) load(simplify_sum);\n(%o1)        /tmp/maxima/share/contrib/solve_rec/simplify_sum.mac\n(%i2) simplify_sum(sum(binomial(n,k)*k^2,k,2,n));\n\n                                 2       n\n                               (n  + n) 2  - 4 n\n(%o2)                          -----------------\n                                       4\n(%i3) \n```\n\nThus, we need to update maxima spkg to 5.26.\n\nBy the way, I never understood why sum() is hardcoded this way in Sage. Sometimes I'd rather use Python's sum(), but I don't know how to do this.",
    "created_at": "2012-02-27T01:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102468",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@nbruin](#comment:4):
> Possibly the following ticket is relevant:
> 
> [maxima: binomial sums - ID: 2919296](http://sourceforge.net/tracker/index.php?func=detail&aid=2919296&group_id=4933&atid=104933)
> 
> If so, it might be fixed. I don't have access to maxima 5.26 to test.

It is fixed. (What's a big deal of having access to maxima 5.26? It compiles with ECL supplied with Sage 4.8):

```
$ ./maxima-local
;;; Loading #P"/usr/local/src/sage/sage-4.8.alpha4/local/lib/ecl-11.1.1/sb-bsd-sockets.fas"
;;; Loading #P"/usr/local/src/sage/sage-4.8.alpha4/local/lib/ecl-11.1.1/sockets.fas"
;;; Loading #P"/usr/local/src/sage/sage-4.8.alpha4/local/lib/ecl-11.1.1/defsystem.fas"
;;; Loading #P"/usr/local/src/sage/sage-4.8.alpha4/local/lib/ecl-11.1.1/cmp.fas"
Maxima 5.26.0_41_gbc6210e http://maxima.sourceforge.net
using Lisp ECL 11.1.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) load(simplify_sum);
(%o1)        /tmp/maxima/share/contrib/solve_rec/simplify_sum.mac
(%i2) simplify_sum(sum(binomial(n,k)*k^2,k,2,n));

                                 2       n
                               (n  + n) 2  - 4 n
(%o2)                          -----------------
                                       4
(%i3) 
```

Thus, we need to update maxima spkg to 5.26.

By the way, I never understood why sum() is hardcoded this way in Sage. Sometimes I'd rather use Python's sum(), but I don't know how to do this.



---

archive/issue_comments_102469.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,5 @@\n sage: sum (binomial(n,k)*k^2, k, 1, n)  # is right n(n+1)2^(n-2)\n sage: sum (binomial(n,k)*k^2, k, 2, n)  # is false : I get 0 \n ```\n+\n+This works correctly on Maxima 5.26 - we need to upgrade!\n``````\n",
    "created_at": "2012-02-27T01:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102469",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,5 @@
 sage: sum (binomial(n,k)*k^2, k, 1, n)  # is right n(n+1)2^(n-2)
 sage: sum (binomial(n,k)*k^2, k, 2, n)  # is false : I get 0 
 ```
+
+This works correctly on Maxima 5.26 - we need to upgrade!
``````




---

archive/issue_events_141624.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-02-27T01:46:06Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "title_is": "sum fails with lower bound != 0 or 1 (upgrade maxima to 5.26)",
    "title_was": "sum fails with lower bound != 0 or 1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141624"
}
```



---

archive/issue_comments_102470.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@dimpase](#comment:5):\n> Sometimes I'd rather use Python's sum(), but I don't know how to do this.\n\nThis is off-topic but a good question. It shows people don't think of checking the [python documentation](http://docs.python.org/library/__builtin__.html) for something like this, so perhaps a more prominent pointer is necessary\n\n```\nsage: import __builtin__\nsage: __builtin__.sum?\n...\nDocstring:\n    sum(sequence[, start]) -> value\n```\n> (What's a big deal of having access to maxima 5.26? It compiles with ECL supplied with Sage 4.8)\n\nI tried on sage.math.washington.edu with the 4.8 precompiled tarball there and it didn't work for me. Luckily there are other people more skilled at compiling maxima.",
    "created_at": "2012-02-27T03:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102470",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@dimpase](#comment:5):
> Sometimes I'd rather use Python's sum(), but I don't know how to do this.

This is off-topic but a good question. It shows people don't think of checking the [python documentation](http://docs.python.org/library/__builtin__.html) for something like this, so perhaps a more prominent pointer is necessary

```
sage: import __builtin__
sage: __builtin__.sum?
...
Docstring:
    sum(sequence[, start]) -> value
```
> (What's a big deal of having access to maxima 5.26? It compiles with ECL supplied with Sage 4.8)

I tried on sage.math.washington.edu with the 4.8 precompiled tarball there and it didn't work for me. Luckily there are other people more skilled at compiling maxima.



---

archive/issue_events_141625.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-02-27T09:41:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141625"
}
```



---

archive/issue_events_141626.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-02-27T09:41:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141626"
}
```



---

archive/issue_comments_102471.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,5 @@\n ```\n \n This works correctly on Maxima 5.26 - we need to upgrade!\n+The new spkg is [here](http://boxen.math.washington.edu/home/dima/packages/maxima-5.26.0.spkg).\n+Needs makeinfo to be installed at the moment (which should probably be disabled).\n``````\n",
    "created_at": "2012-02-27T09:41:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102471",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,5 @@
 ```
 
 This works correctly on Maxima 5.26 - we need to upgrade!
+The new spkg is [here](http://boxen.math.washington.edu/home/dima/packages/maxima-5.26.0.spkg).
+Needs makeinfo to be installed at the moment (which should probably be disabled).
``````




---

archive/issue_events_141627.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-02-27T09:41:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141627"
}
```



---

archive/issue_events_141628.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-02-27T09:41:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141628"
}
```



---

archive/issue_comments_102472.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,4 +9,3 @@\n \n This works correctly on Maxima 5.26 - we need to upgrade!\n The new spkg is [here](http://boxen.math.washington.edu/home/dima/packages/maxima-5.26.0.spkg).\n-Needs makeinfo to be installed at the moment (which should probably be disabled).\n``````\n",
    "created_at": "2012-02-27T22:44:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102472",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,4 +9,3 @@
 
 This works correctly on Maxima 5.26 - we need to upgrade!
 The new spkg is [here](http://boxen.math.washington.edu/home/dima/packages/maxima-5.26.0.spkg).
-Needs makeinfo to be installed at the moment (which should probably be disabled).
``````




---

archive/issue_comments_102473.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSeveral doctests need to be patched due to  changes in output format/term order. See\n[the log](http://boxen.math.washington.edu/home/dima/tmp/maxima5.26ptestlong.log).",
    "created_at": "2012-02-27T22:44:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102473",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

Several doctests need to be patched due to  changes in output format/term order. See
[the log](http://boxen.math.washington.edu/home/dima/tmp/maxima5.26ptestlong.log).



---

archive/issue_comments_102474.json:
```json
{
    "body": "Work Issues: **several doctests need to be patched due to  changes in output format/term order**",
    "created_at": "2012-02-27T22:44:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102474",
    "user": "https://github.com/dimpase"
}
```

Work Issues: **several doctests need to be patched due to  changes in output format/term order**



---

archive/issue_comments_102475.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@dimpase](#comment:10):\n> Several doctests need to be patched due to  changes in output format/term order. See\n> [the log](http://boxen.math.washington.edu/home/dima/tmp/maxima5.26ptestlong.log).\n\nThe first test failure, in `devel/sage/sage/matrix/matrix2.pyx`, actually shows that 5.26 has improved in quality of such computations. The error between the exact and .n() answers has decreased by several orders of magnitude. \nOne more reason for upgrade!",
    "created_at": "2012-02-27T23:34:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102475",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@dimpase](#comment:10):
> Several doctests need to be patched due to  changes in output format/term order. See
> [the log](http://boxen.math.washington.edu/home/dima/tmp/maxima5.26ptestlong.log).

The first test failure, in `devel/sage/sage/matrix/matrix2.pyx`, actually shows that 5.26 has improved in quality of such computations. The error between the exact and .n() answers has decreased by several orders of magnitude. 
One more reason for upgrade!



---

archive/issue_comments_102476.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@dimpase](#comment:12):\n\n> The first test failure, in `devel/sage/sage/matrix/matrix2.pyx`, actually shows that 5.26 has improved in quality of such computations. The error between the exact and .n() answers has decreased by several orders of magnitude. \n\nHere is the evidence (`a` is the matrix from the `matrix/matrix2.pyx`, line 10369,  test, `b` is the exact matrix). The following is with the new spkg: \n\n```\nsage: b=matrix([[1,pi],[100,1/100]])\nsage: a=matrix(RR,[[1.,pi.n()],[100.,.01]])\nsage: (a.exp()-b.exp()).norm()\n9.32525865157e-07\n```\n\nThe same computation on Sage 4.8 gives `(a.exp()-b.exp()).norm()` equal to `0.373383533611`",
    "created_at": "2012-02-27T23:55:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102476",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@dimpase](#comment:12):

> The first test failure, in `devel/sage/sage/matrix/matrix2.pyx`, actually shows that 5.26 has improved in quality of such computations. The error between the exact and .n() answers has decreased by several orders of magnitude. 

Here is the evidence (`a` is the matrix from the `matrix/matrix2.pyx`, line 10369,  test, `b` is the exact matrix). The following is with the new spkg: 

```
sage: b=matrix([[1,pi],[100,1/100]])
sage: a=matrix(RR,[[1.,pi.n()],[100.,.01]])
sage: (a.exp()-b.exp()).norm()
9.32525865157e-07
```

The same computation on Sage 4.8 gives `(a.exp()-b.exp()).norm()` equal to `0.373383533611`



---

archive/issue_comments_102477.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@dimpase](#comment:10):\n> Several doctests need to be patched due to  changes in output format/term order. See\n> [the log](http://boxen.math.washington.edu/home/dima/tmp/maxima5.26ptestlong.log).\n\nThe failure in calculus/desolvers.py is what kept me from upgrading straight to 5.26 (I settled for 5.24 instead).\n\nThe issue is somewhere in our maxima interface... if you try the commands in a maxima console, you get the correct (simple) answer. If you try them with `maxima._eval_line()`, you get the mess from the doctest.",
    "created_at": "2012-02-28T01:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102477",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@dimpase](#comment:10):
> Several doctests need to be patched due to  changes in output format/term order. See
> [the log](http://boxen.math.washington.edu/home/dima/tmp/maxima5.26ptestlong.log).

The failure in calculus/desolvers.py is what kept me from upgrading straight to 5.26 (I settled for 5.24 instead).

The issue is somewhere in our maxima interface... if you try the commands in a maxima console, you get the correct (simple) answer. If you try them with `maxima._eval_line()`, you get the mess from the doctest.



---

archive/issue_comments_102478.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@orlitzky](#comment:14):\n> Replying to [@dimpase](#comment:10):\n> > Several doctests need to be patched due to  changes in output format/term order. See\n> > [the log](http://boxen.math.washington.edu/home/dima/tmp/maxima5.26ptestlong.log).\n\n> \n> The failure in calculus/desolvers.py is what kept me from upgrading straight to 5.26 (I settled for 5.24 instead).\n> \n> The issue is somewhere in our maxima interface... if you try the commands in a maxima console, you get the correct (simple) answer. If you try them with `maxima._eval_line()`, you get the mess from the doctest.\n\nOK, this will need to be sorted out, and few other things. I am preparing the patch for most other, \"trivial\", failures, and will post it shortly.",
    "created_at": "2012-02-28T03:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102478",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@orlitzky](#comment:14):
> Replying to [@dimpase](#comment:10):
> > Several doctests need to be patched due to  changes in output format/term order. See
> > [the log](http://boxen.math.washington.edu/home/dima/tmp/maxima5.26ptestlong.log).

> 
> The failure in calculus/desolvers.py is what kept me from upgrading straight to 5.26 (I settled for 5.24 instead).
> 
> The issue is somewhere in our maxima interface... if you try the commands in a maxima console, you get the correct (simple) answer. If you try them with `maxima._eval_line()`, you get the mess from the doctest.

OK, this will need to be sorted out, and few other things. I am preparing the patch for most other, "trivial", failures, and will post it shortly.



---

archive/issue_comments_102479.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks for preparing the spkg, Dima! My problem was probably that I didn't rebuild ecl first. It works very well now. I think I found the culprit for the desolve problem:\n\n```\nMaxima 5.26.0 http://maxima.sourceforge.net\nusing Lisp ECL 11.1.1\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) display2d: false;\n\n(%o1) false\n(%i2) load('contrib_ode);\n\n(%o2) \"/mnt/usb1/scratch/nbruin/5.0/local/share/maxima/5.26.0/share/contrib/diffequations/contrib_ode.mac\"\n(%i3) domain : complex;\n\n(%o3) complex\n(%i4) assume(x>0);\n\n(%o4) [x > 0]\n(%i5) assume(y>0);\n\n(%o5) [y > 0]\n(%i6) contrib_ode(x*'diff(y,x,1)-x*sqrt(y^2+x^2)-y,y,x);\n\n(%o6) [(log((2*sqrt(4/x^2)*x^2*sqrt((4*y^4+4*x^2*y^2)/x^2)+8*y^2+4*x^2)/x^2)\n        -sqrt(4/x^2)*x*asinh(2*y^2/(x*sqrt(4*y^2)))\n        -sqrt(4/x^2)*x*asinh(2*y/sqrt(4*x^2))+sqrt(4/x^2)*x^2)\n        /(sqrt(4/x^2)*x)\n         = %c]\n(%i7) domain: real;\n\n(%o7) real\n(%i8) contrib_ode(x*'diff(y,x,1)-x*sqrt(y^2+x^2)-y,y,x);\n\n(%o8) [x-asinh(y/x) = %c]\n```\nso the problem is that we set \"domain: complex\" and apparently the behaviour of something there has changed. The assumptions x>0 and y>0 imply that x,y are real (and maxima's assume facility agrees with that), but as we are well aware, assumptions don't get used everywhere. At the very least, it seems that assumptions on variables do not affect all the things that \"domain: complex\" affects.",
    "created_at": "2012-02-28T05:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102479",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks for preparing the spkg, Dima! My problem was probably that I didn't rebuild ecl first. It works very well now. I think I found the culprit for the desolve problem:

```
Maxima 5.26.0 http://maxima.sourceforge.net
using Lisp ECL 11.1.1
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) display2d: false;

(%o1) false
(%i2) load('contrib_ode);

(%o2) "/mnt/usb1/scratch/nbruin/5.0/local/share/maxima/5.26.0/share/contrib/diffequations/contrib_ode.mac"
(%i3) domain : complex;

(%o3) complex
(%i4) assume(x>0);

(%o4) [x > 0]
(%i5) assume(y>0);

(%o5) [y > 0]
(%i6) contrib_ode(x*'diff(y,x,1)-x*sqrt(y^2+x^2)-y,y,x);

(%o6) [(log((2*sqrt(4/x^2)*x^2*sqrt((4*y^4+4*x^2*y^2)/x^2)+8*y^2+4*x^2)/x^2)
        -sqrt(4/x^2)*x*asinh(2*y^2/(x*sqrt(4*y^2)))
        -sqrt(4/x^2)*x*asinh(2*y/sqrt(4*x^2))+sqrt(4/x^2)*x^2)
        /(sqrt(4/x^2)*x)
         = %c]
(%i7) domain: real;

(%o7) real
(%i8) contrib_ode(x*'diff(y,x,1)-x*sqrt(y^2+x^2)-y,y,x);

(%o8) [x-asinh(y/x) = %c]
```
so the problem is that we set "domain: complex" and apparently the behaviour of something there has changed. The assumptions x>0 and y>0 imply that x,y are real (and maxima's assume facility agrees with that), but as we are well aware, assumptions don't get used everywhere. At the very least, it seems that assumptions on variables do not affect all the things that "domain: complex" affects.



---

archive/issue_comments_102480.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nthere still is a bug in \n\n```\nsage/functions/special.py\", line 1464:\n    sage: elliptic_e(z, 1)\nExpected:\n    sin(z)\nGot:\n    sin(z) + 2*round(z/pi)\n```\nNote that BOTH expected and the received values are wrong!\nThe right answer is `abs(sin(z)) + 2*round(z/pi)`\n\nDo you guys know how to report this upstream?\n\nDima",
    "created_at": "2012-02-28T08:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102480",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

there still is a bug in 

```
sage/functions/special.py", line 1464:
    sage: elliptic_e(z, 1)
Expected:
    sin(z)
Got:
    sin(z) + 2*round(z/pi)
```
Note that BOTH expected and the received values are wrong!
The right answer is `abs(sin(z)) + 2*round(z/pi)`

Do you guys know how to report this upstream?

Dima



---

archive/issue_comments_102481.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nto fix the problem in `sage/interfaces/maxima_lib.py`, printing extra `(false)`, I added the patch mentioned\n[here](https://groups.google.com/d/msg/sage-devel/tJwrHO9ipP4/aaHyktqvQesJ) to the spkg.\n\nIt fixes the problem. (I didn't want to mess with the unstable git version of Maxima, so we are applying the patch directly to \nthe stable Maxima 5.26.0).",
    "created_at": "2012-02-28T10:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102481",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

to fix the problem in `sage/interfaces/maxima_lib.py`, printing extra `(false)`, I added the patch mentioned
[here](https://groups.google.com/d/msg/sage-devel/tJwrHO9ipP4/aaHyktqvQesJ) to the spkg.

It fixes the problem. (I didn't want to mess with the unstable git version of Maxima, so we are applying the patch directly to 
the stable Maxima 5.26.0).



---

archive/issue_comments_102482.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nwith the attached patch, and (updated) spkg, only one failure remains when running `make ptestlong`:\n\n```\nsage -t  --long -force_lib devel/sage/sage/calculus/desolvers.py\n**********************************************************************\nFile \"/mnt/usb1/scratch/dima/sage-5.0.beta5/devel/sage-main/sage/calculus/desolvers.py\", line 358:\n    sage: desolve(x*diff(y,x)-x*sqrt(y^2+x^2)-y == 0, y, contrib_ode=True)\nExpected:\n    [x - arcsinh(y(x)/x) == c]\nGot:\n    [1/2*(2*x^2*sqrt(x^(-2)) - 2*x*sqrt(x^(-2))*arcsinh(y(x)/sqrt(x^2)) - 2*x*sqrt(x^(-2))*arcsinh(y(x)^2/(sqrt(y(x)^2)*x)) + log(4*(2*x^2*sqrt((x^2*y(x)^2 + y(x)^4)/x^2)*sqrt(x^(-2)) + x^2 + 2*y(x)^2)/x^2))/(x*sqrt(x^(-2))) == c]\n**********************************************************************\n1 items had failures:\n   1 of  59 in __main__.example_1\n***Test Failed*** 1 failures.\n```\n\nThis ought to be fixed by that complex/real domain thing described above by nbruin, but I don't know where this should be done.",
    "created_at": "2012-02-28T11:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102482",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

with the attached patch, and (updated) spkg, only one failure remains when running `make ptestlong`:

```
sage -t  --long -force_lib devel/sage/sage/calculus/desolvers.py
**********************************************************************
File "/mnt/usb1/scratch/dima/sage-5.0.beta5/devel/sage-main/sage/calculus/desolvers.py", line 358:
    sage: desolve(x*diff(y,x)-x*sqrt(y^2+x^2)-y == 0, y, contrib_ode=True)
Expected:
    [x - arcsinh(y(x)/x) == c]
Got:
    [1/2*(2*x^2*sqrt(x^(-2)) - 2*x*sqrt(x^(-2))*arcsinh(y(x)/sqrt(x^2)) - 2*x*sqrt(x^(-2))*arcsinh(y(x)^2/(sqrt(y(x)^2)*x)) + log(4*(2*x^2*sqrt((x^2*y(x)^2 + y(x)^4)/x^2)*sqrt(x^(-2)) + x^2 + 2*y(x)^2)/x^2))/(x*sqrt(x^(-2))) == c]
**********************************************************************
1 items had failures:
   1 of  59 in __main__.example_1
***Test Failed*** 1 failures.
```

This ought to be fixed by that complex/real domain thing described above by nbruin, but I don't know where this should be done.



---

archive/issue_comments_102483.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@nbruin](#comment:16):\n> Thanks for preparing the spkg, Dima! My problem was probably that I didn't rebuild ecl first. It works very well now. I think I found the culprit for the desolve problem:\n\n> so the problem is that we set \"domain: complex\" and apparently the behaviour of something there has changed. The assumptions x>0 and y>0 imply that x,y are real (and maxima's assume facility agrees with that), but as we are well aware, assumptions don't get used everywhere. At the very least, it seems that assumptions on variables do not affect all the things that \"domain: complex\" affects.\n\nShould we provide an option to do \"domain: real\" on the fly?\nI don't know the details of the maxima interface, but I imagine this is doable...\n\nDima",
    "created_at": "2012-02-29T05:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102483",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@nbruin](#comment:16):
> Thanks for preparing the spkg, Dima! My problem was probably that I didn't rebuild ecl first. It works very well now. I think I found the culprit for the desolve problem:

> so the problem is that we set "domain: complex" and apparently the behaviour of something there has changed. The assumptions x>0 and y>0 imply that x,y are real (and maxima's assume facility agrees with that), but as we are well aware, assumptions don't get used everywhere. At the very least, it seems that assumptions on variables do not affect all the things that "domain: complex" affects.

Should we provide an option to do "domain: real" on the fly?
I don't know the details of the maxima interface, but I imagine this is doable...

Dima



---

archive/issue_comments_102484.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHere is the patch I propose for `calculus/desolvers.py`:\n\n```\n68c68\n< def desolve(de, dvar, ics=None, ivar=None, show_method=False, contrib_ode=False, domain='complex'):\n---\n> def desolve(de, dvar, ics=None, ivar=None, show_method=False, contrib_ode=False):\n113,115d112\n<     - ``domain`` - (optional) specifies the domain to use to solve the ODE.\n<       By default it is complex numbers; setting domain='real' will make it real numbers.\n<       It corresponds to Maxima's 'domain : complex;' or, respectively, 'domain : real;' \n361,365d357\n<         sage: desolve(x*diff(y,x)-x*sqrt(y^2+x^2)-y == 0, y, contrib_ode=True, domain='real')\n<         [x - arcsinh(y(x)/x) == c]\n< \n<     Trac #10682 updated Maxima to 5.26, and it started to show a different solution in the complex domain for the ODE above::\n< \n367,368c359,360\n<         [1/2*(2*x^2*sqrt(x^(-2)) - 2*x*sqrt(x^(-2))*arcsinh(y(x)/sqrt(x^2)) - 2*x*sqrt(x^(-2))*arcsinh(y(x)^2/(sqrt(y(x)^2)*x)) + log(4*(2*x^2*sqrt((x^2*y(x)^2 + y(x)^4)/x^2)*sqrt(x^(-2)) + x^2 + 2*y(x)^2)/x^2))/(x*sqrt(x^(-2))) == c] \n< \n---\n>         [x - arcsinh(y(x)/x) == c]\n>     \n428d419\n<     P(\"domain : \"+domain)\n```\n\nIt gives deslove() one more optional parameter `domain`, which takes care of this new discrepancy with this ODE.\nI'll update the whole patch shortly, test, and then expect the ticket to be ready for review.",
    "created_at": "2012-02-29T10:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102484",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Here is the patch I propose for `calculus/desolvers.py`:

```
68c68
< def desolve(de, dvar, ics=None, ivar=None, show_method=False, contrib_ode=False, domain='complex'):
---
> def desolve(de, dvar, ics=None, ivar=None, show_method=False, contrib_ode=False):
113,115d112
<     - ``domain`` - (optional) specifies the domain to use to solve the ODE.
<       By default it is complex numbers; setting domain='real' will make it real numbers.
<       It corresponds to Maxima's 'domain : complex;' or, respectively, 'domain : real;' 
361,365d357
<         sage: desolve(x*diff(y,x)-x*sqrt(y^2+x^2)-y == 0, y, contrib_ode=True, domain='real')
<         [x - arcsinh(y(x)/x) == c]
< 
<     Trac #10682 updated Maxima to 5.26, and it started to show a different solution in the complex domain for the ODE above::
< 
367,368c359,360
<         [1/2*(2*x^2*sqrt(x^(-2)) - 2*x*sqrt(x^(-2))*arcsinh(y(x)/sqrt(x^2)) - 2*x*sqrt(x^(-2))*arcsinh(y(x)^2/(sqrt(y(x)^2)*x)) + log(4*(2*x^2*sqrt((x^2*y(x)^2 + y(x)^4)/x^2)*sqrt(x^(-2)) + x^2 + 2*y(x)^2)/x^2))/(x*sqrt(x^(-2))) == c] 
< 
---
>         [x - arcsinh(y(x)/x) == c]
>     
428d419
<     P("domain : "+domain)
```

It gives deslove() one more optional parameter `domain`, which takes care of this new discrepancy with this ODE.
I'll update the whole patch shortly, test, and then expect the ticket to be ready for review.



---

archive/issue_events_141629.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-02-29T11:27:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141629"
}
```



---

archive/issue_events_141630.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-02-29T11:27:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141630"
}
```



---

archive/issue_comments_102485.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,5 @@\n \n This works correctly on Maxima 5.26 - we need to upgrade!\n The new spkg is [here](http://boxen.math.washington.edu/home/dima/packages/maxima-5.26.0.spkg).\n+\n+Install the spkg and apply the patch.\n``````\n",
    "created_at": "2012-02-29T11:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102485",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,5 @@
 
 This works correctly on Maxima 5.26 - we need to upgrade!
 The new spkg is [here](http://boxen.math.washington.edu/home/dima/packages/maxima-5.26.0.spkg).
+
+Install the spkg and apply the patch.
``````




---

archive/issue_comments_102486.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nCould you please post a diff between the new and old spkg's here?\n\nJust for review of course.",
    "created_at": "2012-02-29T12:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102486",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:23" align="right">comment:23</div>

Could you please post a diff between the new and old spkg's here?

Just for review of course.



---

archive/issue_events_141631.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-29T12:32:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141631"
}
```



---

archive/issue_events_141632.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-29T12:32:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141632"
}
```



---

archive/issue_comments_102487.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAs far as the Sage patch is concerned, it would be nice to limit the length of code lines to 79 characters.\n\nFor example, in sage/symbolic/relation.py you corrected the output but put everything on one line, which is not very readable in 80 char terminals.\n\nThe error in f.nintegal() should definitely raise an Error. Letting it output of tuple of reals is wrong. I'll try to locate where this should take place if you have no time or no idea.",
    "created_at": "2012-02-29T12:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102487",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:24" align="right">comment:24</div>

As far as the Sage patch is concerned, it would be nice to limit the length of code lines to 79 characters.

For example, in sage/symbolic/relation.py you corrected the output but put everything on one line, which is not very readable in 80 char terminals.

The error in f.nintegal() should definitely raise an Error. Letting it output of tuple of reals is wrong. I'll try to locate where this should take place if you have no time or no idea.



---

archive/issue_comments_102488.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jpflori](#comment:23):\n> Could you please post a diff between the new and old spkg's here?\n> \n> Just for review of course.\n\nHere it is (and of course I took the current maxima release 5.26.0-source from sf.net and replaced src/ with it, and then \nran the script `spkg-dist`)\n\n```\n$ hg diff -r tip -r 35\ndiff --git a/SPKG.txt b/SPKG.txt\n--- a/SPKG.txt\n+++ b/SPKG.txt\n@@ -40,11 +40,6 @@\n \n == Changelog ==\n \n-=== maxima-5.26.0 (Dima Pasechnik, February 28th 2012) ===\n- * upgrading to version 5.26.0 to take care of #10682.\n- * added patch/comm.patch to fix Maxima bug #3484414. \n-   (false) precedes the display output if display2d is set to false.\n-\n === maxima-5.24.0.p0 (Michael Orlitzky, January 29th 2012) ===\n  * Trac #12094: Version bump to prevent a regression with the\n    abs_integrate package.\ndiff --git a/patches/comm.patch b/patches/comm.patch\ndeleted file mode 100644\n--- a/patches/comm.patch\n+++ /dev/null\n@@ -1,12 +0,0 @@\n---- src/src/comm.lisp  \n-+++ src/src/comm.lisp   \n-@@ -753,7 +753,9 @@\n-        (setq ans (list '(mequal simp) (disp2 l) ans)))\n-     (if lablist (nconc lablist (cons (elabel ans) nil)))\n-     (setq tim (get-internal-run-time))\n--    (displa (list '(mlable) (if lablist linelable) ans))\n-+    (let ((*display-labels-p* nil))\n-+      (declare (special *display-labels-p*))\n-+      (displa (list '(mlable) (if lablist linelable) ans)))\n-     (mterpri)\n-     (timeorg tim)))\n```",
    "created_at": "2012-02-29T12:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102488",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jpflori](#comment:23):
> Could you please post a diff between the new and old spkg's here?
> 
> Just for review of course.

Here it is (and of course I took the current maxima release 5.26.0-source from sf.net and replaced src/ with it, and then 
ran the script `spkg-dist`)

```
$ hg diff -r tip -r 35
diff --git a/SPKG.txt b/SPKG.txt
--- a/SPKG.txt
+++ b/SPKG.txt
@@ -40,11 +40,6 @@
 
 == Changelog ==
 
-=== maxima-5.26.0 (Dima Pasechnik, February 28th 2012) ===
- * upgrading to version 5.26.0 to take care of #10682.
- * added patch/comm.patch to fix Maxima bug #3484414. 
-   (false) precedes the display output if display2d is set to false.
-
 === maxima-5.24.0.p0 (Michael Orlitzky, January 29th 2012) ===
  * Trac #12094: Version bump to prevent a regression with the
    abs_integrate package.
diff --git a/patches/comm.patch b/patches/comm.patch
deleted file mode 100644
--- a/patches/comm.patch
+++ /dev/null
@@ -1,12 +0,0 @@
---- src/src/comm.lisp  
-+++ src/src/comm.lisp   
-@@ -753,7 +753,9 @@
-        (setq ans (list '(mequal simp) (disp2 l) ans)))
-     (if lablist (nconc lablist (cons (elabel ans) nil)))
-     (setq tim (get-internal-run-time))
--    (displa (list '(mlable) (if lablist linelable) ans))
-+    (let ((*display-labels-p* nil))
-+      (declare (special *display-labels-p*))
-+      (displa (list '(mlable) (if lablist linelable) ans)))
-     (mterpri)
-     (timeorg tim)))
```



---

archive/issue_comments_102489.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jpflori](#comment:24):\n> As far as the Sage patch is concerned, it would be nice to limit the length of code lines to 79 characters.\n> \n> For example, in sage/symbolic/relation.py you corrected the output but put everything on one line, which is not very readable in 80 char terminals.\n\noops, OK, I somehow had trouble splitting lines, and thought that the doctests framework doesn't quite allow this.\nWhat is the syntax? Will it just ignore '\\n', anywhere ?\n\n> \n> The error in f.nintegal() should definitely raise an Error. Letting it output of tuple of reals is wrong. I'll try to locate where this should take place if you have no time or no idea.\n\nAre you saying that this \"error code\"=6 is a new addition in Maxima, and is not properly handled by the Sage interface?",
    "created_at": "2012-02-29T12:53:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102489",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jpflori](#comment:24):
> As far as the Sage patch is concerned, it would be nice to limit the length of code lines to 79 characters.
> 
> For example, in sage/symbolic/relation.py you corrected the output but put everything on one line, which is not very readable in 80 char terminals.

oops, OK, I somehow had trouble splitting lines, and thought that the doctests framework doesn't quite allow this.
What is the syntax? Will it just ignore '\n', anywhere ?

> 
> The error in f.nintegal() should definitely raise an Error. Letting it output of tuple of reals is wrong. I'll try to locate where this should take place if you have no time or no idea.

Are you saying that this "error code"=6 is a new addition in Maxima, and is not properly handled by the Sage interface?



---

archive/issue_comments_102490.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@dimpase](#comment:26):\n\n> oops, OK, I somehow had trouble splitting lines, and thought that the doctests framework doesn't quite allow this. What is the syntax? Will it just ignore '\\n', anywhere ?\n\nI think that you can more or less split where there is a space.\n\nYou can just copy what used to be done for the previous examples.\n\n> Are you saying that this \"error code\"=6 is a new addition in Maxima, and is not properly handled by the Sage interface?\n\nI'm not sure that this is new, but:\n\n* Sage used to return a ValueError so I guess that it used to catch a Maxima error and translate it\n* So it seems that Maxima's behavior has changed even though the \"6\" case used to be there, maybe a Maxima expert could tell us why this was decided. Anyhow, your fix might be the right one then...\n\nA last comment, in your modification to desolve() you modify the domain var of Maxima.\n\nSo if I use domain=real with your code, then all of Maxima will use domain=real afterwards.\n\nMaybe we'd better set back domain to whatever it was worth before at the end of the computation.",
    "created_at": "2012-02-29T13:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102490",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@dimpase](#comment:26):

> oops, OK, I somehow had trouble splitting lines, and thought that the doctests framework doesn't quite allow this. What is the syntax? Will it just ignore '\n', anywhere ?

I think that you can more or less split where there is a space.

You can just copy what used to be done for the previous examples.

> Are you saying that this "error code"=6 is a new addition in Maxima, and is not properly handled by the Sage interface?

I'm not sure that this is new, but:

* Sage used to return a ValueError so I guess that it used to catch a Maxima error and translate it
* So it seems that Maxima's behavior has changed even though the "6" case used to be there, maybe a Maxima expert could tell us why this was decided. Anyhow, your fix might be the right one then...

A last comment, in your modification to desolve() you modify the domain var of Maxima.

So if I use domain=real with your code, then all of Maxima will use domain=real afterwards.

Maybe we'd better set back domain to whatever it was worth before at the end of the computation.



---

archive/issue_comments_102491.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nBy the way the upstream tarball does not seem to include the latest changelogs.",
    "created_at": "2012-02-29T13:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102491",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:28" align="right">comment:28</div>

By the way the upstream tarball does not seem to include the latest changelogs.



---

archive/issue_comments_102492.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n> A last comment, in your modification to desolve() you modify the domain var of Maxima.\n> \n> So if I use domain=real with your code, then all of Maxima will use domain=real afterwards.\n> \n> Maybe we'd better set back domain to whatever it was worth before at the end of the computation.\n\nYes, definitely.  I'd be surprised if this didn't cause doctest failures otherwise, since we have `domain:complex` because it made other things work in the past.  Otherwise this is a good solution, I think, and gives the user more access to Maxima's flexibility without too much effort, which is a good thing.",
    "created_at": "2012-02-29T13:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102492",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:29" align="right">comment:29</div>

> A last comment, in your modification to desolve() you modify the domain var of Maxima.
> 
> So if I use domain=real with your code, then all of Maxima will use domain=real afterwards.
> 
> Maybe we'd better set back domain to whatever it was worth before at the end of the computation.

Yes, definitely.  I'd be surprised if this didn't cause doctest failures otherwise, since we have `domain:complex` because it made other things work in the past.  Otherwise this is a good solution, I think, and gives the user more access to Maxima's flexibility without too much effort, which is a good thing.



---

archive/issue_comments_102493.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nWhat I told was wrong for the \"6\" stuff.\n\nIn fact, Maxima used to return the expression unmodified when the  precision was too high, now it behaves correctly, so I'm happy with your  fix.\n\nHowever, we could rid of some of the error handling in nintegral and  mention (and before that find...) the corresponding commit in maxima git  tree.",
    "created_at": "2012-02-29T13:54:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102493",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:30" align="right">comment:30</div>

What I told was wrong for the "6" stuff.

In fact, Maxima used to return the expression unmodified when the  precision was too high, now it behaves correctly, so I'm happy with your  fix.

However, we could rid of some of the error handling in nintegral and  mention (and before that find...) the corresponding commit in maxima git  tree.



---

archive/issue_comments_102494.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI think it would be nice if we handled this automatically rather than requiring the user to know about the internals of solution/simplification. I mean, none of *us* knew what the problem was until Nils pointed it out.\n\nMy understanding is that we default to `domain: complex` because it will make the fewest invalid simplifications and is compatible with pynac. In general, that's the right thing to do. But here? We know that *all* of the variables in the system are real, from the assumption that x,y>0.\n\nWhy not just set the domain to real in that case?\n\n(I think we should add something like a `set_domain_real` method to maxima_lib either way to make this cleaner.)",
    "created_at": "2012-02-29T14:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102494",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:31" align="right">comment:31</div>

I think it would be nice if we handled this automatically rather than requiring the user to know about the internals of solution/simplification. I mean, none of *us* knew what the problem was until Nils pointed it out.

My understanding is that we default to `domain: complex` because it will make the fewest invalid simplifications and is compatible with pynac. In general, that's the right thing to do. But here? We know that *all* of the variables in the system are real, from the assumption that x,y>0.

Why not just set the domain to real in that case?

(I think we should add something like a `set_domain_real` method to maxima_lib either way to make this cleaner.)



---

archive/issue_comments_102495.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nIf we just rely on assumptions of the form 'x > 0', it should not be too complicated to check that all variables are supposed to be real.\n\nAnyway, isn't there something in Maxima which \"knows\" that a variable is real after such assumptions ?\n\nIf that is the case, its current behavior could be considered quite strange.",
    "created_at": "2012-02-29T16:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102495",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:32" align="right">comment:32</div>

If we just rely on assumptions of the form 'x > 0', it should not be too complicated to check that all variables are supposed to be real.

Anyway, isn't there something in Maxima which "knows" that a variable is real after such assumptions ?

If that is the case, its current behavior could be considered quite strange.



---

archive/issue_comments_102496.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@jpflori](#comment:32):\n> If we just rely on assumptions of the form 'x > 0', it should not be too complicated to check that all variables are supposed to be real.\n> \n> Anyway, isn't there something in Maxima which \"knows\" that a variable is real after such assumptions ?\n\nIf I understand correctly, Maxima and assumptions play weakly together.  They are ignored in a lot of \"dummy variable\" contexts like solving and integration.  So maybe here too.\n\nInterestingly, our GSL numerical ODE solvers seem to only have real domains (see [this ask.sagemath.org question](http://ask.sagemath.org/question/1156/ode_solver-unable-to-convert-to-float), I can't verify this independently), so maybe we could instead just *always* change to `domain:real` for ODE and then convert back when done... these are all hacks, but some hacks are better than others.",
    "created_at": "2012-02-29T17:59:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102496",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@jpflori](#comment:32):
> If we just rely on assumptions of the form 'x > 0', it should not be too complicated to check that all variables are supposed to be real.
> 
> Anyway, isn't there something in Maxima which "knows" that a variable is real after such assumptions ?

If I understand correctly, Maxima and assumptions play weakly together.  They are ignored in a lot of "dummy variable" contexts like solving and integration.  So maybe here too.

Interestingly, our GSL numerical ODE solvers seem to only have real domains (see [this ask.sagemath.org question](http://ask.sagemath.org/question/1156/ode_solver-unable-to-convert-to-float), I can't verify this independently), so maybe we could instead just *always* change to `domain:real` for ODE and then convert back when done... these are all hacks, but some hacks are better than others.



---

archive/issue_comments_102497.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nFor the assumptions, we don't necessarily need maxima to recognize them. If the user tells us that `x>0`, then we should be able to set `domain: real` whether or not maxima is going to use that information.\n\nIn simplification, I gather that maxima doesn't really know about real/complex. The docs simply say,\n\n```\nOption variable: domain\n\n    Default value: real\n\n    When domain is set to complex, sqrt (x^2) will remain sqrt (x^2) instead of returning abs(x).\n```\n\nThey used to add,\n\n```\nThe notion of a \"domain\" of simplification is still in its infancy, and controls little more than this at the moment. \n```\n\nI think we should leave the default `complex` to be on the safe side. We could strictly improve some things by checking the assumptions, though. There are a few easy cases that we should be able to handle safely:\n\n1. assume(`x`, 'real')\n2. assume(`x` > constant)\n3. assume(`x` > `y`) (where `y` is known to be real by similar reasoning)\n4. et cetera\n\nIf all variables in an expression are determined to be real, we can set `domain: real` before asking maxima to do anything with it.",
    "created_at": "2012-02-29T19:33:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102497",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:34" align="right">comment:34</div>

For the assumptions, we don't necessarily need maxima to recognize them. If the user tells us that `x>0`, then we should be able to set `domain: real` whether or not maxima is going to use that information.

In simplification, I gather that maxima doesn't really know about real/complex. The docs simply say,

```
Option variable: domain

    Default value: real

    When domain is set to complex, sqrt (x^2) will remain sqrt (x^2) instead of returning abs(x).
```

They used to add,

```
The notion of a "domain" of simplification is still in its infancy, and controls little more than this at the moment. 
```

I think we should leave the default `complex` to be on the safe side. We could strictly improve some things by checking the assumptions, though. There are a few easy cases that we should be able to handle safely:

1. assume(`x`, 'real')
2. assume(`x` > constant)
3. assume(`x` > `y`) (where `y` is known to be real by similar reasoning)
4. et cetera

If all variables in an expression are determined to be real, we can set `domain: real` before asking maxima to do anything with it.



---

archive/issue_comments_102498.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nGood points. That being said, if the DE is one that is more complicated, and some nasty expression plays the role that `x` does here, we don't want to try to figure out if that expression is real or not.",
    "created_at": "2012-02-29T19:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102498",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:35" align="right">comment:35</div>

Good points. That being said, if the DE is one that is more complicated, and some nasty expression plays the role that `x` does here, we don't want to try to figure out if that expression is real or not.



---

archive/issue_comments_102499.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@kcrisman](#comment:35):\n> Good points. That being said, if the DE is one that is more complicated, and some nasty expression plays the role that `x` does here, we don't want to try to figure out if that expression is real or not.\n\nI thing we should not try to do our own processing of assume()'s at this point. On another ticket, maybe. \n\nRegarding the domain switch, I simply could not find a place to hook it up, as an independent call, instead opting for desolve() to have an extra parameter. If you read desolve() code you see that it digs up the maxima instance to call, as the parent of the expression. I could not find an independent, \"global\" hook to call maxima, and it seems that it might not even be exposed.  It seems that the original design aimed at possibly many independent maxima instances to be run. \n\nBy the way, the call of desolve with domain='complex', (or just with domain omitted) will reset the domain back to complex. As such, this gives one a way to control the domain, something that was missing in the maxima interface before (although it is a hack).\n\nAny thoughts on this?",
    "created_at": "2012-02-29T20:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102499",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@kcrisman](#comment:35):
> Good points. That being said, if the DE is one that is more complicated, and some nasty expression plays the role that `x` does here, we don't want to try to figure out if that expression is real or not.

I thing we should not try to do our own processing of assume()'s at this point. On another ticket, maybe. 

Regarding the domain switch, I simply could not find a place to hook it up, as an independent call, instead opting for desolve() to have an extra parameter. If you read desolve() code you see that it digs up the maxima instance to call, as the parent of the expression. I could not find an independent, "global" hook to call maxima, and it seems that it might not even be exposed.  It seems that the original design aimed at possibly many independent maxima instances to be run. 

By the way, the call of desolve with domain='complex', (or just with domain omitted) will reset the domain back to complex. As such, this gives one a way to control the domain, something that was missing in the maxima interface before (although it is a hack).

Any thoughts on this?



---

archive/issue_comments_102500.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n> Regarding the domain switch, I simply could not find a place to hook it up, as an independent call, instead opting for desolve() to have an extra parameter. If you read desolve() code you see that it digs up the maxima instance to call, as the parent of the expression. I could not find an independent, \"global\" hook to call maxima, and it seems that it might not even be exposed.  It seems that the original design aimed at possibly many independent maxima instances to be run. \n\nYes, and still is.  But you should be able to import `sage.calculus.calculus.maxima` and the like.\n\n```\nsage: sage.calculus.calculus.maxima('domain')\ncomplex\nsage: sage.calculus.calculus.maxima('domain:real')\nreal\nsage: sage.calculus.calculus.maxima('domain')\nreal\nsage: sage.calculus.calculus.maxima('domain:complex')\ncomplex\nsage: sage.calculus.calculus.maxima('domain')\ncomplex\n```",
    "created_at": "2012-02-29T20:24:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102500",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:37" align="right">comment:37</div>

> Regarding the domain switch, I simply could not find a place to hook it up, as an independent call, instead opting for desolve() to have an extra parameter. If you read desolve() code you see that it digs up the maxima instance to call, as the parent of the expression. I could not find an independent, "global" hook to call maxima, and it seems that it might not even be exposed.  It seems that the original design aimed at possibly many independent maxima instances to be run. 

Yes, and still is.  But you should be able to import `sage.calculus.calculus.maxima` and the like.

```
sage: sage.calculus.calculus.maxima('domain')
complex
sage: sage.calculus.calculus.maxima('domain:real')
real
sage: sage.calculus.calculus.maxima('domain')
real
sage: sage.calculus.calculus.maxima('domain:complex')
complex
sage: sage.calculus.calculus.maxima('domain')
complex
```



---

archive/issue_comments_102501.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@kcrisman](#comment:37):\n> > Regarding the domain switch, I simply could not find a place to hook it up, as an independent call, instead opting for desolve() to have an extra parameter. If you read desolve() code you see that it digs up the maxima instance to call, as the parent of the expression. I could not find an independent, \"global\" hook to call maxima, and it seems that it might not even be exposed.  It seems that the original design aimed at possibly many independent maxima instances to be run. \n\n> \n> Yes, and still is.  But you should be able to import `sage.calculus.calculus.maxima` and the like.\n\nI think I experimented with something like this, and switching domain this way had no effect! But I might be wrong. I'll recheck. We'll be travelling NZ-Singapore in the coming 16 hours, so it would take time.",
    "created_at": "2012-02-29T20:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102501",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@kcrisman](#comment:37):
> > Regarding the domain switch, I simply could not find a place to hook it up, as an independent call, instead opting for desolve() to have an extra parameter. If you read desolve() code you see that it digs up the maxima instance to call, as the parent of the expression. I could not find an independent, "global" hook to call maxima, and it seems that it might not even be exposed.  It seems that the original design aimed at possibly many independent maxima instances to be run. 

> 
> Yes, and still is.  But you should be able to import `sage.calculus.calculus.maxima` and the like.

I think I experimented with something like this, and switching domain this way had no effect! But I might be wrong. I'll recheck. We'll be travelling NZ-Singapore in the coming 16 hours, so it would take time.



---

archive/issue_comments_102502.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nWe might as well just add `domain` as a `@`property on maxima_lib. That way we can do,\n\n```\nold_domain = maxima.domain\nmaxima.domain = 'real'\nresult = perform_things()\nmaxima.domain = old_domain\nreturn result\n```",
    "created_at": "2012-02-29T20:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102502",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:39" align="right">comment:39</div>

We might as well just add `domain` as a `@`property on maxima_lib. That way we can do,

```
old_domain = maxima.domain
maxima.domain = 'real'
result = perform_things()
maxima.domain = old_domain
return result
```



---

archive/issue_comments_102503.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@jpflori](#comment:32):\n> Anyway, isn't there something in Maxima which \"knows\" that a variable is real after such assumptions ?\n\nIt's just a little weak in its deductions:\n\n```\n(%i1) domain: complex;\n(%o1)                               complex\n(%i2) display2d: false;\n(%o2) false\n(%i3) sqrt(x^2);\n(%o3) sqrt(x^2)\n(%i4) assume(x>0);\n(%o4) [x > 0]\n(%i5) sqrt(x^2);\n(%o5) x\n(%i6) sqrt(4/x^2);\n(%o6) sqrt(4/x^2)\n(%i7) domain:real;\n(%o7) real\n(%i8) sqrt(4/x^2);\n(%o8) 2/x\n```\nIt is ingrained now that the calculus maxima runs with `domain: complex`, so if you want to temporarily switch to `domain: real`, you should switch back afterwards. In principle this could play havoc with multiple threads, but maxima is not threadsafe anyway and our signal management isn't compatible with ECL's ideas of dealing with threads either. So, if in `desolve` (conditional on domain=\"real\") we just do:\n\n```\nP(\"load('contrib_ode)\")\n...\ntry:\n    P(\"domain: real\")\n    soln = P(cmd)\nfinally:\n    P(\"domain: complex\")\n```\nwe should be fine (the \"try ... finally\" should guard that we end up with `domain: complex`). I don't think performance is a concern if we're doing a \"load\" every time anyway!.",
    "created_at": "2012-02-29T21:16:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102503",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@jpflori](#comment:32):
> Anyway, isn't there something in Maxima which "knows" that a variable is real after such assumptions ?

It's just a little weak in its deductions:

```
(%i1) domain: complex;
(%o1)                               complex
(%i2) display2d: false;
(%o2) false
(%i3) sqrt(x^2);
(%o3) sqrt(x^2)
(%i4) assume(x>0);
(%o4) [x > 0]
(%i5) sqrt(x^2);
(%o5) x
(%i6) sqrt(4/x^2);
(%o6) sqrt(4/x^2)
(%i7) domain:real;
(%o7) real
(%i8) sqrt(4/x^2);
(%o8) 2/x
```
It is ingrained now that the calculus maxima runs with `domain: complex`, so if you want to temporarily switch to `domain: real`, you should switch back afterwards. In principle this could play havoc with multiple threads, but maxima is not threadsafe anyway and our signal management isn't compatible with ECL's ideas of dealing with threads either. So, if in `desolve` (conditional on domain="real") we just do:

```
P("load('contrib_ode)")
...
try:
    P("domain: real")
    soln = P(cmd)
finally:
    P("domain: complex")
```
we should be fine (the "try ... finally" should guard that we end up with `domain: complex`). I don't think performance is a concern if we're doing a "load" every time anyway!.



---

archive/issue_comments_102504.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@nbruin](#comment:40):\n\n> ideas of dealing with threads either. So, if in `desolve` (conditional on domain=\"real\") we just do: ` P(\"load('contrib_ode)\") ... try: P(\"domain: real\") soln = P(cmd) finally: P(\"domain: complex\") ` we should be fine (the \"try ... finally\" should guard that we end up with `domain: complex`). I don't think performance is a concern if we're doing a \"load\" every time anyway!.^^\n\nThat's the kind of solution I would propose.\n\nAs far as the Maxima instance is concerned, you get it through the ._maxima_().parent() call in nintegral(...) and it happens to be the unique library instance of Maxima (which is currently used for all the calculus stuff). In particular, a call to nintegral should not modify its settings.\n\nTo refine Nils answer, Id say that in try we set domain to the option passed and in \"finally\" we should restore the previous value of domain which could be \"real\"rather than \"complex\" if the user decided to change it globally.\n\nTo get the previous value something like str(P('domain').strip(' ') would do at the Sage level although this is kind of dirty (and surely slow)",
    "created_at": "2012-02-29T22:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102504",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@nbruin](#comment:40):

> ideas of dealing with threads either. So, if in `desolve` (conditional on domain="real") we just do: ` P("load('contrib_ode)") ... try: P("domain: real") soln = P(cmd) finally: P("domain: complex") ` we should be fine (the "try ... finally" should guard that we end up with `domain: complex`). I don't think performance is a concern if we're doing a "load" every time anyway!.^^

That's the kind of solution I would propose.

As far as the Maxima instance is concerned, you get it through the ._maxima_().parent() call in nintegral(...) and it happens to be the unique library instance of Maxima (which is currently used for all the calculus stuff). In particular, a call to nintegral should not modify its settings.

To refine Nils answer, Id say that in try we set domain to the option passed and in "finally" we should restore the previous value of domain which could be "real"rather than "complex" if the user decided to change it globally.

To get the previous value something like str(P('domain').strip(' ') would do at the Sage level although this is kind of dirty (and surely slow)



---

archive/issue_events_141633.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-01T15:51:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141633"
}
```



---

archive/issue_events_141634.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-01T15:51:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141634"
}
```



---

archive/issue_comments_102505.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nplease review the revised patch. I have fixed the formatting problems and removed the `domain` parameter (which I added in the previous version of the patch) from `desolve().`\n\nInstead, I simply call `sage: sage.calculus.calculus.maxima('domain:real')`\nand `sage: sage.calculus.calculus.maxima('domain:complex')` in the docstest.\nThis works just as well.",
    "created_at": "2012-03-01T15:51:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102505",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

please review the revised patch. I have fixed the formatting problems and removed the `domain` parameter (which I added in the previous version of the patch) from `desolve().`

Instead, I simply call `sage: sage.calculus.calculus.maxima('domain:real')`
and `sage: sage.calculus.calculus.maxima('domain:complex')` in the docstest.
This works just as well.



---

archive/issue_comments_102506.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI would rather follow Nils approach and at least include a try/finally statement in cas an error is raised.\n\nDoing so, we're sure not to let the domain set to real after leaving the function because of an error.\n\nThen, you'd better use \"P\" already present in the code rather than sage.calculus.calculs.maxima so that you're sure to use the same maxima as the one that will be used for solving the equation. Currently it's equivalent, but if something else changes in the future, such a choice will make everything easier.\n\nFinally, on my side, I'd really prefer first to use the option approach you already implemented, and then to bakup the previous value of domain and set it back in the finally statement (rather than setting it to complex all the time).*\n\nIf you want to do it more cleanly, you can use\n\n```\ndef desolve(..., domain='real')\n    ...\n    olddomain=P.get('domain')\n    P.set('domain',domain)\n    ...\n    try:\n        ...\n    finally:\n        P.set('domain',olddomain)\n    ...\n\n```\nrather than P('domain :'+str)\n\nAnd the error handling at the end of nintegral should definitely be reworked.\n\nFor example the test \"if 'quad_qags' in str(v)\" is useless now that Maxima behavior has changed.\n\nMoreover, I'm not sure the \"ERROR in srt(err)\" can ever be reached now (was it before???).\n\nI could not locate the commit corresponding to this change although I tried a little hard. Maxima source tree is a little obscure for me. This commit should be mentionned in the doc and would help to answer the two above remarks about error handling. Some expert of Maxima is needed for that.\n\nA last question is to know what we do when nintegral returns an error code.\n\nDo we let the situation as is? Or do we raise an error. I would agrre that this should be treated in another ticket, but I also don't think there is a better choice to make. Some discussion should happen.",
    "created_at": "2012-03-01T16:14:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102506",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:43" align="right">comment:43</div>

I would rather follow Nils approach and at least include a try/finally statement in cas an error is raised.

Doing so, we're sure not to let the domain set to real after leaving the function because of an error.

Then, you'd better use "P" already present in the code rather than sage.calculus.calculs.maxima so that you're sure to use the same maxima as the one that will be used for solving the equation. Currently it's equivalent, but if something else changes in the future, such a choice will make everything easier.

Finally, on my side, I'd really prefer first to use the option approach you already implemented, and then to bakup the previous value of domain and set it back in the finally statement (rather than setting it to complex all the time).*

If you want to do it more cleanly, you can use

```
def desolve(..., domain='real')
    ...
    olddomain=P.get('domain')
    P.set('domain',domain)
    ...
    try:
        ...
    finally:
        P.set('domain',olddomain)
    ...

```
rather than P('domain :'+str)

And the error handling at the end of nintegral should definitely be reworked.

For example the test "if 'quad_qags' in str(v)" is useless now that Maxima behavior has changed.

Moreover, I'm not sure the "ERROR in srt(err)" can ever be reached now (was it before???).

I could not locate the commit corresponding to this change although I tried a little hard. Maxima source tree is a little obscure for me. This commit should be mentionned in the doc and would help to answer the two above remarks about error handling. Some expert of Maxima is needed for that.

A last question is to know what we do when nintegral returns an error code.

Do we let the situation as is? Or do we raise an error. I would agrre that this should be treated in another ticket, but I also don't think there is a better choice to make. Some discussion should happen.



---

archive/issue_comments_102507.json:
```json
{
    "body": "Changed work issues from **several doctests need to be patched due to  changes in output format/term order** to **domain issue, error handling in nintegral**",
    "created_at": "2012-03-01T16:14:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102507",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **several doctests need to be patched due to  changes in output format/term order** to **domain issue, error handling in nintegral**



---

archive/issue_comments_102508.json:
```json
{
    "body": "Changed keywords from none to **maxima 5.26.0 binomial sum**",
    "created_at": "2012-03-01T16:14:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102508",
    "user": "https://github.com/jpflori"
}
```

Changed keywords from none to **maxima 5.26.0 binomial sum**



---

archive/issue_comments_102509.json:
```json
{
    "body": "Author: **Dima Pasechnick**",
    "created_at": "2012-03-01T16:14:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102509",
    "user": "https://github.com/jpflori"
}
```

Author: **Dima Pasechnick**



---

archive/issue_events_141635.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-01T16:14:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141635"
}
```



---

archive/issue_events_141636.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-01T16:14:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141636"
}
```



---

archive/issue_comments_102510.json:
```json
{
    "body": "Reviewer: **Jean-Pierre Flori,**",
    "created_at": "2012-03-01T16:14:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102510",
    "user": "https://github.com/jpflori"
}
```

Reviewer: **Jean-Pierre Flori,**



---

archive/issue_comments_102511.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThe whole\n\n```\ndesolve(..., make_it_work=True)\n```\n\napproach is silly. If we don't get a solution without it, we should use contrib_ode. If we know the variables are real, we should set domain=real.\n\nIt might require a second ticket and some work on MaximaLib/desolve, but we shouldn't just paper over the fact that this doesn't work (and is a regression in that regard). Requiring the user to manually set the domain **is** a regression.",
    "created_at": "2012-03-01T16:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102511",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:44" align="right">comment:44</div>

The whole

```
desolve(..., make_it_work=True)
```

approach is silly. If we don't get a solution without it, we should use contrib_ode. If we know the variables are real, we should set domain=real.

It might require a second ticket and some work on MaximaLib/desolve, but we shouldn't just paper over the fact that this doesn't work (and is a regression in that regard). Requiring the user to manually set the domain **is** a regression.



---

archive/issue_comments_102512.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@jpflori](#comment:43):\n> And the error handling at the end of nintegral should definitely be reworked.\n> \n> For example the test \"if 'quad_qags' in str(v)\" is useless now that Maxima behavior has changed.\n> \n> Moreover, I'm not sure the \"ERROR in srt(err)\" can ever be reached now (was it before???).\n> \n> I could not locate the commit corresponding to this change although I tried a little hard. Maxima source tree is a little obscure for me. This commit should be mentionned in the doc and would help to answer the two above remarks about error handling. Some expert of Maxima is needed for that.\n\nI did find [this commit](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=commitdiff;h=df7393f0f2433cd60937e42b7cae624add3ca085) in the history of `src/numerical/slatec/quadpack.lisp`. It seems to indicate that something about quadpack error reporting has changed and may have become more configurable. Perhaps we can configure it in a way that the reported errors are more suitable and detectable for us?\n\ndesolve: I think Dima's new approach is acceptable in that it both fixes the doctest and documents the regression. Did anybody ever check if the returned solution with `domain: complex` is actually correct with some crazy combination of branch cut choices?",
    "created_at": "2012-03-01T17:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102512",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@jpflori](#comment:43):
> And the error handling at the end of nintegral should definitely be reworked.
> 
> For example the test "if 'quad_qags' in str(v)" is useless now that Maxima behavior has changed.
> 
> Moreover, I'm not sure the "ERROR in srt(err)" can ever be reached now (was it before???).
> 
> I could not locate the commit corresponding to this change although I tried a little hard. Maxima source tree is a little obscure for me. This commit should be mentionned in the doc and would help to answer the two above remarks about error handling. Some expert of Maxima is needed for that.

I did find [this commit](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=commitdiff;h=df7393f0f2433cd60937e42b7cae624add3ca085) in the history of `src/numerical/slatec/quadpack.lisp`. It seems to indicate that something about quadpack error reporting has changed and may have become more configurable. Perhaps we can configure it in a way that the reported errors are more suitable and detectable for us?

desolve: I think Dima's new approach is acceptable in that it both fixes the doctest and documents the regression. Did anybody ever check if the returned solution with `domain: complex` is actually correct with some crazy combination of branch cut choices?



---

archive/issue_comments_102513.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@nbruin](#comment:45):\n> desolve: I think Dima's new approach is acceptable in that it both fixes the doctest and documents the regression. Did anybody ever check if the returned solution with `domain: complex` is actually correct with some crazy combination of branch cut choices?\n\nIt fixes the doctest in the same way that deleting the doctest fixes the doctest.\n\nAll we have to do to fix *this* ticket is backport simplify_sum.mac:\n\n```\nsage: maxima.version()                \n'5.24.0'\nsage: n,k = var('n,k')                \nsage: sum(binomial(n,k)*k^2, k, 2, n) \n1/4*(n^2 + n)*2^n - n\n```\n\nIf we're going to upgrade maxima after that, we should do it properly, i.e. no regressions.",
    "created_at": "2012-03-01T17:32:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102513",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@nbruin](#comment:45):
> desolve: I think Dima's new approach is acceptable in that it both fixes the doctest and documents the regression. Did anybody ever check if the returned solution with `domain: complex` is actually correct with some crazy combination of branch cut choices?

It fixes the doctest in the same way that deleting the doctest fixes the doctest.

All we have to do to fix *this* ticket is backport simplify_sum.mac:

```
sage: maxima.version()                
'5.24.0'
sage: n,k = var('n,k')                
sage: sum(binomial(n,k)*k^2, k, 2, n) 
1/4*(n^2 + n)*2^n - n
```

If we're going to upgrade maxima after that, we should do it properly, i.e. no regressions.



---

archive/issue_comments_102514.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI saw that commit but I must admit I do not understand whether that actually modified the behavior of Maxima and slatec or not.\n\nMy point here is that we should get rid of the now useless lines of  code and if possible document it properly either in the file itself or  in SPKG.txt with a pointer to the corresponding Maxima commit and some  explanation.\n\nDeciding whether the current behavior of letting the user know that  an error occurred through the last value of the tuple (as maxima does)  which is already document, or whether we should actually look at that  value in Sage itself and raise an actual Error accordingly can be done  later (or not, I'll personally live with it as it is).",
    "created_at": "2012-03-01T17:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102514",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:47" align="right">comment:47</div>

I saw that commit but I must admit I do not understand whether that actually modified the behavior of Maxima and slatec or not.

My point here is that we should get rid of the now useless lines of  code and if possible document it properly either in the file itself or  in SPKG.txt with a pointer to the corresponding Maxima commit and some  explanation.

Deciding whether the current behavior of letting the user know that  an error occurred through the last value of the tuple (as maxima does)  which is already document, or whether we should actually look at that  value in Sage itself and raise an actual Error accordingly can be done  later (or not, I'll personally live with it as it is).



---

archive/issue_comments_102515.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI also quite agree with mjo.\n\nIf possible, let's just update the 5.25 spkg with an additional patch for the sum (as Dima just did for the false stuff), so that it is quickly reviewed and merged.\n\nAnd let's upgrade maxima in another ticket (and another one for error handling, and potentially another one for a real solution to the domain stuff, my preferred solution for that is the domain option with try/finally and real by default, for mjo I'm not sure we can call it a regression, did Sage (and Maxima?) actually outputed something different for domain equal to real or complex before? or was it always as it is now with domain= real?).",
    "created_at": "2012-03-01T17:42:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102515",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:48" align="right">comment:48</div>

I also quite agree with mjo.

If possible, let's just update the 5.25 spkg with an additional patch for the sum (as Dima just did for the false stuff), so that it is quickly reviewed and merged.

And let's upgrade maxima in another ticket (and another one for error handling, and potentially another one for a real solution to the domain stuff, my preferred solution for that is the domain option with try/finally and real by default, for mjo I'm not sure we can call it a regression, did Sage (and Maxima?) actually outputed something different for domain equal to real or complex before? or was it always as it is now with domain= real?).



---

archive/issue_comments_102516.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nIt always returned,\n\n```\n[x - arcsinh(y(x)/x) == c]\n```\n\nregardless of the `domain`.\n\nBut, it used to give the correct answer, and now it doesn't.\n\nI'm running a ptestlong now with simplify_sum.mac from 5.26. If that (and the maxima tests) pass, I would certainly give a patched 5.24 a positive review.",
    "created_at": "2012-03-01T18:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102516",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:49" align="right">comment:49</div>

It always returned,

```
[x - arcsinh(y(x)/x) == c]
```

regardless of the `domain`.

But, it used to give the correct answer, and now it doesn't.

I'm running a ptestlong now with simplify_sum.mac from 5.26. If that (and the maxima tests) pass, I would certainly give a patched 5.24 a positive review.



---

archive/issue_events_141637.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-02T00:17:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141637"
}
```



---

archive/issue_events_141638.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-02T00:17:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141638"
}
```



---

archive/issue_comments_102517.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@orlitzky](#comment:49):\n> It always returned, `[x - arcsinh(y(x)/x) == c]`\n> \n> regardless of the `domain`.\n> \n> But, it used to give the correct answer, and now it doesn't.\n> \n> I'm running a ptestlong now with simplify_sum.mac from 5.26. If that (and the maxima tests) pass, I would certainly give a patched 5.24 a positive review.\n\nCan you demonstrate in some way that the solution it gives in the complex domain is wrong? If yes, you have a point. Still, if it were wrong we would have a good Maxima bug report to file. And we have a workaround for this, which is good enough IMHO.\n\nOne way or another, I would much prefer have a patch in 5.26 than in 5.24. The latter is an obsolete version, and I see very little value in keeping it (I am sure they fixed a zillion other bugs in 5.26, which were not covered by Sage doctests). Just from the point of view of maintaining good relations with Maxima community it is important to upgrade to 5.26.",
    "created_at": "2012-03-02T00:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102517",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@orlitzky](#comment:49):
> It always returned, `[x - arcsinh(y(x)/x) == c]`
> 
> regardless of the `domain`.
> 
> But, it used to give the correct answer, and now it doesn't.
> 
> I'm running a ptestlong now with simplify_sum.mac from 5.26. If that (and the maxima tests) pass, I would certainly give a patched 5.24 a positive review.

Can you demonstrate in some way that the solution it gives in the complex domain is wrong? If yes, you have a point. Still, if it were wrong we would have a good Maxima bug report to file. And we have a workaround for this, which is good enough IMHO.

One way or another, I would much prefer have a patch in 5.26 than in 5.24. The latter is an obsolete version, and I see very little value in keeping it (I am sure they fixed a zillion other bugs in 5.26, which were not covered by Sage doctests). Just from the point of view of maintaining good relations with Maxima community it is important to upgrade to 5.26.



---

archive/issue_comments_102518.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@dimpase](#comment:50):\n\n>  (I am sure they fixed a zillion other bugs in 5.26, which were not covered by Sage doctests).\n\nE.g. see my comment above about the quality of numerical approximation in \nmatrix/matrix2.pyx, line 10369, test, as an example of improvement. Actually, the quality of the approximation returned there by the current maxima spkg is so poor that it can be regarded as a bug!",
    "created_at": "2012-03-02T01:35:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102518",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@dimpase](#comment:50):

>  (I am sure they fixed a zillion other bugs in 5.26, which were not covered by Sage doctests).

E.g. see my comment above about the quality of numerical approximation in 
matrix/matrix2.pyx, line 10369, test, as an example of improvement. Actually, the quality of the approximation returned there by the current maxima spkg is so poor that it can be regarded as a bug!



---

archive/issue_comments_102519.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@jpflori](#comment:43):\n> I would rather follow Nils approach and at least include a try/finally statement in cas an error is raised.\n> \n> Doing so, we're sure not to let the domain set to real after leaving the function because of an error.\n> \n> Then, you'd better use \"P\" already present in the code rather than sage.calculus.calculs.maxima so that you're sure to use the same maxima as the one that will be used for solving the equation. Currently it's equivalent, but if something else changes in the future, such a choice will make everything easier.\n\n\nI really cannot imagine a scenario when one would run several instances of maxima in a totally uncoordinated way. If such a major change was ever to happen, surely a facility to execute a series of maxima commands in a given maxima instance would be available, and could be used then.\n\n \n> \n> Finally, on my side, I'd really prefer first to use the option approach you already implemented, and then to bakup the previous value of domain and set it back in the finally statement (rather than setting it to complex all the time).*\n\nThat's a good point, regardless. As I said, when working on the previous patch I overlooked a way to set domain by another call to maxima.\n\n[...]\n \n> A last question is to know what we do when nintegral returns an error code.\n> \n> Do we let the situation as is? Or do we raise an error. I would agrre that this should be treated in another ticket, but I also don't think there is a better choice to make. Some discussion should happen.\n\nIt surely can be handled better, but it surely should  happen on another ticket.",
    "created_at": "2012-03-02T01:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102519",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@jpflori](#comment:43):
> I would rather follow Nils approach and at least include a try/finally statement in cas an error is raised.
> 
> Doing so, we're sure not to let the domain set to real after leaving the function because of an error.
> 
> Then, you'd better use "P" already present in the code rather than sage.calculus.calculs.maxima so that you're sure to use the same maxima as the one that will be used for solving the equation. Currently it's equivalent, but if something else changes in the future, such a choice will make everything easier.


I really cannot imagine a scenario when one would run several instances of maxima in a totally uncoordinated way. If such a major change was ever to happen, surely a facility to execute a series of maxima commands in a given maxima instance would be available, and could be used then.

 
> 
> Finally, on my side, I'd really prefer first to use the option approach you already implemented, and then to bakup the previous value of domain and set it back in the finally statement (rather than setting it to complex all the time).*

That's a good point, regardless. As I said, when working on the previous patch I overlooked a way to set domain by another call to maxima.

[...]
 
> A last question is to know what we do when nintegral returns an error code.
> 
> Do we let the situation as is? Or do we raise an error. I would agrre that this should be treated in another ticket, but I also don't think there is a better choice to make. Some discussion should happen.

It surely can be handled better, but it surely should  happen on another ticket.



---

archive/issue_comments_102520.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nI would be happy with the following:\n\n1. Add a public method to set the maxima simplification domain. This is useful elsewhere, and is pain-equivalent to adding a `domain` parameter to the `desolve` function. Can be a separate ticket.\n2. Open another ticket to figure out the domain automatically in  `desolve` where all the variables are known.\n3. Update this doctest to use that method, and add a reference to that ticket.",
    "created_at": "2012-03-02T02:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102520",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:53" align="right">comment:53</div>

I would be happy with the following:

1. Add a public method to set the maxima simplification domain. This is useful elsewhere, and is pain-equivalent to adding a `domain` parameter to the `desolve` function. Can be a separate ticket.
2. Open another ticket to figure out the domain automatically in  `desolve` where all the variables are known.
3. Update this doctest to use that method, and add a reference to that ticket.



---

archive/issue_comments_102521.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@orlitzky](#comment:49):\n> But, it used to give the correct answer, and now it doesn't.\n\nAs far as I can check, the newly returned solution is valid:\n\n```\nsage: y=function('y',x)\nsage: sol=(log((2*sqrt(4/x^2)*x^2*sqrt((4*y^4+4*x^2*y^2)/x^2)+8*y^2+4*x^2)/x^2)\n....:         -sqrt(4/x^2)*x*asinh(2*y^2/(x*sqrt(4*y^2)))\n....:         -sqrt(4/x^2)*x*asinh(2*y/sqrt(4*x^2))+sqrt(4/x^2)*x^2)/(sqrt(4/x^2)*x)\nsage: var('DY')\nDY\nsage: eqn=sol.diff(x).subs_expr(diff(y,x)==DY)\nsage: dydx=-eqn.coefficient(DY,0)/eqn.coefficient(DY,1)\nsage: assume(x>0)\nsage: E=x*dydx-x*sqrt(y^2+x^2)-y\nsage: E.factor()\n0\n```\nso I don't think we need to consider maxima 5.26's response a regression in this respect. It is simply returning a different solution than 5.24 did when `domain: complex` is in effect.",
    "created_at": "2012-03-02T07:09:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102521",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@orlitzky](#comment:49):
> But, it used to give the correct answer, and now it doesn't.

As far as I can check, the newly returned solution is valid:

```
sage: y=function('y',x)
sage: sol=(log((2*sqrt(4/x^2)*x^2*sqrt((4*y^4+4*x^2*y^2)/x^2)+8*y^2+4*x^2)/x^2)
....:         -sqrt(4/x^2)*x*asinh(2*y^2/(x*sqrt(4*y^2)))
....:         -sqrt(4/x^2)*x*asinh(2*y/sqrt(4*x^2))+sqrt(4/x^2)*x^2)/(sqrt(4/x^2)*x)
sage: var('DY')
DY
sage: eqn=sol.diff(x).subs_expr(diff(y,x)==DY)
sage: dydx=-eqn.coefficient(DY,0)/eqn.coefficient(DY,1)
sage: assume(x>0)
sage: E=x*dydx-x*sqrt(y^2+x^2)-y
sage: E.factor()
0
```
so I don't think we need to consider maxima 5.26's response a regression in this respect. It is simply returning a different solution than 5.24 did when `domain: complex` is in effect.



---

archive/issue_comments_102522.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nAbout the multiplie maxima instance, there is indeed only one library instance and I don't think that will change in the near future.\n\nBut one can instantiate pexpect interfaces (one or multiple one).\n\nSo if I'm a little bizarre and want to use such an interface, I'd like it to behave as much as possible as the library one (e.g. doing something like de_max = maxima(de) and then calling desolve on de_max, in that case we'll get a pexpect interface by the parent() call)..\n\nOf course desole is not really implemented to work in that case and in fact it does not seem to do very well right now (it just returns different kinds of NotImplementedError telling that Maxima failed).\n\nAs a consequence we might also think of getting rid of the _maxima_() and parent() call and explicitely only use sage.calculus.calculus.maxima instead.\n\nIn that case I'll be completely happy with the use of sage.calculus.calculus.maxima for setting the domain.\n\nSetting the domain can be domain with a simple call to set('domain','xxx') as mentioned above.\n\nBut I just discovered that we (I?) messed up something when building the library interface.\n\nWith the pexpect interface (be sure to actually start it with maxima.start()), one can use maxima.domain directly. This does not work with the library interface.\n\nOf course we can also add a new method on top of that as well.",
    "created_at": "2012-03-02T09:24:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102522",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:55" align="right">comment:55</div>

About the multiplie maxima instance, there is indeed only one library instance and I don't think that will change in the near future.

But one can instantiate pexpect interfaces (one or multiple one).

So if I'm a little bizarre and want to use such an interface, I'd like it to behave as much as possible as the library one (e.g. doing something like de_max = maxima(de) and then calling desolve on de_max, in that case we'll get a pexpect interface by the parent() call)..

Of course desole is not really implemented to work in that case and in fact it does not seem to do very well right now (it just returns different kinds of NotImplementedError telling that Maxima failed).

As a consequence we might also think of getting rid of the _maxima_() and parent() call and explicitely only use sage.calculus.calculus.maxima instead.

In that case I'll be completely happy with the use of sage.calculus.calculus.maxima for setting the domain.

Setting the domain can be domain with a simple call to set('domain','xxx') as mentioned above.

But I just discovered that we (I?) messed up something when building the library interface.

With the pexpect interface (be sure to actually start it with maxima.start()), one can use maxima.domain directly. This does not work with the library interface.

Of course we can also add a new method on top of that as well.



---

archive/issue_comments_102523.json:
```json
{
    "body": "Changed author from **Dima Pasechnick** to **Dima Pasechnik**",
    "created_at": "2012-03-02T13:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102523",
    "user": "https://github.com/kcrisman"
}
```

Changed author from **Dima Pasechnick** to **Dima Pasechnik**



---

archive/issue_comments_102524.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nDisagree with having the other interface instances behaving like the standard one.  On the contrary, some people will probably want \"vanilla\" Maxima in that setting.    That said, there should be a nice easy way to say \"pexpect interface with the same defaults as the \"calculus\" copy\" or something like that.",
    "created_at": "2012-03-02T13:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102524",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:56" align="right">comment:56</div>

Disagree with having the other interface instances behaving like the standard one.  On the contrary, some people will probably want "vanilla" Maxima in that setting.    That said, there should be a nice easy way to say "pexpect interface with the same defaults as the "calculus" copy" or something like that.



---

archive/issue_comments_102525.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@jpflori](#comment:55):\n[...]\n> Setting the domain can be domain with a simple call to set('domain','xxx') as mentioned above.\n> \n> But I just discovered that we (I?) messed up something when building the library interface.\n> \n> With the pexpect interface (be sure to actually start it with maxima.start()), one can use maxima.domain directly. This does not work with the library interface.\n> \n> Of course we can also add a new method on top of that as well.\n\nOK, I am confused now - can we have a new public method to do the simplification domain switching in the library, i.e.\nthe equivalent of  `sage.calculus.calculus.maxima('domain:real')`, etc., or it would not work due to a bug in the library interface? If the latter, it looks like one can give it the positive review now, right?\n\nI am relieved to hear that there are \"real\" regressions --- bedankt, Nils!",
    "created_at": "2012-03-02T14:16:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102525",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@jpflori](#comment:55):
[...]
> Setting the domain can be domain with a simple call to set('domain','xxx') as mentioned above.
> 
> But I just discovered that we (I?) messed up something when building the library interface.
> 
> With the pexpect interface (be sure to actually start it with maxima.start()), one can use maxima.domain directly. This does not work with the library interface.
> 
> Of course we can also add a new method on top of that as well.

OK, I am confused now - can we have a new public method to do the simplification domain switching in the library, i.e.
the equivalent of  `sage.calculus.calculus.maxima('domain:real')`, etc., or it would not work due to a bug in the library interface? If the latter, it looks like one can give it the positive review now, right?

I am relieved to hear that there are "real" regressions --- bedankt, Nils!



---

archive/issue_comments_102526.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@dimpase](#comment:57):\n\n> I am relieved to hear that there are \"real\" regressions --- bedankt, Nils!\n\nI meant to say \"there are no 'real' regressions\", of course...",
    "created_at": "2012-03-02T14:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102526",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@dimpase](#comment:57):

> I am relieved to hear that there are "real" regressions --- bedankt, Nils!

I meant to say "there are no 'real' regressions", of course...



---

archive/issue_comments_102527.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nReplying to [@dimpase](#comment:57):\n\n> OK, I am confused now - can we have a new public method to do the simplification domain switching in the library, i.e. the equivalent of  `sage.calculus.calculus.maxima('domain:real')`, etc., or it would not work due to a bug in the library interface? If the latter, it looks like one can give it the\n\nYou're also confusing me now :)\n\nI really do not like and understand how trac treats newline stuff, whence my maybe confusing message above. I'll try to format that one better.\n\nI'll also says a lot a lot of trivialities, but it's to be sure that we all agree on what we want or do not want.\n\nFisrt, sage.calculus.calculus.maxima('domain: real') does work as intended indeed.\n\nIf you think this is not public enough we can add a new method \"set_domain\" in MaximaAbstract class which does the same thing:\n\n```\ndef set_domain(self, domain):\n    r\"\"\"\n    Sets the working domain of this Maxima instance to `domain`.\n    \"\"\"\n    self('domain : \"+domain)\n\n```\nor equivalently\n\n```\ndef set_domain(self, domain):\n    r\"\"\"\n    Sets the working domain of this Maxima instance to `domain`.\n    \"\"\"\n    self.set('domain', domain)\n\n```\nwith some basic doctesting.\n\nIn that form I doubt this is really much more useful than calling sage.calculus.calculus.maxima(...).\n\nMaybe you meant a function declared at the top level of sage.calculus.calculus which does the same ?\n\nIt's maybe a little more meaningful.\n\nWhat I meant about the Maxima Library interface bug is that we should be able to access the \"domain\" variable of Maxima directly as an attribute of the Sage object, so that one could replace the above method by\n\n```\ndef set_domain(self, domain):\n    ...\n    self.domain = domain\n\n```\nor if its a function in sage.calculus.calculus :\n\n```\ndef set_domain(domain):\n    r\"\"\"\n    Sets the domain of the Maxima instance used by Sage for calculus to `domain`\n    \"\"\"\"\n    maxima.domain = domain\n\n```\nThis works for the pexpect interface but is broken for the library interface.",
    "created_at": "2012-03-02T14:34:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102527",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:59" align="right">comment:59</div>

Replying to [@dimpase](#comment:57):

> OK, I am confused now - can we have a new public method to do the simplification domain switching in the library, i.e. the equivalent of  `sage.calculus.calculus.maxima('domain:real')`, etc., or it would not work due to a bug in the library interface? If the latter, it looks like one can give it the

You're also confusing me now :)

I really do not like and understand how trac treats newline stuff, whence my maybe confusing message above. I'll try to format that one better.

I'll also says a lot a lot of trivialities, but it's to be sure that we all agree on what we want or do not want.

Fisrt, sage.calculus.calculus.maxima('domain: real') does work as intended indeed.

If you think this is not public enough we can add a new method "set_domain" in MaximaAbstract class which does the same thing:

```
def set_domain(self, domain):
    r"""
    Sets the working domain of this Maxima instance to `domain`.
    """
    self('domain : "+domain)

```
or equivalently

```
def set_domain(self, domain):
    r"""
    Sets the working domain of this Maxima instance to `domain`.
    """
    self.set('domain', domain)

```
with some basic doctesting.

In that form I doubt this is really much more useful than calling sage.calculus.calculus.maxima(...).

Maybe you meant a function declared at the top level of sage.calculus.calculus which does the same ?

It's maybe a little more meaningful.

What I meant about the Maxima Library interface bug is that we should be able to access the "domain" variable of Maxima directly as an attribute of the Sage object, so that one could replace the above method by

```
def set_domain(self, domain):
    ...
    self.domain = domain

```
or if its a function in sage.calculus.calculus :

```
def set_domain(domain):
    r"""
    Sets the domain of the Maxima instance used by Sage for calculus to `domain`
    """"
    maxima.domain = domain

```
This works for the pexpect interface but is broken for the library interface.



---

archive/issue_comments_102528.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nAnd I do not think that this should be positively reviewed yet: the error handling changes of Maxima in nintegral should be documented and the now useless lines removed.",
    "created_at": "2012-03-02T14:37:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102528",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:60" align="right">comment:60</div>

And I do not think that this should be positively reviewed yet: the error handling changes of Maxima in nintegral should be documented and the now useless lines removed.



---

archive/issue_comments_102529.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@jpflori](#comment:60):\n> And I do not think that this should be positively reviewed yet: the error handling changes of Maxima in nintegral should be documented and the now useless lines removed.\n\nIndeed, if you read [this thread](http://www.math.utexas.edu/pipermail/maxima/2008/012975.html) it seems that in maxima 5.16.2 they decided to return the expression in case of error in evaluation and that this decision was reversed, so now they're just reporting the error codes as computed by quadpack. Those error codes are documented in the `sage.calculus.calculus.nintegral` docstring, so probably the lines\n\n```\n    #This is just a work around until there is a response to\n    #http://www.math.utexas.edu/pipermail/maxima/2008/012975.html\n    if 'quad_qags' in str(v):\n        raise ValueError, \"Maxima (via quadpack) cannot compute the integral to that precision\"\n```\ncould just be removed. A workaround is not necessary anymore. If we prefer to raise errors rather than rely on checking error codes, we could do\n\n```\n    errorcode_dict = {\n        1 : 'too many sub-intervals were done',\n        2 : 'excessive roundoff error detected',\n        3 : 'extremely bad integrand behavior occurs',\n        4 : 'failed to converge',\n        5 :  'integral is probably divergent or slowly convergent',\n        6 : 'invalid input'} #this def can go outside function\n    cond=int(v[3])\n    if cond in errorcode_dict:\n        raise RuntimeError(\"Maxima (via quadpack) reports an error:'%s'\"%error_code_dict(cond)\n    else:\n        return float(v[0]), float(v[1]), Integer(v[2]), Integer(v[3])\n```\nHowever, once you start changing things like that, we should perhaps change the return value format (or make it a parameter 'raise_errors_rather_than_return_error_codes').",
    "created_at": "2012-03-02T20:24:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102529",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@jpflori](#comment:60):
> And I do not think that this should be positively reviewed yet: the error handling changes of Maxima in nintegral should be documented and the now useless lines removed.

Indeed, if you read [this thread](http://www.math.utexas.edu/pipermail/maxima/2008/012975.html) it seems that in maxima 5.16.2 they decided to return the expression in case of error in evaluation and that this decision was reversed, so now they're just reporting the error codes as computed by quadpack. Those error codes are documented in the `sage.calculus.calculus.nintegral` docstring, so probably the lines

```
    #This is just a work around until there is a response to
    #http://www.math.utexas.edu/pipermail/maxima/2008/012975.html
    if 'quad_qags' in str(v):
        raise ValueError, "Maxima (via quadpack) cannot compute the integral to that precision"
```
could just be removed. A workaround is not necessary anymore. If we prefer to raise errors rather than rely on checking error codes, we could do

```
    errorcode_dict = {
        1 : 'too many sub-intervals were done',
        2 : 'excessive roundoff error detected',
        3 : 'extremely bad integrand behavior occurs',
        4 : 'failed to converge',
        5 :  'integral is probably divergent or slowly convergent',
        6 : 'invalid input'} #this def can go outside function
    cond=int(v[3])
    if cond in errorcode_dict:
        raise RuntimeError("Maxima (via quadpack) reports an error:'%s'"%error_code_dict(cond)
    else:
        return float(v[0]), float(v[1]), Integer(v[2]), Integer(v[3])
```
However, once you start changing things like that, we should perhaps change the return value format (or make it a parameter 'raise_errors_rather_than_return_error_codes').



---

archive/issue_comments_102530.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@nbruin](#comment:61):\n\n```\n    #This is just a work around until there is a response to\n    #http://www.math.utexas.edu/pipermail/maxima/2008/012975.html\n    if 'quad_qags' in str(v):\n        raise ValueError, \"Maxima (via quadpack) cannot compute the integral to that precision\"\n```\n\nMy apologies! I've looked at the [quadpack.lisp source](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=blob;f=src/numerical/slatec/quadpack.lisp;h=c07efea3ce3b57e7797c692aa25dc7dee5feb8b5;hb=HEAD#l48) and as you might notice, there's a `handler-case ... error` construct there, which is a lisp version of `try ... except`. The error clause constructs a return value which would be an unevaluated `quad_qags` call in maxima. So the raise above could in principle still be triggered (e.g., give an integrand that triggers an error when evaluated in a way that's not caught otherwise). We need to leave this in. One could leave out the try...except around the maxima call if the error messages produced by maxima are sufficiently informative.\n\nThe patch that triggered Mike Hansen's request and Dodier's answer is probably [this one](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=commitdiff;h=9f156949a789dab37bf548acc20a08f4fd9c6086). That code is still there as far as I can see. I think we're best off leaving both error checks in there. The change in behaviour between 5.24 to 5.26 is likely caused somewhere else. The 5.26 behaviour is still as documented (provided we consider 1e-14 as 'invalid input').\n\nWhether we want to raise an error rather than return an error code is an independent question.",
    "created_at": "2012-03-02T21:49:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102530",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@nbruin](#comment:61):

```
    #This is just a work around until there is a response to
    #http://www.math.utexas.edu/pipermail/maxima/2008/012975.html
    if 'quad_qags' in str(v):
        raise ValueError, "Maxima (via quadpack) cannot compute the integral to that precision"
```

My apologies! I've looked at the [quadpack.lisp source](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=blob;f=src/numerical/slatec/quadpack.lisp;h=c07efea3ce3b57e7797c692aa25dc7dee5feb8b5;hb=HEAD#l48) and as you might notice, there's a `handler-case ... error` construct there, which is a lisp version of `try ... except`. The error clause constructs a return value which would be an unevaluated `quad_qags` call in maxima. So the raise above could in principle still be triggered (e.g., give an integrand that triggers an error when evaluated in a way that's not caught otherwise). We need to leave this in. One could leave out the try...except around the maxima call if the error messages produced by maxima are sufficiently informative.

The patch that triggered Mike Hansen's request and Dodier's answer is probably [this one](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=commitdiff;h=9f156949a789dab37bf548acc20a08f4fd9c6086). That code is still there as far as I can see. I think we're best off leaving both error checks in there. The change in behaviour between 5.24 to 5.26 is likely caused somewhere else. The 5.26 behaviour is still as documented (provided we consider 1e-14 as 'invalid input').

Whether we want to raise an error rather than return an error code is an independent question.



---

archive/issue_comments_102531.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@jpflori](#comment:60):\n> And I do not think that this should be positively reviewed yet: the error handling changes of Maxima in nintegral should be documented and the now useless lines removed.\n\nI read in Nils' latest comment that there are no useless lines to remove, right? Regarding the documentation, how about adding\nthe following to the patch:\n\n```\ndiff --git a/sage/calculus/calculus.py b/sage/calculus/calculus.py\n--- a/sage/calculus/calculus.py\n+++ b/sage/calculus/calculus.py\n@@ -632,7 +632,8 @@\n       - ``5`` - integral is probably divergent or slowly\n         convergent\n \n-      - ``6`` - the input is invalid\n+      - ``6`` - the input is invalid; this includes the case of desired_relative_error\n+        being too small to be achieved \n \n     ALIAS: nintegrate is the same as nintegral\n```\n\nwould this be sufficient?",
    "created_at": "2012-03-03T08:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102531",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@jpflori](#comment:60):
> And I do not think that this should be positively reviewed yet: the error handling changes of Maxima in nintegral should be documented and the now useless lines removed.

I read in Nils' latest comment that there are no useless lines to remove, right? Regarding the documentation, how about adding
the following to the patch:

```
diff --git a/sage/calculus/calculus.py b/sage/calculus/calculus.py
--- a/sage/calculus/calculus.py
+++ b/sage/calculus/calculus.py
@@ -632,7 +632,8 @@
       - ``5`` - integral is probably divergent or slowly
         convergent
 
-      - ``6`` - the input is invalid
+      - ``6`` - the input is invalid; this includes the case of desired_relative_error
+        being too small to be achieved 
 
     ALIAS: nintegrate is the same as nintegral
```

would this be sufficient?



---

archive/issue_comments_102532.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nIm currently looking at Maxima's code and am not yet convinced of what changed in the last version.\n\nThere' indeed the possibility that an error get raised by Maxima (handler ... error stuff) if some values cannot be converted to floats float-or-lose stuff).\n\nIn this case Maxima returns the partially evaluated expression.\n\nBut that does not explain why Maxima now returns (0,0,0,6) rather than the old unevaluated expression for integrating x with a crazy expression. I'm currently looking at dqags.lisp but did not find anything meaningful yet.\n\nIn particular, it also makes me wonder whether the message of the Sage error (for the \"workaround\", but also for the earlier try/catch stuff) is meaningful.\n\nWill it ever be related to precision problems ? because Maxima seems not to complain any more.\n\nand as I said earlier, returning Error ourselves when when detect that the last value of the tuple and as Nils proposes to do, seems a good idea to me, but should be done later. I'd just like to actually reflect what Maxima tells at the Sage level even though the end user still has to check this last value for a moment.",
    "created_at": "2012-03-03T10:20:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102532",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:64" align="right">comment:64</div>

Im currently looking at Maxima's code and am not yet convinced of what changed in the last version.

There' indeed the possibility that an error get raised by Maxima (handler ... error stuff) if some values cannot be converted to floats float-or-lose stuff).

In this case Maxima returns the partially evaluated expression.

But that does not explain why Maxima now returns (0,0,0,6) rather than the old unevaluated expression for integrating x with a crazy expression. I'm currently looking at dqags.lisp but did not find anything meaningful yet.

In particular, it also makes me wonder whether the message of the Sage error (for the "workaround", but also for the earlier try/catch stuff) is meaningful.

Will it ever be related to precision problems ? because Maxima seems not to complain any more.

and as I said earlier, returning Error ourselves when when detect that the last value of the tuple and as Nils proposes to do, seems a good idea to me, but should be done later. I'd just like to actually reflect what Maxima tells at the Sage level even though the end user still has to check this last value for a moment.



---

archive/issue_comments_102533.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nOK, this poking around in maxima's source is really quite unproductive, but I think I have located the source of the change in behaviour. With maxima 5.26, observe:\n\n```\nsage: x.nintegrate(x,0,1,1e-14)\n(0.0, 0.0, 0, 6)\nsage: from sage.libs.ecl import *\nsage: ecl_eval(\"(setf f2cl-lib::*stop-signals-error-p* T)\")\n<ECL: T>\nsage: x.nintegrate(x,0,1,1e-14)\nValueError: Maxima (via quadpack) cannot compute the integral to that precision\n```\nwhereas with maxima 5.23.2 we have the opposite:\n\n```\nsage: x.nintegrate(x,0,1,1e-14)\nValueError: Maxima (via quadpack) cannot compute the integral to that precision\nsage: from sage.libs.ecl import *\nsage: ecl_eval(\"(setf f2cl-lib::*stop-signals-error-p* T)\")\n<ECL: T>\nsage: x.nintegrate(x,0,1,1e-14)\n(0.0, 0.0, 0, 6)\n```\nI think [this commit](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=commitdiff;h=9067349233cc217786983b07c23a2b78cf7d27bc) is responsible]:\n\n```\n (defun stop (&optional arg)\n   (when arg\n     (format cl::*error-output* \"~A~%\" arg))\n-  (unless *stop-signals-error-p*\n+  (when *stop-signals-error-p*\n     (cerror \"Continue anyway\" \"STOP reached\")))\n```\nIn later commits, the following is added:\n\n```\n+;;; Revision 1.116  2011/02/20 20:51:04  rtoy\n+;;; Oops.  STOP should signal an error if *STOP-SIGNALS-ERROR-P* is\n+;;; non-NIL.\n```\nso I think the maxima 5.26 behaviour is as intended. I think you can give Dima's patch a positive review now. Everything is explained and any improvements should be handled on future tickets.",
    "created_at": "2012-03-03T22:39:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102533",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:65" align="right">comment:65</div>

OK, this poking around in maxima's source is really quite unproductive, but I think I have located the source of the change in behaviour. With maxima 5.26, observe:

```
sage: x.nintegrate(x,0,1,1e-14)
(0.0, 0.0, 0, 6)
sage: from sage.libs.ecl import *
sage: ecl_eval("(setf f2cl-lib::*stop-signals-error-p* T)")
<ECL: T>
sage: x.nintegrate(x,0,1,1e-14)
ValueError: Maxima (via quadpack) cannot compute the integral to that precision
```
whereas with maxima 5.23.2 we have the opposite:

```
sage: x.nintegrate(x,0,1,1e-14)
ValueError: Maxima (via quadpack) cannot compute the integral to that precision
sage: from sage.libs.ecl import *
sage: ecl_eval("(setf f2cl-lib::*stop-signals-error-p* T)")
<ECL: T>
sage: x.nintegrate(x,0,1,1e-14)
(0.0, 0.0, 0, 6)
```
I think [this commit](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=commitdiff;h=9067349233cc217786983b07c23a2b78cf7d27bc) is responsible]:

```
 (defun stop (&optional arg)
   (when arg
     (format cl::*error-output* "~A~%" arg))
-  (unless *stop-signals-error-p*
+  (when *stop-signals-error-p*
     (cerror "Continue anyway" "STOP reached")))
```
In later commits, the following is added:

```
+;;; Revision 1.116  2011/02/20 20:51:04  rtoy
+;;; Oops.  STOP should signal an error if *STOP-SIGNALS-ERROR-P* is
+;;; non-NIL.
```
so I think the maxima 5.26 behaviour is as intended. I think you can give Dima's patch a positive review now. Everything is explained and any improvements should be handled on future tickets.



---

archive/issue_comments_102534.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nThanx a lot for locating this! It would have taken me ages to do so. But you did not quite answered one of my questions: we won't get the last error because of precision stuff, so this can get removed? My point is that those last lines were explicitely made to catch that specific error that is not reported as such anymore, so I think it's useless, or if it can then it won't be becase of precision provlems anymore so the stuff about precision should be removed (and the reference to the maxima mailing list should be removed as well).\n\nI also agree it's not really important from a usefulness point of view, but having a good understanding of what we use in Sage is and our code should reflect that.",
    "created_at": "2012-03-03T22:56:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102534",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:66" align="right">comment:66</div>

Thanx a lot for locating this! It would have taken me ages to do so. But you did not quite answered one of my questions: we won't get the last error because of precision stuff, so this can get removed? My point is that those last lines were explicitely made to catch that specific error that is not reported as such anymore, so I think it's useless, or if it can then it won't be becase of precision provlems anymore so the stuff about precision should be removed (and the reference to the maxima mailing list should be removed as well).

I also agree it's not really important from a usefulness point of view, but having a good understanding of what we use in Sage is and our code should reflect that.



---

archive/issue_comments_102535.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@jpflori](#comment:66):\n> we won't get the last error because of precision stuff, so this can get removed? My point is that those last lines were explicitely made to catch that specific error that is not reported as such anymore, so I think it's useless, or if it can then it won't be becase of precision provlems anymore so the stuff about precision should be removed\n\nNo, you already noted yourself that a failure to convert to float can trigger this:\n\n```\nsage: var('n')\nsage: x.nintegrate(x,0,n)\n...\n--> 712         raise ValueError, \"Maxima (via quadpack) cannot compute the integral to that precision\"\n...\nValueError: Maxima (via quadpack) cannot compute the integral to that precision\n```\nthat's why I said before that this check is necessary.",
    "created_at": "2012-03-03T23:02:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102535",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@jpflori](#comment:66):
> we won't get the last error because of precision stuff, so this can get removed? My point is that those last lines were explicitely made to catch that specific error that is not reported as such anymore, so I think it's useless, or if it can then it won't be becase of precision provlems anymore so the stuff about precision should be removed

No, you already noted yourself that a failure to convert to float can trigger this:

```
sage: var('n')
sage: x.nintegrate(x,0,n)
...
--> 712         raise ValueError, "Maxima (via quadpack) cannot compute the integral to that precision"
...
ValueError: Maxima (via quadpack) cannot compute the integral to that precision
```
that's why I said before that this check is necessary.



---

archive/issue_comments_102536.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nYup but that won't be because of too high precision and that's what our error message says...\n\nSo let's just remove the \"to that precision\" part.",
    "created_at": "2012-03-03T23:04:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102536",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:68" align="right">comment:68</div>

Yup but that won't be because of too high precision and that's what our error message says...

So let's just remove the "to that precision" part.



---

archive/issue_comments_102537.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nAs soon as we agree on this last point, I'll be happy to provide a  reviewer patch fixing some formatting problems (spaces at end of lines  and stuff like that) and give the ticket a positive review.\n\nTo be clear about the domain stuff, I don't think we really need an  additional \"public\" method to set it, fixing the maxima library  interface so that sage.calculus.calculus.maxima.domain works as intended  (ie can be read and assigned directly) seems enough for me.\n\n\nAnd sorry about the typos above, it's late here...\n",
    "created_at": "2012-03-03T23:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102537",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:69" align="right">comment:69</div>

As soon as we agree on this last point, I'll be happy to provide a  reviewer patch fixing some formatting problems (spaces at end of lines  and stuff like that) and give the ticket a positive review.

To be clear about the domain stuff, I don't think we really need an  additional "public" method to set it, fixing the maxima library  interface so that sage.calculus.calculus.maxima.domain works as intended  (ie can be read and assigned directly) seems enough for me.


And sorry about the typos above, it's late here...




---

archive/issue_comments_102538.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@jpflori](#comment:68):\n> Yup but that won't be because of too high precision and that's what our error message says...\n> \n> So let's just remove the \"to that precision\" part.\n\nYes, you're right. Agreed. In fact, I expect that any precision problems will always be reported via the error code, so they will *never* come out as an error or an unevaluated call. This only happened before because fortan's \"STOP\" raised an error, which it doesn't do now anymore.\n\nThat also makes me think that the body should be\n\n```\n    v = ex._maxima_().quad_qags(x, a, b,\n                                epsrel=desired_relative_error,\n                                limit=maximum_num_subintervals)\n    #If an error gets raised during evaluation, maxima just returns the unevaluated expression\n    #we raise an error instead\n    if 'quad_qags' in str(v):\n        raise ValueError, \"Maxima (via quadpack) cannot compute the integral\"\n    return float(v[0]), float(v[1]), Integer(v[2]), Integer(v[3])\n```\ni.e., just let `quad_qags` raise its own errors instead of masking it with a blanket error message. Presently we are not aware of any error that would get raised under normal operation in there anyway, so we would want to know what went wrong.",
    "created_at": "2012-03-03T23:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102538",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@jpflori](#comment:68):
> Yup but that won't be because of too high precision and that's what our error message says...
> 
> So let's just remove the "to that precision" part.

Yes, you're right. Agreed. In fact, I expect that any precision problems will always be reported via the error code, so they will *never* come out as an error or an unevaluated call. This only happened before because fortan's "STOP" raised an error, which it doesn't do now anymore.

That also makes me think that the body should be

```
    v = ex._maxima_().quad_qags(x, a, b,
                                epsrel=desired_relative_error,
                                limit=maximum_num_subintervals)
    #If an error gets raised during evaluation, maxima just returns the unevaluated expression
    #we raise an error instead
    if 'quad_qags' in str(v):
        raise ValueError, "Maxima (via quadpack) cannot compute the integral"
    return float(v[0]), float(v[1]), Integer(v[2]), Integer(v[3])
```
i.e., just let `quad_qags` raise its own errors instead of masking it with a blanket error message. Presently we are not aware of any error that would get raised under normal operation in there anyway, so we would want to know what went wrong.



---

archive/issue_comments_102539.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@nbruin](#comment:70):\nOK, I'll update the patch as follows:\n\n```\ndiff --git a/sage/calculus/calculus.py b/sage/calculus/calculus.py\n--- a/sage/calculus/calculus.py\n+++ b/sage/calculus/calculus.py\n@@ -632,7 +632,8 @@\n       - ``5`` - integral is probably divergent or slowly\n         convergent\n \n-      - ``6`` - the input is invalid\n+      - ``6`` - the input is invalid; this includes the case of desired_relative_error\n+        being too small to be achieved \n \n     ALIAS: nintegrate is the same as nintegral\n \n@@ -641,9 +642,6 @@\n     integration using the GSL C library. It is potentially much faster\n     and applies to arbitrary user defined functions.\n \n-    Also, there are limits to the precision to which Maxima can compute\n-    the integral: here the error code \"6\" means \"the input is invalid\".\n-\n     ::\n \n         sage: f = x\n@@ -714,14 +712,14 @@\n                                     limit=maximum_num_subintervals)\n     except TypeError, err:\n         if \"ERROR\" in str(err):\n-            raise ValueError, \"Maxima (via quadpack) cannot compute the integral to that precision\"\n+            raise ValueError, \"Maxima (via quadpack) cannot compute the integral\"\n         else:\n             raise TypeError, err\n \n     #This is just a work around until there is a response to\n     #http://www.math.utexas.edu/pipermail/maxima/2008/012975.html\n     if 'quad_qags' in str(v):\n-        raise ValueError, \"Maxima (via quadpack) cannot compute the integral to that precision\"\n+        raise ValueError, \"Maxima (via quadpack) cannot compute the integral\"\n \n     return float(v[0]), float(v[1]), Integer(v[2]), Integer(v[3])\n```",
    "created_at": "2012-03-04T06:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102539",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@nbruin](#comment:70):
OK, I'll update the patch as follows:

```
diff --git a/sage/calculus/calculus.py b/sage/calculus/calculus.py
--- a/sage/calculus/calculus.py
+++ b/sage/calculus/calculus.py
@@ -632,7 +632,8 @@
       - ``5`` - integral is probably divergent or slowly
         convergent
 
-      - ``6`` - the input is invalid
+      - ``6`` - the input is invalid; this includes the case of desired_relative_error
+        being too small to be achieved 
 
     ALIAS: nintegrate is the same as nintegral
 
@@ -641,9 +642,6 @@
     integration using the GSL C library. It is potentially much faster
     and applies to arbitrary user defined functions.
 
-    Also, there are limits to the precision to which Maxima can compute
-    the integral: here the error code "6" means "the input is invalid".
-
     ::
 
         sage: f = x
@@ -714,14 +712,14 @@
                                     limit=maximum_num_subintervals)
     except TypeError, err:
         if "ERROR" in str(err):
-            raise ValueError, "Maxima (via quadpack) cannot compute the integral to that precision"
+            raise ValueError, "Maxima (via quadpack) cannot compute the integral"
         else:
             raise TypeError, err
 
     #This is just a work around until there is a response to
     #http://www.math.utexas.edu/pipermail/maxima/2008/012975.html
     if 'quad_qags' in str(v):
-        raise ValueError, "Maxima (via quadpack) cannot compute the integral to that precision"
+        raise ValueError, "Maxima (via quadpack) cannot compute the integral"
 
     return float(v[0]), float(v[1]), Integer(v[2]), Integer(v[3])
```



---

archive/issue_comments_102540.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nIn case anyone is waiting for my response:\n- Dima's proposed patch update is fine with me\n- I can't find Dima's updated patch on the ticket: Dima, in case you forgot to actually upload the amended patch, please do!\n- After that, JP can fix some of the formatting that bothered him and then, for the first time since ages, we can ship an up-to-date maxima with the new sage release!",
    "created_at": "2012-03-05T17:29:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102540",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:72" align="right">comment:72</div>

In case anyone is waiting for my response:
- Dima's proposed patch update is fine with me
- I can't find Dima's updated patch on the ticket: Dima, in case you forgot to actually upload the amended patch, please do!
- After that, JP can fix some of the formatting that bothered him and then, for the first time since ages, we can ship an up-to-date maxima with the new sage release!



---

archive/issue_comments_102541.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@nbruin](#comment:72):\n> In case anyone is waiting for my response:\n> - Dima's proposed patch update is fine with me\n> - I can't find Dima's updated patch on the ticket: Dima, in case you forgot to actually upload the amended patch, please do!\n\nI haven't forgotten, I was just waiting for OK...\nIt's updated now.\n\n\n> - After that, JP can fix some of the formatting that bothered him and then, for the first time since ages, we can ship an up-to-date maxima with the new sage release!",
    "created_at": "2012-03-05T23:51:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102541",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@nbruin](#comment:72):
> In case anyone is waiting for my response:
> - Dima's proposed patch update is fine with me
> - I can't find Dima's updated patch on the ticket: Dima, in case you forgot to actually upload the amended patch, please do!

I haven't forgotten, I was just waiting for OK...
It's updated now.


> - After that, JP can fix some of the formatting that bothered him and then, for the first time since ages, we can ship an up-to-date maxima with the new sage release!



---

archive/issue_events_141639.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-05T23:51:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141639"
}
```



---

archive/issue_events_141640.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-05T23:51:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141640"
}
```



---

archive/issue_events_141641.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-06T13:32:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141641"
}
```



---

archive/issue_events_141642.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-06T13:32:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141642"
}
```



---

archive/issue_comments_102542.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nI'm in the process of fixing some formatting issues (from my point of view) in Sage source tree and in the SPKG itself.\n\nTwo remarks:\n\n- I bumped the version number to 5.26.0.p0 because we use a patch on top of 5.26.0\n\n- there is no spk-check although maxima provides a test suite.\n\nI quickly looked for a good reason why there is no such file and could not yet locate one.\n\nTherefore, I'm currently testing \"make check\" and I got one failure in rtest8 related to some quad_qawf not getting evaluated (this smells like an integration issue like above).\n\nThis gives me 1 test failed out of 9,121 in 360 secs (and it does not return an error at the console level...)\n\nCan someone reproduce that failure with SPKG_CHECK=yes and the updated spkg at http://perso.telecom-paristech.fr/~flori/maxima-5.26.0.p0.spkg",
    "created_at": "2012-03-06T13:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102542",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:74" align="right">comment:74</div>

I'm in the process of fixing some formatting issues (from my point of view) in Sage source tree and in the SPKG itself.

Two remarks:

- I bumped the version number to 5.26.0.p0 because we use a patch on top of 5.26.0

- there is no spk-check although maxima provides a test suite.

I quickly looked for a good reason why there is no such file and could not yet locate one.

Therefore, I'm currently testing "make check" and I got one failure in rtest8 related to some quad_qawf not getting evaluated (this smells like an integration issue like above).

This gives me 1 test failed out of 9,121 in 360 secs (and it does not return an error at the console level...)

Can someone reproduce that failure with SPKG_CHECK=yes and the updated spkg at http://perso.telecom-paristech.fr/~flori/maxima-5.26.0.p0.spkg



---

archive/issue_comments_102543.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nSorry, there is a \"sage\" missing between flori and maxima...\n\nSo it is http://perso.telecom-paristech.fr/~flori/sage/maxima-5.26.0.p0.spkg\n\nAnd this issue is already reported here\n\nhttp://sourceforge.net/mailarchive/message.php?msg_id=28697907\n\nalthough I'm not on OpenBSD/i386 but on a Ubuntu x86_64 system which surely is less important that the underlying lisp.\n",
    "created_at": "2012-03-06T13:41:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102543",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:75" align="right">comment:75</div>

Sorry, there is a "sage" missing between flori and maxima...

So it is http://perso.telecom-paristech.fr/~flori/sage/maxima-5.26.0.p0.spkg

And this issue is already reported here

http://sourceforge.net/mailarchive/message.php?msg_id=28697907

although I'm not on OpenBSD/i386 but on a Ubuntu x86_64 system which surely is less important that the underlying lisp.




---

archive/issue_comments_102544.json:
```json
{
    "body": "Changed reviewer from **Jean-Pierre Flori,** to **Jean-Pierre Flori, Nils Bruin**",
    "created_at": "2012-03-06T13:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102544",
    "user": "https://github.com/jpflori"
}
```

Changed reviewer from **Jean-Pierre Flori,** to **Jean-Pierre Flori, Nils Bruin**



---

archive/issue_comments_102545.json:
```json
{
    "body": "Changed work issues from **domain issue, error handling in nintegral** to **spkg-check**",
    "created_at": "2012-03-06T13:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102545",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **domain issue, error handling in nintegral** to **spkg-check**



---

archive/issue_comments_102546.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nHere is the address on the byg tracker:\n\nhttp://sourceforge.net/tracker/?func=detail&atid=104933&aid=3475996&group_id=4933",
    "created_at": "2012-03-06T13:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102546",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:76" align="right">comment:76</div>

Here is the address on the byg tracker:

http://sourceforge.net/tracker/?func=detail&atid=104933&aid=3475996&group_id=4933



---

archive/issue_comments_102547.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\n> although I'm not on OpenBSD/i386 but on a Ubuntu x86_64 system which surely is less important that the underlying lisp.\n\n\nCorrect; the Maxima list is always full of minor failures in their (very large, I believe) test suite.  This shouldn't necessarily hold up positive review, because it is quite dependent on the Lisp, if I recall from reading those messages.  Also, adding the test suite should in theory be another ticket; no need to hold up having an actual up-to-date Maxima!",
    "created_at": "2012-03-06T14:13:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102547",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:77" align="right">comment:77</div>

> although I'm not on OpenBSD/i386 but on a Ubuntu x86_64 system which surely is less important that the underlying lisp.


Correct; the Maxima list is always full of minor failures in their (very large, I believe) test suite.  This shouldn't necessarily hold up positive review, because it is quite dependent on the Lisp, if I recall from reading those messages.  Also, adding the test suite should in theory be another ticket; no need to hold up having an actual up-to-date Maxima!



---

archive/issue_events_141643.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-06T16:50:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141643"
}
```



---

archive/issue_events_141644.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-06T16:50:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141644"
}
```



---

archive/issue_comments_102548.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nOk, I'll split the addition of the spkg-check.\n\nNils, could you have a look at my \"reviewer\" patch (that I'll upload in a minute for the sage tree, you can already look at the mercurial log for the spkg, ignoring the last commit for the spkg-check).\n\nI got rid of a lot of \"useless\" spaces, jsut want to be sure every one is happy with that.",
    "created_at": "2012-03-06T16:50:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102548",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:78" align="right">comment:78</div>

Ok, I'll split the addition of the spkg-check.

Nils, could you have a look at my "reviewer" patch (that I'll upload in a minute for the sage tree, you can already look at the mercurial log for the spkg, ignoring the last commit for the spkg-check).

I got rid of a lot of "useless" spaces, jsut want to be sure every one is happy with that.



---

archive/issue_comments_102549.json:
```json
{
    "body": "Changed work issues from **spkg-check** to none",
    "created_at": "2012-03-06T16:50:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102549",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **spkg-check** to none



---

archive/issue_comments_102550.json:
```json
{
    "body": "Attachment: **[trac_10682-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer.patch.gz)**\n\nReviewer patch, formatting issues",
    "created_at": "2012-03-06T16:51:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102550",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_10682-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer.patch.gz)**

Reviewer patch, formatting issues



---

archive/issue_comments_102551.json:
```json
{
    "body": "Attachment: **[trac_10682-spkg-dp.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac_10682-spkg-dp.patch.gz)**\n\nspkg diff from author, for review only",
    "created_at": "2012-03-06T17:14:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102551",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_10682-spkg-dp.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac_10682-spkg-dp.patch.gz)**

spkg diff from author, for review only



---

archive/issue_events_141645.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2012-03-06T18:44:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141645"
}
```



---

archive/issue_events_141646.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2012-03-06T18:44:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141646"
}
```



---

archive/issue_comments_102552.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nReplying to [@jpflori](#comment:78):\n> I got rid of a lot of \"useless\" spaces, jsut want to be sure every one is happy with that.\n\nAppreciated! I happen to believe that while it's nice to fix whitespace, increasing the footprint of patches by fixing it in lines that are otherwise not affected is not worth it, so I'm not too happy about it. But I don't feel sufficiently strongly about it to enter into a discussion about whether you should put the whitespace back. So I won't hold up a positive review on this. You can make up your own mind on whether you want to fix whitespace like this in the future.",
    "created_at": "2012-03-06T18:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102552",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:79" align="right">comment:79</div>

Replying to [@jpflori](#comment:78):
> I got rid of a lot of "useless" spaces, jsut want to be sure every one is happy with that.

Appreciated! I happen to believe that while it's nice to fix whitespace, increasing the footprint of patches by fixing it in lines that are otherwise not affected is not worth it, so I'm not too happy about it. But I don't feel sufficiently strongly about it to enter into a discussion about whether you should put the whitespace back. So I won't hold up a positive review on this. You can make up your own mind on whether you want to fix whitespace like this in the future.



---

archive/issue_comments_102553.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nI usually do not do it, especially so many lines at a time, but my reviewer patch was all about removing some white spaces reintroduced by Dima, and split some overlongish lines (that's another tricky choice, I can leave with long lines, but it's much more readable in a terminal without them and according to our coding guidelines we should stick  to 79 chars at max...).\n\nSo I chose to suppress them this time.\n\nIIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.\n\nI hope my choice won't break anything.\n\nAnyway, good that this ticket is finally positively reviewed.",
    "created_at": "2012-03-06T18:58:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102553",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:80" align="right">comment:80</div>

I usually do not do it, especially so many lines at a time, but my reviewer patch was all about removing some white spaces reintroduced by Dima, and split some overlongish lines (that's another tricky choice, I can leave with long lines, but it's much more readable in a terminal without them and according to our coding guidelines we should stick  to 79 chars at max...).

So I chose to suppress them this time.

IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.

I hope my choice won't break anything.

Anyway, good that this ticket is finally positively reviewed.



---

archive/issue_comments_102554.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,8 +6,11 @@\n sage: sum (binomial(n,k)*k^2, k, 1, n)  # is right n(n+1)2^(n-2)\n sage: sum (binomial(n,k)*k^2, k, 2, n)  # is false : I get 0 \n ```\n+This works correctly on Maxima 5.26 - we need to upgrade! The new spkg is at\n \n-This works correctly on Maxima 5.26 - we need to upgrade!\n-The new spkg is [here](http://boxen.math.washington.edu/home/dima/packages/maxima-5.26.0.spkg).\n+http://perso.telecom-paristech.fr/~flori/sage/maxima-5.26.0.p0.spkg\n \n-Install the spkg and apply the patch.\n+Install the spkg and apply:\n+\n+* \u00a0 [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) \n+* \u00a0[attachment: trac_10682-reviewer.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer.patch.gz)\n``````\n",
    "created_at": "2012-03-06T18:58:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102554",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,8 +6,11 @@
 sage: sum (binomial(n,k)*k^2, k, 1, n)  # is right n(n+1)2^(n-2)
 sage: sum (binomial(n,k)*k^2, k, 2, n)  # is false : I get 0 
 ```
+This works correctly on Maxima 5.26 - we need to upgrade! The new spkg is at
 
-This works correctly on Maxima 5.26 - we need to upgrade!
-The new spkg is [here](http://boxen.math.washington.edu/home/dima/packages/maxima-5.26.0.spkg).
+http://perso.telecom-paristech.fr/~flori/sage/maxima-5.26.0.p0.spkg
 
-Install the spkg and apply the patch.
+Install the spkg and apply:
+
+*   [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) 
+*  [attachment: trac_10682-reviewer.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer.patch.gz)
``````




---

archive/issue_comments_102555.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,5 +12,5 @@\n \n Install the spkg and apply:\n \n-* \u00a0 [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) \n+*  [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) \n * \u00a0[attachment: trac_10682-reviewer.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer.patch.gz)\n``````\n",
    "created_at": "2012-03-06T19:54:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102555",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,5 +12,5 @@
 
 Install the spkg and apply:
 
-*   [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) 
+*  [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) 
 *  [attachment: trac_10682-reviewer.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer.patch.gz)
``````




---

archive/issue_events_141647.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-06T19:54:22Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "title_is": "Upgrade maxima to 5.26",
    "title_was": "sum fails with lower bound != 0 or 1 (upgrade maxima to 5.26)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141647"
}
```



---

archive/issue_events_141648.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-06T19:59:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141648"
}
```



---

archive/issue_events_141649.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-06T19:59:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141649"
}
```



---

archive/issue_comments_102556.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nReplying to [@jpflori](#comment:80):\n> IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.\n\nFor precisely this reason I would prefer not to just remove all spaces everywhere.  In code which is changed by the patch, it can be done.  But not just everywhere like this.",
    "created_at": "2012-03-06T19:59:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102556",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:82" align="right">comment:82</div>

Replying to [@jpflori](#comment:80):
> IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.

For precisely this reason I would prefer not to just remove all spaces everywhere.  In code which is changed by the patch, it can be done.  But not just everywhere like this.



---

archive/issue_comments_102557.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,3 @@\n Install the spkg and apply:\n \n *  [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) \n-* \u00a0[attachment: trac_10682-reviewer.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer.patch.gz)\n``````\n",
    "created_at": "2012-03-07T04:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102557",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,3 @@
 Install the spkg and apply:
 
 *  [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) 
-*  [attachment: trac_10682-reviewer.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer.patch.gz)
``````




---

archive/issue_comments_102558.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nReplying to [@jdemeyer](#comment:82):\n> Replying to [@jpflori](#comment:80):\n> > IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.\n\n> For precisely this reason I would prefer not to just remove all spaces everywhere.  In code which is changed by the patch, it can be done.  But not just everywhere like this.\n\nwould it be OK if we just not apply the reviewer's patch?",
    "created_at": "2012-03-07T04:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102558",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:83" align="right">comment:83</div>

Replying to [@jdemeyer](#comment:82):
> Replying to [@jpflori](#comment:80):
> > IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.

> For precisely this reason I would prefer not to just remove all spaces everywhere.  In code which is changed by the patch, it can be done.  But not just everywhere like this.

would it be OK if we just not apply the reviewer's patch?



---

archive/issue_events_141650.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-07T04:59:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141650"
}
```



---

archive/issue_events_141651.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-07T04:59:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141651"
}
```



---

archive/issue_comments_102559.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nReplying to [@dimpase](#comment:83):\n\n> Replying to [@jdemeyer](#comment:82):\n> > Replying to [@jpflori](#comment:80):\n> > > IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.\n\n> > For precisely this reason I would prefer not to just remove all spaces everywhere.  In code which is changed by the patch, it can be done.  But not just everywhere like this.\n\n> would it be OK if we just not apply the reviewer's patch?\n\nI don't think so. My patch is overkill, but it's no reason to reintroduce additional formatting issues inside Sage code. If we go on like this, its going to be a real mess.",
    "created_at": "2012-03-07T06:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102559",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:84" align="right">comment:84</div>

Replying to [@dimpase](#comment:83):

> Replying to [@jdemeyer](#comment:82):
> > Replying to [@jpflori](#comment:80):
> > > IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.

> > For precisely this reason I would prefer not to just remove all spaces everywhere.  In code which is changed by the patch, it can be done.  But not just everywhere like this.

> would it be OK if we just not apply the reviewer's patch?

I don't think so. My patch is overkill, but it's no reason to reintroduce additional formatting issues inside Sage code. If we go on like this, its going to be a real mess.



---

archive/issue_events_141652.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-07T06:41:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141652"
}
```



---

archive/issue_events_141653.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-07T06:41:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141653"
}
```



---

archive/issue_comments_102560.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nReplying to [@jpflori](#comment:84):\n> Replying to [@dimpase](#comment:83):\n> \n> > Replying to [@jdemeyer](#comment:82):\n> > > Replying to [@jpflori](#comment:80):\n> > > > IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.\n\n> > > For precisely this reason I would prefer not to just remove all spaces everywhere.  In code which is changed by the patch, it can be done.  But not just everywhere like this.\n\n> > would it be OK if we just not apply the reviewer's patch?\n\n> \n> I don't think so. My patch is overkill, but it's no reason to reintroduce additional formatting issues inside Sage code. If we go on like this, its going to be a real mess.\n\nI haven't noticed that I have introduced any formatting issues. Could you point me out to this, or even better, of course, create a patch that fixes my faults?\nThanks!",
    "created_at": "2012-03-07T06:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102560",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:85" align="right">comment:85</div>

Replying to [@jpflori](#comment:84):
> Replying to [@dimpase](#comment:83):
> 
> > Replying to [@jdemeyer](#comment:82):
> > > Replying to [@jpflori](#comment:80):
> > > > IIRC there was a discussion some time ago on sae-devel about make a one time huge patch for suppressing spaces but some people, especially among sage-combinat, raised the problem that it would break patch queues and that we should rather ensure that no such new lines where added and fix for previous spaces made locally.

> > > For precisely this reason I would prefer not to just remove all spaces everywhere.  In code which is changed by the patch, it can be done.  But not just everywhere like this.

> > would it be OK if we just not apply the reviewer's patch?

> 
> I don't think so. My patch is overkill, but it's no reason to reintroduce additional formatting issues inside Sage code. If we go on like this, its going to be a real mess.

I haven't noticed that I have introduced any formatting issues. Could you point me out to this, or even better, of course, create a patch that fixes my faults?
Thanks!



---

archive/issue_events_141654.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-07T06:54:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141654"
}
```



---

archive/issue_events_141655.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-03-07T06:54:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141655"
}
```



---

archive/issue_comments_102561.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nI'll provide a patch asap of course, that's basically trailing whitespaces (e.g. last lines of your patch) in your lines and too long lines (e.g. first line of your patch) and wrong indentation for some doc (e.g. first line of your patch).\n\nIt's just that the current patch do not apply on 4.8 and as compiling atlas on my computer takes ages and installing properly atlas on my debian seems broken...\n\nMore seriously, you also removed the lines \n\n\"Also, there are limits to the precision to which Maxima can compute...\"\n\nI agree that we do not raise an error anymore, but Maxima can still not compute up to that precision.\n\nYou also left the stuff about waiting for an answer on Maxima's list, but IIRC there has been an answer there, so what is done is not really a workaround, but rather a decision from Sage developpers.",
    "created_at": "2012-03-07T07:55:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102561",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:86" align="right">comment:86</div>

I'll provide a patch asap of course, that's basically trailing whitespaces (e.g. last lines of your patch) in your lines and too long lines (e.g. first line of your patch) and wrong indentation for some doc (e.g. first line of your patch).

It's just that the current patch do not apply on 4.8 and as compiling atlas on my computer takes ages and installing properly atlas on my debian seems broken...

More seriously, you also removed the lines 

"Also, there are limits to the precision to which Maxima can compute..."

I agree that we do not raise an error anymore, but Maxima can still not compute up to that precision.

You also left the stuff about waiting for an answer on Maxima's list, but IIRC there has been an answer there, so what is done is not really a workaround, but rather a decision from Sage developpers.



---

archive/issue_comments_102562.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nLast questions (I hope):\n\nAbout the lines patched in wester.py, why did you add a semi-colon after \"n=var('n')\" ?\n\nAnd what do you mean exactly by \"Maxima 5.26 does not do \"just\" simpify() here.\" (sic)?\n\nThat now Maxima cannot simplify this expression when it is only told that Re(x) >0 and Re(y)>0 and that we have to call simplify_exp() instead ?\n\nI just check that this is indeed the case now and was not with Maxima's 5.24.0.p0 (ok this could be simply deduced from the doctest changes).\n\nIs this a decision from Maxima's developers or a bug introduced recently? if the former holds a pointer to where the change was made would be welcome; if the latter holds, this should be reported upstream.\n\nI guess that this is related to the domain stuff, because setting domain back to real answer right away.\n\nAnd it's strange that the assumptions is not needed anymore.\n\nIn fact looking into the simplify_exp code shows that maxima.eval('domain: real$') is called before calling the radcan method which actually  simplifies the expression.\n\nIn particular, this might actually be a Maxima regression.",
    "created_at": "2012-03-07T08:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102562",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:87" align="right">comment:87</div>

Last questions (I hope):

About the lines patched in wester.py, why did you add a semi-colon after "n=var('n')" ?

And what do you mean exactly by "Maxima 5.26 does not do "just" simpify() here." (sic)?

That now Maxima cannot simplify this expression when it is only told that Re(x) >0 and Re(y)>0 and that we have to call simplify_exp() instead ?

I just check that this is indeed the case now and was not with Maxima's 5.24.0.p0 (ok this could be simply deduced from the doctest changes).

Is this a decision from Maxima's developers or a bug introduced recently? if the former holds a pointer to where the change was made would be welcome; if the latter holds, this should be reported upstream.

I guess that this is related to the domain stuff, because setting domain back to real answer right away.

And it's strange that the assumptions is not needed anymore.

In fact looking into the simplify_exp code shows that maxima.eval('domain: real$') is called before calling the radcan method which actually  simplifies the expression.

In particular, this might actually be a Maxima regression.



---

archive/issue_comments_102563.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,5 @@\n \n Install the spkg and apply:\n \n-*  [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) \n+* [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz)\n+* [attachment: trac_10682-reviewer-local.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer-local.patch.gz)\n``````\n",
    "created_at": "2012-03-07T10:05:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102563",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,5 @@
 
 Install the spkg and apply:
 
-*  [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz) 
+* [attachment: trac10682_1.patch](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz)
+* [attachment: trac_10682-reviewer-local.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer-local.patch.gz)
``````




---

archive/issue_events_141656.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-07T10:05:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141656"
}
```



---

archive/issue_events_141657.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-07T10:05:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141657"
}
```



---

archive/issue_comments_102564.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nReplying to [@jpflori](#comment:87):\n\nThanks for updating the patch! It's OK with me. I'll leave the specific questions for Dima to answer.\n\n> That now Maxima cannot simplify this expression when it is only told that Re(x) >0 and Re(y)>0 and that we have to call simplify_exp() instead ?\n> In particular, this might actually be a Maxima regression.\n\nI agree that this is a Maxima regression. First maxima could verify an equality given sufficient information, and now it can't. Assuming everything in sight is real is not the same as assuming some real parts are positive (although who knows what awful bug had as a side-effect this particular equality got verified).\n\nIf you look in the history of `simp.lisp` you'll see there is some recent probably relevant work there, so I think reporting this issue might have a chance of getting it fixed (and will certainly be appreciated). \n\nWe are at the mercy of Maxima for these issues. Our alternatives are:\n- not upgrade and live with existing bugs\n- live with the regression\n- fix and patch maxima\nI think in this case, Option 2 is the practical one. Option 3 is obviously the best (both for Maxima and for Sage) but doesn't solve anything _now_.\n\nAs soon as Dima has commented, back to positive review!",
    "created_at": "2012-03-07T17:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102564",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:89" align="right">comment:89</div>

Replying to [@jpflori](#comment:87):

Thanks for updating the patch! It's OK with me. I'll leave the specific questions for Dima to answer.

> That now Maxima cannot simplify this expression when it is only told that Re(x) >0 and Re(y)>0 and that we have to call simplify_exp() instead ?
> In particular, this might actually be a Maxima regression.

I agree that this is a Maxima regression. First maxima could verify an equality given sufficient information, and now it can't. Assuming everything in sight is real is not the same as assuming some real parts are positive (although who knows what awful bug had as a side-effect this particular equality got verified).

If you look in the history of `simp.lisp` you'll see there is some recent probably relevant work there, so I think reporting this issue might have a chance of getting it fixed (and will certainly be appreciated). 

We are at the mercy of Maxima for these issues. Our alternatives are:
- not upgrade and live with existing bugs
- live with the regression
- fix and patch maxima
I think in this case, Option 2 is the practical one. Option 3 is obviously the best (both for Maxima and for Sage) but doesn't solve anything _now_.

As soon as Dima has commented, back to positive review!



---

archive/issue_comments_102565.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nReplying to [@jpflori](#comment:86):\n\n> More seriously, you also removed the lines \n> \n> \"Also, there are limits to the precision to which Maxima can compute...\"\n> \n> I agree that we do not raise an error anymore, but Maxima can still not compute up to that precision.\n> \n\nthese lines essentially duplicated the description of return code 6 several lines above these.\n\n\n\n> You also left the stuff about waiting for an answer on Maxima's list, but IIRC there has been an answer there, so what is done is not really a workaround, but rather a decision from Sage developpers.\n\nwell, that's the stuff I had no knowledge about, so I left it stand, obviously.\n\nDima",
    "created_at": "2012-03-08T05:27:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102565",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:90" align="right">comment:90</div>

Replying to [@jpflori](#comment:86):

> More seriously, you also removed the lines 
> 
> "Also, there are limits to the precision to which Maxima can compute..."
> 
> I agree that we do not raise an error anymore, but Maxima can still not compute up to that precision.
> 

these lines essentially duplicated the description of return code 6 several lines above these.



> You also left the stuff about waiting for an answer on Maxima's list, but IIRC there has been an answer there, so what is done is not really a workaround, but rather a decision from Sage developpers.

well, that's the stuff I had no knowledge about, so I left it stand, obviously.

Dima



---

archive/issue_comments_102566.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nReplying to [@jpflori](#comment:87):\n> Last questions (I hope):\n> \n> About the lines patched in wester.py, why did you add a semi-colon after \"n=var('n')\" ?\n\nhmm, perhaps a result of a copy/paste from Sage prompt...\n> \n> And what do you mean exactly by \"Maxima 5.26 does not do \"just\" simpify() here.\" (sic)?\n> \n> That now Maxima cannot simplify this expression when it is only told that Re(x) >0 and Re(y)>0 and that we have to call simplify_exp() instead ?\n\nIndeed.",
    "created_at": "2012-03-08T05:30:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102566",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:91" align="right">comment:91</div>

Replying to [@jpflori](#comment:87):
> Last questions (I hope):
> 
> About the lines patched in wester.py, why did you add a semi-colon after "n=var('n')" ?

hmm, perhaps a result of a copy/paste from Sage prompt...
> 
> And what do you mean exactly by "Maxima 5.26 does not do "just" simpify() here." (sic)?
> 
> That now Maxima cannot simplify this expression when it is only told that Re(x) >0 and Re(y)>0 and that we have to call simplify_exp() instead ?

Indeed.



---

archive/issue_comments_102567.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nOk, I understand. Nonetheless I think its better to be more verbose as was the case before, especially that no error is now explicitely returned.\n\nIf someone does not pay attention, one might think that Sage returns 0 for the integral of x between 0 an 1.",
    "created_at": "2012-03-08T06:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102567",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:92" align="right">comment:92</div>

Ok, I understand. Nonetheless I think its better to be more verbose as was the case before, especially that no error is now explicitely returned.

If someone does not pay attention, one might think that Sage returns 0 for the integral of x between 0 an 1.



---

archive/issue_comments_102568.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nReplying to [@jpflori](#comment:92):\n> Ok, I understand. Nonetheless I think its better to be more verbose as was the case before, especially that no error is now explicitely returned.\n> \n> If someone does not pay attention, one might think that Sage returns 0 for the integral of x between 0 an 1.\n\nOK, I updated the patch as follows, to reflect this and a couple of other minor points raised:\n\n```\n\ndiff --git a/sage/calculus/calculus.py b/sage/calculus/calculus.py\n--- a/sage/calculus/calculus.py\n+++ b/sage/calculus/calculus.py\n@@ -641,6 +641,8 @@\n     ``numerical_integral`` that implements numerical\n     integration using the GSL C library. It is potentially much faster\n     and applies to arbitrary user defined functions.\n+    Also, there are limits to the precision to which Maxima can compute \n+    the integral to due to limitations in quadpack. \n \n     ::\n \ndiff --git a/sage/calculus/wester.py b/sage/calculus/wester.py\n--- a/sage/calculus/wester.py\n+++ b/sage/calculus/wester.py\n@@ -383,9 +383,10 @@\n ::\n \n     sage: # (YES) Assuming Re(x)>0, Re(y)>0, deduce x^(1/n)*y^(1/n)-(x*y)^(1/n)=0.\n-    sage: # Maxima 5.26 does not do \"just\" simpify() here. Thus simplify_exp() used.\n+    sage: # Maxima 5.26 cannot do \"just\" simpify() here. Thus simplify_exp() is used. \n+    sage: # This is a regression from 5.24\n     sage: # assume(real(x) > 0, real(y) > 0) # (not needed for simplify_exp())\n-    sage: n = var('n');\n+    sage: n = var('n')\n     sage: f = x^(1/n)*y^(1/n)-(x*y)^(1/n)\n     sage: f.simplify_exp()\n     0\n```",
    "created_at": "2012-03-08T10:37:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102568",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:93" align="right">comment:93</div>

Replying to [@jpflori](#comment:92):
> Ok, I understand. Nonetheless I think its better to be more verbose as was the case before, especially that no error is now explicitely returned.
> 
> If someone does not pay attention, one might think that Sage returns 0 for the integral of x between 0 an 1.

OK, I updated the patch as follows, to reflect this and a couple of other minor points raised:

```

diff --git a/sage/calculus/calculus.py b/sage/calculus/calculus.py
--- a/sage/calculus/calculus.py
+++ b/sage/calculus/calculus.py
@@ -641,6 +641,8 @@
     ``numerical_integral`` that implements numerical
     integration using the GSL C library. It is potentially much faster
     and applies to arbitrary user defined functions.
+    Also, there are limits to the precision to which Maxima can compute 
+    the integral to due to limitations in quadpack. 
 
     ::
 
diff --git a/sage/calculus/wester.py b/sage/calculus/wester.py
--- a/sage/calculus/wester.py
+++ b/sage/calculus/wester.py
@@ -383,9 +383,10 @@
 ::
 
     sage: # (YES) Assuming Re(x)>0, Re(y)>0, deduce x^(1/n)*y^(1/n)-(x*y)^(1/n)=0.
-    sage: # Maxima 5.26 does not do "just" simpify() here. Thus simplify_exp() used.
+    sage: # Maxima 5.26 cannot do "just" simpify() here. Thus simplify_exp() is used. 
+    sage: # This is a regression from 5.24
     sage: # assume(real(x) > 0, real(y) > 0) # (not needed for simplify_exp())
-    sage: n = var('n');
+    sage: n = var('n')
     sage: f = x^(1/n)*y^(1/n)-(x*y)^(1/n)
     sage: f.simplify_exp()
     0
```



---

archive/issue_comments_102569.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nIn fact, I already corrected these issues in my patch, so if you're happy with my corrections, you'd better reupload the previous version of your patch and let the ticket have positive review.\n\nOtherwise, the reviewer patch will have to be rebased.",
    "created_at": "2012-03-08T10:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102569",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:94" align="right">comment:94</div>

In fact, I already corrected these issues in my patch, so if you're happy with my corrections, you'd better reupload the previous version of your patch and let the ticket have positive review.

Otherwise, the reviewer patch will have to be rebased.



---

archive/issue_comments_102570.json:
```json
{
    "body": "Attachment: **[trac10682_1.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz)**\n\nSage library patch to go with the new spkg",
    "created_at": "2012-03-08T11:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102570",
    "user": "https://github.com/dimpase"
}
```

Attachment: **[trac10682_1.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac10682_1.patch.gz)**

Sage library patch to go with the new spkg



---

archive/issue_comments_102571.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nReplying to [@jpflori](#comment:94):\n> In fact, I already corrected these issues in my patch, so if you're happy with my corrections, you'd better reupload the previous version of your patch and let the ticket have positive review.\n\n\nre-uploaded the previous version. \nUsed Apple's Time Machine backup fot the 1st time ever :-)",
    "created_at": "2012-03-08T11:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102571",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:95" align="right">comment:95</div>

Replying to [@jpflori](#comment:94):
> In fact, I already corrected these issues in my patch, so if you're happy with my corrections, you'd better reupload the previous version of your patch and let the ticket have positive review.


re-uploaded the previous version. 
Used Apple's Time Machine backup fot the 1st time ever :-)



---

archive/issue_comments_102572.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\n\n```\n\"just\" simpify()\n```\nI assume that, since you are changing that line anyway, it would be trivial to edit \"by hand\" the text .patch file so that this reads\n\n```\n\"just\" simplify()\n```\nIt seems to be the sort of thing we should fix :)",
    "created_at": "2012-03-08T18:08:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102572",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:96" align="right">comment:96</div>


```
"just" simpify()
```
I assume that, since you are changing that line anyway, it would be trivial to edit "by hand" the text .patch file so that this reads

```
"just" simplify()
```
It seems to be the sort of thing we should fix :)



---

archive/issue_comments_102573.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nThese lines are in fact changed in the reviewer patch.",
    "created_at": "2012-03-08T21:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102573",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:97" align="right">comment:97</div>

These lines are in fact changed in the reviewer patch.



---

archive/issue_comments_102574.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nSorry, I just saw what you pasted above.  Sorry for the noise.",
    "created_at": "2012-03-08T22:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102574",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:98" align="right">comment:98</div>

Sorry, I just saw what you pasted above.  Sorry for the noise.



---

archive/issue_comments_102575.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nI'm sorry to report that the new spkg seems to cause problems for the expect interface for maxima. I don't think this problem arose with Dima's original spkg. Of course, I'd be very happy to hear that other people cannot reproduce this problem and that I'm not building ecl/maxima correctly, but currently I'm experiencing:\n\n```\nsage: maxima(1)\n[HANGS]\n```\nThis happens to me on two different builds where I've applied the recipe as outlined in the ticket description. For one, see [sage.math](http://sage.math.washington.edu/home/nbruin/sage-5.0/).\nAs it stands, I don't think this ticket will pass doctests (it doesn't for me).",
    "created_at": "2012-03-09T08:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102575",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:99" align="right">comment:99</div>

I'm sorry to report that the new spkg seems to cause problems for the expect interface for maxima. I don't think this problem arose with Dima's original spkg. Of course, I'd be very happy to hear that other people cannot reproduce this problem and that I'm not building ecl/maxima correctly, but currently I'm experiencing:

```
sage: maxima(1)
[HANGS]
```
This happens to me on two different builds where I've applied the recipe as outlined in the ticket description. For one, see [sage.math](http://sage.math.washington.edu/home/nbruin/sage-5.0/).
As it stands, I don't think this ticket will pass doctests (it doesn't for me).



---

archive/issue_events_141658.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2012-03-09T08:03:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141658"
}
```



---

archive/issue_events_141659.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2012-03-09T08:03:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141659"
}
```



---

archive/issue_comments_102576.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nReplying to [@nbruin](#comment:99):\n> I'm sorry to report that the new spkg seems to cause problems for the expect interface for maxima. I don't think this problem arose with Dima's original spkg. Of course, I'd be very happy to hear that other people cannot reproduce this problem and that I'm not building ecl/maxima correctly, but currently I'm experiencing:\n> \n> ```\n> sage: maxima(1)\n> [HANGS]\n> ```\n> This happens to me on two different builds where I've applied the recipe as outlined in the ticket description. For one, see [sage.math](http://sage.math.washington.edu/home/nbruin/sage-5.0/).\n> As it stands, I don't think this ticket will pass doctests (it doesn't for me).\n\nI also see weirdness: e.g. some doctests ran out of time with the present spkg/patches pair, while they worked fine with my original spkg/patches pair...",
    "created_at": "2012-03-09T08:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102576",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:100" align="right">comment:100</div>

Replying to [@nbruin](#comment:99):
> I'm sorry to report that the new spkg seems to cause problems for the expect interface for maxima. I don't think this problem arose with Dima's original spkg. Of course, I'd be very happy to hear that other people cannot reproduce this problem and that I'm not building ecl/maxima correctly, but currently I'm experiencing:
> 
> ```
> sage: maxima(1)
> [HANGS]
> ```
> This happens to me on two different builds where I've applied the recipe as outlined in the ticket description. For one, see [sage.math](http://sage.math.washington.edu/home/nbruin/sage-5.0/).
> As it stands, I don't think this ticket will pass doctests (it doesn't for me).

I also see weirdness: e.g. some doctests ran out of time with the present spkg/patches pair, while they worked fine with my original spkg/patches pair...



---

archive/issue_events_141660.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-09T08:08:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141660"
}
```



---

archive/issue_events_141661.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-09T08:08:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141661"
}
```



---

archive/issue_comments_102577.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIt's strange that you report that it did not happen with Dima original package because the only changes I've made to the spkg are purely typographical (see [attachment: trac_10682-spkg.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-spkg.patch.gz) Download).\nI'll recheck on my computer.",
    "created_at": "2012-03-09T08:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102577",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:1" align="right">comment:1</div>

It's strange that you report that it did not happen with Dima original package because the only changes I've made to the spkg are purely typographical (see [attachment: trac_10682-spkg.patch](https://github.com/sagemath/sage/files/ticket10682/trac_10682-spkg.patch.gz) Download).
I'll recheck on my computer.



---

archive/issue_comments_102578.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI confirm that something went wrong with the last spkg I uploaded, maybe I downloaded a wrong base spkg, I'll check that now.",
    "created_at": "2012-03-09T08:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102578",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:2" align="right">comment:2</div>

I confirm that something went wrong with the last spkg I uploaded, maybe I downloaded a wrong base spkg, I'll check that now.



---

archive/issue_comments_102579.json:
```json
{
    "body": "spkg diff from reviewer, for review only",
    "created_at": "2012-03-09T09:33:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102579",
    "user": "https://github.com/jpflori"
}
```

spkg diff from reviewer, for review only



---

archive/issue_comments_102580.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[trac_10682-spkg.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac_10682-spkg.patch.gz)**\n\nOk that was an error from my part, some TABS were actually needed in spkg-install.\nThis is fixed now.\nI've also swpped two lines in the sage tree patch.\nI'll upload a fixed version in a moment.",
    "created_at": "2012-03-09T09:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102580",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[trac_10682-spkg.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac_10682-spkg.patch.gz)**

Ok that was an error from my part, some TABS were actually needed in spkg-install.
This is fixed now.
I've also swpped two lines in the sage tree patch.
I'll upload a fixed version in a moment.



---

archive/issue_comments_102581.json:
```json
{
    "body": "Attachment: **[trac_10682-reviewer-local.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer-local.patch.gz)**\n\nReviewer patch",
    "created_at": "2012-03-09T10:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102581",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_10682-reviewer-local.patch.gz](https://github.com/sagemath/sage/files/ticket10682/trac_10682-reviewer-local.patch.gz)**

Reviewer patch



---

archive/issue_events_141662.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-09T10:59:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141662"
}
```



---

archive/issue_events_141663.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-09T10:59:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141663"
}
```



---

archive/issue_comments_102582.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nmake ptest is fine on my computer now (ubuntu/amd64).",
    "created_at": "2012-03-09T10:59:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102582",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:4" align="right">comment:4</div>

make ptest is fine on my computer now (ubuntu/amd64).



---

archive/issue_comments_102583.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">comment:105</div>\n\nReplying to [@jpflori](#comment:104):\n> make ptest is fine on my computer now (ubuntu/amd64).\n\nmake ptestlong went well on MacOSX 10.6.8.\nlooks like it's good to go!",
    "created_at": "2012-03-09T13:51:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102583",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:105" align="right">comment:105</div>

Replying to [@jpflori](#comment:104):
> make ptest is fine on my computer now (ubuntu/amd64).

make ptestlong went well on MacOSX 10.6.8.
looks like it's good to go!



---

archive/issue_comments_102584.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nno complaints here.",
    "created_at": "2012-03-09T19:13:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102584",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:6" align="right">comment:6</div>

no complaints here.



---

archive/issue_events_141664.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2012-03-09T19:13:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141664"
}
```



---

archive/issue_events_141665.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2012-03-09T19:13:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141665"
}
```



---

archive/issue_comments_102585.json:
```json
{
    "body": "Merged: **sage-5.0.beta8**",
    "created_at": "2012-03-13T08:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102585",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta8**



---

archive/issue_events_141666.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-13T08:22:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141666"
}
```



---

archive/issue_events_141667.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-13T08:22:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10682#event-141667"
}
```



---

archive/issue_comments_102586.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to **Dmitrii Pasechnik**",
    "created_at": "2012-03-20T07:36:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10682#issuecomment-102586",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Dima Pasechnik** to **Dmitrii Pasechnik**
