# Issue 10529: dimension() and is_smooth() for algebraic subschemes of toric varieties

archive/issues_010476.json:
```json
{
    "body": "The purpose of this ticket is to implement `dimension()` and a `is_smooth()` method for algebraic subschemes of toric varieties, that is, not necessarily complete intersection subschemes.\n\nThis patch does not yet deal properly with singular ambient toric varieties. This will be implemented in a different ticket since this part has further dependencies.\n\nThis ticket is broken down into the following individual patches:\n\n1. `trac_10529_toric_variety_library_names.patch`\n\nThis adds optional `names=\"...\"` parameters to `ToricVarietyFactory` (the class of the `toric_varieties` object) and to `ToricVariety` and `CPRFanoToricVariety` in order to allow you to declare the names of the homogeneous variables as\n\n```\nsage: P2.<x,y,z> = CPRFanoToricVariety(Delta_polar=ReflexivePolytope(3,0))\nsage: dP6.<x0,x1,x2,x3,x4,x5> = toric_varieties.dP6()\n```\n\n2. `trac_10529_MPolynomialIdeal_subs.patch`\n\nThis fixes `subs()` for ideals in multivariate polynomial rings. This is currently a noop:\n\n```\nsage: R.<x,y> = PolynomialRing(QQ)\nsage: I = R.ideal(x)\nsage: I\nIdeal (x) of Multivariate Polynomial Ring in x, y over Rational Field\nsage: I.subs(x=y)\nIdeal (x) of Multivariate Polynomial Ring in x, y over Rational Field\n```\nWith this patch, the output is\n\n```\nsage: I.subs(x=y)\nIdeal (y) of Multivariate Polynomial Ring in x, y over Rational Field\n```\n\n\n3. `trac_10529_SubschemeMorphisms_without_QuotientRing.patch`\n\nWithout this patch, morphisms to algebraic subschemes involve the `coordinate_ring()` of the subscheme, a quotient ring:\n\n```\nsage: A2.<x,y> = AffineSpace(QQ,2)\nsage: X=A2.subscheme(x)\nsage: Y=A2.subscheme(y)\nsage: X.hom([y,x],Y)\nScheme morphism:\n  From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n  x\n  To:   Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n  y\n  Defn: Defined on coordinates by sending (x, y) to\n        (ybar, 0)\n```\nThis patch uses the polynomial ring of the ambient space instead. This is mathematically equivalent, but much more convenient for polynomial computations.\n\n```\nsage: sage: X.hom([y,x],Y)\nScheme morphism:\n  From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n  x\n  To:   Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n  y\n  Defn: Defined on coordinates by sending (x, y) to\n        (y, 0)\n```\n\n4. `trac_10529_smoothness_of_algebraic_subschemes.patch`\n\nFinally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.\n\nDepends on #10525\n\n**Apply**\n1. [attachment:trac_10529_toric_variety_library_names.patch]\n2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]\n3. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]\n4. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]\n5. [attachment:trac_10529_reviewer.patch]\n\n**This ticket must be merged together with #10540**\n\nAssignee: @aghitza\n\nCC:  @novoselt\n\nKeywords: sd31\n\nResolution: fixed\n\nAuthor: Volker Braun\n\nReviewer: Andrey Novoseltsev\n\nMerged: sage-4.7.1.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/10529\n\n",
    "closed_at": "2011-06-24T09:20:15Z",
    "created_at": "2010-12-27T22:45:13Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "dimension() and is_smooth() for algebraic subschemes of toric varieties",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10529",
    "user": "https://github.com/vbraun"
}
```
The purpose of this ticket is to implement `dimension()` and a `is_smooth()` method for algebraic subschemes of toric varieties, that is, not necessarily complete intersection subschemes.

This patch does not yet deal properly with singular ambient toric varieties. This will be implemented in a different ticket since this part has further dependencies.

This ticket is broken down into the following individual patches:

1. `trac_10529_toric_variety_library_names.patch`

This adds optional `names="..."` parameters to `ToricVarietyFactory` (the class of the `toric_varieties` object) and to `ToricVariety` and `CPRFanoToricVariety` in order to allow you to declare the names of the homogeneous variables as

```
sage: P2.<x,y,z> = CPRFanoToricVariety(Delta_polar=ReflexivePolytope(3,0))
sage: dP6.<x0,x1,x2,x3,x4,x5> = toric_varieties.dP6()
```

2. `trac_10529_MPolynomialIdeal_subs.patch`

This fixes `subs()` for ideals in multivariate polynomial rings. This is currently a noop:

```
sage: R.<x,y> = PolynomialRing(QQ)
sage: I = R.ideal(x)
sage: I
Ideal (x) of Multivariate Polynomial Ring in x, y over Rational Field
sage: I.subs(x=y)
Ideal (x) of Multivariate Polynomial Ring in x, y over Rational Field
```
With this patch, the output is

```
sage: I.subs(x=y)
Ideal (y) of Multivariate Polynomial Ring in x, y over Rational Field
```


3. `trac_10529_SubschemeMorphisms_without_QuotientRing.patch`

Without this patch, morphisms to algebraic subschemes involve the `coordinate_ring()` of the subscheme, a quotient ring:

```
sage: A2.<x,y> = AffineSpace(QQ,2)
sage: X=A2.subscheme(x)
sage: Y=A2.subscheme(y)
sage: X.hom([y,x],Y)
Scheme morphism:
  From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
  x
  To:   Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
  y
  Defn: Defined on coordinates by sending (x, y) to
        (ybar, 0)
```
This patch uses the polynomial ring of the ambient space instead. This is mathematically equivalent, but much more convenient for polynomial computations.

```
sage: sage: X.hom([y,x],Y)
Scheme morphism:
  From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
  x
  To:   Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
  y
  Defn: Defined on coordinates by sending (x, y) to
        (y, 0)
```

4. `trac_10529_smoothness_of_algebraic_subschemes.patch`

Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.

Depends on #10525

**Apply**
1. [attachment:trac_10529_toric_variety_library_names.patch]
2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]
3. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]
4. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]
5. [attachment:trac_10529_reviewer.patch]

**This ticket must be merged together with #10540**

Assignee: @aghitza

CC:  @novoselt

Keywords: sd31

Resolution: fixed

Author: Volker Braun

Reviewer: Andrey Novoseltsev

Merged: sage-4.7.1.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/10529





---

archive/issue_comments_131489.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,93 @@\n The purpose of this ticket is to implement `dimension()` and a `is_smooth()` method for algebraic subschemes of toric varieties, that is, not necessarily complete intersection subschemes.\n \n This patch does not yet deal properly with singular ambient toric varieties. This will be implemented in a different ticket since this part has further dependencies.\n+\n+This ticket is broken down into the following individual patches:\n+\n+1. `trac_10529_toric_variety_library_names.patch`\n+\n+This adds optional `names=\"...\"` parameters to `ToricVarietyFactory` (the class of the `toric_varieties` object) and to `ToricVariety` and `CPRFanoToricVariety` in order to allow you to declare the names of the homogeneous variables as\n+\n+```\n+sage: P2.<x,y,z> = CPRFanoToricVariety(Delta_polar=ReflexivePolytope(3,0))\n+sage: dP6.<x0,x1,x2,x3,x4,x5> = toric_varieties.dP6()\n+```\n+\n+2. `trac_10529_MPolynomialIdeal_subs.patch`\n+\n+This fixes `subs()` for ideals in multivariate polynomial rings. This is currently a noop:\n+\n+```\n+sage: R.<x,y> = PolynomialRing(QQ)\n+sage: I = R.ideal(x)\n+sage: I\n+Ideal (x) of Multivariate Polynomial Ring in x, y over Rational Field\n+sage: I.subs(x=y)\n+Ideal (x) of Multivariate Polynomial Ring in x, y over Rational Field\n+```\n+With this patch, the output is\n+\n+```\n+sage: I.subs(x=y)\n+Ideal (y) of Multivariate Polynomial Ring in x, y over Rational Field\n+```\n+\n+3. `trac_10529_QuotientRingElement_call.patch`\n+\n+This hands `QuotientRingElement.__call__` down to the `lift()`:\n+\n+```\n+sage: R.<x,y> = PolynomialRing(QQ)\n+sage: (x^2+y)(1,1)\n+2\n+sage: Q.<xbar,ybar> = R.quotient(x-y)\n+sage: (xbar^2+ybar)(1,1)\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+\n+/home/vbraun/opt/sage-4.6.1.rc0/devel/sage-main/<ipython console> in <module>()\n+\n+TypeError: 'QuotientRingElement' object is not callable\n+```\n+becomes\n+\n+```\n+sage: (xbar^2+ybar)(1,1)\n+2\n+```\n+\n+\n+\n+4. `trac_10529_SubschemeMorphisms_without_QuotientRing.patch`\n+\n+Without this patch, morphisms to algebraic subschemes involve the `coordinate_ring()` of the subscheme, a quotient ring:\n+\n+```\n+sage: A2.<x,y> = AffineSpace(QQ,2)\n+sage: X=A2.subscheme(x)\n+sage: Y=A2.subscheme(y)\n+sage: X.hom([y,x],Y)\n+Scheme morphism:\n+  From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n+  x\n+  To:   Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n+  y\n+  Defn: Defined on coordinates by sending (x, y) to\n+        (ybar, 0)\n+```\n+This patch uses the polynomial ring of the ambient space instead. This is mathematically equivalent, but much more convenient for polynomial computations.\n+\n+```\n+sage: sage: X.hom([y,x],Y)\n+Scheme morphism:\n+  From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n+  x\n+  To:   Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:\n+  y\n+  Defn: Defined on coordinates by sending (x, y) to\n+        (y, 0)\n+```\n+\n+5. `trac_10529_smoothness_of_algebraic_subschemes.patch`\n+\n+Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.\n``````\n",
    "created_at": "2010-12-28T00:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131489",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,93 @@
 The purpose of this ticket is to implement `dimension()` and a `is_smooth()` method for algebraic subschemes of toric varieties, that is, not necessarily complete intersection subschemes.
 
 This patch does not yet deal properly with singular ambient toric varieties. This will be implemented in a different ticket since this part has further dependencies.
+
+This ticket is broken down into the following individual patches:
+
+1. `trac_10529_toric_variety_library_names.patch`
+
+This adds optional `names="..."` parameters to `ToricVarietyFactory` (the class of the `toric_varieties` object) and to `ToricVariety` and `CPRFanoToricVariety` in order to allow you to declare the names of the homogeneous variables as
+
+```
+sage: P2.<x,y,z> = CPRFanoToricVariety(Delta_polar=ReflexivePolytope(3,0))
+sage: dP6.<x0,x1,x2,x3,x4,x5> = toric_varieties.dP6()
+```
+
+2. `trac_10529_MPolynomialIdeal_subs.patch`
+
+This fixes `subs()` for ideals in multivariate polynomial rings. This is currently a noop:
+
+```
+sage: R.<x,y> = PolynomialRing(QQ)
+sage: I = R.ideal(x)
+sage: I
+Ideal (x) of Multivariate Polynomial Ring in x, y over Rational Field
+sage: I.subs(x=y)
+Ideal (x) of Multivariate Polynomial Ring in x, y over Rational Field
+```
+With this patch, the output is
+
+```
+sage: I.subs(x=y)
+Ideal (y) of Multivariate Polynomial Ring in x, y over Rational Field
+```
+
+3. `trac_10529_QuotientRingElement_call.patch`
+
+This hands `QuotientRingElement.__call__` down to the `lift()`:
+
+```
+sage: R.<x,y> = PolynomialRing(QQ)
+sage: (x^2+y)(1,1)
+2
+sage: Q.<xbar,ybar> = R.quotient(x-y)
+sage: (xbar^2+ybar)(1,1)
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+
+/home/vbraun/opt/sage-4.6.1.rc0/devel/sage-main/<ipython console> in <module>()
+
+TypeError: 'QuotientRingElement' object is not callable
+```
+becomes
+
+```
+sage: (xbar^2+ybar)(1,1)
+2
+```
+
+
+
+4. `trac_10529_SubschemeMorphisms_without_QuotientRing.patch`
+
+Without this patch, morphisms to algebraic subschemes involve the `coordinate_ring()` of the subscheme, a quotient ring:
+
+```
+sage: A2.<x,y> = AffineSpace(QQ,2)
+sage: X=A2.subscheme(x)
+sage: Y=A2.subscheme(y)
+sage: X.hom([y,x],Y)
+Scheme morphism:
+  From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
+  x
+  To:   Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
+  y
+  Defn: Defined on coordinates by sending (x, y) to
+        (ybar, 0)
+```
+This patch uses the polynomial ring of the ambient space instead. This is mathematically equivalent, but much more convenient for polynomial computations.
+
+```
+sage: sage: X.hom([y,x],Y)
+Scheme morphism:
+  From: Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
+  x
+  To:   Closed subscheme of Affine Space of dimension 2 over Rational Field defined by:
+  y
+  Defn: Defined on coordinates by sending (x, y) to
+        (y, 0)
+```
+
+5. `trac_10529_smoothness_of_algebraic_subschemes.patch`
+
+Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.
``````




---

archive/issue_comments_131490.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-12-28T00:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131490",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_131491.json:
```json
{
    "body": "<a id='comment:3'></a>For the trac bot:\n\nDepends on #10525\n\nApply trac_10529_toric_variety_library_names.patch, trac_10529_MPolynomialIdeal_subs.patch, trac_10529_QuotientRingElement_call.patch, trac_10529_SubschemeMorphisms_without_QuotientRing.patch, trac_10529_smoothness_of_algebraic_subschemes.patch",
    "created_at": "2010-12-28T17:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131491",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>For the trac bot:

Depends on #10525

Apply trac_10529_toric_variety_library_names.patch, trac_10529_MPolynomialIdeal_subs.patch, trac_10529_QuotientRingElement_call.patch, trac_10529_SubschemeMorphisms_without_QuotientRing.patch, trac_10529_smoothness_of_algebraic_subschemes.patch



---

archive/issue_comments_131492.json:
```json
{
    "body": "Updated patch for sage-4.6.2.alpha0",
    "created_at": "2011-01-19T03:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131492",
    "user": "https://github.com/vbraun"
}
```

Updated patch for sage-4.6.2.alpha0



---

archive/issue_comments_131493.json:
```json
{
    "body": "<a id='comment:4'></a>Attachment [trac_10529_SubschemeMorphisms_without_QuotientRing.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_SubschemeMorphisms_without_QuotientRing.patch) by @vbraun created at 2011-01-19 22:09:19\n\nFor the patch bot: \nDepends on #9055, #10525",
    "created_at": "2011-01-19T22:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131493",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>Attachment [trac_10529_SubschemeMorphisms_without_QuotientRing.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_SubschemeMorphisms_without_QuotientRing.patch) by @vbraun created at 2011-01-19 22:09:19

For the patch bot: 
Depends on #9055, #10525



---

archive/issue_comments_131494.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Andrey Novoseltsev\"",
    "created_at": "2011-02-23T03:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131494",
    "user": "https://github.com/novoselt"
}
```

Changing reviewer from "" to "Andrey Novoseltsev"



---

archive/issue_comments_131495.json:
```json
{
    "body": "<a id='comment:5'></a>Hi Volker, I guess I better start reviewing this ticket. Little picks at the first patch (trac_10529_toric_variety_library_names.patch).\n\n1. It seems that instead of\n {{{\n- ``names`` -- an alias of ``coordinate_names`` for internal\n  use. Takes precedence if set.\n}}}\n you mean to say\n {{{\n- ``names`` -- an alias of ``coordinate_names`` for internal\n  use, cannot be specified together with ``coordinate_names``;\n}}}\n and I think that instead of \n {{{\n    if not names is None:\n        assert coordinate_names is None, \\\n            'You must not specify both coordinate_names and names!'\n        coordinate_names = names\n}}}\n it would be better to have\n {{{\n    if names is not None:\n        if coordinate_names is not None:\n            raise ValueError('You must not specify both coordinate_names and names!')\n        coordinate_names = names\n}}}\n\n2. When you write\n {{{\ndict_key = '_ '+name+' '+'_'.join(coordinate_names) \n}}}\n is it intentional that there is a space after the first underscore? Also, did you mean to join coordinate names with underscores? Look at this:\n {{{\nsage: toric_varieties.__dict__\n{}\nsage: toric_varieties.P2()    \n2-d CPR-Fano toric variety covered by 3 affine patches\nsage: toric_varieties.__dict__\n{'_ P2 x_ _y_ _z': 2-d CPR-Fano toric variety covered by 3 affine patches}\n}}}\n If you meant to create a key `_P2_x_y_z`, I suggest using `normalize_names` from `toric_variety` on coordinate names before joining them and, of course, removing the space. Since you directly work with `__dict__` it is fine even with spaces, but you cannot call this name as an attribute (which can be sometimes convenient for debugging). It still shows in TAB completion, however!\n\n3. Wouldn't it be better to write\n {{{\ndef dP6(self, names='x u y v z w'): \n   ...\n}}}\n instead of \n {{{\ndef dP6(self, names=None):\n    if names is None:\n        names = 'x u y v z w'\n    ...\n}}}\n\n4. This new argument `names` must be documented in `dP6` etc.",
    "created_at": "2011-02-23T03:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131495",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>Hi Volker, I guess I better start reviewing this ticket. Little picks at the first patch (trac_10529_toric_variety_library_names.patch).

1. It seems that instead of
 {{{
- ``names`` -- an alias of ``coordinate_names`` for internal
  use. Takes precedence if set.
}}}
 you mean to say
 {{{
- ``names`` -- an alias of ``coordinate_names`` for internal
  use, cannot be specified together with ``coordinate_names``;
}}}
 and I think that instead of 
 {{{
    if not names is None:
        assert coordinate_names is None, \
            'You must not specify both coordinate_names and names!'
        coordinate_names = names
}}}
 it would be better to have
 {{{
    if names is not None:
        if coordinate_names is not None:
            raise ValueError('You must not specify both coordinate_names and names!')
        coordinate_names = names
}}}

2. When you write
 {{{
dict_key = '_ '+name+' '+'_'.join(coordinate_names) 
}}}
 is it intentional that there is a space after the first underscore? Also, did you mean to join coordinate names with underscores? Look at this:
 {{{
sage: toric_varieties.__dict__
{}
sage: toric_varieties.P2()    
2-d CPR-Fano toric variety covered by 3 affine patches
sage: toric_varieties.__dict__
{'_ P2 x_ _y_ _z': 2-d CPR-Fano toric variety covered by 3 affine patches}
}}}
 If you meant to create a key `_P2_x_y_z`, I suggest using `normalize_names` from `toric_variety` on coordinate names before joining them and, of course, removing the space. Since you directly work with `__dict__` it is fine even with spaces, but you cannot call this name as an attribute (which can be sometimes convenient for debugging). It still shows in TAB completion, however!

3. Wouldn't it be better to write
 {{{
def dP6(self, names='x u y v z w'): 
   ...
}}}
 instead of 
 {{{
def dP6(self, names=None):
    if names is None:
        names = 'x u y v z w'
    ...
}}}

4. This new argument `names` must be documented in `dP6` etc.



---

archive/issue_comments_131496.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-02-23T03:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131496",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_131497.json:
```json
{
    "body": "<a id='comment:6'></a>P.S. If you agree with all these suggestions, I'd be happy to implement them since it is mostly copy-pasting and you have a bunch of other tickets to worry about ;-)",
    "created_at": "2011-02-23T03:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131497",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>P.S. If you agree with all these suggestions, I'd be happy to implement them since it is mostly copy-pasting and you have a bunch of other tickets to worry about ;-)



---

archive/issue_comments_131498.json:
```json
{
    "body": "<a id='comment:7'></a>Comments on the second patch (trac_10529_MPolynomialIdeal_subs.patch)\n\n1. The \"two-line description\" is a little hard to understand, I would remove \"while not touching other variables\" part and instead demonstrate it on examples. (But I don't insist on this point.)\n\n2. The second example in the doctest works with a polynomial, not an ideal, so it should be fixed.\n\n3. The following fails for no reason:\n {{{\nsage: R.<a,b> = PolynomialRing(QQ,2)\nsage: S = PolynomialRing(QQ,\"x\")\nsage: S.inject_variables()\nDefining x\nsage: p = a<sup>2+b</sup>2+a-b+2\nsage: p.subs(a=x, b=x)\n2*x^2 + 2\nsage: _.parent()\nUnivariate Polynomial Ring in x over Rational Field\nsage: I = R.ideal(p)\nsage: I\nIdeal (a^2 + b^2 + a - b + 2) of Multivariate Polynomial Ring in a, b over Rational Field\nsage: I.subs(a=x, b=x)\n\n---\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: Could not find a common ring for the substituted generators.\n}}}\n One solution is to add a check for univariate polynomial rings, but what about fraction fields and symbolic rings\n {{{\nsage: var(\"x\")    \nx\nsage: x.parent()\nSymbolic Ring\nsage: I.subs(a=x, b=x)\n\n---\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: Could not find a common ring for the substituted generators.\n}}}\n Maybe it is OK to try to construct an ideal using the sequence universe if it has ideal method? So that the code looks like\n {{{\nring = self.ring() \ngenerators = [f.subs(in_dict, **kwds) for f in self.gens()] \nif not all(gen in ring for gen in generators): \n    ring = Sequence(generators).universe()\ntry:\n    return ring.ideal(generators)\nexcept AttributeError:\n    raise TypeError(\"cannot form an ideal from the substituted generators!\")\n}}}",
    "created_at": "2011-02-23T04:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131498",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:7'></a>Comments on the second patch (trac_10529_MPolynomialIdeal_subs.patch)

1. The "two-line description" is a little hard to understand, I would remove "while not touching other variables" part and instead demonstrate it on examples. (But I don't insist on this point.)

2. The second example in the doctest works with a polynomial, not an ideal, so it should be fixed.

3. The following fails for no reason:
 {{{
sage: R.<a,b> = PolynomialRing(QQ,2)
sage: S = PolynomialRing(QQ,"x")
sage: S.inject_variables()
Defining x
sage: p = a<sup>2+b</sup>2+a-b+2
sage: p.subs(a=x, b=x)
2*x^2 + 2
sage: _.parent()
Univariate Polynomial Ring in x over Rational Field
sage: I = R.ideal(p)
sage: I
Ideal (a^2 + b^2 + a - b + 2) of Multivariate Polynomial Ring in a, b over Rational Field
sage: I.subs(a=x, b=x)

---
TypeError                                 Traceback (most recent call last)
...
TypeError: Could not find a common ring for the substituted generators.
}}}
 One solution is to add a check for univariate polynomial rings, but what about fraction fields and symbolic rings
 {{{
sage: var("x")    
x
sage: x.parent()
Symbolic Ring
sage: I.subs(a=x, b=x)

---
TypeError                                 Traceback (most recent call last)
...
TypeError: Could not find a common ring for the substituted generators.
}}}
 Maybe it is OK to try to construct an ideal using the sequence universe if it has ideal method? So that the code looks like
 {{{
ring = self.ring() 
generators = [f.subs(in_dict, **kwds) for f in self.gens()] 
if not all(gen in ring for gen in generators): 
    ring = Sequence(generators).universe()
try:
    return ring.ideal(generators)
except AttributeError:
    raise TypeError("cannot form an ideal from the substituted generators!")
}}}



---

archive/issue_comments_131499.json:
```json
{
    "body": "<a id='comment:8'></a>The third patch (trac_10529_QuotientRingElement_call.patch) looks fine except for a little typo: \"Additionally, if quotient ring generators can be used as keywords.\" should be without \"if\".",
    "created_at": "2011-02-23T05:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131499",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>The third patch (trac_10529_QuotientRingElement_call.patch) looks fine except for a little typo: "Additionally, if quotient ring generators can be used as keywords." should be without "if".



---

archive/issue_comments_131500.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-02-23T16:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131500",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_131501.json:
```json
{
    "body": "<a id='comment:9'></a>About `trac_10529_toric_variety_library_names.patch`:\n\nI changed the `dict_key` to remove spaces and start with\n`_cached_`... to avoid any collisions.\n\nI implemented the other changes.",
    "created_at": "2011-02-23T16:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131501",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>About `trac_10529_toric_variety_library_names.patch`:

I changed the `dict_key` to remove spaces and start with
`_cached_`... to avoid any collisions.

I implemented the other changes.



---

archive/issue_comments_131502.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-02-23T16:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131502",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_131503.json:
```json
{
    "body": "Attachment [trac_10529_MPolynomialIdeal_subs.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_MPolynomialIdeal_subs.patch) by @vbraun created at 2011-02-23 16:38:13\n\nUpdated patch",
    "created_at": "2011-02-23T16:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131503",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_10529_MPolynomialIdeal_subs.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_MPolynomialIdeal_subs.patch) by @vbraun created at 2011-02-23 16:38:13

Updated patch



---

archive/issue_comments_131504.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -91,3 +91,7 @@\n 5. `trac_10529_smoothness_of_algebraic_subschemes.patch`\n \n Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.\n+\n+Apply trac_10529_toric_variety_library_names.patch, trac_10529_MPolynomialIdeal_subs.patch, trac_10529_QuotientRingElement_call.patch, trac_10529_SubschemeMorphisms_without_QuotientRing.patch, trac_10529_smoothness_of_algebraic_subschemes.patch\n+\n+Depends on #10525\n``````\n",
    "created_at": "2011-02-23T16:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131504",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -91,3 +91,7 @@
 5. `trac_10529_smoothness_of_algebraic_subschemes.patch`
 
 Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.
+
+Apply trac_10529_toric_variety_library_names.patch, trac_10529_MPolynomialIdeal_subs.patch, trac_10529_QuotientRingElement_call.patch, trac_10529_SubschemeMorphisms_without_QuotientRing.patch, trac_10529_smoothness_of_algebraic_subschemes.patch
+
+Depends on #10525
``````




---

archive/issue_comments_131505.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [trac_10529_QuotientRingElement_call.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_QuotientRingElement_call.patch) by @vbraun created at 2011-02-23 16:40:11",
    "created_at": "2011-02-23T16:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131505",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>Attachment [trac_10529_QuotientRingElement_call.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_QuotientRingElement_call.patch) by @vbraun created at 2011-02-23 16:40:11



---

archive/issue_comments_131506.json:
```json
{
    "body": "<a id='comment:11'></a>OK, I am fine with the forth patch (trac_10529_SubschemeMorphisms_without_QuotientRing.patch).\n\nI think it is very bad that the class description states\n\n```\n    A morphism of schemes determined by rational functions that define\n    what the morphism does on points in the ambient space.\n```\nand yet the previous version was expecting (with `check=False`) polynomials in the quotient ring and the new one - in the original polynomial ring. It is also bad that a generic class does something special for projective targets. But fixing all this is beyond the scope of the ticket and I think that this patch is an improvement to the current situation.",
    "created_at": "2011-02-23T16:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131506",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:11'></a>OK, I am fine with the forth patch (trac_10529_SubschemeMorphisms_without_QuotientRing.patch).

I think it is very bad that the class description states

```
    A morphism of schemes determined by rational functions that define
    what the morphism does on points in the ambient space.
```
and yet the previous version was expecting (with `check=False`) polynomials in the quotient ring and the new one - in the original polynomial ring. It is also bad that a generic class does something special for projective targets. But fixing all this is beyond the scope of the ticket and I think that this patch is an improvement to the current situation.



---

archive/issue_comments_131507.json:
```json
{
    "body": "<a id='comment:12'></a>I meant the fourth...",
    "created_at": "2011-02-23T16:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131507",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:12'></a>I meant the fourth...



---

archive/issue_comments_131508.json:
```json
{
    "body": "<a id='comment:13'></a>The first comment in http://trac.sagemath.org/sage_trac/ticket/10529#comment:5 applies to two cases in `toric_variety` and `fano_toric_variety` ;-)",
    "created_at": "2011-02-23T16:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131508",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:13'></a>The first comment in http://trac.sagemath.org/sage_trac/ticket/10529#comment:5 applies to two cases in `toric_variety` and `fano_toric_variety` ;-)



---

archive/issue_comments_131509.json:
```json
{
    "body": "Attachment [trac_10529_toric_variety_library_names.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_toric_variety_library_names.patch) by @vbraun created at 2011-02-23 16:58:41\n\nNow also fixed in fano_toric_varieties.py",
    "created_at": "2011-02-23T16:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131509",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_10529_toric_variety_library_names.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_toric_variety_library_names.patch) by @vbraun created at 2011-02-23 16:58:41

Now also fixed in fano_toric_varieties.py



---

archive/issue_comments_131510.json:
```json
{
    "body": "<a id='comment:14'></a>I am having second thoughts about calling elements of quotient rings. It seems dangerous to evaluate the lift without checking that the input is acceptable. Given your code for ideal subs, it seems very easy to check that the ideal vanishes on the input, although it will potentially add a big overhead. How about doing it and providing an option `check=False` for turning it off in internal algorithms where the input is already known to be valid? (And if lifts have `check` option already, it should be passed to them as well.)",
    "created_at": "2011-02-23T17:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131510",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:14'></a>I am having second thoughts about calling elements of quotient rings. It seems dangerous to evaluate the lift without checking that the input is acceptable. Given your code for ideal subs, it seems very easy to check that the ideal vanishes on the input, although it will potentially add a big overhead. How about doing it and providing an option `check=False` for turning it off in internal algorithms where the input is already known to be valid? (And if lifts have `check` option already, it should be passed to them as well.)



---

archive/issue_comments_131511.json:
```json
{
    "body": "<a id='comment:15'></a>Glanced through the main patch. What is \"the best affine patch\" and why?\n\nRegarding checking global smoothness in affine varieties, I got very annoyed by \"speed\" of affine patches recently and the following dramatically works:\n\n```\ndiff -r b749e0edc82b sage/schemes/generic/algebraic_scheme.py\n--- a/sage/schemes/generic/algebraic_scheme.py\tMon Feb 21 09:35:33 2011 -0700\n+++ b/sage/schemes/generic/algebraic_scheme.py\tTue Feb 22 19:47:20 2011 -0700\n@@ -1498,7 +1498,7 @@\n         phi_p = ambient_patch.embedding_morphism().defining_polynomials()\n         patch = ambient_patch.subscheme(\n                             [p(phi_p) for p in self.defining_polynomials()])\n-        patch._embedding_morphism = patch.hom(phi_p, self)\n+        patch._embedding_morphism = patch.hom(phi_p, self, check=False)\n         self._affine_patches[i] = patch\n         return patch\n\ndiff -r b749e0edc82b sage/schemes/generic/scheme.py\n--- a/sage/schemes/generic/scheme.py\tMon Feb 21 09:35:33 2011 -0700\n+++ b/sage/schemes/generic/scheme.py\tTue Feb 22 19:47:20 2011 -0700\n@@ -459,7 +459,7 @@\n         \"\"\"\n         return morphism.SchemeMorphism_id(self)\n \n-    def hom(self, x, Y=None):\n+    def hom(self, x, Y=None, check=True):\n         \"\"\"\n         Return the scheme morphism from self to Y defined by x. If x is a\n         scheme, try to determine a natural map to x.\n@@ -480,7 +480,7 @@\n                 return self.Hom(x).natural_map()\n             else:\n                 raise TypeError, \"unable to determine codomain\"\n-        return self.Hom(Y)(x)\n+        return self.Hom(Y)(x, check)\n \n     def _Hom_(self, Y, category=None, check=True):\n         \"\"\"\n```\nFeel free to add it to your patch (with documentation and examples ;-)), but I have not spend much time thinking about implications and what can go wrong with such changes. I think I had at least one doctest failure, but for now I am using it anyway since it works fine for toric varieties and makes a difference between interactive work and coffee breaks.",
    "created_at": "2011-02-23T18:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131511",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:15'></a>Glanced through the main patch. What is "the best affine patch" and why?

Regarding checking global smoothness in affine varieties, I got very annoyed by "speed" of affine patches recently and the following dramatically works:

```
diff -r b749e0edc82b sage/schemes/generic/algebraic_scheme.py
--- a/sage/schemes/generic/algebraic_scheme.py	Mon Feb 21 09:35:33 2011 -0700
+++ b/sage/schemes/generic/algebraic_scheme.py	Tue Feb 22 19:47:20 2011 -0700
@@ -1498,7 +1498,7 @@
         phi_p = ambient_patch.embedding_morphism().defining_polynomials()
         patch = ambient_patch.subscheme(
                             [p(phi_p) for p in self.defining_polynomials()])
-        patch._embedding_morphism = patch.hom(phi_p, self)
+        patch._embedding_morphism = patch.hom(phi_p, self, check=False)
         self._affine_patches[i] = patch
         return patch

diff -r b749e0edc82b sage/schemes/generic/scheme.py
--- a/sage/schemes/generic/scheme.py	Mon Feb 21 09:35:33 2011 -0700
+++ b/sage/schemes/generic/scheme.py	Tue Feb 22 19:47:20 2011 -0700
@@ -459,7 +459,7 @@
         """
         return morphism.SchemeMorphism_id(self)
 
-    def hom(self, x, Y=None):
+    def hom(self, x, Y=None, check=True):
         """
         Return the scheme morphism from self to Y defined by x. If x is a
         scheme, try to determine a natural map to x.
@@ -480,7 +480,7 @@
                 return self.Hom(x).natural_map()
             else:
                 raise TypeError, "unable to determine codomain"
-        return self.Hom(Y)(x)
+        return self.Hom(Y)(x, check)
 
     def _Hom_(self, Y, category=None, check=True):
         """
```
Feel free to add it to your patch (with documentation and examples ;-)), but I have not spend much time thinking about implications and what can go wrong with such changes. I think I had at least one doctest failure, but for now I am using it anyway since it works fine for toric varieties and makes a difference between interactive work and coffee breaks.



---

archive/issue_comments_131512.json:
```json
{
    "body": "<a id='comment:16'></a>The \"best\" affine patch is where you have to divide by the largest number to dehomogenize; Division by small numbers is numerically unstable.",
    "created_at": "2011-02-23T18:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131512",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>The "best" affine patch is where you have to divide by the largest number to dehomogenize; Division by small numbers is numerically unstable.



---

archive/issue_comments_131513.json:
```json
{
    "body": "Attachment [trac_10529_smoothness_of_algebraic_subschemes.2.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_smoothness_of_algebraic_subschemes.2.patch) by @vbraun created at 2011-02-24 10:38:37\n\nUpdated patch",
    "created_at": "2011-02-24T10:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131513",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_10529_smoothness_of_algebraic_subschemes.2.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_smoothness_of_algebraic_subschemes.2.patch) by @vbraun created at 2011-02-24 10:38:37

Updated patch



---

archive/issue_comments_131514.json:
```json
{
    "body": "<a id='comment:17'></a>I added your optional `check=<boolean>` argument. The one ensuing doctest failure is caused by a different presentation of the embedding morphism (modulo the ideal of the domain variety), so either answer is mathematically correct.",
    "created_at": "2011-02-24T10:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131514",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>I added your optional `check=<boolean>` argument. The one ensuing doctest failure is caused by a different presentation of the embedding morphism (modulo the ideal of the domain variety), so either answer is mathematically correct.



---

archive/issue_comments_131515.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -92,6 +92,11 @@\n \n Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.\n \n-Apply trac_10529_toric_variety_library_names.patch, trac_10529_MPolynomialIdeal_subs.patch, trac_10529_QuotientRingElement_call.patch, trac_10529_SubschemeMorphisms_without_QuotientRing.patch, trac_10529_smoothness_of_algebraic_subschemes.patch\n+Depends on #10525\n \n-Depends on #10525\n+**Apply**\n+1. [attachment:trac_10529_toric_variety_library_names.patch]\n+2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]\n+3. [attachment:trac_10529_QuotientRingElement_call.patch]\n+4. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]\n+5. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]\n``````\n",
    "created_at": "2011-04-08T16:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131515",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -92,6 +92,11 @@
 
 Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.
 
-Apply trac_10529_toric_variety_library_names.patch, trac_10529_MPolynomialIdeal_subs.patch, trac_10529_QuotientRingElement_call.patch, trac_10529_SubschemeMorphisms_without_QuotientRing.patch, trac_10529_smoothness_of_algebraic_subschemes.patch
+Depends on #10525
 
-Depends on #10525
+**Apply**
+1. [attachment:trac_10529_toric_variety_library_names.patch]
+2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]
+3. [attachment:trac_10529_QuotientRingElement_call.patch]
+4. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]
+5. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]
``````




---

archive/issue_comments_131516.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [novoselt](#comment%3A14):\n> I am having second thoughts about calling elements of quotient rings. It seems dangerous to evaluate the lift without checking that the input is acceptable. Given your code for ideal subs, it seems very easy to check that the ideal vanishes on the input, although it will potentially add a big overhead. How about doing it and providing an option `check=False` for turning it off in internal algorithms where the input is already known to be valid? (And if lifts have `check` option already, it should be passed to them as well.)\n\n\nHi Volker, any thoughts/objections on this one? (I am going to finally read the last patch today or this weekend.)",
    "created_at": "2011-04-08T17:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131516",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:19'></a>Replying to [novoselt](#comment%3A14):
> I am having second thoughts about calling elements of quotient rings. It seems dangerous to evaluate the lift without checking that the input is acceptable. Given your code for ideal subs, it seems very easy to check that the ideal vanishes on the input, although it will potentially add a big overhead. How about doing it and providing an option `check=False` for turning it off in internal algorithms where the input is already known to be valid? (And if lifts have `check` option already, it should be passed to them as well.)


Hi Volker, any thoughts/objections on this one? (I am going to finally read the last patch today or this weekend.)



---

archive/issue_comments_131517.json:
```json
{
    "body": "<a id='comment:20'></a>I think the calling quotient rings stuff is actually not used because I later switched the maps between affine algebraic schemes to be defined by actual polynomials instead of quotient rings.",
    "created_at": "2011-04-09T05:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131517",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>I think the calling quotient rings stuff is actually not used because I later switched the maps between affine algebraic schemes to be defined by actual polynomials instead of quotient rings.



---

archive/issue_comments_131518.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [vbraun](#comment%3A20):\n> I think the calling quotient rings stuff is actually not used because I later switched the maps between affine algebraic schemes to be defined by actual polynomials instead of quotient rings. \n\n\nSo you want to just drop this patch? I think that the functionality you have added is neat and useful even without relation to this ticket, just don't want it to be dangerous ;-)\n\nComments on the last patch:\n\n1. How about renaming `Jacobian` to `Jacobian_ideal`? I associate `Jacobian` with a single determinant of a square matrix...\n2. It seems to me also that it should NOT include the original polynomials. I am having difficulties with finding a definition of the Jacobian ideal, but at least in the case of one polynomial Singular does not add it in this function http://www.singular.uni-kl.de/Manual/3-0-4/sing_986.htm and its Milnor number routine takes into account all critical points of a function and not just critical points in the zero set http://www.singular.uni-kl.de/Manual/latest/sing_718.htm#SEC770. Another argument against mixing in the defining ideal is that it is easier to combine ideals than to split one apart. So I propose to have `Jacobian_ideal` for the ideal generated by partial derivatives or their minors and some other function or an optional parameter for combining it with the defining ideal.\n3. Wouldn't it be faster to check the rank of the Jacobian matrix rather than to compute all maximal minors?\n4. If there are obstructions to it, probably the Jacobian ideal should be cached.\n5. Can the documentation of `_best_affine_patch` be extended a little with the explanation you gave earlier?\n6. I have a number of issues with `affine_neighbourhood`\n   1. Its purpose is not quite clear from the name: since projective spaces and toric varieties have \"natural\" affine covers, I would expect to get one of the standard patches as an affine neighbourhood. How about changing it to `centered_neigbourhood`?\n   2. I think it actually can be nice to get one of those standard ones as well. How about `affine_neigbourhood(point)` returning a patch which contains `point`?\n   3. This is, of course, close to what `_best_affine_patch` does. I think it would be nice to expose its functionality to the user, but make it a bit more clear that it returns a number. So I guess I propose three functions:\n   * `containing_patch_index(point)` - does what is now done by `_best_affine_patch(point)` (I think that access to the index can be convenient e.g. if a user wants to consider the same points on several subschemes.);\n   * `affine_neighbourhood(point)` - a shortcut for `X.affine_patch(X.containing_patch_index(point))`;\n   * `centered_neigbourhood(point)` - does what is now done by `affine_neigbourhood`.\n   1. I think that returned neighbourhoods should be affine schemes with a determined embedding, not just the embedding morphism (I know that it is possible to get domain/codomain from a morphism, but I think that most people think of neighbourhoods as open subsets, plus it is more consistent with the current `affine_patch`.)\n   2. I don't see any point storing `point_preimage` since it is the origin. Plus having plain public attributes is not in the style of Sage.\n   3. Why do you say that it returns a local isomorphism? A neighbourhood should be isomorphic to its image under the inclusion morphism, and I don't think that it needs any clarification. A local isomorphism, on the other hand, means to me that every point in the domain has a neighbourhood which is isomorphic to its image. That is clearly a weaker statement in general, so it seems confusing to me here.\n7. For toric varieties `_best_affine_patch` can be written a bit more efficiently (for fans with many rays it may give a considerable speed-up):\n {{{\npoint = list(point) \nzeros = set(i for i, coord in enumerate(point) if coord == 0)   \nfor cone_idx, cone in enumerate(self.ambient_space().fan().generating_cones()): \n    if zeros.issubset(cone.ambient_ray_indices()): \n        return cone_idx \nassert False, 'The point must not have been a point of the toric variety.' \n}}}\n Here we work sets of zeros in the point and indices of the cone rather than their completements, which can be much bigger. Also this isn't \"the best\" patch, it is \"just a patch\" so I think that `containing_patch_index` is a better name and when possible it can try to return the best option.\n1. Now I see that for toric varieties `affine_neighbourhood` is not centered. Then I think that for sure the method of projective varieties should be renamed to `centered_neighbourhood`. Other comments still apply. And I still don't like `point_preimage` even though now it is non-trivial. I think that if it is exposed to users it should be a function with documentation and have a bit more meaningful name. (`center_preimage` comes to mind, although I am not sure if that's clear/standard.) Or, perhaps, we still can return an honest centered neighbourhood realized as a plain affine scheme (with an appropriate embedding map)? That actually would be very handy, as so far I was doing such shifts manually whenever I had to put my special points to the origin.\n2. Would be nice to add a message to `NoteImplementedError` in `is_smooth` of affine toric subschemes.",
    "created_at": "2011-04-09T20:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131518",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:21'></a>Replying to [vbraun](#comment%3A20):
> I think the calling quotient rings stuff is actually not used because I later switched the maps between affine algebraic schemes to be defined by actual polynomials instead of quotient rings. 


So you want to just drop this patch? I think that the functionality you have added is neat and useful even without relation to this ticket, just don't want it to be dangerous ;-)

Comments on the last patch:

1. How about renaming `Jacobian` to `Jacobian_ideal`? I associate `Jacobian` with a single determinant of a square matrix...
2. It seems to me also that it should NOT include the original polynomials. I am having difficulties with finding a definition of the Jacobian ideal, but at least in the case of one polynomial Singular does not add it in this function http://www.singular.uni-kl.de/Manual/3-0-4/sing_986.htm and its Milnor number routine takes into account all critical points of a function and not just critical points in the zero set http://www.singular.uni-kl.de/Manual/latest/sing_718.htm#SEC770. Another argument against mixing in the defining ideal is that it is easier to combine ideals than to split one apart. So I propose to have `Jacobian_ideal` for the ideal generated by partial derivatives or their minors and some other function or an optional parameter for combining it with the defining ideal.
3. Wouldn't it be faster to check the rank of the Jacobian matrix rather than to compute all maximal minors?
4. If there are obstructions to it, probably the Jacobian ideal should be cached.
5. Can the documentation of `_best_affine_patch` be extended a little with the explanation you gave earlier?
6. I have a number of issues with `affine_neighbourhood`
   1. Its purpose is not quite clear from the name: since projective spaces and toric varieties have "natural" affine covers, I would expect to get one of the standard patches as an affine neighbourhood. How about changing it to `centered_neigbourhood`?
   2. I think it actually can be nice to get one of those standard ones as well. How about `affine_neigbourhood(point)` returning a patch which contains `point`?
   3. This is, of course, close to what `_best_affine_patch` does. I think it would be nice to expose its functionality to the user, but make it a bit more clear that it returns a number. So I guess I propose three functions:
   * `containing_patch_index(point)` - does what is now done by `_best_affine_patch(point)` (I think that access to the index can be convenient e.g. if a user wants to consider the same points on several subschemes.);
   * `affine_neighbourhood(point)` - a shortcut for `X.affine_patch(X.containing_patch_index(point))`;
   * `centered_neigbourhood(point)` - does what is now done by `affine_neigbourhood`.
   1. I think that returned neighbourhoods should be affine schemes with a determined embedding, not just the embedding morphism (I know that it is possible to get domain/codomain from a morphism, but I think that most people think of neighbourhoods as open subsets, plus it is more consistent with the current `affine_patch`.)
   2. I don't see any point storing `point_preimage` since it is the origin. Plus having plain public attributes is not in the style of Sage.
   3. Why do you say that it returns a local isomorphism? A neighbourhood should be isomorphic to its image under the inclusion morphism, and I don't think that it needs any clarification. A local isomorphism, on the other hand, means to me that every point in the domain has a neighbourhood which is isomorphic to its image. That is clearly a weaker statement in general, so it seems confusing to me here.
7. For toric varieties `_best_affine_patch` can be written a bit more efficiently (for fans with many rays it may give a considerable speed-up):
 {{{
point = list(point) 
zeros = set(i for i, coord in enumerate(point) if coord == 0)   
for cone_idx, cone in enumerate(self.ambient_space().fan().generating_cones()): 
    if zeros.issubset(cone.ambient_ray_indices()): 
        return cone_idx 
assert False, 'The point must not have been a point of the toric variety.' 
}}}
 Here we work sets of zeros in the point and indices of the cone rather than their completements, which can be much bigger. Also this isn't "the best" patch, it is "just a patch" so I think that `containing_patch_index` is a better name and when possible it can try to return the best option.
1. Now I see that for toric varieties `affine_neighbourhood` is not centered. Then I think that for sure the method of projective varieties should be renamed to `centered_neighbourhood`. Other comments still apply. And I still don't like `point_preimage` even though now it is non-trivial. I think that if it is exposed to users it should be a function with documentation and have a bit more meaningful name. (`center_preimage` comes to mind, although I am not sure if that's clear/standard.) Or, perhaps, we still can return an honest centered neighbourhood realized as a plain affine scheme (with an appropriate embedding map)? That actually would be very handy, as so far I was doing such shifts manually whenever I had to put my special points to the origin.
2. Would be nice to add a message to `NoteImplementedError` in `is_smooth` of affine toric subschemes.



---

archive/issue_comments_131519.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-09T20:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131519",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_131520.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-14T15:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131520",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_131521.json:
```json
{
    "body": "<a id='comment:22'></a>1. Thats just the 0-dimensional case. I don't care about `Jacobian` vs. `Jacobian_ideal`, but since you thought of the right thing I would prefer to keep the shorter name.\n\n2. In projective coordinates the CI equations are implied by the minors of the partial derivatives, which is part of why it is usually not spelled out. For speed, it is important to add the equations so that the minors (which often have high degree) can be reduced quickly. Also, in the context of subschemes it is dangerous to not add the equations; For example if you compute the Milnor number you really do only want the critical points on the subvariety. So I very much prefer it the way it is.\n\n3. If you have a faster algorithm then you should be writing a paper on it. But note that you need the rank **everywhere** on the subvariety :-)\n\n4. Computing the Jacobian ideal is fast. Eventually you'll have to compute Groebner basis, this is the slow and memory intensive part. But we can't cache all of these with whatever term ordering the user is going to use. I think its better to cache the final result (whether the variety is smooth) instead of the Jacobian ideal.\n\n5. OK\n\n6. in #10540, the `affine_neighbourhood` method is removed. There are two different methods `affine_patch(int)` and `neighbourhood(point)`. The neighborhood may or may not be centered.\n\n7. Eventually the `_best_affine_patch` should be the \"best\" patch in the same sense as for projective varieties. But we first need some way to easily access the homogeneous rescalings. So I'll leave this as a TODO.\n\n8. In #10540, this is refactored into `subscheme.embedding_morphism()` and `subscheme.embedding_origin` methods. No more public attributes. I think it is better to have un-shifted affine patches for toric varieties as it makes the embedding map easier. But it would be nice to have a `shift()` method, feel free to write a patch on top of #10540 :-)\n\n9. Implemented in #10540",
    "created_at": "2011-04-14T15:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131521",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>1. Thats just the 0-dimensional case. I don't care about `Jacobian` vs. `Jacobian_ideal`, but since you thought of the right thing I would prefer to keep the shorter name.

2. In projective coordinates the CI equations are implied by the minors of the partial derivatives, which is part of why it is usually not spelled out. For speed, it is important to add the equations so that the minors (which often have high degree) can be reduced quickly. Also, in the context of subschemes it is dangerous to not add the equations; For example if you compute the Milnor number you really do only want the critical points on the subvariety. So I very much prefer it the way it is.

3. If you have a faster algorithm then you should be writing a paper on it. But note that you need the rank **everywhere** on the subvariety :-)

4. Computing the Jacobian ideal is fast. Eventually you'll have to compute Groebner basis, this is the slow and memory intensive part. But we can't cache all of these with whatever term ordering the user is going to use. I think its better to cache the final result (whether the variety is smooth) instead of the Jacobian ideal.

5. OK

6. in #10540, the `affine_neighbourhood` method is removed. There are two different methods `affine_patch(int)` and `neighbourhood(point)`. The neighborhood may or may not be centered.

7. Eventually the `_best_affine_patch` should be the "best" patch in the same sense as for projective varieties. But we first need some way to easily access the homogeneous rescalings. So I'll leave this as a TODO.

8. In #10540, this is refactored into `subscheme.embedding_morphism()` and `subscheme.embedding_origin` methods. No more public attributes. I think it is better to have un-shifted affine patches for toric varieties as it makes the embedding map easier. But it would be nice to have a `shift()` method, feel free to write a patch on top of #10540 :-)

9. Implemented in #10540



---

archive/issue_comments_131522.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -97,6 +97,5 @@\n **Apply**\n 1. [attachment:trac_10529_toric_variety_library_names.patch]\n 2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]\n-3. [attachment:trac_10529_QuotientRingElement_call.patch]\n-4. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]\n-5. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]\n+3. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]\n+4. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]\n``````\n",
    "created_at": "2011-04-14T16:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131522",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -97,6 +97,5 @@
 **Apply**
 1. [attachment:trac_10529_toric_variety_library_names.patch]
 2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]
-3. [attachment:trac_10529_QuotientRingElement_call.patch]
-4. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]
-5. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]
+3. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]
+4. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]
``````




---

archive/issue_comments_131523.json:
```json
{
    "body": "<a id='comment:23'></a>I've moved the `trac_10529_QuotientRingElement_call.patch` to #11199.",
    "created_at": "2011-04-14T16:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131523",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>I've moved the `trac_10529_QuotientRingElement_call.patch` to #11199.



---

archive/issue_comments_131524.json:
```json
{
    "body": "Attachment [trac_10529_smoothness_of_algebraic_subschemes.3.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_smoothness_of_algebraic_subschemes.3.patch) by @vbraun created at 2011-04-14 16:04:11\n\nDocumentation added to _best_affine_patch",
    "created_at": "2011-04-14T16:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131524",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_10529_smoothness_of_algebraic_subschemes.3.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_smoothness_of_algebraic_subschemes.3.patch) by @vbraun created at 2011-04-14 16:04:11

Documentation added to _best_affine_patch



---

archive/issue_comments_131525.json:
```json
{
    "body": "<a id='comment:24'></a>1. If you don't really care, I'd go with `Jacobian_ideal` since it is more clear.\n\n2. But in the affine case the defining equations are not implied and I gave examples where they are not included. I agree with your points about adding them. In fact, I was very confused and frustrated when I was computing Milnor numbers for a certain example and results didn't match with expectations precisely because of \"extra critical points\". However, I don't want to go against usual definitions and conventions. Could you please give a reference to the definition of a Jacobian ideal in the sense that you have implemented?\n\n3-4. I was thinking about a particular point, not testing smoothness of the whole scheme ;-) I am OK to leave it for the future.\n\n6-9. If these issues are addressed in #10540, I propose either moving the main patch of this ticket to #10540 or putting it in front of #10540 in the queue and making sure that they are merged together. The second option probably makes more sense, but it will add 2 more tickets as prerequisites for this one.\n\n7. The suggested optimization will work for any definition of \"best\", it is just a more efficient way of determining whether a certain patch is acceptable at all or not.",
    "created_at": "2011-04-17T02:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131525",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:24'></a>1. If you don't really care, I'd go with `Jacobian_ideal` since it is more clear.

2. But in the affine case the defining equations are not implied and I gave examples where they are not included. I agree with your points about adding them. In fact, I was very confused and frustrated when I was computing Milnor numbers for a certain example and results didn't match with expectations precisely because of "extra critical points". However, I don't want to go against usual definitions and conventions. Could you please give a reference to the definition of a Jacobian ideal in the sense that you have implemented?

3-4. I was thinking about a particular point, not testing smoothness of the whole scheme ;-) I am OK to leave it for the future.

6-9. If these issues are addressed in #10540, I propose either moving the main patch of this ticket to #10540 or putting it in front of #10540 in the queue and making sure that they are merged together. The second option probably makes more sense, but it will add 2 more tickets as prerequisites for this one.

7. The suggested optimization will work for any definition of "best", it is just a more efficient way of determining whether a certain patch is acceptable at all or not.



---

archive/issue_comments_131526.json:
```json
{
    "body": "<a id='comment:25'></a>1. But the general usage in Sage is to prefer shorter names. For example `I.is_prime` instead of `I.is_prime_ideal` or `I.quotient` instead of `I.quotient_ring`.\n\n2. Lazarsfeld: Positivity in algebraic geometry: II, p.181\n\n6-9: The tracker bug clearly states that #10540 depends on this ticket. I find that the methods introduced in this ticket are an improvement, even if they get superseded in #10540 by even better ones. How about you review #10540 and this ticket, then they'll automatically end up in the same Sage release.",
    "created_at": "2011-04-17T16:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131526",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>1. But the general usage in Sage is to prefer shorter names. For example `I.is_prime` instead of `I.is_prime_ideal` or `I.quotient` instead of `I.quotient_ring`.

2. Lazarsfeld: Positivity in algebraic geometry: II, p.181

6-9: The tracker bug clearly states that #10540 depends on this ticket. I find that the methods introduced in this ticket are an improvement, even if they get superseded in #10540 by even better ones. How about you review #10540 and this ticket, then they'll automatically end up in the same Sage release.



---

archive/issue_comments_131527.json:
```json
{
    "body": "Added Lazarsfeld reference and code cleanup to _best_affine_patch",
    "created_at": "2011-04-17T16:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131527",
    "user": "https://github.com/vbraun"
}
```

Added Lazarsfeld reference and code cleanup to _best_affine_patch



---

archive/issue_comments_131528.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,33 +32,8 @@\n Ideal (y) of Multivariate Polynomial Ring in x, y over Rational Field\n ```\n \n-3. `trac_10529_QuotientRingElement_call.patch`\n \n-This hands `QuotientRingElement.__call__` down to the `lift()`:\n-\n-```\n-sage: R.<x,y> = PolynomialRing(QQ)\n-sage: (x^2+y)(1,1)\n-2\n-sage: Q.<xbar,ybar> = R.quotient(x-y)\n-sage: (xbar^2+ybar)(1,1)\n----------------------------------------------------------------------------\n-TypeError                                 Traceback (most recent call last)\n-\n-/home/vbraun/opt/sage-4.6.1.rc0/devel/sage-main/<ipython console> in <module>()\n-\n-TypeError: 'QuotientRingElement' object is not callable\n-```\n-becomes\n-\n-```\n-sage: (xbar^2+ybar)(1,1)\n-2\n-```\n-\n-\n-\n-4. `trac_10529_SubschemeMorphisms_without_QuotientRing.patch`\n+3. `trac_10529_SubschemeMorphisms_without_QuotientRing.patch`\n \n Without this patch, morphisms to algebraic subschemes involve the `coordinate_ring()` of the subscheme, a quotient ring:\n \n@@ -88,7 +63,7 @@\n         (y, 0)\n ```\n \n-5. `trac_10529_smoothness_of_algebraic_subschemes.patch`\n+4. `trac_10529_smoothness_of_algebraic_subschemes.patch`\n \n Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.\n \n``````\n",
    "created_at": "2011-04-17T16:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131528",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,33 +32,8 @@
 Ideal (y) of Multivariate Polynomial Ring in x, y over Rational Field
 ```
 
-3. `trac_10529_QuotientRingElement_call.patch`
 
-This hands `QuotientRingElement.__call__` down to the `lift()`:
-
-```
-sage: R.<x,y> = PolynomialRing(QQ)
-sage: (x^2+y)(1,1)
-2
-sage: Q.<xbar,ybar> = R.quotient(x-y)
-sage: (xbar^2+ybar)(1,1)
----------------------------------------------------------------------------
-TypeError                                 Traceback (most recent call last)
-
-/home/vbraun/opt/sage-4.6.1.rc0/devel/sage-main/<ipython console> in <module>()
-
-TypeError: 'QuotientRingElement' object is not callable
-```
-becomes
-
-```
-sage: (xbar^2+ybar)(1,1)
-2
-```
-
-
-
-4. `trac_10529_SubschemeMorphisms_without_QuotientRing.patch`
+3. `trac_10529_SubschemeMorphisms_without_QuotientRing.patch`
 
 Without this patch, morphisms to algebraic subschemes involve the `coordinate_ring()` of the subscheme, a quotient ring:
 
@@ -88,7 +63,7 @@
         (y, 0)
 ```
 
-5. `trac_10529_smoothness_of_algebraic_subschemes.patch`
+4. `trac_10529_smoothness_of_algebraic_subschemes.patch`
 
 Finally implements `dimension()` for subschemes of toric varieties and `is_smooth()` for all algebraic subschemes.
 
``````




---

archive/issue_comments_131529.json:
```json
{
    "body": "<a id='comment:26'></a>Attachment [trac_10529_smoothness_of_algebraic_subschemes.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_smoothness_of_algebraic_subschemes.patch) by @vbraun created at 2011-04-17 16:34:48",
    "created_at": "2011-04-17T16:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131529",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>Attachment [trac_10529_smoothness_of_algebraic_subschemes.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_smoothness_of_algebraic_subschemes.patch) by @vbraun created at 2011-04-17 16:34:48



---

archive/issue_comments_131530.json:
```json
{
    "body": "<a id='comment:27'></a>1. `is*` methods always return True/False, so there is no need to clarify the output. `I.quotient` actually returns an ideal, not ring, but that's also quite unambiguous. On the other hand, you can associate several \"Jacobian things\" to a scheme - you have already implemented matrix and ideal and one can also add  the determinant when it makes sense. Note that it still will be different from the ideal, since this determinant will be its generator. So I still think that `Jacobian_ideal` is better, but I will not insist anymore.\n\n2. Thank you! As I said, I think that this definition is more convenient, but I didn't want to go against standard conventions (and I don't really know what they are in this case).\n\n6-9. Absolutely, I hope to review all current tickets on #9604 for 4.7.1.",
    "created_at": "2011-04-17T17:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131530",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:27'></a>1. `is*` methods always return True/False, so there is no need to clarify the output. `I.quotient` actually returns an ideal, not ring, but that's also quite unambiguous. On the other hand, you can associate several "Jacobian things" to a scheme - you have already implemented matrix and ideal and one can also add  the determinant when it makes sense. Note that it still will be different from the ideal, since this determinant will be its generator. So I still think that `Jacobian_ideal` is better, but I will not insist anymore.

2. Thank you! As I said, I think that this definition is more convenient, but I didn't want to go against standard conventions (and I don't really know what they are in this case).

6-9. Absolutely, I hope to review all current tickets on #9604 for 4.7.1.



---

archive/issue_comments_131531.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -74,3 +74,5 @@\n 2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]\n 3. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]\n 4. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]\n+\n+**This ticket must be merged together with #10540**\n``````\n",
    "created_at": "2011-04-17T17:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131531",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -74,3 +74,5 @@
 2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]
 3. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]
 4. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]
+
+**This ticket must be merged together with #10540**
``````




---

archive/issue_comments_131532.json:
```json
{
    "body": "<a id='comment:28'></a>I meant to refer to `ring.quotient(ideal)`, not `ideal.quotient(ideal)`.  I guess that illustrates the fact that Sage tends to shorten the method names :-)",
    "created_at": "2011-04-17T17:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131532",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>I meant to refer to `ring.quotient(ideal)`, not `ideal.quotient(ideal)`.  I guess that illustrates the fact that Sage tends to shorten the method names :-)



---

archive/issue_comments_131533.json:
```json
{
    "body": "<a id='comment:29'></a>Since you wrote `I.is_prime` and `I.quotient`, I concluded that `I` is some ideal. Both in cases of ideal and the ring the output is of the type of initial object. The point of OOP is that you don't have to explain \"what is the first input\" for methods of the class. In the case of `Jacobian_ideal`, on the other hand, the clarification would refer to the output, which is ambiguous...",
    "created_at": "2011-04-17T20:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131533",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:29'></a>Since you wrote `I.is_prime` and `I.quotient`, I concluded that `I` is some ideal. Both in cases of ideal and the ring the output is of the type of initial object. The point of OOP is that you don't have to explain "what is the first input" for methods of the class. In the case of `Jacobian_ideal`, on the other hand, the clarification would refer to the output, which is ambiguous...



---

archive/issue_comments_131534.json:
```json
{
    "body": "<a id='comment:30'></a>Attachment [trac_10529_reviewer.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_reviewer.patch) by @novoselt created at 2011-05-20 16:27:03\n\nFor my record: everything is addressed in the current patches except for 6,8,9 which should be taken care off in #10540.\n\nThere was also the second instance of a little adjustment missed in the beginning, I have attached a patch fixing it.\n\nOnce we are done with #10540, I will switch this one to positive review.",
    "created_at": "2011-05-20T16:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131534",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:30'></a>Attachment [trac_10529_reviewer.patch](tarball://root/attachments/some-uuid/ticket10529/trac_10529_reviewer.patch) by @novoselt created at 2011-05-20 16:27:03

For my record: everything is addressed in the current patches except for 6,8,9 which should be taken care off in #10540.

There was also the second instance of a little adjustment missed in the beginning, I have attached a patch fixing it.

Once we are done with #10540, I will switch this one to positive review.



---

archive/issue_comments_131535.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -74,5 +74,6 @@\n 2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]\n 3. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]\n 4. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]\n+5. [attachment:trac_10529_reviewer.patch]\n \n **This ticket must be merged together with #10540**\n``````\n",
    "created_at": "2011-05-20T16:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131535",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -74,5 +74,6 @@
 2. [attachment:trac_10529_MPolynomialIdeal_subs.patch]
 3. [attachment:trac_10529_SubschemeMorphisms_without_QuotientRing.patch]
 4. [attachment:trac_10529_smoothness_of_algebraic_subschemes.patch]
+5. [attachment:trac_10529_reviewer.patch]
 
 **This ticket must be merged together with #10540**
``````




---

archive/issue_comments_131536.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-15T20:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131536",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_131537.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd31\".",
    "created_at": "2011-06-15T20:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131537",
    "user": "https://github.com/novoselt"
}
```

Changing keywords from "" to "sd31".



---

archive/issue_comments_131538.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-06-24T09:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131538",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_027034.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-24T09:20:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10529#event-27034"
}
```



---

archive/issue_comments_131539.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.1.alpha4\"",
    "created_at": "2011-06-24T09:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10529#issuecomment-131539",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.7.1.alpha4"
