# Issue 10183: long doctests wrongly tagged "# long" instead of "#long time"

archive/issues_010182.json:
```json
{
    "body": "In several places, long doctests are incorrectly tagged \"# long\" instead of \"# long time\", thus mistakenly preventing them from being omitted when \"-long\" is not included on the command line.\n\nOn of these is at #10182.  The rest are:\n\n```\ncombinat/sf/sfa.py:            sage: a.itensor(a) #long\ngraphs/graph_generators.py:            sage: G.show() # long\ngraphs/graph.py:            sage: K5_minor =\ng.minor(graphs.CompleteGraph(5))                    # long\ngraphs/graph.py:            sage: K33_minor =\ng.minor(graphs.CompleteBipartiteGraph(3,3))        # long\nlfunctions/sympow.py:            sage: sympow.analytic_rank(EllipticCurve([0, 0, 1, -79, 342]))  # long\nlfunctions/sympow.py:            sage:\nsympow.analytic_rank(EllipticCurve([1, 1, 0, -2582, 48720]))  # long\nlfunctions/sympow.py:            sage:\nsympow.analytic_rank(EllipticCurve([0, 0, 0, -10012, 346900]))  # long\nlfunctions/lcalc.py:            sage: lcalc.zeros(4)\n       # long\nlfunctions/lcalc.py:            sage: lcalc.zeros(5, L='--tau')\n       # long\nlfunctions/lcalc.py:            sage: lcalc.zeros(3,\nEllipticCurve('37a'))     # long\nmodules/fg_pid/fgp_module.py:        sage: set_random_seed(s); v =\n[fgp.test_morphism_0(4) for _ in range(50)]    # long\nplot/plot.py:            sage: sum([plot(z*sin(x), 0, 10).plot3d(z)\nfor z in range(6)]) #long\nplot/plot.py:            sage: p.show(gridlines=( [-3,-2.75,..,3],\nxrange(-1,5,2) )) #long\nrings/qqbar.py:            sage: a.exactify(); a #long\nschemes/elliptic_curves/heegner.py:        sage:\nkolyvagin_reduction_data(E,3)              # long\nschemes/elliptic_curves/ell_rational_field.py:            sage: E =\nEllipticCurve([1, -1, 0, -751055859, -7922219731979])     # long (0.6\nseconds)\nschemes/elliptic_curves/ell_rational_field.py:            sage:\nEllipticCurve('681b').three_selmer_rank(algorithm='Heuristic')   #\nlong (10 seconds); optional - magma\nschemes/elliptic_curves/lseries_ell.py:            sage:\nE.lseries().zeros_in_interval(6, 10, 0.1)      # long\nschemes/elliptic_curves/lseries_ell.py:            sage:\nE.lseries().twist_zeros(3, -4, -3)         # long\nschemes/generic/fano_toric_variety.py:    sage: p4318 =\nReflexivePolytope(3, 4318)  # long\nschemes/generic/fano_toric_variety.py:    sage: FTV =\nCPRFanoToricVariety(Delta_polar=p4318)  # long\nschemes/generic/fano_toric_variety.py:    sage:\nFTV.anticanonical_hypersurface()  # long\n```\n(This list is not guaranteed to be complete, and may contain lines which are fine).\n\n**Apply:**\n\n1. [attachment:trac_10183_long_to_long_time.patch]\n2. [attachment:trac_10183_additional_long_time_tags.patch]\n\nAssignee: mvngu\n\nKeywords: doctest long tag\n\nResolution: fixed\n\nAuthor: Damek Davis, Benjamin Jones\n\nReviewer: John Cremona, Minh Van Nguyen\n\nMerged: sage-4.6.1.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/10183\n\n",
    "closed_at": "2010-12-02T16:09:50Z",
    "created_at": "2010-10-28T13:29:22Z",
    "labels": [
        "component: doctest coverage",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "long doctests wrongly tagged \"# long\" instead of \"#long time\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10183",
    "user": "https://github.com/JohnCremona"
}
```
In several places, long doctests are incorrectly tagged "# long" instead of "# long time", thus mistakenly preventing them from being omitted when "-long" is not included on the command line.

On of these is at #10182.  The rest are:

```
combinat/sf/sfa.py:            sage: a.itensor(a) #long
graphs/graph_generators.py:            sage: G.show() # long
graphs/graph.py:            sage: K5_minor =
g.minor(graphs.CompleteGraph(5))                    # long
graphs/graph.py:            sage: K33_minor =
g.minor(graphs.CompleteBipartiteGraph(3,3))        # long
lfunctions/sympow.py:            sage: sympow.analytic_rank(EllipticCurve([0, 0, 1, -79, 342]))  # long
lfunctions/sympow.py:            sage:
sympow.analytic_rank(EllipticCurve([1, 1, 0, -2582, 48720]))  # long
lfunctions/sympow.py:            sage:
sympow.analytic_rank(EllipticCurve([0, 0, 0, -10012, 346900]))  # long
lfunctions/lcalc.py:            sage: lcalc.zeros(4)
       # long
lfunctions/lcalc.py:            sage: lcalc.zeros(5, L='--tau')
       # long
lfunctions/lcalc.py:            sage: lcalc.zeros(3,
EllipticCurve('37a'))     # long
modules/fg_pid/fgp_module.py:        sage: set_random_seed(s); v =
[fgp.test_morphism_0(4) for _ in range(50)]    # long
plot/plot.py:            sage: sum([plot(z*sin(x), 0, 10).plot3d(z)
for z in range(6)]) #long
plot/plot.py:            sage: p.show(gridlines=( [-3,-2.75,..,3],
xrange(-1,5,2) )) #long
rings/qqbar.py:            sage: a.exactify(); a #long
schemes/elliptic_curves/heegner.py:        sage:
kolyvagin_reduction_data(E,3)              # long
schemes/elliptic_curves/ell_rational_field.py:            sage: E =
EllipticCurve([1, -1, 0, -751055859, -7922219731979])     # long (0.6
seconds)
schemes/elliptic_curves/ell_rational_field.py:            sage:
EllipticCurve('681b').three_selmer_rank(algorithm='Heuristic')   #
long (10 seconds); optional - magma
schemes/elliptic_curves/lseries_ell.py:            sage:
E.lseries().zeros_in_interval(6, 10, 0.1)      # long
schemes/elliptic_curves/lseries_ell.py:            sage:
E.lseries().twist_zeros(3, -4, -3)         # long
schemes/generic/fano_toric_variety.py:    sage: p4318 =
ReflexivePolytope(3, 4318)  # long
schemes/generic/fano_toric_variety.py:    sage: FTV =
CPRFanoToricVariety(Delta_polar=p4318)  # long
schemes/generic/fano_toric_variety.py:    sage:
FTV.anticanonical_hypersurface()  # long
```
(This list is not guaranteed to be complete, and may contain lines which are fine).

**Apply:**

1. [attachment:trac_10183_long_to_long_time.patch]
2. [attachment:trac_10183_additional_long_time_tags.patch]

Assignee: mvngu

Keywords: doctest long tag

Resolution: fixed

Author: Damek Davis, Benjamin Jones

Reviewer: John Cremona, Minh Van Nguyen

Merged: sage-4.6.1.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/10183





---

archive/issue_comments_103125.json:
```json
{
    "body": "Attachment [trac_10183_long_to_long_time.patch](tarball://root/attachments/some-uuid/ticket10183/trac_10183_long_to_long_time.patch) by damek created at 2010-11-07 00:24:14",
    "created_at": "2010-11-07T00:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103125",
    "user": "https://trac.sagemath.org/admin/accounts/users/damek"
}
```

Attachment [trac_10183_long_to_long_time.patch](tarball://root/attachments/some-uuid/ticket10183/trac_10183_long_to_long_time.patch) by damek created at 2010-11-07 00:24:14



---

archive/issue_comments_103126.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-11-07T00:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103126",
    "user": "https://trac.sagemath.org/admin/accounts/users/damek"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_103127.json:
```json
{
    "body": "<a id='comment:2'></a>The patch here looks good, similar to trac #10182. I tested the timings before and after, log files are attached (didn't know if this is appropriate here or not, but figured I'd include them anyway). There was an error testing schemes/elliptic_curves/ell_rational_field.py with \"sage -t\" which doesn't occur with \"sage -t --long\" that I'm puzzled about. Here is the error:\n\n```\nsage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n  ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n  ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n**********************************************************************\nFile \"/Users/jonesbe/sage/sage-4.6/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\", line 1447:\n    sage: E.simon_two_descent ()\nExpected:\n    (1, 1, [])\nGot:\n    (3, 3, [(1 : 0 : 1), (0 : 2 : 1), (2 : -1 : 1)])\n**********************************************************************\n1 items had failures:\n   1 of  31 in __main__.example_28\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /Users/jonesbe/.sage//tmp/.doctest_ell_rational_field.py\n\t [39.4 s]\n```\n\nThe test in question is:\n\n```\nsage: E = EllipticCurve([1, -1, 0, -751055859, -7922219731979])     # long time (0.6 seconds)\nsage: set_random_seed(0)\nsage: E.simon_two_descent ()\n```\n\nWhen I run these commands in an interactive sage session I get the \"expected\" answer:\n\n```\nsage: E = EllipticCurve([1, -1, 0, -751055859, -7922219731979])     # long time (0.6 seconds)\nsage: set_random_seed(0)\nsage: E.simon_two_descent ()\n(1, 1, [])\n```\n\nbut when the test gets done as part of \"sage -t\" the result is different (see above). When the test is done with \"sage -t --long\" there is no deviation from the expected answer. \n\nLooks to me like what's going on is that with \"sage -t\" the line tagged \"# long time\" is not executed, so the calculation \n\n```\nsage: set_random_seed(0)\nsage: E.simon_two_descent ()\n```\n\napplies to the previously defined Elliptic curve (on line 1435) where the following test is performed:\n\n```\nsage: E = EllipticCurve('5077a1')\nsage: set_random_seed(0)\nsage: E.simon_two_descent()\n(3, 3, [(1 : 0 : 1), (0 : 2 : 1), (2 : -1 : 1)])\n```\nThe output here is what sage is complaining is not equal to the expected output in the present test.\n\nSo... I guess the whole three line block lines 1445 - 1447 should be tagged \"# long time\".\n\nOther than this problem, the patch produces expected timing differences.",
    "created_at": "2010-11-07T22:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103127",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:2'></a>The patch here looks good, similar to trac #10182. I tested the timings before and after, log files are attached (didn't know if this is appropriate here or not, but figured I'd include them anyway). There was an error testing schemes/elliptic_curves/ell_rational_field.py with "sage -t" which doesn't occur with "sage -t --long" that I'm puzzled about. Here is the error:

```
sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
  ***   Warning: new stack size = 1003360 (0.957 Mbytes).
  ***   Warning: new stack size = 1003360 (0.957 Mbytes).
**********************************************************************
File "/Users/jonesbe/sage/sage-4.6/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py", line 1447:
    sage: E.simon_two_descent ()
Expected:
    (1, 1, [])
Got:
    (3, 3, [(1 : 0 : 1), (0 : 2 : 1), (2 : -1 : 1)])
**********************************************************************
1 items had failures:
   1 of  31 in __main__.example_28
***Test Failed*** 1 failures.
For whitespace errors, see the file /Users/jonesbe/.sage//tmp/.doctest_ell_rational_field.py
	 [39.4 s]
```

The test in question is:

```
sage: E = EllipticCurve([1, -1, 0, -751055859, -7922219731979])     # long time (0.6 seconds)
sage: set_random_seed(0)
sage: E.simon_two_descent ()
```

When I run these commands in an interactive sage session I get the "expected" answer:

```
sage: E = EllipticCurve([1, -1, 0, -751055859, -7922219731979])     # long time (0.6 seconds)
sage: set_random_seed(0)
sage: E.simon_two_descent ()
(1, 1, [])
```

but when the test gets done as part of "sage -t" the result is different (see above). When the test is done with "sage -t --long" there is no deviation from the expected answer. 

Looks to me like what's going on is that with "sage -t" the line tagged "# long time" is not executed, so the calculation 

```
sage: set_random_seed(0)
sage: E.simon_two_descent ()
```

applies to the previously defined Elliptic curve (on line 1435) where the following test is performed:

```
sage: E = EllipticCurve('5077a1')
sage: set_random_seed(0)
sage: E.simon_two_descent()
(3, 3, [(1 : 0 : 1), (0 : 2 : 1), (2 : -1 : 1)])
```
The output here is what sage is complaining is not equal to the expected output in the present test.

So... I guess the whole three line block lines 1445 - 1447 should be tagged "# long time".

Other than this problem, the patch produces expected timing differences.



---

archive/issue_comments_103128.json:
```json
{
    "body": "Attachment [trac_10183_before.txt](tarball://root/attachments/some-uuid/ticket10183/trac_10183_before.txt) by @benjaminfjones created at 2010-11-07 22:28:05\n\nTiming log (before patch)",
    "created_at": "2010-11-07T22:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103128",
    "user": "https://github.com/benjaminfjones"
}
```

Attachment [trac_10183_before.txt](tarball://root/attachments/some-uuid/ticket10183/trac_10183_before.txt) by @benjaminfjones created at 2010-11-07 22:28:05

Timing log (before patch)



---

archive/issue_comments_103129.json:
```json
{
    "body": "Attachment [trac_10183_after.txt](tarball://root/attachments/some-uuid/ticket10183/trac_10183_after.txt) by @benjaminfjones created at 2010-11-07 22:28:30\n\nTiming log (after patch)",
    "created_at": "2010-11-07T22:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103129",
    "user": "https://github.com/benjaminfjones"
}
```

Attachment [trac_10183_after.txt](tarball://root/attachments/some-uuid/ticket10183/trac_10183_after.txt) by @benjaminfjones created at 2010-11-07 22:28:30

Timing log (after patch)



---

archive/issue_comments_103130.json:
```json
{
    "body": "<a id='comment:3'></a>I've attached an additional patch to fix the problem appearing in my last comment. Now the \"sage -t\" test and \"sage -t --long\" tests for schemes/elliptic_curves/ell_rational_field.py both succeed:\n\n```\nsage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n\t [40.5 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 40.5 seconds\n\nsage -t --long \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n\t [157.6 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 157.6 seconds\n```",
    "created_at": "2010-11-07T22:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103130",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:3'></a>I've attached an additional patch to fix the problem appearing in my last comment. Now the "sage -t" test and "sage -t --long" tests for schemes/elliptic_curves/ell_rational_field.py both succeed:

```
sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
	 [40.5 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 40.5 seconds

sage -t --long "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
	 [157.6 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 157.6 seconds
```



---

archive/issue_comments_103131.json:
```json
{
    "body": "added neccesary \"# long time\" tags to lines 1446-1447 of schemes/elliptic_curves/ell_rational_field.py",
    "created_at": "2010-11-07T22:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103131",
    "user": "https://github.com/benjaminfjones"
}
```

added neccesary "# long time" tags to lines 1446-1447 of schemes/elliptic_curves/ell_rational_field.py



---

archive/issue_comments_103132.json:
```json
{
    "body": "<a id='comment:4'></a>Attachment [trac_10183_additional_long_time_tags.patch](tarball://root/attachments/some-uuid/ticket10183/trac_10183_additional_long_time_tags.patch) by @JohnCremona created at 2010-11-07 22:36:30\n\nBenjamin,  Your analysis is entirely correct!\n\nI don't have time right now to re-review the patch, but I'm sure it is fine now.\n\nDamek,  you should try to work out how you did not detect this problem (which was certainly not your fault).  It's important to do full testing before asking for a review!",
    "created_at": "2010-11-07T22:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103132",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>Attachment [trac_10183_additional_long_time_tags.patch](tarball://root/attachments/some-uuid/ticket10183/trac_10183_additional_long_time_tags.patch) by @JohnCremona created at 2010-11-07 22:36:30

Benjamin,  Your analysis is entirely correct!

I don't have time right now to re-review the patch, but I'm sure it is fine now.

Damek,  you should try to work out how you did not detect this problem (which was certainly not your fault).  It's important to do full testing before asking for a review!



---

archive/issue_comments_103133.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-27T14:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103133",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_103134.json:
```json
{
    "body": "<a id='comment:5'></a>Both patches look good to me. See the ticket description for instructions on which tickets to apply and in which order.",
    "created_at": "2010-11-27T14:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103134",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:5'></a>Both patches look good to me. See the ticket description for instructions on which tickets to apply and in which order.



---

archive/issue_comments_103135.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-12-02T16:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10183#issuecomment-103135",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_026078.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-02T16:09:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10183",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10183#event-26078"
}
```
