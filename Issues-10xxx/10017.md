# Issue 10017: reduced_basis for number field multiples wrong

archive/issues_010016.json:
```json
{
    "assignees": [],
    "body": "This was reported by the \"report a problem\" link:\n\nThe reduced_basis for number fields applies LLL to basis of the maximal order in order to get a reduced basis. The problem is that after applying LLL, it multiples the transformation matrix by the vector [1,a,a<sup>2</sup>,...], where 'a' is generator of the field - instead of using the vector it actually used for the maximal order.\n\nHow to reproduce:\n\n```\nx = QQ['x'].0\nk = NumberField(x^6 + 2218926655879913714112*x^4 - \\\n32507675650290949030789018433536*x^3 + \\\n4923635504174417014460581055002374467948544*x^2 - \\\n36066074010564497464129951249279114076897746988630016*x + \\\n264187244046129768986806800244258952598300346857154900812365824,'a')\nnew_basis = k.reduced_basis()\nprint new_basis[0].minpoly()\n```\nThis prints a crazy big polynomial. Looking a bit at what is returned it is clear that reduced_basis is multiplying the transformation matrix by the wrong vector.\n\nTo solve you just need to multiply by the vector of generators of the maximal order:\n\n```\nmp = pari( k.Minkowski_embedding(k.maximal_order().gens(), prec=120) )\nml = sage.libs.pari.gen.gen.qflll(mp)\nT = matrix([[ZZ(y) for y in list(x)] for x in list(ml)]).transpose()\nr = Matrix(O.gens())* T\nfor rr in r[0]:\nprint rr.minpoly()\n```\nThis works fine.\n\nAssignee: **@loefflerd**\n\nBranch/Commit: **[8f1f51d](https://github.com/sagemath/sagetrac-mirror/commit/8f1f51d83fc198a31683740001bcffe9a3d30bbc)**\n\nStopgaps: **todo**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **John Cremona**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10017_\n\n",
    "closed_at": "2018-01-20T20:20:23Z",
    "created_at": "2010-09-26T10:24:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "reduced_basis for number field multiples wrong",
    "type": "issue",
    "updated_at": "2018-01-20T20:20:23Z",
    "url": "https://github.com/sagemath/sage/issues/10017",
    "user": "https://github.com/haraldschilly"
}
```
This was reported by the "report a problem" link:

The reduced_basis for number fields applies LLL to basis of the maximal order in order to get a reduced basis. The problem is that after applying LLL, it multiples the transformation matrix by the vector [1,a,a<sup>2</sup>,...], where 'a' is generator of the field - instead of using the vector it actually used for the maximal order.

How to reproduce:

```
x = QQ['x'].0
k = NumberField(x^6 + 2218926655879913714112*x^4 - \
32507675650290949030789018433536*x^3 + \
4923635504174417014460581055002374467948544*x^2 - \
36066074010564497464129951249279114076897746988630016*x + \
264187244046129768986806800244258952598300346857154900812365824,'a')
new_basis = k.reduced_basis()
print new_basis[0].minpoly()
```
This prints a crazy big polynomial. Looking a bit at what is returned it is clear that reduced_basis is multiplying the transformation matrix by the wrong vector.

To solve you just need to multiply by the vector of generators of the maximal order:

```
mp = pari( k.Minkowski_embedding(k.maximal_order().gens(), prec=120) )
ml = sage.libs.pari.gen.gen.qflll(mp)
T = matrix([[ZZ(y) for y in list(x)] for x in list(ml)]).transpose()
r = Matrix(O.gens())* T
for rr in r[0]:
print rr.minpoly()
```
This works fine.

Assignee: **@loefflerd**

Branch/Commit: **[8f1f51d](https://github.com/sagemath/sagetrac-mirror/commit/8f1f51d83fc198a31683740001bcffe9a3d30bbc)**

Stopgaps: **todo**

Reviewer: **Jeroen Demeyer**

Author: **John Cremona**

_Issue created by migration from https://trac.sagemath.org/ticket/10017_





---

archive/issue_events_119121.json:
```json
{
    "actor": "https://github.com/haraldschilly",
    "created_at": "2010-09-26T10:24:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119121"
}
```



---

archive/issue_events_119122.json:
```json
{
    "actor": "https://github.com/haraldschilly",
    "created_at": "2010-09-26T10:24:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "component: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119122"
}
```



---

archive/issue_events_119123.json:
```json
{
    "actor": "https://github.com/haraldschilly",
    "created_at": "2010-09-26T10:24:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119123"
}
```



---

archive/issue_events_119124.json:
```json
{
    "actor": "https://github.com/haraldschilly",
    "created_at": "2010-09-26T10:24:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119124"
}
```



---

archive/issue_comments_093408.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nLooks like the definition of `O` was omitted.  The following slightly simplified code works ok for me:\n\n```\nsage: O = k.ring_of_integers()\nsage: mp = pari( k.Minkowski_embedding(O.gens(), prec=120) )\nsage: ml = sage.libs.pari.gen.gen.qflll(mp)\nsage: T = ml.sage()\nsage: r = vector(O.gens())*T\nsage: for rr in r:\n....:     rr.minpoly()\n```",
    "created_at": "2010-09-27T06:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93408",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<a id='comment:1'>Comment 1:</a>
Looks like the definition of `O` was omitted.  The following slightly simplified code works ok for me:

```
sage: O = k.ring_of_integers()
sage: mp = pari( k.Minkowski_embedding(O.gens(), prec=120) )
sage: ml = sage.libs.pari.gen.gen.qflll(mp)
sage: T = ml.sage()
sage: r = vector(O.gens())*T
sage: for rr in r:
....:     rr.minpoly()
```



---

archive/issue_events_119125.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119125"
}
```



---

archive/issue_events_119126.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119126"
}
```



---

archive/issue_events_119127.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119127"
}
```



---

archive/issue_events_119128.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119128"
}
```



---

archive/issue_events_119129.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119129"
}
```



---

archive/issue_events_119130.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119130"
}
```



---

archive/issue_events_119131.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119131"
}
```



---

archive/issue_events_119132.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119132"
}
```



---

archive/issue_comments_093409.json:
```json
{
    "body": "Stopgaps: **todo**",
    "created_at": "2015-08-25T14:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93409",
    "user": "https://github.com/sagetrac-jakobkroeker"
}
```

Stopgaps: **todo**



---

archive/issue_comments_093410.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nWhile the original diagnosis is not wrong, there is a more basic problem as this smaller example shows:\n\n```\nsage: K.<a> = NumberField(x^3-10)\nsage: ZK = K.ring_of_integers()\nsage: ZK.basis()\n[1/3*a^2 + 1/3*a + 1/3, a, a^2]\nsage: ZK([1,2,3])\n3*a^2 + 2*a + 1\n```\nAlthough the ring of integers is an order which knows its own Z-basis, when you construct an element of the order from an integer vector it ignores that and uses the power_basis of the field and not its integral basis.\n\nI think the problem is in these lines of _element_constructor() (order.py lines 1142-1143):\n\n```\n       if not is_Element(x) or x.parent() is not self._K:\n            x = self._K(x)\n```\n\nThere appears to be a related problem in the constructor of OrderElementAbsolute in number_field_element:\n\n```\n       K = order.number_field()\n        NumberFieldElement_absolute.__init__(self, K, f)\n        self._number_field = K\n```\nwhere the parameter f is not documented and there are no relevant tests, but this seems to be saying \"take the data in f and construct a field element from it\".\n\nPerhaps the simplest solution is to go to those lines in order.py and insert code to handle the case where the input data is an integer vector of the right length.",
    "created_at": "2017-11-12T15:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93410",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'>Comment 7:</a>
While the original diagnosis is not wrong, there is a more basic problem as this smaller example shows:

```
sage: K.<a> = NumberField(x^3-10)
sage: ZK = K.ring_of_integers()
sage: ZK.basis()
[1/3*a^2 + 1/3*a + 1/3, a, a^2]
sage: ZK([1,2,3])
3*a^2 + 2*a + 1
```
Although the ring of integers is an order which knows its own Z-basis, when you construct an element of the order from an integer vector it ignores that and uses the power_basis of the field and not its integral basis.

I think the problem is in these lines of _element_constructor() (order.py lines 1142-1143):

```
       if not is_Element(x) or x.parent() is not self._K:
            x = self._K(x)
```

There appears to be a related problem in the constructor of OrderElementAbsolute in number_field_element:

```
       K = order.number_field()
        NumberFieldElement_absolute.__init__(self, K, f)
        self._number_field = K
```
where the parameter f is not documented and there are no relevant tests, but this seems to be saying "take the data in f and construct a field element from it".

Perhaps the simplest solution is to go to those lines in order.py and insert code to handle the case where the input data is an integer vector of the right length.



---

archive/issue_comments_093411.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nAfter doing the above \"simplest solution\", which did fix the `x^3-10` example above, I saw that it's not the fix needed for the original which is to take the vectors output by the LLL reduction and push them into the ring of integers rather than the field.  Now I get \n\n```\nsage: [c.minpoly() for c in new_basis]\n\n[x - 1,\n x^6 + 3*x^5 + 258*x^4 + 511*x^3 + 3564*x^2 + 3309*x + 2347,\n x^6 - 24*x^5 + 6126*x^4 - 312664*x^3 + 5407566*x^2 - 33643572*x + 95921443,\n x^6 + 18*x^5 + 3366*x^4 + 82008*x^3 + 886962*x^2 - 840726*x + 5521647,\n x^6 + 27*x^5 + 9579*x^4 + 623358*x^3 + 5060091*x^2 - 139224285*x + 880944177,\n x^6 - 72*x^5 + 65286*x^4 - 10762768*x^3 + 473072922*x^2 - 2502686322*x + 54227921641]\n```\nwhich is a lot better.\n\nPatch up when I have added doctests...",
    "created_at": "2017-11-12T15:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93411",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'>Comment 8:</a>
After doing the above "simplest solution", which did fix the `x^3-10` example above, I saw that it's not the fix needed for the original which is to take the vectors output by the LLL reduction and push them into the ring of integers rather than the field.  Now I get 

```
sage: [c.minpoly() for c in new_basis]

[x - 1,
 x^6 + 3*x^5 + 258*x^4 + 511*x^3 + 3564*x^2 + 3309*x + 2347,
 x^6 - 24*x^5 + 6126*x^4 - 312664*x^3 + 5407566*x^2 - 33643572*x + 95921443,
 x^6 + 18*x^5 + 3366*x^4 + 82008*x^3 + 886962*x^2 - 840726*x + 5521647,
 x^6 + 27*x^5 + 9579*x^4 + 623358*x^3 + 5060091*x^2 - 139224285*x + 880944177,
 x^6 - 72*x^5 + 65286*x^4 - 10762768*x^3 + 473072922*x^2 - 2502686322*x + 54227921641]
```
which is a lot better.

Patch up when I have added doctests...



---

archive/issue_comments_093412.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nThe doctest based on the original post works fine for me when run manually, but when run as a doctest something weird happens -- it takes ages and then gives an enormous python crash.  I have no idea what this is but hope that a human can help before this breaks all the patchbots out there...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bee3fca54bf50cfbd7a82e71d899b7ddafacb89\">6bee3fc</a></td><td><code>#10017: fix construction of order elements from list, and number field reduced basis</code></td></tr></table>\n",
    "created_at": "2017-11-12T16:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93412",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'>Comment 9:</a>
The doctest based on the original post works fine for me when run manually, but when run as a doctest something weird happens -- it takes ages and then gives an enormous python crash.  I have no idea what this is but hope that a human can help before this breaks all the patchbots out there...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bee3fca54bf50cfbd7a82e71d899b7ddafacb89">6bee3fc</a></td><td><code>#10017: fix construction of order elements from list, and number field reduced basis</code></td></tr></table>




---

archive/issue_events_119133.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-11-12T16:36:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119133"
}
```



---

archive/issue_comments_093413.json:
```json
{
    "body": "Author: **John Cremona**",
    "created_at": "2017-11-12T16:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93413",
    "user": "https://github.com/JohnCremona"
}
```

Author: **John Cremona**



---

archive/issue_comments_093414.json:
```json
{
    "body": "Branch: **[u/cremona/10017](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/10017)**",
    "created_at": "2017-11-12T16:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93414",
    "user": "https://github.com/JohnCremona"
}
```

Branch: **[u/cremona/10017](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/10017)**



---

archive/issue_comments_093415.json:
```json
{
    "body": "Commit: **[6bee3fc](https://github.com/sagemath/sagetrac-mirror/commit/6bee3fca54bf50cfbd7a82e71d899b7ddafacb89)**",
    "created_at": "2017-11-12T16:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93415",
    "user": "https://github.com/JohnCremona"
}
```

Commit: **[6bee3fc](https://github.com/sagemath/sagetrac-mirror/commit/6bee3fca54bf50cfbd7a82e71d899b7ddafacb89)**



---

archive/issue_comments_093416.json:
```json
{
    "body": "Changed commit from **[6bee3fc](https://github.com/sagemath/sagetrac-mirror/commit/6bee3fca54bf50cfbd7a82e71d899b7ddafacb89)** to **[5d51b32](https://github.com/sagemath/sagetrac-mirror/commit/5d51b3260b6bec7eacc24aca4f469ee1ba8b4572)**",
    "created_at": "2017-11-21T13:05:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93416",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6bee3fc](https://github.com/sagemath/sagetrac-mirror/commit/6bee3fca54bf50cfbd7a82e71d899b7ddafacb89)** to **[5d51b32](https://github.com/sagemath/sagetrac-mirror/commit/5d51b3260b6bec7eacc24aca4f469ee1ba8b4572)**



---

archive/issue_comments_093417.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0000be4e8d06d00340e32c930514d22038ebd5c5\">0000be4</a></td><td><code>Merge branch 'develop' into 10017</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d51b3260b6bec7eacc24aca4f469ee1ba8b4572\">5d51b32</a></td><td><code>#10017 added 2 lines to new doctest</code></td></tr></table>\n",
    "created_at": "2017-11-21T13:05:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93417",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0000be4e8d06d00340e32c930514d22038ebd5c5">0000be4</a></td><td><code>Merge branch 'develop' into 10017</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d51b3260b6bec7eacc24aca4f469ee1ba8b4572">5d51b32</a></td><td><code>#10017 added 2 lines to new doctest</code></td></tr></table>




---

archive/issue_comments_093418.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nQuick comments (more might come):\n\n1. Replace <code>See (:trac:\\`10017\\`)::</code> by <code>Check that :trac:\\`10017\\` is fixed::</code> or something along those lines.\n\n2. Replace\n\n```\nsage: assert R.discriminant()==k.discriminant()\n```\nby\n\n```\nsage: R.discriminant() == k.discriminant()\nTrue\n```",
    "created_at": "2017-11-21T13:47:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93418",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>Comment 11:</a>
Quick comments (more might come):

1. Replace <code>See (:trac:\`10017\`)::</code> by <code>Check that :trac:\`10017\` is fixed::</code> or something along those lines.

2. Replace

```
sage: assert R.discriminant()==k.discriminant()
```
by

```
sage: R.discriminant() == k.discriminant()
True
```



---

archive/issue_comments_093419.json:
```json
{
    "body": "Changed commit from **[5d51b32](https://github.com/sagemath/sagetrac-mirror/commit/5d51b3260b6bec7eacc24aca4f469ee1ba8b4572)** to **[8b3eb02](https://github.com/sagemath/sagetrac-mirror/commit/8b3eb02ede88e3de6bf03cc54f8565b2a0ef3bcf)**",
    "created_at": "2017-11-21T14:25:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93419",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5d51b32](https://github.com/sagemath/sagetrac-mirror/commit/5d51b3260b6bec7eacc24aca4f469ee1ba8b4572)** to **[8b3eb02](https://github.com/sagemath/sagetrac-mirror/commit/8b3eb02ede88e3de6bf03cc54f8565b2a0ef3bcf)**



---

archive/issue_comments_093420.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b3eb02ede88e3de6bf03cc54f8565b2a0ef3bcf\">8b3eb02</a></td><td><code>#10017 minor changes to docstring</code></td></tr></table>\n",
    "created_at": "2017-11-21T14:25:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93420",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b3eb02ede88e3de6bf03cc54f8565b2a0ef3bcf">8b3eb02</a></td><td><code>#10017 minor changes to docstring</code></td></tr></table>




---

archive/issue_comments_093421.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nIn this block of code:\n\n```\n            M = self.Minkowski_embedding(self.integral_basis(), prec=prec)\n            T = pari(M).qflll().sage()\n            ZK = self.ring_of_integers()\n            self.__reduced_basis = [ ZK(v.list()) for v in T.columns() ]\n```\nyou are assuming that `self.integral_basis()` corresponds to the basis chosen in `ZK(v.list())`. After all, that's the bug on this ticket, right? To me, this looks way too implicit. I would prefer to see the code written in such a way that you are actually using `self.integral_basis()` in this computation, instead of the `ZK()` call. I.e. something like\n\n```\nZK = self.integral_basis()\nreduced_basis = [sum(x * g for x, g in zip(v.list(), ZK)) for v in T.columns()]\n```",
    "created_at": "2017-11-28T13:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93421",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
In this block of code:

```
            M = self.Minkowski_embedding(self.integral_basis(), prec=prec)
            T = pari(M).qflll().sage()
            ZK = self.ring_of_integers()
            self.__reduced_basis = [ ZK(v.list()) for v in T.columns() ]
```
you are assuming that `self.integral_basis()` corresponds to the basis chosen in `ZK(v.list())`. After all, that's the bug on this ticket, right? To me, this looks way too implicit. I would prefer to see the code written in such a way that you are actually using `self.integral_basis()` in this computation, instead of the `ZK()` call. I.e. something like

```
ZK = self.integral_basis()
reduced_basis = [sum(x * g for x, g in zip(v.list(), ZK)) for v in T.columns()]
```



---

archive/issue_comments_093422.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nYes, you are right, and perhaps being explicit like this is safest.  I still think (do you agree?) that being able to do ZK(list) is useful and must give the linear combination of ZK's basis with coefficients from the list.\n\nA related different point is that after computing the reduced basis, it is stored as `self.__reduced_basis`, but not actually used anywhere.  Perhaps we should implement the ability to change the integral basis itself; but that might be too dangerous since various functions using pari directly will assume that the integral basis does not change.",
    "created_at": "2017-11-28T14:02:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93422",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'>Comment 14:</a>
Yes, you are right, and perhaps being explicit like this is safest.  I still think (do you agree?) that being able to do ZK(list) is useful and must give the linear combination of ZK's basis with coefficients from the list.

A related different point is that after computing the reduced basis, it is stored as `self.__reduced_basis`, but not actually used anywhere.  Perhaps we should implement the ability to change the integral basis itself; but that might be too dangerous since various functions using pari directly will assume that the integral basis does not change.



---

archive/issue_comments_093423.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n(fixing exponentiation in ticket description)",
    "created_at": "2017-12-03T11:43:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93423",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'>Comment 15:</a>
(fixing exponentiation in ticket description)



---

archive/issue_comments_093424.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n This was reported by the \"report a problem\" link:\n \n-The reduced_basis for number fields applies LLL to basis of the maximal order in order to get a reduced basis. The problem is that after applying LLL, it multiples the transformation matrix by the vector [1,a,a^2,...], where 'a' is generator of the field - instead of using the vector it actually used for the maximal order.\n+The reduced_basis for number fields applies LLL to basis of the maximal order in order to get a reduced basis. The problem is that after applying LLL, it multiples the transformation matrix by the vector [1,a,a<sup>2</sup>,...], where 'a' is generator of the field - instead of using the vector it actually used for the maximal order.\n \n How to reproduce:\n \n``````\n",
    "created_at": "2017-12-03T11:43:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93424",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 This was reported by the "report a problem" link:
 
-The reduced_basis for number fields applies LLL to basis of the maximal order in order to get a reduced basis. The problem is that after applying LLL, it multiples the transformation matrix by the vector [1,a,a^2,...], where 'a' is generator of the field - instead of using the vector it actually used for the maximal order.
+The reduced_basis for number fields applies LLL to basis of the maximal order in order to get a reduced basis. The problem is that after applying LLL, it multiples the transformation matrix by the vector [1,a,a<sup>2</sup>,...], where 'a' is generator of the field - instead of using the vector it actually used for the maximal order.
 
 How to reproduce:
 
``````




---

archive/issue_comments_093425.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@JohnCremona](#comment%3A14):\n> Yes, you are right, and perhaps being explicit like this is safest.  I still think (do you agree?) that being able to do ZK(list) is useful and must give the linear combination of ZK's basis with coefficients from the list.\n\nSure, why not.\n\n> A related different point is that after computing the reduced basis, it is stored as `self.__reduced_basis`, but not actually used anywhere.\n\nI would be fine to not store it.\n\n> Perhaps we should implement the ability to change the integral basis itself; but that might be too dangerous since various functions using pari directly will assume that the integral basis does not change.\n\nI agree with the latter. Better not do this.",
    "created_at": "2018-01-08T08:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93425",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@JohnCremona](#comment%3A14):
> Yes, you are right, and perhaps being explicit like this is safest.  I still think (do you agree?) that being able to do ZK(list) is useful and must give the linear combination of ZK's basis with coefficients from the list.

Sure, why not.

> A related different point is that after computing the reduced basis, it is stored as `self.__reduced_basis`, but not actually used anywhere.

I would be fine to not store it.

> Perhaps we should implement the ability to change the integral basis itself; but that might be too dangerous since various functions using pari directly will assume that the integral basis does not change.

I agree with the latter. Better not do this.



---

archive/issue_comments_093426.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nThe problems I was having with testing were due to a cut-and-paste error: in the patch the coefficient of x starts 3666 instead of 36066 which makes the polynomial rather harder to work with.  I will fix that and the other issues from the previous comment now.",
    "created_at": "2018-01-11T12:55:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93426",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:17'>Comment 17:</a>
The problems I was having with testing were due to a cut-and-paste error: in the patch the coefficient of x starts 3666 instead of 36066 which makes the polynomial rather harder to work with.  I will fix that and the other issues from the previous comment now.



---

archive/issue_comments_093427.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ee081a5d2052f1adcfb44fbba9afb29c2b7be56\">6ee081a</a></td><td><code>Merge branch 'develop' into 10017</code></td></tr></table>\n",
    "created_at": "2018-01-11T13:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93427",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'>Comment 18:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ee081a5d2052f1adcfb44fbba9afb29c2b7be56">6ee081a</a></td><td><code>Merge branch 'develop' into 10017</code></td></tr></table>




---

archive/issue_comments_093428.json:
```json
{
    "body": "Changed commit from **[8b3eb02](https://github.com/sagemath/sagetrac-mirror/commit/8b3eb02ede88e3de6bf03cc54f8565b2a0ef3bcf)** to **[6ee081a](https://github.com/sagemath/sagetrac-mirror/commit/6ee081a5d2052f1adcfb44fbba9afb29c2b7be56)**",
    "created_at": "2018-01-11T13:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93428",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8b3eb02](https://github.com/sagemath/sagetrac-mirror/commit/8b3eb02ede88e3de6bf03cc54f8565b2a0ef3bcf)** to **[6ee081a](https://github.com/sagemath/sagetrac-mirror/commit/6ee081a5d2052f1adcfb44fbba9afb29c2b7be56)**



---

archive/issue_comments_093429.json:
```json
{
    "body": "Changed commit from **[6ee081a](https://github.com/sagemath/sagetrac-mirror/commit/6ee081a5d2052f1adcfb44fbba9afb29c2b7be56)** to **[a0448a2](https://github.com/sagemath/sagetrac-mirror/commit/a0448a21aea340aa6dc4be2cbca17fc6cf756ab5)**",
    "created_at": "2018-01-11T13:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93429",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6ee081a](https://github.com/sagemath/sagetrac-mirror/commit/6ee081a5d2052f1adcfb44fbba9afb29c2b7be56)** to **[a0448a2](https://github.com/sagemath/sagetrac-mirror/commit/a0448a21aea340aa6dc4be2cbca17fc6cf756ab5)**



---

archive/issue_comments_093430.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0448a21aea340aa6dc4be2cbca17fc6cf756ab5\">a0448a2</a></td><td><code>#10017: fix new example and simplify code in line with review comments</code></td></tr></table>\n",
    "created_at": "2018-01-11T13:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93430",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0448a21aea340aa6dc4be2cbca17fc6cf756ab5">a0448a2</a></td><td><code>#10017: fix new example and simplify code in line with review comments</code></td></tr></table>




---

archive/issue_comments_093431.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nNew changes: code simplified since there's really only 2 lines different between the two cases (totally real or not).  Removed caching of reduced basis (was never used).  Follow suggestion of comments 13 and following.\n\nNeeds review again!",
    "created_at": "2018-01-11T13:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93431",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:20'>Comment 20:</a>
New changes: code simplified since there's really only 2 lines different between the two cases (totally real or not).  Removed caching of reduced basis (was never used).  Follow suggestion of comments 13 and following.

Needs review again!



---

archive/issue_comments_093432.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nStyle issue: better write\n\n```\nif isinstance(x, (tuple, list)):\n```\ninstead of\n\n```\nif isinstance(x,list) or isinstance(x,tuple):\n```",
    "created_at": "2018-01-11T15:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93432",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'>Comment 21:</a>
Style issue: better write

```
if isinstance(x, (tuple, list)):
```
instead of

```
if isinstance(x,list) or isinstance(x,tuple):
```



---

archive/issue_comments_093433.json:
```json
{
    "body": "Changed commit from **[a0448a2](https://github.com/sagemath/sagetrac-mirror/commit/a0448a21aea340aa6dc4be2cbca17fc6cf756ab5)** to **[39fc227](https://github.com/sagemath/sagetrac-mirror/commit/39fc2278ce182b46715ffd4fb2071178a4c11092)**",
    "created_at": "2018-01-11T15:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93433",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a0448a2](https://github.com/sagemath/sagetrac-mirror/commit/a0448a21aea340aa6dc4be2cbca17fc6cf756ab5)** to **[39fc227](https://github.com/sagemath/sagetrac-mirror/commit/39fc2278ce182b46715ffd4fb2071178a4c11092)**



---

archive/issue_comments_093434.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39fc2278ce182b46715ffd4fb2071178a4c11092\">39fc227</a></td><td><code>#10017: small stylistic improvement</code></td></tr></table>\n",
    "created_at": "2018-01-11T15:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93434",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>Comment 22:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39fc2278ce182b46715ffd4fb2071178a4c11092">39fc227</a></td><td><code>#10017: small stylistic improvement</code></td></tr></table>




---

archive/issue_comments_093435.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nThe patchbot reports a failure on 32-bit:\n\n```\nsage -t --long src/sage/rings/number_field/number_field.py\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field.py\", line 5599, in sage.rings.number_field.number_field.NumberField_generic.reduced_basis\nFailed example:\n    [c.minpoly() for c in new_basis]\nExpected:\n    [x - 1,\n     x^6 + 3*x^5 + 258*x^4 + 511*x^3 + 3564*x^2 + 3309*x + 2347,\n     x^6 - 24*x^5 + 6126*x^4 - 312664*x^3 + 5407566*x^2 - 33643572*x + 95921443,\n     x^6 + 18*x^5 + 3366*x^4 + 82008*x^3 + 886962*x^2 - 840726*x + 5521647,\n     x^6 + 27*x^5 + 9579*x^4 + 623358*x^3 + 5060091*x^2 - 139224285*x + 880944177,\n     x^6 - 72*x^5 + 65286*x^4 - 10762768*x^3 + 473072922*x^2 - 2502686322*x + 54227921641]\nGot:\n    [x - 1,\n     x^6 - 45*x^5 + 6993*x^4 - 519048*x^3 + 8139204*x^2 + 64936080*x + 394386192,\n     x^6 + 3*x^5 + 258*x^4 + 511*x^3 + 3564*x^2 + 3309*x + 2347,\n     x^6 - 12*x^5 + 459*x^4 - 13068*x^3 + 171423*x^2 - 1008720*x + 2218941,\n     x^6 - 72*x^5 + 21618*x^4 - 2725154*x^3 + 96844941*x^2 - 367602102*x + 5299367596,\n     x^6 - 36*x^5 + 4104*x^4 - 225746*x^3 + 4831632*x^2 - 39603546*x + 130361299]\n**********************************************************************\n```",
    "created_at": "2018-01-12T14:00:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93435",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>Comment 23:</a>
The patchbot reports a failure on 32-bit:

```
sage -t --long src/sage/rings/number_field/number_field.py
**********************************************************************
File "src/sage/rings/number_field/number_field.py", line 5599, in sage.rings.number_field.number_field.NumberField_generic.reduced_basis
Failed example:
    [c.minpoly() for c in new_basis]
Expected:
    [x - 1,
     x^6 + 3*x^5 + 258*x^4 + 511*x^3 + 3564*x^2 + 3309*x + 2347,
     x^6 - 24*x^5 + 6126*x^4 - 312664*x^3 + 5407566*x^2 - 33643572*x + 95921443,
     x^6 + 18*x^5 + 3366*x^4 + 82008*x^3 + 886962*x^2 - 840726*x + 5521647,
     x^6 + 27*x^5 + 9579*x^4 + 623358*x^3 + 5060091*x^2 - 139224285*x + 880944177,
     x^6 - 72*x^5 + 65286*x^4 - 10762768*x^3 + 473072922*x^2 - 2502686322*x + 54227921641]
Got:
    [x - 1,
     x^6 - 45*x^5 + 6993*x^4 - 519048*x^3 + 8139204*x^2 + 64936080*x + 394386192,
     x^6 + 3*x^5 + 258*x^4 + 511*x^3 + 3564*x^2 + 3309*x + 2347,
     x^6 - 12*x^5 + 459*x^4 - 13068*x^3 + 171423*x^2 - 1008720*x + 2218941,
     x^6 - 72*x^5 + 21618*x^4 - 2725154*x^3 + 96844941*x^2 - 367602102*x + 5299367596,
     x^6 - 36*x^5 + 4104*x^4 - 225746*x^3 + 4831632*x^2 - 39603546*x + 130361299]
**********************************************************************
```



---

archive/issue_events_119134.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-12T14:00:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119134"
}
```



---

archive/issue_events_119135.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-12T14:00:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119135"
}
```



---

archive/issue_comments_093436.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2018-01-12T14:00:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93436",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_093437.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nWould it be OK to tag the current output as 64-bit and this alternative as 32-bit?  Of course this \"reduced basis\" is in no way canonical.",
    "created_at": "2018-01-12T14:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93437",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:24'>Comment 24:</a>
Would it be OK to tag the current output as 64-bit and this alternative as 32-bit?  Of course this "reduced basis" is in no way canonical.



---

archive/issue_comments_093438.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nlet me check if the `prec` argument makes a difference.",
    "created_at": "2018-01-12T14:18:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93438",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>Comment 25:</a>
let me check if the `prec` argument makes a difference.



---

archive/issue_comments_093439.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nOn 64-bit, the output stabilizes for `prec >= 117`; the result it\n\n```\n[x - 1,\n x^2 - x + 1,\n x^6 + 3*x^5 - 102*x^4 - 103*x^3 + 10572*x^2 - 59919*x + 127657,\n x^6 - 3*x^5 - 102*x^4 + 315*x^3 + 10254*x^2 - 80955*x + 198147,\n x^3 - 171*x + 848,\n x^6 + 171*x^4 + 1696*x^3 + 29241*x^2 + 145008*x + 719104]\n```",
    "created_at": "2018-01-12T14:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93439",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'>Comment 26:</a>
On 64-bit, the output stabilizes for `prec >= 117`; the result it

```
[x - 1,
 x^2 - x + 1,
 x^6 + 3*x^5 - 102*x^4 - 103*x^3 + 10572*x^2 - 59919*x + 127657,
 x^6 - 3*x^5 - 102*x^4 + 315*x^3 + 10254*x^2 - 80955*x + 198147,
 x^3 - 171*x + 848,
 x^6 + 171*x^4 + 1696*x^3 + 29241*x^2 + 145008*x + 719104]
```



---

archive/issue_comments_093440.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nThat's a lot better -- can you check if it's the same on 32-bit using the same prec (say 120)?",
    "created_at": "2018-01-12T14:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93440",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:27'>Comment 27:</a>
That's a lot better -- can you check if it's the same on 32-bit using the same prec (say 120)?



---

archive/issue_comments_093441.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nYes, on 32-bit I get the same result for `prec >= 68`.\n\nSo the best solution is increasing the `prec` in the doctest. While you're at it, could you please replace `k = NumberField(...,'a')` by `k.<a> = NumberField(...)`?",
    "created_at": "2018-01-12T14:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93441",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>Comment 28:</a>
Yes, on 32-bit I get the same result for `prec >= 68`.

So the best solution is increasing the `prec` in the doctest. While you're at it, could you please replace `k = NumberField(...,'a')` by `k.<a> = NumberField(...)`?



---

archive/issue_comments_093442.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22746f8e5bd59a1f1f53189dc8e8281cc83933c4\">22746f8</a></td><td><code>#10017: adjust doctest for 32-bit</code></td></tr></table>\n",
    "created_at": "2018-01-16T14:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93442",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22746f8e5bd59a1f1f53189dc8e8281cc83933c4">22746f8</a></td><td><code>#10017: adjust doctest for 32-bit</code></td></tr></table>




---

archive/issue_comments_093443.json:
```json
{
    "body": "Changed commit from **[39fc227](https://github.com/sagemath/sagetrac-mirror/commit/39fc2278ce182b46715ffd4fb2071178a4c11092)** to **[22746f8](https://github.com/sagemath/sagetrac-mirror/commit/22746f8e5bd59a1f1f53189dc8e8281cc83933c4)**",
    "created_at": "2018-01-16T14:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93443",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[39fc227](https://github.com/sagemath/sagetrac-mirror/commit/39fc2278ce182b46715ffd4fb2071178a4c11092)** to **[22746f8](https://github.com/sagemath/sagetrac-mirror/commit/22746f8e5bd59a1f1f53189dc8e8281cc83933c4)**



---

archive/issue_events_119136.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2018-01-16T14:33:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119136"
}
```



---

archive/issue_events_119137.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2018-01-16T14:33:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119137"
}
```



---

archive/issue_comments_093444.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nApologies for the delay -- I pushed to u/cremona/20017 by mistake 4 days ago.  It's now where it should be.",
    "created_at": "2018-01-16T14:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93444",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:30'>Comment 30:</a>
Apologies for the delay -- I pushed to u/cremona/20017 by mistake 4 days ago.  It's now where it should be.



---

archive/issue_comments_093445.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nOK, looks good but let's wait for the patchbot.",
    "created_at": "2018-01-16T14:36:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93445",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>Comment 31:</a>
OK, looks good but let's wait for the patchbot.



---

archive/issue_events_119138.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-18T09:59:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119138"
}
```



---

archive/issue_events_119139.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-18T09:59:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119139"
}
```



---

archive/issue_comments_093446.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nSorry to say this, but the branch doesn't merge cleanly...",
    "created_at": "2018-01-18T09:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93446",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'>Comment 32:</a>
Sorry to say this, but the branch doesn't merge cleanly...



---

archive/issue_comments_093447.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@jdemeyer](#comment%3A32):\n> Sorry to say this, but the branch doesn't merge cleanly...\n\nNot your fault!  I am just building the latest beta and will merge it with my branch shortly.",
    "created_at": "2018-01-18T11:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93447",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@jdemeyer](#comment%3A32):
> Sorry to say this, but the branch doesn't merge cleanly...

Not your fault!  I am just building the latest beta and will merge it with my branch shortly.



---

archive/issue_comments_093448.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f56a7e822ec2b1116bf3c80294af3a8d07b88c67\">f56a7e8</a></td><td><code>Merge branch 'develop' into 10017</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f1f51d83fc198a31683740001bcffe9a3d30bbc\">8f1f51d</a></td><td><code>#10017: fix deprecation warning for Minkowski_embedding</code></td></tr></table>\n",
    "created_at": "2018-01-18T16:11:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93448",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:34'>Comment 34:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f56a7e822ec2b1116bf3c80294af3a8d07b88c67">f56a7e8</a></td><td><code>Merge branch 'develop' into 10017</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f1f51d83fc198a31683740001bcffe9a3d30bbc">8f1f51d</a></td><td><code>#10017: fix deprecation warning for Minkowski_embedding</code></td></tr></table>




---

archive/issue_comments_093449.json:
```json
{
    "body": "Changed commit from **[22746f8](https://github.com/sagemath/sagetrac-mirror/commit/22746f8e5bd59a1f1f53189dc8e8281cc83933c4)** to **[8f1f51d](https://github.com/sagemath/sagetrac-mirror/commit/8f1f51d83fc198a31683740001bcffe9a3d30bbc)**",
    "created_at": "2018-01-18T16:11:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93449",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[22746f8](https://github.com/sagemath/sagetrac-mirror/commit/22746f8e5bd59a1f1f53189dc8e8281cc83933c4)** to **[8f1f51d](https://github.com/sagemath/sagetrac-mirror/commit/8f1f51d83fc198a31683740001bcffe9a3d30bbc)**



---

archive/issue_events_119140.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2018-01-18T16:12:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119140"
}
```



---

archive/issue_events_119141.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2018-01-18T16:12:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119141"
}
```



---

archive/issue_comments_093450.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nOK, I merged, fixed the small conflict and a deprecation warning.  Let's see if the patchbots like this one better.",
    "created_at": "2018-01-18T16:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93450",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:35'>Comment 35:</a>
OK, I merged, fixed the small conflict and a deprecation warning.  Let's see if the patchbots like this one better.



---

archive/issue_events_119142.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-18T21:14:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119142"
}
```



---

archive/issue_events_119143.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-18T21:14:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119143"
}
```



---

archive/issue_events_119144.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-20T20:20:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119144"
}
```



---

archive/issue_events_119145.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "03e2e86cb252195e1b410473b808ec374d98cfb9",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-20T20:20:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10017#event-119145"
}
```



---

archive/issue_comments_093451.json:
```json
{
    "body": "Changed branch from **[u/cremona/10017](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/10017)** to **[8f1f51d](https://github.com/sagemath/sagetrac-mirror/commit/8f1f51d83fc198a31683740001bcffe9a3d30bbc)**",
    "created_at": "2018-01-20T20:20:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10017#issuecomment-93451",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/cremona/10017](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/10017)** to **[8f1f51d](https://github.com/sagemath/sagetrac-mirror/commit/8f1f51d83fc198a31683740001bcffe9a3d30bbc)**
