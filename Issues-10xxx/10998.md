# Issue 10998: Categories for posets

archive/issues_010913.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-sage-combinat"
    ],
    "body": "This patch creates categories for posets and lattices, refactors the\nposet code, and adds new features. See the header of the patch for a\ncomplete description.\n\nApply: [attachment: trac_10998-categories-posets-nt.patch](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-nt.patch.gz)\n\nApply on sagenb repo: [attachment: trac_10998-categories-posets-sagenb-nt.patch](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-sagenb-nt.patch.gz)\n\n\nDepends on #8288\nDepends on #10651\nDepends on #11289\nDepends on #10938\nDepends on #9065\n\nCC:  @sagetrac-sage-combinat @nilesjohnson @novoselt @vbraun\n\nKeywords: **days30, sd31, Cernay2012**\n\nComponent: **combinatorics**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton, Christian Stump, Nicolas M. Thi\u00e9ry**\n\nReviewer: **Franco Saliola, Christian Stump, Nicolas M. Thi\u00e9ry, Florent Hivert**\n\nMerged: **sage-5.0.beta4**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10998_\n\n",
    "closed_at": "2012-02-14T14:19:48Z",
    "created_at": "2011-03-23T16:05:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Categories for posets",
    "type": "issue",
    "updated_at": "2012-02-14T14:19:48Z",
    "url": "https://github.com/sagemath/sage/issues/10998",
    "user": "https://github.com/nthiery"
}
```
This patch creates categories for posets and lattices, refactors the
poset code, and adds new features. See the header of the patch for a
complete description.

Apply: [attachment: trac_10998-categories-posets-nt.patch](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-nt.patch.gz)

Apply on sagenb repo: [attachment: trac_10998-categories-posets-sagenb-nt.patch](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-sagenb-nt.patch.gz)


Depends on #8288
Depends on #10651
Depends on #11289
Depends on #10938
Depends on #9065

CC:  @sagetrac-sage-combinat @nilesjohnson @novoselt @vbraun

Keywords: **days30, sd31, Cernay2012**

Component: **combinatorics**

Author: **Frédéric Chapoton, Christian Stump, Nicolas M. Thiéry**

Reviewer: **Franco Saliola, Christian Stump, Nicolas M. Thiéry, Florent Hivert**

Merged: **sage-5.0.beta4**

_Issue created by migration from https://trac.sagemath.org/ticket/10998_





---

archive/issue_events_146666.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-03-23T16:05:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146666"
}
```



---

archive/issue_events_146667.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-03-23T16:05:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146667"
}
```



---

archive/issue_events_146668.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-03-23T16:05:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146668"
}
```



---

archive/issue_events_146669.json:
```json
{
    "actor": "https://github.com/sagetrac-sage-combinat",
    "created_at": "2011-03-23T16:05:57Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "subject": "https://github.com/nthiery",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146669"
}
```



---

archive/issue_comments_108258.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n poset code, and add new features. It is under finalization on the\n Sage-Combinat server:\n \n-http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/categories-posets-nt.patch\n+http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch\n \n See the header there for a current description.\n \n``````\n",
    "created_at": "2011-03-23T16:07:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108258",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 poset code, and add new features. It is under finalization on the
 Sage-Combinat server:
 
-http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/categories-posets-nt.patch
+http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch
 
 See the header there for a current description.
 
``````




---

archive/issue_events_146670.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-03-23T16:07:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146670"
}
```



---

archive/issue_events_146671.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-03-28T14:28:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146671"
}
```



---

archive/issue_comments_108259.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,5 @@\n This patch creates categories for posets and lattices, refactors the\n-poset code, and add new features. It is under finalization on the\n-Sage-Combinat server:\n+poset code, and add new features. It is available on the Sage-Combinat server:\n \n http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch\n \n``````\n",
    "created_at": "2011-03-28T14:28:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108259",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,5 @@
 This patch creates categories for posets and lattices, refactors the
-poset code, and add new features. It is under finalization on the
-Sage-Combinat server:
+poset code, and add new features. It is available on the Sage-Combinat server:
 
 http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch
 
``````




---

archive/issue_comments_108260.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,4 @@\n \n See the header there for a current description.\n \n+Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest)\n``````\n",
    "created_at": "2011-03-28T14:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108260",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,4 @@
 
 See the header there for a current description.
 
+Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest)
``````




---

archive/issue_comments_108261.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,9 @@\n This patch creates categories for posets and lattices, refactors the\n-poset code, and add new features. It is available on the Sage-Combinat server:\n+poset code, and add new features. See the header of the patch for a complete description.\n \n-http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch\n+Note: this patch is probably going to be reviewed on the Sage-Combinat server; please see there for the very latest version:\n \n-See the header there for a current description.\n+[http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch](http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch)\n+\n \n Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest)\n``````\n",
    "created_at": "2011-03-28T15:02:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108261",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,9 @@
 This patch creates categories for posets and lattices, refactors the
-poset code, and add new features. It is available on the Sage-Combinat server:
+poset code, and add new features. See the header of the patch for a complete description.
 
-http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch
+Note: this patch is probably going to be reviewed on the Sage-Combinat server; please see there for the very latest version:
 
-See the header there for a current description.
+[http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch](http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch)
+
 
 Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest)
``````




---

archive/issue_comments_108262.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nFixed trivial non commutation with trac_10193-graded_enumerated_sets-nt.patch in the Sage-Combinat queue. In principle the patch should now apply on vanilla sage + listed dependencies.",
    "created_at": "2011-04-04T22:08:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108262",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:6" align="right">comment:6</div>

Fixed trivial non commutation with trac_10193-graded_enumerated_sets-nt.patch in the Sage-Combinat queue. In principle the patch should now apply on vanilla sage + listed dependencies.



---

archive/issue_comments_108263.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSalut Nicolas,\n\nI must say: there is a lot of code where I don't really understand what you do, and why you do it. E.g., which code is generic enough to put in categories and which is not, how are examples organized, how do you properly test the code, ...\n\nIn my (not yet final) review patch, I place some questions on implementations, some suggestions for additional methods, and I fixed several typos.\n\nBest, Christian",
    "created_at": "2011-04-05T14:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108263",
    "user": "https://github.com/stumpc5"
}
```

<div id="comment:7" align="right">comment:7</div>

Salut Nicolas,

I must say: there is a lot of code where I don't really understand what you do, and why you do it. E.g., which code is generic enough to put in categories and which is not, how are examples organized, how do you properly test the code, ...

In my (not yet final) review patch, I place some questions on implementations, some suggestions for additional methods, and I fixed several typos.

Best, Christian



---

archive/issue_comments_108264.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@stumpc5](#comment:7):\n\n> I must say: there is a lot of code where I don't really understand\n> what you do, and why you do it.\n\nHmm, more specific questions (like the one below) would be useful to\nget a constructive discussion :-)\n\n> E.g., which code is generic enough to put in categories and which is\n> not,\n\nThe rule of thumb is: does the code use the data structure or not?\nFor example, a method like has_top uses the internal hasse diagram,\nand therefore remains in Poset. On the other hand a method like\njoin_irreducibles just requires that there is a method \"lower_covers\",\nand so can be implemented generically in the category.\n\nBut that's just a rule thumb; I left in Poset all the code that was on\nthe edge, so as to avoid moving too much code around.\n\n> how are examples organized, how do you properly test the code, ...\n\nAre those questions about the category framework in general, or about\nthis specific patch?\n\n> In my (not yet final) review patch, I place some questions on\n> implementations, some suggestions for additional methods, and I\n> fixed several typos.\n\nOk, thanks!\n\nCheers,\n                       Nicolas",
    "created_at": "2011-04-05T15:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108264",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@stumpc5](#comment:7):

> I must say: there is a lot of code where I don't really understand
> what you do, and why you do it.

Hmm, more specific questions (like the one below) would be useful to
get a constructive discussion :-)

> E.g., which code is generic enough to put in categories and which is
> not,

The rule of thumb is: does the code use the data structure or not?
For example, a method like has_top uses the internal hasse diagram,
and therefore remains in Poset. On the other hand a method like
join_irreducibles just requires that there is a method "lower_covers",
and so can be implemented generically in the category.

But that's just a rule thumb; I left in Poset all the code that was on
the edge, so as to avoid moving too much code around.

> how are examples organized, how do you properly test the code, ...

Are those questions about the category framework in general, or about
this specific patch?

> In my (not yet final) review patch, I place some questions on
> implementations, some suggestions for additional methods, and I
> fixed several typos.

Ok, thanks!

Cheers,
                       Nicolas



---

archive/issue_comments_108265.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,6 @@\n \n Note: this patch is probably going to be reviewed on the Sage-Combinat server; please see there for the very latest version:\n \n-[http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch](http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch)\n-\n+Apply: trac_10998-categories-posets-nt.patch\n \n Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest)\n``````\n",
    "created_at": "2011-04-21T21:13:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108265",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,6 @@
 
 Note: this patch is probably going to be reviewed on the Sage-Combinat server; please see there for the very latest version:
 
-[http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch](http://combinat.sagemath.org/patches/file/tip/trac_10998-categories-posets-nt.patch)
-
+Apply: trac_10998-categories-posets-nt.patch
 
 Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest)
``````




---

archive/issue_comments_108266.json:
```json
{
    "body": "Reviewer: **Franco Saliola, Christian Stump, Nicolas M. Thi\u00e9ry**",
    "created_at": "2011-04-21T21:13:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108266",
    "user": "https://github.com/nthiery"
}
```

Reviewer: **Franco Saliola, Christian Stump, Nicolas M. Thiéry**



---

archive/issue_events_146672.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-04-21T21:13:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146672"
}
```



---

archive/issue_events_146673.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-04-21T21:13:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146673"
}
```



---

archive/issue_comments_108267.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nApply only trac_10998-categories-posets-nt.patch",
    "created_at": "2011-04-22T15:27:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108267",
    "user": "https://github.com/stumpc5"
}
```

<div id="comment:10" align="right">comment:10</div>

Apply only trac_10998-categories-posets-nt.patch



---

archive/issue_comments_108268.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThere where a few bad sphinx markup. I just pushed a review patch on sage-combinat queue. I let you decide if you want to fold it or upload it. \n\nCheers,\n\nFlorent",
    "created_at": "2011-04-22T22:14:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108268",
    "user": "https://github.com/hivert"
}
```

<div id="comment:11" align="right">comment:11</div>

There where a few bad sphinx markup. I just pushed a review patch on sage-combinat queue. I let you decide if you want to fold it or upload it. 

Cheers,

Florent



---

archive/issue_comments_108269.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nFolded; thanks!",
    "created_at": "2011-04-23T02:15:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108269",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:12" align="right">comment:12</div>

Folded; thanks!



---

archive/issue_comments_108270.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nFixed failing test.",
    "created_at": "2011-04-23T02:43:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108270",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:13" align="right">comment:13</div>

Fixed failing test.



---

archive/issue_comments_108271.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!",
    "created_at": "2011-04-23T03:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108271",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:14" align="right">comment:14</div>

Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!



---

archive/issue_comments_108272.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@nthiery](#comment:14):\n> Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!\n\nI also just spotted a few more wrong sphinx markup ! I'm fixing those.",
    "created_at": "2011-04-23T12:30:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108272",
    "user": "https://github.com/hivert"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@nthiery](#comment:14):
> Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!

I also just spotted a few more wrong sphinx markup ! I'm fixing those.



---

archive/issue_comments_108273.json:
```json
{
    "body": "Changed reviewer from **Franco Saliola, Christian Stump, Nicolas M. Thi\u00e9ry** to **Franco Saliola, Christian Stump, Nicolas M. Thi\u00e9ry, Florent Hivert**",
    "created_at": "2011-04-23T12:30:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108273",
    "user": "https://github.com/hivert"
}
```

Changed reviewer from **Franco Saliola, Christian Stump, Nicolas M. Thiéry** to **Franco Saliola, Christian Stump, Nicolas M. Thiéry, Florent Hivert**



---

archive/issue_comments_108274.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@hivert](#comment:15):\n> Replying to [@nthiery](#comment:14):\n> > Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!\n\n> \n> I also just spotted a few more wrong sphinx markup ! I'm fixing those.\n\nPlease see my new review patch on sage-combinat queue `trac_10998-categories-posets-docfix-fh.patch`",
    "created_at": "2011-04-23T13:30:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108274",
    "user": "https://github.com/hivert"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@hivert](#comment:15):
> Replying to [@nthiery](#comment:14):
> > Hmm, there are a couple more trivial ones. I'll work on those on Monday unless someone beats me to it!

> 
> I also just spotted a few more wrong sphinx markup ! I'm fixing those.

Please see my new review patch on sage-combinat queue `trac_10998-categories-posets-docfix-fh.patch`



---

archive/issue_events_146674.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2011-05-05T01:37:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146674"
}
```



---

archive/issue_events_146675.json:
```json
{
    "actor": "https://github.com/saliola",
    "created_at": "2011-05-05T01:37:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146675"
}
```



---

archive/issue_comments_108275.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI started with a fresh install of sage-4.7.rc1 and applied the patches at #9065 and #10938, followed by the patch for this ticket on the sage-combinat queue. I get a the following doctest failures.\n\n```\nThe following tests failed:\n \n        sage -t  devel/sage-trac/sage/geometry/fan_morphism.py # 25 doctests failed                                    \n        sage -t  devel/sage-trac/sage/geometry/fan.py # 4 doctests failed\n        sage -t  devel/sage-trac/sage/schemes/generic/toric_variety.py # 1 doctests failed\n        sage -t  devel/sage-trac/sage/schemes/generic/toric_divisor.py # 3 doctests failed\n        sage -t  devel/sage-trac/sage/schemes/generic/toric_chow_group.py # 10 doctests failed\n        sage -t  devel/sage-trac/sage/structure/sage_object.pyx # 1 doctests failed\n```\nI verified that they are not caused by the other patches. (I also get these errors on 4.6.2 with the sage-combinat patches applied.)\n\nI don't understand the problem. If you copy and paste the offending doctests into the sage command-line, I don't get the errors reported by the doctest system. Any ideas?",
    "created_at": "2011-05-05T01:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108275",
    "user": "https://github.com/saliola"
}
```

<div id="comment:17" align="right">comment:17</div>

I started with a fresh install of sage-4.7.rc1 and applied the patches at #9065 and #10938, followed by the patch for this ticket on the sage-combinat queue. I get a the following doctest failures.

```
The following tests failed:
 
        sage -t  devel/sage-trac/sage/geometry/fan_morphism.py # 25 doctests failed                                    
        sage -t  devel/sage-trac/sage/geometry/fan.py # 4 doctests failed
        sage -t  devel/sage-trac/sage/schemes/generic/toric_variety.py # 1 doctests failed
        sage -t  devel/sage-trac/sage/schemes/generic/toric_divisor.py # 3 doctests failed
        sage -t  devel/sage-trac/sage/schemes/generic/toric_chow_group.py # 10 doctests failed
        sage -t  devel/sage-trac/sage/structure/sage_object.pyx # 1 doctests failed
```
I verified that they are not caused by the other patches. (I also get these errors on 4.6.2 with the sage-combinat patches applied.)

I don't understand the problem. If you copy and paste the offending doctests into the sage command-line, I don't get the errors reported by the doctest system. Any ideas?



---

archive/issue_comments_108276.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOh right, I had forgotten about those. I tried a bit to find the problem, but to not avail yet.\n\nAndrey, would you have any clue?",
    "created_at": "2011-05-05T02:11:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108276",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:18" align="right">comment:18</div>

Oh right, I had forgotten about those. I tried a bit to find the problem, but to not avail yet.

Andrey, would you have any clue?



---

archive/issue_comments_108277.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHi Nicolas, thanks for ccing me!\n\nGiven that the problem is not reproducible in the command line, I am not exactly sure how to attack it, but we probably need to focus on the failing doctest in `fan.py`.\n\nThe problem as shown by the doctest framework is that cones which are supposed to know that they sit inside a fan appear to be \"standalone\" and breaking this relation messes up everything that builds up on top of it.\n\nI'll try to trace it down further, but it may take me a few days due to traveling and conferencing...",
    "created_at": "2011-05-05T05:04:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108277",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:19" align="right">comment:19</div>

Hi Nicolas, thanks for ccing me!

Given that the problem is not reproducible in the command line, I am not exactly sure how to attack it, but we probably need to focus on the failing doctest in `fan.py`.

The problem as shown by the doctest framework is that cones which are supposed to know that they sit inside a fan appear to be "standalone" and breaking this relation messes up everything that builds up on top of it.

I'll try to trace it down further, but it may take me a few days due to traveling and conferencing...



---

archive/issue_comments_108278.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@novoselt](#comment:19):\n> Hi Nicolas, thanks for ccing me!\n> \n> Given that the problem is not reproducible in the command line, I am not exactly sure how to attack it, but we probably need to focus on the failing doctest in `fan.py`.\n> \n> The problem as shown by the doctest framework is that cones which are supposed to know that they sit inside a fan appear to be \"standalone\" and breaking this relation messes up everything that builds up on top of it.\n> \n> I'll try to trace it down further, but it may take me a few days due to traveling and conferencing...\n\nThanks!\n\nFor the record: finite posets and their elements, now have UniqueRepresentation. This could have an influence if the same poset is created several times when constructing several fans.",
    "created_at": "2011-05-05T05:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108278",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@novoselt](#comment:19):
> Hi Nicolas, thanks for ccing me!
> 
> Given that the problem is not reproducible in the command line, I am not exactly sure how to attack it, but we probably need to focus on the failing doctest in `fan.py`.
> 
> The problem as shown by the doctest framework is that cones which are supposed to know that they sit inside a fan appear to be "standalone" and breaking this relation messes up everything that builds up on top of it.
> 
> I'll try to trace it down further, but it may take me a few days due to traveling and conferencing...

Thanks!

For the record: finite posets and their elements, now have UniqueRepresentation. This could have an influence if the same poset is created several times when constructing several fans.



---

archive/issue_comments_108279.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@nthiery](#comment:20):\n> For the record: finite posets and their elements, now have UniqueRepresentation. This could have an influence if the same poset is created several times when constructing several fans.\n\nYes, this is it. Repeating the failing code twice in the command line reproduced the error. This raises two questions:\n1) Out of curiosity: Why does it show up in doctests? Shouldn't the state of Sage be clean before running a new test?\n2) To the point: How to fix it?\n\nI really don't want to make fans unique at this point as I am planning some adjustments to them and related objects.\n\nDoes uniqueness test rely on `==` test? Is there any way to change it? Currently `==` for fans checks that fans have the same rays and the same generating cones in the same order. Things relates to facets require even stronger `is`-equivalence. On the other hand, Volker votes for `==` being mathematical equivalence without taking order into account. Such equivalence definitely would not be acceptable deep inside implementation which relies on fixed order.\n\nSo I guess my preferred solution for now would be to trick posets into creating different face lattices for fans and cones even if they are `==`. Can I somehow attach `id(fan)` to the poset without altering its structure?..",
    "created_at": "2011-05-05T05:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108279",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@nthiery](#comment:20):
> For the record: finite posets and their elements, now have UniqueRepresentation. This could have an influence if the same poset is created several times when constructing several fans.

Yes, this is it. Repeating the failing code twice in the command line reproduced the error. This raises two questions:
1) Out of curiosity: Why does it show up in doctests? Shouldn't the state of Sage be clean before running a new test?
2) To the point: How to fix it?

I really don't want to make fans unique at this point as I am planning some adjustments to them and related objects.

Does uniqueness test rely on `==` test? Is there any way to change it? Currently `==` for fans checks that fans have the same rays and the same generating cones in the same order. Things relates to facets require even stronger `is`-equivalence. On the other hand, Volker votes for `==` being mathematical equivalence without taking order into account. Such equivalence definitely would not be acceptable deep inside implementation which relies on fixed order.

So I guess my preferred solution for now would be to trick posets into creating different face lattices for fans and cones even if they are `==`. Can I somehow attach `id(fan)` to the poset without altering its structure?..



---

archive/issue_comments_108280.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nHere is a reviewer patch. This applies on top of the latest version of Nicolas's patch that can be found on the sage-combinat queue. These are mostly documentation fixes.\n\nWith the exception of the issue highlighted above, I give a positive review to the changes.\n\n- someone needs to review my patch\n- someone needs to post a patch addressing the broken doctests",
    "created_at": "2011-05-05T16:32:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108280",
    "user": "https://github.com/saliola"
}
```

<div id="comment:22" align="right">comment:22</div>

Here is a reviewer patch. This applies on top of the latest version of Nicolas's patch that can be found on the sage-combinat queue. These are mostly documentation fixes.

With the exception of the issue highlighted above, I give a positive review to the changes.

- someone needs to review my patch
- someone needs to post a patch addressing the broken doctests



---

archive/issue_comments_108281.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI made sure that the patches (on the sage-combinat queue) apply on top of Rob Beezer's recent patches surrounding posets (ticket numbers #11289, #11293, #11292). There was a slight conflict with #11289, so this patch now depends on #11289. I updated the description accordingly.",
    "created_at": "2011-05-05T18:30:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108281",
    "user": "https://github.com/saliola"
}
```

<div id="comment:23" align="right">comment:23</div>

I made sure that the patches (on the sage-combinat queue) apply on top of Rob Beezer's recent patches surrounding posets (ticket numbers #11289, #11293, #11292). There was a slight conflict with #11289, so this patch now depends on #11289. I updated the description accordingly.



---

archive/issue_comments_108282.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,4 +5,4 @@\n \n Apply: trac_10998-categories-posets-nt.patch\n \n-Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest)\n+Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest), #11289 (Random posets, documentation and error-checking)\n``````\n",
    "created_at": "2011-05-05T18:30:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108282",
    "user": "https://github.com/saliola"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,4 +5,4 @@
 
 Apply: trac_10998-categories-posets-nt.patch
 
-Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest)
+Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest), #11289 (Random posets, documentation and error-checking)
``````




---

archive/issue_comments_108283.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nMy previous comment refers to the patches on the sage-combinat queue.",
    "created_at": "2011-05-05T18:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108283",
    "user": "https://github.com/saliola"
}
```

<div id="comment:24" align="right">comment:24</div>

My previous comment refers to the patches on the sage-combinat queue.



---

archive/issue_comments_108284.json:
```json
{
    "body": "Changed keywords from none to **days30**",
    "created_at": "2011-05-10T14:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108284",
    "user": "https://github.com/nthiery"
}
```

Changed keywords from none to **days30**



---

archive/issue_comments_108285.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nTrying to help the buildbot to do its job\n\nApply trac_10998-categories-posets-nt.patch\nApply trac_10998-review-fs.patch",
    "created_at": "2011-06-10T07:57:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108285",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:26" align="right">comment:26</div>

Trying to help the buildbot to do its job

Apply trac_10998-categories-posets-nt.patch
Apply trac_10998-review-fs.patch



---

archive/issue_comments_108286.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\ntry again\n\nApply trac_10998-categories-posets-nt.patch trac_10998-review-fs.patch",
    "created_at": "2011-06-10T08:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108286",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:27" align="right">comment:27</div>

try again

Apply trac_10998-categories-posets-nt.patch trac_10998-review-fs.patch



---

archive/issue_comments_108287.json:
```json
{
    "body": "Dependencies: **#11289, #10938, #9065**",
    "created_at": "2011-06-10T19:10:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108287",
    "user": "https://github.com/fchapoton"
}
```

Dependencies: **#11289, #10938, #9065**



---

archive/issue_comments_108288.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\ntrying to help the bot again\n\nApply trac_10998-categories-posets-nt.patch trac_10998-review-fs.patch",
    "created_at": "2011-06-10T19:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108288",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:29" align="right">comment:29</div>

trying to help the bot again

Apply trac_10998-categories-posets-nt.patch trac_10998-review-fs.patch



---

archive/issue_comments_108289.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nok, the bot has found a HUNK problem in poset_examples.py \n\nCould somebody solve that ?",
    "created_at": "2011-06-10T20:51:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108289",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:30" align="right">comment:30</div>

ok, the bot has found a HUNK problem in poset_examples.py 

Could somebody solve that ?



---

archive/issue_comments_108290.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@fchapoton](#comment:30):\n> ok, the bot has found a HUNK problem in poset_examples.py \n> \n> Could somebody solve that ?\n\nDone! There just remains the cone issue.",
    "created_at": "2011-06-14T10:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108290",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@fchapoton](#comment:30):
> ok, the bot has found a HUNK problem in poset_examples.py 
> 
> Could somebody solve that ?

Done! There just remains the cone issue.



---

archive/issue_comments_108291.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nBtw: I reviewed and folded in Franco's reviewer's patch. Thanks Franco!",
    "created_at": "2011-06-14T10:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108291",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:32" align="right">comment:32</div>

Btw: I reviewed and folded in Franco's reviewer's patch. Thanks Franco!



---

archive/issue_comments_108292.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nHi Andrei,\n\nReplying to [@novoselt](#comment:21):\n> 2) To the point: How to fix it?\n> \n> I really don't want to make fans unique at this point as I am planning some adjustments to them and related objects.\n> \n> Does uniqueness test rely on `==` test? Is there any way to change it? Currently `==` for fans checks that fans have the same rays and the same generating cones in the same order. Things relates to facets require even stronger `is`-equivalence. On the other hand, Volker votes for `==` being mathematical equivalence without taking order into account. Such equivalence definitely would not be acceptable deep inside implementation which relies on fixed order.\n> \n> So I guess my preferred solution for now would be to trick posets into creating different face lattices for fans and cones even if they are `==`. Can I somehow attach `id(fan)` to the poset without altering its structure?..\n\nI have (finally!) just looked at this again. I traced through the execution of `f.cone_containing(0)`, and did not find the place where the construction of the cone (and in particular its unique representation or not) depended on a poset. Could you give me a pointer? Or ideally, a minimal example where two cones are constructed involving the same poset, and where the cones should be different (but are not with this patch)?\n\nWe are both at FPSAC with Franco; it would be great if we could finish this patch today or tomorrow.\n\nThanks!",
    "created_at": "2011-06-14T11:12:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108292",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:33" align="right">comment:33</div>

Hi Andrei,

Replying to [@novoselt](#comment:21):
> 2) To the point: How to fix it?
> 
> I really don't want to make fans unique at this point as I am planning some adjustments to them and related objects.
> 
> Does uniqueness test rely on `==` test? Is there any way to change it? Currently `==` for fans checks that fans have the same rays and the same generating cones in the same order. Things relates to facets require even stronger `is`-equivalence. On the other hand, Volker votes for `==` being mathematical equivalence without taking order into account. Such equivalence definitely would not be acceptable deep inside implementation which relies on fixed order.
> 
> So I guess my preferred solution for now would be to trick posets into creating different face lattices for fans and cones even if they are `==`. Can I somehow attach `id(fan)` to the poset without altering its structure?..

I have (finally!) just looked at this again. I traced through the execution of `f.cone_containing(0)`, and did not find the place where the construction of the cone (and in particular its unique representation or not) depended on a poset. Could you give me a pointer? Or ideally, a minimal example where two cones are constructed involving the same poset, and where the cones should be different (but are not with this patch)?

We are both at FPSAC with Franco; it would be great if we could finish this patch today or tomorrow.

Thanks!



---

archive/issue_comments_108293.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nHi Nicolas!\n\nWith the patch:\n\n```\nsage: F1 = FaceFan(lattice_polytope.octahedron(3))\nsage: F2 = FaceFan(lattice_polytope.octahedron(3))\nsage: F1 == F2\nTrue\nsage: F1 is F2\nFalse\nsage: F1(2)[0]\n2-d cone of Rational polyhedral fan in 3-d lattice N\nsage: F1(2)[0].ambient() is F1\nTrue\nsage: F2(2)[0].ambient() is F2\nFalse\n```\n\nThe last command is heavily assumed to return True in the toric-related code. The problem is that when the cone lattice of `F2` is constructed, it is considered as the same poset as the cone lattice of `F1` and so all cones of `F2` become linked to `F1`. Possible solutions are:\n* Make cone lattices of fans which are \"==\" but not \"is\" distinct. This should fix the issue without any complications as it will basically restore the current state.\n* Make \"==\" and \"is\" comparisons the same for fans. I think that this is undesirable as there are arguments for making \"==\" be the mathematical equivalence, which is even weaker than the current behaviour.\n* Make fans unique based on the ordered list of rays and cone generators. This should fix the issue but may have consequences. Also, while in general unique fans may be good, it would be nice to still have a possibility to make \"==\" the mathematical equivalence and IMHO it would be absolutely terrible for performance and convenience of use if uniqueness of fans was based on their mathematical equivalence. \n\nNote: I'd rather not make cones unique based on the ordered list of rays as I want to have a possibility to create different cones with the same order of rays but different order of facet normals. This is not currently implemented but would be extremely convenient for handling all kinds of dualities and correspondences.\n\nSo, in short, I prefer to be able to create different posets of cones for fans which are \"==\".\n\nThank you,\nAndrey",
    "created_at": "2011-06-14T17:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108293",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:34" align="right">comment:34</div>

Hi Nicolas!

With the patch:

```
sage: F1 = FaceFan(lattice_polytope.octahedron(3))
sage: F2 = FaceFan(lattice_polytope.octahedron(3))
sage: F1 == F2
True
sage: F1 is F2
False
sage: F1(2)[0]
2-d cone of Rational polyhedral fan in 3-d lattice N
sage: F1(2)[0].ambient() is F1
True
sage: F2(2)[0].ambient() is F2
False
```

The last command is heavily assumed to return True in the toric-related code. The problem is that when the cone lattice of `F2` is constructed, it is considered as the same poset as the cone lattice of `F1` and so all cones of `F2` become linked to `F1`. Possible solutions are:
* Make cone lattices of fans which are "==" but not "is" distinct. This should fix the issue without any complications as it will basically restore the current state.
* Make "==" and "is" comparisons the same for fans. I think that this is undesirable as there are arguments for making "==" be the mathematical equivalence, which is even weaker than the current behaviour.
* Make fans unique based on the ordered list of rays and cone generators. This should fix the issue but may have consequences. Also, while in general unique fans may be good, it would be nice to still have a possibility to make "==" the mathematical equivalence and IMHO it would be absolutely terrible for performance and convenience of use if uniqueness of fans was based on their mathematical equivalence. 

Note: I'd rather not make cones unique based on the ordered list of rays as I want to have a possibility to create different cones with the same order of rays but different order of facet normals. This is not currently implemented but would be extremely convenient for handling all kinds of dualities and correspondences.

So, in short, I prefer to be able to create different posets of cones for fans which are "==".

Thank you,
Andrey



---

archive/issue_comments_108294.json:
```json
{
    "body": "Changed keywords from **days30** to **days30, sd31**",
    "created_at": "2011-06-14T17:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108294",
    "user": "https://github.com/novoselt"
}
```

Changed keywords from **days30** to **days30, sd31**



---

archive/issue_comments_108295.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@novoselt](#comment:34):\n> Hi Nicolas!\n> \n> With the patch:\n> \n> ```\n> sage: F1 = FaceFan(lattice_polytope.octahedron(3))\n> sage: F2 = FaceFan(lattice_polytope.octahedron(3))\n> sage: F1 == F2\n> True\n> sage: F1 is F2\n> False\n> sage: F1(2)[0]\n> 2-d cone of Rational polyhedral fan in 3-d lattice N\n> sage: F1(2)[0].ambient() is F1\n> True\n> sage: F2(2)[0].ambient() is F2\n> False\n> ```\n> \n> The last command is heavily assumed to return True in the toric-related code. The problem is that when the cone lattice of `F2` is constructed, it is considered as the same poset as the cone lattice of `F1` and so all cones of `F2` become linked to `F1`. Possible solutions are:\n> * Make cone lattices of fans which are \"==\" but not \"is\" distinct. This should fix the issue without any complications as it will basically restore the current state.\n> * Make \"==\" and \"is\" comparisons the same for fans. I think that this is undesirable as there are arguments for making \"==\" be the mathematical equivalence, which is even weaker than the current behaviour.\n> * Make fans unique based on the ordered list of rays and cone generators. This should fix the issue but may have consequences. Also, while in general unique fans may be good, it would be nice to still have a possibility to make \"==\" the mathematical equivalence and IMHO it would be absolutely terrible for performance and convenience of use if uniqueness of fans was based on their mathematical equivalence. \n> \n> Note: I'd rather not make cones unique based on the ordered list of rays as I want to have a possibility to create different cones with the same order of rays but different order of facet normals. This is not currently implemented but would be extremely convenient for handling all kinds of dualities and correspondences.\n> \n> So, in short, I prefer to be able to create different posets of cones for fans which are \"==\".\n\nThanks a lot! I'll look at this tonight.\n\nI am still confused a bit: do you know where technically in the cone code is there an ``==`` or ``is`` test done on some posets, which cause the change of behaviour above?",
    "created_at": "2011-06-14T17:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108295",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@novoselt](#comment:34):
> Hi Nicolas!
> 
> With the patch:
> 
> ```
> sage: F1 = FaceFan(lattice_polytope.octahedron(3))
> sage: F2 = FaceFan(lattice_polytope.octahedron(3))
> sage: F1 == F2
> True
> sage: F1 is F2
> False
> sage: F1(2)[0]
> 2-d cone of Rational polyhedral fan in 3-d lattice N
> sage: F1(2)[0].ambient() is F1
> True
> sage: F2(2)[0].ambient() is F2
> False
> ```
> 
> The last command is heavily assumed to return True in the toric-related code. The problem is that when the cone lattice of `F2` is constructed, it is considered as the same poset as the cone lattice of `F1` and so all cones of `F2` become linked to `F1`. Possible solutions are:
> * Make cone lattices of fans which are "==" but not "is" distinct. This should fix the issue without any complications as it will basically restore the current state.
> * Make "==" and "is" comparisons the same for fans. I think that this is undesirable as there are arguments for making "==" be the mathematical equivalence, which is even weaker than the current behaviour.
> * Make fans unique based on the ordered list of rays and cone generators. This should fix the issue but may have consequences. Also, while in general unique fans may be good, it would be nice to still have a possibility to make "==" the mathematical equivalence and IMHO it would be absolutely terrible for performance and convenience of use if uniqueness of fans was based on their mathematical equivalence. 
> 
> Note: I'd rather not make cones unique based on the ordered list of rays as I want to have a possibility to create different cones with the same order of rays but different order of facet normals. This is not currently implemented but would be extremely convenient for handling all kinds of dualities and correspondences.
> 
> So, in short, I prefer to be able to create different posets of cones for fans which are "==".

Thanks a lot! I'll look at this tonight.

I am still confused a bit: do you know where technically in the cone code is there an ``==`` or ``is`` test done on some posets, which cause the change of behaviour above?



---

archive/issue_comments_108296.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@nthiery](#comment:35):\n> I am still confused a bit: do you know where technically in the cone code is there an ``==`` or ``is`` test done on some posets, which cause the change of behaviour above?\n\nWhen a fan computes its cone lattice, it constructs all of the required cones (which are bound to the correct fan) and then converts them into a poset. All further methods work with this poset. Since now posets are unique and involve \"==\" checks for fans and cones, the poset of the second fan is treated as the same one as the first one, so the second fan gets a poset of cones bound to the first fan. The precise method of fans is `_compute_cone_lattice`.\n\nNow, I have actually realized, that it will have the same issue for cones, it just does not break the existent doctests yet:\n\n```\nsage: C1 = Cone([(0,1)])\nsage: C2 = Cone([(0,1)])\nsage: C1 == C2\nTrue\nsage: C1 is C2\nFalse\nsage: C1.facets()[0]\n0-d face of 1-d cone in 2-d lattice N\nsage: C1.facets()[0].ambient() is C1\nTrue\nsage: C2.facets()[0].ambient() is C1\nTrue\nsage: C2.facets()[0].ambient() is C2\nFalse\n```\nThe code for cones is in `face_lattice` method. Again, I don't want to get the same posets even for cones that have the same order of rays, and there are arguments that \"==\" should treat rays as sets. So it would be nice to force different posets for \"==\" objects.\n\nWhy exactly are posets unique? Isn't it expensive to check that two posets are equivalent? I am interested in dealing with face lattices of about 10<sup>5</sup> elements, how long would it take to check their equality? Maybe elements of posets should be unique, but not posets themselves?",
    "created_at": "2011-06-14T18:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108296",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@nthiery](#comment:35):
> I am still confused a bit: do you know where technically in the cone code is there an ``==`` or ``is`` test done on some posets, which cause the change of behaviour above?

When a fan computes its cone lattice, it constructs all of the required cones (which are bound to the correct fan) and then converts them into a poset. All further methods work with this poset. Since now posets are unique and involve "==" checks for fans and cones, the poset of the second fan is treated as the same one as the first one, so the second fan gets a poset of cones bound to the first fan. The precise method of fans is `_compute_cone_lattice`.

Now, I have actually realized, that it will have the same issue for cones, it just does not break the existent doctests yet:

```
sage: C1 = Cone([(0,1)])
sage: C2 = Cone([(0,1)])
sage: C1 == C2
True
sage: C1 is C2
False
sage: C1.facets()[0]
0-d face of 1-d cone in 2-d lattice N
sage: C1.facets()[0].ambient() is C1
True
sage: C2.facets()[0].ambient() is C1
True
sage: C2.facets()[0].ambient() is C2
False
```
The code for cones is in `face_lattice` method. Again, I don't want to get the same posets even for cones that have the same order of rays, and there are arguments that "==" should treat rays as sets. So it would be nice to force different posets for "==" objects.

Why exactly are posets unique? Isn't it expensive to check that two posets are equivalent? I am interested in dealing with face lattices of about 10<sup>5</sup> elements, how long would it take to check their equality? Maybe elements of posets should be unique, but not posets themselves?



---

archive/issue_comments_108297.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n> Why exactly are posets unique? Isn't it expensive to check that two posets\n> are equivalent? I am interested in dealing with face lattices of about 10<sup>5</sup>\n> elements, how long would it take to check their equality? Maybe elements of\n> posets should be unique, but not posets themselves?\n\nAs far as I understood, there is not check for equivalence, is it ? Actually,\nI'm not sure what you mean by equivalence opposed to equality. However I see\nno reason why two posets with the same element and the same ordering should be\ndifferent object: mathematically they are the same set with the same\nordering...\n\nMore pragmatically, I have some code using poset as key for hash tables. At\nfirst I didn't ensure that posets were unique then the code end-up spending\nall the time comparing poset that is comparing the underlying graph.\n\nIn my opinion, if you need to see two equal poset as different, this is\nbecause you have some more information on those poset (eg: some tag saying\nwhere it come from). If it is the case, I have the feeling that you should\ninherit a class from poset which adds the tag and use it for comparison and\ncreation so that two differently tagged posets will be different for is as for\n==.\n\nMy two cents,\n\nFlorent",
    "created_at": "2011-06-14T21:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108297",
    "user": "https://github.com/hivert"
}
```

<div id="comment:37" align="right">comment:37</div>

> Why exactly are posets unique? Isn't it expensive to check that two posets
> are equivalent? I am interested in dealing with face lattices of about 10<sup>5</sup>
> elements, how long would it take to check their equality? Maybe elements of
> posets should be unique, but not posets themselves?

As far as I understood, there is not check for equivalence, is it ? Actually,
I'm not sure what you mean by equivalence opposed to equality. However I see
no reason why two posets with the same element and the same ordering should be
different object: mathematically they are the same set with the same
ordering...

More pragmatically, I have some code using poset as key for hash tables. At
first I didn't ensure that posets were unique then the code end-up spending
all the time comparing poset that is comparing the underlying graph.

In my opinion, if you need to see two equal poset as different, this is
because you have some more information on those poset (eg: some tag saying
where it come from). If it is the case, I have the feeling that you should
inherit a class from poset which adds the tag and use it for comparison and
creation so that two differently tagged posets will be different for is as for
==.

My two cents,

Florent



---

archive/issue_comments_108298.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nAs I understand the uniqueness framework, it is based on checking that the input to the constructor is the same as was already used before. So if posets are unique, the constructor input is somehow normalized (using Hasse diagram, perhaps?) and then compared with those that were already constructed.\n\nIn this cases fans and cones report that \"==\" is true for all the elements and therefore the posets are considered to be the same and become a unique object.\n\nHowever for implementation purposes there is a big difference between treating two cones as cones of the same fan and as two arbitrary cones. In the first case the intersection is internally computed as the intersection of two ordered sets of integers. In the second one it involves constructing a new polyhedral object and determining its minimal generator set. With old PALP/cdd interfaces this takes forever (compared to intersection two short lists of integers). With Volker's new PPL interface it is much better, yet still it requires many more operations.\n\nI agree that we have here more structure than poset itself but it is basically the question of \"the same\" and \"isomorphic\". We have a similar issue with toric lattices: if M = ZZ<sup>n</sup>, then the dual space is also ZZ<sup>n</sup>, yet they are isomorphic but not equal. It would be great actually to have some standard way in Sage to tag objects. Maybe ZZ is unique as a ring, but it is possible that one wants to consider several modules which are isomorphic to ZZ and treat them as different ones.",
    "created_at": "2011-06-14T21:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108298",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:38" align="right">comment:38</div>

As I understand the uniqueness framework, it is based on checking that the input to the constructor is the same as was already used before. So if posets are unique, the constructor input is somehow normalized (using Hasse diagram, perhaps?) and then compared with those that were already constructed.

In this cases fans and cones report that "==" is true for all the elements and therefore the posets are considered to be the same and become a unique object.

However for implementation purposes there is a big difference between treating two cones as cones of the same fan and as two arbitrary cones. In the first case the intersection is internally computed as the intersection of two ordered sets of integers. In the second one it involves constructing a new polyhedral object and determining its minimal generator set. With old PALP/cdd interfaces this takes forever (compared to intersection two short lists of integers). With Volker's new PPL interface it is much better, yet still it requires many more operations.

I agree that we have here more structure than poset itself but it is basically the question of "the same" and "isomorphic". We have a similar issue with toric lattices: if M = ZZ<sup>n</sup>, then the dual space is also ZZ<sup>n</sup>, yet they are isomorphic but not equal. It would be great actually to have some standard way in Sage to tag objects. Maybe ZZ is unique as a ring, but it is possible that one wants to consider several modules which are isomorphic to ZZ and treat them as different ones.



---

archive/issue_events_146676.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-06-23T10:34:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146676"
}
```



---

archive/issue_events_146677.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-06-23T10:34:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146677"
}
```



---

archive/issue_comments_108299.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThe updated patch fixes the issue with cones and fans by adding a ``key`` argument to FinitePoset. Using it, equal but not identical Cone's and Fan's create distinct posets.\nI also folded in Christian's order_complex fix.\n\nTo me the whole thing seems ready to go.\n\nSorry, I screwed up and refreshed my changes directly in the main patch. So I have attached a diff between the previous and new version. It's not super-readable, but it should point to those few places that need review.",
    "created_at": "2011-06-23T10:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108299",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:39" align="right">comment:39</div>

The updated patch fixes the issue with cones and fans by adding a ``key`` argument to FinitePoset. Using it, equal but not identical Cone's and Fan's create distinct posets.
I also folded in Christian's order_complex fix.

To me the whole thing seems ready to go.

Sorry, I screwed up and refreshed my changes directly in the main patch. So I have attached a diff between the previous and new version. It's not super-readable, but it should point to those few places that need review.



---

archive/issue_comments_108300.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@novoselt](#comment:38):\n> As I understand the uniqueness framework, it is based on checking that the input to the constructor is the same as was already used before. So if posets are unique, the constructor input is somehow normalized (using Hasse diagram, perhaps?) and then compared with those that were already constructed.\n\nCorrect.\n\n> However for implementation purposes there is a big difference between treating two cones as cones of the same fan and as two arbitrary cones. In the first case the intersection is internally computed as the intersection of two ordered sets of integers. In the second one it involves constructing a new polyhedral object and determining its minimal generator set. With old PALP/cdd interfaces this takes forever (compared to intersection two short lists of integers). With Volker's new PPL interface it is much better, yet still it requires many more operations.\n\nTo me this sounds like two cones/fans shall be equal (as in A==B) only if they really have the same ambient space / ... and otherwise be only isomorphic (as in A.is_isomorphic(B)). \nIn general, equality is often used by Python at a very low level, e.g. for hash table lookups. So it should be fast and simple.\n\nAnyway, this does not need to be settled now, and we can discuss this more efficiently face to face at the next occasion.\n\n> I agree that we have here more structure than poset itself but it is basically the question of \"the same\" and \"isomorphic\". We have a similar issue with toric lattices: if M = ZZ<sup>n</sup>, then the dual space is also ZZ<sup>n</sup>, yet they are isomorphic but not equal. It would be great actually to have some standard way in Sage to tag objects. Maybe ZZ is unique as a ring, but it is possible that one wants to consider several modules which are isomorphic to ZZ and treat them as different ones.\n\nWe definitely have had such use cases as well. However we were lucky enough that we usually wanted to add some more structure, or change a bit the structure, and in those cases we would either derive a new class, or use a facade parent together with Cat.IsomorphicObjects() to transfer the part of the structure that was to be kept.\n\nBut we could think of generalizing the use of a key=`...` in UniqueRepresentation as I used here for posets.\n\nCheers,\n                      Nicolas",
    "created_at": "2011-06-23T10:48:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108300",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@novoselt](#comment:38):
> As I understand the uniqueness framework, it is based on checking that the input to the constructor is the same as was already used before. So if posets are unique, the constructor input is somehow normalized (using Hasse diagram, perhaps?) and then compared with those that were already constructed.

Correct.

> However for implementation purposes there is a big difference between treating two cones as cones of the same fan and as two arbitrary cones. In the first case the intersection is internally computed as the intersection of two ordered sets of integers. In the second one it involves constructing a new polyhedral object and determining its minimal generator set. With old PALP/cdd interfaces this takes forever (compared to intersection two short lists of integers). With Volker's new PPL interface it is much better, yet still it requires many more operations.

To me this sounds like two cones/fans shall be equal (as in A==B) only if they really have the same ambient space / ... and otherwise be only isomorphic (as in A.is_isomorphic(B)). 
In general, equality is often used by Python at a very low level, e.g. for hash table lookups. So it should be fast and simple.

Anyway, this does not need to be settled now, and we can discuss this more efficiently face to face at the next occasion.

> I agree that we have here more structure than poset itself but it is basically the question of "the same" and "isomorphic". We have a similar issue with toric lattices: if M = ZZ<sup>n</sup>, then the dual space is also ZZ<sup>n</sup>, yet they are isomorphic but not equal. It would be great actually to have some standard way in Sage to tag objects. Maybe ZZ is unique as a ring, but it is possible that one wants to consider several modules which are isomorphic to ZZ and treat them as different ones.

We definitely have had such use cases as well. However we were lucky enough that we usually wanted to add some more structure, or change a bit the structure, and in those cases we would either derive a new class, or use a facade parent together with Cat.IsomorphicObjects() to transfer the part of the structure that was to be kept.

But we could think of generalizing the use of a key=`...` in UniqueRepresentation as I used here for posets.

Cheers,
                      Nicolas



---

archive/issue_comments_108301.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nHi Nicolas, thanks for the reply!\n\nChanges to the cones and fans seem fine to me. I think that we do care about the possibility of pickling faces, but it is not something desperate. In my prior experience it was sometimes faster to recompute faces than to store them, I have not tested it for the current toric framework.\n\nGeneralizing your `key` argument for all `UniqueRepresentation`s sound like a good idea to me!\n\nAndrey",
    "created_at": "2011-06-23T19:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108301",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:41" align="right">comment:41</div>

Hi Nicolas, thanks for the reply!

Changes to the cones and fans seem fine to me. I think that we do care about the possibility of pickling faces, but it is not something desperate. In my prior experience it was sometimes faster to recompute faces than to store them, I have not tested it for the current toric framework.

Generalizing your `key` argument for all `UniqueRepresentation`s sound like a good idea to me!

Andrey



---

archive/issue_comments_108302.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@novoselt](#comment:41):\n> Changes to the cones and fans seem fine to me. I think that we do care about the possibility of pickling faces, but it is not something desperate.\n\nNope. I just went this way because it was the quickest to setup to get this patch done. Worst case, a bit of getstate/setstate magic will do the job.\n\n> In my prior experience it was sometimes faster to recompute faces than to store them, I have not tested it for the current toric framework.\n\nOk.\n\n> Generalizing your `key` argument for all `UniqueRepresentation`s sound like a good idea to me!\n\nOk. I'll keep this in mind, and wait until we get enough other use cases.\n\nThanks Andrey for your fast review.",
    "created_at": "2011-06-23T20:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108302",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@novoselt](#comment:41):
> Changes to the cones and fans seem fine to me. I think that we do care about the possibility of pickling faces, but it is not something desperate.

Nope. I just went this way because it was the quickest to setup to get this patch done. Worst case, a bit of getstate/setstate magic will do the job.

> In my prior experience it was sometimes faster to recompute faces than to store them, I have not tested it for the current toric framework.

Ok.

> Generalizing your `key` argument for all `UniqueRepresentation`s sound like a good idea to me!

Ok. I'll keep this in mind, and wait until we get enough other use cases.

Thanks Andrey for your fast review.



---

archive/issue_comments_108303.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nChristian, Franco: any chances for one of you to check my latest changes shortly? Then we could be done, and get this in 4.7.2.\n\nThanks in advance,\n                   Nicolas",
    "created_at": "2011-06-23T20:54:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108303",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:43" align="right">comment:43</div>

Christian, Franco: any chances for one of you to check my latest changes shortly? Then we could be done, and get this in 4.7.2.

Thanks in advance,
                   Nicolas



---

archive/issue_comments_108304.json:
```json
{
    "body": "Changed dependencies from **#11289, #10938, #9065** to **#8288,#10651,#11289, #10938, #9065,#11183**",
    "created_at": "2011-06-28T12:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108304",
    "user": "https://github.com/nthiery"
}
```

Changed dependencies from **#11289, #10938, #9065** to **#8288,#10651,#11289, #10938, #9065,#11183**



---

archive/issue_comments_108305.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,4 +5,3 @@\n \n Apply: trac_10998-categories-posets-nt.patch\n \n-Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest), #11289 (Random posets, documentation and error-checking)\n``````\n",
    "created_at": "2011-06-28T12:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108305",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,4 +5,3 @@
 
 Apply: trac_10998-categories-posets-nt.patch
 
-Depends on: #10651 (empty set), #9065 (facade sets), #10938 (Set-issubset), #8288 (search forest), #11289 (Random posets, documentation and error-checking)
``````




---

archive/issue_comments_108306.json:
```json
{
    "body": "Changed dependencies from **#8288,#10651,#11289, #10938, #9065,#11183** to **#8288,#10651,#11289, #10938, #9065**",
    "created_at": "2011-06-28T12:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108306",
    "user": "https://github.com/nthiery"
}
```

Changed dependencies from **#8288,#10651,#11289, #10938, #9065,#11183** to **#8288,#10651,#11289, #10938, #9065**



---

archive/issue_comments_108307.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nThe poset elements have two attributes, `.element` and `.vertex`. Is there a one-to-one correspondence between elements and vertices? I do think so, but maybe there is something I'm overlooking. \n\nIf it is true, can we get rid of the superfluous element comparison in `PosetElement.__eq__`? This causes a serious slowdown in the toric code - its much cheaper to compare vertices than cones.",
    "created_at": "2011-07-07T22:07:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108307",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:46" align="right">comment:46</div>

The poset elements have two attributes, `.element` and `.vertex`. Is there a one-to-one correspondence between elements and vertices? I do think so, but maybe there is something I'm overlooking. 

If it is true, can we get rid of the superfluous element comparison in `PosetElement.__eq__`? This causes a serious slowdown in the toric code - its much cheaper to compare vertices than cones.



---

archive/issue_comments_108308.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI don't know what the current status here is; I just saw that the optional arguments label_elements and element_labels for show/plot do not work anymore (I fixed that a while ago somewhere is this big cluster patch). Can someone confirm that and/or see where my changes got lost?\n\nAs an example, I tried\n\n```\nsage: D = Poset({ 0:[1,2], 1:[3], 2:[3,4] })\nsage: D.plot(label_elements=False)\n\nsage: D.show()\nsage: elm_labs = {0:'a', 1:'b', 2:'c', 3:'d', 4:'e'}\nsage: D.show(element_labels=elm_labs)\n```\n\nIn both cases, I see the numbers as labels.\n\nBest, Christian",
    "created_at": "2011-08-10T00:37:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108308",
    "user": "https://github.com/stumpc5"
}
```

<div id="comment:47" align="right">comment:47</div>

I don't know what the current status here is; I just saw that the optional arguments label_elements and element_labels for show/plot do not work anymore (I fixed that a while ago somewhere is this big cluster patch). Can someone confirm that and/or see where my changes got lost?

As an example, I tried

```
sage: D = Poset({ 0:[1,2], 1:[3], 2:[3,4] })
sage: D.plot(label_elements=False)

sage: D.show()
sage: elm_labs = {0:'a', 1:'b', 2:'c', 3:'d', 4:'e'}
sage: D.show(element_labels=elm_labs)
```

In both cases, I see the numbers as labels.

Best, Christian



---

archive/issue_comments_108309.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nHello, I wonder - what are the current plans for this ticket? (I am interested in #11559 which depends on it.)",
    "created_at": "2011-12-29T16:48:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108309",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:48" align="right">comment:48</div>

Hello, I wonder - what are the current plans for this ticket? (I am interested in #11559 which depends on it.)



---

archive/issue_comments_108310.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@novoselt](#comment:48):\n> Hello, I wonder - what are the current plans for this ticket? (I am interested in #11559 which depends on it.)\n\nI really want to get rid of it. I should have more time working on Sage shortly, so hopefully that will be soon!\n                      Nicolas",
    "created_at": "2012-01-08T19:59:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108310",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@novoselt](#comment:48):
> Hello, I wonder - what are the current plans for this ticket? (I am interested in #11559 which depends on it.)

I really want to get rid of it. I should have more time working on Sage shortly, so hopefully that will be soon!
                      Nicolas



---

archive/issue_comments_108311.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI get numerous mismatches when applying the patch on top of sage-5.0.prealpha0. I think it is due to #11900. Since #11900 is merged, I suggest to rebase the patch from here.",
    "created_at": "2012-01-27T09:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108311",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:50" align="right">comment:50</div>

I get numerous mismatches when applying the patch on top of sage-5.0.prealpha0. I think it is due to #11900. Since #11900 is merged, I suggest to rebase the patch from here.



---

archive/issue_comments_108312.json:
```json
{
    "body": "Work Issues: **rebase relative sage-5.0.beta0**",
    "created_at": "2012-01-27T09:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108312",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **rebase relative sage-5.0.beta0**



---

archive/issue_events_146678.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-01-27T09:39:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146678"
}
```



---

archive/issue_events_146679.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-01-27T09:39:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146679"
}
```



---

archive/issue_comments_108313.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@stumpc5](#comment:47):\n> I don't know what the current status here is; I just saw that the optional arguments label_elements and element_labels for show/plot do not work anymore (I fixed that a while ago somewhere is this big cluster patch). Can someone confirm that and/or see where my changes got lost?\n> \n> As an example, I tried\n> \n> ```\n> sage: D = Poset({ 0:[1,2], 1:[3], 2:[3,4] })\n> sage: D.plot(label_elements=False)\n> \n> sage: D.show()\n> sage: elm_labs = {0:'a', 1:'b', 2:'c', 3:'d', 4:'e'}\n> sage: D.show(element_labels=elm_labs)\n> ```\n> \n> In both cases, I see the numbers as labels.\n\nFixed and tested in the updated patch!",
    "created_at": "2012-02-08T00:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108313",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@stumpc5](#comment:47):
> I don't know what the current status here is; I just saw that the optional arguments label_elements and element_labels for show/plot do not work anymore (I fixed that a while ago somewhere is this big cluster patch). Can someone confirm that and/or see where my changes got lost?
> 
> As an example, I tried
> 
> ```
> sage: D = Poset({ 0:[1,2], 1:[3], 2:[3,4] })
> sage: D.plot(label_elements=False)
> 
> sage: D.show()
> sage: elm_labs = {0:'a', 1:'b', 2:'c', 3:'d', 4:'e'}
> sage: D.show(element_labels=elm_labs)
> ```
> 
> In both cases, I see the numbers as labels.

Fixed and tested in the updated patch!



---

archive/issue_comments_108314.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@vbraun](#comment:46):\n> The poset elements have two attributes, `.element` and `.vertex`. Is there a one-to-one correspondence between elements and vertices? I do think so, but maybe there is something I'm overlooking. \n> \n> If it is true, can we get rid of the superfluous element comparison in `PosetElement.__eq__`? This causes a serious slowdown in the toric code - its much cheaper to compare vertices than cones.\n\nThanks for the suggestion. I implemented this in the latest version of my patch!",
    "created_at": "2012-02-08T01:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108314",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@vbraun](#comment:46):
> The poset elements have two attributes, `.element` and `.vertex`. Is there a one-to-one correspondence between elements and vertices? I do think so, but maybe there is something I'm overlooking. 
> 
> If it is true, can we get rid of the superfluous element comparison in `PosetElement.__eq__`? This causes a serious slowdown in the toric code - its much cheaper to compare vertices than cones.

Thanks for the suggestion. I implemented this in the latest version of my patch!



---

archive/issue_comments_108315.json:
```json
{
    "body": "Changed keywords from **days30, sd31** to **days30, sd31, Cernay2012**",
    "created_at": "2012-02-08T01:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108315",
    "user": "https://github.com/nthiery"
}
```

Changed keywords from **days30, sd31** to **days30, sd31, Cernay2012**



---

archive/issue_events_146680.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-02-08T01:20:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146680"
}
```



---

archive/issue_events_146681.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-02-08T01:20:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146681"
}
```



---

archive/issue_comments_108316.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nThe latest version of the patch is here and in the Sage-Combinat queue. Florent will make the final review tomorrow morning.",
    "created_at": "2012-02-08T01:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108316",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:53" align="right">comment:53</div>

The latest version of the patch is here and in the Sage-Combinat queue. Florent will make the final review tomorrow morning.



---

archive/issue_comments_108317.json:
```json
{
    "body": "Patch to be applied on the sagenb repo",
    "created_at": "2012-02-08T10:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108317",
    "user": "https://github.com/nthiery"
}
```

Patch to be applied on the sagenb repo



---

archive/issue_comments_108318.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nAttachment: **[trac_10998-categories-posets-sagenb-nt.patch.gz](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-sagenb-nt.patch.gz)**",
    "created_at": "2012-02-08T10:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108318",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:54" align="right">comment:54</div>

Attachment: **[trac_10998-categories-posets-sagenb-nt.patch.gz](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-sagenb-nt.patch.gz)**



---

archive/issue_comments_108319.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,8 @@\n This patch creates categories for posets and lattices, refactors the\n-poset code, and add new features. See the header of the patch for a complete description.\n+poset code, and adds new features. See the header of the patch for a\n+complete description.\n \n-Note: this patch is probably going to be reviewed on the Sage-Combinat server; please see there for the very latest version:\n+Apply: [attachment: trac_10998-categories-posets-nt.patch](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-nt.patch.gz)\n \n-Apply: trac_10998-categories-posets-nt.patch\n+Apply on sagenb repo: [attachment: trac_10998-categories-posets-sagenb-nt.patch](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-sagenb-nt.patch.gz)\n \n``````\n",
    "created_at": "2012-02-08T10:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108319",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,8 @@
 This patch creates categories for posets and lattices, refactors the
-poset code, and add new features. See the header of the patch for a complete description.
+poset code, and adds new features. See the header of the patch for a
+complete description.
 
-Note: this patch is probably going to be reviewed on the Sage-Combinat server; please see there for the very latest version:
+Apply: [attachment: trac_10998-categories-posets-nt.patch](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-nt.patch.gz)
 
-Apply: trac_10998-categories-posets-nt.patch
+Apply on sagenb repo: [attachment: trac_10998-categories-posets-sagenb-nt.patch](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-sagenb-nt.patch.gz)
 
``````




---

archive/issue_comments_108320.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nAttachment: **[trac_10998-categories-posets-nt.patch.gz](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-nt.patch.gz)**\n\nFinal patch uploaded, after polishing of the doc and a final failing doctest. Crossreviewed with Florent. All tests pass. Positive review!\n\nThanks everyone!",
    "created_at": "2012-02-09T00:41:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108320",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:55" align="right">comment:55</div>

Attachment: **[trac_10998-categories-posets-nt.patch.gz](https://github.com/sagemath/sage/files/ticket10998/trac_10998-categories-posets-nt.patch.gz)**

Final patch uploaded, after polishing of the doc and a final failing doctest. Crossreviewed with Florent. All tests pass. Positive review!

Thanks everyone!



---

archive/issue_events_146682.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-02-09T00:41:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146682"
}
```



---

archive/issue_events_146683.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-02-09T00:41:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146683"
}
```



---

archive/issue_comments_108321.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nWow, you win the award for longest commit message.",
    "created_at": "2012-02-09T19:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108321",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:56" align="right">comment:56</div>

Wow, you win the award for longest commit message.



---

archive/issue_comments_108322.json:
```json
{
    "body": "Changed work issues from **rebase relative sage-5.0.beta0** to none",
    "created_at": "2012-02-09T19:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108322",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **rebase relative sage-5.0.beta0** to none



---

archive/issue_comments_108323.json:
```json
{
    "body": "Merged: **sage-5.0.beta4**",
    "created_at": "2012-02-14T14:19:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10998#issuecomment-108323",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta4**



---

archive/issue_events_146684.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T14:19:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146684"
}
```



---

archive/issue_events_146685.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T14:19:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10998",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10998#event-146685"
}
```
