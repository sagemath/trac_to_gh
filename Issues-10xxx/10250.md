# Issue 10250: segfault when multiplying QQ constant and SR vector (with user basis)

archive/issues_010249.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/williamstein"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nThis code worked in Sage 4.5.2.  I just realized that it now gives a segfault in 4.6.  Does anyone know what is going on?\n\n```\nsage: A=matrix(QQ, [[2,1],[0,3]])\nsage: eval, evecs,mult=A.eigenvectors_right()[0]\nsage: evec=evecs[0]\nsage: unitevec=evec/evec.norm()\nsage: unitevec\n(1/2*sqrt(2), 1/2*sqrt(2))\nsage: parent(eval)\nRational Field\nsage: eval\n3\n```\nand then:\n\n```\nsage: w=(SR2)(unitevec)\nsage: parent(w) # works fine\nVector space of dimension 2 over Symbolic Ring\nsage: eval*w\n(3/2*sqrt(2), 3/2*sqrt(2))\n```\nbut here's the problem:\n\n```\nsage: parent(unitevec) # gives problem\nVector space of degree 2 and dimension 1 over Symbolic Ring\nUser basis matrix:\n[1 1]\nsage: eval*unitevec\n\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------ \n```\n\nHere is a backtrace using sage -gdb, which indicates a problem in ginac or pynac.\n\n```\nsage: eval*unitevec\n\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: 13 at address: 0x0000000000000000\n0x00007fff8294a7a2 in __dynamic_cast ()\n(gdb) bt\n#0  0x00007fff8294a7a2 in __dynamic_cast ()\n#1  0x000000010798ffcc in is_a<GiNaC::relational> [inlined] () at /Users/grout/sage-trees/sage-4.6/local/include/pynac/basic.h:939\n#2  0x000000010798ffcc in is_a<GiNaC::relational> [inlined] () at /Users/grout/sage-trees/sage-4.6/local/include/pynac/ex.h:939\n#3  0x000000010798ffcc in __pyx_f_4sage_8symbolic_10expression_10Expression__mul_ (__pyx_v_left=0x10c825a70, __pyx_v_right=0x10c8281d0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at ex.h:11284\n#4  0x0000000104be0632 in __pyx_f_4sage_7modules_19free_module_element_31FreeModuleElement_generic_dense__rmul_ (__pyx_v_self=0x10c81e628, __pyx_v_left=0x10c825a70, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/modules/free_module_element.c:15600\n#5  0x00000001022b5b7f in __pyx_f_4sage_9structure_14coerce_actions_16LeftModuleAction__call_ (__pyx_v_self=0x1006be758, __pyx_v_g=0x10c825a70, __pyx_v_a=0x10c81e628, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce_actions.c:5437\n#6  0x000000010223fe62 in __pyx_pf_4sage_10categories_6action_6Action_act (__pyx_v_self=0x1006be758, __pyx_args=0x10bd2e638, __pyx_kwds=0x0) at sage/categories/action.c:2563\n#7  0x000000010000bcd2 in PyObject_Call ()\n#8  0x00000001022b68eb in __pyx_pf_4sage_9structure_14coerce_actions_12ModuleAction___init__ (__pyx_v_self=0x1006be758, __pyx_args=<value temporarily unavailable, due to optimizations>, __pyx_kwds=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce_actions.c:5133\n#9  0x000000010006d8c5 in type_call ()\n#10 0x000000010000bcd2 in PyObject_Call ()\n#11 0x00000001022b8673 in __pyx_pf_4sage_9structure_14coerce_actions_detect_element_action (__pyx_self=<value temporarily unavailable, due to optimizations>, __pyx_args=<value temporarily unavailable, due to optimizations>, __pyx_kwds=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce_actions.c:4184\n#12 0x000000010000bcd2 in PyObject_Call ()\n#13 0x0000000101f9988c in __pyx_f_4sage_9structure_6parent_6Parent_discover_action (__pyx_v_self=0x10bed9b40, __pyx_v_S=0x1021654d0, __pyx_v_op=0x1006418c0, __pyx_v_self_on_left=0) at sage/structure/parent.c:14710\n#14 0x0000000101f5b825 in __pyx_f_4sage_9structure_10parent_old_6Parent_get_action_c_impl (__pyx_v_self=0x10bed9b40, __pyx_v_S=0x1021654d0, __pyx_v_op=0x1006418c0, __pyx_v_self_on_left=0) at sage/structure/parent_old.c:3254\n#15 0x0000000101f5ba6f in __pyx_pf_4sage_9structure_10parent_old_6Parent_get_action_impl (__pyx_v_self=0x10bed9b40, __pyx_args=<value temporarily unavailable, due to optimizations>, __pyx_kwds=<value temporarily unavailable, due to optimizations>) at sage/structure/parent_old.c:3204\n#16 0x000000010000bcd2 in PyObject_Call ()\n#17 0x0000000101f5c424 in __pyx_f_4sage_9structure_10parent_old_6Parent_get_action_c (__pyx_v_self=0x10bed9b40, __pyx_v_S=0x1021654d0, __pyx_v_op=0x1006418c0, __pyx_v_self_on_left=0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/parent_old.c:2892\n#18 0x0000000101f4f359 in __pyx_f_4sage_9structure_10parent_old_6Parent__get_action_ (__pyx_v_self=0x10bed9b40, __pyx_v_other=0x1021654d0, __pyx_v_op=0x1006418c0, __pyx_v_self_on_left=0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/parent_old.c:6069\n#19 0x0000000101f9b9a4 in __pyx_f_4sage_9structure_6parent_6Parent_get_action (__pyx_v_self=0x10bed9b40, __pyx_v_S=0x1021654d0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>, __pyx_optional_args=<value temporarily unavailable, due to optimizations>) at sage/structure/parent.c:13731\n#20 0x00000001020aaa87 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_discover_action (__pyx_v_self=0x101f38710, __pyx_v_R=0x1021654d0, __pyx_v_S=0x10bed9b40, __pyx_v_op=0x1006418c0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce.c:11909\n#21 0x00000001020afcf1 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_get_action (__pyx_v_self=0x101f38710, __pyx_v_R=0x1021654d0, __pyx_v_S=0x10bed9b40, __pyx_v_op=0x1006418c0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce.c:10837\n#22 0x00000001020bbe36 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_bin_op (__pyx_v_self=0x101f38710, __pyx_v_x=0x1006b56b0, __pyx_v_y=0x10c8292b8, __pyx_v_op=0x1006418c0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce.c:6080\n#23 0x000000010203165d in __pyx_pf_4sage_9structure_7element_11RingElement___mul__ (__pyx_v_left=0x1006b56b0, __pyx_v_right=0x10c8292b8) at sage/structure/element.c:11399\n#24 0x000000010000bfbc in binary_op1 ()\n#25 0x000000010000e5a8 in PyNumber_Multiply ()\n#26 0x00000001000b35df in PyEval_EvalFrameEx ()\n#27 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#28 0x00000001000b7799 in PyEval_EvalFrameEx ()\n#29 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#30 0x00000001000b6ffd in PyEval_EvalFrameEx ()\n#31 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#32 0x00000001000b6ffd in PyEval_EvalFrameEx ()\n#33 0x00000001000b745a in PyEval_EvalFrameEx ()\n#34 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#35 0x00000001000b6ffd in PyEval_EvalFrameEx ()\n#36 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#37 0x00000001000b6ffd in PyEval_EvalFrameEx ()\n#38 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#39 0x00000001000b6ffd in PyEval_EvalFrameEx ()\n#40 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#41 0x00000001000b90f6 in PyEval_EvalCode ()\n#42 0x00000001000dde0e in PyRun_FileExFlags ()\n#43 0x00000001000de0c9 in PyRun_SimpleFileExFlags ()\n#44 0x00000001000eb5eb in Py_Main ()\n#45 0x0000000100000f14 in start ()\n(gdb)\n```\n\nCC:  @burcin @rbeezer @craigcitro @robertwb @novoselt @vbraun\n\nComponent: **linear algebra**\n\nAuthor: **Andrey Novoseltsev, Jason Grout**\n\nReviewer: **Jason Grout, Andrey Novoseltsev**\n\nMerged: **sage-4.6.1.alpha2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10250_\n\n",
    "closed_at": "2010-11-15T23:25:34Z",
    "created_at": "2010-11-11T08:24:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "segfault when multiplying QQ constant and SR vector (with user basis)",
    "type": "issue",
    "updated_at": "2010-11-15T23:25:34Z",
    "url": "https://github.com/sagemath/sage/issues/10250",
    "user": "https://github.com/jasongrout"
}
```
<div id="comment:0"></div>

This code worked in Sage 4.5.2.  I just realized that it now gives a segfault in 4.6.  Does anyone know what is going on?

```
sage: A=matrix(QQ, [[2,1],[0,3]])
sage: eval, evecs,mult=A.eigenvectors_right()[0]
sage: evec=evecs[0]
sage: unitevec=evec/evec.norm()
sage: unitevec
(1/2*sqrt(2), 1/2*sqrt(2))
sage: parent(eval)
Rational Field
sage: eval
3
```
and then:

```
sage: w=(SR2)(unitevec)
sage: parent(w) # works fine
Vector space of dimension 2 over Symbolic Ring
sage: eval*w
(3/2*sqrt(2), 3/2*sqrt(2))
```
but here's the problem:

```
sage: parent(unitevec) # gives problem
Vector space of degree 2 and dimension 1 over Symbolic Ring
User basis matrix:
[1 1]
sage: eval*unitevec


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------ 
```

Here is a backtrace using sage -gdb, which indicates a problem in ginac or pynac.

```
sage: eval*unitevec

Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: 13 at address: 0x0000000000000000
0x00007fff8294a7a2 in __dynamic_cast ()
(gdb) bt
#0  0x00007fff8294a7a2 in __dynamic_cast ()
#1  0x000000010798ffcc in is_a<GiNaC::relational> [inlined] () at /Users/grout/sage-trees/sage-4.6/local/include/pynac/basic.h:939
#2  0x000000010798ffcc in is_a<GiNaC::relational> [inlined] () at /Users/grout/sage-trees/sage-4.6/local/include/pynac/ex.h:939
#3  0x000000010798ffcc in __pyx_f_4sage_8symbolic_10expression_10Expression__mul_ (__pyx_v_left=0x10c825a70, __pyx_v_right=0x10c8281d0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at ex.h:11284
#4  0x0000000104be0632 in __pyx_f_4sage_7modules_19free_module_element_31FreeModuleElement_generic_dense__rmul_ (__pyx_v_self=0x10c81e628, __pyx_v_left=0x10c825a70, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/modules/free_module_element.c:15600
#5  0x00000001022b5b7f in __pyx_f_4sage_9structure_14coerce_actions_16LeftModuleAction__call_ (__pyx_v_self=0x1006be758, __pyx_v_g=0x10c825a70, __pyx_v_a=0x10c81e628, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce_actions.c:5437
#6  0x000000010223fe62 in __pyx_pf_4sage_10categories_6action_6Action_act (__pyx_v_self=0x1006be758, __pyx_args=0x10bd2e638, __pyx_kwds=0x0) at sage/categories/action.c:2563
#7  0x000000010000bcd2 in PyObject_Call ()
#8  0x00000001022b68eb in __pyx_pf_4sage_9structure_14coerce_actions_12ModuleAction___init__ (__pyx_v_self=0x1006be758, __pyx_args=<value temporarily unavailable, due to optimizations>, __pyx_kwds=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce_actions.c:5133
#9  0x000000010006d8c5 in type_call ()
#10 0x000000010000bcd2 in PyObject_Call ()
#11 0x00000001022b8673 in __pyx_pf_4sage_9structure_14coerce_actions_detect_element_action (__pyx_self=<value temporarily unavailable, due to optimizations>, __pyx_args=<value temporarily unavailable, due to optimizations>, __pyx_kwds=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce_actions.c:4184
#12 0x000000010000bcd2 in PyObject_Call ()
#13 0x0000000101f9988c in __pyx_f_4sage_9structure_6parent_6Parent_discover_action (__pyx_v_self=0x10bed9b40, __pyx_v_S=0x1021654d0, __pyx_v_op=0x1006418c0, __pyx_v_self_on_left=0) at sage/structure/parent.c:14710
#14 0x0000000101f5b825 in __pyx_f_4sage_9structure_10parent_old_6Parent_get_action_c_impl (__pyx_v_self=0x10bed9b40, __pyx_v_S=0x1021654d0, __pyx_v_op=0x1006418c0, __pyx_v_self_on_left=0) at sage/structure/parent_old.c:3254
#15 0x0000000101f5ba6f in __pyx_pf_4sage_9structure_10parent_old_6Parent_get_action_impl (__pyx_v_self=0x10bed9b40, __pyx_args=<value temporarily unavailable, due to optimizations>, __pyx_kwds=<value temporarily unavailable, due to optimizations>) at sage/structure/parent_old.c:3204
#16 0x000000010000bcd2 in PyObject_Call ()
#17 0x0000000101f5c424 in __pyx_f_4sage_9structure_10parent_old_6Parent_get_action_c (__pyx_v_self=0x10bed9b40, __pyx_v_S=0x1021654d0, __pyx_v_op=0x1006418c0, __pyx_v_self_on_left=0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/parent_old.c:2892
#18 0x0000000101f4f359 in __pyx_f_4sage_9structure_10parent_old_6Parent__get_action_ (__pyx_v_self=0x10bed9b40, __pyx_v_other=0x1021654d0, __pyx_v_op=0x1006418c0, __pyx_v_self_on_left=0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/parent_old.c:6069
#19 0x0000000101f9b9a4 in __pyx_f_4sage_9structure_6parent_6Parent_get_action (__pyx_v_self=0x10bed9b40, __pyx_v_S=0x1021654d0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>, __pyx_optional_args=<value temporarily unavailable, due to optimizations>) at sage/structure/parent.c:13731
#20 0x00000001020aaa87 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_discover_action (__pyx_v_self=0x101f38710, __pyx_v_R=0x1021654d0, __pyx_v_S=0x10bed9b40, __pyx_v_op=0x1006418c0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce.c:11909
#21 0x00000001020afcf1 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_get_action (__pyx_v_self=0x101f38710, __pyx_v_R=0x1021654d0, __pyx_v_S=0x10bed9b40, __pyx_v_op=0x1006418c0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce.c:10837
#22 0x00000001020bbe36 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_bin_op (__pyx_v_self=0x101f38710, __pyx_v_x=0x1006b56b0, __pyx_v_y=0x10c8292b8, __pyx_v_op=0x1006418c0, __pyx_skip_dispatch=<value temporarily unavailable, due to optimizations>) at sage/structure/coerce.c:6080
#23 0x000000010203165d in __pyx_pf_4sage_9structure_7element_11RingElement___mul__ (__pyx_v_left=0x1006b56b0, __pyx_v_right=0x10c8292b8) at sage/structure/element.c:11399
#24 0x000000010000bfbc in binary_op1 ()
#25 0x000000010000e5a8 in PyNumber_Multiply ()
#26 0x00000001000b35df in PyEval_EvalFrameEx ()
#27 0x00000001000b9010 in PyEval_EvalCodeEx ()
#28 0x00000001000b7799 in PyEval_EvalFrameEx ()
#29 0x00000001000b9010 in PyEval_EvalCodeEx ()
#30 0x00000001000b6ffd in PyEval_EvalFrameEx ()
#31 0x00000001000b9010 in PyEval_EvalCodeEx ()
#32 0x00000001000b6ffd in PyEval_EvalFrameEx ()
#33 0x00000001000b745a in PyEval_EvalFrameEx ()
#34 0x00000001000b9010 in PyEval_EvalCodeEx ()
#35 0x00000001000b6ffd in PyEval_EvalFrameEx ()
#36 0x00000001000b9010 in PyEval_EvalCodeEx ()
#37 0x00000001000b6ffd in PyEval_EvalFrameEx ()
#38 0x00000001000b9010 in PyEval_EvalCodeEx ()
#39 0x00000001000b6ffd in PyEval_EvalFrameEx ()
#40 0x00000001000b9010 in PyEval_EvalCodeEx ()
#41 0x00000001000b90f6 in PyEval_EvalCode ()
#42 0x00000001000dde0e in PyRun_FileExFlags ()
#43 0x00000001000de0c9 in PyRun_SimpleFileExFlags ()
#44 0x00000001000eb5eb in Py_Main ()
#45 0x0000000100000f14 in start ()
(gdb)
```

CC:  @burcin @rbeezer @craigcitro @robertwb @novoselt @vbraun

Component: **linear algebra**

Author: **Andrey Novoseltsev, Jason Grout**

Reviewer: **Jason Grout, Andrey Novoseltsev**

Merged: **sage-4.6.1.alpha2**

_Issue created by migration from https://trac.sagemath.org/ticket/10250_





---

archive/issue_events_133192.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-11T08:24:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133192"
}
```



---

archive/issue_events_133193.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-11T08:24:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133193"
}
```



---

archive/issue_events_133194.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-11T08:24:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133194"
}
```



---

archive/issue_events_133195.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-11T08:24:10Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "subject": "https://github.com/jasongrout",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133195"
}
```



---

archive/issue_events_133196.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-11-11T08:24:10Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "subject": "https://github.com/jasongrout",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133196"
}
```



---

archive/issue_comments_095432.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThis is puzzling that this works, though:\n\n```\nsage: V=(SR^2).subspace_with_basis([[1,1]])\nsage: v=V([sqrt(2)/2,sqrt(2)/2])\nsage: parent(v)\nVector space of degree 2 and dimension 1 over Symbolic Ring\nUser basis matrix:\n[1 1]\nsage: QQ(3)*v\n(3/2*sqrt(2), 3/2*sqrt(2))\n```\n\nSo apparently creating the vector manually (rather than getting it as an eigenvector of a matrix) works okay.",
    "created_at": "2010-11-11T08:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95432",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:1" align="right">comment:1</div>

This is puzzling that this works, though:

```
sage: V=(SR^2).subspace_with_basis([[1,1]])
sage: v=V([sqrt(2)/2,sqrt(2)/2])
sage: parent(v)
Vector space of degree 2 and dimension 1 over Symbolic Ring
User basis matrix:
[1 1]
sage: QQ(3)*v
(3/2*sqrt(2), 3/2*sqrt(2))
```

So apparently creating the vector manually (rather than getting it as an eigenvector of a matrix) works okay.



---

archive/issue_comments_095433.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n#4834 would probably take care of this effect of the problem, but probably wouldn't fix the actual problem.",
    "created_at": "2010-11-11T14:32:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95433",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:2" align="right">comment:2</div>

#4834 would probably take care of this effect of the problem, but probably wouldn't fix the actual problem.



---

archive/issue_comments_095434.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nTracking this down even more:\n\n```\nsage: V=(QQ^2).span_of_basis([[1,1]])\nsage: v=V([1,1])\nsage: w=sqrt(2)*v\nsage: 3*w\n\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n\n```",
    "created_at": "2010-11-11T15:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95434",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">comment:3</div>

Tracking this down even more:

```
sage: V=(QQ^2).span_of_basis([[1,1]])
sage: v=V([1,1])
sage: w=sqrt(2)*v
sage: 3*w


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------

```



---

archive/issue_comments_095435.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nCcing Robert B and Craig Citro, since it looks like it might be a problem in the coercion system, and maybe in how the coercion system builds a module with a user basis:\n\n```\nsage: V=(QQ^2).span_of_basis([[1,1]])\nsage: v=V([1,1])\nsage: w=v.change_ring(SR)\nsage: w.parent()\nVector space of degree 2 and dimension 1 over Symbolic Ring\nUser basis matrix:\n[1 1]\nsage: 3*w\n(3, 3)\nsage: x=sqrt(2)*v # here the coercion system builds the parent of x\nsage: x.parent() is w.parent()\nFalse\nsage: x.parent()\nVector space of degree 2 and dimension 1 over Symbolic Ring\nUser basis matrix:\n[1 1]\nsage: x.parent() == w.parent() # equivalent parents between x and w\nTrue\nsage: 3*x # but we get a segfault when multiplying x by something\n\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n\n\n\n```\n\nAlso, notice that trying to get the coercion system to explain itself also segfaults:\n\n```\nsage: cm = sage.structure.element.get_coercion_model(); cm\n<sage.structure.coerce.CoercionModel_cache_maps object at 0x101f3b6b0>\nsage: sage: V=(QQ^2).span_of_basis([[1,1]])\nsage: v=V([1,1])\nsage: x=sqrt(2)*v\nsage: cm.explain(3.parent(), x.parent())\n\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n\n```",
    "created_at": "2010-11-11T15:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95435",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">comment:4</div>

Ccing Robert B and Craig Citro, since it looks like it might be a problem in the coercion system, and maybe in how the coercion system builds a module with a user basis:

```
sage: V=(QQ^2).span_of_basis([[1,1]])
sage: v=V([1,1])
sage: w=v.change_ring(SR)
sage: w.parent()
Vector space of degree 2 and dimension 1 over Symbolic Ring
User basis matrix:
[1 1]
sage: 3*w
(3, 3)
sage: x=sqrt(2)*v # here the coercion system builds the parent of x
sage: x.parent() is w.parent()
False
sage: x.parent()
Vector space of degree 2 and dimension 1 over Symbolic Ring
User basis matrix:
[1 1]
sage: x.parent() == w.parent() # equivalent parents between x and w
True
sage: 3*x # but we get a segfault when multiplying x by something


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------



```

Also, notice that trying to get the coercion system to explain itself also segfaults:

```
sage: cm = sage.structure.element.get_coercion_model(); cm
<sage.structure.coerce.CoercionModel_cache_maps object at 0x101f3b6b0>
sage: sage: V=(QQ^2).span_of_basis([[1,1]])
sage: v=V([1,1])
sage: x=sqrt(2)*v
sage: cm.explain(3.parent(), x.parent())


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------

```



---

archive/issue_comments_095436.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis works in Sage 4.4.4, and doesn't have anything to do with Pynac, as you now suspect.\n\n```\nsage: var('y')\ny\nsage: get_systems('diff(3*y,y)')\n['ginac']\n```\nbut in your example I get\n\n```\nsage: get_systems('3*x')\n[]\n```",
    "created_at": "2010-11-11T16:51:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95436",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:5" align="right">comment:5</div>

This works in Sage 4.4.4, and doesn't have anything to do with Pynac, as you now suspect.

```
sage: var('y')
y
sage: get_systems('diff(3*y,y)')
['ginac']
```
but in your example I get

```
sage: get_systems('3*x')
[]
```



---

archive/issue_comments_095437.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@kcrisman](#comment%3A5):\n> This works in Sage 4.4.4, and doesn't have anything to do with Pynac\n\nWell, yes it does.  The backtrace posted above points to the error happening in Ginac.\n\n```\n(gdb) bt\n#0  0x00007fff8294a7a2 in __dynamic_cast ()\n#1  0x000000010798ffcc in is_a<GiNaC::relational> [inlined] () at /Users/grout/sage-trees/sage-4.6/local/include/pynac/basic.h:939\n```",
    "created_at": "2010-11-11T17:10:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95437",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@kcrisman](#comment%3A5):
> This works in Sage 4.4.4, and doesn't have anything to do with Pynac

Well, yes it does.  The backtrace posted above points to the error happening in Ginac.

```
(gdb) bt
#0  0x00007fff8294a7a2 in __dynamic_cast ()
#1  0x000000010798ffcc in is_a<GiNaC::relational> [inlined] () at /Users/grout/sage-trees/sage-4.6/local/include/pynac/basic.h:939
```



---

archive/issue_comments_095438.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nYes, I saw that.  So why don't I get that system as being used?  Maybe we are now using Ginac, after the 4.6, and shouldn't be, due to coercion?  But I have no idea - sorry.",
    "created_at": "2010-11-11T17:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95438",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

Yes, I saw that.  So why don't I get that system as being used?  Maybe we are now using Ginac, after the 4.6, and shouldn't be, due to coercion?  But I have no idea - sorry.



---

archive/issue_comments_095439.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOkay, thanks to John Palmieri testing this out on various versions of Sage, I found that reverting #9502 fixes the issue.  I'm CCing the author and reviewer of #9502.  In short, #9502 causes a segfault with the following code:\n\n```\nsage: V=(QQ^2).span_of_basis([[1,1]])\nsage: v=V([1,1])\nsage: x=sqrt(2)*v\nsage: 3*x # but we get a segfault when multiplying x by something\n\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n```\n\nDo you guys that did #9502 know what could have caused this?",
    "created_at": "2010-11-11T17:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95439",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:8" align="right">comment:8</div>

Okay, thanks to John Palmieri testing this out on various versions of Sage, I found that reverting #9502 fixes the issue.  I'm CCing the author and reviewer of #9502.  In short, #9502 causes a segfault with the following code:

```
sage: V=(QQ^2).span_of_basis([[1,1]])
sage: v=V([1,1])
sage: x=sqrt(2)*v
sage: 3*x # but we get a segfault when multiplying x by something


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------
```

Do you guys that did #9502 know what could have caused this?



---

archive/issue_comments_095440.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nNow I'm CCing the author/reviewer of #9502.  #9502 is causing a segfault now.  Please #10250 (this ticket) for details.  Do you have any idea of what is happening to cause the segfault?",
    "created_at": "2010-11-11T18:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95440",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:9" align="right">comment:9</div>

Now I'm CCing the author/reviewer of #9502.  #9502 is causing a segfault now.  Please #10250 (this ticket) for details.  Do you have any idea of what is happening to cause the segfault?



---

archive/issue_comments_095441.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI don't, never had issues with segfaults before... I'll look into it, but I am probably not the best person to solve this problem.",
    "created_at": "2010-11-11T18:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95441",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:10" align="right">comment:10</div>

I don't, never had issues with segfaults before... I'll look into it, but I am probably not the best person to solve this problem.



---

archive/issue_comments_095442.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe problem seems to be that the coercion ends up calling `__rmul__` (which is inherited) and not `_rmul_` (which is directly defined in `FreeModuleElement_generic_dense`:\n\n```\nsage: x\n(sqrt(2), sqrt(2))\nsage: x._rmul_(3)\n(3*sqrt(2), 3*sqrt(2))\nsage: x.__rmul__(3)\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\n```\n\nFor the record, stack backtrace:\n\n```\n#0  __cxxabiv1::__dynamic_cast (src_ptr=0x100000001, src_type=0x7fffd3a02f40, \n    dst_type=0x7fffd3a090c0, src2dst=0)\n    at ../../../../libstdc++-v3/libsupc++/dyncast.cc:54\n#1  0x00007fffd3224803 in is_a<GiNaC::relational> (__pyx_v_left=0x428c9e0, \n    __pyx_v_right=0x41b9d70, __pyx_skip_dispatch=<value optimized out>)\n    at /home/vbraun/Sage/sage/local/include/pynac/basic.h:305\n#2  is_a<GiNaC::relational> (__pyx_v_left=0x428c9e0, __pyx_v_right=0x41b9d70, \n    __pyx_skip_dispatch=<value optimized out>)\n    at /home/vbraun/Sage/sage/local/include/pynac/ex.h:939\n#3  __pyx_f_4sage_8symbolic_10expression_10Expression__mul_ (\n    __pyx_v_left=0x428c9e0, __pyx_v_right=0x41b9d70, \n    __pyx_skip_dispatch=<value optimized out>)\n    at sage/symbolic/expression.cpp:11284\n#4  0x00007fffe046a122 in __pyx_f_4sage_7modules_19free_module_element_31FreeModuleElement_generic_dense__rmul_ (__pyx_v_self=0x4289940, \n    __pyx_v_left=0x428c9e0, __pyx_skip_dispatch=<value optimized out>)\n    at sage/modules/free_module_element.c:15600\n#5  0x00007fffe992212c in __pyx_f_4sage_9structure_14coerce_actions_16LeftModuleAction__call_ (__pyx_v_self=0x72c410, __pyx_v_g=0x428c9e0, \n    __pyx_v_a=0x4289940, __pyx_skip_dispatch=<value optimized out>)\n    at sage/structure/coerce_actions.c:5437\n#6  0x00007fffe9d4e9a1 in __pyx_pf_4sage_10categories_6action_6Action_act (\n    __pyx_v_self=0x72c410, __pyx_args=0x412ce18, __pyx_kwds=0x0)\n    at sage/categories/action.c:2563\n#7  0x00007ffff7c7e3b3 in PyObject_Call (func=0x737098, \n    arg=<value optimized out>, kw=<value optimized out>)\n    at Objects/abstract.c:2492\n#8  0x00007fffe9927764 in __pyx_pf_4sage_9structure_14coerce_actions_12ModuleAction___init__ (__pyx_v_self=0x72c410, __pyx_args=<value optimized out>, \n    __pyx_kwds=<value optimized out>) at sage/structure/coerce_actions.c:5133\n#9  0x00007ffff7cd9f18 in type_call (type=<value optimized out>, \n    args=0x412d5f0, kwds=0x0) at Objects/typeobject.c:747\n#10 0x00007ffff7c7e3b3 in PyObject_Call (func=0x7fffe9b33de0, \n    arg=<value optimized out>, kw=<value optimized out>)\n    at Objects/abstract.c:2492\n#11 0x00007fffe992a52c in __pyx_pf_4sage_9structure_14coerce_actions_detect_element_action (__pyx_self=<value optimized out>, \n    __pyx_args=<value optimized out>, __pyx_kwds=<value optimized out>)\n    at sage/structure/coerce_actions.c:4184\n#12 0x00007ffff7c7e3b3 in PyObject_Call (func=0x1042d40, \n    arg=<value optimized out>, kw=<value optimized out>)\n    at Objects/abstract.c:2492\n#13 0x00007fffeae9d34f in __pyx_f_4sage_9structure_6parent_6Parent_discover_action (__pyx_v_self=0x42d27f0, __pyx_v_S=0x121e8e0, __pyx_v_op=0x1042d40, \n    __pyx_v_self_on_left=0) at sage/structure/parent.c:14710\n#14 0x00007fffeb0c5ecd in __pyx_f_4sage_9structure_10parent_old_6Parent_get_acti---Type <return> to continue, or q <return> to quit---\non_c_impl (__pyx_v_self=0x42d27f0, __pyx_v_S=<value optimized out>, \n    __pyx_v_op=<value optimized out>, \n    __pyx_v_self_on_left=<value optimized out>)\n    at sage/structure/parent_old.c:3254\n#15 0x00007fffeb0c7441 in __pyx_pf_4sage_9structure_10parent_old_6Parent_get_action_impl (__pyx_v_self=0x42d27f0, __pyx_args=<value optimized out>, \n    __pyx_kwds=<value optimized out>) at sage/structure/parent_old.c:3204\n#16 0x00007ffff7c7e3b3 in PyObject_Call (func=0x41abfc8, \n    arg=<value optimized out>, kw=<value optimized out>)\n    at Objects/abstract.c:2492\n#17 0x00007fffeb0cdeb2 in __pyx_f_4sage_9structure_10parent_old_6Parent_get_action_c (__pyx_v_self=0x42d27f0, __pyx_v_S=0x121e8e0, __pyx_v_op=0x78a1b8, \n    __pyx_v_self_on_left=0, __pyx_skip_dispatch=<value optimized out>)\n    at sage/structure/parent_old.c:2892\n#18 0x00007fffeb0c16c3 in __pyx_f_4sage_9structure_10parent_old_6Parent__get_action_ (__pyx_v_self=0x42d27f0, __pyx_v_other=0x121e8e0, \n    __pyx_v_op=<value optimized out>, \n    __pyx_v_self_on_left=<value optimized out>, \n    __pyx_skip_dispatch=<value optimized out>)\n    at sage/structure/parent_old.c:6069\n#19 0x00007fffeae9ab71 in __pyx_f_4sage_9structure_6parent_6Parent_get_action (\n    __pyx_v_self=0x42d27f0, __pyx_v_S=0x121e8e0, \n    __pyx_skip_dispatch=<value optimized out>, \n    __pyx_optional_args=<value optimized out>) at sage/structure/parent.c:13731\n#20 0x00007fffea5bf810 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_discover_action (__pyx_v_self=0x1043350, __pyx_v_R=0x121e8e0, \n    __pyx_v_S=0x42d27f0, __pyx_v_op=0x78a1b8, \n    __pyx_skip_dispatch=<value optimized out>) at sage/structure/coerce.c:11909\n#21 0x00007fffea5b2aca in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_get_action (__pyx_v_self=0x1043350, __pyx_v_R=0x121e8e0, \n    __pyx_v_S=0x42d27f0, __pyx_v_op=0x78a1b8, \n    __pyx_skip_dispatch=<value optimized out>) at sage/structure/coerce.c:10837\n#22 0x00007fffea5b5417 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_bin_op (__pyx_v_self=0x1043350, __pyx_v_x=0x3296bd0, \n    __pyx_v_y=0x4289c00, __pyx_v_op=0x78a1b8, \n    __pyx_skip_dispatch=<value optimized out>) at sage/structure/coerce.c:6080\n#23 0x00007fffea7f8c8d in __pyx_pf_4sage_9structure_7element_11RingElement___mul__ (__pyx_v_left=0x3296bd0, __pyx_v_right=0x4289c00)\n    at sage/structure/element.c:11399\n#24 0x00007ffff7c7998a in binary_op1 (v=0x3296bd0, w=0x4289c00, op_slot=16)\n    at Objects/abstract.c:917\n#25 0x00007ffff7c7c788 in PyNumber_Multiply (v=0x3296bd0, w=0x4289c00)\n    at Objects/abstract.c:1188\n#26 0x00007ffff7\n    throwflag=<value optimized out>) at Python/ceval.c:1118\n#27 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0x6fabe8, \n    globals=<value optimized out>, locals=<value optimized out>, \n    args=<value optimized out>, argcount=0, kws=<value optimized out>, \n    kwcount=0, defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:2968\n#28 0x00007ffff7d20802 in PyEval_EvalCode (co=<value optimized out>, \n    globals=<value optimized out>, locals=<value optimized out>)\n    at Python/ceval.c:522\n#29 0x00007ffff7d1f162 in exec_statement (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:4401\n#30 PyEval_EvalFrameEx (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:1717\n#31 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0xb13c60, \n    globals=<value optimized out>, locals=<value optimized out>, \n    args=<value optimized out>, argcount=2, kws=<value optimized out>, \n    kwcount=0, defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:2968\n#32 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:3802\n#33 call_function (f=<value optimized out>, throwflag=<value optimized out>)\n    at Python/ceval.c:3727\n#34 PyEval_EvalFrameEx (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:2389\n#35 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0xb13af8, \n    globals=<value optimized out>, locals=<value optimized out>, \n    args=<value optimized out>, argcount=3, kws=<value optimized out>, \n    kwcount=0, defs=0xb730f8, defcount=2, closure=0x0) at Python/ceval.c:2968\n#36 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:3802\n#37 call_function (f=<value optimized out>, throwflag=<value optimized out>)\n    at Python/ceval.c:3727\n#38 PyEval_EvalFrameEx (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:2389\n#39 0x00007ffff7d1fa7f in fast_function (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:3792\n#40 call_function (f=<value optimized out>, throwflag=<value optimized out>)\n    at Python/ceval.c:3727\n#41 PyEval_EvalFrameEx (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:2389\n#42 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0xb13300, \n    globals=<value optimized out>, locals=<value optimized out>, \n    args=<value optimized out>, argcount=2, kws=<value optimized out>, \n    kwcount=0, defs=0xb6c868, defcount=1, closure=0x0) at Python/ceval.c:2968\n#43 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:3802\n#44 call_function (f=<value optimized out>, throwflag=<value optimized out>)\n    at Python/ceval.c:3727\n#45 PyEval_EvalFrameEx (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:2389\n#46 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0xb10cd8, \n    globals=<value optimized out>, locals=<value optimized out>, \n    args=<value optimized out>, argcount=2, kws=<value optimized out>, \n    kwcount=0, defs=0xb6c828, defcount=1, closure=0x0) at Python/ceval.c:2968\n#47 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:3802\n#48 call_function (f=<value optimized out>, throwflag=<value optimized out>)\n    at Python/ceval.c:3727\n#49 PyEval_EvalFrameEx (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:2389\n#50 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0x931f30, \n    globals=<value optimized out>, locals=<value optimized out>, \n    args=<value optimized out>, argcount=1, kws=<value optimized out>, \n    kwcount=2, defs=0x93d8d8, defcount=2, closure=0x0) at Python/ceval.c:2968\n#51 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:3802\n#52 call_function (f=<value optimized out>, throwflag=<value optimized out>)\n    at Python/ceval.c:3727\n#53 PyEval_EvalFrameEx (f=<value optimized out>, \n    throwflag=<value optimized out>) at Python/ceval.c:2389\n#54 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0x6da378, \n    globals=<value optimized out>, locals=<value optimized out>, \n    args=<value optimized out>, argcount=0, kws=<value optimized out>, \n    kwcount=0, defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:2968\n#55 0x00007ffff7d20802 in PyEval_EvalCode (co=<value optimized out>, \n    globals=<value optimized out>, locals=<value optimized out>)\n    at Python/ceval.c:522\n#56 0x00007ffff7d42600 in run_mod (fp=0x625830, \n    filename=<value optimized out>, start=<value optimized out>, \n    globals=0x63c080, locals=0x63c080, closeit=0, flags=0x7fffffffd8b0)\n    at Python/pythonrun.c:1335\n#57 PyRun_FileExFlags (fp=0x625830, filename=<value optimized out>, \n    start=<value optimized out>, globals=0x63c080, locals=0x63c080, closeit=0, \n    flags=0x7fffffffd8b0) at Python/pythonrun.c:1321\n#58 0x00007ffff7d430cf in PyRun_SimpleFileExFlags (fp=0x625830, \n    filename=0x7fffffffeac3 \"/home/vbraun/Sage/sage/local/bin/sage-ipython\", \n    closeit=0, flags=0x7fffffffd8b0) at Python/pythonrun.c:931\n#59 0x00007ffff7d5205b in RunStartupFile (argc=<value optimized out>, \n    argv=0x7fffffffd9d8) at Modules/main.c:142\n#60 Py_Main (argc=<value optimized out>, argv=0x7fffffffd9d8)\n    at Modules/main.c:558\n#61 0x000000381a81ee7d in __libc_start_main (main=0x400710 <main>, argc=2, \n    ubp_av\n    fini=<value optimized out>, rtld_fini=<value optimized out>, \n    stack_end=0x7fffffffd9c8) at libc-start.c:226\n#62 0x0000000000400649 in _start ()\n```",
    "created_at": "2010-11-11T18:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95442",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

The problem seems to be that the coercion ends up calling `__rmul__` (which is inherited) and not `_rmul_` (which is directly defined in `FreeModuleElement_generic_dense`:

```
sage: x
(sqrt(2), sqrt(2))
sage: x._rmul_(3)
(3*sqrt(2), 3*sqrt(2))
sage: x.__rmul__(3)
------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
```

For the record, stack backtrace:

```
#0  __cxxabiv1::__dynamic_cast (src_ptr=0x100000001, src_type=0x7fffd3a02f40, 
    dst_type=0x7fffd3a090c0, src2dst=0)
    at ../../../../libstdc++-v3/libsupc++/dyncast.cc:54
#1  0x00007fffd3224803 in is_a<GiNaC::relational> (__pyx_v_left=0x428c9e0, 
    __pyx_v_right=0x41b9d70, __pyx_skip_dispatch=<value optimized out>)
    at /home/vbraun/Sage/sage/local/include/pynac/basic.h:305
#2  is_a<GiNaC::relational> (__pyx_v_left=0x428c9e0, __pyx_v_right=0x41b9d70, 
    __pyx_skip_dispatch=<value optimized out>)
    at /home/vbraun/Sage/sage/local/include/pynac/ex.h:939
#3  __pyx_f_4sage_8symbolic_10expression_10Expression__mul_ (
    __pyx_v_left=0x428c9e0, __pyx_v_right=0x41b9d70, 
    __pyx_skip_dispatch=<value optimized out>)
    at sage/symbolic/expression.cpp:11284
#4  0x00007fffe046a122 in __pyx_f_4sage_7modules_19free_module_element_31FreeModuleElement_generic_dense__rmul_ (__pyx_v_self=0x4289940, 
    __pyx_v_left=0x428c9e0, __pyx_skip_dispatch=<value optimized out>)
    at sage/modules/free_module_element.c:15600
#5  0x00007fffe992212c in __pyx_f_4sage_9structure_14coerce_actions_16LeftModuleAction__call_ (__pyx_v_self=0x72c410, __pyx_v_g=0x428c9e0, 
    __pyx_v_a=0x4289940, __pyx_skip_dispatch=<value optimized out>)
    at sage/structure/coerce_actions.c:5437
#6  0x00007fffe9d4e9a1 in __pyx_pf_4sage_10categories_6action_6Action_act (
    __pyx_v_self=0x72c410, __pyx_args=0x412ce18, __pyx_kwds=0x0)
    at sage/categories/action.c:2563
#7  0x00007ffff7c7e3b3 in PyObject_Call (func=0x737098, 
    arg=<value optimized out>, kw=<value optimized out>)
    at Objects/abstract.c:2492
#8  0x00007fffe9927764 in __pyx_pf_4sage_9structure_14coerce_actions_12ModuleAction___init__ (__pyx_v_self=0x72c410, __pyx_args=<value optimized out>, 
    __pyx_kwds=<value optimized out>) at sage/structure/coerce_actions.c:5133
#9  0x00007ffff7cd9f18 in type_call (type=<value optimized out>, 
    args=0x412d5f0, kwds=0x0) at Objects/typeobject.c:747
#10 0x00007ffff7c7e3b3 in PyObject_Call (func=0x7fffe9b33de0, 
    arg=<value optimized out>, kw=<value optimized out>)
    at Objects/abstract.c:2492
#11 0x00007fffe992a52c in __pyx_pf_4sage_9structure_14coerce_actions_detect_element_action (__pyx_self=<value optimized out>, 
    __pyx_args=<value optimized out>, __pyx_kwds=<value optimized out>)
    at sage/structure/coerce_actions.c:4184
#12 0x00007ffff7c7e3b3 in PyObject_Call (func=0x1042d40, 
    arg=<value optimized out>, kw=<value optimized out>)
    at Objects/abstract.c:2492
#13 0x00007fffeae9d34f in __pyx_f_4sage_9structure_6parent_6Parent_discover_action (__pyx_v_self=0x42d27f0, __pyx_v_S=0x121e8e0, __pyx_v_op=0x1042d40, 
    __pyx_v_self_on_left=0) at sage/structure/parent.c:14710
#14 0x00007fffeb0c5ecd in __pyx_f_4sage_9structure_10parent_old_6Parent_get_acti---Type <return> to continue, or q <return> to quit---
on_c_impl (__pyx_v_self=0x42d27f0, __pyx_v_S=<value optimized out>, 
    __pyx_v_op=<value optimized out>, 
    __pyx_v_self_on_left=<value optimized out>)
    at sage/structure/parent_old.c:3254
#15 0x00007fffeb0c7441 in __pyx_pf_4sage_9structure_10parent_old_6Parent_get_action_impl (__pyx_v_self=0x42d27f0, __pyx_args=<value optimized out>, 
    __pyx_kwds=<value optimized out>) at sage/structure/parent_old.c:3204
#16 0x00007ffff7c7e3b3 in PyObject_Call (func=0x41abfc8, 
    arg=<value optimized out>, kw=<value optimized out>)
    at Objects/abstract.c:2492
#17 0x00007fffeb0cdeb2 in __pyx_f_4sage_9structure_10parent_old_6Parent_get_action_c (__pyx_v_self=0x42d27f0, __pyx_v_S=0x121e8e0, __pyx_v_op=0x78a1b8, 
    __pyx_v_self_on_left=0, __pyx_skip_dispatch=<value optimized out>)
    at sage/structure/parent_old.c:2892
#18 0x00007fffeb0c16c3 in __pyx_f_4sage_9structure_10parent_old_6Parent__get_action_ (__pyx_v_self=0x42d27f0, __pyx_v_other=0x121e8e0, 
    __pyx_v_op=<value optimized out>, 
    __pyx_v_self_on_left=<value optimized out>, 
    __pyx_skip_dispatch=<value optimized out>)
    at sage/structure/parent_old.c:6069
#19 0x00007fffeae9ab71 in __pyx_f_4sage_9structure_6parent_6Parent_get_action (
    __pyx_v_self=0x42d27f0, __pyx_v_S=0x121e8e0, 
    __pyx_skip_dispatch=<value optimized out>, 
    __pyx_optional_args=<value optimized out>) at sage/structure/parent.c:13731
#20 0x00007fffea5bf810 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_discover_action (__pyx_v_self=0x1043350, __pyx_v_R=0x121e8e0, 
    __pyx_v_S=0x42d27f0, __pyx_v_op=0x78a1b8, 
    __pyx_skip_dispatch=<value optimized out>) at sage/structure/coerce.c:11909
#21 0x00007fffea5b2aca in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_get_action (__pyx_v_self=0x1043350, __pyx_v_R=0x121e8e0, 
    __pyx_v_S=0x42d27f0, __pyx_v_op=0x78a1b8, 
    __pyx_skip_dispatch=<value optimized out>) at sage/structure/coerce.c:10837
#22 0x00007fffea5b5417 in __pyx_f_4sage_9structure_6coerce_24CoercionModel_cache_maps_bin_op (__pyx_v_self=0x1043350, __pyx_v_x=0x3296bd0, 
    __pyx_v_y=0x4289c00, __pyx_v_op=0x78a1b8, 
    __pyx_skip_dispatch=<value optimized out>) at sage/structure/coerce.c:6080
#23 0x00007fffea7f8c8d in __pyx_pf_4sage_9structure_7element_11RingElement___mul__ (__pyx_v_left=0x3296bd0, __pyx_v_right=0x4289c00)
    at sage/structure/element.c:11399
#24 0x00007ffff7c7998a in binary_op1 (v=0x3296bd0, w=0x4289c00, op_slot=16)
    at Objects/abstract.c:917
#25 0x00007ffff7c7c788 in PyNumber_Multiply (v=0x3296bd0, w=0x4289c00)
    at Objects/abstract.c:1188
#26 0x00007ffff7
    throwflag=<value optimized out>) at Python/ceval.c:1118
#27 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0x6fabe8, 
    globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=0, kws=<value optimized out>, 
    kwcount=0, defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:2968
#28 0x00007ffff7d20802 in PyEval_EvalCode (co=<value optimized out>, 
    globals=<value optimized out>, locals=<value optimized out>)
    at Python/ceval.c:522
#29 0x00007ffff7d1f162 in exec_statement (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:4401
#30 PyEval_EvalFrameEx (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:1717
#31 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0xb13c60, 
    globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=<value optimized out>, 
    kwcount=0, defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:2968
#32 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:3802
#33 call_function (f=<value optimized out>, throwflag=<value optimized out>)
    at Python/ceval.c:3727
#34 PyEval_EvalFrameEx (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:2389
#35 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0xb13af8, 
    globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=3, kws=<value optimized out>, 
    kwcount=0, defs=0xb730f8, defcount=2, closure=0x0) at Python/ceval.c:2968
#36 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:3802
#37 call_function (f=<value optimized out>, throwflag=<value optimized out>)
    at Python/ceval.c:3727
#38 PyEval_EvalFrameEx (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:2389
#39 0x00007ffff7d1fa7f in fast_function (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:3792
#40 call_function (f=<value optimized out>, throwflag=<value optimized out>)
    at Python/ceval.c:3727
#41 PyEval_EvalFrameEx (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:2389
#42 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0xb13300, 
    globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=<value optimized out>, 
    kwcount=0, defs=0xb6c868, defcount=1, closure=0x0) at Python/ceval.c:2968
#43 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:3802
#44 call_function (f=<value optimized out>, throwflag=<value optimized out>)
    at Python/ceval.c:3727
#45 PyEval_EvalFrameEx (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:2389
#46 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0xb10cd8, 
    globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=2, kws=<value optimized out>, 
    kwcount=0, defs=0xb6c828, defcount=1, closure=0x0) at Python/ceval.c:2968
#47 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:3802
#48 call_function (f=<value optimized out>, throwflag=<value optimized out>)
    at Python/ceval.c:3727
#49 PyEval_EvalFrameEx (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:2389
#50 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0x931f30, 
    globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=1, kws=<value optimized out>, 
    kwcount=2, defs=0x93d8d8, defcount=2, closure=0x0) at Python/ceval.c:2968
#51 0x00007ffff7d1e8de in fast_function (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:3802
#52 call_function (f=<value optimized out>, throwflag=<value optimized out>)
    at Python/ceval.c:3727
#53 PyEval_EvalFrameEx (f=<value optimized out>, 
    throwflag=<value optimized out>) at Python/ceval.c:2389
#54 0x00007ffff7d2072c in PyEval_EvalCodeEx (co=0x6da378, 
    globals=<value optimized out>, locals=<value optimized out>, 
    args=<value optimized out>, argcount=0, kws=<value optimized out>, 
    kwcount=0, defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:2968
#55 0x00007ffff7d20802 in PyEval_EvalCode (co=<value optimized out>, 
    globals=<value optimized out>, locals=<value optimized out>)
    at Python/ceval.c:522
#56 0x00007ffff7d42600 in run_mod (fp=0x625830, 
    filename=<value optimized out>, start=<value optimized out>, 
    globals=0x63c080, locals=0x63c080, closeit=0, flags=0x7fffffffd8b0)
    at Python/pythonrun.c:1335
#57 PyRun_FileExFlags (fp=0x625830, filename=<value optimized out>, 
    start=<value optimized out>, globals=0x63c080, locals=0x63c080, closeit=0, 
    flags=0x7fffffffd8b0) at Python/pythonrun.c:1321
#58 0x00007ffff7d430cf in PyRun_SimpleFileExFlags (fp=0x625830, 
    filename=0x7fffffffeac3 "/home/vbraun/Sage/sage/local/bin/sage-ipython", 
    closeit=0, flags=0x7fffffffd8b0) at Python/pythonrun.c:931
#59 0x00007ffff7d5205b in RunStartupFile (argc=<value optimized out>, 
    argv=0x7fffffffd9d8) at Modules/main.c:142
#60 Py_Main (argc=<value optimized out>, argv=0x7fffffffd9d8)
    at Modules/main.c:558
#61 0x000000381a81ee7d in __libc_start_main (main=0x400710 <main>, argc=2, 
    ubp_av
    fini=<value optimized out>, rtld_fini=<value optimized out>, 
    stack_end=0x7fffffffd9c8) at libc-start.c:226
#62 0x0000000000400649 in _start ()
```



---

archive/issue_comments_095443.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nNo, it's deeper than that.  `__rmul__` should call the right coercion stuff so that `_rmul_` is eventually called.  So far, I've traced it down to this:\n\n```\nsage: p=x.parent()\nsage: p.get_action(3.parent(), operator.mul,False)\n\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n\n\n```",
    "created_at": "2010-11-11T23:40:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95443",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:12" align="right">comment:12</div>

No, it's deeper than that.  `__rmul__` should call the right coercion stuff so that `_rmul_` is eventually called.  So far, I've traced it down to this:

```
sage: p=x.parent()
sage: p.get_action(3.parent(), operator.mul,False)


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------


```



---

archive/issue_comments_095444.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nActually, I think something is wrong with the parent:\n\n```\nsage: x.parent().an_element()\n(1, 1)\nsage: x.parent().an_element().__mul__(3)\n(0/0, 0/0)\n```",
    "created_at": "2010-11-12T00:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95444",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

Actually, I think something is wrong with the parent:

```
sage: x.parent().an_element()
(1, 1)
sage: x.parent().an_element().__mul__(3)
(0/0, 0/0)
```



---

archive/issue_comments_095445.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI think that the appropriate action is not getting registered (which is a problem with the parent), leading to all sorts of weirdness as the coercion system tries to do things.  It can't register the action because when it asks for the action (using the get_action method of the parent), it segfaults.\n\n```\nsage: v.parent().get_action(3.parent(), operator.mul, False)\nLeft scalar multiplication by Integer Ring on Vector space of degree 2 and dimension 1 over Rational Field\nUser basis matrix:\n[1 1]\nsage: x.parent().get_action(3.parent(), operator.mul, False)\n\n\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n\n```",
    "created_at": "2010-11-12T00:29:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95445",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:14" align="right">comment:14</div>

I think that the appropriate action is not getting registered (which is a problem with the parent), leading to all sorts of weirdness as the coercion system tries to do things.  It can't register the action because when it asks for the action (using the get_action method of the parent), it segfaults.

```
sage: v.parent().get_action(3.parent(), operator.mul, False)
Left scalar multiplication by Integer Ring on Vector space of degree 2 and dimension 1 over Rational Field
User basis matrix:
[1 1]
sage: x.parent().get_action(3.parent(), operator.mul, False)


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------

```



---

archive/issue_comments_095446.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nCarefully looking at my patch at #9502, I found that I skipped one conversion. I posted a patch that restores it and gives\n\n```\nsage: sage: V=(QQ^2).span_of_basis([[1,1]])\nsage: sage: v=V([1,1])\nsage: sage: w=sqrt(2)*v\nsage: sage: 3*w\n(3*sqrt(2), 3*sqrt(2))\n```\nBut I don't yet understand why the single conversion is not good enough.",
    "created_at": "2010-11-12T01:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95446",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:15" align="right">comment:15</div>

Carefully looking at my patch at #9502, I found that I skipped one conversion. I posted a patch that restores it and gives

```
sage: sage: V=(QQ^2).span_of_basis([[1,1]])
sage: sage: v=V([1,1])
sage: sage: w=sqrt(2)*v
sage: sage: 3*w
(3*sqrt(2), 3*sqrt(2))
```
But I don't yet understand why the single conversion is not good enough.



---

archive/issue_comments_095447.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nYeah, I just found that if you add\n\n```\n        if check:\n            V = ambient.vector_space()\n            basis = [V(x) for x in basis]\n```\nright before the if check block, things work.  Notice that V is ambient.vector_space() in this case, rather than ambient.ambient_vector_space().  I bet that's the difference.",
    "created_at": "2010-11-12T01:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95447",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:16" align="right">comment:16</div>

Yeah, I just found that if you add

```
        if check:
            V = ambient.vector_space()
            basis = [V(x) for x in basis]
```
right before the if check block, things work.  Notice that V is ambient.vector_space() in this case, rather than ambient.ambient_vector_space().  I bet that's the difference.



---

archive/issue_comments_095448.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWe should also add a doctest to the patch.",
    "created_at": "2010-11-12T01:47:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95448",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:17" align="right">comment:17</div>

We should also add a doctest to the patch.



---

archive/issue_events_133197.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-12T01:47:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133197"
}
```



---

archive/issue_comments_095449.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jasongrout](#comment%3A17):\n> We should also add a doctest to the patch.\n\nI am not sure that this is a satisfactory solution - why converting x into the ambient vector space is not the same as converting it into the spanned vector space and then into the ambient vector space?",
    "created_at": "2010-11-12T01:53:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95449",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jasongrout](#comment%3A17):
> We should also add a doctest to the patch.

I am not sure that this is a satisfactory solution - why converting x into the ambient vector space is not the same as converting it into the spanned vector space and then into the ambient vector space?



---

archive/issue_comments_095450.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI think I see the problem.  Here is the code in question:\n\n```\n        if check:\n            V = ambient.ambient_vector_space()\n            for i in range(len(basis)):\n                x = basis[i]\n                if x not in V:\n                    try:\n                        basis[i] = V(x)\n                    except TypeError:\n                        raise TypeError(\"each element of basis must be in \"\n                                        \"the ambient vector space\")\n```\n\nNotice that a basis element is only converted to V if it's not already in V.  The problem is that the test \"x in V\" may succeed, even if x is not a vector in V.  In this case, when you try to construct a basis vector for SR<sup>2</sup>, you're handed the vector (1,1) as a rational vector.  The test \"x not in V\" fails, since the rational vector (1,1) *is* in V.  So it is put in as a basis vector.  You need the initial conversion to first convert vectors to the same type of vectors as live in V, because you need those basis elements to actually be vectors with parent SR<sup>2</sup>.\n\nI.e., we are handed a basis vector in QQ<sup>2</sup>, and we fail to convert it to a vector in SR<sup>2</sup> because the if statement fails:\n\n```\nsage: (QQ^2)([1,1]) not in (SR^2)\nFalse\n```\n\nThe initial conversion using ambient.ambient_vector_space is to ensure that the vectors are actually vectors in SR<sup>2</sup> (in this case).",
    "created_at": "2010-11-12T01:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95450",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:19" align="right">comment:19</div>

I think I see the problem.  Here is the code in question:

```
        if check:
            V = ambient.ambient_vector_space()
            for i in range(len(basis)):
                x = basis[i]
                if x not in V:
                    try:
                        basis[i] = V(x)
                    except TypeError:
                        raise TypeError("each element of basis must be in "
                                        "the ambient vector space")
```

Notice that a basis element is only converted to V if it's not already in V.  The problem is that the test "x in V" may succeed, even if x is not a vector in V.  In this case, when you try to construct a basis vector for SR<sup>2</sup>, you're handed the vector (1,1) as a rational vector.  The test "x not in V" fails, since the rational vector (1,1) *is* in V.  So it is put in as a basis vector.  You need the initial conversion to first convert vectors to the same type of vectors as live in V, because you need those basis elements to actually be vectors with parent SR<sup>2</sup>.

I.e., we are handed a basis vector in QQ<sup>2</sup>, and we fail to convert it to a vector in SR<sup>2</sup> because the if statement fails:

```
sage: (QQ^2)([1,1]) not in (SR^2)
False
```

The initial conversion using ambient.ambient_vector_space is to ensure that the vectors are actually vectors in SR<sup>2</sup> (in this case).



---

archive/issue_comments_095451.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAh, now I see. Thank you for the clarification, I'll write a proper patch and post it shortly.",
    "created_at": "2010-11-12T02:02:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95451",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:20" align="right">comment:20</div>

Ah, now I see. Thank you for the clarification, I'll write a proper patch and post it shortly.



---

archive/issue_comments_095452.json:
```json
{
    "body": "Attachment: **[trac_10250_fix_conversion_in_submodule_constructor.patch.gz](https://github.com/sagemath/sage/files/ticket10250/trac_10250_fix_conversion_in_submodule_constructor.patch.gz)**\n\nApply this patch only.",
    "created_at": "2010-11-12T02:16:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95452",
    "user": "https://github.com/novoselt"
}
```

Attachment: **[trac_10250_fix_conversion_in_submodule_constructor.patch.gz](https://github.com/sagemath/sage/files/ticket10250/trac_10250_fix_conversion_in_submodule_constructor.patch.gz)**

Apply this patch only.



---

archive/issue_events_133198.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-11-12T02:19:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133198"
}
```



---

archive/issue_events_133199.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-11-12T02:19:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133199"
}
```



---

archive/issue_comments_095453.json:
```json
{
    "body": "Author: **Andrey Novoseltsev**",
    "created_at": "2010-11-12T02:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95453",
    "user": "https://github.com/novoselt"
}
```

Author: **Andrey Novoseltsev**



---

archive/issue_comments_095454.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nInstead of adding previously removed code I removed some more, now it works and is easier to understand ;-) Didn't run full library tests yet but will do it now and report if there are any issues.",
    "created_at": "2010-11-12T02:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95454",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:21" align="right">comment:21</div>

Instead of adding previously removed code I removed some more, now it works and is easier to understand ;-) Didn't run full library tests yet but will do it now and report if there are any issues.



---

archive/issue_events_133200.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-11-12T02:19:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133200"
}
```



---

archive/issue_events_133201.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-11-12T02:19:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133201"
}
```



---

archive/issue_comments_095455.json:
```json
{
    "body": "Reviewer: **Jason Grout**",
    "created_at": "2010-11-12T02:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95455",
    "user": "https://github.com/jasongrout"
}
```

Reviewer: **Jason Grout**



---

archive/issue_comments_095456.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI think the new patch looks correct.  Thanks for your work on this!",
    "created_at": "2010-11-12T02:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95456",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:22" align="right">comment:22</div>

I think the new patch looks correct.  Thanks for your work on this!



---

archive/issue_comments_095457.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nTests pass in the modules/ directory.  So if tests pass on the full test suite, please set this to positive review.\n\nThanks again!",
    "created_at": "2010-11-12T02:33:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95457",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:23" align="right">comment:23</div>

Tests pass in the modules/ directory.  So if tests pass on the full test suite, please set this to positive review.

Thanks again!



---

archive/issue_events_133202.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-12T02:33:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "milestone_number": null,
    "milestone_title": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133202"
}
```



---

archive/issue_comments_095458.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThere will be some delay, as sage.math gets out of memory (not because of this patch ;-))",
    "created_at": "2010-11-12T02:56:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95458",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:24" align="right">comment:24</div>

There will be some delay, as sage.math gets out of memory (not because of this patch ;-))



---

archive/issue_comments_095459.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOK, all long tests pass on mod.math, so I am switching it to \"positive review.\"",
    "created_at": "2010-11-12T03:48:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95459",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:25" align="right">comment:25</div>

OK, all long tests pass on mod.math, so I am switching it to "positive review."



---

archive/issue_events_133203.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-11-12T03:48:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133203"
}
```



---

archive/issue_events_133204.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-11-12T03:48:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133204"
}
```



---

archive/issue_comments_095460.json:
```json
{
    "body": "Changed author from **Andrey Novoseltsev** to **Andrey Novoseltsev, Jason Grout**",
    "created_at": "2010-11-13T01:46:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95460",
    "user": "https://github.com/jasongrout"
}
```

Changed author from **Andrey Novoseltsev** to **Andrey Novoseltsev, Jason Grout**



---

archive/issue_comments_095461.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI think we both came up with the solution independently and worked with each other on authoring and checking each other on this, so I'm putting both of us as authors and reviewers (with Andrey as the primary author and me as the primary reviewer).",
    "created_at": "2010-11-13T01:46:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95461",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:26" align="right">comment:26</div>

I think we both came up with the solution independently and worked with each other on authoring and checking each other on this, so I'm putting both of us as authors and reviewers (with Andrey as the primary author and me as the primary reviewer).



---

archive/issue_comments_095462.json:
```json
{
    "body": "Changed reviewer from **Jason Grout** to **Jason Grout, Andrey Novoseltsev**",
    "created_at": "2010-11-13T01:46:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95462",
    "user": "https://github.com/jasongrout"
}
```

Changed reviewer from **Jason Grout** to **Jason Grout, Andrey Novoseltsev**



---

archive/issue_comments_095463.json:
```json
{
    "body": "Merged: **sage-4.6.1.alpha2**",
    "created_at": "2010-11-15T23:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10250#issuecomment-95463",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.6.1.alpha2**



---

archive/issue_events_133205.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-15T23:25:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133205"
}
```



---

archive/issue_events_133206.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-15T23:25:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10250",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10250#event-133206"
}
```
