# Issue 10364: Vector constructor improvements

archive/issues_010363.json:
```json
{
    "body": "Patch creates a `zero_vector` constructor, mirroring the `zero_matrix` constructor.  It adds error-checking to the `vector` constructor for the case of a negative degree.  \n\nFinally, it adds a new, more informative error message when a dictionary is used for the entries of a (sparse) vector and a degree is given.  Presently, the following syntax executes without an error, though the result would not be what we should expect.  This \"works\" since the dictionary has \"length\" 3.\n\n```\nsage: vector(QQ, 3, {0:0, 2:5, 12:-1})\n(0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1)\n```\n\nThis could be improved further by adjusting the `prepare_dict` method to accept an optional integer degree for the number of entries.  Then instead of an error we could have the (fictional) behavior:\n\n```\nsage: vector(QQ, 6, {1:2, 4:-3})\n(0, 2, 0, 0, -3, 0)\n```\n\nThis depends on #10362 since one doctest there has changed in this patch.\n\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @jasongrout\n\n**Author:** Rob Beezer\n\n**Reviewer:** Andrey Novoseltsev\n\n**Merged:** sage-4.6.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/10364\n\n",
    "closed_at": "2011-01-12T06:39:19Z",
    "created_at": "2010-12-02T04:02:56Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Vector constructor improvements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10364",
    "user": "https://github.com/rbeezer"
}
```
Patch creates a `zero_vector` constructor, mirroring the `zero_matrix` constructor.  It adds error-checking to the `vector` constructor for the case of a negative degree.  

Finally, it adds a new, more informative error message when a dictionary is used for the entries of a (sparse) vector and a degree is given.  Presently, the following syntax executes without an error, though the result would not be what we should expect.  This "works" since the dictionary has "length" 3.

```
sage: vector(QQ, 3, {0:0, 2:5, 12:-1})
(0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1)
```

This could be improved further by adjusting the `prepare_dict` method to accept an optional integer degree for the number of entries.  Then instead of an error we could have the (fictional) behavior:

```
sage: vector(QQ, 6, {1:2, 4:-3})
(0, 2, 0, 0, -3, 0)
```

This depends on #10362 since one doctest there has changed in this patch.


**Assignee:** @jasongrout, @williamstein

**CC:**  @jasongrout

**Author:** Rob Beezer

**Reviewer:** Andrey Novoseltsev

**Merged:** sage-4.6.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/10364





---

archive/attachments_013576.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10364-zero-vector-constructor.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10364/trac_10364-zero-vector-constructor.patch",
    "created_at": "2010-12-02T04:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_101125.json:
```json
{
    "body": "<a id='comment:1'></a>\n",
    "created_at": "2010-12-02T04:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101125",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:1'></a>




---

archive/issue_events_081286.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2010-12-02T04:15:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81286"
}
```



---

archive/issue_events_081287.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-03T00:41:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81287"
}
```



---

archive/issue_events_081288.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-03T00:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81288"
}
```



---

archive/issue_comments_101126.json:
```json
{
    "body": "<a id='comment:3'></a>\nWhy is it an error to specify the degree of a vector when entries are given as a dictionary? To me it makes more sense to give explicit degree in this case (and avoid unnatural addition of the \"terminal element\") rather than when entries are packed into a list. I propose that if the degree is given, a vector of this degree is constructed and if the dictionary contains any keys above the degree an exception is raised.",
    "created_at": "2010-12-03T00:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101126",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:3'></a>
Why is it an error to specify the degree of a vector when entries are given as a dictionary? To me it makes more sense to give explicit degree in this case (and avoid unnatural addition of the "terminal element") rather than when entries are packed into a list. I propose that if the degree is given, a vector of this degree is constructed and if the dictionary contains any keys above the degree an exception is raised.



---

archive/issue_comments_101127.json:
```json
{
    "body": "<a id='comment:4'></a>\nGiving the degree and giving the entries as a dictionary gives an error (or an unexpected result) in the unpatched state and probably has for a long time.  The problem is that you could always give a degree, though this was totally undocumented.  When a degree is given, it checks for the length of the entries.  For a dictionary this goes boom, or coincidentally passes this check and behaves poorly.  On #10362 I was trying to mostly document the degree possibility.\n\nCurrent patch makes it so that a degree/dictionary call will *always* give an exception.  So it is an improvement.  I agree 100% that your suggestion is the *right* thing to do long-term, and I can see where and how to do it.\n\nHowever, I am on a mission to clean up as much of the linear algebra code that is wrong or missing and trying not to make any one ticket too involved (explanation on sage-devel soon).  I'd be happy to document the current behavior and an outline of a fix (your ideas on exceptions are perfect) on another ticket.  Would it be OK if I moved this to another ticket?\n\nThanks, \nRob",
    "created_at": "2010-12-03T01:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101127",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:4'></a>
Giving the degree and giving the entries as a dictionary gives an error (or an unexpected result) in the unpatched state and probably has for a long time.  The problem is that you could always give a degree, though this was totally undocumented.  When a degree is given, it checks for the length of the entries.  For a dictionary this goes boom, or coincidentally passes this check and behaves poorly.  On #10362 I was trying to mostly document the degree possibility.

Current patch makes it so that a degree/dictionary call will *always* give an exception.  So it is an improvement.  I agree 100% that your suggestion is the *right* thing to do long-term, and I can see where and how to do it.

However, I am on a mission to clean up as much of the linear algebra code that is wrong or missing and trying not to make any one ticket too involved (explanation on sage-devel soon).  I'd be happy to document the current behavior and an outline of a fix (your ideas on exceptions are perfect) on another ticket.  Would it be OK if I moved this to another ticket?

Thanks, 
Rob



---

archive/issue_comments_101128.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [rbeezer](#comment%3A4):\n> However, I am on a mission to clean up as much of the linear algebra code that is wrong or missing and trying not to make any one ticket too involved (explanation on sage-devel soon).  I'd be happy to document the current behavior and an outline of a fix (your ideas on exceptions are perfect) on another ticket.  Would it be OK if I moved this to another ticket?\n\n\nSure, let it be another ticket. I thought that it is an easy change but I didn't actually look at the relevant code.",
    "created_at": "2010-12-03T04:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101128",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>
Replying to [rbeezer](#comment%3A4):
> However, I am on a mission to clean up as much of the linear algebra code that is wrong or missing and trying not to make any one ticket too involved (explanation on sage-devel soon).  I'd be happy to document the current behavior and an outline of a fix (your ideas on exceptions are perfect) on another ticket.  Would it be OK if I moved this to another ticket?


Sure, let it be another ticket. I thought that it is an easy change but I didn't actually look at the relevant code.



---

archive/issue_events_081289.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-03T04:36:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81289"
}
```



---

archive/issue_events_081290.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-03T04:36:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81290"
}
```



---

archive/issue_comments_101129.json:
```json
{
    "body": "<a id='comment:6'></a>\nI don't quite like error-checking in `zero_vector` because I think that it belongs to the general vector constructor. I think code like\n\n```\ndef zero_vector(arg0, arg1=None):\n    if arg1 is None:\n        arg0, arg1 = ZZ, arg0\n    return vector(arg0, arg1)\n```\nwould be better for uniform input handling. (Maybe it would even make sense to get zero integer vector from `vector(5)`, but that's a bigger change.)\n\nI guess also that the list in CALL FORMAT has the issue with INPUT right under it as on #10362.",
    "created_at": "2010-12-03T05:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101129",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>
I don't quite like error-checking in `zero_vector` because I think that it belongs to the general vector constructor. I think code like

```
def zero_vector(arg0, arg1=None):
    if arg1 is None:
        arg0, arg1 = ZZ, arg0
    return vector(arg0, arg1)
```
would be better for uniform input handling. (Maybe it would even make sense to get zero integer vector from `vector(5)`, but that's a bigger change.)

I guess also that the list in CALL FORMAT has the issue with INPUT right under it as on #10362.



---

archive/issue_comments_101130.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [novoselt](#comment%3A6):\n> I don't quite like error-checking in `zero_vector` because I think that it belongs to the general vector constructor.\n\n\nI agree that using the error-checking code from the more general `vector` constructor would be best.  But the `vector()` constructor is so permissive and accepts such a variety of input, that I think any input to a new `zero_vector` *must* get scrutinized (and then report the problem).  Here's the example and test:\n\n```\ndef mock_zero_vector(arg0, arg1=None):\n    if arg1 is None:\n        arg0, arg1 = sage.rings.integer_ring.IntegerRing(), arg0\n    return vector(arg0, arg1)\n```\n\n```\nsage: v = sage.modules.free_module_element.mock_zero_vector([1,2,3])\nsage: v\n(1, 2, 3)\n```\n\nAt least one check is being made in the general constructor - seeing if the proposed degree is negative.\n\n> I guess also that the list in CALL FORMAT has the issue with INPUT right under it as on #10362.\n\n\nYes, I'll get to this with any other changes.  Thanks.\n\nRob",
    "created_at": "2010-12-03T19:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101130",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>
Replying to [novoselt](#comment%3A6):
> I don't quite like error-checking in `zero_vector` because I think that it belongs to the general vector constructor.


I agree that using the error-checking code from the more general `vector` constructor would be best.  But the `vector()` constructor is so permissive and accepts such a variety of input, that I think any input to a new `zero_vector` *must* get scrutinized (and then report the problem).  Here's the example and test:

```
def mock_zero_vector(arg0, arg1=None):
    if arg1 is None:
        arg0, arg1 = sage.rings.integer_ring.IntegerRing(), arg0
    return vector(arg0, arg1)
```

```
sage: v = sage.modules.free_module_element.mock_zero_vector([1,2,3])
sage: v
(1, 2, 3)
```

At least one check is being made in the general constructor - seeing if the proposed degree is negative.

> I guess also that the list in CALL FORMAT has the issue with INPUT right under it as on #10362.


Yes, I'll get to this with any other changes.  Thanks.

Rob



---

archive/issue_events_081291.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2010-12-03T19:03:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81291"
}
```



---

archive/issue_events_081292.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2010-12-03T19:03:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81292"
}
```



---

archive/issue_comments_101131.json:
```json
{
    "body": "<a id='comment:8'></a>\nHmmm, indeed, it is necessary to do extra checks to construct zero vectors instead of something else. Let it be as is then!",
    "created_at": "2010-12-03T19:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101131",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>
Hmmm, indeed, it is necessary to do extra checks to construct zero vectors instead of something else. Let it be as is then!



---

archive/attachments_013577.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10364-zero-vector-constructor-v2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10364/trac_10364-zero-vector-constructor-v2.patch",
    "created_at": "2010-12-03T21:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_101132.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [novoselt](#comment%3A8):\n> Hmmm, indeed, it is necessary to do extra checks to construct zero vectors instead of something else. Let it be as is then!\n\n\nSounds good.  Thanks.\n\nStandalone v2 patch just fixes up the documentation - call formats and output block only.  Thanks for your help with these.\n\nRob",
    "created_at": "2010-12-03T21:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101132",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:9'></a>
Replying to [novoselt](#comment%3A8):
> Hmmm, indeed, it is necessary to do extra checks to construct zero vectors instead of something else. Let it be as is then!


Sounds good.  Thanks.

Standalone v2 patch just fixes up the documentation - call formats and output block only.  Thanks for your help with these.

Rob



---

archive/issue_events_081293.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2010-12-03T21:11:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81293"
}
```



---

archive/issue_events_081294.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2010-12-03T21:11:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81294"
}
```



---

archive/issue_comments_101133.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe new patch looks good and passes all tests!",
    "created_at": "2010-12-03T22:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101133",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'></a>
The new patch looks good and passes all tests!



---

archive/issue_events_081295.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-03T22:34:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81295"
}
```



---

archive/issue_events_081296.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-03T22:34:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81296"
}
```



---

archive/issue_comments_101134.json:
```json
{
    "body": "**Reviewer:** Andrey Novoseltsev",
    "created_at": "2010-12-03T22:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101134",
    "user": "https://github.com/novoselt"
}
```

**Reviewer:** Andrey Novoseltsev



---

archive/issue_comments_101135.json:
```json
{
    "body": "<a id='comment:11'></a>\nPlease set milestone",
    "created_at": "2010-12-05T09:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101135",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Please set milestone



---

archive/issue_events_081297.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-12-05T16:40:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81297"
}
```



---

archive/issue_events_081298.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-05T16:42:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81298"
}
```



---

archive/issue_events_081299.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-05T16:42:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81299"
}
```



---

archive/issue_comments_101136.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [novoselt](#comment%3A5):\n> Sure, let it be another ticket. I thought that it is an easy change but I didn't actually look at the relevant code.\n\n\nDegree plus dictionary enhancement is now on #10439.",
    "created_at": "2010-12-07T23:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101136",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:14'></a>
Replying to [novoselt](#comment%3A5):
> Sure, let it be another ticket. I thought that it is an easy change but I didn't actually look at the relevant code.


Degree plus dictionary enhancement is now on #10439.



---

archive/issue_events_081300.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-12T06:39:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81300"
}
```



---

archive/issue_events_081301.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-12T06:39:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10364#event-81301"
}
```



---

archive/issue_comments_101137.json:
```json
{
    "body": "**Merged:** sage-4.6.2.alpha0",
    "created_at": "2011-01-12T06:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10364",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10364#issuecomment-101137",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.6.2.alpha0
