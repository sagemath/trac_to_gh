# Issue 10176: ImportError: No module named sagenb on openSUSE

archive/issues_010175.json:
```json
{
    "body": "Florent Hivert reports on [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/bb636656e2153332) that Sage refuses to start after building 4.6.rc0 from scratch on openSUSE 11.3:\n\n```\npopcorn-*age/sage-4.6.rc0 $ ./sage \n[...]\n    ImportError: No module named sagenb \n```\nAccording to the thread, the problem seems to be that installing the sagenb package does not yield an\n\n `SAGE_ROOT/local/lib/python/site-packages/easy-install.pth`\n\nthat contains any path to the Sage Notebook files.\n\nThis is a possible follow-up to #10097, which is supposed to replace the line `./sagenb-0.8.2-py2.6.egg` --- inserted by setuptools into `easy-install.pth` --- with `../../../../devel/sagenb`.\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @hivert @jasongrout drkirkby @TimDumol @jdemeyer\n\n**Reviewer:** Leif Leonhardy\n\nIssue created by migration from https://trac.sagemath.org/ticket/10176\n\n",
    "closed_at": "2015-06-19T08:38:41Z",
    "created_at": "2010-10-27T08:55:59Z",
    "labels": [
        "component: notebook",
        "bug",
        "invalid"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "ImportError: No module named sagenb on openSUSE",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10176",
    "user": "https://github.com/qed777"
}
```
Florent Hivert reports on [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/bb636656e2153332) that Sage refuses to start after building 4.6.rc0 from scratch on openSUSE 11.3:

```
popcorn-*age/sage-4.6.rc0 $ ./sage 
[...]
    ImportError: No module named sagenb 
```
According to the thread, the problem seems to be that installing the sagenb package does not yield an

 `SAGE_ROOT/local/lib/python/site-packages/easy-install.pth`

that contains any path to the Sage Notebook files.

This is a possible follow-up to #10097, which is supposed to replace the line `./sagenb-0.8.2-py2.6.egg` --- inserted by setuptools into `easy-install.pth` --- with `../../../../devel/sagenb`.

**Assignee:** @jasongrout, @williamstein

**CC:**  @hivert @jasongrout drkirkby @TimDumol @jdemeyer

**Reviewer:** Leif Leonhardy

Issue created by migration from https://trac.sagemath.org/ticket/10176





---

archive/issue_comments_120448.json:
```json
{
    "body": "<a id='comment:1'></a>\nHi there,\n\nActually I had the same error with a openSuSE 11.1 (64 bits if it maters).",
    "created_at": "2010-10-27T09:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120448",
    "user": "https://github.com/hivert"
}
```

<a id='comment:1'></a>
Hi there,

Actually I had the same error with a openSuSE 11.1 (64 bits if it maters).



---

archive/issue_events_030906.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "rename": {
        "from": "ImportError: No module named sagenb on openSUSE 11.3",
        "to": "ImportError: No module named sagenb on openSUSE"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30906"
}
```



---

archive/issue_comments_120449.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [hivert](#comment%3A1):\n> Hi there,\n> \n> Actually I had the same error with a openSuSE 11.1 (64 bits if it matters).\n\n\nSo we can exclude the possibility of a broken `sed` I guess...\n\nI really would try just adding `#!/usr/bin/env bash` to (the generation of) SageNB's `spkg-install`, since apparently Sage 4.6.rc0 built fine and passed all tests on Skynet's OpenSuSE 11.1 box (menas).\n\n(If one changes that, one could of course also add some debug code to see if and how the `easy-install.pth` gets modified; also, one should check more exit codes in the script.)",
    "created_at": "2010-10-27T13:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120449",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
Replying to [hivert](#comment%3A1):
> Hi there,
> 
> Actually I had the same error with a openSuSE 11.1 (64 bits if it matters).


So we can exclude the possibility of a broken `sed` I guess...

I really would try just adding `#!/usr/bin/env bash` to (the generation of) SageNB's `spkg-install`, since apparently Sage 4.6.rc0 built fine and passed all tests on Skynet's OpenSuSE 11.1 box (menas).

(If one changes that, one could of course also add some debug code to see if and how the `easy-install.pth` gets modified; also, one should check more exit codes in the script.)



---

archive/issue_comments_120450.json:
```json
{
    "body": "**Changing status** from new to needs_info.",
    "created_at": "2010-10-27T15:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120450",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from new to needs_info.



---

archive/issue_comments_120451.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe attached patch to the SageNB spkg adds `#!...` and some error checking to its `spkg-install`, which now also prints the old and new SageNB path in `easy-install.pth` - at least for debugging...\n\nFlorent, please (apply,) build, test and report! ;-)\n\n(I have no idea if that solves the problem, therefore a temporary patch and \"needs info\". At least we should hopefully be able to track this further down.)\n\n---\n\nTo apply the patch, extract the original SageNB package (best from a Sage shell, since we need a suitable Python installation), cd to `sagenb-0.8.7/src/sagenb/`, then apply the patch and run `./spkg-dist` to create a new `sagenb-0.8.7-patched.spkg`, located in `sagenb-0.8.7/src/sagenb/dist/` (i.e., `./dist/`).",
    "created_at": "2010-10-27T15:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120451",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
The attached patch to the SageNB spkg adds `#!...` and some error checking to its `spkg-install`, which now also prints the old and new SageNB path in `easy-install.pth` - at least for debugging...

Florent, please (apply,) build, test and report! ;-)

(I have no idea if that solves the problem, therefore a temporary patch and "needs info". At least we should hopefully be able to track this further down.)

---

To apply the patch, extract the original SageNB package (best from a Sage shell, since we need a suitable Python installation), cd to `sagenb-0.8.7/src/sagenb/`, then apply the patch and run `./spkg-dist` to create a new `sagenb-0.8.7-patched.spkg`, located in `sagenb-0.8.7/src/sagenb/dist/` (i.e., `./dist/`).



---

archive/issue_comments_120452.json:
```json
{
    "body": "<a id='comment:5'></a>\n> Florent, please (apply,) build, test and report! ;-)\n\n\nJust to let you now: test in progress...",
    "created_at": "2010-10-27T16:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120452",
    "user": "https://github.com/hivert"
}
```

<a id='comment:5'></a>
> Florent, please (apply,) build, test and report! ;-)


Just to let you now: test in progress...



---

archive/issue_comments_120453.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe compilation of sage is not yet finished but from install.log\n\n```\nFinished processing dependencies for sagenb==0.8.7-patched\nOld path: \"\"\nNew path: \"\"\n\nreal    0m25.564s\nuser    0m13.760s\nsys     0m3.817s\nSuccessfully installed sagenb-0.8.7-patched\n```",
    "created_at": "2010-10-27T16:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120453",
    "user": "https://github.com/hivert"
}
```

<a id='comment:6'></a>
The compilation of sage is not yet finished but from install.log

```
Finished processing dependencies for sagenb==0.8.7-patched
Old path: ""
New path: ""

real    0m25.564s
user    0m13.760s
sys     0m3.817s
Successfully installed sagenb-0.8.7-patched
```



---

archive/issue_comments_120454.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [hivert](#comment%3A6):\n> The compilation of sage is not yet finished but from install.log\n\n\n```\n Finished processing dependencies for sagenb==0.8.7-patched\n Old path: \"\"\n New path: \"\"\n \n real    0m25.564s\n user    0m13.760s\n sys     0m3.817s\n Successfully installed sagenb-0.8.7-patched\n```\n\nHmmm, so something else goes wrong (i.e. there's no sagenb path listed there at all, unless my grep failed for some reason...)\n\nBtw, it should have been sufficient to just install the patched spkg.\n\nCan you take a look at / post your `$SAGE_ROOT/local/lib/python/site-packages/easy-install.pth`?\n\nMaybe we have a race condition in editing that? (You could retry with `./sage -f ...` when your build has finished.)",
    "created_at": "2010-10-27T17:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120454",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Replying to [hivert](#comment%3A6):
> The compilation of sage is not yet finished but from install.log


```
 Finished processing dependencies for sagenb==0.8.7-patched
 Old path: ""
 New path: ""
 
 real    0m25.564s
 user    0m13.760s
 sys     0m3.817s
 Successfully installed sagenb-0.8.7-patched
```

Hmmm, so something else goes wrong (i.e. there's no sagenb path listed there at all, unless my grep failed for some reason...)

Btw, it should have been sufficient to just install the patched spkg.

Can you take a look at / post your `$SAGE_ROOT/local/lib/python/site-packages/easy-install.pth`?

Maybe we have a race condition in editing that? (You could retry with `./sage -f ...` when your build has finished.)



---

archive/issue_comments_120455.json:
```json
{
    "body": "<a id='comment:8'></a>\nJust for the record, I got:\n\n```sh\n...\nSearching for setuptools==0.6c9\nBest match: setuptools 0.6c9\nProcessing setuptools-0.6c9-py2.6.egg\nsetuptools 0.6c9 is already the active version in easy-install.pth\nInstalling easy_install script to /home/leif/Sage/sage-4.6.rc0-short-logs/local/bin\nInstalling easy_install-2.6 script to /home/leif/Sage/sage-4.6.rc0-short-logs/local/bin\n\nUsing /home/leif/Sage/sage-4.6.rc0-short-logs/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg\nFinished processing dependencies for sagenb==0.8.7-patched\nOld path: \"/home/leif/Sage/sage-4.6.rc0-short-logs/devel/sagenb-main\"\nNew path: \"../../../../devel/sagenb\"\n\nreal\t0m8.624s\nuser\t0m5.800s\nsys\t0m2.570s\nSuccessfully installed sagenb-0.8.7-patched\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing sagenb-0.8.7-patched.spkg\n```",
    "created_at": "2010-10-27T17:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120455",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Just for the record, I got:

```sh
...
Searching for setuptools==0.6c9
Best match: setuptools 0.6c9
Processing setuptools-0.6c9-py2.6.egg
setuptools 0.6c9 is already the active version in easy-install.pth
Installing easy_install script to /home/leif/Sage/sage-4.6.rc0-short-logs/local/bin
Installing easy_install-2.6 script to /home/leif/Sage/sage-4.6.rc0-short-logs/local/bin

Using /home/leif/Sage/sage-4.6.rc0-short-logs/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg
Finished processing dependencies for sagenb==0.8.7-patched
Old path: "/home/leif/Sage/sage-4.6.rc0-short-logs/devel/sagenb-main"
New path: "../../../../devel/sagenb"

real	0m8.624s
user	0m5.800s
sys	0m2.570s
Successfully installed sagenb-0.8.7-patched
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing sagenb-0.8.7-patched.spkg
```



---

archive/issue_comments_120456.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [leif](#comment%3A7):\n> Maybe we have a race condition in editing that? (You could retry with `./sage -f ...` when your build has finished.)\n\n\nCould you also take a look at `easy-install.pth`'s modification time after reinstalling the spkg?",
    "created_at": "2010-10-27T17:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120456",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
Replying to [leif](#comment%3A7):
> Maybe we have a race condition in editing that? (You could retry with `./sage -f ...` when your build has finished.)


Could you also take a look at `easy-install.pth`'s modification time after reinstalling the spkg?



---

archive/issue_comments_120457.json:
```json
{
    "body": "<a id='comment:10'></a>\nTo brute-force-fix your problem without knowing the real cause, we could just add:\n\n```sh\n# Dave says Solaris' non-POSIX grep in the default path\n# doesn't understand \"-q\" (which *is* POSIX):\n\nif ! grep sagenb easy-install.pth >/dev/null; then\n    echo 'No sagenb path found in easy-install.pth!'\n    echo \"Adding relative sagenb path to easy-install.pth\"\n    # Anyone recalling the correct syntax for *sed*?\n    ed easy-install.pth >/dev/null <<EOF\n$i\n../../../../devel/sagenb\n.\nwq\nEOF\nfi\n```\n\nOpinions?",
    "created_at": "2010-10-27T18:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120457",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
To brute-force-fix your problem without knowing the real cause, we could just add:

```sh
# Dave says Solaris' non-POSIX grep in the default path
# doesn't understand "-q" (which *is* POSIX):

if ! grep sagenb easy-install.pth >/dev/null; then
    echo 'No sagenb path found in easy-install.pth!'
    echo "Adding relative sagenb path to easy-install.pth"
    # Anyone recalling the correct syntax for *sed*?
    ed easy-install.pth >/dev/null <<EOF
$i
../../../../devel/sagenb
.
wq
EOF
fi
```

Opinions?



---

archive/issue_comments_120458.json:
```json
{
    "body": "<a id='comment:11'></a>\nOk, the `ed` command can be substituted by:\n\n```sh\n    sed -e '$ i \\../../../../devel/sagenb' easy-install.pth > easy-install.$$\n    mv -f easy-install.$$ easy-install.pth\n```",
    "created_at": "2010-10-27T18:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120458",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Ok, the `ed` command can be substituted by:

```sh
    sed -e '$ i \../../../../devel/sagenb' easy-install.pth > easy-install.$$
    mv -f easy-install.$$ easy-install.pth
```



---

archive/issue_comments_120459.json:
```json
{
    "body": "<a id='comment:12'></a>\n> > Maybe we have a race condition in editing that? (You could retry with `./sage -f ...` when your build has finished.)\n\n\n> Could you also take a look at `easy-install.pth`'s modification time after reinstalling the spkg?\n\n\nLooks reasonable. It has been touched at the end of the build. \n\nI tried a `sage -f ./sage -f ../sagenb-0.8.7-patched.spkg` and get no changes:\n\n```\n[...]\nsing /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg\nSearching for zope.interface==3.6.1\nBest match: zope.interface 3.6.1\nProcessing zope.interface-3.6.1-py2.6-linux-x86_64.egg\nzope.interface 3.6.1 is already the active version in easy-install.pth\n\nUsing /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg\nSearching for setuptools==0.6c9\nBest match: setuptools 0.6c9\nProcessing setuptools-0.6c9-py2.6.egg\nsetuptools 0.6c9 is already the active version in easy-install.pth\nInstalling easy_install script to /home/florent/src/Sage/readline/sage-4.6.rc0/local/bin\nInstalling easy_install-2.6 script to /home/florent/src/Sage/readline/sage-4.6.rc0/local/bin\n\nUsing /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg\nFinished processing dependencies for sagenb==0.8.7-patched\nOld path: \"\"\nNew path: \"\"\n\nreal    0m8.013s\nuser    0m5.983s\nsys     0m2.016s\nSuccessfully installed sagenb-0.8.7-patched\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing sagenb-0.8.7-patched.spkg\n```\n\nI'm not sure what to do... If you have some time, maybe it could be easier to discuss on irc. I'm kind of busy tonight (it is 20:4 here) but I probably can find 1/2h if you need. I've no idea how this `setup.py/easy-install` stuff works and what could be the cause...",
    "created_at": "2010-10-27T18:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120459",
    "user": "https://github.com/hivert"
}
```

<a id='comment:12'></a>
> > Maybe we have a race condition in editing that? (You could retry with `./sage -f ...` when your build has finished.)


> Could you also take a look at `easy-install.pth`'s modification time after reinstalling the spkg?


Looks reasonable. It has been touched at the end of the build. 

I tried a `sage -f ./sage -f ../sagenb-0.8.7-patched.spkg` and get no changes:

```
[...]
sing /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg
Searching for zope.interface==3.6.1
Best match: zope.interface 3.6.1
Processing zope.interface-3.6.1-py2.6-linux-x86_64.egg
zope.interface 3.6.1 is already the active version in easy-install.pth

Using /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg
Searching for setuptools==0.6c9
Best match: setuptools 0.6c9
Processing setuptools-0.6c9-py2.6.egg
setuptools 0.6c9 is already the active version in easy-install.pth
Installing easy_install script to /home/florent/src/Sage/readline/sage-4.6.rc0/local/bin
Installing easy_install-2.6 script to /home/florent/src/Sage/readline/sage-4.6.rc0/local/bin

Using /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg
Finished processing dependencies for sagenb==0.8.7-patched
Old path: ""
New path: ""

real    0m8.013s
user    0m5.983s
sys     0m2.016s
Successfully installed sagenb-0.8.7-patched
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing sagenb-0.8.7-patched.spkg
```

I'm not sure what to do... If you have some time, maybe it could be easier to discuss on irc. I'm kind of busy tonight (it is 20:4 here) but I probably can find 1/2h if you need. I've no idea how this `setup.py/easy-install` stuff works and what could be the cause...



---

archive/issue_comments_120460.json:
```json
{
    "body": "<a id='comment:13'></a>\nSo the modification time did not change when running `./sage -f ...`?\n\nI'm not familiar with setuptools, easy-install etc. either... :(\n\nI could perhaps upload a modified patch including the \"brute force\" fix later, but am busy now, too.\n\nDave just said he's going to install OpenSuSE 11.3 and / or 11.2 in a virtual machine; perhaps he can help, too, with debugging that.",
    "created_at": "2010-10-27T18:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120460",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>
So the modification time did not change when running `./sage -f ...`?

I'm not familiar with setuptools, easy-install etc. either... :(

I could perhaps upload a modified patch including the "brute force" fix later, but am busy now, too.

Dave just said he's going to install OpenSuSE 11.3 and / or 11.2 in a virtual machine; perhaps he can help, too, with debugging that.



---

archive/issue_comments_120461.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [leif](#comment%3A13):\n> So the modification time did not change when running `./sage -f ...`?\n\n\nOn the contrary it *did* change as expected. \n\n> I'm not familiar with setuptools, easy-install etc. either... :(\n> \n> I could perhaps upload a modified patch including the \"brute force\" fix later, but am busy now, too.\n\n\nOk !\n \n> Dave just said he's going to install OpenSuSE 11.3 and / or 11.2 in a virtual machine; perhaps he can help, too, with debugging that.\n",
    "created_at": "2010-10-27T19:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120461",
    "user": "https://github.com/hivert"
}
```

<a id='comment:14'></a>
Replying to [leif](#comment%3A13):
> So the modification time did not change when running `./sage -f ...`?


On the contrary it *did* change as expected. 

> I'm not familiar with setuptools, easy-install etc. either... :(
> 
> I could perhaps upload a modified patch including the "brute force" fix later, but am busy now, too.


Ok !
 
> Dave just said he's going to install OpenSuSE 11.3 and / or 11.2 in a virtual machine; perhaps he can help, too, with debugging that.




---

archive/issue_comments_120462.json:
```json
{
    "body": "<a id='comment:15'></a>\nA last question for the moment:\n\nHow do you get the different paths `/home/florent/src/...` and `/home/data/Sage-Install/...`?",
    "created_at": "2010-10-27T19:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120462",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
A last question for the moment:

How do you get the different paths `/home/florent/src/...` and `/home/data/Sage-Install/...`?



---

archive/issue_comments_120463.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [leif](#comment%3A15):\n> A last question for the moment:\n> \n> How do you get the different paths `/home/florent/src/...` and `/home/data/Sage-Install/...`?\n\n\nMy install is in `/home/data/Sage-Install` with a symbolic link from `/home/florent/src/...`. I figured out that it could be the source of the problem. I though I have been careful not to go through the link but it seems I failed. However, on my openSuSE 11.1 I had the same failure without any links. So this is not the cause of the problem.",
    "created_at": "2010-10-27T19:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120463",
    "user": "https://github.com/hivert"
}
```

<a id='comment:16'></a>
Replying to [leif](#comment%3A15):
> A last question for the moment:
> 
> How do you get the different paths `/home/florent/src/...` and `/home/data/Sage-Install/...`?


My install is in `/home/data/Sage-Install` with a symbolic link from `/home/florent/src/...`. I figured out that it could be the source of the problem. I though I have been careful not to go through the link but it seems I failed. However, on my openSuSE 11.1 I had the same failure without any links. So this is not the cause of the problem.



---

archive/attachments_013291.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10176-improve_spkg_dists_spkg_install_generation-spkg.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10176/trac_10176-improve_spkg_dists_spkg_install_generation-spkg.patch",
    "created_at": "2010-10-27T23:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_120464.json:
```json
{
    "body": "SageNB spkg patch (0.8.7 -> 0.8.7.p1). Now includes an ugly work-around.",
    "created_at": "2010-10-27T23:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120464",
    "user": "https://github.com/nexttime"
}
```

SageNB spkg patch (0.8.7 -> 0.8.7.p1). Now includes an ugly work-around.



---

archive/attachments_013292.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "sagenb-0.8.7_vs._0.8.7.p1.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10176/sagenb-0.8.7_vs._0.8.7.p1.diff",
    "created_at": "2010-10-27T23:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_120465.json:
```json
{
    "body": "Cumulative diff between SageNB 0.8.7 and 0.8.7.p1 - for reference / review only.",
    "created_at": "2010-10-27T23:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120465",
    "user": "https://github.com/nexttime"
}
```

Cumulative diff between SageNB 0.8.7 and 0.8.7.p1 - for reference / review only.



---

archive/issue_comments_120466.json:
```json
{
    "body": "**Author:** Leif Leonhardy",
    "created_at": "2010-10-28T00:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120466",
    "user": "https://github.com/nexttime"
}
```

**Author:** Leif Leonhardy



---

archive/issue_comments_120467.json:
```json
{
    "body": "<a id='comment:17'></a>\n**New spkg: http://spkg-upload.googlecode.com/files/sagenb-0.8.7.p1.spkg**\n\n**md5sum:** `6fe0e76e336fc24e71b5c591a112f8fb  sagenb-0.8.7.p1.spkg`\n\nFlorent, again: Please install / build, test and report! ;-)\n\nThis spkg now contains the work-around **adding** the relative sagenb path to `easy-install.pth` if (for whatever reason) there's no sagenb path at all in it...\n\nI've also updated the spkg patch, and added a cumulative diff for reference / review (the Mercurial changeset contains *two* patches), but you can just download and install the new spkg.\n\n(I actually made a mistake in the previously attached patch s.t. the `#!` in `spkg-install` ended up on the *second* line. I'm really curious what messages you will *now* get - either *\"Adding relative sagenb path to easy-install.pth\"* or *\"Making sagenb path in easy-install.pth relative\"*...)\n\nI've again tested the spkg (only) on Ubuntu 10.04.\n\n```sh\n$ ./sage -f /path/to/sagenb-0.8.7.p1.spkg\n$ ./sage -t -long -sagenb # Though there are no long tests IIRC\n```\nshould be sufficient to test it. (Others should perhaps test it on different platforms as well.)\n\nYou could then do\n\n```sh\n$ egrep \"Adding|Removing\" spkg/logs/sagenb-0.8.7.p1.log\n$ grep easy-install\\.pth spkg/logs/sagenb-0.8.7.p1.log # more matches\n```\n(also with your previous logs, i.e. `spkg/logs/sagenb-0.8.7.log` or `spkg/logs/sagenb-0.8.7-patched.log`).",
    "created_at": "2010-10-28T00:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120467",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
**New spkg: http://spkg-upload.googlecode.com/files/sagenb-0.8.7.p1.spkg**

**md5sum:** `6fe0e76e336fc24e71b5c591a112f8fb  sagenb-0.8.7.p1.spkg`

Florent, again: Please install / build, test and report! ;-)

This spkg now contains the work-around **adding** the relative sagenb path to `easy-install.pth` if (for whatever reason) there's no sagenb path at all in it...

I've also updated the spkg patch, and added a cumulative diff for reference / review (the Mercurial changeset contains *two* patches), but you can just download and install the new spkg.

(I actually made a mistake in the previously attached patch s.t. the `#!` in `spkg-install` ended up on the *second* line. I'm really curious what messages you will *now* get - either *"Adding relative sagenb path to easy-install.pth"* or *"Making sagenb path in easy-install.pth relative"*...)

I've again tested the spkg (only) on Ubuntu 10.04.

```sh
$ ./sage -f /path/to/sagenb-0.8.7.p1.spkg
$ ./sage -t -long -sagenb # Though there are no long tests IIRC
```
should be sufficient to test it. (Others should perhaps test it on different platforms as well.)

You could then do

```sh
$ egrep "Adding|Removing" spkg/logs/sagenb-0.8.7.p1.log
$ grep easy-install\.pth spkg/logs/sagenb-0.8.7.p1.log # more matches
```
(also with your previous logs, i.e. `spkg/logs/sagenb-0.8.7.log` or `spkg/logs/sagenb-0.8.7-patched.log`).



---

archive/issue_comments_120468.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2010-10-28T00:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120468",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_120469.json:
```json
{
    "body": "<a id='comment:18'></a>\nLeif, thanks for making a new spkg with your improvements.\n\nFrom `spkg/standard/deps` (cf. #8306):\n\n```\n# setuptools forgets to update easy-install.pth during parallel\n# builds, so we build the relevant packages serially.\n```\nPerhaps `forgets` should be `\"forgets\"`.  Anyway, I'm mentioning this, in case anyone sees a connection with the behavior Florent sees.",
    "created_at": "2010-10-28T01:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120469",
    "user": "https://github.com/qed777"
}
```

<a id='comment:18'></a>
Leif, thanks for making a new spkg with your improvements.

From `spkg/standard/deps` (cf. #8306):

```
# setuptools forgets to update easy-install.pth during parallel
# builds, so we build the relevant packages serially.
```
Perhaps `forgets` should be `"forgets"`.  Anyway, I'm mentioning this, in case anyone sees a connection with the behavior Florent sees.



---

archive/issue_comments_120470.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [mpatel](#comment%3A18):\n> Leif, thanks for making a new spkg with your improvements.\n\n\nThanks ! I'm just getting up and I have to run to get my train to work. Thanks for your work. Unfortunately I'm very busy today. I won't have time to test it before this evening (Paris local time ;-))\n\nThanks for the help.\n\nFlorent",
    "created_at": "2010-10-28T05:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120470",
    "user": "https://github.com/hivert"
}
```

<a id='comment:19'></a>
Replying to [mpatel](#comment%3A18):
> Leif, thanks for making a new spkg with your improvements.


Thanks ! I'm just getting up and I have to run to get my train to work. Thanks for your work. Unfortunately I'm very busy today. I won't have time to test it before this evening (Paris local time ;-))

Thanks for the help.

Florent



---

archive/issue_comments_120471.json:
```json
{
    "body": "<a id='comment:20'></a>\nMitesh, I think we can remove the (non-portable / non-POSIX) `-n` from\n\n```sh\nln -snf sagenb-main sagenb\n```\nif we first delete `sagenb` (with `rm -f`). (This was introduced at #10097, by [this patch](http://trac.sagemath.org/sage_trac/attachment/ticket/10097/trac_10097-sagenb_relocatability.patch).)\n\nIn fact, the `rm -f sagenb` had been there, before I changed the `cp` to `mv`, so the `-n` was IMHO previously superfluous. (I actually assumed you meant `rm -rf`, deleting also the **contents of the directory** pointed to (`sagenb-main`) and copied to `sagenb-main-old` right before, rather than the link itself, to avoid having old files in the directory to which the new files are copied. Right?)\n\nSo I'd suggest \"uncommenting\" the original `rm -f sagenb`, and omitting the `-n` when effectively *[re]creating* (as opposed to *overwriting*) the `sagenb` symbolic link. (We then don't need the `-f` either.):\n\n```sh\n...\nmkdir -p \"$SAGE_ROOT/devel\"\n\necho \"Copying SageNB package to '$SAGE_ROOT/devel/sagenb-main'.\"\nif [ -d \"$SAGE_ROOT/devel/sagenb-main\" ]; then\n    echo \"Moving old SageNB package to '$SAGE_ROOT/devel/sagenb-main-old'.\"\n    rm -rf \"$SAGE_ROOT/devel/sagenb-main-old\"\n    mv \"$SAGE_ROOT/devel/sagenb-main\" \"$SAGE_ROOT/devel/sagenb-main-old\"\nfi\n\nrm -f \"$SAGE_ROOT/devel/sagenb\" # Delete just the link itself (if it exists)\n\ncd ..\ncp -pr sagenb \"$SAGE_ROOT/devel/sagenb-main\"\n\ncd \"$SAGE_ROOT/devel\"\nln -s sagenb-main sagenb\n...\n```\n\nOpinions? Or do I miss something?",
    "created_at": "2010-10-28T07:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120471",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
Mitesh, I think we can remove the (non-portable / non-POSIX) `-n` from

```sh
ln -snf sagenb-main sagenb
```
if we first delete `sagenb` (with `rm -f`). (This was introduced at #10097, by [this patch](http://trac.sagemath.org/sage_trac/attachment/ticket/10097/trac_10097-sagenb_relocatability.patch).)

In fact, the `rm -f sagenb` had been there, before I changed the `cp` to `mv`, so the `-n` was IMHO previously superfluous. (I actually assumed you meant `rm -rf`, deleting also the **contents of the directory** pointed to (`sagenb-main`) and copied to `sagenb-main-old` right before, rather than the link itself, to avoid having old files in the directory to which the new files are copied. Right?)

So I'd suggest "uncommenting" the original `rm -f sagenb`, and omitting the `-n` when effectively *[re]creating* (as opposed to *overwriting*) the `sagenb` symbolic link. (We then don't need the `-f` either.):

```sh
...
mkdir -p "$SAGE_ROOT/devel"

echo "Copying SageNB package to '$SAGE_ROOT/devel/sagenb-main'."
if [ -d "$SAGE_ROOT/devel/sagenb-main" ]; then
    echo "Moving old SageNB package to '$SAGE_ROOT/devel/sagenb-main-old'."
    rm -rf "$SAGE_ROOT/devel/sagenb-main-old"
    mv "$SAGE_ROOT/devel/sagenb-main" "$SAGE_ROOT/devel/sagenb-main-old"
fi

rm -f "$SAGE_ROOT/devel/sagenb" # Delete just the link itself (if it exists)

cd ..
cp -pr sagenb "$SAGE_ROOT/devel/sagenb-main"

cd "$SAGE_ROOT/devel"
ln -s sagenb-main sagenb
...
```

Opinions? Or do I miss something?



---

archive/issue_comments_120472.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [leif](#comment%3A20):\n\n> Mitesh, I think we can remove the (non-portable / non-POSIX) `-n` from ... Opinions? Or do I miss something?\n\n\nUnfortunately, I followed the not-so-portable example of `sage-build`.  (Also, I should have added error-checking at #10097.)  The changes you suggest look good.  Could you update the package?",
    "created_at": "2010-10-28T09:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120472",
    "user": "https://github.com/qed777"
}
```

<a id='comment:21'></a>
Replying to [leif](#comment%3A20):

> Mitesh, I think we can remove the (non-portable / non-POSIX) `-n` from ... Opinions? Or do I miss something?


Unfortunately, I followed the not-so-portable example of `sage-build`.  (Also, I should have added error-checking at #10097.)  The changes you suggest look good.  Could you update the package?



---

archive/issue_comments_120473.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [hivert](#comment%3A12):\n> > Could you also take a look at `easy-install.pth`'s modification time after reinstalling the spkg?\n\n> \n> Looks reasonable. It has been touched at the end of the build.\n\n\nI just realized that (unless the script exits prematurely) the \"modification\" time will always change, regardless if the file really got modified, since we do an analogue of\n\n```sh\nsed ... file.orig > file.new\nmv -f file.new file.orig\n```\n(Using the unfortunately non-POSIX `-i` (in-place) option of `sed` would avoid this...)\n\nShould we do\n\n```sh\nif diff file.orig file.new >/dev/null; then\n    rm -f file.new # just clean up\nelse\n    mv -f file.new file.orig\nfi\n# or, in short form:\ndiff file.orig file.new >/dev/null && rm -f file.new || mv -f file.new file.orig\n```\n? ;-)\n\nDave, how do your *\"Sage programmer's How to work around non-portable non-POSIX commands, options and built-in shell functions\"* wiki pages fare?",
    "created_at": "2010-10-28T19:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120473",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>
Replying to [hivert](#comment%3A12):
> > Could you also take a look at `easy-install.pth`'s modification time after reinstalling the spkg?

> 
> Looks reasonable. It has been touched at the end of the build.


I just realized that (unless the script exits prematurely) the "modification" time will always change, regardless if the file really got modified, since we do an analogue of

```sh
sed ... file.orig > file.new
mv -f file.new file.orig
```
(Using the unfortunately non-POSIX `-i` (in-place) option of `sed` would avoid this...)

Should we do

```sh
if diff file.orig file.new >/dev/null; then
    rm -f file.new # just clean up
else
    mv -f file.new file.orig
fi
# or, in short form:
diff file.orig file.new >/dev/null && rm -f file.new || mv -f file.new file.orig
```
? ;-)

Dave, how do your *"Sage programmer's How to work around non-portable non-POSIX commands, options and built-in shell functions"* wiki pages fare?



---

archive/issue_comments_120474.json:
```json
{
    "body": "<a id='comment:23'></a>\nAnother shot into the dark: Might Florent's problem be a locale issue?\n\nWhat happens if you e.g. do\n\n```sh\n$ env LC_MESSAGES=C ./sage -f sagenb-0.8.7-patched # or 0.8.7.p1\n```\n?",
    "created_at": "2010-10-28T19:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120474",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
Another shot into the dark: Might Florent's problem be a locale issue?

What happens if you e.g. do

```sh
$ env LC_MESSAGES=C ./sage -f sagenb-0.8.7-patched # or 0.8.7.p1
```
?



---

archive/issue_comments_120475.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [leif](#comment%3A23):\n> Another shot into the dark: Might Florent's problem be a locale issue?\n\n\nI'm sorry to report it's a miss. Moreover my 11.3 box works in utf8 and the older 11.1 in latin1... Thank you for trying. I'll be happy to tray any other idea. As usual the script still report\n\n```\nRemoving sagenb 0.8.7-patched from easy-install.pth file\nAdding sagenb 0.8.7-patched to easy-install.pth file\n```\nbut nothing is happening. So someone have any idea of which script (I guess something in setuptools) writes those two lines on my screen ? Otherwise I'll probably spend tomorrow morning playing with grep :-| Do you think raising this issue somewhere else (sage-devel or python-devel) could get me some help ?",
    "created_at": "2010-10-28T20:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120475",
    "user": "https://github.com/hivert"
}
```

<a id='comment:24'></a>
Replying to [leif](#comment%3A23):
> Another shot into the dark: Might Florent's problem be a locale issue?


I'm sorry to report it's a miss. Moreover my 11.3 box works in utf8 and the older 11.1 in latin1... Thank you for trying. I'll be happy to tray any other idea. As usual the script still report

```
Removing sagenb 0.8.7-patched from easy-install.pth file
Adding sagenb 0.8.7-patched to easy-install.pth file
```
but nothing is happening. So someone have any idea of which script (I guess something in setuptools) writes those two lines on my screen ? Otherwise I'll probably spend tomorrow morning playing with grep :-| Do you think raising this issue somewhere else (sage-devel or python-devel) could get me some help ?



---

archive/issue_comments_120476.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [mpatel](#comment%3A21):\n> The changes you suggest look good.  Could you update the package?\n\n\n*Days later...*\n\nSure. I've made those changes (including some more error checking, comments and cosmetic changes), but hesitate a little to (commit them and) upload a new package before Florent has reported back for the *current* p1. (Though I expect the work-around to work for him.)\n\nAlways make worst case assumptions... ;-)",
    "created_at": "2010-10-28T22:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120476",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>
Replying to [mpatel](#comment%3A21):
> The changes you suggest look good.  Could you update the package?


*Days later...*

Sure. I've made those changes (including some more error checking, comments and cosmetic changes), but hesitate a little to (commit them and) upload a new package before Florent has reported back for the *current* p1. (Though I expect the work-around to work for him.)

Always make worst case assumptions... ;-)



---

archive/issue_comments_120477.json:
```json
{
    "body": "<a id='comment:26'></a>\nI've also built a \"French\" (`LC_ALL=fr_FR.utf8`) rc0 from scratch (on Ubuntu 10.04 though) and didn't experience any problems; `ptestlong` passed, too.",
    "created_at": "2010-10-28T23:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120477",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'></a>
I've also built a "French" (`LC_ALL=fr_FR.utf8`) rc0 from scratch (on Ubuntu 10.04 though) and didn't experience any problems; `ptestlong` passed, too.



---

archive/issue_comments_120478.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [hivert](#comment%3A24):\n> I'll be happy to tray any other idea. As usual the script still report\n\n\n```\n Removing sagenb 0.8.7-patched from easy-install.pth file\n Adding sagenb 0.8.7-patched to easy-install.pth file\n```\n> but nothing is happening. So someone have any idea of which script (I guess something in setuptools) writes those two lines on my screen ? Otherwise I'll probably spend tomorrow morning playing with grep :-|\n\n\nYou don't have to grep, take a look at `setuptools-0.6c9.p0/src/setuptools/command/easy_install.py`:\n* Starting on line 944:\n\n```python\n    def update_pth(self,dist):\n        if self.pth_file is None:\n            return\n\n        for d in self.pth_file[dist.key]:    # drop old entries\n            if self.multi_version or d.location != dist.location:\n                log.info(\"Removing %s from easy-install.pth file\", d)\n                self.pth_file.remove(d)\n                if d.location in self.shadow_path:\n                    self.shadow_path.remove(d.location)\n\n        if not self.multi_version:\n            if dist.location in self.pth_file.paths:\n                log.info(\n                    \"%s is already the active version in easy-install.pth\",\n                    dist\n                )\n            else:\n                log.info(\"Adding %s to easy-install.pth file\", dist)\n                self.pth_file.add(dist) # add new entry\n                if dist.location not in self.shadow_path:\n                    self.shadow_path.append(dist.location)\n\n        if not self.dry_run:\n\n            self.pth_file.save()\n\n            if dist.key=='setuptools':\n                # Ensure that setuptools itself never becomes unavailable!\n                # XXX should this check for latest version?\n                filename = os.path.join(self.install_dir,'setuptools.pth')\n                if os.path.islink(filename): os.unlink(filename)\n                f = open(filename, 'wt')\n                f.write(self.pth_file.make_relative(dist.location)+'\\n')\n                f.close()\n```\n* Starting on line 1313:\n\n```python\nclass PthDistributions(Environment):\n    \"\"\"A .pth file with Distribution paths in it\"\"\"\n\n    ...\n\n    def save(self):\n        \"\"\"Write changed .pth file back to disk\"\"\"\n        if not self.dirty:\n            return\n\n        data = '\\n'.join(map(self.make_relative,self.paths))\n        if data:\n            log.debug(\"Saving %s\", self.filename)\n            data = (\n                \"import sys; sys.__plen = len(sys.path)\\n\"\n                \"%s\\n\"\n                \"import sys; new=sys.path[sys.__plen:];\"\n                \" del sys.path[sys.__plen:];\"\n                \" p=getattr(sys,'__egginsert',0); sys.path[p:p]=new;\"\n                \" sys.__egginsert = p+len(new)\\n\"\n            ) % data\n\n            if os.path.islink(self.filename):\n                os.unlink(self.filename)\n            f = open(self.filename,'wb')\n            f.write(data); f.close()\n\n        elif os.path.exists(self.filename):\n            log.debug(\"Deleting empty %s\", self.filename)\n            os.unlink(self.filename)\n\n        self.dirty = False\n\n    def add(self,dist):\n        \"\"\"Add `dist` to the distribution map\"\"\"\n        if dist.location not in self.paths and dist.location not in self.sitedirs:\n            self.paths.append(dist.location); self.dirty = True\n        Environment.add(self,dist)\n\n    ...\n```\nUnfortunately `export DISTUTILS_DEBUG=yes` seems to have no effect on setuptools, but perhaps we could call `distutils.log.set_threshold(distutils.log.DEBUG)` in SageNB's `setup.py` (haven't tried that yet).\n\nOr we could hack some debugging statements into the setuptools spkg by ourselves, since there anyway aren't many calls of `log.debug()`, at least in the parts we're interested in.\n\nOur setuptools are fairly old by the way; the latest seem to be 0.6c11, released a year ago, though some changelog ends with \"0.6 (final)\", lacking entries for \"recent\" 0.6c*N*s.",
    "created_at": "2010-10-29T00:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120478",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'></a>
Replying to [hivert](#comment%3A24):
> I'll be happy to tray any other idea. As usual the script still report


```
 Removing sagenb 0.8.7-patched from easy-install.pth file
 Adding sagenb 0.8.7-patched to easy-install.pth file
```
> but nothing is happening. So someone have any idea of which script (I guess something in setuptools) writes those two lines on my screen ? Otherwise I'll probably spend tomorrow morning playing with grep :-|


You don't have to grep, take a look at `setuptools-0.6c9.p0/src/setuptools/command/easy_install.py`:
* Starting on line 944:

```python
    def update_pth(self,dist):
        if self.pth_file is None:
            return

        for d in self.pth_file[dist.key]:    # drop old entries
            if self.multi_version or d.location != dist.location:
                log.info("Removing %s from easy-install.pth file", d)
                self.pth_file.remove(d)
                if d.location in self.shadow_path:
                    self.shadow_path.remove(d.location)

        if not self.multi_version:
            if dist.location in self.pth_file.paths:
                log.info(
                    "%s is already the active version in easy-install.pth",
                    dist
                )
            else:
                log.info("Adding %s to easy-install.pth file", dist)
                self.pth_file.add(dist) # add new entry
                if dist.location not in self.shadow_path:
                    self.shadow_path.append(dist.location)

        if not self.dry_run:

            self.pth_file.save()

            if dist.key=='setuptools':
                # Ensure that setuptools itself never becomes unavailable!
                # XXX should this check for latest version?
                filename = os.path.join(self.install_dir,'setuptools.pth')
                if os.path.islink(filename): os.unlink(filename)
                f = open(filename, 'wt')
                f.write(self.pth_file.make_relative(dist.location)+'\n')
                f.close()
```
* Starting on line 1313:

```python
class PthDistributions(Environment):
    """A .pth file with Distribution paths in it"""

    ...

    def save(self):
        """Write changed .pth file back to disk"""
        if not self.dirty:
            return

        data = '\n'.join(map(self.make_relative,self.paths))
        if data:
            log.debug("Saving %s", self.filename)
            data = (
                "import sys; sys.__plen = len(sys.path)\n"
                "%s\n"
                "import sys; new=sys.path[sys.__plen:];"
                " del sys.path[sys.__plen:];"
                " p=getattr(sys,'__egginsert',0); sys.path[p:p]=new;"
                " sys.__egginsert = p+len(new)\n"
            ) % data

            if os.path.islink(self.filename):
                os.unlink(self.filename)
            f = open(self.filename,'wb')
            f.write(data); f.close()

        elif os.path.exists(self.filename):
            log.debug("Deleting empty %s", self.filename)
            os.unlink(self.filename)

        self.dirty = False

    def add(self,dist):
        """Add `dist` to the distribution map"""
        if dist.location not in self.paths and dist.location not in self.sitedirs:
            self.paths.append(dist.location); self.dirty = True
        Environment.add(self,dist)

    ...
```
Unfortunately `export DISTUTILS_DEBUG=yes` seems to have no effect on setuptools, but perhaps we could call `distutils.log.set_threshold(distutils.log.DEBUG)` in SageNB's `setup.py` (haven't tried that yet).

Or we could hack some debugging statements into the setuptools spkg by ourselves, since there anyway aren't many calls of `log.debug()`, at least in the parts we're interested in.

Our setuptools are fairly old by the way; the latest seem to be 0.6c11, released a year ago, though some changelog ends with "0.6 (final)", lacking entries for "recent" 0.6c*N*s.



---

archive/issue_comments_120479.json:
```json
{
    "body": "<a id='comment:28'></a>\nFlorent, if you make `log.debug(\"Saving %s\", self.filename)` a `print` statement around line 1360 of\n\n```\nSAGE_ROOT/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg/setuptools/command/easy_install.py\n```\nand reinstall the sagenb package, do you see one or more \"`Saving .../easy-install.pth`\" lines in the log?",
    "created_at": "2010-10-29T02:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120479",
    "user": "https://github.com/qed777"
}
```

<a id='comment:28'></a>
Florent, if you make `log.debug("Saving %s", self.filename)` a `print` statement around line 1360 of

```
SAGE_ROOT/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg/setuptools/command/easy_install.py
```
and reinstall the sagenb package, do you see one or more "`Saving .../easy-install.pth`" lines in the log?



---

archive/issue_comments_120480.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [mpatel](#comment%3A28):\n> Florent, if you make `log.debug(\"Saving %s\", self.filename)` a `print` statement around line 1360 of\n\n\n```\n SAGE_ROOT/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg/setuptools/command/easy_install.py\n```\n> and reinstall the sagenb package, do you see one or more \"`Saving .../easy-install.pth`\" lines in the log?\n\n\nYou can also just `s/log.debug/log.info/g` with your favorite editor.\n\nI'm attaching a patch to `easy_install.py` that does some more `log.debug()` (inside the I think relevant parts).\n\n(Again, after applying that patch, you could change `log.debug()` to `log.info()`.)",
    "created_at": "2010-10-29T03:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120480",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>
Replying to [mpatel](#comment%3A28):
> Florent, if you make `log.debug("Saving %s", self.filename)` a `print` statement around line 1360 of


```
 SAGE_ROOT/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg/setuptools/command/easy_install.py
```
> and reinstall the sagenb package, do you see one or more "`Saving .../easy-install.pth`" lines in the log?


You can also just `s/log.debug/log.info/g` with your favorite editor.

I'm attaching a patch to `easy_install.py` that does some more `log.debug()` (inside the I think relevant parts).

(Again, after applying that patch, you could change `log.debug()` to `log.info()`.)



---

archive/issue_comments_120481.json:
```json
{
    "body": "<a id='comment:30'></a>\nHmmm, for some reason I get the `Updating easy-install.pth file: \"...\"` messages, but not the rest... :/",
    "created_at": "2010-10-29T03:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120481",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>
Hmmm, for some reason I get the `Updating easy-install.pth file: "..."` messages, but not the rest... :/



---

archive/issue_comments_120482.json:
```json
{
    "body": "Ordinary patch to `easy_install` to get more debug messages. Not relevant for merging the ticket. (2nd version)",
    "created_at": "2010-10-29T03:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120482",
    "user": "https://github.com/nexttime"
}
```

Ordinary patch to `easy_install` to get more debug messages. Not relevant for merging the ticket. (2nd version)



---

archive/attachments_013293.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "easy_install.py.debug.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10176/easy_install.py.debug.patch",
    "created_at": "2010-10-29T04:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_120483.json:
```json
{
    "body": "<a id='comment:31'></a>\nOk, I've updated the patch to `easy_install.py`, which now also does:\n\n```python\nimport os \nif os.environ.get(\"SAGE_SETUPTOOLS_DEBUG\",\"no\")==\"yes\":\n    log.set_threshold(log.DEBUG) \n```\nsuch that `export SAGE_SETUPTOOLS_DEBUG=yes` enables the debug output. (I.e., replacing `log.debug` by `log.info` is no longer necessary.)\n\n(Did not work from SageNB's `setup.py`, don't know yet why.)",
    "created_at": "2010-10-29T04:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120483",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:31'></a>
Ok, I've updated the patch to `easy_install.py`, which now also does:

```python
import os 
if os.environ.get("SAGE_SETUPTOOLS_DEBUG","no")=="yes":
    log.set_threshold(log.DEBUG) 
```
such that `export SAGE_SETUPTOOLS_DEBUG=yes` enables the debug output. (I.e., replacing `log.debug` by `log.info` is no longer necessary.)

(Did not work from SageNB's `setup.py`, don't know yet why.)



---

archive/issue_comments_120484.json:
```json
{
    "body": "<a id='comment:32'></a>\nI know get (after manually deleting sagenb from `easy_install.pth` and forcing reinstallation):\n\n```\n...\nFinished processing dependencies for sagenb==0.8.7.p2\nCopying SageNB package to '/home/leif/Sage/sage-4.6.rc0/devel/sagenb-main'...\nMoving old SageNB package to '/home/leif/Sage/sage-4.6.rc0/devel/sagenb-main-old'...\nrunning develop\nLoading .pth file \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"...\n    Path found: \"./setuptools-0.6c9-py2.6.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg\"\n    Path found: \"./Twisted-9.0.0-py2.6-linux-x86_64.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg\"\n    Path found: \"./zope.interface-3.6.1-py2.6-linux-x86_64.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg\"\n    Path found: \"./zope.proxy-3.6.0-py2.6-linux-x86_64.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.proxy-3.6.0-py2.6-linux-x86_64.egg\"\n    Path found: \"./zope.exceptions-3.6.1-py2.6.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.exceptions-3.6.1-py2.6.egg\"\n    Path found: \"./zope.testing-3.9.5-py2.6.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.testing-3.9.5-py2.6.egg\"\n    Path found: \"./ZConfig-2.8.0-py2.6.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/ZConfig-2.8.0-py2.6.egg\"\n    Path found: \"./zdaemon-2.0.4-py2.6.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zdaemon-2.0.4-py2.6.egg\"\n    Path found: \"./ZODB3-3.7.0-py2.6-linux-x86_64.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/ZODB3-3.7.0-py2.6-linux-x86_64.egg\"\n    Path found: \"./Pygments-0.11.1-py2.6.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Pygments-0.11.1-py2.6.egg\"\n    Path found: \"./Jinja2-2.1.1-py2.6-linux-x86_64.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg\"\n    Path found: \"./Sphinx-0.6.3-py2.6.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Sphinx-0.6.3-py2.6.egg\"\n    Path found: \"./SQLAlchemy-0.5.8-py2.6.egg\"\n    Normalized: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/sagenb-0.8.7.p2-py2.6.egg\"\nrunning egg_info\nwriting requirements to sagenb.egg-info/requires.txt\nwriting sagenb.egg-info/PKG-INFO\nwriting top-level names to sagenb.egg-info/top_level.txt\nwriting dependency_links to sagenb.egg-info/dependency_links.txt\nreading manifest file 'sagenb.egg-info/SOURCES.txt'\nreading manifest template 'MANIFEST.in'\n...\nrunning build_ext\nCreating /home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/sagenb.egg-link (link to .)\nUpdating easy-install.pth file: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"\nRemoving sagenb 0.8.7.p2 from easy-install.pth file\nAdding sagenb 0.8.7.p2 to easy-install.pth file\nSaving .pth file \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"...\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg\" -> \"./setuptools-0.6c9-py2.6.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg\" -> \"./Twisted-9.0.0-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg\" -> \"./zope.interface-3.6.1-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.proxy-3.6.0-py2.6-linux-x86_64.egg\" -> \"./zope.proxy-3.6.0-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.exceptions-3.6.1-py2.6.egg\" -> \"./zope.exceptions-3.6.1-py2.6.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.testing-3.9.5-py2.6.egg\" -> \"./zope.testing-3.9.5-py2.6.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/ZConfig-2.8.0-py2.6.egg\" -> \"./ZConfig-2.8.0-py2.6.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zdaemon-2.0.4-py2.6.egg\" -> \"./zdaemon-2.0.4-py2.6.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/ZODB3-3.7.0-py2.6-linux-x86_64.egg\" -> \"./ZODB3-3.7.0-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Pygments-0.11.1-py2.6.egg\" -> \"./Pygments-0.11.1-py2.6.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg\" -> \"./Jinja2-2.1.1-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Sphinx-0.6.3-py2.6.egg\" -> \"./Sphinx-0.6.3-py2.6.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/SQLAlchemy-0.5.8-py2.6.egg\" -> \"./SQLAlchemy-0.5.8-py2.6.egg\"\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/devel/sagenb-main\" (unchanged)\nSaving /home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\nInstalling jmol script to /home/leif/Sage/sage-4.6.rc0/local/bin\n...\nProcessing Twisted-9.0.0-py2.6-linux-x86_64.egg\nUpdating easy-install.pth file: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"\nTwisted 9.0.0 is already the active version in easy-install.pth\nNot saving .pth file \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\" since it is clean (unmodified).\nInstalling conch script to /home/leif/Sage/sage-4.6.rc0/local/bin\n...\nProcessing setuptools-0.6c9-py2.6.egg\nUpdating easy-install.pth file: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"\nsetuptools 0.6c9 is already the active version in easy-install.pth\nNot saving .pth file \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\" since it is clean (unmodified).\n    Making path relative: \"/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg\" -> \"./setuptools-0.6c9-py2.6.egg\"\nInstalling easy_install script to /home/leif/Sage/sage-4.6.rc0/local/bin\nchanging mode of /home/leif/Sage/sage-4.6.rc0/local/bin/easy_install to 755\nInstalling easy_install-2.6 script to /home/leif/Sage/sage-4.6.rc0/local/bin\nchanging mode of /home/leif/Sage/sage-4.6.rc0/local/bin/easy_install-2.6 to 755\n\nUsing /home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg\nFinished processing dependencies for sagenb==0.8.7.p2\nMaking sagenb path in 'easy-install.pth' relative...\nOld path: \"/home/leif/Sage/sage-4.6.rc0/devel/sagenb-main\"\nNew path: \"../../../../devel/sagenb\"\n\nreal\t0m9.776s\nuser\t0m6.220s\nsys\t0m2.290s\nSuccessfully installed sagenb-0.8.7.p2\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing sagenb-0.8.7.p2.spkg\n```",
    "created_at": "2010-10-29T04:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120484",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'></a>
I know get (after manually deleting sagenb from `easy_install.pth` and forcing reinstallation):

```
...
Finished processing dependencies for sagenb==0.8.7.p2
Copying SageNB package to '/home/leif/Sage/sage-4.6.rc0/devel/sagenb-main'...
Moving old SageNB package to '/home/leif/Sage/sage-4.6.rc0/devel/sagenb-main-old'...
running develop
Loading .pth file "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"...
    Path found: "./setuptools-0.6c9-py2.6.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg"
    Path found: "./Twisted-9.0.0-py2.6-linux-x86_64.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg"
    Path found: "./zope.interface-3.6.1-py2.6-linux-x86_64.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg"
    Path found: "./zope.proxy-3.6.0-py2.6-linux-x86_64.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.proxy-3.6.0-py2.6-linux-x86_64.egg"
    Path found: "./zope.exceptions-3.6.1-py2.6.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.exceptions-3.6.1-py2.6.egg"
    Path found: "./zope.testing-3.9.5-py2.6.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.testing-3.9.5-py2.6.egg"
    Path found: "./ZConfig-2.8.0-py2.6.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/ZConfig-2.8.0-py2.6.egg"
    Path found: "./zdaemon-2.0.4-py2.6.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zdaemon-2.0.4-py2.6.egg"
    Path found: "./ZODB3-3.7.0-py2.6-linux-x86_64.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/ZODB3-3.7.0-py2.6-linux-x86_64.egg"
    Path found: "./Pygments-0.11.1-py2.6.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Pygments-0.11.1-py2.6.egg"
    Path found: "./Jinja2-2.1.1-py2.6-linux-x86_64.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg"
    Path found: "./Sphinx-0.6.3-py2.6.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Sphinx-0.6.3-py2.6.egg"
    Path found: "./SQLAlchemy-0.5.8-py2.6.egg"
    Normalized: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/sagenb-0.8.7.p2-py2.6.egg"
running egg_info
writing requirements to sagenb.egg-info/requires.txt
writing sagenb.egg-info/PKG-INFO
writing top-level names to sagenb.egg-info/top_level.txt
writing dependency_links to sagenb.egg-info/dependency_links.txt
reading manifest file 'sagenb.egg-info/SOURCES.txt'
reading manifest template 'MANIFEST.in'
...
running build_ext
Creating /home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/sagenb.egg-link (link to .)
Updating easy-install.pth file: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"
Removing sagenb 0.8.7.p2 from easy-install.pth file
Adding sagenb 0.8.7.p2 to easy-install.pth file
Saving .pth file "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"...
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg" -> "./setuptools-0.6c9-py2.6.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg" -> "./Twisted-9.0.0-py2.6-linux-x86_64.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg" -> "./zope.interface-3.6.1-py2.6-linux-x86_64.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.proxy-3.6.0-py2.6-linux-x86_64.egg" -> "./zope.proxy-3.6.0-py2.6-linux-x86_64.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.exceptions-3.6.1-py2.6.egg" -> "./zope.exceptions-3.6.1-py2.6.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.testing-3.9.5-py2.6.egg" -> "./zope.testing-3.9.5-py2.6.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/ZConfig-2.8.0-py2.6.egg" -> "./ZConfig-2.8.0-py2.6.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/zdaemon-2.0.4-py2.6.egg" -> "./zdaemon-2.0.4-py2.6.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/ZODB3-3.7.0-py2.6-linux-x86_64.egg" -> "./ZODB3-3.7.0-py2.6-linux-x86_64.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Pygments-0.11.1-py2.6.egg" -> "./Pygments-0.11.1-py2.6.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg" -> "./Jinja2-2.1.1-py2.6-linux-x86_64.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/Sphinx-0.6.3-py2.6.egg" -> "./Sphinx-0.6.3-py2.6.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/SQLAlchemy-0.5.8-py2.6.egg" -> "./SQLAlchemy-0.5.8-py2.6.egg"
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/devel/sagenb-main" (unchanged)
Saving /home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth
Installing jmol script to /home/leif/Sage/sage-4.6.rc0/local/bin
...
Processing Twisted-9.0.0-py2.6-linux-x86_64.egg
Updating easy-install.pth file: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"
Twisted 9.0.0 is already the active version in easy-install.pth
Not saving .pth file "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth" since it is clean (unmodified).
Installing conch script to /home/leif/Sage/sage-4.6.rc0/local/bin
...
Processing setuptools-0.6c9-py2.6.egg
Updating easy-install.pth file: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"
setuptools 0.6c9 is already the active version in easy-install.pth
Not saving .pth file "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth" since it is clean (unmodified).
    Making path relative: "/home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg" -> "./setuptools-0.6c9-py2.6.egg"
Installing easy_install script to /home/leif/Sage/sage-4.6.rc0/local/bin
changing mode of /home/leif/Sage/sage-4.6.rc0/local/bin/easy_install to 755
Installing easy_install-2.6 script to /home/leif/Sage/sage-4.6.rc0/local/bin
changing mode of /home/leif/Sage/sage-4.6.rc0/local/bin/easy_install-2.6 to 755

Using /home/leif/Sage/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg
Finished processing dependencies for sagenb==0.8.7.p2
Making sagenb path in 'easy-install.pth' relative...
Old path: "/home/leif/Sage/sage-4.6.rc0/devel/sagenb-main"
New path: "../../../../devel/sagenb"

real	0m9.776s
user	0m6.220s
sys	0m2.290s
Successfully installed sagenb-0.8.7.p2
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing sagenb-0.8.7.p2.spkg
```



---

archive/issue_comments_120485.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [leif](#comment%3A32):\n> I know get (after manually deleting sagenb from `easy_install.pth` and forcing reinstallation):\n\n\nHere is my output ! Strangely, no write occurs at the critical momment \n\n```\nrunning build_ext\nCreating /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/sagenb.egg-link (link to .)\nUpdating easy-install.pth file: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"\nRemoving sagenb 0.8.7-patched from easy-install.pth file\nAdding sagenb 0.8.7-patched to easy-install.pth file\nInstalling jmol script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling sage3d script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\n\nInstalled /home/data/Sage-Install/readline/sage-4.6.rc0/devel/sagenb-main\nProcessing dependencies for sagenb==0.8.7-patched\nSearching for Twisted==9.0.0\nBest match: Twisted 9.0.0\nProcessing Twisted-9.0.0-py2.6-linux-x86_64.egg\nUpdating easy-install.pth file: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"\nTwisted 9.0.0 is already the active version in easy-install.pth\nInstalling cftp script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling trial script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling mailmail script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling tkconch script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling twistd script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling conch script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling tap2rpm script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling mktap script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling pyhtmlizer script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling ckeygen script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling lore script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling tapconvert script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling manhole script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling tap2deb script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\n\nUsing /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg\nSearching for zope.interface==3.6.1\nBest match: zope.interface 3.6.1\nProcessing zope.interface-3.6.1-py2.6-linux-x86_64.egg\nUpdating easy-install.pth file: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"\nzope.interface 3.6.1 is already the active version in easy-install.pth\n\nUsing /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg\nSearching for setuptools==0.6c9\nBest match: setuptools 0.6c9\nProcessing setuptools-0.6c9-py2.6.egg\nUpdating easy-install.pth file: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"\nsetuptools 0.6c9 is already the active version in easy-install.pth\nInstalling easy_install script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\nInstalling easy_install-2.6 script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin\n\nUsing /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg\nFinished processing dependencies for sagenb==0.8.7-patched\nOld path: \"\"\nNew path: \"\"\n\nreal    0m8.764s\nuser    0m6.042s\nsys     0m2.094s\nSuccessfully installed sagenb-0.8.7-patched\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing sagenb-0.8.7-patched.spkg\n```\n\nWe are probably getting close. I'm investigating this further. Also: I'll be more or\nless hanging on irc the whole day (It is 10am in paris)...",
    "created_at": "2010-10-29T08:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120485",
    "user": "https://github.com/hivert"
}
```

<a id='comment:33'></a>
Replying to [leif](#comment%3A32):
> I know get (after manually deleting sagenb from `easy_install.pth` and forcing reinstallation):


Here is my output ! Strangely, no write occurs at the critical momment 

```
running build_ext
Creating /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/sagenb.egg-link (link to .)
Updating easy-install.pth file: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"
Removing sagenb 0.8.7-patched from easy-install.pth file
Adding sagenb 0.8.7-patched to easy-install.pth file
Installing jmol script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing sage3d script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin

Installed /home/data/Sage-Install/readline/sage-4.6.rc0/devel/sagenb-main
Processing dependencies for sagenb==0.8.7-patched
Searching for Twisted==9.0.0
Best match: Twisted 9.0.0
Processing Twisted-9.0.0-py2.6-linux-x86_64.egg
Updating easy-install.pth file: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"
Twisted 9.0.0 is already the active version in easy-install.pth
Installing cftp script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing trial script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing mailmail script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing tkconch script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing twistd script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing conch script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing tap2rpm script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing mktap script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing pyhtmlizer script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing ckeygen script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing lore script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing tapconvert script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing manhole script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing tap2deb script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin

Using /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg
Searching for zope.interface==3.6.1
Best match: zope.interface 3.6.1
Processing zope.interface-3.6.1-py2.6-linux-x86_64.egg
Updating easy-install.pth file: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"
zope.interface 3.6.1 is already the active version in easy-install.pth

Using /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg
Searching for setuptools==0.6c9
Best match: setuptools 0.6c9
Processing setuptools-0.6c9-py2.6.egg
Updating easy-install.pth file: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"
setuptools 0.6c9 is already the active version in easy-install.pth
Installing easy_install script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin
Installing easy_install-2.6 script to /home/data/Sage-Install/readline/sage-4.6.rc0/local/bin

Using /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg
Finished processing dependencies for sagenb==0.8.7-patched
Old path: ""
New path: ""

real    0m8.764s
user    0m6.042s
sys     0m2.094s
Successfully installed sagenb-0.8.7-patched
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing sagenb-0.8.7-patched.spkg
```

We are probably getting close. I'm investigating this further. Also: I'll be more or
less hanging on irc the whole day (It is 10am in paris)...



---

archive/issue_comments_120486.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [hivert](#comment%3A33):\n> Replying to [leif](#comment%3A32):\n> > I know get (after manually deleting sagenb from `easy_install.pth` and forcing reinstallation):\n\n> \n> Here is my output ! Strangely, no write occurs at the critical momment \n\n\nFlorent, did you `export SAGE_SETUPTOOLS_DEBUG=yes` before reinstalling?",
    "created_at": "2010-10-29T10:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120486",
    "user": "https://github.com/qed777"
}
```

<a id='comment:34'></a>
Replying to [hivert](#comment%3A33):
> Replying to [leif](#comment%3A32):
> > I know get (after manually deleting sagenb from `easy_install.pth` and forcing reinstallation):

> 
> Here is my output ! Strangely, no write occurs at the critical momment 


Florent, did you `export SAGE_SETUPTOOLS_DEBUG=yes` before reinstalling?



---

archive/issue_comments_120487.json:
```json
{
    "body": "<a id='comment:35'></a>\n> We are probably getting close. I'm investigating this further. Also: I'll be more or\n> less hanging on irc the whole day (It is 10am in paris)...\n\n\nMore infos: I added some more log stuff to the function add:\n\n```\n    def add(self,dist):\n        if dist.location not in self.paths and dist.location not in self.sitedirs:\n            log.info(\"**************appending %s to pth file\"%(dist.location))\n            self.paths.append(dist.location); self.dirty = True\n        else:\n            log.info(\"####### %s already in self.paths or self.sitedirs not adding\"%dist.location)\n            log.info(\"####### %s,%s\"%(dist.location in self.paths,\n                                      dist.location in self.sitedirs))\n        Environment.add(self,dist)\n```\nI appear that sagenb is allready in self.paths and therefor not added ! Here is a exerpt from the log\n\n```\nRemoving sagenb 0.8.7-patched from easy-install.pth file\nAdding sagenb 0.8.7-patched to easy-install.pth file\n####### /home/data/Sage-Install/readline/sage-4.6.rc0/devel/sagenb-main already in self.paths or self.sitedirs not adding\n####### False,True\nSaving .pth file \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\"...\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg\" -> \"./setuptools-0.6\nc9-py2.6.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg\" -> \"./Twis\nted-9.0.0-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg\" -> \n\"./zope.interface-3.6.1-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.proxy-3.6.0-py2.6-linux-x86_64.egg\" -> \"./z\nope.proxy-3.6.0-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.exceptions-3.6.1-py2.6.egg\" -> \"./zope.exce\nptions-3.6.1-py2.6.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.testing-3.9.5-py2.6.egg\" -> \"./zope.testing\n-3.9.5-py2.6.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/ZConfig-2.8.0-py2.6.egg\" -> \"./ZConfig-2.8.0-py2\n.6.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zdaemon-2.0.4-py2.6.egg\" -> \"./zdaemon-2.0.4-py2\n.6.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/ZODB3-3.7.0-py2.6-linux-x86_64.egg\" -> \"./ZODB3-\n3.7.0-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Pygments-0.11.1-py2.6.egg\" -> \"./Pygments-0.11.1\n-py2.6.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg\" -> \"./Jinja\n2-2.1.1-py2.6-linux-x86_64.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Sphinx-0.6.3-py2.6.egg\" -> \"./Sphinx-0.6.3-py2.6\n.egg\"\n    Making path relative: \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/SQLAlchemy-0.5.8-py2.6.egg\" -> \"./SQLAlchemy-0.5\n.8-py2.6.egg\"\nSaving /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth\n```\nI need to understand more what's happening. In the meantime I'm also ptestlong-ing `http://spkg-upload.googlecode.com/files/sagenb-0.8.7.p1.spkg`.\n\nSo far it looks good.",
    "created_at": "2010-10-29T10:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120487",
    "user": "https://github.com/hivert"
}
```

<a id='comment:35'></a>
> We are probably getting close. I'm investigating this further. Also: I'll be more or
> less hanging on irc the whole day (It is 10am in paris)...


More infos: I added some more log stuff to the function add:

```
    def add(self,dist):
        if dist.location not in self.paths and dist.location not in self.sitedirs:
            log.info("**************appending %s to pth file"%(dist.location))
            self.paths.append(dist.location); self.dirty = True
        else:
            log.info("####### %s already in self.paths or self.sitedirs not adding"%dist.location)
            log.info("####### %s,%s"%(dist.location in self.paths,
                                      dist.location in self.sitedirs))
        Environment.add(self,dist)
```
I appear that sagenb is allready in self.paths and therefor not added ! Here is a exerpt from the log

```
Removing sagenb 0.8.7-patched from easy-install.pth file
Adding sagenb 0.8.7-patched to easy-install.pth file
####### /home/data/Sage-Install/readline/sage-4.6.rc0/devel/sagenb-main already in self.paths or self.sitedirs not adding
####### False,True
Saving .pth file "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth"...
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/setuptools-0.6c9-py2.6.egg" -> "./setuptools-0.6
c9-py2.6.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg" -> "./Twis
ted-9.0.0-py2.6-linux-x86_64.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.interface-3.6.1-py2.6-linux-x86_64.egg" -> 
"./zope.interface-3.6.1-py2.6-linux-x86_64.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.proxy-3.6.0-py2.6-linux-x86_64.egg" -> "./z
ope.proxy-3.6.0-py2.6-linux-x86_64.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.exceptions-3.6.1-py2.6.egg" -> "./zope.exce
ptions-3.6.1-py2.6.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zope.testing-3.9.5-py2.6.egg" -> "./zope.testing
-3.9.5-py2.6.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/ZConfig-2.8.0-py2.6.egg" -> "./ZConfig-2.8.0-py2
.6.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/zdaemon-2.0.4-py2.6.egg" -> "./zdaemon-2.0.4-py2
.6.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/ZODB3-3.7.0-py2.6-linux-x86_64.egg" -> "./ZODB3-
3.7.0-py2.6-linux-x86_64.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Pygments-0.11.1-py2.6.egg" -> "./Pygments-0.11.1
-py2.6.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Jinja2-2.1.1-py2.6-linux-x86_64.egg" -> "./Jinja
2-2.1.1-py2.6-linux-x86_64.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/Sphinx-0.6.3-py2.6.egg" -> "./Sphinx-0.6.3-py2.6
.egg"
    Making path relative: "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/SQLAlchemy-0.5.8-py2.6.egg" -> "./SQLAlchemy-0.5
.8-py2.6.egg"
Saving /home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages/easy-install.pth
```
I need to understand more what's happening. In the meantime I'm also ptestlong-ing `http://spkg-upload.googlecode.com/files/sagenb-0.8.7.p1.spkg`.

So far it looks good.



---

archive/issue_comments_120488.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [mpatel](#comment%3A34):\n> Replying to [hivert](#comment%3A33):\n> > Replying to [leif](#comment%3A32):\n> > > I know get (after manually deleting sagenb from `easy_install.pth` and forcing reinstallation):\n\n> > \n> > Here is my output ! Strangely, no write occurs at the critical momment \n\n> \n> Florent, did you `export SAGE_SETUPTOOLS_DEBUG=yes` before reinstalling?\n\n\nSorry I uploaded the wrong log where I indeed forgot to export DEBUG... The full correct log is at `http://www-igm.univ-mlv.fr/~hivert/SAGE/lastinst.log`\n\nI'm going to have lunch.",
    "created_at": "2010-10-29T10:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120488",
    "user": "https://github.com/hivert"
}
```

<a id='comment:36'></a>
Replying to [mpatel](#comment%3A34):
> Replying to [hivert](#comment%3A33):
> > Replying to [leif](#comment%3A32):
> > > I know get (after manually deleting sagenb from `easy_install.pth` and forcing reinstallation):

> > 
> > Here is my output ! Strangely, no write occurs at the critical momment 

> 
> Florent, did you `export SAGE_SETUPTOOLS_DEBUG=yes` before reinstalling?


Sorry I uploaded the wrong log where I indeed forgot to export DEBUG... The full correct log is at `http://www-igm.univ-mlv.fr/~hivert/SAGE/lastinst.log`

I'm going to have lunch.



---

archive/issue_comments_120489.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [hivert](#comment%3A35):\n> > We are probably getting close. I'm investigating this further. Also: I'll be more or\n> > less hanging on irc the whole day (It is 10am in paris)...\n\n\n> I appear that sagenb is allready in self.paths and therefor not added ! Here is a exerpt from the log\n\n\nShould that be `self.sitedirs`, according to the output `####### False,True`?  Adding a statement to print this, I always get\n\n```python\n['/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6/site-packages', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/site-python']\n```",
    "created_at": "2010-10-29T13:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120489",
    "user": "https://github.com/qed777"
}
```

<a id='comment:37'></a>
Replying to [hivert](#comment%3A35):
> > We are probably getting close. I'm investigating this further. Also: I'll be more or
> > less hanging on irc the whole day (It is 10am in paris)...


> I appear that sagenb is allready in self.paths and therefor not added ! Here is a exerpt from the log


Should that be `self.sitedirs`, according to the output `####### False,True`?  Adding a statement to print this, I always get

```python
['/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6/site-packages', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/site-python']
```



---

archive/issue_comments_120490.json:
```json
{
    "body": "<a id='comment:38'></a>\nIf I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this?  This is probably a separate problem, though.",
    "created_at": "2010-10-29T14:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120490",
    "user": "https://github.com/qed777"
}
```

<a id='comment:38'></a>
If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this?  This is probably a separate problem, though.



---

archive/issue_comments_120491.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [mpatel](#comment%3A38):\n> If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this?  This is probably a separate problem, though.\n\n\nThat is, we may need to reset the relative sagenb path in `sage-location`.",
    "created_at": "2010-10-29T14:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120491",
    "user": "https://github.com/qed777"
}
```

<a id='comment:39'></a>
Replying to [mpatel](#comment%3A38):
> If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this?  This is probably a separate problem, though.


That is, we may need to reset the relative sagenb path in `sage-location`.



---

archive/issue_comments_120492.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [leif](#comment%3A17):\n> **New spkg: http://spkg-upload.googlecode.com/files/sagenb-0.8.7.p1.spkg**\n> \n> **md5sum:** `6fe0e76e336fc24e71b5c591a112f8fb  sagenb-0.8.7.p1.spkg`\n> \n> Florent, again: Please install / build, test and report! ;-)\n\n\nHere is the result of ptestlong of sage-4.6.rc0 with the following\nnon-standard spkg\n\n```\nsetuptools-0.6c9.p0.spkg\nreadline-6.1.spkg\nsagenb-0.8.7.p1.spkg\n```\n\n```\nsage -t  -long -force_lib devel/sage/sage/all.py\nTraceback (most recent call last):\n  File \"/home/florent/.sage//tmp/all.py\", line 2, in <module>\n    from sage.all_cmdline import *; \n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/all_cmdline.py\", line 14, in <module>\n    from sage.all import *\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/all.py\", line 64, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/all.py\", line 16, in <module>\n    from sage_timeit_class import timeit\n  File \"sage_timeit_class.pyx\", line 3, in init sage.misc.sage_timeit_class (sage/misc/sage_timeit_class.c:837)\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/sage_timeit.py\", line 12, in <module>\n    import timeit as timeit_, time, math, preparser, interpreter\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/interpreter.py\", line 95, in <module>\n    import IPython.ipapi\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/__init__.py\", line 58, in <module>\n    __import__(name,glob,loc,[])\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/Shell.py\", line 45, in <module>\n    from IPython.iplib import InteractiveShell\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/iplib.py\", line 59, in <module>\n    from sets import Set\nImportError: cannot import name Set\n\n         [0.5 s]\nsage -t  -long -force_lib devel/sage/sage/all_cmdline.py\nTraceback (most recent call last):\n  File \"/home/florent/.sage//tmp/all_cmdline.py\", line 2, in <module>\n    from sage.all_cmdline import *; \n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/all_cmdline.py\", line 14, in <module>\n    from sage.all import *\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/all.py\", line 64, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/all.py\", line 16, in <module>\n    from sage_timeit_class import timeit\n  File \"sage_timeit_class.pyx\", line 3, in init sage.misc.sage_timeit_class (sage/misc/sage_timeit_class.c:837)\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/sage_timeit.py\", line 12, in <module>\n    import timeit as timeit_, time, math, preparser, interpreter\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/interpreter.py\", line 95, in <module>\n    import IPython.ipapi\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/__init__.py\", line 58, in <module>\n    __import__(name,glob,loc,[])\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/Shell.py\", line 45, in <module>\n    from IPython.iplib import InteractiveShell\n  File \"/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/iplib.py\", line 59, in <module>\n    from sets import Set\nImportError: cannot import name Set\n\n         [0.5 s]\n[...]\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n        sage -t  -long -force_lib devel/sage/sage/all.py # 0 doctests failed\n        sage -t  -long -force_lib devel/sage/sage/all_cmdline.py # 0 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1907.5 seconds\n```\nNote that if I launch the same tests alone:\n\n```\nsage -t -long -force_lib \"devel/sage/sage/all.py\"\n         [1.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 1.1 seconds\n\nsage -t -long -force_lib \"devel/sage/sage/all_cmdline.py\"\n         [1.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 1.1 seconds\n```\nSo this is probably the usual parallel test problem.",
    "created_at": "2010-10-29T14:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120492",
    "user": "https://github.com/hivert"
}
```

<a id='comment:40'></a>
Replying to [leif](#comment%3A17):
> **New spkg: http://spkg-upload.googlecode.com/files/sagenb-0.8.7.p1.spkg**
> 
> **md5sum:** `6fe0e76e336fc24e71b5c591a112f8fb  sagenb-0.8.7.p1.spkg`
> 
> Florent, again: Please install / build, test and report! ;-)


Here is the result of ptestlong of sage-4.6.rc0 with the following
non-standard spkg

```
setuptools-0.6c9.p0.spkg
readline-6.1.spkg
sagenb-0.8.7.p1.spkg
```

```
sage -t  -long -force_lib devel/sage/sage/all.py
Traceback (most recent call last):
  File "/home/florent/.sage//tmp/all.py", line 2, in <module>
    from sage.all_cmdline import *; 
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/all_cmdline.py", line 14, in <module>
    from sage.all import *
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/all.py", line 64, in <module>
    from sage.misc.all       import *         # takes a while
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/all.py", line 16, in <module>
    from sage_timeit_class import timeit
  File "sage_timeit_class.pyx", line 3, in init sage.misc.sage_timeit_class (sage/misc/sage_timeit_class.c:837)
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/sage_timeit.py", line 12, in <module>
    import timeit as timeit_, time, math, preparser, interpreter
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/interpreter.py", line 95, in <module>
    import IPython.ipapi
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/__init__.py", line 58, in <module>
    __import__(name,glob,loc,[])
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/Shell.py", line 45, in <module>
    from IPython.iplib import InteractiveShell
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/iplib.py", line 59, in <module>
    from sets import Set
ImportError: cannot import name Set

         [0.5 s]
sage -t  -long -force_lib devel/sage/sage/all_cmdline.py
Traceback (most recent call last):
  File "/home/florent/.sage//tmp/all_cmdline.py", line 2, in <module>
    from sage.all_cmdline import *; 
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/all_cmdline.py", line 14, in <module>
    from sage.all import *
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/all.py", line 64, in <module>
    from sage.misc.all       import *         # takes a while
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/all.py", line 16, in <module>
    from sage_timeit_class import timeit
  File "sage_timeit_class.pyx", line 3, in init sage.misc.sage_timeit_class (sage/misc/sage_timeit_class.c:837)
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/sage_timeit.py", line 12, in <module>
    import timeit as timeit_, time, math, preparser, interpreter
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/sage/misc/interpreter.py", line 95, in <module>
    import IPython.ipapi
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/__init__.py", line 58, in <module>
    __import__(name,glob,loc,[])
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/Shell.py", line 45, in <module>
    from IPython.iplib import InteractiveShell
  File "/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python/site-packages/IPython/iplib.py", line 59, in <module>
    from sets import Set
ImportError: cannot import name Set

         [0.5 s]
[...]
----------------------------------------------------------------------

The following tests failed:

        sage -t  -long -force_lib devel/sage/sage/all.py # 0 doctests failed
        sage -t  -long -force_lib devel/sage/sage/all_cmdline.py # 0 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1907.5 seconds
```
Note that if I launch the same tests alone:

```
sage -t -long -force_lib "devel/sage/sage/all.py"
         [1.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 1.1 seconds

sage -t -long -force_lib "devel/sage/sage/all_cmdline.py"
         [1.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 1.1 seconds
```
So this is probably the usual parallel test problem.



---

archive/issue_comments_120493.json:
```json
{
    "body": "<a id='comment:41'></a>\nI Mitesh,\n\n> Should that be `self.sitedirs`, according to the output `####### False,True`?  \n\n\nIndeed !\n\n> Adding a statement to print this, I always get\n\n\n```python\n ['/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6/site-packages', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/site-python']\n```\n\nI get\n\n```python\nself.sitedirs = ['/home/data/Sage-Install/readline/sage-4.6.rc0/devel/sagenb-main', '/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6', '/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages', '/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/site-python']\n```\nAnd that must be the root of my problem.",
    "created_at": "2010-10-29T14:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120493",
    "user": "https://github.com/hivert"
}
```

<a id='comment:41'></a>
I Mitesh,

> Should that be `self.sitedirs`, according to the output `####### False,True`?  


Indeed !

> Adding a statement to print this, I always get


```python
 ['/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6/site-packages', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/site-python']
```

I get

```python
self.sitedirs = ['/home/data/Sage-Install/readline/sage-4.6.rc0/devel/sagenb-main', '/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6', '/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/python2.6/site-packages', '/home/data/Sage-Install/readline/sage-4.6.rc0/local/lib/site-python']
```
And that must be the root of my problem.



---

archive/issue_comments_120494.json:
```json
{
    "body": "<a id='comment:42'></a>\nThe initial source of the `sitedirs` seems to be `get_site_dirs`, which gives\n\n```python\nsage: from setuptools.command.easy_install import get_site_dirs\nsage: get_site_dirs()\n['/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6/site-packages', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/site-python']\n```\nThis function begins\n\n```python\ndef get_site_dirs():\n    # return a list of 'site' dirs\n    sitedirs = filter(None,os.environ.get('PYTHONPATH','').split(os.pathsep))\n...\n```\nand later appends the paths I get above.\n\n```python\nsage: os.environ.get('PYTHONPATH','')\n':/home/mpatel/apps/sage/local/lib/python'\n```\nDo you see a sagenb path here?",
    "created_at": "2010-10-29T23:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120494",
    "user": "https://github.com/qed777"
}
```

<a id='comment:42'></a>
The initial source of the `sitedirs` seems to be `get_site_dirs`, which gives

```python
sage: from setuptools.command.easy_install import get_site_dirs
sage: get_site_dirs()
['/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/python2.6/site-packages', '/mnt/usb1/scratch/mpatel/apps/sage-4.6.rc0/local/lib/site-python']
```
This function begins

```python
def get_site_dirs():
    # return a list of 'site' dirs
    sitedirs = filter(None,os.environ.get('PYTHONPATH','').split(os.pathsep))
...
```
and later appends the paths I get above.

```python
sage: os.environ.get('PYTHONPATH','')
':/home/mpatel/apps/sage/local/lib/python'
```
Do you see a sagenb path here?



---

archive/issue_comments_120495.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [mpatel](#comment%3A38):\n> If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this? \n\n\nOf course. This will happen each time `easy_install` modifies that file, also when (re)installing other spkgs that use setuptools.\n\n> This is probably a separate problem, though.\n",
    "created_at": "2010-10-30T00:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120495",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:43'></a>
Replying to [mpatel](#comment%3A38):
> If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this? 


Of course. This will happen each time `easy_install` modifies that file, also when (re)installing other spkgs that use setuptools.

> This is probably a separate problem, though.




---

archive/issue_comments_120496.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [leif](#comment%3A43):\n> Replying to [mpatel](#comment%3A38):\n> > If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this? \n\n> \n> Of course. This will happen each time `easy_install` modifies that file, also when (re)installing other spkgs that use setuptools.\n\n\n\nWow, this seems like it is really turning into a mess.  Maybe we should just pretend to install in the normal place (the site-packages directory) and then move that directory to the SAGE_DEVEL directory and create a relative symlink from site-packages/sagenb... to SAGE_DEVEL/sagenb ourselves?",
    "created_at": "2010-10-30T05:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120496",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:44'></a>
Replying to [leif](#comment%3A43):
> Replying to [mpatel](#comment%3A38):
> > If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this? 

> 
> Of course. This will happen each time `easy_install` modifies that file, also when (re)installing other spkgs that use setuptools.



Wow, this seems like it is really turning into a mess.  Maybe we should just pretend to install in the normal place (the site-packages directory) and then move that directory to the SAGE_DEVEL directory and create a relative symlink from site-packages/sagenb... to SAGE_DEVEL/sagenb ourselves?



---

archive/issue_comments_120497.json:
```json
{
    "body": "<a id='comment:45'></a>\nI've finally found the problem: it has nothing to do with openSUSE (I've\nreproduced it on `sage.sagemath.org`). I had the environment variable\n`SAGE_PATH` set to `.` (don't ask me why) ! When this is the case,\nduring the installation of sagenb, python is able to find sagenb into its path\nand therefore refuse to add it to `easy-install.pth`. I don't want to edit\nthe header of this ticket because I'm not sure what is the right decision\nhere.",
    "created_at": "2010-10-30T15:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120497",
    "user": "https://github.com/hivert"
}
```

<a id='comment:45'></a>
I've finally found the problem: it has nothing to do with openSUSE (I've
reproduced it on `sage.sagemath.org`). I had the environment variable
`SAGE_PATH` set to `.` (don't ask me why) ! When this is the case,
during the installation of sagenb, python is able to find sagenb into its path
and therefore refuse to add it to `easy-install.pth`. I don't want to edit
the header of this ticket because I'm not sure what is the right decision
here.



---

archive/issue_comments_120498.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [hivert](#comment%3A45):\n> I don't want to edit the header of this ticket because I'm not sure what is the right decision here. \n\n\nOpen a new ticket *\"SageNB fails to install when SAGE_PATH is set to '.' \"* and mark this to be closed as a duplicate. ;-)",
    "created_at": "2010-10-30T15:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120498",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:46'></a>
Replying to [hivert](#comment%3A45):
> I don't want to edit the header of this ticket because I'm not sure what is the right decision here. 


Open a new ticket *"SageNB fails to install when SAGE_PATH is set to '.' "* and mark this to be closed as a duplicate. ;-)



---

archive/issue_comments_120499.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2010-10-30T15:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120499",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_120500.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [leif](#comment%3A46):\n> Replying to [hivert](#comment%3A45):\n> > I don't want to edit the header of this ticket because I'm not sure what is the right decision here. \n\n> \n> Open a new ticket *\"SageNB fails to install when SAGE_PATH is set to '.' \"* and mark this to be closed as a duplicate. ;-)\n\n\nI created #10192.\n\nThere is still the question raised by jason in comment 44...",
    "created_at": "2010-10-30T15:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120500",
    "user": "https://github.com/hivert"
}
```

<a id='comment:47'></a>
Replying to [leif](#comment%3A46):
> Replying to [hivert](#comment%3A45):
> > I don't want to edit the header of this ticket because I'm not sure what is the right decision here. 

> 
> Open a new ticket *"SageNB fails to install when SAGE_PATH is set to '.' "* and mark this to be closed as a duplicate. ;-)


I created #10192.

There is still the question raised by jason in comment 44...



---

archive/issue_comments_120501.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [jason](#comment%3A44):\n> Replying to [leif](#comment%3A43):\n> > Replying to [mpatel](#comment%3A38):\n> > > If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this? \n\n> > \n> > Of course. This will happen each time `easy_install` modifies that file, also when (re)installing other spkgs that use setuptools.\n\n> \n> \n> Wow, this seems like it is really turning into a mess.  Maybe we should just pretend to install in the normal place (the site-packages directory) and then move that directory to the SAGE_DEVEL directory and create a relative symlink from site-packages/sagenb... to SAGE_DEVEL/sagenb ourselves?\n\n\nAs said on the IRC, I don't think this works with (at least our current) unpatched setuptools; these expand symbolic links such that if I create\n\n```\nlocal/lib/python/site-packages/sagenb -> ../../../../devel/sagenb\n```\nand add `./sagenb` to `easy-install.pth`, installing different spkgs using setuptools again replaces this by an absolute path.",
    "created_at": "2010-10-30T17:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120501",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:48'></a>
Replying to [jason](#comment%3A44):
> Replying to [leif](#comment%3A43):
> > Replying to [mpatel](#comment%3A38):
> > > If I run `easy_install pep8` in a Sage subshell, the relative path to sagenb in `easy-install.pth` is made absolute again.  Does anyone else see this? 

> > 
> > Of course. This will happen each time `easy_install` modifies that file, also when (re)installing other spkgs that use setuptools.

> 
> 
> Wow, this seems like it is really turning into a mess.  Maybe we should just pretend to install in the normal place (the site-packages directory) and then move that directory to the SAGE_DEVEL directory and create a relative symlink from site-packages/sagenb... to SAGE_DEVEL/sagenb ourselves?


As said on the IRC, I don't think this works with (at least our current) unpatched setuptools; these expand symbolic links such that if I create

```
local/lib/python/site-packages/sagenb -> ../../../../devel/sagenb
```
and add `./sagenb` to `easy-install.pth`, installing different spkgs using setuptools again replaces this by an absolute path.



---

archive/issue_comments_120502.json:
```json
{
    "body": "<a id='comment:49'></a>\nDespite that, I don't think this needs to remain a 4.6 blocker.\n\nOf course I can upload the p2 spkg (though the p1 also works around the issue, and it seems rather unlikely other people will run into this, or they could at least now find a simple solution...)\n\nWe could improve the SageNB spkg in 4.6.1 as well, along with changes to setuptools and / or `sage-location`.\n\nAnyway, going to upload the second patch (to get the p2 version, which also removes the non-portable `ln -snf ...`). (I haven't made more changes to it since yesterday, i.e. the changes are those I mailed you.)",
    "created_at": "2010-10-30T19:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120502",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:49'></a>
Despite that, I don't think this needs to remain a 4.6 blocker.

Of course I can upload the p2 spkg (though the p1 also works around the issue, and it seems rather unlikely other people will run into this, or they could at least now find a simple solution...)

We could improve the SageNB spkg in 4.6.1 as well, along with changes to setuptools and / or `sage-location`.

Anyway, going to upload the second patch (to get the p2 version, which also removes the non-portable `ln -snf ...`). (I haven't made more changes to it since yesterday, i.e. the changes are those I mailed you.)



---

archive/attachments_013294.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10176-further_improve_spkg_install-spkg.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10176/trac_10176-further_improve_spkg_install-spkg.patch",
    "created_at": "2010-10-30T19:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_120503.json:
```json
{
    "body": "SageNB spkg patch (0.8.7.p1 -> 0.8.7.p2). Removes `ln -snf` etc.; apply on top of the previous spkg patch (i.e., the p1).",
    "created_at": "2010-10-30T19:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120503",
    "user": "https://github.com/nexttime"
}
```

SageNB spkg patch (0.8.7.p1 -> 0.8.7.p2). Removes `ln -snf` etc.; apply on top of the previous spkg patch (i.e., the p1).



---

archive/issue_comments_120504.json:
```json
{
    "body": "Cumulative diff between SageNB 0.8.7 and 0.8.7.p2 - for reference / review only.",
    "created_at": "2010-10-30T19:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120504",
    "user": "https://github.com/nexttime"
}
```

Cumulative diff between SageNB 0.8.7 and 0.8.7.p2 - for reference / review only.



---

archive/attachments_013295.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "sagenb-0.8.7_vs._0.8.7.p2.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10176/sagenb-0.8.7_vs._0.8.7.p2.diff",
    "created_at": "2010-10-30T22:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_120505.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [leif](#comment%3A49):\n> Anyway, going to upload the second patch (to get the p2 version, which also removes the non-portable `ln -snf ...`). (I haven't made more changes to it since yesterday, i.e. the changes are those I mailed you.)\n\n\nFor convenience, I've also uploaded the second spkg:\n\n**http://spkg-upload.googlecode.com/files/sagenb-0.8.7.p2.spkg**\n\n**md5sum:** `bfe01e9f07d629260652a6794ea04dcc  sagenb-0.8.7.p2.spkg`",
    "created_at": "2010-10-30T22:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120505",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:50'></a>
Replying to [leif](#comment%3A49):
> Anyway, going to upload the second patch (to get the p2 version, which also removes the non-portable `ln -snf ...`). (I haven't made more changes to it since yesterday, i.e. the changes are those I mailed you.)


For convenience, I've also uploaded the second spkg:

**http://spkg-upload.googlecode.com/files/sagenb-0.8.7.p2.spkg**

**md5sum:** `bfe01e9f07d629260652a6794ea04dcc  sagenb-0.8.7.p2.spkg`



---

archive/issue_events_030907.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30907"
}
```



---

archive/issue_comments_120506.json:
```json
{
    "body": "<a id='comment:51'></a>\nReplying to [leif](#comment%3A49):\n> Despite that, I don't think this needs to remain a 4.6 blocker.\n\n\nOK.  It would be great to get your improvements, perhaps without the work around, into 4.6.1.",
    "created_at": "2010-10-30T22:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120506",
    "user": "https://github.com/qed777"
}
```

<a id='comment:51'></a>
Replying to [leif](#comment%3A49):
> Despite that, I don't think this needs to remain a 4.6 blocker.


OK.  It would be great to get your improvements, perhaps without the work around, into 4.6.1.



---

archive/issue_events_030908.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-30T22:57:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30908"
}
```



---

archive/issue_comments_120507.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [mpatel](#comment%3A51):\n> Replying to [leif](#comment%3A49):\n> > Despite that, I don't think this needs to remain a 4.6 blocker.\n\n> \n> OK.  It would be great to get your improvements, perhaps without the work around, into 4.6.1.\n\n\nWell, perhaps the work-around also catches other strange situations... ;-)\n\nI'll upload a patch to `sage-spkg` at #10192 shortly.",
    "created_at": "2010-10-30T23:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120507",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:52'></a>
Replying to [mpatel](#comment%3A51):
> Replying to [leif](#comment%3A49):
> > Despite that, I don't think this needs to remain a 4.6 blocker.

> 
> OK.  It would be great to get your improvements, perhaps without the work around, into 4.6.1.


Well, perhaps the work-around also catches other strange situations... ;-)

I'll upload a patch to `sage-spkg` at #10192 shortly.



---

archive/issue_comments_120508.json:
```json
{
    "body": "<a id='comment:53'></a>\nReplying to [leif](#comment%3A52):\n> I'll upload a patch to `sage-spkg` at #10192 shortly.\n\n\nDone... (needs review) ;-)",
    "created_at": "2010-10-31T01:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120508",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:53'></a>
Replying to [leif](#comment%3A52):
> I'll upload a patch to `sage-spkg` at #10192 shortly.


Done... (needs review) ;-)



---

archive/attachments_013296.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "sagenb-0.8.9-0.8.9.p1.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10176/sagenb-0.8.9-0.8.9.p1.diff",
    "created_at": "2010-12-16T04:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/nexttime"
}
```



---

archive/issue_comments_120509.json:
```json
{
    "body": "Diff between SageNB 0.8.9 and 0.8.9.p1 (with the two patches from here + more changes: messages and error checking). For reference / review.",
    "created_at": "2010-12-16T04:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120509",
    "user": "https://github.com/nexttime"
}
```

Diff between SageNB 0.8.9 and 0.8.9.p1 (with the two patches from here + more changes: messages and error checking). For reference / review.



---

archive/issue_comments_120510.json:
```json
{
    "body": "<a id='comment:54'></a>\nI've attached a diff of the new SageNB 0.8.9.p1 against 0.8.9 here since that spkg contains - besides further changes - also the two patches attached here.\n\nThe new spkg can be found here: http://spkg-upload.googlecode.com/files/sagenb-0.8.9.p1.spkg\n\n`md5sum: c572c29364f2ef496054696219832832`\n\n(I'll perhaps later open a follow-up, or feel free to do so yourself, for *that* spkg. Hope it helps in debugging the upgrade errors...)",
    "created_at": "2010-12-16T04:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120510",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:54'></a>
I've attached a diff of the new SageNB 0.8.9.p1 against 0.8.9 here since that spkg contains - besides further changes - also the two patches attached here.

The new spkg can be found here: http://spkg-upload.googlecode.com/files/sagenb-0.8.9.p1.spkg

`md5sum: c572c29364f2ef496054696219832832`

(I'll perhaps later open a follow-up, or feel free to do so yourself, for *that* spkg. Hope it helps in debugging the upgrade errors...)



---

archive/issue_comments_120511.json:
```json
{
    "body": "**Changing status** from needs_info to needs_work.",
    "created_at": "2010-12-16T08:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120511",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_info to needs_work.



---

archive/issue_comments_120512.json:
```json
{
    "body": "<a id='comment:55'></a>\nNote that (as release manager) I don't care about the spkg, only about the diffs.",
    "created_at": "2010-12-16T08:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120512",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'></a>
Note that (as release manager) I don't care about the spkg, only about the diffs.



---

archive/issue_comments_120513.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to leif:\n> Just curious: *Which* 'sage' is supposed to be called here? \n> Should we check if SAGE_LOCAL or SAGE_ROOT is defined? \n> ... and perhaps call $SAGE_ROOT/sage or $SAGE_LOCAL/bin/...?\n\n\nI think it's not important which `sage` is called.  It just needs `sage -pkg`, `sage -hg` and so on to do the Right Thing.",
    "created_at": "2010-12-16T08:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120513",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:56'></a>
Replying to leif:
> Just curious: *Which* 'sage' is supposed to be called here? 
> Should we check if SAGE_LOCAL or SAGE_ROOT is defined? 
> ... and perhaps call $SAGE_ROOT/sage or $SAGE_LOCAL/bin/...?


I think it's not important which `sage` is called.  It just needs `sage -pkg`, `sage -hg` and so on to do the Right Thing.



---

archive/attachments_013297.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "10176_combined.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10176/10176_combined.patch",
    "created_at": "2010-12-16T08:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_120514.json:
```json
{
    "body": "SAGENB patch, replaces all previous",
    "created_at": "2010-12-16T08:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120514",
    "user": "https://github.com/jdemeyer"
}
```

SAGENB patch, replaces all previous



---

archive/issue_comments_120515.json:
```json
{
    "body": "<a id='comment:57'></a>\nLeif: my patch is the same as yours, expect that it's a `hg` patch and that it doesn't change the version number.",
    "created_at": "2010-12-16T08:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120515",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:57'></a>
Leif: my patch is the same as yours, expect that it's a `hg` patch and that it doesn't change the version number.



---

archive/issue_events_030909.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30909"
}
```



---

archive/issue_events_030910.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30910"
}
```



---

archive/issue_comments_120516.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [jdemeyer](#comment%3A56):\n> Replying to leif:\n> > Just curious: *Which* 'sage' is supposed to be called here? \n> > Should we check if SAGE_LOCAL or SAGE_ROOT is defined? \n> > ... and perhaps call $SAGE_ROOT/sage or $SAGE_LOCAL/bin/...?\n  \n> \n> I think it's not important which `sage` is called.  It just needs `sage -pkg`, `sage -hg` and so on to do the Right Thing.\n\n\n;-) Well, since SageNB moved from a more or less typical spkg to something more like the Sage library, I expect more people - potentially less familiar with the SageNB update process - to work on it.\n\nSo it's now IMHO more likely developers will have a broken (or outdated) Sage in their default path (i.e., outside a Sage subshell), in which case \"arbitrary\" things could happen.\n\nIf `sage-env` was sourced, i.e. some variables like `SAGE_LOCAL` or `SAGE_ROOT` are defined*, we can perhaps be more sure `sage` is the \"proper\" one, i.e. more recent.\n\n\n---\n* I prefer having `SAGE_ENV_SOURCED` anyway, to also avoid to (effectively) source it more than once. See #10469.",
    "created_at": "2010-12-16T12:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120516",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:59'></a>
Replying to [jdemeyer](#comment%3A56):
> Replying to leif:
> > Just curious: *Which* 'sage' is supposed to be called here? 
> > Should we check if SAGE_LOCAL or SAGE_ROOT is defined? 
> > ... and perhaps call $SAGE_ROOT/sage or $SAGE_LOCAL/bin/...?
  
> 
> I think it's not important which `sage` is called.  It just needs `sage -pkg`, `sage -hg` and so on to do the Right Thing.


;-) Well, since SageNB moved from a more or less typical spkg to something more like the Sage library, I expect more people - potentially less familiar with the SageNB update process - to work on it.

So it's now IMHO more likely developers will have a broken (or outdated) Sage in their default path (i.e., outside a Sage subshell), in which case "arbitrary" things could happen.

If `sage-env` was sourced, i.e. some variables like `SAGE_LOCAL` or `SAGE_ROOT` are defined*, we can perhaps be more sure `sage` is the "proper" one, i.e. more recent.


---
* I prefer having `SAGE_ENV_SOURCED` anyway, to also avoid to (effectively) source it more than once. See #10469.



---

archive/issue_comments_120517.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [jdemeyer](#comment%3A57):\n> Leif: my patch is the same as yours, expect that it's a `hg` patch and that it doesn't change the version number.\n\n\nMy Mercurial patch(es) contain a lot of commit messages with notes; the diff was not intended to get merged.\n\nReplying to [jdemeyer](#comment%3A55):\n> Note that (as release manager) I don't care about the spkg, only about the diffs.\n\n\nAt the moment the whole purpose of the spkg is to aid debugging the problems mentioned on sage-devel; nobody opened a ticket I asked for, or replied on that thread yet.\n\nIn case the spkg helps, I suggest opening a new ticket with a description of the newly encountered problems, then \"clean\" Mercurial patches, and with just a back-reference to this ticket since the two patches from here will (most probably) be also included there.\n\n[Error] messages given by my current spkg may lead to further work. I can't do that until I get some feedback and know what's really going wrong.\n\nTesting upgrading *with the current buildbot / scripts* seems less useful; cf. sage-release.",
    "created_at": "2010-12-16T13:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120517",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:60'></a>
Replying to [jdemeyer](#comment%3A57):
> Leif: my patch is the same as yours, expect that it's a `hg` patch and that it doesn't change the version number.


My Mercurial patch(es) contain a lot of commit messages with notes; the diff was not intended to get merged.

Replying to [jdemeyer](#comment%3A55):
> Note that (as release manager) I don't care about the spkg, only about the diffs.


At the moment the whole purpose of the spkg is to aid debugging the problems mentioned on sage-devel; nobody opened a ticket I asked for, or replied on that thread yet.

In case the spkg helps, I suggest opening a new ticket with a description of the newly encountered problems, then "clean" Mercurial patches, and with just a back-reference to this ticket since the two patches from here will (most probably) be also included there.

[Error] messages given by my current spkg may lead to further work. I can't do that until I get some feedback and know what's really going wrong.

Testing upgrading *with the current buildbot / scripts* seems less useful; cf. sage-release.



---

archive/issue_comments_120518.json:
```json
{
    "body": "**Changing status** from needs_work to needs_info.",
    "created_at": "2010-12-16T13:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120518",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from needs_work to needs_info.



---

archive/issue_comments_120519.json:
```json
{
    "body": "<a id='comment:62'></a>\nReplying to [leif](#comment%3A60):\n> Replying to [jdemeyer](#comment%3A57):\n> > Leif: my patch is the same as yours, expect that it's a `hg` patch and that it doesn't change the version number.\n\n> \n> My Mercurial patch(es) contain a lot of commit messages with notes; the diff was not intended to get merged.\n\n\nI know :-)\n\nI just prefer qpushing a `hg` patch to applying a plain patch.",
    "created_at": "2010-12-16T13:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120519",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:62'></a>
Replying to [leif](#comment%3A60):
> Replying to [jdemeyer](#comment%3A57):
> > Leif: my patch is the same as yours, expect that it's a `hg` patch and that it doesn't change the version number.

> 
> My Mercurial patch(es) contain a lot of commit messages with notes; the diff was not intended to get merged.


I know :-)

I just prefer qpushing a `hg` patch to applying a plain patch.



---

archive/issue_comments_120520.json:
```json
{
    "body": "<a id='comment:63'></a>\nLeif, as far as I can tell, your patch fixes the issue.  Could it be?",
    "created_at": "2010-12-17T14:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120520",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:63'></a>
Leif, as far as I can tell, your patch fixes the issue.  Could it be?



---

archive/issue_comments_120521.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [jdemeyer](#comment%3A63):\n> Leif, as far as I can tell, your patch fixes the issue.  Could it be?\n\n\nWell, besides other things it removes the `ln -snf` which would not work as expected on Solaris, but you said you also failed to (re)install SageNB on `sage.math` previously...",
    "created_at": "2010-12-17T16:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120521",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:64'></a>
Replying to [jdemeyer](#comment%3A63):
> Leif, as far as I can tell, your patch fixes the issue.  Could it be?


Well, besides other things it removes the `ln -snf` which would not work as expected on Solaris, but you said you also failed to (re)install SageNB on `sage.math` previously...



---

archive/issue_comments_120522.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [leif](#comment%3A64):\n> Replying to [jdemeyer](#comment%3A63):\n> > Leif, as far as I can tell, your patch fixes the issue.  Could it be?\n\n> \n> Well, besides other things it removes the `ln -snf` which would not work as expected on Solaris, but you said you also failed to (re)install SageNB on `sage.math` previously...\n\n\nTrue, but I can't reproduce this problem anymore with [sage 4.6.1.rc0](http://sage.math.washington.edu/home/release/sage-4.6.1.rc0/) (not officially released).",
    "created_at": "2010-12-19T09:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120522",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:65'></a>
Replying to [leif](#comment%3A64):
> Replying to [jdemeyer](#comment%3A63):
> > Leif, as far as I can tell, your patch fixes the issue.  Could it be?

> 
> Well, besides other things it removes the `ln -snf` which would not work as expected on Solaris, but you said you also failed to (re)install SageNB on `sage.math` previously...


True, but I can't reproduce this problem anymore with [sage 4.6.1.rc0](http://sage.math.washington.edu/home/release/sage-4.6.1.rc0/) (not officially released).



---

archive/issue_comments_120523.json:
```json
{
    "body": "<a id='comment:66'></a>\nI have (finally) created ticket #10494 for the upgrade issue.",
    "created_at": "2010-12-19T09:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120523",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:66'></a>
I have (finally) created ticket #10494 for the upgrade issue.



---

archive/issue_events_030911.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30911"
}
```



---

archive/issue_comments_120524.json:
```json
{
    "body": "<a id='comment:67'></a>\nPatch copied to #10494.",
    "created_at": "2010-12-19T13:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120524",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:67'></a>
Patch copied to #10494.



---

archive/issue_events_030912.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30912"
}
```



---

archive/issue_events_030913.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30913"
}
```



---

archive/issue_events_030914.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30914"
}
```



---

archive/issue_events_030915.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30915"
}
```



---

archive/issue_events_030916.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30916"
}
```



---

archive/issue_events_030917.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30917"
}
```



---

archive/issue_events_030918.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30918"
}
```



---

archive/issue_events_030919.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30919"
}
```



---

archive/issue_comments_120525.json:
```json
{
    "body": "<a id='comment:72'></a>\nIs this still an issue?",
    "created_at": "2014-11-10T18:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120525",
    "user": "https://github.com/a-andre"
}
```

<a id='comment:72'></a>
Is this still an issue?



---

archive/issue_comments_120526.json:
```json
{
    "body": "**Changing status** from needs_info to positive_review.",
    "created_at": "2015-06-17T15:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120526",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_info to positive_review.



---

archive/issue_comments_120527.json:
```json
{
    "body": "**Changing author** from \"Leif Leonhardy\" to \"\".",
    "created_at": "2015-06-17T15:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120527",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Leif Leonhardy" to "".



---

archive/issue_comments_120528.json:
```json
{
    "body": "**Reviewer:** Leif Leonhardy",
    "created_at": "2015-06-17T15:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10176#issuecomment-120528",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Leif Leonhardy



---

archive/issue_events_030920.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-17T15:43:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30920"
}
```



---

archive/issue_events_030921.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-17T15:43:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30921"
}
```



---

archive/issue_events_030922.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-19T08:38:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10176",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10176#event-30922"
}
```
