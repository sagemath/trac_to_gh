# Issue 10746: Refactor matrix kernel routines

archive/issues_010683.json:
```json
{
    "body": "This patch reorganizes the matrix kernel code with as little change in behavior as possible.\n\nOverview:\n\nRaw computations and results are now separated from subsequent conversions, format choices and conveniences.\n\nEach subclass has a new (or modified) private `_right_kernel_matrix()` method, and the top-level code has several new private helper functions that have names starting with `_right_kernel_matrix`.  These take no input options, and return a string identifying the nature of their results, and a matrix whose rows are a basis for the right kernel.  These methods are meant to impose as little overhead as possible on top of the necessary computations.\n\nThe new `right_kernel_matrix` method manages which algorithms are used and if the basis is converted, such as being echelonized.  This introduces the \"pivot\" format which is a natural way to express basis vectors for a kernel obtained from the echelon form of a matrix.  Several algorithms currently in use return results in this format, or something very close.  This is the original motivation for this work.\n\nKernels, right or left, then build vector spaces with the rows of the right kernel matrix.\n\n\nImprovements:\n\n* Caching of kernels and immutability of the matrix happens in exactly two places, once for left and once for right, ensuring consistency.\n\n* Trivial cases (zero dimension, or full dimension) are handled in one place, again ensuring consistency.\n\n* Adding new algorithms, or specialized behavior for new subclasses, should be easier.\n\n* The logic of how various cases are handled should be more obvious.\n\n* Several bugs have been corrected due to these changes.\n\n* The `right_kernel_matrix()` method allows great flexibility for those who want easy access to a \"raw\" kernel, either unadorned, or massaged into one of several formats.\n\n* Warnings via the `verbose()` system have been added to make it easy to verify the flow of the computations, and these are doctested.\n\n\nChanges in behavior:\n\n* For a matrix whose kernel is an entire vector space (ie the ambient vector space), the kernels are returned as such.  Previously, they were often built as submodules that were just as big as the whole space.  So this is the reason for many of the docstring changes.\n\n* `_right_kernel_matrix` for integer matrices was used just once outside of the matrix code.  It now behaves differently, but can be replaced by the public `right_kernel_matrix()` which behaves almost identically.  The exception is that a conversion to an LLL basis is accomplished with a different keyword.\n\n* Documentation infers that keywords can be passed to the echelon form code.  This was not working properly since extra keywords, or keywords with the same name (eg `algorithm`), followed logic that was not as described in the documentation.  This should be easy to add properly on a subsequent ticket as this new code was written with this in mind.  See comments in the source.\n\n* Actual code for the computations is largely unmodified from before.  The very few changes needed outside of the `sage/matrix` directory is a reflection of this.  These changes are all contained in the \"external\" patch.\n\n**Apply:**\n1. [attachment:trac_10746-matrix-kernel-refactor-v4.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v4.patch)\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @jasongrout spancratz stumpc5\n\n**Author:** Rob Beezer\n\n**Reviewer:** Christian Stump\n\n**Merged:** sage-4.7.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/10746\n\n",
    "closed_at": "2011-05-30T14:51:57Z",
    "created_at": "2011-02-05T21:12:44Z",
    "labels": [
        "component: linear algebra",
        "critical",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.1",
    "title": "Refactor matrix kernel routines",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/10746",
    "user": "https://github.com/rbeezer"
}
```
This patch reorganizes the matrix kernel code with as little change in behavior as possible.

Overview:

Raw computations and results are now separated from subsequent conversions, format choices and conveniences.

Each subclass has a new (or modified) private `_right_kernel_matrix()` method, and the top-level code has several new private helper functions that have names starting with `_right_kernel_matrix`.  These take no input options, and return a string identifying the nature of their results, and a matrix whose rows are a basis for the right kernel.  These methods are meant to impose as little overhead as possible on top of the necessary computations.

The new `right_kernel_matrix` method manages which algorithms are used and if the basis is converted, such as being echelonized.  This introduces the "pivot" format which is a natural way to express basis vectors for a kernel obtained from the echelon form of a matrix.  Several algorithms currently in use return results in this format, or something very close.  This is the original motivation for this work.

Kernels, right or left, then build vector spaces with the rows of the right kernel matrix.


Improvements:

* Caching of kernels and immutability of the matrix happens in exactly two places, once for left and once for right, ensuring consistency.

* Trivial cases (zero dimension, or full dimension) are handled in one place, again ensuring consistency.

* Adding new algorithms, or specialized behavior for new subclasses, should be easier.

* The logic of how various cases are handled should be more obvious.

* Several bugs have been corrected due to these changes.

* The `right_kernel_matrix()` method allows great flexibility for those who want easy access to a "raw" kernel, either unadorned, or massaged into one of several formats.

* Warnings via the `verbose()` system have been added to make it easy to verify the flow of the computations, and these are doctested.


Changes in behavior:

* For a matrix whose kernel is an entire vector space (ie the ambient vector space), the kernels are returned as such.  Previously, they were often built as submodules that were just as big as the whole space.  So this is the reason for many of the docstring changes.

* `_right_kernel_matrix` for integer matrices was used just once outside of the matrix code.  It now behaves differently, but can be replaced by the public `right_kernel_matrix()` which behaves almost identically.  The exception is that a conversion to an LLL basis is accomplished with a different keyword.

* Documentation infers that keywords can be passed to the echelon form code.  This was not working properly since extra keywords, or keywords with the same name (eg `algorithm`), followed logic that was not as described in the documentation.  This should be easy to add properly on a subsequent ticket as this new code was written with this in mind.  See comments in the source.

* Actual code for the computations is largely unmodified from before.  The very few changes needed outside of the `sage/matrix` directory is a reflection of this.  These changes are all contained in the "external" patch.

**Apply:**
1. [attachment:trac_10746-matrix-kernel-refactor-v4.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v4.patch)

**Assignee:** @jasongrout, @williamstein

**CC:**  @jasongrout spancratz stumpc5

**Author:** Rob Beezer

**Reviewer:** Christian Stump

**Merged:** sage-4.7.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/10746





---

archive/attachments_014579.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10746-matrix-kernel-refactor.patch",
    "asset_url": "tarball://root/attachments/ticket10746/trac_10746-matrix-kernel-refactor.patch",
    "created_at": "2011-02-05T21:27:46Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_105353.json:
```json
{
    "body": "**Attachment:** [trac_10746-matrix-kernel-refactor.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor.patch)\n\nChanges within sage/matrix",
    "created_at": "2011-02-05T21:27:46Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105353",
    "user": "https://github.com/rbeezer"
}
```

**Attachment:** [trac_10746-matrix-kernel-refactor.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor.patch)

Changes within sage/matrix



---

archive/issue_comments_105354.json:
```json
{
    "body": "Changes outside sage/matrix",
    "created_at": "2011-02-05T21:28:28Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105354",
    "user": "https://github.com/rbeezer"
}
```

Changes outside sage/matrix



---

archive/issue_comments_105355.json:
```json
{
    "body": "**Author:** Rob Beezer",
    "created_at": "2011-02-05T22:04:10Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105355",
    "user": "https://github.com/rbeezer"
}
```

**Author:** Rob Beezer



---

archive/issue_comments_105356.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -39,3 +39,5 @@\n * Actual code for the computations is largely unmodified from before.  The very few changes needed outside of the `sage/matrix` directory is a reflection of this.  These changes are all contained in the \"external\" patch.\n \n Depends #10714\n+\n+Apply  trac_10746-matrix-kernel-refactor.patch, trac_10746-matrix-kernel-refactor-external.patch\n``````\n",
    "created_at": "2011-02-05T22:04:10Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105356",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -39,3 +39,5 @@
 * Actual code for the computations is largely unmodified from before.  The very few changes needed outside of the `sage/matrix` directory is a reflection of this.  These changes are all contained in the "external" patch.
 
 Depends #10714
+
+Apply  trac_10746-matrix-kernel-refactor.patch, trac_10746-matrix-kernel-refactor-external.patch
``````




---

archive/attachments_014580.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10746-matrix-kernel-refactor-external.patch",
    "asset_url": "tarball://root/attachments/ticket10746/trac_10746-matrix-kernel-refactor-external.patch",
    "created_at": "2011-02-05T22:04:10Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-external.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_105357.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Attachment:** [trac_10746-matrix-kernel-refactor-external.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-external.patch)\n\nA failing doc-test needs attention before this can proceed.  More details posted on sage-devel at\n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/64b227bc9067b012\n\n```\nsage -t  \"devel/sage/sage/modular/hecke/module.py\"\n**********************************************************************\nFile \"/sage/dev/devel/sage/sage/modular/hecke/module.py\", line 1560:\n    sage: [A.system_of_eigenvalues(3) for A in S.decomposition()]\nExpected:\n    [[1, 1, 0], [1, -1, -alpha - 1]]\nGot:\n    [[1, 1, 0], [1, -1, -1/2*alpha - 1/2]]\n**********************************************************************\n```",
    "created_at": "2011-02-05T22:04:10Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105357",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:1'></a>
**Attachment:** [trac_10746-matrix-kernel-refactor-external.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-external.patch)

A failing doc-test needs attention before this can proceed.  More details posted on sage-devel at

http://groups.google.com/group/sage-devel/browse_thread/thread/64b227bc9067b012

```
sage -t  "devel/sage/sage/modular/hecke/module.py"
**********************************************************************
File "/sage/dev/devel/sage/sage/modular/hecke/module.py", line 1560:
    sage: [A.system_of_eigenvalues(3) for A in S.decomposition()]
Expected:
    [[1, 1, 0], [1, -1, -alpha - 1]]
Got:
    [[1, 1, 0], [1, -1, -1/2*alpha - 1/2]]
**********************************************************************
```



---

archive/issue_events_083032.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-02-05T22:04:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83032"
}
```



---

archive/issue_comments_105358.json:
```json
{
    "body": "Replaces previous \"external\" patch,  still apply this second",
    "created_at": "2011-02-07T19:29:31Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105358",
    "user": "https://github.com/rbeezer"
}
```

Replaces previous "external" patch,  still apply this second



---

archive/issue_events_083033.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-02-07T19:32:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83033"
}
```



---

archive/issue_events_083034.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-02-07T19:32:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83034"
}
```



---

archive/attachments_014581.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10746-matrix-kernel-refactor-external-v2.patch",
    "asset_url": "tarball://root/attachments/ticket10746/trac_10746-matrix-kernel-refactor-external-v2.patch",
    "created_at": "2011-02-07T19:32:49Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-external-v2.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_105359.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Attachment:** [trac_10746-matrix-kernel-refactor-external-v2.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-external-v2.patch)\n\n#10714 now has a positive review (thanks, Jason) and the failing doctest has been updated based on advice in the sage-devel thread referenced above.  So this is ready to go now, built on 4.6.2.alpha3, and I'll try to keep it updated.",
    "created_at": "2011-02-07T19:32:49Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105359",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>
**Attachment:** [trac_10746-matrix-kernel-refactor-external-v2.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-external-v2.patch)

#10714 now has a positive review (thanks, Jason) and the failing doctest has been updated based on advice in the sage-devel thread referenced above.  So this is ready to go now, built on 4.6.2.alpha3, and I'll try to keep it updated.



---

archive/issue_comments_105360.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n Depends #10714\n \n-Apply  trac_10746-matrix-kernel-refactor.patch, trac_10746-matrix-kernel-refactor-external.patch\n+Apply  trac_10746-matrix-kernel-refactor.patch, trac_10746-matrix-kernel-refactor-external-v2.patch\n``````\n",
    "created_at": "2011-02-07T19:32:49Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105360",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 Depends #10714
 
-Apply  trac_10746-matrix-kernel-refactor.patch, trac_10746-matrix-kernel-refactor-external.patch
+Apply  trac_10746-matrix-kernel-refactor.patch, trac_10746-matrix-kernel-refactor-external-v2.patch
``````




---

archive/attachments_014582.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10746-matrix-kernel-refactor-v2.patch",
    "asset_url": "tarball://root/attachments/ticket10746/trac_10746-matrix-kernel-refactor-v2.patch",
    "created_at": "2011-02-08T03:54:05Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v2.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_105361.json:
```json
{
    "body": "**Attachment:** [trac_10746-matrix-kernel-refactor-v2.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v2.patch)\n\nRebased for 4.6.2.alpha4, apply first",
    "created_at": "2011-02-08T03:54:05Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105361",
    "user": "https://github.com/rbeezer"
}
```

**Attachment:** [trac_10746-matrix-kernel-refactor-v2.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v2.patch)

Rebased for 4.6.2.alpha4, apply first



---

archive/issue_comments_105362.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -40,4 +40,4 @@\n \n Depends #10714\n \n-Apply  trac_10746-matrix-kernel-refactor.patch, trac_10746-matrix-kernel-refactor-external-v2.patch\n+Apply  trac_10746-matrix-kernel-refactor-v2.patch, trac_10746-matrix-kernel-refactor-external-v2.patch\n``````\n",
    "created_at": "2011-02-08T03:55:22Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105362",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -40,4 +40,4 @@
 
 Depends #10714
 
-Apply  trac_10746-matrix-kernel-refactor.patch, trac_10746-matrix-kernel-refactor-external-v2.patch
+Apply  trac_10746-matrix-kernel-refactor-v2.patch, trac_10746-matrix-kernel-refactor-external-v2.patch
``````




---

archive/issue_comments_105363.json:
```json
{
    "body": "<a id='comment:4'></a>\nRebased the larger patch for 4.6.2.alpha4, the external patch didn't need it.  I had the immutability of the *input* versus the immutability of the *output* a bit confused in a couple places, but that is fixed now as well.  Use both v2 patches, \"external\" is second.",
    "created_at": "2011-02-08T03:55:22Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105363",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:4'></a>
Rebased the larger patch for 4.6.2.alpha4, the external patch didn't need it.  I had the immutability of the *input* versus the immutability of the *output* a bit confused in a couple places, but that is fixed now as well.  Use both v2 patches, "external" is second.



---

archive/attachments_014583.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10746-matrix-kernel-refactor-v3.patch",
    "asset_url": "tarball://root/attachments/ticket10746/trac_10746-matrix-kernel-refactor-v3.patch",
    "created_at": "2011-02-15T23:58:15Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v3.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_105364.json:
```json
{
    "body": "**Attachment:** [trac_10746-matrix-kernel-refactor-v3.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v3.patch)\n\nApply first, then follow with external patch",
    "created_at": "2011-02-15T23:58:15Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105364",
    "user": "https://github.com/rbeezer"
}
```

**Attachment:** [trac_10746-matrix-kernel-refactor-v3.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v3.patch)

Apply first, then follow with external patch



---

archive/issue_comments_105365.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,7 +13,7 @@\n \n Improvements:\n \n-* Caching of kernels and immutbility of the matrix happens in exactly two places, once for left and once for right, ensuring consistency.\n+* Caching of kernels and immutability of the matrix happens in exactly two places, once for left and once for right, ensuring consistency.\n \n * Trivial cases (zero dimension, or full dimension) are handled in one place, again ensuring consistency.\n \n@@ -40,4 +40,4 @@\n \n Depends #10714\n \n-Apply  trac_10746-matrix-kernel-refactor-v2.patch, trac_10746-matrix-kernel-refactor-external-v2.patch\n+Apply  trac_10746-matrix-kernel-refactor-v3.patch, trac_10746-matrix-kernel-refactor-external-v2.patch\n``````\n",
    "created_at": "2011-02-16T00:05:04Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105365",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,7 +13,7 @@
 
 Improvements:
 
-* Caching of kernels and immutbility of the matrix happens in exactly two places, once for left and once for right, ensuring consistency.
+* Caching of kernels and immutability of the matrix happens in exactly two places, once for left and once for right, ensuring consistency.
 
 * Trivial cases (zero dimension, or full dimension) are handled in one place, again ensuring consistency.
 
@@ -40,4 +40,4 @@
 
 Depends #10714
 
-Apply  trac_10746-matrix-kernel-refactor-v2.patch, trac_10746-matrix-kernel-refactor-external-v2.patch
+Apply  trac_10746-matrix-kernel-refactor-v3.patch, trac_10746-matrix-kernel-refactor-external-v2.patch
``````




---

archive/issue_comments_105366.json:
```json
{
    "body": "<a id='comment:5'></a>\nSome editing in response to suggetions (via email) by Sebastian Pancratz creates the \"v3\" patch for the main changes to the `sage/matrix` code.  Passes long tests.\n\n\n* Remove unreachable code containing exception for unhandled right kernel basis format\n\n* Clarified documentation about full-rank kernels being buildable for any ring with a one.\n\n* Docstring text, code comments wrapped at column 79\n\n* Docstring text pared down wherever possible\n\n* Left kernel documentation is reduced, relying on the right kernel documentation - but still tests `kernel` and `left_kernel` as aliases, an echelon basis versus a user basis, corner (trivial) cases and caching (which differs substantially for left versus right).",
    "created_at": "2011-02-16T00:05:04Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105366",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:5'></a>
Some editing in response to suggetions (via email) by Sebastian Pancratz creates the "v3" patch for the main changes to the `sage/matrix` code.  Passes long tests.


* Remove unreachable code containing exception for unhandled right kernel basis format

* Clarified documentation about full-rank kernels being buildable for any ring with a one.

* Docstring text, code comments wrapped at column 79

* Docstring text pared down wherever possible

* Left kernel documentation is reduced, relying on the right kernel documentation - but still tests `kernel` and `left_kernel` as aliases, an echelon basis versus a user basis, corner (trivial) cases and caching (which differs substantially for left versus right).



---

archive/issue_comments_105367.json:
```json
{
    "body": "<a id='comment:6'></a>\nLatest patches apply, build and test (sage/matrix) fine on 4.7.alpha1.",
    "created_at": "2011-03-20T05:50:52Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105367",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:6'></a>
Latest patches apply, build and test (sage/matrix) fine on 4.7.alpha1.



---

archive/issue_comments_105368.json:
```json
{
    "body": "<a id='comment:7'></a>\nI am willing to work through this, and at first glance the changes look good.\n\nThere is one major issue: A kernel IS a subspace. Always. Even if it can be canonically identified with the whole space.\n\nI wouldn't let this pass for a minor release like 4.7.1. Rather, since the behavior changes, we should wait for 4.8 or 5.0, until we merge this.",
    "created_at": "2011-03-25T04:36:03Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105368",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

<a id='comment:7'></a>
I am willing to work through this, and at first glance the changes look good.

There is one major issue: A kernel IS a subspace. Always. Even if it can be canonically identified with the whole space.

I wouldn't let this pass for a minor release like 4.7.1. Rather, since the behavior changes, we should wait for 4.8 or 5.0, until we merge this.



---

archive/issue_events_083035.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mraum",
    "created_at": "2011-03-25T04:36:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83035"
}
```



---

archive/issue_events_083036.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mraum",
    "created_at": "2011-03-25T04:36:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83036"
}
```



---

archive/issue_comments_105369.json:
```json
{
    "body": "Apply only this",
    "created_at": "2011-04-27T06:26:33Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105369",
    "user": "https://github.com/rbeezer"
}
```

Apply only this



---

archive/issue_comments_105370.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -38,6 +38,5 @@\n \n * Actual code for the computations is largely unmodified from before.  The very few changes needed outside of the `sage/matrix` directory is a reflection of this.  These changes are all contained in the \"external\" patch.\n \n-Depends #10714\n-\n-Apply  trac_10746-matrix-kernel-refactor-v3.patch, trac_10746-matrix-kernel-refactor-external-v2.patch\n+**Apply:**\n+1. [attachment:trac_10746-matrix-kernel-refactor-v4.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v4.patch)\n``````\n",
    "created_at": "2011-04-27T06:31:12Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105370",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -38,6 +38,5 @@
 
 * Actual code for the computations is largely unmodified from before.  The very few changes needed outside of the `sage/matrix` directory is a reflection of this.  These changes are all contained in the "external" patch.
 
-Depends #10714
-
-Apply  trac_10746-matrix-kernel-refactor-v3.patch, trac_10746-matrix-kernel-refactor-external-v2.patch
+**Apply:**
+1. [attachment:trac_10746-matrix-kernel-refactor-v4.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v4.patch)
``````




---

archive/attachments_014584.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10746-matrix-kernel-refactor-v4.patch",
    "asset_url": "tarball://root/attachments/ticket10746/trac_10746-matrix-kernel-refactor-v4.patch",
    "created_at": "2011-04-27T06:31:12Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v4.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_105371.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Attachment:** [trac_10746-matrix-kernel-refactor-v4.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v4.patch)\n\nMartin has suggested that even if a kernel is equal to the ambient space, it should be built and reported as a subspace of the ambient space.  I have made that change (in the right_kernel() routine) by removing the logic that recognized when the right kernel matrix is an identity matrix.\n\nThis had the pleasant side-effect that fewer changes are needed elsewhere.  So now there are exactly two changes outside the matrix code - a replacement of the private `_right_kernel_matrix()` by the public `right_kernel_matrix()` in the quaternion algebra code, and a documentation change.\n\nSo there is no longer a separate patch containing changes external to the sage/matrix code.  *Everything* is now in the v4 patch.  This passes long tests on 4.7.rc0.\n\nApply: trac_10746-matrix-kernel-refactor-v4.patch",
    "created_at": "2011-04-27T06:31:12Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105371",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:8'></a>
**Attachment:** [trac_10746-matrix-kernel-refactor-v4.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-matrix-kernel-refactor-v4.patch)

Martin has suggested that even if a kernel is equal to the ambient space, it should be built and reported as a subspace of the ambient space.  I have made that change (in the right_kernel() routine) by removing the logic that recognized when the right kernel matrix is an identity matrix.

This had the pleasant side-effect that fewer changes are needed elsewhere.  So now there are exactly two changes outside the matrix code - a replacement of the private `_right_kernel_matrix()` by the public `right_kernel_matrix()` in the quaternion algebra code, and a documentation change.

So there is no longer a separate patch containing changes external to the sage/matrix code.  *Everything* is now in the v4 patch.  This passes long tests on 4.7.rc0.

Apply: trac_10746-matrix-kernel-refactor-v4.patch



---

archive/issue_events_083037.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-27T06:31:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83037"
}
```



---

archive/issue_events_083038.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-27T06:31:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83038"
}
```



---

archive/issue_comments_105372.json:
```json
{
    "body": "**Reviewer:** Christian Stump",
    "created_at": "2011-05-05T19:09:53Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105372",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

**Reviewer:** Christian Stump



---

archive/issue_comments_105373.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe patch looks very well organized and extensively documented.\n\nAs the latest version does not contain many changes outside of the matrix code, I think it is okay to put this patch into 4.7, and not to wait for 4.8 or even version 5.\n\nI leave it as needs review, as maybe someone working more with linear algebra / matrices should have a look as well.\n\nOne doctest failed in 4.6.2, but I guess this doesn't happen anymore in 4.7.rc0, see the attached patch.\n\nChristian",
    "created_at": "2011-05-05T19:09:53Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105373",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:10'></a>
The patch looks very well organized and extensively documented.

As the latest version does not contain many changes outside of the matrix code, I think it is okay to put this patch into 4.7, and not to wait for 4.8 or even version 5.

I leave it as needs review, as maybe someone working more with linear algebra / matrices should have a look as well.

One doctest failed in 4.6.2, but I guess this doesn't happen anymore in 4.7.rc0, see the attached patch.

Christian



---

archive/attachments_014585.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10746-review-cs.patch",
    "asset_url": "tarball://root/attachments/ticket10746/trac_10746-review-cs.patch",
    "created_at": "2011-05-05T19:26:22Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket10746/trac_10746-review-cs.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_105374.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Attachment:** [trac_10746-review-cs.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-review-cs.patch)\n\nReplying to [stumpc5](#comment%3A10):\n> One doctest failed in 4.6.2, but I guess this doesn't happen anymore in 4.7.rc0, see the attached patch.\n\n\nThanks, Christian.  Indeed, the pivots have switched to tuples instead of lists at #10752, so that failure would be expected on 4.6.2.  So the [attachment:trac_10746-review-cs.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-review-cs.patch) patch should *not* be applied.\n\nThanks again.",
    "created_at": "2011-05-05T19:26:22Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105374",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:11'></a>
**Attachment:** [trac_10746-review-cs.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-review-cs.patch)

Replying to [stumpc5](#comment%3A10):
> One doctest failed in 4.6.2, but I guess this doesn't happen anymore in 4.7.rc0, see the attached patch.


Thanks, Christian.  Indeed, the pivots have switched to tuples instead of lists at #10752, so that failure would be expected on 4.6.2.  So the [attachment:trac_10746-review-cs.patch](https://github.com/sagemath/sage/files/ticket10746/trac_10746-review-cs.patch) patch should *not* be applied.

Thanks again.



---

archive/issue_comments_105375.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe patch definitely deserve a positive review, even at a second glance -- the organization of the matrix kernel code is much cleaner now, and the documentation and the examples are very helpful!\n\nBest, Christian",
    "created_at": "2011-05-24T10:35:33Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105375",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:12'></a>
The patch definitely deserve a positive review, even at a second glance -- the organization of the matrix kernel code is much cleaner now, and the documentation and the examples are very helpful!

Best, Christian



---

archive/issue_events_083039.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/stumpc5",
    "created_at": "2011-05-24T10:35:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83039"
}
```



---

archive/issue_events_083040.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/stumpc5",
    "created_at": "2011-05-24T10:35:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83040"
}
```



---

archive/issue_comments_105376.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [stumpc5](#comment%3A12):\n\nThanks, Christian.  Good luck with the upcoming new arrival!\n\nRob",
    "created_at": "2011-05-24T17:18:31Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105376",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:13'></a>
Replying to [stumpc5](#comment%3A12):

Thanks, Christian.  Good luck with the upcoming new arrival!

Rob



---

archive/issue_events_083041.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-05-24T17:20:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "milestone": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83041"
}
```



---

archive/issue_events_083042.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-05-24T17:20:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83042"
}
```



---

archive/issue_comments_105377.json:
```json
{
    "body": "<a id='comment:14'></a>\nI have built this patch against 4.7.rc3, and tested it against a subset of the Sage library with no problems, so it should be ready to go.",
    "created_at": "2011-05-24T17:20:06Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105377",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:14'></a>
I have built this patch against 4.7.rc3, and tested it against a subset of the Sage library with no problems, so it should be ready to go.



---

archive/issue_events_083043.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-25T12:55:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83043"
}
```



---

archive/issue_events_083044.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-30T14:51:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83044"
}
```



---

archive/issue_events_083045.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-30T14:51:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10746#event-83045"
}
```



---

archive/issue_comments_105378.json:
```json
{
    "body": "**Merged:** sage-4.7.1.alpha2",
    "created_at": "2011-05-30T14:51:57Z",
    "issue": "https://github.com/sagemath/sage/issues/10746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10746#issuecomment-105378",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.1.alpha2
