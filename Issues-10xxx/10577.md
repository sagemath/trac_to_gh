# Issue 10577: Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified

archive/issues_010524.json:
```json
{
    "body": "Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified, but works for vectorspaces over GF(p) if either p>2 or the inner_product_matrix is not specified.  Apparently there is some issue with using mutable matrices.\n\n\n```\nsage: V3 = VectorSpace(GF(3), 2, inner_product_matrix =\nDiagonalMatrix(GF(3), [1,1]))\nsage: deepcopy(V3)\nAmbient quadratic space of dimension 2 over Finite Field of size 3\nInner product matrix:\n[1 0]\n[0 1]\n\nsage: V2 = VectorSpace(GF(2), 2)\nsage: deepcopy(V2)\nVector space of dimension 2 over Finite Field of size 2\n\nsage: M2 = DiagonalMatrix(GF(2), [1,1])\nsage: deepcopy(M2)\n[1 0]\n[0 1]\n\nsage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =\nDiagonalMatrix(GF(2), [1,1]))\nsage:\nsage:\nsage: deepcopy(V2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in\ndeepcopy(x, memo, _nil)\n    187                             raise Error(\n    188                                 \"un(deep)copyable object of type %s\"\n% cls)\n--> 189                 y = _reconstruct(x, rv, 1, memo)\n    190\n    191     memo[d] = y\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in\n_reconstruct(x, info, deep, memo)\n    321     if deep:\n    322         args = deepcopy(args, memo)\n--> 323     y = callable(*args)\n    324     memo[id(x)] = y\n    325     if listiter is not None:\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so\nin sage.structure.factory.generic_factory_unpickle\n(sage/structure/factory.c:2277)()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so\nin sage.structure.factory.UniqueFactory.get_object\n(sage/structure/factory.c:1633)()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so\nin sage.structure.factory.UniqueFactory.get_object\n(sage/structure/factory.c:1049)()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so\nin sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.__hash__\n(sage/matrix/matrix_mod2_dense.c:3222)()\n\nTypeError: mutable matrices are unhashable\n```\n\nAssignee: jason, was\n\nCC:  jonhanke@gmail.com\n\nKeywords: GF(2), vectorspace, characteristic 2\n\nBranch/Commit: [b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92](https://github.com/sagemath/sagetrac-mirror/commit/b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92)\n\nReviewer: Simon Brandhorst\n\nAuthor: Jonathan Hanke, Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/10577\n\n",
    "closed_at": "2018-05-08T17:27:43Z",
    "created_at": "2011-01-09T22:14:42Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10577",
    "user": "https://github.com/jonhanke"
}
```
Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified, but works for vectorspaces over GF(p) if either p>2 or the inner_product_matrix is not specified.  Apparently there is some issue with using mutable matrices.


```
sage: V3 = VectorSpace(GF(3), 2, inner_product_matrix =
DiagonalMatrix(GF(3), [1,1]))
sage: deepcopy(V3)
Ambient quadratic space of dimension 2 over Finite Field of size 3
Inner product matrix:
[1 0]
[0 1]

sage: V2 = VectorSpace(GF(2), 2)
sage: deepcopy(V2)
Vector space of dimension 2 over Finite Field of size 2

sage: M2 = DiagonalMatrix(GF(2), [1,1])
sage: deepcopy(M2)
[1 0]
[0 1]

sage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =
DiagonalMatrix(GF(2), [1,1]))
sage:
sage:
sage: deepcopy(V2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in
deepcopy(x, memo, _nil)
    187                             raise Error(
    188                                 "un(deep)copyable object of type %s"
% cls)
--> 189                 y = _reconstruct(x, rv, 1, memo)
    190
    191     memo[d] = y

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in
_reconstruct(x, info, deep, memo)
    321     if deep:
    322         args = deepcopy(args, memo)
--> 323     y = callable(*args)
    324     memo[id(x)] = y
    325     if listiter is not None:

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.generic_factory_unpickle
(sage/structure/factory.c:2277)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.UniqueFactory.get_object
(sage/structure/factory.c:1633)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.UniqueFactory.get_object
(sage/structure/factory.c:1049)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so
in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.__hash__
(sage/matrix/matrix_mod2_dense.c:3222)()

TypeError: mutable matrices are unhashable
```

Assignee: jason, was

CC:  jonhanke@gmail.com

Keywords: GF(2), vectorspace, characteristic 2

Branch/Commit: [b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92](https://github.com/sagemath/sagetrac-mirror/commit/b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92)

Reviewer: Simon Brandhorst

Author: Jonathan Hanke, Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/10577





---

archive/issue_comments_138649.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified, but works for vectorspaces over GF(p) if either p>2 or the inner_product_matrix is not specified.  Apparently there is some issue with using mutable matrices.\n \n-==============================================\n \n+```\n sage: V3 = VectorSpace(GF(3), 2, inner_product_matrix =\n DiagonalMatrix(GF(3), [1,1]))\n sage: deepcopy(V3)\n@@ -24,8 +24,7 @@\n sage:\n sage:\n sage: deepcopy(V2)\n-\n----\n+---------------------------------------------------------------------------\n TypeError                                 Traceback (most recent call last)\n \n /Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()\n@@ -64,4 +63,4 @@\n (sage/matrix/matrix_mod2_dense.c:3222)()\n \n TypeError: mutable matrices are unhashable\n-\n+```\n``````\n",
    "created_at": "2011-01-09T22:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138649",
    "user": "https://github.com/jonhanke"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified, but works for vectorspaces over GF(p) if either p>2 or the inner_product_matrix is not specified.  Apparently there is some issue with using mutable matrices.
 
-==============================================
 
+```
 sage: V3 = VectorSpace(GF(3), 2, inner_product_matrix =
 DiagonalMatrix(GF(3), [1,1]))
 sage: deepcopy(V3)
@@ -24,8 +24,7 @@
 sage:
 sage:
 sage: deepcopy(V2)
-
----
+---------------------------------------------------------------------------
 TypeError                                 Traceback (most recent call last)
 
 /Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()
@@ -64,4 +63,4 @@
 (sage/matrix/matrix_mod2_dense.c:3222)()
 
 TypeError: mutable matrices are unhashable
-
+```
``````




---

archive/issue_events_032608.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32608"
}
```



---

archive/issue_events_032609.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32609"
}
```



---

archive/issue_events_032610.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32610"
}
```



---

archive/issue_events_032611.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32611"
}
```



---

archive/issue_events_032612.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32612"
}
```



---

archive/issue_events_032613.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32613"
}
```



---

archive/issue_events_032614.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32614"
}
```



---

archive/issue_comments_138650.json:
```json
{
    "body": "<a id='comment:6'></a>\nWorks with 8.2.beta8\n\n```\nsage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =\n....: matrix.diagonal(GF(2), [1,1]))\nsage: deepcopy(V2)\nAmbient quadratic space of dimension 2 over Finite Field of size 2\nInner product matrix:\n[1 0]\n[0 1]\n```",
    "created_at": "2018-03-20T12:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138650",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:6'></a>
Works with 8.2.beta8

```
sage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =
....: matrix.diagonal(GF(2), [1,1]))
sage: deepcopy(V2)
Ambient quadratic space of dimension 2 over Finite Field of size 2
Inner product matrix:
[1 0]
[0 1]
```



---

archive/issue_comments_138651.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-20T12:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138651",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_events_032615.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2018-03-20T12:45:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32615"
}
```



---

archive/issue_events_032616.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2018-03-20T12:45:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32616"
}
```



---

archive/issue_comments_138652.json:
```json
{
    "body": "<a id='comment:7'></a>\nadding a doctest\n\n---\nNew commits:\n|                                                                                                                                          |                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[b1f3223](https://github.com/sagemath/sagetrac-mirror/commit/b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92)|`trac 10577 adding a doctest`|",
    "created_at": "2018-04-15T12:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138652",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
adding a doctest

---
New commits:
|                                                                                                                                          |                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[b1f3223](https://github.com/sagemath/sagetrac-mirror/commit/b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92)|`trac 10577 adding a doctest`|



---

archive/issue_comments_138653.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/10577\"",
    "created_at": "2018-04-15T12:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138653",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/10577"



---

archive/issue_events_032617.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-04-15T12:12:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32617"
}
```



---

archive/issue_events_032618.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-04-15T12:12:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32618"
}
```



---

archive/issue_comments_138654.json:
```json
{
    "body": "Changing commit from \"\" to \"b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92\"",
    "created_at": "2018-04-15T12:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138654",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92"



---

archive/issue_comments_138655.json:
```json
{
    "body": "<a id='comment:8'></a>\ngreen bot, please review",
    "created_at": "2018-04-15T14:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138655",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
green bot, please review



---

archive/issue_comments_138656.json:
```json
{
    "body": "<a id='comment:9'></a>\nAdd your name as an author and you have it.",
    "created_at": "2018-04-18T14:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138656",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:9'></a>
Add your name as an author and you have it.



---

archive/issue_comments_138657.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Simon Brandhorst\"",
    "created_at": "2018-04-18T14:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138657",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing reviewer from "" to "Simon Brandhorst"



---

archive/issue_comments_138658.json:
```json
{
    "body": "Changing author from \"Jonathan Hanke\" to \"Jonathan Hanke, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2018-04-18T14:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138658",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "Jonathan Hanke" to "Jonathan Hanke, Frédéric Chapoton"



---

archive/issue_comments_138659.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-18T14:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138659",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_138660.json:
```json
{
    "body": "<a id='comment:10'></a>\nthanx",
    "created_at": "2018-04-18T14:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138660",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
thanx



---

archive/issue_comments_138661.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-08T17:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138661",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_032619.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:27:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10577#event-32619"
}
```



---

archive/issue_comments_138662.json:
```json
{
    "body": "Changing branch from \"u/chapoton/10577\" to \"b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92\"",
    "created_at": "2018-05-08T17:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10577#issuecomment-138662",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/10577" to "b1f3223f1d2f3a8dcd6b8d1dd96c9124e191cc92"
