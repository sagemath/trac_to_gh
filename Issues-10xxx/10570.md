# Issue 10570: sage leaves a lot of stackframes alive at startup

archive/issues_010517.json:
```json
{
    "assignees": [
        "https://github.com/rlmill"
    ],
    "body": "This is a really really bad thing and probably related to a lot of the memory leaks shown up recently. All the ipython frames are probably ok on the stack. But most of the other frames come from a call stack frame which is unneccesarily alive.\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.6.1.alpha3, Release Date: 2010-12-05                |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: import gc\nsage: import inspect\nsage: l1=gc.get_objects()\nsage: frames=[x for x in l1 if inspect.isframe(x)]\nsage: len(frames)\n26\nsage: for i in frames: inspect.getframeinfo(i) \n....: \nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/Shell.py', lineno=81, function='mainloop', code_context=['        self.IP.mainloop(banner)\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=1577, function='mainloop', code_context=['                self.interact(banner)\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=1813, function='interact', code_context=['                more = self.push(line)\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=2121, function='push', code_context=['        return more\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=2045, function='runsource', code_context=['            return False\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=2093, function='runcode', code_context=['        return outflag\\n'], index=0)\nTraceback(filename='<ipython console>', lineno=1, function='<module>', code_context=None, index=None)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/rings/qqbar.py', lineno=5800, function='_init_qqbar', code_context=[\"    ZZX_x = ZZ['x'].gen()\\n\"], index=0)\nTraceback(filename='coerce_actions.pyx', lineno=184, function='sage.structure.coerce_actions.detect_element_action (sage/structure/coerce_actions.c:4184)', code_context=None, index=None)\nTraceback(filename='coerce_actions.pyx', lineno=184, function='sage.structure.coerce_actions.detect_element_action (sage/structure/coerce_actions.c:4184)', code_context=None, index=None)\nTraceback(filename='coerce_actions.pyx', lineno=184, function='sage.structure.coerce_actions.detect_element_action (sage/structure/coerce_actions.c:4184)', code_context=None, index=None)\nTraceback(filename='coerce_actions.pyx', lineno=237, function='sage.structure.coerce_actions.ModuleAction.__init__ (sage/structure/coerce_actions.c:4713)', code_context=None, index=None)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/rings/qqbar.py', lineno=5253, function='_interval_fast', code_context=['        return v\\n'], index=0)\nTraceback(filename='coerce_actions.pyx', lineno=278, function='sage.structure.coerce_actions.ModuleAction.__init__ (sage/structure/coerce_actions.c:5174)', code_context=None, index=None)\nTraceback(filename='coerce_actions.pyx', lineno=278, function='sage.structure.coerce_actions.ModuleAction.__init__ (sage/structure/coerce_actions.c:5174)', code_context=None, index=None)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/rings/qqbar.py', lineno=2177, function='__init__', code_context=['        self._value = self._descr._interval_fast(64)\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/rings/qqbar.py', lineno=2854, function='__init__', code_context=['        AlgebraicNumber_base.__init__(self, QQbar, x)\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/bin/sage-ipython', lineno=52, function='<module>', code_context=[\"ipy_sage.mainloop(sys_exit=1, banner='')\\n\"], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/Shell.py', lineno=1233, function='start', code_context=['    return shell(user_ns = user_ns)\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/Shell.py', lineno=78, function='__init__', code_context=['                               debug=debug,shell_class=shell_class)\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/ipmaker.py', lineno=782, function='make_IPython', code_context=['    return IP\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/ipmaker.py', lineno=66, function='force_import', code_context=['        __import__(modname)\\n'], index=0)\nTraceback(filename='ipy_profile_sage.py', lineno=33, function='<module>', code_context=[\"    _ip.expose_magic('prun', lambda self, s: old_prun(preparse(s)))\\n\"], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/all_cmdline.py', lineno=35, function='<module>', code_context=['sage.misc.session.init()\\n'], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/all.py', lineno=313, function='<module>', code_context=[\"sage.structure.sage_object.register_unpickle_override('sage.categories.category_types', 'ModularAbelianVarieties', ModularAbelianVarieties)\\n\"], index=0)\nTraceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/combinat/species/generating_series.py', lineno=269, function='factorial_gen', code_context=['def factorial_gen():\\n'], index=0)\n```\nApply nothing\n\nCC:  @jdemeyer\n\nComponent: **memleak**\n\nReviewer: **Burcin Erocal**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10570_\n\n",
    "closed_at": "2011-05-31T17:16:20Z",
    "created_at": "2011-01-08T00:36:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/duplicate",
        "https://github.com/sagemath/sage/labels/memleak"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage leaves a lot of stackframes alive at startup",
    "type": "issue",
    "updated_at": "2011-05-31T17:16:20Z",
    "url": "https://github.com/sagemath/sage/issues/10570",
    "user": "https://github.com/koffie"
}
```
This is a really really bad thing and probably related to a lot of the memory leaks shown up recently. All the ipython frames are probably ok on the stack. But most of the other frames come from a call stack frame which is unneccesarily alive.

```
----------------------------------------------------------------------
| Sage Version 4.6.1.alpha3, Release Date: 2010-12-05                |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: import gc
sage: import inspect
sage: l1=gc.get_objects()
sage: frames=[x for x in l1 if inspect.isframe(x)]
sage: len(frames)
26
sage: for i in frames: inspect.getframeinfo(i) 
....: 
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/Shell.py', lineno=81, function='mainloop', code_context=['        self.IP.mainloop(banner)\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=1577, function='mainloop', code_context=['                self.interact(banner)\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=1813, function='interact', code_context=['                more = self.push(line)\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=2121, function='push', code_context=['        return more\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=2045, function='runsource', code_context=['            return False\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/iplib.py', lineno=2093, function='runcode', code_context=['        return outflag\n'], index=0)
Traceback(filename='<ipython console>', lineno=1, function='<module>', code_context=None, index=None)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/rings/qqbar.py', lineno=5800, function='_init_qqbar', code_context=["    ZZX_x = ZZ['x'].gen()\n"], index=0)
Traceback(filename='coerce_actions.pyx', lineno=184, function='sage.structure.coerce_actions.detect_element_action (sage/structure/coerce_actions.c:4184)', code_context=None, index=None)
Traceback(filename='coerce_actions.pyx', lineno=184, function='sage.structure.coerce_actions.detect_element_action (sage/structure/coerce_actions.c:4184)', code_context=None, index=None)
Traceback(filename='coerce_actions.pyx', lineno=184, function='sage.structure.coerce_actions.detect_element_action (sage/structure/coerce_actions.c:4184)', code_context=None, index=None)
Traceback(filename='coerce_actions.pyx', lineno=237, function='sage.structure.coerce_actions.ModuleAction.__init__ (sage/structure/coerce_actions.c:4713)', code_context=None, index=None)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/rings/qqbar.py', lineno=5253, function='_interval_fast', code_context=['        return v\n'], index=0)
Traceback(filename='coerce_actions.pyx', lineno=278, function='sage.structure.coerce_actions.ModuleAction.__init__ (sage/structure/coerce_actions.c:5174)', code_context=None, index=None)
Traceback(filename='coerce_actions.pyx', lineno=278, function='sage.structure.coerce_actions.ModuleAction.__init__ (sage/structure/coerce_actions.c:5174)', code_context=None, index=None)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/rings/qqbar.py', lineno=2177, function='__init__', code_context=['        self._value = self._descr._interval_fast(64)\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/rings/qqbar.py', lineno=2854, function='__init__', code_context=['        AlgebraicNumber_base.__init__(self, QQbar, x)\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/bin/sage-ipython', lineno=52, function='<module>', code_context=["ipy_sage.mainloop(sys_exit=1, banner='')\n"], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/Shell.py', lineno=1233, function='start', code_context=['    return shell(user_ns = user_ns)\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/Shell.py', lineno=78, function='__init__', code_context=['                               debug=debug,shell_class=shell_class)\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/ipmaker.py', lineno=782, function='make_IPython', code_context=['    return IP\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/IPython/ipmaker.py', lineno=66, function='force_import', code_context=['        __import__(modname)\n'], index=0)
Traceback(filename='ipy_profile_sage.py', lineno=33, function='<module>', code_context=["    _ip.expose_magic('prun', lambda self, s: old_prun(preparse(s)))\n"], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/all_cmdline.py', lineno=35, function='<module>', code_context=['sage.misc.session.init()\n'], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/all.py', lineno=313, function='<module>', code_context=["sage.structure.sage_object.register_unpickle_override('sage.categories.category_types', 'ModularAbelianVarieties', ModularAbelianVarieties)\n"], index=0)
Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/combinat/species/generating_series.py', lineno=269, function='factorial_gen', code_context=['def factorial_gen():\n'], index=0)
```
Apply nothing

CC:  @jdemeyer

Component: **memleak**

Reviewer: **Burcin Erocal**

_Issue created by migration from https://trac.sagemath.org/ticket/10570_





---

archive/issue_events_139180.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-01-08T00:36:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139180"
}
```



---

archive/issue_events_139181.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-01-08T00:36:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/memleak",
    "label_color": "696969",
    "label_name": "memleak",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139181"
}
```



---

archive/issue_events_139182.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-01-08T00:36:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139182"
}
```



---

archive/issue_events_139183.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-01-08T00:36:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139183"
}
```



---

archive/issue_events_139184.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2011-01-08T00:36:00Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "subject": "https://github.com/koffie",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139184"
}
```



---

archive/issue_comments_100802.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nps. The unnecessary frames are there since at least sage 4.4.4",
    "created_at": "2011-01-08T00:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100802",
    "user": "https://github.com/koffie"
}
```

<div id="comment:1" align="right">comment:1</div>

ps. The unnecessary frames are there since at least sage 4.4.4



---

archive/issue_comments_100803.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe vast majority of the stack frames are saved by the coercion model for use in its introspection mechanism. Adding the line\n\n```\nget_coercion_model().exception_stack()\n```\n\nat the end of `sage/all.py` kills all but 9 of the 26 stack frames listed above. Of the remaining 9, 8 are to do with IPython. The other one is some silly generator in the combinatorics module that is there to compute factorials; I don't know why they don't call the general-purpose factorial function.",
    "created_at": "2011-01-20T15:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100803",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:2" align="right">comment:2</div>

The vast majority of the stack frames are saved by the coercion model for use in its introspection mechanism. Adding the line

```
get_coercion_model().exception_stack()
```

at the end of `sage/all.py` kills all but 9 of the 26 stack frames listed above. Of the remaining 9, 8 are to do with IPython. The other one is some silly generator in the combinatorics module that is there to compute factorials; I don't know why they don't call the general-purpose factorial function.



---

archive/issue_comments_100804.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis shows that #10548 is actually the cause of the factorial generator.\n\n```\nsage: import gc\nsage: import inspect\nsage: frames=[x for x in gc.get_objects() if inspect.isframe(x)]\nsage: l=objgraph.find_backref_chain(frames[0],inspect.ismodule,max_depth=15,extra_ignore=[id(frames)])\nsage: l=objgraph.find_backref_chain(frames[8],inspect.ismodule,max_depth=15,extra_ignore=[id(frames)])\nsage: map(type,l)\n[<type 'module'>, <type 'dict'>, <type 'sage.structure.coerce.CoercionModel_cache_maps'>, <type 'list'>, <type 'tuple'>, <type 'traceback'>, <type 'frame'>, <type 'frame'>, <type 'frame'>, <type 'frame'>]\n```\nI'm going to add a patch to remove all the other stack frames in the way david sugested so this ticket can be closed. (since when there is a fix for 10548 it should also remove last stackframe)",
    "created_at": "2011-03-21T22:30:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100804",
    "user": "https://github.com/koffie"
}
```

<div id="comment:3" align="right">comment:3</div>

This shows that #10548 is actually the cause of the factorial generator.

```
sage: import gc
sage: import inspect
sage: frames=[x for x in gc.get_objects() if inspect.isframe(x)]
sage: l=objgraph.find_backref_chain(frames[0],inspect.ismodule,max_depth=15,extra_ignore=[id(frames)])
sage: l=objgraph.find_backref_chain(frames[8],inspect.ismodule,max_depth=15,extra_ignore=[id(frames)])
sage: map(type,l)
[<type 'module'>, <type 'dict'>, <type 'sage.structure.coerce.CoercionModel_cache_maps'>, <type 'list'>, <type 'tuple'>, <type 'traceback'>, <type 'frame'>, <type 'frame'>, <type 'frame'>, <type 'frame'>]
```
I'm going to add a patch to remove all the other stack frames in the way david sugested so this ticket can be closed. (since when there is a fix for 10548 it should also remove last stackframe)



---

archive/issue_comments_100805.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAttachment: **[trac_10570.patch.gz](https://github.com/sagemath/sage/files/ticket10570/trac_10570.patch.gz)**",
    "created_at": "2011-03-22T01:19:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100805",
    "user": "https://github.com/koffie"
}
```

<div id="comment:4" align="right">comment:4</div>

Attachment: **[trac_10570.patch.gz](https://github.com/sagemath/sage/files/ticket10570/trac_10570.patch.gz)**



---

archive/issue_events_139185.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-22T01:19:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139185"
}
```



---

archive/issue_comments_100806.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAfter applying the two-patch series at #10548, this patch tests fine whether or not the last line is commented out -- that is, the issue itself seems to be fixed by #10548 independently.\n\nI will merge this patch into your doctest patch at #10548 and upload it there.",
    "created_at": "2011-03-24T22:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100806",
    "user": "https://github.com/kini"
}
```

<div id="comment:5" align="right">comment:5</div>

After applying the two-patch series at #10548, this patch tests fine whether or not the last line is commented out -- that is, the issue itself seems to be fixed by #10548 independently.

I will merge this patch into your doctest patch at #10548 and upload it there.



---

archive/issue_comments_100807.json:
```json
{
    "body": "Author: **Maarten Derickx**",
    "created_at": "2011-03-24T22:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100807",
    "user": "https://github.com/kini"
}
```

Author: **Maarten Derickx**



---

archive/issue_events_139186.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-03-24T22:35:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139186"
}
```



---

archive/issue_events_139187.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-03-24T22:35:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139187"
}
```



---

archive/issue_comments_100808.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -46,3 +46,6 @@\n Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/all.py', lineno=313, function='<module>', code_context=[\"sage.structure.sage_object.register_unpickle_override('sage.categories.category_types', 'ModularAbelianVarieties', ModularAbelianVarieties)\\n\"], index=0)\n Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/combinat/species/generating_series.py', lineno=269, function='factorial_gen', code_context=['def factorial_gen():\\n'], index=0)\n ```\n+\n+Apply trac_10570.v2.patch\n+Depends on #10548\n``````\n",
    "created_at": "2011-03-24T22:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100808",
    "user": "https://github.com/kini"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -46,3 +46,6 @@
 Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/all.py', lineno=313, function='<module>', code_context=["sage.structure.sage_object.register_unpickle_override('sage.categories.category_types', 'ModularAbelianVarieties', ModularAbelianVarieties)\n"], index=0)
 Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/combinat/species/generating_series.py', lineno=269, function='factorial_gen', code_context=['def factorial_gen():\n'], index=0)
 ```
+
+Apply trac_10570.v2.patch
+Depends on #10548
``````




---

archive/issue_comments_100809.json:
```json
{
    "body": "Reviewer: **Keshav Kini**",
    "created_at": "2011-03-24T22:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100809",
    "user": "https://github.com/kini"
}
```

Reviewer: **Keshav Kini**



---

archive/issue_comments_100810.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThere is now only the factorial remaining, but now for a different reason then before:\n\nsage: import gc\nsage: import inspect\nsage: l1=gc.get_objects()\nsage: frames=[x for x in l1 if inspect.isframe(x)]\nsage: len(frames)\n9\nsage: l=objgraph.find_backref_chain(frames[8],inspect.ismodule,max_depth=15,extra_ignore=[id(frames)])\nsage: map(type,l)\n[<type 'module'>, <type 'dict'>, <class 'sage.combinat.species.stream.Stream_class'>, <type 'dict'>, <type 'generator'>, <type 'frame'>]",
    "created_at": "2011-03-24T22:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100810",
    "user": "https://github.com/koffie"
}
```

<div id="comment:6" align="right">comment:6</div>

There is now only the factorial remaining, but now for a different reason then before:

sage: import gc
sage: import inspect
sage: l1=gc.get_objects()
sage: frames=[x for x in l1 if inspect.isframe(x)]
sage: len(frames)
9
sage: l=objgraph.find_backref_chain(frames[8],inspect.ismodule,max_depth=15,extra_ignore=[id(frames)])
sage: map(type,l)
[<type 'module'>, <type 'dict'>, <class 'sage.combinat.species.stream.Stream_class'>, <type 'dict'>, <type 'generator'>, <type 'frame'>]



---

archive/issue_events_139188.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-24T22:44:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139188"
}
```



---

archive/issue_events_139189.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-24T22:44:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139189"
}
```



---

archive/issue_comments_100811.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n\n```\nsage: sage: import gc\nsage: sage: import inspect\nsage: sage: l1=gc.get_objects()\nsage: sage: frames=[x for x in l1 if inspect.isframe(x)]\nsage: sage: len(frames)\n9\nsage: sage: l=objgraph.find_backref_chain(frames[8],inspect.ismodule,max_depth=15,extra_ignore=[id(frames)])\nsage: sage: map(type,l)\n[<type 'module'>, <type 'dict'>, <class 'sage.combinat.species.stream.Stream_class'>, <type 'dict'>, <type 'generator'>, <type 'frame'>]\n```",
    "created_at": "2011-03-24T22:45:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100811",
    "user": "https://github.com/koffie"
}
```

<div id="comment:7" align="right">comment:7</div>


```
sage: sage: import gc
sage: sage: import inspect
sage: sage: l1=gc.get_objects()
sage: sage: frames=[x for x in l1 if inspect.isframe(x)]
sage: sage: len(frames)
9
sage: sage: l=objgraph.find_backref_chain(frames[8],inspect.ismodule,max_depth=15,extra_ignore=[id(frames)])
sage: sage: map(type,l)
[<type 'module'>, <type 'dict'>, <class 'sage.combinat.species.stream.Stream_class'>, <type 'dict'>, <type 'generator'>, <type 'frame'>]
```



---

archive/issue_events_139190.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-24T23:31:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139190"
}
```



---

archive/issue_events_139191.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-24T23:31:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139191"
}
```



---

archive/issue_events_139192.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-24T23:31:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139192"
}
```



---

archive/issue_events_139193.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-24T23:31:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139193"
}
```



---

archive/issue_events_139194.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-03-24T23:31:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139194"
}
```



---

archive/issue_comments_100812.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,4 @@\n-This is a really really bad thing and probably related to a lot of the memory leaks shown up recently.\n-All the ipython frames are probably ok on the stack. But most of the other frames come from a call stack frame which is unneccesarily alive. \n+This is a really really bad thing and probably related to a lot of the memory leaks shown up recently. All the ipython frames are probably ok on the stack. But most of the other frames come from a call stack frame which is unneccesarily alive.\n \n ```\n ----------------------------------------------------------------------\n@@ -46,6 +45,4 @@\n Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/all.py', lineno=313, function='<module>', code_context=[\"sage.structure.sage_object.register_unpickle_override('sage.categories.category_types', 'ModularAbelianVarieties', ModularAbelianVarieties)\\n\"], index=0)\n Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/combinat/species/generating_series.py', lineno=269, function='factorial_gen', code_context=['def factorial_gen():\\n'], index=0)\n ```\n-\n-Apply trac_10570.v2.patch\n-Depends on #10548\n+Apply nothing\n``````\n",
    "created_at": "2011-03-24T23:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100812",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,4 @@
-This is a really really bad thing and probably related to a lot of the memory leaks shown up recently.
-All the ipython frames are probably ok on the stack. But most of the other frames come from a call stack frame which is unneccesarily alive. 
+This is a really really bad thing and probably related to a lot of the memory leaks shown up recently. All the ipython frames are probably ok on the stack. But most of the other frames come from a call stack frame which is unneccesarily alive.
 
 ```
 ----------------------------------------------------------------------
@@ -46,6 +45,4 @@
 Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/all.py', lineno=313, function='<module>', code_context=["sage.structure.sage_object.register_unpickle_override('sage.categories.category_types', 'ModularAbelianVarieties', ModularAbelianVarieties)\n"], index=0)
 Traceback(filename='/Applications/sage-4.6.rc0/local/lib/python2.6/site-packages/sage/combinat/species/generating_series.py', lineno=269, function='factorial_gen', code_context=['def factorial_gen():\n'], index=0)
 ```
-
-Apply trac_10570.v2.patch
-Depends on #10548
+Apply nothing
``````




---

archive/issue_comments_100813.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI don't consider the remaining frame corresponding to the factorial generator a bug. It is there because appearantly someone thinks that the factorial generator should be available as a generator instead of a function in some module.",
    "created_at": "2011-03-24T23:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100813",
    "user": "https://github.com/koffie"
}
```

<div id="comment:8" align="right">comment:8</div>

I don't consider the remaining frame corresponding to the factorial generator a bug. It is there because appearantly someone thinks that the factorial generator should be available as a generator instead of a function in some module.



---

archive/issue_comments_100814.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@koffie](#comment:8):\n> I don't consider the remaining frame corresponding to the factorial generator a bug. It is there because appearantly someone thinks that the factorial generator should be available as a generator instead of a function in some module.\n\nI agree that the main problem was solved by #10548 and this can be closed.",
    "created_at": "2011-05-31T13:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100814",
    "user": "https://github.com/burcin"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@koffie](#comment:8):
> I don't consider the remaining frame corresponding to the factorial generator a bug. It is there because appearantly someone thinks that the factorial generator should be available as a generator instead of a function in some module.

I agree that the main problem was solved by #10548 and this can be closed.



---

archive/issue_events_139195.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2011-05-31T13:39:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139195"
}
```



---

archive/issue_events_139196.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2011-05-31T13:39:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139196"
}
```



---

archive/issue_comments_100815.json:
```json
{
    "body": "Changed author from **Maarten Derickx** to none",
    "created_at": "2011-05-31T14:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100815",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Maarten Derickx** to none



---

archive/issue_comments_100816.json:
```json
{
    "body": "Changed reviewer from **Keshav Kini** to **Burcin Erocal**",
    "created_at": "2011-05-31T14:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10570#issuecomment-100816",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Keshav Kini** to **Burcin Erocal**



---

archive/issue_events_139197.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-31T17:16:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139197"
}
```



---

archive/issue_events_139198.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-31T17:16:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139198"
}
```



---

archive/issue_events_139199.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-31T17:16:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10570",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10570#event-139199"
}
```
