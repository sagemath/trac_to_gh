# Issue 10801: Create a new option: "sage -strip" which deletes things that aren't needed for a binary distribution of sage, or for people that will never develop or upgrade

archive/issues_010735.json:
```json
{
    "assignees": [],
    "body": "This is a frequently requested feature.  We should start with some little script that does this, and build on it.  I tried all the following, and ran the test suite and it worked fine. \n\n- rm SAGE_ROOT/local/lib/*.a\n- rm SAGE_ROOT/devel/sage/build/lib.*\n- rm SAGE_ROOT/devel/sage/build/temp.*\n- strip SAGE_ROOT/local/bin/Singular-* SAGE_ROOT/local/bin/gfan   # gfan is a huge win.\n- jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...\n- strip SAGE_ROOT/local/lib/*.so\n- rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n- rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n\n---\n\nThe patches below actually provide a new `make` target, \"`micro_release`\", rather than adding a new option to `sage`.\n\n---\n\nApply [attachment: trac_10801-root_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz) to the Sage **root repository**.\n\nApply [attachment: trac_10801-local_bin_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz) to the Sage **scripts repository**.\n\n\n\n\nCC:  @jasongrout @kcrisman\n\nKeywords: **sd32**\n\nAuthor: **William Stein, Keshav Kini**\n\nReviewer: **Benjamin Jones, Keshav Kini**\n\nMerged: **sage-4.7.2.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10801_\n\n",
    "closed_at": "2011-09-12T18:39:51Z",
    "created_at": "2011-02-19T00:57:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Create a new option: \"sage -strip\" which deletes things that aren't needed for a binary distribution of sage, or for people that will never develop or upgrade",
    "type": "issue",
    "updated_at": "2011-09-12T18:39:51Z",
    "url": "https://github.com/sagemath/sage/issues/10801",
    "user": "https://github.com/williamstein"
}
```
This is a frequently requested feature.  We should start with some little script that does this, and build on it.  I tried all the following, and ran the test suite and it worked fine. 

- rm SAGE_ROOT/local/lib/*.a
- rm SAGE_ROOT/devel/sage/build/lib.*
- rm SAGE_ROOT/devel/sage/build/temp.*
- strip SAGE_ROOT/local/bin/Singular-* SAGE_ROOT/local/bin/gfan   # gfan is a huge win.
- jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...
- strip SAGE_ROOT/local/lib/*.so
- rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
- rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)

---

The patches below actually provide a new `make` target, "`micro_release`", rather than adding a new option to `sage`.

---

Apply [attachment: trac_10801-root_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz) to the Sage **root repository**.

Apply [attachment: trac_10801-local_bin_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz) to the Sage **scripts repository**.




CC:  @jasongrout @kcrisman

Keywords: **sd32**

Author: **William Stein, Keshav Kini**

Reviewer: **Benjamin Jones, Keshav Kini**

Merged: **sage-4.7.2.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/10801_





---

archive/issue_events_130318.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-02-19T00:57:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130318"
}
```



---

archive/issue_events_130319.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-02-19T00:57:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130319"
}
```



---

archive/issue_events_130320.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-02-19T00:57:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130320"
}
```



---

archive/issue_events_130321.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-02-19T00:57:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130321"
}
```



---

archive/issue_comments_106268.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nIt seems like the LiveCD folks have also worked on stuff like this...",
    "created_at": "2011-03-17T16:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106268",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'>Comment 1:</a>
It seems like the LiveCD folks have also worked on stuff like this...



---

archive/issue_comments_106269.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nIf we mount a sage source installation with mount option strictatime or relatime we can just touch all the files to have an access time in the deep past (with something like `cd $SAGE_ROOT ; for x in $(find) ; do touch -ad \"1981-02-03 04:05:06\" ; done`), then run the whole doctest suite, then use stat() to find files which were unused. This should give us a good idea of what is never used. Unfortunately this does not seem possible on sage.math - POSIX atime is not respected in my homedir, probably as it is mounted over NFS...",
    "created_at": "2011-03-22T00:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106269",
    "user": "https://github.com/kini"
}
```

<a id='comment:2'>Comment 2:</a>
If we mount a sage source installation with mount option strictatime or relatime we can just touch all the files to have an access time in the deep past (with something like `cd $SAGE_ROOT ; for x in $(find) ; do touch -ad "1981-02-03 04:05:06" ; done`), then run the whole doctest suite, then use stat() to find files which were unused. This should give us a good idea of what is never used. Unfortunately this does not seem possible on sage.math - POSIX atime is not respected in my homedir, probably as it is mounted over NFS...



---

archive/issue_comments_106270.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,5 +7,5 @@\n - jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...\n - strip SAGE_ROOT/local/lib/*.so\n - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n-- rm all files in SAGE_LOCAL/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n+- rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n \n``````\n",
    "created_at": "2011-03-22T19:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106270",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,5 +7,5 @@
 - jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...
 - strip SAGE_ROOT/local/lib/*.so
 - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
-- rm all files in SAGE_LOCAL/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
+- rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
 
``````




---

archive/issue_comments_106271.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nif you're using linux, take a look at inotify-tools which has nice and clean command line tools, as it will give you a more fine-grained and realtime sense of what files are being used as they are accessed/modified to track down what's being used by which calls/tests/parts of sage.",
    "created_at": "2011-03-23T19:09:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106271",
    "user": "https://github.com/sagetrac-pi"
}
```

<a id='comment:4'>Comment 4:</a>
if you're using linux, take a look at inotify-tools which has nice and clean command line tools, as it will give you a more fine-grained and realtime sense of what files are being used as they are accessed/modified to track down what's being used by which calls/tests/parts of sage.



---

archive/issue_comments_106272.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nWe can probably remove any Mercurial repositories.",
    "created_at": "2011-03-23T23:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106272",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'>Comment 5:</a>
We can probably remove any Mercurial repositories.



---

archive/issue_comments_106273.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\n[Here](http://www1.spms.ntu.edu.sg/~krkini/temp/access_monitor.tar.bz2)'s some data I collected about what files are used and what files aren't, in sage 4.7.alpha3. Surprisingly many aren't, but come to think of it there's going to be a lot of stuff that users would want which isn't used by any doctest. I guess one should think of this data as a lower bound...",
    "created_at": "2011-03-25T00:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106273",
    "user": "https://github.com/kini"
}
```

<a id='comment:7'>Comment 7:</a>
[Here](http://www1.spms.ntu.edu.sg/~krkini/temp/access_monitor.tar.bz2)'s some data I collected about what files are used and what files aren't, in sage 4.7.alpha3. Surprisingly many aren't, but come to think of it there's going to be a lot of stuff that users would want which isn't used by any doctest. I guess one should think of this data as a lower bound...



---

archive/issue_comments_106274.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nWhy is it OK to delete SAGE_ROOT/local/bin/gfan?",
    "created_at": "2011-05-28T03:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106274",
    "user": "https://github.com/sagetrac-mhampton"
}
```

<a id='comment:8'>Comment 8:</a>
Why is it OK to delete SAGE_ROOT/local/bin/gfan?



---

archive/issue_comments_106275.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nNot delete, but [strip](https://secure.wikimedia.org/wikipedia/en/wiki/Strip_(Unix)). This removes debug symbols.",
    "created_at": "2011-06-14T23:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106275",
    "user": "https://github.com/kini"
}
```

<a id='comment:9'>Comment 9:</a>
Not delete, but [strip](https://secure.wikimedia.org/wikipedia/en/wiki/Strip_(Unix)). This removes debug symbols.



---

archive/issue_comments_106276.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nSlightly related: `sage -crap ...` (`local/bin/sage-crap`)\n\nNote that we already have a few `*clean` targets in the top-level Makefile; there could be more (like `strip`), and some of the others could perhaps get improved or extended.\n\nI personally wouldn't use `-strip` for anything else than really stripping debug symbols, i.e., if it is e.g. intended to delete also static libraries (which may be needed if someone installs some package, not necessarily an spkg), I'd choose a different name for such an option (or `make` target).",
    "created_at": "2011-08-22T09:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106276",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'>Comment 10:</a>
Slightly related: `sage -crap ...` (`local/bin/sage-crap`)

Note that we already have a few `*clean` targets in the top-level Makefile; there could be more (like `strip`), and some of the others could perhaps get improved or extended.

I personally wouldn't use `-strip` for anything else than really stripping debug symbols, i.e., if it is e.g. intended to delete also static libraries (which may be needed if someone installs some package, not necessarily an spkg), I'd choose a different name for such an option (or `make` target).



---

archive/issue_comments_106277.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nAfter a long discussion, Keshav and I came up with:\n\n```\n   make micro_release\n```\nsince this is a lot like \"make release\" with other software....",
    "created_at": "2011-08-23T18:02:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106277",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:11'>Comment 11:</a>
After a long discussion, Keshav and I came up with:

```
   make micro_release
```
since this is a lot like "make release" with other software....



---

archive/issue_comments_106278.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [mhampton](#comment%3A8):\n> Why is it OK to delete SAGE_ROOT/local/bin/gfan?  \n\nI didn't suggest deleting gfan, but *stripping* it.",
    "created_at": "2011-08-23T18:34:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106278",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [mhampton](#comment%3A8):
> Why is it OK to delete SAGE_ROOT/local/bin/gfan?  

I didn't suggest deleting gfan, but *stripping* it.



---

archive/issue_comments_106279.json:
```json
{
    "body": "Attachment: **[trac_10801-root_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz)**\n\napply to the repo in $SAGE_ROOT",
    "created_at": "2011-08-23T20:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106279",
    "user": "https://github.com/williamstein"
}
```

Attachment: **[trac_10801-root_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz)**

apply to the repo in $SAGE_ROOT



---

archive/issue_comments_106280.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nHere's how I'm testing this:\n\n```\nwstein@sage:/tmp/wstein/sage-4.7.2.alpha1-sage.math.washington.edu-x86_64-Linux$\n$ du -sh .\n2.4G    .\n$ du -s .\n2468404 .\n\n$ ./sage -hg import https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz\napplying https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz\n\n$ cd local/bin/; ../../sage -hg import https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz\napplying https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz\n\n$ time make micro_release\nreal    0m38.227s\nuser    0m2.370s\nsys     0m5.140s\n\n$ du -sh .\n1.5G    .\n$ du -s .\n1547480 .\n\n$ ./sage\n# see it works\n\n$ make ptestlong\n# observe what happens (I will report back in a follow comment about this).\n```",
    "created_at": "2011-08-23T20:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106280",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:13'>Comment 13:</a>
Here's how I'm testing this:

```
wstein@sage:/tmp/wstein/sage-4.7.2.alpha1-sage.math.washington.edu-x86_64-Linux$
$ du -sh .
2.4G    .
$ du -s .
2468404 .

$ ./sage -hg import https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz
applying https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz

$ cd local/bin/; ../../sage -hg import https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz
applying https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz

$ time make micro_release
real    0m38.227s
user    0m2.370s
sys     0m5.140s

$ du -sh .
1.5G    .
$ du -s .
1547480 .

$ ./sage
# see it works

$ make ptestlong
# observe what happens (I will report back in a follow comment about this).
```



---

archive/issue_comments_106281.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nptestlong passes.  W00t.",
    "created_at": "2011-08-23T21:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106281",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:14'>Comment 14:</a>
ptestlong passes.  W00t.



---

archive/issue_events_130322.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-23T21:29:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130322"
}
```



---

archive/issue_comments_106282.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nSome thoughts:\n\n* In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep \"not stripped\" &> /dev/null`, I think.\n* The *`_with_condition()` functions should not talk about extensions in their docstrings.\n* What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)\n\nGoing a bit farther, considering the target users will never develop or upgrade,\n\n* Should we delete mercurial repos?\n* Should we delete SPKGs?",
    "created_at": "2011-08-24T04:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106282",
    "user": "https://github.com/kini"
}
```

<a id='comment:15'>Comment 15:</a>
Some thoughts:

* In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep "not stripped" &> /dev/null`, I think.
* The *`_with_condition()` functions should not talk about extensions in their docstrings.
* What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)

Going a bit farther, considering the target users will never develop or upgrade,

* Should we delete mercurial repos?
* Should we delete SPKGs?



---

archive/issue_comments_106283.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@kini](#comment%3A15):\n> Some thoughts:\n> \n> * In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep \"not stripped\" &> /dev/null`, I think.\n\nLATER: This could be added, but can we do it later in a future ticket.  It would be good if the first version of this patch is quite safe.  Hey, it already saves *1 GB* as is!\n\n> * The *`_with_condition()` functions should not talk about extensions in their docstrings.\n\nOK: I'll fix the patch right now. \n\n> * What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)\n> \n\nNO:  Pointless, and scary in that it would break functionality, which is probably a bad idea.  Good point about the size.  I must have been testing something with some optional fonts installed. \n\n> Going a bit farther, considering the target users will never develop or upgrade,\n> \n> * Should we delete mercurial repos?\n\nFUTURE: Yes, but in a future version of this?\n\n> * Should we delete SPKGs?\n\nFUTURE: It's safer to put a small string in each, to avoid confusion.  This happens automatically when you build a binary with \"sage -bdist\".   Anyway, this is something that could be added later.",
    "created_at": "2011-08-24T05:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106283",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@kini](#comment%3A15):
> Some thoughts:
> 
> * In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep "not stripped" &> /dev/null`, I think.

LATER: This could be added, but can we do it later in a future ticket.  It would be good if the first version of this patch is quite safe.  Hey, it already saves *1 GB* as is!

> * The *`_with_condition()` functions should not talk about extensions in their docstrings.

OK: I'll fix the patch right now. 

> * What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)
> 

NO:  Pointless, and scary in that it would break functionality, which is probably a bad idea.  Good point about the size.  I must have been testing something with some optional fonts installed. 

> Going a bit farther, considering the target users will never develop or upgrade,
> 
> * Should we delete mercurial repos?

FUTURE: Yes, but in a future version of this?

> * Should we delete SPKGs?

FUTURE: It's safer to put a small string in each, to avoid confusion.  This happens automatically when you build a binary with "sage -bdist".   Anyway, this is something that could be added later.



---

archive/issue_comments_106284.json:
```json
{
    "body": "Reviewer: **Benjamin Jones**",
    "created_at": "2011-08-24T19:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106284",
    "user": "https://github.com/benjaminfjones"
}
```

Reviewer: **Benjamin Jones**



---

archive/issue_comments_106285.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nTested the patches on sage.math and fresh build of Sage-4.7.1:\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ pwd\n/scratch/bjones/sage-4.7.1\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh\n2.5G\t.\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -s\n2554916\t.\n```\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ time make micro_release\n...\nreal\t0m12.064s\nuser\t0m2.560s\nsys\t0m7.600s\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh\n2.0G\t.\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -s\n2033236\t.\n```\n\nSo it saved 0.5 GB which is not the 1.0 GB observed by William above. Did you remove stuff by hand in that session that the script doesn't touch? Or maybe because I built the install from source instead of using a binary distribution? \n\nI'm running `make ptestlong` now, will report back if anything fails.",
    "created_at": "2011-08-24T19:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106285",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:17'>Comment 17:</a>
Tested the patches on sage.math and fresh build of Sage-4.7.1:

```
bjones@sage:/scratch/bjones/sage-4.7.1$ pwd
/scratch/bjones/sage-4.7.1
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh
2.5G	.
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -s
2554916	.
```

```
bjones@sage:/scratch/bjones/sage-4.7.1$ time make micro_release
...
real	0m12.064s
user	0m2.560s
sys	0m7.600s
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh
2.0G	.
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -s
2033236	.
```

So it saved 0.5 GB which is not the 1.0 GB observed by William above. Did you remove stuff by hand in that session that the script doesn't touch? Or maybe because I built the install from source instead of using a binary distribution? 

I'm running `make ptestlong` now, will report back if anything fails.



---

archive/issue_comments_106286.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nAfter producing the micro release, `make ptestlong` had one failure which disappeared when I doctested by hand:\n\n```\nThe following tests failed:\n\n        sage -t  -long -force_lib devel/sage/sage/tests/startup.py # 1 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1468.7 seconds\nmake: *** [ptestlong] Error 128\n```\nSubsequently by hand:\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ sage -t  -long -force_lib devel/sage/sage/tests/startup.py\nsage -t -long -force_lib \"devel/sage/sage/tests/startup.py\" \n         [12.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 12.1 seconds\n```",
    "created_at": "2011-08-24T19:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106286",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:18'>Comment 18:</a>
After producing the micro release, `make ptestlong` had one failure which disappeared when I doctested by hand:

```
The following tests failed:

        sage -t  -long -force_lib devel/sage/sage/tests/startup.py # 1 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1468.7 seconds
make: *** [ptestlong] Error 128
```
Subsequently by hand:

```
bjones@sage:/scratch/bjones/sage-4.7.1$ sage -t  -long -force_lib devel/sage/sage/tests/startup.py
sage -t -long -force_lib "devel/sage/sage/tests/startup.py" 
         [12.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 12.1 seconds
```



---

archive/issue_comments_106287.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBen:\n\n1. Regarding the size savings, I started with a binary... so we may see a difference.\n\n2. Regarding the startup time failure, this has nothing to do with my patch.  It routinely fails on sage.math.  It's a test that it isn't taking more than 2 seconds on sage.math.  I put it in back when we got the startup time down to solidly be < 1 second on sage.math, since I didn't want people to screw that up.  They did though.",
    "created_at": "2011-08-24T21:34:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106287",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:19'>Comment 19:</a>
Ben:

1. Regarding the size savings, I started with a binary... so we may see a difference.

2. Regarding the startup time failure, this has nothing to do with my patch.  It routinely fails on sage.math.  It's a test that it isn't taking more than 2 seconds on sage.math.  I put it in back when we got the startup time down to solidly be < 1 second on sage.math, since I didn't want people to screw that up.  They did though.



---

archive/issue_comments_106288.json:
```json
{
    "body": "Changed keywords from **** to **sd32**",
    "created_at": "2011-08-24T23:41:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106288",
    "user": "https://github.com/williamstein"
}
```

Changed keywords from **** to **sd32**



---

archive/issue_comments_106289.json:
```json
{
    "body": "Changed reviewer from **Benjamin Jones** to **Benjamin Jones, Keshav Kini**",
    "created_at": "2011-08-25T00:35:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106289",
    "user": "https://github.com/kini"
}
```

Changed reviewer from **Benjamin Jones** to **Benjamin Jones, Keshav Kini**



---

archive/issue_events_130323.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-08-25T00:35:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130323"
}
```



---

archive/issue_events_130324.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-08-25T00:35:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130324"
}
```



---

archive/issue_comments_106290.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nWilliam: OK, sounds good. I'll make a ticket. Sounds like we're good to go here, no? Positive review from me.",
    "created_at": "2011-08-25T00:35:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106290",
    "user": "https://github.com/kini"
}
```

<a id='comment:21'>Comment 21:</a>
William: OK, sounds good. I'll make a ticket. Sounds like we're good to go here, no? Positive review from me.



---

archive/issue_comments_106291.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nOK, I checked on OSX 10.6.8 binary install and I get results simular to William's. Looks good here too. Positive review from me as well.",
    "created_at": "2011-08-25T00:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106291",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:22'>Comment 22:</a>
OK, I checked on OSX 10.6.8 binary install and I get results simular to William's. Looks good here too. Positive review from me as well.



---

archive/issue_comments_106292.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nNew ticket is #11743.",
    "created_at": "2011-08-25T02:41:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106292",
    "user": "https://github.com/kini"
}
```

<a id='comment:23'>Comment 23:</a>
New ticket is #11743.



---

archive/issue_comments_106293.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nMartin Albrecht pointed out that deleting .a files could make it so users can't compile certain Cython programs, maybe.   I'm not sure if we should care though, given the goal of this ticket ('never develop or upgrade').",
    "created_at": "2011-08-25T05:24:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106293",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:24'>Comment 24:</a>
Martin Albrecht pointed out that deleting .a files could make it so users can't compile certain Cython programs, maybe.   I'm not sure if we should care though, given the goal of this ticket ('never develop or upgrade').



---

archive/issue_comments_106294.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nHm. If that includes `%cython` cells, I don't think that counts as \"developing\".",
    "created_at": "2011-08-25T05:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106294",
    "user": "https://github.com/kini"
}
```

<a id='comment:25'>Comment 25:</a>
Hm. If that includes `%cython` cells, I don't think that counts as "developing".



---

archive/issue_comments_106295.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nYes, I'm concerned.  I'll simply comment out the line that deletes the .a files, and repost the patch.",
    "created_at": "2011-08-25T05:34:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106295",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:26'>Comment 26:</a>
Yes, I'm concerned.  I'll simply comment out the line that deletes the .a files, and repost the patch.



---

archive/issue_comments_106296.json:
```json
{
    "body": "replacing the patch by one that doesn't delete .a files.",
    "created_at": "2011-08-25T05:36:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106296",
    "user": "https://github.com/williamstein"
}
```

replacing the patch by one that doesn't delete .a files.



---

archive/issue_comments_106297.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nAttachment: **[trac_10801-local_bin_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz)**\n\nFair enough. Sadly this reduces our space savings by more than 200 MB.\n\n(I'm putting myself as an author on this ticket because I seem to be listed as one the patch...)",
    "created_at": "2011-08-25T05:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106297",
    "user": "https://github.com/kini"
}
```

<a id='comment:27'>Comment 27:</a>
Attachment: **[trac_10801-local_bin_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz)**

Fair enough. Sadly this reduces our space savings by more than 200 MB.

(I'm putting myself as an author on this ticket because I seem to be listed as one the patch...)



---

archive/issue_comments_106298.json:
```json
{
    "body": "Author: **William Stein, Keshav Kini**",
    "created_at": "2011-08-25T05:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106298",
    "user": "https://github.com/kini"
}
```

Author: **William Stein, Keshav Kini**



---

archive/issue_comments_106299.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,15 @@\n - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n - rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n \n+---\n+\n+The patches below actually provide a new `make` target, \"`micro_release`\", rather than adding a new option to `sage`.\n+\n+---\n+\n+Apply [attachment: trac_10801-root_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz) to the Sage **root repository**.\n+\n+Apply [attachment: trac_10801-local_bin_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz) to the Sage **scripts repository**.\n+\n+\n+\n``````\n",
    "created_at": "2011-09-09T00:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106299",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,15 @@
 - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
 - rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
 
+---
+
+The patches below actually provide a new `make` target, "`micro_release`", rather than adding a new option to `sage`.
+
+---
+
+Apply [attachment: trac_10801-root_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz) to the Sage **root repository**.
+
+Apply [attachment: trac_10801-local_bin_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz) to the Sage **scripts repository**.
+
+
+
``````




---

archive/issue_events_130325.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T18:39:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130325"
}
```



---

archive/issue_events_130326.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T18:39:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-130326"
}
```



---

archive/issue_comments_106300.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha3**",
    "created_at": "2011-09-12T18:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-106300",
    "user": "https://github.com/nexttime"
}
```

Merged: **sage-4.7.2.alpha3**
