# Issue 10801: Create a new option: "sage -strip" which deletes things that aren't needed for a binary distribution of sage, or for people that will never develop or upgrade

archive/issues_010735.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis is a frequently requested feature.  We should start with some little script that does this, and build on it.  I tried all the following, and ran the test suite and it worked fine. \n\n- rm SAGE_ROOT/local/lib/*.a\n- rm SAGE_ROOT/devel/sage/build/lib.*\n- rm SAGE_ROOT/devel/sage/build/temp.*\n- strip SAGE_ROOT/local/bin/Singular-* SAGE_ROOT/local/bin/gfan   # gfan is a huge win.\n- jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...\n- strip SAGE_ROOT/local/lib/*.so\n- rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n- rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n\n---\n\nThe patches below actually provide a new `make` target, \"`micro_release`\", rather than adding a new option to `sage`.\n\n---\n\nApply [attachment: trac_10801-root_repo.patch](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz) to the Sage **root repository**.\n\nApply [attachment: trac_10801-local_bin_repo.patch](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz) to the Sage **scripts repository**.\n\n\n\n\nCC:  @jasongrout @kcrisman\n\nComponent: **packages: standard**\n\nKeywords: **sd32**\n\nAuthor: **William Stein, Keshav Kini**\n\nReviewer: **Benjamin Jones, Keshav Kini**\n\nMerged: **sage-4.7.2.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10801_\n\n",
    "closed_at": "2011-09-12T18:39:51Z",
    "created_at": "2011-02-19T00:57:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Create a new option: \"sage -strip\" which deletes things that aren't needed for a binary distribution of sage, or for people that will never develop or upgrade",
    "type": "issue",
    "updated_at": "2011-09-12T18:39:51Z",
    "url": "https://github.com/sagemath/sage/issues/10801",
    "user": "https://github.com/williamstein"
}
```
<div id="comment:0"></div>

This is a frequently requested feature.  We should start with some little script that does this, and build on it.  I tried all the following, and ran the test suite and it worked fine. 

- rm SAGE_ROOT/local/lib/*.a
- rm SAGE_ROOT/devel/sage/build/lib.*
- rm SAGE_ROOT/devel/sage/build/temp.*
- strip SAGE_ROOT/local/bin/Singular-* SAGE_ROOT/local/bin/gfan   # gfan is a huge win.
- jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...
- strip SAGE_ROOT/local/lib/*.so
- rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
- rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)

---

The patches below actually provide a new `make` target, "`micro_release`", rather than adding a new option to `sage`.

---

Apply [attachment: trac_10801-root_repo.patch](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz) to the Sage **root repository**.

Apply [attachment: trac_10801-local_bin_repo.patch](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz) to the Sage **scripts repository**.




CC:  @jasongrout @kcrisman

Component: **packages: standard**

Keywords: **sd32**

Author: **William Stein, Keshav Kini**

Reviewer: **Benjamin Jones, Keshav Kini**

Merged: **sage-4.7.2.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/10801_





---

archive/issue_events_141433.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-02-19T00:57:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141433"
}
```



---

archive/issue_events_141434.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-02-19T00:57:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141434"
}
```



---

archive/issue_events_141435.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-02-19T00:57:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141435"
}
```



---

archive/issue_events_141436.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-02-19T00:57:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141436"
}
```



---

archive/issue_comments_104181.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIt seems like the LiveCD folks have also worked on stuff like this...",
    "created_at": "2011-03-17T16:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104181",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:1" align="right">comment:1</div>

It seems like the LiveCD folks have also worked on stuff like this...



---

archive/issue_comments_104182.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIf we mount a sage source installation with mount option strictatime or relatime we can just touch all the files to have an access time in the deep past (with something like `cd $SAGE_ROOT ; for x in $(find) ; do touch -ad \"1981-02-03 04:05:06\" ; done`), then run the whole doctest suite, then use stat() to find files which were unused. This should give us a good idea of what is never used. Unfortunately this does not seem possible on sage.math - POSIX atime is not respected in my homedir, probably as it is mounted over NFS...",
    "created_at": "2011-03-22T00:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104182",
    "user": "https://github.com/kini"
}
```

<div id="comment:2" align="right">comment:2</div>

If we mount a sage source installation with mount option strictatime or relatime we can just touch all the files to have an access time in the deep past (with something like `cd $SAGE_ROOT ; for x in $(find) ; do touch -ad "1981-02-03 04:05:06" ; done`), then run the whole doctest suite, then use stat() to find files which were unused. This should give us a good idea of what is never used. Unfortunately this does not seem possible on sage.math - POSIX atime is not respected in my homedir, probably as it is mounted over NFS...



---

archive/issue_comments_104183.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,5 +7,5 @@\n - jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...\n - strip SAGE_ROOT/local/lib/*.so\n - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n-- rm all files in SAGE_LOCAL/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n+- rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n \n``````\n",
    "created_at": "2011-03-22T19:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104183",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,5 +7,5 @@
 - jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...
 - strip SAGE_ROOT/local/lib/*.so
 - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
-- rm all files in SAGE_LOCAL/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
+- rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
 
``````




---

archive/issue_comments_104184.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nif you're using linux, take a look at inotify-tools which has nice and clean command line tools, as it will give you a more fine-grained and realtime sense of what files are being used as they are accessed/modified to track down what's being used by which calls/tests/parts of sage.",
    "created_at": "2011-03-23T19:09:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104184",
    "user": "https://github.com/sagetrac-pi"
}
```

<div id="comment:4" align="right">comment:4</div>

if you're using linux, take a look at inotify-tools which has nice and clean command line tools, as it will give you a more fine-grained and realtime sense of what files are being used as they are accessed/modified to track down what's being used by which calls/tests/parts of sage.



---

archive/issue_comments_104185.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWe can probably remove any Mercurial repositories.",
    "created_at": "2011-03-23T23:16:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104185",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

We can probably remove any Mercurial repositories.



---

archive/issue_comments_104186.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n[Here](http://www1.spms.ntu.edu.sg/~krkini/temp/access_monitor.tar.bz2)'s some data I collected about what files are used and what files aren't, in sage 4.7.alpha3. Surprisingly many aren't, but come to think of it there's going to be a lot of stuff that users would want which isn't used by any doctest. I guess one should think of this data as a lower bound...",
    "created_at": "2011-03-25T00:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104186",
    "user": "https://github.com/kini"
}
```

<div id="comment:7" align="right">comment:7</div>

[Here](http://www1.spms.ntu.edu.sg/~krkini/temp/access_monitor.tar.bz2)'s some data I collected about what files are used and what files aren't, in sage 4.7.alpha3. Surprisingly many aren't, but come to think of it there's going to be a lot of stuff that users would want which isn't used by any doctest. I guess one should think of this data as a lower bound...



---

archive/issue_comments_104187.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWhy is it OK to delete SAGE_ROOT/local/bin/gfan?",
    "created_at": "2011-05-28T03:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104187",
    "user": "https://github.com/sagetrac-mhampton"
}
```

<div id="comment:8" align="right">comment:8</div>

Why is it OK to delete SAGE_ROOT/local/bin/gfan?



---

archive/issue_comments_104188.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nNot delete, but [strip](https://secure.wikimedia.org/wikipedia/en/wiki/Strip_(Unix)). This removes debug symbols.",
    "created_at": "2011-06-14T23:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104188",
    "user": "https://github.com/kini"
}
```

<div id="comment:9" align="right">comment:9</div>

Not delete, but [strip](https://secure.wikimedia.org/wikipedia/en/wiki/Strip_(Unix)). This removes debug symbols.



---

archive/issue_comments_104189.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSlightly related: `sage -crap ...` (`local/bin/sage-crap`)\n\nNote that we already have a few `*clean` targets in the top-level Makefile; there could be more (like `strip`), and some of the others could perhaps get improved or extended.\n\nI personally wouldn't use `-strip` for anything else than really stripping debug symbols, i.e., if it is e.g. intended to delete also static libraries (which may be needed if someone installs some package, not necessarily an spkg), I'd choose a different name for such an option (or `make` target).",
    "created_at": "2011-08-22T09:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104189",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:10" align="right">comment:10</div>

Slightly related: `sage -crap ...` (`local/bin/sage-crap`)

Note that we already have a few `*clean` targets in the top-level Makefile; there could be more (like `strip`), and some of the others could perhaps get improved or extended.

I personally wouldn't use `-strip` for anything else than really stripping debug symbols, i.e., if it is e.g. intended to delete also static libraries (which may be needed if someone installs some package, not necessarily an spkg), I'd choose a different name for such an option (or `make` target).



---

archive/issue_comments_104190.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAfter a long discussion, Keshav and I came up with:\n\n```\n   make micro_release\n```\nsince this is a lot like \"make release\" with other software....",
    "created_at": "2011-08-23T18:02:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104190",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:11" align="right">comment:11</div>

After a long discussion, Keshav and I came up with:

```
   make micro_release
```
since this is a lot like "make release" with other software....



---

archive/issue_comments_104191.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@sagetrac-mhampton](#comment%3A8):\n> Why is it OK to delete SAGE_ROOT/local/bin/gfan?  \n\nI didn't suggest deleting gfan, but *stripping* it.",
    "created_at": "2011-08-23T18:34:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104191",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@sagetrac-mhampton](#comment%3A8):
> Why is it OK to delete SAGE_ROOT/local/bin/gfan?  

I didn't suggest deleting gfan, but *stripping* it.



---

archive/issue_comments_104192.json:
```json
{
    "body": "Attachment: **[trac_10801-root_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz)**\n\napply to the repo in $SAGE_ROOT",
    "created_at": "2011-08-23T20:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104192",
    "user": "https://github.com/williamstein"
}
```

Attachment: **[trac_10801-root_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz)**

apply to the repo in $SAGE_ROOT



---

archive/issue_comments_104193.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHere's how I'm testing this:\n\n```\nwstein@sage:/tmp/wstein/sage-4.7.2.alpha1-sage.math.washington.edu-x86_64-Linux$\n$ du -sh .\n2.4G    .\n$ du -s .\n2468404 .\n\n$ ./sage -hg import https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz\napplying https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz\n\n$ cd local/bin/; ../../sage -hg import https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz\napplying https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz\n\n$ time make micro_release\nreal    0m38.227s\nuser    0m2.370s\nsys     0m5.140s\n\n$ du -sh .\n1.5G    .\n$ du -s .\n1547480 .\n\n$ ./sage\n# see it works\n\n$ make ptestlong\n# observe what happens (I will report back in a follow comment about this).\n```",
    "created_at": "2011-08-23T20:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104193",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:13" align="right">comment:13</div>

Here's how I'm testing this:

```
wstein@sage:/tmp/wstein/sage-4.7.2.alpha1-sage.math.washington.edu-x86_64-Linux$
$ du -sh .
2.4G    .
$ du -s .
2468404 .

$ ./sage -hg import https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz
applying https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz

$ cd local/bin/; ../../sage -hg import https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz
applying https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz

$ time make micro_release
real    0m38.227s
user    0m2.370s
sys     0m5.140s

$ du -sh .
1.5G    .
$ du -s .
1547480 .

$ ./sage
# see it works

$ make ptestlong
# observe what happens (I will report back in a follow comment about this).
```



---

archive/issue_comments_104194.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nptestlong passes.  W00t.",
    "created_at": "2011-08-23T21:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104194",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:14" align="right">comment:14</div>

ptestlong passes.  W00t.



---

archive/issue_events_141437.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-23T21:29:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141437"
}
```



---

archive/issue_comments_104195.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nSome thoughts:\n\n* In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep \"not stripped\" &> /dev/null`, I think.\n* The *`_with_condition()` functions should not talk about extensions in their docstrings.\n* What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)\n\nGoing a bit farther, considering the target users will never develop or upgrade,\n\n* Should we delete mercurial repos?\n* Should we delete SPKGs?",
    "created_at": "2011-08-24T04:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104195",
    "user": "https://github.com/kini"
}
```

<div id="comment:15" align="right">comment:15</div>

Some thoughts:

* In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep "not stripped" &> /dev/null`, I think.
* The *`_with_condition()` functions should not talk about extensions in their docstrings.
* What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)

Going a bit farther, considering the target users will never develop or upgrade,

* Should we delete mercurial repos?
* Should we delete SPKGs?



---

archive/issue_comments_104196.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@kini](#comment%3A15):\n> Some thoughts:\n> \n> * In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep \"not stripped\" &> /dev/null`, I think.\n\nLATER: This could be added, but can we do it later in a future ticket.  It would be good if the first version of this patch is quite safe.  Hey, it already saves *1 GB* as is!\n\n> * The *`_with_condition()` functions should not talk about extensions in their docstrings.\n\nOK: I'll fix the patch right now. \n\n> * What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)\n> \n\nNO:  Pointless, and scary in that it would break functionality, which is probably a bad idea.  Good point about the size.  I must have been testing something with some optional fonts installed. \n\n> Going a bit farther, considering the target users will never develop or upgrade,\n> \n> * Should we delete mercurial repos?\n\nFUTURE: Yes, but in a future version of this?\n\n> * Should we delete SPKGs?\n\nFUTURE: It's safer to put a small string in each, to avoid confusion.  This happens automatically when you build a binary with \"sage -bdist\".   Anyway, this is something that could be added later.",
    "created_at": "2011-08-24T05:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104196",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@kini](#comment%3A15):
> Some thoughts:
> 
> * In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep "not stripped" &> /dev/null`, I think.

LATER: This could be added, but can we do it later in a future ticket.  It would be good if the first version of this patch is quite safe.  Hey, it already saves *1 GB* as is!

> * The *`_with_condition()` functions should not talk about extensions in their docstrings.

OK: I'll fix the patch right now. 

> * What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)
> 

NO:  Pointless, and scary in that it would break functionality, which is probably a bad idea.  Good point about the size.  I must have been testing something with some optional fonts installed. 

> Going a bit farther, considering the target users will never develop or upgrade,
> 
> * Should we delete mercurial repos?

FUTURE: Yes, but in a future version of this?

> * Should we delete SPKGs?

FUTURE: It's safer to put a small string in each, to avoid confusion.  This happens automatically when you build a binary with "sage -bdist".   Anyway, this is something that could be added later.



---

archive/issue_comments_104197.json:
```json
{
    "body": "Reviewer: **Benjamin Jones**",
    "created_at": "2011-08-24T19:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104197",
    "user": "https://github.com/benjaminfjones"
}
```

Reviewer: **Benjamin Jones**



---

archive/issue_comments_104198.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nTested the patches on sage.math and fresh build of Sage-4.7.1:\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ pwd\n/scratch/bjones/sage-4.7.1\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh\n2.5G\t.\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -s\n2554916\t.\n```\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ time make micro_release\n...\nreal\t0m12.064s\nuser\t0m2.560s\nsys\t0m7.600s\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh\n2.0G\t.\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -s\n2033236\t.\n```\n\nSo it saved 0.5 GB which is not the 1.0 GB observed by William above. Did you remove stuff by hand in that session that the script doesn't touch? Or maybe because I built the install from source instead of using a binary distribution? \n\nI'm running `make ptestlong` now, will report back if anything fails.",
    "created_at": "2011-08-24T19:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104198",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:17" align="right">comment:17</div>

Tested the patches on sage.math and fresh build of Sage-4.7.1:

```
bjones@sage:/scratch/bjones/sage-4.7.1$ pwd
/scratch/bjones/sage-4.7.1
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh
2.5G	.
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -s
2554916	.
```

```
bjones@sage:/scratch/bjones/sage-4.7.1$ time make micro_release
...
real	0m12.064s
user	0m2.560s
sys	0m7.600s
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh
2.0G	.
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -s
2033236	.
```

So it saved 0.5 GB which is not the 1.0 GB observed by William above. Did you remove stuff by hand in that session that the script doesn't touch? Or maybe because I built the install from source instead of using a binary distribution? 

I'm running `make ptestlong` now, will report back if anything fails.



---

archive/issue_comments_104199.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAfter producing the micro release, `make ptestlong` had one failure which disappeared when I doctested by hand:\n\n```\nThe following tests failed:\n\n        sage -t  -long -force_lib devel/sage/sage/tests/startup.py # 1 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1468.7 seconds\nmake: *** [ptestlong] Error 128\n```\nSubsequently by hand:\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ sage -t  -long -force_lib devel/sage/sage/tests/startup.py\nsage -t -long -force_lib \"devel/sage/sage/tests/startup.py\" \n         [12.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 12.1 seconds\n```",
    "created_at": "2011-08-24T19:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104199",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:18" align="right">comment:18</div>

After producing the micro release, `make ptestlong` had one failure which disappeared when I doctested by hand:

```
The following tests failed:

        sage -t  -long -force_lib devel/sage/sage/tests/startup.py # 1 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1468.7 seconds
make: *** [ptestlong] Error 128
```
Subsequently by hand:

```
bjones@sage:/scratch/bjones/sage-4.7.1$ sage -t  -long -force_lib devel/sage/sage/tests/startup.py
sage -t -long -force_lib "devel/sage/sage/tests/startup.py" 
         [12.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 12.1 seconds
```



---

archive/issue_comments_104200.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nBen:\n\n1. Regarding the size savings, I started with a binary... so we may see a difference.\n\n2. Regarding the startup time failure, this has nothing to do with my patch.  It routinely fails on sage.math.  It's a test that it isn't taking more than 2 seconds on sage.math.  I put it in back when we got the startup time down to solidly be < 1 second on sage.math, since I didn't want people to screw that up.  They did though.",
    "created_at": "2011-08-24T21:34:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104200",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:19" align="right">comment:19</div>

Ben:

1. Regarding the size savings, I started with a binary... so we may see a difference.

2. Regarding the startup time failure, this has nothing to do with my patch.  It routinely fails on sage.math.  It's a test that it isn't taking more than 2 seconds on sage.math.  I put it in back when we got the startup time down to solidly be < 1 second on sage.math, since I didn't want people to screw that up.  They did though.



---

archive/issue_comments_104201.json:
```json
{
    "body": "Changed keywords from none to **sd32**",
    "created_at": "2011-08-24T23:41:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104201",
    "user": "https://github.com/williamstein"
}
```

Changed keywords from none to **sd32**



---

archive/issue_comments_104202.json:
```json
{
    "body": "Changed reviewer from **Benjamin Jones** to **Benjamin Jones, Keshav Kini**",
    "created_at": "2011-08-25T00:35:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104202",
    "user": "https://github.com/kini"
}
```

Changed reviewer from **Benjamin Jones** to **Benjamin Jones, Keshav Kini**



---

archive/issue_events_141438.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-08-25T00:35:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141438"
}
```



---

archive/issue_events_141439.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-08-25T00:35:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141439"
}
```



---

archive/issue_comments_104203.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWilliam: OK, sounds good. I'll make a ticket. Sounds like we're good to go here, no? Positive review from me.",
    "created_at": "2011-08-25T00:35:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104203",
    "user": "https://github.com/kini"
}
```

<div id="comment:21" align="right">comment:21</div>

William: OK, sounds good. I'll make a ticket. Sounds like we're good to go here, no? Positive review from me.



---

archive/issue_comments_104204.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nOK, I checked on OSX 10.6.8 binary install and I get results simular to William's. Looks good here too. Positive review from me as well.",
    "created_at": "2011-08-25T00:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104204",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:22" align="right">comment:22</div>

OK, I checked on OSX 10.6.8 binary install and I get results simular to William's. Looks good here too. Positive review from me as well.



---

archive/issue_comments_104205.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nNew ticket is #11743.",
    "created_at": "2011-08-25T02:41:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104205",
    "user": "https://github.com/kini"
}
```

<div id="comment:23" align="right">comment:23</div>

New ticket is #11743.



---

archive/issue_comments_104206.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nMartin Albrecht pointed out that deleting .a files could make it so users can't compile certain Cython programs, maybe.   I'm not sure if we should care though, given the goal of this ticket ('never develop or upgrade').",
    "created_at": "2011-08-25T05:24:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104206",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:24" align="right">comment:24</div>

Martin Albrecht pointed out that deleting .a files could make it so users can't compile certain Cython programs, maybe.   I'm not sure if we should care though, given the goal of this ticket ('never develop or upgrade').



---

archive/issue_comments_104207.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nHm. If that includes `%cython` cells, I don't think that counts as \"developing\".",
    "created_at": "2011-08-25T05:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104207",
    "user": "https://github.com/kini"
}
```

<div id="comment:25" align="right">comment:25</div>

Hm. If that includes `%cython` cells, I don't think that counts as "developing".



---

archive/issue_comments_104208.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nYes, I'm concerned.  I'll simply comment out the line that deletes the .a files, and repost the patch.",
    "created_at": "2011-08-25T05:34:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104208",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:26" align="right">comment:26</div>

Yes, I'm concerned.  I'll simply comment out the line that deletes the .a files, and repost the patch.



---

archive/issue_comments_104209.json:
```json
{
    "body": "replacing the patch by one that doesn't delete .a files.",
    "created_at": "2011-08-25T05:36:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104209",
    "user": "https://github.com/williamstein"
}
```

replacing the patch by one that doesn't delete .a files.



---

archive/issue_comments_104210.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAttachment: **[trac_10801-local_bin_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz)**\n\nFair enough. Sadly this reduces our space savings by more than 200 MB.\n\n(I'm putting myself as an author on this ticket because I seem to be listed as one the patch...)",
    "created_at": "2011-08-25T05:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104210",
    "user": "https://github.com/kini"
}
```

<div id="comment:27" align="right">comment:27</div>

Attachment: **[trac_10801-local_bin_repo.patch.gz](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz)**

Fair enough. Sadly this reduces our space savings by more than 200 MB.

(I'm putting myself as an author on this ticket because I seem to be listed as one the patch...)



---

archive/issue_comments_104211.json:
```json
{
    "body": "Author: **William Stein, Keshav Kini**",
    "created_at": "2011-08-25T05:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104211",
    "user": "https://github.com/kini"
}
```

Author: **William Stein, Keshav Kini**



---

archive/issue_comments_104212.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,15 @@\n - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n - rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n \n+---\n+\n+The patches below actually provide a new `make` target, \"`micro_release`\", rather than adding a new option to `sage`.\n+\n+---\n+\n+Apply [attachment: trac_10801-root_repo.patch](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz) to the Sage **root repository**.\n+\n+Apply [attachment: trac_10801-local_bin_repo.patch](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz) to the Sage **scripts repository**.\n+\n+\n+\n``````\n",
    "created_at": "2011-09-09T00:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104212",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,15 @@
 - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
 - rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
 
+---
+
+The patches below actually provide a new `make` target, "`micro_release`", rather than adding a new option to `sage`.
+
+---
+
+Apply [attachment: trac_10801-root_repo.patch](https://github.com/sagemath/sage/files/ticket10801/trac_10801-root_repo.patch.gz) to the Sage **root repository**.
+
+Apply [attachment: trac_10801-local_bin_repo.patch](https://github.com/sagemath/sage/files/ticket10801/trac_10801-local_bin_repo.patch.gz) to the Sage **scripts repository**.
+
+
+
``````




---

archive/issue_events_141440.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T18:39:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141440"
}
```



---

archive/issue_events_141441.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T18:39:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10801#event-141441"
}
```



---

archive/issue_comments_104213.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha3**",
    "created_at": "2011-09-12T18:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10801#issuecomment-104213",
    "user": "https://github.com/nexttime"
}
```

Merged: **sage-4.7.2.alpha3**
