# Issue 10801: Create a new option: "sage -strip" which deletes things that aren't needed for a binary distribution of sage, or for people that will never develop or upgrade

archive/issues_010735.json:
```json
{
    "body": "This is a frequently requested feature.  We should start with some little script that does this, and build on it.  I tried all the following, and ran the test suite and it worked fine. \n\n- rm SAGE_ROOT/local/lib/*.a\n- rm SAGE_ROOT/devel/sage/build/lib.*\n- rm SAGE_ROOT/devel/sage/build/temp.*\n- strip SAGE_ROOT/local/bin/Singular-* SAGE_ROOT/local/bin/gfan   # gfan is a huge win.\n- jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...\n- strip SAGE_ROOT/local/lib/*.so\n- rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n- rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n\n---\n\nThe patches below actually provide a new `make` target, \"`micro_release`\", rather than adding a new option to `sage`.\n\n---\n\nApply [attachment:trac_10801-root_repo.patch] to the Sage **root repository**.\n\nApply [attachment:trac_10801-local_bin_repo.patch] to the Sage **scripts repository**.\n\n\n\n\n**CC:**  @jasongrout @kcrisman\n\n**Keywords:** sd32\n\n**Author:** William Stein, Keshav Kini\n\n**Reviewer:** Benjamin Jones, Keshav Kini\n\n**Merged:** sage-4.7.2.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/10801\n\n",
    "closed_at": "2011-09-12T18:39:51Z",
    "created_at": "2011-02-19T00:57:23Z",
    "labels": [
        "component: packages: standard",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Create a new option: \"sage -strip\" which deletes things that aren't needed for a binary distribution of sage, or for people that will never develop or upgrade",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10801",
    "user": "https://github.com/williamstein"
}
```
This is a frequently requested feature.  We should start with some little script that does this, and build on it.  I tried all the following, and ran the test suite and it worked fine. 

- rm SAGE_ROOT/local/lib/*.a
- rm SAGE_ROOT/devel/sage/build/lib.*
- rm SAGE_ROOT/devel/sage/build/temp.*
- strip SAGE_ROOT/local/bin/Singular-* SAGE_ROOT/local/bin/gfan   # gfan is a huge win.
- jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...
- strip SAGE_ROOT/local/lib/*.so
- rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
- rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)

---

The patches below actually provide a new `make` target, "`micro_release`", rather than adding a new option to `sage`.

---

Apply [attachment:trac_10801-root_repo.patch] to the Sage **root repository**.

Apply [attachment:trac_10801-local_bin_repo.patch] to the Sage **scripts repository**.




**CC:**  @jasongrout @kcrisman

**Keywords:** sd32

**Author:** William Stein, Keshav Kini

**Reviewer:** Benjamin Jones, Keshav Kini

**Merged:** sage-4.7.2.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/10801





---

archive/issue_comments_132053.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt seems like the LiveCD folks have also worked on stuff like this...",
    "created_at": "2011-03-17T16:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132053",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
It seems like the LiveCD folks have also worked on stuff like this...



---

archive/issue_comments_132054.json:
```json
{
    "body": "<a id='comment:2'></a>\nIf we mount a sage source installation with mount option strictatime or relatime we can just touch all the files to have an access time in the deep past (with something like `cd $SAGE_ROOT ; for x in $(find) ; do touch -ad \"1981-02-03 04:05:06\" ; done`), then run the whole doctest suite, then use stat() to find files which were unused. This should give us a good idea of what is never used. Unfortunately this does not seem possible on sage.math - POSIX atime is not respected in my homedir, probably as it is mounted over NFS...",
    "created_at": "2011-03-22T00:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132054",
    "user": "https://github.com/kini"
}
```

<a id='comment:2'></a>
If we mount a sage source installation with mount option strictatime or relatime we can just touch all the files to have an access time in the deep past (with something like `cd $SAGE_ROOT ; for x in $(find) ; do touch -ad "1981-02-03 04:05:06" ; done`), then run the whole doctest suite, then use stat() to find files which were unused. This should give us a good idea of what is never used. Unfortunately this does not seem possible on sage.math - POSIX atime is not respected in my homedir, probably as it is mounted over NFS...



---

archive/issue_comments_132055.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,5 +7,5 @@\n - jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...\n - strip SAGE_ROOT/local/lib/*.so\n - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n-- rm all files in SAGE_LOCAL/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n+- rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n \n``````\n",
    "created_at": "2011-03-22T19:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132055",
    "user": "https://github.com/williamstein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,5 +7,5 @@
 - jsmath image fonts are in MoinMoin and are *HUGE*.  Just delete everything related to moinmoin...
 - strip SAGE_ROOT/local/lib/*.so
 - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
-- rm all files in SAGE_LOCAL/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
+- rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
 
``````




---

archive/issue_comments_132056.json:
```json
{
    "body": "<a id='comment:4'></a>\nif you're using linux, take a look at inotify-tools which has nice and clean command line tools, as it will give you a more fine-grained and realtime sense of what files are being used as they are accessed/modified to track down what's being used by which calls/tests/parts of sage.",
    "created_at": "2011-03-23T19:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132056",
    "user": "https://trac.sagemath.org/admin/accounts/users/pi"
}
```

<a id='comment:4'></a>
if you're using linux, take a look at inotify-tools which has nice and clean command line tools, as it will give you a more fine-grained and realtime sense of what files are being used as they are accessed/modified to track down what's being used by which calls/tests/parts of sage.



---

archive/issue_comments_132057.json:
```json
{
    "body": "<a id='comment:5'></a>\nWe can probably remove any Mercurial repositories.",
    "created_at": "2011-03-23T23:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132057",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
We can probably remove any Mercurial repositories.



---

archive/issue_comments_132058.json:
```json
{
    "body": "<a id='comment:7'></a>\n[Here](http://www1.spms.ntu.edu.sg/~krkini/temp/access_monitor.tar.bz2)'s some data I collected about what files are used and what files aren't, in sage 4.7.alpha3. Surprisingly many aren't, but come to think of it there's going to be a lot of stuff that users would want which isn't used by any doctest. I guess one should think of this data as a lower bound...",
    "created_at": "2011-03-25T00:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132058",
    "user": "https://github.com/kini"
}
```

<a id='comment:7'></a>
[Here](http://www1.spms.ntu.edu.sg/~krkini/temp/access_monitor.tar.bz2)'s some data I collected about what files are used and what files aren't, in sage 4.7.alpha3. Surprisingly many aren't, but come to think of it there's going to be a lot of stuff that users would want which isn't used by any doctest. I guess one should think of this data as a lower bound...



---

archive/issue_comments_132059.json:
```json
{
    "body": "<a id='comment:8'></a>\nWhy is it OK to delete SAGE_ROOT/local/bin/gfan?",
    "created_at": "2011-05-28T03:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132059",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:8'></a>
Why is it OK to delete SAGE_ROOT/local/bin/gfan?



---

archive/issue_comments_132060.json:
```json
{
    "body": "<a id='comment:9'></a>\nNot delete, but [strip](https://secure.wikimedia.org/wikipedia/en/wiki/Strip_(Unix)). This removes debug symbols.",
    "created_at": "2011-06-14T23:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132060",
    "user": "https://github.com/kini"
}
```

<a id='comment:9'></a>
Not delete, but [strip](https://secure.wikimedia.org/wikipedia/en/wiki/Strip_(Unix)). This removes debug symbols.



---

archive/issue_comments_132061.json:
```json
{
    "body": "<a id='comment:10'></a>\nSlightly related: `sage -crap ...` (`local/bin/sage-crap`)\n\nNote that we already have a few `*clean` targets in the top-level Makefile; there could be more (like `strip`), and some of the others could perhaps get improved or extended.\n\nI personally wouldn't use `-strip` for anything else than really stripping debug symbols, i.e., if it is e.g. intended to delete also static libraries (which may be needed if someone installs some package, not necessarily an spkg), I'd choose a different name for such an option (or `make` target).",
    "created_at": "2011-08-22T09:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132061",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
Slightly related: `sage -crap ...` (`local/bin/sage-crap`)

Note that we already have a few `*clean` targets in the top-level Makefile; there could be more (like `strip`), and some of the others could perhaps get improved or extended.

I personally wouldn't use `-strip` for anything else than really stripping debug symbols, i.e., if it is e.g. intended to delete also static libraries (which may be needed if someone installs some package, not necessarily an spkg), I'd choose a different name for such an option (or `make` target).



---

archive/issue_comments_132062.json:
```json
{
    "body": "<a id='comment:11'></a>\nAfter a long discussion, Keshav and I came up with:\n\n```\n   make micro_release\n```\nsince this is a lot like \"make release\" with other software....",
    "created_at": "2011-08-23T18:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132062",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:11'></a>
After a long discussion, Keshav and I came up with:

```
   make micro_release
```
since this is a lot like "make release" with other software....



---

archive/issue_comments_132063.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mhampton](#comment%3A8):\n> Why is it OK to delete SAGE_ROOT/local/bin/gfan?  \n\n\nI didn't suggest deleting gfan, but *stripping* it.",
    "created_at": "2011-08-23T18:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132063",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'></a>
Replying to [mhampton](#comment%3A8):
> Why is it OK to delete SAGE_ROOT/local/bin/gfan?  


I didn't suggest deleting gfan, but *stripping* it.



---

archive/attachments_014144.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10801-root_repo.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10801/trac_10801-root_repo.patch",
    "created_at": "2011-08-23T20:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_132064.json:
```json
{
    "body": "apply to the repo in $SAGE_ROOT",
    "created_at": "2011-08-23T20:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132064",
    "user": "https://github.com/williamstein"
}
```

apply to the repo in $SAGE_ROOT



---

archive/issue_comments_132065.json:
```json
{
    "body": "<a id='comment:13'></a>\nHere's how I'm testing this:\n\n```\nwstein@sage:/tmp/wstein/sage-4.7.2.alpha1-sage.math.washington.edu-x86_64-Linux$\n$ du -sh .\n2.4G    .\n$ du -s .\n2468404 .\n\n$ ./sage -hg import http://trac.sagemath.org/sage_trac/raw-attachment/ticket/10801/trac_10801-root_repo.patch\napplying http://trac.sagemath.org/sage_trac/raw-attachment/ticket/10801/trac_10801-root_repo.patch\n\n$ cd local/bin/; ../../sage -hg import http://trac.sagemath.org/sage_trac/raw-attachment/ticket/10801/trac_10801-local_bin_repo.patch\napplying http://trac.sagemath.org/sage_trac/raw-attachment/ticket/10801/trac_10801-local_bin_repo.patch\n\n$ time make micro_release\nreal    0m38.227s\nuser    0m2.370s\nsys     0m5.140s\n\n$ du -sh .\n1.5G    .\n$ du -s .\n1547480 .\n\n$ ./sage\n# see it works\n\n$ make ptestlong\n# observe what happens (I will report back in a follow comment about this).\n```",
    "created_at": "2011-08-23T20:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132065",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:13'></a>
Here's how I'm testing this:

```
wstein@sage:/tmp/wstein/sage-4.7.2.alpha1-sage.math.washington.edu-x86_64-Linux$
$ du -sh .
2.4G    .
$ du -s .
2468404 .

$ ./sage -hg import http://trac.sagemath.org/sage_trac/raw-attachment/ticket/10801/trac_10801-root_repo.patch
applying http://trac.sagemath.org/sage_trac/raw-attachment/ticket/10801/trac_10801-root_repo.patch

$ cd local/bin/; ../../sage -hg import http://trac.sagemath.org/sage_trac/raw-attachment/ticket/10801/trac_10801-local_bin_repo.patch
applying http://trac.sagemath.org/sage_trac/raw-attachment/ticket/10801/trac_10801-local_bin_repo.patch

$ time make micro_release
real    0m38.227s
user    0m2.370s
sys     0m5.140s

$ du -sh .
1.5G    .
$ du -s .
1547480 .

$ ./sage
# see it works

$ make ptestlong
# observe what happens (I will report back in a follow comment about this).
```



---

archive/issue_comments_132066.json:
```json
{
    "body": "<a id='comment:14'></a>\nptestlong passes.  W00t.",
    "created_at": "2011-08-23T21:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132066",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:14'></a>
ptestlong passes.  W00t.



---

archive/issue_comments_132067.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-08-23T21:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132067",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_132068.json:
```json
{
    "body": "<a id='comment:15'></a>\nSome thoughts:\n\n* In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep \"not stripped\" &> /dev/null`, I think.\n* The *`_with_condition()` functions should not talk about extensions in their docstrings.\n* What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)\n\nGoing a bit farther, considering the target users will never develop or upgrade,\n\n* Should we delete mercurial repos?\n* Should we delete SPKGs?",
    "created_at": "2011-08-24T04:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132068",
    "user": "https://github.com/kini"
}
```

<a id='comment:15'></a>
Some thoughts:

* In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep "not stripped" &> /dev/null`, I think.
* The *`_with_condition()` functions should not talk about extensions in their docstrings.
* What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)

Going a bit farther, considering the target users will never develop or upgrade,

* Should we delete mercurial repos?
* Should we delete SPKGs?



---

archive/issue_comments_132069.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [kini](#comment%3A15):\n> Some thoughts:\n> \n> * In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep \"not stripped\" &> /dev/null`, I think.\n\n\nLATER: This could be added, but can we do it later in a future ticket.  It would be good if the first version of this patch is quite safe.  Hey, it already saves *1 GB* as is!\n\n>  * The *`_with_condition()` functions should not talk about extensions in their docstrings.\n\n\nOK: I'll fix the patch right now. \n\n>  * What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)\n \n> \n\nNO:  Pointless, and scary in that it would break functionality, which is probably a bad idea.  Good point about the size.  I must have been testing something with some optional fonts installed. \n\n> Going a bit farther, considering the target users will never develop or upgrade,\n> \n> * Should we delete mercurial repos?\n\n\nFUTURE: Yes, but in a future version of this?\n\n>  * Should we delete SPKGs?\n\n\nFUTURE: It's safer to put a small string in each, to avoid confusion.  This happens automatically when you build a binary with \"sage -bdist\".   Anyway, this is something that could be added later.",
    "created_at": "2011-08-24T05:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132069",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:16'></a>
Replying to [kini](#comment%3A15):
> Some thoughts:
> 
> * In `strip_binaries()`, why not strip all executables? One can find them by checking exit status of `find . -perm /111 | grep "not stripped" &> /dev/null`, I think.


LATER: This could be added, but can we do it later in a future ticket.  It would be good if the first version of this patch is quite safe.  Hey, it already saves *1 GB* as is!

>  * The *`_with_condition()` functions should not talk about extensions in their docstrings.


OK: I'll fix the patch right now. 

>  * What about getting rid of MoinMoin? (fake edit: never mind, the ticket description is wrong or out of date - it's under 20 MB)
 
> 

NO:  Pointless, and scary in that it would break functionality, which is probably a bad idea.  Good point about the size.  I must have been testing something with some optional fonts installed. 

> Going a bit farther, considering the target users will never develop or upgrade,
> 
> * Should we delete mercurial repos?


FUTURE: Yes, but in a future version of this?

>  * Should we delete SPKGs?


FUTURE: It's safer to put a small string in each, to avoid confusion.  This happens automatically when you build a binary with "sage -bdist".   Anyway, this is something that could be added later.



---

archive/issue_comments_132070.json:
```json
{
    "body": "**Reviewer:** Benjamin Jones",
    "created_at": "2011-08-24T19:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132070",
    "user": "https://github.com/benjaminfjones"
}
```

**Reviewer:** Benjamin Jones



---

archive/issue_comments_132071.json:
```json
{
    "body": "<a id='comment:17'></a>\nTested the patches on sage.math and fresh build of Sage-4.7.1:\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ pwd\n/scratch/bjones/sage-4.7.1\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh\n2.5G\t.\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -s\n2554916\t.\n```\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ time make micro_release\n...\nreal\t0m12.064s\nuser\t0m2.560s\nsys\t0m7.600s\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh\n2.0G\t.\nbjones@sage:/scratch/bjones/sage-4.7.1$ du . -s\n2033236\t.\n```\n\nSo it saved 0.5 GB which is not the 1.0 GB observed by William above. Did you remove stuff by hand in that session that the script doesn't touch? Or maybe because I built the install from source instead of using a binary distribution? \n\nI'm running `make ptestlong` now, will report back if anything fails.",
    "created_at": "2011-08-24T19:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132071",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:17'></a>
Tested the patches on sage.math and fresh build of Sage-4.7.1:

```
bjones@sage:/scratch/bjones/sage-4.7.1$ pwd
/scratch/bjones/sage-4.7.1
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh
2.5G	.
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -s
2554916	.
```

```
bjones@sage:/scratch/bjones/sage-4.7.1$ time make micro_release
...
real	0m12.064s
user	0m2.560s
sys	0m7.600s
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -sh
2.0G	.
bjones@sage:/scratch/bjones/sage-4.7.1$ du . -s
2033236	.
```

So it saved 0.5 GB which is not the 1.0 GB observed by William above. Did you remove stuff by hand in that session that the script doesn't touch? Or maybe because I built the install from source instead of using a binary distribution? 

I'm running `make ptestlong` now, will report back if anything fails.



---

archive/issue_comments_132072.json:
```json
{
    "body": "<a id='comment:18'></a>\nAfter producing the micro release, `make ptestlong` had one failure which disappeared when I doctested by hand:\n\n```\nThe following tests failed:\n\n        sage -t  -long -force_lib devel/sage/sage/tests/startup.py # 1 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1468.7 seconds\nmake: *** [ptestlong] Error 128\n```\nSubsequently by hand:\n\n```\nbjones@sage:/scratch/bjones/sage-4.7.1$ sage -t  -long -force_lib devel/sage/sage/tests/startup.py\nsage -t -long -force_lib \"devel/sage/sage/tests/startup.py\" \n         [12.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 12.1 seconds\n```",
    "created_at": "2011-08-24T19:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132072",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:18'></a>
After producing the micro release, `make ptestlong` had one failure which disappeared when I doctested by hand:

```
The following tests failed:

        sage -t  -long -force_lib devel/sage/sage/tests/startup.py # 1 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1468.7 seconds
make: *** [ptestlong] Error 128
```
Subsequently by hand:

```
bjones@sage:/scratch/bjones/sage-4.7.1$ sage -t  -long -force_lib devel/sage/sage/tests/startup.py
sage -t -long -force_lib "devel/sage/sage/tests/startup.py" 
         [12.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 12.1 seconds
```



---

archive/issue_comments_132073.json:
```json
{
    "body": "<a id='comment:19'></a>\nBen:\n\n1. Regarding the size savings, I started with a binary... so we may see a difference.\n\n2. Regarding the startup time failure, this has nothing to do with my patch.  It routinely fails on sage.math.  It's a test that it isn't taking more than 2 seconds on sage.math.  I put it in back when we got the startup time down to solidly be < 1 second on sage.math, since I didn't want people to screw that up.  They did though.",
    "created_at": "2011-08-24T21:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132073",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:19'></a>
Ben:

1. Regarding the size savings, I started with a binary... so we may see a difference.

2. Regarding the startup time failure, this has nothing to do with my patch.  It routinely fails on sage.math.  It's a test that it isn't taking more than 2 seconds on sage.math.  I put it in back when we got the startup time down to solidly be < 1 second on sage.math, since I didn't want people to screw that up.  They did though.



---

archive/issue_comments_132074.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd32\".",
    "created_at": "2011-08-24T23:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132074",
    "user": "https://github.com/williamstein"
}
```

**Changing keywords** from "" to "sd32".



---

archive/issue_comments_132075.json:
```json
{
    "body": "**Changing reviewer** from \"Benjamin Jones\" to \"Benjamin Jones, Keshav Kini\".",
    "created_at": "2011-08-25T00:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132075",
    "user": "https://github.com/kini"
}
```

**Changing reviewer** from "Benjamin Jones" to "Benjamin Jones, Keshav Kini".



---

archive/issue_comments_132076.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-08-25T00:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132076",
    "user": "https://github.com/kini"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_132077.json:
```json
{
    "body": "<a id='comment:21'></a>\nWilliam: OK, sounds good. I'll make a ticket. Sounds like we're good to go here, no? Positive review from me.",
    "created_at": "2011-08-25T00:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132077",
    "user": "https://github.com/kini"
}
```

<a id='comment:21'></a>
William: OK, sounds good. I'll make a ticket. Sounds like we're good to go here, no? Positive review from me.



---

archive/issue_comments_132078.json:
```json
{
    "body": "<a id='comment:22'></a>\nOK, I checked on OSX 10.6.8 binary install and I get results simular to William's. Looks good here too. Positive review from me as well.",
    "created_at": "2011-08-25T00:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132078",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:22'></a>
OK, I checked on OSX 10.6.8 binary install and I get results simular to William's. Looks good here too. Positive review from me as well.



---

archive/issue_comments_132079.json:
```json
{
    "body": "<a id='comment:23'></a>\nNew ticket is #11743.",
    "created_at": "2011-08-25T02:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132079",
    "user": "https://github.com/kini"
}
```

<a id='comment:23'></a>
New ticket is #11743.



---

archive/issue_comments_132080.json:
```json
{
    "body": "<a id='comment:24'></a>\nMartin Albrecht pointed out that deleting .a files could make it so users can't compile certain Cython programs, maybe.   I'm not sure if we should care though, given the goal of this ticket ('never develop or upgrade').",
    "created_at": "2011-08-25T05:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132080",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:24'></a>
Martin Albrecht pointed out that deleting .a files could make it so users can't compile certain Cython programs, maybe.   I'm not sure if we should care though, given the goal of this ticket ('never develop or upgrade').



---

archive/issue_comments_132081.json:
```json
{
    "body": "<a id='comment:25'></a>\nHm. If that includes `%cython` cells, I don't think that counts as \"developing\".",
    "created_at": "2011-08-25T05:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132081",
    "user": "https://github.com/kini"
}
```

<a id='comment:25'></a>
Hm. If that includes `%cython` cells, I don't think that counts as "developing".



---

archive/issue_comments_132082.json:
```json
{
    "body": "<a id='comment:26'></a>\nYes, I'm concerned.  I'll simply comment out the line that deletes the .a files, and repost the patch.",
    "created_at": "2011-08-25T05:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132082",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:26'></a>
Yes, I'm concerned.  I'll simply comment out the line that deletes the .a files, and repost the patch.



---

archive/issue_comments_132083.json:
```json
{
    "body": "replacing the patch by one that doesn't delete .a files.",
    "created_at": "2011-08-25T05:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132083",
    "user": "https://github.com/williamstein"
}
```

replacing the patch by one that doesn't delete .a files.



---

archive/attachments_014145.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10801-local_bin_repo.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10801/trac_10801-local_bin_repo.patch",
    "created_at": "2011-08-25T05:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kini"
}
```



---

archive/issue_comments_132084.json:
```json
{
    "body": "<a id='comment:27'></a>\nFair enough. Sadly this reduces our space savings by more than 200 MB.\n\n(I'm putting myself as an author on this ticket because I seem to be listed as one the patch...)",
    "created_at": "2011-08-25T05:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132084",
    "user": "https://github.com/kini"
}
```

<a id='comment:27'></a>
Fair enough. Sadly this reduces our space savings by more than 200 MB.

(I'm putting myself as an author on this ticket because I seem to be listed as one the patch...)



---

archive/issue_comments_132085.json:
```json
{
    "body": "**Author:** William Stein, Keshav Kini",
    "created_at": "2011-08-25T05:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132085",
    "user": "https://github.com/kini"
}
```

**Author:** William Stein, Keshav Kini



---

archive/issue_comments_132086.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,3 +9,15 @@\n - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin \n - rm all files in SAGE_ROOT/devel/sage/sage/ that begin \"* Generated by Cython\"  (I didn't do that)\n \n+---\n+\n+The patches below actually provide a new `make` target, \"`micro_release`\", rather than adding a new option to `sage`.\n+\n+---\n+\n+Apply [attachment:trac_10801-root_repo.patch] to the Sage **root repository**.\n+\n+Apply [attachment:trac_10801-local_bin_repo.patch] to the Sage **scripts repository**.\n+\n+\n+\n``````\n",
    "created_at": "2011-09-09T00:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132086",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,3 +9,15 @@
 - rm -rf SAGE_ROOT/local/python/site-package/MoinMoin 
 - rm all files in SAGE_ROOT/devel/sage/sage/ that begin "* Generated by Cython"  (I didn't do that)
 
+---
+
+The patches below actually provide a new `make` target, "`micro_release`", rather than adding a new option to `sage`.
+
+---
+
+Apply [attachment:trac_10801-root_repo.patch] to the Sage **root repository**.
+
+Apply [attachment:trac_10801-local_bin_repo.patch] to the Sage **scripts repository**.
+
+
+
``````




---

archive/issue_events_033523.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T18:39:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10801#event-33523"
}
```



---

archive/issue_comments_132087.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha3",
    "created_at": "2011-09-12T18:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10801#issuecomment-132087",
    "user": "https://github.com/nexttime"
}
```

**Merged:** sage-4.7.2.alpha3
