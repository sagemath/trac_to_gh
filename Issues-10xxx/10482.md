# Issue 10482: Add Weisfeiler-Lehman algorithm to sage.graphs

archive/issues_010429.json:
```json
{
    "assignees": [],
    "body": "---\nSee [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).\n\nAdding an implementation of the Weisfeiler-Lehman algorithm for partition / graph refinement.\n\nApply \n\n *[attachment: trac_10482-wlrefine_rebased.patch](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine_rebased.patch.gz)\n\n\nAssignee: **@kini**\n\nKeywords: **weisfeiler-lehman algorithm, graphs, coherent configurations, refinement**\n\nWork Issues: **fix the bug with wl-bug example**\n\nAuthor: **Keshav Kini**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10482_\n\n",
    "closed_at": "2019-02-26T13:58:00Z",
    "created_at": "2010-12-16T11:40:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add Weisfeiler-Lehman algorithm to sage.graphs",
    "type": "issue",
    "updated_at": "2019-02-26T13:58:00Z",
    "url": "https://github.com/sagemath/sage/issues/10482",
    "user": "https://github.com/kini"
}
```
---
See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).

Adding an implementation of the Weisfeiler-Lehman algorithm for partition / graph refinement.

Apply 

 *[attachment: trac_10482-wlrefine_rebased.patch](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine_rebased.patch.gz)


Assignee: **@kini**

Keywords: **weisfeiler-lehman algorithm, graphs, coherent configurations, refinement**

Work Issues: **fix the bug with wl-bug example**

Author: **Keshav Kini**

_Issue created by migration from https://trac.sagemath.org/ticket/10482_





---

archive/issue_events_125443.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2010-12-16T11:40:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125443"
}
```



---

archive/issue_events_125444.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2010-12-16T11:40:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125444"
}
```



---

archive/issue_events_125445.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2010-12-16T11:40:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125445"
}
```



---

archive/issue_comments_100411.json:
```json
{
    "body": "Attachment: **[trac_10482-wlrefine.gz](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine.gz)**\n\npatch to be applied to sage-main repository",
    "created_at": "2010-12-16T11:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100411",
    "user": "https://github.com/kini"
}
```

Attachment: **[trac_10482-wlrefine.gz](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine.gz)**

patch to be applied to sage-main repository



---

archive/issue_comments_100412.json:
```json
{
    "body": "Sorry, here it is with a \".patch\" extension. To be applied to sage-main.",
    "created_at": "2010-12-16T11:48:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100412",
    "user": "https://github.com/kini"
}
```

Sorry, here it is with a ".patch" extension. To be applied to sage-main.



---

archive/issue_comments_100413.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nAttachment: **[trac_10482-wlrefine.patch.gz](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine.patch.gz)**\n\nthis  all works OK (on sage 4.6.1.alpha3);\nwhat I do not know is whether GraphWL should be installed as a method for graphs.\n\nDima",
    "created_at": "2010-12-16T12:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100413",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">Comment 1</div>

Attachment: **[trac_10482-wlrefine.patch.gz](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine.patch.gz)**

this  all works OK (on sage 4.6.1.alpha3);
what I do not know is whether GraphWL should be installed as a method for graphs.

Dima



---

archive/issue_comments_100414.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+\n+---\n See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).\n \n Adding an implementation of the Weisfeiler-Leman algorithm for partition / graph refinement.\n``````\n",
    "created_at": "2010-12-16T12:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100414",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
+
+---
 See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).
 
 Adding an implementation of the Weisfeiler-Leman algorithm for partition / graph refinement.
``````




---

archive/issue_events_125446.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2010-12-16T12:40:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125446"
}
```



---

archive/issue_comments_100415.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,3 @@\n-\n ---\n See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).\n \n``````\n",
    "created_at": "2010-12-16T12:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100415",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,3 @@
-
 ---
 See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).
 
``````




---

archive/issue_comments_100416.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nSorry, didn't realize I should have marked this as \"needs review\".\n\nBy the way, something I wasn't able to figure out - why (with this patch applied) does `sage.graphs.wlrefine.sage` alias to `sage` (the top-level module)? Why does `sage.graphs.wlrefine.sage` even appear in the first place?",
    "created_at": "2010-12-23T10:14:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100416",
    "user": "https://github.com/kini"
}
```

<div id="comment:3" align="right">Comment 3</div>

Sorry, didn't realize I should have marked this as "needs review".

By the way, something I wasn't able to figure out - why (with this patch applied) does `sage.graphs.wlrefine.sage` alias to `sage` (the top-level module)? Why does `sage.graphs.wlrefine.sage` even appear in the first place?



---

archive/issue_comments_100417.json:
```json
{
    "body": "Author: **Keshav Kini**",
    "created_at": "2010-12-23T10:14:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100417",
    "user": "https://github.com/kini"
}
```

Author: **Keshav Kini**



---

archive/issue_events_125447.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2010-12-23T10:14:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125447"
}
```



---

archive/issue_events_125448.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2011-02-02T06:03:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125448"
}
```



---

archive/issue_events_125449.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2011-02-02T06:03:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125449"
}
```



---

archive/issue_comments_100418.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nCan we have a mildly interesting example in the doctest, i.e. refining which does not produce an orbital-induced refinement?\nThe smallest non-directed example like this is the [Shrikhande strongly regular graph](http://en.wikipedia.org/wiki/Shrikhande_graph) on 16 vertices; a the smallest directed example a certain tournament on 15 vertices.\n\nShrikhande graph is mentioned on #9136.\nMaybe you can contribute its Sage implementation along the way!",
    "created_at": "2011-02-02T06:03:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100418",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">Comment 4</div>

Can we have a mildly interesting example in the doctest, i.e. refining which does not produce an orbital-induced refinement?
The smallest non-directed example like this is the [Shrikhande strongly regular graph](http://en.wikipedia.org/wiki/Shrikhande_graph) on 16 vertices; a the smallest directed example a certain tournament on 15 vertices.

Shrikhande graph is mentioned on #9136.
Maybe you can contribute its Sage implementation along the way!



---

archive/issue_comments_100419.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\njust a reminder that this must be fixed soon...",
    "created_at": "2011-05-18T21:32:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100419",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">Comment 5</div>

just a reminder that this must be fixed soon...



---

archive/issue_comments_100420.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nSorry about that - I was planning to rebase on 4.7 after it comes out (as this is clearly not getting into Sage by then). Is that OK? If not I'll rebase on 4.7.rc2 (there have been some changes to the patch since I created this ticket).",
    "created_at": "2011-05-19T07:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100420",
    "user": "https://github.com/kini"
}
```

<div id="comment:6" align="right">Comment 6</div>

Sorry about that - I was planning to rebase on 4.7 after it comes out (as this is clearly not getting into Sage by then). Is that OK? If not I'll rebase on 4.7.rc2 (there have been some changes to the patch since I created this ticket).



---

archive/issue_comments_100421.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@kini](#comment%3A6):\n> Sorry about that - I was planning to rebase on 4.7 after it comes out (as this is clearly not getting into Sage by then). Is that OK? If not I'll rebase on 4.7.rc2 (there have been some changes to the patch since I created this ticket).\n\nit works on 4.7.rc1, I didn't check rc2.",
    "created_at": "2011-05-19T08:54:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100421",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@kini](#comment%3A6):
> Sorry about that - I was planning to rebase on 4.7 after it comes out (as this is clearly not getting into Sage by then). Is that OK? If not I'll rebase on 4.7.rc2 (there have been some changes to the patch since I created this ticket).

it works on 4.7.rc1, I didn't check rc2.



---

archive/issue_comments_100422.json:
```json
{
    "body": "Attachment: **[wl-bug.gz](https://github.com/sagemath/sage/files/ticket10482/wl-bug.gz)**\n\n64x64 matrix with automorphisms (16 of them), which WL does not see - returns all the 64^2 colours",
    "created_at": "2011-05-25T11:33:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100422",
    "user": "https://github.com/dimpase"
}
```

Attachment: **[wl-bug.gz](https://github.com/sagemath/sage/files/ticket10482/wl-bug.gz)**

64x64 matrix with automorphisms (16 of them), which WL does not see - returns all the 64^2 colours



---

archive/issue_comments_100423.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI attached an example of 64x64 matrix with nontrivial automorphisms, which WL does not see, and colours every matrix entry in its own colour.",
    "created_at": "2011-05-25T11:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100423",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">Comment 8</div>

I attached an example of 64x64 matrix with nontrivial automorphisms, which WL does not see, and colours every matrix entry in its own colour.



---

archive/issue_comments_100424.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nan optimal canonical labellling algorithm is described here: http://www.automata.rwth-aachen.de/~grohe/pub/berbongro13.pdf\nIt runs in O((n+m)log n) time, with n, resp. m, being #of vertices (resp. edges). (that's not the problem on this ticket though, it's a coarser classification of vertices)",
    "created_at": "2013-08-08T20:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100424",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">Comment 9</div>

an optimal canonical labellling algorithm is described here: http://www.automata.rwth-aachen.de/~grohe/pub/berbongro13.pdf
It runs in O((n+m)log n) time, with n, resp. m, being #of vertices (resp. edges). (that's not the problem on this ticket though, it's a coarser classification of vertices)



---

archive/issue_events_125450.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125450"
}
```



---

archive/issue_events_125451.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125451"
}
```



---

archive/issue_comments_100425.json:
```json
{
    "body": "rebased for Sage 5.12 (the bug not fixed...)",
    "created_at": "2013-10-13T22:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100425",
    "user": "https://github.com/dimpase"
}
```

rebased for Sage 5.12 (the bug not fixed...)



---

archive/issue_comments_100426.json:
```json
{
    "body": "Work Issues: **fix the bug with wl-bug example**",
    "created_at": "2013-10-13T22:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100426",
    "user": "https://github.com/dimpase"
}
```

Work Issues: **fix the bug with wl-bug example**



---

archive/issue_comments_100427.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nAttachment: **[trac_10482-wlrefine_rebased.patch.gz](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine_rebased.patch.gz)**",
    "created_at": "2013-10-13T22:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100427",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">Comment 11</div>

Attachment: **[trac_10482-wlrefine_rebased.patch.gz](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine_rebased.patch.gz)**



---

archive/issue_comments_100428.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,3 +2,8 @@\n See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).\n \n Adding an implementation of the Weisfeiler-Leman algorithm for partition / graph refinement.\n+\n+Apply \n+\n+ *[attachment: trac_10482-wlrefine_rebased.patch](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine_rebased.patch.gz)\n+\n``````\n",
    "created_at": "2013-10-13T22:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100428",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,3 +2,8 @@
 See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).
 
 Adding an implementation of the Weisfeiler-Leman algorithm for partition / graph refinement.
+
+Apply 
+
+ *[attachment: trac_10482-wlrefine_rebased.patch](https://github.com/sagemath/sage/files/ticket10482/trac_10482-wlrefine_rebased.patch.gz)
+
``````




---

archive/issue_comments_100429.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI'm not sure what to do with this now. As I recall, I did try stepping carefully through the code back in 2011, and it was doing what I expected it to do, and as far as I could tell it also matched what's written in the paper I based the code on. Yet the answer is wrong for the `wl-bug` case.\n\nSo either the code doesn't do what I thought it did after all (certainly possible), or I misread the paper or other resources in some subtle way, or the algorithm in the paper is wrong in some subtle way (I wrote `STABIL.c` more or less completely based on the description of the algorithm in the paper and not on the original code, which *does* work on `wl-bug`). I'm not sure which of these is the case, and now I don't any longer remember the code I wrote or the contents of the paper well enough to try to find out which of these is the case.\n\nPerhaps at this point the better solution is to just use the old code (which is what you originally suggested in 2010). My code was supposed to allow for a wider variety of input and more memory usage than made sense back in the 80s, but all of that is worthless if the output is not correct... :(",
    "created_at": "2013-10-14T00:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100429",
    "user": "https://github.com/kini"
}
```

<div id="comment:12" align="right">Comment 12</div>

I'm not sure what to do with this now. As I recall, I did try stepping carefully through the code back in 2011, and it was doing what I expected it to do, and as far as I could tell it also matched what's written in the paper I based the code on. Yet the answer is wrong for the `wl-bug` case.

So either the code doesn't do what I thought it did after all (certainly possible), or I misread the paper or other resources in some subtle way, or the algorithm in the paper is wrong in some subtle way (I wrote `STABIL.c` more or less completely based on the description of the algorithm in the paper and not on the original code, which *does* work on `wl-bug`). I'm not sure which of these is the case, and now I don't any longer remember the code I wrote or the contents of the paper well enough to try to find out which of these is the case.

Perhaps at this point the better solution is to just use the old code (which is what you originally suggested in 2010). My code was supposed to allow for a wider variety of input and more memory usage than made sense back in the 80s, but all of that is worthless if the output is not correct... :(



---

archive/issue_comments_100430.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@kini](#comment%3A12):\n> I'm not sure what to do with this now. As I recall, I did try stepping carefully through the code back in 2011, and it was doing what I expected it to do, and as far as I could tell it also matched what's written in the paper I based the code on. Yet the answer is wrong for the `wl-bug` case.\n\nThe strategy for debugging is obvious: what happens, mathematically, is that a basis of 0-1 matrices for a matrix algebra is built incrementally. One just has to trace this carefully: at some point instead of creating a minimal 0-1 basis, the procedure breaks.\nThis might need a bit of extra code, allowing outputting the current basis in some \"dumb\" machine-readable form at any iteration. Then you can compare what happens in the implementation (it computes the product A_i A_j of two (presumed-)basis elements {A_k}, each of them represented as a linked list, and tries to decompose it into a Z-linear combination of the A_k's. When it fails, this means that it has to locate an A_k that needs to be spit into a number of 0-1 matrices, do this splitting, etc).",
    "created_at": "2013-10-14T07:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100430",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@kini](#comment%3A12):
> I'm not sure what to do with this now. As I recall, I did try stepping carefully through the code back in 2011, and it was doing what I expected it to do, and as far as I could tell it also matched what's written in the paper I based the code on. Yet the answer is wrong for the `wl-bug` case.

The strategy for debugging is obvious: what happens, mathematically, is that a basis of 0-1 matrices for a matrix algebra is built incrementally. One just has to trace this carefully: at some point instead of creating a minimal 0-1 basis, the procedure breaks.
This might need a bit of extra code, allowing outputting the current basis in some "dumb" machine-readable form at any iteration. Then you can compare what happens in the implementation (it computes the product A_i A_j of two (presumed-)basis elements {A_k}, each of them represented as a linked list, and tries to decompose it into a Z-linear combination of the A_k's. When it fails, this means that it has to locate an A_k that needs to be spit into a number of 0-1 matrices, do this splitting, etc).



---

archive/issue_comments_100431.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nBy the way, what about `STABIL-tests.h`, mentioned in `STABIL.c`? Is it available anywhere?",
    "created_at": "2013-10-14T21:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100431",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">Comment 14</div>

By the way, what about `STABIL-tests.h`, mentioned in `STABIL.c`? Is it available anywhere?



---

archive/issue_comments_100432.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nThere was at one point a repository containing this code and the original files from stabprogs.tgz. I think it was on www1.spms.ntu.edu.sg, but my directory there has been cleaned out by now... I found an old clone of it on banana just now, though. I put it up at http://github.com/kini/stabprogs and gave you access to it. I added a testing script, and formatted the wl-bug adjacency matrix like the other input files and added that too. `STABIL-tests.h` is there as well and as you can see, it does something like what you described in comment 13. Well, not that machine-readable, I suppose...",
    "created_at": "2013-10-14T22:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100432",
    "user": "https://github.com/kini"
}
```

<div id="comment:15" align="right">Comment 15</div>

There was at one point a repository containing this code and the original files from stabprogs.tgz. I think it was on www1.spms.ntu.edu.sg, but my directory there has been cleaned out by now... I found an old clone of it on banana just now, though. I put it up at http://github.com/kini/stabprogs and gave you access to it. I added a testing script, and formatted the wl-bug adjacency matrix like the other input files and added that too. `STABIL-tests.h` is there as well and as you can see, it does something like what you described in comment 13. Well, not that machine-readable, I suppose...



---

archive/issue_events_125452.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125452"
}
```



---

archive/issue_events_125453.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125453"
}
```



---

archive/issue_events_125454.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125454"
}
```



---

archive/issue_events_125455.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125455"
}
```



---

archive/issue_events_125456.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125456"
}
```



---

archive/issue_events_125457.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125457"
}
```



---

archive/issue_comments_100433.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n ---\n See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).\n \n-Adding an implementation of the Weisfeiler-Leman algorithm for partition / graph refinement.\n+Adding an implementation of the Weisfeiler-Lehman algorithm for partition / graph refinement.\n \n Apply \n \n``````\n",
    "created_at": "2018-12-17T20:59:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100433",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 ---
 See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/aae6ee93b11715c8).
 
-Adding an implementation of the Weisfeiler-Leman algorithm for partition / graph refinement.
+Adding an implementation of the Weisfeiler-Lehman algorithm for partition / graph refinement.
 
 Apply 
 
``````




---

archive/issue_events_125458.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-12-17T20:59:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "title_is": "Add Weisfeiler-Lehman algorithm to sage.graphs",
    "title_was": "Add Weisfeiler-Leman algorithm to sage.graphs",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125458"
}
```



---

archive/issue_comments_100434.json:
```json
{
    "body": "Changed keywords from **weisfeiler-leman algorithm, graphs, coherent configurations, refinement** to **weisfeiler-lehman algorithm, graphs, coherent configurations, refinement**",
    "created_at": "2018-12-17T20:59:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100434",
    "user": "https://github.com/fchapoton"
}
```

Changed keywords from **weisfeiler-leman algorithm, graphs, coherent configurations, refinement** to **weisfeiler-lehman algorithm, graphs, coherent configurations, refinement**



---

archive/issue_comments_100435.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nThe bug is not going to be fixed by the author. This is superseded by #25802, with a much better implementation.",
    "created_at": "2018-12-18T16:30:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100435",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">Comment 20</div>

The bug is not going to be fixed by the author. This is superseded by #25802, with a much better implementation.



---

archive/issue_events_125459.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-12-18T16:30:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125459"
}
```



---

archive/issue_events_125460.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-12-18T16:30:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125460"
}
```



---

archive/issue_events_125461.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-12-18T16:30:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125461"
}
```



---

archive/issue_events_125462.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-12-18T16:30:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125462"
}
```



---

archive/issue_events_125463.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-12-18T16:30:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125463"
}
```



---

archive/issue_comments_100436.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nPresuming these are all correctly reviewed as either duplicate, invalid, or wontfix.",
    "created_at": "2019-02-26T13:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10482#issuecomment-100436",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">Comment 21</div>

Presuming these are all correctly reviewed as either duplicate, invalid, or wontfix.



---

archive/issue_events_125464.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-26T13:58:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125464"
}
```



---

archive/issue_events_125465.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-26T13:58:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10482",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10482#event-125465"
}
```
