# Issue 10836: primitive root is broken

archive/issues_010770.json:
```json
{
    "body": "Assignee: @williamstein\n\nCC:  @williamstein @adeines\n\nPari has a major bug in its primitive root:\n\n```\nsage: primitive_root(15) \n2 \nsage: mod(2,15).multiplicative_order() \n4 \nsage: euler_phi(15) \n8 \nsage: [mod(2,15)^i for i in [1..8]] \n[2, 4, 8, 1, 2, 4, 8, 1] \nsage: b = pari(15) \nsage: b.znprimroot() \nMod(2, 15)\n```\nNote that this DOES work correctly with whatever Pari is in Sage 4.4.4.\n\n```\n--------------------------------------------------------------------- \n---------------------------------------------------------------------- \nLoading Sage library. Current Mercurial branch is: hackbranch \nsage: primitive_root(15) \n<snip> \nArithmeticError: There is no primitive root modulo n \n```\n| Sage Version 4.4.4, Release Date: 2010-06-23                       | \n| Type notebook() for the GUI, and license() for information.        | \n---\nApply [attachment:trac_10836.2.patch] and [attachment:10836_additional.patch].\n\nIssue created by migration from https://trac.sagemath.org/ticket/10836\n\n",
    "closed_at": "2011-04-05T12:00:26Z",
    "created_at": "2011-02-23T21:13:31Z",
    "labels": [
        "component: number theory",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "primitive root is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10836",
    "user": "https://github.com/kcrisman"
}
```
Assignee: @williamstein

CC:  @williamstein @adeines

Pari has a major bug in its primitive root:

```
sage: primitive_root(15) 
2 
sage: mod(2,15).multiplicative_order() 
4 
sage: euler_phi(15) 
8 
sage: [mod(2,15)^i for i in [1..8]] 
[2, 4, 8, 1, 2, 4, 8, 1] 
sage: b = pari(15) 
sage: b.znprimroot() 
Mod(2, 15)
```
Note that this DOES work correctly with whatever Pari is in Sage 4.4.4.

```
--------------------------------------------------------------------- 
---------------------------------------------------------------------- 
Loading Sage library. Current Mercurial branch is: hackbranch 
sage: primitive_root(15) 
<snip> 
ArithmeticError: There is no primitive root modulo n 
```
| Sage Version 4.4.4, Release Date: 2010-06-23                       | 
| Type notebook() for the GUI, and license() for information.        | 
---
Apply [attachment:trac_10836.2.patch] and [attachment:10836_additional.patch].

Issue created by migration from https://trac.sagemath.org/ticket/10836





---

archive/issue_comments_113746.json:
```json
{
    "body": "From one of the Pari developers:\n\n```\n\nPlease read the documentation of znprimroot in PARI 2.4.3:\n\n? ??znprimroot\nznprimroot(n):\n\n  returns a primitive root (generator) of (Z/nZ)^*, whenever this latter group is cyclic (n = 4\nor n = 2p^k or n = p^k,  where p is an odd prime and k >= 0).   If the group is not cyclic,  the\nresult  is undefined.   If n is a prime,  then the smallest positive primitive root is returned.\nThis is no longer true for composites.\n\n(Z/15Z)* is not cyclic so znprimroot(15) is undefined.\n```",
    "created_at": "2011-02-25T17:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113746",
    "user": "https://github.com/kcrisman"
}
```

From one of the Pari developers:

```

Please read the documentation of znprimroot in PARI 2.4.3:

? ??znprimroot
znprimroot(n):

  returns a primitive root (generator) of (Z/nZ)^*, whenever this latter group is cyclic (n = 4
or n = 2p^k or n = p^k,  where p is an odd prime and k >= 0).   If the group is not cyclic,  the
result  is undefined.   If n is a prime,  then the smallest positive primitive root is returned.
This is no longer true for composites.

(Z/15Z)* is not cyclic so znprimroot(15) is undefined.
```



---

archive/issue_comments_113747.json:
```json
{
    "body": "Ergo, we will have to catch such cases in an effort to remain mathematically correct.",
    "created_at": "2011-02-25T17:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113747",
    "user": "https://github.com/kcrisman"
}
```

Ergo, we will have to catch such cases in an effort to remain mathematically correct.



---

archive/issue_comments_113748.json:
```json
{
    "body": "Pretty easy to fix but there are some choices regarding speed and whether we now believe in pari's ispower function.\n\n```\ntrying: 2\ncall Integers(n).multiplicative_generator()            : 625 loops, best of 3: 3.97 \u00b5s per loop\npari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 16.1 \u00b5s per loop\npari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 9.53 \u00b5s per loop\npari without check:                                    : 625 loops, best of 3: 8.74 \u00b5s per loop\npari trusting that pari.ispower now works              : 625 loops, best of 3: 9.39 \u00b5s per loop\nI.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 29.3 \u00b5s per loop\ntrying: 97\ncall Integers(n).multiplicative_generator()            : 625 loops, best of 3: 3.93 \u00b5s per loop\npari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 33 \u00b5s per loop\npari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 27.3 \u00b5s per loop\npari without check:                                    : 625 loops, best of 3: 10.8 \u00b5s per loop\npari trusting that pari.ispower now works              : 625 loops, best of 3: 19.8 \u00b5s per loop\nI.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 29.4 \u00b5s per loop\ntrying: 10007\ncall Integers(n).multiplicative_generator()            : 625 loops, best of 3: 3.93 \u00b5s per loop\npari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 34.1 \u00b5s per loop\npari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 28.4 \u00b5s per loop\npari without check:                                    : 625 loops, best of 3: 11.4 \u00b5s per loop\npari trusting that pari.ispower now works              : 625 loops, best of 3: 21.3 \u00b5s per loop\nI.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 30 \u00b5s per loop\ntrying: 1000000007\ncall Integers(n).multiplicative_generator()            : 625 loops, best of 3: 3.86 \u00b5s per loop\npari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 78.6 \u00b5s per loop\npari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 73.6 \u00b5s per loop\npari without check:                                    : 625 loops, best of 3: 53.7 \u00b5s per loop\npari trusting that pari.ispower now works              : 625 loops, best of 3: 71.1 \u00b5s per loop\nI.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 31.6 \u00b5s per loop\ntrying: 17^5\ncall Integers(n).multiplicative_generator()            : 625 loops, best of 3: 79.7 \u00b5s per loop\npari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 57.4 \u00b5s per loop\npari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 51 \u00b5s per loop\npari without check:                                    : 625 loops, best of 3: 10.5 \u00b5s per loop\npari trusting that pari.ispower now works              : 625 loops, best of 3: 20.8 \u00b5s per loop\nI.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 46.7 \u00b5s per loop\ntrying: 2 * 109^100\ncall Integers(n).multiplicative_generator()            : 625 loops, best of 3: 857 \u00b5s per loop\npari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 879 \u00b5s per loop\npari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 869 \u00b5s per loop\npari without check:                                    : 625 loops, best of 3: 49.4 \u00b5s per loop\npari trusting that pari.ispower now works              : 625 loops, best of 3: 95.1 \u00b5s per loop\nI.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 123 \u00b5s per loop\n```\n\nLong story short, Integers(n).multiplicative_generator is very fast for primes, but otherwise slow.  Trying to mix the two (using multiplicative_generator for primes and pari for everything else) winds up being slower than pari for small primes and faster for large ones; could branch on size but not sure if the speed benefit would be worth the complexity.  I don't have a good sense for Python overheads at the microsecond level.",
    "created_at": "2011-02-26T05:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113748",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

Pretty easy to fix but there are some choices regarding speed and whether we now believe in pari's ispower function.

```
trying: 2
call Integers(n).multiplicative_generator()            : 625 loops, best of 3: 3.97 µs per loop
pari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 16.1 µs per loop
pari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 9.53 µs per loop
pari without check:                                    : 625 loops, best of 3: 8.74 µs per loop
pari trusting that pari.ispower now works              : 625 loops, best of 3: 9.39 µs per loop
I.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 29.3 µs per loop
trying: 97
call Integers(n).multiplicative_generator()            : 625 loops, best of 3: 3.93 µs per loop
pari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 33 µs per loop
pari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 27.3 µs per loop
pari without check:                                    : 625 loops, best of 3: 10.8 µs per loop
pari trusting that pari.ispower now works              : 625 loops, best of 3: 19.8 µs per loop
I.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 29.4 µs per loop
trying: 10007
call Integers(n).multiplicative_generator()            : 625 loops, best of 3: 3.93 µs per loop
pari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 34.1 µs per loop
pari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 28.4 µs per loop
pari without check:                                    : 625 loops, best of 3: 11.4 µs per loop
pari trusting that pari.ispower now works              : 625 loops, best of 3: 21.3 µs per loop
I.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 30 µs per loop
trying: 1000000007
call Integers(n).multiplicative_generator()            : 625 loops, best of 3: 3.86 µs per loop
pari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 78.6 µs per loop
pari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 73.6 µs per loop
pari without check:                                    : 625 loops, best of 3: 53.7 µs per loop
pari trusting that pari.ispower now works              : 625 loops, best of 3: 71.1 µs per loop
I.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 31.6 µs per loop
trying: 17^5
call Integers(n).multiplicative_generator()            : 625 loops, best of 3: 79.7 µs per loop
pari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 57.4 µs per loop
pari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 51 µs per loop
pari without check:                                    : 625 loops, best of 3: 10.5 µs per loop
pari trusting that pari.ispower now works              : 625 loops, best of 3: 20.8 µs per loop
I.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 46.7 µs per loop
trying: 2 * 109^100
call Integers(n).multiplicative_generator()            : 625 loops, best of 3: 857 µs per loop
pari after Integers(n).multiplicative_group_is_cyclic(): 625 loops, best of 3: 879 µs per loop
pari after inline Integers(n).mult.._group_is_cyclic() : 625 loops, best of 3: 869 µs per loop
pari without check:                                    : 625 loops, best of 3: 49.4 µs per loop
pari trusting that pari.ispower now works              : 625 loops, best of 3: 95.1 µs per loop
I.mul_gen() if prime, trusting pari otherwise:         : 625 loops, best of 3: 123 µs per loop
```

Long story short, Integers(n).multiplicative_generator is very fast for primes, but otherwise slow.  Trying to mix the two (using multiplicative_generator for primes and pari for everything else) winds up being slower than pari for small primes and faster for large ones; could branch on size but not sure if the speed benefit would be worth the complexity.  I don't have a good sense for Python overheads at the microsecond level.



---

archive/issue_comments_113749.json:
```json
{
    "body": "From some correspondence with myself, William, and the Pari team, where it becomes clear that their implementation has the rather useful virtue of being very very fast:\n\n```\n\n> Compare :\n>\n> (23:07) gp > p = 10^50 + 151;\n> (23:07) gp > for(i=1,10^2, isprime(p))\n> time = 1,324 ms.\n> (23:07) gp >  for(i=1,10^2, ispseudoprime(p))\n> time = 32 ms.\n> (23:07) gp >  for(i=1,10^2, znprimroot(p))\n> time = 112 ms.\n>\n> For simple inputs (where factoring p-1 is not a problem), it's orders of\n> magnitude faster to find a plausible primitive root than to guarantee\n> that the question makes sense (primality proof). In fact, already trying\n> to weed out most composites [ ispseudoprime vs. isprime ] takes a\n> non-negligible amount of time.\n>\n> As p increases, I can produce (contrived but) legitimate prime inputs\n> where isprime() takes an arbitrary amount of time whereas znprimroot()\n> remains essentially instantaneous. For random large p, factoring p-1 will\n> dominate the running time, hiding all this. (In fact, znprimroot won't\n> even stand a chance of finishing.)\n```\n\nSo we will keep using their very fast function and wrap it with something that checks for sensible input, but adding documentation like\n\n```\nsage: b = pari(11) \nsage: b.znprimroot() \n```\nto the documentation for our `primitive_root` function for those needing direct access to the speed, warning of 'undefined' input.  William, does that sound right?",
    "created_at": "2011-02-26T21:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113749",
    "user": "https://github.com/kcrisman"
}
```

From some correspondence with myself, William, and the Pari team, where it becomes clear that their implementation has the rather useful virtue of being very very fast:

```

> Compare :
>
> (23:07) gp > p = 10^50 + 151;
> (23:07) gp > for(i=1,10^2, isprime(p))
> time = 1,324 ms.
> (23:07) gp >  for(i=1,10^2, ispseudoprime(p))
> time = 32 ms.
> (23:07) gp >  for(i=1,10^2, znprimroot(p))
> time = 112 ms.
>
> For simple inputs (where factoring p-1 is not a problem), it's orders of
> magnitude faster to find a plausible primitive root than to guarantee
> that the question makes sense (primality proof). In fact, already trying
> to weed out most composites [ ispseudoprime vs. isprime ] takes a
> non-negligible amount of time.
>
> As p increases, I can produce (contrived but) legitimate prime inputs
> where isprime() takes an arbitrary amount of time whereas znprimroot()
> remains essentially instantaneous. For random large p, factoring p-1 will
> dominate the running time, hiding all this. (In fact, znprimroot won't
> even stand a chance of finishing.)
```

So we will keep using their very fast function and wrap it with something that checks for sensible input, but adding documentation like

```
sage: b = pari(11) 
sage: b.znprimroot() 
```
to the documentation for our `primitive_root` function for those needing direct access to the speed, warning of 'undefined' input.  William, does that sound right?



---

archive/issue_comments_113750.json:
```json
{
    "body": "Well, I have a provisional patch, but because I am very unfamiliar with how gp/GP/Pari/PARI interact with Sage, this might be really kludgy. Also, I have observed the following perplexing behavior in testing (in Sage or Pari):\n\n```\nparisize = 8000000, primelimit = 500509\n? p = 10^80+129\n%1 = 100000000000000000000000000000000000000000000000000000000000000000000000000000129\n? znprimroot(p)\n^C  ***   at top-level: znprimroot(p)\n  ***                 ^-------------\n  *** znprimroot: user interrupt after 29,777 ms.\n  ***   Break loop: type <Return> to continue; 'break' to go back to GP\nbreak> break\n\n? p = 10^76+133\n%2 = 10000000000000000000000000000000000000000000000000000000000000000000000000133\n? znprimroot(p)\n%3 = Mod(2, 10000000000000000000000000000000000000000000000000000000000000000000000000133)\n```\nShould this size difference really make such a huge difference?  I would estimate the second computation took about a second.  The slowness is all in Pari, too; in Sage I get the same thing.  I would think these were not such large numbers.\n\n```\nsage: primitive_root(next_prime(3.32*10^76))\n^C\nKeyboardInterrupt: \nsage: primitive_root(next_prime(3.33*10^76))\n2\n```\nThis also happens in Sage 4.6.2, so it's nothing unusual.    Am I just getting unlucky with numbers that have really big primitive roots?  Maybe; I just put a problem to that effect on a take-home exam...  \n\nOn the other hand, when I quit after having done these breaks, I get\n\n```\n  ***   Warning: I/O: leaked file descriptor (0): /var/folders/Yy/YytEJm5VEB0+pBRD7JNLe++++TQ/-Tmp-/MPQS.503.640ad/LPNEW.\n  ***   Warning: I/O: leaked file descriptor (0): /var/folders/Yy/YytEJm5VEB0+pBRD7JNLe++++TQ/-Tmp-/MPQS.503.640ad/FNEW.\n  ***   Warning: I/O: leaked file descriptor (0): /var/folders/Yy/YytEJm5VEB0+pBRD7JNLe++++TQ/-Tmp-/MPQS.503.640ac/FNEW.\n```\ntype stuff, so maybe I'm not crazy.\n\nAnyway, for the purposes here, the problem is finding a doctest where the Sage version takes a long time without the Pari one taking a long time.  I tried lots and lots of things.\n\nAny ideas?  Anyway, maybe this patch is better than WRONG answers, so here is a patch to look at.",
    "created_at": "2011-03-14T19:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113750",
    "user": "https://github.com/kcrisman"
}
```

Well, I have a provisional patch, but because I am very unfamiliar with how gp/GP/Pari/PARI interact with Sage, this might be really kludgy. Also, I have observed the following perplexing behavior in testing (in Sage or Pari):

```
parisize = 8000000, primelimit = 500509
? p = 10^80+129
%1 = 100000000000000000000000000000000000000000000000000000000000000000000000000000129
? znprimroot(p)
^C  ***   at top-level: znprimroot(p)
  ***                 ^-------------
  *** znprimroot: user interrupt after 29,777 ms.
  ***   Break loop: type <Return> to continue; 'break' to go back to GP
break> break

? p = 10^76+133
%2 = 10000000000000000000000000000000000000000000000000000000000000000000000000133
? znprimroot(p)
%3 = Mod(2, 10000000000000000000000000000000000000000000000000000000000000000000000000133)
```
Should this size difference really make such a huge difference?  I would estimate the second computation took about a second.  The slowness is all in Pari, too; in Sage I get the same thing.  I would think these were not such large numbers.

```
sage: primitive_root(next_prime(3.32*10^76))
^C
KeyboardInterrupt: 
sage: primitive_root(next_prime(3.33*10^76))
2
```
This also happens in Sage 4.6.2, so it's nothing unusual.    Am I just getting unlucky with numbers that have really big primitive roots?  Maybe; I just put a problem to that effect on a take-home exam...  

On the other hand, when I quit after having done these breaks, I get

```
  ***   Warning: I/O: leaked file descriptor (0): /var/folders/Yy/YytEJm5VEB0+pBRD7JNLe++++TQ/-Tmp-/MPQS.503.640ad/LPNEW.
  ***   Warning: I/O: leaked file descriptor (0): /var/folders/Yy/YytEJm5VEB0+pBRD7JNLe++++TQ/-Tmp-/MPQS.503.640ad/FNEW.
  ***   Warning: I/O: leaked file descriptor (0): /var/folders/Yy/YytEJm5VEB0+pBRD7JNLe++++TQ/-Tmp-/MPQS.503.640ac/FNEW.
```
type stuff, so maybe I'm not crazy.

Anyway, for the purposes here, the problem is finding a doctest where the Sage version takes a long time without the Pari one taking a long time.  I tried lots and lots of things.

Any ideas?  Anyway, maybe this patch is better than WRONG answers, so here is a patch to look at.



---

archive/issue_events_028035.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-03-14T19:01:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "milestone": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10836#event-28035"
}
```



---

archive/issue_comments_113751.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-03-14T19:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113751",
    "user": "https://github.com/kcrisman"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_113752.json:
```json
{
    "body": "Attachment [trac_10836-primitive.patch](tarball://root/attachments/some-uuid/ticket10836/trac_10836-primitive.patch) by @kcrisman created at 2011-03-14 19:03:36",
    "created_at": "2011-03-14T19:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113752",
    "user": "https://github.com/kcrisman"
}
```

Attachment [trac_10836-primitive.patch](tarball://root/attachments/some-uuid/ticket10836/trac_10836-primitive.patch) by @kcrisman created at 2011-03-14 19:03:36



---

archive/issue_comments_113753.json:
```json
{
    "body": "```\nsage: for i in range(10^2):\n....:         n = randrange(10^50)\n....:     try:\n....:         primitive_root(n)\n....:     except:\n....:         pass\n```\nI've gotten big error rates on this in the old one - 70% or more of the primitive roots were erroneous.  Something like this takes 11 seconds in both versions, though.  \n\nBut there definitely is a slowdown for some numbers:\n\n```\nsage: sage: timeit('primitive_root(10^50+151)')\n25 loops, best of 3: 17.6 ms per loop\nsage: sage: timeit('pari(10^50+151).znprimroot()')\n625 loops, best of 3: 1.46 ms per loop\n```\nBefore, both took about the same amount of time.  \n\nAnother data point, possibly irrelevant:\n\n```\nsage: timeit('try:\\n    primitive_root(randrange(10^60))\\nexcept:\\n    pass')\n5 loops, best of 3: 97.9 ms per loop\nsage: timeit('try:\\n    pari(randrange(10^60)).znprimroot()\\nexcept:\\n    pass') \n5 loops, best of 3: 200 ms per loop\n```\nThe variation is extremely wide on this, as one might expect, and sometimes one is faster, sometimes another.  I've gotten from 25 to 300 ms for both commands, irrespective of before/after the patch.  I did once get 1.85 *seconds* for the new primitive_root, so it seems it is sometimes slower, but I also got as long as 1.24 s for the pari version, and neither of these bad times came close to always happening - much more important were the particular random numbers chosen.",
    "created_at": "2011-03-14T19:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113753",
    "user": "https://github.com/kcrisman"
}
```

```
sage: for i in range(10^2):
....:         n = randrange(10^50)
....:     try:
....:         primitive_root(n)
....:     except:
....:         pass
```
I've gotten big error rates on this in the old one - 70% or more of the primitive roots were erroneous.  Something like this takes 11 seconds in both versions, though.  

But there definitely is a slowdown for some numbers:

```
sage: sage: timeit('primitive_root(10^50+151)')
25 loops, best of 3: 17.6 ms per loop
sage: sage: timeit('pari(10^50+151).znprimroot()')
625 loops, best of 3: 1.46 ms per loop
```
Before, both took about the same amount of time.  

Another data point, possibly irrelevant:

```
sage: timeit('try:\n    primitive_root(randrange(10^60))\nexcept:\n    pass')
5 loops, best of 3: 97.9 ms per loop
sage: timeit('try:\n    pari(randrange(10^60)).znprimroot()\nexcept:\n    pass') 
5 loops, best of 3: 200 ms per loop
```
The variation is extremely wide on this, as one might expect, and sometimes one is faster, sometimes another.  I've gotten from 25 to 300 ms for both commands, irrespective of before/after the patch.  I did once get 1.85 *seconds* for the new primitive_root, so it seems it is sometimes slower, but I also got as long as 1.24 s for the pari version, and neither of these bad times came close to always happening - much more important were the particular random numbers chosen.



---

archive/issue_comments_113754.json:
```json
{
    "body": "Hopefully someone can review this during Sage Day 29?  It's mathematically wrong currently...",
    "created_at": "2011-03-22T00:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113754",
    "user": "https://github.com/kcrisman"
}
```

Hopefully someone can review this during Sage Day 29?  It's mathematically wrong currently...



---

archive/issue_comments_113755.json:
```json
{
    "body": "I think maybe there's a little too much duplication with all the branches?  ISTM it's simpler to implement the condition exactly from the definition given, with something like\n\n```\n    if ((n == 4) or (n % 2 == 1 and n.is_prime_power()) or \n        (n % 2 == 0 and n % 4 != 0 and (n//2).is_prime_power())):\n        return ans\n```\n\nwhere each condition group matches exactly one of the classes of allowed arguments in the docstring.  I find this is also marginally faster on average for successful calls.  But I think we should check n for the existence of a primitive root before we call pari, because when testing it I came across this (4.6.2):\n\n```\nsage: factor(1729)\n7 * 13 * 19\nsage: time primitive_root(1729)\n[... several minutes go by, so I have no idea if this eventually returns a value or not ...]\n```\n\nSimilarly for 2465, 3458, 4930.  This is a pari bug not an interface bug, as working directly with the console shows the same issue.",
    "created_at": "2011-03-22T01:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113755",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

I think maybe there's a little too much duplication with all the branches?  ISTM it's simpler to implement the condition exactly from the definition given, with something like

```
    if ((n == 4) or (n % 2 == 1 and n.is_prime_power()) or 
        (n % 2 == 0 and n % 4 != 0 and (n//2).is_prime_power())):
        return ans
```

where each condition group matches exactly one of the classes of allowed arguments in the docstring.  I find this is also marginally faster on average for successful calls.  But I think we should check n for the existence of a primitive root before we call pari, because when testing it I came across this (4.6.2):

```
sage: factor(1729)
7 * 13 * 19
sage: time primitive_root(1729)
[... several minutes go by, so I have no idea if this eventually returns a value or not ...]
```

Similarly for 2465, 3458, 4930.  This is a pari bug not an interface bug, as working directly with the console shows the same issue.



---

archive/issue_comments_113756.json:
```json
{
    "body": "If you can find a quicker way to write that, this is fine.   I was hoping to speed things up by checking certain cases first, such as primes.  Branching can be confusing, you are right.\n\nMore precisely, it's what Pari claims is user input error.  I actually explicitly didn't do this because we didn't want to slow down the checking of primitive roots for legitimate input, which this would do for huge numbers - that is the whole idea behind Pari's thinking.  \n\nAt this point, I'd appreciate the input of someone who actually needs primitive roots of huge numbers!  The question is whether we want the bottleneck with legitimate or non-legitimate input.  If it really is that long for a four-digit number, maybe we go with your idea; that's pretty bad.",
    "created_at": "2011-03-22T01:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113756",
    "user": "https://github.com/kcrisman"
}
```

If you can find a quicker way to write that, this is fine.   I was hoping to speed things up by checking certain cases first, such as primes.  Branching can be confusing, you are right.

More precisely, it's what Pari claims is user input error.  I actually explicitly didn't do this because we didn't want to slow down the checking of primitive roots for legitimate input, which this would do for huge numbers - that is the whole idea behind Pari's thinking.  

At this point, I'd appreciate the input of someone who actually needs primitive roots of huge numbers!  The question is whether we want the bottleneck with legitimate or non-legitimate input.  If it really is that long for a four-digit number, maybe we go with your idea; that's pretty bad.



---

archive/issue_comments_113757.json:
```json
{
    "body": "Well, it hasn't stopped after half an hour..\n\nI don't quite follow you about the speed, though.  Before every \"return ans\" for n > 5 you either (1) test primality, (2) test for a prime power, or (3) once again test for a prime power, so ISTM you're not avoiding the cost of doing the tests on legitimate input, you're just doing it after the znprimroot call instead of before.  (And we get very similar times for large legitimate input, which is what I'd expect if I'm right.)\n\nIf we really want a super-fast way to do this when needed -- and like you I suspect, I have zero need for primitive roots of huge numbers so I have no idea if this matters at all in practice `:^)` -- I say we add a proof=False option, or whatever the standard is in other functions that don't test their input for speed reasons (I think I've seen exactly this situation before but can't think where right now).",
    "created_at": "2011-03-22T02:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113757",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

Well, it hasn't stopped after half an hour..

I don't quite follow you about the speed, though.  Before every "return ans" for n > 5 you either (1) test primality, (2) test for a prime power, or (3) once again test for a prime power, so ISTM you're not avoiding the cost of doing the tests on legitimate input, you're just doing it after the znprimroot call instead of before.  (And we get very similar times for large legitimate input, which is what I'd expect if I'm right.)

If we really want a super-fast way to do this when needed -- and like you I suspect, I have zero need for primitive roots of huge numbers so I have no idea if this matters at all in practice `:^)` -- I say we add a proof=False option, or whatever the standard is in other functions that don't test their input for speed reasons (I think I've seen exactly this situation before but can't think where right now).



---

archive/issue_comments_113758.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-22T02:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113758",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_113759.json:
```json
{
    "body": "Yes, you are right about this.  I forgot that the number isn't actually returned until then :)\n\nYeah, I thought about proof=False, but wanted to keep it short to start - adding keywords sometimes turns into a mess.  \n\nIf you want to post a second patch with these ideas, we can review it jointly very easily.   To me, it's half a dozen of one and six of the other, although I am surprised myself about \n\n```\nsage: a = pari(1729)\nsage: a.znprimroot()\n```\ntaking so long.",
    "created_at": "2011-03-22T02:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113759",
    "user": "https://github.com/kcrisman"
}
```

Yes, you are right about this.  I forgot that the number isn't actually returned until then :)

Yeah, I thought about proof=False, but wanted to keep it short to start - adding keywords sometimes turns into a mess.  

If you want to post a second patch with these ideas, we can review it jointly very easily.   To me, it's half a dozen of one and six of the other, although I am surprised myself about 

```
sage: a = pari(1729)
sage: a.znprimroot()
```
taking so long.



---

archive/issue_comments_113760.json:
```json
{
    "body": "Wow, regarding\n\n```\nsage: a = pari(1729)\nsage: a.znprimroot()\n```\nThat's seriously messed up!  This is a case where there is no primitive root.  So it's the \"undefined\" behavior mentioned in the pari docs -- just take forever.  \n\nAnyway, looking over this thread, it seems to me that the docstring in the patch is very good as is, but the code should be completely changed to only call pari after explicitly checking the condition for there to be a primitive root (as explained in the docstring).",
    "created_at": "2011-03-25T05:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113760",
    "user": "https://github.com/williamstein"
}
```

Wow, regarding

```
sage: a = pari(1729)
sage: a.znprimroot()
```
That's seriously messed up!  This is a case where there is no primitive root.  So it's the "undefined" behavior mentioned in the pari docs -- just take forever.  

Anyway, looking over this thread, it seems to me that the docstring in the patch is very good as is, but the code should be completely changed to only call pari after explicitly checking the condition for there to be a primitive root (as explained in the docstring).



---

archive/issue_comments_113761.json:
```json
{
    "body": "Attachment [trac_10836.patch](tarball://root/attachments/some-uuid/ticket10836/trac_10836.patch) by @williamstein created at 2011-03-25 06:27:14\n\napply only this patch",
    "created_at": "2011-03-25T06:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113761",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_10836.patch](tarball://root/attachments/some-uuid/ticket10836/trac_10836.patch) by @williamstein created at 2011-03-25 06:27:14

apply only this patch



---

archive/issue_comments_113762.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-25T06:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113762",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113763.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-03-25T12:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113763",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_113764.json:
```json
{
    "body": "Nice use of `is_prime_power` to make sure negatives don't get through.  \n\nShould we throw a better error message than \n\n```\nAttributeError: 'sage.rings.rational.Rational' object has no attribute 'is_prime_power'\n```\nfor non-integer input?  Or is it enough to say that there isn't a primitive root?  I guess same question for negatives.  \"No primitive root\" seems somewhat cryptic.  Putting 'needs info'; I can also upload a reviewer patch if you think that's okay.  We would check for that *after* we actually got the primitive root, so it wouldn't slow anything down.\n\nOtherwise the patch looks good, and if William thinks `check=True` is good enough, it's fine for me.",
    "created_at": "2011-03-25T12:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113764",
    "user": "https://github.com/kcrisman"
}
```

Nice use of `is_prime_power` to make sure negatives don't get through.  

Should we throw a better error message than 

```
AttributeError: 'sage.rings.rational.Rational' object has no attribute 'is_prime_power'
```
for non-integer input?  Or is it enough to say that there isn't a primitive root?  I guess same question for negatives.  "No primitive root" seems somewhat cryptic.  Putting 'needs info'; I can also upload a reviewer patch if you think that's okay.  We would check for that *after* we actually got the primitive root, so it wouldn't slow anything down.

Otherwise the patch looks good, and if William thinks `check=True` is good enough, it's fine for me.



---

archive/issue_comments_113765.json:
```json
{
    "body": "I'm also getting something weird while trying to test one of the files where this occurs.\n\n```\nsage -tp 4 devel/sage/sage/rings/finite_rings\nTesting that Sage starts...\nYes, Sage starts.\nGlobal iterations: 1\nFile iterations: 1\nUsing cached timings to run longest doctests first.\nDoctesting 0 files doing 0 jobs in parallel\n \n----------------------------------------------------------------------\nAll tests passed!\nTimings have been updated.\nTotal time for all tests: 0.2 seconds\n```\nBut \n\n```\nls Downloads/sage-4.7.alpha1/devel/sage/sage/rings/finite_rings/\n__init__.py\t\t\tfinite_field_base.c\nall.py\t\t\t\tfinite_field_base.pxd\nconstructor.py\t\t\tfinite_field_base.pyx\nelement_base.c\t\t\tfinite_field_ext_pari.py\nelement_base.pxd\t\tfinite_field_givaro.py\nelement_base.pyx\t\tfinite_field_prime_modn.py\nelement_ext_pari.py\t\thomset.py\nelement_givaro.cpp\t\tinteger_mod.c\nelement_givaro.pxd\t\tinteger_mod.pxd\nelement_givaro.pyx\t\tinteger_mod.pyx\nelement_ntl_gf2e.cpp\t\tinteger_mod_ring.py\nelement_ntl_gf2e.pxd\t\tstdint.h\nelement_ntl_gf2e.pyx\n```\nWhat is up with that?",
    "created_at": "2011-03-25T12:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113765",
    "user": "https://github.com/kcrisman"
}
```

I'm also getting something weird while trying to test one of the files where this occurs.

```
sage -tp 4 devel/sage/sage/rings/finite_rings
Testing that Sage starts...
Yes, Sage starts.
Global iterations: 1
File iterations: 1
Using cached timings to run longest doctests first.
Doctesting 0 files doing 0 jobs in parallel
 
----------------------------------------------------------------------
All tests passed!
Timings have been updated.
Total time for all tests: 0.2 seconds
```
But 

```
ls Downloads/sage-4.7.alpha1/devel/sage/sage/rings/finite_rings/
__init__.py			finite_field_base.c
all.py				finite_field_base.pxd
constructor.py			finite_field_base.pyx
element_base.c			finite_field_ext_pari.py
element_base.pxd		finite_field_givaro.py
element_base.pyx		finite_field_prime_modn.py
element_ext_pari.py		homset.py
element_givaro.cpp		integer_mod.c
element_givaro.pxd		integer_mod.pxd
element_givaro.pyx		integer_mod.pyx
element_ntl_gf2e.cpp		integer_mod_ring.py
element_ntl_gf2e.pxd		stdint.h
element_ntl_gf2e.pyx
```
What is up with that?



---

archive/issue_comments_113766.json:
```json
{
    "body": "Okay, that turned out to be a red herring.  At least I think so.  Sorry for the noise.  \n\nRelevant tests pass.  I don't have time to make a reviewer patch now, but would appreciate the feedback on whether it's okay to add that check and format.  Since it would be after the real work is done, I think that is ok.",
    "created_at": "2011-03-25T13:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113766",
    "user": "https://github.com/kcrisman"
}
```

Okay, that turned out to be a red herring.  At least I think so.  Sorry for the noise.  

Relevant tests pass.  I don't have time to make a reviewer patch now, but would appreciate the feedback on whether it's okay to add that check and format.  Since it would be after the real work is done, I think that is ok.



---

archive/issue_comments_113767.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-03-25T13:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113767",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_113768.json:
```json
{
    "body": "> Should we throw a better error message than \n> \n> ```\n> AttributeError: 'sage.rings.rational.Rational' object has no attribute 'is_prime_power'\n> ```\n> for non-integer input?  \n\nActually, we end up with \n\n```\nTypeError: Attempt to coerce non-integral RealNumber to Integer\n```\nwhich I didn't notice but is obvious because of the `ZZ(n)`.  So that is okay. \n\nAssuming the docs look ok, I now think that adding the other thing is not worth the effort.    I think I may need to give a reviewer patch to fix a couple REsT things, though.  We'll see :)",
    "created_at": "2011-03-25T13:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113768",
    "user": "https://github.com/kcrisman"
}
```

> Should we throw a better error message than 
> 
> ```
> AttributeError: 'sage.rings.rational.Rational' object has no attribute 'is_prime_power'
> ```
> for non-integer input?  

Actually, we end up with 

```
TypeError: Attempt to coerce non-integral RealNumber to Integer
```
which I didn't notice but is obvious because of the `ZZ(n)`.  So that is okay. 

Assuming the docs look ok, I now think that adding the other thing is not worth the effort.    I think I may need to give a reviewer patch to fix a couple REsT things, though.  We'll see :)



---

archive/issue_comments_113769.json:
```json
{
    "body": "Apply only this patch",
    "created_at": "2011-03-25T13:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113769",
    "user": "https://github.com/kcrisman"
}
```

Apply only this patch



---

archive/issue_comments_113770.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-25T13:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113770",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_113771.json:
```json
{
    "body": "Attachment [trac_10836.2.patch](tarball://root/attachments/some-uuid/ticket10836/trac_10836.2.patch) by @kcrisman created at 2011-03-25 13:50:17\n\nHad to fix one tiny thing for the note to look right.  Positive review.\n\nApply only [attachment:trac_10836.2.patch].",
    "created_at": "2011-03-25T13:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113771",
    "user": "https://github.com/kcrisman"
}
```

Attachment [trac_10836.2.patch](tarball://root/attachments/some-uuid/ticket10836/trac_10836.2.patch) by @kcrisman created at 2011-03-25 13:50:17

Had to fix one tiny thing for the note to look right.  Positive review.

Apply only [attachment:trac_10836.2.patch].



---

archive/issue_comments_113772.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-03-26T20:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113772",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_113773.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-26T20:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113773",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113774.json:
```json
{
    "body": "My additional patch needs review.",
    "created_at": "2011-03-26T20:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113774",
    "user": "https://github.com/jdemeyer"
}
```

My additional patch needs review.



---

archive/issue_comments_113775.json:
```json
{
    "body": "Attachment [10836_additional.patch](tarball://root/attachments/some-uuid/ticket10836/10836_additional.patch) by @jdemeyer created at 2011-03-26 21:13:19",
    "created_at": "2011-03-26T21:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113775",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10836_additional.patch](tarball://root/attachments/some-uuid/ticket10836/10836_additional.patch) by @jdemeyer created at 2011-03-26 21:13:19



---

archive/issue_comments_113776.json:
```json
{
    "body": "Whoah, Nelly!  I see the 'niceification'.  But two points.\n\n* PARI doc explicitly says that it does *not* give the smallest root for non-prime input.\n* Do negative integers have primitive roots?  I have never heard this.  I understand the extension of the definition, but a generator of \"Z/(-5)Z\" somehow seems different to me than a \"primitive root of -5\".  I was able to [crash !W|A](http://www.wolframalpha.com/input/?i=PrimitiveRoot%5B-5%5D) with this, incidentally :)",
    "created_at": "2011-03-27T01:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113776",
    "user": "https://github.com/kcrisman"
}
```

Whoah, Nelly!  I see the 'niceification'.  But two points.

* PARI doc explicitly says that it does *not* give the smallest root for non-prime input.
* Do negative integers have primitive roots?  I have never heard this.  I understand the extension of the definition, but a generator of "Z/(-5)Z" somehow seems different to me than a "primitive root of -5".  I was able to [crash !W|A](http://www.wolframalpha.com/input/?i=PrimitiveRoot%5B-5%5D) with this, incidentally :)



---

archive/issue_comments_113777.json:
```json
{
    "body": "Replying to [comment:21 kcrisman]:\n> Do negative integers have primitive roots?  I have never heard this.  I understand the extension of the definition, but a generator of \"Z/(-5)Z\" somehow seems different to me than a \"primitive root of -5\".  I was able to [crash !W|A](http://www.wolframalpha.com/input/?i=PrimitiveRoot%5B-5%5D) with this, incidentally :)\n\nWell, I think we should decide what we do with negative integers: either raise an exception or return a sensible value. It seemed artificial to me not to allow negative numbers. Also PARI/GP computes primitive roots of negative numbers.",
    "created_at": "2011-03-27T09:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113777",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:21 kcrisman]:
> Do negative integers have primitive roots?  I have never heard this.  I understand the extension of the definition, but a generator of "Z/(-5)Z" somehow seems different to me than a "primitive root of -5".  I was able to [crash !W|A](http://www.wolframalpha.com/input/?i=PrimitiveRoot%5B-5%5D) with this, incidentally :)

Well, I think we should decide what we do with negative integers: either raise an exception or return a sensible value. It seemed artificial to me not to allow negative numbers. Also PARI/GP computes primitive roots of negative numbers.



---

archive/issue_comments_113778.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-28T18:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113778",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_113779.json:
```json
{
    "body": "Well, what we say does refer to just multipl. gp. mod n, so ok. \n\nBut should definitely make sure not to say we give smallest prim root.  So 'needs work' to fix that.  But this is pretty bad not to have fixed, so let's try to get it in asap.",
    "created_at": "2011-03-28T18:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113779",
    "user": "https://github.com/kcrisman"
}
```

Well, what we say does refer to just multipl. gp. mod n, so ok. 

But should definitely make sure not to say we give smallest prim root.  So 'needs work' to fix that.  But this is pretty bad not to have fixed, so let's try to get it in asap.



---

archive/issue_comments_113780.json:
```json
{
    "body": "Replying to [comment:23 kcrisman]:\n> But should definitely make sure not to say we give smallest prim root.\n\nWhy not?  If you things like \"this is pretty bad not to have fixed\", at least say **why**.",
    "created_at": "2011-03-28T19:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113780",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:23 kcrisman]:
> But should definitely make sure not to say we give smallest prim root.

Why not?  If you things like "this is pretty bad not to have fixed", at least say **why**.



---

archive/issue_comments_113781.json:
```json
{
    "body": "Replying to [comment:24 jdemeyer]:\n> Replying to [comment:23 kcrisman]:\n> > But should definitely make sure not to say we give smallest prim root.\n\n> Why not?  If you things like \"this is pretty bad not to have fixed\", at least say **why**.\nBecause the PARI documentation says that it no longer gives the smallest prim root, except for primes.  Or at least the changeset I saw a while ago says this - please don't ask me to find it.  Presumably something about the internal algorithm changed?\n\nOh, I see what you mean now!  \"Pretty bad to not have fixed\" meant the actual ticket.  Wrong mathematics!  Not the tiny change I am mentioning above.  I'm sorry for the possible misinterpretation.",
    "created_at": "2011-03-28T20:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113781",
    "user": "https://github.com/kcrisman"
}
```

Replying to [comment:24 jdemeyer]:
> Replying to [comment:23 kcrisman]:
> > But should definitely make sure not to say we give smallest prim root.

> Why not?  If you things like "this is pretty bad not to have fixed", at least say **why**.
Because the PARI documentation says that it no longer gives the smallest prim root, except for primes.  Or at least the changeset I saw a while ago says this - please don't ask me to find it.  Presumably something about the internal algorithm changed?

Oh, I see what you mean now!  "Pretty bad to not have fixed" meant the actual ticket.  Wrong mathematics!  Not the tiny change I am mentioning above.  I'm sorry for the possible misinterpretation.



---

archive/issue_comments_113782.json:
```json
{
    "body": "Replying to [comment:25 kcrisman]:\n> Because the PARI documentation says that it no longer gives the smallest prim root, except for primes.\n\nBut this is consistent with my patch.  In this patch, I write \"If `n` is prime, this is the smallest primitive root.\".  You mean I should be more explicit about the non-prime case?",
    "created_at": "2011-03-29T07:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113782",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 kcrisman]:
> Because the PARI documentation says that it no longer gives the smallest prim root, except for primes.

But this is consistent with my patch.  In this patch, I write "If `n` is prime, this is the smallest primitive root.".  You mean I should be more explicit about the non-prime case?



---

archive/issue_comments_113783.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2011-03-29T13:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113783",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_113784.json:
```json
{
    "body": "My humble apologies.  I don't know why I thought it said \n\n\"A primitive root of `n`. This is the smallest primitive root.\"\n\nThat means we should, in theory, fix \n\n\"`k` is a nonnegative number.\" \n\nand \n\n\"assumed to be a positive integer possessing a primitive root\"\n\nBut I agree that unless it's very easy to update the patch for this, this should go in.  So I'm inclined to put positive review.  Docs look right, still passes tests.",
    "created_at": "2011-03-29T13:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113784",
    "user": "https://github.com/kcrisman"
}
```

My humble apologies.  I don't know why I thought it said 

"A primitive root of `n`. This is the smallest primitive root."

That means we should, in theory, fix 

"`k` is a nonnegative number." 

and 

"assumed to be a positive integer possessing a primitive root"

But I agree that unless it's very easy to update the patch for this, this should go in.  So I'm inclined to put positive review.  Docs look right, still passes tests.



---

archive/issue_comments_113785.json:
```json
{
    "body": "Replying to [comment:27 kcrisman]:\n> That means we should, in theory, fix\n\nActually, I think both of these statements are 100% correct in the patch.\n\n> \"`k` is a nonnegative number.\"\n\nHere, we are talking about exponents which are allowed to be zero, so this is correct.\n\n> \"assumed to be a positive integer possessing a primitive root\"\n\nThis is also correct because PARI's behaviour for negative arguments to `znprimroot()` is undocumented, so we cannot rely on it (in practice, it does work though).",
    "created_at": "2011-03-29T13:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113785",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:27 kcrisman]:
> That means we should, in theory, fix

Actually, I think both of these statements are 100% correct in the patch.

> "`k` is a nonnegative number."

Here, we are talking about exponents which are allowed to be zero, so this is correct.

> "assumed to be a positive integer possessing a primitive root"

This is also correct because PARI's behaviour for negative arguments to `znprimroot()` is undocumented, so we cannot rely on it (in practice, it does work though).



---

archive/issue_comments_113786.json:
```json
{
    "body": "I clearly need more sleep.  You're right on the second count, and I copied the wrong thing on the first count:\n\n\"A primitive root exists if `n=4` or `n=p^k` or `n=2p^k`, where `p` is an odd prime\"\n\nWhich in theory then should say something about `\\pm` all those numbers, given that this patch defines it that way.  Probably that is lawyering.  But wanted to put it out there.  Anyway, doesn't really bother me.",
    "created_at": "2011-03-29T13:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113786",
    "user": "https://github.com/kcrisman"
}
```

I clearly need more sleep.  You're right on the second count, and I copied the wrong thing on the first count:

"A primitive root exists if `n=4` or `n=p^k` or `n=2p^k`, where `p` is an odd prime"

Which in theory then should say something about `\pm` all those numbers, given that this patch defines it that way.  Probably that is lawyering.  But wanted to put it out there.  Anyway, doesn't really bother me.



---

archive/issue_comments_113787.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-04-05T12:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10836#issuecomment-113787",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_028036.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-05T12:00:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10836",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10836#event-28036"
}
```
