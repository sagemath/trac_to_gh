# Issue 10540: Spec and patches for singular affine toric varieties / algebraic schemes

archive/issues_010487.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "This patch implements \n* the Spec of affine toric varieties. \n* patches for algebraic schemes with singular ambient toric varieties\nIn particular, Sage can now compute the dimension and smoothness for algebraic subschemes of singular toric varieties as well.\n\nThis uses both the Hilbert basis for cones and the algebraic schemes, and, therefore, depends on\n* #10525: move algebraic subschemes of toric varieties to their rightful places\n* #9918: triangulate point configurations\n* #10023: Compute Hilbert basis of cone\n* #10529: dimension() and is_smooth() for algebraic subschemes of toric varieties\n\n**Apply**\n1. [attachment: trac_10540_toric_ideals.patch](https://github.com/sagemath/sage/files/ticket10540/trac_10540_toric_ideals.patch.gz)\n2. [attachment: trac_10540_Spec_of_affine_toric_variety.patch](https://github.com/sagemath/sage/files/ticket10540/trac_10540_Spec_of_affine_toric_variety.patch.gz)\n\nDepends on #9918\nDepends on #10525\nDepends on #10023\nDepends on #10529\nDepends on #11481\n\nCC:  @novoselt @jdemeyer\n\nComponent: **algebraic geometry**\n\nKeywords: **sd31**\n\nAuthor: **Volker Braun**\n\nReviewer: **Andrey Novoseltsev**\n\nMerged: **sage-4.7.1.alpha4**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10540_\n\n",
    "closed_at": "2011-06-24T09:20:10Z",
    "created_at": "2010-12-31T18:02:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Spec and patches for singular affine toric varieties / algebraic schemes",
    "type": "issue",
    "updated_at": "2011-06-24T09:20:10Z",
    "url": "https://github.com/sagemath/sage/issues/10540",
    "user": "https://github.com/vbraun"
}
```
This patch implements 
* the Spec of affine toric varieties. 
* patches for algebraic schemes with singular ambient toric varieties
In particular, Sage can now compute the dimension and smoothness for algebraic subschemes of singular toric varieties as well.

This uses both the Hilbert basis for cones and the algebraic schemes, and, therefore, depends on
* #10525: move algebraic subschemes of toric varieties to their rightful places
* #9918: triangulate point configurations
* #10023: Compute Hilbert basis of cone
* #10529: dimension() and is_smooth() for algebraic subschemes of toric varieties

**Apply**
1. [attachment: trac_10540_toric_ideals.patch](https://github.com/sagemath/sage/files/ticket10540/trac_10540_toric_ideals.patch.gz)
2. [attachment: trac_10540_Spec_of_affine_toric_variety.patch](https://github.com/sagemath/sage/files/ticket10540/trac_10540_Spec_of_affine_toric_variety.patch.gz)

Depends on #9918
Depends on #10525
Depends on #10023
Depends on #10529
Depends on #11481

CC:  @novoselt @jdemeyer

Component: **algebraic geometry**

Keywords: **sd31**

Author: **Volker Braun**

Reviewer: **Andrey Novoseltsev**

Merged: **sage-4.7.1.alpha4**

_Issue created by migration from https://trac.sagemath.org/ticket/10540_





---

archive/issue_events_137270.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-12-31T18:02:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137270"
}
```



---

archive/issue_events_137271.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-12-31T18:02:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
    "label_color": "0000ff",
    "label_name": "c: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137271"
}
```



---

archive/issue_events_137272.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-12-31T18:02:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137272"
}
```



---

archive/issue_events_137273.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-12-31T18:02:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137273"
}
```



---

archive/issue_events_137274.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-12-31T18:02:43Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137274"
}
```



---

archive/issue_comments_100316.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n This patch implements \n-* the prime spectrum for affine toric varieties. \n+* the Spec of affine toric varieties. \n * patches for algebraic schemes with singular ambient toric varieties\n+In particular, Sage can now compute the dimension and smoothness for algebraic subschemes of singular toric varieties as well.\n \n This uses both the Hilbert basis for cones and the algebraic schemes, and, therefore, depends on\n * #10525: move algebraic subschemes of toric varieties to their rightful places\n``````\n",
    "created_at": "2010-12-31T18:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100316",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
 This patch implements 
-* the prime spectrum for affine toric varieties. 
+* the Spec of affine toric varieties. 
 * patches for algebraic schemes with singular ambient toric varieties
+In particular, Sage can now compute the dimension and smoothness for algebraic subschemes of singular toric varieties as well.
 
 This uses both the Hilbert basis for cones and the algebraic schemes, and, therefore, depends on
 * #10525: move algebraic subschemes of toric varieties to their rightful places
``````




---

archive/issue_comments_100317.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nFor the patch bot:\n\nDepends on #9918, #10023, #10525, #10529",
    "created_at": "2010-12-31T18:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100317",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:1" align="right">comment:1</div>

For the patch bot:

Depends on #9918, #10023, #10525, #10529



---

archive/issue_events_137275.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-12-31T18:11:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137275"
}
```



---

archive/issue_events_137276.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-12-31T18:11:18Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "title_is": "Spec and patches for singular affine toric varieties / algebraic schemes",
    "title_was": "patches for singular algebraic schemes",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137276"
}
```



---

archive/issue_comments_100318.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMy first version was a bit naive with the toric ideals. The updated patch implements the Hosten&Sturmfels algorithm to find a finite generating set of toric ideals.",
    "created_at": "2011-01-02T01:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100318",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:2" align="right">comment:2</div>

My first version was a bit naive with the toric ideals. The updated patch implements the Hosten&Sturmfels algorithm to find a finite generating set of toric ideals.



---

archive/issue_comments_100319.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOne more bug fixed. Also, the syntax is now much more sensible, in particular `ToricIdeal` is actually an ideal..",
    "created_at": "2011-01-02T21:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100319",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

One more bug fixed. Also, the syntax is now much more sensible, in particular `ToricIdeal` is actually an ideal..



---

archive/issue_comments_100320.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nGiven the issue #10708 where the ideal dimension is completely off for some term orders, I find it prudent to convert the ideal to the standard reverse-degree lex order. The updated patch does precisely this.",
    "created_at": "2011-02-01T17:10:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100320",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:4" align="right">comment:4</div>

Given the issue #10708 where the ideal dimension is completely off for some term orders, I find it prudent to convert the ideal to the standard reverse-degree lex order. The updated patch does precisely this.



---

archive/issue_comments_100321.json:
```json
{
    "body": "Reviewer: **Andrey Novoseltsev**",
    "created_at": "2011-05-19T00:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100321",
    "user": "https://github.com/novoselt"
}
```

Reviewer: **Andrey Novoseltsev**



---

archive/issue_comments_100322.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nFrom PEP8: \"Method definitions inside a class are separated by a single blank line.\" While this ticket inserts a bunch of second blank lines ;-)",
    "created_at": "2011-05-19T00:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100322",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:5" align="right">comment:5</div>

From PEP8: "Method definitions inside a class are separated by a single blank line." While this ticket inserts a bunch of second blank lines ;-)



---

archive/issue_comments_100323.json:
```json
{
    "body": "Dependencies: **#9918, #10525, #10023, #10529**",
    "created_at": "2011-05-19T00:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100323",
    "user": "https://github.com/novoselt"
}
```

Dependencies: **#9918, #10525, #10023, #10529**



---

archive/issue_comments_100324.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,10 @@\n \n This uses both the Hilbert basis for cones and the algebraic schemes, and, therefore, depends on\n * #10525: move algebraic subschemes of toric varieties to their rightful places\n-* #10529: dimension() and is_smooth() for algebraic subschemes of toric varieties\n * #9918: triangulate point configurations\n * #10023: Compute Hilbert basis of cone\n+* #10529: dimension() and is_smooth() for algebraic subschemes of toric varieties\n \n+**Apply**\n+1. [attachment: trac_10540_toric_ideals.patch](https://github.com/sagemath/sage/files/ticket10540/trac_10540_toric_ideals.patch.gz)\n+2. [attachment: trac_10540_Spec_of_affine_toric_variety.patch](https://github.com/sagemath/sage/files/ticket10540/trac_10540_Spec_of_affine_toric_variety.patch.gz)\n``````\n",
    "created_at": "2011-05-19T00:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100324",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,10 @@
 
 This uses both the Hilbert basis for cones and the algebraic schemes, and, therefore, depends on
 * #10525: move algebraic subschemes of toric varieties to their rightful places
-* #10529: dimension() and is_smooth() for algebraic subschemes of toric varieties
 * #9918: triangulate point configurations
 * #10023: Compute Hilbert basis of cone
+* #10529: dimension() and is_smooth() for algebraic subschemes of toric varieties
 
+**Apply**
+1. [attachment: trac_10540_toric_ideals.patch](https://github.com/sagemath/sage/files/ticket10540/trac_10540_toric_ideals.patch.gz)
+2. [attachment: trac_10540_Spec_of_affine_toric_variety.patch](https://github.com/sagemath/sage/files/ticket10540/trac_10540_Spec_of_affine_toric_variety.patch.gz)
``````




---

archive/issue_events_137277.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-19T00:43:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137277"
}
```



---

archive/issue_events_137278.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-19T00:43:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137278"
}
```



---

archive/issue_comments_100325.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nFrom PEP8: \"A Foolish Consistency is the Hobgoblin of Little Minds\" :-)\n\nI changed to single blank lines in `algebraic_schemes.py`. Though I really find double blank lines in method def's improve readability especially if there are very long docstrings which themselves contain single blank lines.",
    "created_at": "2011-05-27T16:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100325",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

From PEP8: "A Foolish Consistency is the Hobgoblin of Little Minds" :-)

I changed to single blank lines in `algebraic_schemes.py`. Though I really find double blank lines in method def's improve readability especially if there are very long docstrings which themselves contain single blank lines.



---

archive/issue_comments_100326.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nComments/questions on the first patch (toric ideals):\n1. The default names of variables are not described in the class constructor.\n2. Perhaps, as an alternative to specifying names, it should be possible to specify the ring in which the ideal has to be constructed?\n3. Out of curiosity: are there any reasons for using `QQ` as the default ring and not `ZZ`?\n4. I liked the module documentation with many examples of different complexity and comments on them. Perhaps it is worth mentioning in the ideal constructor docstring that there is this extensive tutorial.",
    "created_at": "2011-05-28T02:45:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100326",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:7" align="right">comment:7</div>

Comments/questions on the first patch (toric ideals):
1. The default names of variables are not described in the class constructor.
2. Perhaps, as an alternative to specifying names, it should be possible to specify the ring in which the ideal has to be constructed?
3. Out of curiosity: are there any reasons for using `QQ` as the default ring and not `ZZ`?
4. I liked the module documentation with many examples of different complexity and comments on them. Perhaps it is worth mentioning in the ideal constructor docstring that there is this extensive tutorial.



---

archive/issue_comments_100327.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI've added a possibility to specify the polynomial ring directly and documentation.\n\nAs for the base ring, really you only have to work over `GF(2)`. During the Buchberger algorithm, all S-polynomials are of the form `monomial=monomial`. This is a very special case and implementing Buchbergers algorithm in this special case is probably faster than any general-purpose code. But then, its been fast enough for me so far. If you use smaller coefficient rings then converting it back into an ideal over QQ, say, gets more difficult. For example, if you use `GF(2)` then you have to manually give each generator alternating signs. So its probably most convenient to work over QQ.",
    "created_at": "2011-05-28T21:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100327",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:8" align="right">comment:8</div>

I've added a possibility to specify the polynomial ring directly and documentation.

As for the base ring, really you only have to work over `GF(2)`. During the Buchberger algorithm, all S-polynomials are of the form `monomial=monomial`. This is a very special case and implementing Buchbergers algorithm in this special case is probably faster than any general-purpose code. But then, its been fast enough for me so far. If you use smaller coefficient rings then converting it back into an ideal over QQ, say, gets more difficult. For example, if you use `GF(2)` then you have to manually give each generator alternating signs. So its probably most convenient to work over QQ.



---

archive/issue_comments_100328.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nLooks good!\n\nFor the second patch:\n5. (line 433) The implementation looks very confusing to me: why would you store in the field `embedding_morphism` an exception??? I would expect either returning the stored value if it exists, or constructing the default embedding into the ambient space...\n1. (line 441) Am I right that `embedding_origin` may be a non-origin as in not (0,0,0)? In this case I kind of really don't like using the word `origin`, how about `marked_point` instead or `embegging_marking` or `embedding_center` to put it next to the embedding?\n2. (line 1847) There should be no \"local\", this scheme is just isomorphic to a neighbourhood of the point.\n3. (line 1859) <code>\\`\\`result.embedding_morphism\\`\\`</code> should be more like <code>:meth:\\`embedding_morphism\\`</code> or at least <code>\\`\\`result.embedding_morphism()\\`\\`</code>, same for (1862).\n4. (line 2076) `affine_patch` was used for compatibility with projective spaces, do we really need to change its name? If yes, then a) the old name should be kept as well for compatibility, b) how about `covering_patch` since toric varieties are printed as `covered by 5 affine patches`?\n5. \"algebraic\" attached to patches seems a bit weird to me...\n6. Aha, now I see that `affine_patch` is preserved. Now the question is - do we really need three functions or maybe `affine_patch` with several forms of input will do?..\n7. (line 2169) Why 0 is listed as one of the ideal generators?\n8. (line 2193) You have actually added a possibility to construct lattice polytopes from a list of points, without packing them into a matrix and then transposing ;-)",
    "created_at": "2011-05-28T22:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100328",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:9" align="right">comment:9</div>

Looks good!

For the second patch:
5. (line 433) The implementation looks very confusing to me: why would you store in the field `embedding_morphism` an exception??? I would expect either returning the stored value if it exists, or constructing the default embedding into the ambient space...
1. (line 441) Am I right that `embedding_origin` may be a non-origin as in not (0,0,0)? In this case I kind of really don't like using the word `origin`, how about `marked_point` instead or `embegging_marking` or `embedding_center` to put it next to the embedding?
2. (line 1847) There should be no "local", this scheme is just isomorphic to a neighbourhood of the point.
3. (line 1859) <code>\`\`result.embedding_morphism\`\`</code> should be more like <code>:meth:\`embedding_morphism\`</code> or at least <code>\`\`result.embedding_morphism()\`\`</code>, same for (1862).
4. (line 2076) `affine_patch` was used for compatibility with projective spaces, do we really need to change its name? If yes, then a) the old name should be kept as well for compatibility, b) how about `covering_patch` since toric varieties are printed as `covered by 5 affine patches`?
5. "algebraic" attached to patches seems a bit weird to me...
6. Aha, now I see that `affine_patch` is preserved. Now the question is - do we really need three functions or maybe `affine_patch` with several forms of input will do?..
7. (line 2169) Why 0 is listed as one of the ideal generators?
8. (line 2193) You have actually added a possibility to construct lattice polytopes from a list of points, without packing them into a matrix and then transposing ;-)



---

archive/issue_comments_100329.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n5. (line 433) In some (singular) cases you can't express the\n     embedding morphism as polynomial map, so it currently can't be\n     represented in Sage. The embedding morphism is constructed as a\n     byproduct of the patch, so we can't immediately raise an\n     exception. Really, we only need the patch and the pull-back of\n     ideals and never the embedding morphism.\n\n   6. (line 441) You are right, I changed it to `embedding_center`.\n\n   7. (line 1847) fixed.\n\n   8. (line 1859) fixed. \n\n   9. (line 2076) I removed the `toric_algebraic_patch()` which was an\n     alias for `affine_patch()`. \n\n   For projective space, `affine_patch()` returns the cover by\n   affine space. The natural analog for toric varieties is the cover\n   by an affine toric variety, and is again called\n   `affine_patch()`. There is also a useful patch covering by an\n   affine algebraic variety, which I called\n   `affine_algebraic_patch`. I do want to distinguish `affine_patch`\n   and `affine_algebraic_patch` since they produce very different\n   output.\n\n10. (line 2169) I added an extra line to filter out the 0 generator to the ideal, though mathematically it of course makes no difference.\n\n21. (line 2193) thanks for reminding me :-)",
    "created_at": "2011-06-04T20:57:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100329",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

5. (line 433) In some (singular) cases you can't express the
     embedding morphism as polynomial map, so it currently can't be
     represented in Sage. The embedding morphism is constructed as a
     byproduct of the patch, so we can't immediately raise an
     exception. Really, we only need the patch and the pull-back of
     ideals and never the embedding morphism.

   6. (line 441) You are right, I changed it to `embedding_center`.

   7. (line 1847) fixed.

   8. (line 1859) fixed. 

   9. (line 2076) I removed the `toric_algebraic_patch()` which was an
     alias for `affine_patch()`. 

   For projective space, `affine_patch()` returns the cover by
   affine space. The natural analog for toric varieties is the cover
   by an affine toric variety, and is again called
   `affine_patch()`. There is also a useful patch covering by an
   affine algebraic variety, which I called
   `affine_algebraic_patch`. I do want to distinguish `affine_patch`
   and `affine_algebraic_patch` since they produce very different
   output.

10. (line 2169) I added an extra line to filter out the 0 generator to the ideal, though mathematically it of course makes no difference.

21. (line 2193) thanks for reminding me :-)



---

archive/issue_comments_100330.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-06-04T20:57:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100330",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_100331.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAttachment: **[trac_10540_Spec_of_affine_toric_variety.patch.gz](https://github.com/sagemath/sage/files/ticket10540/trac_10540_Spec_of_affine_toric_variety.patch.gz)**\n\nI am getting the following:\n\n```\nnovoselt@geom:/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main$ ../../sage -t sage/schemes/generic/toric_ideal.py \nsage -t  \"devel/sage-main/sage/schemes/generic/toric_ideal.py\"\n**********************************************************************\nFile \"/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py\", line 24:\n    sage: IA.ker()\nExpected:\n    Free module of degree 3 and rank 1 over Integer Ring\n    User basis matrix:\n    [ 1 -2  1]\nGot:\n    Free module of degree 3 and rank 1 over Integer Ring\n    Echelon basis matrix:\n    [ 1 -2  1]\n**********************************************************************\nFile \"/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py\", line 39:\n    sage: IA.ker()\nExpected:\n    Free module of degree 4 and rank 2 over Integer Ring\n    User basis matrix:\n    [ 1 -1 -1  1]\n    [ 1 -2  1  0]\nGot:\n    Free module of degree 4 and rank 2 over Integer Ring\n    Echelon basis matrix:\n    [ 1  0 -3  2]\n    [ 0  1 -2  1]\n**********************************************************************\nFile \"/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py\", line 298:\n    sage: IA.ker()\nExpected:\n    Free module of degree 3 and rank 1 over Integer Ring\n    User basis matrix:\n    [ 1 -2  1]\nGot:\n    Free module of degree 3 and rank 1 over Integer Ring\n    Echelon basis matrix:\n    [ 1 -2  1]\n**********************************************************************\nFile \"/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py\", line 379:\n    sage: IA.ker()\nExpected:\n    Free module of degree 3 and rank 1 over Integer Ring\n    User basis matrix:\n    [ 1 -2  1]\nGot:\n    Free module of degree 3 and rank 1 over Integer Ring\n    Echelon basis matrix:\n    [ 1 -2  1]\n**********************************************************************\nFile \"/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py\", line 420:\n    sage: IA._ideal_quotient_by_variable(R, J0, 0)\nExpected:\n    Ideal (z2*z3^2 - z0*z1*z4, z1*z3 - z0*z2,\n           z2^2*z3 - z1^2*z4, z1^3*z4 - z0*z2^3)\n    of Multivariate Polynomial Ring in z0, z1, z2, z3, z4 over Rational Field\nGot:\n    Ideal (z2*z3^2 - z0*z1*z4, z2^2*z3 - z1^2*z4, z1^2*z3*z4 - z0*z1*z2*z4, z1^4*z4^2 - z0*z1*z2^3*z4) of Multivariate Polynomial Ring in z0, z1, z2, z3, z4 over Rational Field\n**********************************************************************\n4 items had failures:\n   2 of  26 in __main__.example_0\n   1 of   6 in __main__.example_4\n   1 of   7 in __main__.example_7\n   1 of   8 in __main__.example_8\n***Test Failed*** 5 failures.\nFor whitespace errors, see the file /home/novoselt/.sage//tmp/.doctest_toric_ideal.py\n\t [7.1 s]\n```\nAlso, it seems that with `-long` option the long test is really long both on my machine and on sage.math, although I didn't try any other version of Sage but 4.7.1.alpha2. Applying Hilbert cone speed up does not seem to help.",
    "created_at": "2011-06-13T23:08:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100331",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:11" align="right">comment:11</div>

Attachment: **[trac_10540_Spec_of_affine_toric_variety.patch.gz](https://github.com/sagemath/sage/files/ticket10540/trac_10540_Spec_of_affine_toric_variety.patch.gz)**

I am getting the following:

```
novoselt@geom:/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main$ ../../sage -t sage/schemes/generic/toric_ideal.py 
sage -t  "devel/sage-main/sage/schemes/generic/toric_ideal.py"
**********************************************************************
File "/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py", line 24:
    sage: IA.ker()
Expected:
    Free module of degree 3 and rank 1 over Integer Ring
    User basis matrix:
    [ 1 -2  1]
Got:
    Free module of degree 3 and rank 1 over Integer Ring
    Echelon basis matrix:
    [ 1 -2  1]
**********************************************************************
File "/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py", line 39:
    sage: IA.ker()
Expected:
    Free module of degree 4 and rank 2 over Integer Ring
    User basis matrix:
    [ 1 -1 -1  1]
    [ 1 -2  1  0]
Got:
    Free module of degree 4 and rank 2 over Integer Ring
    Echelon basis matrix:
    [ 1  0 -3  2]
    [ 0  1 -2  1]
**********************************************************************
File "/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py", line 298:
    sage: IA.ker()
Expected:
    Free module of degree 3 and rank 1 over Integer Ring
    User basis matrix:
    [ 1 -2  1]
Got:
    Free module of degree 3 and rank 1 over Integer Ring
    Echelon basis matrix:
    [ 1 -2  1]
**********************************************************************
File "/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py", line 379:
    sage: IA.ker()
Expected:
    Free module of degree 3 and rank 1 over Integer Ring
    User basis matrix:
    [ 1 -2  1]
Got:
    Free module of degree 3 and rank 1 over Integer Ring
    Echelon basis matrix:
    [ 1 -2  1]
**********************************************************************
File "/disk/scratch/novoselt/sage-4.7.1.alpha2/devel/sage-main/sage/schemes/generic/toric_ideal.py", line 420:
    sage: IA._ideal_quotient_by_variable(R, J0, 0)
Expected:
    Ideal (z2*z3^2 - z0*z1*z4, z1*z3 - z0*z2,
           z2^2*z3 - z1^2*z4, z1^3*z4 - z0*z2^3)
    of Multivariate Polynomial Ring in z0, z1, z2, z3, z4 over Rational Field
Got:
    Ideal (z2*z3^2 - z0*z1*z4, z2^2*z3 - z1^2*z4, z1^2*z3*z4 - z0*z1*z2*z4, z1^4*z4^2 - z0*z1*z2^3*z4) of Multivariate Polynomial Ring in z0, z1, z2, z3, z4 over Rational Field
**********************************************************************
4 items had failures:
   2 of  26 in __main__.example_0
   1 of   6 in __main__.example_4
   1 of   7 in __main__.example_7
   1 of   8 in __main__.example_8
***Test Failed*** 5 failures.
For whitespace errors, see the file /home/novoselt/.sage//tmp/.doctest_toric_ideal.py
	 [7.1 s]
```
Also, it seems that with `-long` option the long test is really long both on my machine and on sage.math, although I didn't try any other version of Sage but 4.7.1.alpha2. Applying Hilbert cone speed up does not seem to help.



---

archive/issue_comments_100332.json:
```json
{
    "body": "Work Issues: **doctest failures**",
    "created_at": "2011-06-13T23:08:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100332",
    "user": "https://github.com/novoselt"
}
```

Work Issues: **doctest failures**



---

archive/issue_comments_100333.json:
```json
{
    "body": "Attachment: **[trac_10540_toric_ideals.patch.gz](https://github.com/sagemath/sage/files/ticket10540/trac_10540_toric_ideals.patch.gz)**\n\nUpdated patch",
    "created_at": "2011-06-14T15:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100333",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_10540_toric_ideals.patch.gz](https://github.com/sagemath/sage/files/ticket10540/trac_10540_toric_ideals.patch.gz)**

Updated patch



---

archive/issue_comments_100334.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAndrey reported a performance regression in Sage-4.7.1.alpha2 for the long doctests. The reason is that the syntax for computing the LLL-reduced kernel changed from `A.right_kernel(LLL=True)` to `A.right_kernel(basis='LLL')`. Unfortunately #10746 did not add a deprecation warning, but then we were the only users of the `LLL=True` syntax. The result was that Sage-4.7.1.alpha2 computed the naive ideal with the echelon form of the kernel and not the LLL-reduced form, which makes the Groebner basis computations much much harder.\n\nThe updated patch switches to the new syntax and works as fast as before.",
    "created_at": "2011-06-14T15:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100334",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>

Andrey reported a performance regression in Sage-4.7.1.alpha2 for the long doctests. The reason is that the syntax for computing the LLL-reduced kernel changed from `A.right_kernel(LLL=True)` to `A.right_kernel(basis='LLL')`. Unfortunately #10746 did not add a deprecation warning, but then we were the only users of the `LLL=True` syntax. The result was that Sage-4.7.1.alpha2 computed the naive ideal with the echelon form of the kernel and not the LLL-reduced form, which makes the Groebner basis computations much much harder.

The updated patch switches to the new syntax and works as fast as before.



---

archive/issue_comments_100335.json:
```json
{
    "body": "Changed keywords from none to **sd31**",
    "created_at": "2011-06-14T15:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100335",
    "user": "https://github.com/vbraun"
}
```

Changed keywords from none to **sd31**



---

archive/issue_comments_100336.json:
```json
{
    "body": "Changed work issues from **doctest failures** to none",
    "created_at": "2011-06-14T15:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100336",
    "user": "https://github.com/vbraun"
}
```

Changed work issues from **doctest failures** to none



---

archive/issue_comments_100337.json:
```json
{
    "body": "Changed dependencies from **#9918, #10525, #10023, #10529** to **#9918, #10525, #10023, #10529, #11481**",
    "created_at": "2011-06-14T15:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100337",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#9918, #10525, #10023, #10529** to **#9918, #10525, #10023, #10529, #11481**



---

archive/issue_comments_100338.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOne of the doctests crashes with Sage-4.7.alpha2 because of #11481.",
    "created_at": "2011-06-14T15:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100338",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

One of the doctests crashes with Sage-4.7.alpha2 because of #11481.



---

archive/issue_comments_100339.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThe doctests pass with the patch from #11481.",
    "created_at": "2011-06-14T16:24:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100339",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">comment:14</div>

The doctests pass with the patch from #11481.



---

archive/issue_comments_100340.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nEverything works now and once #11481 is approved, I am happy to switch this one (and #10529) to positive review!",
    "created_at": "2011-06-14T20:39:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100340",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:15" align="right">comment:15</div>

Everything works now and once #11481 is approved, I am happy to switch this one (and #10529) to positive review!



---

archive/issue_events_137279.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-06-15T20:34:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137279"
}
```



---

archive/issue_events_137280.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-06-15T20:34:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137280"
}
```



---

archive/issue_comments_100341.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHi Jeroen, if there is any chance to include this ticket into 4.7.1, it would be greatly appreciated! (I am participating in a toric summer school in a month and it would be great if this functionality was available in a stable release by then.)",
    "created_at": "2011-06-16T06:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100341",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:17" align="right">comment:17</div>

Hi Jeroen, if there is any chance to include this ticket into 4.7.1, it would be greatly appreciated! (I am participating in a toric summer school in a month and it would be great if this functionality was available in a stable release by then.)



---

archive/issue_events_137281.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-24T09:20:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137281"
}
```



---

archive/issue_events_137282.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-24T09:20:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10540#event-137282"
}
```



---

archive/issue_comments_100342.json:
```json
{
    "body": "Merged: **sage-4.7.1.alpha4**",
    "created_at": "2011-06-24T09:20:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10540#issuecomment-100342",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.1.alpha4**
