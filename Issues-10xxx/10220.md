# Issue 10220: Unnecessary imports cause slower sage startup

archive/issues_010219.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @robertwb @mwhansen\n\nKeywords: import startuptime\n\nThis ticket takes care of some unnecessary imports that were done at startup time instead of inside of functions.  It takes care of some of the worst offenders when sage -startuptime is run.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10220\n\n",
    "closed_at": "2010-12-02T23:05:42Z",
    "created_at": "2010-11-05T12:34:11Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "Unnecessary imports cause slower sage startup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10220",
    "user": "https://github.com/jasongrout"
}
```
Assignee: tbd

CC:  @robertwb @mwhansen

Keywords: import startuptime

This ticket takes care of some unnecessary imports that were done at startup time instead of inside of functions.  It takes care of some of the worst offenders when sage -startuptime is run.

Issue created by migration from https://trac.sagemath.org/ticket/10220





---

archive/issue_comments_103833.json:
```json
{
    "body": "Attachment [trac-10220-speedup.patch](tarball://root/attachments/some-uuid/ticket10220/trac-10220-speedup.patch) by @jasongrout created at 2010-11-05 12:35:27",
    "created_at": "2010-11-05T12:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103833",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac-10220-speedup.patch](tarball://root/attachments/some-uuid/ticket10220/trac-10220-speedup.patch) by @jasongrout created at 2010-11-05 12:35:27



---

archive/issue_comments_103834.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2010-11-05T12:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103834",
    "user": "https://github.com/jasongrout"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_103835.json:
```json
{
    "body": "I haven't run full doctests yet, so I guess this is needs work right now.  I think it's good to go, though, modulo running doctests.",
    "created_at": "2010-11-05T12:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103835",
    "user": "https://github.com/jasongrout"
}
```

I haven't run full doctests yet, so I guess this is needs work right now.  I think it's good to go, though, modulo running doctests.



---

archive/issue_comments_103836.json:
```json
{
    "body": "What is the actual speedup?",
    "created_at": "2010-11-05T18:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103836",
    "user": "https://github.com/mwhansen"
}
```

What is the actual speedup?



---

archive/issue_comments_103837.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2010-11-25T22:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103837",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_103838.json:
```json
{
    "body": "Works for me.",
    "created_at": "2010-11-25T22:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103838",
    "user": "https://github.com/jdemeyer"
}
```

Works for me.



---

archive/issue_comments_103839.json:
```json
{
    "body": "What is the actual speedup?",
    "created_at": "2010-11-25T22:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103839",
    "user": "https://github.com/mwhansen"
}
```

What is the actual speedup?



---

archive/issue_comments_103840.json:
```json
{
    "body": "Replying to [comment:4 mhansen]:\n> What is the actual speedup?\n\n\nStatistically insignificant...",
    "created_at": "2010-11-26T12:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103840",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 mhansen]:
> What is the actual speedup?


Statistically insignificant...



---

archive/issue_events_026205.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-26T12:58:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10220#event-26205"
}
```



---

archive/issue_comments_103841.json:
```json
{
    "body": "To really speed stuff up you have to eliminate all imports of a module. Easier said than done.",
    "created_at": "2010-11-30T05:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103841",
    "user": "https://github.com/robertwb"
}
```

To really speed stuff up you have to eliminate all imports of a module. Easier said than done.



---

archive/issue_comments_103842.json:
```json
{
    "body": "Replying to [comment:6 robertwb]:\n> To really speed stuff up you have to eliminate all imports of a module. Easier said than done. \n\n\nFor example, http://trac.sagemath.org/sage_trac/ticket/6494",
    "created_at": "2010-11-30T05:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103842",
    "user": "https://github.com/mwhansen"
}
```

Replying to [comment:6 robertwb]:
> To really speed stuff up you have to eliminate all imports of a module. Easier said than done. 


For example, http://trac.sagemath.org/sage_trac/ticket/6494



---

archive/issue_comments_103843.json:
```json
{
    "body": "Should this be merged if it doesn't change the startuptime?",
    "created_at": "2010-12-02T13:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103843",
    "user": "https://github.com/jdemeyer"
}
```

Should this be merged if it doesn't change the startuptime?



---

archive/issue_events_026206.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-02T13:10:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10220#event-26206"
}
```



---

archive/issue_events_026207.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-02T13:10:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "milestone": "sage-feature",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10220#event-26207"
}
```



---

archive/issue_comments_103844.json:
```json
{
    "body": "I agree with both robertwb and jdemeyer.  When I test it, startup doesn't seem to go down significantly, though the top one or two entries from sage -startup are eliminated.\n\nI think the patch is helpful, but maybe doesn't go far enough to eliminate all imports of a package.\n\nThis is interesting, since this patch eliminates the imports with a - next to them in my list of slowest imports in sage -startup.  However, the overall startup time does not seem to diminish appreciably.  I suppose other modules take the \"-\" places below so that startuptime doesn't really go down?  Or is it that the modules are loaded anyway somewhere else, and loading a module a second time (even in a different module) is insignificant?\n\n```\nsage.all: 1.608 (None)\n\n\n1.608 sage.all (None)\n0.387 sage.schemes.all (sage.all)\n0.279 elliptic_curves.all (sage.schemes.all)\n0.275 ell_rational_field (elliptic_curves.all)\n0.245 ell_number_field (ell_rational_field)\n0.244 sage.misc.all (sage.all)\n0.243 ell_field (ell_number_field)\n0.242 ell_curve_isogeny (ell_field)\n0.190 sage.modular.all (sage.all)\n0.151 twisted.persisted.styles (sage.all)\n0.146 abvar.all (sage.modular.all)\n0.145 abvar_newform (abvar.all)\n0.141 abvar (abvar_newform)\n0.135 sage.groups.all (abvar)\n0.124 perm_gps.all (sage.groups.all)\n-0.122 cubegroup (perm_gps.all)\n0.117 sage.rings.all (sage.all)\n-0.113 sage.plot.all (cubegroup)\n0.111 sage.symbolic.pynac (sage.all)\n0.106 hyperelliptic_curves.all (sage.schemes.all)\n0.105 sage_input (sage.misc.all)\n-0.104 sage.misc.functional (sage_input)\n-0.098 complex_plot (sage.plot.all)\n-0.097 numpy (complex_plot)\n0.096 sage.schemes.generic.all (hyperelliptic_curves.all)\n0.090 fano_toric_variety (sage.schemes.generic.all)\n0.088 sage.geometry.all (fano_toric_variety)\n0.084 cone (sage.geometry.all)\n0.084 zope.interface (twisted.persisted.styles)\n0.081 sage_timeit_class (sage.misc.all)\n0.081 sage.rings.complex_double (sage.misc.functional)\n-0.081 sage_timeit (sage_timeit_class)\n0.080 add_newdocs (numpy)\n-0.079 interpreter (sage_timeit)\n-0.078 IPython.ipapi (interpreter)\n0.076 pkg_resources (zope.interface)\n0.073 lib (add_newdocs)\n0.073 sage.combinat.all (sage.all)\n0.063 type_check (lib)\n0.063 numpy.core.numeric (type_check)\n0.063 sage.algebras.all (sage.all)\n0.046 numeric (numpy.core.numeric)\n0.046 misc (sage.misc.all)\n0.045 sage.combinat.posets.posets (cone)\n0.042 sage.graphs.all (sage.combinat.posets.posets)\n0.041 Shell (IPython.ipapi)\n0.039 sage.server.all (sage.all)\n0.037 notebook.all (sage.server.all)\n0.037 sagenb.notebook.all (notebook.all)\n0.037 notebook_object (sagenb.notebook.all)\n```",
    "created_at": "2010-12-02T16:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103844",
    "user": "https://github.com/jasongrout"
}
```

I agree with both robertwb and jdemeyer.  When I test it, startup doesn't seem to go down significantly, though the top one or two entries from sage -startup are eliminated.

I think the patch is helpful, but maybe doesn't go far enough to eliminate all imports of a package.

This is interesting, since this patch eliminates the imports with a - next to them in my list of slowest imports in sage -startup.  However, the overall startup time does not seem to diminish appreciably.  I suppose other modules take the "-" places below so that startuptime doesn't really go down?  Or is it that the modules are loaded anyway somewhere else, and loading a module a second time (even in a different module) is insignificant?

```
sage.all: 1.608 (None)


1.608 sage.all (None)
0.387 sage.schemes.all (sage.all)
0.279 elliptic_curves.all (sage.schemes.all)
0.275 ell_rational_field (elliptic_curves.all)
0.245 ell_number_field (ell_rational_field)
0.244 sage.misc.all (sage.all)
0.243 ell_field (ell_number_field)
0.242 ell_curve_isogeny (ell_field)
0.190 sage.modular.all (sage.all)
0.151 twisted.persisted.styles (sage.all)
0.146 abvar.all (sage.modular.all)
0.145 abvar_newform (abvar.all)
0.141 abvar (abvar_newform)
0.135 sage.groups.all (abvar)
0.124 perm_gps.all (sage.groups.all)
-0.122 cubegroup (perm_gps.all)
0.117 sage.rings.all (sage.all)
-0.113 sage.plot.all (cubegroup)
0.111 sage.symbolic.pynac (sage.all)
0.106 hyperelliptic_curves.all (sage.schemes.all)
0.105 sage_input (sage.misc.all)
-0.104 sage.misc.functional (sage_input)
-0.098 complex_plot (sage.plot.all)
-0.097 numpy (complex_plot)
0.096 sage.schemes.generic.all (hyperelliptic_curves.all)
0.090 fano_toric_variety (sage.schemes.generic.all)
0.088 sage.geometry.all (fano_toric_variety)
0.084 cone (sage.geometry.all)
0.084 zope.interface (twisted.persisted.styles)
0.081 sage_timeit_class (sage.misc.all)
0.081 sage.rings.complex_double (sage.misc.functional)
-0.081 sage_timeit (sage_timeit_class)
0.080 add_newdocs (numpy)
-0.079 interpreter (sage_timeit)
-0.078 IPython.ipapi (interpreter)
0.076 pkg_resources (zope.interface)
0.073 lib (add_newdocs)
0.073 sage.combinat.all (sage.all)
0.063 type_check (lib)
0.063 numpy.core.numeric (type_check)
0.063 sage.algebras.all (sage.all)
0.046 numeric (numpy.core.numeric)
0.046 misc (sage.misc.all)
0.045 sage.combinat.posets.posets (cone)
0.042 sage.graphs.all (sage.combinat.posets.posets)
0.041 Shell (IPython.ipapi)
0.039 sage.server.all (sage.all)
0.037 notebook.all (sage.server.all)
0.037 sagenb.notebook.all (notebook.all)
0.037 notebook_object (sagenb.notebook.all)
```



---

archive/issue_comments_103845.json:
```json
{
    "body": "I'm in favor of any patches that remove unnecessary imports, as it will make the import order (which is now a mess) easier to understand and actual speedups easier to achieve.",
    "created_at": "2010-12-02T18:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103845",
    "user": "https://github.com/robertwb"
}
```

I'm in favor of any patches that remove unnecessary imports, as it will make the import order (which is now a mess) easier to understand and actual speedups easier to achieve.



---

archive/issue_events_026208.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-02T23:05:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "milestone": "sage-feature",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10220#event-26208"
}
```



---

archive/issue_events_026209.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-02T23:05:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10220#event-26209"
}
```



---

archive/issue_events_026210.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-02T23:05:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10220#event-26210"
}
```



---

archive/issue_comments_103846.json:
```json
{
    "body": "Changing keywords from \"\" to \"import startuptime\".",
    "created_at": "2010-12-02T23:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103846",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "" to "import startuptime".



---

archive/issue_comments_103847.json:
```json
{
    "body": "Replying to [comment:10 robertwb]:\n> I'm in favor of any patches that remove unnecessary imports, as it will make the import order (which is now a mess) easier to understand and actual speedups easier to achieve. \n\n\nAs you wish :-)",
    "created_at": "2010-12-02T23:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103847",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 robertwb]:
> I'm in favor of any patches that remove unnecessary imports, as it will make the import order (which is now a mess) easier to understand and actual speedups easier to achieve. 


As you wish :-)



---

archive/issue_comments_103848.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-12-02T23:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10220#issuecomment-103848",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
