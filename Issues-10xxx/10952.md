# Issue 10952: better numerical accuracy testing

archive/issues_010873.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mvngu"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nIf a line contains `tol` or `tolerance`, numerical results are only \nverified to the given tolerance. This may be prefixed by `abs[olute]` or `rel[ative]` to specify whether to measure absolute or relative error; defaults to relative error except when the expected value is exactly zero: \n\n```\n        sage: RDF(pi)                               # abs tol 1e-5 \n        3.14159 \n        sage: [10^n for n in [0.0 .. 4]]            # rel tol 2e-4 \n        [0.9999, 10.001, 100.01, 999.9, 10001] \n```\n\nThis can be useful when the exact output is subject to rounding error and/or processor floating point arithmetic variation. \n\n---\n\nRelated:\n* `.zero_at(epsilon)` methods, to fix noisy (and signed) zeroes; see for example #11848.\n\n---\n\nApply\n1. [attachment: 10952-tol-bin.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)\n2. [attachment: trac_10952-ref.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-ref.patch.gz)\nto the Sage **scripts repository**.\n\nApply\n1. [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)\n2. [attachment: trac_10952-reviewer-docs-v3.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz)\nto the Sage library repository.\n\n\nCC:  @jasongrout @kcrisman\n\nComponent: **doctest coverage**\n\nKeywords: **sd32 noise noisy doctest failure error tolerance**\n\nAuthor: **Robert Bradshaw, Rob Beezer**\n\nReviewer: **Jason Grout, Mariah Lenox, William Stein, John Palmieri**\n\nMerged: **sage-4.7.2.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10952_\n\n",
    "closed_at": "2011-09-27T17:41:07Z",
    "created_at": "2011-03-17T08:10:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/doctest%20coverage",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/doctest%20coverage"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "better numerical accuracy testing",
    "type": "issue",
    "updated_at": "2012-02-10T20:07:22Z",
    "url": "https://github.com/sagemath/sage/issues/10952",
    "user": "https://github.com/robertwb"
}
```
<div id="comment:0"></div>

If a line contains `tol` or `tolerance`, numerical results are only 
verified to the given tolerance. This may be prefixed by `abs[olute]` or `rel[ative]` to specify whether to measure absolute or relative error; defaults to relative error except when the expected value is exactly zero: 

```
        sage: RDF(pi)                               # abs tol 1e-5 
        3.14159 
        sage: [10^n for n in [0.0 .. 4]]            # rel tol 2e-4 
        [0.9999, 10.001, 100.01, 999.9, 10001] 
```

This can be useful when the exact output is subject to rounding error and/or processor floating point arithmetic variation. 

---

Related:
* `.zero_at(epsilon)` methods, to fix noisy (and signed) zeroes; see for example #11848.

---

Apply
1. [attachment: 10952-tol-bin.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)
2. [attachment: trac_10952-ref.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-ref.patch.gz)
to the Sage **scripts repository**.

Apply
1. [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)
2. [attachment: trac_10952-reviewer-docs-v3.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz)
to the Sage library repository.


CC:  @jasongrout @kcrisman

Component: **doctest coverage**

Keywords: **sd32 noise noisy doctest failure error tolerance**

Author: **Robert Bradshaw, Rob Beezer**

Reviewer: **Jason Grout, Mariah Lenox, William Stein, John Palmieri**

Merged: **sage-4.7.2.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/10952_





---

archive/issue_events_143778.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-03-17T08:10:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143778"
}
```



---

archive/issue_events_143779.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-03-17T08:10:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143779"
}
```



---

archive/issue_events_143780.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-03-17T08:10:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143780"
}
```



---

archive/issue_events_143781.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2011-03-17T08:10:07Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "subject": "https://github.com/robertwb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143781"
}
```



---

archive/issue_comments_106474.json:
```json
{
    "body": "Attachment: **[noise.patch.gz](https://github.com/sagemath/sage/files/ticket10952/noise.patch.gz)**",
    "created_at": "2011-03-17T08:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106474",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[noise.patch.gz](https://github.com/sagemath/sage/files/ticket10952/noise.patch.gz)**



---

archive/issue_events_143782.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-03-17T08:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143782"
}
```



---

archive/issue_comments_106475.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,6 @@\n \n ```\n-sage: 1.5 # tol 1e-3\n-1.499999\n+sage: print \"The answers are\", 1.5, 2, 1e-12 # tol 1e-3\n+The answers are 1.499999 2.0001 0\n ```\n+\n``````\n",
    "created_at": "2011-03-17T08:13:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106475",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,6 @@
 
 ```
-sage: 1.5 # tol 1e-3
-1.499999
+sage: print "The answers are", 1.5, 2, 1e-12 # tol 1e-3
+The answers are 1.499999 2.0001 0
 ```
+
``````




---

archive/issue_comments_106476.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAmazing speed getting this up!  Shouldn't \"((?:abs(?:solute)?)\" be \"((?:abs(?:olute)?)\" ?",
    "created_at": "2011-03-17T13:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106476",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:2" align="right">comment:2</div>

Amazing speed getting this up!  Shouldn't "((?:abs(?:solute)?)" be "((?:abs(?:olute)?)" ?



---

archive/issue_comments_106477.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nNitpicky: This comment is now incorrect:\n\n```\n# following three: used only for parsing only_optional; list of comments \n```\n\nAlso, something should be added to the docs about this new option.  Perhaps here: http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples",
    "created_at": "2011-03-17T13:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106477",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">comment:3</div>

Nitpicky: This comment is now incorrect:

```
# following three: used only for parsing only_optional; list of comments 
```

Also, something should be added to the docs about this new option.  Perhaps here: http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples



---

archive/issue_comments_106478.json:
```json
{
    "body": "apply only this patch to the bin repo",
    "created_at": "2011-03-18T06:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106478",
    "user": "https://github.com/robertwb"
}
```

apply only this patch to the bin repo



---

archive/issue_comments_106479.json:
```json
{
    "body": "Attachment: **[10952-tol-bin.patch.gz](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)**",
    "created_at": "2011-03-18T06:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106479",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[10952-tol-bin.patch.gz](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)**



---

archive/issue_comments_106480.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAttachment: **[10952-tol-doc.patch.gz](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.patch.gz)**\n\nThanks for the comments, new patches attached.",
    "created_at": "2011-03-18T06:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106480",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:4" align="right">comment:4</div>

Attachment: **[10952-tol-doc.patch.gz](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.patch.gz)**

Thanks for the comments, new patches attached.



---

archive/issue_comments_106481.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWould this works with test of that kind as well:\n\n```\nFile \"/usr/share/sage/devel/sage-main/sage/stats/hmm/chmm.pyx\", line 579:\n    sage: m.viterbi([-2,-1,.1,0.3])\nExpected:\n    ([1, 1, 1, 0], -9.5660236533785135)\nGot:\n    ([1, 1, 1, 0], -9.566023653378513)\n```\nor even\n\n```\nFile \"/usr/share/sage/devel/sage-main/sage/categories/examples/semigroups.py\", line 32:\n    sage: S.some_elements()\nExpected:\n    [3, 42, 'a', 3.3999999999999999, 'raton laveur']\nGot:\n    [3, 42, 'a', 3.4, 'raton laveur']\n```\n(test failures courtesy of my work on python-2.7)",
    "created_at": "2011-04-24T03:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106481",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

Would this works with test of that kind as well:

```
File "/usr/share/sage/devel/sage-main/sage/stats/hmm/chmm.pyx", line 579:
    sage: m.viterbi([-2,-1,.1,0.3])
Expected:
    ([1, 1, 1, 0], -9.5660236533785135)
Got:
    ([1, 1, 1, 0], -9.566023653378513)
```
or even

```
File "/usr/share/sage/devel/sage-main/sage/categories/examples/semigroups.py", line 32:
    sage: S.some_elements()
Expected:
    [3, 42, 'a', 3.3999999999999999, 'raton laveur']
Got:
    [3, 42, 'a', 3.4, 'raton laveur']
```
(test failures courtesy of my work on python-2.7)



---

archive/issue_comments_106482.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nYes, it would (though you do have to explicitly annotate the test with a tolerance, and if Python 2.7 consistently gives, e.g., 3.4 then we should change the doctest rather than make it fuzzy.)",
    "created_at": "2011-04-24T04:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106482",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:7" align="right">comment:7</div>

Yes, it would (though you do have to explicitly annotate the test with a tolerance, and if Python 2.7 consistently gives, e.g., 3.4 then we should change the doctest rather than make it fuzzy.)



---

archive/issue_comments_106483.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIn trying to review this ticket, I applied 10952-tol-bin.patch in the local/bin directory of a skynet/taurus (x86_64-Linux-nehalem) build of sage-4.7.rc2.  I next did 'sage -b'.  Yet I get\n\n```\nsage: print \"The answers are\", 1.5, 2, 1e-12 # tol 1e-3\nThe answers are 1.50000000000000 2 1.00000000000000e-12\n```\n\nAm I missing something?",
    "created_at": "2011-05-13T14:19:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106483",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:8" align="right">comment:8</div>

In trying to review this ticket, I applied 10952-tol-bin.patch in the local/bin directory of a skynet/taurus (x86_64-Linux-nehalem) build of sage-4.7.rc2.  I next did 'sage -b'.  Yet I get

```
sage: print "The answers are", 1.5, 2, 1e-12 # tol 1e-3
The answers are 1.50000000000000 2 1.00000000000000e-12
```

Am I missing something?



---

archive/issue_events_143783.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-13T14:19:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143783"
}
```



---

archive/issue_events_143784.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-13T14:19:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143784"
}
```



---

archive/issue_comments_106484.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nNo, that is correct.\n\nThe example in the description is an example of something that would pass doctests (even though the true output doesn't match exactly, you're seeing what the actual output is).",
    "created_at": "2011-05-14T00:24:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106484",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:9" align="right">comment:9</div>

No, that is correct.

The example in the description is an example of something that would pass doctests (even though the true output doesn't match exactly, you're seeing what the actual output is).



---

archive/issue_comments_106485.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAnother nitpicky: the doc patch misspells \"arithmetic\".  Definitely not big enough to stop a positive review, but also not big enough to be worth my effort in making a new patch right now.",
    "created_at": "2011-05-14T00:32:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106485",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:10" align="right">comment:10</div>

Another nitpicky: the doc patch misspells "arithmetic".  Definitely not big enough to stop a positive review, but also not big enough to be worth my effort in making a new patch right now.



---

archive/issue_comments_106486.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAttachment: **[10952-tol-doc.2.patch.gz](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)**\n\nArgh. Fixed.",
    "created_at": "2011-05-14T00:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106486",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:11" align="right">comment:11</div>

Attachment: **[10952-tol-doc.2.patch.gz](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)**

Argh. Fixed.



---

archive/issue_comments_106487.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThanks!  If we had a github pull system, or a system where I could edit the patch inline, I would have fixed it.",
    "created_at": "2011-05-14T00:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106487",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:12" align="right">comment:12</div>

Thanks!  If we had a github pull system, or a system where I could edit the patch inline, I would have fixed it.



---

archive/issue_events_143785.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-05-14T11:22:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143785"
}
```



---

archive/issue_events_143786.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-05-14T11:22:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143786"
}
```



---

archive/issue_comments_106488.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jasongrout](#comment%3A12):\n> Thanks!  If we had a github pull system, or a system where I could edit the patch inline, I would have fixed it.\n\nI have to admit that *would* be convenient.  But wouldn't that create a privileged class of commit people who don't need review?  At least that seems to be the model for the projects I'm familiar with.",
    "created_at": "2011-05-14T11:22:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106488",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jasongrout](#comment%3A12):
> Thanks!  If we had a github pull system, or a system where I could edit the patch inline, I would have fixed it.

I have to admit that *would* be convenient.  But wouldn't that create a privileged class of commit people who don't need review?  At least that seems to be the model for the projects I'm familiar with.



---

archive/issue_comments_106489.json:
```json
{
    "body": "Reviewer: **Jason Grout**",
    "created_at": "2011-05-14T11:22:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106489",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Jason Grout**



---

archive/issue_comments_106490.json:
```json
{
    "body": "Author: **Robert Bradshaw**",
    "created_at": "2011-05-14T11:22:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106490",
    "user": "https://github.com/kcrisman"
}
```

Author: **Robert Bradshaw**



---

archive/issue_comments_106491.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThat *person* would be the release manager.  He would be the only one able (or supposed to) merge into the master branch.\n\nOn the other hand, given our problems with finding release managers who could do the entire release process, maybe sharing the burden to commit patches to master wouldn't be a bad idea.",
    "created_at": "2011-05-14T15:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106491",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:14" align="right">comment:14</div>

That *person* would be the release manager.  He would be the only one able (or supposed to) merge into the master branch.

On the other hand, given our problems with finding release managers who could do the entire release process, maybe sharing the burden to commit patches to master wouldn't be a bad idea.



---

archive/issue_comments_106492.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI applied 10952-tol-bin.patch in the local/bin directory of a skynet/taurus (x86_64-Linux-nehalem) build of sage-4.7.rc2. I next did 'sage -b'.  I then modified a doctest to include the lines in\nthe ticket description\n\n```\nsage: print \"The answers are\", 1.5, 2, 1e-12 # tol 1e-3\nThe answers are 1.499999 2.0001 0\n```\nI then did 'sage -b' again.  When I run the doctest, I get\n\n```\n% ./sage -t  -long -force_lib \"devel/sage/sage/symbolic/units.py\"\nsage -t -long -force_lib \"devel/sage/sage/symbolic/units.py\"\n**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10952/devel/sage/sage/symbolic/units.py\", line 13:\n    sage: print \"The answers are\", 1.5, 2, 1e-12 # tol 1e-3\nException raised:\n    Traceback (most recent call last):\n      File \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10952/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10952/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10952/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[6]>\", line 1\n         res =  print \"The answers are\", RealNumber('1.5'), Integer(2), RealNumber('1e-12') # tol 1e-3###line 13:\n    sage: print \"The answers are\", 1.5, 2, 1e-12 # tol 1e-3\n                    ^\n     SyntaxError: invalid syntax\n**********************************************************************\n```\n\nNote that if I put the lines \n\n```\n    sage: RDF(pi)                               # abs tol 1e-5\n    3.14159\n```\nin the doctest, then the doctest passes.",
    "created_at": "2011-05-16T15:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106492",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:15" align="right">comment:15</div>

I applied 10952-tol-bin.patch in the local/bin directory of a skynet/taurus (x86_64-Linux-nehalem) build of sage-4.7.rc2. I next did 'sage -b'.  I then modified a doctest to include the lines in
the ticket description

```
sage: print "The answers are", 1.5, 2, 1e-12 # tol 1e-3
The answers are 1.499999 2.0001 0
```
I then did 'sage -b' again.  When I run the doctest, I get

```
% ./sage -t  -long -force_lib "devel/sage/sage/symbolic/units.py"
sage -t -long -force_lib "devel/sage/sage/symbolic/units.py"
**********************************************************************
File "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10952/devel/sage/sage/symbolic/units.py", line 13:
    sage: print "The answers are", 1.5, 2, 1e-12 # tol 1e-3
Exception raised:
    Traceback (most recent call last):
      File "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10952/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10952/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10952/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[6]>", line 1
         res =  print "The answers are", RealNumber('1.5'), Integer(2), RealNumber('1e-12') # tol 1e-3###line 13:
    sage: print "The answers are", 1.5, 2, 1e-12 # tol 1e-3
                    ^
     SyntaxError: invalid syntax
**********************************************************************
```

Note that if I put the lines 

```
    sage: RDF(pi)                               # abs tol 1e-5
    3.14159
```
in the doctest, then the doctest passes.



---

archive/issue_events_143787.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-16T15:51:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143787"
}
```



---

archive/issue_events_143788.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-16T15:51:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143788"
}
```



---

archive/issue_events_143789.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-05-16T19:38:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143789"
}
```



---

archive/issue_events_143790.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-05-16T19:38:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143790"
}
```



---

archive/issue_comments_106493.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,15 @@\n+If a line contains ``tol`` or ``tolerance, numerical results are only \n+verified to the given tolerance. This may be prefixed by ``abs[olute`` \n+or ``rel[ative]`` to specify whether to measure absolute or relative \n+error; defaults to relative error except when the expected value is \n+exactly zero: \n \n ```\n-sage: print \"The answers are\", 1.5, 2, 1e-12 # tol 1e-3\n-The answers are 1.499999 2.0001 0\n+        sage: RDF(pi)                               # abs tol 1e-5 \n+        3.14159 \n+        sage: [10^n for n in [0.0 .. 4]]            # rel tol 2e-4 \n+        [0.9999, 10.001, 100.01, 999.9, 10001] \n ```\n \n+This can be useful when the exact output is subject to rounding error \n+and/or processor floating point arithmetic variation. \n``````\n",
    "created_at": "2011-05-16T19:38:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106493",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,15 @@
+If a line contains ``tol`` or ``tolerance, numerical results are only 
+verified to the given tolerance. This may be prefixed by ``abs[olute`` 
+or ``rel[ative]`` to specify whether to measure absolute or relative 
+error; defaults to relative error except when the expected value is 
+exactly zero: 
 
 ```
-sage: print "The answers are", 1.5, 2, 1e-12 # tol 1e-3
-The answers are 1.499999 2.0001 0
+        sage: RDF(pi)                               # abs tol 1e-5 
+        3.14159 
+        sage: [10^n for n in [0.0 .. 4]]            # rel tol 2e-4 
+        [0.9999, 10.001, 100.01, 999.9, 10001] 
 ```
 
+This can be useful when the exact output is subject to rounding error 
+and/or processor floating point arithmetic variation. 
``````




---

archive/issue_comments_106494.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nTrue. It doesn't work with print (or other non-expression statements). I've created #11336 to generalize it. \n\nI think that this is still plenty useful even with that limitation, and don't know when I'll have more time to work on it--we could either get this in and start using it now or hold off until has time to write a more complete implementation at some later date (which I'd like to get to someday, but that someday list is long...)",
    "created_at": "2011-05-16T19:38:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106494",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:16" align="right">comment:16</div>

True. It doesn't work with print (or other non-expression statements). I've created #11336 to generalize it. 

I think that this is still plenty useful even with that limitation, and don't know when I'll have more time to work on it--we could either get this in and start using it now or hold off until has time to write a more complete implementation at some later date (which I'd like to get to someday, but that someday list is long...)



---

archive/issue_comments_106495.json:
```json
{
    "body": "Changed reviewer from **Jason Grout** to **Jason Grout, Mariah Lenox**",
    "created_at": "2011-05-17T13:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106495",
    "user": "https://github.com/sagetrac-mariah"
}
```

Changed reviewer from **Jason Grout** to **Jason Grout, Mariah Lenox**



---

archive/issue_comments_106496.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@robertwb](#comment%3A16):\n> True. It doesn't work with print (or other non-expression statements). I've created #11336 to generalize it. \n> \n> I think that this is still plenty useful even with that limitation\n\nAgreed.  I am just doing my \"reviewer\" duty.\n\nPositive review.",
    "created_at": "2011-05-17T13:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106496",
    "user": "https://github.com/sagetrac-mariah"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@robertwb](#comment%3A16):
> True. It doesn't work with print (or other non-expression statements). I've created #11336 to generalize it. 
> 
> I think that this is still plenty useful even with that limitation

Agreed.  I am just doing my "reviewer" duty.

Positive review.



---

archive/issue_events_143791.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-17T13:25:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143791"
}
```



---

archive/issue_events_143792.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2011-05-17T13:25:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143792"
}
```



---

archive/issue_events_143793.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-17T15:33:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143793"
}
```



---

archive/issue_events_143794.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-17T15:33:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143794"
}
```



---

archive/issue_events_143795.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-17T15:33:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143795"
}
```



---

archive/issue_events_143796.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-17T15:33:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143796"
}
```



---

archive/issue_comments_106497.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nWhich patches have to be applied?",
    "created_at": "2011-05-17T15:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106497",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Which patches have to be applied?



---

archive/issue_events_143797.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-17T15:33:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143797"
}
```



---

archive/issue_comments_106498.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI think the documentation should be expanded a bit to show less trivial examples, for example complex numbers or polynomials with non-exact coefficients.",
    "created_at": "2011-05-17T15:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106498",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

I think the documentation should be expanded a bit to show less trivial examples, for example complex numbers or polynomials with non-exact coefficients.



---

archive/issue_comments_106499.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAlso matrices",
    "created_at": "2011-05-17T15:48:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106499",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Also matrices



---

archive/issue_comments_106500.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAttachment: **[trac_10952-reviewer-docs.patch.gz](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz)**\n\nI have added an \"Apply\" list for this ticket.\n\nMy patch fixes one typo in the documentation (a missing ]).\n\nI have added some non-trivial tests.\n\nJeroen:\n\n1.  abs() for a matrix computes the determinant.  Not useful for testing.\n\n2.  Is there a class of polynomials with numerical coefficients?  Does it have abs() defined on it?\n\nI am working on this as a high-priority ticket for Bug Days 32.\n\nRob",
    "created_at": "2011-08-22T06:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106500",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:21" align="right">comment:21</div>

Attachment: **[trac_10952-reviewer-docs.patch.gz](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz)**

I have added an "Apply" list for this ticket.

My patch fixes one typo in the documentation (a missing ]).

I have added some non-trivial tests.

Jeroen:

1.  abs() for a matrix computes the determinant.  Not useful for testing.

2.  Is there a class of polynomials with numerical coefficients?  Does it have abs() defined on it?

I am working on this as a high-priority ticket for Bug Days 32.

Rob



---

archive/issue_comments_106501.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,3 +13,10 @@\n \n This can be useful when the exact output is subject to rounding error \n and/or processor floating point arithmetic variation. \n+\n+**Apply**:\n+1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)\n+2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)\n+3.  [attachment: trac_10952-reviewer-docs.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz)\n+\n+\n``````\n",
    "created_at": "2011-08-22T06:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106501",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,3 +13,10 @@
 
 This can be useful when the exact output is subject to rounding error 
 and/or processor floating point arithmetic variation. 
+
+**Apply**:
+1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)
+2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)
+3.  [attachment: trac_10952-reviewer-docs.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz)
+
+
``````




---

archive/issue_events_143798.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-22T06:24:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143798"
}
```



---

archive/issue_events_143799.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-22T06:24:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143799"
}
```



---

archive/issue_comments_106502.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThis ticket is pretty amazing.\n\nRob, this doctest you added seems very wrong:\n\n```\n\n   A relative tolerance on a root of a polynomial.\n    \n   ::\n   \n       sage: p = (y - 10^16)*(y-10^(-13))*(y-2); p\n       y^3 + (-1e+16)*y^2 + (2e+16)*y - 2000.0\n       sage: p.roots()\n       sage: p.roots(multiplicities=False)[2]     # relative tol 1e-10\n       10^16\n```\n\nIn particular, \n\n* it seems that y isn't defined\n* the output of `p.roots()` is missing\n* I get an output of `1e16` instead of `10^16`.",
    "created_at": "2011-08-24T05:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106502",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:22" align="right">comment:22</div>

This ticket is pretty amazing.

Rob, this doctest you added seems very wrong:

```

   A relative tolerance on a root of a polynomial.
    
   ::
   
       sage: p = (y - 10^16)*(y-10^(-13))*(y-2); p
       y^3 + (-1e+16)*y^2 + (2e+16)*y - 2000.0
       sage: p.roots()
       sage: p.roots(multiplicities=False)[2]     # relative tol 1e-10
       10^16
```

In particular, 

* it seems that y isn't defined
* the output of `p.roots()` is missing
* I get an output of `1e16` instead of `10^16`.



---

archive/issue_comments_106503.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,8 +15,8 @@\n and/or processor floating point arithmetic variation. \n \n **Apply**:\n-1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)\n-2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)\n-3.  [attachment: trac_10952-reviewer-docs.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz)\n+1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz) - to the local/bin repo\n+2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz) - to the devel/sage repo\n+3.  [attachment: trac_10952-reviewer-docs.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz) - to the devel/sage repo\n \n \n``````\n",
    "created_at": "2011-08-24T05:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106503",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,8 +15,8 @@
 and/or processor floating point arithmetic variation. 
 
 **Apply**:
-1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)
-2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)
-3.  [attachment: trac_10952-reviewer-docs.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz)
+1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz) - to the local/bin repo
+2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz) - to the devel/sage repo
+3.  [attachment: trac_10952-reviewer-docs.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz) - to the devel/sage repo
 
 
``````




---

archive/issue_events_143800.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-24T05:49:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143800"
}
```



---

archive/issue_events_143801.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-24T05:49:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143801"
}
```



---

archive/issue_comments_106504.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@williamstein](#comment%3A22):\n> Rob, this doctest you added seems very wrong:\n\nYes, I think this was the patch missing a refresh.  I'll clean it in the AM.",
    "created_at": "2011-08-24T05:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106504",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@williamstein](#comment%3A22):
> Rob, this doctest you added seems very wrong:

Yes, I think this was the patch missing a refresh.  I'll clean it in the AM.



---

archive/issue_comments_106505.json:
```json
{
    "body": "Attachment: **[trac_10952-reviewer-docs-v2.patch.gz](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v2.patch.gz)**",
    "created_at": "2011-08-24T07:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106505",
    "user": "https://github.com/rbeezer"
}
```

Attachment: **[trac_10952-reviewer-docs-v2.patch.gz](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v2.patch.gz)**



---

archive/issue_events_143802.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-24T07:08:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143802"
}
```



---

archive/issue_events_143803.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-08-24T07:08:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143803"
}
```



---

archive/issue_comments_106506.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,6 +17,6 @@\n **Apply**:\n 1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz) - to the local/bin repo\n 2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz) - to the devel/sage repo\n-3.  [attachment: trac_10952-reviewer-docs.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz) - to the devel/sage repo\n+3.  [attachment: trac_10952-reviewer-docs-v2.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v2.patch.gz) - to the devel/sage repo\n \n \n``````\n",
    "created_at": "2011-08-24T07:08:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106506",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,6 +17,6 @@
 **Apply**:
 1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz) - to the local/bin repo
 2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz) - to the devel/sage repo
-3.  [attachment: trac_10952-reviewer-docs.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs.patch.gz) - to the devel/sage repo
+3.  [attachment: trac_10952-reviewer-docs-v2.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v2.patch.gz) - to the devel/sage repo
 
 
``````




---

archive/issue_comments_106507.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReviewer documentation v2 patch cleans up the mess.\n\nI used `10^16` intentionally.  The tolerance feature does *arithmetic* with the \noutput, so does not have to identically match as text.  Maybe that deserves a comment?\n\nRob",
    "created_at": "2011-08-24T07:08:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106507",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:24" align="right">comment:24</div>

Reviewer documentation v2 patch cleans up the mess.

I used `10^16` intentionally.  The tolerance feature does *arithmetic* with the 
output, so does not have to identically match as text.  Maybe that deserves a comment?

Rob



---

archive/issue_comments_106508.json:
```json
{
    "body": "Attachment: **[trac_10952-reviewer-docs-v3.patch.gz](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz)**",
    "created_at": "2011-08-24T16:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106508",
    "user": "https://github.com/rbeezer"
}
```

Attachment: **[trac_10952-reviewer-docs-v3.patch.gz](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz)**



---

archive/issue_comments_106509.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,6 +17,6 @@\n **Apply**:\n 1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz) - to the local/bin repo\n 2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz) - to the devel/sage repo\n-3.  [attachment: trac_10952-reviewer-docs-v2.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v2.patch.gz) - to the devel/sage repo\n+3.  [attachment: trac_10952-reviewer-docs-v3.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz) - to the devel/sage repo\n \n \n``````\n",
    "created_at": "2011-08-24T16:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106509",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,6 +17,6 @@
 **Apply**:
 1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz) - to the local/bin repo
 2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz) - to the devel/sage repo
-3.  [attachment: trac_10952-reviewer-docs-v2.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v2.patch.gz) - to the devel/sage repo
+3.  [attachment: trac_10952-reviewer-docs-v3.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz) - to the devel/sage repo
 
 
``````




---

archive/issue_comments_106510.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReviewer documentation v3 patch adds a comment about intended output being of any form, fixes some missing quotes and expands a bit more on how this works.  Passes tests, so should be ready for review.",
    "created_at": "2011-08-24T16:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106510",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:25" align="right">comment:25</div>

Reviewer documentation v3 patch adds a comment about intended output being of any form, fixes some missing quotes and expands a bit more on how this works.  Passes tests, so should be ready for review.



---

archive/issue_events_143804.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-24T16:38:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143804"
}
```



---

archive/issue_events_143805.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-08-24T16:38:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143805"
}
```



---

archive/issue_comments_106511.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nNice.  Game changer!!!!   Sweet.  It's about time.  Great work!  W00t.  FTW.  Frickin' awesome.",
    "created_at": "2011-08-24T16:38:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106511",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:26" align="right">comment:26</div>

Nice.  Game changer!!!!   Sweet.  It's about time.  Great work!  W00t.  FTW.  Frickin' awesome.



---

archive/issue_comments_106512.json:
```json
{
    "body": "Changed author from **Robert Bradshaw** to **Robert Bradshaw, Rob Beezer**",
    "created_at": "2011-08-24T17:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106512",
    "user": "https://github.com/kcrisman"
}
```

Changed author from **Robert Bradshaw** to **Robert Bradshaw, Rob Beezer**



---

archive/issue_comments_106513.json:
```json
{
    "body": "Changed reviewer from **Jason Grout, Mariah Lenox** to **Jason Grout, Mariah Lenox, William Stein**",
    "created_at": "2011-08-24T17:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106513",
    "user": "https://github.com/kcrisman"
}
```

Changed reviewer from **Jason Grout, Mariah Lenox** to **Jason Grout, Mariah Lenox, William Stein**



---

archive/issue_comments_106514.json:
```json
{
    "body": "Changed keywords from none to **sd32**",
    "created_at": "2011-08-24T23:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106514",
    "user": "https://github.com/williamstein"
}
```

Changed keywords from none to **sd32**



---

archive/issue_comments_106515.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nShouldn't the code only be included if the doctests actually contain `# tol ...`?\n\n`( +[0-9.e+-]+)?` hardly matches what we want btw.\n\n\n\n\n\nI've put this onto the 1337 ticket (#11337).",
    "created_at": "2011-09-08T23:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106515",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:29" align="right">comment:29</div>

Shouldn't the code only be included if the doctests actually contain `# tol ...`?

`( +[0-9.e+-]+)?` hardly matches what we want btw.





I've put this onto the 1337 ticket (#11337).



---

archive/issue_comments_106516.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,5 @@\n-If a line contains ``tol`` or ``tolerance, numerical results are only \n-verified to the given tolerance. This may be prefixed by ``abs[olute`` \n-or ``rel[ative]`` to specify whether to measure absolute or relative \n-error; defaults to relative error except when the expected value is \n-exactly zero: \n+If a line contains `tol` or `tolerance`, numerical results are only \n+verified to the given tolerance. This may be prefixed by `abs[olute]` or `rel[ative]` to specify whether to measure absolute or relative error; defaults to relative error except when the expected value is exactly zero: \n \n ```\n         sage: RDF(pi)                               # abs tol 1e-5 \n@@ -11,12 +8,16 @@\n         [0.9999, 10.001, 100.01, 999.9, 10001] \n ```\n \n-This can be useful when the exact output is subject to rounding error \n-and/or processor floating point arithmetic variation. \n+This can be useful when the exact output is subject to rounding error and/or processor floating point arithmetic variation. \n \n-**Apply**:\n-1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz) - to the local/bin repo\n-2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz) - to the devel/sage repo\n-3.  [attachment: trac_10952-reviewer-docs-v3.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz) - to the devel/sage repo\n+---\n \n+Apply\n+1. [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)\n+to the Sage **scripts repository**.\n \n+Apply\n+1. [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)\n+2. [attachment: trac_10952-reviewer-docs-v3.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz)\n+to the Sage library repository.\n+\n``````\n",
    "created_at": "2011-09-08T23:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106516",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,5 @@
-If a line contains ``tol`` or ``tolerance, numerical results are only 
-verified to the given tolerance. This may be prefixed by ``abs[olute`` 
-or ``rel[ative]`` to specify whether to measure absolute or relative 
-error; defaults to relative error except when the expected value is 
-exactly zero: 
+If a line contains `tol` or `tolerance`, numerical results are only 
+verified to the given tolerance. This may be prefixed by `abs[olute]` or `rel[ative]` to specify whether to measure absolute or relative error; defaults to relative error except when the expected value is exactly zero: 
 
 ```
         sage: RDF(pi)                               # abs tol 1e-5 
@@ -11,12 +8,16 @@
         [0.9999, 10.001, 100.01, 999.9, 10001] 
 ```
 
-This can be useful when the exact output is subject to rounding error 
-and/or processor floating point arithmetic variation. 
+This can be useful when the exact output is subject to rounding error and/or processor floating point arithmetic variation. 
 
-**Apply**:
-1.  [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz) - to the local/bin repo
-2.  [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz) - to the devel/sage repo
-3.  [attachment: trac_10952-reviewer-docs-v3.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz) - to the devel/sage repo
+---
 
+Apply
+1. [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)
+to the Sage **scripts repository**.
 
+Apply
+1. [attachment: 10952-tol-doc.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-doc.2.patch.gz)
+2. [attachment: trac_10952-reviewer-docs-v3.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-reviewer-docs-v3.patch.gz)
+to the Sage library repository.
+
``````




---

archive/issue_comments_106517.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThis doesn't work. Re Leif's comment, I think the regexp should something like `' ((\\.[0-9]+|[0-9]+(\\.[0-9]*)?)e[+-]?[0-9]+)'`, which adds another group to the match, so we need to make this change:\n\n```diff\ndiff --git a/sage-doctest b/sage-doctest\n--- a/sage-doctest\n+++ b/sage-doctest\n@@ -217,7 +217,7 @@ if __name__ ==  '__main__':\n \"\"\" % dict\n \n NONE=0; LONG_TIME=1; RANDOM=2; OPTIONAL=3; NOT_IMPLEMENTED=4; NOT_TESTED=5; TOLERANCE=6\n-tolerance_pattern = re.compile(r'\\b((?:abs(?:olute)?)|(?:rel(?:ative)?))? *?tol(?:erance)?\\b( +[0-9.e+-]+)?')\n+tolerance_pattern = re.compile(r'\\b((?:abs(?:olute)?)|(?:rel(?:ative)?))? *?tol(?:erance)?\\b +((\\.[0-9]+|[0-9]+(\\.[0-9]*)?)e[+-]?[0-9]+)?')\n \n def comment_modifier(s):\n     sind = s.find('#')\n@@ -239,7 +239,7 @@ def comment_modifier(s):\n     m = tolerance_pattern.search(L)\n     if m:\n         v.append(TOLERANCE)\n-        rel_or_abs, epsilon = m.groups()\n+        rel_or_abs, epsilon, _, _ = m.groups()\n         if rel_or_abs is not None:\n             rel_or_abs = rel_or_abs[:3]\n         if epsilon is None:\n```\nI think this should match any of \"1.2e12\", \"1e-12\", \".1e12\", without matching \"ee12e+-122\", like the previous regexp.\n\nIn addition to this, the whole thing just flat doesn't work.  I created a Python file with some tolerance tests in it, and they all fail, and the failures print badly: they include tracebacks, for example.  I'm not sure why the rst file patched in the two \"doc\" patches isn't being doctested correctly, but as far as I can tell, no doctests are being run in that file -- just add an obviously wrong doctest, and tests still pass.  Here is a test file:\n\n```python\n\"\"\"\nHere are some examples::\n\n    sage: 3+3\n    6\n    sage: RDF(pi)                               # abs tol 1e-4\n    3.14159\n\nHere is another example::\n\n    sage: [10^n for n in [0.0 .. 4]]            # rel tol 2e-4\n    [0.9999, 10.001, 100.01, 999.9, 10001]\n\nAnd another::\n\n    sage: RDF(pi)                               # abs tol 1e-4\n    3.14159\n\nAnd that's the end.\n\"\"\"\n```\nSave this as \"new.py\" and run \"sage -t new.py\" to see some bad behavior.",
    "created_at": "2011-09-09T03:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106517",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

This doesn't work. Re Leif's comment, I think the regexp should something like `' ((\.[0-9]+|[0-9]+(\.[0-9]*)?)e[+-]?[0-9]+)'`, which adds another group to the match, so we need to make this change:

```diff
diff --git a/sage-doctest b/sage-doctest
--- a/sage-doctest
+++ b/sage-doctest
@@ -217,7 +217,7 @@ if __name__ ==  '__main__':
 """ % dict
 
 NONE=0; LONG_TIME=1; RANDOM=2; OPTIONAL=3; NOT_IMPLEMENTED=4; NOT_TESTED=5; TOLERANCE=6
-tolerance_pattern = re.compile(r'\b((?:abs(?:olute)?)|(?:rel(?:ative)?))? *?tol(?:erance)?\b( +[0-9.e+-]+)?')
+tolerance_pattern = re.compile(r'\b((?:abs(?:olute)?)|(?:rel(?:ative)?))? *?tol(?:erance)?\b +((\.[0-9]+|[0-9]+(\.[0-9]*)?)e[+-]?[0-9]+)?')
 
 def comment_modifier(s):
     sind = s.find('#')
@@ -239,7 +239,7 @@ def comment_modifier(s):
     m = tolerance_pattern.search(L)
     if m:
         v.append(TOLERANCE)
-        rel_or_abs, epsilon = m.groups()
+        rel_or_abs, epsilon, _, _ = m.groups()
         if rel_or_abs is not None:
             rel_or_abs = rel_or_abs[:3]
         if epsilon is None:
```
I think this should match any of "1.2e12", "1e-12", ".1e12", without matching "ee12e+-122", like the previous regexp.

In addition to this, the whole thing just flat doesn't work.  I created a Python file with some tolerance tests in it, and they all fail, and the failures print badly: they include tracebacks, for example.  I'm not sure why the rst file patched in the two "doc" patches isn't being doctested correctly, but as far as I can tell, no doctests are being run in that file -- just add an obviously wrong doctest, and tests still pass.  Here is a test file:

```python
"""
Here are some examples::

    sage: 3+3
    6
    sage: RDF(pi)                               # abs tol 1e-4
    3.14159

Here is another example::

    sage: [10^n for n in [0.0 .. 4]]            # rel tol 2e-4
    [0.9999, 10.001, 100.01, 999.9, 10001]

And another::

    sage: RDF(pi)                               # abs tol 1e-4
    3.14159

And that's the end.
"""
```
Save this as "new.py" and run "sage -t new.py" to see some bad behavior.



---

archive/issue_events_143806.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-09-09T03:08:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143806"
}
```



---

archive/issue_events_143807.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-09-09T03:08:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143807"
}
```



---

archive/issue_comments_106518.json:
```json
{
    "body": "Changed reviewer from **Jason Grout, Mariah Lenox, William Stein** to **Jason Grout, Mariah Lenox, William Stein, John Palmieri**",
    "created_at": "2011-09-09T03:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106518",
    "user": "https://github.com/jhpalmieri"
}
```

Changed reviewer from **Jason Grout, Mariah Lenox, William Stein** to **Jason Grout, Mariah Lenox, William Stein, John Palmieri**



---

archive/issue_comments_106519.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@jhpalmieri](#comment%3A30):\n> I think the regexp should something like\n\n\n```\n' ((\\.[0-9]+|[0-9]+(\\.[0-9]*)?)e[+-]?[0-9]+)'`\n```\n\nBut that doesn't match `1ee7` :(\n\nYou can of course match funny things first, i.e. use more general patterns, but you then have to check the matched expression further before passing it to `float()`.\n\nThe whole idea isn't that bad, but carries the danger that people simply increase the tolerance (too much) just to make doctests pass *somehow*, without caring where the variations originate from.",
    "created_at": "2011-09-09T04:00:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106519",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@jhpalmieri](#comment%3A30):
> I think the regexp should something like


```
' ((\.[0-9]+|[0-9]+(\.[0-9]*)?)e[+-]?[0-9]+)'`
```

But that doesn't match `1ee7` :(

You can of course match funny things first, i.e. use more general patterns, but you then have to check the matched expression further before passing it to `float()`.

The whole idea isn't that bad, but carries the danger that people simply increase the tolerance (too much) just to make doctests pass *somehow*, without caring where the variations originate from.



---

archive/issue_comments_106520.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nBut `float(1ee7)` raises an error.  Why would we want to match that?\n\nRe the issue of raising tolerance, I hope that referees will keep an eye on that sort of thing.  Dave Kirkby, for example, is a strong advocate of not arbitrarily raising tolerance.",
    "created_at": "2011-09-09T05:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106520",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">comment:32</div>

But `float(1ee7)` raises an error.  Why would we want to match that?

Re the issue of raising tolerance, I hope that referees will keep an eye on that sort of thing.  Dave Kirkby, for example, is a strong advocate of not arbitrarily raising tolerance.



---

archive/issue_comments_106521.json:
```json
{
    "body": "Attachment: **[10952-tol-bin.2.patch.gz](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)**",
    "created_at": "2011-09-09T05:20:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106521",
    "user": "https://github.com/robertwb"
}
```

Attachment: **[10952-tol-bin.2.patch.gz](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)**



---

archive/issue_comments_106522.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI've fixed the issue with blanklines terminating example blocks. As for the regular expression for floats, I don't see any need to make it more complicated--I'd rather match miss-typed numbers and raise an error than silently ignore them. If you feel strongly, this could be changed.\n\nReferees should keep an eye on precision. This is back to my philosophy that a computer should run doctests and a human read the code (though we could add a patchbot plugin to flag drops in precision). It's not a new issue--we've been using \"...\" for quite a while now which is less flexible and more dangerous (as it can match more than just a single number).",
    "created_at": "2011-09-09T05:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106522",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:33" align="right">comment:33</div>

I've fixed the issue with blanklines terminating example blocks. As for the regular expression for floats, I don't see any need to make it more complicated--I'd rather match miss-typed numbers and raise an error than silently ignore them. If you feel strongly, this could be changed.

Referees should keep an eye on precision. This is back to my philosophy that a computer should run doctests and a human read the code (though we could add a patchbot plugin to flag drops in precision). It's not a new issue--we've been using "..." for quite a while now which is less flexible and more dangerous (as it can match more than just a single number).



---

archive/issue_comments_106523.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,7 +13,7 @@\n ---\n \n Apply\n-1. [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)\n+1. [attachment: 10952-tol-bin.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)\n to the Sage **scripts repository**.\n \n Apply\n``````\n",
    "created_at": "2011-09-09T05:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106523",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,7 +13,7 @@
 ---
 
 Apply
-1. [attachment: 10952-tol-bin.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.patch.gz)
+1. [attachment: 10952-tol-bin.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)
 to the Sage **scripts repository**.
 
 Apply
``````




---

archive/issue_events_143808.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-09T05:36:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143808"
}
```



---

archive/issue_events_143809.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-09T05:36:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143809"
}
```



---

archive/issue_comments_106524.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nHow about emitting the extra code only if `# tol ...` is used at all in the file?\n\nThat's a simple `\"\"\"... %s ...\"\"\" % (tolerance_code if uses_tol else \"\")`.",
    "created_at": "2011-09-09T05:48:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106524",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:35" align="right">comment:35</div>

How about emitting the extra code only if `# tol ...` is used at all in the file?

That's a simple `"""... %s ...""" % (tolerance_code if uses_tol else "")`.



---

archive/issue_comments_106525.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nYou're talking about the `check_with_tolerance` function and helpers. One could add a variable to keep track of this and conditionally emit it; not sure if the added complexity is worth the tiny savings.",
    "created_at": "2011-09-09T06:15:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106525",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:36" align="right">comment:36</div>

You're talking about the `check_with_tolerance` function and helpers. One could add a variable to keep track of this and conditionally emit it; not sure if the added complexity is worth the tiny savings.



---

archive/issue_comments_106526.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@robertwb](#comment%3A36):\n> You're talking about the `check_with_tolerance` function and helpers. One could add a variable to keep track of this and conditionally emit it; not sure if the added complexity is worth the tiny savings. \n\nAdded complexity? One boolean variable, initialized to false and set to `True` in only a few places?\n\nThis not only reduces the file size and run (import!) time but also avoids more potential name clashes.\n\nWhy should one add useless code to each and every file to doctest not using `# tol`?",
    "created_at": "2011-09-09T06:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106526",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@robertwb](#comment%3A36):
> You're talking about the `check_with_tolerance` function and helpers. One could add a variable to keep track of this and conditionally emit it; not sure if the added complexity is worth the tiny savings. 

Added complexity? One boolean variable, initialized to false and set to `True` in only a few places?

This not only reduces the file size and run (import!) time but also avoids more potential name clashes.

Why should one add useless code to each and every file to doctest not using `# tol`?



---

archive/issue_comments_106527.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nEither we make this variable a global (ugly) or return it on from call to doc_preparse along with the parsed docstring (also ugly). All to save a fraction of a block (~1KB) of an ephemeral file and < 1ms on an already fairly expensive operation. If we're looking to cut fat, it'd be better to avoid the quadratic-time creation of the doctest file string. \n\nThe name clash is a red herring--if we avoid it only because # tol is not used, that's a potentially latent bug in my mind. The function could be renamed if need be.",
    "created_at": "2011-09-09T08:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106527",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:38" align="right">comment:38</div>

Either we make this variable a global (ugly) or return it on from call to doc_preparse along with the parsed docstring (also ugly). All to save a fraction of a block (~1KB) of an ephemeral file and < 1ms on an already fairly expensive operation. If we're looking to cut fat, it'd be better to avoid the quadratic-time creation of the doctest file string. 

The name clash is a red herring--if we avoid it only because # tol is not used, that's a potentially latent bug in my mind. The function could be renamed if need be.



---

archive/issue_comments_106528.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI don't see anything wrong with more complicated regular expressions, but I like regular expressions.  So leave it as is if you want.\n\nMeanwhile, the output for failures using tolerances isn't nice, compared to other sorts of failures:\n\n```\nsage -t  \"builds/sage-4.7.2.alpha2/devel/sage-new/sage/homology/new.py\"\n**********************************************************************\nFile \"/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/sage/homology/new.py\", line 4:\n    sage: 3+3\nExpected:\n    8\nGot:\n    6\n**********************************************************************\nFile \"/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/sage/homology/new.py\", iled example:\n    check_with_tolerance('''\n        3.14159\n    ''', res, 9.9999999999999998e-13, 'abs')\nException raised:\n    Traceback (most recent call last):\n      File \"/Applications/sage/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Applications/sage/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Applications/sage/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[11]>\", line 3, in <module>\n        ''', res, 9.9999999999999998e-13, 'abs')\n      File \"/Users/palmieri/.sage//tmp/new.py\", line 35, in check_with_tolerance\n        assert abs(expected_value - actual_value) < epsilon, \"Out of tolerance %s vs %s\" % (expected_value, actual_value)\n    AssertionError: Out of tolerance 3.14159 vs 3.14159265359\n**********************************************************************\n1 items had failures:\n   2 of  13 in __main__.example_0\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /Users/palmieri/.sage//tmp/.doctest_new.py\n\t [3.9 s]\n```\nNotice that the line number is missing and the traceback is present.  I'm attaching a referee patch which tries to fix this.  Please take a look.  For me, this gives this sort of output (with a slightly different file):\n\n```\nsage -t  \"builds/sage-4.7.2.alpha2/devel/sage-new/new.py\"   \n**********************************************************************\nFile \"/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/new.py\", line 4:\n    sage: 3+3\nExpected:\n    8\nGot:\n    6\n**********************************************************************\nFile \"/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/new.py\", line 6:\n    sage: RDF(pi)                               # abs tol 1e-6\nOut of tolerance 3.14159 vs 3.14159265359\n**********************************************************************\nFile \"/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/new.py\", line 16:\n    sage: RDF(pi)                               # abs tol 1e-8\nOut of tolerance 3.14159 vs 3.14159265359\n**********************************************************************\n1 items had failures:\n   3 of  16 in __main__.example_0\n***Test Failed*** 3 failures.\nFor whitespace errors, see the file /Users/palmieri/.sage//tmp/.doctest_new.py\n\t [4.2 s]\n```\n\nSince the whole ticket had a positive review earlier, I think if you're happy with my changes, you can switch it back to that status.\n\nFinally, the issue with doctests in `conventions.rst` is, I think, that the various triple quotes `\"\"\"` confuse the parsing routine (the function `pythonify_rst` in particular).  This belongs on another ticket.  That file contains enough incomplete code stubs that I wonder if it shouldn't be doctested at all...",
    "created_at": "2011-09-09T22:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106528",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">comment:39</div>

I don't see anything wrong with more complicated regular expressions, but I like regular expressions.  So leave it as is if you want.

Meanwhile, the output for failures using tolerances isn't nice, compared to other sorts of failures:

```
sage -t  "builds/sage-4.7.2.alpha2/devel/sage-new/sage/homology/new.py"
**********************************************************************
File "/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/sage/homology/new.py", line 4:
    sage: 3+3
Expected:
    8
Got:
    6
**********************************************************************
File "/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/sage/homology/new.py", iled example:
    check_with_tolerance('''
        3.14159
    ''', res, 9.9999999999999998e-13, 'abs')
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Applications/sage/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Applications/sage/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[11]>", line 3, in <module>
        ''', res, 9.9999999999999998e-13, 'abs')
      File "/Users/palmieri/.sage//tmp/new.py", line 35, in check_with_tolerance
        assert abs(expected_value - actual_value) < epsilon, "Out of tolerance %s vs %s" % (expected_value, actual_value)
    AssertionError: Out of tolerance 3.14159 vs 3.14159265359
**********************************************************************
1 items had failures:
   2 of  13 in __main__.example_0
***Test Failed*** 2 failures.
For whitespace errors, see the file /Users/palmieri/.sage//tmp/.doctest_new.py
	 [3.9 s]
```
Notice that the line number is missing and the traceback is present.  I'm attaching a referee patch which tries to fix this.  Please take a look.  For me, this gives this sort of output (with a slightly different file):

```
sage -t  "builds/sage-4.7.2.alpha2/devel/sage-new/new.py"   
**********************************************************************
File "/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/new.py", line 4:
    sage: 3+3
Expected:
    8
Got:
    6
**********************************************************************
File "/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/new.py", line 6:
    sage: RDF(pi)                               # abs tol 1e-6
Out of tolerance 3.14159 vs 3.14159265359
**********************************************************************
File "/Applications/sage_builds/sage-4.7.2.alpha2/devel/sage-new/new.py", line 16:
    sage: RDF(pi)                               # abs tol 1e-8
Out of tolerance 3.14159 vs 3.14159265359
**********************************************************************
1 items had failures:
   3 of  16 in __main__.example_0
***Test Failed*** 3 failures.
For whitespace errors, see the file /Users/palmieri/.sage//tmp/.doctest_new.py
	 [4.2 s]
```

Since the whole ticket had a positive review earlier, I think if you're happy with my changes, you can switch it back to that status.

Finally, the issue with doctests in `conventions.rst` is, I think, that the various triple quotes `"""` confuse the parsing routine (the function `pythonify_rst` in particular).  This belongs on another ticket.  That file contains enough incomplete code stubs that I wonder if it shouldn't be doctested at all...



---

archive/issue_comments_106529.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,7 @@\n \n Apply\n 1. [attachment: 10952-tol-bin.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)\n+2. [attachment: trac_10952-ref.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-ref.patch.gz)\n to the Sage **scripts repository**.\n \n Apply\n``````\n",
    "created_at": "2011-09-09T22:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106529",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,7 @@
 
 Apply
 1. [attachment: 10952-tol-bin.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)
+2. [attachment: trac_10952-ref.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-ref.patch.gz)
 to the Sage **scripts repository**.
 
 Apply
``````




---

archive/issue_comments_106530.json:
```json
{
    "body": "scripts repo; apply on top of other scripts patch",
    "created_at": "2011-09-09T22:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106530",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo; apply on top of other scripts patch



---

archive/issue_comments_106531.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nAttachment: **[trac_10952-ref.patch.gz](https://github.com/sagemath/sage/files/ticket10952/trac_10952-ref.patch.gz)**\n\nReplying to [@jhpalmieri](#comment%3A39):\n> I don't see anything wrong with more complicated regular expressions, but I like regular expressions.  So leave it as is if you want.\n\nYes, only\n\n```\nsage: foo   # tol 1ee7\nanything\n```\nshould always pass. ;-)\n\n\n\n\n> Meanwhile, the output for failures using tolerances isn't nice, compared to other sorts of failures [...] \n\n> Notice that the line number is missing and the traceback is present.  I'm attaching a referee patch which tries to fix this.  Please take a look.\n\nHaven't tested your patch (nor looked at it), but the output you gave looks much better.\n\n\n\n\n> Since the whole ticket had a positive review earlier, I think if you're happy with my changes, you can switch it back to that status.\n\nI won't object, though I in general don't like the idea of adding code (regardless how small the overhead or impact might be) unconditionally, i.e., if there's no need to do so.\n\nWe have similar situations all around, where everybody adds \"just a little\", IMHO.",
    "created_at": "2011-09-09T22:31:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106531",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:40" align="right">comment:40</div>

Attachment: **[trac_10952-ref.patch.gz](https://github.com/sagemath/sage/files/ticket10952/trac_10952-ref.patch.gz)**

Replying to [@jhpalmieri](#comment%3A39):
> I don't see anything wrong with more complicated regular expressions, but I like regular expressions.  So leave it as is if you want.

Yes, only

```
sage: foo   # tol 1ee7
anything
```
should always pass. ;-)




> Meanwhile, the output for failures using tolerances isn't nice, compared to other sorts of failures [...] 

> Notice that the line number is missing and the traceback is present.  I'm attaching a referee patch which tries to fix this.  Please take a look.

Haven't tested your patch (nor looked at it), but the output you gave looks much better.




> Since the whole ticket had a positive review earlier, I think if you're happy with my changes, you can switch it back to that status.

I won't object, though I in general don't like the idea of adding code (regardless how small the overhead or impact might be) unconditionally, i.e., if there's no need to do so.

We have similar situations all around, where everybody adds "just a little", IMHO.



---

archive/issue_comments_106532.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@nexttime](#comment%3A40):\n> Replying to [@jhpalmieri](#comment%3A39):\n> > I don't see anything wrong with more complicated regular expressions, but I like regular expressions.  So leave it as is if you want.\n> \n> \n> Yes, only\n> \n> ```\n> sage: foo   # tol 1ee7\n> anything\n> ```\n> should always pass. ;-)\n\nCurrently, it raises an error indicating that the *doctest* itself is bad. \n\n> > Meanwhile, the output for failures using tolerances isn't nice, compared to other sorts of failures [...] \n\n> > Notice that the line number is missing and the traceback is present.  I'm attaching a referee patch which tries to fix this.  Please take a look.\n> \n> \n> Haven't tested your patch (nor looked at it), but the output you gave looks much better.\n> \n> \n\n> \n> > Since the whole ticket had a positive review earlier, I think if you're happy with my changes, you can switch it back to that status.\n> \n> \n> I won't object, though I in general don't like the idea of adding code (regardless how small the overhead or impact might be) unconditionally, i.e., if there's no need to do so.\n> \n> We have similar situations all around, where everybody adds \"just a little\", IMHO.\n\nYes, it's a tradeoff between adding \"just a little\" python parsing overhead to the testing infrastructure or \"just a little\" human parsing overhead to the testing infrastructure. I'd rather put the burden on machines than developers in this case. \n\nThe reviewer patches look good, certainly an improvement, so I'm setting this back to positive review unless there's something else that needs to be taken care of.",
    "created_at": "2011-09-22T21:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106532",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@nexttime](#comment%3A40):
> Replying to [@jhpalmieri](#comment%3A39):
> > I don't see anything wrong with more complicated regular expressions, but I like regular expressions.  So leave it as is if you want.
> 
> 
> Yes, only
> 
> ```
> sage: foo   # tol 1ee7
> anything
> ```
> should always pass. ;-)

Currently, it raises an error indicating that the *doctest* itself is bad. 

> > Meanwhile, the output for failures using tolerances isn't nice, compared to other sorts of failures [...] 

> > Notice that the line number is missing and the traceback is present.  I'm attaching a referee patch which tries to fix this.  Please take a look.
> 
> 
> Haven't tested your patch (nor looked at it), but the output you gave looks much better.
> 
> 

> 
> > Since the whole ticket had a positive review earlier, I think if you're happy with my changes, you can switch it back to that status.
> 
> 
> I won't object, though I in general don't like the idea of adding code (regardless how small the overhead or impact might be) unconditionally, i.e., if there's no need to do so.
> 
> We have similar situations all around, where everybody adds "just a little", IMHO.

Yes, it's a tradeoff between adding "just a little" python parsing overhead to the testing infrastructure or "just a little" human parsing overhead to the testing infrastructure. I'd rather put the burden on machines than developers in this case. 

The reviewer patches look good, certainly an improvement, so I'm setting this back to positive review unless there's something else that needs to be taken care of.



---

archive/issue_events_143810.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-09-22T21:36:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143810"
}
```



---

archive/issue_events_143811.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-09-22T21:36:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143811"
}
```



---

archive/issue_comments_106533.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,6 +12,11 @@\n \n ---\n \n+Related:\n+* `.zero_at(epsilon)` methods, to fix noisy (and signed) zeroes; see for example #11848.\n+\n+---\n+\n Apply\n 1. [attachment: 10952-tol-bin.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)\n 2. [attachment: trac_10952-ref.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-ref.patch.gz)\n``````\n",
    "created_at": "2011-09-26T02:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106533",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,6 +12,11 @@
 
 ---
 
+Related:
+* `.zero_at(epsilon)` methods, to fix noisy (and signed) zeroes; see for example #11848.
+
+---
+
 Apply
 1. [attachment: 10952-tol-bin.2.patch](https://github.com/sagemath/sage/files/ticket10952/10952-tol-bin.2.patch.gz)
 2. [attachment: trac_10952-ref.patch](https://github.com/sagemath/sage/files/ticket10952/trac_10952-ref.patch.gz)
``````




---

archive/issue_comments_106534.json:
```json
{
    "body": "Changed keywords from **sd32** to **sd32 noise noisy doctest failure error tolerance**",
    "created_at": "2011-09-26T02:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106534",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from **sd32** to **sd32 noise noisy doctest failure error tolerance**



---

archive/issue_comments_106535.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha3**",
    "created_at": "2011-09-27T17:41:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106535",
    "user": "https://github.com/nexttime"
}
```

Merged: **sage-4.7.2.alpha3**



---

archive/issue_events_143812.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-27T17:41:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143812"
}
```



---

archive/issue_events_143813.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-27T17:41:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10952#event-143813"
}
```



---

archive/issue_comments_106536.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI'd like to draw the attention of folks here to [#12493 comment:7](https://github.com/sagemath/sage/issues/12493#comment:7).  Apparently one can't do `only-optional` tests along with `tol` tests at the same time.   My guess is that not too many people use `only-optional` and the `tol` stuff is pretty new.\n\nIn fact, I only found one occurrence in 5.0.beta3.  Can that be right?  This has been in Sage for months!\n\n```\nsage: search_src(\" tol \",\"#\")\nsymbolic/integration/integral.py:587:        sage: error.numerical_approx() # abs tol 10e-10\n```\nAnyway, even if my analysis is wrong (let's hope it's easier than that), I figure the people here can give a quick diagnosis of #12493.",
    "created_at": "2012-02-10T20:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106536",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:44" align="right">comment:44</div>

I'd like to draw the attention of folks here to [#12493 comment:7](https://github.com/sagemath/sage/issues/12493#comment:7).  Apparently one can't do `only-optional` tests along with `tol` tests at the same time.   My guess is that not too many people use `only-optional` and the `tol` stuff is pretty new.

In fact, I only found one occurrence in 5.0.beta3.  Can that be right?  This has been in Sage for months!

```
sage: search_src(" tol ","#")
symbolic/integration/integral.py:587:        sage: error.numerical_approx() # abs tol 10e-10
```
Anyway, even if my analysis is wrong (let's hope it's easier than that), I figure the people here can give a quick diagnosis of #12493.



---

archive/issue_comments_106537.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nActually, [#12493 comment:8](https://github.com/sagemath/sage/issues/12493#comment:8) is even better!  Optional and tol don't play well together.",
    "created_at": "2012-02-10T20:07:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10952#issuecomment-106537",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:45" align="right">comment:45</div>

Actually, [#12493 comment:8](https://github.com/sagemath/sage/issues/12493#comment:8) is even better!  Optional and tol don't play well together.
