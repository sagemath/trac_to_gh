# Issue 10202: Use pkg-config --define-variable option to set ${SAGE_ROOT} anytime pkg-config is invoked

archive/issues_010201.json:
```json
{
    "assignees": [
        "https://github.com/nexttime"
    ],
    "body": "Currently we rewrite all of the local/lib/pkgconfig/*.pc files every time we move locations. Instead, we should just use the --define-variable option of pkg-config to define a ${SAGE_ROOT} variable. Then we don't have to keep rewriting files every time.\n\nINSTRUCTIONS FOR TESTING:\n\n1. Download a fresh sage-4.7.alpha5.tar source archive\n\n2. Extract and delete the spkg/standard/sage_scripts-4.7.alpha5.spkg\n\n3. Put http://sage.math.washington.edu/home/jason/sage_scripts-4.7.alpha5.p0.spkg into the spkg/standard/ directory\n\n4. Make Sage\n\nNote to release manager: you have to edit the sage_scripts spkg-install to copy over the pkg-config shell script; see my sage_scripts spkg above.\n\nP.S. Why is the sage_scripts spkg-install not under version control?!?\n\n\n\nCC:  @nexttime @sagetrac-drkirkby @kcrisman @jdemeyer @jhpalmieri @dimpase\n\nReviewer: **Dima Pasechnik**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10202_\n\n",
    "closed_at": "2020-10-11T22:33:50Z",
    "created_at": "2010-11-02T14:13:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Use pkg-config --define-variable option to set ${SAGE_ROOT} anytime pkg-config is invoked",
    "type": "issue",
    "updated_at": "2020-10-11T22:33:50Z",
    "url": "https://github.com/sagemath/sage/issues/10202",
    "user": "https://github.com/jasongrout"
}
```
Currently we rewrite all of the local/lib/pkgconfig/*.pc files every time we move locations. Instead, we should just use the --define-variable option of pkg-config to define a ${SAGE_ROOT} variable. Then we don't have to keep rewriting files every time.

INSTRUCTIONS FOR TESTING:

1. Download a fresh sage-4.7.alpha5.tar source archive

2. Extract and delete the spkg/standard/sage_scripts-4.7.alpha5.spkg

3. Put http://sage.math.washington.edu/home/jason/sage_scripts-4.7.alpha5.p0.spkg into the spkg/standard/ directory

4. Make Sage

Note to release manager: you have to edit the sage_scripts spkg-install to copy over the pkg-config shell script; see my sage_scripts spkg above.

P.S. Why is the sage_scripts spkg-install not under version control?!?



CC:  @nexttime @sagetrac-drkirkby @kcrisman @jdemeyer @jhpalmieri @dimpase

Reviewer: **Dima Pasechnik**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/10202_





---

archive/issue_events_134328.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-02T14:13:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134328"
}
```



---

archive/issue_events_134329.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-02T14:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134329"
}
```



---

archive/issue_events_134330.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-02T14:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134330"
}
```



---

archive/issue_events_134331.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-11-02T14:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134331"
}
```



---

archive/issue_comments_094767.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSlightly abusing this ticket (the G`**`gle groups are less suited for markup), here's my current situation:\n\n```sh\n$ egrep '^prefix=.*$|^SAGE_ROOT=.*$' local/lib/pkgconfig/*.pc\nlocal/lib/pkgconfig/bdw-gc.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/bdw-gc.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/freetype2.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/freetype2.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/gnutls-extra.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/gnutls-extra.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/gnutls.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/gnutls.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/gsl.pc:prefix=/home/leif/Sage/sage-4.6/local\nlocal/lib/pkgconfig/libpng.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/libpng.pc:SAGE_ROOT=${SAGE_ROOT}\nlocal/lib/pkgconfig/libpng.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/libpng12.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/libpng12.pc:SAGE_ROOT=${SAGE_ROOT}\nlocal/lib/pkgconfig/libpng12.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/opencdk.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/opencdk.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/pynac.pc:prefix=/home/leif/Sage/sage-4.6/local\nlocal/lib/pkgconfig/sqlite3.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/sqlite3.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/zlib.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6\nlocal/lib/pkgconfig/zlib.pc:prefix=${SAGE_ROOT}/local\n$ (cd ../sage-4.6.rc0 && egrep '^prefix=.*$|^SAGE_ROOT=.*$' local/lib/pkgconfig/*.pc)\nlocal/lib/pkgconfig/bdw-gc.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/bdw-gc.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/freetype2.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/freetype2.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/gnutls-extra.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/gnutls-extra.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/gnutls.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/gnutls.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/gsl.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/gsl.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/libR.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/libpng.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/libpng.pc:SAGE_ROOT=${SAGE_ROOT}\nlocal/lib/pkgconfig/libpng.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/libpng12.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/libpng12.pc:SAGE_ROOT=${SAGE_ROOT}\nlocal/lib/pkgconfig/libpng12.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/opencdk.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/opencdk.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/pynac.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/pynac.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/sqlite3.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/sqlite3.pc:prefix=${SAGE_ROOT}/local\nlocal/lib/pkgconfig/zlib.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0\nlocal/lib/pkgconfig/zlib.pc:prefix=${SAGE_ROOT}/local\n```\n(Note that the `egrep` patterns are a bit \"redundant\", to be partially also used with `sed`. ;-) )\n\nSo briefly, in my Sage 4.6 **final** (built from scratch), `gsl.pc` and `pynac.pc` lack a `SAGE_ROOT=...` line, while `libpng.pc` has in addition a superfluous line `SAGE_ROOT=${SAGE_ROOT}`, and `libR.pc` lacks a definition of both `prefix` and `SAGE_ROOT` (but the file is sane, i.e. contains the proper hard-coded path(s) in `rhome` and `rincludedir`.)\n\nI really wonder what might have caused the differences between 4.6.rc0 and 4.6 final. Do these files get modified by other scripts than `sage-location`?\n\nThe redundant `SAGE_ROOT=${SAGE_ROOT}` is clearly a \"bug\" in #9210's `initialize_pkgconfig_files()`, since it doesn't check if a `.pc` file is just a link to another one (which is the case for `libpng.pc`). Testing for an already existing `SAGE_ROOT=...` would of course be possible as well.",
    "created_at": "2010-11-02T16:35:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94767",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:2" align="right">comment:2</div>

Slightly abusing this ticket (the G`**`gle groups are less suited for markup), here's my current situation:

```sh
$ egrep '^prefix=.*$|^SAGE_ROOT=.*$' local/lib/pkgconfig/*.pc
local/lib/pkgconfig/bdw-gc.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/bdw-gc.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/freetype2.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/freetype2.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/gnutls-extra.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/gnutls-extra.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/gnutls.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/gnutls.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/gsl.pc:prefix=/home/leif/Sage/sage-4.6/local
local/lib/pkgconfig/libpng.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/libpng.pc:SAGE_ROOT=${SAGE_ROOT}
local/lib/pkgconfig/libpng.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/libpng12.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/libpng12.pc:SAGE_ROOT=${SAGE_ROOT}
local/lib/pkgconfig/libpng12.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/opencdk.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/opencdk.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/pynac.pc:prefix=/home/leif/Sage/sage-4.6/local
local/lib/pkgconfig/sqlite3.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/sqlite3.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/zlib.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6
local/lib/pkgconfig/zlib.pc:prefix=${SAGE_ROOT}/local
$ (cd ../sage-4.6.rc0 && egrep '^prefix=.*$|^SAGE_ROOT=.*$' local/lib/pkgconfig/*.pc)
local/lib/pkgconfig/bdw-gc.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/bdw-gc.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/freetype2.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/freetype2.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/gnutls-extra.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/gnutls-extra.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/gnutls.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/gnutls.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/gsl.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/gsl.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/libR.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/libpng.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/libpng.pc:SAGE_ROOT=${SAGE_ROOT}
local/lib/pkgconfig/libpng.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/libpng12.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/libpng12.pc:SAGE_ROOT=${SAGE_ROOT}
local/lib/pkgconfig/libpng12.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/opencdk.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/opencdk.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/pynac.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/pynac.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/sqlite3.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/sqlite3.pc:prefix=${SAGE_ROOT}/local
local/lib/pkgconfig/zlib.pc:SAGE_ROOT=/home/leif/Sage/sage-4.6.rc0
local/lib/pkgconfig/zlib.pc:prefix=${SAGE_ROOT}/local
```
(Note that the `egrep` patterns are a bit "redundant", to be partially also used with `sed`. ;-) )

So briefly, in my Sage 4.6 **final** (built from scratch), `gsl.pc` and `pynac.pc` lack a `SAGE_ROOT=...` line, while `libpng.pc` has in addition a superfluous line `SAGE_ROOT=${SAGE_ROOT}`, and `libR.pc` lacks a definition of both `prefix` and `SAGE_ROOT` (but the file is sane, i.e. contains the proper hard-coded path(s) in `rhome` and `rincludedir`.)

I really wonder what might have caused the differences between 4.6.rc0 and 4.6 final. Do these files get modified by other scripts than `sage-location`?

The redundant `SAGE_ROOT=${SAGE_ROOT}` is clearly a "bug" in #9210's `initialize_pkgconfig_files()`, since it doesn't check if a `.pc` file is just a link to another one (which is the case for `libpng.pc`). Testing for an already existing `SAGE_ROOT=...` would of course be possible as well.



---

archive/issue_comments_094768.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOh, may it be the case that `sage-location` is also called (first) **during** the build (through `sage-sage`)?",
    "created_at": "2010-11-02T16:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94768",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

Oh, may it be the case that `sage-location` is also called (first) **during** the build (through `sage-sage`)?



---

archive/issue_comments_094769.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI agree that the current solution is suboptimal.  If we can really use environment variables in pkgconfig files, then clearly the best place to fix the pkgconfig files is in the separate spkg-installs for the affected packages.  That would be way less error-prone (for example, libpng knows about the symbolic link, so it knows exactly which file to modify).  In other words, it is the responsibility of the spkg to make the package relocatable.\n\nI think we ought to just post new versions of the right spkgs, and not modify the pkgconfig files in sage-location.",
    "created_at": "2010-11-02T16:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94769",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">comment:4</div>

I agree that the current solution is suboptimal.  If we can really use environment variables in pkgconfig files, then clearly the best place to fix the pkgconfig files is in the separate spkg-installs for the affected packages.  That would be way less error-prone (for example, libpng knows about the symbolic link, so it knows exactly which file to modify).  In other words, it is the responsibility of the spkg to make the package relocatable.

I think we ought to just post new versions of the right spkgs, and not modify the pkgconfig files in sage-location.



---

archive/issue_comments_094770.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@jasongrout](#comment:4):\n> I agree that the current solution is suboptimal.  If we can really use environment variables in pkgconfig files, then clearly the best place to fix the pkgconfig files is in the separate spkg-installs for the affected packages.  That would be way less error-prone (for example, libpng knows about the symbolic link, so it knows exactly which file to modify).  In other words, it is the responsibility of the spkg to make the package relocatable.\n\nPossible. Regarding the number of spkgs affected, rather \"no\" (not now)...\n\n> I think we ought to just post new versions of the right spkgs, and not modify the pkgconfig files in sage-location.\n\nWe should just check there if the files *are* already patched.\n\nI also suggested elsewhere to make it more verbose.",
    "created_at": "2010-11-02T16:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94770",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@jasongrout](#comment:4):
> I agree that the current solution is suboptimal.  If we can really use environment variables in pkgconfig files, then clearly the best place to fix the pkgconfig files is in the separate spkg-installs for the affected packages.  That would be way less error-prone (for example, libpng knows about the symbolic link, so it knows exactly which file to modify).  In other words, it is the responsibility of the spkg to make the package relocatable.

Possible. Regarding the number of spkgs affected, rather "no" (not now)...

> I think we ought to just post new versions of the right spkgs, and not modify the pkgconfig files in sage-location.

We should just check there if the files *are* already patched.

I also suggested elsewhere to make it more verbose.



---

archive/issue_comments_094771.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@nexttime](#comment:5):\n> I also suggested elsewhere to make it more verbose.\n\n... and also to make backup copies of the original files.",
    "created_at": "2010-11-02T16:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94771",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@nexttime](#comment:5):
> I also suggested elsewhere to make it more verbose.

... and also to make backup copies of the original files.



---

archive/issue_events_134332.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-11-02T16:58:24Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "subject": "https://github.com/nexttime",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134332"
}
```



---

archive/issue_comments_094772.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nCf. https://github.com/sagemath/sage/issues/10162#comment:3",
    "created_at": "2010-11-02T16:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94772",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

Cf. https://github.com/sagemath/sage/issues/10162#comment:3



---

archive/issue_comments_094773.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@nexttime](#comment:3):\n> Oh, may it be the case that `sage-location` is also called (first) **during** the build (through `sage-sage`)?\n\nYep:\n\n```sh\n$ ls -rtl local/lib/pkgconfig/*.pc\nlrwxrwxrwx 1 leif leif   11 Nov  1 14:21 local/lib/pkgconfig/libpng.pc -> libpng12.pc\n-rw-r--r-- 1 leif leif  310 Nov  1 14:23 local/lib/pkgconfig/zlib.pc\n-rw-r--r-- 1 leif leif  311 Nov  1 14:23 local/lib/pkgconfig/sqlite3.pc\n-rw-r--r-- 1 leif leif  947 Nov  1 14:23 local/lib/pkgconfig/opencdk.pc\n-rw-r--r-- 1 leif leif  313 Nov  1 14:23 local/lib/pkgconfig/libpng12.pc\n-rw-r--r-- 1 leif leif  973 Nov  1 14:23 local/lib/pkgconfig/gnutls.pc\n-rw-r--r-- 1 leif leif 1153 Nov  1 14:23 local/lib/pkgconfig/gnutls-extra.pc\n-rw-r--r-- 1 leif leif  324 Nov  1 14:23 local/lib/pkgconfig/freetype2.pc\n-rw-r--r-- 1 leif leif  303 Nov  1 14:23 local/lib/pkgconfig/bdw-gc.pc\n-rw-r--r-- 1 leif leif  296 Nov  1 14:34 local/lib/pkgconfig/pynac.pc\n-rw-r--r-- 1 leif leif  348 Nov  1 14:47 local/lib/pkgconfig/gsl.pc\n-rw-r--r-- 1 leif leif  239 Nov  1 14:51 local/lib/pkgconfig/libR.pc\n$ ls -l local/lib/sage-current-location.txt \n-rw-r--r-- 1 leif leif   24 Nov  1 14:23 local/lib/sage-current-location.txt\n```",
    "created_at": "2010-11-02T17:07:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94773",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@nexttime](#comment:3):
> Oh, may it be the case that `sage-location` is also called (first) **during** the build (through `sage-sage`)?

Yep:

```sh
$ ls -rtl local/lib/pkgconfig/*.pc
lrwxrwxrwx 1 leif leif   11 Nov  1 14:21 local/lib/pkgconfig/libpng.pc -> libpng12.pc
-rw-r--r-- 1 leif leif  310 Nov  1 14:23 local/lib/pkgconfig/zlib.pc
-rw-r--r-- 1 leif leif  311 Nov  1 14:23 local/lib/pkgconfig/sqlite3.pc
-rw-r--r-- 1 leif leif  947 Nov  1 14:23 local/lib/pkgconfig/opencdk.pc
-rw-r--r-- 1 leif leif  313 Nov  1 14:23 local/lib/pkgconfig/libpng12.pc
-rw-r--r-- 1 leif leif  973 Nov  1 14:23 local/lib/pkgconfig/gnutls.pc
-rw-r--r-- 1 leif leif 1153 Nov  1 14:23 local/lib/pkgconfig/gnutls-extra.pc
-rw-r--r-- 1 leif leif  324 Nov  1 14:23 local/lib/pkgconfig/freetype2.pc
-rw-r--r-- 1 leif leif  303 Nov  1 14:23 local/lib/pkgconfig/bdw-gc.pc
-rw-r--r-- 1 leif leif  296 Nov  1 14:34 local/lib/pkgconfig/pynac.pc
-rw-r--r-- 1 leif leif  348 Nov  1 14:47 local/lib/pkgconfig/gsl.pc
-rw-r--r-- 1 leif leif  239 Nov  1 14:51 local/lib/pkgconfig/libR.pc
$ ls -l local/lib/sage-current-location.txt 
-rw-r--r-- 1 leif leif   24 Nov  1 14:23 local/lib/sage-current-location.txt
```



---

archive/issue_events_134333.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-11-02T17:08:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134333"
}
```



---

archive/issue_events_134334.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-11-02T17:08:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134334"
}
```



---

archive/issue_comments_094774.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,20 @@\n \"At least for freetype, it should be possible to simply set prefix to $SAGE_LOCAL (unexpanded) rather than a hard-coded absolute path. (Done once, e.g. in its spkg-install.) \"\n \n This would a lot of hassle in the sage-location script if this works.  I'm not sure if these needs to be done as part of setting the prefix option on the command line when compiling, or if it needs to be done after freetype is installed (i.e., manually fix up the pkgconfig file)\n+\n+In short, this ticket is to modify the spkg-install file in the freetype spkg so that after installation, the freetype2.pc file would be something like:\n+\n+```\n+prefix=${SAGE_LOCAL}\n+exec_prefix=${prefix}\n+libdir=${exec_prefix}/lib\n+includedir=${prefix}/include\n+\n+Name: FreeType 2\n+Description: A free, high-quality, and portable font engine.\n+Version: 9.16.3\n+Requires:\n+Libs: -L${libdir} -lfreetype -lz \n+Cflags: -I${includedir}/freetype2 -I${includedir}\n+```\n+\n``````\n",
    "created_at": "2010-11-02T17:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94774",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,20 @@
 "At least for freetype, it should be possible to simply set prefix to $SAGE_LOCAL (unexpanded) rather than a hard-coded absolute path. (Done once, e.g. in its spkg-install.) "
 
 This would a lot of hassle in the sage-location script if this works.  I'm not sure if these needs to be done as part of setting the prefix option on the command line when compiling, or if it needs to be done after freetype is installed (i.e., manually fix up the pkgconfig file)
+
+In short, this ticket is to modify the spkg-install file in the freetype spkg so that after installation, the freetype2.pc file would be something like:
+
+```
+prefix=${SAGE_LOCAL}
+exec_prefix=${prefix}
+libdir=${exec_prefix}/lib
+includedir=${prefix}/include
+
+Name: FreeType 2
+Description: A free, high-quality, and portable font engine.
+Version: 9.16.3
+Requires:
+Libs: -L${libdir} -lfreetype -lz 
+Cflags: -I${includedir}/freetype2 -I${includedir}
+```
+
``````




---

archive/issue_comments_094775.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis ticket is getting confusing.  When I opened it, the goal was to modify the spkg-install file in the freetype spkg so that after installation, the freetype2.pc file would be something like:\n\n```\nprefix=${SAGE_LOCAL}\nexec_prefix=${prefix}\nlibdir=${exec_prefix}/lib\nincludedir=${prefix}/include\n\nName: FreeType 2\nDescription: A free, high-quality, and portable font engine.\nVersion: 9.16.3\nRequires:\nLibs: -L${libdir} -lfreetype -lz \nCflags: -I${includedir}/freetype2 -I${includedir}\n```\n\nI envision as the first of several spkgs that are updated to have similar changes, so that sage-location (eventually) does not have to update the pkgconfig files.\n\nThis ticket may necessitate changes in the sage-location script, as the script no longer needs to update the pkgconfig file.  However, I don't think any harm is done in sage-location updating the pkgconfig file either.",
    "created_at": "2010-11-02T17:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94775",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:10" align="right">comment:10</div>

This ticket is getting confusing.  When I opened it, the goal was to modify the spkg-install file in the freetype spkg so that after installation, the freetype2.pc file would be something like:

```
prefix=${SAGE_LOCAL}
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include

Name: FreeType 2
Description: A free, high-quality, and portable font engine.
Version: 9.16.3
Requires:
Libs: -L${libdir} -lfreetype -lz 
Cflags: -I${includedir}/freetype2 -I${includedir}
```

I envision as the first of several spkgs that are updated to have similar changes, so that sage-location (eventually) does not have to update the pkgconfig files.

This ticket may necessitate changes in the sage-location script, as the script no longer needs to update the pkgconfig file.  However, I don't think any harm is done in sage-location updating the pkgconfig file either.



---

archive/issue_comments_094776.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jasongrout](#comment:10):\n> This ticket is getting confusing.  When I opened it, the goal was to modify the spkg-install file in the freetype spkg [...]\n\nI hesitated to change its title... ;-)\n\nThe modification of the freetype spkg should IMHO be addressed at #9523 as well.\n\n> I envision as the first of several spkgs that are updated to have similar changes, so that sage-location (eventually) does not have to update the pkgconfig files.\n> \n> This ticket may necessitate changes in the sage-location script, as the script no longer needs to update the pkgconfig file.  However, I don't think any harm is done in sage-location updating the pkgconfig file either.\n\nThe situation is much worse since the logic of patching / \"initializing\" the `.pc` files **exactly once** (and all at the same time) is currently completely broken.\n\nI'll write a shell script to (re-)initialize them conditionally.",
    "created_at": "2010-11-02T17:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94776",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jasongrout](#comment:10):
> This ticket is getting confusing.  When I opened it, the goal was to modify the spkg-install file in the freetype spkg [...]

I hesitated to change its title... ;-)

The modification of the freetype spkg should IMHO be addressed at #9523 as well.

> I envision as the first of several spkgs that are updated to have similar changes, so that sage-location (eventually) does not have to update the pkgconfig files.
> 
> This ticket may necessitate changes in the sage-location script, as the script no longer needs to update the pkgconfig file.  However, I don't think any harm is done in sage-location updating the pkgconfig file either.

The situation is much worse since the logic of patching / "initializing" the `.pc` files **exactly once** (and all at the same time) is currently completely broken.

I'll write a shell script to (re-)initialize them conditionally.



---

archive/issue_comments_094777.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI'm curious where we are on this.  I haven't worked on it at all.  leif, you were going to do something (see your last comment).  I agree that the pkg files should be initialized conditionally.  Did you write a script of some sort to check to see if the files had been already modified?",
    "created_at": "2011-02-10T18:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94777",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:12" align="right">comment:12</div>

I'm curious where we are on this.  I haven't worked on it at all.  leif, you were going to do something (see your last comment).  I agree that the pkg files should be initialized conditionally.  Did you write a script of some sort to check to see if the files had been already modified?



---

archive/issue_comments_094778.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThis last problem (initializing pc files only once) might be causing a problem behind the scenes:\n\n```\n$ pkg-config --cflags libpng\nDuplicate definition of variable 'SAGE_ROOT' in '/Users/grout/sage/local/lib/pkgconfig/libpng.pc'\n```\n\nSo I'm not sure that our pkg-config works right now.  At least `pkg-config --exists libpng` still works.",
    "created_at": "2011-04-21T15:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94778",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:13" align="right">comment:13</div>

This last problem (initializing pc files only once) might be causing a problem behind the scenes:

```
$ pkg-config --cflags libpng
Duplicate definition of variable 'SAGE_ROOT' in '/Users/grout/sage/local/lib/pkgconfig/libpng.pc'
```

So I'm not sure that our pkg-config works right now.  At least `pkg-config --exists libpng` still works.



---

archive/issue_comments_094779.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOne other note.  I'm not sure that the basic idea of having ${SAGE_LOCAL} as a variable inside the .pc files works.  I just changed libpng.pc to not define `${SAGE_ROOT}`, but hopefully just take it out of the environment.  However, when I run pkg-config, it says:\n\n```\n$ pkg-config --cflags libpng\nVariable 'SAGE_ROOT' not defined in '/Users/grout/sage/local/lib/pkgconfig/libpng.pc'\n```\n\nSo I think the main idea of this ticket is doomed.",
    "created_at": "2011-04-21T15:54:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94779",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:14" align="right">comment:14</div>

One other note.  I'm not sure that the basic idea of having ${SAGE_LOCAL} as a variable inside the .pc files works.  I just changed libpng.pc to not define `${SAGE_ROOT}`, but hopefully just take it out of the environment.  However, when I run pkg-config, it says:

```
$ pkg-config --cflags libpng
Variable 'SAGE_ROOT' not defined in '/Users/grout/sage/local/lib/pkgconfig/libpng.pc'
```

So I think the main idea of this ticket is doomed.



---

archive/issue_comments_094780.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI take that back about this ticket being doomed.  In fact, the solution is *much* easier.  Instead of defining `${SAGE_ROOT}` at the top of pkg-config, we should wrap the system pkg-config using the --define-variable option:\n\n```\n       --define-variable=VARIABLENAME=VARIABLEVALUE\n              This sets a global value for a variable, overriding the value in any files. Most packages define the vari-\n              able \"prefix\", for example, so you can say:\n                $ pkg-config --print-errors --define-variable=prefix=/foo \\\n                             --variable=prefix glib-2.0\n                /foo\n\n```\n\nSo if we have a pkg-config in `$SAGE_ROOT/local/bin` which is something like:\n\n```\n#!/bin/sh\npkg-config --define-variable=SAGE_ROOT=<whatever> $*\n```\n\nthen we don't have to keep mucking with the .pc files every time our location moves.  We just need to do a simple string substitution the first time Sage is built or the first time any package makes a .pc file.\n\nThis solves both the main problem of this ticket and the problem with double-initialization.",
    "created_at": "2011-04-21T16:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94780",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:15" align="right">comment:15</div>

I take that back about this ticket being doomed.  In fact, the solution is *much* easier.  Instead of defining `${SAGE_ROOT}` at the top of pkg-config, we should wrap the system pkg-config using the --define-variable option:

```
       --define-variable=VARIABLENAME=VARIABLEVALUE
              This sets a global value for a variable, overriding the value in any files. Most packages define the vari-
              able "prefix", for example, so you can say:
                $ pkg-config --print-errors --define-variable=prefix=/foo \
                             --variable=prefix glib-2.0
                /foo

```

So if we have a pkg-config in `$SAGE_ROOT/local/bin` which is something like:

```
#!/bin/sh
pkg-config --define-variable=SAGE_ROOT=<whatever> $*
```

then we don't have to keep mucking with the .pc files every time our location moves.  We just need to do a simple string substitution the first time Sage is built or the first time any package makes a .pc file.

This solves both the main problem of this ticket and the problem with double-initialization.



---

archive/issue_comments_094781.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAnother very automatic solution for us:  patch pkg-config:\n\nhttp://lists.freedesktop.org/archives/pkg-config/2010-April/000531.html\n\nThe advantage to patching and distributing our own pkg-config is that then we can count on pkg-config, even on osx systems that don't come with it by default.",
    "created_at": "2011-04-21T16:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94781",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:16" align="right">comment:16</div>

Another very automatic solution for us:  patch pkg-config:

http://lists.freedesktop.org/archives/pkg-config/2010-April/000531.html

The advantage to patching and distributing our own pkg-config is that then we can count on pkg-config, even on osx systems that don't come with it by default.



---

archive/issue_comments_094782.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOnly one MB.  Comes with glib, which is perhaps half the download?",
    "created_at": "2011-04-21T16:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94782",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:17" align="right">comment:17</div>

Only one MB.  Comes with glib, which is perhaps half the download?



---

archive/issue_comments_094783.json:
```json
{
    "body": "Attachment: **[pkg-config-SAGE_ROOT.patch.gz](https://github.com/sagemath/sage/files/ticket10202/pkg-config-SAGE_ROOT.patch.gz)**\n\napply to sage scripts repository",
    "created_at": "2011-04-21T16:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94783",
    "user": "https://github.com/jasongrout"
}
```

Attachment: **[pkg-config-SAGE_ROOT.patch.gz](https://github.com/sagemath/sage/files/ticket10202/pkg-config-SAGE_ROOT.patch.gz)**

apply to sage scripts repository



---

archive/issue_events_134335.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-04-21T17:04:11Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "title_is": "Use pkg-config --define-variable option to set ${SAGE_ROOT} anytime pkg-config is invoked",
    "title_was": "Make freetype have ${SAGE_LOCAL} as its prefix in the pkgconfig file",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134335"
}
```



---

archive/issue_comments_094784.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,22 +1 @@\n-Following up on the comments at the end of #9221, let's see if we can do the following:\n-\n-\"At least for freetype, it should be possible to simply set prefix to $SAGE_LOCAL (unexpanded) rather than a hard-coded absolute path. (Done once, e.g. in its spkg-install.) \"\n-\n-This would a lot of hassle in the sage-location script if this works.  I'm not sure if these needs to be done as part of setting the prefix option on the command line when compiling, or if it needs to be done after freetype is installed (i.e., manually fix up the pkgconfig file)\n-\n-In short, this ticket is to modify the spkg-install file in the freetype spkg so that after installation, the freetype2.pc file would be something like:\n-\n-```\n-prefix=${SAGE_LOCAL}\n-exec_prefix=${prefix}\n-libdir=${exec_prefix}/lib\n-includedir=${prefix}/include\n-\n-Name: FreeType 2\n-Description: A free, high-quality, and portable font engine.\n-Version: 9.16.3\n-Requires:\n-Libs: -L${libdir} -lfreetype -lz \n-Cflags: -I${includedir}/freetype2 -I${includedir}\n-```\n-\n+Currently we rewrite all of the local/lib/pkgconfig/*.pc files every time we move locations. Instead, we should just use the --define-variable option of pkg-config to define a ${SAGE_ROOT} variable. Then we don't have to keep rewriting files every time.\n``````\n",
    "created_at": "2011-04-21T17:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94784",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,22 +1 @@
-Following up on the comments at the end of #9221, let's see if we can do the following:
-
-"At least for freetype, it should be possible to simply set prefix to $SAGE_LOCAL (unexpanded) rather than a hard-coded absolute path. (Done once, e.g. in its spkg-install.) "
-
-This would a lot of hassle in the sage-location script if this works.  I'm not sure if these needs to be done as part of setting the prefix option on the command line when compiling, or if it needs to be done after freetype is installed (i.e., manually fix up the pkgconfig file)
-
-In short, this ticket is to modify the spkg-install file in the freetype spkg so that after installation, the freetype2.pc file would be something like:
-
-```
-prefix=${SAGE_LOCAL}
-exec_prefix=${prefix}
-libdir=${exec_prefix}/lib
-includedir=${prefix}/include
-
-Name: FreeType 2
-Description: A free, high-quality, and portable font engine.
-Version: 9.16.3
-Requires:
-Libs: -L${libdir} -lfreetype -lz 
-Cflags: -I${includedir}/freetype2 -I${includedir}
-```
-
+Currently we rewrite all of the local/lib/pkgconfig/*.pc files every time we move locations. Instead, we should just use the --define-variable option of pkg-config to define a ${SAGE_ROOT} variable. Then we don't have to keep rewriting files every time.
``````




---

archive/issue_comments_094785.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nActually, that path to pkg-config won't solve our problem, since it involves modifying each of the pkg-config files anyway, and then things depend on the package, etc. So I don't think anymore that it would be better to ship pkg-config.\n\nI changed the description to reflect the patch's new solution.",
    "created_at": "2011-04-21T17:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94785",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:18" align="right">comment:18</div>

Actually, that path to pkg-config won't solve our problem, since it involves modifying each of the pkg-config files anyway, and then things depend on the package, etc. So I don't think anymore that it would be better to ship pkg-config.

I changed the description to reflect the patch's new solution.



---

archive/issue_comments_094786.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI'm going to set this to \"needs review\" as it needs testing on a lot of systems.  My guess is that it needs to be tested by making a new `sage_scripts` spkg and then a system needs to be built fresh with that new spkg.",
    "created_at": "2011-04-21T17:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94786",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:19" align="right">comment:19</div>

I'm going to set this to "needs review" as it needs testing on a lot of systems.  My guess is that it needs to be tested by making a new `sage_scripts` spkg and then a system needs to be built fresh with that new spkg.



---

archive/issue_comments_094787.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nSo what happens if the computer doesn't have pkg-config?",
    "created_at": "2011-04-21T17:14:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94787",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:20" align="right">comment:20</div>

So what happens if the computer doesn't have pkg-config?



---

archive/issue_comments_094788.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nNothing.  Same thing that happens now.",
    "created_at": "2011-04-21T17:16:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94788",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:21" align="right">comment:21</div>

Nothing.  Same thing that happens now.



---

archive/issue_comments_094789.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,13 @@\n Currently we rewrite all of the local/lib/pkgconfig/*.pc files every time we move locations. Instead, we should just use the --define-variable option of pkg-config to define a ${SAGE_ROOT} variable. Then we don't have to keep rewriting files every time.\n+\n+INSTRUCTIONS FOR TESTING:\n+\n+1. Download a fresh sage-4.7.alpha5.tar source archive\n+\n+2. Extract and delete the spkg/standard/sage_scripts-4.7.alpha5.spkg\n+\n+3. Put http://sage.math.washington.edu/home/jason/sage_scripts-4.7.alpha5.p0.spkg into the spkg/standard/ directory\n+\n+4. Make Sage\n+\n+\n``````\n",
    "created_at": "2011-04-21T18:07:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94789",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,13 @@
 Currently we rewrite all of the local/lib/pkgconfig/*.pc files every time we move locations. Instead, we should just use the --define-variable option of pkg-config to define a ${SAGE_ROOT} variable. Then we don't have to keep rewriting files every time.
+
+INSTRUCTIONS FOR TESTING:
+
+1. Download a fresh sage-4.7.alpha5.tar source archive
+
+2. Extract and delete the spkg/standard/sage_scripts-4.7.alpha5.spkg
+
+3. Put http://sage.math.washington.edu/home/jason/sage_scripts-4.7.alpha5.p0.spkg into the spkg/standard/ directory
+
+4. Make Sage
+
+
``````




---

archive/issue_events_134336.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-04-21T18:07:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134336"
}
```



---

archive/issue_comments_094790.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,8 @@\n \n 4. Make Sage\n \n+Note to release manager: you have to edit the sage_scripts spkg-install to copy over the pkg-config shell script; see my sage_scripts spkg above.\n \n+P.S. Why is the sage_scripts spkg-install not under version control?!?\n+\n+\n``````\n",
    "created_at": "2011-04-21T18:18:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94790",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,8 @@
 
 4. Make Sage
 
+Note to release manager: you have to edit the sage_scripts spkg-install to copy over the pkg-config shell script; see my sage_scripts spkg above.
 
+P.S. Why is the sage_scripts spkg-install not under version control?!?
+
+
``````




---

archive/issue_comments_094791.json:
```json
{
    "body": "Author: **Jason Grout**",
    "created_at": "2011-08-09T01:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94791",
    "user": "https://github.com/nexttime"
}
```

Author: **Jason Grout**



---

archive/issue_comments_094792.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nFinally (and again) returning to this...\n\n* We don't need to \"wrap\" `pkg-config` (and if we would, one should use `\"$@\"` instead of `$*`).\n* We don't have to `--define-variable=SAGE_ROOT=${SAGE_ROOT}`, provided we **don't** put any [hardcoded] definitions of `SAGE_ROOT` (or `SAGE_LOCAL`) into the `.pc` files, which I more than once said is totally superfluous if we for example use (literally) `prefix=${SAGE_ROOT}/local`:\n\n```python\ndef initialize_pkgconfig_files():\n    \"\"\"\n    Insert a sage_local variable in each pkg_config file and replace\n    them to make the paths portable.\n    \"\"\"\n    LIB = os.path.join(os.path.abspath(SAGE_ROOT), 'local', 'lib')\n    PKG = os.path.join(LIB,'pkgconfig')\n    for name in os.listdir(PKG):\n        filename=os.path.join(PKG,name)\n        if os.path.splitext(filename)[1]==\".pc\":\n            with open(filename) as file:\n                config = file.read()\n\n            new_config = config.replace(os.path.abspath(SAGE_ROOT), \"${SAGE_ROOT}\")\n\n            new_config = 'SAGE_ROOT=%s\\n'%os.path.abspath(SAGE_ROOT)+new_config\n\n            with open(filename, 'w') as file:\n                file.write(new_config)\n```\n (This is from `local/bin/sage-location`, Sage 4.7.1.rc0.) \n\n There we have to remove the second assignment to `new_config`. The function `update_pkgconfig_files()` should be deleted (or no longer used), since it just updates `SAGE_ROOT=...` definitions with a new **hardcoded path** for `SAGE_ROOT`.\n* We may still have to fix *a few* `.pc` files in their corresponding `spkg-install` files. I did this for R / `libR.pc` (cf. #9668) in a new r-2.10.1.p6 spkg (which I haven't yet uploaded though). For *most* `.pc` files defining `prefix=${SAGE_ROOT}/local` (see above) is sufficient, and `initialize_pkgconfig_files()` does this, although it could do better by explicitly looking for `^prefix=...`. (Also, we could do the same -- more reliably -- from some **shell** script, e.g. `sage-spkg`, using `sed`, since Python is not necessarily available during the build. If we do, we no longer have to deal with `.pc` files in `sage-location` at all. `sage-spkg` already calls `sage-make_relative` after every spkg installation, so this would fit well.)\n\nJason's new patch to `sage-location` already does\n* remove the second assignment to `new_config`, which defined `SAGE_ROOT` to the current `$SAGE_ROOT` (i.e., a hardcoded path),\n* remove the no longer necessary function `update_pkgconfig_files()`.\n\n(The note on) using `--define-variable=SAGE_ROOT=${SAGE_ROOT}` is not necessary though, see above.\n\nNo offense btw.",
    "created_at": "2011-08-09T01:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94792",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

Finally (and again) returning to this...

* We don't need to "wrap" `pkg-config` (and if we would, one should use `"$@"` instead of `$*`).
* We don't have to `--define-variable=SAGE_ROOT=${SAGE_ROOT}`, provided we **don't** put any [hardcoded] definitions of `SAGE_ROOT` (or `SAGE_LOCAL`) into the `.pc` files, which I more than once said is totally superfluous if we for example use (literally) `prefix=${SAGE_ROOT}/local`:

```python
def initialize_pkgconfig_files():
    """
    Insert a sage_local variable in each pkg_config file and replace
    them to make the paths portable.
    """
    LIB = os.path.join(os.path.abspath(SAGE_ROOT), 'local', 'lib')
    PKG = os.path.join(LIB,'pkgconfig')
    for name in os.listdir(PKG):
        filename=os.path.join(PKG,name)
        if os.path.splitext(filename)[1]==".pc":
            with open(filename) as file:
                config = file.read()

            new_config = config.replace(os.path.abspath(SAGE_ROOT), "${SAGE_ROOT}")

            new_config = 'SAGE_ROOT=%s\n'%os.path.abspath(SAGE_ROOT)+new_config

            with open(filename, 'w') as file:
                file.write(new_config)
```
 (This is from `local/bin/sage-location`, Sage 4.7.1.rc0.) 

 There we have to remove the second assignment to `new_config`. The function `update_pkgconfig_files()` should be deleted (or no longer used), since it just updates `SAGE_ROOT=...` definitions with a new **hardcoded path** for `SAGE_ROOT`.
* We may still have to fix *a few* `.pc` files in their corresponding `spkg-install` files. I did this for R / `libR.pc` (cf. #9668) in a new r-2.10.1.p6 spkg (which I haven't yet uploaded though). For *most* `.pc` files defining `prefix=${SAGE_ROOT}/local` (see above) is sufficient, and `initialize_pkgconfig_files()` does this, although it could do better by explicitly looking for `^prefix=...`. (Also, we could do the same -- more reliably -- from some **shell** script, e.g. `sage-spkg`, using `sed`, since Python is not necessarily available during the build. If we do, we no longer have to deal with `.pc` files in `sage-location` at all. `sage-spkg` already calls `sage-make_relative` after every spkg installation, so this would fit well.)

Jason's new patch to `sage-location` already does
* remove the second assignment to `new_config`, which defined `SAGE_ROOT` to the current `$SAGE_ROOT` (i.e., a hardcoded path),
* remove the no longer necessary function `update_pkgconfig_files()`.

(The note on) using `--define-variable=SAGE_ROOT=${SAGE_ROOT}` is not necessary though, see above.

No offense btw.



---

archive/issue_comments_094793.json:
```json
{
    "body": "Reviewer: **Leif Leonhardy**",
    "created_at": "2011-08-09T01:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94793",
    "user": "https://github.com/nexttime"
}
```

Reviewer: **Leif Leonhardy**



---

archive/issue_comments_094794.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nP.S.: I currently have no idea where the shell script I wrote is... 8/ (IIRC it consisted of *more* than a single `sed` line, to be more robust and address some corner cases.)",
    "created_at": "2011-08-09T01:34:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94794",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:25" align="right">comment:25</div>

P.S.: I currently have no idea where the shell script I wrote is... 8/ (IIRC it consisted of *more* than a single `sed` line, to be more robust and address some corner cases.)



---

archive/issue_comments_094795.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n*Unfortunately my reasoning is now spread across a few tickets...* 8/\n\nFirst of all, we don't have to wrap `pkg-config`, which would not necessarily be available during the whole build (including upgrades), and doing so might confuse [dumb] build scripts testing for its presence on systems that lack a \"real\" `pkg-config`.\n\nI now seem to recall why using `${SAGE_ROOT}` without explicitly defining it in the `.pc` files \"worked for me\" last year -- I was using `$${SAGE_ROOT}`, which postpones expansion to the shell, like it does in Makefiles.\n\nBut there is an even safer way (cf. [comment:ticket:11687:1 this comment] at #11687), namely to define the environment variable `PKG_CONFIG_TOP_BUILD_DIR` in `sage-env` and use the corresponding `.pc`-file variable `pc_top_builddir` (instead of `SAGE_ROOT`) in all `.pc` files, e.g.\n\n```sh\n# We set PKG_CONFIG_TOP_BUILD_DIR to $SAGE_ROOT in sage-env,\n# such that ${pc_top_builddir} always yields this.\nprefix=${pc_top_builddir}/local\n...\n# All further directory definitions are relative to ${pc_top_builddir}\n# or ${prefix}.\n```\n\nSubstitutions in (\"initialization\" of) `.pc` files should IMHO be performed from or better directly within `sage-spkg` (or an spkg's `spkg-install` if necessary), of course not \"fixing\" individual files more than once. We then can drop the `pkg-config`-related code in `sage-location` completely, or otherwise have to make sure it is consistent with the other one, i.e. doesn't mess things up afterwards (as it currently does).\n\nWe also have to fix setting `PKG_CONFIG_PATH` in `sage-env`; see #11687.",
    "created_at": "2011-08-14T17:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94795",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:26" align="right">comment:26</div>

*Unfortunately my reasoning is now spread across a few tickets...* 8/

First of all, we don't have to wrap `pkg-config`, which would not necessarily be available during the whole build (including upgrades), and doing so might confuse [dumb] build scripts testing for its presence on systems that lack a "real" `pkg-config`.

I now seem to recall why using `${SAGE_ROOT}` without explicitly defining it in the `.pc` files "worked for me" last year -- I was using `$${SAGE_ROOT}`, which postpones expansion to the shell, like it does in Makefiles.

But there is an even safer way (cf. [comment:ticket:11687:1 this comment] at #11687), namely to define the environment variable `PKG_CONFIG_TOP_BUILD_DIR` in `sage-env` and use the corresponding `.pc`-file variable `pc_top_builddir` (instead of `SAGE_ROOT`) in all `.pc` files, e.g.

```sh
# We set PKG_CONFIG_TOP_BUILD_DIR to $SAGE_ROOT in sage-env,
# such that ${pc_top_builddir} always yields this.
prefix=${pc_top_builddir}/local
...
# All further directory definitions are relative to ${pc_top_builddir}
# or ${prefix}.
```

Substitutions in ("initialization" of) `.pc` files should IMHO be performed from or better directly within `sage-spkg` (or an spkg's `spkg-install` if necessary), of course not "fixing" individual files more than once. We then can drop the `pkg-config`-related code in `sage-location` completely, or otherwise have to make sure it is consistent with the other one, i.e. doesn't mess things up afterwards (as it currently does).

We also have to fix setting `PKG_CONFIG_PATH` in `sage-env`; see #11687.



---

archive/issue_comments_094796.json:
```json
{
    "body": "Replying to [ticket:10202 jason]:\n> Note to release manager: you have to edit the sage_scripts spkg-install to copy over the pkg-config shell script; see my sage_scripts spkg above.\n\nI will certainly **not** do this.  I need a simply `hg` patch which I can apply.",
    "created_at": "2011-08-17T13:13:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94796",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:10202 jason]:
> Note to release manager: you have to edit the sage_scripts spkg-install to copy over the pkg-config shell script; see my sage_scripts spkg above.

I will certainly **not** do this.  I need a simply `hg` patch which I can apply.



---

archive/issue_comments_094797.json:
```json
{
    "body": "Replying to [ticket:10202 jason]:\n> Why is the sage_scripts spkg-install not under version control?!?\n\nInside the spkg, that file is `sage-spkg-install` which is under revision control.  Don't ask me why though...",
    "created_at": "2011-08-17T13:14:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94797",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:10202 jason]:
> Why is the sage_scripts spkg-install not under version control?!?

Inside the spkg, that file is `sage-spkg-install` which is under revision control.  Don't ask me why though...



---

archive/issue_comments_094798.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThis ticket IMHO needs work anyway (see above), and its title should be changed (or I can open another one with a different approach as pointed out above).",
    "created_at": "2011-08-17T16:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94798",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:29" align="right">comment:29</div>

This ticket IMHO needs work anyway (see above), and its title should be changed (or I can open another one with a different approach as pointed out above).



---

archive/issue_events_134337.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-17T16:05:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134337"
}
```



---

archive/issue_events_134338.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-17T16:05:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134338"
}
```



---

archive/issue_comments_094799.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThe one disadvantage I can see to the PC_TOP_BUILD_DIR solution is that if the user is already using that for some other purpose in their system-installed packages.  Using $${SAGE_ROOT} instead avoids this problem.\n\nAt any rate, I'm glad you're looking into this so carefully!",
    "created_at": "2011-08-17T16:26:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94799",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:30" align="right">comment:30</div>

The one disadvantage I can see to the PC_TOP_BUILD_DIR solution is that if the user is already using that for some other purpose in their system-installed packages.  Using $${SAGE_ROOT} instead avoids this problem.

At any rate, I'm glad you're looking into this so carefully!



---

archive/issue_comments_094800.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nIt also seems like using PC_TOP_BUILD_DIR in this way goes against its purpose.  That would confuse users, I think.",
    "created_at": "2011-08-17T16:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94800",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:31" align="right">comment:31</div>

It also seems like using PC_TOP_BUILD_DIR in this way goes against its purpose.  That would confuse users, I think.



---

archive/issue_comments_094801.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jasongrout](#comment:31):\n> It also seems like using PC_TOP_BUILD_DIR in this way goes against its purpose.  That would confuse users, I think.\n\nWell, it's just another situation where its application is useful (and which is quite similar to its original intent). The way Sage uses its own prefix / subtree of typical system directories (`$SAGE_ROOT/local/{bin,lib,include}`) is just not very common, so the developer of `pkg-config` didn't have it in mind.\n\nTo make it less obscure (to people actually looking at the `.pc` files), we could use\n\n```\nSAGE_ROOT=${pc_top_builddir} # the latter is set \"dynamically\" by sage-env\nprefix=${SAGE_ROOT}/local\n...\n# (further references to SAGE_ROOT rather than pc_top_builddir)\n```\n(Adding comments to the `.pc` files isn't bad anyway; I used to also add a comment telling when the file was [last] modified by Sage, e.g. for debugging.)\n\n\n\n\nW.r.t. users already using that variable (`pc_top_builddir`) for other purposes: \n\nI don't think anybody will have it in his/her system-wide `.pc` files, but at least in case `PKG_CONFIG_TOP_BUILD_DIR` is already set, we could issue a warning.\n\n\n\n\nUsing `$${SAGE_ROOT}` instead isn't that safe, since programs using parameters supplied by `pkg-config` do *not necessarily* use the shell to execute commands with these parameters (though they usually do; I'm currently not aware of any counter-example), in which case `${SAGE_ROOT}/...` would get passed verbatim to the commands, e.g. to the compiler or the linker.",
    "created_at": "2011-08-17T18:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94801",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jasongrout](#comment:31):
> It also seems like using PC_TOP_BUILD_DIR in this way goes against its purpose.  That would confuse users, I think.

Well, it's just another situation where its application is useful (and which is quite similar to its original intent). The way Sage uses its own prefix / subtree of typical system directories (`$SAGE_ROOT/local/{bin,lib,include}`) is just not very common, so the developer of `pkg-config` didn't have it in mind.

To make it less obscure (to people actually looking at the `.pc` files), we could use

```
SAGE_ROOT=${pc_top_builddir} # the latter is set "dynamically" by sage-env
prefix=${SAGE_ROOT}/local
...
# (further references to SAGE_ROOT rather than pc_top_builddir)
```
(Adding comments to the `.pc` files isn't bad anyway; I used to also add a comment telling when the file was [last] modified by Sage, e.g. for debugging.)




W.r.t. users already using that variable (`pc_top_builddir`) for other purposes: 

I don't think anybody will have it in his/her system-wide `.pc` files, but at least in case `PKG_CONFIG_TOP_BUILD_DIR` is already set, we could issue a warning.




Using `$${SAGE_ROOT}` instead isn't that safe, since programs using parameters supplied by `pkg-config` do *not necessarily* use the shell to execute commands with these parameters (though they usually do; I'm currently not aware of any counter-example), in which case `${SAGE_ROOT}/...` would get passed verbatim to the commands, e.g. to the compiler or the linker.



---

archive/issue_events_134339.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134339"
}
```



---

archive/issue_events_134340.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134340"
}
```



---

archive/issue_events_134341.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134341"
}
```



---

archive/issue_events_134342.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134342"
}
```



---

archive/issue_events_134343.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134343"
}
```



---

archive/issue_events_134344.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134344"
}
```



---

archive/issue_events_134345.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134345"
}
```



---

archive/issue_events_134346.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134346"
}
```



---

archive/issue_events_134347.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T01:01:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134347"
}
```



---

archive/issue_events_134348.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T01:01:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134348"
}
```



---

archive/issue_events_134349.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T01:01:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134349"
}
```



---

archive/issue_events_134350.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T01:01:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134350"
}
```



---

archive/issue_events_134351.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T01:01:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134351"
}
```



---

archive/issue_comments_094802.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThis is outdated and should be closed",
    "created_at": "2020-07-16T01:01:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94802",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

This is outdated and should be closed



---

archive/issue_comments_094803.json:
```json
{
    "body": "Changed reviewer from **Leif Leonhardy** to none",
    "created_at": "2020-07-16T01:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94803",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Leif Leonhardy** to none



---

archive/issue_comments_094804.json:
```json
{
    "body": "Changed author from **Jason Grout** to none",
    "created_at": "2020-07-16T01:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94804",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Jason Grout** to none



---

archive/issue_comments_094805.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-07-16T07:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10202#issuecomment-94805",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_134352.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-07-16T07:16:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134352"
}
```



---

archive/issue_events_134353.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-07-16T07:16:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134353"
}
```



---

archive/issue_events_134354.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-10-11T22:33:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134354"
}
```



---

archive/issue_events_134355.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-10-11T22:33:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134355"
}
```



---

archive/issue_events_134356.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-10-11T22:33:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10202",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10202#event-134356"
}
```
