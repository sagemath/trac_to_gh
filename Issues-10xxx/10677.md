# Issue 10677: Improve PARI interface for relative number fields

archive/issues_010624.json:
```json
{
    "body": "\n\nAssignee: @loefflerd\n\nCC:  @mstreng @jdemeyer\n\nKeywords: pari rnf\n\nResolution: fixed\n\nAuthor: Jeroen Demeyer\n\nReviewer: Marco Streng\n\nMerged: sage-4.7.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/10677\n\n",
    "closed_at": "2011-03-08T21:46:50Z",
    "created_at": "2011-01-23T18:03:52Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "Improve PARI interface for relative number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10677",
    "user": "https://github.com/jdemeyer"
}
```


Assignee: @loefflerd

CC:  @mstreng @jdemeyer

Keywords: pari rnf

Resolution: fixed

Author: Jeroen Demeyer

Reviewer: Marco Streng

Merged: sage-4.7.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/10677





---

archive/issue_comments_116729.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-23T20:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116729",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_116730.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-01-24T09:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116730",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_116731.json:
```json
{
    "body": "<a id='comment:2'></a>I still need to implement conversion from a PARI relative number field element.",
    "created_at": "2011-01-24T09:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116731",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I still need to implement conversion from a PARI relative number field element.



---

archive/issue_comments_116732.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-01-24T15:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116732",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_116733.json:
```json
{
    "body": "<a id='comment:4'></a>Looks good at first glance. Could you add doctests for `get_nf(self)` on line 671 of sage/libs/pari/gen.pyx?",
    "created_at": "2011-02-04T11:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116733",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:4'></a>Looks good at first glance. Could you add doctests for `get_nf(self)` on line 671 of sage/libs/pari/gen.pyx?



---

archive/issue_comments_116734.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 mstreng]:\n> Could you add doctests for `get_nf(self)`?\n\n(these would be implicit doctests I suppose)\n\nRelated to this: the documentation of `get_nf` seems to be more detailed than that of `nf_get_pol`. In particular, the documentation of `nf_get_pol` doesn't say that only nfinit, bnfinit and bnrinit are allowed (which I think it should). A doctest showing the error message for an rnfinit object would be useful.\n\nI think doctests showing that these functions work for bnfinit and rnfinit would be good too.",
    "created_at": "2011-02-04T12:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116734",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:5'></a>Replying to [comment:4 mstreng]:
> Could you add doctests for `get_nf(self)`?

(these would be implicit doctests I suppose)

Related to this: the documentation of `get_nf` seems to be more detailed than that of `nf_get_pol`. In particular, the documentation of `nf_get_pol` doesn't say that only nfinit, bnfinit and bnrinit are allowed (which I think it should). A doctest showing the error message for an rnfinit object would be useful.

I think doctests showing that these functions work for bnfinit and rnfinit would be good too.



---

archive/issue_comments_116735.json:
```json
{
    "body": "<a id='comment:6'></a>Hi Jeroen,\n\nDid you ever test your new code for converting PARI relative number field elements to Sage relative number field elements?\n\nI get this (on 4.6.2.alpha3 regardless of whether I apply your patch):\n\n```\nsage: p = pari(\"Mod(Mod(x, x^2-y), y^3+17)\"); p\n0\n```\nClearly \"0\" is incorrect. This seems to be a bug introduced by the PARI upgrade:\n\n```\n                    GP/PARI CALCULATOR Version 2.4.3 (alpha)\n(13:18) gp > Mod(Mod(x, x^2-y), y^3+17)\n%1 = 0\n(13:19) gp > Mod(Mod(x, x^2-y), y^3+17)==0\n%2 = 1\n```\n\n```\n                  GP/PARI CALCULATOR Version 2.3.4 (released)\n(13:16) gp > Mod(Mod(x, x^2-y), y^3+17)\n%1 = Mod(Mod(x, x^2 - y), y^3 + 17)\n(13:20) gp > Mod(Mod(x, x^2-y), y^3+17)==0\n%2 = 0\n```\nI can't test your patch this way:\n\n```\nsage: y = PolynomialRing(QQ,'y').gen()\nsage: K.<a> = NumberField(y^3+17)\nsage: x = PolynomialRing(K,'x').gen()\nsage: L.<b> = NumberField(x^2-a)\nsage: p = pari(\"Mod(Mod(x, x^2-y), y^3+17)\")\nsage: L(p)\n0\nsage: p.sage()\n0\nsage: p.sage().parent()\nInteger Ring\n```\nIt is possible that I am using PARI in the wrong way here. Regardless of that, your patch should contain an example of converting PARI relative number field elements to Sage relative number field elements.",
    "created_at": "2011-02-04T13:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116735",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:6'></a>Hi Jeroen,

Did you ever test your new code for converting PARI relative number field elements to Sage relative number field elements?

I get this (on 4.6.2.alpha3 regardless of whether I apply your patch):

```
sage: p = pari("Mod(Mod(x, x^2-y), y^3+17)"); p
0
```
Clearly "0" is incorrect. This seems to be a bug introduced by the PARI upgrade:

```
                    GP/PARI CALCULATOR Version 2.4.3 (alpha)
(13:18) gp > Mod(Mod(x, x^2-y), y^3+17)
%1 = 0
(13:19) gp > Mod(Mod(x, x^2-y), y^3+17)==0
%2 = 1
```

```
                  GP/PARI CALCULATOR Version 2.3.4 (released)
(13:16) gp > Mod(Mod(x, x^2-y), y^3+17)
%1 = Mod(Mod(x, x^2 - y), y^3 + 17)
(13:20) gp > Mod(Mod(x, x^2-y), y^3+17)==0
%2 = 0
```
I can't test your patch this way:

```
sage: y = PolynomialRing(QQ,'y').gen()
sage: K.<a> = NumberField(y^3+17)
sage: x = PolynomialRing(K,'x').gen()
sage: L.<b> = NumberField(x^2-a)
sage: p = pari("Mod(Mod(x, x^2-y), y^3+17)")
sage: L(p)
0
sage: p.sage()
0
sage: p.sage().parent()
Integer Ring
```
It is possible that I am using PARI in the wrong way here. Regardless of that, your patch should contain an example of converting PARI relative number field elements to Sage relative number field elements.



---

archive/issue_comments_116736.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-02-04T13:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116736",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_116737.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 mstreng]:\n> Clearly \"0\" is incorrect.\n\n\nWhether or not \"0\" is correct, I believe you are doing things the wrong way.  The following is a proper example of a PARI relative number field element::\n\n```\nMod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)\n```\n\nHere, K is the field over QQ defined by `y^3 + 17` and L is the extension defined by `x^2 - y`.\n\nThere is an example in my patch in `sage/rings/number_field/number_field_element.pyx`, line 3316.  But it might be a good idea to expand this.",
    "created_at": "2011-02-04T13:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116737",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:6 mstreng]:
> Clearly "0" is incorrect.


Whether or not "0" is correct, I believe you are doing things the wrong way.  The following is a proper example of a PARI relative number field element::

```
Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)
```

Here, K is the field over QQ defined by `y^3 + 17` and L is the extension defined by `x^2 - y`.

There is an example in my patch in `sage/rings/number_field/number_field_element.pyx`, line 3316.  But it might be a good idea to expand this.



---

archive/issue_comments_116738.json:
```json
{
    "body": "<a id='comment:8'></a>\n```\nsage: sage: y = PolynomialRing(QQ,'y').gen()\nsage: sage: K.<a> = NumberField(y^3+17)\nsage: sage: x = PolynomialRing(K,'x').gen()\nsage: sage: L.<b> = NumberField(x^2-a)\nsage: p = pari(\"Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)\")\nsage: L(p)\na*b + 1\n```",
    "created_at": "2011-02-04T13:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116738",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
```
sage: sage: y = PolynomialRing(QQ,'y').gen()
sage: sage: K.<a> = NumberField(y^3+17)
sage: sage: x = PolynomialRing(K,'x').gen()
sage: sage: L.<b> = NumberField(x^2-a)
sage: p = pari("Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)")
sage: L(p)
a*b + 1
```



---

archive/issue_comments_116739.json:
```json
{
    "body": "<a id='comment:9'></a>Added another example.",
    "created_at": "2011-02-04T14:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116739",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Added another example.



---

archive/issue_comments_116740.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-02-04T14:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116740",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_116741.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [10677_pari_rnf.patch](tarball://root/attachments/some-uuid/ticket10677/10677_pari_rnf.patch) by @mstreng created at 2011-02-04 14:23:46\n\nReplying to [comment:7 jdemeyer]:\n> The following is a proper example of a PARI relative number field element::\n> \n> ```\n> Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)\n> ```\n\n\nOf course, sorry about that.\n\nI don't know how much work it is, but as you are adding extra examples anyway, perhaps you could fix this:\n\n```\nsage: K.<a> = QuadraticField(-5)\nsage: p = pari(\"Mod(x,x^2+7)\")\nsage: K(p)\na\nsage: K(p)^2\n-5\nsage: p^2\nMod(-7, x^2 + 7)\n```\nThe same issue is there with your code:\n\n```\nsage: y = PolynomialRing(QQ,'y').gen()\nsage: K.<a> = NumberField(y^3+17)\nsage: x = PolynomialRing(K,'x').gen()\nsage: L.<b> = NumberField(x^2-a)\nsage: q = pari(\"Mod(Mod(y, y^3 + 19)*x + Mod(1, y^3 + 23), x^2 - y + 1)\")\nsage: L(q)\na*b\n```\nI think K(p) and L(q) should raise errors.\n\n> There is an example in my patch in `sage/rings/number_field/number_field_element.pyx`, line 3316.  But it might be a good idea to expand this.\n\n\nGreat! I'd say\n\n* at least one example with the completely written out correct form of PARI, in case idiots like me swap the moduli around again.\n\n* at least one example with the incorrect moduli that raises an error (like my examples in this comment).\n\n* at least one example in the documentation of the `__init__` method of `NumberFieldElement` (because that is where your new code is).",
    "created_at": "2011-02-04T14:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116741",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:10'></a>Attachment [10677_pari_rnf.patch](tarball://root/attachments/some-uuid/ticket10677/10677_pari_rnf.patch) by @mstreng created at 2011-02-04 14:23:46

Replying to [comment:7 jdemeyer]:
> The following is a proper example of a PARI relative number field element::
> 
> ```
> Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)
> ```


Of course, sorry about that.

I don't know how much work it is, but as you are adding extra examples anyway, perhaps you could fix this:

```
sage: K.<a> = QuadraticField(-5)
sage: p = pari("Mod(x,x^2+7)")
sage: K(p)
a
sage: K(p)^2
-5
sage: p^2
Mod(-7, x^2 + 7)
```
The same issue is there with your code:

```
sage: y = PolynomialRing(QQ,'y').gen()
sage: K.<a> = NumberField(y^3+17)
sage: x = PolynomialRing(K,'x').gen()
sage: L.<b> = NumberField(x^2-a)
sage: q = pari("Mod(Mod(y, y^3 + 19)*x + Mod(1, y^3 + 23), x^2 - y + 1)")
sage: L(q)
a*b
```
I think K(p) and L(q) should raise errors.

> There is an example in my patch in `sage/rings/number_field/number_field_element.pyx`, line 3316.  But it might be a good idea to expand this.


Great! I'd say

* at least one example with the completely written out correct form of PARI, in case idiots like me swap the moduli around again.

* at least one example with the incorrect moduli that raises an error (like my examples in this comment).

* at least one example in the documentation of the `__init__` method of `NumberFieldElement` (because that is where your new code is).



---

archive/issue_comments_116742.json:
```json
{
    "body": "Attachment [10677_check.patch](tarball://root/attachments/some-uuid/ticket10677/10677_check.patch) by @jdemeyer created at 2011-02-05 14:40:39\n\nApply on top of previous patch",
    "created_at": "2011-02-05T14:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116742",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10677_check.patch](tarball://root/attachments/some-uuid/ticket10677/10677_check.patch) by @jdemeyer created at 2011-02-05 14:40:39

Apply on top of previous patch



---

archive/issue_comments_116743.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 mstreng]:\n> * at least one example with the incorrect moduli that raises an error (like my examples in this comment).\n \nDone for absolute elements.  For relative elements, the checking is impossible because it should be done by PARI's `rnfeltreltoabs()`, but it's not.\n\n> * at least one example in the documentation of the `__init__` method of `NumberFieldElement` (because that is where your new code is).\n \nI decided not to do this, because it would lead to duplication and also because there isn't a single example of relative number fields in `NumberFieldElement.__init__()`.\n\nI've added the new patch, but I still need to doctest it (also together with #2329).",
    "created_at": "2011-02-05T14:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116743",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:10 mstreng]:
> * at least one example with the incorrect moduli that raises an error (like my examples in this comment).
 
Done for absolute elements.  For relative elements, the checking is impossible because it should be done by PARI's `rnfeltreltoabs()`, but it's not.

> * at least one example in the documentation of the `__init__` method of `NumberFieldElement` (because that is where your new code is).
 
I decided not to do this, because it would lead to duplication and also because there isn't a single example of relative number fields in `NumberFieldElement.__init__()`.

I've added the new patch, but I still need to doctest it (also together with #2329).



---

archive/issue_comments_116744.json:
```json
{
    "body": "<a id='comment:12'></a>Great, I'll probably have some time to review it tomorrow.",
    "created_at": "2011-02-05T15:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116744",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:12'></a>Great, I'll probably have some time to review it tomorrow.



---

archive/issue_comments_116745.json:
```json
{
    "body": "<a id='comment:13'></a>All long doctests pass with this ticket and #2329 applied.",
    "created_at": "2011-02-05T18:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116745",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>All long doctests pass with this ticket and #2329 applied.



---

archive/issue_comments_116746.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-06T14:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116746",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_116747.json:
```json
{
    "body": "<a id='comment:14'></a>Looks good.",
    "created_at": "2011-02-06T14:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116747",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:14'></a>Looks good.



---

archive/issue_events_027518.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-07T20:20:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "milestone": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10677#event-27518"
}
```



---

archive/issue_comments_116748.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-03-08T21:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10677#issuecomment-116748",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_027519.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-08T21:46:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10677",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10677#event-27519"
}
```
