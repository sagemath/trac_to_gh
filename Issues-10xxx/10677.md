# Issue 10677: Improve PARI interface for relative number fields

archive/issues_010624.json:
```json
{
    "assignees": [],
    "body": "\n\nAssignee: **@loefflerd**\n\nCC:  @mstreng @jdemeyer\n\nKeywords: **pari rnf**\n\nAuthor: **Jeroen Demeyer**\n\nReviewer: **Marco Streng**\n\nMerged: **sage-4.7.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10677_\n\n",
    "closed_at": "2011-03-08T21:46:50Z",
    "created_at": "2011-01-23T18:03:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve PARI interface for relative number fields",
    "type": "issue",
    "updated_at": "2011-03-08T21:46:50Z",
    "url": "https://github.com/sagemath/sage/issues/10677",
    "user": "https://github.com/jdemeyer"
}
```


Assignee: **@loefflerd**

CC:  @mstreng @jdemeyer

Keywords: **pari rnf**

Author: **Jeroen Demeyer**

Reviewer: **Marco Streng**

Merged: **sage-4.7.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/10677_





---

archive/issue_events_128563.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-23T18:03:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128563"
}
```



---

archive/issue_events_128564.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-23T18:03:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "component: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128564"
}
```



---

archive/issue_events_128565.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-23T18:03:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128565"
}
```



---

archive/issue_events_128566.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-23T18:03:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128566"
}
```



---

archive/issue_comments_104466.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2011-01-23T20:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104466",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_events_128567.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-23T20:12:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128567"
}
```



---

archive/issue_events_128568.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-24T09:46:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128568"
}
```



---

archive/issue_events_128569.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-24T09:46:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128569"
}
```



---

archive/issue_comments_104467.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nI still need to implement conversion from a PARI relative number field element.",
    "created_at": "2011-01-24T09:46:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104467",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">Comment 2</div>

I still need to implement conversion from a PARI relative number field element.



---

archive/issue_events_128570.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-24T15:21:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128570"
}
```



---

archive/issue_events_128571.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-24T15:21:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128571"
}
```



---

archive/issue_comments_104468.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nLooks good at first glance. Could you add doctests for `get_nf(self)` on line 671 of sage/libs/pari/gen.pyx?",
    "created_at": "2011-02-04T11:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104468",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:4" align="right">Comment 4</div>

Looks good at first glance. Could you add doctests for `get_nf(self)` on line 671 of sage/libs/pari/gen.pyx?



---

archive/issue_comments_104469.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@mstreng](#comment%3A4):\n> Could you add doctests for `get_nf(self)`?\n\n(these would be implicit doctests I suppose)\n\nRelated to this: the documentation of `get_nf` seems to be more detailed than that of `nf_get_pol`. In particular, the documentation of `nf_get_pol` doesn't say that only nfinit, bnfinit and bnrinit are allowed (which I think it should). A doctest showing the error message for an rnfinit object would be useful.\n\nI think doctests showing that these functions work for bnfinit and rnfinit would be good too.",
    "created_at": "2011-02-04T12:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104469",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@mstreng](#comment%3A4):
> Could you add doctests for `get_nf(self)`?

(these would be implicit doctests I suppose)

Related to this: the documentation of `get_nf` seems to be more detailed than that of `nf_get_pol`. In particular, the documentation of `nf_get_pol` doesn't say that only nfinit, bnfinit and bnrinit are allowed (which I think it should). A doctest showing the error message for an rnfinit object would be useful.

I think doctests showing that these functions work for bnfinit and rnfinit would be good too.



---

archive/issue_comments_104470.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nHi Jeroen,\n\nDid you ever test your new code for converting PARI relative number field elements to Sage relative number field elements?\n\nI get this (on 4.6.2.alpha3 regardless of whether I apply your patch):\n\n```\nsage: p = pari(\"Mod(Mod(x, x^2-y), y^3+17)\"); p\n0\n```\nClearly \"0\" is incorrect. This seems to be a bug introduced by the PARI upgrade:\n\n```\n                    GP/PARI CALCULATOR Version 2.4.3 (alpha)\n(13:18) gp > Mod(Mod(x, x^2-y), y^3+17)\n%1 = 0\n(13:19) gp > Mod(Mod(x, x^2-y), y^3+17)==0\n%2 = 1\n```\n\n```\n                  GP/PARI CALCULATOR Version 2.3.4 (released)\n(13:16) gp > Mod(Mod(x, x^2-y), y^3+17)\n%1 = Mod(Mod(x, x^2 - y), y^3 + 17)\n(13:20) gp > Mod(Mod(x, x^2-y), y^3+17)==0\n%2 = 0\n```\nI can't test your patch this way:\n\n```\nsage: y = PolynomialRing(QQ,'y').gen()\nsage: K.<a> = NumberField(y^3+17)\nsage: x = PolynomialRing(K,'x').gen()\nsage: L.<b> = NumberField(x^2-a)\nsage: p = pari(\"Mod(Mod(x, x^2-y), y^3+17)\")\nsage: L(p)\n0\nsage: p.sage()\n0\nsage: p.sage().parent()\nInteger Ring\n```\nIt is possible that I am using PARI in the wrong way here. Regardless of that, your patch should contain an example of converting PARI relative number field elements to Sage relative number field elements.",
    "created_at": "2011-02-04T13:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104470",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:6" align="right">Comment 6</div>

Hi Jeroen,

Did you ever test your new code for converting PARI relative number field elements to Sage relative number field elements?

I get this (on 4.6.2.alpha3 regardless of whether I apply your patch):

```
sage: p = pari("Mod(Mod(x, x^2-y), y^3+17)"); p
0
```
Clearly "0" is incorrect. This seems to be a bug introduced by the PARI upgrade:

```
                    GP/PARI CALCULATOR Version 2.4.3 (alpha)
(13:18) gp > Mod(Mod(x, x^2-y), y^3+17)
%1 = 0
(13:19) gp > Mod(Mod(x, x^2-y), y^3+17)==0
%2 = 1
```

```
                  GP/PARI CALCULATOR Version 2.3.4 (released)
(13:16) gp > Mod(Mod(x, x^2-y), y^3+17)
%1 = Mod(Mod(x, x^2 - y), y^3 + 17)
(13:20) gp > Mod(Mod(x, x^2-y), y^3+17)==0
%2 = 0
```
I can't test your patch this way:

```
sage: y = PolynomialRing(QQ,'y').gen()
sage: K.<a> = NumberField(y^3+17)
sage: x = PolynomialRing(K,'x').gen()
sage: L.<b> = NumberField(x^2-a)
sage: p = pari("Mod(Mod(x, x^2-y), y^3+17)")
sage: L(p)
0
sage: p.sage()
0
sage: p.sage().parent()
Integer Ring
```
It is possible that I am using PARI in the wrong way here. Regardless of that, your patch should contain an example of converting PARI relative number field elements to Sage relative number field elements.



---

archive/issue_events_128572.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-02-04T13:25:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128572"
}
```



---

archive/issue_events_128573.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-02-04T13:25:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128573"
}
```



---

archive/issue_comments_104471.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@mstreng](#comment%3A6):\n> Clearly \"0\" is incorrect.\n\nWhether or not \"0\" is correct, I believe you are doing things the wrong way.  The following is a proper example of a PARI relative number field element::\n\n```\nMod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)\n```\n\nHere, K is the field over QQ defined by `y^3 + 17` and L is the extension defined by `x^2 - y`.\n\nThere is an example in my patch in `sage/rings/number_field/number_field_element.pyx`, line 3316.  But it might be a good idea to expand this.",
    "created_at": "2011-02-04T13:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104471",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@mstreng](#comment%3A6):
> Clearly "0" is incorrect.

Whether or not "0" is correct, I believe you are doing things the wrong way.  The following is a proper example of a PARI relative number field element::

```
Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)
```

Here, K is the field over QQ defined by `y^3 + 17` and L is the extension defined by `x^2 - y`.

There is an example in my patch in `sage/rings/number_field/number_field_element.pyx`, line 3316.  But it might be a good idea to expand this.



---

archive/issue_comments_104472.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\n\n```\nsage: sage: y = PolynomialRing(QQ,'y').gen()\nsage: sage: K.<a> = NumberField(y^3+17)\nsage: sage: x = PolynomialRing(K,'x').gen()\nsage: sage: L.<b> = NumberField(x^2-a)\nsage: p = pari(\"Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)\")\nsage: L(p)\na*b + 1\n```",
    "created_at": "2011-02-04T13:58:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104472",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">Comment 8</div>


```
sage: sage: y = PolynomialRing(QQ,'y').gen()
sage: sage: K.<a> = NumberField(y^3+17)
sage: sage: x = PolynomialRing(K,'x').gen()
sage: sage: L.<b> = NumberField(x^2-a)
sage: p = pari("Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)")
sage: L(p)
a*b + 1
```



---

archive/issue_comments_104473.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nAdded another example.",
    "created_at": "2011-02-04T14:04:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104473",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">Comment 9</div>

Added another example.



---

archive/issue_events_128574.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-04T14:04:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128574"
}
```



---

archive/issue_events_128575.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-04T14:04:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128575"
}
```



---

archive/issue_comments_104474.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nAttachment: **[10677_pari_rnf.patch.gz](https://github.com/sagemath/sage/files/ticket10677/10677_pari_rnf.patch.gz)**\n\nReplying to [@jdemeyer](#comment%3A7):\n> The following is a proper example of a PARI relative number field element::\n> \n> ```\n> Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)\n> ```\n\nOf course, sorry about that.\n\nI don't know how much work it is, but as you are adding extra examples anyway, perhaps you could fix this:\n\n```\nsage: K.<a> = QuadraticField(-5)\nsage: p = pari(\"Mod(x,x^2+7)\")\nsage: K(p)\na\nsage: K(p)^2\n-5\nsage: p^2\nMod(-7, x^2 + 7)\n```\nThe same issue is there with your code:\n\n```\nsage: y = PolynomialRing(QQ,'y').gen()\nsage: K.<a> = NumberField(y^3+17)\nsage: x = PolynomialRing(K,'x').gen()\nsage: L.<b> = NumberField(x^2-a)\nsage: q = pari(\"Mod(Mod(y, y^3 + 19)*x + Mod(1, y^3 + 23), x^2 - y + 1)\")\nsage: L(q)\na*b\n```\nI think K(p) and L(q) should raise errors.\n\n> There is an example in my patch in `sage/rings/number_field/number_field_element.pyx`, line 3316.  But it might be a good idea to expand this.\n\nGreat! I'd say\n\n* at least one example with the completely written out correct form of PARI, in case idiots like me swap the moduli around again.\n\n* at least one example with the incorrect moduli that raises an error (like my examples in this comment).\n\n* at least one example in the documentation of the `__init__` method of `NumberFieldElement` (because that is where your new code is).",
    "created_at": "2011-02-04T14:23:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104474",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:10" align="right">Comment 10</div>

Attachment: **[10677_pari_rnf.patch.gz](https://github.com/sagemath/sage/files/ticket10677/10677_pari_rnf.patch.gz)**

Replying to [@jdemeyer](#comment%3A7):
> The following is a proper example of a PARI relative number field element::
> 
> ```
> Mod(Mod(y, y^3 + 17)*x + Mod(1, y^3 + 17), x^2 - y)
> ```

Of course, sorry about that.

I don't know how much work it is, but as you are adding extra examples anyway, perhaps you could fix this:

```
sage: K.<a> = QuadraticField(-5)
sage: p = pari("Mod(x,x^2+7)")
sage: K(p)
a
sage: K(p)^2
-5
sage: p^2
Mod(-7, x^2 + 7)
```
The same issue is there with your code:

```
sage: y = PolynomialRing(QQ,'y').gen()
sage: K.<a> = NumberField(y^3+17)
sage: x = PolynomialRing(K,'x').gen()
sage: L.<b> = NumberField(x^2-a)
sage: q = pari("Mod(Mod(y, y^3 + 19)*x + Mod(1, y^3 + 23), x^2 - y + 1)")
sage: L(q)
a*b
```
I think K(p) and L(q) should raise errors.

> There is an example in my patch in `sage/rings/number_field/number_field_element.pyx`, line 3316.  But it might be a good idea to expand this.

Great! I'd say

* at least one example with the completely written out correct form of PARI, in case idiots like me swap the moduli around again.

* at least one example with the incorrect moduli that raises an error (like my examples in this comment).

* at least one example in the documentation of the `__init__` method of `NumberFieldElement` (because that is where your new code is).



---

archive/issue_comments_104475.json:
```json
{
    "body": "Attachment: **[10677_check.patch.gz](https://github.com/sagemath/sage/files/ticket10677/10677_check.patch.gz)**\n\nApply on top of previous patch",
    "created_at": "2011-02-05T14:40:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104475",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[10677_check.patch.gz](https://github.com/sagemath/sage/files/ticket10677/10677_check.patch.gz)**

Apply on top of previous patch



---

archive/issue_comments_104476.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@mstreng](#comment%3A10):\n> * at least one example with the incorrect moduli that raises an error (like my examples in this comment).\n\nDone for absolute elements.  For relative elements, the checking is impossible because it should be done by PARI's `rnfeltreltoabs()`, but it's not.\n\n> * at least one example in the documentation of the `__init__` method of `NumberFieldElement` (because that is where your new code is).\n\nI decided not to do this, because it would lead to duplication and also because there isn't a single example of relative number fields in `NumberFieldElement.__init__()`.\n\nI've added the new patch, but I still need to doctest it (also together with #2329).",
    "created_at": "2011-02-05T14:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104476",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@mstreng](#comment%3A10):
> * at least one example with the incorrect moduli that raises an error (like my examples in this comment).

Done for absolute elements.  For relative elements, the checking is impossible because it should be done by PARI's `rnfeltreltoabs()`, but it's not.

> * at least one example in the documentation of the `__init__` method of `NumberFieldElement` (because that is where your new code is).

I decided not to do this, because it would lead to duplication and also because there isn't a single example of relative number fields in `NumberFieldElement.__init__()`.

I've added the new patch, but I still need to doctest it (also together with #2329).



---

archive/issue_comments_104477.json:
```json
{
    "body": "Reviewer: **Marco Streng**",
    "created_at": "2011-02-05T14:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104477",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Marco Streng**



---

archive/issue_comments_104478.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nGreat, I'll probably have some time to review it tomorrow.",
    "created_at": "2011-02-05T15:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104478",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:12" align="right">Comment 12</div>

Great, I'll probably have some time to review it tomorrow.



---

archive/issue_comments_104479.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nAll long doctests pass with this ticket and #2329 applied.",
    "created_at": "2011-02-05T18:24:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104479",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">Comment 13</div>

All long doctests pass with this ticket and #2329 applied.



---

archive/issue_events_128576.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-02-06T14:30:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128576"
}
```



---

archive/issue_events_128577.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-02-06T14:30:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128577"
}
```



---

archive/issue_comments_104480.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nLooks good.",
    "created_at": "2011-02-06T14:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104480",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:14" align="right">Comment 14</div>

Looks good.



---

archive/issue_events_128578.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-07T20:20:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128578"
}
```



---

archive/issue_events_128579.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-07T20:20:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128579"
}
```



---

archive/issue_comments_104481.json:
```json
{
    "body": "Merged: **sage-4.7.alpha1**",
    "created_at": "2011-03-08T21:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10677#issuecomment-104481",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.alpha1**



---

archive/issue_events_128580.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-08T21:46:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128580"
}
```



---

archive/issue_events_128581.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-08T21:46:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10677",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10677#event-128581"
}
```
