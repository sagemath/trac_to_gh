# Issue 10355: containment for multivariate polynomial rings

archive/issues_010354.json:
```json
{
    "body": "A bug in containment for multivariate polynomial rings:\n\n```\nsage: A1.<a> = PolynomialRing(QQ)\nsage: 3 in A1\nTrue\n\nsage: A2.<a,b> = PolynomialRing(QQ)\nsage: 3 in A2\nFalse \n\nsage: A1(a) in A2\nFalse\n```\n\nThis occurs because `__contains__(self,x)` for multivariate polynomial rings simply tests whether the parent of `x` is `self`.  Instead, it should inherit `__contains__` from the class `Parent`.  Further discussion can be found on this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/dab74506d9ff94bf).\n\n## Apply\n\n1. [attachment:trac_10355_multi_polynomial_containment_2.patch]\n2. [attachment:trac_10355_polynomial_containment_in_toric_varieties.patch]\n\n**Assignee:** @malb\n\n**CC:**  @novoselt\n\n**Keywords:** multivariate polynomial containment\n\n**Resolution:** fixed\n\n**Author:** Niles Johnson, Andrey Novoseltsev\n\n**Reviewer:** Volker Braun\n\n**Merged:** sage-4.6.2.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/10355\n\n",
    "closed_at": "2011-01-25T08:16:07Z",
    "created_at": "2010-11-29T18:05:06Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "containment for multivariate polynomial rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10355",
    "user": "https://github.com/nilesjohnson"
}
```
A bug in containment for multivariate polynomial rings:

```
sage: A1.<a> = PolynomialRing(QQ)
sage: 3 in A1
True

sage: A2.<a,b> = PolynomialRing(QQ)
sage: 3 in A2
False 

sage: A1(a) in A2
False
```

This occurs because `__contains__(self,x)` for multivariate polynomial rings simply tests whether the parent of `x` is `self`.  Instead, it should inherit `__contains__` from the class `Parent`.  Further discussion can be found on this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/dab74506d9ff94bf).

## Apply

1. [attachment:trac_10355_multi_polynomial_containment_2.patch]
2. [attachment:trac_10355_polynomial_containment_in_toric_varieties.patch]

**Assignee:** @malb

**CC:**  @novoselt

**Keywords:** multivariate polynomial containment

**Resolution:** fixed

**Author:** Niles Johnson, Andrey Novoseltsev

**Reviewer:** Volker Braun

**Merged:** sage-4.6.2.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/10355





---

archive/attachments_013559.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10355_multi_polynomial_containment.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10355/trac_10355_multi_polynomial_containment.patch",
    "created_at": "2010-11-29T19:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nilesjohnson"
}
```



---

archive/issue_comments_134220.json:
```json
{
    "body": "",
    "created_at": "2010-11-29T19:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134220",
    "user": "https://github.com/nilesjohnson"
}
```





---

archive/issue_comments_134221.json:
```json
{
    "body": "<a id='comment:1'></a>\nI've added a first version of a patch; it simply deletes the definition of `__contains__` for multivariate polynomial rings, allowing it to be inherited from `Parent`.  Unfortunately, this fails some doctests:\n\n```\nsage -t -long devel/sage-main/sage/schemes/generic/toric_variety.py # 5 doctests failed\nsage -t -long devel/sage-main/sage/misc/trace.py # 2 doctests failed\n```",
    "created_at": "2010-11-29T19:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134221",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:1'></a>
I've added a first version of a patch; it simply deletes the definition of `__contains__` for multivariate polynomial rings, allowing it to be inherited from `Parent`.  Unfortunately, this fails some doctests:

```
sage -t -long devel/sage-main/sage/schemes/generic/toric_variety.py # 5 doctests failed
sage -t -long devel/sage-main/sage/misc/trace.py # 2 doctests failed
```



---

archive/issue_comments_134222.json:
```json
{
    "body": "**Work_Issues:** address failing doctests",
    "created_at": "2010-11-29T19:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134222",
    "user": "https://github.com/nilesjohnson"
}
```

**Work_Issues:** address failing doctests



---

archive/issue_comments_134223.json:
```json
{
    "body": "**Changing status** from new to needs_work.",
    "created_at": "2010-11-29T19:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134223",
    "user": "https://github.com/nilesjohnson"
}
```

**Changing status** from new to needs_work.



---

archive/issue_comments_134224.json:
```json
{
    "body": "<a id='comment:2'></a>\nHi Andrey,\n\nI'm working on a very simple bug in containment for multivariate polynomials, but the obvious fix is causing doctest failures in your `toric_variety.py` code, which I'm afraid I don't understand.  Could you help me figure out what the basic problem is, so that I can try to fix it? (Note that almost all of the sage library seems to work fine; `toric_variety.py` is the only file with significant failures.)\n\nDetails can be found on this ticket page, or I can write to you separately. (you can find my email at [http://nilesjohnson.net](http://nilesjohnson.net))\n\nthanks,\nNiles",
    "created_at": "2010-11-30T01:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134224",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:2'></a>
Hi Andrey,

I'm working on a very simple bug in containment for multivariate polynomials, but the obvious fix is causing doctest failures in your `toric_variety.py` code, which I'm afraid I don't understand.  Could you help me figure out what the basic problem is, so that I can try to fix it? (Note that almost all of the sage library seems to work fine; `toric_variety.py` is the only file with significant failures.)

Details can be found on this ticket page, or I can write to you separately. (you can find my email at [http://nilesjohnson.net](http://nilesjohnson.net))

thanks,
Niles



---

archive/issue_comments_134225.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-11-30T02:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134225",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_134226.json:
```json
{
    "body": "<a id='comment:3'></a>\nHere's a patch which I think fixes the problem in toric_variety.py.  Is it a reasonable fix?",
    "created_at": "2010-11-30T02:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134226",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
Here's a patch which I think fixes the problem in toric_variety.py.  Is it a reasonable fix?



---

archive/issue_comments_134227.json:
```json
{
    "body": "apply together with other patch",
    "created_at": "2010-11-30T02:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134227",
    "user": "https://github.com/jhpalmieri"
}
```

apply together with other patch



---

archive/attachments_013560.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10355-toric.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10355/trac_10355-toric.patch",
    "created_at": "2010-11-30T02:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_134228.json:
```json
{
    "body": "<a id='comment:4'></a>\nSince the main patch deletes code instead of adding anything, where is the right place to put a doctest to verify that it works the way it is now supposed to?",
    "created_at": "2010-11-30T02:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134228",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Since the main patch deletes code instead of adding anything, where is the right place to put a doctest to verify that it works the way it is now supposed to?



---

archive/attachments_013561.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10355_polynomial_containment_in_toric_varieties.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10355/trac_10355_polynomial_containment_in_toric_varieties.patch",
    "created_at": "2010-11-30T03:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/novoselt"
}
```



---

archive/issue_comments_134229.json:
```json
{
    "body": "",
    "created_at": "2010-11-30T03:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134229",
    "user": "https://github.com/novoselt"
}
```





---

archive/issue_comments_134230.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jhpalmieri](#comment%3A3):\n> Here's a patch which I think fixes the problem in toric_variety.py.  Is it a reasonable fix?\n\n\nIt was fixing the issue due to the changes of this ticket, but it was actually more of a bug, so I attached an alternative version and added a little doctest checking that plain numbers are also interpreted correctly as polynomials.",
    "created_at": "2010-11-30T03:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134230",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>
Replying to [jhpalmieri](#comment%3A3):
> Here's a patch which I think fixes the problem in toric_variety.py.  Is it a reasonable fix?


It was fixing the issue due to the changes of this ticket, but it was actually more of a bug, so I attached an alternative version and added a little doctest checking that plain numbers are also interpreted correctly as polynomials.



---

archive/issue_comments_134231.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> Since the main patch deletes code instead of adding anything, where is the right place to put a doctest to verify that it works the way it is now supposed to?\n\n\nI'd put it in the parent's class-level docstring.",
    "created_at": "2010-11-30T04:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134231",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:6'></a>
Replying to [jhpalmieri](#comment%3A4):
> Since the main patch deletes code instead of adding anything, where is the right place to put a doctest to verify that it works the way it is now supposed to?


I'd put it in the parent's class-level docstring.



---

archive/issue_comments_134232.json:
```json
{
    "body": "second version, with doctest",
    "created_at": "2010-11-30T14:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134232",
    "user": "https://github.com/nilesjohnson"
}
```

second version, with doctest



---

archive/issue_comments_134233.json:
```json
{
    "body": "**Changing work_issues** from \"address failing doctests\" to \"\".",
    "created_at": "2010-11-30T14:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134233",
    "user": "https://github.com/nilesjohnson"
}
```

**Changing work_issues** from "address failing doctests" to "".



---

archive/issue_comments_134234.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,3 +14,8 @@\n ```\n \n This occurs because `__contains__(self,x)` for multivariate polynomial rings simply tests whether the parent of `x` is `self`.  Instead, it should inherit `__contains__` from the class `Parent`.  Further discussion can be found on this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/dab74506d9ff94bf).\n+\n+## Apply\n+\n+1. [attachment:trac_10355_multi_polynomial_containment_2.patch]\n+2. [attachment:trac_10355_polynomial_containment_in_toric_varieties.patch]\n``````\n",
    "created_at": "2010-11-30T14:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134234",
    "user": "https://github.com/nilesjohnson"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,3 +14,8 @@
 ```
 
 This occurs because `__contains__(self,x)` for multivariate polynomial rings simply tests whether the parent of `x` is `self`.  Instead, it should inherit `__contains__` from the class `Parent`.  Further discussion can be found on this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/dab74506d9ff94bf).
+
+## Apply
+
+1. [attachment:trac_10355_multi_polynomial_containment_2.patch]
+2. [attachment:trac_10355_polynomial_containment_in_toric_varieties.patch]
``````




---

archive/issue_comments_134235.json:
```json
{
    "body": "**Author:** Niles Johnson, Andrey Novoseltsev",
    "created_at": "2010-11-30T14:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134235",
    "user": "https://github.com/nilesjohnson"
}
```

**Author:** Niles Johnson, Andrey Novoseltsev



---

archive/attachments_013562.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_10355_multi_polynomial_containment_2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket10355/trac_10355_multi_polynomial_containment_2.patch",
    "created_at": "2010-11-30T14:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/nilesjohnson"
}
```



---

archive/issue_comments_134236.json:
```json
{
    "body": "<a id='comment:7'></a>\nI decided to add the doctest to the `__init__` method for 3 reasons:\n\n* keeps the doctest in the file which defines multivariate polynomial rings\n* `__init__` is one of the \"closest\" methods (in `multi_polynomial_ring_generic.py`) to the `Parent` class\n* Having the test in the docstring for an underscore method means that it won't appear in any of the Sage documentation -- for this test, I think that's appropriate.",
    "created_at": "2010-11-30T14:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134236",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:7'></a>
I decided to add the doctest to the `__init__` method for 3 reasons:

* keeps the doctest in the file which defines multivariate polynomial rings
* `__init__` is one of the "closest" methods (in `multi_polynomial_ring_generic.py`) to the `Parent` class
* Having the test in the docstring for an underscore method means that it won't appear in any of the Sage documentation -- for this test, I think that's appropriate.



---

archive/issue_comments_134237.json:
```json
{
    "body": "<a id='comment:8'></a>\np.s. With the two patches applied, all doctests pass, and all documentation builds cleanly.",
    "created_at": "2010-11-30T15:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134237",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:8'></a>
p.s. With the two patches applied, all doctests pass, and all documentation builds cleanly.



---

archive/issue_comments_134238.json:
```json
{
    "body": "<a id='comment:9'></a>\nApply trac_10355_multi_polynomial_containment_2.patch and trac_10355_polynomial_containment_in_toric_varieties.patch",
    "created_at": "2010-12-03T19:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134238",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:9'></a>
Apply trac_10355_multi_polynomial_containment_2.patch and trac_10355_polynomial_containment_in_toric_varieties.patch



---

archive/issue_comments_134239.json:
```json
{
    "body": "<a id='comment:10'></a>\nLooks good! Tested on 4.6.1alpha3.",
    "created_at": "2010-12-20T12:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134239",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
Looks good! Tested on 4.6.1alpha3.



---

archive/issue_comments_134240.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-12-20T12:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134240",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_134241.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2010-12-20T12:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134241",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_events_032001.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-24T10:18:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10355#event-32001"
}
```



---

archive/issue_events_032002.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-25T08:16:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10355#event-32002"
}
```



---

archive/issue_comments_134242.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2011-01-25T08:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134242",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_134243.json:
```json
{
    "body": "**Merged:** sage-4.6.2.alpha2",
    "created_at": "2011-01-25T08:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10355",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10355#issuecomment-134243",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.6.2.alpha2
