# Issue 10719: Symmetrica does not build on OpenSUSE 11.2 x86_64 and Ubuntu 11.10

archive/issues_010656.json:
```json
{
    "body": "The updated spkg moves the `-lm` compiler flag past `-lsymmetrica` when building the test program, adds an `spkg-check` file, honors `LDFLAGS`, and removes the obsolete Debian `dist/` directory.\n\n---\n\n**New spkg:** http://sage.math.washington.edu/home/leif/Sage/spkgs/symmetrica-2.0.p7.spkg\n\n**md5sum:** `03a4d2ec75eb3595ebba568419872e64`\n\n\nAssignee: GeorgSWeber\n\nCC:  @mwhansen\n\nKeywords: library order linker semantics Ubuntu 11.10 Oneiric Ocelot sd34\n\nResolution: fixed\n\nAuthor: Volker Braun, Leif Leonhardy\n\nReviewer: Leif Leonhardy, Volker Braun\n\nMerged: sage-4.7.2.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/10719\n\n",
    "closed_at": "2011-10-07T19:11:52Z",
    "created_at": "2011-01-31T15:24:33Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Symmetrica does not build on OpenSUSE 11.2 x86_64 and Ubuntu 11.10",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10719",
    "user": "https://github.com/vbraun"
}
```
The updated spkg moves the `-lm` compiler flag past `-lsymmetrica` when building the test program, adds an `spkg-check` file, honors `LDFLAGS`, and removes the obsolete Debian `dist/` directory.

---

**New spkg:** http://sage.math.washington.edu/home/leif/Sage/spkgs/symmetrica-2.0.p7.spkg

**md5sum:** `03a4d2ec75eb3595ebba568419872e64`


Assignee: GeorgSWeber

CC:  @mwhansen

Keywords: library order linker semantics Ubuntu 11.10 Oneiric Ocelot sd34

Resolution: fixed

Author: Volker Braun, Leif Leonhardy

Reviewer: Leif Leonhardy, Volker Braun

Merged: sage-4.7.2.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/10719





---

archive/issue_comments_135233.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-31T15:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135233",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_135234.json:
```json
{
    "body": "<a id='comment:1'></a>Works on Fedora 14 and t2.math. Is rather simple change...\n\nSee also: https://groups.google.com/d/topic/sage-devel/2jyWCWUn_30/discussion",
    "created_at": "2011-01-31T15:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135234",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>Works on Fedora 14 and t2.math. Is rather simple change...

See also: https://groups.google.com/d/topic/sage-devel/2jyWCWUn_30/discussion



---

archive/issue_comments_135235.json:
```json
{
    "body": "for review purposes only",
    "created_at": "2011-02-01T01:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135235",
    "user": "https://github.com/vbraun"
}
```

for review purposes only



---

archive/issue_comments_135236.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [makefile](tarball://root/attachments/some-uuid/ticket10719/makefile) by @vbraun created at 2011-02-01 01:10:45\n\nOk I noticed that `patches/*patch` wasn't actually applied?!?. Fixed now. Also, I rewrote the makefile and we are actually only building the static library now. Updated spkg is at the same location as above.",
    "created_at": "2011-02-01T01:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135236",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>Attachment [makefile](tarball://root/attachments/some-uuid/ticket10719/makefile) by @vbraun created at 2011-02-01 01:10:45

Ok I noticed that `patches/*patch` wasn't actually applied?!?. Fixed now. Also, I rewrote the makefile and we are actually only building the static library now. Updated spkg is at the same location as above.



---

archive/issue_comments_135237.json:
```json
{
    "body": "<a id='comment:3'></a>The above spkg successfully builds on the current Ubuntu 11.04 beta, which fixes a linking problem from the p5 spkg. I'll see if I can properly review this, but the spkg does fix an important problem.",
    "created_at": "2011-02-11T00:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135237",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:3'></a>The above spkg successfully builds on the current Ubuntu 11.04 beta, which fixes a linking problem from the p5 spkg. I'll see if I can properly review this, but the spkg does fix an important problem.



---

archive/issue_comments_135238.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 ddrake]:\n> The above spkg successfully builds on the current Ubuntu 11.04 beta, which fixes a linking problem from the p5 spkg. I'll see if I can properly review this, but the spkg does fix an important problem.\n\n\nsage-devel thread: https://groups.google.com/d/topic/sage-devel/chWfpkqj6xU/discussion",
    "created_at": "2011-02-11T00:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135238",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:4'></a>Replying to [comment:3 ddrake]:
> The above spkg successfully builds on the current Ubuntu 11.04 beta, which fixes a linking problem from the p5 spkg. I'll see if I can properly review this, but the spkg does fix an important problem.


sage-devel thread: https://groups.google.com/d/topic/sage-devel/chWfpkqj6xU/discussion



---

archive/issue_comments_135239.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-01T01:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135239",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_135240.json:
```json
{
    "body": "<a id='comment:5'></a>Here's one tiny problem: most of the files in src/ all have 400 permissions, and spkg-install copies two .h files over at the end of the build. If you rebuild symmetrica, that copying will fail because it can't overwrite the \"400\" files. I would run a `chmod 644 *` in the src/ directory of the spkg.",
    "created_at": "2011-03-01T01:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135240",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:5'></a>Here's one tiny problem: most of the files in src/ all have 400 permissions, and spkg-install copies two .h files over at the end of the build. If you rebuild symmetrica, that copying will fail because it can't overwrite the "400" files. I would run a `chmod 644 *` in the src/ directory of the spkg.



---

archive/issue_comments_135241.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-02T10:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135241",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135242.json:
```json
{
    "body": "<a id='comment:6'></a>I've upgraded the spgk. I set the permissions in src/ to 644 and added an extra chmod to the spkg-install so we don't trip over this issue again if somebody unpacks the source tarball.",
    "created_at": "2011-03-02T10:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135242",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>I've upgraded the spgk. I set the permissions in src/ to 644 and added an extra chmod to the spkg-install so we don't trip over this issue again if somebody unpacks the source tarball.



---

archive/issue_comments_135243.json:
```json
{
    "body": "Attachment [spkg-install](tarball://root/attachments/some-uuid/ticket10719/spkg-install) by @vbraun created at 2011-03-02 10:49:18\n\nfor review purposes",
    "created_at": "2011-03-02T10:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135243",
    "user": "https://github.com/vbraun"
}
```

Attachment [spkg-install](tarball://root/attachments/some-uuid/ticket10719/spkg-install) by @vbraun created at 2011-03-02 10:49:18

for review purposes



---

archive/issue_comments_135244.json:
```json
{
    "body": "Changing keywords from \"\" to \"library order linker semantics\".",
    "created_at": "2011-08-27T12:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135244",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "" to "library order linker semantics".



---

archive/issue_comments_135245.json:
```json
{
    "body": "<a id='comment:7'></a>This patch / new spkg will also be necessary for newer Debians like e.g. Ubuntu 11.10, which feature (the good old) stricter linker semantics; cf. [comment:ticket:11674:38] ff.\n\nOur current Singular (3-1-1-4) spkg also has issues with wrong library order, namely `-ldl` and `-lkernel`. (I haven't yet checked whether this is already fixed in a newer upstream release; hopefully Sage's Singular will be upgraded during the [Sage/Singular Days (SD34)](http://wiki.sagemath.org/days34) at the end of September, see also [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/cca0edad4b6a41aa/1f872997a159304e); cf. #10903.)",
    "created_at": "2011-08-27T12:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135245",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>This patch / new spkg will also be necessary for newer Debians like e.g. Ubuntu 11.10, which feature (the good old) stricter linker semantics; cf. [comment:ticket:11674:38] ff.

Our current Singular (3-1-1-4) spkg also has issues with wrong library order, namely `-ldl` and `-lkernel`. (I haven't yet checked whether this is already fixed in a newer upstream release; hopefully Sage's Singular will be upgraded during the [Sage/Singular Days (SD34)](http://wiki.sagemath.org/days34) at the end of September, see also [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/cca0edad4b6a41aa/1f872997a159304e); cf. #10903.)



---

archive/issue_comments_135246.json:
```json
{
    "body": "<a id='comment:8'></a>A couple of more or less minor issues:\n\n* Michael Abshoff should be removed from the spkg maintainer list.\n\n* [http://www.symmetrica.de/](http://www.symmetrica.de/) is perhaps a more stable upstream link (currently redirected to [http://www.algorithm.uni-bayreuth.de/en/research/SYMMETRICA/](http://www.algorithm.uni-bayreuth.de/en/research/SYMMETRICA/)).\n\n* `s/sort tp/sort to/` in `SPKG.txt`\n\n* `$CFLAG64` should be quoted in `[ -z $CFLAG64 ]`. (And exporting `CFLAGS` there is really redundant.)\n\n* Not all user-specified `CFLAGS` should be overridden by Sage's (e.g. `-O2` should precede `$CFLAGS` in the assignment).\n\n* The exit codes of `patch` (and `cp`) aren't checked. (`makefile` could also be patched rather than copied over. `SPKG.txt` mentions `patches/makefile.patch`, though  there's only `patches/makefile`.)\n\n* (GNU) `patch` should be added as a dependency.\n\n* `$MAKE -f makefile` is redundant.\n\n* `$SAGE_LOCAL` should be quoted.\n\n* `cp` for installation (library, headers) should use `-p`, otherwise the current umask could break permissions.\n\n* The new `makefile` removes the `test` target, which builds an executable functioning as a minimalistic test suite. (The removal also removes `-lm` completely, such that the changelog entry regarding that no longer applies.)\n\n\nThe \"usual\" superfluous trailing semicolon inside the sanity check is *of course*<sup>TM</sup> also there; `[ -z \"$SAGE_LOCAL\" ]` is also better than comparing to an empty string.",
    "created_at": "2011-08-27T13:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135246",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>A couple of more or less minor issues:

* Michael Abshoff should be removed from the spkg maintainer list.

* [http://www.symmetrica.de/](http://www.symmetrica.de/) is perhaps a more stable upstream link (currently redirected to [http://www.algorithm.uni-bayreuth.de/en/research/SYMMETRICA/](http://www.algorithm.uni-bayreuth.de/en/research/SYMMETRICA/)).

* `s/sort tp/sort to/` in `SPKG.txt`

* `$CFLAG64` should be quoted in `[ -z $CFLAG64 ]`. (And exporting `CFLAGS` there is really redundant.)

* Not all user-specified `CFLAGS` should be overridden by Sage's (e.g. `-O2` should precede `$CFLAGS` in the assignment).

* The exit codes of `patch` (and `cp`) aren't checked. (`makefile` could also be patched rather than copied over. `SPKG.txt` mentions `patches/makefile.patch`, though  there's only `patches/makefile`.)

* (GNU) `patch` should be added as a dependency.

* `$MAKE -f makefile` is redundant.

* `$SAGE_LOCAL` should be quoted.

* `cp` for installation (library, headers) should use `-p`, otherwise the current umask could break permissions.

* The new `makefile` removes the `test` target, which builds an executable functioning as a minimalistic test suite. (The removal also removes `-lm` completely, such that the changelog entry regarding that no longer applies.)


The "usual" superfluous trailing semicolon inside the sanity check is *of course*<sup>TM</sup> also there; `[ -z "$SAGE_LOCAL" ]` is also better than comparing to an empty string.



---

archive/issue_comments_135247.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-27T13:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135247",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_135248.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Leif Leonhardy\"",
    "created_at": "2011-08-27T13:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135248",
    "user": "https://github.com/nexttime"
}
```

Changing reviewer from "" to "Leif Leonhardy"



---

archive/issue_comments_135249.json:
```json
{
    "body": "Changing keywords from \"library order linker semantics\" to \"library order linker semantics Ubuntu 11.10 Oneiric Ocelot\".",
    "created_at": "2011-09-11T05:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135249",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "library order linker semantics" to "library order linker semantics Ubuntu 11.10 Oneiric Ocelot".



---

archive/issue_comments_135250.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2011-09-11T05:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135250",
    "user": "https://github.com/nexttime"
}
```

Changing priority from major to critical.



---

archive/issue_comments_135251.json:
```json
{
    "body": "<a id='comment:11'></a>Making this a **blocker**, since IMHO this should be fixed in the **final Sage 4.7.2**, likely to be released [right] before the final Ubuntu 11.10 (Oneiric Ocelot), in contrast to a *final* Sage 4.7.3 ...\n\n(Hereby also pinging myself...)\n\nP.S.: The description isn't up-to-date, as the current spkg doesn't use `-lm` at all, since it doesn't build the test program (which it IMHO should, as a minimalistic test suite, unless it provides and runs some other test(s), at least if `SAGE_CHECK=yes`).",
    "created_at": "2011-09-24T13:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135251",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>Making this a **blocker**, since IMHO this should be fixed in the **final Sage 4.7.2**, likely to be released [right] before the final Ubuntu 11.10 (Oneiric Ocelot), in contrast to a *final* Sage 4.7.3 ...

(Hereby also pinging myself...)

P.S.: The description isn't up-to-date, as the current spkg doesn't use `-lm` at all, since it doesn't build the test program (which it IMHO should, as a minimalistic test suite, unless it provides and runs some other test(s), at least if `SAGE_CHECK=yes`).



---

archive/issue_comments_135252.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2011-09-24T13:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135252",
    "user": "https://github.com/nexttime"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_135253.json:
```json
{
    "body": "<a id='comment:12'></a>I implemented leif's nitpicks. Also, now has a spkg-check. Updated spkg is at the same url as before.",
    "created_at": "2011-09-27T22:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135253",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>I implemented leif's nitpicks. Also, now has a spkg-check. Updated spkg is at the same url as before.



---

archive/issue_comments_135254.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-27T22:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135254",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135255.json:
```json
{
    "body": "Changing keywords from \"library order linker semantics Ubuntu 11.10 Oneiric Ocelot\" to \"library order linker semantics Ubuntu 11.10 Oneiric Ocelot sd34\".",
    "created_at": "2011-09-29T15:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135255",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "library order linker semantics Ubuntu 11.10 Oneiric Ocelot" to "library order linker semantics Ubuntu 11.10 Oneiric Ocelot sd34".



---

archive/issue_comments_135256.json:
```json
{
    "body": "<a id='comment:14'></a>Instead of adding `~*` to `.hgignore`, you should delete `spkg-check~`. ;-)\n\nAnd make `spkg-check` executable.",
    "created_at": "2011-10-04T08:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135256",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>Instead of adding `~*` to `.hgignore`, you should delete `spkg-check~`. ;-)

And make `spkg-check` executable.



---

archive/issue_comments_135257.json:
```json
{
    "body": "<a id='comment:15'></a>Whats the obsession with deleting backup files, geez :-P\n\nThe new spkg is at the same URL.",
    "created_at": "2011-10-04T09:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135257",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>Whats the obsession with deleting backup files, geez :-P

The new spkg is at the same URL.



---

archive/issue_comments_135258.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-04T09:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135258",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_135259.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 vbraun]:\n> The new spkg is at the same URL.\n\n\nSorry, you were too quick (or I was too slow...):\n\n\nThe commit message looks like a copy-paste accident, but the spkg was made on 28st[sic] September anyway. :)\n\n\n\n\n`spkg-check` should also use `$MAKE`.\n\nIf you also **build** `test` in `spkg-check`, you have to setup `CFLAGS` etc. there in the same way as in `spkg-install`.\n\n`s/exitting/exiting/`.\n\nThe error message should start with \"`Error`\" (or \"`Failed`\").\n\n(The whole test could be simplified by\n\n```sh\nif ! diff spkg-check.actual spkg-check.expected; then\n    echo >&2 \"Error: The symmetrica test suite failed (see diff output above).\"\n    exit 1\n# Optionally:\n#else\n#    echo \"All tests passed.\" # or whatever\nfi\n# EOF\n```\n\n\n\n\nDo we need `LDFLAGS` when linking `test`?\n\nI.e., for example `-m64`, which we *could* take from `CFLAG64`, but using `LDFLAG64` (defaulting to `-m64`) would be cleaner.\n\n\n\n\nI don't like the `set +/-o errexit`, as it doesn't necessarily give a meaningful (and easy to search for) error message. Therefore we removed all instances of `set +/-e` previously.\n\nInstead, you could use the usual loop for applying the patches, exiting with an appropriate error message upon the first patch which doesn't apply:\n\n```sh\nfor patch in ../patches; do\n    patch < \"$patch\"\n    if [ $? -ne 0 ]; then\n        echo >&2 \"Error: Patch \\\"$patch\\\" failed to apply. Exiting...\n        exit 1\n    fi\ndone\n# Copy over makefile and check $?\n# or create also a *patch* for 'makefile' to be applied\n# in the loop above, too.\n```\n\nSimilar for the \"installation\":\n\n`spkg-install` will only exit with a non-zero status if **the last** copy command failed. You could either check each exit code, giving an appropriate error message for each individual case, or use\n\n```\nfoo &&\nbar &&\nbaz\nif [ $? -ne 0 ]; then\n    echo >&2 \"Error: Failed to install Symmetrica.\"\n    exit 1\nfi\n```",
    "created_at": "2011-10-04T09:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135259",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>Replying to [comment:15 vbraun]:
> The new spkg is at the same URL.


Sorry, you were too quick (or I was too slow...):


The commit message looks like a copy-paste accident, but the spkg was made on 28st[sic] September anyway. :)




`spkg-check` should also use `$MAKE`.

If you also **build** `test` in `spkg-check`, you have to setup `CFLAGS` etc. there in the same way as in `spkg-install`.

`s/exitting/exiting/`.

The error message should start with "`Error`" (or "`Failed`").

(The whole test could be simplified by

```sh
if ! diff spkg-check.actual spkg-check.expected; then
    echo >&2 "Error: The symmetrica test suite failed (see diff output above)."
    exit 1
# Optionally:
#else
#    echo "All tests passed." # or whatever
fi
# EOF
```




Do we need `LDFLAGS` when linking `test`?

I.e., for example `-m64`, which we *could* take from `CFLAG64`, but using `LDFLAG64` (defaulting to `-m64`) would be cleaner.




I don't like the `set +/-o errexit`, as it doesn't necessarily give a meaningful (and easy to search for) error message. Therefore we removed all instances of `set +/-e` previously.

Instead, you could use the usual loop for applying the patches, exiting with an appropriate error message upon the first patch which doesn't apply:

```sh
for patch in ../patches; do
    patch < "$patch"
    if [ $? -ne 0 ]; then
        echo >&2 "Error: Patch \"$patch\" failed to apply. Exiting...
        exit 1
    fi
done
# Copy over makefile and check $?
# or create also a *patch* for 'makefile' to be applied
# in the loop above, too.
```

Similar for the "installation":

`spkg-install` will only exit with a non-zero status if **the last** copy command failed. You could either check each exit code, giving an appropriate error message for each individual case, or use

```
foo &&
bar &&
baz
if [ $? -ne 0 ]; then
    echo >&2 "Error: Failed to install Symmetrica."
    exit 1
fi
```



---

archive/issue_comments_135260.json:
```json
{
    "body": "<a id='comment:17'></a>Oh, should of course read `for patch in ../patches/*.patch; do ...`.",
    "created_at": "2011-10-04T09:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135260",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>Oh, should of course read `for patch in ../patches/*.patch; do ...`.



---

archive/issue_comments_135261.json:
```json
{
    "body": "<a id='comment:18'></a>Well you are welcome to rewrite the spkg-install and spkg-check scripts. I'll be happy to review them.",
    "created_at": "2011-10-04T09:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135261",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>Well you are welcome to rewrite the spkg-install and spkg-check scripts. I'll be happy to review them.



---

archive/issue_comments_135262.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 vbraun]:\n> Well you are welcome to rewrite the spkg-install and spkg-check scripts. I'll be happy to review them.\n\n\nOk, later today.",
    "created_at": "2011-10-04T10:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135262",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>Replying to [comment:18 vbraun]:
> Well you are welcome to rewrite the spkg-install and spkg-check scripts. I'll be happy to review them.


Ok, later today.



---

archive/issue_comments_135263.json:
```json
{
    "body": "<a id='comment:20'></a>New spkg is up.\n\nIf Volker is ok with my additional changes, we have a positive review.",
    "created_at": "2011-10-06T15:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135263",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>New spkg is up.

If Volker is ok with my additional changes, we have a positive review.



---

archive/issue_comments_135264.json:
```json
{
    "body": "Changing author from \"Volker Braun\" to \"Volker Braun, Leif Leonhardy\"",
    "created_at": "2011-10-06T15:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135264",
    "user": "https://github.com/nexttime"
}
```

Changing author from "Volker Braun" to "Volker Braun, Leif Leonhardy"



---

archive/issue_comments_135265.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-06T15:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135265",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135266.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,11 @@\n-The updated spkg moves the `-lm` compiler flag to the end of the object files and removes the `dist/` directory.\n+The updated spkg moves the `-lm` compiler flag past `-lsymmetrica` when building the test program, adds an `spkg-check` file, honors `LDFLAGS`, and removes the obsolete Debian `dist/` directory.\n \n-http://www.stp.dias.ie/~vbraun/Sage/spkg/symmetrica-2.0.p6.spkg\n+---\n+\n+**New spkg:** http://sage.math.washington.edu/home/leif/Sage/spkgs/symmetrica-2.0.p7.spkg\n+\n+**md5sum:** `03a4d2ec75eb3595ebba568419872e64`\n+\n \n Author: Volker Braun\n \n``````\n",
    "created_at": "2011-10-06T15:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135266",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,11 @@
-The updated spkg moves the `-lm` compiler flag to the end of the object files and removes the `dist/` directory.
+The updated spkg moves the `-lm` compiler flag past `-lsymmetrica` when building the test program, adds an `spkg-check` file, honors `LDFLAGS`, and removes the obsolete Debian `dist/` directory.
 
-http://www.stp.dias.ie/~vbraun/Sage/spkg/symmetrica-2.0.p6.spkg
+---
+
+**New spkg:** http://sage.math.washington.edu/home/leif/Sage/spkgs/symmetrica-2.0.p7.spkg
+
+**md5sum:** `03a4d2ec75eb3595ebba568419872e64`
+
 
 Author: Volker Braun
 
``````




---

archive/issue_comments_135267.json:
```json
{
    "body": "Attachment [symmetrica-2.0.p6-p7.diff](tarball://root/attachments/some-uuid/ticket10719/symmetrica-2.0.p6-p7.diff) by @nexttime created at 2011-10-06 15:03:40\n\nDiff between Volker's p6 and my p7. For reference / review only.",
    "created_at": "2011-10-06T15:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135267",
    "user": "https://github.com/nexttime"
}
```

Attachment [symmetrica-2.0.p6-p7.diff](tarball://root/attachments/some-uuid/ticket10719/symmetrica-2.0.p6-p7.diff) by @nexttime created at 2011-10-06 15:03:40

Diff between Volker's p6 and my p7. For reference / review only.



---

archive/issue_comments_135268.json:
```json
{
    "body": "<a id='comment:21'></a>I've attached a diff with my changes (for review).",
    "created_at": "2011-10-06T15:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135268",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>I've attached a diff with my changes (for review).



---

archive/issue_comments_135269.json:
```json
{
    "body": "Cumulative diff between the previous p5 in Sage and the p7. For reference / review only.",
    "created_at": "2011-10-06T15:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135269",
    "user": "https://github.com/nexttime"
}
```

Cumulative diff between the previous p5 in Sage and the p7. For reference / review only.



---

archive/issue_comments_135270.json:
```json
{
    "body": "Changing reviewer from \"Leif Leonhardy\" to \"Leif Leonhardy, Volker Braun\"",
    "created_at": "2011-10-06T17:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135270",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "Leif Leonhardy" to "Leif Leonhardy, Volker Braun"



---

archive/issue_comments_135271.json:
```json
{
    "body": "<a id='comment:22'></a>Attachment [symmetrica-2.0.p5-p7.diff](tarball://root/attachments/some-uuid/ticket10719/symmetrica-2.0.p5-p7.diff) by @vbraun created at 2011-10-06 17:46:27\n\nLooks good. Even builds on Solaris/Sparc. Positive review.",
    "created_at": "2011-10-06T17:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135271",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>Attachment [symmetrica-2.0.p5-p7.diff](tarball://root/attachments/some-uuid/ticket10719/symmetrica-2.0.p5-p7.diff) by @vbraun created at 2011-10-06 17:46:27

Looks good. Even builds on Solaris/Sparc. Positive review.



---

archive/issue_comments_135272.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-06T17:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135272",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_027600.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-07T19:11:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10719#event-27600"
}
```



---

archive/issue_comments_135273.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-07T19:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135273",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_135274.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.2.alpha4\"",
    "created_at": "2011-10-07T19:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10719#issuecomment-135274",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.7.2.alpha4"
