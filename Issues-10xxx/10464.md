# Issue 10464: m-th power residue symbol

archive/issues_010411.json:
```json
{
    "body": "implement m-th power residue symbol (generalising Legendre/Kronecker symbol)\n\n---\n\nApply only [attachment:trac_10464_residue_symbol.4.patch] to the Sage library.\n\n\n**Assignee:** @loefflerd\n\n**CC:**  @katestange\n\n**Keywords:** cubic residue\n\n**Resolution:** fixed\n\n**Author:** Katherine Stange\n\n**Reviewer:** Francis Clarke, David Loeffler\n\n**Merged:** sage-4.7.2.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/10464\n\n",
    "closed_at": "2011-09-17T04:35:09Z",
    "created_at": "2010-12-10T22:24:47Z",
    "labels": [
        "component: number fields",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "m-th power residue symbol",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10464",
    "user": "https://github.com/katestange"
}
```
implement m-th power residue symbol (generalising Legendre/Kronecker symbol)

---

Apply only [attachment:trac_10464_residue_symbol.4.patch] to the Sage library.


**Assignee:** @loefflerd

**CC:**  @katestange

**Keywords:** cubic residue

**Resolution:** fixed

**Author:** Katherine Stange

**Reviewer:** Francis Clarke, David Loeffler

**Merged:** sage-4.7.2.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/10464





---

archive/issue_comments_135210.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-12-11T03:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135210",
    "user": "https://github.com/katestange"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_135211.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [trac_10464_residue_symbol.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.patch) by @katestange created at 2010-12-11 03:05:13",
    "created_at": "2010-12-11T03:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135211",
    "user": "https://github.com/katestange"
}
```

<a id='comment:1'></a>
Attachment [trac_10464_residue_symbol.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.patch) by @katestange created at 2010-12-11 03:05:13



---

archive/issue_comments_135212.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-12-16T13:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135212",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_135213.json:
```json
{
    "body": "<a id='comment:3'></a>\nI like the look of this, but the formatting of the docstrings isn't quite right -- the text `\"Quadratic Residue (7 is not a square modulo 11)\"` shouldn't be inside the code block. You should remove the double colon after `EXAMPLES`, unindent the description lines and put a double colon at the end of each one. Other than that very trivial fix this looks absolutely fine.",
    "created_at": "2010-12-16T13:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135213",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:3'></a>
I like the look of this, but the formatting of the docstrings isn't quite right -- the text `"Quadratic Residue (7 is not a square modulo 11)"` shouldn't be inside the code block. You should remove the double colon after `EXAMPLES`, unindent the description lines and put a double colon at the end of each one. Other than that very trivial fix this looks absolutely fine.



---

archive/issue_comments_135214.json:
```json
{
    "body": "**Work_Issues:** docstring formatting",
    "created_at": "2010-12-16T13:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135214",
    "user": "https://github.com/loefflerd"
}
```

**Work_Issues:** docstring formatting



---

archive/issue_comments_135215.json:
```json
{
    "body": "<a id='comment:4'></a>\nI think there are a couple of things which will make the ideal `residue_symbol` function a little faster:\n\n1. There should be no need to have the default `check=True` when recursively applying the function to the prime factors of the ideal since all the checks will have already been performed.\n2. The final loop can be avoided by calculating a discrete log in the residue field.\n\nThus I think the last few lines of the definition should read something like:\n\n```\n        if not self.is_prime():\n            return prod(Q.residue_symbol(e, m, check=False)**i for Q, i in self.factor())\n        k = self.residue_field()\n        r = k(e)**((k.order() - 1)/m)\n        resroot = primroot**(rootorder/m)\n        from sage.groups.generic import discrete_log\n        j = discrete_log(k(resroot), k(r), ord=m)\n        return resroot**j\n```\nOne other little thing.  I think it is safer to write `self.smallest_integer()` rather than `ZZ(self.gens()[0])`.",
    "created_at": "2010-12-16T22:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135215",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:4'></a>
I think there are a couple of things which will make the ideal `residue_symbol` function a little faster:

1. There should be no need to have the default `check=True` when recursively applying the function to the prime factors of the ideal since all the checks will have already been performed.
2. The final loop can be avoided by calculating a discrete log in the residue field.

Thus I think the last few lines of the definition should read something like:

```
        if not self.is_prime():
            return prod(Q.residue_symbol(e, m, check=False)**i for Q, i in self.factor())
        k = self.residue_field()
        r = k(e)**((k.order() - 1)/m)
        resroot = primroot**(rootorder/m)
        from sage.groups.generic import discrete_log
        j = discrete_log(k(resroot), k(r), ord=m)
        return resroot**j
```
One other little thing.  I think it is safer to write `self.smallest_integer()` rather than `ZZ(self.gens()[0])`.



---

archive/issue_comments_135216.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [trac_10464_residue_symbol.2.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.2.patch) by @katestange created at 2011-09-12 16:37:45\n\nThanks all for the comments and suggestions; they were very helpful.  I've uploaded a new version of the patch that has taken into account all of them.  (I couldn't figure out how to replace the file with one of the same name as suggested in the development walkthrough guide.)",
    "created_at": "2011-09-12T16:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135216",
    "user": "https://github.com/katestange"
}
```

<a id='comment:5'></a>
Attachment [trac_10464_residue_symbol.2.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.2.patch) by @katestange created at 2011-09-12 16:37:45

Thanks all for the comments and suggestions; they were very helpful.  I've uploaded a new version of the patch that has taken into account all of them.  (I couldn't figure out how to replace the file with one of the same name as suggested in the development walkthrough guide.)



---

archive/issue_comments_135217.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-09-12T16:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135217",
    "user": "https://github.com/katestange"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_135218.json:
```json
{
    "body": "<a id='comment:6'></a>\nThere is something messed up with this patch: each new method is defined twice over.",
    "created_at": "2011-09-12T18:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135218",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:6'></a>
There is something messed up with this patch: each new method is defined twice over.



---

archive/issue_comments_135219.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-09-12T18:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135219",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_135220.json:
```json
{
    "body": "**Changing work_issues** from \"docstring formatting\" to \"patch corrupted?\".",
    "created_at": "2011-09-12T18:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135220",
    "user": "https://github.com/loefflerd"
}
```

**Changing work_issues** from "docstring formatting" to "patch corrupted?".



---

archive/issue_comments_135221.json:
```json
{
    "body": "Attachment [trac_10464_residue_symbol.3.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.3.patch) by @katestange created at 2011-09-12 19:45:09",
    "created_at": "2011-09-12T19:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135221",
    "user": "https://github.com/katestange"
}
```

Attachment [trac_10464_residue_symbol.3.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.3.patch) by @katestange created at 2011-09-12 19:45:09



---

archive/issue_comments_135222.json:
```json
{
    "body": "<a id='comment:7'></a>\nSorry!  I must have cloned the wrong branch at some point, but I should have noticed in the diff -- newbie mistake.  Anyway, it's now been fixed.  (I also see now how to replace the old patch, but at this point I think that would be more confusing, so this is labelled '3'.)",
    "created_at": "2011-09-12T19:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135222",
    "user": "https://github.com/katestange"
}
```

<a id='comment:7'></a>
Sorry!  I must have cloned the wrong branch at some point, but I should have noticed in the diff -- newbie mistake.  Anyway, it's now been fixed.  (I also see now how to replace the old patch, but at this point I think that would be more confusing, so this is labelled '3'.)



---

archive/issue_comments_135223.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-09-12T19:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135223",
    "user": "https://github.com/katestange"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_135224.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt's all fine now.  I'd give it a positive review but for one thing.  The docstring for `sage.rings.number_field.number_field_element.NumberFieldElement.residue_symbol` says \n\n```\n        - ``P`` - proper ideal of the number field (or an extension) \n```\nI think that there needs to be a doctest illustrating the case where P is an ideal in an extension.",
    "created_at": "2011-09-12T21:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135224",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:8'></a>
It's all fine now.  I'd give it a positive review but for one thing.  The docstring for `sage.rings.number_field.number_field_element.NumberFieldElement.residue_symbol` says 

```
        - ``P`` - proper ideal of the number field (or an extension) 
```
I think that there needs to be a doctest illustrating the case where P is an ideal in an extension.



---

archive/issue_comments_135225.json:
```json
{
    "body": "Attachment [trac_10464_residue_symbol.4.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.4.patch) by @katestange created at 2011-09-13 00:49:46",
    "created_at": "2011-09-13T00:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135225",
    "user": "https://github.com/katestange"
}
```

Attachment [trac_10464_residue_symbol.4.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.4.patch) by @katestange created at 2011-09-13 00:49:46



---

archive/issue_comments_135226.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks for pointing that out.  I've fleshed out the documentation somewhat, and in the process found a small bug which has been fixed (the faster routine kronecker_symbol was called on some inappropriate cases).",
    "created_at": "2011-09-13T00:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135226",
    "user": "https://github.com/katestange"
}
```

<a id='comment:9'></a>
Thanks for pointing that out.  I've fleshed out the documentation somewhat, and in the process found a small bug which has been fixed (the faster routine kronecker_symbol was called on some inappropriate cases).



---

archive/issue_comments_135227.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-09-13T06:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135227",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_135228.json:
```json
{
    "body": "<a id='comment:10'></a>\nAll looks good now.  Positive review.",
    "created_at": "2011-09-13T06:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135228",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:10'></a>
All looks good now.  Positive review.



---

archive/issue_comments_135229.json:
```json
{
    "body": "**Changing work_issues** from \"patch corrupted?\" to \"\".",
    "created_at": "2011-09-13T06:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135229",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing work_issues** from "patch corrupted?" to "".



---

archive/issue_comments_135230.json:
```json
{
    "body": "**Reviewer:** Francis Clarke",
    "created_at": "2011-09-13T06:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135230",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Reviewer:** Francis Clarke



---

archive/issue_comments_135231.json:
```json
{
    "body": "<a id='comment:11'></a>\nPlease put into the ticket's description which patches to apply [in which order, i.e., in the order they should be applied, and perhaps to which repository].\n\n(The trac wiki syntax for referring to attached files is `[attachment:here_comes_the_filename]`, hence in this case `[attachment:trac_10464_residue_symbol.4.patch]`.)\n\nAlso, using the comment field of attachments isn't bad.",
    "created_at": "2011-09-16T11:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135231",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Please put into the ticket's description which patches to apply [in which order, i.e., in the order they should be applied, and perhaps to which repository].

(The trac wiki syntax for referring to attached files is `[attachment:here_comes_the_filename]`, hence in this case `[attachment:trac_10464_residue_symbol.4.patch]`.)

Also, using the comment field of attachments isn't bad.



---

archive/issue_comments_135232.json:
```json
{
    "body": "**Changing reviewer** from \"Francis Clarke\" to \"Francis Clarke, David Loeffler\".",
    "created_at": "2011-09-16T11:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135232",
    "user": "https://github.com/nexttime"
}
```

**Changing reviewer** from "Francis Clarke" to "Francis Clarke, David Loeffler".



---

archive/issue_comments_135233.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n implement m-th power residue symbol (generalising Legendre/Kronecker symbol)\n+\n+---\n+\n+Apply only [attachment:trac_10464_residue_symbol.4.patch] to the Sage library.\n+\n``````\n",
    "created_at": "2011-09-16T11:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135233",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,6 @@
 implement m-th power residue symbol (generalising Legendre/Kronecker symbol)
+
+---
+
+Apply only [attachment:trac_10464_residue_symbol.4.patch] to the Sage library.
+
``````




---

archive/issue_comments_135234.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha3",
    "created_at": "2011-09-17T04:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135234",
    "user": "https://github.com/nexttime"
}
```

**Merged:** sage-4.7.2.alpha3



---

archive/issue_comments_135235.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2011-09-17T04:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10464#issuecomment-135235",
    "user": "https://github.com/nexttime"
}
```

**Resolution:** fixed



---

archive/issue_events_032171.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T04:35:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10464",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10464#event-32171"
}
```
