# Issue 10146: update SageTeX spkg to version 2.3.1

archive/issues_010145.json:
```json
{
    "body": "I've just finished a new version of the SageTeX spkg, which is available from \n\nhttp://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.spkg\n\nAssignee: @dandrake\n\nCC:  @vbraun abmasse\n\nKeywords: sd31\n\nResolution: fixed\n\nAuthor: Dan Drake\n\nReviewer: Mariah Lenox, Andrey Novoseltsev\n\nMerged: sage-4.7.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/10146\n\n",
    "closed_at": "2011-07-22T12:49:15Z",
    "created_at": "2010-10-20T13:45:24Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "update SageTeX spkg to version 2.3.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10146",
    "user": "https://github.com/dandrake"
}
```
I've just finished a new version of the SageTeX spkg, which is available from 

http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.spkg

Assignee: @dandrake

CC:  @vbraun abmasse

Keywords: sd31

Resolution: fixed

Author: Dan Drake

Reviewer: Mariah Lenox, Andrey Novoseltsev

Merged: sage-4.7.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/10146





---

archive/issue_comments_123274.json:
```json
{
    "body": "<a id='comment:1'></a>What's new in this?  What should we look for?",
    "created_at": "2010-10-21T02:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123274",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>What's new in this?  What should we look for?



---

archive/issue_comments_123275.json:
```json
{
    "body": "<a id='comment:2'></a>Relevant thread on sage-devel: http://groups.google.com/group/sage-devel/browse_thread/thread/9613fc8c1775510f#",
    "created_at": "2010-10-21T02:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123275",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>Relevant thread on sage-devel: http://groups.google.com/group/sage-devel/browse_thread/thread/9613fc8c1775510f#



---

archive/issue_comments_123276.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-10-21T02:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123276",
    "user": "https://github.com/jasongrout"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_123277.json:
```json
{
    "body": "<a id='comment:3'></a>What is the sagetex-2.3.cksum file?  How come it's not in the spkg directory?  I've never seen a file like this before",
    "created_at": "2010-10-21T02:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123277",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>What is the sagetex-2.3.cksum file?  How come it's not in the spkg directory?  I've never seen a file like this before



---

archive/issue_comments_123278.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 jason]:\n> What is the sagetex-2.3.cksum file?  How come it's not in the spkg directory?  I've never seen a file like this before\n\n\nSee #329. It's for doing integrity checks of spkg files. The md5sum of the spkg should be a377b1b98b6e92164f4042783a949e75, if you want to be very cautious.\n\nYou could review #329 after you're done here. :)\n\nReplying to [comment:1 jason]:\n> What's new in this? What should we look for?\n\n\nThe `sagecommandline` environment is the new thing, so please look carefully at that. Look at the examples, try to make up your own examples, check over the documentation, etc.\n\nLooking over `hg log`, other changes include:\n\n* generated files are now called .sagetex.sage, .sagetex.py, etc.\n* the warning that you need to re-run Sage that LaTeX prints is hopefully a little more obvious\n* there's a CONTRIBUTORS file.\n\nThe commandline environment is the big thing.",
    "created_at": "2010-10-21T03:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123278",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:4'></a>Replying to [comment:3 jason]:
> What is the sagetex-2.3.cksum file?  How come it's not in the spkg directory?  I've never seen a file like this before


See #329. It's for doing integrity checks of spkg files. The md5sum of the spkg should be a377b1b98b6e92164f4042783a949e75, if you want to be very cautious.

You could review #329 after you're done here. :)

Replying to [comment:1 jason]:
> What's new in this? What should we look for?


The `sagecommandline` environment is the new thing, so please look carefully at that. Look at the examples, try to make up your own examples, check over the documentation, etc.

Looking over `hg log`, other changes include:

* generated files are now called .sagetex.sage, .sagetex.py, etc.
* the warning that you need to re-run Sage that LaTeX prints is hopefully a little more obvious
* there's a CONTRIBUTORS file.

The commandline environment is the big thing.



---

archive/issue_comments_123279.json:
```json
{
    "body": "Example of going over the margins",
    "created_at": "2010-11-11T18:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123279",
    "user": "https://github.com/novoselt"
}
```

Example of going over the margins



---

archive/issue_comments_123280.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-11-11T18:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123280",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_123281.json:
```json
{
    "body": "<a id='comment:5'></a>Attachment [Screenshot.png](tarball://root/attachments/some-uuid/ticket10146/Screenshot.png) by @novoselt created at 2010-11-11 18:35:38\n\nThe sagecommandline environment is going over margins on the right (perhaps it has textwidth width, but gets shifted?). I think this is a quite serious issue for any LaTeX package, so I will switch it to \"needs work.\" \n\n(Vertical line on the left and blue on the right on the attached screenshot are parts of window borders, the text above is within margins.)",
    "created_at": "2010-11-11T18:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123281",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>Attachment [Screenshot.png](tarball://root/attachments/some-uuid/ticket10146/Screenshot.png) by @novoselt created at 2010-11-11 18:35:38

The sagecommandline environment is going over margins on the right (perhaps it has textwidth width, but gets shifted?). I think this is a quite serious issue for any LaTeX package, so I will switch it to "needs work." 

(Vertical line on the left and blue on the right on the attached screenshot are parts of window borders, the text above is within margins.)



---

archive/issue_comments_123282.json:
```json
{
    "body": "Changing work_issues from \"\" to \"Going over margins\"",
    "created_at": "2010-11-11T18:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123282",
    "user": "https://github.com/novoselt"
}
```

Changing work_issues from "" to "Going over margins"



---

archive/issue_comments_123283.json:
```json
{
    "body": "<a id='comment:6'></a>Another minor issue: clicking on the link in the footnote of the first page goes to\n\n```\nhttp://mathsci.kaist.ac.kr/%5Cprotect%20%5Cunhbox%20%5Cvoidb@x%20%5Cpenalty%20%5C@M%20%5C%20%7B%7Ddrake/\n```\nleading to\n\n```\nThe requested URL /\\protect \\unhbox \\voidb@x \\penalty \\@M \\ {}drake/ was not found on this server.\n```\n\nAnd two comments which are more like feature requests than issues:\n* I have a document with one-and-a-half line interval and Sage examples are typeset with the same interval. I'd rather use a single one (or even less) for examples, since there are no sub- and superscripts. I can easily achieve it by wrapping an example into `\\begin{spacing}{0}...\\end{spacing}` (using `setspace` package), but I'd have to repeat it every time, since my attempts to define a combined environment were unsuccessful, I guess because of fragility of sagecommandline.\n* It would be nice to have an option to turn off line numbers at all. Especially if they actually were meant to be on the margins, as it seems to me after looking at the documentation more carefully.",
    "created_at": "2010-11-11T20:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123283",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>Another minor issue: clicking on the link in the footnote of the first page goes to

```
http://mathsci.kaist.ac.kr/%5Cprotect%20%5Cunhbox%20%5Cvoidb@x%20%5Cpenalty%20%5C@M%20%5C%20%7B%7Ddrake/
```
leading to

```
The requested URL /\protect \unhbox \voidb@x \penalty \@M \ {}drake/ was not found on this server.
```

And two comments which are more like feature requests than issues:
* I have a document with one-and-a-half line interval and Sage examples are typeset with the same interval. I'd rather use a single one (or even less) for examples, since there are no sub- and superscripts. I can easily achieve it by wrapping an example into `\begin{spacing}{0}...\end{spacing}` (using `setspace` package), but I'd have to repeat it every time, since my attempts to define a combined environment were unsuccessful, I guess because of fragility of sagecommandline.
* It would be nice to have an option to turn off line numbers at all. Especially if they actually were meant to be on the margins, as it seems to me after looking at the documentation more carefully.



---

archive/issue_comments_123284.json:
```json
{
    "body": "<a id='comment:7'></a>The documentation says: \"The SageTEX package defines a length \\sagetexindent, which controls how much the Sage code is indented when typeset.\" But when I try to change it, it seems that it affects only position of line numbers, not the code indentation itself.\n\nAfter reading listings documentation, I see that it is easy to turn off line numbers (or shift them off the margins), but it would be great if this was mentioned in the documentation of SageTEX - I think that users of Sage are much more likely to worry about it than about syntax highlighting and other stuff supported by listings.",
    "created_at": "2010-11-12T05:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123284",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:7'></a>The documentation says: "The SageTEX package defines a length \sagetexindent, which controls how much the Sage code is indented when typeset." But when I try to change it, it seems that it affects only position of line numbers, not the code indentation itself.

After reading listings documentation, I see that it is easy to turn off line numbers (or shift them off the margins), but it would be great if this was mentioned in the documentation of SageTEX - I think that users of Sage are much more likely to worry about it than about syntax highlighting and other stuff supported by listings.



---

archive/issue_comments_123285.json:
```json
{
    "body": "<a id='comment:8'></a>OK, I'll try to make this the last comment (I wish I could edit the previous ones...)\n\nMy complains about \\sagetexindent affecting line numbers seem to be wrong, I think it was due to some of the extra code I had. But perhaps it is worth mentioning in the documentation that it does not affect sagecommandline.\n\nI managed to change the spacing in code blocks by adjusting `SageInput/Output` styles. However, as I understand, every line of Sage input/output is typeset in a separate listings environment. As a result, aboveskip, belowskip, and lineskip all affect the line spacing and allow making it whatever one wants, but I don't see a way to adjust before/after space for the whole sagecommandline environment. Is it possible? If yes, it would be nice to document it, if no, it would be nice to implement it.\n\nAs for line numbers on margins, I still don't like it, but it seems to be supposed to be like that, so I withdraw my request to change it (but still it would be nice to explain in SateTEX documentation, how to shift them or turn them off).\n\nOverall, thanks for a great package and a new environment in this version!",
    "created_at": "2010-11-12T07:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123285",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>OK, I'll try to make this the last comment (I wish I could edit the previous ones...)

My complains about \sagetexindent affecting line numbers seem to be wrong, I think it was due to some of the extra code I had. But perhaps it is worth mentioning in the documentation that it does not affect sagecommandline.

I managed to change the spacing in code blocks by adjusting `SageInput/Output` styles. However, as I understand, every line of Sage input/output is typeset in a separate listings environment. As a result, aboveskip, belowskip, and lineskip all affect the line spacing and allow making it whatever one wants, but I don't see a way to adjust before/after space for the whole sagecommandline environment. Is it possible? If yes, it would be nice to document it, if no, it would be nice to implement it.

As for line numbers on margins, I still don't like it, but it seems to be supposed to be like that, so I withdraw my request to change it (but still it would be nice to explain in SateTEX documentation, how to shift them or turn them off).

Overall, thanks for a great package and a new environment in this version!



---

archive/issue_comments_123286.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-12T07:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123286",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_123287.json:
```json
{
    "body": "Changing work_issues from \"Going over margins\" to \"\"",
    "created_at": "2010-11-12T07:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123287",
    "user": "https://github.com/novoselt"
}
```

Changing work_issues from "Going over margins" to ""



---

archive/issue_comments_123288.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:6 novoselt]:\n> Another minor issue: clicking on the link in the footnote of the first page goes to\n> \n> ```\n> http://mathsci.kaist.ac.kr/%5Cprotect%20%5Cunhbox%20%5Cvoidb@x%20%5Cpenalty%20%5C@M%20%5C%20%7B%7Ddrake/\n> ```\n\n\nThat is weird. I have no idea what that is happening. It's because of the tilde in the URL in the footnote. I've asked about this: http://tex.stackexchange.com/questions/5260/why-is-docstrip-putting-extra-macro-calls-in-a-hyperlink-inside-a-footnote-that-h",
    "created_at": "2010-11-12T08:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123288",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:9'></a>Replying to [comment:6 novoselt]:
> Another minor issue: clicking on the link in the footnote of the first page goes to
> 
> ```
> http://mathsci.kaist.ac.kr/%5Cprotect%20%5Cunhbox%20%5Cvoidb@x%20%5Cpenalty%20%5C@M%20%5C%20%7B%7Ddrake/
> ```


That is weird. I have no idea what that is happening. It's because of the tilde in the URL in the footnote. I've asked about this: http://tex.stackexchange.com/questions/5260/why-is-docstrip-putting-extra-macro-calls-in-a-hyperlink-inside-a-footnote-that-h



---

archive/issue_comments_123289.json:
```json
{
    "body": "Vertical space issues with sagecommandline",
    "created_at": "2010-11-18T01:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123289",
    "user": "https://github.com/novoselt"
}
```

Vertical space issues with sagecommandline



---

archive/issue_comments_123290.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [STE.pdf](tarball://root/attachments/some-uuid/ticket10146/STE.pdf) by @novoselt created at 2010-11-18 01:56:25\n\nI've found a couple of issues with vertical spacing before and after sagecommandline environment and posted an example (the second page is the document that produces the first one). I have no idea how to fix it, but judging from other environments it is possible ;-)",
    "created_at": "2010-11-18T01:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123290",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'></a>Attachment [STE.pdf](tarball://root/attachments/some-uuid/ticket10146/STE.pdf) by @novoselt created at 2010-11-18 01:56:25

I've found a couple of issues with vertical spacing before and after sagecommandline environment and posted an example (the second page is the document that produces the first one). I have no idea how to fix it, but judging from other environments it is possible ;-)



---

archive/issue_comments_123291.json:
```json
{
    "body": "<a id='comment:11'></a>I think that keyword coloring should be removed for the output:\n\n```\n\\begin{sagecommandline}\nsage: 'Is this statement True?'\n\\end{sagecommandline}\n```\nproduces the correct output line \n\n```\nIs this statement True?\n```\nBut \"True\" is blue and the rest of the text is black.",
    "created_at": "2010-11-18T05:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123291",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:11'></a>I think that keyword coloring should be removed for the output:

```
\begin{sagecommandline}
sage: 'Is this statement True?'
\end{sagecommandline}
```
produces the correct output line 

```
Is this statement True?
```
But "True" is blue and the rest of the text is black.



---

archive/issue_comments_123292.json:
```json
{
    "body": "<a id='comment:12'></a>Those using SageTeX for plotting may find #7981 relevant.\n\nAlso I find the reference \"Till Tantau has some good commentary on the use of graphics in section 6 of the pgf manual\" a bit confusing. I suggest pointing the link at `http://www.ctan.org/tex-archive/help/Catalogue/entries/pgf.html` and adding the name of the section since now it is \"7 Guidelines on Graphics.\"",
    "created_at": "2010-11-19T04:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123292",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:12'></a>Those using SageTeX for plotting may find #7981 relevant.

Also I find the reference "Till Tantau has some good commentary on the use of graphics in section 6 of the pgf manual" a bit confusing. I suggest pointing the link at `http://www.ctan.org/tex-archive/help/Catalogue/entries/pgf.html` and adding the name of the section since now it is "7 Guidelines on Graphics."



---

archive/issue_comments_123293.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:9 ddrake]:\n> That is weird. I have no idea what that is happening. It's because of the tilde in the URL in the footnote. I've asked about this: http://tex.stackexchange.com/questions/5260/why-is-docstrip-putting-extra-macro-calls-in-a-hyperlink-inside-a-footnote-that-h\n\n\nI got an answer there and [have fixed that problem](https://bitbucket.org/ddrake/sagetex/changeset/45599b7584e9).",
    "created_at": "2010-11-19T06:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123293",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:13'></a>Replying to [comment:9 ddrake]:
> That is weird. I have no idea what that is happening. It's because of the tilde in the URL in the footnote. I've asked about this: http://tex.stackexchange.com/questions/5260/why-is-docstrip-putting-extra-macro-calls-in-a-hyperlink-inside-a-footnote-that-h


I got an answer there and [have fixed that problem](https://bitbucket.org/ddrake/sagetex/changeset/45599b7584e9).



---

archive/issue_comments_123294.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:11 novoselt]:\n> I think that keyword coloring should be removed for the output:\n> \n> ```\n> \\begin{sagecommandline}\n> sage: 'Is this statement True?'\n> \\end{sagecommandline}\n> ```\n> produces the correct output line \n> \n> ```\n> Is this statement True?\n> ```\n> But \"True\" is blue and the rest of the text is black.\n\n\nI'll add Volker Braun to the CC list and see if he has a comment; he knows more about the LaTeX listings package than I do.",
    "created_at": "2010-11-19T06:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123294",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:14'></a>Replying to [comment:11 novoselt]:
> I think that keyword coloring should be removed for the output:
> 
> ```
> \begin{sagecommandline}
> sage: 'Is this statement True?'
> \end{sagecommandline}
> ```
> produces the correct output line 
> 
> ```
> Is this statement True?
> ```
> But "True" is blue and the rest of the text is black.


I'll add Volker Braun to the CC list and see if he has a comment; he knows more about the LaTeX listings package than I do.



---

archive/issue_comments_123295.json:
```json
{
    "body": "Changing assignee from tbd to @dandrake.",
    "created_at": "2010-11-19T06:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123295",
    "user": "https://github.com/dandrake"
}
```

Changing assignee from tbd to @dandrake.



---

archive/issue_comments_123296.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:12 novoselt]:\n> Those using SageTeX for plotting may find #7981 relevant.\n> \n> Also I find the reference \"Till Tantau has some good commentary on the use of graphics in section 6 of the pgf manual\" a bit confusing. I suggest pointing the link at `http://www.ctan.org/tex-archive/help/Catalogue/entries/pgf.html` and adding the name of the section since now it is \"7 Guidelines on Graphics.\"\n\n\n[Fixed](https://bitbucket.org/ddrake/sagetex/changeset/88d215fcf79b).\n\nI'll look over the other issues raised here and see what I can do.",
    "created_at": "2010-11-19T06:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123296",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:15'></a>Replying to [comment:12 novoselt]:
> Those using SageTeX for plotting may find #7981 relevant.
> 
> Also I find the reference "Till Tantau has some good commentary on the use of graphics in section 6 of the pgf manual" a bit confusing. I suggest pointing the link at `http://www.ctan.org/tex-archive/help/Catalogue/entries/pgf.html` and adding the name of the section since now it is "7 Guidelines on Graphics."


[Fixed](https://bitbucket.org/ddrake/sagetex/changeset/88d215fcf79b).

I'll look over the other issues raised here and see what I can do.



---

archive/issue_comments_123297.json:
```json
{
    "body": "<a id='comment:16'></a>Thanks for fixes! It was indeed illuminating to read that section in PGF manual. And after reading it, it seems to me that there should be no default scaling of the produced graphics to `0.75\\textwidth`, users should control it via `figsize` option to matplotlib, since in this case specifying font sizes and line widths in points makes sense and works as expected. This behaviour is easy to achieve in the present version by adding empty [] after `\\sageplot`, but I think it should be the default.\n\nBetter yet, it would be nice if it was possible to write\n\n```\n\\sageplot[width=0.5\\textwidth]{...}\n```\nand this resulted in automatic computation of the required figsize parameters (since `figsize=[\\textwidth, 2]` does not work). I guess this is a bit tricky since `figsize` requires two parameters, but perhaps it would make sense to use the same width and height if only one was given.",
    "created_at": "2010-11-19T16:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123297",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:16'></a>Thanks for fixes! It was indeed illuminating to read that section in PGF manual. And after reading it, it seems to me that there should be no default scaling of the produced graphics to `0.75\textwidth`, users should control it via `figsize` option to matplotlib, since in this case specifying font sizes and line widths in points makes sense and works as expected. This behaviour is easy to achieve in the present version by adding empty [] after `\sageplot`, but I think it should be the default.

Better yet, it would be nice if it was possible to write

```
\sageplot[width=0.5\textwidth]{...}
```
and this resulted in automatic computation of the required figsize parameters (since `figsize=[\textwidth, 2]` does not work). I guess this is a bit tricky since `figsize` requires two parameters, but perhaps it would make sense to use the same width and height if only one was given.



---

archive/issue_comments_123298.json:
```json
{
    "body": "<a id='comment:17'></a>#2100 may be relevant to the above suggestion.\n\nAlso I have another very general suggestion. I didn't succeed in installing sagetex.sty in my home folder and I don't really care what was wrong, as I just copied it directly to the folder with my main .tex file. I think that this is the best option, it should be recommended in the manual, and instead of checking that sagetex.sty version matches the installed Sage version, there should be a check that Sage installation is not older than sagetex.sty.\n\nThe reason was mentioned on sage-devel:\nhttp://groups.google.com/group/sage-devel/msg/999f3712689df932\npapers don't get updates as often as software and one of the really nice features of LaTeX is that its current versions can process old input files and produce the same output as many years ago. I think the same should be the case for SageTeX and it probably can be accomplished if its Sage module maintained backward compatibility with all previous versions of sagetex.sty. Then when one wants to write a new paper using SageTeX, s/he copies the current version of sagetex.sty into the paper directory, writes the paper and keeps that version of sagetex.sty with the paper source. Even if later sagetex.sty will be significantly altered, that paper should still work fine with the old copy, even if Sage installation is newer.",
    "created_at": "2010-12-05T04:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123298",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:17'></a>#2100 may be relevant to the above suggestion.

Also I have another very general suggestion. I didn't succeed in installing sagetex.sty in my home folder and I don't really care what was wrong, as I just copied it directly to the folder with my main .tex file. I think that this is the best option, it should be recommended in the manual, and instead of checking that sagetex.sty version matches the installed Sage version, there should be a check that Sage installation is not older than sagetex.sty.

The reason was mentioned on sage-devel:
http://groups.google.com/group/sage-devel/msg/999f3712689df932
papers don't get updates as often as software and one of the really nice features of LaTeX is that its current versions can process old input files and produce the same output as many years ago. I think the same should be the case for SageTeX and it probably can be accomplished if its Sage module maintained backward compatibility with all previous versions of sagetex.sty. Then when one wants to write a new paper using SageTeX, s/he copies the current version of sagetex.sty into the paper directory, writes the paper and keeps that version of sagetex.sty with the paper source. Even if later sagetex.sty will be significantly altered, that paper should still work fine with the old copy, even if Sage installation is newer.



---

archive/issue_comments_123299.json:
```json
{
    "body": "<a id='comment:18'></a>Optimization suggestion for listings-styles: `basicstyle` propagates to all other ones, so setting it to `\\ttfamily` makes everything typeset with it. Also, there is no bold version of typewriter fonts (at least for standard fonts of LaTeX), so `\\bfseries` didn't do anything. The following commands do for me the same typesetting as the original ones, but look a little cleaner and make it easier for the user to understand what should be changed. (I wanted to make everything a little smaller, and my first impression was that I have to insert `\\small` into 10 places or so, but one turned out to be enough.)\n\n```\n\\lstdefinestyle{DefaultSageInputOutput}{\n  nolol,\n  identifierstyle=,\n  name=sagecommandline,\n  xleftmargin=5pt,\n  numbersep=5pt,\n  aboveskip=0pt,\n  belowskip=0pt,\n  breaklines=true,\n  basicstyle={\\ttfamily},\n  numberstyle=\\footnotesize,\n  numbers=right\n}\n\\lstdefinestyle{DefaultSageInput}{\n  language=Sage,\n  style=DefaultSageInputOutput,\n  commentstyle={\\color{dgreencolor}},\n  keywordstyle={\\color{dbluecolor}},\n  stringstyle={\\color{dgraycolor}},\n}\n\\lstdefinestyle{DefaultSageOutput}{\n  language=SageOutput,\n  style=DefaultSageInputOutput,\n  commentstyle={\\color{dgreencolor}},\n  keywordstyle={\\color{dbluecolor}},\n  stringstyle={\\color{dgraycolor}},\n}\n```\nIn the last definition I think all styles can go since the output should not be typeset with any kind of \"syntax highlighting\", in particular True/False should not be blue.",
    "created_at": "2010-12-10T01:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123299",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:18'></a>Optimization suggestion for listings-styles: `basicstyle` propagates to all other ones, so setting it to `\ttfamily` makes everything typeset with it. Also, there is no bold version of typewriter fonts (at least for standard fonts of LaTeX), so `\bfseries` didn't do anything. The following commands do for me the same typesetting as the original ones, but look a little cleaner and make it easier for the user to understand what should be changed. (I wanted to make everything a little smaller, and my first impression was that I have to insert `\small` into 10 places or so, but one turned out to be enough.)

```
\lstdefinestyle{DefaultSageInputOutput}{
  nolol,
  identifierstyle=,
  name=sagecommandline,
  xleftmargin=5pt,
  numbersep=5pt,
  aboveskip=0pt,
  belowskip=0pt,
  breaklines=true,
  basicstyle={\ttfamily},
  numberstyle=\footnotesize,
  numbers=right
}
\lstdefinestyle{DefaultSageInput}{
  language=Sage,
  style=DefaultSageInputOutput,
  commentstyle={\color{dgreencolor}},
  keywordstyle={\color{dbluecolor}},
  stringstyle={\color{dgraycolor}},
}
\lstdefinestyle{DefaultSageOutput}{
  language=SageOutput,
  style=DefaultSageInputOutput,
  commentstyle={\color{dgreencolor}},
  keywordstyle={\color{dbluecolor}},
  stringstyle={\color{dgraycolor}},
}
```
In the last definition I think all styles can go since the output should not be typeset with any kind of "syntax highlighting", in particular True/False should not be blue.



---

archive/issue_comments_123300.json:
```json
{
    "body": "<a id='comment:19'></a>Some more issues:\n\n* If I have a `sagecommandline` block and then I insert `$\\sage{...}$` before it, I cannot compile the file. As I understand, because of the reference shift LaTeX tries to substitute the output of sagecommandline into inline sage and that does not work since the latter is in the math mode. But then rerunning Sage does not help since the source code for Sage does not get updated without a successful LaTeX run. So pretty much the only option seems to delete all (or some) autogenerated files, which is a bit annoying.\n\n* If I put `\\sage{...}` inside, say, `\\begin{gather} ... \\end{gather}`, then I get warnings about multiple definition of sage-related labels. Looking at `*.sagetex.py` file I suppose that the issue is in lines\n\n```\ntry:\n _st_.inline(_sage_const_28 , latex(1+1))\nexcept:\n _st_.goboom(_sage_const_961 )\ntry:\n _st_.inline(_sage_const_28 , latex(1+1))\nexcept:\n _st_.goboom(_sage_const_961 )\n```\ni.e. they are exactly the same. I suppose that's just how LaTeX works, it processes the input of complicated math environments twice, but it would be nice if it was somehow taken into account in SageTeX. \"Just ignoring these warnings\" is not a good option, because I see only the top warnings automatically in my editor and if that space is \"occupied\" I'll have to scroll manually to see if my new lines have introduced any warnings that I would like to fix. It is much more pleasant when there are usually no warnings at all and when they do appear I notice it right away.",
    "created_at": "2011-01-31T00:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123300",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:19'></a>Some more issues:

* If I have a `sagecommandline` block and then I insert `$\sage{...}$` before it, I cannot compile the file. As I understand, because of the reference shift LaTeX tries to substitute the output of sagecommandline into inline sage and that does not work since the latter is in the math mode. But then rerunning Sage does not help since the source code for Sage does not get updated without a successful LaTeX run. So pretty much the only option seems to delete all (or some) autogenerated files, which is a bit annoying.

* If I put `\sage{...}` inside, say, `\begin{gather} ... \end{gather}`, then I get warnings about multiple definition of sage-related labels. Looking at `*.sagetex.py` file I suppose that the issue is in lines

```
try:
 _st_.inline(_sage_const_28 , latex(1+1))
except:
 _st_.goboom(_sage_const_961 )
try:
 _st_.inline(_sage_const_28 , latex(1+1))
except:
 _st_.goboom(_sage_const_961 )
```
i.e. they are exactly the same. I suppose that's just how LaTeX works, it processes the input of complicated math environments twice, but it would be nice if it was somehow taken into account in SageTeX. "Just ignoring these warnings" is not a good option, because I see only the top warnings automatically in my editor and if that space is "occupied" I'll have to scroll manually to see if my new lines have introduced any warnings that I would like to fix. It is much more pleasant when there are usually no warnings at all and when they do appear I notice it right away.



---

archive/issue_comments_123301.json:
```json
{
    "body": "<a id='comment:20'></a>By the way, IMHO this update is very useful as is and I have an itch to switch it to positive review. I hesitate since I cannot really understand the guts of the package, but as a user I like it a lot despite of all the issues I have discovered. Perhaps this version can be merged with fixes and improvements delegated to future ones...",
    "created_at": "2011-01-31T00:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123301",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:20'></a>By the way, IMHO this update is very useful as is and I have an itch to switch it to positive review. I hesitate since I cannot really understand the guts of the package, but as a user I like it a lot despite of all the issues I have discovered. Perhaps this version can be merged with fixes and improvements delegated to future ones...



---

archive/issue_comments_123302.json:
```json
{
    "body": "Fixed vertical spacing (same input as before, with modified sagetex.py)",
    "created_at": "2011-03-27T06:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123302",
    "user": "https://github.com/novoselt"
}
```

Fixed vertical spacing (same input as before, with modified sagetex.py)



---

archive/issue_comments_123303.json:
```json
{
    "body": "Changing work_issues from \"\" to \"spacing before/after sagecommandline\"",
    "created_at": "2011-03-27T07:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123303",
    "user": "https://github.com/novoselt"
}
```

Changing work_issues from "" to "spacing before/after sagecommandline"



---

archive/issue_comments_123304.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-27T07:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123304",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_123305.json:
```json
{
    "body": "<a id='comment:21'></a>Attachment [STE-new.pdf](tarball://root/attachments/some-uuid/ticket10146/STE-new.pdf) by @novoselt created at 2011-03-27 07:15:48\n\nOK, I have found fixes for the vertical space issues both before and after. In the sagetex.py file (I am not sure where the original is supposed to be, I was fixing the version in `sage/local/lib/python2.6/site-packages`).\n\nLines 77-78 should be\n\n```\n    self.souttmp.write('\\\\newlabel{@sageinline' + str(counter) + '}{{%\\n' +\n                 s.rstrip() + '}}\\n')\n```\nI have removed four pairs of `{}` before the newline. It may be not the proper place/way to do it, but the main idea is that these braces should not appear on the last line of every command line listing in `*.sagetex.sout`. This seems to fix the issue with extra space appearing after sagecommandline, if the following text starts a new paragraph or a theorem.\n\nLine 145 should be\n\n```\n      latex_string = r\"\\unskip\\unskip\\vspace{\\sagecommandlineskip}\" + \"\\n\"\n```\nTwo unskips eliminate the space before sagecommandline which was appearing if the preceding line was \"full.\" One unskip does not work, what is the correct number of them I don't know, but I took the repetition idea from `amsthm.sty` which contains\n\n```\n\\ifhmode\\unskip\\unskip\\par\\fi\n```\non line 140.\n\nIt is possible that `\\ignorespaces` should be used somehow in the end of blocks for even more robust behaviour.\n\nPlease include these fixes, for these spacing issues are really annoying and it is somewhat non-trivial to figure out a workaround ;-)",
    "created_at": "2011-03-27T07:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123305",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:21'></a>Attachment [STE-new.pdf](tarball://root/attachments/some-uuid/ticket10146/STE-new.pdf) by @novoselt created at 2011-03-27 07:15:48

OK, I have found fixes for the vertical space issues both before and after. In the sagetex.py file (I am not sure where the original is supposed to be, I was fixing the version in `sage/local/lib/python2.6/site-packages`).

Lines 77-78 should be

```
    self.souttmp.write('\\newlabel{@sageinline' + str(counter) + '}{{%\n' +
                 s.rstrip() + '}}\n')
```
I have removed four pairs of `{}` before the newline. It may be not the proper place/way to do it, but the main idea is that these braces should not appear on the last line of every command line listing in `*.sagetex.sout`. This seems to fix the issue with extra space appearing after sagecommandline, if the following text starts a new paragraph or a theorem.

Line 145 should be

```
      latex_string = r"\unskip\unskip\vspace{\sagecommandlineskip}" + "\n"
```
Two unskips eliminate the space before sagecommandline which was appearing if the preceding line was "full." One unskip does not work, what is the correct number of them I don't know, but I took the repetition idea from `amsthm.sty` which contains

```
\ifhmode\unskip\unskip\par\fi
```
on line 140.

It is possible that `\ignorespaces` should be used somehow in the end of blocks for even more robust behaviour.

Please include these fixes, for these spacing issues are really annoying and it is somewhat non-trivial to figure out a workaround ;-)



---

archive/issue_comments_123306.json:
```json
{
    "body": "<a id='comment:22'></a>#11067 (sage -t on lstlistings) may be related.",
    "created_at": "2011-03-28T13:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123306",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:22'></a>#11067 (sage -t on lstlistings) may be related.



---

archive/issue_comments_123307.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 novoselt]:\n> Lines 77-78 should be\n> \n> ```\n>     self.souttmp.write('\\\\newlabel{@sageinline' + str(counter) + '}{{%\\n' +\n>                  s.rstrip() + '}}\\n')\n> ```\n> I have removed four pairs of `{}` before the newline.\n\n\nDoing that breaks hyperref compatibility. We can't remove those brace pairs.\n\nI'll look into the other spacing issues.",
    "created_at": "2011-03-29T07:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123307",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:23'></a>Replying to [comment:21 novoselt]:
> Lines 77-78 should be
> 
> ```
>     self.souttmp.write('\\newlabel{@sageinline' + str(counter) + '}{{%\n' +
>                  s.rstrip() + '}}\n')
> ```
> I have removed four pairs of `{}` before the newline.


Doing that breaks hyperref compatibility. We can't remove those brace pairs.

I'll look into the other spacing issues.



---

archive/issue_comments_123308.json:
```json
{
    "body": "<a id='comment:24'></a>As I said, it may be not the right place to fix it. Does `sagecommandline` need something from hyperref? It wraps each line into its own `lstlisting` environment and in the very end of the whole block there are these extra braces. Perhaps `inline` function should be left as is, but a copy of it without braces can be created specifically for `sagecommandline`?",
    "created_at": "2011-03-29T15:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123308",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:24'></a>As I said, it may be not the right place to fix it. Does `sagecommandline` need something from hyperref? It wraps each line into its own `lstlisting` environment and in the very end of the whole block there are these extra braces. Perhaps `inline` function should be left as is, but a copy of it without braces can be created specifically for `sagecommandline`?



---

archive/issue_comments_123309.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 novoselt]:\n> As I said, it may be not the right place to fix it. Does `sagecommandline` need something from hyperref? \n\n\nNo, but if the user has hyperref loaded, any `\\newlabel` must have the five `{}` pairs or the document can't be typeset.\n\n> It wraps each line into its own `lstlisting` environment and in the very end of the whole block there are these extra braces. Perhaps `inline` function should be left as is, but a copy of it without braces can be created specifically for `sagecommandline`?\n\n\nThat's a good idea, but in that case the copy of `inline` would have the same problem: with hyperref loaded, the `\\newlabel` will fail without the extra `{}`s.",
    "created_at": "2011-03-30T08:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123309",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:25'></a>Replying to [comment:24 novoselt]:
> As I said, it may be not the right place to fix it. Does `sagecommandline` need something from hyperref? 


No, but if the user has hyperref loaded, any `\newlabel` must have the five `{}` pairs or the document can't be typeset.

> It wraps each line into its own `lstlisting` environment and in the very end of the whole block there are these extra braces. Perhaps `inline` function should be left as is, but a copy of it without braces can be created specifically for `sagecommandline`?


That's a good idea, but in that case the copy of `inline` would have the same problem: with hyperref loaded, the `\newlabel` will fail without the extra `{}`s.



---

archive/issue_comments_123310.json:
```json
{
    "body": "<a id='comment:26'></a>I have also changed line 146 to be \n\n```\n      bottom_skip =  r\"\\vspace{\\sagecommandlineskip}\" + \"\\n\"\n```\nsince otherwise there is no bottom skip for blocks that do not produce any output.\n\nIt may be better to use `\\addvspace` instead of `\\vspace` - it works fine in the end of blocks since LaTeX is in vertical mode by then, but in the beginning it is in horizontal one, `\\par` is not acceptable inside `\\newlabel`, and I don't know how to switch to vertical mode otherwise. Does anyone know it? Or how to allow wrapping arbitrarily complicated LaTeX?\n\nRegarding `\\newlabel` and `hyperref` - perhaps SageTeX should detect whether it is in use or not or at least have a manual switch to adjust the number of parameters according to the used definition of `\\newlabel`. By the way - is there documentation on `\\newlabel` command and if yes, how can I find it???",
    "created_at": "2011-04-01T04:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123310",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:26'></a>I have also changed line 146 to be 

```
      bottom_skip =  r"\vspace{\sagecommandlineskip}" + "\n"
```
since otherwise there is no bottom skip for blocks that do not produce any output.

It may be better to use `\addvspace` instead of `\vspace` - it works fine in the end of blocks since LaTeX is in vertical mode by then, but in the beginning it is in horizontal one, `\par` is not acceptable inside `\newlabel`, and I don't know how to switch to vertical mode otherwise. Does anyone know it? Or how to allow wrapping arbitrarily complicated LaTeX?

Regarding `\newlabel` and `hyperref` - perhaps SageTeX should detect whether it is in use or not or at least have a manual switch to adjust the number of parameters according to the used definition of `\newlabel`. By the way - is there documentation on `\newlabel` command and if yes, how can I find it???



---

archive/issue_comments_123311.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:19 novoselt]:\n>  * If I have a `sagecommandline` block and then I insert `$\\sage{...}$` before it, I cannot compile the file. As I understand, because of the reference shift LaTeX tries to substitute the output of sagecommandline into inline sage and that does not work since the latter is in the math mode. But then rerunning Sage does not help since the source code for Sage does not get updated without a successful LaTeX run. So pretty much the only option seems to delete all (or some) autogenerated files, which is a bit annoying.\n\n\nNote that it will impossible to prevent this from happening: after the `.sout` file is written, you can rewrite your LaTeX file in all sorts of crazy ways to get the labels pulled into strange places. I can add a bit of sanity checking to the `commandline` stuff so that you at least don't get bizarre errors when typesetting your document.",
    "created_at": "2011-04-07T07:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123311",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:27'></a>Replying to [comment:19 novoselt]:
>  * If I have a `sagecommandline` block and then I insert `$\sage{...}$` before it, I cannot compile the file. As I understand, because of the reference shift LaTeX tries to substitute the output of sagecommandline into inline sage and that does not work since the latter is in the math mode. But then rerunning Sage does not help since the source code for Sage does not get updated without a successful LaTeX run. So pretty much the only option seems to delete all (or some) autogenerated files, which is a bit annoying.


Note that it will impossible to prevent this from happening: after the `.sout` file is written, you can rewrite your LaTeX file in all sorts of crazy ways to get the labels pulled into strange places. I can add a bit of sanity checking to the `commandline` stuff so that you at least don't get bizarre errors when typesetting your document.



---

archive/issue_comments_123312.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:27 ddrake]:\n> Replying to [comment:19 novoselt]:\n> >  * If I have a `sagecommandline` block and then I insert `$\\sage{...}$` before it, I cannot compile the file. As I understand, because of the reference shift LaTeX tries to substitute the output of sagecommandline into inline sage and that does not work since the latter is in the math mode. But then rerunning Sage does not help since the source code for Sage does not get updated without a successful LaTeX run. So pretty much the only option seems to delete all (or some) autogenerated files, which is a bit annoying.\n \n> \n> Note that it will impossible to prevent this from happening: after the `.sout` file is written, you can rewrite your LaTeX file in all sorts of crazy ways to get the labels pulled into strange places. I can add a bit of sanity checking to the `commandline` stuff so that you at least don't get bizarre errors when typesetting your document.\n\n\nWould it be possible to use different label names for different SageTeX environments? If they are not mixed, then there should be no issue with using the output in a wrong mode and the user will be able to generate new input file and run Sage on it without deleting  anything.",
    "created_at": "2011-04-07T15:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123312",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:28'></a>Replying to [comment:27 ddrake]:
> Replying to [comment:19 novoselt]:
> >  * If I have a `sagecommandline` block and then I insert `$\sage{...}$` before it, I cannot compile the file. As I understand, because of the reference shift LaTeX tries to substitute the output of sagecommandline into inline sage and that does not work since the latter is in the math mode. But then rerunning Sage does not help since the source code for Sage does not get updated without a successful LaTeX run. So pretty much the only option seems to delete all (or some) autogenerated files, which is a bit annoying.
 
> 
> Note that it will impossible to prevent this from happening: after the `.sout` file is written, you can rewrite your LaTeX file in all sorts of crazy ways to get the labels pulled into strange places. I can add a bit of sanity checking to the `commandline` stuff so that you at least don't get bizarre errors when typesetting your document.


Would it be possible to use different label names for different SageTeX environments? If they are not mixed, then there should be no issue with using the output in a wrong mode and the user will be able to generate new input file and run Sage on it without deleting  anything.



---

archive/issue_comments_123313.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 novoselt]:\n> Would it be possible to use different label names for different SageTeX environments? If they are not mixed, then there should be no issue with using the output in a wrong mode and the user will be able to generate new input file and run Sage on it without deleting  anything.\n\n\nThat's a much smarter idea than what I was thinking. I've implemented your idea; it's in the most recent commits on bitbucket.",
    "created_at": "2011-04-08T06:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123313",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:29'></a>Replying to [comment:28 novoselt]:
> Would it be possible to use different label names for different SageTeX environments? If they are not mixed, then there should be no issue with using the output in a wrong mode and the user will be able to generate new input file and run Sage on it without deleting  anything.


That's a much smarter idea than what I was thinking. I've implemented your idea; it's in the most recent commits on bitbucket.



---

archive/issue_comments_123314.json:
```json
{
    "body": "<a id='comment:30'></a>I just found this ticket and downloaded the latest version. This is great! I'll try testing it.\n\nWhat's the current status of this ticket? I mean, could you summarize what remains to be done?\n\nThank you!",
    "created_at": "2011-05-25T00:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123314",
    "user": "https://trac.sagemath.org/admin/accounts/users/abmasse"
}
```

<a id='comment:30'></a>I just found this ticket and downloaded the latest version. This is great! I'll try testing it.

What's the current status of this ticket? I mean, could you summarize what remains to be done?

Thank you!



---

archive/issue_comments_123315.json:
```json
{
    "body": "<a id='comment:31'></a>I agree that the current state of the spkg is a big improvement, even if there are issues remaining. I'm in favor of giving it a positive review now so we can release it with Sage-4.7.1. There were some good suggestions on this ticket, maybe Dan can comment on whether he wants to make any other changes during this release?",
    "created_at": "2011-05-25T01:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123315",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>I agree that the current state of the spkg is a big improvement, even if there are issues remaining. I'm in favor of giving it a positive review now so we can release it with Sage-4.7.1. There were some good suggestions on this ticket, maybe Dan can comment on whether he wants to make any other changes during this release?



---

archive/issue_events_025915.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-05-25T01:33:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10146#event-25915"
}
```



---

archive/issue_comments_123316.json:
```json
{
    "body": "<a id='comment:32'></a>Let's please not include the package which was made when this ticket was created, but rather a fresh version reflecting SageTeX repository. The very last issue (resolved by using different link names for different environments) was making it very annoying to modify files with extensive SageTeX usage.\n\nI also made a bunch of suggestions in comment 18 regarding settings of listings. The most important one of them: I strongly feel that there should be no syntax highlighting of any kind in the output (currently True/False are different).\n\nIt would be also a good idea to include some short instructions on installing luximono, which allows using bold font for listings and is quite a bit narrower than the standard typerwriter font.\n\nRegarding bold, I also quite strongly feel that listings should not be bold by default (the output may), since \"the main thing\" should be typeset using \"the main style\" and when commandline environment is used, the emphasis is probably on the code itself, so it is likely to be the bigger part of the listing. When the output gets large, it is probably a better idea to typeset/represent it some other way.",
    "created_at": "2011-05-25T02:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123316",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:32'></a>Let's please not include the package which was made when this ticket was created, but rather a fresh version reflecting SageTeX repository. The very last issue (resolved by using different link names for different environments) was making it very annoying to modify files with extensive SageTeX usage.

I also made a bunch of suggestions in comment 18 regarding settings of listings. The most important one of them: I strongly feel that there should be no syntax highlighting of any kind in the output (currently True/False are different).

It would be also a good idea to include some short instructions on installing luximono, which allows using bold font for listings and is quite a bit narrower than the standard typerwriter font.

Regarding bold, I also quite strongly feel that listings should not be bold by default (the output may), since "the main thing" should be typeset using "the main style" and when commandline environment is used, the emphasis is probably on the code itself, so it is likely to be the bigger part of the listing. When the output gets large, it is probably a better idea to typeset/represent it some other way.



---

archive/issue_comments_123317.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:31 vbraun]:\n> I agree that the current state of the spkg is a big improvement, even if there are issues remaining. I'm in favor of giving it a positive review now so we can release it with Sage-4.7.1. There were some good suggestions on this ticket, maybe Dan can comment on whether he wants to make any other changes during this release?\n\n\nI'd really like to get the current version into 4.7.1. I looked over the changes since 2.3, and I see three nontrivial, user-visible things:\n\n* use `foo.sagetex.sout`, etc, instead of `foo.sout`. This means that if you put Sage code into `important_paper.sage`, it won't get clobbered when you typeset `important_paper.tex`.\n* handle (some) spaces in filenames.\n* use separate labels for `inline` and `commandline` (as reported above).\n\nThe issues not addressed are the spacing issues that Andrey has noted. The stuff about syntax highlighting needs to be addressed, but I think that counts as bikeshedding here.\n\nIf we merge the current version of SageTeX, we have something that definitely works better than what's currently shipping. I will likely have time over the summer to work on that, and in any case, Andrey (and Volker, and many other SageTeXers) will be at Sage Days 31 and we can have a discussion there.\n\nHere's my proposal: I make a spkg for the current version of SageTeX and we merge that with 4.7.1, and work on the other problems noted here over the summer. What do you think?",
    "created_at": "2011-05-25T13:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123317",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:33'></a>Replying to [comment:31 vbraun]:
> I agree that the current state of the spkg is a big improvement, even if there are issues remaining. I'm in favor of giving it a positive review now so we can release it with Sage-4.7.1. There were some good suggestions on this ticket, maybe Dan can comment on whether he wants to make any other changes during this release?


I'd really like to get the current version into 4.7.1. I looked over the changes since 2.3, and I see three nontrivial, user-visible things:

* use `foo.sagetex.sout`, etc, instead of `foo.sout`. This means that if you put Sage code into `important_paper.sage`, it won't get clobbered when you typeset `important_paper.tex`.
* handle (some) spaces in filenames.
* use separate labels for `inline` and `commandline` (as reported above).

The issues not addressed are the spacing issues that Andrey has noted. The stuff about syntax highlighting needs to be addressed, but I think that counts as bikeshedding here.

If we merge the current version of SageTeX, we have something that definitely works better than what's currently shipping. I will likely have time over the summer to work on that, and in any case, Andrey (and Volker, and many other SageTeXers) will be at Sage Days 31 and we can have a discussion there.

Here's my proposal: I make a spkg for the current version of SageTeX and we merge that with 4.7.1, and work on the other problems noted here over the summer. What do you think?



---

archive/issue_comments_123318.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 ddrake]:\n> Here's my proposal: I make a spkg for the current version of SageTeX and we merge that with 4.7.1, and work on the other problems noted here over the summer. What do you think?\n\n\n+1\n\nI also don't mind if the output is too colorful. If you don't like the syntax highlighting then its easy to turn off, but if its initially turned off then its hard to discover that the feature is there.",
    "created_at": "2011-05-25T14:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123318",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>Replying to [comment:33 ddrake]:
> Here's my proposal: I make a spkg for the current version of SageTeX and we merge that with 4.7.1, and work on the other problems noted here over the summer. What do you think?


+1

I also don't mind if the output is too colorful. If you don't like the syntax highlighting then its easy to turn off, but if its initially turned off then its hard to discover that the feature is there.



---

archive/issue_comments_123319.json:
```json
{
    "body": "Changing work_issues from \"spacing before/after sagecommandline\" to \"update spkg to the latest version of SageTeX\"",
    "created_at": "2011-05-25T14:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123319",
    "user": "https://github.com/novoselt"
}
```

Changing work_issues from "spacing before/after sagecommandline" to "update spkg to the latest version of SageTeX"



---

archive/issue_comments_123320.json:
```json
{
    "body": "<a id='comment:35'></a>As long as we merge the version with separate label names - I am fine!\n\nI will be even happier if there are no colored keywords in the output, which is a simple change ;-) But since it does not affect how things work, we may leave it and other things to the next version, after perhaps having some live discussions.",
    "created_at": "2011-05-25T14:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123320",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:35'></a>As long as we merge the version with separate label names - I am fine!

I will be even happier if there are no colored keywords in the output, which is a simple change ;-) But since it does not affect how things work, we may leave it and other things to the next version, after perhaps having some live discussions.



---

archive/issue_comments_123321.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,8 @@\n I've just finished a new version of the SageTeX spkg, which is available from \n \n-http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.spkg\n+http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.spkg\n \n Please review!\n-\n-Assignee: tbd\n \n Author: Dan Drake\n \n``````\n",
    "created_at": "2011-05-27T04:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123321",
    "user": "https://github.com/dandrake"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,8 @@
 I've just finished a new version of the SageTeX spkg, which is available from 
 
-http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.spkg
+http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.spkg
 
 Please review!
-
-Assignee: tbd
 
 Author: Dan Drake
 
``````




---

archive/issue_comments_123322.json:
```json
{
    "body": "<a id='comment:36'></a>Okay, here's a new spkg: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.spkg\n\nI'm switching this to \"needs review\"; if that spkg works, then switch this to positive review and let's get this into 4.7.1 and work on the other bits this summer.",
    "created_at": "2011-05-27T04:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123322",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:36'></a>Okay, here's a new spkg: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.spkg

I'm switching this to "needs review"; if that spkg works, then switch this to positive review and let's get this into 4.7.1 and work on the other bits this summer.



---

archive/issue_comments_123323.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-05-27T04:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123323",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_123324.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Mariah Lenox\"",
    "created_at": "2011-06-16T13:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123324",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing reviewer from "" to "Mariah Lenox"



---

archive/issue_comments_123325.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-16T13:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123325",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_123326.json:
```json
{
    "body": "<a id='comment:37'></a>I put the spkg into the source of sage-4.7.1.alpha2 and did 'make testlong'.  All tests passed.  Positive review!",
    "created_at": "2011-06-16T13:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123326",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:37'></a>I put the spkg into the source of sage-4.7.1.alpha2 and did 'make testlong'.  All tests passed.  Positive review!



---

archive/issue_comments_123327.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd31\".",
    "created_at": "2011-06-16T16:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123327",
    "user": "https://github.com/novoselt"
}
```

Changing keywords from "" to "sd31".



---

archive/issue_comments_123328.json:
```json
{
    "body": "Changing reviewer from \"Mariah Lenox\" to \"Mariah Lenox, Andrey Novoseltsev\"",
    "created_at": "2011-06-16T16:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123328",
    "user": "https://github.com/novoselt"
}
```

Changing reviewer from "Mariah Lenox" to "Mariah Lenox, Andrey Novoseltsev"



---

archive/issue_comments_123329.json:
```json
{
    "body": "Changing work_issues from \"update spkg to the latest version of SageTeX\" to \"\"",
    "created_at": "2011-06-16T16:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123329",
    "user": "https://github.com/novoselt"
}
```

Changing work_issues from "update spkg to the latest version of SageTeX" to ""



---

archive/issue_comments_123330.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+I've just finished a new version of the SageTeX spkg, which is available from \n \n+http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.spkg\n \n Author: Dan Drake\n \n``````\n",
    "created_at": "2011-06-16T21:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123330",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+I've just finished a new version of the SageTeX spkg, which is available from 
 
+http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.1.spkg
 
 Author: Dan Drake
 
``````




---

archive/issue_events_025916.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-16T21:33:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10146#event-25916"
}
```



---

archive/issue_events_025917.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-16T21:33:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10146#event-25917"
}
```



---

archive/issue_comments_123331.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-07-22T12:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123331",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_123332.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.2.alpha0\"",
    "created_at": "2011-07-22T12:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10146#issuecomment-123332",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.7.2.alpha0"



---

archive/issue_events_025918.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-22T12:49:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10146",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10146#event-25918"
}
```
