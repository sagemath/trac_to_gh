# Issue 10229: Deleting attached files causes major problems

archive/issues_010228.json:
```json
{
    "assignees": [],
    "body": "Create a file, attach it in a Sage session, then delete/move the file.  Sage does not like this - and every command results in `OSError: [Errno 2] No such file or directory: '/path/to/attached/file.py`.  It won't even let you detach the file.\n\nAt the moment before each command is executed, Sage checks to see if any attached files have been modified.  Presumably instead it should except this error, remove the file from the list of attached files, and inform the user.\n\nDiscovered by rossk when reviewing #378.\n\nApply [attachment: trac_10229-2.patch](https://github.com/sagemath/sage/files/ticket10229/trac_10229-2.patch.gz)\n\nAssignee: **@williamstein**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10229_\n\n",
    "created_at": "2010-11-06T13:50:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Deleting attached files causes major problems",
    "type": "issue",
    "updated_at": "2022-12-29T01:28:25Z",
    "url": "https://github.com/sagemath/sage/issues/10229",
    "user": "https://github.com/sagetrac-flawrence"
}
```
Create a file, attach it in a Sage session, then delete/move the file.  Sage does not like this - and every command results in `OSError: [Errno 2] No such file or directory: '/path/to/attached/file.py`.  It won't even let you detach the file.

At the moment before each command is executed, Sage checks to see if any attached files have been modified.  Presumably instead it should except this error, remove the file from the list of attached files, and inform the user.

Discovered by rossk when reviewing #378.

Apply [attachment: trac_10229-2.patch](https://github.com/sagemath/sage/files/ticket10229/trac_10229-2.patch.gz)

Assignee: **@williamstein**

_Issue created by migration from https://trac.sagemath.org/ticket/10229_





---

archive/issue_events_122467.json:
```json
{
    "actor": "https://github.com/sagetrac-flawrence",
    "created_at": "2010-11-06T13:50:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122467"
}
```



---

archive/issue_events_122468.json:
```json
{
    "actor": "https://github.com/sagetrac-flawrence",
    "created_at": "2010-11-06T13:50:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20user%20interface",
    "label_color": "000080",
    "label_name": "component: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122468"
}
```



---

archive/issue_events_122469.json:
```json
{
    "actor": "https://github.com/sagetrac-flawrence",
    "created_at": "2010-11-06T13:50:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122469"
}
```



---

archive/issue_events_122470.json:
```json
{
    "actor": "https://github.com/sagetrac-flawrence",
    "created_at": "2010-11-06T13:50:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122470"
}
```



---

archive/issue_events_122471.json:
```json
{
    "actor": "https://github.com/mboratko",
    "created_at": "2011-11-17T06:47:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122471"
}
```



---

archive/issue_comments_097197.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nI wish I could include a patch here, but my sage install is having an unrelated issue right now, but this is an easy fix so it may be worth mentioning.\n\nFor sage/misc/preparser.py, wrap lines 1790 to 1794 in a try block, and use\n\n{{except OSError, e:\n      if e.errno==2:\n          pass\n}}\n\nThis will at least make it continue working. What would be our desired response to a moved/deleted file? I think it would make sense to detach it, since otherwise it will just keep attempting to go through this. Do we want to display a message to the user as well?\n\nSorry for not posting a patch, I will try to when I fix my sage install.",
    "created_at": "2011-11-17T06:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97197",
    "user": "https://github.com/mboratko"
}
```

<div id="comment:1" align="right">Comment 1</div>

I wish I could include a patch here, but my sage install is having an unrelated issue right now, but this is an easy fix so it may be worth mentioning.

For sage/misc/preparser.py, wrap lines 1790 to 1794 in a try block, and use

{{except OSError, e:
      if e.errno==2:
          pass
}}

This will at least make it continue working. What would be our desired response to a moved/deleted file? I think it would make sense to detach it, since otherwise it will just keep attempting to go through this. Do we want to display a message to the user as well?

Sorry for not posting a patch, I will try to when I fix my sage install.



---

archive/issue_comments_097198.json:
```json
{
    "body": "Attachment: **[trac_10229.patch.gz](https://github.com/sagemath/sage/files/ticket10229/trac_10229.patch.gz)**\n\nSuppress exception message for moved or deleted attachments",
    "created_at": "2011-11-17T07:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97198",
    "user": "https://github.com/mboratko"
}
```

Attachment: **[trac_10229.patch.gz](https://github.com/sagemath/sage/files/ticket10229/trac_10229.patch.gz)**

Suppress exception message for moved or deleted attachments



---

archive/issue_events_122472.json:
```json
{
    "actor": "https://github.com/mboratko",
    "created_at": "2011-11-17T07:05:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122472"
}
```



---

archive/issue_events_122473.json:
```json
{
    "actor": "https://github.com/mboratko",
    "created_at": "2011-11-17T07:05:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122473"
}
```



---

archive/issue_comments_097199.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nHere is a new patch that detaches inaccessible files and issues warnings. Doctests for the re-written function `modified_attached_files` have been overhauled as well. Please review!",
    "created_at": "2012-02-24T00:24:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97199",
    "user": "https://github.com/sagetrac-ltw"
}
```

<div id="comment:3" align="right">Comment 3</div>

Here is a new patch that detaches inaccessible files and issues warnings. Doctests for the re-written function `modified_attached_files` have been overhauled as well. Please review!



---

archive/issue_comments_097200.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n At the moment before each command is executed, Sage checks to see if any attached files have been modified.  Presumably instead it should except this error, remove the file from the list of attached files, and inform the user.\n \n Discovered by rossk when reviewing #378.\n+\n+Apply [attachment: trac_10229-2.patch](https://github.com/sagemath/sage/files/ticket10229/trac_10229-2.patch.gz)\n``````\n",
    "created_at": "2012-02-24T00:24:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97200",
    "user": "https://github.com/sagetrac-ltw"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 At the moment before each command is executed, Sage checks to see if any attached files have been modified.  Presumably instead it should except this error, remove the file from the list of attached files, and inform the user.
 
 Discovered by rossk when reviewing #378.
+
+Apply [attachment: trac_10229-2.patch](https://github.com/sagemath/sage/files/ticket10229/trac_10229-2.patch.gz)
``````




---

archive/issue_events_122474.json:
```json
{
    "actor": "https://github.com/sagetrac-ltw",
    "created_at": "2012-02-29T05:05:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122474"
}
```



---

archive/issue_events_122475.json:
```json
{
    "actor": "https://github.com/sagetrac-ltw",
    "created_at": "2012-02-29T05:05:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122475"
}
```



---

archive/issue_comments_097201.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nOops, looks like the patchbot isn't happy. Changing this to \"needs work\" until I (or someone else) has time to investigate.",
    "created_at": "2012-02-29T05:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97201",
    "user": "https://github.com/sagetrac-ltw"
}
```

<div id="comment:4" align="right">Comment 4</div>

Oops, looks like the patchbot isn't happy. Changing this to "needs work" until I (or someone else) has time to investigate.



---

archive/issue_comments_097202.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nApply trac_10229-2.patch",
    "created_at": "2012-02-29T19:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97202",
    "user": "https://github.com/sagetrac-ltw"
}
```

<div id="comment:5" align="right">Comment 5</div>

Apply trac_10229-2.patch



---

archive/issue_events_122476.json:
```json
{
    "actor": "https://github.com/sagetrac-ltw",
    "created_at": "2012-02-29T19:30:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122476"
}
```



---

archive/issue_events_122477.json:
```json
{
    "actor": "https://github.com/sagetrac-ltw",
    "created_at": "2012-02-29T19:30:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122477"
}
```



---

archive/issue_comments_097203.json:
```json
{
    "body": "fixed `modified_attached_files()`",
    "created_at": "2012-03-01T01:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97203",
    "user": "https://github.com/sagetrac-ltw"
}
```

fixed `modified_attached_files()`



---

archive/issue_comments_097204.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nAttachment: **[trac_10229-2.patch.gz](https://github.com/sagemath/sage/files/ticket10229/trac_10229-2.patch.gz)**\n\nApply trac_10229-2.patch",
    "created_at": "2012-03-01T01:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97204",
    "user": "https://github.com/sagetrac-ltw"
}
```

<div id="comment:6" align="right">Comment 6</div>

Attachment: **[trac_10229-2.patch.gz](https://github.com/sagemath/sage/files/ticket10229/trac_10229-2.patch.gz)**

Apply trac_10229-2.patch



---

archive/issue_events_122478.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2012-03-18T15:02:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122478"
}
```



---

archive/issue_events_122479.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2012-03-18T15:02:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122479"
}
```



---

archive/issue_comments_097205.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nIt looks like something introduced in sage-5.0.beta8 interferes with this as the following test fails:\n\n```\nsage -t  \"devel/sage-main/sage/misc/preparser.py\"\n```",
    "created_at": "2012-03-18T15:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10229#issuecomment-97205",
    "user": "https://github.com/sagetrac-johanbosman"
}
```

<div id="comment:7" align="right">Comment 7</div>

It looks like something introduced in sage-5.0.beta8 interferes with this as the following test fails:

```
sage -t  "devel/sage-main/sage/misc/preparser.py"
```



---

archive/issue_events_122480.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122480"
}
```



---

archive/issue_events_122481.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122481"
}
```



---

archive/issue_events_122482.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122482"
}
```



---

archive/issue_events_122483.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122483"
}
```



---

archive/issue_events_122484.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122484"
}
```



---

archive/issue_events_122485.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122485"
}
```



---

archive/issue_events_122486.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122486"
}
```



---

archive/issue_events_122487.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122487"
}
```



---

archive/issue_events_122488.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:28:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10229",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10229#event-122488"
}
```
