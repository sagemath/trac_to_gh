# Issue 10928: Test that getitem of numpy matrix using Sage integers works

archive/issues_010850.json:
```json
{
    "body": "In older versions of Sage, extracting a one-column submatrix\nof a NumPy matrix could return it as a one-row matrix if using\na Sage integer for the column number:\n\n```\nsage: m = numpy.matrix(numpy.arange(6).reshape(3, 2))\nsage: m[:, int(0)]  # correct submatrix extraction\nmatrix([[0],\n        [2],\n        [4]])\nsage: m[:, Integer(0)]  # incorrect submatrix extraction\nmatrix([[0, 2, 4]])\n```\n\nCurrent versions of NumPy no longer have this problem.\n\nThis ticket adds a doctest to ensure correct submatrix\nextraction keeps working.\n\nAssignee: tbd\n\nCC:  @jasongrout @mkoeppe @slel\n\nKeywords: numpy\n\nBranch/Commit: 290ab73e00f86d872d79d63b753569cefdf1db00\n\nUpstream: Fixed upstream, in a later stable release.\n\nReviewer: Vincent Delecroix\n\nAuthor: Samuel Leli\u00e8vre\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/10928\n\n",
    "closed_at": "2021-05-27T20:30:45Z",
    "created_at": "2011-03-14T01:32:59Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Test that getitem of numpy matrix using Sage integers works",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10928",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```
In older versions of Sage, extracting a one-column submatrix
of a NumPy matrix could return it as a one-row matrix if using
a Sage integer for the column number:

```
sage: m = numpy.matrix(numpy.arange(6).reshape(3, 2))
sage: m[:, int(0)]  # correct submatrix extraction
matrix([[0],
        [2],
        [4]])
sage: m[:, Integer(0)]  # incorrect submatrix extraction
matrix([[0, 2, 4]])
```

Current versions of NumPy no longer have this problem.

This ticket adds a doctest to ensure correct submatrix
extraction keeps working.

Assignee: tbd

CC:  @jasongrout @mkoeppe @slel

Keywords: numpy

Branch/Commit: 290ab73e00f86d872d79d63b753569cefdf1db00

Upstream: Fixed upstream, in a later stable release.

Reviewer: Vincent Delecroix

Author: Samuel Lelièvre

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/10928





---

archive/issue_comments_145364.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt's not a Sage-specific issue.  E.g. using gmpy's mpz has the same issue:\n\n```\nPython 2.7 (r27:82500, Aug 18 2010, 23:33:57) \n[GCC 4.2.1 (Apple Inc. build 5664)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> \n>>> import numpy, gmpy\n>>> \n>>> m = numpy.matrix(numpy.arange(6)).reshape(3,2)\n>>> m\nmatrix([[0, 1],\n        [2, 3],\n        [4, 5]])\n>>> m[:,0]\nmatrix([[0],\n        [2],\n        [4]])\n>>> m[:,gmpy.mpz(0)]\nmatrix([[0, 2, 4]])\n```\n\nThe underlying issue is that numpy doesn't recognize Sage integers as scalars:\n\n```\nsage: numpy.isscalar(int(0))\nTrue\nsage: numpy.isscalar((0))\nFalse\nsage: numpy.ScalarType\n(<type 'int'>, <type 'float'>, <type 'complex'>, <type 'long'>, <type 'bool'>, <type 'str'>, <type 'unicode'>, <type 'buffer'>, <type 'numpy.int64'>, <type 'numpy.int16'>, <type 'numpy.complex128'>, <type 'numpy.void'>, <type 'numpy.int32'>, <type 'numpy.uint32'>, <type 'numpy.float128'>, <type 'numpy.string_'>, <type 'numpy.int8'>, <type 'numpy.uint8'>, <type 'numpy.float32'>, <type 'numpy.bool_'>, <type 'numpy.uint64'>, <type 'numpy.int64'>, <type 'numpy.uint64'>, <type 'numpy.complex64'>, <type 'numpy.unicode_'>, <type 'numpy.uint16'>, <type 'numpy.float64'>, <type 'numpy.object_'>, <type 'numpy.complex256'>)\n```\n\nbecause it doesn't recognize it as a generic and it's not listed in the acceptable scalar types.  This means the wrong branch is taken here:\n\n```\n# numpy/matrixlib/defmatrix.py\n        if out.ndim == 1:\n            sh = out.shape[0]\n            # Determine when we should have a column array\n            try:\n                n = len(index)\n            except:\n                n = 0\n            if n > 1 and isscalar(index[1]):\n                out.shape = (sh,1)\n            else:\n                out.shape = (1,sh)\n```\n\nn=2, but isscalar(Integer(0)) is False.",
    "created_at": "2011-03-14T04:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145364",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:1'></a>
It's not a Sage-specific issue.  E.g. using gmpy's mpz has the same issue:

```
Python 2.7 (r27:82500, Aug 18 2010, 23:33:57) 
[GCC 4.2.1 (Apple Inc. build 5664)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> 
>>> import numpy, gmpy
>>> 
>>> m = numpy.matrix(numpy.arange(6)).reshape(3,2)
>>> m
matrix([[0, 1],
        [2, 3],
        [4, 5]])
>>> m[:,0]
matrix([[0],
        [2],
        [4]])
>>> m[:,gmpy.mpz(0)]
matrix([[0, 2, 4]])
```

The underlying issue is that numpy doesn't recognize Sage integers as scalars:

```
sage: numpy.isscalar(int(0))
True
sage: numpy.isscalar((0))
False
sage: numpy.ScalarType
(<type 'int'>, <type 'float'>, <type 'complex'>, <type 'long'>, <type 'bool'>, <type 'str'>, <type 'unicode'>, <type 'buffer'>, <type 'numpy.int64'>, <type 'numpy.int16'>, <type 'numpy.complex128'>, <type 'numpy.void'>, <type 'numpy.int32'>, <type 'numpy.uint32'>, <type 'numpy.float128'>, <type 'numpy.string_'>, <type 'numpy.int8'>, <type 'numpy.uint8'>, <type 'numpy.float32'>, <type 'numpy.bool_'>, <type 'numpy.uint64'>, <type 'numpy.int64'>, <type 'numpy.uint64'>, <type 'numpy.complex64'>, <type 'numpy.unicode_'>, <type 'numpy.uint16'>, <type 'numpy.float64'>, <type 'numpy.object_'>, <type 'numpy.complex256'>)
```

because it doesn't recognize it as a generic and it's not listed in the acceptable scalar types.  This means the wrong branch is taken here:

```
# numpy/matrixlib/defmatrix.py
        if out.ndim == 1:
            sh = out.shape[0]
            # Determine when we should have a column array
            try:
                n = len(index)
            except:
                n = 0
            if n > 1 and isscalar(index[1]):
                out.shape = (sh,1)
            else:
                out.shape = (1,sh)
```

n=2, but isscalar(Integer(0)) is False.



---

archive/issue_comments_145365.json:
```json
{
    "body": "<a id='comment:3'></a>\npossibly (but maybe marginally) related ticket: #6506",
    "created_at": "2011-03-14T13:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145365",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
possibly (but maybe marginally) related ticket: #6506



---

archive/issue_comments_145366.json:
```json
{
    "body": "<a id='comment:4'></a>\nNumpy comparing to a set list of types also makes this inconsistency with a standard python type:\n\n```\nsage: import fractions\nsage: a=fractions.Fraction(2,1)\nsage: a\nFraction(2, 1)\nsage: a==int(2)\nTrue\nsage: np.isscalar(a)\nFalse\n```",
    "created_at": "2011-03-14T13:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145366",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
Numpy comparing to a set list of types also makes this inconsistency with a standard python type:

```
sage: import fractions
sage: a=fractions.Fraction(2,1)
sage: a
Fraction(2, 1)
sage: a==int(2)
True
sage: np.isscalar(a)
False
```



---

archive/issue_comments_145367.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Not yet reported upstream; Will do shortly.\"",
    "created_at": "2011-03-14T13:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145367",
    "user": "https://github.com/jasongrout"
}
```

Changing upstream from "N/A" to "Not yet reported upstream; Will do shortly."



---

archive/issue_comments_145368.json:
```json
{
    "body": "<a id='comment:5'></a>\nSomebody ought to probably post to the numpy mailing list...",
    "created_at": "2011-03-14T13:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145368",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
Somebody ought to probably post to the numpy mailing list...



---

archive/issue_comments_145369.json:
```json
{
    "body": "Changing upstream from \"Not yet reported upstream; Will do shortly.\" to \"Reported upstream. Little or no feedback.\"",
    "created_at": "2011-03-15T00:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145369",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

Changing upstream from "Not yet reported upstream; Will do shortly." to "Reported upstream. Little or no feedback."



---

archive/issue_comments_145370.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jason](#comment%3A5):\n> Somebody ought to probably post to the numpy mailing list...\n\n\nDone.",
    "created_at": "2011-03-15T00:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145370",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:6'></a>
Replying to [jason](#comment%3A5):
> Somebody ought to probably post to the numpy mailing list...


Done.



---

archive/issue_comments_145371.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe thread link is here: http://article.gmane.org/gmane.comp.python.numeric.general/42994\n\nHowever, there didn't seem to be replies.  We should probably re-raise the subject (or submit a pull request with a fix)...",
    "created_at": "2011-05-14T15:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145371",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:7'></a>
The thread link is here: http://article.gmane.org/gmane.comp.python.numeric.general/42994

However, there didn't seem to be replies.  We should probably re-raise the subject (or submit a pull request with a fix)...



---

archive/issue_comments_145372.json:
```json
{
    "body": "<a id='comment:8'></a>\nHere is a relevant thread from a while ago about the same sorts of issues: http://comments.gmane.org/gmane.comp.python.scientific.devel/13936",
    "created_at": "2011-05-14T15:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145372",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:8'></a>
Here is a relevant thread from a while ago about the same sorts of issues: http://comments.gmane.org/gmane.comp.python.scientific.devel/13936



---

archive/issue_comments_145373.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. Little or no feedback.\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2012-06-01T17:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145373",
    "user": "https://github.com/roed314"
}
```

Changing upstream from "Reported upstream. Little or no feedback." to "Reported upstream. No feedback yet."



---

archive/issue_events_033745.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33745"
}
```



---

archive/issue_events_033746.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33746"
}
```



---

archive/issue_events_033747.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33747"
}
```



---

archive/issue_events_033748.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33748"
}
```



---

archive/issue_events_033749.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33749"
}
```



---

archive/issue_events_033750.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33750"
}
```



---

archive/issue_events_033751.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33751"
}
```



---

archive/issue_comments_145374.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [jason](#comment%3A4):\n> Numpy comparing to a set list of types also makes this inconsistency with a standard python type:\n> \n\nNow even `Fraction` does not take `Integer`s anymore:\n\n```\nsage: a=fractions.Fraction(2,1)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-17-a64d83a7a828> in <module>()\n----> 1 a=fractions.Fraction(Integer(2),Integer(1))\n\n/home/ralf/sage/local/lib/python/fractions.pyc in __new__(cls, numerator, denominator)\n    156                 )\n    157         else:\n--> 158             raise TypeError(\"both arguments should be \"\n    159                             \"Rational instances\")\n    160 \n\nTypeError: both arguments should be Rational instances\n```",
    "created_at": "2014-08-11T06:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145374",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
Replying to [jason](#comment%3A4):
> Numpy comparing to a set list of types also makes this inconsistency with a standard python type:
> 

Now even `Fraction` does not take `Integer`s anymore:

```
sage: a=fractions.Fraction(2,1)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-17-a64d83a7a828> in <module>()
----> 1 a=fractions.Fraction(Integer(2),Integer(1))

/home/ralf/sage/local/lib/python/fractions.pyc in __new__(cls, numerator, denominator)
    156                 )
    157         else:
--> 158             raise TypeError("both arguments should be "
    159                             "Rational instances")
    160 

TypeError: both arguments should be Rational instances
```



---

archive/issue_events_033752.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-08T21:04:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33752"
}
```



---

archive/issue_events_033753.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-08T21:04:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33753"
}
```



---

archive/issue_comments_145375.json:
```json
{
    "body": "Changing keywords from \"\" to \"numpy\".",
    "created_at": "2020-10-08T21:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145375",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "numpy".



---

archive/issue_comments_145376.json:
```json
{
    "body": "<a id='comment:16'></a>\nDemoted from 'critical' to 'major': fixed already in Sage 8.2, maybe before.\n\nDoctest needed. Tentative doctest:\n\n```\nsage: import numpy as np\nsage: m = np.matrix(np.arange(4).reshape(2, 2))\nsage: a = m[:, int(0)]\nsage: b = m[:, Integer(0)]\nsage: print('{}\\n{}\\n{}'.format(m, a, b))\n[[0 1]\n [2 3]]\n[[0]\n [2]]\n[[0]\n [2]]\n```\n\nWhere could such a doctest go?\n\nRelated:\n\n- #29728: improve compatibility with the Python library",
    "created_at": "2020-10-08T21:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145376",
    "user": "https://github.com/slel"
}
```

<a id='comment:16'></a>
Demoted from 'critical' to 'major': fixed already in Sage 8.2, maybe before.

Doctest needed. Tentative doctest:

```
sage: import numpy as np
sage: m = np.matrix(np.arange(4).reshape(2, 2))
sage: a = m[:, int(0)]
sage: b = m[:, Integer(0)]
sage: print('{}\n{}\n{}'.format(m, a, b))
[[0 1]
 [2 3]]
[[0]
 [2]]
[[0]
 [2]]
```

Where could such a doctest go?

Related:

- #29728: improve compatibility with the Python library



---

archive/issue_comments_145377.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, in a later stable release.\"",
    "created_at": "2020-10-08T21:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145377",
    "user": "https://github.com/slel"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Fixed upstream, in a later stable release."



---

archive/issue_comments_145378.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [rws](#comment%3A14):\n> Now even `Fraction` does not take `Integer`s anymore:\n\n\nDedicated ticket for that issue:\n\n- #28234: Sage Integers are incompatible with Python Fractions",
    "created_at": "2021-03-25T00:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145378",
    "user": "https://github.com/slel"
}
```

<a id='comment:17'></a>
Replying to [rws](#comment%3A14):
> Now even `Fraction` does not take `Integer`s anymore:


Dedicated ticket for that issue:

- #28234: Sage Integers are incompatible with Python Fractions



---

archive/issue_comments_145379.json:
```json
{
    "body": "<a id='comment:18'></a>\nIs there a file dedicated to testing Sage's compatibility\nwith the Python ecosystem?\n\nIf not, should we create one?",
    "created_at": "2021-03-25T00:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145379",
    "user": "https://github.com/slel"
}
```

<a id='comment:18'></a>
Is there a file dedicated to testing Sage's compatibility
with the Python ecosystem?

If not, should we create one?



---

archive/issue_events_033754.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "rename": {
        "from": "numpy matrices indexed by sage integers are wrong",
        "to": "Test that getitem of numpy matrix using Sage integers works"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33754"
}
```



---

archive/issue_comments_145380.json:
```json
{
    "body": "<a id='comment:19'></a>\nOr should this go somewhere in `src/sage/matrix`?",
    "created_at": "2021-03-25T00:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145380",
    "user": "https://github.com/slel"
}
```

<a id='comment:19'></a>
Or should this go somewhere in `src/sage/matrix`?



---

archive/issue_comments_145381.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [slelievre](#comment%3A18):\n> Is there a file dedicated to testing Sage's compatibility\n> with the Python ecosystem?\n> \n> If not, should we create one?\n\n\nI would think that the best place for this would be `src/sage/tests`, which already has files such as `sympy.py` and `parigp.py`. \n\nSo a new file `numpy.py` would make sense.",
    "created_at": "2021-03-26T16:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145381",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Replying to [slelievre](#comment%3A18):
> Is there a file dedicated to testing Sage's compatibility
> with the Python ecosystem?
> 
> If not, should we create one?


I would think that the best place for this would be `src/sage/tests`, which already has files such as `sympy.py` and `parigp.py`. 

So a new file `numpy.py` would make sense.



---

archive/issue_comments_145382.json:
```json
{
    "body": "<a id='comment:21'></a>\nHere is a branch. Ready for review.\n\n---\nNew commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[290ab73](https://github.com/sagemath/sagetrac-mirror/commit/290ab73e00f86d872d79d63b753569cefdf1db00)|`10928: Test NumPy matrix getitem with Sage integers`|",
    "created_at": "2021-03-26T20:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145382",
    "user": "https://github.com/slel"
}
```

<a id='comment:21'></a>
Here is a branch. Ready for review.

---
New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[290ab73](https://github.com/sagemath/sagetrac-mirror/commit/290ab73e00f86d872d79d63b753569cefdf1db00)|`10928: Test NumPy matrix getitem with Sage integers`|



---

archive/issue_comments_145383.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,18 @@\n-When using numpy matrices, indexing behaves differently depending on whether sage integers or python integers are used to do the indexing\n+In older versions of Sage, extracting a one-column submatrix\n+of a NumPy matrix could return it as a one-row matrix if using\n+a Sage integer for the column number:\n \n ```\n-sage: mymat = numpy.matrix(numpy.arange(6).reshape(3,2))\n-sage: mymat[:,0]\n-matrix([[0, 2, 4]])\n-sage: mymat[:,int(0)]\n+sage: m = numpy.matrix(numpy.arange(6).reshape(3, 2))\n+sage: m[:, int(0)]  # correct submatrix extraction\n matrix([[0],\n         [2],\n         [4]])\n+sage: m[:, Integer(0)]  # incorrect submatrix extraction\n+matrix([[0, 2, 4]])\n ```\n \n-The second behaviour is correct, i.e. int(0) gives the correct answer.\n+Current versions of NumPy no longer have this problem.\n+\n+This ticket adds a doctest to ensure correct submatrix\n+extraction keeps working.\n``````\n",
    "created_at": "2021-03-26T20:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145383",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,18 @@
-When using numpy matrices, indexing behaves differently depending on whether sage integers or python integers are used to do the indexing
+In older versions of Sage, extracting a one-column submatrix
+of a NumPy matrix could return it as a one-row matrix if using
+a Sage integer for the column number:
 
 ```
-sage: mymat = numpy.matrix(numpy.arange(6).reshape(3,2))
-sage: mymat[:,0]
-matrix([[0, 2, 4]])
-sage: mymat[:,int(0)]
+sage: m = numpy.matrix(numpy.arange(6).reshape(3, 2))
+sage: m[:, int(0)]  # correct submatrix extraction
 matrix([[0],
         [2],
         [4]])
+sage: m[:, Integer(0)]  # incorrect submatrix extraction
+matrix([[0, 2, 4]])
 ```
 
-The second behaviour is correct, i.e. int(0) gives the correct answer.
+Current versions of NumPy no longer have this problem.
+
+This ticket adds a doctest to ensure correct submatrix
+extraction keeps working.
``````




---

archive/issue_comments_145384.json:
```json
{
    "body": "Changing commit from \"\" to \"290ab73e00f86d872d79d63b753569cefdf1db00\"",
    "created_at": "2021-03-26T20:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145384",
    "user": "https://github.com/slel"
}
```

Changing commit from "" to "290ab73e00f86d872d79d63b753569cefdf1db00"



---

archive/issue_comments_145385.json:
```json
{
    "body": "Changing branch from \"\" to \"u/slelievre/10928\"",
    "created_at": "2021-03-26T20:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145385",
    "user": "https://github.com/slel"
}
```

Changing branch from "" to "u/slelievre/10928"



---

archive/issue_comments_145386.json:
```json
{
    "body": "Changing author from \"\" to \"Samuel Leli\u00e8vre\"",
    "created_at": "2021-03-26T20:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145386",
    "user": "https://github.com/slel"
}
```

Changing author from "" to "Samuel Lelièvre"



---

archive/issue_comments_145387.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-26T21:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145387",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_033755.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33755"
}
```



---

archive/issue_events_033756.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33756"
}
```



---

archive/issue_comments_145388.json:
```json
{
    "body": "<a id='comment:23'></a>\nMoving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145388",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_145389.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-08T15:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145389",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_145390.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2021-04-08T15:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145390",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_145391.json:
```json
{
    "body": "<a id='comment:25'></a>\nMerci!",
    "created_at": "2021-04-08T15:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145391",
    "user": "https://github.com/slel"
}
```

<a id='comment:25'></a>
Merci!



---

archive/issue_comments_145392.json:
```json
{
    "body": "Changing branch from \"u/slelievre/10928\" to \"290ab73e00f86d872d79d63b753569cefdf1db00\"",
    "created_at": "2021-05-27T20:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145392",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/slelievre/10928" to "290ab73e00f86d872d79d63b753569cefdf1db00"



---

archive/issue_events_033757.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:30:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10928#event-33757"
}
```



---

archive/issue_comments_145393.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10928#issuecomment-145393",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
