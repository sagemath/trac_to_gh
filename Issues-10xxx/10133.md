# Issue 10133: Make sin(0), log(1) and similar expressions return Sage integers, not Python ints

archive/issues_010132.json:
```json
{
    "body": "From [this thread](http://groups.google.com/group/sage-devel/browse_thread/thread/cceabb7271022b1c/944c94af910269a0):\n\n```\n> > sage: type(log(1))\n> > <type 'int'>\n> > sage: log(1).n()\n> > ---------------------------------------------------------------------------\n> > AttributeError: 'int' object has no attribute 'n'\n> > sage: Integer(log(1)).n()\n> > 0.000000000000000\n> > sage: a = Integer(1)\n> > sage: a.log()\n> > 0\n> > sage: type(a.log())\n> > <type 'int'>\n> > sage: from sage.functions.log import function_log\n> > sage: function_log(Integer(1))\n> > 0\n> > sage: type(function_log(Integer(1)))\n> > <type 'int'>\n> \n> > Is there any way to get around this in the code, or are we pretty much\n> > stuck with this because of how GinacFunctions work? \u00a0I'm not 100% sure\n> > this is a bug in log; maybe instead we should extend int so that\n> \n> This is a bug in the log() function, and any other function which\n> returns exact values like 0 or 1. We already work around most cases,\n> see lines 720-722 and 736-761 of sage/symbolic/function.pyx.\n> \n> The correct fix is to change the corresponding pynac functions to\n> coerce the exact value to the parent of the argument before returning\n> it. For example, all the lines \"return _ex1;\" or \"return _ex0;\" in\n> \n> http://pynac.sagemath.org/hg/file/b233d9dadcfa/ginac/inifcns_trans.cpp\n> \n> has to be changed this way.\n> \n\nYup, I see what you are talking about - e.g. \n\nif (x.is_equal(_ex1))  // log(1) -> 0\n     return _ex0;\n\nAlthough it might be nice to stay relatively close to Ginac and fix such things on the Sage level if that's not really bad.\n```\nThis ticket's goal is to implement one of these solutions (that is, catch this in function.pyx or in Pynac).\n\nWe might as well also deal with `sin(0), tan(0), sin(pi)` from #10972 here as well, otherwise that really wasn't a duplicate.\n\nAssignee: @burcin\n\nCC:  @eviatarbach\n\nKeywords: type coercion symbolic\n\nReviewer: Ralf Stephan\n\nAuthor: Jeroen Demeyer\n\nBranch: c8c26e1ca6195841b5bd1bb900a33eef3bb30b60\n\nDependencies: #17130\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/10133\n\n",
    "closed_at": "2014-12-12T12:29:54Z",
    "created_at": "2010-10-15T19:19:44Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Make sin(0), log(1) and similar expressions return Sage integers, not Python ints",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10133",
    "user": "https://github.com/kcrisman"
}
```
From [this thread](http://groups.google.com/group/sage-devel/browse_thread/thread/cceabb7271022b1c/944c94af910269a0):

```
> > sage: type(log(1))
> > <type 'int'>
> > sage: log(1).n()
> > ---------------------------------------------------------------------------
> > AttributeError: 'int' object has no attribute 'n'
> > sage: Integer(log(1)).n()
> > 0.000000000000000
> > sage: a = Integer(1)
> > sage: a.log()
> > 0
> > sage: type(a.log())
> > <type 'int'>
> > sage: from sage.functions.log import function_log
> > sage: function_log(Integer(1))
> > 0
> > sage: type(function_log(Integer(1)))
> > <type 'int'>
> 
> > Is there any way to get around this in the code, or are we pretty much
> > stuck with this because of how GinacFunctions work?  I'm not 100% sure
> > this is a bug in log; maybe instead we should extend int so that
> 
> This is a bug in the log() function, and any other function which
> returns exact values like 0 or 1. We already work around most cases,
> see lines 720-722 and 736-761 of sage/symbolic/function.pyx.
> 
> The correct fix is to change the corresponding pynac functions to
> coerce the exact value to the parent of the argument before returning
> it. For example, all the lines "return _ex1;" or "return _ex0;" in
> 
> http://pynac.sagemath.org/hg/file/b233d9dadcfa/ginac/inifcns_trans.cpp
> 
> has to be changed this way.
> 

Yup, I see what you are talking about - e.g. 

if (x.is_equal(_ex1))  // log(1) -> 0
     return _ex0;

Although it might be nice to stay relatively close to Ginac and fix such things on the Sage level if that's not really bad.
```
This ticket's goal is to implement one of these solutions (that is, catch this in function.pyx or in Pynac).

We might as well also deal with `sin(0), tan(0), sin(pi)` from #10972 here as well, otherwise that really wasn't a duplicate.

Assignee: @burcin

CC:  @eviatarbach

Keywords: type coercion symbolic

Reviewer: Ralf Stephan

Author: Jeroen Demeyer

Branch: c8c26e1ca6195841b5bd1bb900a33eef3bb30b60

Dependencies: #17130

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/10133





---

archive/issue_comments_107094.json:
```json
{
    "body": "<a id='comment:1'></a>#10972 was closed as a duplicate. Ironic that I reported both, though in my defense, that ticket does list a few specific functions beyond log for which that happens, and it was 8 months ago :)",
    "created_at": "2011-06-01T03:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107094",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>#10972 was closed as a duplicate. Ironic that I reported both, though in my defense, that ticket does list a few specific functions beyond log for which that happens, and it was 8 months ago :)



---

archive/issue_comments_107095.json:
```json
{
    "body": "<a id='comment:2'></a>ping.  I just noticed this in a different context.",
    "created_at": "2012-02-13T07:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107095",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:2'></a>ping.  I just noticed this in a different context.



---

archive/issue_comments_107096.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -45,6 +45,8 @@\n ```\n This ticket's goal is to implement one of these solutions (that is, catch this in function.pyx or in Pynac).\n \n+We might as well also deal with `sin(0), tan(0), sin(pi)` from #10972 here as well, otherwise that really wasn't a duplicate.\n+\n Comment: 1\n \n Summary: Make sure log(1) returns an Integer, not an int\n```\n",
    "created_at": "2012-02-13T18:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107096",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
```diff
--- 
+++ 
@@ -45,6 +45,8 @@
 ```
 This ticket's goal is to implement one of these solutions (that is, catch this in function.pyx or in Pynac).
 
+We might as well also deal with `sin(0), tan(0), sin(pi)` from #10972 here as well, otherwise that really wasn't a duplicate.
+
 Comment: 1
 
 Summary: Make sure log(1) returns an Integer, not an int
```




---

archive/issue_comments_107097.json:
```json
{
    "body": "<a id='comment:4'></a>See also [this sage-devel thread](https://groups.google.com/forum/#!msg/sage-devel/lVCZTy0DljY/aGmQ1csQr4kJ).",
    "created_at": "2012-10-21T01:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107097",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>See also [this sage-devel thread](https://groups.google.com/forum/#!msg/sage-devel/lVCZTy0DljY/aGmQ1csQr4kJ).



---

archive/issue_comments_107098.json:
```json
{
    "body": "<a id='comment:5'></a>See also [this sage-devel thread](https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/apTU2ZdBZVw), where it seems that the consensus is that such things should give Sage `Integer`s, though at #10972 Burcin seems to suggest that symbolic expressions are appropriate.",
    "created_at": "2012-10-31T12:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107098",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>See also [this sage-devel thread](https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/apTU2ZdBZVw), where it seems that the consensus is that such things should give Sage `Integer`s, though at #10972 Burcin seems to suggest that symbolic expressions are appropriate.



---

archive/issue_comments_107099.json:
```json
{
    "body": "Changing keywords from \"\" to \"type coercion symbolic\".",
    "created_at": "2012-10-31T12:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107099",
    "user": "https://github.com/kcrisman"
}
```

Changing keywords from "" to "type coercion symbolic".



---

archive/issue_events_025874.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10133#event-25874"
}
```



---

archive/issue_events_025875.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10133#event-25875"
}
```



---

archive/issue_events_025876.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10133#event-25876"
}
```



---

archive/issue_events_025877.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10133#event-25877"
}
```



---

archive/issue_events_025878.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10133#event-25878"
}
```



---

archive/issue_events_025879.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10133#event-25879"
}
```



---

archive/issue_events_025880.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10133#event-25880"
}
```



---

archive/issue_comments_107100.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-26T17:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107100",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_107101.json:
```json
{
    "body": "<a id='comment:13'></a>New commits:",
    "created_at": "2014-11-26T17:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107101",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>New commits:



---

archive/issue_comments_107102.json:
```json
{
    "body": "<a id='comment:15'></a>Looks good and passes `make ptestlong`.",
    "created_at": "2014-12-05T16:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107102",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'></a>Looks good and passes `make ptestlong`.



---

archive/issue_comments_107103.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-05T16:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107103",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_025881.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-12T12:29:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10133#event-25881"
}
```



---

archive/issue_comments_107104.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-12-12T12:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107104",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_107105.json:
```json
{
    "body": "<a id='comment:17'></a>Actually this should have been fixed in Pynac. Now, accidentally the recent patches dealing with https://github.com/pynac/pynac/issues/7 automatically produce this behaviour. Which will be Pynac-0.4.4. The wrapper from this ticket should then be removed.",
    "created_at": "2015-08-29T14:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107105",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'></a>Actually this should have been fixed in Pynac. Now, accidentally the recent patches dealing with https://github.com/pynac/pynac/issues/7 automatically produce this behaviour. Which will be Pynac-0.4.4. The wrapper from this ticket should then be removed.



---

archive/issue_comments_107106.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,51 @@\n+From [this thread](http://groups.google.com/group/sage-devel/browse_thread/thread/cceabb7271022b1c/944c94af910269a0):\n \n+```\n+> > sage: type(log(1))\n+> > <type 'int'>\n+> > sage: log(1).n()\n+> > ---------------------------------------------------------------------------\n+> > AttributeError: 'int' object has no attribute 'n'\n+> > sage: Integer(log(1)).n()\n+> > 0.000000000000000\n+> > sage: a = Integer(1)\n+> > sage: a.log()\n+> > 0\n+> > sage: type(a.log())\n+> > <type 'int'>\n+> > sage: from sage.functions.log import function_log\n+> > sage: function_log(Integer(1))\n+> > 0\n+> > sage: type(function_log(Integer(1)))\n+> > <type 'int'>\n+> \n+> > Is there any way to get around this in the code, or are we pretty much\n+> > stuck with this because of how GinacFunctions work? \u00a0I'm not 100% sure\n+> > this is a bug in log; maybe instead we should extend int so that\n+> \n+> This is a bug in the log() function, and any other function which\n+> returns exact values like 0 or 1. We already work around most cases,\n+> see lines 720-722 and 736-761 of sage/symbolic/function.pyx.\n+> \n+> The correct fix is to change the corresponding pynac functions to\n+> coerce the exact value to the parent of the argument before returning\n+> it. For example, all the lines \"return _ex1;\" or \"return _ex0;\" in\n+> \n+> http://pynac.sagemath.org/hg/file/b233d9dadcfa/ginac/inifcns_trans.cpp\n+> \n+> has to be changed this way.\n+> \n+\n+Yup, I see what you are talking about - e.g. \n+\n+if (x.is_equal(_ex1))  // log(1) -> 0\n+     return _ex0;\n+\n+Although it might be nice to stay relatively close to Ginac and fix such things on the Sage level if that's not really bad.\n+```\n+This ticket's goal is to implement one of these solutions (that is, catch this in function.pyx or in Pynac).\n+\n+We might as well also deal with `sin(0), tan(0), sin(pi)` from #10972 here as well, otherwise that really wasn't a duplicate.\n \n Comment: 1\n \n```\n",
    "created_at": "2015-09-06T15:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10133#issuecomment-107106",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,51 @@
+From [this thread](http://groups.google.com/group/sage-devel/browse_thread/thread/cceabb7271022b1c/944c94af910269a0):
 
+```
+> > sage: type(log(1))
+> > <type 'int'>
+> > sage: log(1).n()
+> > ---------------------------------------------------------------------------
+> > AttributeError: 'int' object has no attribute 'n'
+> > sage: Integer(log(1)).n()
+> > 0.000000000000000
+> > sage: a = Integer(1)
+> > sage: a.log()
+> > 0
+> > sage: type(a.log())
+> > <type 'int'>
+> > sage: from sage.functions.log import function_log
+> > sage: function_log(Integer(1))
+> > 0
+> > sage: type(function_log(Integer(1)))
+> > <type 'int'>
+> 
+> > Is there any way to get around this in the code, or are we pretty much
+> > stuck with this because of how GinacFunctions work?  I'm not 100% sure
+> > this is a bug in log; maybe instead we should extend int so that
+> 
+> This is a bug in the log() function, and any other function which
+> returns exact values like 0 or 1. We already work around most cases,
+> see lines 720-722 and 736-761 of sage/symbolic/function.pyx.
+> 
+> The correct fix is to change the corresponding pynac functions to
+> coerce the exact value to the parent of the argument before returning
+> it. For example, all the lines "return _ex1;" or "return _ex0;" in
+> 
+> http://pynac.sagemath.org/hg/file/b233d9dadcfa/ginac/inifcns_trans.cpp
+> 
+> has to be changed this way.
+> 
+
+Yup, I see what you are talking about - e.g. 
+
+if (x.is_equal(_ex1))  // log(1) -> 0
+     return _ex0;
+
+Although it might be nice to stay relatively close to Ginac and fix such things on the Sage level if that's not really bad.
+```
+This ticket's goal is to implement one of these solutions (that is, catch this in function.pyx or in Pynac).
+
+We might as well also deal with `sin(0), tan(0), sin(pi)` from #10972 here as well, otherwise that really wasn't a duplicate.
 
 Comment: 1
 
```

