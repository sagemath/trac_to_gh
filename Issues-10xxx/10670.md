# Issue 10670: Mobius matrices of posets are integer matrices

archive/issues_010617.json:
```json
{
    "body": "Assignee: @hivert\n\nCC:  @fchapoton sage-combinat\n\nKeywords: poset, matrix, Cernay2012\n\nI have noticed the following problem.\n\n```\nP=Posets.PentagonPoset()\nP.mobius_function_matrix().parent()\nFull MatrixSpace of 5 by 5 sparse matrices over Rational Field\n```\nThe Mobius function of a poset should really be an **integer matrix**. This can be achieved by using change_ring :\n\n```\nP.mobius_function_matrix().change_ring(ZZ).parent()\nFull MatrixSpace of 5 by 5 sparse matrices over Integer Ring\n```\n\nThe patch does this by default. It also adds optional arguments to choose sparse/dense and the base ring. Same thing for lequal_matrix.\nIt also makes sure those matrices are immutable, and improves a bit the redefinition of .mobius_function when the mobius function has been calculated.\n\n\nApply:\n\n* [attachment:trac_10670_integral_mobius_matrix_for_posets-fh.patch]\n\nIssue created by migration from https://trac.sagemath.org/ticket/10670\n\n",
    "closed_at": "2012-02-22T10:44:33Z",
    "created_at": "2011-01-21T11:17:12Z",
    "labels": [
        "component: combinatorics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Mobius matrices of posets are integer matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10670",
    "user": "https://github.com/fchapoton"
}
```
Assignee: @hivert

CC:  @fchapoton sage-combinat

Keywords: poset, matrix, Cernay2012

I have noticed the following problem.

```
P=Posets.PentagonPoset()
P.mobius_function_matrix().parent()
Full MatrixSpace of 5 by 5 sparse matrices over Rational Field
```
The Mobius function of a poset should really be an **integer matrix**. This can be achieved by using change_ring :

```
P.mobius_function_matrix().change_ring(ZZ).parent()
Full MatrixSpace of 5 by 5 sparse matrices over Integer Ring
```

The patch does this by default. It also adds optional arguments to choose sparse/dense and the base ring. Same thing for lequal_matrix.
It also makes sure those matrices are immutable, and improves a bit the redefinition of .mobius_function when the mobius function has been calculated.


Apply:

* [attachment:trac_10670_integral_mobius_matrix_for_posets-fh.patch]

Issue created by migration from https://trac.sagemath.org/ticket/10670





---

archive/issue_comments_111130.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-06-01T13:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111130",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_111131.json:
```json
{
    "body": "Hi Fr\u00e9d\u00e9ric,\n\nThanks for taking care of this problem.\n\nHere are a few remarks:\n\n- The field Author below is used to give credits after each release. You\n  should put your real name here and not your login.\n\n- If you think returning a matrix over `QQ` is a bug, then you should\n  make sure by a doctest that the bug is indeed fixed, indicating in comment\n  the ticket number for this bug.\n\n- I can easily imagine use cases where the Moebius function is needed over a\n  different ring (eg: Z2 or a polynomial field). What about having an\n  optional argument `ring` with a default value `ZZ` to avoid\n  changing the ring twice ? In this case for consistency,\n  `.mobius_function_matrix()` should also take this optional parameter too.\n  What do you think ?\n\nRight now, I'm having lunch, but I'll probably find the time to post a review\npatch this evening if you don't beat me. If you start working on it please put\na message here so that we avoid doing it twice. Of course I'll do the same. In\nany case one of us will have to do some review and the other to write some\ncode.\n\nFlorent",
    "created_at": "2011-06-02T10:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111131",
    "user": "https://github.com/hivert"
}
```

Hi Frédéric,

Thanks for taking care of this problem.

Here are a few remarks:

- The field Author below is used to give credits after each release. You
  should put your real name here and not your login.

- If you think returning a matrix over `QQ` is a bug, then you should
  make sure by a doctest that the bug is indeed fixed, indicating in comment
  the ticket number for this bug.

- I can easily imagine use cases where the Moebius function is needed over a
  different ring (eg: Z2 or a polynomial field). What about having an
  optional argument `ring` with a default value `ZZ` to avoid
  changing the ring twice ? In this case for consistency,
  `.mobius_function_matrix()` should also take this optional parameter too.
  What do you think ?

Right now, I'm having lunch, but I'll probably find the time to post a review
patch this evening if you don't beat me. If you start working on it please put
a message here so that we avoid doing it twice. Of course I'll do the same. In
any case one of us will have to do some review and the other to write some
code.

Florent



---

archive/issue_comments_111132.json:
```json
{
    "body": "Remove assignee sage-combinat.",
    "created_at": "2011-06-02T10:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111132",
    "user": "https://github.com/hivert"
}
```

Remove assignee sage-combinat.



---

archive/issue_comments_111133.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-02T13:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111133",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_111134.json:
```json
{
    "body": "> Right now, I'm having lunch, but I'll probably find the time to post a review\n> patch this evening if you don't beat me. If you start working on it please put\n> a message here so that we avoid doing it twice. Of course I'll do the same. In\n> any case one of us will have to do some review and the other to write some\n> code.\n\n\nI'm on It. Please don't touch anything !",
    "created_at": "2011-06-02T13:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111134",
    "user": "https://github.com/hivert"
}
```

> Right now, I'm having lunch, but I'll probably find the time to post a review
> patch this evening if you don't beat me. If you start working on it please put
> a message here so that we avoid doing it twice. Of course I'll do the same. In
> any case one of us will have to do some review and the other to write some
> code.


I'm on It. Please don't touch anything !



---

archive/issue_comments_111135.json:
```json
{
    "body": "I reworked the patch. Unfortunately on the way I got a dependency on #10998\n\nFlorent",
    "created_at": "2011-06-02T14:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111135",
    "user": "https://github.com/hivert"
}
```

I reworked the patch. Unfortunately on the way I got a dependency on #10998

Florent



---

archive/issue_comments_111136.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-02T14:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111136",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_111137.json:
```json
{
    "body": "Trying to help the build bot to do its job\n\nApply trac_10670_integral_mobius_matrix_for_posets-fh.patch",
    "created_at": "2011-06-10T07:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111137",
    "user": "https://github.com/fchapoton"
}
```

Trying to help the build bot to do its job

Apply trac_10670_integral_mobius_matrix_for_posets-fh.patch



---

archive/issue_comments_111138.json:
```json
{
    "body": "Set assignee to @hivert.",
    "created_at": "2011-12-03T14:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111138",
    "user": "https://github.com/hivert"
}
```

Set assignee to @hivert.



---

archive/issue_comments_111139.json:
```json
{
    "body": "Changing keywords from \"poset, matrix\" to \"poset, matrix, Cernay2012\".",
    "created_at": "2012-02-06T14:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111139",
    "user": "https://github.com/hivert"
}
```

Changing keywords from "poset, matrix" to "poset, matrix, Cernay2012".



---

archive/issue_comments_111140.json:
```json
{
    "body": "We finalized the patch together with Florent.\nPositive review on the version I just uploaded, assuming the test pass (I am running them).",
    "created_at": "2012-02-08T12:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111140",
    "user": "https://github.com/nthiery"
}
```

We finalized the patch together with Florent.
Positive review on the version I just uploaded, assuming the test pass (I am running them).



---

archive/issue_events_027475.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-02-09T00:34:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10670#event-27475"
}
```



---

archive/issue_comments_111141.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-09T00:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111141",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_111142.json:
```json
{
    "body": "Except for a timeout in sage/sandpiles/sandpile.py, all tests passed on sage-5.0.beta2 with the following patches applied::\n\n```\ntrac_11003-folded.patch\ntrac_10998-categories-posets-nt.patch\ntrac_10670_integral_mobius_matrix_for_posets-fh.patch\ntrac_11382-subposet_to_vertex_speedup-fh.patch\ntrac_12476-lattice_join_matrix_speedup-fh.patch\ntrac_11118-finite_enumset_list_cache-fh.patch\n```\n\nSetting a positive review. Thanks Fr\u00e9d\u00e9ric and Florent!",
    "created_at": "2012-02-09T00:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111142",
    "user": "https://github.com/nthiery"
}
```

Except for a timeout in sage/sandpiles/sandpile.py, all tests passed on sage-5.0.beta2 with the following patches applied::

```
trac_11003-folded.patch
trac_10998-categories-posets-nt.patch
trac_10670_integral_mobius_matrix_for_posets-fh.patch
trac_11382-subposet_to_vertex_speedup-fh.patch
trac_12476-lattice_join_matrix_speedup-fh.patch
trac_11118-finite_enumset_list_cache-fh.patch
```

Setting a positive review. Thanks Frédéric and Florent!



---

archive/issue_comments_111143.json:
```json
{
    "body": "Attachment [trac_10670_integral_mobius_matrix_for_posets-fh.patch](tarball://root/attachments/some-uuid/ticket10670/trac_10670_integral_mobius_matrix_for_posets-fh.patch) by @jdemeyer created at 2012-02-22 10:44:33",
    "created_at": "2012-02-22T10:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111143",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac_10670_integral_mobius_matrix_for_posets-fh.patch](tarball://root/attachments/some-uuid/ticket10670/trac_10670_integral_mobius_matrix_for_posets-fh.patch) by @jdemeyer created at 2012-02-22 10:44:33



---

archive/issue_comments_111144.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-22T10:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10670#issuecomment-111144",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_027476.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-22T10:44:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10670",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10670#event-27476"
}
```
