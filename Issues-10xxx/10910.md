# Issue 10910: Avoid nfinit while factoring polynomials

archive/issues_010837.json:
```json
{
    "body": "In previous versions of pari the options to factor a univariate polynomial over a number field were Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.\n\nHence Sage computed nfinit on the number field before factoring the polynomial via Pari.\n\nWith current pari version the whole nf structure is not needed. So, the factor routines should not call nfinit that can be a very expensive operation for large fields.\n\nThe patch modifies the factor method. If the nf structure is already computed we use it, as it will be faster. If the nf structure is not already computed then do not compute it to factor the polynomial.\n\nSee also #11890 for a slightly different solution to the same issue.\n\nAssignee: tbd\n\nKeywords: factorization, pari, nfinit, number field, sd32\n\nResolution: duplicate\n\nDependencies: #11130\n\nReviewer: Luis Felipe Tabera Alonso\n\nUpstream: Fixed upstream, in a later stable release.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10910\n\n",
    "closed_at": "2011-10-16T16:10:45Z",
    "created_at": "2011-03-10T17:28:27Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Avoid nfinit while factoring polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10910",
    "user": "https://github.com/lftabera"
}
```
In previous versions of pari the options to factor a univariate polynomial over a number field were Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.

Hence Sage computed nfinit on the number field before factoring the polynomial via Pari.

With current pari version the whole nf structure is not needed. So, the factor routines should not call nfinit that can be a very expensive operation for large fields.

The patch modifies the factor method. If the nf structure is already computed we use it, as it will be faster. If the nf structure is not already computed then do not compute it to factor the polynomial.

See also #11890 for a slightly different solution to the same issue.

Assignee: tbd

Keywords: factorization, pari, nfinit, number field, sd32

Resolution: duplicate

Dependencies: #11130

Reviewer: Luis Felipe Tabera Alonso

Upstream: Fixed upstream, in a later stable release.

Issue created by migration from https://trac.sagemath.org/ticket/10910





---

archive/issue_comments_120595.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-03-10T23:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120595",
    "user": "https://github.com/lftabera"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_120596.json:
```json
{
    "body": "<a id='comment:2'></a>The doctest failure is known bug that is corrected in #2329.\n\nDepends: #2329",
    "created_at": "2011-03-11T08:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120596",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:2'></a>The doctest failure is known bug that is corrected in #2329.

Depends: #2329



---

archive/issue_comments_120597.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,10 @@\n-In previous versions of pari the options to factor a univariate polynomial over a number field where Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.\n+In previous versions of pari the options to factor a univariate polynomial over a number field were Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.\n \n Hence Sage computed nfinit on the number field before factoring the polynomial via Pari.\n \n With current pari version the whole nf structure is not needed. So, the factor routines should not call nfinit that can be a very expensive operation for large fields.\n \n The patch modifies the factor method. If the nf structure is already computed we use it, as it will be faster. If the nf structure is not already computed then do not compute it to factor the polynomial.\n-\n-Keywords: factorization, pari, nfinit, number field\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-05-17T14:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120597",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,10 @@
-In previous versions of pari the options to factor a univariate polynomial over a number field where Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.
+In previous versions of pari the options to factor a univariate polynomial over a number field were Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.
 
 Hence Sage computed nfinit on the number field before factoring the polynomial via Pari.
 
 With current pari version the whole nf structure is not needed. So, the factor routines should not call nfinit that can be a very expensive operation for large fields.
 
 The patch modifies the factor method. If the nf structure is already computed we use it, as it will be faster. If the nf structure is not already computed then do not compute it to factor the polynomial.
-
-Keywords: factorization, pari, nfinit, number field
 
 Comment: 1
 
``````




---

archive/issue_comments_120598.json:
```json
{
    "body": "<a id='comment:3'></a>Minor edit of grammer.",
    "created_at": "2011-05-17T14:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120598",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:3'></a>Minor edit of grammer.



---

archive/issue_comments_120599.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-18T14:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120599",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120600.json:
```json
{
    "body": "<a id='comment:4'></a>The patch applied to sage-4.7.rc2 causes the following test to fail:\n\n```\n% ./sage -t  -long -force_lib \"devel/sage/sage/rings/polynomial/polynomial_element.pyx\"\nsage -t -long -force_lib \"devel/sage/sage/rings/polynomial/polynomial_element.pyx\"\n**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10910/devel/sage/sage/rings/polynomial/polynomial_element.pyx\", line 2704:\n    sage: hasattr(N, '_NumberField_generic__pari_nf')\nExpected:\n    False\nGot:\n    True\n**********************************************************************\n1 items had failures:\n   1 of 143 in __main__.example_51\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/mariah/.sage//tmp/.doctest_polynomial_element.py\n         [23.1 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t -long -force_lib \"devel/sage/sage/rings/polynomial/polynomial_element.pyx\"\nTotal time for all tests: 23.1 seconds\n```",
    "created_at": "2011-05-18T14:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120600",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:4'></a>The patch applied to sage-4.7.rc2 causes the following test to fail:

```
% ./sage -t  -long -force_lib "devel/sage/sage/rings/polynomial/polynomial_element.pyx"
sage -t -long -force_lib "devel/sage/sage/rings/polynomial/polynomial_element.pyx"
**********************************************************************
File "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10910/devel/sage/sage/rings/polynomial/polynomial_element.pyx", line 2704:
    sage: hasattr(N, '_NumberField_generic__pari_nf')
Expected:
    False
Got:
    True
**********************************************************************
1 items had failures:
   1 of 143 in __main__.example_51
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/mariah/.sage//tmp/.doctest_polynomial_element.py
         [23.1 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t -long -force_lib "devel/sage/sage/rings/polynomial/polynomial_element.pyx"
Total time for all tests: 23.1 seconds
```



---

archive/issue_comments_120601.json:
```json
{
    "body": "<a id='comment:5'></a>Just for the record, my patch introduces the following problem, so I need to add a doctest to it since it is an unapparent side effect.\n\n```\nsage: N = NumberField(x^3-2*x+3,'a')\nsage: f = N[x](x^2-41943301)\nsage: M = N.extension(f,'b')\nsage: M.hom([M.gen()])\n...\nValueError: no way to map base field to codomain.\n```",
    "created_at": "2011-06-07T08:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120601",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:5'></a>Just for the record, my patch introduces the following problem, so I need to add a doctest to it since it is an unapparent side effect.

```
sage: N = NumberField(x^3-2*x+3,'a')
sage: f = N[x](x^2-41943301)
sage: M = N.extension(f,'b')
sage: M.hom([M.gen()])
...
ValueError: no way to map base field to codomain.
```



---

archive/issue_comments_120602.json:
```json
{
    "body": "<a id='comment:6'></a>I have tracked the latest problem and it is in fact a bug in pari. See upstream report\n[#1207](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1207).\n\nI have corrected some errors in the code and added another doctest.\n\nI am unable to reproduce the doctest failing that Maria points out on sage-4.7\n\nNote: doctest with this patch will fail until the pari bug is solved.",
    "created_at": "2011-06-09T14:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120602",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:6'></a>I have tracked the latest problem and it is in fact a bug in pari. See upstream report
[#1207](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1207).

I have corrected some errors in the code and added another doctest.

I am unable to reproduce the doctest failing that Maria points out on sage-4.7

Note: doctest with this patch will fail until the pari bug is solved.



---

archive/issue_comments_120603.json:
```json
{
    "body": "<a id='comment:8'></a>The problem with pari is solved in the last stable release.\n\nThis ticket now depends on #11130 until pari is not updated the patch is not safe.",
    "created_at": "2011-07-21T15:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120603",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:8'></a>The problem with pari is solved in the last stable release.

This ticket now depends on #11130 until pari is not updated the patch is not safe.



---

archive/issue_comments_120604.json:
```json
{
    "body": "Attachment [factor_nfinit_free.patch](tarball://root/attachments/some-uuid/ticket10910/factor_nfinit_free.patch) by @lftabera created at 2011-08-24 17:02:58\n\nthe good one",
    "created_at": "2011-08-24T17:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120604",
    "user": "https://github.com/lftabera"
}
```

Attachment [factor_nfinit_free.patch](tarball://root/attachments/some-uuid/ticket10910/factor_nfinit_free.patch) by @lftabera created at 2011-08-24 17:02:58

the good one



---

archive/issue_comments_120605.json:
```json
{
    "body": "<a id='comment:9'></a>Rebase against 4.7.1",
    "created_at": "2011-08-24T17:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120605",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:9'></a>Rebase against 4.7.1



---

archive/issue_comments_120606.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-24T17:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120606",
    "user": "https://github.com/lftabera"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120607.json:
```json
{
    "body": "Changing keywords from \"factorization, pari, nfinit, number field\" to \"factorization, pari, nfinit, number field, sd32\".",
    "created_at": "2011-08-24T23:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120607",
    "user": "https://github.com/williamstein"
}
```

Changing keywords from "factorization, pari, nfinit, number field" to "factorization, pari, nfinit, number field, sd32".



---

archive/issue_comments_120608.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+In previous versions of pari the options to factor a univariate polynomial over a number field were Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.\n \n+Hence Sage computed nfinit on the number field before factoring the polynomial via Pari.\n+\n+With current pari version the whole nf structure is not needed. So, the factor routines should not call nfinit that can be a very expensive operation for large fields.\n+\n+The patch modifies the factor method. If the nf structure is already computed we use it, as it will be faster. If the nf structure is not already computed then do not compute it to factor the polynomial.\n+\n+See also #11890 for a slightly different solution to the same issue.\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-10-05T14:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120608",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+In previous versions of pari the options to factor a univariate polynomial over a number field were Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.
 
+Hence Sage computed nfinit on the number field before factoring the polynomial via Pari.
+
+With current pari version the whole nf structure is not needed. So, the factor routines should not call nfinit that can be a very expensive operation for large fields.
+
+The patch modifies the factor method. If the nf structure is already computed we use it, as it will be faster. If the nf structure is not already computed then do not compute it to factor the polynomial.
+
+See also #11890 for a slightly different solution to the same issue.
 
 Comment: 1
 
``````




---

archive/issue_comments_120609.json:
```json
{
    "body": "<a id='comment:12'></a>This ticked should be closed as a duplicate of #11890",
    "created_at": "2011-10-11T07:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120609",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:12'></a>This ticked should be closed as a duplicate of #11890



---

archive/issue_events_028270.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-11T07:56:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10910#event-28270"
}
```



---

archive/issue_comments_120610.json:
```json
{
    "body": "Changing component from factorization to number fields.",
    "created_at": "2011-10-11T07:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120610",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from factorization to number fields.



---

archive/issue_comments_120611.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-11T07:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120611",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120612.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2011-10-16T16:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10910#issuecomment-120612",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate



---

archive/issue_events_028271.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-16T16:10:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10910",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10910#event-28271"
}
```
