# Issue 10411: m-th power residue symbol

archive/issues_010411.json:
```json
{
    "body": "Assignee: @loefflerd\n\nCC:  @katestange\n\nKeywords: cubic residue\n\nimplement m-th power residue symbol (generalising Legendre/Kronecker symbol)\n\n---\n\nApply only [attachment:trac_10464_residue_symbol.4.patch] to the Sage library.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10464\n\n",
    "closed_at": "2011-09-17T04:35:09Z",
    "created_at": "2010-12-10T22:24:47Z",
    "labels": [
        "component: number fields",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "m-th power residue symbol",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10411",
    "user": "https://github.com/katestange"
}
```
Assignee: @loefflerd

CC:  @katestange

Keywords: cubic residue

implement m-th power residue symbol (generalising Legendre/Kronecker symbol)

---

Apply only [attachment:trac_10464_residue_symbol.4.patch] to the Sage library.


Issue created by migration from https://trac.sagemath.org/ticket/10464





---

archive/issue_comments_106971.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-12-11T03:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106971",
    "user": "https://github.com/katestange"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_106972.json:
```json
{
    "body": "Attachment [trac_10464_residue_symbol.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.patch) by @katestange created at 2010-12-11 03:05:13",
    "created_at": "2010-12-11T03:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106972",
    "user": "https://github.com/katestange"
}
```

Attachment [trac_10464_residue_symbol.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.patch) by @katestange created at 2010-12-11 03:05:13



---

archive/issue_comments_106973.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-12-16T13:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106973",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_106974.json:
```json
{
    "body": "I like the look of this, but the formatting of the docstrings isn't quite right -- the text `\"Quadratic Residue (7 is not a square modulo 11)\"` shouldn't be inside the code block. You should remove the double colon after `EXAMPLES`, unindent the description lines and put a double colon at the end of each one. Other than that very trivial fix this looks absolutely fine.",
    "created_at": "2010-12-16T13:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106974",
    "user": "https://github.com/loefflerd"
}
```

I like the look of this, but the formatting of the docstrings isn't quite right -- the text `"Quadratic Residue (7 is not a square modulo 11)"` shouldn't be inside the code block. You should remove the double colon after `EXAMPLES`, unindent the description lines and put a double colon at the end of each one. Other than that very trivial fix this looks absolutely fine.



---

archive/issue_comments_106975.json:
```json
{
    "body": "I think there are a couple of things which will make the ideal `residue_symbol` function a little faster:\n\n1. There should be no need to have the default `check=True` when recursively applying the function to the prime factors of the ideal since all the checks will have already been performed.\n2. The final loop can be avoided by calculating a discrete log in the residue field.\n\nThus I think the last few lines of the definition should read something like:\n\n```\n        if not self.is_prime():\n            return prod(Q.residue_symbol(e, m, check=False)**i for Q, i in self.factor())\n        k = self.residue_field()\n        r = k(e)**((k.order() - 1)/m)\n        resroot = primroot**(rootorder/m)\n        from sage.groups.generic import discrete_log\n        j = discrete_log(k(resroot), k(r), ord=m)\n        return resroot**j\n```\nOne other little thing.  I think it is safer to write `self.smallest_integer()` rather than `ZZ(self.gens()[0])`.",
    "created_at": "2010-12-16T22:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106975",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

I think there are a couple of things which will make the ideal `residue_symbol` function a little faster:

1. There should be no need to have the default `check=True` when recursively applying the function to the prime factors of the ideal since all the checks will have already been performed.
2. The final loop can be avoided by calculating a discrete log in the residue field.

Thus I think the last few lines of the definition should read something like:

```
        if not self.is_prime():
            return prod(Q.residue_symbol(e, m, check=False)**i for Q, i in self.factor())
        k = self.residue_field()
        r = k(e)**((k.order() - 1)/m)
        resroot = primroot**(rootorder/m)
        from sage.groups.generic import discrete_log
        j = discrete_log(k(resroot), k(r), ord=m)
        return resroot**j
```
One other little thing.  I think it is safer to write `self.smallest_integer()` rather than `ZZ(self.gens()[0])`.



---

archive/issue_comments_106976.json:
```json
{
    "body": "Attachment [trac_10464_residue_symbol.2.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.2.patch) by @katestange created at 2011-09-12 16:37:45\n\nThanks all for the comments and suggestions; they were very helpful.  I've uploaded a new version of the patch that has taken into account all of them.  (I couldn't figure out how to replace the file with one of the same name as suggested in the development walkthrough guide.)",
    "created_at": "2011-09-12T16:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106976",
    "user": "https://github.com/katestange"
}
```

Attachment [trac_10464_residue_symbol.2.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.2.patch) by @katestange created at 2011-09-12 16:37:45

Thanks all for the comments and suggestions; they were very helpful.  I've uploaded a new version of the patch that has taken into account all of them.  (I couldn't figure out how to replace the file with one of the same name as suggested in the development walkthrough guide.)



---

archive/issue_comments_106977.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-12T16:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106977",
    "user": "https://github.com/katestange"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_106978.json:
```json
{
    "body": "There is something messed up with this patch: each new method is defined twice over.",
    "created_at": "2011-09-12T18:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106978",
    "user": "https://github.com/loefflerd"
}
```

There is something messed up with this patch: each new method is defined twice over.



---

archive/issue_comments_106979.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-12T18:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106979",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_106980.json:
```json
{
    "body": "Attachment [trac_10464_residue_symbol.3.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.3.patch) by @katestange created at 2011-09-12 19:45:09",
    "created_at": "2011-09-12T19:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106980",
    "user": "https://github.com/katestange"
}
```

Attachment [trac_10464_residue_symbol.3.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.3.patch) by @katestange created at 2011-09-12 19:45:09



---

archive/issue_comments_106981.json:
```json
{
    "body": "Sorry!  I must have cloned the wrong branch at some point, but I should have noticed in the diff -- newbie mistake.  Anyway, it's now been fixed.  (I also see now how to replace the old patch, but at this point I think that would be more confusing, so this is labelled '3'.)",
    "created_at": "2011-09-12T19:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106981",
    "user": "https://github.com/katestange"
}
```

Sorry!  I must have cloned the wrong branch at some point, but I should have noticed in the diff -- newbie mistake.  Anyway, it's now been fixed.  (I also see now how to replace the old patch, but at this point I think that would be more confusing, so this is labelled '3'.)



---

archive/issue_comments_106982.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-12T19:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106982",
    "user": "https://github.com/katestange"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_106983.json:
```json
{
    "body": "It's all fine now.  I'd give it a positive review but for one thing.  The docstring for `sage.rings.number_field.number_field_element.NumberFieldElement.residue_symbol` says \n\n```\n        - ``P`` - proper ideal of the number field (or an extension) \n```\nI think that there needs to be a doctest illustrating the case where P is an ideal in an extension.",
    "created_at": "2011-09-12T21:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106983",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

It's all fine now.  I'd give it a positive review but for one thing.  The docstring for `sage.rings.number_field.number_field_element.NumberFieldElement.residue_symbol` says 

```
        - ``P`` - proper ideal of the number field (or an extension) 
```
I think that there needs to be a doctest illustrating the case where P is an ideal in an extension.



---

archive/issue_comments_106984.json:
```json
{
    "body": "Attachment [trac_10464_residue_symbol.4.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.4.patch) by @katestange created at 2011-09-13 00:49:46",
    "created_at": "2011-09-13T00:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106984",
    "user": "https://github.com/katestange"
}
```

Attachment [trac_10464_residue_symbol.4.patch](tarball://root/attachments/some-uuid/ticket10464/trac_10464_residue_symbol.4.patch) by @katestange created at 2011-09-13 00:49:46



---

archive/issue_comments_106985.json:
```json
{
    "body": "Thanks for pointing that out.  I've fleshed out the documentation somewhat, and in the process found a small bug which has been fixed (the faster routine kronecker_symbol was called on some inappropriate cases).",
    "created_at": "2011-09-13T00:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106985",
    "user": "https://github.com/katestange"
}
```

Thanks for pointing that out.  I've fleshed out the documentation somewhat, and in the process found a small bug which has been fixed (the faster routine kronecker_symbol was called on some inappropriate cases).



---

archive/issue_comments_106986.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-09-13T06:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106986",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_106987.json:
```json
{
    "body": "All looks good now.  Positive review.",
    "created_at": "2011-09-13T06:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106987",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

All looks good now.  Positive review.



---

archive/issue_comments_106988.json:
```json
{
    "body": "Please put into the ticket's description which patches to apply [in which order, i.e., in the order they should be applied, and perhaps to which repository].\n\n(The trac wiki syntax for referring to attached files is `[attachment:here_comes_the_filename]`, hence in this case `[attachment:trac_10464_residue_symbol.4.patch]`.)\n\nAlso, using the comment field of attachments isn't bad.",
    "created_at": "2011-09-16T11:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106988",
    "user": "https://github.com/nexttime"
}
```

Please put into the ticket's description which patches to apply [in which order, i.e., in the order they should be applied, and perhaps to which repository].

(The trac wiki syntax for referring to attached files is `[attachment:here_comes_the_filename]`, hence in this case `[attachment:trac_10464_residue_symbol.4.patch]`.)

Also, using the comment field of attachments isn't bad.



---

archive/issue_comments_106989.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-17T04:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10411#issuecomment-106989",
    "user": "https://github.com/nexttime"
}
```

Resolution: fixed



---

archive/issue_events_026787.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T04:35:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10411",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10411#event-26787"
}
```
