# Issue 10195: Occasional doctest failure in libs/fplll/fplll.pyx

archive/issues_010194.json:
```json
{
    "assignees": [],
    "body": "Reported on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/145fb7e073d4e12b):\n\n```\nI ran\n\n./sage -t -long -force_lib \"devel/sage/sage/libs/fplll/fplll.pyx\"\n\n1000 times in serial [1] with a 64-bit 4.6.rc0 built on OS X 10.6\n(bsd.math).  All but one of the runs pass.  The failure:\n\nRun 766 of 1000\nDetected SAGE64 flag\nBuilding Sage on OS X in 64-bit mode\nsage -t -long -force_lib \"devel/sage/sage/libs/fplll/fplll.pyx\"\n**********************************************************************\nFile\n\"/Users/buildbot/build/sage/bsd-2/bsd_64_full/build/sage-4.6.0pre0/devel/sa\nge/sage/libs/fplll/fplll.pyx\", line 853:\n    sage: L.echelon_form() == A.echelon_form()\nExpected:\n    True\nGot:\n    False\n```\n\nThe error also occurs with a 32-bit build on bsd.math (OS X 10.6, 5 out of 1000 runs) and on sage.math (64-bit Ubuntu 8.04.4 LTS, 6 of 1000 runs).\n\nDavid Kirkby does **not** get any incorrect results on OpenSolaris 06/2009 after more than 15000 runs with 4.6.rc0 and more than 16000 with 4.6.1.alpha0. He had a total of 31748 passes. However, he did experience 109 doctest failures which are likely to be result of doctesting two copies of Sage simultaneously, as these were using the same directory for temporary files (`$HOME/.sage/tmp`). His errors were like  this:\n\n```\nRun 442 of 100000\nsage -t -long -force_lib \"devel/sage/sage/libs/fplll/fplll.pyx\"\npython: can't open file '/export/home/drkirkby/.sage//tmp/fplll.py':\n[Errno 2] No such file or directory\n\n        [0.2 s]\n```\n\nand never due to False being return instead of True. His problems are probably the result of the issues discussed on #9739. Once David only tested one copy of Sage at a time, there were 0 failures in 17230 tests of sage-4.6.rc0. (Note, since Sage currently only works well on Solaris or OpenSolaris if built as a 32-bit application, this was a 32-bit build).  \n\nDepends on #11130\n\n**Assignee:** mvngu\n\n**CC:**  drkirkby @malb @jdemeyer\n\n**Reviewer:** Jeroen Demeyer\n\n**Upstream:** Fixed upstream, in a later stable release.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10195\n\n",
    "closed_at": "2011-10-17T07:57:39Z",
    "created_at": "2010-10-31T10:10:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Occasional doctest failure in libs/fplll/fplll.pyx",
    "type": "issue",
    "updated_at": "2011-10-17T07:57:39Z",
    "url": "https://github.com/sagemath/sage/issues/10195",
    "user": "https://github.com/qed777"
}
```
Reported on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/145fb7e073d4e12b):

```
I ran

./sage -t -long -force_lib "devel/sage/sage/libs/fplll/fplll.pyx"

1000 times in serial [1] with a 64-bit 4.6.rc0 built on OS X 10.6
(bsd.math).  All but one of the runs pass.  The failure:

Run 766 of 1000
Detected SAGE64 flag
Building Sage on OS X in 64-bit mode
sage -t -long -force_lib "devel/sage/sage/libs/fplll/fplll.pyx"
**********************************************************************
File
"/Users/buildbot/build/sage/bsd-2/bsd_64_full/build/sage-4.6.0pre0/devel/sa
ge/sage/libs/fplll/fplll.pyx", line 853:
    sage: L.echelon_form() == A.echelon_form()
Expected:
    True
Got:
    False
```

The error also occurs with a 32-bit build on bsd.math (OS X 10.6, 5 out of 1000 runs) and on sage.math (64-bit Ubuntu 8.04.4 LTS, 6 of 1000 runs).

David Kirkby does **not** get any incorrect results on OpenSolaris 06/2009 after more than 15000 runs with 4.6.rc0 and more than 16000 with 4.6.1.alpha0. He had a total of 31748 passes. However, he did experience 109 doctest failures which are likely to be result of doctesting two copies of Sage simultaneously, as these were using the same directory for temporary files (`$HOME/.sage/tmp`). His errors were like  this:

```
Run 442 of 100000
sage -t -long -force_lib "devel/sage/sage/libs/fplll/fplll.pyx"
python: can't open file '/export/home/drkirkby/.sage//tmp/fplll.py':
[Errno 2] No such file or directory

        [0.2 s]
```

and never due to False being return instead of True. His problems are probably the result of the issues discussed on #9739. Once David only tested one copy of Sage at a time, there were 0 failures in 17230 tests of sage-4.6.rc0. (Note, since Sage currently only works well on Solaris or OpenSolaris if built as a 32-bit application, this was a 32-bit build).  

Depends on #11130

**Assignee:** mvngu

**CC:**  drkirkby @malb @jdemeyer

**Reviewer:** Jeroen Demeyer

**Upstream:** Fixed upstream, in a later stable release.

Issue created by migration from https://trac.sagemath.org/ticket/10195





---

archive/issue_events_112271.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-31T10:10:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
    "label_color": "08517b",
    "label_name": "component: doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112271"
}
```



---

archive/issue_events_112272.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-31T10:10:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "008080",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112272"
}
```



---

archive/issue_events_112273.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-31T10:19:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112273"
}
```



---

archive/issue_comments_096669.json:
```json
{
    "body": "<a id='comment:2'></a>\nLeif Leonhardy's results:\n\n```\n3/1000 failures on Ubuntu 10.04 x86_64 (Core2), Sage 4.6.rc0, first\nrun.\n4/1000 failures on Ubuntu 10.04 x86_64 (Core2), Sage 4.6.rc0, second\nrun.\n3/1000 failures on Ubuntu 9.04 x86_64 (Core2), Sage 4.6.rc0, first\nrun.\n2/ 500 failures on Ubuntu 9.04 x86_64 (Core2), Sage 4.6.rc0, second\nrun.\n5/1000 failures on Ubuntu 9.04 x86 (Pentium 4 Prescott), Sage 4.6.rc0.\n\n(Exactly the same as above, line 853, False instead of True.) \n```",
    "created_at": "2010-10-31T10:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96669",
    "user": "https://github.com/qed777"
}
```

<a id='comment:2'></a>
Leif Leonhardy's results:

```
3/1000 failures on Ubuntu 10.04 x86_64 (Core2), Sage 4.6.rc0, first
run.
4/1000 failures on Ubuntu 10.04 x86_64 (Core2), Sage 4.6.rc0, second
run.
3/1000 failures on Ubuntu 9.04 x86_64 (Core2), Sage 4.6.rc0, first
run.
2/ 500 failures on Ubuntu 9.04 x86_64 (Core2), Sage 4.6.rc0, second
run.
5/1000 failures on Ubuntu 9.04 x86 (Pentium 4 Prescott), Sage 4.6.rc0.

(Exactly the same as above, line 853, False instead of True.) 
```



---

archive/issue_comments_096670.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -25,12 +25,4 @@\n \n The error also occurs with a 32-bit build on bsd.math (OS X 10.6, 5 out of 1000 runs) and on sage.math (64-bit Ubuntu 8.04.4 LTS, 6 of 1000 runs).\n \n-David Kirkby does not get the error above on OpenSolaris but does see\n-\n-```\n-Run 442 of 100000\n-sage -t -long -force_lib \"devel/sage/sage/libs/fplll/fplll.pyx\"\n-python: can't open file '/export/home/drkirkby/.sage//tmp/fplll.py':\n-[Errno 2] No such file or directory \n-```\n-38 times after 14875 runs.\n+David Kirkby does **not** any failures on OpenSolaris after about 15000 runs with 4.6.rc0 and about 15000 with 4.6.alpha1.\n``````\n",
    "created_at": "2010-10-31T10:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96670",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -25,12 +25,4 @@
 
 The error also occurs with a 32-bit build on bsd.math (OS X 10.6, 5 out of 1000 runs) and on sage.math (64-bit Ubuntu 8.04.4 LTS, 6 of 1000 runs).
 
-David Kirkby does not get the error above on OpenSolaris but does see
-
-```
-Run 442 of 100000
-sage -t -long -force_lib "devel/sage/sage/libs/fplll/fplll.pyx"
-python: can't open file '/export/home/drkirkby/.sage//tmp/fplll.py':
-[Errno 2] No such file or directory 
-```
-38 times after 14875 runs.
+David Kirkby does **not** any failures on OpenSolaris after about 15000 runs with 4.6.rc0 and about 15000 with 4.6.alpha1.
``````




---

archive/issue_comments_096671.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -25,4 +25,4 @@\n \n The error also occurs with a 32-bit build on bsd.math (OS X 10.6, 5 out of 1000 runs) and on sage.math (64-bit Ubuntu 8.04.4 LTS, 6 of 1000 runs).\n \n-David Kirkby does **not** any failures on OpenSolaris after about 15000 runs with 4.6.rc0 and about 15000 with 4.6.alpha1.\n+David Kirkby does **not** get any failures on OpenSolaris after about 15000 runs with 4.6.rc0 and about 15000 with 4.6.alpha1.\n``````\n",
    "created_at": "2010-10-31T10:23:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96671",
    "user": "https://github.com/qed777"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -25,4 +25,4 @@
 
 The error also occurs with a 32-bit build on bsd.math (OS X 10.6, 5 out of 1000 runs) and on sage.math (64-bit Ubuntu 8.04.4 LTS, 6 of 1000 runs).
 
-David Kirkby does **not** any failures on OpenSolaris after about 15000 runs with 4.6.rc0 and about 15000 with 4.6.alpha1.
+David Kirkby does **not** get any failures on OpenSolaris after about 15000 runs with 4.6.rc0 and about 15000 with 4.6.alpha1.
``````




---

archive/issue_comments_096672.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -25,4 +25,15 @@\n \n The error also occurs with a 32-bit build on bsd.math (OS X 10.6, 5 out of 1000 runs) and on sage.math (64-bit Ubuntu 8.04.4 LTS, 6 of 1000 runs).\n \n-David Kirkby does **not** get any failures on OpenSolaris after about 15000 runs with 4.6.rc0 and about 15000 with 4.6.alpha1.\n+David Kirkby does **not** get any incorrect results on OpenSolaris 06/2009 after more than 15000 runs with 4.6.rc0 and more than 16000 with 4.6.1.alpha0. He had a total of 31748 passes. However, he did experience 109 doctest failures which are likely to be result of doctesting two copies of Sage simultaneously, as these were using the same directory for temporary files (`$HOME/.sage/tmp`). His errors were like  this:\n+\n+```\n+Run 442 of 100000\n+sage -t -long -force_lib \"devel/sage/sage/libs/fplll/fplll.pyx\"\n+python: can't open file '/export/home/drkirkby/.sage//tmp/fplll.py':\n+[Errno 2] No such file or directory\n+\n+        [0.2 s]\n+```\n+\n+and never due to False being return instead of True. \n``````\n",
    "created_at": "2010-10-31T10:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96672",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -25,4 +25,15 @@
 
 The error also occurs with a 32-bit build on bsd.math (OS X 10.6, 5 out of 1000 runs) and on sage.math (64-bit Ubuntu 8.04.4 LTS, 6 of 1000 runs).
 
-David Kirkby does **not** get any failures on OpenSolaris after about 15000 runs with 4.6.rc0 and about 15000 with 4.6.alpha1.
+David Kirkby does **not** get any incorrect results on OpenSolaris 06/2009 after more than 15000 runs with 4.6.rc0 and more than 16000 with 4.6.1.alpha0. He had a total of 31748 passes. However, he did experience 109 doctest failures which are likely to be result of doctesting two copies of Sage simultaneously, as these were using the same directory for temporary files (`$HOME/.sage/tmp`). His errors were like  this:
+
+```
+Run 442 of 100000
+sage -t -long -force_lib "devel/sage/sage/libs/fplll/fplll.pyx"
+python: can't open file '/export/home/drkirkby/.sage//tmp/fplll.py':
+[Errno 2] No such file or directory
+
+        [0.2 s]
+```
+
+and never due to False being return instead of True. 
``````




---

archive/issue_comments_096673.json:
```json
{
    "body": "<a id='comment:5'></a>\nI reckon you Linux and OS X users should upgrade to Solaris! \n\nDave",
    "created_at": "2010-10-31T10:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96673",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:5'></a>
I reckon you Linux and OS X users should upgrade to Solaris! 

Dave



---

archive/issue_comments_096674.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [drkirkby](#comment%3A5):\n> I reckon you Linux and OS X users should upgrade to Solaris! \n> \n> Dave \n\nWhat if those failures are *intended* by the fplll authors, but just do *not* work on *your* machine / operating system? Or just those \"file not found\" instances would have been the ones failing... Nobody knows. ;-)\n\n(At least regarding memory and CPUs, I trust most of my machines; they didn't show any bit errors I certainly would have noticed for at least month of continuous computations whose results I could verify...)\n\nBtw, one could also try something like\n\n```sh\n$ export SAGE_TEST_GLOBAL_ITER=1000\n$ ./sage -tp 1 -long devel/sage/sage/libs/fplll/fplll.pyx 2>&1 | tee fplll-test.log\n$ echo \"`grep -c All fplll-test.log` out of 1000 runs did NOT fail.\"\n$ echo \"`grep -c Got fplll-test.log` tests out of 1000 gave an unexpected result.\"\n```",
    "created_at": "2010-10-31T12:31:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96674",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
Replying to [drkirkby](#comment%3A5):
> I reckon you Linux and OS X users should upgrade to Solaris! 
> 
> Dave 

What if those failures are *intended* by the fplll authors, but just do *not* work on *your* machine / operating system? Or just those "file not found" instances would have been the ones failing... Nobody knows. ;-)

(At least regarding memory and CPUs, I trust most of my machines; they didn't show any bit errors I certainly would have noticed for at least month of continuous computations whose results I could verify...)

Btw, one could also try something like

```sh
$ export SAGE_TEST_GLOBAL_ITER=1000
$ ./sage -tp 1 -long devel/sage/sage/libs/fplll/fplll.pyx 2>&1 | tee fplll-test.log
$ echo "`grep -c All fplll-test.log` out of 1000 runs did NOT fail."
$ echo "`grep -c Got fplll-test.log` tests out of 1000 gave an unexpected result."
```



---

archive/issue_comments_096675.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [@nexttime](#comment%3A6):\n> Replying to [drkirkby](#comment%3A5):\n> > I reckon you Linux and OS X users should upgrade to Solaris! \n> > \n> > Dave \n\n> \n> What if those failures are *intended* by the fplll authors, but just do *not* work on *your* machine / operating system? Or just those \"file not found\" instances would have been the ones failing... Nobody knows. ;-)\n\nI was rather expecting you to have something to say on this;-) \n\nFWIW, I'm now doctesting again, but this time only testing one instance of Sage. So errors due to using the one directory for temp files should not exist. I've only managed to run the tests 3723 times, but none of them have failed in any way whatsoever. \n\nI personally think my initial failures were due to #9739. \n\nI think the matrix used for this test might be random, which could explain failures which occur when (for example) all elements are zero. However, that would probably not explain why I don't get any failures.",
    "created_at": "2010-10-31T13:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96675",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:7'></a>
Replying to [@nexttime](#comment%3A6):
> Replying to [drkirkby](#comment%3A5):
> > I reckon you Linux and OS X users should upgrade to Solaris! 
> > 
> > Dave 

> 
> What if those failures are *intended* by the fplll authors, but just do *not* work on *your* machine / operating system? Or just those "file not found" instances would have been the ones failing... Nobody knows. ;-)

I was rather expecting you to have something to say on this;-) 

FWIW, I'm now doctesting again, but this time only testing one instance of Sage. So errors due to using the one directory for temp files should not exist. I've only managed to run the tests 3723 times, but none of them have failed in any way whatsoever. 

I personally think my initial failures were due to #9739. 

I think the matrix used for this test might be random, which could explain failures which occur when (for example) all elements are zero. However, that would probably not explain why I don't get any failures.



---

archive/issue_comments_096676.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -36,4 +36,4 @@\n         [0.2 s]\n ```\n \n-and never due to False being return instead of True. \n+and never due to False being return instead of True. His problems are probably the result of the issues discussed on #9739.\n``````\n",
    "created_at": "2010-10-31T13:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96676",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -36,4 +36,4 @@
         [0.2 s]
 ```
 
-and never due to False being return instead of True. 
+and never due to False being return instead of True. His problems are probably the result of the issues discussed on #9739.
``````




---

archive/issue_comments_096677.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'm cc'ing  Martin Albrecht on this, as he is the author of the library interface. \n\nI'll take a guess at what is happening here. I believe gcc uses the 387 by default on 32-bit builds and the SSE instructions on 32-bit builds for 64-bit builds. So the precision of the results will be increased on 32-bit builds, as the FPU is using 80 bits internally, not 64 as it does with the SSE instructions. \n\nI suspect recompiling libfpll with -mfpmath=387 on 64-bit builds would solve this. See\n\nhttp://gcc.gnu.org/onlinedocs/gcc/i386-and-x86_002d64-Options.html#i386-and-x86_002d64-Options\n\nDave",
    "created_at": "2010-10-31T13:28:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96677",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:8'></a>
I'm cc'ing  Martin Albrecht on this, as he is the author of the library interface. 

I'll take a guess at what is happening here. I believe gcc uses the 387 by default on 32-bit builds and the SSE instructions on 32-bit builds for 64-bit builds. So the precision of the results will be increased on 32-bit builds, as the FPU is using 80 bits internally, not 64 as it does with the SSE instructions. 

I suspect recompiling libfpll with -mfpmath=387 on 64-bit builds would solve this. See

http://gcc.gnu.org/onlinedocs/gcc/i386-and-x86_002d64-Options.html#i386-and-x86_002d64-Options

Dave



---

archive/issue_comments_096678.json:
```json
{
    "body": "<a id='comment:9'></a>\nMore data (Ubuntu 9.04 x86_64, Core2):\n\n```\nFailures: 29/5000\nFailed runs: 468 560 588 656 691 849 909 993 1054 1133 1391 1437 1443 1761 1845 1848 2293 2294 2529 2801 2848 2938 2992 3433 3665 3862 3940 4432 4661\n```\n\nUbuntu 9.04 x86 with `env SAGE_TEST_GLOBAL_ITER=1000 ./sage -tp 1 -long ...`: 3/1000 failed.",
    "created_at": "2010-10-31T14:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96678",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
More data (Ubuntu 9.04 x86_64, Core2):

```
Failures: 29/5000
Failed runs: 468 560 588 656 691 849 909 993 1054 1133 1391 1437 1443 1761 1845 1848 2293 2294 2529 2801 2848 2938 2992 3433 3665 3862 3940 4432 4661
```

Ubuntu 9.04 x86 with `env SAGE_TEST_GLOBAL_ITER=1000 ./sage -tp 1 -long ...`: 3/1000 failed.



---

archive/issue_comments_096679.json:
```json
{
    "body": "<a id='comment:10'></a>\nDave, what happens if you run the following?\n\n```python\nfrom sage.libs.fplll.fplll import gen_ajtai\n\nruns=1000000\nverbose=1\nfailed=[]\n\nfor i in xrange(1,runs):\n    A = gen_ajtai(10, 0.7)\n    L = A.LLL()\n    # L.is_LLL_reduced()\n    # True\n    if not (L.echelon_form() == A.echelon_form()):\n        failed += [ i ]\n        print \"Test #%d failed:\" % i\n        if verbose:\n            print \"A:\\n\", A\n            print \"L:\\n\", L\n            if verbose>1:\n                print \"A.echelon_form()\\n\", A.echelon_form()\n                print \"L.echelon_form()\\n\", L.echelon_form()\n\nprint \"%d out of %d tests failed:\\n\" % (len(failed), runs)\nprint failed\n```",
    "created_at": "2010-10-31T15:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96679",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
Dave, what happens if you run the following?

```python
from sage.libs.fplll.fplll import gen_ajtai

runs=1000000
verbose=1
failed=[]

for i in xrange(1,runs):
    A = gen_ajtai(10, 0.7)
    L = A.LLL()
    # L.is_LLL_reduced()
    # True
    if not (L.echelon_form() == A.echelon_form()):
        failed += [ i ]
        print "Test #%d failed:" % i
        if verbose:
            print "A:\n", A
            print "L:\n", L
            if verbose>1:
                print "A.echelon_form()\n", A.echelon_form()
                print "L.echelon_form()\n", L.echelon_form()

print "%d out of %d tests failed:\n" % (len(failed), runs)
print failed
```



---

archive/issue_comments_096680.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [drkirkby](#comment%3A8):\n> I suspect recompiling libfpll with -mfpmath=387 on 64-bit builds would solve this.\n\nAt least recompilation of libfplll and `sage/libs/fplll/*` with `-mfpmath=387` on the (32-bit) Pentium 4 Prescott doesn't change the outcome (on which I usually compile with `-mfpmath=sse`).",
    "created_at": "2010-10-31T15:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96680",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Replying to [drkirkby](#comment%3A8):
> I suspect recompiling libfpll with -mfpmath=387 on 64-bit builds would solve this.

At least recompilation of libfplll and `sage/libs/fplll/*` with `-mfpmath=387` on the (32-bit) Pentium 4 Prescott doesn't change the outcome (on which I usually compile with `-mfpmath=sse`).



---

archive/issue_comments_096681.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@nexttime](#comment%3A10):\n> Dave, what happens if you run the following?\n\n<snip>\n\nWell, I did a quick check - just 10,000 runs, and there were 19 failures\n\n```\nsage: print \"%d out of %d tests failed:\\n\" % (len(failed), runs)\n19 out of 10000 tests failed:\n\nsage: print failed\n[432, 654, 1219, 1264, 1326, 1490, 1696, 2366, 2622, 3049, 3626, 3835, 4239, 5221, 5368, 6148, 7007, 9661, 9792]\n```\n\nSee attached file\n\nDave",
    "created_at": "2010-11-01T00:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96681",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:12'></a>
Replying to [@nexttime](#comment%3A10):
> Dave, what happens if you run the following?

<snip>

Well, I did a quick check - just 10,000 runs, and there were 19 failures

```
sage: print "%d out of %d tests failed:\n" % (len(failed), runs)
19 out of 10000 tests failed:

sage: print failed
[432, 654, 1219, 1264, 1326, 1490, 1696, 2366, 2622, 3049, 3626, 3835, 4239, 5221, 5368, 6148, 7007, 9661, 9792]
```

See attached file

Dave



---

archive/issue_comments_096682.json:
```json
{
    "body": "**Attachment:** [OpenSolaris-failures-with-Leifs-program.txt](https://github.com/sagemath/sage/files/ticket10195/OpenSolaris-failures-with-Leifs-program.txt)\n\n19 failures in 10,000 runs on OpenSolaris using Leifs script. The actual doctest has never failed in many thosands of runs",
    "created_at": "2010-11-01T00:21:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96682",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

**Attachment:** [OpenSolaris-failures-with-Leifs-program.txt](https://github.com/sagemath/sage/files/ticket10195/OpenSolaris-failures-with-Leifs-program.txt)

19 failures in 10,000 runs on OpenSolaris using Leifs script. The actual doctest has never failed in many thosands of runs



---

archive/issue_comments_096683.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -36,4 +36,4 @@\n         [0.2 s]\n ```\n \n-and never due to False being return instead of True. His problems are probably the result of the issues discussed on #9739.\n+and never due to False being return instead of True. His problems are probably the result of the issues discussed on #9739. Once David only tested one copy of Sage at a time, there were 0 failures in 17230 tests of sage-4.6.rc0. (Note, since Sage currently only works well on Solaris or OpenSolaris if built as a 32-bit application, this was a 32-bit build).  \n``````\n",
    "created_at": "2010-11-01T00:32:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96683",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -36,4 +36,4 @@
         [0.2 s]
 ```
 
-and never due to False being return instead of True. His problems are probably the result of the issues discussed on #9739.
+and never due to False being return instead of True. His problems are probably the result of the issues discussed on #9739. Once David only tested one copy of Sage at a time, there were 0 failures in 17230 tests of sage-4.6.rc0. (Note, since Sage currently only works well on Solaris or OpenSolaris if built as a 32-bit application, this was a 32-bit build).  
``````




---

archive/issue_comments_096684.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [drkirkby](#comment%3A12):\n> Replying to [@nexttime](#comment%3A10):\n> > Dave, what happens if you run the following?\n\n> \n> <snip>\n> \n> Well, I did a quick check - just 10,000 runs, and there were 19 failures\n\nWow, that's more then I get. (I did a couple of tests on three machines, with 100,000 and 1,000,000 \"runs\"; the failure rate in comparison to the doctests dropped to about 0.15-0.17%.)\n\nI've also rebuilt rc0 from scratch with `SAGE87=yes` on x86_64, and besides 7 new doctest errors, three of them PARI \"bugs\", one numerical noise, the failures remain; approximately same ratio with the Python program.",
    "created_at": "2010-11-01T00:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96684",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
Replying to [drkirkby](#comment%3A12):
> Replying to [@nexttime](#comment%3A10):
> > Dave, what happens if you run the following?

> 
> <snip>
> 
> Well, I did a quick check - just 10,000 runs, and there were 19 failures

Wow, that's more then I get. (I did a couple of tests on three machines, with 100,000 and 1,000,000 "runs"; the failure rate in comparison to the doctests dropped to about 0.15-0.17%.)

I've also rebuilt rc0 from scratch with `SAGE87=yes` on x86_64, and besides 7 new doctest errors, three of them PARI "bugs", one numerical noise, the failures remain; approximately same ratio with the Python program.



---

archive/issue_comments_096685.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis may actually be a bug in `echelon_form()`. Manual inspection of one of the failing matrices shows that `A.echelon_form()` doesn't actually return a matrix in HNF, but that the row spaces of `A.echelon_form()` and `L.echelon_form()` are in fact equal.",
    "created_at": "2011-01-10T03:24:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96685",
    "user": "https://github.com/wjp"
}
```

<a id='comment:15'></a>
This may actually be a bug in `echelon_form()`. Manual inspection of one of the failing matrices shows that `A.echelon_form()` doesn't actually return a matrix in HNF, but that the row spaces of `A.echelon_form()` and `L.echelon_form()` are in fact equal.



---

archive/issue_comments_096686.json:
```json
{
    "body": "<a id='comment:16'></a>\nBy the way, these failures are deterministic, so there's no need to do extensive loops.\n\nOne example that fails in pari/gp 2.4.3 (in sage), but works with pari/gp 2.3.1:\n\n```\nmathnf([0, 0, 0, 0, 0, 0, 0, 0, 0, 13; 0, 0, 0, 0, 0, 0, 0, 0, 23, 6; \\\n0, 0, 0, 0, 0, 0, 0, 23, -4, -7; 0, 0, 0, 0, 0, 0, 17, -3, 5, -5; \\\n0, 0, 0, 0, 0, 56, 16, -16, -15, -17; 0, 0, 0, 0, 57, 24, -16, -25, 2, -21; \\\n0, 0, 0, 114, 9, 56, 51, -52, 25, -55; 0, 0, 113, -31, -11, 24, 0, 28, 34, -16; \\\n0, 50, 3, 2, 16, -6, -2, 7, -19, -21; 118, 43, 51, 23, 37, -52, 18, 38, 51, 28], 0)\n```\n\nI'll investigate some more, and then report this upstream.",
    "created_at": "2011-01-10T05:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96686",
    "user": "https://github.com/wjp"
}
```

<a id='comment:16'></a>
By the way, these failures are deterministic, so there's no need to do extensive loops.

One example that fails in pari/gp 2.4.3 (in sage), but works with pari/gp 2.3.1:

```
mathnf([0, 0, 0, 0, 0, 0, 0, 0, 0, 13; 0, 0, 0, 0, 0, 0, 0, 0, 23, 6; \
0, 0, 0, 0, 0, 0, 0, 23, -4, -7; 0, 0, 0, 0, 0, 0, 17, -3, 5, -5; \
0, 0, 0, 0, 0, 56, 16, -16, -15, -17; 0, 0, 0, 0, 57, 24, -16, -25, 2, -21; \
0, 0, 0, 114, 9, 56, 51, -52, 25, -55; 0, 0, 113, -31, -11, 24, 0, 28, 34, -16; \
0, 50, 3, 2, 16, -6, -2, 7, -19, -21; 118, 43, 51, 23, 37, -52, 18, 38, 51, 28], 0)
```

I'll investigate some more, and then report this upstream.



---

archive/issue_comments_096687.json:
```json
{
    "body": "**Upstream:** Reported upstream. Little or no feedback.",
    "created_at": "2011-01-10T18:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96687",
    "user": "https://github.com/wjp"
}
```

**Upstream:** Reported upstream. Little or no feedback.



---

archive/issue_comments_096688.json:
```json
{
    "body": "<a id='comment:17'></a>\nThis is now http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1153",
    "created_at": "2011-01-10T18:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96688",
    "user": "https://github.com/wjp"
}
```

<a id='comment:17'></a>
This is now http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1153



---

archive/issue_comments_096689.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. Little or no feedback.\" to \"Reported upstream. Developers acknowledge bug.\".",
    "created_at": "2011-01-25T14:33:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96689",
    "user": "https://github.com/wjp"
}
```

**Changing upstream** from "Reported upstream. Little or no feedback." to "Reported upstream. Developers acknowledge bug.".



---

archive/issue_comments_096690.json:
```json
{
    "body": "<a id='comment:20'></a>\n> I have no documentation on \"Batut's algorithm\" (probably in Christian\n> Batut's thesis), I'm reverse-engineering the code to try and understand\n> what is going wrong.\n\nThis doesn't sound good :-)",
    "created_at": "2011-01-25T14:38:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96690",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
> I have no documentation on "Batut's algorithm" (probably in Christian
> Batut's thesis), I'm reverse-engineering the code to try and understand
> what is going wrong.

This doesn't sound good :-)



---

archive/issue_comments_096691.json:
```json
{
    "body": "<a id='comment:21'></a>\nAccording to Karim Belabas this is now fixed in pari svn r12889.\n\n(How many more times am I expected to change the upstream status field? :-) )",
    "created_at": "2011-01-31T21:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96691",
    "user": "https://github.com/wjp"
}
```

<a id='comment:21'></a>
According to Karim Belabas this is now fixed in pari svn r12889.

(How many more times am I expected to change the upstream status field? :-) )



---

archive/issue_comments_096692.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. Developers acknowledge bug.\" to \"Fixed upstream, but not in a stable release.\".",
    "created_at": "2011-01-31T21:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96692",
    "user": "https://github.com/wjp"
}
```

**Changing upstream** from "Reported upstream. Developers acknowledge bug." to "Fixed upstream, but not in a stable release.".



---

archive/issue_comments_096693.json:
```json
{
    "body": "<a id='comment:22'></a>\nSee #11130.",
    "created_at": "2011-04-05T15:01:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96693",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
See #11130.



---

archive/issue_comments_096694.json:
```json
{
    "body": "**Dependencies:** #11130",
    "created_at": "2011-09-16T17:40:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96694",
    "user": "https://github.com/nexttime"
}
```

**Dependencies:** #11130



---

archive/issue_events_112274.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-16T17:40:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112274"
}
```



---

archive/issue_comments_096695.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [@jdemeyer](#comment%3A22):\n> See #11130.\n\nI.e., #11130 will (also) fix this. [Hopefully.]",
    "created_at": "2011-09-16T17:40:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96695",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
Replying to [@jdemeyer](#comment%3A22):
> See #11130.

I.e., #11130 will (also) fix this. [Hopefully.]



---

archive/issue_events_112275.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-16T17:40:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112275"
}
```



---

archive/issue_events_112276.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-23T19:36:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112276"
}
```



---

archive/issue_events_112277.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-23T19:36:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112277"
}
```



---

archive/issue_comments_096696.json:
```json
{
    "body": "**Changing upstream** from \"Fixed upstream, but not in a stable release.\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2011-09-23T19:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96696",
    "user": "https://github.com/jdemeyer"
}
```

**Changing upstream** from "Fixed upstream, but not in a stable release." to "Fixed upstream, in a later stable release.".



---

archive/issue_comments_096697.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2011-09-27T09:43:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10195#issuecomment-96697",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_events_112278.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T07:57:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "008080",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112278"
}
```



---

archive/issue_events_112279.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T07:57:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112279"
}
```



---

archive/issue_events_112280.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T07:57:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10195",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10195#event-112280"
}
```
