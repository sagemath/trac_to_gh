# Issue 10336: Cannot plot non-strictly convex cones

archive/issues_010335.json:
```json
{
    "body": "Assignee: @novoselt\n\nCC:  @novoselt\n\nPlotting cones relies on the cone's face lattice:\n\n```\nsage: halfspace = Cone([(1,0,0), (0,1,0), (-1,-1,0), (0,0,1)])\nsage: halfspace.plot()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n\n/home/vbraun/opt/sage-4.6/devel/sage-main/<ipython console> in <module>()\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/geometry/cone.pyc in plot(self, **options)\n   2623         if self.dim() >= 2:\n   2624             # Modify wall labels to match the ambient cone or fan too.\n-> 2625             walls = self.faces(2)\n   2626             try:\n   2627                 ambient_walls = self.ambient().faces(2)\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/geometry/cone.pyc in faces(self, dim, codim)\n   2015         if \"_faces\" not in self.__dict__:\n   2016             self._faces = tuple(self._sort_faces(e.element for e in level)\n-> 2017                                 for level in self.face_lattice().level_sets())\n   2018             # To avoid duplication and ensure order consistency\n   2019             if self.dim() > 0:\n\n/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/geometry/cone.pyc in face_lattice(self)\n   1854                 # We need to compute face lattice on our own\n   1855                 if not self.is_strictly_convex():\n-> 1856                     raise NotImplementedError(\"face lattice is currently \"\n   1857                                 \"implemented only for strictly convex cones!\")\n   1858                 def ConeFace(rays, facets):\n\nNotImplementedError: face lattice is currently implemented only for strictly convex cones!\n```\nIs there any reason for why we can't compute the face lattice of a non-strictly convex cone? If there is, we might want to still plot something reasonable in that case...\n\nIssue created by migration from https://trac.sagemath.org/ticket/10336\n\n",
    "closed_at": "2011-01-25T08:15:25Z",
    "created_at": "2010-11-26T09:18:55Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Cannot plot non-strictly convex cones",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10336",
    "user": "https://github.com/vbraun"
}
```
Assignee: @novoselt

CC:  @novoselt

Plotting cones relies on the cone's face lattice:

```
sage: halfspace = Cone([(1,0,0), (0,1,0), (-1,-1,0), (0,0,1)])
sage: halfspace.plot()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)

/home/vbraun/opt/sage-4.6/devel/sage-main/<ipython console> in <module>()

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/geometry/cone.pyc in plot(self, **options)
   2623         if self.dim() >= 2:
   2624             # Modify wall labels to match the ambient cone or fan too.
-> 2625             walls = self.faces(2)
   2626             try:
   2627                 ambient_walls = self.ambient().faces(2)

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/geometry/cone.pyc in faces(self, dim, codim)
   2015         if "_faces" not in self.__dict__:
   2016             self._faces = tuple(self._sort_faces(e.element for e in level)
-> 2017                                 for level in self.face_lattice().level_sets())
   2018             # To avoid duplication and ensure order consistency
   2019             if self.dim() > 0:

/home/vbraun/Sage/sage/local/lib/python2.6/site-packages/sage/geometry/cone.pyc in face_lattice(self)
   1854                 # We need to compute face lattice on our own
   1855                 if not self.is_strictly_convex():
-> 1856                     raise NotImplementedError("face lattice is currently "
   1857                                 "implemented only for strictly convex cones!")
   1858                 def ConeFace(rays, facets):

NotImplementedError: face lattice is currently implemented only for strictly convex cones!
```
Is there any reason for why we can't compute the face lattice of a non-strictly convex cone? If there is, we might want to still plot something reasonable in that case...

Issue created by migration from https://trac.sagemath.org/ticket/10336





---

archive/issue_comments_105829.json:
```json
{
    "body": "Originally there was no code to compute face lattices of non-strictly convex cones, but with your recent modifications it will be easy to fix.\n\nPlotting code that I wrote will not immediately work for such cases anyway, but again it should not be terribly difficult to fix, I just was more concerned with plotting fans.\n\nWill work on it!\n\nP.S. Since it was due to `NotImplemented`, I consider this ticket an enhancement ;-)",
    "created_at": "2010-11-26T18:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105829",
    "user": "https://github.com/novoselt"
}
```

Originally there was no code to compute face lattices of non-strictly convex cones, but with your recent modifications it will be easy to fix.

Plotting code that I wrote will not immediately work for such cases anyway, but again it should not be terribly difficult to fix, I just was more concerned with plotting fans.

Will work on it!

P.S. Since it was due to `NotImplemented`, I consider this ticket an enhancement ;-)



---

archive/issue_comments_105830.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2010-11-26T18:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105830",
    "user": "https://github.com/novoselt"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_105831.json:
```json
{
    "body": "Changing assignee from @aghitza to @novoselt.",
    "created_at": "2010-11-26T18:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105831",
    "user": "https://github.com/novoselt"
}
```

Changing assignee from @aghitza to @novoselt.



---

archive/issue_comments_105832.json:
```json
{
    "body": "I am thinking of:\n* allowing `cone.faces(d)` to accept any d and return an empty tuple if there are no faces of dimension d;\n* returning a tuple of non-empty tuples as the output of `cone.faces()`, i.e. for a half-space it will be just `((plane,), (half-space,))` instead of `((), (), (plane,), (half-space,))` where the d-th tuple contains faces of dimension d.\n\nThoughts?",
    "created_at": "2010-11-26T22:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105832",
    "user": "https://github.com/novoselt"
}
```

I am thinking of:
* allowing `cone.faces(d)` to accept any d and return an empty tuple if there are no faces of dimension d;
* returning a tuple of non-empty tuples as the output of `cone.faces()`, i.e. for a half-space it will be just `((plane,), (half-space,))` instead of `((), (), (plane,), (half-space,))` where the d-th tuple contains faces of dimension d.

Thoughts?



---

archive/issue_comments_105833.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2010-11-26T22:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105833",
    "user": "https://github.com/novoselt"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_105834.json:
```json
{
    "body": "I attached the first development version. `face_lattice` should work for any cone now and there are a few small corrections in other places. Definitely needs more work!-)",
    "created_at": "2010-11-26T22:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105834",
    "user": "https://github.com/novoselt"
}
```

I attached the first development version. `face_lattice` should work for any cone now and there are a few small corrections in other places. Definitely needs more work!-)



---

archive/issue_comments_105835.json:
```json
{
    "body": "Replying to [comment:2 novoselt]:\n> I am thinking of:\n> * allowing `cone.faces(d)` to accept any d and return an empty tuple if there are no faces of dimension d;\n> * returning a tuple of non-empty tuples as the output of `cone.faces()`\n\n\nboth sound good to me!",
    "created_at": "2010-11-26T23:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105835",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:2 novoselt]:
> I am thinking of:
> * allowing `cone.faces(d)` to accept any d and return an empty tuple if there are no faces of dimension d;
> * returning a tuple of non-empty tuples as the output of `cone.faces()`


both sound good to me!



---

archive/issue_events_026587.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-11-27T02:49:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10336#event-26587"
}
```



---

archive/issue_comments_105836.json:
```json
{
    "body": "Great! Done! Refreshed patch should deal fine with faces in all cases, all old doctests pass and I added a couple for non-strictly convex cones - there was an issue originally for \"totally non-strictly conex\" cones like a plane, that's why there is `DiGraph(1)` in `Hasse_diagram`.\n\nRegarding the plots. Let's take, e.g. a half-plane generated by vectors (1,0), (1,1), (0,1), (-1,0). I propose that its plot will look exactly like the plot of the fan with these generators except that two middle vectors will be plotted as generators, but there will be no rays in their direction extending to the boundary of the plot (labels still will be places on the boundary out of colored regions). The label for the half-plane itself will be randomly placed between two consecutive generators - this way it will be inside and will not get crossed by one of the internal generators.",
    "created_at": "2010-11-27T02:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105836",
    "user": "https://github.com/novoselt"
}
```

Great! Done! Refreshed patch should deal fine with faces in all cases, all old doctests pass and I added a couple for non-strictly convex cones - there was an issue originally for "totally non-strictly conex" cones like a plane, that's why there is `DiGraph(1)` in `Hasse_diagram`.

Regarding the plots. Let's take, e.g. a half-plane generated by vectors (1,0), (1,1), (0,1), (-1,0). I propose that its plot will look exactly like the plot of the fan with these generators except that two middle vectors will be plotted as generators, but there will be no rays in their direction extending to the boundary of the plot (labels still will be places on the boundary out of colored regions). The label for the half-plane itself will be randomly placed between two consecutive generators - this way it will be inside and will not get crossed by one of the internal generators.



---

archive/issue_comments_105837.json:
```json
{
    "body": "OK, it remains to make the default \"round\" mode work and reposition labels of non-strictly convex 2-d walls.",
    "created_at": "2010-11-27T05:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105837",
    "user": "https://github.com/novoselt"
}
```

OK, it remains to make the default "round" mode work and reposition labels of non-strictly convex 2-d walls.



---

archive/issue_comments_105838.json:
```json
{
    "body": "Now plotting should work in all modes.\n\nWall labels will be positioned between two generators that generate the plane of the wall. This will result in OK placement for automatically adjusted generators (i.e. when half-planes are generated by 3 rays and planes by 4). If the user has forced (via `check=False` option) other generators, they can potentially cross labels, in which case this user should place labels manually.\n\nI have switched `toric_plotter` to using `RDF` instead of `RR` since the first seems to be a little faster.",
    "created_at": "2010-11-28T18:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105838",
    "user": "https://github.com/novoselt"
}
```

Now plotting should work in all modes.

Wall labels will be positioned between two generators that generate the plane of the wall. This will result in OK placement for automatically adjusted generators (i.e. when half-planes are generated by 3 rays and planes by 4). If the user has forced (via `check=False` option) other generators, they can potentially cross labels, in which case this user should place labels manually.

I have switched `toric_plotter` to using `RDF` instead of `RR` since the first seems to be a little faster.



---

archive/issue_comments_105839.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-28T18:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105839",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_105840.json:
```json
{
    "body": "Attachment [trac_10336_plot_non_strictly_convex_cones.patch](tarball://root/attachments/some-uuid/ticket10336/trac_10336_plot_non_strictly_convex_cones.patch) by @novoselt created at 2010-11-28 20:17:42",
    "created_at": "2010-11-28T20:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105840",
    "user": "https://github.com/novoselt"
}
```

Attachment [trac_10336_plot_non_strictly_convex_cones.patch](tarball://root/attachments/some-uuid/ticket10336/trac_10336_plot_non_strictly_convex_cones.patch) by @novoselt created at 2010-11-28 20:17:42



---

archive/issue_comments_105841.json:
```json
{
    "body": "Made user's `radius` more important (new code block in `ToricPlotter.__init__`), so that it is possible to make it small even if it cuts off some generators.",
    "created_at": "2010-11-28T20:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105841",
    "user": "https://github.com/novoselt"
}
```

Made user's `radius` more important (new code block in `ToricPlotter.__init__`), so that it is possible to make it small even if it cuts off some generators.



---

archive/issue_comments_105842.json:
```json
{
    "body": "Depends on #9972.",
    "created_at": "2010-12-05T19:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105842",
    "user": "https://github.com/novoselt"
}
```

Depends on #9972.



---

archive/issue_comments_105843.json:
```json
{
    "body": "Nice! Tested against sage-4.6.1alpha3",
    "created_at": "2010-12-20T12:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105843",
    "user": "https://github.com/vbraun"
}
```

Nice! Tested against sage-4.6.1alpha3



---

archive/issue_comments_105844.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-12-20T12:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105844",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_105845.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-01-25T08:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10336#issuecomment-105845",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_026588.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-25T08:15:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10336",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10336#event-26588"
}
```
