# Issue 10156: Rename top-level makefile to Makefile

archive/issues_010155.json:
```json
{
    "assignees": [],
    "body": "This ticket has a few patches which should be applied when renaming `makefile` to `Makefile`.  See also #9799.\n\nApply:\n1. [attachment: 10156_doc.patch](https://github.com/sagemath/sage/files/ticket10156/10156_doc.patch.gz)\n2. [attachment: 10156_scripts.patch](https://github.com/sagemath/sage/files/ticket10156/10156_scripts.patch.gz)\n3. [attachment: install.patch](https://github.com/sagemath/sage/files/ticket10156/install.patch.gz)\n\nCC:  @jhpalmieri @nexttime\n\nKeywords: **scripts makefile**\n\nComponent: **distribution**\n\nAuthor: **Jeroen Demeyer, John Palmieri**\n\nReviewer: **Volker Braun**\n\nMerged: **sage-4.6.1.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10156_\n\n",
    "closed_at": "2010-11-16T08:21:29Z",
    "created_at": "2010-10-23T07:42:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20distribution",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Rename top-level makefile to Makefile",
    "type": "issue",
    "updated_at": "2010-11-16T19:41:41Z",
    "url": "https://github.com/sagemath/sage/issues/10156",
    "user": "https://github.com/jdemeyer"
}
```
This ticket has a few patches which should be applied when renaming `makefile` to `Makefile`.  See also #9799.

Apply:
1. [attachment: 10156_doc.patch](https://github.com/sagemath/sage/files/ticket10156/10156_doc.patch.gz)
2. [attachment: 10156_scripts.patch](https://github.com/sagemath/sage/files/ticket10156/10156_scripts.patch.gz)
3. [attachment: install.patch](https://github.com/sagemath/sage/files/ticket10156/install.patch.gz)

CC:  @jhpalmieri @nexttime

Keywords: **scripts makefile**

Component: **distribution**

Author: **Jeroen Demeyer, John Palmieri**

Reviewer: **Volker Braun**

Merged: **sage-4.6.1.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/10156_





---

archive/issue_events_133016.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T07:42:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "milestone_number": null,
    "milestone_title": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133016"
}
```



---

archive/issue_events_133017.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T07:42:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "000080",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133017"
}
```



---

archive/issue_events_133018.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T07:42:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133018"
}
```



---

archive/issue_events_133019.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-23T07:42:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133019"
}
```



---

archive/issue_comments_093718.json:
```json
{
    "body": "Attachment: **[10156_doc.patch.gz](https://github.com/sagemath/sage/files/ticket10156/10156_doc.patch.gz)**\n\nsagelib patch",
    "created_at": "2010-10-23T07:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93718",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[10156_doc.patch.gz](https://github.com/sagemath/sage/files/ticket10156/10156_doc.patch.gz)**

sagelib patch



---

archive/issue_comments_093719.json:
```json
{
    "body": "Attachment: **[10156_scripts.patch.gz](https://github.com/sagemath/sage/files/ticket10156/10156_scripts.patch.gz)**\n\nsage_scripts patch",
    "created_at": "2010-10-23T07:51:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93719",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[10156_scripts.patch.gz](https://github.com/sagemath/sage/files/ticket10156/10156_scripts.patch.gz)**

sage_scripts patch



---

archive/issue_comments_093720.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2010-10-23T11:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93720",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_093721.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe renaming is also done by #9433 IIRC.",
    "created_at": "2010-10-23T11:56:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93721",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:2" align="right">comment:2</div>

The renaming is also done by #9433 IIRC.



---

archive/issue_comments_093722.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI wonder if it's safer to use `[Mm]akefile` in the shell scripts. (The scripts calling Python functions rather than `os.system()` etc. would get more complicated of course.)\n\nAt least there seems to be a lack of error / consistency checking, as always...",
    "created_at": "2010-10-23T13:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93722",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

I wonder if it's safer to use `[Mm]akefile` in the shell scripts. (The scripts calling Python functions rather than `os.system()` etc. would get more complicated of course.)

At least there seems to be a lack of error / consistency checking, as always...



---

archive/issue_events_133020.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-10-23T13:29:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133020"
}
```



---

archive/issue_comments_093723.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nPatches look reasonable; I just don't know yet if they catch all instances.",
    "created_at": "2010-10-23T13:31:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93723",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">comment:4</div>

Patches look reasonable; I just don't know yet if they catch all instances.



---

archive/issue_comments_093724.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIf you thrust the author of the patch to do the test, I am doing the following:\n* building Sage from source with #9799, #10156, #10157 applied and makefile renamed to Makefile\n* making an sdist and a bdist from this built Sage\n* extract the sdist, make, make ptestlong\n* extract the bdist, make ptestlong\n\nIf all this works, I think that #10156 and #10157 are proven to work.",
    "created_at": "2010-10-23T15:56:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93724",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

If you thrust the author of the patch to do the test, I am doing the following:
* building Sage from source with #9799, #10156, #10157 applied and makefile renamed to Makefile
* making an sdist and a bdist from this built Sage
* extract the sdist, make, make ptestlong
* extract the bdist, make ptestlong

If all this works, I think that #10156 and #10157 are proven to work.



---

archive/issue_comments_093725.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAll builds and tests mentioned above worked with #9799, #10156, #10157 applied.",
    "created_at": "2010-10-23T22:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93725",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

All builds and tests mentioned above worked with #9799, #10156, #10157 applied.



---

archive/issue_comments_093726.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-See also #9799\n+This ticket has a few patches which should be applied when renaming `makefile` to `Makefile`.  See also #9799.\n``````\n",
    "created_at": "2010-10-23T22:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93726",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-See also #9799
+This ticket has a few patches which should be applied when renaming `makefile` to `Makefile`.  See also #9799.
``````




---

archive/issue_comments_093727.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@nexttime](#comment:3):\n> I wonder if it's safer to use `[Mm]akefile` in the shell scripts.\n\nI don't see why.  If we really rename `makefile` to `Makefile`, there is no reason to use `[Mm]akefile`.",
    "created_at": "2010-10-25T10:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93727",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@nexttime](#comment:3):
> I wonder if it's safer to use `[Mm]akefile` in the shell scripts.

I don't see why.  If we really rename `makefile` to `Makefile`, there is no reason to use `[Mm]akefile`.



---

archive/issue_comments_093728.json:
```json
{
    "body": "Merged: **sage-4.6.1.alpha0**",
    "created_at": "2010-11-01T10:17:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93728",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.6.1.alpha0**



---

archive/issue_comments_093729.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nJohn or Leif: could you review this and #10157 please?  I think these patches have received sufficient testing to prove that they work.",
    "created_at": "2010-11-05T08:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93729",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

John or Leif: could you review this and #10157 please?  I think these patches have received sufficient testing to prove that they work.



---

archive/issue_comments_093730.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe Sage library patch looks fine. \n\nFor the scripts patch, I haven't tested it at all, but what happens if you upgrade from a version of Sage with a file called \"makefile\"?  Will things break?  I don't think it's ever a good idea to run \"sage-sdist\" or \"sage-bdist\" from an upgraded version of Sage, but if someone does, what will happen?  Would it be a good idea to either use something like [Mm]akefile, as leif suggested, or do something like the following:\n\n```sh\nif [ -e makefile ]; then\n   cp -$OPT makefile \"$TMP\"/Makefile\nfi\n```\n(This is for sage-bdist, and you would use something similar in sage-sdist.)",
    "created_at": "2010-11-05T17:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93730",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

The Sage library patch looks fine. 

For the scripts patch, I haven't tested it at all, but what happens if you upgrade from a version of Sage with a file called "makefile"?  Will things break?  I don't think it's ever a good idea to run "sage-sdist" or "sage-bdist" from an upgraded version of Sage, but if someone does, what will happen?  Would it be a good idea to either use something like [Mm]akefile, as leif suggested, or do something like the following:

```sh
if [ -e makefile ]; then
   cp -$OPT makefile "$TMP"/Makefile
fi
```
(This is for sage-bdist, and you would use something similar in sage-sdist.)



---

archive/issue_comments_093731.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jhpalmieri](#comment:10):\n> The Sage library patch looks fine. \n> \n> For the scripts patch, I haven't tested it at all, but what happens if you upgrade from a version of Sage with a file called \"makefile\"?  Will things break?\n\nW.r.t. making new dists from an upgraded version, hopefully #9433 solves this... ;-)\n\n(I don't know if you meant upgrading in general; this works for me. You just still have the old `makefile`.)\n\n\n> I don't think it's ever a good idea to run \"sage-sdist\" or \"sage-bdist\" from an upgraded version of Sage [...]\n\nNobody should do this, currently.\n\nWe should perhaps just give an error message in that case (until #9433 is merged).",
    "created_at": "2010-11-05T18:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93731",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jhpalmieri](#comment:10):
> The Sage library patch looks fine. 
> 
> For the scripts patch, I haven't tested it at all, but what happens if you upgrade from a version of Sage with a file called "makefile"?  Will things break?

W.r.t. making new dists from an upgraded version, hopefully #9433 solves this... ;-)

(I don't know if you meant upgrading in general; this works for me. You just still have the old `makefile`.)


> I don't think it's ever a good idea to run "sage-sdist" or "sage-bdist" from an upgraded version of Sage [...]

Nobody should do this, currently.

We should perhaps just give an error message in that case (until #9433 is merged).



---

archive/issue_comments_093732.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI don't understand the fine details of upgrading, but would it be possible to copy `makefile` to `Makefile` during the *upgrade*?",
    "created_at": "2010-11-05T20:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93732",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

I don't understand the fine details of upgrading, but would it be possible to copy `makefile` to `Makefile` during the *upgrade*?



---

archive/issue_comments_093733.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jdemeyer](#comment:12):\n> I don't understand the fine details of upgrading, but would it be possible to copy `makefile` to `Makefile` during the *upgrade*?\n\nOf course. But I would *rename* it because (POSIX) `make` gives `makefile` precedence over `Makefile` and we don't want to cause confusion.",
    "created_at": "2010-11-06T00:24:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93733",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jdemeyer](#comment:12):
> I don't understand the fine details of upgrading, but would it be possible to copy `makefile` to `Makefile` during the *upgrade*?

Of course. But I would *rename* it because (POSIX) `make` gives `makefile` precedence over `Makefile` and we don't want to cause confusion.



---

archive/issue_comments_093734.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@nexttime](#comment:13):\n> Replying to [@jdemeyer](#comment:12):\n> > I don't understand the fine details of upgrading, but would it be possible to copy `makefile` to `Makefile` during the *upgrade*?\n\n> \n> Of course. But I would *rename* it because (POSIX) `make` gives `makefile` precedence over `Makefile` and we don't want to cause confusion.\n\nOn the other hand, if `makefile` and `Makefile` are identical files, it shouldn't matter.  It seems just dangerous to delete `makefile` during a Sage build/upgrade.\n\nCan any of you implement this?",
    "created_at": "2010-11-07T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93734",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@nexttime](#comment:13):
> Replying to [@jdemeyer](#comment:12):
> > I don't understand the fine details of upgrading, but would it be possible to copy `makefile` to `Makefile` during the *upgrade*?

> 
> Of course. But I would *rename* it because (POSIX) `make` gives `makefile` precedence over `Makefile` and we don't want to cause confusion.

On the other hand, if `makefile` and `Makefile` are identical files, it shouldn't matter.  It seems just dangerous to delete `makefile` during a Sage build/upgrade.

Can any of you implement this?



---

archive/issue_comments_093735.json:
```json
{
    "body": "Work Issues: **copy makefile to Makefile during upgrade**",
    "created_at": "2010-11-07T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93735",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **copy makefile to Makefile during upgrade**



---

archive/issue_events_133021.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-07T10:56:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133021"
}
```



---

archive/issue_events_133022.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-07T10:56:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133022"
}
```



---

archive/issue_comments_093736.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jdemeyer](#comment:14):\n> Replying to [@nexttime](#comment:13):\n> > Replying to [@jdemeyer](#comment:12):\n> > > I don't understand the fine details of upgrading, but would it be possible to copy `makefile` to `Makefile` during the *upgrade*?\n\n> > \n> > Of course. But I would *rename* it because (POSIX) `make` gives `makefile` precedence over `Makefile` and we don't want to cause confusion.\n\n> \n> On the other hand, if `makefile` and `Makefile` are identical files, it shouldn't matter.  It seems just dangerous to delete `makefile` during a Sage build/upgrade.\n\nNote that on OS X, you can't have files called both \"makefile\" and \"Makefile\" in the same directory.  Also, \"makefile\" is not used at all during an upgrade, so it should be safe to rename it.\n\n> Can any of you implement this?\n\nIt's taken care of by #9433.  If we want to implement it here, I think it should be done in the sage-upgrade script, after running \"./install\" and checking its exit status:\n\n```diff\ndiff -r 4047e578febc sage-upgrade\n--- a/sage-upgrade      Sat Oct 30 16:05:33 2010 -0700\n+++ b/sage-upgrade      Tue Nov 09 10:57:40 2010 -0800\n@@ -36,3 +36,13 @@\n     exit 1\n fi\n \n+cd \"$SAGE_ROOT\"\n+\n+if [ -f makefile ]; then\n+    mv makefile Makefile\n+fi\n+\n+if [ $? -ne 0 ]; then\n+    echo \"Error renaming 'makefile' to 'Makefile'.\n+    exit 1\n+fi\n```\nAnother option would also check for the existence of 'Makefile' before doing the move:\n\n```diff\ndiff -r 4047e578febc sage-upgrade\n--- a/sage-upgrade      Sat Oct 30 16:05:33 2010 -0700\n+++ b/sage-upgrade      Tue Nov 09 10:58:47 2010 -0800\n@@ -36,3 +36,16 @@\n     exit 1\n fi\n \n+cd \"$SAGE_ROOT\"\n+\n+if [ -f makefile ]; then\n+    if [ -f Makefile ]; then\n+       mv Makefile Makefile.old\n+    fi\n+    mv makefile Makefile\n+fi\n+\n+if [ $? -ne 0 ]; then\n+    echo \"Error renaming 'makefile' to 'Makefile'.\n+    exit 1\n+fi\n```\nOpinions either way?",
    "created_at": "2010-11-09T19:00:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93736",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jdemeyer](#comment:14):
> Replying to [@nexttime](#comment:13):
> > Replying to [@jdemeyer](#comment:12):
> > > I don't understand the fine details of upgrading, but would it be possible to copy `makefile` to `Makefile` during the *upgrade*?

> > 
> > Of course. But I would *rename* it because (POSIX) `make` gives `makefile` precedence over `Makefile` and we don't want to cause confusion.

> 
> On the other hand, if `makefile` and `Makefile` are identical files, it shouldn't matter.  It seems just dangerous to delete `makefile` during a Sage build/upgrade.

Note that on OS X, you can't have files called both "makefile" and "Makefile" in the same directory.  Also, "makefile" is not used at all during an upgrade, so it should be safe to rename it.

> Can any of you implement this?

It's taken care of by #9433.  If we want to implement it here, I think it should be done in the sage-upgrade script, after running "./install" and checking its exit status:

```diff
diff -r 4047e578febc sage-upgrade
--- a/sage-upgrade      Sat Oct 30 16:05:33 2010 -0700
+++ b/sage-upgrade      Tue Nov 09 10:57:40 2010 -0800
@@ -36,3 +36,13 @@
     exit 1
 fi
 
+cd "$SAGE_ROOT"
+
+if [ -f makefile ]; then
+    mv makefile Makefile
+fi
+
+if [ $? -ne 0 ]; then
+    echo "Error renaming 'makefile' to 'Makefile'.
+    exit 1
+fi
```
Another option would also check for the existence of 'Makefile' before doing the move:

```diff
diff -r 4047e578febc sage-upgrade
--- a/sage-upgrade      Sat Oct 30 16:05:33 2010 -0700
+++ b/sage-upgrade      Tue Nov 09 10:58:47 2010 -0800
@@ -36,3 +36,16 @@
     exit 1
 fi
 
+cd "$SAGE_ROOT"
+
+if [ -f makefile ]; then
+    if [ -f Makefile ]; then
+       mv Makefile Makefile.old
+    fi
+    mv makefile Makefile
+fi
+
+if [ $? -ne 0 ]; then
+    echo "Error renaming 'makefile' to 'Makefile'.
+    exit 1
+fi
```
Opinions either way?



---

archive/issue_comments_093737.json:
```json
{
    "body": "Attachment: **[10156_upgrade.patch.gz](https://github.com/sagemath/sage/files/ticket10156/10156_upgrade.patch.gz)**\n\nAdditional scripts patch: rename makefile to Makefile during upgrade",
    "created_at": "2010-11-10T08:39:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93737",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[10156_upgrade.patch.gz](https://github.com/sagemath/sage/files/ticket10156/10156_upgrade.patch.gz)**

Additional scripts patch: rename makefile to Makefile during upgrade



---

archive/issue_events_133023.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-10T18:58:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133023"
}
```



---

archive/issue_events_133024.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-10T18:58:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133024"
}
```



---

archive/issue_comments_093738.json:
```json
{
    "body": "Changed merged from **sage-4.6.1.alpha0** to none",
    "created_at": "2010-11-10T18:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93738",
    "user": "https://github.com/jdemeyer"
}
```

Changed merged from **sage-4.6.1.alpha0** to none



---

archive/issue_comments_093739.json:
```json
{
    "body": "Merged: **sage-4.6.1.alpha1**",
    "created_at": "2010-11-10T22:27:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93739",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.6.1.alpha1**



---

archive/issue_comments_093740.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThe first two patches (10156_docs.patch and 10156_scripts.patch) get a positive review from me.\n\nThis doesn't work, probably my fault.  The issue is that the script \"sage-upgrade\" doesn't get upgraded in the process.  So I think moving makefile should happen at the end of the \"install\" script instead, since this gets downloaded before it gets run.  (In particular, upgrading didn't rename \"makefile\" when I tested it.)  Try this patch to \"install\" instead.",
    "created_at": "2010-11-11T01:15:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93740",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

The first two patches (10156_docs.patch and 10156_scripts.patch) get a positive review from me.

This doesn't work, probably my fault.  The issue is that the script "sage-upgrade" doesn't get upgraded in the process.  So I think moving makefile should happen at the end of the "install" script instead, since this gets downloaded before it gets run.  (In particular, upgrading didn't rename "makefile" when I tested it.)  Try this patch to "install" instead.



---

archive/issue_comments_093741.json:
```json
{
    "body": "Changed author from **Jeroen Demeyer** to **Jeroen Demeyer, John Palmieri**",
    "created_at": "2010-11-11T01:15:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93741",
    "user": "https://github.com/jhpalmieri"
}
```

Changed author from **Jeroen Demeyer** to **Jeroen Demeyer, John Palmieri**



---

archive/issue_comments_093742.json:
```json
{
    "body": "Attachment: **[install.gz](https://github.com/sagemath/sage/files/ticket10156/install.gz)**\n\nthe file spkg/install",
    "created_at": "2010-11-11T01:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93742",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[install.gz](https://github.com/sagemath/sage/files/ticket10156/install.gz)**

the file spkg/install



---

archive/issue_comments_093743.json:
```json
{
    "body": "Attachment: **[install.patch.gz](https://github.com/sagemath/sage/files/ticket10156/install.patch.gz)**\n\npatch for 'install'",
    "created_at": "2010-11-11T01:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93743",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[install.patch.gz](https://github.com/sagemath/sage/files/ticket10156/install.patch.gz)**

patch for 'install'



---

archive/issue_comments_093744.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jhpalmieri](#comment:18):\n> This doesn't work, probably my fault. \n\nBy \"this\", I meant the third patch, 10156_upgrade.patch.",
    "created_at": "2010-11-11T02:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93744",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jhpalmieri](#comment:18):
> This doesn't work, probably my fault. 

By "this", I meant the third patch, 10156_upgrade.patch.



---

archive/issue_comments_093745.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nFor what it's worth, my change to \"install\" works for me when upgrading on both Mac OS X (with its odd case-sensitivity) and Solaris.  I tested upgrading from 4.5.3 (which had \"makefile\") and 4.6.1.alpha0 (which had \"Makefile\").",
    "created_at": "2010-11-11T04:40:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93745",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

For what it's worth, my change to "install" works for me when upgrading on both Mac OS X (with its odd case-sensitivity) and Solaris.  I tested upgrading from 4.5.3 (which had "makefile") and 4.6.1.alpha0 (which had "Makefile").



---

archive/issue_comments_093746.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n This ticket has a few patches which should be applied when renaming `makefile` to `Makefile`.  See also #9799.\n+\n+Apply:\n+1. [attachment: 10156_doc.patch](https://github.com/sagemath/sage/files/ticket10156/10156_doc.patch.gz)\n+2. [attachment: 10156_scripts.patch](https://github.com/sagemath/sage/files/ticket10156/10156_scripts.patch.gz)\n+3. [attachment: install.patch](https://github.com/sagemath/sage/files/ticket10156/install.patch.gz)\n``````\n",
    "created_at": "2010-11-11T19:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93746",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,6 @@
 This ticket has a few patches which should be applied when renaming `makefile` to `Makefile`.  See also #9799.
+
+Apply:
+1. [attachment: 10156_doc.patch](https://github.com/sagemath/sage/files/ticket10156/10156_doc.patch.gz)
+2. [attachment: 10156_scripts.patch](https://github.com/sagemath/sage/files/ticket10156/10156_scripts.patch.gz)
+3. [attachment: install.patch](https://github.com/sagemath/sage/files/ticket10156/install.patch.gz)
``````




---

archive/issue_comments_093747.json:
```json
{
    "body": "Changed work issues from **copy makefile to Makefile during upgrade** to none",
    "created_at": "2010-11-15T12:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93747",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **copy makefile to Makefile during upgrade** to none



---

archive/issue_events_133025.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-15T12:43:57Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "title_is": "Rename top-level makefile to Makefile",
    "title_was": "Rename makefile to Makefile",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133025"
}
```



---

archive/issue_comments_093748.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2010-11-16T02:05:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93748",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_comments_093749.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI successfully updated from sage-4.5.2 on Fedora 13 and the patch did go the extra mile to make sure that it doesn't break upgrades. I'll set it to positive review.",
    "created_at": "2010-11-16T02:05:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93749",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">comment:23</div>

I successfully updated from sage-4.5.2 on Fedora 13 and the patch did go the extra mile to make sure that it doesn't break upgrades. I'll set it to positive review.



---

archive/issue_events_133026.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-11-16T02:05:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133026"
}
```



---

archive/issue_events_133027.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2010-11-16T02:05:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133027"
}
```



---

archive/issue_events_133028.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-16T08:21:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133028"
}
```



---

archive/issue_events_133029.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-16T08:21:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10156#event-133029"
}
```



---

archive/issue_comments_093750.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIt looks to me there are still a few files that refer to `makefile`. Shall I create a ticket for these:\n\n```\ndevel/sage-main/doc/output/latex/en/developer/developer.tex:Another way is to edit the file \\code{makefile} in the top level Sage\ndevel/sage-main/doc/output/latex/en/developer/developer.tex:After saving all changes to \\code{makefile}, we can parallel test with the\ndevel/sage-main/doc/output/latex/en/developer/developer.tex:these command, see the files \\code{SAGE\\_ROOT/makefile} and\ndevel/sage-main/doc/output/latex/en/developer/developer.tex:argument \\code{-long}. See the file \\code{SAGE\\_ROOT/makefile} for further\ndevel/sage-main/doc/output/latex/en/developer/developer.tex:\\code{SAGE\\_ROOT/makefile} for further details.\ndevel/sage-main/doc/output/latex/en/developer/developer.tex:the file \\code{SAGE\\_ROOT/makefile} takes care of the unpacking,\ndevel/sage-main/doc/output/latex/en/developer/developer.tex:\\code{\\$SAGE\\_ROOT/makefile} before using \\code{ptestlong}). See\n```",
    "created_at": "2010-11-16T17:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93750",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:25" align="right">comment:25</div>

It looks to me there are still a few files that refer to `makefile`. Shall I create a ticket for these:

```
devel/sage-main/doc/output/latex/en/developer/developer.tex:Another way is to edit the file \code{makefile} in the top level Sage
devel/sage-main/doc/output/latex/en/developer/developer.tex:After saving all changes to \code{makefile}, we can parallel test with the
devel/sage-main/doc/output/latex/en/developer/developer.tex:these command, see the files \code{SAGE\_ROOT/makefile} and
devel/sage-main/doc/output/latex/en/developer/developer.tex:argument \code{-long}. See the file \code{SAGE\_ROOT/makefile} for further
devel/sage-main/doc/output/latex/en/developer/developer.tex:\code{SAGE\_ROOT/makefile} for further details.
devel/sage-main/doc/output/latex/en/developer/developer.tex:the file \code{SAGE\_ROOT/makefile} takes care of the unpacking,
devel/sage-main/doc/output/latex/en/developer/developer.tex:\code{\$SAGE\_ROOT/makefile} before using \code{ptestlong}). See
```



---

archive/issue_comments_093751.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@sagetrac-drkirkby](#comment:25):\n> It looks to me there are still a few files that refer to `makefile`. Shall I create a ticket for these:\n> \n> ```\n> devel/sage-main/doc/output/latex/en/developer/developer.tex:Another way is to edit the file \\code{makefile} in the top level Sage\n> devel/sage-main/doc/output/latex/en/developer/developer.tex:After saving all changes to \\code{makefile}, we can parallel test with the\n> devel/sage-main/doc/output/latex/en/developer/developer.tex:these command, see the files \\code{SAGE\\_ROOT/makefile} and\n> devel/sage-main/doc/output/latex/en/developer/developer.tex:argument \\code{-long}. See the file \\code{SAGE\\_ROOT/makefile} for further\n> devel/sage-main/doc/output/latex/en/developer/developer.tex:\\code{SAGE\\_ROOT/makefile} for further details.\n> devel/sage-main/doc/output/latex/en/developer/developer.tex:the file \\code{SAGE\\_ROOT/makefile} takes care of the unpacking,\n> devel/sage-main/doc/output/latex/en/developer/developer.tex:\\code{\\$SAGE\\_ROOT/makefile} before using \\code{ptestlong}). See\n> ```\n\nThese are all in the *output* directory.  Could it be that you did not rebuild the pdf documentation after applying these tickets and are finding the old tex files?",
    "created_at": "2010-11-16T18:04:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93751",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@sagetrac-drkirkby](#comment:25):
> It looks to me there are still a few files that refer to `makefile`. Shall I create a ticket for these:
> 
> ```
> devel/sage-main/doc/output/latex/en/developer/developer.tex:Another way is to edit the file \code{makefile} in the top level Sage
> devel/sage-main/doc/output/latex/en/developer/developer.tex:After saving all changes to \code{makefile}, we can parallel test with the
> devel/sage-main/doc/output/latex/en/developer/developer.tex:these command, see the files \code{SAGE\_ROOT/makefile} and
> devel/sage-main/doc/output/latex/en/developer/developer.tex:argument \code{-long}. See the file \code{SAGE\_ROOT/makefile} for further
> devel/sage-main/doc/output/latex/en/developer/developer.tex:\code{SAGE\_ROOT/makefile} for further details.
> devel/sage-main/doc/output/latex/en/developer/developer.tex:the file \code{SAGE\_ROOT/makefile} takes care of the unpacking,
> devel/sage-main/doc/output/latex/en/developer/developer.tex:\code{\$SAGE\_ROOT/makefile} before using \code{ptestlong}). See
> ```

These are all in the *output* directory.  Could it be that you did not rebuild the pdf documentation after applying these tickets and are finding the old tex files?



---

archive/issue_comments_093752.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jdemeyer](#comment:26):\n\n> These are all in the *output* directory.  Could it be that you did not rebuild the pdf documentation after applying these tickets and are finding the old tex files?\n\nYes, it is very possible. I'm just going to build Sage again from scratch, as I've messed around with various files. But I very much doubt I built the pdfs, so that explains it. \n\nDave",
    "created_at": "2010-11-16T19:41:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10156#issuecomment-93752",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jdemeyer](#comment:26):

> These are all in the *output* directory.  Could it be that you did not rebuild the pdf documentation after applying these tickets and are finding the old tex files?

Yes, it is very possible. I'm just going to build Sage again from scratch, as I've messed around with various files. But I very much doubt I built the pdfs, so that explains it. 

Dave
