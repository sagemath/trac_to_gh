# Issue 10256: make -1 modular symbols from eclib available to elliptic curves

archive/issues_010255.json:
```json
{
    "body": "This ticket is a follw-up from #10236. In there certain changes from #9476 and #9247 were reverted back. Here is what has to be done to make modular symbols with negative sign available for computations with elliptic curves, e.g. p-adic L-series.\n\nCurrently eclib can compute the space of modular symbols of sign = -1, but ECModularSymbol in sage.libs.cremona.newforms.pyx can not use them yet to compute {0,r}-\n\nOnce this is there, one can modify sage.schemes.elliptic_curves.ell_modular_symbols.py to allow sign = -1 in ModularSymbolECLIB. (Where one has to think a little bit about the normalization.) This would allow to switch in line 1098 of ell_rational_field.py and in line 131 of padic_lseries.py to make use_eclib=True to be default.\n\nAssignee: @JohnCremona\n\nCC:  @JohnCremona\n\nKeywords: modular symbols\n\nBranch/Commit: [49be7d89ed221986f0d3f6df7debf401f1694a3a](https://github.com/sagemath/sagetrac-mirror/commit/49be7d89ed221986f0d3f6df7debf401f1694a3a)\n\nReviewer: Chris Wuthrich\n\nAuthor: John Cremona\n\nDependencies: #22077\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/10256\n\n",
    "closed_at": "2017-01-21T21:21:57Z",
    "created_at": "2010-11-13T12:19:07Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "make -1 modular symbols from eclib available to elliptic curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10256",
    "user": "https://github.com/categorie"
}
```
This ticket is a follw-up from #10236. In there certain changes from #9476 and #9247 were reverted back. Here is what has to be done to make modular symbols with negative sign available for computations with elliptic curves, e.g. p-adic L-series.

Currently eclib can compute the space of modular symbols of sign = -1, but ECModularSymbol in sage.libs.cremona.newforms.pyx can not use them yet to compute {0,r}-

Once this is there, one can modify sage.schemes.elliptic_curves.ell_modular_symbols.py to allow sign = -1 in ModularSymbolECLIB. (Where one has to think a little bit about the normalization.) This would allow to switch in line 1098 of ell_rational_field.py and in line 131 of padic_lseries.py to make use_eclib=True to be default.

Assignee: @JohnCremona

CC:  @JohnCremona

Keywords: modular symbols

Branch/Commit: [49be7d89ed221986f0d3f6df7debf401f1694a3a](https://github.com/sagemath/sagetrac-mirror/commit/49be7d89ed221986f0d3f6df7debf401f1694a3a)

Reviewer: Chris Wuthrich

Author: John Cremona

Dependencies: #22077

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/10256





---

archive/issue_comments_131952.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe current eclib (eclib-20100711.spkg) has normalization problems in the \"sign=-1\" modular symbols, which I am currently working on fixing.  The Sage interface should perhaps wait until that is done.",
    "created_at": "2010-11-18T21:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131952",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
The current eclib (eclib-20100711.spkg) has normalization problems in the "sign=-1" modular symbols, which I am currently working on fixing.  The Sage interface should perhaps wait until that is done.



---

archive/issue_events_031709.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31709"
}
```



---

archive/issue_events_031710.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31710"
}
```



---

archive/issue_events_031711.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31711"
}
```



---

archive/issue_events_031712.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31712"
}
```



---

archive/issue_events_031713.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31713"
}
```



---

archive/issue_events_031714.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31714"
}
```



---

archive/issue_events_031715.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31715"
}
```



---

archive/issue_comments_131953.json:
```json
{
    "body": "<a id='comment:6'></a>\nPing ?\n\nI was working on #20864 when I changed the plus symbols to be computed by eclib by default. I wondered if the negative could be added now? Sage normalises the negative ones correctly now. We only need some rational multiple from eclib.",
    "created_at": "2016-07-05T13:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131953",
    "user": "https://github.com/categorie"
}
```

<a id='comment:6'></a>
Ping ?

I was working on #20864 when I changed the plus symbols to be computed by eclib by default. I wondered if the negative could be added now? Sage normalises the negative ones correctly now. We only need some rational multiple from eclib.



---

archive/issue_comments_131954.json:
```json
{
    "body": "<a id='comment:7'></a>\nImplementing this just went up my to-do list, after hearing a lecture by Mazur on his experimental work with Rubin which makes heavy use of this modular symbol functionality.  Karl told me that it would save them a lot of time for minus symbols to be available from eclib.  As soon as I can, I will.",
    "created_at": "2016-11-02T14:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131954",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>
Implementing this just went up my to-do list, after hearing a lecture by Mazur on his experimental work with Rubin which makes heavy use of this modular symbol functionality.  Karl told me that it would save them a lot of time for minus symbols to be available from eclib.  As soon as I can, I will.



---

archive/issue_comments_131955.json:
```json
{
    "body": "<a id='comment:8'></a>\nExcellent. I will help of course.\n\nI am curious what Rubin and Mazur are up to, too.",
    "created_at": "2016-11-02T15:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131955",
    "user": "https://github.com/categorie"
}
```

<a id='comment:8'></a>
Excellent. I will help of course.

I am curious what Rubin and Mazur are up to, too.



---

archive/issue_comments_131956.json:
```json
{
    "body": "<a id='comment:9'></a>\nI will make this ticket dependent on another which will upgrade the eclib version in Sage to one which will be released later today.  Two reasons: (1) I fixed a bug which sometimes caused the plus symbols to all be mutiplied by a factor >1 (in known examples, a factor of 2).  (2) I have added a facility to eclib to base symbols at infinity (oo) instead of 0, i.e. it computes the image of either {0,r} or {oo,r} for a given rational.\n\nExample:\n\n```\nsage: E=EllipticCurve(\"121b1\")\nsage: M=E.modular_symbol(1)\nWarning : Could not normalize the modular symbols, maybe all further results will be multiplied by -1, 2 or -2.\nsage: M(1/7)\n-2\n```\nHere the error message is coming from Sage, not eclib.  And the correct value is 1 though the current eclib version returns 2.",
    "created_at": "2016-12-19T13:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131956",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>
I will make this ticket dependent on another which will upgrade the eclib version in Sage to one which will be released later today.  Two reasons: (1) I fixed a bug which sometimes caused the plus symbols to all be mutiplied by a factor >1 (in known examples, a factor of 2).  (2) I have added a facility to eclib to base symbols at infinity (oo) instead of 0, i.e. it computes the image of either {0,r} or {oo,r} for a given rational.

Example:

```
sage: E=EllipticCurve("121b1")
sage: M=E.modular_symbol(1)
Warning : Could not normalize the modular symbols, maybe all further results will be multiplied by -1, 2 or -2.
sage: M(1/7)
-2
```
Here the error message is coming from Sage, not eclib.  And the correct value is 1 though the current eclib version returns 2.



---

archive/issue_comments_131957.json:
```json
{
    "body": "<a id='comment:10'></a>\nSee #22077",
    "created_at": "2016-12-19T14:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131957",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>
See #22077



---

archive/issue_comments_131958.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#22077\"",
    "created_at": "2016-12-19T16:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131958",
    "user": "https://github.com/JohnCremona"
}
```

Changing dependencies from "" to "#22077"



---

archive/issue_comments_131959.json:
```json
{
    "body": "<a id='comment:11'></a>\n#22077 is now ready for review.  I will base by branch for this ticket on that one, so am now setting that to be a prerequisite to this.",
    "created_at": "2016-12-19T16:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131959",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'></a>
#22077 is now ready for review.  I will base by branch for this ticket on that one, so am now setting that to be a prerequisite to this.



---

archive/issue_comments_131960.json:
```json
{
    "body": "Changing author from \"\" to \"John Cremona\"",
    "created_at": "2016-12-19T16:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131960",
    "user": "https://github.com/JohnCremona"
}
```

Changing author from "" to "John Cremona"



---

archive/issue_comments_131961.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cremona/10256\"",
    "created_at": "2016-12-30T18:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131961",
    "user": "https://github.com/JohnCremona"
}
```

Changing branch from "" to "u/cremona/10256"



---

archive/issue_comments_131962.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-30T18:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131962",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_131963.json:
```json
{
    "body": "<a id='comment:12'></a>\nI have set this to Needs Review but note that #22077 (upgrading eclib to version v20161230) is a dependency and is currently also waiting review.",
    "created_at": "2016-12-30T18:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131963",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:12'></a>
I have set this to Needs Review but note that #22077 (upgrading eclib to version v20161230) is a dependency and is currently also waiting review.



---

archive/issue_events_031716.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2016-12-30T18:26:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31716"
}
```



---

archive/issue_events_031717.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2016-12-30T18:26:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31717"
}
```



---

archive/issue_comments_131964.json:
```json
{
    "body": "Changing commit from \"\" to \"6637227842765bdf48022f7c7025d3bcb310b323\"",
    "created_at": "2016-12-30T18:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131964",
    "user": "https://github.com/JohnCremona"
}
```

Changing commit from "" to "6637227842765bdf48022f7c7025d3bcb310b323"



---

archive/issue_comments_131965.json:
```json
{
    "body": "<a id='comment:13'></a>\nI am working on this. I spotted a few misprints, but more seriously:\n\n* This code also changes the normalization for modular symbols in sage. In particular, the warning for 121b1 is no longer there, despite the function returning the wrong result.\n\n```\nsage: E = EllipticCurve(\"121b1\")\nsage: m = E.modular_symbol(implementation=\"sage\")\nsage: m(1/7)\n-1/2\nsage: me = E.modular_symbol()\nsage: me(1/7)\n1/2\n```\n\n* The second thing is that there are more places which need to change taking eclib automatically for negative symbols. Like line 219 in padic_lseries.py",
    "created_at": "2017-01-02T19:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131965",
    "user": "https://github.com/categorie"
}
```

<a id='comment:13'></a>
I am working on this. I spotted a few misprints, but more seriously:

* This code also changes the normalization for modular symbols in sage. In particular, the warning for 121b1 is no longer there, despite the function returning the wrong result.

```
sage: E = EllipticCurve("121b1")
sage: m = E.modular_symbol(implementation="sage")
sage: m(1/7)
-1/2
sage: me = E.modular_symbol()
sage: me(1/7)
1/2
```

* The second thing is that there are more places which need to change taking eclib automatically for negative symbols. Like line 219 in padic_lseries.py



---

archive/issue_comments_131966.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-02T19:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131966",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_131967.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Chris Wuthrich\"",
    "created_at": "2017-01-03T10:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131967",
    "user": "https://github.com/categorie"
}
```

Changing reviewer from "" to "Chris Wuthrich"



---

archive/issue_comments_131968.json:
```json
{
    "body": "Changing branch from \"u/cremona/10256\" to \"u/wuthrich/ticket/10256\"",
    "created_at": "2017-01-03T10:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131968",
    "user": "https://github.com/categorie"
}
```

Changing branch from "u/cremona/10256" to "u/wuthrich/ticket/10256"



---

archive/issue_comments_131969.json:
```json
{
    "body": "<a id='comment:14'></a>\nI found that eclib returns incorrect values currently. This is what causes all the test failures in sage.modular.pollack_stevens after my additional changes. Here is the example I am certain about:\n\n```\nsage: E = EllipticCurve('11a')\nsage: m = E.modular_symbol(-1,implementation=\"eclib\")\nsage: ms = E.modular_symbol(-1,implementation=\"sage\")\nsage: m(-1/3)\n1/2\nsage: ms(-1/3)\n-1/2\nsage: la = sum(E.an(n)/n*exp(2*RR.pi()*I*(-1/3)*n) for n in [1..100000]); la\n-0.387171140749021 - 1.47418172900132*I\nsage: E.period_lattice().basis()\n(1.26920930427955, 0.634604652139777 + 1.45881661693850*I)\n```\n\nThis shows that sage's normalisation is correct and eclib has missed the sign.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[1b75fcc](https://github.com/sagemath/sagetrac-mirror/commit/1b75fcc688b34011445e7b933238c1f8ef6c51d2)|`Merge branch 'u/cremona/22077' of git://trac.sagemath.org/sage into eclib`|\n|[4f51d79](https://github.com/sagemath/sagetrac-mirror/commit/4f51d79e31d8c3857893db289fc5c8a1a248fe61)|`Merge branch 'u/cremona/10256' of git://trac.sagemath.org/sage into eclib`|\n|[dcacece](https://github.com/sagemath/sagetrac-mirror/commit/dcacece0987125d46cf82b64407e2877940d8477)|`trac #10256: reviewer patch first part`|\n|[724a205](https://github.com/sagemath/sagetrac-mirror/commit/724a20522ca193a859f85dfe275bb876613edccd)|`trac #10256: highlight wrong values`|",
    "created_at": "2017-01-03T10:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131969",
    "user": "https://github.com/categorie"
}
```

<a id='comment:14'></a>
I found that eclib returns incorrect values currently. This is what causes all the test failures in sage.modular.pollack_stevens after my additional changes. Here is the example I am certain about:

```
sage: E = EllipticCurve('11a')
sage: m = E.modular_symbol(-1,implementation="eclib")
sage: ms = E.modular_symbol(-1,implementation="sage")
sage: m(-1/3)
1/2
sage: ms(-1/3)
-1/2
sage: la = sum(E.an(n)/n*exp(2*RR.pi()*I*(-1/3)*n) for n in [1..100000]); la
-0.387171140749021 - 1.47418172900132*I
sage: E.period_lattice().basis()
(1.26920930427955, 0.634604652139777 + 1.45881661693850*I)
```

This shows that sage's normalisation is correct and eclib has missed the sign.

---
New commits:
|                                                                                                                                          |                                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[1b75fcc](https://github.com/sagemath/sagetrac-mirror/commit/1b75fcc688b34011445e7b933238c1f8ef6c51d2)|`Merge branch 'u/cremona/22077' of git://trac.sagemath.org/sage into eclib`|
|[4f51d79](https://github.com/sagemath/sagetrac-mirror/commit/4f51d79e31d8c3857893db289fc5c8a1a248fe61)|`Merge branch 'u/cremona/10256' of git://trac.sagemath.org/sage into eclib`|
|[dcacece](https://github.com/sagemath/sagetrac-mirror/commit/dcacece0987125d46cf82b64407e2877940d8477)|`trac #10256: reviewer patch first part`|
|[724a205](https://github.com/sagemath/sagetrac-mirror/commit/724a20522ca193a859f85dfe275bb876613edccd)|`trac #10256: highlight wrong values`|



---

archive/issue_comments_131970.json:
```json
{
    "body": "Changing commit from \"6637227842765bdf48022f7c7025d3bcb310b323\" to \"724a20522ca193a859f85dfe275bb876613edccd\"",
    "created_at": "2017-01-03T10:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131970",
    "user": "https://github.com/categorie"
}
```

Changing commit from "6637227842765bdf48022f7c7025d3bcb310b323" to "724a20522ca193a859f85dfe275bb876613edccd"



---

archive/issue_comments_131971.json:
```json
{
    "body": "<a id='comment:15'></a>\nAt this stage, it goes back to John to figure out - if he wants - how to get the correct sign already in eclib.\n\nIn the long term, once #21046 is in, I can use the numerical ones to do a very quick and efficient scaling. So one could also wait.\n\nThe last modification I did was to highlight the above value in the doctest. There might be others that are wrong.",
    "created_at": "2017-01-03T10:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131971",
    "user": "https://github.com/categorie"
}
```

<a id='comment:15'></a>
At this stage, it goes back to John to figure out - if he wants - how to get the correct sign already in eclib.

In the long term, once #21046 is in, I can use the numerical ones to do a very quick and efficient scaling. So one could also wait.

The last modification I did was to highlight the above value in the doctest. There might be others that are wrong.



---

archive/issue_comments_131972.json:
```json
{
    "body": "<a id='comment:16'></a>\nI am looking at this right now to see if it is really eclib and not the interface,  Back soon...",
    "created_at": "2017-01-03T10:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131972",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:16'></a>
I am looking at this right now to see if it is really eclib and not the interface,  Back soon...



---

archive/issue_comments_131973.json:
```json
{
    "body": "<a id='comment:17'></a>\nWhen I run eclib's own program (called ecnf) on this curve [0,-1,1,-10,-20] I find that {oo, 1/3} and {oo, -1/3} both map to (-3/5,-1), meaning that the plus symbol is -3/5 and the minus symbol is in both cases -1.  This must be a bug since (by definition) theminus symbol should have been negated.\n\nApologies.  This will require yet another fix to eclib, hence to #22077.  I'll work on that right away.",
    "created_at": "2017-01-03T10:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131973",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:17'></a>
When I run eclib's own program (called ecnf) on this curve [0,-1,1,-10,-20] I find that {oo, 1/3} and {oo, -1/3} both map to (-3/5,-1), meaning that the plus symbol is -3/5 and the minus symbol is in both cases -1.  This must be a bug since (by definition) theminus symbol should have been negated.

Apologies.  This will require yet another fix to eclib, hence to #22077.  I'll work on that right away.



---

archive/issue_comments_131974.json:
```json
{
    "body": "<a id='comment:18'></a>\nThe previous comment needs correcting since I was testing on the wrong machine and not actually useing the latest eclib version v20161230.  Now eclib's ecnf program maps {oo,-1/3} to (-3/5,+1) as it should for consistency.  But consistency is not correctness, and in fact eclib only normalizes (w.r.t. sign) the plus symbols, and then only when L(E,1) is non-zero.\n\nHence there is more to be done within eclib to get the signs right.  I have set #22077 back to 'needs work' but it would also be possible for the sign to be checked on the Sage side.",
    "created_at": "2017-01-03T11:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131974",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:18'></a>
The previous comment needs correcting since I was testing on the wrong machine and not actually useing the latest eclib version v20161230.  Now eclib's ecnf program maps {oo,-1/3} to (-3/5,+1) as it should for consistency.  But consistency is not correctness, and in fact eclib only normalizes (w.r.t. sign) the plus symbols, and then only when L(E,1) is non-zero.

Hence there is more to be done within eclib to get the signs right.  I have set #22077 back to 'needs work' but it would also be possible for the sign to be checked on the Sage side.



---

archive/issue_comments_131975.json:
```json
{
    "body": "<a id='comment:19'></a>\nThere's a new version of eclib (v20170104) over at #22077 and my last branch on this ticket (u/cremona/10256) works OK with it.  I have not yet merged and tested u/wuthrich/ticket/10256 but I did test with wuthrich's independent test script.",
    "created_at": "2017-01-04T20:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131975",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:19'></a>
There's a new version of eclib (v20170104) over at #22077 and my last branch on this ticket (u/cremona/10256) works OK with it.  I have not yet merged and tested u/wuthrich/ticket/10256 but I did test with wuthrich's independent test script.



---

archive/issue_comments_131976.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[7e695e8](https://github.com/sagemath/sagetrac-mirror/commit/7e695e8c6ce01db84035d1206e615661d9678e5f)|`updated eclib to v20170103`|\n|[777fa61](https://github.com/sagemath/sagetrac-mirror/commit/777fa611f9cb36139b93e8ed13187594582b7514)|`Merge branch 'u/cremona/22077' of git://trac.sagemath.org/sage into eclib`|\n|[e101d21](https://github.com/sagemath/sagetrac-mirror/commit/e101d21c8e42b3e7fdcfb4441292df6602255216)|`trac #10256: references`|\n|[8fabe91](https://github.com/sagemath/sagetrac-mirror/commit/8fabe91a3ff9c42a7a4d719a305d1f9924f80f1b)|`updated eclib to v20170104`|\n|[1c78871](https://github.com/sagemath/sagetrac-mirror/commit/1c7887157a6d7ae068c28637152c56e3d8c00804)|`updated eclib to v20170104 again`|\n|[b12bc13](https://github.com/sagemath/sagetrac-mirror/commit/b12bc13d0fbb8b7c735cbf21f199967a3792dcbc)|`Merge branch 'u/cremona/22077' of git://trac.sagemath.org/sage into eclib`|\n|[49aa039](https://github.com/sagemath/sagetrac-mirror/commit/49aa0395e6fb7f3d09b0724461db2dc4e7b69057)|`trac #10256: update latest version of eclib from #22077`|",
    "created_at": "2017-01-04T21:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[7e695e8](https://github.com/sagemath/sagetrac-mirror/commit/7e695e8c6ce01db84035d1206e615661d9678e5f)|`updated eclib to v20170103`|
|[777fa61](https://github.com/sagemath/sagetrac-mirror/commit/777fa611f9cb36139b93e8ed13187594582b7514)|`Merge branch 'u/cremona/22077' of git://trac.sagemath.org/sage into eclib`|
|[e101d21](https://github.com/sagemath/sagetrac-mirror/commit/e101d21c8e42b3e7fdcfb4441292df6602255216)|`trac #10256: references`|
|[8fabe91](https://github.com/sagemath/sagetrac-mirror/commit/8fabe91a3ff9c42a7a4d719a305d1f9924f80f1b)|`updated eclib to v20170104`|
|[1c78871](https://github.com/sagemath/sagetrac-mirror/commit/1c7887157a6d7ae068c28637152c56e3d8c00804)|`updated eclib to v20170104 again`|
|[b12bc13](https://github.com/sagemath/sagetrac-mirror/commit/b12bc13d0fbb8b7c735cbf21f199967a3792dcbc)|`Merge branch 'u/cremona/22077' of git://trac.sagemath.org/sage into eclib`|
|[49aa039](https://github.com/sagemath/sagetrac-mirror/commit/49aa0395e6fb7f3d09b0724461db2dc4e7b69057)|`trac #10256: update latest version of eclib from #22077`|



---

archive/issue_comments_131977.json:
```json
{
    "body": "Changing commit from \"724a20522ca193a859f85dfe275bb876613edccd\" to \"49aa0395e6fb7f3d09b0724461db2dc4e7b69057\"",
    "created_at": "2017-01-04T21:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131977",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "724a20522ca193a859f85dfe275bb876613edccd" to "49aa0395e6fb7f3d09b0724461db2dc4e7b69057"



---

archive/issue_comments_131978.json:
```json
{
    "body": "<a id='comment:21'></a>\nWith the latest changes to eclib, it looks good. Testing now.",
    "created_at": "2017-01-04T21:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131978",
    "user": "https://github.com/categorie"
}
```

<a id='comment:21'></a>
With the latest changes to eclib, it looks good. Testing now.



---

archive/issue_comments_131979.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-04T21:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131979",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_131980.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-05T13:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131980",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_131981.json:
```json
{
    "body": "<a id='comment:22'></a>\nmissed some doctests.",
    "created_at": "2017-01-05T13:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131981",
    "user": "https://github.com/categorie"
}
```

<a id='comment:22'></a>
missed some doctests.



---

archive/issue_comments_131982.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [wuthrich](#comment%3A22):\n> missed some doctests.\n\n\nDou mean that some are missing, or that they don't work?",
    "created_at": "2017-01-05T14:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131982",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:23'></a>
Replying to [wuthrich](#comment%3A22):
> missed some doctests.


Dou mean that some are missing, or that they don't work?



---

archive/issue_comments_131983.json:
```json
{
    "body": "<a id='comment:24'></a>\nSorry, I had to go, but now I am back. I meant: I missed updating the doctests in newforms.pyx with all the merging forth and back they got lost. Probably you are right and cleaning up could actually help. So one should take your new branch for #22077 and change the files in \nin elliptic_curves:\n* ell_modular_symbols\n* ell_rational_field\n* padic_lseries\n* padics\nand in modular.pollack_stevens\n* space\nThere are also three misprints in newforms in libs.eclib which are better corrected in #22077.\n\nShall I do it? Or have you almost done it already?",
    "created_at": "2017-01-05T19:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131983",
    "user": "https://github.com/categorie"
}
```

<a id='comment:24'></a>
Sorry, I had to go, but now I am back. I meant: I missed updating the doctests in newforms.pyx with all the merging forth and back they got lost. Probably you are right and cleaning up could actually help. So one should take your new branch for #22077 and change the files in 
in elliptic_curves:
* ell_modular_symbols
* ell_rational_field
* padic_lseries
* padics
and in modular.pollack_stevens
* space
There are also three misprints in newforms in libs.eclib which are better corrected in #22077.

Shall I do it? Or have you almost done it already?



---

archive/issue_comments_131984.json:
```json
{
    "body": "<a id='comment:25'></a>\nJohn, I fear we are doing parallel work. Upload yours.\n\nI did the changes here, but I ran into a very strange compilation error for newforms.pyx. Cython did not recognise \"pair\". I added an import, but then I got other compilation errors like \n\n```\n_sp = self.nfs.plus_modular_symbol(_r, 0, int(base_at_infinity))\nsage/libs/eclib/newforms.pyx:347:46: Call with wrong number of arguments (expected 1, got 3)\n```\nHonestly I don't understand. So if yours works, I am happy to ditch what I have done here.",
    "created_at": "2017-01-05T21:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131984",
    "user": "https://github.com/categorie"
}
```

<a id='comment:25'></a>
John, I fear we are doing parallel work. Upload yours.

I did the changes here, but I ran into a very strange compilation error for newforms.pyx. Cython did not recognise "pair". I added an import, but then I got other compilation errors like 

```
_sp = self.nfs.plus_modular_symbol(_r, 0, int(base_at_infinity))
sage/libs/eclib/newforms.pyx:347:46: Call with wrong number of arguments (expected 1, got 3)
```
Honestly I don't understand. So if yours works, I am happy to ditch what I have done here.



---

archive/issue_comments_131985.json:
```json
{
    "body": "<a id='comment:26'></a>\nSorry I totally messed up on the other ticket, and this one will have to wait until I sort that out, which will have to be Friday.\n\nCorrection (next morning): #22077 is fine and back to \"needs review\" -- see the remarks there.  Nothing was messed up at all.  I'll now finish cleaning up this one.",
    "created_at": "2017-01-05T21:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131985",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:26'></a>
Sorry I totally messed up on the other ticket, and this one will have to wait until I sort that out, which will have to be Friday.

Correction (next morning): #22077 is fine and back to "needs review" -- see the remarks there.  Nothing was messed up at all.  I'll now finish cleaning up this one.



---

archive/issue_comments_131986.json:
```json
{
    "body": "Changing branch from \"u/wuthrich/ticket/10256\" to \"u/cremona/10256new\"",
    "created_at": "2017-01-06T10:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131986",
    "user": "https://github.com/JohnCremona"
}
```

Changing branch from "u/wuthrich/ticket/10256" to "u/cremona/10256new"



---

archive/issue_comments_131987.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-06T10:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131987",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_131988.json:
```json
{
    "body": "Changing commit from \"49aa0395e6fb7f3d09b0724461db2dc4e7b69057\" to \"\"",
    "created_at": "2017-01-06T10:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131988",
    "user": "https://github.com/JohnCremona"
}
```

Changing commit from "49aa0395e6fb7f3d09b0724461db2dc4e7b69057" to ""



---

archive/issue_comments_131989.json:
```json
{
    "body": "<a id='comment:28'></a>\nOK so here's what I did.  Starting from the new branch at #22077, I first used \"git cherry-pick\" to pick the 4 commits (6f517b3, 6301cc5, 6637227, e81588a) I had originally made here (which had been interspersed with eclib updates); only the first of those had some minor merge conflicts which I fixed.  I then used rebase to sqush thos together into one commit ee879ee.  Second, I did similarly with the 3 reviewer commits (dcacece, 724a205, e101d21), squashing into one (0db2a00).  Lastly I added one more commit after testing revealed one doctest failing (49be7d8).\n\nSo I think that the 3 top commits on the new branch u/cremona/10256new contain all previous work while being based on u/cremona/22077new which is itself based on 7.5.rc1.\n\nIf there are additional changes needed here, that's fine as long as they are based on this (and don't require more changes to eclib itself...)",
    "created_at": "2017-01-06T10:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131989",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:28'></a>
OK so here's what I did.  Starting from the new branch at #22077, I first used "git cherry-pick" to pick the 4 commits (6f517b3, 6301cc5, 6637227, e81588a) I had originally made here (which had been interspersed with eclib updates); only the first of those had some minor merge conflicts which I fixed.  I then used rebase to sqush thos together into one commit ee879ee.  Second, I did similarly with the 3 reviewer commits (dcacece, 724a205, e101d21), squashing into one (0db2a00).  Lastly I added one more commit after testing revealed one doctest failing (49be7d8).

So I think that the 3 top commits on the new branch u/cremona/10256new contain all previous work while being based on u/cremona/22077new which is itself based on 7.5.rc1.

If there are additional changes needed here, that's fine as long as they are based on this (and don't require more changes to eclib itself...)



---

archive/issue_comments_131990.json:
```json
{
    "body": "<a id='comment:29'></a>\nYour branch doesn't exist, John. Mine still does not work.",
    "created_at": "2017-01-06T20:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131990",
    "user": "https://github.com/categorie"
}
```

<a id='comment:29'></a>
Your branch doesn't exist, John. Mine still does not work.



---

archive/issue_comments_131991.json:
```json
{
    "body": "Changing commit from \"\" to \"49be7d89ed221986f0d3f6df7debf401f1694a3a\"",
    "created_at": "2017-01-06T21:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131991",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "49be7d89ed221986f0d3f6df7debf401f1694a3a"



---

archive/issue_comments_131992.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[cb3fd05](https://github.com/sagemath/sagetrac-mirror/commit/cb3fd05c95fb3afbaed9ba621038293b5412d6e0)|`#22077 update eclib to v20170104`|\n|[ee879ee](https://github.com/sagemath/sagetrac-mirror/commit/ee879ee187b19827c1878d514c76ce8b17574bb3)|`work in progress on modular symbols`|\n|[0db2a00](https://github.com/sagemath/sagetrac-mirror/commit/0db2a002f45b1249af0d0c9ac4c9978afe4686d4)|`trac #10256: reviewer patches: first part, highlight wrong values, references`|\n|[49be7d8](https://github.com/sagemath/sagetrac-mirror/commit/49be7d89ed221986f0d3f6df7debf401f1694a3a)|`10256: fix one doctest`|",
    "created_at": "2017-01-06T21:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[cb3fd05](https://github.com/sagemath/sagetrac-mirror/commit/cb3fd05c95fb3afbaed9ba621038293b5412d6e0)|`#22077 update eclib to v20170104`|
|[ee879ee](https://github.com/sagemath/sagetrac-mirror/commit/ee879ee187b19827c1878d514c76ce8b17574bb3)|`work in progress on modular symbols`|
|[0db2a00](https://github.com/sagemath/sagetrac-mirror/commit/0db2a002f45b1249af0d0c9ac4c9978afe4686d4)|`trac #10256: reviewer patches: first part, highlight wrong values, references`|
|[49be7d8](https://github.com/sagemath/sagetrac-mirror/commit/49be7d89ed221986f0d3f6df7debf401f1694a3a)|`10256: fix one doctest`|



---

archive/issue_comments_131993.json:
```json
{
    "body": "<a id='comment:31'></a>\n...it does help if you don't forget to actually push the branch to trac....it's there now",
    "created_at": "2017-01-06T21:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131993",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:31'></a>
...it does help if you don't forget to actually push the branch to trac....it's there now



---

archive/issue_comments_131994.json:
```json
{
    "body": "<a id='comment:32'></a>\nAll tests passed, the documentation, too. Thanks a lot.",
    "created_at": "2017-01-07T09:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131994",
    "user": "https://github.com/categorie"
}
```

<a id='comment:32'></a>
All tests passed, the documentation, too. Thanks a lot.



---

archive/issue_comments_131995.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-07T09:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131995",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_031718.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T21:21:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10256#event-31718"
}
```



---

archive/issue_comments_131996.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-21T21:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131996",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_131997.json:
```json
{
    "body": "Changing branch from \"u/cremona/10256new\" to \"49be7d89ed221986f0d3f6df7debf401f1694a3a\"",
    "created_at": "2017-01-21T21:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10256#issuecomment-131997",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/cremona/10256new" to "49be7d89ed221986f0d3f6df7debf401f1694a3a"
