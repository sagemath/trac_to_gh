# Issue 10295: Upgrade and optimize pexpect

archive/issues_010294.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?\n\nSee also #10294.\n\n**New upstream tarballs**:\n* https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz\n* https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz\n* http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.6.1.tar\n\n**Patches included and submitted upstream**:\n* [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n* [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)\n* [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)\n* [https://github.com/pexpect/pexpect/pull/307](https://github.com/pexpect/pexpect/pull/307)\n\n**Note** that this branch *includes* #19616.\n\n---\n\n**Throughput timings** (best out of 5):\n\npexpect 2.0 upstream:\n\n```\nsage: %time _ = str(gp(\"2^2^22\"))\nCPU times: user 184 ms, sys: 4 ms, total: 188 ms\nWall time: 384 ms\n```\n\npexpect 4.0.1 upstream:\n\n```\nsage: %time _ = str(gp(\"2^2^22\"))\nCPU times: user 208 ms, sys: 4 ms, total: 212 ms\nWall time: 405 ms\n```\n\npexpect 4.0.1 + Sage patches:\n\n```\nsage: %time _ = str(gp(\"2^2^22\"))\nCPU times: user 9 ms, sys: 7 ms, total: 16 ms\nWall time: 209 ms\n```\n\n---\n\n**Latency timings** (best out of 5):\n\npexpect 2.0 upstream:\n\n```\nsage: gp(1);\nsage: %time _ = [gp(i) for i in range(10^4)]\nCPU times: user 2.96 s, sys: 855 ms, total: 3.82 s\nWall time: 4.52 s\n```\n\npexpect 4.0.1 upstream:\n\n```\nsage: gp(1);\nsage: %time _ = [gp(i) for i in range(10^4)]\nCPU times: user 2.61 s, sys: 758 ms, total: 3.37 s\nWall time: 3.48 s\n```\n\npexpect 4.0.1 + Sage patches:\n\n```\nsage: gp(1);\nsage: %time _ = [gp(i) for i in range(10^4)]\nCPU times: user 2.3 s, sys: 999 ms, total: 3.3 s\nWall time: 3.4 s\n```\n\nDepends on #19671\n\nCC:  @sagetrac-drkirkby @nexttime @sagetrac-Vincent-Neri\n\nKeywords: **pexpect upgrade**\n\nBranch/Commit: **[9351ccb](https://github.com/sagemath/sagetrac-mirror/commit/9351ccb53d1d3c1d387c11e0c57443b53d1cfdd1)**\n\nUpstream: **Reported upstream. Developers acknowledge bug.**\n\nReviewer: **Jeroen Demeyer, Bill Page**\n\nAuthor: **Fran\u00e7ois Bissey, Bill Page, Jeroen Demeyer**\n\nComponent: **interfaces**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10295_\n\n",
    "closed_at": "2015-12-22T19:50:40Z",
    "created_at": "2010-11-20T08:53:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade and optimize pexpect",
    "type": "issue",
    "updated_at": "2015-12-22T19:50:40Z",
    "url": "https://github.com/sagemath/sage/issues/10295",
    "user": "https://github.com/simon-king-jena"
}
```
We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?

See also #10294.

**New upstream tarballs**:
* https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz
* https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz
* http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.6.1.tar

**Patches included and submitted upstream**:
* [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
* [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)
* [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)
* [https://github.com/pexpect/pexpect/pull/307](https://github.com/pexpect/pexpect/pull/307)

**Note** that this branch *includes* #19616.

---

**Throughput timings** (best out of 5):

pexpect 2.0 upstream:

```
sage: %time _ = str(gp("2^2^22"))
CPU times: user 184 ms, sys: 4 ms, total: 188 ms
Wall time: 384 ms
```

pexpect 4.0.1 upstream:

```
sage: %time _ = str(gp("2^2^22"))
CPU times: user 208 ms, sys: 4 ms, total: 212 ms
Wall time: 405 ms
```

pexpect 4.0.1 + Sage patches:

```
sage: %time _ = str(gp("2^2^22"))
CPU times: user 9 ms, sys: 7 ms, total: 16 ms
Wall time: 209 ms
```

---

**Latency timings** (best out of 5):

pexpect 2.0 upstream:

```
sage: gp(1);
sage: %time _ = [gp(i) for i in range(10^4)]
CPU times: user 2.96 s, sys: 855 ms, total: 3.82 s
Wall time: 4.52 s
```

pexpect 4.0.1 upstream:

```
sage: gp(1);
sage: %time _ = [gp(i) for i in range(10^4)]
CPU times: user 2.61 s, sys: 758 ms, total: 3.37 s
Wall time: 3.48 s
```

pexpect 4.0.1 + Sage patches:

```
sage: gp(1);
sage: %time _ = [gp(i) for i in range(10^4)]
CPU times: user 2.3 s, sys: 999 ms, total: 3.3 s
Wall time: 3.4 s
```

Depends on #19671

CC:  @sagetrac-drkirkby @nexttime @sagetrac-Vincent-Neri

Keywords: **pexpect upgrade**

Branch/Commit: **[9351ccb](https://github.com/sagemath/sagetrac-mirror/commit/9351ccb53d1d3c1d387c11e0c57443b53d1cfdd1)**

Upstream: **Reported upstream. Developers acknowledge bug.**

Reviewer: **Jeroen Demeyer, Bill Page**

Author: **Fran√ßois Bissey, Bill Page, Jeroen Demeyer**

Component: **interfaces**

_Issue created by migration from https://trac.sagemath.org/ticket/10295_





---

archive/issue_events_135311.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-11-20T08:53:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135311"
}
```



---

archive/issue_events_135312.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-11-20T08:53:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135312"
}
```



---

archive/issue_events_135313.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-11-20T08:53:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135313"
}
```



---

archive/issue_events_135314.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-11-20T08:53:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135314"
}
```



---

archive/issue_events_135315.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-11-20T08:53:18Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "subject": "https://github.com/simon-king-jena",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135315"
}
```



---

archive/issue_comments_096127.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nTry version 2.4 even. This has been discussed to death several times on sage-devel.\nVersion 2.1 and over are slower than what we currently have. Plus from experience\nin sage-on-gentoo where at some stage we experimented with pexpect 2.4, some plotting broke down in the notebook.",
    "created_at": "2010-11-20T08:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96127",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:1" align="right">comment:1</div>

Try version 2.4 even. This has been discussed to death several times on sage-devel.
Version 2.1 and over are slower than what we currently have. Plus from experience
in sage-on-gentoo where at some stage we experimented with pexpect 2.4, some plotting broke down in the notebook.



---

archive/issue_comments_096128.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nWhen I say version 2.4 you have to go there: [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect)\nrather than here: [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect)",
    "created_at": "2010-11-20T09:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96128",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:2" align="right">comment:2</div>

When I say version 2.4 you have to go there: [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect)
rather than here: [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect)



---

archive/issue_comments_096129.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@kiwifb](#comment:2):\n> When I say version 2.4 you have to go there: [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect)\n> rather than here: [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect)\n\nAren't the two links the same?\n\nSo, you say that there might be a performance problem with more recent versions of pexpect. That's bad, because the idea was to *get rid of* a performance problem by upgrading...",
    "created_at": "2010-11-20T09:27:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96129",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@kiwifb](#comment:2):
> When I say version 2.4 you have to go there: [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect)
> rather than here: [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect)

Aren't the two links the same?

So, you say that there might be a performance problem with more recent versions of pexpect. That's bad, because the idea was to *get rid of* a performance problem by upgrading...



---

archive/issue_comments_096130.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\ncut and paste didn't work as expected the second one was meant to be:\n[http://pexpect.sourceforge.net/](http://pexpect.sourceforge.net/)\n\nsearch the mailing list for pexpect, it is a proverbial can of worms.",
    "created_at": "2010-11-20T09:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96130",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

cut and paste didn't work as expected the second one was meant to be:
[http://pexpect.sourceforge.net/](http://pexpect.sourceforge.net/)

search the mailing list for pexpect, it is a proverbial can of worms.



---

archive/issue_comments_096131.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n2.4 is not released yet. Here's a package for 2.3 that I created.\n\nhttp://boxen.math.washington.edu/home/kirkby/patches/pexpect-2.3.spkg\n\nbut on my OpenSolaris machine, this 2.3 package results in one doctest failure, which is:\n\n```\nsage -t  -long -force_lib devel/sage/sage/interfaces/expect.py\n```\n\nThe interface must be semi-working, as the interface to R works - or at lease the R doctest does not fail. Here's the error message of the failed doctest. \n\n```\nsage -t  -long -force_lib devel/sage/sage/interfaces/sage0.py\n         [14.8 s]\nsage -t  -long -force_lib devel/sage/sage/interfaces/expect.py\nException pexpect.ExceptionPexpect: ExceptionPexpect() in <bound method spawn.__del__ of <pexpect.spawn object at 0xc5988ac>> ignored\n\n<snip out load more similar errors>\n\n<pexpect.spawn object at 0xc386d6c>> ignored\nException pexpect.ExceptionPexpect: ExceptionPexpect() in <bound method spawn.__del__ of <pexpect.spawn object at 0xc386d6c>> ignored\n**********************************************************************\nFile \"/export/home/drkirkby/sage-4.7.alpha3/devel/sage-main/sage/interfaces/expect.py\", line 867:\n    sage: r._expect.before\nExpected:\n    'abc;\\r\\n[1] '\nGot:\n    'abc <- 10 +15;\\r\\n__SAGE__R__PROMPT__> abc;\\r\\n[1] '\n**********************************************************************\n1 items had failures:\n   1 of  11 in __main__.example_16\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /export/home/drkirkby/.sage//tmp/.doctest_expect.py\n         [18.4 s]\nsage -t  -long -force_lib devel/sage/sage/interfaces/gap.py\n         [20.4 s]\n```\n\nI think in some cases where we call external programs there are probably better ways of doing this. For example\n* R has libraries, I expect we can call R via the libraries, rather than on the command line. \n* Mathematica uses the [Mathlink](http://reference.wolfram.com/mathematica/tutorial/MathLinkAndExternalProgramCommunicationOverview.html) protocol to communicate between the kernel and front end. How to use [Mathlink](http://reference.wolfram.com/mathematica/tutorial/MathLinkAndExternalProgramCommunicationOverview.html) is documented, and has been used by at least open-source program ([JMath](http://robotics.caltech.edu/~radford/jmath/)) to work with Mathematica. But Sage calls Mathematica via the command line. \n\nDave",
    "created_at": "2011-04-08T07:55:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96131",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:5" align="right">comment:5</div>

2.4 is not released yet. Here's a package for 2.3 that I created.

http://boxen.math.washington.edu/home/kirkby/patches/pexpect-2.3.spkg

but on my OpenSolaris machine, this 2.3 package results in one doctest failure, which is:

```
sage -t  -long -force_lib devel/sage/sage/interfaces/expect.py
```

The interface must be semi-working, as the interface to R works - or at lease the R doctest does not fail. Here's the error message of the failed doctest. 

```
sage -t  -long -force_lib devel/sage/sage/interfaces/sage0.py
         [14.8 s]
sage -t  -long -force_lib devel/sage/sage/interfaces/expect.py
Exception pexpect.ExceptionPexpect: ExceptionPexpect() in <bound method spawn.__del__ of <pexpect.spawn object at 0xc5988ac>> ignored

<snip out load more similar errors>

<pexpect.spawn object at 0xc386d6c>> ignored
Exception pexpect.ExceptionPexpect: ExceptionPexpect() in <bound method spawn.__del__ of <pexpect.spawn object at 0xc386d6c>> ignored
**********************************************************************
File "/export/home/drkirkby/sage-4.7.alpha3/devel/sage-main/sage/interfaces/expect.py", line 867:
    sage: r._expect.before
Expected:
    'abc;\r\n[1] '
Got:
    'abc <- 10 +15;\r\n__SAGE__R__PROMPT__> abc;\r\n[1] '
**********************************************************************
1 items had failures:
   1 of  11 in __main__.example_16
***Test Failed*** 1 failures.
For whitespace errors, see the file /export/home/drkirkby/.sage//tmp/.doctest_expect.py
         [18.4 s]
sage -t  -long -force_lib devel/sage/sage/interfaces/gap.py
         [20.4 s]
```

I think in some cases where we call external programs there are probably better ways of doing this. For example
* R has libraries, I expect we can call R via the libraries, rather than on the command line. 
* Mathematica uses the [Mathlink](http://reference.wolfram.com/mathematica/tutorial/MathLinkAndExternalProgramCommunicationOverview.html) protocol to communicate between the kernel and front end. How to use [Mathlink](http://reference.wolfram.com/mathematica/tutorial/MathLinkAndExternalProgramCommunicationOverview.html) is documented, and has been used by at least open-source program ([JMath](http://robotics.caltech.edu/~radford/jmath/)) to work with Mathematica. But Sage calls Mathematica via the command line. 

Dave



---

archive/issue_comments_096132.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOops, I see this doctest is related to R. But I'm sure there are other doctests which make use of pexpect, which are passing\n\nDave",
    "created_at": "2011-04-08T07:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96132",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:6" align="right">comment:6</div>

Oops, I see this doctest is related to R. But I'm sure there are other doctests which make use of pexpect, which are passing

Dave



---

archive/issue_comments_096133.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWhile 2.4 is not on sourceforge but on pypi.python.org [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect) I think we can call it released unless you have other infos (from author/mailing list).\nAs far as I remember, last time we tried pexpect-2.4 on sage-on-gentoo it broke plotting in the notebook. Can you try to do some plotting in the notebook with this version of pexpect? Digged my email archive, more precisely:\n\n```\ng=sin(x); plot(g,(x,-pi,3*pi/2))\n```\nin the notebook. It produced the following for us (at the time, notice the python time stamp):\n\n```\nimport os;os.chdir(\"/tmp/tmpo2KomY\");\nexecfile(\"_sage_input_1.py\")Python 2.6.4 (r264:75706, Mar  4 2010,\n21:15:13)\n[GCC 4.3.4] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> \n>>> import os;os.chdir(\"/tmp/tmpo2KomY\");\n>>> execfile(\"_sage_input_1.py\")\nSTART1\n\nimport os;os.chdir(\"/tmp/tmpY61yjM\");\nexecfile(\"_sage_input_2.py\")\n\nimport os;os.chdir(\"/tmp/tmpXjmsQK\");\nexecfile(\"_sage_input_3.py\")\n__SAGE__\n__SAGE__import os;os.chdir(\"/tmp/tmpY61yjM\");\n__SAGE__execfile(\"_sage_input_2.py\")\nSTART2\n__SAGE__\n__SAGE__import os;os.chdir(\"/tmp/tmpXjmsQK\");\n```",
    "created_at": "2011-04-08T09:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96133",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

While 2.4 is not on sourceforge but on pypi.python.org [http://pypi.python.org/pypi/pexpect](http://pypi.python.org/pypi/pexpect) I think we can call it released unless you have other infos (from author/mailing list).
As far as I remember, last time we tried pexpect-2.4 on sage-on-gentoo it broke plotting in the notebook. Can you try to do some plotting in the notebook with this version of pexpect? Digged my email archive, more precisely:

```
g=sin(x); plot(g,(x,-pi,3*pi/2))
```
in the notebook. It produced the following for us (at the time, notice the python time stamp):

```
import os;os.chdir("/tmp/tmpo2KomY");
execfile("_sage_input_1.py")Python 2.6.4 (r264:75706, Mar  4 2010,
21:15:13)
[GCC 4.3.4] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> 
>>> import os;os.chdir("/tmp/tmpo2KomY");
>>> execfile("_sage_input_1.py")
START1

import os;os.chdir("/tmp/tmpY61yjM");
execfile("_sage_input_2.py")

import os;os.chdir("/tmp/tmpXjmsQK");
execfile("_sage_input_3.py")
__SAGE__
__SAGE__import os;os.chdir("/tmp/tmpY61yjM");
__SAGE__execfile("_sage_input_2.py")
START2
__SAGE__
__SAGE__import os;os.chdir("/tmp/tmpXjmsQK");
```



---

archive/issue_comments_096134.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nDave, have you tried plotting in the notebook?",
    "created_at": "2011-04-12T23:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96134",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">comment:8</div>

Dave, have you tried plotting in the notebook?



---

archive/issue_events_135316.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135316"
}
```



---

archive/issue_events_135317.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135317"
}
```



---

archive/issue_events_135318.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135318"
}
```



---

archive/issue_events_135319.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135319"
}
```



---

archive/issue_comments_096135.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nBump this. There is a pexpect 3.1 now at http://pexpect.readthedocs.org/en/latest/ (note: the sourceforge address will redirect you there). For a long time I thought pexpect was done and there wouldn't be anymore release.\n\nI think if the project is alive they may take request from us.",
    "created_at": "2014-03-30T09:15:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96135",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">comment:12</div>

Bump this. There is a pexpect 3.1 now at http://pexpect.readthedocs.org/en/latest/ (note: the sourceforge address will redirect you there). For a long time I thought pexpect was done and there wouldn't be anymore release.

I think if the project is alive they may take request from us.



---

archive/issue_events_135320.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135320"
}
```



---

archive/issue_events_135321.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135321"
}
```



---

archive/issue_events_135322.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135322"
}
```



---

archive/issue_events_135323.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135323"
}
```



---

archive/issue_comments_096136.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-We use pexpect version 2.0. Shouldn't we upgrade to the current version 2.3?\n+We use pexpect version 2.0. Shouldn't we upgrade to the current version 3.3?\n \n This may be related with the performance problem reported at #10294.\n+\n+See also #502.\n``````\n",
    "created_at": "2014-09-09T09:19:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96136",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-We use pexpect version 2.0. Shouldn't we upgrade to the current version 2.3?
+We use pexpect version 2.0. Shouldn't we upgrade to the current version 3.3?
 
 This may be related with the performance problem reported at #10294.
+
+See also #502.
``````




---

archive/issue_comments_096137.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,6 @@\n This may be related with the performance problem reported at #10294.\n \n See also #502.\n+\n+New upstream tarball:\n+[https://pypi.python.org/packages/source/p/pexpect/pexpect-3.3.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-3.3.tar.gz)\n``````\n",
    "created_at": "2015-05-08T02:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96137",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,6 @@
 This may be related with the performance problem reported at #10294.
 
 See also #502.
+
+New upstream tarball:
+[https://pypi.python.org/packages/source/p/pexpect/pexpect-3.3.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-3.3.tar.gz)
``````




---

archive/issue_comments_096138.json:
```json
{
    "body": "Commit: **[9b1e098](https://github.com/sagemath/sagetrac-mirror/commit/9b1e0985e09c7181860d43f41f394cc23103ce1c)**",
    "created_at": "2015-05-08T02:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96138",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[9b1e098](https://github.com/sagemath/sagetrac-mirror/commit/9b1e0985e09c7181860d43f41f394cc23103ce1c)**



---

archive/issue_comments_096139.json:
```json
{
    "body": "Branch: **[u/fbissey/pexpect3.3](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/pexpect3.3)**",
    "created_at": "2015-05-08T02:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96139",
    "user": "https://github.com/kiwifb"
}
```

Branch: **[u/fbissey/pexpect3.3](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/pexpect3.3)**



---

archive/issue_events_135324.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-08T02:28:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135324"
}
```



---

archive/issue_events_135325.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-05-08T02:28:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135325"
}
```



---

archive/issue_comments_096140.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHum wrong stuff in that branch sorry will update shortly.",
    "created_at": "2015-05-08T02:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96140",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:17" align="right">comment:17</div>

Hum wrong stuff in that branch sorry will update shortly.



---

archive/issue_comments_096141.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/679e33af8315444f0080c98a45d7def4566bfbc1\">679e33a</a></td><td><code>Update pexpect to 3.3</code></td></tr></table>\n",
    "created_at": "2015-05-08T02:38:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96141",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/679e33af8315444f0080c98a45d7def4566bfbc1">679e33a</a></td><td><code>Update pexpect to 3.3</code></td></tr></table>




---

archive/issue_comments_096142.json:
```json
{
    "body": "Changed commit from **[9b1e098](https://github.com/sagemath/sagetrac-mirror/commit/9b1e0985e09c7181860d43f41f394cc23103ce1c)** to **[679e33a](https://github.com/sagemath/sagetrac-mirror/commit/679e33af8315444f0080c98a45d7def4566bfbc1)**",
    "created_at": "2015-05-08T02:38:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96142",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9b1e098](https://github.com/sagemath/sagetrac-mirror/commit/9b1e0985e09c7181860d43f41f394cc23103ce1c)** to **[679e33a](https://github.com/sagemath/sagetrac-mirror/commit/679e33af8315444f0080c98a45d7def4566bfbc1)**



---

archive/issue_comments_096143.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a24eab3ce985874ab8445ed5e362bbeead76fd40\">a24eab3</a></td><td><code>Fix broken doctest. _expect.before returns more stuff in pexpect 3.3</code></td></tr></table>\n",
    "created_at": "2015-05-08T02:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96143",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a24eab3ce985874ab8445ed5e362bbeead76fd40">a24eab3</a></td><td><code>Fix broken doctest. _expect.before returns more stuff in pexpect 3.3</code></td></tr></table>




---

archive/issue_comments_096144.json:
```json
{
    "body": "Changed commit from **[679e33a](https://github.com/sagemath/sagetrac-mirror/commit/679e33af8315444f0080c98a45d7def4566bfbc1)** to **[a24eab3](https://github.com/sagemath/sagetrac-mirror/commit/a24eab3ce985874ab8445ed5e362bbeead76fd40)**",
    "created_at": "2015-05-08T02:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96144",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[679e33a](https://github.com/sagemath/sagetrac-mirror/commit/679e33af8315444f0080c98a45d7def4566bfbc1)** to **[a24eab3](https://github.com/sagemath/sagetrac-mirror/commit/a24eab3ce985874ab8445ed5e362bbeead76fd40)**



---

archive/issue_comments_096145.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe bad behavior in the notebook originates in `sagenb/notebook/worksheet.py`, this is potentially broken but the question is why don't we go there we the old pexpect?",
    "created_at": "2015-05-08T02:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96145",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">comment:20</div>

The bad behavior in the notebook originates in `sagenb/notebook/worksheet.py`, this is potentially broken but the question is why don't we go there we the old pexpect?



---

archive/issue_comments_096146.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nBe aware that #17686 cleans up `expect.py`.",
    "created_at": "2015-05-08T11:16:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96146",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:21" align="right">comment:21</div>

Be aware that #17686 cleans up `expect.py`.



---

archive/issue_comments_096147.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nSeems to be orthogonal to the only change I made to that file. It'll just need rebasing. On the other hand there seem to be several `load` functions defined in sage. And it is not obvious why we should get that one in the notebook.",
    "created_at": "2015-05-08T12:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96147",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:22" align="right">comment:22</div>

Seems to be orthogonal to the only change I made to that file. It'll just need rebasing. On the other hand there seem to be several `load` functions defined in sage. And it is not obvious why we should get that one in the notebook.



---

archive/issue_comments_096148.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nhttps://github.com/billpage/sagenb/commit/811a2e762bb041dd34d32d96b003ab46eaab22e9\n\nHere is a patch to sagenb/interfaces/expect.py that corrects the bad behavior in the notebook following upgrade to pexpect 3.3.  The problem is due to a difference between pexpect 2.0 and newer versions of pexpect in what happens following a TIMEOUT of an expect; call.  TIMEOUT is the intended result from a call to '_read'. In newer versions '_expect.before' is not modified by TIMEOUT so the output continues to accumulate. There is no need to do this ourselves in 'output_status'.",
    "created_at": "2015-05-10T08:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96148",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:23" align="right">comment:23</div>

https://github.com/billpage/sagenb/commit/811a2e762bb041dd34d32d96b003ab46eaab22e9

Here is a patch to sagenb/interfaces/expect.py that corrects the bad behavior in the notebook following upgrade to pexpect 3.3.  The problem is due to a difference between pexpect 2.0 and newer versions of pexpect in what happens following a TIMEOUT of an expect; call.  TIMEOUT is the intended result from a call to '_read'. In newer versions '_expect.before' is not modified by TIMEOUT so the output continues to accumulate. There is no need to do this ourselves in 'output_status'.



---

archive/issue_comments_096149.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nSee also http://pexpect.readthedocs.org/en/latest/history.html?highlight=timeout#version-2-3 for perhaps a better explanation.",
    "created_at": "2015-05-10T08:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96149",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:24" align="right">comment:24</div>

See also http://pexpect.readthedocs.org/en/latest/history.html?highlight=timeout#version-2-3 for perhaps a better explanation.



---

archive/issue_comments_096150.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nCool, I'll try that tomorrow morning. The next step will be performance measurements. One of the reason we hadn't moved to at least pexpect 2.4 was poor performance (sloooow). I would be willing to trade performance for something properly maintained but we should know what we are getting into on that front. Then again that `TIMEOUT` thing may have been the cause.",
    "created_at": "2015-05-10T08:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96150",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

Cool, I'll try that tomorrow morning. The next step will be performance measurements. One of the reason we hadn't moved to at least pexpect 2.4 was poor performance (sloooow). I would be willing to trade performance for something properly maintained but we should know what we are getting into on that front. Then again that `TIMEOUT` thing may have been the cause.



---

archive/issue_comments_096151.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@kiwifb](#comment:25):\n> Then again that `TIMEOUT` thing may have been the cause.\n\nThe mentioned change was made in 2.3, but already 2.1 was said to be slooooooooow.\n\nBut we'll (or you'll) see...",
    "created_at": "2015-05-10T14:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96151",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@kiwifb](#comment:25):
> Then again that `TIMEOUT` thing may have been the cause.

The mentioned change was made in 2.3, but already 2.1 was said to be slooooooooow.

But we'll (or you'll) see...



---

archive/issue_comments_096152.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI also doubt that this particular case of the use of TIMEOUT has anything to do with version 2.1 being slower.  The problem here is how the notebook interacts with Sage in an asynchronous manner.  TIMEOUT is the expected behavior when checking on the status of a computation.  This allows notebook to display partial results, i.e. the output in 'self._so_far'.  The notebook code treats TIMEOUT as a Python exception rather than waiting for it with a 'expect' pattern.  In the old version of pexpect this exception did not update the '.before' attribute.  On the other hand if the code was changed to explicitly look for 'pexpect.TIMEOUT' then we would have had this problem even with the old version.\n\nWhat is the recommended way to measure Sage performance?",
    "created_at": "2015-05-10T15:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96152",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:27" align="right">comment:27</div>

I also doubt that this particular case of the use of TIMEOUT has anything to do with version 2.1 being slower.  The problem here is how the notebook interacts with Sage in an asynchronous manner.  TIMEOUT is the expected behavior when checking on the status of a computation.  This allows notebook to display partial results, i.e. the output in 'self._so_far'.  The notebook code treats TIMEOUT as a Python exception rather than waiting for it with a 'expect' pattern.  In the old version of pexpect this exception did not update the '.before' attribute.  On the other hand if the code was changed to explicitly look for 'pexpect.TIMEOUT' then we would have had this problem even with the old version.

What is the recommended way to measure Sage performance?



---

archive/issue_comments_096153.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@sagetrac-bpage](#comment:27):\n> What is the recommended way to measure Sage performance?\n\nGood question, I can only talk about the command line interface:\n\nOf course there's `time ./sage -t --long src/sage/interfaces/` (probably with `-p`; one can also set `SAGE_TEST_ITER` and `SAGE_TEST_GLOBAL_ITER`).  Only testing the interfaces that actually use pexpect (and where the external program is really installed) makes more sense.\n\nTests that make heavy use of (stand-alone) Maxima/`ecl`, Singular, `gap` and `gp` are meaningful as well.  I cannot really list them right now, but `src/sage/schemes/elliptic_curves/` and especially `src/sage/sandpiles/sandpile.py` are known to fall into that category IIRC.\n\nBefore testing, it IMHO makes sense to remove or rename `$DOT_SAGE/timings*.json`, otherwise doctests will get reordered with undesirable impact on the resource usage, influencing the measured timings.",
    "created_at": "2015-05-10T15:56:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96153",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@sagetrac-bpage](#comment:27):
> What is the recommended way to measure Sage performance?

Good question, I can only talk about the command line interface:

Of course there's `time ./sage -t --long src/sage/interfaces/` (probably with `-p`; one can also set `SAGE_TEST_ITER` and `SAGE_TEST_GLOBAL_ITER`).  Only testing the interfaces that actually use pexpect (and where the external program is really installed) makes more sense.

Tests that make heavy use of (stand-alone) Maxima/`ecl`, Singular, `gap` and `gp` are meaningful as well.  I cannot really list them right now, but `src/sage/schemes/elliptic_curves/` and especially `src/sage/sandpiles/sandpile.py` are known to fall into that category IIRC.

Before testing, it IMHO makes sense to remove or rename `$DOT_SAGE/timings*.json`, otherwise doctests will get reordered with undesirable impact on the resource usage, influencing the measured timings.



---

archive/issue_comments_096154.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nOn my system with pexpect 3.x from github I get:\n\n```\n  wspage@suse:~/sage> inxi -SCI\n  System:    Host: suse Kernel: 3.0.101-0.46-default x86_64 (64 bit) \n             Desktop Gnome 2.28.2 Distro: SUSE Linux Enterprise Server 11 (x86_64) VERSION = 11 PATCHLEVEL = 3\n  CPU:       Quad core Intel Core i5-2500K CPU (-MCP-) cache: 6144 KB flags: (lm nx sse sse2 sse3 sse4_1 sse4_2 ssse3 vmx) \n             Clock Speeds: 1: 1600.00 MHz 2: 1600.00 MHz 3: 3301.00 MHz 4: 1600.00 MHz\n  Info:      Processes: 245 Uptime: 67 days  5:09 Memory: 11461.1/15917.0MB Client: Shell inxi: 1.7.24 \n\n \n  wspage@suse:~/sage> time ./sage -t --long src/sage/interfaces/\n  ...\n  ----------------------------------------------------------------------\n  sage -t --long src/sage/interfaces/expect.py  # 1 doctest failed\n  ----------------------------------------------------------------------\n  Total time for all tests: 123.2 seconds\n      cpu time: 14.3 seconds\n      cumulative wall time: 120.5 seconds\n\n  real\t2m18.358s\n  user\t0m56.396s\n  sys\t0m4.856s\n```",
    "created_at": "2015-05-10T21:33:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96154",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:29" align="right">comment:29</div>

On my system with pexpect 3.x from github I get:

```
  wspage@suse:~/sage> inxi -SCI
  System:    Host: suse Kernel: 3.0.101-0.46-default x86_64 (64 bit) 
             Desktop Gnome 2.28.2 Distro: SUSE Linux Enterprise Server 11 (x86_64) VERSION = 11 PATCHLEVEL = 3
  CPU:       Quad core Intel Core i5-2500K CPU (-MCP-) cache: 6144 KB flags: (lm nx sse sse2 sse3 sse4_1 sse4_2 ssse3 vmx) 
             Clock Speeds: 1: 1600.00 MHz 2: 1600.00 MHz 3: 3301.00 MHz 4: 1600.00 MHz
  Info:      Processes: 245 Uptime: 67 days  5:09 Memory: 11461.1/15917.0MB Client: Shell inxi: 1.7.24 

 
  wspage@suse:~/sage> time ./sage -t --long src/sage/interfaces/
  ...
  ----------------------------------------------------------------------
  sage -t --long src/sage/interfaces/expect.py  # 1 doctest failed
  ----------------------------------------------------------------------
  Total time for all tests: 123.2 seconds
      cpu time: 14.3 seconds
      cumulative wall time: 120.5 seconds

  real	2m18.358s
  user	0m56.396s
  sys	0m4.856s
```



---

archive/issue_comments_096155.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nYou should do some things like\n\n```\n    %timeit gp.eval('2+3')\n    %timeit gp('2') + gp('3')\n    %timeit axiom('2+3')\n```\netc.   The doctesting won't testing latency much, and latency is *the* main issue with performance with the pexpect interfaces.\nThe other is size, e.g.,\n\n```\n    %timeit s=str(gp.eval('2^10000'))\n```",
    "created_at": "2015-05-10T21:54:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96155",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:30" align="right">comment:30</div>

You should do some things like

```
    %timeit gp.eval('2+3')
    %timeit gp('2') + gp('3')
    %timeit axiom('2+3')
```
etc.   The doctesting won't testing latency much, and latency is *the* main issue with performance with the pexpect interfaces.
The other is size, e.g.,

```
    %timeit s=str(gp.eval('2^10000'))
```



---

archive/issue_comments_096156.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI will move to do the latency test shortly but for reference when I do the doctesting of `sage/interface` on my machine.\npexpect-2.0\n\n```\nTotal time for all tests: 118.3 seconds\n    cpu time: 20.6 seconds\n    cumulative wall time: 115.9 seconds\n\nreal    1m59.638s\nuser    1m21.060s\nsys     0m3.290s\n```\npexpect-3.3\n\n```\nTotal time for all tests: 128.3 seconds\n    cpu time: 21.3 seconds\n    cumulative wall time: 125.9 seconds\n\nreal    2m9.655s\nuser    1m27.270s\nsys     0m3.200s\n```\nSo it's a little bit slower already. I don't know if anything skew that a bit. Moving to the latency test which may be a better test anyway.",
    "created_at": "2015-05-10T22:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96156",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">comment:31</div>

I will move to do the latency test shortly but for reference when I do the doctesting of `sage/interface` on my machine.
pexpect-2.0

```
Total time for all tests: 118.3 seconds
    cpu time: 20.6 seconds
    cumulative wall time: 115.9 seconds

real    1m59.638s
user    1m21.060s
sys     0m3.290s
```
pexpect-3.3

```
Total time for all tests: 128.3 seconds
    cpu time: 21.3 seconds
    cumulative wall time: 125.9 seconds

real    2m9.655s
user    1m27.270s
sys     0m3.200s
```
So it's a little bit slower already. I don't know if anything skew that a bit. Moving to the latency test which may be a better test anyway.



---

archive/issue_comments_096157.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\npexpect-2.0\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath Version 6.7.beta4, Release Date: 2015-05-05               \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: %timeit gp.eval('2+3')\nThe slowest run took 269.56 times longer than the fastest. This could mean that an intermediate result is being cached \n10000 loops, best of 3: 94.4 us per loop\nsage: %timeit gp('2') + gp('3')\nThe slowest run took 8.78 times longer than the fastest. This could mean that an intermediate result is being cached \n1000 loops, best of 3: 556 us per loop\nsage: %timeit s=str(gp.eval('2^10000'))\n1000 loops, best of 3: 250 us per loop\n```\n\nOne time only so we don't use the cache\n\n```\nsage: %time gp.eval('2+3')\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 728 us\n'5'\nsage: %time gp('2') + gp('3')\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 1.51 ms\n5\nsage: %time s=str(gp.eval('2^10000'))\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 667 us\n```\n\npexpect-3.3\n\n```\nsage: %timeit gp.eval('2+3')\nThe slowest run took 80.90 times longer than the fastest. This could mean that an intermediate result is being cached \n1000 loops, best of 3: 309 us per loop\nsage: %timeit gp('2') + gp('3')\n1000 loops, best of 3: 1.54 ms per loop\nsage: %timeit s=str(gp.eval('2^10000'))\nThe slowest run took 6.02 times longer than the fastest. This could mean that an intermediate result is being cached \n1000 loops, best of 3: 513 us per loop\n```\nOne time only\n\n```\nsage: %time gp.eval('2+3')\nCPU times: user 10 ms, sys: 0 ns, total: 10 ms\nWall time: 30.5 ms\n'5'\nsage: %time gp('2') + gp('3')\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 4.58 ms\n5\nsage: %time s=str(gp.eval('2^10000'))\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 644 us\n```\n\nSo it is a little bit all over the place, but generally 3 to 4 times slower with pexpect 3.3. I don't know if it is acceptable. Since upstream is now alive and well we could take it as an issue with them?",
    "created_at": "2015-05-10T22:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96157",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">comment:32</div>

pexpect-2.0

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SageMath Version 6.7.beta4, Release Date: 2015-05-05               ‚îÇ
‚îÇ Type "notebook()" for the browser-based notebook interface.        ‚îÇ
‚îÇ Type "help()" for help.                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Warning: this is a prerelease version, and it may be unstable.     ‚îÉ
‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ
sage: %timeit gp.eval('2+3')
The slowest run took 269.56 times longer than the fastest. This could mean that an intermediate result is being cached 
10000 loops, best of 3: 94.4 us per loop
sage: %timeit gp('2') + gp('3')
The slowest run took 8.78 times longer than the fastest. This could mean that an intermediate result is being cached 
1000 loops, best of 3: 556 us per loop
sage: %timeit s=str(gp.eval('2^10000'))
1000 loops, best of 3: 250 us per loop
```

One time only so we don't use the cache

```
sage: %time gp.eval('2+3')
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 728 us
'5'
sage: %time gp('2') + gp('3')
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 1.51 ms
5
sage: %time s=str(gp.eval('2^10000'))
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 667 us
```

pexpect-3.3

```
sage: %timeit gp.eval('2+3')
The slowest run took 80.90 times longer than the fastest. This could mean that an intermediate result is being cached 
1000 loops, best of 3: 309 us per loop
sage: %timeit gp('2') + gp('3')
1000 loops, best of 3: 1.54 ms per loop
sage: %timeit s=str(gp.eval('2^10000'))
The slowest run took 6.02 times longer than the fastest. This could mean that an intermediate result is being cached 
1000 loops, best of 3: 513 us per loop
```
One time only

```
sage: %time gp.eval('2+3')
CPU times: user 10 ms, sys: 0 ns, total: 10 ms
Wall time: 30.5 ms
'5'
sage: %time gp('2') + gp('3')
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 4.58 ms
5
sage: %time s=str(gp.eval('2^10000'))
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 644 us
```

So it is a little bit all over the place, but generally 3 to 4 times slower with pexpect 3.3. I don't know if it is acceptable. Since upstream is now alive and well we could take it as an issue with them?



---

archive/issue_comments_096158.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\n> So it is a little bit all over the place, but generally 3 to 4 times slower with pexpect 3.3. I don't know if it is acceptable.\n\nNo, this is definitely not acceptable.  For real work it could easily mean people's programs are 4 times slower due to this upgrade.  It's important to understand that the use case of pexpect by Sage is massively different than the use case of pexpect for absolutely everybody else -- for them some latency issues are no big deal, but for us they are.\n\nIncidentally, I think there is no caching going on despite what %timeit says...",
    "created_at": "2015-05-10T22:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96158",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:33" align="right">comment:33</div>

> So it is a little bit all over the place, but generally 3 to 4 times slower with pexpect 3.3. I don't know if it is acceptable.

No, this is definitely not acceptable.  For real work it could easily mean people's programs are 4 times slower due to this upgrade.  It's important to understand that the use case of pexpect by Sage is massively different than the use case of pexpect for absolutely everybody else -- for them some latency issues are no big deal, but for us they are.

Incidentally, I think there is no caching going on despite what %timeit says...



---

archive/issue_comments_096159.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nRight, I am hearing you. This is a definite problem. So is keeping dead software. If we are keeping the pexpect 2.0 branch in for performance issue it becomes the responsibility of sage developers to maintain it and add new features like the one Bill wants. \n\nEffectively we are maintaining a fork and if we are going that way I would like it to be formalized with a different name and possibly integrated in the sage code itself. This is so people don't get upgraded to a different pexpect through pip if they are using it. Also while our core functionality uses this pexpect, we don't want to block other packages that would need a newer pexpect.\n\nThat is my opinion on the matter. The other way is to work, possibly with upstream, to solve that latency problem in newer versions.",
    "created_at": "2015-05-10T22:46:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96159",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:34" align="right">comment:34</div>

Right, I am hearing you. This is a definite problem. So is keeping dead software. If we are keeping the pexpect 2.0 branch in for performance issue it becomes the responsibility of sage developers to maintain it and add new features like the one Bill wants. 

Effectively we are maintaining a fork and if we are going that way I would like it to be formalized with a different name and possibly integrated in the sage code itself. This is so people don't get upgraded to a different pexpect through pip if they are using it. Also while our core functionality uses this pexpect, we don't want to block other packages that would need a newer pexpect.

That is my opinion on the matter. The other way is to work, possibly with upstream, to solve that latency problem in newer versions.



---

archive/issue_comments_096160.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nfbissey -- definitely -- I completely agree with you, as long as \"we\" = not me :-)",
    "created_at": "2015-05-10T23:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96160",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:35" align="right">comment:35</div>

fbissey -- definitely -- I completely agree with you, as long as "we" = not me :-)



---

archive/issue_comments_096161.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\n`@`bill do you think it would be easy to bake unicode support in pexpect 2.0? Or would it be easier to work out the latency issue? You seem to have a good handle on what's in pexpect.",
    "created_at": "2015-05-10T23:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96161",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:36" align="right">comment:36</div>

`@`bill do you think it would be easy to bake unicode support in pexpect 2.0? Or would it be easier to work out the latency issue? You seem to have a good handle on what's in pexpect.



---

archive/issue_comments_096162.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nApparently the performance problem originates with this old commit:\n\nhttps://github.com/pexpect/pexpect/commit/600463686284ea102548f5e0bf51582db051dc78#diff-dfb232b43530f0961894e09a0d862aa4R1048\n\nafter commenting out\n\nhttps://github.com/pexpect/pexpect/blob/3.x/pexpect/__init__.py#L1540\n\n```\n                #time.sleep(0.0001)\n```\n\nperformance changes from\n\n```\nsage: sage: %timeit gp.eval('2+3')\n1000 loops, best of 3: 427 \u00b5s per loop\nsage: sage: %timeit gp.eval('2+3')\n1000 loops, best of 3: 449 \u00b5s per loop\n```\n\nto this\n\n```\nsage: %timeit gp.eval('2+3')\nThe slowest run took 175.25 times longer than the fastest. This could mean that an intermediate result is being cached \n10000 loops, best of 3: 76.3 \u00b5s per loop\nsage: %timeit gp.eval('2+3')\nThe slowest run took 7.85 times longer than the fastest. This could mean that an intermediate result is being cached \n10000 loops, best of 3: 76.4 \u00b5s per loop\n```",
    "created_at": "2015-05-11T05:06:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96162",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:37" align="right">comment:37</div>

Apparently the performance problem originates with this old commit:

https://github.com/pexpect/pexpect/commit/600463686284ea102548f5e0bf51582db051dc78#diff-dfb232b43530f0961894e09a0d862aa4R1048

after commenting out

https://github.com/pexpect/pexpect/blob/3.x/pexpect/__init__.py#L1540

```
                #time.sleep(0.0001)
```

performance changes from

```
sage: sage: %timeit gp.eval('2+3')
1000 loops, best of 3: 427 ¬µs per loop
sage: sage: %timeit gp.eval('2+3')
1000 loops, best of 3: 449 ¬µs per loop
```

to this

```
sage: %timeit gp.eval('2+3')
The slowest run took 175.25 times longer than the fastest. This could mean that an intermediate result is being cached 
10000 loops, best of 3: 76.3 ¬µs per loop
sage: %timeit gp.eval('2+3')
The slowest run took 7.85 times longer than the fastest. This could mean that an intermediate result is being cached 
10000 loops, best of 3: 76.4 ¬µs per loop
```



---

archive/issue_comments_096163.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nExcellent job! Do we have contact upstream to see if this is really needed or could be made optional?",
    "created_at": "2015-05-11T05:52:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96163",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:38" align="right">comment:38</div>

Excellent job! Do we have contact upstream to see if this is really needed or could be made optional?



---

archive/issue_comments_096164.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nAlternative to patching pexpect, we can just replace pieces of pexpect that we don't like with custom Python or Cython code (I do this in #17686 for exiting programs).",
    "created_at": "2015-05-11T06:22:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96164",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Alternative to patching pexpect, we can just replace pieces of pexpect that we don't like with custom Python or Cython code (I do this in #17686 for exiting programs).



---

archive/issue_comments_096165.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@williamstein](#comment:33):\n> No, this is definitely not acceptable.  For real work it could easily mean people's programs are 4 times slower due to this upgrade.\n\nIndeed. I am even using a patched version of my department's linux distribution, since otherwise the latency (of pseudo-TTY, which slows down pexpect) makes my group cohomology spkg practically unusable.",
    "created_at": "2015-05-11T06:26:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96165",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@williamstein](#comment:33):
> No, this is definitely not acceptable.  For real work it could easily mean people's programs are 4 times slower due to this upgrade.

Indeed. I am even using a patched version of my department's linux distribution, since otherwise the latency (of pseudo-TTY, which slows down pexpect) makes my group cohomology spkg practically unusable.



---

archive/issue_comments_096166.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@jdemeyer](#comment:39):\n> Alternative to patching pexpect, we can just replace pieces of pexpect that we don't like with custom Python or Cython code (I do this in #17686 for exiting programs).\n\nThat's interesting if we can do it in a systematic way. I wouldn't mind getting rid of most pexpect interface with the exception of the notebook (which may be harder).",
    "created_at": "2015-05-11T07:40:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96166",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@jdemeyer](#comment:39):
> Alternative to patching pexpect, we can just replace pieces of pexpect that we don't like with custom Python or Cython code (I do this in #17686 for exiting programs).

That's interesting if we can do it in a systematic way. I wouldn't mind getting rid of most pexpect interface with the exception of the notebook (which may be harder).



---

archive/issue_comments_096167.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@kiwifb](#comment:41):\n> That's interesting if we can do it in a systematic way. I wouldn't mind getting rid of most pexpect interface with the exception of the notebook (which may be harder).\n\nI don't mean to stop using pexpect interfaces. I mean replacing parts of pexpect itself: the main pexpect code is in one Python class `spawn` and we can monkey-patch that by subclassing that and changing methods as we please.\n\nSince pexpect uses some low-level OS stuff, implementing the critical parts in Cython might also give significant speed gain (I haven't tested this yet, but surely calling `os.foo()` in Python and playing with strings will be slower than directly calling the `foo()` system call from Cython).",
    "created_at": "2015-05-11T07:57:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96167",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@kiwifb](#comment:41):
> That's interesting if we can do it in a systematic way. I wouldn't mind getting rid of most pexpect interface with the exception of the notebook (which may be harder).

I don't mean to stop using pexpect interfaces. I mean replacing parts of pexpect itself: the main pexpect code is in one Python class `spawn` and we can monkey-patch that by subclassing that and changing methods as we please.

Since pexpect uses some low-level OS stuff, implementing the critical parts in Cython might also give significant speed gain (I haven't tested this yet, but surely calling `os.foo()` in Python and playing with strings will be slower than directly calling the `foo()` system call from Cython).



---

archive/issue_comments_096168.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@sagetrac-bpage](#comment:37):\n> Apparently the performance problem originates with this old commit:\n> \n> https://github.com/pexpect/pexpect/commit/600463686284ea102548f5e0bf51582db051dc78#diff-dfb232b43530f0961894e09a0d862aa4R1048\n> \n> after commenting out\n> \n> https://github.com/pexpect/pexpect/blob/3.x/pexpect/__init__.py#L1540\n> \n> ```\n>                 #time.sleep(0.0001)\n> ```\n\nHahaha, I was going to grab 2.1 and investigate the changes compared to 2.0.  (Didn't realize the full history was kept.)\n\n\nOf course continually polling without delay isn't nice either; it will significantly increase the CPU load.",
    "created_at": "2015-05-11T09:16:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96168",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@sagetrac-bpage](#comment:37):
> Apparently the performance problem originates with this old commit:
> 
> https://github.com/pexpect/pexpect/commit/600463686284ea102548f5e0bf51582db051dc78#diff-dfb232b43530f0961894e09a0d862aa4R1048
> 
> after commenting out
> 
> https://github.com/pexpect/pexpect/blob/3.x/pexpect/__init__.py#L1540
> 
> ```
>                 #time.sleep(0.0001)
> ```

Hahaha, I was going to grab 2.1 and investigate the changes compared to 2.0.  (Didn't realize the full history was kept.)


Of course continually polling without delay isn't nice either; it will significantly increase the CPU load.



---

archive/issue_comments_096169.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@nexttime](#comment:43):\n> Replying to [@sagetrac-bpage](#comment:37):\n> > Apparently the performance problem originates with this old commit:\n> > \n> > https://github.com/pexpect/pexpect/commit/600463686284ea102548f5e0bf51582db051dc78#diff-dfb232b43530f0961894e09a0d862aa4R1048\n> > \n> > after commenting out\n> > \n> > https://github.com/pexpect/pexpect/blob/3.x/pexpect/__init__.py#L1540\n> > \n> > ```\n> >                 #time.sleep(0.0001)\n> > ```\n\n> \n> Hahaha, I was going to grab 2.1 and investigate the changes compared to 2.0.  (Didn't realize the full history was kept.)\n> \n> \n> Of course continually polling without delay isn't nice either; it will significantly increase the CPU load.\n\nWill it? After all unless there are quite a number of other changes, it is the current situation with 2.0, isn't it? Upgrading without patching would decrease the CPU load if I am not mistaken.\n\n\nAnyway, I like Jeroen's idea but we will need to upgrade pexpect in any case. I am all in favour of upgrading now with a patch and working on some cythonized elements for pexpect in a follow up ticket. We could remove the patch when we have something satisfactory in place.",
    "created_at": "2015-05-11T09:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96169",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@nexttime](#comment:43):
> Replying to [@sagetrac-bpage](#comment:37):
> > Apparently the performance problem originates with this old commit:
> > 
> > https://github.com/pexpect/pexpect/commit/600463686284ea102548f5e0bf51582db051dc78#diff-dfb232b43530f0961894e09a0d862aa4R1048
> > 
> > after commenting out
> > 
> > https://github.com/pexpect/pexpect/blob/3.x/pexpect/__init__.py#L1540
> > 
> > ```
> >                 #time.sleep(0.0001)
> > ```

> 
> Hahaha, I was going to grab 2.1 and investigate the changes compared to 2.0.  (Didn't realize the full history was kept.)
> 
> 
> Of course continually polling without delay isn't nice either; it will significantly increase the CPU load.

Will it? After all unless there are quite a number of other changes, it is the current situation with 2.0, isn't it? Upgrading without patching would decrease the CPU load if I am not mistaken.


Anyway, I like Jeroen's idea but we will need to upgrade pexpect in any case. I am all in favour of upgrading now with a patch and working on some cythonized elements for pexpect in a follow up ticket. We could remove the patch when we have something satisfactory in place.



---

archive/issue_comments_096170.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@kiwifb](#comment:44):\n> Replying to [@nexttime](#comment:43):\n> > Of course continually polling without delay isn't nice either; it will significantly increase the CPU load.\n\n> \n> Will it?\n\n[http://en.wikipedia.org/wiki/Busy_waiting](http://en.wikipedia.org/wiki/Busy_waiting).\n\nI'll have to look closer at the code.  Haven't tested yet, but I guess it'll get worse the longer the net computation in the subprocess takes; the examples above only do short toy computations and don't take the overall CPU time into account.  (It may lead to effectively doubling `SAGE_NUM_THREADS` in ptestlong.)\n \n> After all unless there are quite a number of other changes, it is the current situation with 2.0, isn't it? Upgrading without patching would decrease the CPU load if I am not mistaken.\n\nProbably.  In fact, for me ptestlong with 3.3 (unpatched) went faster than with 2.0, although only slightly, under the same conditions (constant low load).  (But in both cases I had some process apparently still waiting for Singular after all other tests had already finished, so the wall time got messed up a bit.)\n\nBut I'm ok with first upgrading here and removing the `sleep`, then checking what else we could tweak on another ticket.\n \n> Anyway, I like Jeroen's idea but we will need to upgrade pexpect in any case. I am all in favour of upgrading now with a patch and working on some cythonized elements for pexpect in a follow up ticket. We could remove the patch when we have something satisfactory in place.\n\nSubclassing, probably with individual changes for different interfaces or dynamically changing parameters is the way to go I think.\n\nWhile we could perhaps do some parts in Cython, leaving Python of course puts more burden of portablility on us, depending on what exactly we do.",
    "created_at": "2015-05-11T12:03:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96170",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@kiwifb](#comment:44):
> Replying to [@nexttime](#comment:43):
> > Of course continually polling without delay isn't nice either; it will significantly increase the CPU load.

> 
> Will it?

[http://en.wikipedia.org/wiki/Busy_waiting](http://en.wikipedia.org/wiki/Busy_waiting).

I'll have to look closer at the code.  Haven't tested yet, but I guess it'll get worse the longer the net computation in the subprocess takes; the examples above only do short toy computations and don't take the overall CPU time into account.  (It may lead to effectively doubling `SAGE_NUM_THREADS` in ptestlong.)
 
> After all unless there are quite a number of other changes, it is the current situation with 2.0, isn't it? Upgrading without patching would decrease the CPU load if I am not mistaken.

Probably.  In fact, for me ptestlong with 3.3 (unpatched) went faster than with 2.0, although only slightly, under the same conditions (constant low load).  (But in both cases I had some process apparently still waiting for Singular after all other tests had already finished, so the wall time got messed up a bit.)

But I'm ok with first upgrading here and removing the `sleep`, then checking what else we could tweak on another ticket.
 
> Anyway, I like Jeroen's idea but we will need to upgrade pexpect in any case. I am all in favour of upgrading now with a patch and working on some cythonized elements for pexpect in a follow up ticket. We could remove the patch when we have something satisfactory in place.

Subclassing, probably with individual changes for different interfaces or dynamically changing parameters is the way to go I think.

While we could perhaps do some parts in Cython, leaving Python of course puts more burden of portablility on us, depending on what exactly we do.



---

archive/issue_comments_096171.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nPerhaps proposing an upstream patch to provide an optional parameter such as\n\n```\nexpect(prompt,yield=false)\n```\n\nto optionally avoid the call to sleep would be a good idea?  Apparently there are situations such as the way that Sage uses gap where busy waiting is a good thing.  Meanwhile in Python 3.x there is asyncio and pexpect 3.x already supports that.",
    "created_at": "2015-05-11T14:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96171",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:46" align="right">comment:46</div>

Perhaps proposing an upstream patch to provide an optional parameter such as

```
expect(prompt,yield=false)
```

to optionally avoid the call to sleep would be a good idea?  Apparently there are situations such as the way that Sage uses gap where busy waiting is a good thing.  Meanwhile in Python 3.x there is asyncio and pexpect 3.x already supports that.



---

archive/issue_comments_096172.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nBased on\nhttp://stackoverflow.com/questions/7273474/behavior-of-pythons-time-sleep0-under-linux-does-it-cause-a-context-switch\n\nI tried\n\n```\n                time.sleep(0)\n```\n\nin *pexpect/__init__.py* and the result on my linux system remains fast (78.9 \u00b5s per loop).  In principle the use of *sleep(0)* should allow scheduling on all systems but it might be a good idea for someone with a MAC to try this on OSX.\n\nThe pexpect people might accept a patch to change this to 0.",
    "created_at": "2015-05-11T16:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96172",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:47" align="right">comment:47</div>

Based on
http://stackoverflow.com/questions/7273474/behavior-of-pythons-time-sleep0-under-linux-does-it-cause-a-context-switch

I tried

```
                time.sleep(0)
```

in *pexpect/__init__.py* and the result on my linux system remains fast (78.9 ¬µs per loop).  In principle the use of *sleep(0)* should allow scheduling on all systems but it might be a good idea for someone with a MAC to try this on OSX.

The pexpect people might accept a patch to change this to 0.



---

archive/issue_comments_096173.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nWhy do you think it's busy waiting? It looks like it's reading with a timeout, which is not busy waiting.",
    "created_at": "2015-05-11T16:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96173",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

Why do you think it's busy waiting? It looks like it's reading with a timeout, which is not busy waiting.



---

archive/issue_comments_096174.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@sagetrac-bpage](#comment:47):\n> The pexpect people might accept a patch to change this to 0.\n\nWell, rather the delay should be configurable.\n\nBut the whole `expect_loop()` and `read_nonblocking()` look pretty messy.  We should perhaps simply overwrite one or both with a version that fits our needs.  The whole class certainly isn't written for performance.\n\n\nNote that the behaviour also depends on the writer (i.e., the subprocess); ECL for example is extremely poor in that it doesn't write strings, but really character by character, such that in the worst case we here would end up with at least `len(s)` * 0.1 ms (and at least len(s) context switches, not including the system calls themselves, where pexpect doesn't only call `select()` and probably `read()`, but also `waitpid()` because of the `isalive()` checks).",
    "created_at": "2015-05-11T16:55:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96174",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@sagetrac-bpage](#comment:47):
> The pexpect people might accept a patch to change this to 0.

Well, rather the delay should be configurable.

But the whole `expect_loop()` and `read_nonblocking()` look pretty messy.  We should perhaps simply overwrite one or both with a version that fits our needs.  The whole class certainly isn't written for performance.


Note that the behaviour also depends on the writer (i.e., the subprocess); ECL for example is extremely poor in that it doesn't write strings, but really character by character, such that in the worst case we here would end up with at least `len(s)` * 0.1 ms (and at least len(s) context switches, not including the system calls themselves, where pexpect doesn't only call `select()` and probably `read()`, but also `waitpid()` because of the `isalive()` checks).



---

archive/issue_comments_096175.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\n@jdemeyer Yes I see, so I wonder why they need *time.sleep* at all?  I am back to asking them to just remove it. But if they prefer a patch with a configurable sleep time then why not?\n\n@nexttime Re: rewriting the loop.  For sure if you have the time but I think the priority should be to get pexpect updated soonest.",
    "created_at": "2015-05-11T17:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96175",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:50" align="right">comment:50</div>

@jdemeyer Yes I see, so I wonder why they need *time.sleep* at all?  I am back to asking them to just remove it. But if they prefer a patch with a configurable sleep time then why not?

@nexttime Re: rewriting the loop.  For sure if you have the time but I think the priority should be to get pexpect updated soonest.



---

archive/issue_comments_096176.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@jdemeyer](#comment:48):\n> Why do you think it's busy waiting? It looks like it's reading with a timeout, which is not busy waiting.\n\nUnless the timeout is `None`, it *is* busy waiting.\n\nWith a larger timeout, it gets less worse, but is still busy waiting.",
    "created_at": "2015-05-11T17:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96176",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@jdemeyer](#comment:48):
> Why do you think it's busy waiting? It looks like it's reading with a timeout, which is not busy waiting.

Unless the timeout is `None`, it *is* busy waiting.

With a larger timeout, it gets less worse, but is still busy waiting.



---

archive/issue_comments_096177.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@sagetrac-bpage](#comment:50):\n> @nexttime Re: rewriting the loop.  For sure if you have the time but I think the priority should be to get pexpect updated soonest.\n\nOf course on a follow-up, as I said before.\n\n`sleep(0)` shouldn't be necessary because of the (many!) system calls in the loop.",
    "created_at": "2015-05-11T17:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96177",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@sagetrac-bpage](#comment:50):
> @nexttime Re: rewriting the loop.  For sure if you have the time but I think the priority should be to get pexpect updated soonest.

Of course on a follow-up, as I said before.

`sleep(0)` shouldn't be necessary because of the (many!) system calls in the loop.



---

archive/issue_comments_096178.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nhttps://github.com/pexpect/pexpect/issues/215",
    "created_at": "2015-05-11T17:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96178",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:53" align="right">comment:53</div>

https://github.com/pexpect/pexpect/issues/215



---

archive/issue_comments_096179.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@sagetrac-bpage](#comment:53):\n> https://github.com/pexpect/pexpect/issues/215\n\nThank you for linking back... B)\n\n(Hope the guys don't get my address.)",
    "created_at": "2015-05-11T17:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96179",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@sagetrac-bpage](#comment:53):
> https://github.com/pexpect/pexpect/issues/215

Thank you for linking back... B)

(Hope the guys don't get my address.)



---

archive/issue_comments_096180.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@nexttime](#comment:51):\n> Replying to [@jdemeyer](#comment:48):\n> > Why do you think it's busy waiting? It looks like it's reading with a timeout, which is not busy waiting.\n\n> \n> Unless the timeout is `None`, it *is* busy waiting.\n> \n> With a larger timeout, it gets less worse, but is still busy waiting.\n\nOk, it's not as bad as I first thought, since the loop is exited upon the first timeout (which is on the *total* time spent in `expect_loop()`, but also used in `select()`).  So it depends on what happens in the application upon timeout, and the timeout chosen.",
    "created_at": "2015-05-11T21:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96180",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@nexttime](#comment:51):
> Replying to [@jdemeyer](#comment:48):
> > Why do you think it's busy waiting? It looks like it's reading with a timeout, which is not busy waiting.

> 
> Unless the timeout is `None`, it *is* busy waiting.
> 
> With a larger timeout, it gets less worse, but is still busy waiting.

Ok, it's not as bad as I first thought, since the loop is exited upon the first timeout (which is on the *total* time spent in `expect_loop()`, but also used in `select()`).  So it depends on what happens in the application upon timeout, and the timeout chosen.



---

archive/issue_comments_096181.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nIt would be good if upstream were accepting one of the possible changes.\n\n`@`Bill I see you have made a pull request can you tell us the results from travis when you have them? If it passes the tests I'll update the branch.",
    "created_at": "2015-05-12T03:20:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96181",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:56" align="right">comment:56</div>

It would be good if upstream were accepting one of the possible changes.

`@`Bill I see you have made a pull request can you tell us the results from travis when you have them? If it passes the tests I'll update the branch.



---

archive/issue_comments_096182.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nHum.... I don't see much improvement by applying that patch at all.\n\n```\nsage: %time gp.eval('2+3')\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 24 ms\n'5'\n```\nNote that while William says there shouldn't be a cache there is definitely one\n\n```\nsage: %time gp.eval('2+3')\nCPU times: user 0 ns, sys: 20 ms, total: 20 ms\nWall time: 23.4 ms\n'5'\nsage: %time gp.eval('2+3')\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 309 us\n'5'\n```",
    "created_at": "2015-05-12T03:31:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96182",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:57" align="right">comment:57</div>

Hum.... I don't see much improvement by applying that patch at all.

```
sage: %time gp.eval('2+3')
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 24 ms
'5'
```
Note that while William says there shouldn't be a cache there is definitely one

```
sage: %time gp.eval('2+3')
CPU times: user 0 ns, sys: 20 ms, total: 20 ms
Wall time: 23.4 ms
'5'
sage: %time gp.eval('2+3')
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 309 us
'5'
```



---

archive/issue_comments_096183.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@kiwifb](#comment:57):\n> Note that while William says there shouldn't be a cache there is definitely one\n> \n> ```\n> sage: %time gp.eval('2+3')\n> CPU times: user 0 ns, sys: 20 ms, total: 20 ms\n> Wall time: 23.4 ms\n> '5'\n> sage: %time gp.eval('2+3')\n> CPU times: user 0 ns, sys: 0 ns, total: 0 ns\n> Wall time: 309 us\n> '5'\n> ```\n\nIsn't that just the overhead of starting up the process the first time you run it? If I subsequently send other strings to `gp`, such as `gp.eval('3+4')`, I get similar times. That's not consistent with caching.",
    "created_at": "2015-05-12T05:31:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96183",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@kiwifb](#comment:57):
> Note that while William says there shouldn't be a cache there is definitely one
> 
> ```
> sage: %time gp.eval('2+3')
> CPU times: user 0 ns, sys: 20 ms, total: 20 ms
> Wall time: 23.4 ms
> '5'
> sage: %time gp.eval('2+3')
> CPU times: user 0 ns, sys: 0 ns, total: 0 ns
> Wall time: 309 us
> '5'
> ```

Isn't that just the overhead of starting up the process the first time you run it? If I subsequently send other strings to `gp`, such as `gp.eval('3+4')`, I get similar times. That's not consistent with caching.



---

archive/issue_comments_096184.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nI hadn't thought of that. But then the figure for the first run with pexpect 2.0 is in us while it is ms for 3.3. So there is quite a gap for that. May be I will need to recheck the timing for 2.0. \n\n`timeit` is definitely in the same ballpark for 2.0 (94.4 us) and 3.3 (99.7 us) so you are probably right.",
    "created_at": "2015-05-12T06:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96184",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:59" align="right">comment:59</div>

I hadn't thought of that. But then the figure for the first run with pexpect 2.0 is in us while it is ms for 3.3. So there is quite a gap for that. May be I will need to recheck the timing for 2.0. 

`timeit` is definitely in the same ballpark for 2.0 (94.4 us) and 3.3 (99.7 us) so you are probably right.



---

archive/issue_comments_096185.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nFor info: upgrading pexpect might also solve another issue we are having when running Sage's doctests within a docker container. See comment by olliewalsh on:\n \nhttps://github.com/docker/docker/issues/12277\n\n@sagetrac-Vincent-Neri: using this branch might be the easiest way to try out a recent version of pexpect and experiment with olliewalsh's suggestion",
    "created_at": "2015-05-12T07:00:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96185",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:60" align="right">comment:60</div>

For info: upgrading pexpect might also solve another issue we are having when running Sage's doctests within a docker container. See comment by olliewalsh on:
 
https://github.com/docker/docker/issues/12277

@sagetrac-Vincent-Neri: using this branch might be the easiest way to try out a recent version of pexpect and experiment with olliewalsh's suggestion



---

archive/issue_comments_096186.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@kiwifb](#comment:56):\n> It would be good if upstream were accepting one of the possible changes.\n> \n> `@`Bill I see you have made a pull request can you tell us the results from travis when you have them? If it passes the tests I'll update the branch.\n\nhttps://github.com/pexpect/pexpect/pull/216\n\nI am not sure if the \"ci/teamcity\" result is real.  Could someone with more experience with this ci stuff take a look?",
    "created_at": "2015-05-12T11:45:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96186",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@kiwifb](#comment:56):
> It would be good if upstream were accepting one of the possible changes.
> 
> `@`Bill I see you have made a pull request can you tell us the results from travis when you have them? If it passes the tests I'll update the branch.

https://github.com/pexpect/pexpect/pull/216

I am not sure if the "ci/teamcity" result is real.  Could someone with more experience with this ci stuff take a look?



---

archive/issue_comments_096187.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nIt looks like a misconfiguration rather than a fault in pexpect but I couldn't affirm it 100%.",
    "created_at": "2015-05-12T12:27:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96187",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:62" align="right">comment:62</div>

It looks like a misconfiguration rather than a fault in pexpect but I couldn't affirm it 100%.



---

archive/issue_comments_096188.json:
```json
{
    "body": "Changed commit from **[a24eab3](https://github.com/sagemath/sagetrac-mirror/commit/a24eab3ce985874ab8445ed5e362bbeead76fd40)** to **[80cd29c](https://github.com/sagemath/sagetrac-mirror/commit/80cd29cee620bb62b53a389cff5f7db4aa65b2d6)**",
    "created_at": "2015-05-13T11:46:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96188",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a24eab3](https://github.com/sagemath/sagetrac-mirror/commit/a24eab3ce985874ab8445ed5e362bbeead76fd40)** to **[80cd29c](https://github.com/sagemath/sagetrac-mirror/commit/80cd29cee620bb62b53a389cff5f7db4aa65b2d6)**



---

archive/issue_comments_096189.json:
```json
{
    "body": "<div id=\"comment:63\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80cd29cee620bb62b53a389cff5f7db4aa65b2d6\">80cd29c</a></td><td><code>Add patch from https://github.com/pexpect/pexpect/pull/216</code></td></tr></table>\n",
    "created_at": "2015-05-13T11:46:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96189",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:63"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80cd29cee620bb62b53a389cff5f7db4aa65b2d6">80cd29c</a></td><td><code>Add patch from https://github.com/pexpect/pexpect/pull/216</code></td></tr></table>




---

archive/issue_comments_096190.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nThe failing test upstream for python3.3 is a bit annoying but I am pushing the patch anyway as we are only concerned with python2.7 and 3.4.x (or even 3.5) in the future. It looks like we may have to get ready to shift target to pexpect 4.0 if they solve their last issue for a release.",
    "created_at": "2015-05-13T11:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96190",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:64" align="right">comment:64</div>

The failing test upstream for python3.3 is a bit annoying but I am pushing the patch anyway as we are only concerned with python2.7 and 3.4.x (or even 3.5) in the future. It looks like we may have to get ready to shift target to pexpect 4.0 if they solve their last issue for a release.



---

archive/issue_comments_096191.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nWe'll also need a new release of sagenb or patch it, getting it done may be fun...",
    "created_at": "2015-05-13T11:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96191",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:65" align="right">comment:65</div>

We'll also need a new release of sagenb or patch it, getting it done may be fun...



---

archive/issue_comments_096192.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nNote that we can also re-implement the slow/broken parts in the Cython front-end `sage/interfaces/sagespawn.pyx`. Doing that for `expect_loop()` and `read_nonblocking()` might be worth it.",
    "created_at": "2015-06-23T15:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96192",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:66" align="right">comment:66</div>

Note that we can also re-implement the slow/broken parts in the Cython front-end `sage/interfaces/sagespawn.pyx`. Doing that for `expect_loop()` and `read_nonblocking()` might be worth it.



---

archive/issue_comments_096193.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nWhat advantage can we gain from using Cython to re-implement? I think it might be better to propose a different upstream patch, something like:\n\n   time.sleep(self.maxSleep)\n\nwhere maxSleep corresponds to a new optional parameter that defaults to 0.0001 for backward compatibility but which we can set to 0 in `expect.py`.  I have tested `time.sleep(0)` and it seems to have the same end effect in Sage as commenting it out (and the same failures upstream).  Given that they have apparently used similar strategies in the past, by making it optional I think we can expect upstream to agree to the change and that it would be incorporated into future versions of pexpect with no impact on Sage maintenance.",
    "created_at": "2015-06-23T16:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96193",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:67" align="right">comment:67</div>

What advantage can we gain from using Cython to re-implement? I think it might be better to propose a different upstream patch, something like:

   time.sleep(self.maxSleep)

where maxSleep corresponds to a new optional parameter that defaults to 0.0001 for backward compatibility but which we can set to 0 in `expect.py`.  I have tested `time.sleep(0)` and it seems to have the same end effect in Sage as commenting it out (and the same failures upstream).  Given that they have apparently used similar strategies in the past, by making it optional I think we can expect upstream to agree to the change and that it would be incorporated into future versions of pexpect with no impact on Sage maintenance.



---

archive/issue_comments_096194.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@sagetrac-bpage](#comment:67):\n> What advantage can we gain from using Cython to re-implement?\n\nI wasn't specifically talking about the `sleep(0.0001)` issue, it was just a general comment.\n\nWe could\n1. Directly call system calls instead of using `os.foo()`, leading to better performance and better reliability, especially w.r.t. interrupts.\n2. Use C strings instead of Python strings for performance.\n3. More generally change/add functionality without depending on upstream.",
    "created_at": "2015-06-23T17:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96194",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@sagetrac-bpage](#comment:67):
> What advantage can we gain from using Cython to re-implement?

I wasn't specifically talking about the `sleep(0.0001)` issue, it was just a general comment.

We could
1. Directly call system calls instead of using `os.foo()`, leading to better performance and better reliability, especially w.r.t. interrupts.
2. Use C strings instead of Python strings for performance.
3. More generally change/add functionality without depending on upstream.



---

archive/issue_comments_096195.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nIs there significant overhead calling `os.foo`?  By \"w.r.t. interrupts\" are you referring to the so called Python GIL that makes most things like this single-threaded? Would that mean that we would have to be careful to avoid mixing `os.foo` calls and direct system calls? I understand that this changes significantly in Python 3.  `pexpect 3.x` and `4.x` support some new asynchronous modes for i/o processing in Python 3 that might be of interest.\n\nI am sceptical that performance is significantly limited by string matching. I think this might only be the case if it is necessary to locate prompts within very large \"before\" buffers - something that does not happen frequently in the way that Sage calls external programs and when it does, performance may not be a priority.  Do you have any examples where this would be of benefit?\n\nIf the goal is to change/add functionality without depending on upstream perhaps the best choice would be to re-write `pexpect` entirely in cython, e.g. `cexpect`.  But it worries me every time the choice is made to re-invent things in Sage.",
    "created_at": "2015-06-23T17:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96195",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:69" align="right">comment:69</div>

Is there significant overhead calling `os.foo`?  By "w.r.t. interrupts" are you referring to the so called Python GIL that makes most things like this single-threaded? Would that mean that we would have to be careful to avoid mixing `os.foo` calls and direct system calls? I understand that this changes significantly in Python 3.  `pexpect 3.x` and `4.x` support some new asynchronous modes for i/o processing in Python 3 that might be of interest.

I am sceptical that performance is significantly limited by string matching. I think this might only be the case if it is necessary to locate prompts within very large "before" buffers - something that does not happen frequently in the way that Sage calls external programs and when it does, performance may not be a priority.  Do you have any examples where this would be of benefit?

If the goal is to change/add functionality without depending on upstream perhaps the best choice would be to re-write `pexpect` entirely in cython, e.g. `cexpect`.  But it worries me every time the choice is made to re-invent things in Sage.



---

archive/issue_comments_096196.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@sagetrac-bpage](#comment:69):\n> Is there significant overhead calling `os.foo`?\n\nNo idea, I haven't profiled anything. Most likely there is not a large overhead.\n\n> By \"w.r.t. interrupts\" are you referring to the so called Python GIL that makes most things like this single-threaded?\n\nNo, but that could actually be a 4th point on my list above.\n\n> Would that mean that we would have to be careful to avoid mixing `os.foo` calls and direct system calls?\n\nNo, there is no such problem.\n\n> I understand that this changes significantly in Python 3.\n\nI have no idea what changes in Python 3 for system calls.\n\n> I am sceptical that performance is significantly limited by string matching. I think this might only be the case if it is necessary to locate prompts within very large \"before\" buffers - something that does not happen frequently in the way that Sage calls external programs and when it does, performance may not be a priority.  Do you have any examples where this would be of benefit?\n\nIt happens a lot in practice: it happens when a `pexpect` process has a large output (which is then followed by a prompt). See the last example of [comment:30]\n\n> If the goal is to change/add functionality without depending on upstream perhaps the best choice would be to re-write `pexpect` entirely in cython, e.g. `cexpect`.\n\nI don't really want to fork completely `pexpect`. It might be sufficient to change only `expect` and `read_nonblocking`.",
    "created_at": "2015-06-23T17:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96196",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@sagetrac-bpage](#comment:69):
> Is there significant overhead calling `os.foo`?

No idea, I haven't profiled anything. Most likely there is not a large overhead.

> By "w.r.t. interrupts" are you referring to the so called Python GIL that makes most things like this single-threaded?

No, but that could actually be a 4th point on my list above.

> Would that mean that we would have to be careful to avoid mixing `os.foo` calls and direct system calls?

No, there is no such problem.

> I understand that this changes significantly in Python 3.

I have no idea what changes in Python 3 for system calls.

> I am sceptical that performance is significantly limited by string matching. I think this might only be the case if it is necessary to locate prompts within very large "before" buffers - something that does not happen frequently in the way that Sage calls external programs and when it does, performance may not be a priority.  Do you have any examples where this would be of benefit?

It happens a lot in practice: it happens when a `pexpect` process has a large output (which is then followed by a prompt). See the last example of [comment:30]

> If the goal is to change/add functionality without depending on upstream perhaps the best choice would be to re-write `pexpect` entirely in cython, e.g. `cexpect`.

I don't really want to fork completely `pexpect`. It might be sufficient to change only `expect` and `read_nonblocking`.



---

archive/issue_comments_096197.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@sagetrac-bpage](#comment:69):\n> By \"w.r.t. interrupts\" are you referring to the so called Python GIL that makes most things like this single-threaded?\n\nNo, with \"interrupts\" I am talking about CTRL-C, a.k.a. `KeyboardInterrupt` in Python. The problem is that Python's `os` interface really doesn't deal with those well. Here is the problem:\n\n```\ntry:\n    result = os.read(fd)\nexcept KeyboardInterrupt:\n    # ... ?\n```\nThe problem is that, when an interrupt happens, you simply cannot know whether the `read()` call actually succeeded and what the result is (the interrupt could happen while assigned the result for example).\n\nI don't know to what extent this is actually a problem in practice, but it is something that worries me about `pexpect`.\n\nIn Cython, interrupt handling has to be done manually, which means that it can be done in a predictable way.",
    "created_at": "2015-06-23T18:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96197",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@sagetrac-bpage](#comment:69):
> By "w.r.t. interrupts" are you referring to the so called Python GIL that makes most things like this single-threaded?

No, with "interrupts" I am talking about CTRL-C, a.k.a. `KeyboardInterrupt` in Python. The problem is that Python's `os` interface really doesn't deal with those well. Here is the problem:

```
try:
    result = os.read(fd)
except KeyboardInterrupt:
    # ... ?
```
The problem is that, when an interrupt happens, you simply cannot know whether the `read()` call actually succeeded and what the result is (the interrupt could happen while assigned the result for example).

I don't know to what extent this is actually a problem in practice, but it is something that worries me about `pexpect`.

In Cython, interrupt handling has to be done manually, which means that it can be done in a predictable way.



---

archive/issue_comments_096198.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [@jdemeyer](#comment:70):\n> Replying to [@sagetrac-bpage](#comment:69):\n> \n> > I am sceptical that performance is significantly limited by string matching. I think this might only be the case if it is necessary to locate prompts within very large \"before\" buffers - something that does not happen frequently in the way that Sage calls external programs and when it does, performance may not be a priority.  Do you have any examples where this would be of benefit?\n\n> It happens a lot in practice: it happens when a `pexpect` process has a large output (which is then followed by a prompt). See the last example of [comment:30]\n\nMy point was that I would not expect something like `%timeit s=str(gp.eval('2^10000'))` to be particularly fast.  But maybe it is important to note that `pexpect` already does make an effort to allow faster scanning for prompt if it can be represented as a fixed string rather than a regular expression.\n\n> \n> > If the goal is to change/add functionality without depending on upstream perhaps the best choice would be to re-write `pexpect` entirely in cython, e.g. `cexpect`.\n\n> I don't really want to fork completely `pexpect`. It might be sufficient to change only `expect` and `read_nonblocking`.\n\nIt seems to me that this is exactly the essential part of `pexpect` on which Sage depends. Most of the rest of `pexpect` is just program interface and portability.",
    "created_at": "2015-06-23T18:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96198",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [@jdemeyer](#comment:70):
> Replying to [@sagetrac-bpage](#comment:69):
> 
> > I am sceptical that performance is significantly limited by string matching. I think this might only be the case if it is necessary to locate prompts within very large "before" buffers - something that does not happen frequently in the way that Sage calls external programs and when it does, performance may not be a priority.  Do you have any examples where this would be of benefit?

> It happens a lot in practice: it happens when a `pexpect` process has a large output (which is then followed by a prompt). See the last example of [comment:30]

My point was that I would not expect something like `%timeit s=str(gp.eval('2^10000'))` to be particularly fast.  But maybe it is important to note that `pexpect` already does make an effort to allow faster scanning for prompt if it can be represented as a fixed string rather than a regular expression.

> 
> > If the goal is to change/add functionality without depending on upstream perhaps the best choice would be to re-write `pexpect` entirely in cython, e.g. `cexpect`.

> I don't really want to fork completely `pexpect`. It might be sufficient to change only `expect` and `read_nonblocking`.

It seems to me that this is exactly the essential part of `pexpect` on which Sage depends. Most of the rest of `pexpect` is just program interface and portability.



---

archive/issue_comments_096199.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nSee commit to pexpect\n\nhttps://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801\n\nby Jeff Quast.  Some discussion at\n\nhttps://gitter.im/pexpect/pexpect\n\nThe proposal is to make it possible for Sage to stop bundling an obsolete version of pexpect and to take advantage of recent improvements to pexpect including unicode support and support for Python 3.",
    "created_at": "2015-10-15T00:18:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96199",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:73" align="right">comment:73</div>

See commit to pexpect

https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801

by Jeff Quast.  Some discussion at

https://gitter.im/pexpect/pexpect

The proposal is to make it possible for Sage to stop bundling an obsolete version of pexpect and to take advantage of recent improvements to pexpect including unicode support and support for Python 3.



---

archive/issue_comments_096200.json:
```json
{
    "body": "<div id=\"comment:74\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8f493325f89857566fb66d4f49a96e3d6fb41da\">b8f4933</a></td><td><code>Merge branch 'develop' into pexpect3.3</code></td></tr></table>\n",
    "created_at": "2015-11-05T00:11:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96200",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:74"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8f493325f89857566fb66d4f49a96e3d6fb41da">b8f4933</a></td><td><code>Merge branch 'develop' into pexpect3.3</code></td></tr></table>




---

archive/issue_comments_096201.json:
```json
{
    "body": "Changed commit from **[80cd29c](https://github.com/sagemath/sagetrac-mirror/commit/80cd29cee620bb62b53a389cff5f7db4aa65b2d6)** to **[b8f4933](https://github.com/sagemath/sagetrac-mirror/commit/b8f493325f89857566fb66d4f49a96e3d6fb41da)**",
    "created_at": "2015-11-05T00:11:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96201",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[80cd29c](https://github.com/sagemath/sagetrac-mirror/commit/80cd29cee620bb62b53a389cff5f7db4aa65b2d6)** to **[b8f4933](https://github.com/sagemath/sagetrac-mirror/commit/b8f493325f89857566fb66d4f49a96e3d6fb41da)**



---

archive/issue_comments_096202.json:
```json
{
    "body": "<div id=\"comment:75\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13f9f4fb9c120de1ada2f6165f25cdbeb689d2c5\">13f9f4f</a></td><td><code>upgrade pexpect to top of git branch superfluous-sleep</code></td></tr></table>\n",
    "created_at": "2015-11-05T00:44:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96202",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:75"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13f9f4fb9c120de1ada2f6165f25cdbeb689d2c5">13f9f4f</a></td><td><code>upgrade pexpect to top of git branch superfluous-sleep</code></td></tr></table>




---

archive/issue_comments_096203.json:
```json
{
    "body": "Changed commit from **[b8f4933](https://github.com/sagemath/sagetrac-mirror/commit/b8f493325f89857566fb66d4f49a96e3d6fb41da)** to **[13f9f4f](https://github.com/sagemath/sagetrac-mirror/commit/13f9f4fb9c120de1ada2f6165f25cdbeb689d2c5)**",
    "created_at": "2015-11-05T00:44:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96203",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b8f4933](https://github.com/sagemath/sagetrac-mirror/commit/b8f493325f89857566fb66d4f49a96e3d6fb41da)** to **[13f9f4f](https://github.com/sagemath/sagetrac-mirror/commit/13f9f4fb9c120de1ada2f6165f25cdbeb689d2c5)**



---

archive/issue_comments_096204.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,10 @@\n-We use pexpect version 2.0. Shouldn't we upgrade to the current version 3.3?\n+We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?\n+\n+The present ticket is set to upgrade to https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801  which close to master (and beyond 4.0.1) at the time of writing.\n \n This may be related with the performance problem reported at #10294.\n \n See also #502.\n \n New upstream tarball:\n-[https://pypi.python.org/packages/source/p/pexpect/pexpect-3.3.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-3.3.tar.gz)\n+[http://www.lmona.de/files/sage/pexpect-4.0.1_p1.tar.bz2](http://www.lmona.de/files/sage/pexpect-4.0.1_p1.tar.bz2)\n``````\n",
    "created_at": "2015-11-05T00:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96204",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,10 @@
-We use pexpect version 2.0. Shouldn't we upgrade to the current version 3.3?
+We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?
+
+The present ticket is set to upgrade to https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801  which close to master (and beyond 4.0.1) at the time of writing.
 
 This may be related with the performance problem reported at #10294.
 
 See also #502.
 
 New upstream tarball:
-[https://pypi.python.org/packages/source/p/pexpect/pexpect-3.3.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-3.3.tar.gz)
+[http://www.lmona.de/files/sage/pexpect-4.0.1_p1.tar.bz2](http://www.lmona.de/files/sage/pexpect-4.0.1_p1.tar.bz2)
``````




---

archive/issue_comments_096205.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nOK this is to update/test on top of the superfluous-sleep branch of pexpect - this 4.0.1+ hence the `_p1` bit. We may move to an upstream release including this if all goes well.\n\nThe upgrade needs to be matched with a `sagenb` upgrade including matching fixes for the notebook. Sorry to have been this long in preparing this.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13f9f4fb9c120de1ada2f6165f25cdbeb689d2c5\">13f9f4f</a></td><td><code>upgrade pexpect to top of git branch superfluous-sleep</code></td></tr></table>\n",
    "created_at": "2015-11-05T00:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96205",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:76" align="right">comment:76</div>

OK this is to update/test on top of the superfluous-sleep branch of pexpect - this 4.0.1+ hence the `_p1` bit. We may move to an upstream release including this if all goes well.

The upgrade needs to be matched with a `sagenb` upgrade including matching fixes for the notebook. Sorry to have been this long in preparing this.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13f9f4fb9c120de1ada2f6165f25cdbeb689d2c5">13f9f4f</a></td><td><code>upgrade pexpect to top of git branch superfluous-sleep</code></td></tr></table>




---

archive/issue_comments_096206.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nThe matching change to `sagenb` is now https://github.com/sagemath/sagenb/pull/351.",
    "created_at": "2015-11-05T00:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96206",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:77" align="right">comment:77</div>

The matching change to `sagenb` is now https://github.com/sagemath/sagenb/pull/351.



---

archive/issue_comments_096207.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nBill, have you tried the new branch and tarball?",
    "created_at": "2015-11-10T01:32:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96207",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:78" align="right">comment:78</div>

Bill, have you tried the new branch and tarball?



---

archive/issue_events_135326.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-11-17T20:14:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135326"
}
```



---

archive/issue_events_135327.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-23T14:12:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135327"
}
```



---

archive/issue_events_135328.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-23T14:12:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135328"
}
```



---

archive/issue_events_135329.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-23T14:12:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135329"
}
```



---

archive/issue_events_135330.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-23T14:12:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135330"
}
```



---

archive/issue_comments_096208.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nWhy the custom tarball? Usually in Sage, we try using an upstream tarball with Sage patches.",
    "created_at": "2015-11-23T14:12:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96208",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:80" align="right">comment:80</div>

Why the custom tarball? Usually in Sage, we try using an upstream tarball with Sage patches.



---

archive/issue_comments_096209.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nIf you can give very explicit instructions on how to test these simultaneously I should be okay to try to merge this over Thanksgiving (US).  Do you expect (hah!) any differences between local installations and server ones?",
    "created_at": "2015-11-23T15:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96209",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:81" align="right">comment:81</div>

If you can give very explicit instructions on how to test these simultaneously I should be okay to try to merge this over Thanksgiving (US).  Do you expect (hah!) any differences between local installations and server ones?



---

archive/issue_comments_096210.json:
```json
{
    "body": "Dependencies: **#19616**",
    "created_at": "2015-11-23T15:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96210",
    "user": "https://github.com/kcrisman"
}
```

Dependencies: **#19616**



---

archive/issue_comments_096211.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nReplying to [@jdemeyer](#comment:80):\n> Why the custom tarball? Usually in Sage, we try using an upstream tarball with Sage patches.\n\nYes and I tried to do it that way. But just taking the latest release and then adding the patch from the commit didn't work. That particular branch was split from master sometimes after the latest release and sticking to `pexpect 4.0.1` means that I was going to have to do some backporting. Because it was not obvious I decided to bit the bullet and ship the branch.",
    "created_at": "2015-11-23T22:19:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96211",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:83" align="right">comment:83</div>

Replying to [@jdemeyer](#comment:80):
> Why the custom tarball? Usually in Sage, we try using an upstream tarball with Sage patches.

Yes and I tried to do it that way. But just taking the latest release and then adding the patch from the commit didn't work. That particular branch was split from master sometimes after the latest release and sticking to `pexpect 4.0.1` means that I was going to have to do some backporting. Because it was not obvious I decided to bit the bullet and ship the branch.



---

archive/issue_comments_096212.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nI think you should then do either of the following two things:\n\n(A) properly document how the tarball was made: I should be able to follow your instructions and end up with the same files.\n\n(B) add a patch between the branch you want to use and the latest upstream stable release. Then there will be no issues of a patch not applying.",
    "created_at": "2015-11-24T08:40:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96212",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:84" align="right">comment:84</div>

I think you should then do either of the following two things:

(A) properly document how the tarball was made: I should be able to follow your instructions and end up with the same files.

(B) add a patch between the branch you want to use and the latest upstream stable release. Then there will be no issues of a patch not applying.



---

archive/issue_comments_096213.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nAlso, fill in your author name.",
    "created_at": "2015-11-24T08:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96213",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:85" align="right">comment:85</div>

Also, fill in your author name.



---

archive/issue_events_135331.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-24T08:40:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135331"
}
```



---

archive/issue_events_135332.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-11-24T08:40:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135332"
}
```



---

archive/issue_comments_096214.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nFair enough I put it to review after all. Patch between 4.0.1 and the state of this branch is 50KB :( no wonder the patch from the commit just didn't apply. Anyway all these things are incoming.",
    "created_at": "2015-11-24T09:02:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96214",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:86" align="right">comment:86</div>

Fair enough I put it to review after all. Patch between 4.0.1 and the state of this branch is 50KB :( no wonder the patch from the commit just didn't apply. Anyway all these things are incoming.



---

archive/issue_comments_096215.json:
```json
{
    "body": "<div id=\"comment:87\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90aebce1238710a9df18d6cd6aed6ce765caaf93\">90aebce</a></td><td><code>Base the package on pexpect 4.0.1 with the help of a patch to get to the desired superfluous sleep branch of pexpect.</code></td></tr></table>\n",
    "created_at": "2015-11-24T09:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96215",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:87"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90aebce1238710a9df18d6cd6aed6ce765caaf93">90aebce</a></td><td><code>Base the package on pexpect 4.0.1 with the help of a patch to get to the desired superfluous sleep branch of pexpect.</code></td></tr></table>




---

archive/issue_comments_096216.json:
```json
{
    "body": "Changed commit from **[13f9f4f](https://github.com/sagemath/sagetrac-mirror/commit/13f9f4fb9c120de1ada2f6165f25cdbeb689d2c5)** to **[90aebce](https://github.com/sagemath/sagetrac-mirror/commit/90aebce1238710a9df18d6cd6aed6ce765caaf93)**",
    "created_at": "2015-11-24T09:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96216",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[13f9f4f](https://github.com/sagemath/sagetrac-mirror/commit/13f9f4fb9c120de1ada2f6165f25cdbeb689d2c5)** to **[90aebce](https://github.com/sagemath/sagetrac-mirror/commit/90aebce1238710a9df18d6cd6aed6ce765caaf93)**



---

archive/issue_events_135333.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-11-24T09:20:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135333"
}
```



---

archive/issue_events_135334.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-11-24T09:20:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135334"
}
```



---

archive/issue_comments_096217.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey, Bill Page**",
    "created_at": "2015-11-24T09:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96217",
    "user": "https://github.com/kiwifb"
}
```

Author: **Fran√ßois Bissey, Bill Page**



---

archive/issue_comments_096218.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,11 @@\n We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?\n \n-The present ticket is set to upgrade to https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801  which close to master (and beyond 4.0.1) at the time of writing.\n+The present ticket is set to upgrade to pexpect 4.0.1 with material from the \"superfluous sleep\" branch of pexpect which includes behavior we requested from pexpect.\n+[https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801](https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801)\n \n This may be related with the performance problem reported at #10294.\n \n See also #502.\n \n New upstream tarball:\n-[http://www.lmona.de/files/sage/pexpect-4.0.1_p1.tar.bz2](http://www.lmona.de/files/sage/pexpect-4.0.1_p1.tar.bz2)\n+[https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)\n``````\n",
    "created_at": "2015-11-24T09:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96218",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,11 @@
 We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?
 
-The present ticket is set to upgrade to https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801  which close to master (and beyond 4.0.1) at the time of writing.
+The present ticket is set to upgrade to pexpect 4.0.1 with material from the "superfluous sleep" branch of pexpect which includes behavior we requested from pexpect.
+[https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801](https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801)
 
 This may be related with the performance problem reported at #10294.
 
 See also #502.
 
 New upstream tarball:
-[http://www.lmona.de/files/sage/pexpect-4.0.1_p1.tar.bz2](http://www.lmona.de/files/sage/pexpect-4.0.1_p1.tar.bz2)
+[https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)
``````




---

archive/issue_comments_096219.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nIf this doesn't make any more progress in the next few days I will probably just revert [this sagenb commit](https://github.com/sagemath/sagenb/commit/ab1f775af96583e5b9db79f53c5f3613f2815894) upstream and release something, then we could have a specific sagenb just for this ticket later.",
    "created_at": "2015-12-01T04:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96219",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:89" align="right">comment:89</div>

If this doesn't make any more progress in the next few days I will probably just revert [this sagenb commit](https://github.com/sagemath/sagenb/commit/ab1f775af96583e5b9db79f53c5f3613f2815894) upstream and release something, then we could have a specific sagenb just for this ticket later.



---

archive/issue_comments_096220.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nNote that there is a circular dependency with #19616. Can somebody please clarify?",
    "created_at": "2015-12-01T15:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96220",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:90" align="right">comment:90</div>

Note that there is a circular dependency with #19616. Can somebody please clarify?



---

archive/issue_comments_096221.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\n[fbissey said](https://github.com/sagemath/sagenb/pull/351#issuecomment-157493140) that the packages need to be updated simultaneously; assuming that #19616 ends up including [this commit](https://github.com/sagemath/sagenb/commit/ab1f775af96583e5b9db79f53c5f3613f2815894), then that ticket would be the one.",
    "created_at": "2015-12-01T15:14:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96221",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:91" align="right">comment:91</div>

[fbissey said](https://github.com/sagemath/sagenb/pull/351#issuecomment-157493140) that the packages need to be updated simultaneously; assuming that #19616 ends up including [this commit](https://github.com/sagemath/sagenb/commit/ab1f775af96583e5b9db79f53c5f3613f2815894), then that ticket would be the one.



---

archive/issue_comments_096222.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nSorry to ask the obvious question, but did anybody ever check that Sage even starts with this branch? Because it doesn't for me...\n\n```\nTraceback (most recent call last):\n  File \"/usr/local/src/sage-config/src/bin/sage-ipython\", line 10, in <module>\n    from sage.repl.interpreter import SageTerminalApp\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/interpreter.py\", line 218, in <module>\n    from IPython.core.interactiveshell import InteractiveShell\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/__init__.py\", line 47, in <module>\n    from .core.application import Application\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/application.py\", line 24, in <module>\n    from IPython.core import release, crashhandler\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/crashhandler.py\", line 28, in <module>\n    from IPython.core import ultratb\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/ultratb.py\", line 116, in <module>\n    from IPython.utils import path as util_path\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/utils/path.py\", line 19, in <module>\n    from IPython.utils.process import system\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/utils/process.py\", line 19, in <module>\n    from ._process_posix import system, getoutput, arg_split, check_pid\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/utils/_process_posix.py\", line 24, in <module>\n    import pexpect\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/pexpect/__init__.py\", line 75, in <module>\n    from .pty_spawn import spawn, spawnu\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 11, in <module>\n    import ptyprocess\nImportError: No module named ptyprocess\n```",
    "created_at": "2015-12-01T20:21:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96222",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:92" align="right">comment:92</div>

Sorry to ask the obvious question, but did anybody ever check that Sage even starts with this branch? Because it doesn't for me...

```
Traceback (most recent call last):
  File "/usr/local/src/sage-config/src/bin/sage-ipython", line 10, in <module>
    from sage.repl.interpreter import SageTerminalApp
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/interpreter.py", line 218, in <module>
    from IPython.core.interactiveshell import InteractiveShell
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/__init__.py", line 47, in <module>
    from .core.application import Application
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/application.py", line 24, in <module>
    from IPython.core import release, crashhandler
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/crashhandler.py", line 28, in <module>
    from IPython.core import ultratb
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/ultratb.py", line 116, in <module>
    from IPython.utils import path as util_path
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/utils/path.py", line 19, in <module>
    from IPython.utils.process import system
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/utils/process.py", line 19, in <module>
    from ._process_posix import system, getoutput, arg_split, check_pid
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/utils/_process_posix.py", line 24, in <module>
    import pexpect
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/pexpect/__init__.py", line 75, in <module>
    from .pty_spawn import spawn, spawnu
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 11, in <module>
    import ptyprocess
ImportError: No module named ptyprocess
```



---

archive/issue_events_135335.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-01T20:21:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135335"
}
```



---

archive/issue_events_135336.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-01T20:21:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135336"
}
```



---

archive/issue_comments_096223.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2015-12-01T20:21:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96223",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_096224.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nBother, I didn't notice that this bit was split off. Works brilliantly in sage-on-gentoo. Seriously I was counting on Bill to look it over weeks ago, but he disappeared. I'll be pushing the needed dependencies ASAP.",
    "created_at": "2015-12-01T20:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96224",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:93" align="right">comment:93</div>

Bother, I didn't notice that this bit was split off. Works brilliantly in sage-on-gentoo. Seriously I was counting on Bill to look it over weeks ago, but he disappeared. I'll be pushing the needed dependencies ASAP.



---

archive/issue_comments_096225.json:
```json
{
    "body": "Changed commit from **[90aebce](https://github.com/sagemath/sagetrac-mirror/commit/90aebce1238710a9df18d6cd6aed6ce765caaf93)** to **[fe10661](https://github.com/sagemath/sagetrac-mirror/commit/fe1066154892173d17bed1892886dc8148fa33f5)**",
    "created_at": "2015-12-01T20:46:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96225",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[90aebce](https://github.com/sagemath/sagetrac-mirror/commit/90aebce1238710a9df18d6cd6aed6ce765caaf93)** to **[fe10661](https://github.com/sagemath/sagetrac-mirror/commit/fe1066154892173d17bed1892886dc8148fa33f5)**



---

archive/issue_comments_096226.json:
```json
{
    "body": "<div id=\"comment:94\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe1066154892173d17bed1892886dc8148fa33f5\">fe10661</a></td><td><code>Add ptyprocess as a dependency of pexpect, clean pexpect SPKG.txt and update the license</code></td></tr></table>\n",
    "created_at": "2015-12-01T20:46:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96226",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:94"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe1066154892173d17bed1892886dc8148fa33f5">fe10661</a></td><td><code>Add ptyprocess as a dependency of pexpect, clean pexpect SPKG.txt and update the license</code></td></tr></table>




---

archive/issue_events_135337.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-12-01T20:49:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135337"
}
```



---

archive/issue_events_135338.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-12-01T20:49:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135338"
}
```



---

archive/issue_comments_096227.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nShould work now.",
    "created_at": "2015-12-01T20:49:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96227",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:95" align="right">comment:95</div>

Should work now.



---

archive/issue_comments_096228.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nI am sorry but I have been focusing on other unrelated things. I am kind of lost and confused about how to test this kind of change in Sage.  What exactly do I need to do? Can I just checkout a branch using git and build Sage? Steps?",
    "created_at": "2015-12-01T20:56:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96228",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:96" align="right">comment:96</div>

I am sorry but I have been focusing on other unrelated things. I am kind of lost and confused about how to test this kind of change in Sage.  What exactly do I need to do? Can I just checkout a branch using git and build Sage? Steps?



---

archive/issue_comments_096229.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nReplying to [@sagetrac-bpage](#comment:96):\n> Can I just checkout a branch using git and build Sage?\n\nPrecisely. The easiest way to get access to the Trac branches is using `git-trac`: \nhttp://doc.sagemath.org/html/en/developer/git_trac.html\n\nOnce you have Sage and `git-trac` set up, you should be able to do\n\n```\n$ git trac checkout 10295\n$ make\n```",
    "created_at": "2015-12-01T21:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96229",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:97" align="right">comment:97</div>

Replying to [@sagetrac-bpage](#comment:96):
> Can I just checkout a branch using git and build Sage?

Precisely. The easiest way to get access to the Trac branches is using `git-trac`: 
http://doc.sagemath.org/html/en/developer/git_trac.html

Once you have Sage and `git-trac` set up, you should be able to do

```
$ git trac checkout 10295
$ make
```



---

archive/issue_comments_096230.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nUpstream tarball for `ptyprocess`?",
    "created_at": "2015-12-01T21:16:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96230",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:98" align="right">comment:98</div>

Upstream tarball for `ptyprocess`?



---

archive/issue_events_135339.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-01T21:16:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135339"
}
```



---

archive/issue_events_135340.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-01T21:16:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135340"
}
```



---

archive/issue_comments_096231.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,5 +7,6 @@\n \n See also #502.\n \n-New upstream tarball:\n+New upstream tarballs:\n [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)\n+[https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)\n``````\n",
    "created_at": "2015-12-01T21:18:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96231",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,5 +7,6 @@
 
 See also #502.
 
-New upstream tarball:
+New upstream tarballs:
 [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)
+[https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)
``````




---

archive/issue_comments_096232.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nAdded.",
    "created_at": "2015-12-01T21:18:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96232",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:99" align="right">comment:99</div>

Added.



---

archive/issue_events_135341.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-12-01T21:18:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135341"
}
```



---

archive/issue_events_135342.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2015-12-01T21:18:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135342"
}
```



---

archive/issue_comments_096233.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nCombining the last two topics, I think these are the correct instructions for building Sage: first download the `pexpect` and `ptyprocess` tarballs (as given in the description) and stick them in `SAGE_ROOT/upstream/`. Then do\n\n```\n$ git trac checkout 10295\n$ make\n```",
    "created_at": "2015-12-01T21:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96233",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:0" align="right">comment:0</div>

Combining the last two topics, I think these are the correct instructions for building Sage: first download the `pexpect` and `ptyprocess` tarballs (as given in the description) and stick them in `SAGE_ROOT/upstream/`. Then do

```
$ git trac checkout 10295
$ make
```



---

archive/issue_comments_096234.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nOK, at least `ptyprocess` and `pexpect` build now. I'll rebuild Sage from scratch and test it overnight.",
    "created_at": "2015-12-01T21:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96234",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

OK, at least `ptyprocess` and `pexpect` build now. I'll rebuild Sage from scratch and test it overnight.



---

archive/issue_comments_096235.json:
```json
{
    "body": "Changed dependencies from **#19616** to none",
    "created_at": "2015-12-02T02:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96235",
    "user": "https://github.com/kcrisman"
}
```

Changed dependencies from **#19616** to none



---

archive/issue_comments_096236.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI'm going to have to make a different ticket for this sagenb update than originally anticipated, I think.",
    "created_at": "2015-12-02T02:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96236",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

I'm going to have to make a different ticket for this sagenb update than originally anticipated, I think.



---

archive/issue_comments_096237.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI get some failures:\n\n```\n----------------------------------------------------------------------\nsage -t --long src/sage/interfaces/gap.py  # 14 doctests failed\nsage -t --long src/sage/interfaces/expect.py  # Timed out\n----------------------------------------------------------------------\n```\nFor the first one, there are lots of errors of this sort:\n\n```\nsage -t --long src/sage/interfaces/gap.py\n**********************************************************************\nFile \"src/sage/interfaces/gap.py\", line 717, in sage.interfaces.gap.Gap_generic._eval_line\nFailed example:\n    a\nExpected:\n    3\nGot:\n    ** Gap crashed or quit executing 'Print($sage1);' **\n    Restarting Gap and trying again\n    <repr(<sage.interfaces.gap.GapElement at 0x10cd07870>) failed: RuntimeError: Gap produced error output\n    Error, Variable: '$sage1' must have a value\n    <BLANKLINE>\n       executing Print($sage1);>\n**********************************************************************\nFile \"src/sage/interfaces/gap.py\", line 779, in sage.interfaces.gap.Gap_generic.unbind\nFailed example:\n    gap.set('x', '2')\nExpected nothing\nGot:\n    ** Gap crashed or quit executing 'x:=2;;' **\n    Restarting Gap and trying again\n**********************************************************************\n```\nFor the second one, the start of that part of the log looks like this:\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 708, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular('a')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496\\\n, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858\\\n, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line_using_file[4]>\", line 1, in <module>\n        singular('a')\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", lin\\\ne 788, in __call__\n        return SingularElement(self, type, x, False)\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", lin\\\ne 1266, in __init__\n        raise_(TypeError, x, sys.exc_info()[2])\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", lin\\\ne 1261, in __init__\n        self._name = parent._create( value, type)\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", lin\\\ne 749, in _create\n        self.set(type, name, value)\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", lin\\\ne 692, in set\n        self.eval(cmd)\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", lin\\\ne 650, in eval\n        raise SingularError('Singular error:\\n%s'%s)\n    TypeError: Singular error:\n       ? `a` is undefined\n       ? error occurred in or before STDIN line 12: `def sage15=a;`\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 710, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular.eval('quit;')\nExpected:\n    ''\nGot:\n    Singular crashed -- automatically restarting.\n    ''\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 721, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular(3)\nExpected:\n    Singular crashed -- automatically restarting.\n    3\nGot:\n    Singular crashed -- automatically restarting.\n    Singular crashed -- automatically restarting.\n    Singular crashed -- automatically restarting.\n    <repr(<sage.interfaces.singular.SingularElement at 0x11ac13fa0>) failed: AttributeError: 'NoneType' object has no attri\\\nbute 'group'>\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 800, in sage.interfaces.expect.Expect._eval_line\nFailed example:\n    singular._eval_line('def a=3;')\nExpected:\n    ''\nGot:\n    Singular crashed -- automatically restarting.\n    ''\n**********************************************************************\n```\nThis is on OS X 10.10, Sage built from scratch.",
    "created_at": "2015-12-02T02:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96237",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

I get some failures:

```
----------------------------------------------------------------------
sage -t --long src/sage/interfaces/gap.py  # 14 doctests failed
sage -t --long src/sage/interfaces/expect.py  # Timed out
----------------------------------------------------------------------
```
For the first one, there are lots of errors of this sort:

```
sage -t --long src/sage/interfaces/gap.py
**********************************************************************
File "src/sage/interfaces/gap.py", line 717, in sage.interfaces.gap.Gap_generic._eval_line
Failed example:
    a
Expected:
    3
Got:
    ** Gap crashed or quit executing 'Print($sage1);' **
    Restarting Gap and trying again
    <repr(<sage.interfaces.gap.GapElement at 0x10cd07870>) failed: RuntimeError: Gap produced error output
    Error, Variable: '$sage1' must have a value
    <BLANKLINE>
       executing Print($sage1);>
**********************************************************************
File "src/sage/interfaces/gap.py", line 779, in sage.interfaces.gap.Gap_generic.unbind
Failed example:
    gap.set('x', '2')
Expected nothing
Got:
    ** Gap crashed or quit executing 'x:=2;;' **
    Restarting Gap and trying again
**********************************************************************
```
For the second one, the start of that part of the log looks like this:

```
**********************************************************************
File "src/sage/interfaces/expect.py", line 708, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular('a')
Exception raised:
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496\
, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858\
, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[4]>", line 1, in <module>
        singular('a')
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py", lin\
e 788, in __call__
        return SingularElement(self, type, x, False)
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py", lin\
e 1266, in __init__
        raise_(TypeError, x, sys.exc_info()[2])
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py", lin\
e 1261, in __init__
        self._name = parent._create( value, type)
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py", lin\
e 749, in _create
        self.set(type, name, value)
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py", lin\
e 692, in set
        self.eval(cmd)
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/interfaces/singular.py", lin\
e 650, in eval
        raise SingularError('Singular error:\n%s'%s)
    TypeError: Singular error:
       ? `a` is undefined
       ? error occurred in or before STDIN line 12: `def sage15=a;`
**********************************************************************
File "src/sage/interfaces/expect.py", line 710, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular.eval('quit;')
Expected:
    ''
Got:
    Singular crashed -- automatically restarting.
    ''
**********************************************************************
File "src/sage/interfaces/expect.py", line 721, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular(3)
Expected:
    Singular crashed -- automatically restarting.
    3
Got:
    Singular crashed -- automatically restarting.
    Singular crashed -- automatically restarting.
    Singular crashed -- automatically restarting.
    <repr(<sage.interfaces.singular.SingularElement at 0x11ac13fa0>) failed: AttributeError: 'NoneType' object has no attri\
bute 'group'>
**********************************************************************
File "src/sage/interfaces/expect.py", line 800, in sage.interfaces.expect.Expect._eval_line
Failed example:
    singular._eval_line('def a=3;')
Expected:
    ''
Got:
    Singular crashed -- automatically restarting.
    ''
**********************************************************************
```
This is on OS X 10.10, Sage built from scratch.



---

archive/issue_comments_096238.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThat is new and I should try a build on OS X 10.11.",
    "created_at": "2015-12-02T03:57:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96238",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

That is new and I should try a build on OS X 10.11.



---

archive/issue_comments_096239.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI get similar errors as jhpalmieri.",
    "created_at": "2015-12-02T07:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96239",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

I get similar errors as jhpalmieri.



---

archive/issue_comments_096240.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think I am an idiot. I need to add a bit that's different for this branch than what we had before with `pexpect-3.3`.",
    "created_at": "2015-12-02T07:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96240",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

I think I am an idiot. I need to add a bit that's different for this branch than what we had before with `pexpect-3.3`.



---

archive/issue_comments_096241.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e463e51f47e8ff3035921b9213a4e580e1f70f1\">6e463e5</a></td><td><code>Set the new delayafterread parameter to restore pexpect behavior, and restore pexpect 3.3 and under behavior with regards to sighup.</code></td></tr></table>\n",
    "created_at": "2015-12-02T10:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96241",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e463e51f47e8ff3035921b9213a4e580e1f70f1">6e463e5</a></td><td><code>Set the new delayafterread parameter to restore pexpect behavior, and restore pexpect 3.3 and under behavior with regards to sighup.</code></td></tr></table>




---

archive/issue_comments_096242.json:
```json
{
    "body": "Changed commit from **[fe10661](https://github.com/sagemath/sagetrac-mirror/commit/fe1066154892173d17bed1892886dc8148fa33f5)** to **[6e463e5](https://github.com/sagemath/sagetrac-mirror/commit/6e463e51f47e8ff3035921b9213a4e580e1f70f1)**",
    "created_at": "2015-12-02T10:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96242",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fe10661](https://github.com/sagemath/sagetrac-mirror/commit/fe1066154892173d17bed1892886dc8148fa33f5)** to **[6e463e5](https://github.com/sagemath/sagetrac-mirror/commit/6e463e51f47e8ff3035921b9213a4e580e1f70f1)**



---

archive/issue_comments_096243.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe last commit is not sufficient to solve the observed problems but it should be included especially with regards to speed. Still have to find the post `pexpect-4.0.1` change responsible for these.",
    "created_at": "2015-12-02T10:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96243",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">comment:8</div>

The last commit is not sufficient to solve the observed problems but it should be included especially with regards to speed. Still have to find the post `pexpect-4.0.1` change responsible for these.



---

archive/issue_comments_096244.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI think it's better to move those changes to the `SageSpawn` class instead (see `src/sage/interfaces/sagespawn.pyx`).",
    "created_at": "2015-12-02T13:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96244",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

I think it's better to move those changes to the `SageSpawn` class instead (see `src/sage/interfaces/sagespawn.pyx`).



---

archive/issue_comments_096245.json:
```json
{
    "body": "Changed branch from **[u/fbissey/pexpect3.3](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/pexpect3.3)** to **[u/jdemeyer/pexpect3.3](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/pexpect3.3)**",
    "created_at": "2015-12-02T13:34:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96245",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/fbissey/pexpect3.3](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/pexpect3.3)** to **[u/jdemeyer/pexpect3.3](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/pexpect3.3)**



---

archive/issue_comments_096246.json:
```json
{
    "body": "Changed commit from **[6e463e5](https://github.com/sagemath/sagetrac-mirror/commit/6e463e51f47e8ff3035921b9213a4e580e1f70f1)** to **[de71ef8](https://github.com/sagemath/sagetrac-mirror/commit/de71ef81f8acac4c3dd2219d87de897c965fc11a)**",
    "created_at": "2015-12-02T13:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96246",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[6e463e5](https://github.com/sagemath/sagetrac-mirror/commit/6e463e51f47e8ff3035921b9213a4e580e1f70f1)** to **[de71ef8](https://github.com/sagemath/sagetrac-mirror/commit/de71ef81f8acac4c3dd2219d87de897c965fc11a)**



---

archive/issue_comments_096247.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de71ef81f8acac4c3dd2219d87de897c965fc11a\">de71ef8</a></td><td><code>Set the new delayafterread parameter to restore pexpect behavior, and restore pexpect 3.3 and under behavior with regards to sighup.</code></td></tr></table>\n",
    "created_at": "2015-12-02T13:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96247",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de71ef81f8acac4c3dd2219d87de897c965fc11a">de71ef8</a></td><td><code>Set the new delayafterread parameter to restore pexpect behavior, and restore pexpect 3.3 and under behavior with regards to sighup.</code></td></tr></table>




---

archive/issue_events_135343.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-02T13:37:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135343"
}
```



---

archive/issue_events_135344.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-02T13:37:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135344"
}
```



---

archive/issue_comments_096248.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI think there is a new problem in `send()`. In certain cases, the following can happen:\n\n```\nTraceback (most recent call last):\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 870, in _eval_line\n    E.sendline(line)\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 529, in sendline\n    n = self.send(s)\n  File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 520, in send\n    return os.write(self.child_fd, b)\nOSError: [Errno 9] Bad file descriptor\n```",
    "created_at": "2015-12-02T14:31:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96248",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

I think there is a new problem in `send()`. In certain cases, the following can happen:

```
Traceback (most recent call last):
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 870, in _eval_line
    E.sendline(line)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 529, in sendline
    n = self.send(s)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 520, in send
    return os.write(self.child_fd, b)
OSError: [Errno 9] Bad file descriptor
```



---

archive/issue_comments_096249.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSomething is closing the file descriptor for the `pty`, but I haven't figured out which thing is doing that.",
    "created_at": "2015-12-02T15:31:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96249",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Something is closing the file descriptor for the `pty`, but I haven't figured out which thing is doing that.



---

archive/issue_comments_096250.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe file descriptor is closed during garbage collection.",
    "created_at": "2015-12-02T15:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96250",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

The file descriptor is closed during garbage collection.



---

archive/issue_comments_096251.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe change causing that is not actually between 4.0.1 and the current patch but in between 3.3 and 4.0.1. Quite a lot of change in there but it sounds like overeager garbage collection.",
    "created_at": "2015-12-02T20:58:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96251",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

The change causing that is not actually between 4.0.1 and the current patch but in between 3.3 and 4.0.1. Quite a lot of change in there but it sounds like overeager garbage collection.



---

archive/issue_comments_096252.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAdding `E._keep_alive()` in the `_eval_line` code in `sage/interfaces/expect.py` solves the problem for `expect.py` but not for `gap.py`. Presumably it is abusive and would have to be added in numerous place, and properly ripped afterwards, that doesn't scale.",
    "created_at": "2015-12-03T00:03:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96252",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

Adding `E._keep_alive()` in the `_eval_line` code in `sage/interfaces/expect.py` solves the problem for `expect.py` but not for `gap.py`. Presumably it is abusive and would have to be added in numerous place, and properly ripped afterwards, that doesn't scale.



---

archive/issue_comments_096253.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nLet me know when you're ready for me to make sagenb 0.11.6 with the one-character change needed...",
    "created_at": "2015-12-03T03:50:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96253",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:8" align="right">comment:8</div>

Let me know when you're ready for me to make sagenb 0.11.6 with the one-character change needed...



---

archive/issue_comments_096254.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI asked upstream for guidance, this is what they have to say so far:\nWhen the `PtyProcess` instance (`self.ptyproc` on a `Pexpect` spawn instance) is garbage collected, it will indeed close the file descriptor. But I don't see how that could have happened when you're still calling `E.sendline()` - clearly there is still a reference to the object, so it shouldn't be garbage collected.\n\nCould something else be closing an fd explicitly? I have run into odd effects before because the numbers representing fds are readily reused. If one fd gets closed while its corresponding 'handle' object (e.g. a `PtyProcess` instance) still exists, when the handle object is garbage collected, it may close an unrelated file which has been opened in the meantime:\n\n\n```\nA =  open('foo')\n# handle A with fd=5\nos.close(5)\nB = open('bar')\n# handle A with fd=5\n# handle B with fd=5\ndel A\n# handle A is garbage collected, closing fd 5\nB.read()\n# Bad fd!\n```",
    "created_at": "2015-12-03T20:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96254",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">comment:9</div>

I asked upstream for guidance, this is what they have to say so far:
When the `PtyProcess` instance (`self.ptyproc` on a `Pexpect` spawn instance) is garbage collected, it will indeed close the file descriptor. But I don't see how that could have happened when you're still calling `E.sendline()` - clearly there is still a reference to the object, so it shouldn't be garbage collected.

Could something else be closing an fd explicitly? I have run into odd effects before because the numbers representing fds are readily reused. If one fd gets closed while its corresponding 'handle' object (e.g. a `PtyProcess` instance) still exists, when the handle object is garbage collected, it may close an unrelated file which has been opened in the meantime:


```
A =  open('foo')
# handle A with fd=5
os.close(5)
B = open('bar')
# handle A with fd=5
# handle B with fd=5
del A
# handle A is garbage collected, closing fd 5
B.read()
# Bad fd!
```



---

archive/issue_comments_096255.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nIt looks like the stuff crashing is tests added by #10296",
    "created_at": "2015-12-03T21:58:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96255",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:0" align="right">comment:0</div>

It looks like the stuff crashing is tests added by #10296



---

archive/issue_comments_096256.json:
```json
{
    "body": "<div id=\"comment:121\" align=\"right\">comment:121</div>\n\nReplying to [@kiwifb](#comment:119):\n> Could something else be closing an fd explicitly?\n\nThis is a likely explanation of what is happening. The \"problem\" is that `pexpect` was split up in two independent parts (`pexpect` and `ptyprocess`) and the Sage wrapper `SageSpawn` tries to override the wrong `close()` method.",
    "created_at": "2015-12-04T06:37:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96256",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:121" align="right">comment:121</div>

Replying to [@kiwifb](#comment:119):
> Could something else be closing an fd explicitly?

This is a likely explanation of what is happening. The "problem" is that `pexpect` was split up in two independent parts (`pexpect` and `ptyprocess`) and the Sage wrapper `SageSpawn` tries to override the wrong `close()` method.



---

archive/issue_comments_096257.json:
```json
{
    "body": "Changed author from **Fran\u00e7ois Bissey, Bill Page** to **Fran\u00e7ois Bissey, Bill Page, Jeroen Demeyer**",
    "created_at": "2015-12-04T09:58:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96257",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Fran√ßois Bissey, Bill Page** to **Fran√ßois Bissey, Bill Page, Jeroen Demeyer**



---

archive/issue_comments_096258.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nWe need a custom wrapper over `PtyProcess` also.",
    "created_at": "2015-12-04T09:58:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96258",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

We need a custom wrapper over `PtyProcess` also.



---

archive/issue_comments_096259.json:
```json
{
    "body": "Upstream: **Not yet reported upstream; Will do shortly.**",
    "created_at": "2015-12-04T09:58:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96259",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Not yet reported upstream; Will do shortly.**



---

archive/issue_comments_096260.json:
```json
{
    "body": "Changed commit from **[de71ef8](https://github.com/sagemath/sagetrac-mirror/commit/de71ef81f8acac4c3dd2219d87de897c965fc11a)** to **[411c293](https://github.com/sagemath/sagetrac-mirror/commit/411c29346c9234aec8c920eae86c18f5209352a8)**",
    "created_at": "2015-12-04T10:16:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96260",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[de71ef8](https://github.com/sagemath/sagetrac-mirror/commit/de71ef81f8acac4c3dd2219d87de897c965fc11a)** to **[411c293](https://github.com/sagemath/sagetrac-mirror/commit/411c29346c9234aec8c920eae86c18f5209352a8)**



---

archive/issue_comments_096261.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/411c29346c9234aec8c920eae86c18f5209352a8\">411c293</a></td><td><code>Fix Sage wrapper around spawn/PtyProcess</code></td></tr></table>\n",
    "created_at": "2015-12-04T10:16:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96261",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/411c29346c9234aec8c920eae86c18f5209352a8">411c293</a></td><td><code>Fix Sage wrapper around spawn/PtyProcess</code></td></tr></table>




---

archive/issue_events_135345.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-04T10:17:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135345"
}
```



---

archive/issue_events_135346.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-04T10:17:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135346"
}
```



---

archive/issue_comments_096262.json:
```json
{
    "body": "Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. No feedback yet.**",
    "created_at": "2015-12-04T10:52:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96262",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. No feedback yet.**



---

archive/issue_comments_096263.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,9 @@\n \n See also #502.\n \n-New upstream tarballs:\n-[https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)\n-[https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)\n+**New upstream tarballs**:\n+* [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)\n+* [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)\n+\n+**Upstream patches included**:\n+* [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)\n``````\n",
    "created_at": "2015-12-04T10:52:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96263",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,9 @@
 
 See also #502.
 
-New upstream tarballs:
-[https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)
-[https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)
+**New upstream tarballs**:
+* [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)
+* [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)
+
+**Upstream patches included**:
+* [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)
``````




---

archive/issue_comments_096264.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,11 @@\n We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?\n \n-The present ticket is set to upgrade to pexpect 4.0.1 with material from the \"superfluous sleep\" branch of pexpect which includes behavior we requested from pexpect.\n-[https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801](https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801)\n-\n-This may be related with the performance problem reported at #10294.\n-\n-See also #502.\n+See also #502 and #10294.\n \n **New upstream tarballs**:\n * [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)\n * [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)\n \n **Upstream patches included**:\n+* [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)\n``````\n",
    "created_at": "2015-12-04T10:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96264",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,11 @@
 We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?
 
-The present ticket is set to upgrade to pexpect 4.0.1 with material from the "superfluous sleep" branch of pexpect which includes behavior we requested from pexpect.
-[https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801](https://github.com/pexpect/pexpect/commit/40ce421051c0a54f3b3849424491882cf1339801)
-
-This may be related with the performance problem reported at #10294.
-
-See also #502.
+See also #502 and #10294.
 
 **New upstream tarballs**:
 * [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)
 * [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)
 
 **Upstream patches included**:
+* [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
 * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)
``````




---

archive/issue_comments_096265.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe new `pexpect` seems slightly slower at reading large strings:\n\npexpect 2.0:\n\n```\nsage: timeit('str(gp(\"2^2^22\"))', repeat=10)\n5 loops, best of 10: 380 ms per loop\n```\n\npexpect 4.0.1:\n\n```\nsage: timeit('str(gp(\"2^2^22\"))', repeat=10)\n5 loops, best of 10: 402 ms per loop\n```",
    "created_at": "2015-12-04T11:15:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96265",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

The new `pexpect` seems slightly slower at reading large strings:

pexpect 2.0:

```
sage: timeit('str(gp("2^2^22"))', repeat=10)
5 loops, best of 10: 380 ms per loop
```

pexpect 4.0.1:

```
sage: timeit('str(gp("2^2^22"))', repeat=10)
5 loops, best of 10: 402 ms per loop
```



---

archive/issue_comments_096266.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe same now with `%time` shows that the time increase is mainly in `user` time, so it's really the `pexpect` code which is causing the slowdown:\n\npexpect 2.0:\n\n```\nsage: %time _ = str(gp(\"2^2^22\"))\nCPU times: user 184 ms, sys: 4 ms, total: 188 ms\nWall time: 384 ms\n```\n\npexpect 4.0.1:\n\n```\nsage: %time _ = str(gp(\"2^2^22\"))\nCPU times: user 203 ms, sys: 7 ms, total: 210 ms\nWall time: 405 ms\n```",
    "created_at": "2015-12-04T11:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96266",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

The same now with `%time` shows that the time increase is mainly in `user` time, so it's really the `pexpect` code which is causing the slowdown:

pexpect 2.0:

```
sage: %time _ = str(gp("2^2^22"))
CPU times: user 184 ms, sys: 4 ms, total: 188 ms
Wall time: 384 ms
```

pexpect 4.0.1:

```
sage: %time _ = str(gp("2^2^22"))
CPU times: user 203 ms, sys: 7 ms, total: 210 ms
Wall time: 405 ms
```



---

archive/issue_comments_096267.json:
```json
{
    "body": "Work Issues: **slowness**",
    "created_at": "2015-12-04T11:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96267",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **slowness**



---

archive/issue_events_135347.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-04T11:18:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135347"
}
```



---

archive/issue_events_135348.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-04T11:18:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135348"
}
```



---

archive/issue_comments_096268.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nI just noticed that `pexpect` uses a read buffer of only 2000 bytes by default.\n\nWTF??? Does `pexpect` upstream really *want* things to be slow?",
    "created_at": "2015-12-04T13:23:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96268",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:0" align="right">comment:0</div>

I just noticed that `pexpect` uses a read buffer of only 2000 bytes by default.

WTF??? Does `pexpect` upstream really *want* things to be slow?



---

archive/issue_comments_096269.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93a5fae54078aa71d95fd81d9a6806ab7f5506e3\">93a5fae</a></td><td><code>Vastly increase pexpect read buffer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10623b2318047234dc0f2f4fcaed47d741bffc9a\">10623b2</a></td><td><code>Add pexpect patch to read more data at once</code></td></tr></table>\n",
    "created_at": "2015-12-04T13:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96269",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93a5fae54078aa71d95fd81d9a6806ab7f5506e3">93a5fae</a></td><td><code>Vastly increase pexpect read buffer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10623b2318047234dc0f2f4fcaed47d741bffc9a">10623b2</a></td><td><code>Add pexpect patch to read more data at once</code></td></tr></table>




---

archive/issue_comments_096270.json:
```json
{
    "body": "Changed commit from **[411c293](https://github.com/sagemath/sagetrac-mirror/commit/411c29346c9234aec8c920eae86c18f5209352a8)** to **[10623b2](https://github.com/sagemath/sagetrac-mirror/commit/10623b2318047234dc0f2f4fcaed47d741bffc9a)**",
    "created_at": "2015-12-04T13:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96270",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[411c293](https://github.com/sagemath/sagetrac-mirror/commit/411c29346c9234aec8c920eae86c18f5209352a8)** to **[10623b2](https://github.com/sagemath/sagetrac-mirror/commit/10623b2318047234dc0f2f4fcaed47d741bffc9a)**



---

archive/issue_comments_096271.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,4 @@\n **Upstream patches included**:\n * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)\n+* [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)\n``````\n",
    "created_at": "2015-12-04T13:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96271",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,4 @@
 **Upstream patches included**:
 * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
 * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)
+* [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)
``````




---

archive/issue_comments_096272.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nLooking better now:\n\npexpect 2.0 upstream:\n\n```\nsage: %time _ = str(gp(\"2^2^22\"))\nCPU times: user 184 ms, sys: 4 ms, total: 188 ms\nWall time: 384 ms\n```\n\npexpect 4.0.1 upstream:\n\n```\nsage: %time _ = str(gp(\"2^2^22\"))\nCPU times: user 308 ms, sys: 9 ms, total: 317 ms\nWall time: 571 ms\n```\n\npexpect 4.0.1 + Sage patches:\n\n```\nsage: %time _ = str(gp(\"2^2^22\"))\nCPU times: user 26 ms, sys: 2 ms, total: 28 ms\nWall time: 231 ms\n```",
    "created_at": "2015-12-04T13:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96272",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Looking better now:

pexpect 2.0 upstream:

```
sage: %time _ = str(gp("2^2^22"))
CPU times: user 184 ms, sys: 4 ms, total: 188 ms
Wall time: 384 ms
```

pexpect 4.0.1 upstream:

```
sage: %time _ = str(gp("2^2^22"))
CPU times: user 308 ms, sys: 9 ms, total: 317 ms
Wall time: 571 ms
```

pexpect 4.0.1 + Sage patches:

```
sage: %time _ = str(gp("2^2^22"))
CPU times: user 26 ms, sys: 2 ms, total: 28 ms
Wall time: 231 ms
```



---

archive/issue_events_135349.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-04T13:58:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135349"
}
```



---

archive/issue_events_135350.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-04T13:58:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135350"
}
```



---

archive/issue_comments_096273.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIt's especially interesting to look at `user` time. We cannot really change how much time is spent in the system calls, but we can change the time spent in Python code.",
    "created_at": "2015-12-04T14:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96273",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

It's especially interesting to look at `user` time. We cannot really change how much time is spent in the system calls, but we can change the time spent in Python code.



---

archive/issue_events_135351.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-04T14:04:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "title_is": "Upgrade and optimize pexpect",
    "title_was": "Upgrading pexpect",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135351"
}
```



---

archive/issue_comments_096274.json:
```json
{
    "body": "Changed commit from **[10623b2](https://github.com/sagemath/sagetrac-mirror/commit/10623b2318047234dc0f2f4fcaed47d741bffc9a)** to **[e0ccd45](https://github.com/sagemath/sagetrac-mirror/commit/e0ccd4547824107c1bb0ea132726f565eb70142e)**",
    "created_at": "2015-12-04T14:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96274",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[10623b2](https://github.com/sagemath/sagetrac-mirror/commit/10623b2318047234dc0f2f4fcaed47d741bffc9a)** to **[e0ccd45](https://github.com/sagemath/sagetrac-mirror/commit/e0ccd4547824107c1bb0ea132726f565eb70142e)**



---

archive/issue_comments_096275.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0ccd4547824107c1bb0ea132726f565eb70142e\">e0ccd45</a></td><td><code>Remove support for maxread, there is no need to limit it!</code></td></tr></table>\n",
    "created_at": "2015-12-04T14:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96275",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0ccd4547824107c1bb0ea132726f565eb70142e">e0ccd45</a></td><td><code>Remove support for maxread, there is no need to limit it!</code></td></tr></table>




---

archive/issue_comments_096276.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,31 @@\n * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)\n * [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)\n+\n+---\n+\n+**Timings** (best out of 5):\n+\n+pexpect 2.0 upstream:\n+\n+```\n+sage: %time _ = str(gp(\"2^2^22\"))\n+CPU times: user 184 ms, sys: 4 ms, total: 188 ms\n+Wall time: 384 ms\n+```\n+\n+pexpect 4.0.1 upstream:\n+\n+```\n+sage: %time _ = str(gp(\"2^2^22\"))\n+CPU times: user 308 ms, sys: 9 ms, total: 317 ms\n+Wall time: 571 ms\n+```\n+\n+pexpect 4.0.1 + Sage patches:\n+\n+```\n+sage: %time _ = str(gp(\"2^2^22\"))\n+CPU times: user 16 ms, sys: 6 ms, total: 22 ms\n+Wall time: 216 ms\n+```\n``````\n",
    "created_at": "2015-12-04T15:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96276",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,31 @@
 * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
 * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)
 * [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)
+
+---
+
+**Timings** (best out of 5):
+
+pexpect 2.0 upstream:
+
+```
+sage: %time _ = str(gp("2^2^22"))
+CPU times: user 184 ms, sys: 4 ms, total: 188 ms
+Wall time: 384 ms
+```
+
+pexpect 4.0.1 upstream:
+
+```
+sage: %time _ = str(gp("2^2^22"))
+CPU times: user 308 ms, sys: 9 ms, total: 317 ms
+Wall time: 571 ms
+```
+
+pexpect 4.0.1 + Sage patches:
+
+```
+sage: %time _ = str(gp("2^2^22"))
+CPU times: user 16 ms, sys: 6 ms, total: 22 ms
+Wall time: 216 ms
+```
``````




---

archive/issue_comments_096277.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n * [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)\n * [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)\n \n-**Upstream patches included**:\n+**Patches included and submitted upstream**:\n * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)\n * [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)\n``````\n",
    "created_at": "2015-12-04T16:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96277",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 * [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)
 * [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)
 
-**Upstream patches included**:
+**Patches included and submitted upstream**:
 * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
 * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)
 * [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)
``````




---

archive/issue_comments_096278.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n`make ptestlong` passes.",
    "created_at": "2015-12-04T18:31:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96278",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

`make ptestlong` passes.



---

archive/issue_comments_096279.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\njdemeyer asked for a branch for the sagenb piece of this.  I didn't want to have two branches - I guess I should have based on this branch but too late now, and won't have time later today.\n\nu/kcrisman/ticket/10295\n\n```diff\ndiff --git a/build/pkgs/sagenb/checksums.ini b/build/pkgs/sagenb/checksums.ini\nindex f35bb1b..f8e929b 100644\n--- a/build/pkgs/sagenb/checksums.ini\n+++ b/build/pkgs/sagenb/checksums.ini\n@@ -1,4 +1,4 @@\n tarball=sagenb-VERSION.tar\n-sha1=66593ecf18cbf77115279f6f1564854eb9b93df5\n-md5=facdc06b94fcf0a85b76aa861c6e646f\n-cksum=2719820378\n+sha1=7631e986aa01676cfac2522d5cc52b4131f0d399\n+md5=4a286cac8412fa3af9cdcc6b6234b9ce\n+cksum=2718880955\ndiff --git a/build/pkgs/sagenb/package-version.txt b/build/pkgs/sagenb/package-v\nindex 35ad344..af92809 100644\n--- a/build/pkgs/sagenb/package-version.txt\n+++ b/build/pkgs/sagenb/package-version.txt\n@@ -1 +1 @@\n-0.11.4\n+0.11.5.1\n```\n\nPackage will be at http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar",
    "created_at": "2015-12-04T18:51:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96279",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:9" align="right">comment:9</div>

jdemeyer asked for a branch for the sagenb piece of this.  I didn't want to have two branches - I guess I should have based on this branch but too late now, and won't have time later today.

u/kcrisman/ticket/10295

```diff
diff --git a/build/pkgs/sagenb/checksums.ini b/build/pkgs/sagenb/checksums.ini
index f35bb1b..f8e929b 100644
--- a/build/pkgs/sagenb/checksums.ini
+++ b/build/pkgs/sagenb/checksums.ini
@@ -1,4 +1,4 @@
 tarball=sagenb-VERSION.tar
-sha1=66593ecf18cbf77115279f6f1564854eb9b93df5
-md5=facdc06b94fcf0a85b76aa861c6e646f
-cksum=2719820378
+sha1=7631e986aa01676cfac2522d5cc52b4131f0d399
+md5=4a286cac8412fa3af9cdcc6b6234b9ce
+cksum=2718880955
diff --git a/build/pkgs/sagenb/package-version.txt b/build/pkgs/sagenb/package-v
index 35ad344..af92809 100644
--- a/build/pkgs/sagenb/package-version.txt
+++ b/build/pkgs/sagenb/package-version.txt
@@ -1 +1 @@
-0.11.4
+0.11.5.1
```

Package will be at http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar



---

archive/issue_comments_096280.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,7 @@\n **New upstream tarballs**:\n * [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)\n * [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)\n+* [\u200bhttp://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar]\n \n **Patches included and submitted upstream**:\n * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n``````\n",
    "created_at": "2015-12-04T18:57:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96280",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,7 @@
 **New upstream tarballs**:
 * [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)
 * [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)
+* [‚Äãhttp://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar]
 
 **Patches included and submitted upstream**:
 * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
``````




---

archive/issue_comments_096281.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74c8754804e135c4ceb8ab03d1c49ca2a8715d9e\">74c8754</a></td><td><code>Upgrade to sagenb 0.11.5.1 for pexpect 4</code></td></tr></table>\n",
    "created_at": "2015-12-04T19:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96281",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74c8754804e135c4ceb8ab03d1c49ca2a8715d9e">74c8754</a></td><td><code>Upgrade to sagenb 0.11.5.1 for pexpect 4</code></td></tr></table>




---

archive/issue_comments_096282.json:
```json
{
    "body": "Changed commit from **[e0ccd45](https://github.com/sagemath/sagetrac-mirror/commit/e0ccd4547824107c1bb0ea132726f565eb70142e)** to **[74c8754](https://github.com/sagemath/sagetrac-mirror/commit/74c8754804e135c4ceb8ab03d1c49ca2a8715d9e)**",
    "created_at": "2015-12-04T19:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96282",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e0ccd45](https://github.com/sagemath/sagetrac-mirror/commit/e0ccd4547824107c1bb0ea132726f565eb70142e)** to **[74c8754](https://github.com/sagemath/sagetrac-mirror/commit/74c8754804e135c4ceb8ab03d1c49ca2a8715d9e)**



---

archive/issue_comments_096283.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIn the `pexpect` log, I see this:\n\n```\nbyte-compiling /Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pexpect/async.py to async.pyc\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pexpect/async.py\", line 16\n    transport, pw = yield from asyncio.get_event_loop()\\\n                             ^\nSyntaxError: invalid syntax\n```\nand as a result, there is a file `async.py` but not `async.pyc`. Something to worry about?",
    "created_at": "2015-12-04T20:02:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96283",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

In the `pexpect` log, I see this:

```
byte-compiling /Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pexpect/async.py to async.pyc
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pexpect/async.py", line 16
    transport, pw = yield from asyncio.get_event_loop()\
                             ^
SyntaxError: invalid syntax
```
and as a result, there is a file `async.py` but not `async.pyc`. Something to worry about?



---

archive/issue_comments_096284.json:
```json
{
    "body": "<div id=\"comment:143\" align=\"right\">comment:143</div>\n\nReplying to [@jhpalmieri](#comment:142):\n> In the `pexpect` log, I see this:\n> \n> ```\n> byte-compiling /Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pexpect/async.py to async.pyc\n>   File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pexpect/async.py\", line 16\n>     transport, pw = yield from asyncio.get_event_loop()\\\n>                              ^\n> SyntaxError: invalid syntax\n> ```\n> and as a result, there is a file `async.py` but not `async.pyc`. Something to worry about?\n\nNo, I opened an issue upstream that was quickly closed. And it mirrored at least another issue opened by another distro maintainer. This file is only used with python3. See [https://github.com/pexpect/pexpect/issues/297](https://github.com/pexpect/pexpect/issues/297)",
    "created_at": "2015-12-04T20:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96284",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:143" align="right">comment:143</div>

Replying to [@jhpalmieri](#comment:142):
> In the `pexpect` log, I see this:
> 
> ```
> byte-compiling /Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pexpect/async.py to async.pyc
>   File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pexpect/async.py", line 16
>     transport, pw = yield from asyncio.get_event_loop()\
>                              ^
> SyntaxError: invalid syntax
> ```
> and as a result, there is a file `async.py` but not `async.pyc`. Something to worry about?

No, I opened an issue upstream that was quickly closed. And it mirrored at least another issue opened by another distro maintainer. This file is only used with python3. See [https://github.com/pexpect/pexpect/issues/297](https://github.com/pexpect/pexpect/issues/297)



---

archive/issue_comments_096285.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI greatly appreciate all of your hard work on this and regret not being able to keep up. The new timings are very impressive. I have one question:  Do you have timings before and after for the full Sage test suite or at least those parts of it that exercise most of the functionality associated with those other parts of Sage besides gap that use external components via pexpect?",
    "created_at": "2015-12-04T20:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96285",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:4" align="right">comment:4</div>

I greatly appreciate all of your hard work on this and regret not being able to keep up. The new timings are very impressive. I have one question:  Do you have timings before and after for the full Sage test suite or at least those parts of it that exercise most of the functionality associated with those other parts of Sage besides gap that use external components via pexpect?



---

archive/issue_comments_096286.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI gave it a try but documentation doesn't build\n\n```\n[notebook ] reading sources... [ 85%] sagenb/notebook/template\n[notebook ] Exception occurred:\n[notebook ] File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/Flask-0.10.1-py2.7.egg/flask/globals.py\", line 34, in _find_app\n[notebook ] raise RuntimeError('working outside of application context')\n[notebook ] RuntimeError: working outside of application context\n[notebook ] The full traceback has been saved in /var/folders/hj/rs3k66f91zddr7hvc6yf_90m0000gp/T/sphinx-err-jc5YhT.log, if you want to report the issue to the developers.\n[notebook ] Please also report this if it was a user error, so that a better error message can be provided next time.\n[notebook ] A bug report can be filed in the tracker at <https://bitbucket.org/birkenfeld/sphinx/issues/>. Thanks!\nError building the documentation.\nTraceback (most recent call last):\n  File \"/Users/buildslave-sage/slave/sage_git/build/src/doc/common/builder.py\", line 1641, in <module>\n    getattr(get_builder(name), type)()\n  File \"/Users/buildslave-sage/slave/sage_git/build/src/doc/common/builder.py\", line 302, in _wrapper\n    getattr(get_builder(document), 'inventory')(*args, **kwds)\n  File \"/Users/buildslave-sage/slave/sage_git/build/src/doc/common/builder.py\", line 513, in _wrapper\n    x.get(99999)\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python/multiprocessing/pool.py\", line 567, in get\n    raise self._value\nOSError: [notebook ] Exception occurred:\n\nmake[1]: *** [doc-html-mathjax] Error 1\n```",
    "created_at": "2015-12-05T10:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96286",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:5" align="right">comment:5</div>

I gave it a try but documentation doesn't build

```
[notebook ] reading sources... [ 85%] sagenb/notebook/template
[notebook ] Exception occurred:
[notebook ] File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/Flask-0.10.1-py2.7.egg/flask/globals.py", line 34, in _find_app
[notebook ] raise RuntimeError('working outside of application context')
[notebook ] RuntimeError: working outside of application context
[notebook ] The full traceback has been saved in /var/folders/hj/rs3k66f91zddr7hvc6yf_90m0000gp/T/sphinx-err-jc5YhT.log, if you want to report the issue to the developers.
[notebook ] Please also report this if it was a user error, so that a better error message can be provided next time.
[notebook ] A bug report can be filed in the tracker at <https://bitbucket.org/birkenfeld/sphinx/issues/>. Thanks!
Error building the documentation.
Traceback (most recent call last):
  File "/Users/buildslave-sage/slave/sage_git/build/src/doc/common/builder.py", line 1641, in <module>
    getattr(get_builder(name), type)()
  File "/Users/buildslave-sage/slave/sage_git/build/src/doc/common/builder.py", line 302, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/Users/buildslave-sage/slave/sage_git/build/src/doc/common/builder.py", line 513, in _wrapper
    x.get(99999)
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python/multiprocessing/pool.py", line 567, in get
    raise self._value
OSError: [notebook ] Exception occurred:

make[1]: *** [doc-html-mathjax] Error 1
```



---

archive/issue_comments_096287.json:
```json
{
    "body": "Dependencies: **#19671**",
    "created_at": "2015-12-05T14:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96287",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#19671**



---

archive/issue_comments_096288.json:
```json
{
    "body": "Changed work issues from **slowness** to none",
    "created_at": "2015-12-05T14:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96288",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **slowness** to none



---

archive/issue_comments_096289.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9980ee58ee8c8a5464fd8f5513bfb28d7ae9ed2\">c9980ee</a></td><td><code>Allow all exceptions in obj._sage_obj_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0523e41eb491c0589c230973229cfeb2123dccd\">f0523e4</a></td><td><code>Merge remote-tracking branch 'trac/u/jdemeyer/fix_docbuild_for_sagenb_upgrade' into t/10295/pexpect3.3</code></td></tr></table>\n",
    "created_at": "2015-12-08T15:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96289",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9980ee58ee8c8a5464fd8f5513bfb28d7ae9ed2">c9980ee</a></td><td><code>Allow all exceptions in obj._sage_obj_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0523e41eb491c0589c230973229cfeb2123dccd">f0523e4</a></td><td><code>Merge remote-tracking branch 'trac/u/jdemeyer/fix_docbuild_for_sagenb_upgrade' into t/10295/pexpect3.3</code></td></tr></table>




---

archive/issue_comments_096290.json:
```json
{
    "body": "Changed commit from **[74c8754](https://github.com/sagemath/sagetrac-mirror/commit/74c8754804e135c4ceb8ab03d1c49ca2a8715d9e)** to **[f0523e4](https://github.com/sagemath/sagetrac-mirror/commit/f0523e41eb491c0589c230973229cfeb2123dccd)**",
    "created_at": "2015-12-08T15:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96290",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[74c8754](https://github.com/sagemath/sagetrac-mirror/commit/74c8754804e135c4ceb8ab03d1c49ca2a8715d9e)** to **[f0523e4](https://github.com/sagemath/sagetrac-mirror/commit/f0523e41eb491c0589c230973229cfeb2123dccd)**



---

archive/issue_comments_096291.json:
```json
{
    "body": "<div id=\"comment:148\" align=\"right\">comment:148</div>\n\nReplying to [@sagetrac-bpage](#comment:144):\n> Do you have timings before and after for the full Sage test suite or at least those parts of it that exercise most of the functionality associated with those other parts of Sage besides gap that use external components via pexpect?\n\nSee [attachment: old-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/old-pexpect.log) and [attachment: new-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/new-pexpect.log) for the output of\n\n```\n./sage -t --optional=sage src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py*\n```\n(test all files in `src/sage/interfaces` 5 times).\n\nThe total time of those tests is (I'm not claiming that anything is statistically significant):\n\nold:\n\n```\nTotal time for all tests: 378.2 seconds\n    cpu time: 86.5 seconds\n    cumulative wall time: 365.2 seconds\n```\n\nnew:\n\n```\nTotal time for all tests: 360.3 seconds\n    cpu time: 93.6 seconds\n    cumulative wall time: 347.1 seconds\n```",
    "created_at": "2015-12-08T16:34:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96291",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:148" align="right">comment:148</div>

Replying to [@sagetrac-bpage](#comment:144):
> Do you have timings before and after for the full Sage test suite or at least those parts of it that exercise most of the functionality associated with those other parts of Sage besides gap that use external components via pexpect?

See [attachment: old-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/old-pexpect.log) and [attachment: new-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/new-pexpect.log) for the output of

```
./sage -t --optional=sage src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py*
```
(test all files in `src/sage/interfaces` 5 times).

The total time of those tests is (I'm not claiming that anything is statistically significant):

old:

```
Total time for all tests: 378.2 seconds
    cpu time: 86.5 seconds
    cumulative wall time: 365.2 seconds
```

new:

```
Total time for all tests: 360.3 seconds
    cpu time: 93.6 seconds
    cumulative wall time: 347.1 seconds
```



---

archive/issue_comments_096292.json:
```json
{
    "body": "<div id=\"comment:149\" align=\"right\">comment:149</div>\n\nReplying to [@jdemeyer](#comment:148):\n> Replying to [@sagetrac-bpage](#comment:144):\n> > Do you have timings before and after for the full Sage test suite or at least those parts of it that exercise most of the functionality associated with those other parts of Sage besides gap that use external components via pexpect?\n\n> \n> See [attachment: old-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/old-pexpect.log) and [attachment: new-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/new-pexpect.log) for the output of\n> \n> ```\n> ./sage -t --optional=sage src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py*\n> ```\n> (test all files in `src/sage/interfaces` 5 times).\n> \n> The total time of those tests is (I'm not claiming that anything is statistically significant):\n> \n> old:\n> \n> ```\n> Total time for all tests: 378.2 seconds\n>     cpu time: 86.5 seconds\n>     cumulative wall time: 365.2 seconds\n> ```\n> \n> new:\n> \n> ```\n> Total time for all tests: 360.3 seconds\n>     cpu time: 93.6 seconds\n>     cumulative wall time: 347.1 seconds\n> ```\n\nSo the CPU time increased by a significant amount, which is bad...\n\n(Not sure how reliable the figures at all are.)",
    "created_at": "2015-12-08T17:08:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96292",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:149" align="right">comment:149</div>

Replying to [@jdemeyer](#comment:148):
> Replying to [@sagetrac-bpage](#comment:144):
> > Do you have timings before and after for the full Sage test suite or at least those parts of it that exercise most of the functionality associated with those other parts of Sage besides gap that use external components via pexpect?

> 
> See [attachment: old-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/old-pexpect.log) and [attachment: new-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/new-pexpect.log) for the output of
> 
> ```
> ./sage -t --optional=sage src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py* src/sage/interfaces/*.py*
> ```
> (test all files in `src/sage/interfaces` 5 times).
> 
> The total time of those tests is (I'm not claiming that anything is statistically significant):
> 
> old:
> 
> ```
> Total time for all tests: 378.2 seconds
>     cpu time: 86.5 seconds
>     cumulative wall time: 365.2 seconds
> ```
> 
> new:
> 
> ```
> Total time for all tests: 360.3 seconds
>     cpu time: 93.6 seconds
>     cumulative wall time: 347.1 seconds
> ```

So the CPU time increased by a significant amount, which is bad...

(Not sure how reliable the figures at all are.)



---

archive/issue_comments_096293.json:
```json
{
    "body": "<div id=\"comment:150\" align=\"right\">comment:150</div>\n\nReplying to [@nexttime](#comment:149):\n> So the CPU time increased by a significant amount, which is bad...\n> \n> (Not sure how reliable the figures at all are.)\n\nI have no idea if it's really significant. I don't even know how to check this (all I know is that I should **not** ask the person who wrote the patchbot startup-time plugin)",
    "created_at": "2015-12-08T17:27:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96293",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:150" align="right">comment:150</div>

Replying to [@nexttime](#comment:149):
> So the CPU time increased by a significant amount, which is bad...
> 
> (Not sure how reliable the figures at all are.)

I have no idea if it's really significant. I don't even know how to check this (all I know is that I should **not** ask the person who wrote the patchbot startup-time plugin)



---

archive/issue_comments_096294.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nP.S.:  There is (or at least used to be) `SAGE_TEST_ITER` and `SAGE_TEST_GLOBAL_ITER` (w.r.t. the \"five times\").",
    "created_at": "2015-12-08T17:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96294",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:1" align="right">comment:1</div>

P.S.:  There is (or at least used to be) `SAGE_TEST_ITER` and `SAGE_TEST_GLOBAL_ITER` (w.r.t. the "five times").



---

archive/issue_comments_096295.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nStill there (around line 230 in `src/sage/doctest/control.py`).",
    "created_at": "2015-12-08T17:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96295",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

Still there (around line 230 in `src/sage/doctest/control.py`).



---

archive/issue_comments_096296.json:
```json
{
    "body": "Attachment: **[old-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/old-pexpect.log)**\n\nOld doctest timings",
    "created_at": "2015-12-08T19:05:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96296",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[old-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/old-pexpect.log)**

Old doctest timings



---

archive/issue_comments_096297.json:
```json
{
    "body": "New doctest timings",
    "created_at": "2015-12-08T19:05:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96297",
    "user": "https://github.com/jdemeyer"
}
```

New doctest timings



---

archive/issue_comments_096298.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[new-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/new-pexpect.log)**\n\nI tried the doctests in `sage/interface` again, now with 10 runs. Results are essentially the same:\n\nold:\n\n```\nTotal time for all tests: 722.6 seconds\n    cpu time: 170.2 seconds\n    cumulative wall time: 696.9 seconds\n```\n\nnew:\n\n```\nTotal time for all tests: 710.4 seconds\n    cpu time: 185.6 seconds\n    cumulative wall time: 685.0 seconds\n```\n\nIs it really a problem if the CPU goes up while the total time goes down?",
    "created_at": "2015-12-08T19:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96298",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[new-pexpect.log](https://github.com/sagemath/sage/files/ticket10295/new-pexpect.log)**

I tried the doctests in `sage/interface` again, now with 10 runs. Results are essentially the same:

old:

```
Total time for all tests: 722.6 seconds
    cpu time: 170.2 seconds
    cumulative wall time: 696.9 seconds
```

new:

```
Total time for all tests: 710.4 seconds
    cpu time: 185.6 seconds
    cumulative wall time: 685.0 seconds
```

Is it really a problem if the CPU goes up while the total time goes down?



---

archive/issue_comments_096299.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,11 @@\n We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?\n \n-See also #502 and #10294.\n+See also #10294.\n \n **New upstream tarballs**:\n-* [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)\n-* [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)\n-* [\u200bhttp://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar]\n+* https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz\n+* https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz\n+* \u200bhttp://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar\n \n **Patches included and submitted upstream**:\n * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n``````\n",
    "created_at": "2015-12-08T19:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96299",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,11 @@
 We use pexpect version 2.0. Shouldn't we upgrade to the current version 4.0.1?
 
-See also #502 and #10294.
+See also #10294.
 
 **New upstream tarballs**:
-* [https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz](https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz)
-* [https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz](https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz)
-* [‚Äãhttp://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar]
+* https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz
+* https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz
+* ‚Äãhttp://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar
 
 **Patches included and submitted upstream**:
 * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
``````




---

archive/issue_comments_096300.json:
```json
{
    "body": "<div id=\"comment:155\" align=\"right\">comment:155</div>\n\nReplying to [@jdemeyer](#comment:153):\n> Is it really a problem if the CPU goes up while the total time goes down?\n\nAs always, *it depends*.\n\nDo we burn more carbon that way?\n\nMore seriously, in case the potential cpu time is wasted otherwise, perhaps not (*wall time* then matters; but even on a battery-powered notebook, the answer might yet be different).  But if it's not, i.e., if other processes suffer from getting less, it does of course.  So it mainly depends on the user, or rather the usage of the machine Sage is running on (and hence potentially many users).\n\n\n\n\n\nReplying late to [jdemeyer](#comment:130):\n> I just noticed that `pexpect` uses a read buffer of only 2000 bytes by default.\n> \n> WTF??? Does `pexpect` upstream really *want* things to be slow?\n\nThink of pexpect's purpose; not counting newlines, 2000 characters is 80 columns by 25 lines, so pretty reasonable even with ASCII art output (well, perhaps twice that, but not vastly more.).\n\nIn the same sense, benchmarking with `gp(\"2<sup>2</sup>22\")` seems hardly appropriate, IMHO.\n\nLatency matters, more than throughput.  (And in a multitasking environment, overall resource usage.)",
    "created_at": "2015-12-08T20:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96300",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:155" align="right">comment:155</div>

Replying to [@jdemeyer](#comment:153):
> Is it really a problem if the CPU goes up while the total time goes down?

As always, *it depends*.

Do we burn more carbon that way?

More seriously, in case the potential cpu time is wasted otherwise, perhaps not (*wall time* then matters; but even on a battery-powered notebook, the answer might yet be different).  But if it's not, i.e., if other processes suffer from getting less, it does of course.  So it mainly depends on the user, or rather the usage of the machine Sage is running on (and hence potentially many users).





Replying late to [jdemeyer](#comment:130):
> I just noticed that `pexpect` uses a read buffer of only 2000 bytes by default.
> 
> WTF??? Does `pexpect` upstream really *want* things to be slow?

Think of pexpect's purpose; not counting newlines, 2000 characters is 80 columns by 25 lines, so pretty reasonable even with ASCII art output (well, perhaps twice that, but not vastly more.).

In the same sense, benchmarking with `gp("2<sup>2</sup>22")` seems hardly appropriate, IMHO.

Latency matters, more than throughput.  (And in a multitasking environment, overall resource usage.)



---

archive/issue_comments_096301.json:
```json
{
    "body": "<div id=\"comment:156\" align=\"right\">comment:156</div>\n\nReplying to [@nexttime](#comment:155):\n> In the same sense, benchmarking with `gp(\"2<sup>2</sup>22\")` seems hardly appropriate, IMHO.\n\nLarge outputs do actually happen in Sage. It's not so crazy.\n\nI agree that it's not the *only* thing which matters.",
    "created_at": "2015-12-08T20:46:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96301",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:156" align="right">comment:156</div>

Replying to [@nexttime](#comment:155):
> In the same sense, benchmarking with `gp("2<sup>2</sup>22")` seems hardly appropriate, IMHO.

Large outputs do actually happen in Sage. It's not so crazy.

I agree that it's not the *only* thing which matters.



---

archive/issue_comments_096302.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIs anybody willing to review this ticket? I won't waste my time investigating the CPU time issue if this ticket will stall anyway.",
    "created_at": "2015-12-08T20:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96302",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Is anybody willing to review this ticket? I won't waste my time investigating the CPU time issue if this ticket will stall anyway.



---

archive/issue_comments_096303.json:
```json
{
    "body": "<div id=\"comment:158\" align=\"right\">comment:158</div>\n\nReplying to [@jdemeyer](#comment:156):\n> Replying to [@nexttime](#comment:155):\n> > In the same sense, benchmarking with `gp(\"2<sup>2</sup>22\")` seems hardly appropriate, IMHO.\n\n> \n> Large outputs do actually happen in Sage. It's not so crazy.\n\nYep, but certainly not the typical usage scenario of pexpect, so I wouldn't blame upstream for their default buffer size.\n\nOn the other hand, often the interaction of Sage with pexpect-driven programs looks more like a human one, where lots of variables get set with short commands, to finally get a (typically relatively short) answer.  Mainly in toy examples communication overhead dominates computation time (unless latency in a longer dialogue is really bad, as we experienced with some Ubuntu kernels a while ago).\n\n\n\n\nI'm not very worried about the increased CPU time (yet ;-) ); it's just that we shouldn't exclusively focus on bare throughput.\n\nIf the number and/or size of objects passed is huge, it's probably more worth thinking of other solutions.",
    "created_at": "2015-12-08T21:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96303",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:158" align="right">comment:158</div>

Replying to [@jdemeyer](#comment:156):
> Replying to [@nexttime](#comment:155):
> > In the same sense, benchmarking with `gp("2<sup>2</sup>22")` seems hardly appropriate, IMHO.

> 
> Large outputs do actually happen in Sage. It's not so crazy.

Yep, but certainly not the typical usage scenario of pexpect, so I wouldn't blame upstream for their default buffer size.

On the other hand, often the interaction of Sage with pexpect-driven programs looks more like a human one, where lots of variables get set with short commands, to finally get a (typically relatively short) answer.  Mainly in toy examples communication overhead dominates computation time (unless latency in a longer dialogue is really bad, as we experienced with some Ubuntu kernels a while ago).




I'm not very worried about the increased CPU time (yet ;-) ); it's just that we shouldn't exclusively focus on bare throughput.

If the number and/or size of objects passed is huge, it's probably more worth thinking of other solutions.



---

archive/issue_comments_096304.json:
```json
{
    "body": "<div id=\"comment:159\" align=\"right\">comment:159</div>\n\nReplying to [@jdemeyer](#comment:157):\n> Is anybody willing to review this ticket? I won't waste my time investigating the CPU time issue if this ticket will stall anyway.\n\nI do not find the difference in reported times for the sage/interface tests at all disturbing. I seriously doubt that it would be noticeable to the average user. At the same time the new gap timings suggest that certain heavy users might be pleasantly surprized.\n\nI plan to test this change some time in the next few days.  One thing that I want out of this change is support for unicode in external packages. I expect to be able to give it a positive review.",
    "created_at": "2015-12-08T21:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96304",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:159" align="right">comment:159</div>

Replying to [@jdemeyer](#comment:157):
> Is anybody willing to review this ticket? I won't waste my time investigating the CPU time issue if this ticket will stall anyway.

I do not find the difference in reported times for the sage/interface tests at all disturbing. I seriously doubt that it would be noticeable to the average user. At the same time the new gap timings suggest that certain heavy users might be pleasantly surprized.

I plan to test this change some time in the next few days.  One thing that I want out of this change is support for unicode in external packages. I expect to be able to give it a positive review.



---

archive/issue_comments_096305.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nI added some latency timings too, which again show a significant improvement.",
    "created_at": "2015-12-09T08:45:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96305",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:0" align="right">comment:0</div>

I added some latency timings too, which again show a significant improvement.



---

archive/issue_comments_096306.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,7 +14,7 @@\n \n ---\n \n-**Timings** (best out of 5):\n+**Throughput timings** (best out of 5):\n \n pexpect 2.0 upstream:\n \n@@ -39,3 +39,25 @@\n CPU times: user 16 ms, sys: 6 ms, total: 22 ms\n Wall time: 216 ms\n ```\n+\n+---\n+\n+**Latency timings** (best out of 5):\n+\n+pexpect 2.0 upstream:\n+\n+```\n+sage: gp(1);\n+sage: %time _ = [gp(i) for i in range(10^4)]\n+CPU times: user 2.96 s, sys: 855 ms, total: 3.82 s\n+Wall time: 4.52 s\n+```\n+\n+pexpect 4.0.1 + Sage patches:\n+\n+```\n+sage: gp(1);\n+sage: %time _ = [gp(i) for i in range(10^4)]\n+CPU times: user 2.48 s, sys: 980 ms, total: 3.46 s\n+Wall time: 3.52 s\n+```\n``````\n",
    "created_at": "2015-12-09T08:45:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96306",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,7 +14,7 @@
 
 ---
 
-**Timings** (best out of 5):
+**Throughput timings** (best out of 5):
 
 pexpect 2.0 upstream:
 
@@ -39,3 +39,25 @@
 CPU times: user 16 ms, sys: 6 ms, total: 22 ms
 Wall time: 216 ms
 ```
+
+---
+
+**Latency timings** (best out of 5):
+
+pexpect 2.0 upstream:
+
+```
+sage: gp(1);
+sage: %time _ = [gp(i) for i in range(10^4)]
+CPU times: user 2.96 s, sys: 855 ms, total: 3.82 s
+Wall time: 4.52 s
+```
+
+pexpect 4.0.1 + Sage patches:
+
+```
+sage: gp(1);
+sage: %time _ = [gp(i) for i in range(10^4)]
+CPU times: user 2.48 s, sys: 980 ms, total: 3.46 s
+Wall time: 3.52 s
+```
``````




---

archive/issue_comments_096307.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b98fbf950f8f056fa096f9fbe2ff52501de98a44\">b98fbf9</a></td><td><code>Simplify patch for pexpect PR #291</code></td></tr></table>\n",
    "created_at": "2015-12-09T13:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96307",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b98fbf950f8f056fa096f9fbe2ff52501de98a44">b98fbf9</a></td><td><code>Simplify patch for pexpect PR #291</code></td></tr></table>




---

archive/issue_comments_096308.json:
```json
{
    "body": "Changed commit from **[f0523e4](https://github.com/sagemath/sagetrac-mirror/commit/f0523e41eb491c0589c230973229cfeb2123dccd)** to **[b98fbf9](https://github.com/sagemath/sagetrac-mirror/commit/b98fbf950f8f056fa096f9fbe2ff52501de98a44)**",
    "created_at": "2015-12-09T13:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96308",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f0523e4](https://github.com/sagemath/sagetrac-mirror/commit/f0523e41eb491c0589c230973229cfeb2123dccd)** to **[b98fbf9](https://github.com/sagemath/sagetrac-mirror/commit/b98fbf950f8f056fa096f9fbe2ff52501de98a44)**



---

archive/issue_comments_096309.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI see no reason to include all the changes on the `superfluous-sleep` branch. I changed the patch to take just the changes proposed on the pull request.",
    "created_at": "2015-12-09T13:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96309",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

I see no reason to include all the changes on the `superfluous-sleep` branch. I changed the patch to take just the changes proposed on the pull request.



---

archive/issue_comments_096310.json:
```json
{
    "body": "Changed commit from **[b98fbf9](https://github.com/sagemath/sagetrac-mirror/commit/b98fbf950f8f056fa096f9fbe2ff52501de98a44)** to **[59d6591](https://github.com/sagemath/sagetrac-mirror/commit/59d659155808600547bf72fd302ae977840d109a)**",
    "created_at": "2015-12-09T14:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96310",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b98fbf9](https://github.com/sagemath/sagetrac-mirror/commit/b98fbf950f8f056fa096f9fbe2ff52501de98a44)** to **[59d6591](https://github.com/sagemath/sagetrac-mirror/commit/59d659155808600547bf72fd302ae977840d109a)**



---

archive/issue_comments_096311.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59d659155808600547bf72fd302ae977840d109a\">59d6591</a></td><td><code>New version of https://github.com/pexpect/pexpect/pull/304</code></td></tr></table>\n",
    "created_at": "2015-12-09T14:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96311",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59d659155808600547bf72fd302ae977840d109a">59d6591</a></td><td><code>New version of https://github.com/pexpect/pexpect/pull/304</code></td></tr></table>




---

archive/issue_comments_096312.json:
```json
{
    "body": "Changed commit from **[59d6591](https://github.com/sagemath/sagetrac-mirror/commit/59d659155808600547bf72fd302ae977840d109a)** to **[c7947bd](https://github.com/sagemath/sagetrac-mirror/commit/c7947bd69e183c6590125051ace85529ba0be251)**",
    "created_at": "2015-12-09T14:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96312",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[59d6591](https://github.com/sagemath/sagetrac-mirror/commit/59d659155808600547bf72fd302ae977840d109a)** to **[c7947bd](https://github.com/sagemath/sagetrac-mirror/commit/c7947bd69e183c6590125051ace85529ba0be251)**



---

archive/issue_comments_096313.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7947bd69e183c6590125051ace85529ba0be251\">c7947bd</a></td><td><code>New version of https://github.com/pexpect/pexpect/pull/304</code></td></tr></table>\n",
    "created_at": "2015-12-09T14:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96313",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7947bd69e183c6590125051ace85529ba0be251">c7947bd</a></td><td><code>New version of https://github.com/pexpect/pexpect/pull/304</code></td></tr></table>




---

archive/issue_comments_096314.json:
```json
{
    "body": "<div id=\"comment:165\" align=\"right\">comment:165</div>\n\nReplying to [@jdemeyer](#comment:162):\n> I see no reason to include all the changes on the `superfluous-sleep` branch. I changed the patch to take just the changes proposed on the pull request.\n\nFailed to parse that...  So you rebased the changes from PR !#291 onto 4.0.1 (since the PR is based on some 4.1.dev)?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7947bd69e183c6590125051ace85529ba0be251\">c7947bd</a></td><td><code>New version of https://github.com/pexpect/pexpect/pull/304</code></td></tr></table>\n",
    "created_at": "2015-12-09T14:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96314",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:165" align="right">comment:165</div>

Replying to [@jdemeyer](#comment:162):
> I see no reason to include all the changes on the `superfluous-sleep` branch. I changed the patch to take just the changes proposed on the pull request.

Failed to parse that...  So you rebased the changes from PR !#291 onto 4.0.1 (since the PR is based on some 4.1.dev)?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7947bd69e183c6590125051ace85529ba0be251">c7947bd</a></td><td><code>New version of https://github.com/pexpect/pexpect/pull/304</code></td></tr></table>




---

archive/issue_comments_096315.json:
```json
{
    "body": "<div id=\"comment:166\" align=\"right\">comment:166</div>\n\nReplying to [@nexttime](#comment:165):\n> Failed to parse that...  So you rebased the changes from PR !#291 onto 4.0.1 (since the PR is based on some 4.1.dev)?\n\nYes. But it was a trivial rebase, essentially just a cherry-pick of one commit.\n\nNow all 3 patches are independent.",
    "created_at": "2015-12-09T14:35:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96315",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:166" align="right">comment:166</div>

Replying to [@nexttime](#comment:165):
> Failed to parse that...  So you rebased the changes from PR !#291 onto 4.0.1 (since the PR is based on some 4.1.dev)?

Yes. But it was a trivial rebase, essentially just a cherry-pick of one commit.

Now all 3 patches are independent.



---

archive/issue_comments_096316.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe new version of patch for https://github.com/pexpect/pexpect/pull/304 shows again a small improvement.",
    "created_at": "2015-12-09T14:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96316",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

The new version of patch for https://github.com/pexpect/pexpect/pull/304 shows again a small improvement.



---

archive/issue_comments_096317.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,16 +28,16 @@\n \n ```\n sage: %time _ = str(gp(\"2^2^22\"))\n-CPU times: user 308 ms, sys: 9 ms, total: 317 ms\n-Wall time: 571 ms\n+CPU times: user 208 ms, sys: 4 ms, total: 212 ms\n+Wall time: 405 ms\n ```\n \n pexpect 4.0.1 + Sage patches:\n \n ```\n sage: %time _ = str(gp(\"2^2^22\"))\n-CPU times: user 16 ms, sys: 6 ms, total: 22 ms\n-Wall time: 216 ms\n+CPU times: user 9 ms, sys: 7 ms, total: 16 ms\n+Wall time: 209 ms\n ```\n \n ---\n@@ -53,11 +53,20 @@\n Wall time: 4.52 s\n ```\n \n+pexpect 4.0.1 upstream:\n+\n+```\n+sage: gp(1);\n+sage: %time _ = [gp(i) for i in range(10^4)]\n+CPU times: user 2.61 s, sys: 758 ms, total: 3.37 s\n+Wall time: 3.48 s\n+```\n+\n pexpect 4.0.1 + Sage patches:\n \n ```\n sage: gp(1);\n sage: %time _ = [gp(i) for i in range(10^4)]\n-CPU times: user 2.48 s, sys: 980 ms, total: 3.46 s\n-Wall time: 3.52 s\n+CPU times: user 2.3 s, sys: 999 ms, total: 3.3 s\n+Wall time: 3.4 s\n ```\n``````\n",
    "created_at": "2015-12-09T14:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96317",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,16 +28,16 @@
 
 ```
 sage: %time _ = str(gp("2^2^22"))
-CPU times: user 308 ms, sys: 9 ms, total: 317 ms
-Wall time: 571 ms
+CPU times: user 208 ms, sys: 4 ms, total: 212 ms
+Wall time: 405 ms
 ```
 
 pexpect 4.0.1 + Sage patches:
 
 ```
 sage: %time _ = str(gp("2^2^22"))
-CPU times: user 16 ms, sys: 6 ms, total: 22 ms
-Wall time: 216 ms
+CPU times: user 9 ms, sys: 7 ms, total: 16 ms
+Wall time: 209 ms
 ```
 
 ---
@@ -53,11 +53,20 @@
 Wall time: 4.52 s
 ```
 
+pexpect 4.0.1 upstream:
+
+```
+sage: gp(1);
+sage: %time _ = [gp(i) for i in range(10^4)]
+CPU times: user 2.61 s, sys: 758 ms, total: 3.37 s
+Wall time: 3.48 s
+```
+
 pexpect 4.0.1 + Sage patches:
 
 ```
 sage: gp(1);
 sage: %time _ = [gp(i) for i in range(10^4)]
-CPU times: user 2.48 s, sys: 980 ms, total: 3.46 s
-Wall time: 3.52 s
+CPU times: user 2.3 s, sys: 999 ms, total: 3.3 s
+Wall time: 3.4 s
 ```
``````




---

archive/issue_comments_096318.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHow about creating a new, clean branch?",
    "created_at": "2015-12-09T14:46:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96318",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

How about creating a new, clean branch?



---

archive/issue_comments_096319.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2015-12-09T20:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96319",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_096320.json:
```json
{
    "body": "Changed dependencies from **#19671** to **#19671, #19616**",
    "created_at": "2015-12-09T20:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96320",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#19671** to **#19671, #19616**



---

archive/issue_comments_096321.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,6 +11,7 @@\n * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)\n * [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)\n+* [https://github.com/pexpect/pexpect/pull/307](https://github.com/pexpect/pexpect/pull/307)\n \n ---\n \n``````\n",
    "created_at": "2015-12-09T21:54:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96321",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,6 +11,7 @@
 * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
 * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)
 * [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)
+* [https://github.com/pexpect/pexpect/pull/307](https://github.com/pexpect/pexpect/pull/307)
 
 ---
 
``````




---

archive/issue_comments_096322.json:
```json
{
    "body": "Changed commit from **[c7947bd](https://github.com/sagemath/sagetrac-mirror/commit/c7947bd69e183c6590125051ace85529ba0be251)** to **[0f4148d](https://github.com/sagemath/sagetrac-mirror/commit/0f4148d993d799b09143b778e37a376c237cf903)**",
    "created_at": "2015-12-09T21:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96322",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c7947bd](https://github.com/sagemath/sagetrac-mirror/commit/c7947bd69e183c6590125051ace85529ba0be251)** to **[0f4148d](https://github.com/sagemath/sagetrac-mirror/commit/0f4148d993d799b09143b778e37a376c237cf903)**



---

archive/issue_comments_096323.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f4148d993d799b09143b778e37a376c237cf903\">0f4148d</a></td><td><code>Use delaybeforesend=None to skip a sleep(0)</code></td></tr></table>\n",
    "created_at": "2015-12-09T21:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96323",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f4148d993d799b09143b778e37a376c237cf903">0f4148d</a></td><td><code>Use delaybeforesend=None to skip a sleep(0)</code></td></tr></table>




---

archive/issue_comments_096324.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThanks for all the work on this Jeroen, I have been rather absent for the last week at least but it looks like a great clean up as well as an upgrade.",
    "created_at": "2015-12-09T22:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96324",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:2" align="right">comment:2</div>

Thanks for all the work on this Jeroen, I have been rather absent for the last week at least but it looks like a great clean up as well as an upgrade.



---

archive/issue_comments_096325.json:
```json
{
    "body": "Changed commit from **[0f4148d](https://github.com/sagemath/sagetrac-mirror/commit/0f4148d993d799b09143b778e37a376c237cf903)** to **[1e75fbd](https://github.com/sagemath/sagetrac-mirror/commit/1e75fbd677507e9bb1e06879fe2f45580ab3b584)**",
    "created_at": "2015-12-09T22:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96325",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0f4148d](https://github.com/sagemath/sagetrac-mirror/commit/0f4148d993d799b09143b778e37a376c237cf903)** to **[1e75fbd](https://github.com/sagemath/sagetrac-mirror/commit/1e75fbd677507e9bb1e06879fe2f45580ab3b584)**



---

archive/issue_comments_096326.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e75fbd677507e9bb1e06879fe2f45580ab3b584\">1e75fbd</a></td><td><code>Clean up header</code></td></tr></table>\n",
    "created_at": "2015-12-09T22:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96326",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e75fbd677507e9bb1e06879fe2f45580ab3b584">1e75fbd</a></td><td><code>Clean up header</code></td></tr></table>




---

archive/issue_comments_096327.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI've patched sage.6.10.beta7 and built it on SMC.  I ran the interface tests. I configured it to run from SMC worksheet and verified that Sage and my favorite external packages (FriCAS and Octave) work as expected. Unicode symbols work in FriCAS. Everything looks fine to me. I would give this ticket a positive review.",
    "created_at": "2015-12-10T03:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96327",
    "user": "https://github.com/sagetrac-bpage"
}
```

<div id="comment:4" align="right">comment:4</div>

I've patched sage.6.10.beta7 and built it on SMC.  I ran the interface tests. I configured it to run from SMC worksheet and verified that Sage and my favorite external packages (FriCAS and Octave) work as expected. Unicode symbols work in FriCAS. Everything looks fine to me. I would give this ticket a positive review.



---

archive/issue_events_135352.json:
```json
{
    "actor": "https://github.com/sagetrac-bpage",
    "created_at": "2015-12-10T03:08:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135352"
}
```



---

archive/issue_events_135353.json:
```json
{
    "actor": "https://github.com/sagetrac-bpage",
    "created_at": "2015-12-10T03:08:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135353"
}
```



---

archive/issue_comments_096328.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNote that the dependency #19671 still needs a review.",
    "created_at": "2015-12-10T07:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96328",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Note that the dependency #19671 still needs a review.



---

archive/issue_events_135354.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-10T08:33:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135354"
}
```



---

archive/issue_events_135355.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-10T08:33:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "milestone_number": null,
    "milestone_title": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135355"
}
```



---

archive/issue_comments_096329.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nSince we are in the \"sage-6.10.rc\" phase, I don't think this should be merged in 6.10.",
    "created_at": "2015-12-10T08:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96329",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Since we are in the "sage-6.10.rc" phase, I don't think this should be merged in 6.10.



---

archive/issue_comments_096330.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nNow that this has positive review otherwise, I'll also be sure to include the relevant piece in #19616.  Fran\u00e7ois, if you want to make the same PR as before I can do that; I'm not sure how to revert reverting a changeset on Github, I just want to make sure your name is still attached to that change.",
    "created_at": "2015-12-10T14:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96330",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

Now that this has positive review otherwise, I'll also be sure to include the relevant piece in #19616.  Fran√ßois, if you want to make the same PR as before I can do that; I'm not sure how to revert reverting a changeset on Github, I just want to make sure your name is still attached to that change.



---

archive/issue_comments_096331.json:
```json
{
    "body": "<div id=\"comment:178\" align=\"right\">comment:178</div>\n\nReplying to [@kcrisman](#comment:177):\n> Now that this has positive review otherwise, I'll also be sure to include the relevant piece in #19616.  Fran\u00e7ois, if you want to make the same PR as before I can do that; I'm not sure how to revert reverting a changeset on Github, I just want to make sure your name is still attached to that change.\n\nOn it.",
    "created_at": "2015-12-10T19:50:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96331",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:178" align="right">comment:178</div>

Replying to [@kcrisman](#comment:177):
> Now that this has positive review otherwise, I'll also be sure to include the relevant piece in #19616.  Fran√ßois, if you want to make the same PR as before I can do that; I'm not sure how to revert reverting a changeset on Github, I just want to make sure your name is still attached to that change.

On it.



---

archive/issue_comments_096332.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI have made one additional pull request to `pexpect`: [https://github.com/pexpect/pexpect/pull/308/files](https://github.com/pexpect/pexpect/pull/308/files)\n\nIt is really quite trivial and it provided yet another easy optimization. If some reviewer agrees, I will add that patch to the branch here.",
    "created_at": "2015-12-10T19:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96332",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

I have made one additional pull request to `pexpect`: [https://github.com/pexpect/pexpect/pull/308/files](https://github.com/pexpect/pexpect/pull/308/files)

It is really quite trivial and it provided yet another easy optimization. If some reviewer agrees, I will add that patch to the branch here.



---

archive/issue_comments_096333.json:
```json
{
    "body": "<div id=\"comment:180\" align=\"right\">comment:180</div>\n\nReplying to [@kiwifb](#comment:178):\n> Replying to [@kcrisman](#comment:177):\n> > Now that this has positive review otherwise, I'll also be sure to include the relevant piece in #19616.  Fran\u00e7ois, if you want to make the same PR as before I can do that; I'm not sure how to revert reverting a changeset on Github, I just want to make sure your name is still attached to that change.\n\n> \n> On it.\n\nThis is now https://github.com/sagemath/sagenb/pull/356",
    "created_at": "2015-12-10T20:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96333",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:180" align="right">comment:180</div>

Replying to [@kiwifb](#comment:178):
> Replying to [@kcrisman](#comment:177):
> > Now that this has positive review otherwise, I'll also be sure to include the relevant piece in #19616.  Fran√ßois, if you want to make the same PR as before I can do that; I'm not sure how to revert reverting a changeset on Github, I just want to make sure your name is still attached to that change.

> 
> On it.

This is now https://github.com/sagemath/sagenb/pull/356



---

archive/issue_comments_096334.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n **New upstream tarballs**:\n * https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz\n * https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz\n-* \u200bhttp://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar\n+* http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.6.tar\n \n **Patches included and submitted upstream**:\n * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n``````\n",
    "created_at": "2015-12-14T09:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96334",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 **New upstream tarballs**:
 * https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz
 * https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz
-* ‚Äãhttp://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.5.1.tar
+* http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.6.tar
 
 **Patches included and submitted upstream**:
 * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
``````




---

archive/issue_comments_096335.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd1ec53da213ce1e739496abfb40c50284948041\">fd1ec53</a></td><td><code>Upgrade sagenb to version 0.11.5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bb1df25d5d7873c51abde434cda5aaeea4328b5\">0bb1df2</a></td><td><code>Upgrade sagenb to version 0.11.6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1255a5a4a07559fe444455aeff7a2d27388a0b87\">1255a5a</a></td><td><code>Merge remote-tracking branch 'trac/u/kcrisman/ticket/19616' into t/10295/pexpect3.3</code></td></tr></table>\n",
    "created_at": "2015-12-14T09:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96335",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd1ec53da213ce1e739496abfb40c50284948041">fd1ec53</a></td><td><code>Upgrade sagenb to version 0.11.5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bb1df25d5d7873c51abde434cda5aaeea4328b5">0bb1df2</a></td><td><code>Upgrade sagenb to version 0.11.6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1255a5a4a07559fe444455aeff7a2d27388a0b87">1255a5a</a></td><td><code>Merge remote-tracking branch 'trac/u/kcrisman/ticket/19616' into t/10295/pexpect3.3</code></td></tr></table>




---

archive/issue_events_135356.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2015-12-14T09:22:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135356"
}
```



---

archive/issue_events_135357.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2015-12-14T09:22:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135357"
}
```



---

archive/issue_comments_096336.json:
```json
{
    "body": "Changed commit from **[1e75fbd](https://github.com/sagemath/sagetrac-mirror/commit/1e75fbd677507e9bb1e06879fe2f45580ab3b584)** to **[1255a5a](https://github.com/sagemath/sagetrac-mirror/commit/1255a5a4a07559fe444455aeff7a2d27388a0b87)**",
    "created_at": "2015-12-14T09:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96336",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1e75fbd](https://github.com/sagemath/sagetrac-mirror/commit/1e75fbd677507e9bb1e06879fe2f45580ab3b584)** to **[1255a5a](https://github.com/sagemath/sagetrac-mirror/commit/1255a5a4a07559fe444455aeff7a2d27388a0b87)**



---

archive/issue_comments_096337.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nMerged the latest version of #19616.",
    "created_at": "2015-12-14T09:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96337",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Merged the latest version of #19616.



---

archive/issue_events_135358.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-14T09:23:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135358"
}
```



---

archive/issue_events_135359.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-14T09:23:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135359"
}
```



---

archive/issue_comments_096338.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bed31b2aea44ae9e3783a2cdc914edbd4232e7e9\">bed31b2</a></td><td><code>Upgrade sagenb to version 0.11.6.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9351ccb53d1d3c1d387c11e0c57443b53d1cfdd1\">9351ccb</a></td><td><code>Merge remote-tracking branch 'trac/u/kcrisman/ticket/19616' into t/10295/pexpect3.3</code></td></tr></table>\n",
    "created_at": "2015-12-16T21:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96338",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bed31b2aea44ae9e3783a2cdc914edbd4232e7e9">bed31b2</a></td><td><code>Upgrade sagenb to version 0.11.6.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9351ccb53d1d3c1d387c11e0c57443b53d1cfdd1">9351ccb</a></td><td><code>Merge remote-tracking branch 'trac/u/kcrisman/ticket/19616' into t/10295/pexpect3.3</code></td></tr></table>




---

archive/issue_comments_096339.json:
```json
{
    "body": "Changed commit from **[1255a5a](https://github.com/sagemath/sagetrac-mirror/commit/1255a5a4a07559fe444455aeff7a2d27388a0b87)** to **[9351ccb](https://github.com/sagemath/sagetrac-mirror/commit/9351ccb53d1d3c1d387c11e0c57443b53d1cfdd1)**",
    "created_at": "2015-12-16T21:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96339",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1255a5a](https://github.com/sagemath/sagetrac-mirror/commit/1255a5a4a07559fe444455aeff7a2d27388a0b87)** to **[9351ccb](https://github.com/sagemath/sagetrac-mirror/commit/9351ccb53d1d3c1d387c11e0c57443b53d1cfdd1)**



---

archive/issue_events_135360.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2015-12-16T21:34:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135360"
}
```



---

archive/issue_events_135361.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2015-12-16T21:34:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135361"
}
```



---

archive/issue_comments_096340.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,13 +5,15 @@\n **New upstream tarballs**:\n * https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz\n * https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz\n-* http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.6.tar\n+* http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.6.1.tar\n \n **Patches included and submitted upstream**:\n * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)\n * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)\n * [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)\n * [https://github.com/pexpect/pexpect/pull/307](https://github.com/pexpect/pexpect/pull/307)\n+\n+**Note** that this branch *includes* #19616.\n \n ---\n \n``````\n",
    "created_at": "2015-12-16T21:34:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96340",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,13 +5,15 @@
 **New upstream tarballs**:
 * https://pypi.python.org/packages/source/p/pexpect/pexpect-4.0.1.tar.gz
 * https://pypi.python.org/packages/source/p/ptyprocess/ptyprocess-0.5.tar.gz
-* http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.6.tar
+* http://www.math-cs.gordon.edu/~kcrisman/sagenb-0.11.6.1.tar
 
 **Patches included and submitted upstream**:
 * [https://github.com/pexpect/pexpect/pull/291](https://github.com/pexpect/pexpect/pull/291)
 * [https://github.com/pexpect/pexpect/pull/303](https://github.com/pexpect/pexpect/pull/303)
 * [https://github.com/pexpect/pexpect/pull/304](https://github.com/pexpect/pexpect/pull/304)
 * [https://github.com/pexpect/pexpect/pull/307](https://github.com/pexpect/pexpect/pull/307)
+
+**Note** that this branch *includes* #19616.
 
 ---
 
``````




---

archive/issue_comments_096341.json:
```json
{
    "body": "Changed dependencies from **#19671, #19616** to **#19671**",
    "created_at": "2015-12-16T21:34:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96341",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#19671, #19616** to **#19671**



---

archive/issue_events_135362.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-16T21:35:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135362"
}
```



---

archive/issue_events_135363.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-16T21:35:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135363"
}
```



---

archive/issue_comments_096342.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nFollow-up at #19736.",
    "created_at": "2015-12-16T22:21:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96342",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Follow-up at #19736.



---

archive/issue_comments_096343.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Bill Page**",
    "created_at": "2015-12-17T09:15:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96343",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Bill Page**



---

archive/issue_events_135364.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-12-22T19:50:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135364"
}
```



---

archive/issue_events_135365.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c12ef2085079bd5d22332c99966645183c864a36",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-12-22T19:50:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10295#event-135365"
}
```



---

archive/issue_comments_096344.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/pexpect3.3](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/pexpect3.3)** to **[9351ccb](https://github.com/sagemath/sagetrac-mirror/commit/9351ccb53d1d3c1d387c11e0c57443b53d1cfdd1)**",
    "created_at": "2015-12-22T19:50:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10295#issuecomment-96344",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/pexpect3.3](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/pexpect3.3)** to **[9351ccb](https://github.com/sagemath/sagetrac-mirror/commit/9351ccb53d1d3c1d387c11e0c57443b53d1cfdd1)**
