# Issue 10070: make heaviside and step play nicely together.

archive/issues_010069.json:
```json
{
    "body": "The heaviside built-in function and the step symbolic method are not the same at zero. \n\n```\nsage: heaviside(0)\nheaviside(0)\nsage: SR(0).step()\n1/2\n```\nAnd the documentation seems to indicate that `heaviside` should be undefined (?) at zero, though it's not definitive.  \n\nIn addition to reconciling these, we should probably unify notation or something. \n\n**Assignee:** @burcin\n\n**CC:**  @mforets @rwst\n\n**Branch/Commit:** [bbc921e655a6a914679f27919d11781f6eb5593c](https://github.com/sagemath/sagetrac-mirror/commit/bbc921e655a6a914679f27919d11781f6eb5593c)\n\n**Reviewer:** Travis Scrimshaw, Marcelo Forets\n\n**Author:** Ralf Stephan\n\n**Dependencies:** #22838\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/10070\n\n",
    "closed_at": "2017-04-27T20:11:43Z",
    "created_at": "2010-10-05T13:41:44Z",
    "labels": [
        "component: symbolics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "make heaviside and step play nicely together.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10070",
    "user": "https://github.com/kcrisman"
}
```
The heaviside built-in function and the step symbolic method are not the same at zero. 

```
sage: heaviside(0)
heaviside(0)
sage: SR(0).step()
1/2
```
And the documentation seems to indicate that `heaviside` should be undefined (?) at zero, though it's not definitive.  

In addition to reconciling these, we should probably unify notation or something. 

**Assignee:** @burcin

**CC:**  @mforets @rwst

**Branch/Commit:** [bbc921e655a6a914679f27919d11781f6eb5593c](https://github.com/sagemath/sagetrac-mirror/commit/bbc921e655a6a914679f27919d11781f6eb5593c)

**Reviewer:** Travis Scrimshaw, Marcelo Forets

**Author:** Ralf Stephan

**Dependencies:** #22838

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/10070





---

archive/issue_comments_127975.json:
```json
{
    "body": "<a id='comment:1'></a>\nSee also #10071 for how this would allow `step(hold=True)` to be evaluated post hoc.",
    "created_at": "2010-10-05T13:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127975",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>
See also #10071 for how this would allow `step(hold=True)` to be evaluated post hoc.



---

archive/issue_events_030914.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30914"
}
```



---

archive/issue_events_030915.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30915"
}
```



---

archive/issue_events_030916.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30916"
}
```



---

archive/issue_events_030917.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30917"
}
```



---

archive/issue_events_030918.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30918"
}
```



---

archive/issue_events_030919.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30919"
}
```



---

archive/issue_events_030920.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30920"
}
```



---

archive/issue_comments_127976.json:
```json
{
    "body": "<a id='comment:7'></a>\nthe problem is that in many contexts (that is, university courses and books), the heaviside step function is not assigned the value 1/2 at 0, as was the choice in `SR(0).step()`. if seen as a distribution, there is no need for such choice indeed, since this would be a difference by a set of measure 0.\n\nlet me mention in passing that a proper class of distributions with some flesh in it would be a (cool!) feature. \n\ncompare to:\n\n- `heaviside` has a similar behaviour to Mathematica's [HeavisideTheta](https://reference.wolfram.com/language/ref/HeavisideTheta.html) function.\n\n- `unit_step` has a similar behaviour to Mathematica's [UnitStep](https://reference.wolfram.com/language/ref/UnitStep.html) function.\n\nin sum, this is to suggest:\n\n- writing \"See also\" blocks, where it is missing\n- allowing the possibility to assign a value to heaviside at 0 (as in sympy)",
    "created_at": "2017-04-01T06:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127976",
    "user": "https://github.com/mforets"
}
```

<a id='comment:7'></a>
the problem is that in many contexts (that is, university courses and books), the heaviside step function is not assigned the value 1/2 at 0, as was the choice in `SR(0).step()`. if seen as a distribution, there is no need for such choice indeed, since this would be a difference by a set of measure 0.

let me mention in passing that a proper class of distributions with some flesh in it would be a (cool!) feature. 

compare to:

- `heaviside` has a similar behaviour to Mathematica's [HeavisideTheta](https://reference.wolfram.com/language/ref/HeavisideTheta.html) function.

- `unit_step` has a similar behaviour to Mathematica's [UnitStep](https://reference.wolfram.com/language/ref/UnitStep.html) function.

in sum, this is to suggest:

- writing "See also" blocks, where it is missing
- allowing the possibility to assign a value to heaviside at 0 (as in sympy)



---

archive/issue_comments_127977.json:
```json
{
    "body": "<a id='comment:8'></a>\nFrom the [wikipedia page](https://en.wikipedia.org/wiki/Heaviside_step_function), it is mostly a convention choice and depends on the situation. The current behavior actually doesn't allow it to be evaluated at 0:\n\n```\nsage: heaviside(0)\nheaviside(0)\nsage: heaviside(0).n()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: function returned None, expected return value of type sage.symbolic.expression.Expression\n```\nThere seem to be some other differences with step:\n\n```\nsage: heaviside(I)\nheaviside(I)\nsage: SR(I).step()\n1\nsage: plot(x.step())\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n...\nRuntimeError: cannot find SFunction in table\n```\nSo both of these approaches might need some work.",
    "created_at": "2017-04-01T14:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127977",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
From the [wikipedia page](https://en.wikipedia.org/wiki/Heaviside_step_function), it is mostly a convention choice and depends on the situation. The current behavior actually doesn't allow it to be evaluated at 0:

```
sage: heaviside(0)
heaviside(0)
sage: heaviside(0).n()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: function returned None, expected return value of type sage.symbolic.expression.Expression
```
There seem to be some other differences with step:

```
sage: heaviside(I)
heaviside(I)
sage: SR(I).step()
1
sage: plot(x.step())
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: cannot find SFunction in table
```
So both of these approaches might need some work.



---

archive/issue_comments_127978.json:
```json
{
    "body": "<a id='comment:9'></a>\ni think this ticket should also fix integration with the default interface (Maxima):\n\n```\nsage: integrate(heaviside(x), x, 0, 10)    # unevaluated?\nintegrate(heaviside(x), x, 0, 10)\nsage: integrate(heaviside(x), x, 0, 10, algorithm='sympy')    # ok\n10\n```",
    "created_at": "2017-04-08T09:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127978",
    "user": "https://github.com/mforets"
}
```

<a id='comment:9'></a>
i think this ticket should also fix integration with the default interface (Maxima):

```
sage: integrate(heaviside(x), x, 0, 10)    # unevaluated?
integrate(heaviside(x), x, 0, 10)
sage: integrate(heaviside(x), x, 0, 10, algorithm='sympy')    # ok
10
```



---

archive/issue_events_030921.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-04-08T13:21:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30921"
}
```



---

archive/issue_events_030922.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-04-08T13:21:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30922"
}
```



---

archive/issue_comments_127979.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [tscrim](#comment%3A8):\n> From the [wikipedia page](https://en.wikipedia.org/wiki/Heaviside_step_function), it is mostly a convention choice and depends on the situation. The current behavior actually doesn't allow it to be evaluated at 0:\n> \n> ```\n> sage: heaviside(0)\n> heaviside(0)\n> sage: heaviside(0).n()\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> ...\n> TypeError: function returned None, expected return value of type sage.symbolic.expression.Expression\n> ```\n\n\nok. i think that it should rather break with: `TypeError: cannot evaluate symbolic expression numerically` (the problem is that currently it returns `None`). also in the help it should be clear that the value at 0 can be specified ad-hoc via an additional argument (as in sympy). \n\n> There seem to be some other differences with step:\n> \n> ```\n> sage: heaviside(I)\n> heaviside(I)\n> sage: SR(I).step()\n> 1\n> sage: plot(x.step())\n> ---------------------------------------------------------------------------\n> RuntimeError                              Traceback (most recent call last)\n> ...\n> RuntimeError: cannot find SFunction in table\n> ```\n\n\nintereseting, i didn't yet understand how to \"add new functions to the SFunction table\", hints welcome. for instance, `plot(x.abs())` does work, as well as a couple of other Pynac functions at `/libs/pynac/pynac.pyd`. however, in that file there exist all `g_step`, `step_serial` and `py_step` entries.",
    "created_at": "2017-04-09T11:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127979",
    "user": "https://github.com/mforets"
}
```

<a id='comment:11'></a>
Replying to [tscrim](#comment%3A8):
> From the [wikipedia page](https://en.wikipedia.org/wiki/Heaviside_step_function), it is mostly a convention choice and depends on the situation. The current behavior actually doesn't allow it to be evaluated at 0:
> 
> ```
> sage: heaviside(0)
> heaviside(0)
> sage: heaviside(0).n()
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> ...
> TypeError: function returned None, expected return value of type sage.symbolic.expression.Expression
> ```


ok. i think that it should rather break with: `TypeError: cannot evaluate symbolic expression numerically` (the problem is that currently it returns `None`). also in the help it should be clear that the value at 0 can be specified ad-hoc via an additional argument (as in sympy). 

> There seem to be some other differences with step:
> 
> ```
> sage: heaviside(I)
> heaviside(I)
> sage: SR(I).step()
> 1
> sage: plot(x.step())
> ---------------------------------------------------------------------------
> RuntimeError                              Traceback (most recent call last)
> ...
> RuntimeError: cannot find SFunction in table
> ```


intereseting, i didn't yet understand how to "add new functions to the SFunction table", hints welcome. for instance, `plot(x.abs())` does work, as well as a couple of other Pynac functions at `/libs/pynac/pynac.pyd`. however, in that file there exist all `g_step`, `step_serial` and `py_step` entries.



---

archive/issue_comments_127980.json:
```json
{
    "body": "<a id='comment:12'></a>\nRalf, can you help us with the SFunction table (comment:11)? I haven't ever used it either.\n\nI would also appreciate any thoughts you had about the Heaviside step function. On a sight tangent, I've been told it is somewhat slow for use in SageManifolds and if there was a way to make it faster (I can cc Eric too for more details).",
    "created_at": "2017-04-09T15:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127980",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Ralf, can you help us with the SFunction table (comment:11)? I haven't ever used it either.

I would also appreciate any thoughts you had about the Heaviside step function. On a sight tangent, I've been told it is somewhat slow for use in SageManifolds and if there was a way to make it faster (I can cc Eric too for more details).



---

archive/issue_comments_127981.json:
```json
{
    "body": "<a id='comment:13'></a>\nI opened an issue: https://github.com/pynac/pynac/issues/243",
    "created_at": "2017-04-09T15:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127981",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'></a>
I opened an issue: https://github.com/pynac/pynac/issues/243



---

archive/issue_comments_127982.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [tscrim](#comment%3A12):\n\n> I would also appreciate any thoughts you had about the Heaviside step function. On a sight tangent, I've been told it is somewhat slow for use in SageManifolds and if there was a way to make it faster (I can cc Eric too for more details).\n\n\nthe module [piecewise.py](https://github.com/sagemath/sage/blob/master/src/sage/functions/piecewise.py) is using `from sage.ext.fast_callable import ExpressionTreeBuilder`, maybe this helps? \n\nheaviside is just `heaviside_piecewise = piecewise([((-oo, 0), 0), ((0, oo), 1)], var=x)`, if 0 is not in the domain",
    "created_at": "2017-04-10T11:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127982",
    "user": "https://github.com/mforets"
}
```

<a id='comment:14'></a>
Replying to [tscrim](#comment%3A12):

> I would also appreciate any thoughts you had about the Heaviside step function. On a sight tangent, I've been told it is somewhat slow for use in SageManifolds and if there was a way to make it faster (I can cc Eric too for more details).


the module [piecewise.py](https://github.com/sagemath/sage/blob/master/src/sage/functions/piecewise.py) is using `from sage.ext.fast_callable import ExpressionTreeBuilder`, maybe this helps? 

heaviside is just `heaviside_piecewise = piecewise([((-oo, 0), 0), ((0, oo), 1)], var=x)`, if 0 is not in the domain



---

archive/issue_comments_127983.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [tscrim](#comment%3A12):\n> Ralf, can you help us with the SFunction table (comment:11)? I haven't ever used it either.\n\n\nOk I have now looked a bit into this. The SFunctionTable problem comes from the fact that there is no step function class in `sage/functions` and you get the raw Pynac function object that is not registered with the (Python) table. The same BTW applies to `x.csgn()`. Since there is no `Function` object `step(x)` is also not available. So if you want a full feature `step` function different from `heaviside` and `unit_step` the best is to create such a `GinacFunction` in eg `functions/generalized.py`. Else I would argue to replace the code in `Expression.step()` with a call to `heaviside` or `unit_step`, and in the longer term, deprecate the member function in favor of an alias `step =` in `functions/generalized.py`.\n\n> I would also appreciate any thoughts you had about the Heaviside step function. On a sight tangent, I've been told it is somewhat slow for use in SageManifolds and if there was a way to make it faster (I can cc Eric too for more details).\n\n\nCreation is not really slow but numerics is:\n\n```\nsage: %timeit _=heaviside(x)\nThe slowest run took 5.08 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 13.4 \u00b5s per loop\nsage: %timeit _=heaviside(2.7)\nThe slowest run took 4.33 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 58.9 \u00b5s per loop\nsage: %timeit _=heaviside(ZZ(8))\n10000 loops, best of 3: 78.8 \u00b5s per loop\nsage: %timeit _=heaviside(QQ(8))\n10000 loops, best of 3: 82.5 \u00b5s per loop\n```\nThe ZZ and QQ numbers can be easily and well improved by changing `FunctionHeaviside` to a `GinacFunction` and checking for these types in C++ because the GMP functions are available there and Python is not needed. The evalf part still needs Python. I guess this all applies to `unit_step`.\n\nSo, is a `step()` separate from `heaviside` and `unit_step` really needed? If not which is it?",
    "created_at": "2017-04-13T15:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127983",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'></a>
Replying to [tscrim](#comment%3A12):
> Ralf, can you help us with the SFunction table (comment:11)? I haven't ever used it either.


Ok I have now looked a bit into this. The SFunctionTable problem comes from the fact that there is no step function class in `sage/functions` and you get the raw Pynac function object that is not registered with the (Python) table. The same BTW applies to `x.csgn()`. Since there is no `Function` object `step(x)` is also not available. So if you want a full feature `step` function different from `heaviside` and `unit_step` the best is to create such a `GinacFunction` in eg `functions/generalized.py`. Else I would argue to replace the code in `Expression.step()` with a call to `heaviside` or `unit_step`, and in the longer term, deprecate the member function in favor of an alias `step =` in `functions/generalized.py`.

> I would also appreciate any thoughts you had about the Heaviside step function. On a sight tangent, I've been told it is somewhat slow for use in SageManifolds and if there was a way to make it faster (I can cc Eric too for more details).


Creation is not really slow but numerics is:

```
sage: %timeit _=heaviside(x)
The slowest run took 5.08 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 13.4 µs per loop
sage: %timeit _=heaviside(2.7)
The slowest run took 4.33 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 58.9 µs per loop
sage: %timeit _=heaviside(ZZ(8))
10000 loops, best of 3: 78.8 µs per loop
sage: %timeit _=heaviside(QQ(8))
10000 loops, best of 3: 82.5 µs per loop
```
The ZZ and QQ numbers can be easily and well improved by changing `FunctionHeaviside` to a `GinacFunction` and checking for these types in C++ because the GMP functions are available there and Python is not needed. The evalf part still needs Python. I guess this all applies to `unit_step`.

So, is a `step()` separate from `heaviside` and `unit_step` really needed? If not which is it?



---

archive/issue_comments_127984.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [rws](#comment%3A15):\n> The ZZ and QQ numbers can be easily and well improved by changing `FunctionHeaviside` to a `GinacFunction` and checking for these types in C++ [...]\n\n\nthanks! so i tried BuiltinFunction -> GinacFunction in the def of FunctionHeaviside (and at the `init` method), and sage crashes when we do `./sage -br` (compiles but crashes at runtime). why?\n\nthen i defined a new `class FunctionHeavisideGinac(GinacFunction):` just calling it `heaviside_ginac`, and then sage doesn't crash and we can use it. i don't have a clue what may be the cause..",
    "created_at": "2017-04-18T17:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127984",
    "user": "https://github.com/mforets"
}
```

<a id='comment:16'></a>
Replying to [rws](#comment%3A15):
> The ZZ and QQ numbers can be easily and well improved by changing `FunctionHeaviside` to a `GinacFunction` and checking for these types in C++ [...]


thanks! so i tried BuiltinFunction -> GinacFunction in the def of FunctionHeaviside (and at the `init` method), and sage crashes when we do `./sage -br` (compiles but crashes at runtime). why?

then i defined a new `class FunctionHeavisideGinac(GinacFunction):` just calling it `heaviside_ginac`, and then sage doesn't crash and we can use it. i don't have a clue what may be the cause..



---

archive/issue_comments_127985.json:
```json
{
    "body": "<a id='comment:17'></a>\nI bet the slow part of `_evalf_` comes from this line:\n\n```\napprox_x = ComplexIntervalField()(x)\n```\nwhich has a Python (i.e., not Cython) `__call__` function (contrast this with `Parent.__call__`).\n\n> So, is a `step()` separate from `heaviside` and `unit_step` really needed? If not which is it? \n\n\nThis one is hard because they all have slightly different behaviors with dealing with `0`. The natural inclination from me is to combine them all into 1 function, where we can give it an optional parameter for what to do when evaluating at `0`. However, this has problems when converting to other programs and keeping with their conventions; e.g., mathematica for `heaviside` and `unit_step` are different functions. I also don't have good use cases, so I can't give definitive answers on this.",
    "created_at": "2017-04-18T22:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127985",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
I bet the slow part of `_evalf_` comes from this line:

```
approx_x = ComplexIntervalField()(x)
```
which has a Python (i.e., not Cython) `__call__` function (contrast this with `Parent.__call__`).

> So, is a `step()` separate from `heaviside` and `unit_step` really needed? If not which is it? 


This one is hard because they all have slightly different behaviors with dealing with `0`. The natural inclination from me is to combine them all into 1 function, where we can give it an optional parameter for what to do when evaluating at `0`. However, this has problems when converting to other programs and keeping with their conventions; e.g., mathematica for `heaviside` and `unit_step` are different functions. I also don't have good use cases, so I can't give definitive answers on this.



---

archive/issue_comments_127986.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [mforets](#comment%3A16):\n> Replying to [rws](#comment%3A15):\n> > The ZZ and QQ numbers can be easily and well improved by changing `FunctionHeaviside` to a `GinacFunction` and checking for these types in C++ [...]\n\n> \n> thanks! so i tried BuiltinFunction -> GinacFunction in the def of FunctionHeaviside (and at the `init` method), and sage crashes when we do `./sage -br` (compiles but crashes at runtime). why?\n\n\nProbably because you still had \"heaviside\" as name argument in the `GinacFunction.__init__` call but I didn't check (note that Pynac matches Pynac functions with Sage functions by name and the name of the only Pynac function of this kind is `step`). Rather, what I meant was then write a second Pynac function corresponding to `heaviside`.\n\n> then i defined a new `class FunctionHeavisideGinac(GinacFunction):` just calling it `heaviside_ginac`, and then sage doesn't crash and we can use it. i don't have a clue what may be the cause..\n\n\nBut then nothing is done in C++ so no speedup.",
    "created_at": "2017-04-19T07:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127986",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'></a>
Replying to [mforets](#comment%3A16):
> Replying to [rws](#comment%3A15):
> > The ZZ and QQ numbers can be easily and well improved by changing `FunctionHeaviside` to a `GinacFunction` and checking for these types in C++ [...]

> 
> thanks! so i tried BuiltinFunction -> GinacFunction in the def of FunctionHeaviside (and at the `init` method), and sage crashes when we do `./sage -br` (compiles but crashes at runtime). why?


Probably because you still had "heaviside" as name argument in the `GinacFunction.__init__` call but I didn't check (note that Pynac matches Pynac functions with Sage functions by name and the name of the only Pynac function of this kind is `step`). Rather, what I meant was then write a second Pynac function corresponding to `heaviside`.

> then i defined a new `class FunctionHeavisideGinac(GinacFunction):` just calling it `heaviside_ginac`, and then sage doesn't crash and we can use it. i don't have a clue what may be the cause..


But then nothing is done in C++ so no speedup.



---

archive/issue_comments_127987.json:
```json
{
    "body": "<a id='comment:19'></a>\nNote that if you allow a separate `step()` then a `Function` in `src/sage/functions` would be needed because atm only `x.step()` works not `step(x)`.",
    "created_at": "2017-04-19T07:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127987",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'></a>
Note that if you allow a separate `step()` then a `Function` in `src/sage/functions` would be needed because atm only `x.step()` works not `step(x)`.



---

archive/issue_comments_127988.json:
```json
{
    "body": "<a id='comment:20'></a>\ni'd like to argue in favor of 1 `heaviside` 1 `unit_step` (not merged), that is to keep the current implementation, and to follow the recommendation of rws about pointing `SR(x).step()` into `unit_step()` (*)\n\nfor some people, the fact that heaviside is undefined at 0 is good and expected, because what it really defines is an equivalence class, and it is typically used in the context of [distributions](https://en.wikipedia.org/wiki/Distribution_(mathematics)). in concrete, linear systems theory (to model a on/off switch) and for differential -> algebraic transformations in physics problems (applications of laplace transform). \n\nbut for other set of users (as in the OP description), this may be confusing, and in many contexts one wouldn't like to talk about equivalence class and the `dirac_delta` (more on this below). \n\nif i had to change something it would be the derivative operator of `unit_step`: again, one wouldn't like to talk about `dirac_delta` in many contexts because that is a more advanced notion. instead i would give the answer `piecewise([((-oo, 0), 0), ((0, oo), 0)])`, which is nice because 0 is not in  the domain when you ask `f(0)`.. we can also add a message `See heaviside for a generalized notion.`\n\n(*) argument: it's not possible to make a plot, `plot(SR(x).step())`, for such a long time, that i suspect it's not widely used. it should be merged with `unit_step()` or `heaviside()` with value 1/2 at 0. don't have any particular preference, probably the latter.\n\n(note: ..this comment could be more illustrative of different uses (or not) with proper references to books/courses but i don't have time to go into that now :/ )",
    "created_at": "2017-04-19T07:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127988",
    "user": "https://github.com/mforets"
}
```

<a id='comment:20'></a>
i'd like to argue in favor of 1 `heaviside` 1 `unit_step` (not merged), that is to keep the current implementation, and to follow the recommendation of rws about pointing `SR(x).step()` into `unit_step()` (*)

for some people, the fact that heaviside is undefined at 0 is good and expected, because what it really defines is an equivalence class, and it is typically used in the context of [distributions](https://en.wikipedia.org/wiki/Distribution_(mathematics)). in concrete, linear systems theory (to model a on/off switch) and for differential -> algebraic transformations in physics problems (applications of laplace transform). 

but for other set of users (as in the OP description), this may be confusing, and in many contexts one wouldn't like to talk about equivalence class and the `dirac_delta` (more on this below). 

if i had to change something it would be the derivative operator of `unit_step`: again, one wouldn't like to talk about `dirac_delta` in many contexts because that is a more advanced notion. instead i would give the answer `piecewise([((-oo, 0), 0), ((0, oo), 0)])`, which is nice because 0 is not in  the domain when you ask `f(0)`.. we can also add a message `See heaviside for a generalized notion.`

(*) argument: it's not possible to make a plot, `plot(SR(x).step())`, for such a long time, that i suspect it's not widely used. it should be merged with `unit_step()` or `heaviside()` with value 1/2 at 0. don't have any particular preference, probably the latter.

(note: ..this comment could be more illustrative of different uses (or not) with proper references to books/courses but i don't have time to go into that now :/ )



---

archive/issue_comments_127989.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mforets](#comment%3A20):\n> i'd like to argue in favor of 1 `heaviside` 1 `unit_step` (not merged), that is to keep the current implementation, and to follow the recommendation of rws about pointing `SR(x).step()` into `unit_step()` (*)\n\n\n`step()` timings:\n\n```\nsage: %timeit _=SR(1).step()\nThe slowest run took 11.30 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 4.77 \u00b5s per loop\nsage: %timeit _=SR(1/2).step()\nThe slowest run took 7.51 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 6.92 \u00b5s per loop\nsage: %timeit _=SR(1.5).step()\nThe slowest run took 6.56 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 8.21 \u00b5s per loop\n```\n\nSo the Pynac's `step` can be used to speed up `heaviside` and `unit_step`. The procedure would be to rename `step` in Pynac to `unit_step` (adapting the behaviour at 0), and copy the code for `heaviside` in Pynac (again adapting the behaviour at 0), and after that make the Sage functions `GinacFunction`s.",
    "created_at": "2017-04-19T07:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127989",
    "user": "https://github.com/rwst"
}
```

<a id='comment:21'></a>
Replying to [mforets](#comment%3A20):
> i'd like to argue in favor of 1 `heaviside` 1 `unit_step` (not merged), that is to keep the current implementation, and to follow the recommendation of rws about pointing `SR(x).step()` into `unit_step()` (*)


`step()` timings:

```
sage: %timeit _=SR(1).step()
The slowest run took 11.30 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 4.77 µs per loop
sage: %timeit _=SR(1/2).step()
The slowest run took 7.51 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 6.92 µs per loop
sage: %timeit _=SR(1.5).step()
The slowest run took 6.56 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 8.21 µs per loop
```

So the Pynac's `step` can be used to speed up `heaviside` and `unit_step`. The procedure would be to rename `step` in Pynac to `unit_step` (adapting the behaviour at 0), and copy the code for `heaviside` in Pynac (again adapting the behaviour at 0), and after that make the Sage functions `GinacFunction`s.



---

archive/issue_comments_127990.json:
```json
{
    "body": "**Branch:** [u/mforets/make_heaviside_and_step_play_nicely_together_](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/make_heaviside_and_step_play_nicely_together_)",
    "created_at": "2017-04-19T12:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127990",
    "user": "https://github.com/mforets"
}
```

**Branch:** [u/mforets/make_heaviside_and_step_play_nicely_together_](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/make_heaviside_and_step_play_nicely_together_)



---

archive/issue_comments_127991.json:
```json
{
    "body": "**Commit:** [d7813f80f995233cb964d8bec9d39b50188d53a1](https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1)",
    "created_at": "2017-04-19T12:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127991",
    "user": "https://github.com/mforets"
}
```

**Commit:** [d7813f80f995233cb964d8bec9d39b50188d53a1](https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1)



---

archive/issue_comments_127992.json:
```json
{
    "body": "<a id='comment:23'></a>\n> Replying to [mforets](#comment%3A22):\n\n\npresuming that this commit is not correct, but is a starter. still i need some time to understand how things work. \n\nabout the timing, already it gets down to 22us with this little change. i suppose that calling symbolic expressions `step` is not good (?), but instead a call to `new_Expression_from_GEx` requires a `cimport`?..\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1\">d7813f8</a></td><td><code>call pynac's step from generalized.py</code></td></tr></table>\n",
    "created_at": "2017-04-19T12:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127992",
    "user": "https://github.com/mforets"
}
```

<a id='comment:23'></a>
> Replying to [mforets](#comment%3A22):


presuming that this commit is not correct, but is a starter. still i need some time to understand how things work. 

about the timing, already it gets down to 22us with this little change. i suppose that calling symbolic expressions `step` is not good (?), but instead a call to `new_Expression_from_GEx` requires a `cimport`?..

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1">d7813f8</a></td><td><code>call pynac's step from generalized.py</code></td></tr></table>




---

archive/issue_comments_127993.json:
```json
{
    "body": "<a id='comment:24'></a>\n> Replying to [rws](#comment%3A21):\n> and copy the code for `heaviside` in Pynac (again adapting the behaviour at 0), and after that make the Sage functions `GinacFunction`s.\n\n\nOk so in the end of the day, in `generalized.py` we shall be left with:\n\n- just one `FunctionUnitStep(GinacFunction)`, or with\n- one `FunctionUnitStep(BuiltinFunction)` plus one `FunctionUnitStep(GinacFunction)`?",
    "created_at": "2017-04-19T13:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127993",
    "user": "https://github.com/mforets"
}
```

<a id='comment:24'></a>
> Replying to [rws](#comment%3A21):
> and copy the code for `heaviside` in Pynac (again adapting the behaviour at 0), and after that make the Sage functions `GinacFunction`s.


Ok so in the end of the day, in `generalized.py` we shall be left with:

- just one `FunctionUnitStep(GinacFunction)`, or with
- one `FunctionUnitStep(BuiltinFunction)` plus one `FunctionUnitStep(GinacFunction)`?



---

archive/issue_comments_127994.json:
```json
{
    "body": "**Changing branch** from \"[u/mforets/make_heaviside_and_step_play_nicely_together_](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/make_heaviside_and_step_play_nicely_together_)\" to \"[u/rws/10070](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/10070)\".",
    "created_at": "2017-04-19T13:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127994",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/mforets/make_heaviside_and_step_play_nicely_together_](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/make_heaviside_and_step_play_nicely_together_)" to "[u/rws/10070](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/10070)".



---

archive/issue_comments_127995.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7211abe1d82d928a1b7547727b26e71a683672fc\">7211abe</a></td><td><code>10070: use Pynac's step() via GinacFunction</code></td></tr></table>\n",
    "created_at": "2017-04-19T13:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127995",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7211abe1d82d928a1b7547727b26e71a683672fc">7211abe</a></td><td><code>10070: use Pynac's step() via GinacFunction</code></td></tr></table>




---

archive/issue_comments_127996.json:
```json
{
    "body": "**Changing commit** from \"[d7813f80f995233cb964d8bec9d39b50188d53a1](https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1)\" to \"[7211abe1d82d928a1b7547727b26e71a683672fc](https://github.com/sagemath/sagetrac-mirror/commit/7211abe1d82d928a1b7547727b26e71a683672fc)\".",
    "created_at": "2017-04-19T13:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127996",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d7813f80f995233cb964d8bec9d39b50188d53a1](https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1)" to "[7211abe1d82d928a1b7547727b26e71a683672fc](https://github.com/sagemath/sagetrac-mirror/commit/7211abe1d82d928a1b7547727b26e71a683672fc)".



---

archive/issue_comments_127997.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [mforets](#comment%3A23):\n> > Replying to [mforets](#comment%3A22):\n\n> \n> about the timing, already it gets down to 22us with this little change. i suppose that calling symbolic expressions `step` is not good (?), but instead a call to `new_Expression_from_GEx` requires a `cimport`?..\n\n\nYes but I think that's not the reason that it still needs 22us. The branch I uploaded leaves only the derivative function and uses Pynac's step for everything else. It gets down to 6us.\n\n> presuming that this commit is not correct, but is a starter. still i need some time to understand how things work.\n",
    "created_at": "2017-04-19T13:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127997",
    "user": "https://github.com/rwst"
}
```

<a id='comment:27'></a>
Replying to [mforets](#comment%3A23):
> > Replying to [mforets](#comment%3A22):

> 
> about the timing, already it gets down to 22us with this little change. i suppose that calling symbolic expressions `step` is not good (?), but instead a call to `new_Expression_from_GEx` requires a `cimport`?..


Yes but I think that's not the reason that it still needs 22us. The branch I uploaded leaves only the derivative function and uses Pynac's step for everything else. It gets down to 6us.

> presuming that this commit is not correct, but is a starter. still i need some time to understand how things work.




---

archive/issue_comments_127998.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/10070](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/10070)\" to \"[u/mforets/make_heaviside_and_step_play_nicely_together_](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/make_heaviside_and_step_play_nicely_together_)\".",
    "created_at": "2017-04-19T13:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127998",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/10070](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/10070)" to "[u/mforets/make_heaviside_and_step_play_nicely_together_](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/make_heaviside_and_step_play_nicely_together_)".



---

archive/issue_comments_127999.json:
```json
{
    "body": "**Changing commit** from \"[7211abe1d82d928a1b7547727b26e71a683672fc](https://github.com/sagemath/sagetrac-mirror/commit/7211abe1d82d928a1b7547727b26e71a683672fc)\" to \"[d7813f80f995233cb964d8bec9d39b50188d53a1](https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1)\".",
    "created_at": "2017-04-19T13:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-127999",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[7211abe1d82d928a1b7547727b26e71a683672fc](https://github.com/sagemath/sagetrac-mirror/commit/7211abe1d82d928a1b7547727b26e71a683672fc)" to "[d7813f80f995233cb964d8bec9d39b50188d53a1](https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1)".



---

archive/issue_comments_128000.json:
```json
{
    "body": "<a id='comment:28'></a>\nOf course in the final version the name is set back to `unit_step` after step in Pynac is named unit_step. Also the doctests need to be moved to the class docstring.",
    "created_at": "2017-04-19T13:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128000",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
Of course in the final version the name is set back to `unit_step` after step in Pynac is named unit_step. Also the doctests need to be moved to the class docstring.



---

archive/issue_comments_128001.json:
```json
{
    "body": "<a id='comment:29'></a>\nI will try to include the relevant changes in the next Pynac version 0.7.6.",
    "created_at": "2017-04-19T13:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128001",
    "user": "https://github.com/rwst"
}
```

<a id='comment:29'></a>
I will try to include the relevant changes in the next Pynac version 0.7.6.



---

archive/issue_comments_128002.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [mforets](#comment%3A24):\n> > Replying to [rws](#comment%3A21):\n> > and copy the code for `heaviside` in Pynac (again adapting the behaviour at 0), and after that make the Sage functions `GinacFunction`s.\n\n> \n> Ok so in the end of the day, in `generalized.py` we shall be left with:\n> \n> - just one `FunctionUnitStep(GinacFunction)`, or with\n> - one `FunctionUnitStep(BuiltinFunction)` plus one `FunctionUnitStep(GinacFunction)`?\n\n\nOne `FunctionHeaviside(GinacFunction)` plus one `FunctionUnitStep(GinacFunction)`.\n\n(EDITED)",
    "created_at": "2017-04-19T13:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128002",
    "user": "https://github.com/rwst"
}
```

<a id='comment:30'></a>
Replying to [mforets](#comment%3A24):
> > Replying to [rws](#comment%3A21):
> > and copy the code for `heaviside` in Pynac (again adapting the behaviour at 0), and after that make the Sage functions `GinacFunction`s.

> 
> Ok so in the end of the day, in `generalized.py` we shall be left with:
> 
> - just one `FunctionUnitStep(GinacFunction)`, or with
> - one `FunctionUnitStep(BuiltinFunction)` plus one `FunctionUnitStep(GinacFunction)`?


One `FunctionHeaviside(GinacFunction)` plus one `FunctionUnitStep(GinacFunction)`.

(EDITED)



---

archive/issue_comments_128003.json:
```json
{
    "body": "<a id='comment:31'></a>\nI don't know if this pertains to this ticket but, aside from the value at 0, another difference between `heaviside` and `unit_step` is that the former cannot be used in numerical resolutions:\n\n```\nsage: y = var('y')\nsage: desolve_rk4(x,y,ics=[0,0],end_points=1,step=0.5) # solution is x^2/2\n[[0, 0], [0.5, 0.125], [1.0, 0.4999999999999999]]\nsage: desolve_rk4(x*unit_step(1+x),y,ics=[0,0],end_points=1,step=0.5) # OK\n[[0, 0], [0.5, 0.125], [1.0, 0.4999999999999999]]\nsage: desolve_rk4(x*heaviside(1+x),y,ics=[0,0],end_points=1,step=0.5) # ??\n[[0, 0]]\n```\nThe value at 0 cannot explain such difference because `x` varies in [0,1], so that `1+x>0` and `heaviside(1+x)` should always return `1`.",
    "created_at": "2017-04-19T20:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128003",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:31'></a>
I don't know if this pertains to this ticket but, aside from the value at 0, another difference between `heaviside` and `unit_step` is that the former cannot be used in numerical resolutions:

```
sage: y = var('y')
sage: desolve_rk4(x,y,ics=[0,0],end_points=1,step=0.5) # solution is x^2/2
[[0, 0], [0.5, 0.125], [1.0, 0.4999999999999999]]
sage: desolve_rk4(x*unit_step(1+x),y,ics=[0,0],end_points=1,step=0.5) # OK
[[0, 0], [0.5, 0.125], [1.0, 0.4999999999999999]]
sage: desolve_rk4(x*heaviside(1+x),y,ics=[0,0],end_points=1,step=0.5) # ??
[[0, 0]]
```
The value at 0 cannot explain such difference because `x` varies in [0,1], so that `1+x>0` and `heaviside(1+x)` should always return `1`.



---

archive/issue_comments_128004.json:
```json
{
    "body": "<a id='comment:32'></a>\nNote that\n\n```\ndesolve_rk4(x*(1+x).step(),y,ics=[0,0],end_points=1,step=0.5)\n```\nresults in an error, but that should be fixed by the proposed change.",
    "created_at": "2017-04-19T20:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128004",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>
Note that

```
desolve_rk4(x*(1+x).step(),y,ics=[0,0],end_points=1,step=0.5)
```
results in an error, but that should be fixed by the proposed change.



---

archive/issue_comments_128005.json:
```json
{
    "body": "**Changing branch** from \"[u/mforets/make_heaviside_and_step_play_nicely_together_](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/make_heaviside_and_step_play_nicely_together_)\" to \"[u/rws/10070-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/10070-1)\".",
    "created_at": "2017-04-20T08:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128005",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/mforets/make_heaviside_and_step_play_nicely_together_](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/make_heaviside_and_step_play_nicely_together_)" to "[u/rws/10070-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/10070-1)".



---

archive/issue_comments_128006.json:
```json
{
    "body": "**Dependencies:** #22838",
    "created_at": "2017-04-20T08:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128006",
    "user": "https://github.com/rwst"
}
```

**Dependencies:** #22838



---

archive/issue_comments_128007.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-04-20T08:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128007",
    "user": "https://github.com/rwst"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_128008.json:
```json
{
    "body": "<a id='comment:34'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c848dafc67f073a295a382e2760b00ef8175ddb\">3c848da</a></td><td><code>22838: pkg version/checksum</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d89e6d0df966cf85542f32ae133905c1f55f853c\">d89e6d0</a></td><td><code>22838: remove unnecessary patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a30119162c83386ec77dfbc5cb7995ac66ae7d4\">4a30119</a></td><td><code>22838: interface change</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d3fd60de71caff0ab8b2d9ec365a95312388944\">7d3fd60</a></td><td><code>22838: doctest adaptation to ticket 10070</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79ab0ac26bc7dae8f3324b35520e239e1f14f774\">79ab0ac</a></td><td><code>10070: heaviside, unit_step revamp</code></td></tr></table>\n",
    "created_at": "2017-04-20T08:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128008",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c848dafc67f073a295a382e2760b00ef8175ddb">3c848da</a></td><td><code>22838: pkg version/checksum</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d89e6d0df966cf85542f32ae133905c1f55f853c">d89e6d0</a></td><td><code>22838: remove unnecessary patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a30119162c83386ec77dfbc5cb7995ac66ae7d4">4a30119</a></td><td><code>22838: interface change</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d3fd60de71caff0ab8b2d9ec365a95312388944">7d3fd60</a></td><td><code>22838: doctest adaptation to ticket 10070</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79ab0ac26bc7dae8f3324b35520e239e1f14f774">79ab0ac</a></td><td><code>10070: heaviside, unit_step revamp</code></td></tr></table>




---

archive/issue_comments_128009.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2017-04-20T08:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128009",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_128010.json:
```json
{
    "body": "**Changing commit** from \"[d7813f80f995233cb964d8bec9d39b50188d53a1](https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1)\" to \"[79ab0ac26bc7dae8f3324b35520e239e1f14f774](https://github.com/sagemath/sagetrac-mirror/commit/79ab0ac26bc7dae8f3324b35520e239e1f14f774)\".",
    "created_at": "2017-04-20T08:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128010",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[d7813f80f995233cb964d8bec9d39b50188d53a1](https://github.com/sagemath/sagetrac-mirror/commit/d7813f80f995233cb964d8bec9d39b50188d53a1)" to "[79ab0ac26bc7dae8f3324b35520e239e1f14f774](https://github.com/sagemath/sagetrac-mirror/commit/79ab0ac26bc7dae8f3324b35520e239e1f14f774)".



---

archive/issue_comments_128011.json:
```json
{
    "body": "<a id='comment:35'></a>\n@rwst : cool, i was able to test it! (thanks to your answer in the other ticket). Wow! <surprise face> so heaviside is really defined in `inifcns.cpp` of the Ginac project. \n\nwe still have issues that have been raised in this thread that should be fixed (optional definition at 0, use in `integrate` fails, use in `desolve_rk4` fails) -- but i guess that should be a new ticket for `heaviside` only?",
    "created_at": "2017-04-20T13:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128011",
    "user": "https://github.com/mforets"
}
```

<a id='comment:35'></a>
@rwst : cool, i was able to test it! (thanks to your answer in the other ticket). Wow! <surprise face> so heaviside is really defined in `inifcns.cpp` of the Ginac project. 

we still have issues that have been raised in this thread that should be fixed (optional definition at 0, use in `integrate` fails, use in `desolve_rk4` fails) -- but i guess that should be a new ticket for `heaviside` only?



---

archive/issue_comments_128012.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [mforets](#comment%3A35):\n> we still have issues that have been raised in this thread that should be fixed (optional definition at 0, use in `integrate` fails, use in `desolve_rk4` fails) -- but i guess that should be a new ticket for `heaviside` only?\n\n\nAgreed.",
    "created_at": "2017-04-20T13:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128012",
    "user": "https://github.com/rwst"
}
```

<a id='comment:36'></a>
Replying to [mforets](#comment%3A35):
> we still have issues that have been raised in this thread that should be fixed (optional definition at 0, use in `integrate` fails, use in `desolve_rk4` fails) -- but i guess that should be a new ticket for `heaviside` only?


Agreed.



---

archive/issue_comments_128013.json:
```json
{
    "body": "<a id='comment:37'></a>\nThere was a part of me that hoped this would fix [comment:31](#comment%3A31) (it does fix [comment:32](#comment%3A32) as I predicted), but it doesn't. However, I agree that this should be a separate ticket.\n\nI think we need to also update the documentation for `step` to say it returns the `unit_step`, which has a different convention from `heaviside`. This should fix some of the issues with this ticket; the other would be to add `.. SEEALSO::` links between the two with a mild note on the difference. I do not agree that they should have different derivatives as the Dirac delta behaves essentially in the same way.",
    "created_at": "2017-04-20T13:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128013",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'></a>
There was a part of me that hoped this would fix [comment:31](#comment%3A31) (it does fix [comment:32](#comment%3A32) as I predicted), but it doesn't. However, I agree that this should be a separate ticket.

I think we need to also update the documentation for `step` to say it returns the `unit_step`, which has a different convention from `heaviside`. This should fix some of the issues with this ticket; the other would be to add `.. SEEALSO::` links between the two with a mild note on the difference. I do not agree that they should have different derivatives as the Dirac delta behaves essentially in the same way.



---

archive/issue_comments_128014.json:
```json
{
    "body": "**Changing commit** from \"[79ab0ac26bc7dae8f3324b35520e239e1f14f774](https://github.com/sagemath/sagetrac-mirror/commit/79ab0ac26bc7dae8f3324b35520e239e1f14f774)\" to \"[68e3a60e4fd5ebef56437e4b9740fba993386ed4](https://github.com/sagemath/sagetrac-mirror/commit/68e3a60e4fd5ebef56437e4b9740fba993386ed4)\".",
    "created_at": "2017-04-20T21:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128014",
    "user": "https://github.com/mforets"
}
```

**Changing commit** from "[79ab0ac26bc7dae8f3324b35520e239e1f14f774](https://github.com/sagemath/sagetrac-mirror/commit/79ab0ac26bc7dae8f3324b35520e239e1f14f774)" to "[68e3a60e4fd5ebef56437e4b9740fba993386ed4](https://github.com/sagemath/sagetrac-mirror/commit/68e3a60e4fd5ebef56437e4b9740fba993386ed4)".



---

archive/issue_comments_128015.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/10070-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/10070-1)\" to \"[u/mforets/10070](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/10070)\".",
    "created_at": "2017-04-20T21:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128015",
    "user": "https://github.com/mforets"
}
```

**Changing branch** from "[u/rws/10070-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/10070-1)" to "[u/mforets/10070](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/10070)".



---

archive/issue_comments_128016.json:
```json
{
    "body": "<a id='comment:38'></a>\nupdate docstring of `step`, add see also blocks.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68e3a60e4fd5ebef56437e4b9740fba993386ed4\">68e3a60</a></td><td><code>add seealso blocks</code></td></tr></table>\n",
    "created_at": "2017-04-20T21:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128016",
    "user": "https://github.com/mforets"
}
```

<a id='comment:38'></a>
update docstring of `step`, add see also blocks.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68e3a60e4fd5ebef56437e4b9740fba993386ed4">68e3a60</a></td><td><code>add seealso blocks</code></td></tr></table>




---

archive/issue_comments_128017.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [tscrim](#comment%3A37):\n> There was a part of me that hoped this would fix [comment:31](#comment%3A31) (it does fix [comment:32](#comment%3A32) as I predicted), but it doesn't. However, I agree that this should be a separate ticket.\n\n\nseparate ticket: #22849, Heaviside in numerical resolutions.",
    "created_at": "2017-04-20T22:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128017",
    "user": "https://github.com/mforets"
}
```

<a id='comment:39'></a>
Replying to [tscrim](#comment%3A37):
> There was a part of me that hoped this would fix [comment:31](#comment%3A31) (it does fix [comment:32](#comment%3A32) as I predicted), but it doesn't. However, I agree that this should be a separate ticket.


separate ticket: #22849, Heaviside in numerical resolutions.



---

archive/issue_comments_128018.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2017-04-21T03:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128018",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_128019.json:
```json
{
    "body": "<a id='comment:40'></a>\nYour last commit will likely conflict with a similar change I made on #22838. Once you merge in those changes, you can set a positive review on my behalf (and add your name to the reviewers list).",
    "created_at": "2017-04-21T03:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128019",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>
Your last commit will likely conflict with a similar change I made on #22838. Once you merge in those changes, you can set a positive review on my behalf (and add your name to the reviewers list).



---

archive/issue_comments_128020.json:
```json
{
    "body": "<a id='comment:41'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca852a14f122326ed4b11d412efbdb8bb15aa028\">ca852a1</a></td><td><code>Some reviewer tweaks.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbc921e655a6a914679f27919d11781f6eb5593c\">bbc921e</a></td><td><code>Merge branch 'u/tscrim/pynac_0_7_6-22838' of git://trac.sagemath.org/sage into u/mforets/10070</code></td></tr></table>\n",
    "created_at": "2017-04-21T06:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca852a14f122326ed4b11d412efbdb8bb15aa028">ca852a1</a></td><td><code>Some reviewer tweaks.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbc921e655a6a914679f27919d11781f6eb5593c">bbc921e</a></td><td><code>Merge branch 'u/tscrim/pynac_0_7_6-22838' of git://trac.sagemath.org/sage into u/mforets/10070</code></td></tr></table>




---

archive/issue_comments_128021.json:
```json
{
    "body": "**Changing commit** from \"[68e3a60e4fd5ebef56437e4b9740fba993386ed4](https://github.com/sagemath/sagetrac-mirror/commit/68e3a60e4fd5ebef56437e4b9740fba993386ed4)\" to \"[bbc921e655a6a914679f27919d11781f6eb5593c](https://github.com/sagemath/sagetrac-mirror/commit/bbc921e655a6a914679f27919d11781f6eb5593c)\".",
    "created_at": "2017-04-21T06:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128021",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[68e3a60e4fd5ebef56437e4b9740fba993386ed4](https://github.com/sagemath/sagetrac-mirror/commit/68e3a60e4fd5ebef56437e4b9740fba993386ed4)" to "[bbc921e655a6a914679f27919d11781f6eb5593c](https://github.com/sagemath/sagetrac-mirror/commit/bbc921e655a6a914679f27919d11781f6eb5593c)".



---

archive/issue_comments_128022.json:
```json
{
    "body": "<a id='comment:42'></a>\n@tscrim : merge done, thanks!",
    "created_at": "2017-04-21T06:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128022",
    "user": "https://github.com/mforets"
}
```

<a id='comment:42'></a>
@tscrim : merge done, thanks!



---

archive/issue_comments_128023.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-04-21T06:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128023",
    "user": "https://github.com/mforets"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_128024.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Marcelo Forets\".",
    "created_at": "2017-04-21T06:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128024",
    "user": "https://github.com/mforets"
}
```

**Changing reviewer** from "Travis Scrimshaw" to "Travis Scrimshaw, Marcelo Forets".



---

archive/issue_comments_128025.json:
```json
{
    "body": "**Changing branch** from \"[u/mforets/10070](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/10070)\" to \"[bbc921e655a6a914679f27919d11781f6eb5593c](https://github.com/sagemath/sagetrac-mirror/commit/bbc921e655a6a914679f27919d11781f6eb5593c)\".",
    "created_at": "2017-04-27T20:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128025",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mforets/10070](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/10070)" to "[bbc921e655a6a914679f27919d11781f6eb5593c](https://github.com/sagemath/sagetrac-mirror/commit/bbc921e655a6a914679f27919d11781f6eb5593c)".



---

archive/issue_comments_128026.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2017-04-27T20:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10070#issuecomment-128026",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_030923.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-27T20:11:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10070",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10070#event-30923"
}
```
