# Issue 10816: Subscheme creation does not work from the notebook

archive/issues_010750.json:
```json
{
    "body": "There is the following example in the documentation in `schemes\\generic\\projective_space.py`:\n\n```\nsage: A.<x,y,z> = ProjectiveSpace(2, QQ)\nsage: X = A.subscheme([x*z^2, y^2*z, x*y^2]); X\nClosed subscheme of Projective Space of dimension 2 over Rational Field defined by:\n  x*z^2,\n  y^2*z,\n  x*y^2\n```\nThe file passes tests fine in sage-4.6.2.rc0, I can also do it from the command line. But if I try to do it in the notebook, I get\n\n```\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"_sage_input_4.py\", line 10, in <module>\n    exec compile(u'open(\"___code___.py\",\"w\").write(\"# -*- coding: utf-8 -*-\\\\n\" + _support_.preparse_worksheet_cell(base64.b64decode(\"QS48eCx5LHo+ID0gUHJvamVjdGl2ZVNwYWNlKDIsIFFRKQpYID0gQS5zdWJzY2hlbWUoW3gqel4yLCB5XjIqeiwgeCp5XjJdKTsgWA==\"),globals())+\"\\\\n\"); execfile(os.path.abspath(\"___code___.py\"))\n  File \"\", line 1, in <module>\n    \n  File \"/tmp/tmpgPYl3N/___code___.py\", line 4, in <module>\n    exec compile(u'X = A.subscheme([x*z**_sage_const_2 , y**_sage_const_2 *z, x*y**_sage_const_2 ]); X\n  File \"\", line 1, in <module>\n    \n  File \"/home/novoselt/sage/local/lib/python2.6/site-packages/sage/schemes/generic/projective_space.py\", line 501, in subscheme\n    return algebraic_scheme.AlgebraicScheme_subscheme_projective(self, X)\nAttributeError: 'module' object has no attribute 'AlgebraicScheme_subscheme_projective'\n```\nwhich I don't understand.\n\nEverything is good in the notebook in sage-4.6, so it should been broken recently, perhaps by #10525, although I can't imagine how.\n\nAssignee: @aghitza\n\nCC:  @vbraun @jdemeyer\n\nResolution: fixed\n\nAuthor: Volker Braun\n\nReviewer: Jeroen Demeyer\n\nMerged: sage-4.6.2.rc1\n\nIssue created by migration from https://trac.sagemath.org/ticket/10816\n\n",
    "closed_at": "2011-02-25T08:07:01Z",
    "created_at": "2011-02-21T19:16:19Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Subscheme creation does not work from the notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10816",
    "user": "https://github.com/novoselt"
}
```
There is the following example in the documentation in `schemes\generic\projective_space.py`:

```
sage: A.<x,y,z> = ProjectiveSpace(2, QQ)
sage: X = A.subscheme([x*z^2, y^2*z, x*y^2]); X
Closed subscheme of Projective Space of dimension 2 over Rational Field defined by:
  x*z^2,
  y^2*z,
  x*y^2
```
The file passes tests fine in sage-4.6.2.rc0, I can also do it from the command line. But if I try to do it in the notebook, I get

```
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "_sage_input_4.py", line 10, in <module>
    exec compile(u'open("___code___.py","w").write("# -*- coding: utf-8 -*-\\n" + _support_.preparse_worksheet_cell(base64.b64decode("QS48eCx5LHo+ID0gUHJvamVjdGl2ZVNwYWNlKDIsIFFRKQpYID0gQS5zdWJzY2hlbWUoW3gqel4yLCB5XjIqeiwgeCp5XjJdKTsgWA=="),globals())+"\\n"); execfile(os.path.abspath("___code___.py"))
  File "", line 1, in <module>
    
  File "/tmp/tmpgPYl3N/___code___.py", line 4, in <module>
    exec compile(u'X = A.subscheme([x*z**_sage_const_2 , y**_sage_const_2 *z, x*y**_sage_const_2 ]); X
  File "", line 1, in <module>
    
  File "/home/novoselt/sage/local/lib/python2.6/site-packages/sage/schemes/generic/projective_space.py", line 501, in subscheme
    return algebraic_scheme.AlgebraicScheme_subscheme_projective(self, X)
AttributeError: 'module' object has no attribute 'AlgebraicScheme_subscheme_projective'
```
which I don't understand.

Everything is good in the notebook in sage-4.6, so it should been broken recently, perhaps by #10525, although I can't imagine how.

Assignee: @aghitza

CC:  @vbraun @jdemeyer

Resolution: fixed

Author: Volker Braun

Reviewer: Jeroen Demeyer

Merged: sage-4.6.2.rc1

Issue created by migration from https://trac.sagemath.org/ticket/10816





---

archive/issue_comments_143243.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think the problem is a circular import `projective_space` <-> `algebraic_scheme`",
    "created_at": "2011-02-21T20:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143243",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>
I think the problem is a circular import `projective_space` <-> `algebraic_scheme`



---

archive/issue_comments_143244.json:
```json
{
    "body": "<a id='comment:2'></a>\nMaybe, but I don't see what is wrong with those imports.\n\nWhat bugs me most is that it works from the command line, but not in the notebook, so there is probably a bug in the notebook, but I have no idea how to trace it.",
    "created_at": "2011-02-21T20:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143244",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'></a>
Maybe, but I don't see what is wrong with those imports.

What bugs me most is that it works from the command line, but not in the notebook, so there is probably a bug in the notebook, but I have no idea how to trace it.



---

archive/issue_comments_143245.json:
```json
{
    "body": "Initial patch",
    "created_at": "2011-02-22T10:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143245",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_events_033367.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-22T10:49:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10816#event-33367"
}
```



---

archive/issue_comments_143246.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_10816_remove_cyclic_import.patch](tarball://root/attachments/some-uuid/ticket10816/trac_10816_remove_cyclic_import.patch) by @vbraun created at 2011-02-22 10:49:25\n\nRemoving the circular import fixes this for me. The bug was probably introduced in #10525, so it would be nice if we could push the patch into Sage-4.6.2. Its really uncontroversial.",
    "created_at": "2011-02-22T10:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143246",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
Attachment [trac_10816_remove_cyclic_import.patch](tarball://root/attachments/some-uuid/ticket10816/trac_10816_remove_cyclic_import.patch) by @vbraun created at 2011-02-22 10:49:25

Removing the circular import fixes this for me. The bug was probably introduced in #10525, so it would be nice if we could push the patch into Sage-4.6.2. Its really uncontroversial.



---

archive/issue_comments_143247.json:
```json
{
    "body": "Author: Volker Braun",
    "created_at": "2011-02-22T10:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143247",
    "user": "https://github.com/vbraun"
}
```

Author: Volker Braun



---

archive/issue_comments_143248.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-22T10:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143248",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_143249.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe patch looks fine, but what about other spaces, I suppose they have the same problem?\n\nThe main issue is that this error could not be detected automatically and you cannot demonstrate in a doctest that this patch has solved the problem. Who knows how many of the other doctests in Sage would fail in the notebook?.. Checking for circular imports by hands is very tedious and perhaps even impossible, so these issues must be caught during tests.",
    "created_at": "2011-02-22T15:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143249",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>
The patch looks fine, but what about other spaces, I suppose they have the same problem?

The main issue is that this error could not be detected automatically and you cannot demonstrate in a doctest that this patch has solved the problem. Who knows how many of the other doctests in Sage would fail in the notebook?.. Checking for circular imports by hands is very tedious and perhaps even impossible, so these issues must be caught during tests.



---

archive/issue_comments_143250.json:
```json
{
    "body": "<a id='comment:5'></a>\nCan we first fix this bug before we embark on a discussion on how to extend the doctesting framework?\n\nI think pylint and similar tools can already check for circular imports. Although bad style, I think the circular import here was actually ok. So there might be a bug in the worksheet. Since that is being rewritten right now, I don't think its useful to spend  much time tracking down the underlying issue.",
    "created_at": "2011-02-22T16:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143250",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
Can we first fix this bug before we embark on a discussion on how to extend the doctesting framework?

I think pylint and similar tools can already check for circular imports. Although bad style, I think the circular import here was actually ok. So there might be a bug in the worksheet. Since that is being rewritten right now, I don't think its useful to spend  much time tracking down the underlying issue.



---

archive/issue_comments_143251.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [vbraun](#comment%3A3):\n> Removing the circular import fixes this for me. The bug was probably introduced in #10525, so it would be nice if we could push the patch into Sage-4.6.2. Its really uncontroversial.\n\n\nAgreed.",
    "created_at": "2011-02-22T16:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143251",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [vbraun](#comment%3A3):
> Removing the circular import fixes this for me. The bug was probably introduced in #10525, so it would be nice if we could push the patch into Sage-4.6.2. Its really uncontroversial.


Agreed.



---

archive/issue_comments_143252.json:
```json
{
    "body": "Reviewer: Jeroen Demeyer",
    "created_at": "2011-02-22T16:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143252",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: Jeroen Demeyer



---

archive/issue_comments_143253.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-23T08:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143253",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_033368.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-25T08:07:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10816#event-33368"
}
```



---

archive/issue_comments_143254.json:
```json
{
    "body": "Merged: sage-4.6.2.rc1",
    "created_at": "2011-02-25T08:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143254",
    "user": "https://github.com/jdemeyer"
}
```

Merged: sage-4.6.2.rc1



---

archive/issue_comments_143255.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-02-25T08:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10816",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10816#issuecomment-143255",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
