# Issue 10572: compiler/binutils wrapper

archive/issues_010519.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "This ticket implements a wrapper for the compiler that lets us rewrite compiler options on the fly. The goal is to fix:\n\n1. Clashes between system and Sage's libraries due to LD_LIBRARY_PATH abuse.\n2. Relocation issues, i.e., \"dead\" (hard-coded) RPATHs in binaries (shared libraries and executables) created by Sage, upon moving the installation (which includes installing a pre-built / binary distribution).\n3. Broken compiler versions / tool chains; work around by messing with (e.g.) optimization flags, depending on the present compiler and its known issues.\n\nThe wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.\n\nCode repository https://bitbucket.org/vbraun/compilerwrapper\n\nUse tarball at:\n* http://boxen.math.washington.edu/home/jpflori/upstream/compilerwrapper-1.2.tar.bz2\n\nCC:  @sagetrac-drkirkby @jdemeyer @wjp @burcin @jpflori @tscrim\n\nKeywords: **compiler gcc wrapper rpath spkg**\n\nBranch/Commit: **[`1df9ecd`](https://github.com/sagemath/sagetrac-mirror/commit/1df9ecd34079780609a95aa0b79168ed376d83da)**\n\nReviewer: **Jean-Pierre Flori**\n\nAuthor: **Volker Braun, Jean-Pierre Flori**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10572_\n\n",
    "closed_at": "2014-11-14T21:01:41Z",
    "created_at": "2011-01-09T06:52:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "compiler/binutils wrapper",
    "type": "issue",
    "updated_at": "2014-11-14T21:01:41Z",
    "url": "https://github.com/sagemath/sage/issues/10572",
    "user": "https://github.com/vbraun"
}
```
This ticket implements a wrapper for the compiler that lets us rewrite compiler options on the fly. The goal is to fix:

1. Clashes between system and Sage's libraries due to LD_LIBRARY_PATH abuse.
2. Relocation issues, i.e., "dead" (hard-coded) RPATHs in binaries (shared libraries and executables) created by Sage, upon moving the installation (which includes installing a pre-built / binary distribution).
3. Broken compiler versions / tool chains; work around by messing with (e.g.) optimization flags, depending on the present compiler and its known issues.

The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.

Code repository https://bitbucket.org/vbraun/compilerwrapper

Use tarball at:
* http://boxen.math.washington.edu/home/jpflori/upstream/compilerwrapper-1.2.tar.bz2

CC:  @sagetrac-drkirkby @jdemeyer @wjp @burcin @jpflori @tscrim

Keywords: **compiler gcc wrapper rpath spkg**

Branch/Commit: **[`1df9ecd`](https://github.com/sagemath/sagetrac-mirror/commit/1df9ecd34079780609a95aa0b79168ed376d83da)**

Reviewer: **Jean-Pierre Flori**

Author: **Volker Braun, Jean-Pierre Flori**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/10572_





---

archive/issue_events_139216.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-01-09T06:52:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139216"
}
```



---

archive/issue_events_139217.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-01-09T06:52:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139217"
}
```



---

archive/issue_events_139218.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-01-09T06:52:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139218"
}
```



---

archive/issue_events_139219.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-01-09T06:52:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139219"
}
```



---

archive/issue_events_139220.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2011-01-09T06:52:46Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139220"
}
```



---

archive/issue_comments_100837.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,15 @@\n-This ticket aims to implement a gcc wrapper that will change gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at \n+This ticket aims to implement a gcc wrapper that will suitably modify gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at:\n \n https://bitbucket.org/vbraun/gcc-wrapper\n \n-Right now, the wrappers\n-* remove any extra rpath that is set\n-* set the rpath to `$ORIGIN/../lib`. This makes the sage binaries look for their libraries in `$SAGE_LOCAL/lib` and no `LD_LIBRARY_PATH` hacks are necessary.\n-* some gcc optimization settings are removed on itanium and gcc 4.4.1. See also #10430.\n+and a spkg is here:\n+\n+http://www.stp.dias.ie/~vbraun/Sage/spkg/gccwrapper-1.0.spkg\n+\n+Right now, the wrapper\n+* removes any extra rpaths that are set\n+* sets the rpath to `$ORIGIN/../lib`. This forces the sage binaries to first look for their libraries in `$SAGE_LOCAL/lib` and no `LD_LIBRARY_PATH` hacks are necessary any more.\n+* removes some gcc optimization settings that are broken on itanium and gcc 4.4.1. See also #10430.\n \n The wrapper is implemented in pure C++ and does not depend on any Sage component.\n \n-TODO:\n-* Make the underlying ld binary independently configurable - this will simplify building Sage on Solaris.\n-\n``````\n",
    "created_at": "2011-01-09T09:07:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100837",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,15 @@
-This ticket aims to implement a gcc wrapper that will change gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at 
+This ticket aims to implement a gcc wrapper that will suitably modify gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at:
 
 https://bitbucket.org/vbraun/gcc-wrapper
 
-Right now, the wrappers
-* remove any extra rpath that is set
-* set the rpath to `$ORIGIN/../lib`. This makes the sage binaries look for their libraries in `$SAGE_LOCAL/lib` and no `LD_LIBRARY_PATH` hacks are necessary.
-* some gcc optimization settings are removed on itanium and gcc 4.4.1. See also #10430.
+and a spkg is here:
+
+http://www.stp.dias.ie/~vbraun/Sage/spkg/gccwrapper-1.0.spkg
+
+Right now, the wrapper
+* removes any extra rpaths that are set
+* sets the rpath to `$ORIGIN/../lib`. This forces the sage binaries to first look for their libraries in `$SAGE_LOCAL/lib` and no `LD_LIBRARY_PATH` hacks are necessary any more.
+* removes some gcc optimization settings that are broken on itanium and gcc 4.4.1. See also #10430.
 
 The wrapper is implemented in pure C++ and does not depend on any Sage component.
 
-TODO:
-* Make the underlying ld binary independently configurable - this will simplify building Sage on Solaris.
-
``````




---

archive/issue_comments_100838.json:
```json
{
    "body": "Attachment: **[install.gz](https://github.com/sagemath/sage/files/ticket10572/install.gz)**\n\nspkg/install with the wrapper spkg added",
    "created_at": "2011-01-10T03:39:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100838",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[install.gz](https://github.com/sagemath/sage/files/ticket10572/install.gz)**

spkg/install with the wrapper spkg added



---

archive/issue_comments_100839.json:
```json
{
    "body": "spkg/standard/deps with the added gcc wrapper spkg",
    "created_at": "2011-01-10T03:40:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100839",
    "user": "https://github.com/vbraun"
}
```

spkg/standard/deps with the added gcc wrapper spkg



---

archive/issue_comments_100840.json:
```json
{
    "body": "Attachment: **[deps.gz](https://github.com/sagemath/sage/files/ticket10572/deps.gz)**\n\ndiff for spkg/install",
    "created_at": "2011-01-10T03:41:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100840",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[deps.gz](https://github.com/sagemath/sage/files/ticket10572/deps.gz)**

diff for spkg/install



---

archive/issue_comments_100841.json:
```json
{
    "body": "Attachment: **[gccwrapper-install.patch.gz](https://github.com/sagemath/sage/files/ticket10572/gccwrapper-install.patch.gz)**\n\ndiff for spkg/standard/deps",
    "created_at": "2011-01-10T03:41:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100841",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[gccwrapper-install.patch.gz](https://github.com/sagemath/sage/files/ticket10572/gccwrapper-install.patch.gz)**

diff for spkg/standard/deps



---

archive/issue_events_139221.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-01-11T10:26:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139221"
}
```



---

archive/issue_comments_100842.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,10 +6,10 @@\n \n http://www.stp.dias.ie/~vbraun/Sage/spkg/gccwrapper-1.0.spkg\n \n-Right now, the wrapper\n-* removes any extra rpaths that are set\n-* sets the rpath to `$ORIGIN/../lib`. This forces the sage binaries to first look for their libraries in `$SAGE_LOCAL/lib` and no `LD_LIBRARY_PATH` hacks are necessary any more.\n-* removes some gcc optimization settings that are broken on itanium and gcc 4.4.1. See also #10430.\n+Documentation is at \n+\n+http://www.stp.dias.ie/~vbraun/Sage/gccwrapper/gccwrapper.html\n \n The wrapper is implemented in pure C++ and does not depend on any Sage component.\n \n+\n``````\n",
    "created_at": "2011-01-11T10:26:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100842",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,10 +6,10 @@
 
 http://www.stp.dias.ie/~vbraun/Sage/spkg/gccwrapper-1.0.spkg
 
-Right now, the wrapper
-* removes any extra rpaths that are set
-* sets the rpath to `$ORIGIN/../lib`. This forces the sage binaries to first look for their libraries in `$SAGE_LOCAL/lib` and no `LD_LIBRARY_PATH` hacks are necessary any more.
-* removes some gcc optimization settings that are broken on itanium and gcc 4.4.1. See also #10430.
+Documentation is at 
+
+http://www.stp.dias.ie/~vbraun/Sage/gccwrapper/gccwrapper.html
 
 The wrapper is implemented in pure C++ and does not depend on any Sage component.
 
+
``````




---

archive/issue_comments_100843.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[gccwrapper-deps.patch.gz](https://github.com/sagemath/sage/files/ticket10572/gccwrapper-deps.patch.gz)**",
    "created_at": "2011-01-11T10:26:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100843",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[gccwrapper-deps.patch.gz](https://github.com/sagemath/sage/files/ticket10572/gccwrapper-deps.patch.gz)**



---

archive/issue_comments_100844.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nVolker, what's your opinion on ulimiting the memory/CPU time of `gcc` just in case we are running a broken compiler which either uses infinite memory or runs forever.",
    "created_at": "2011-01-12T00:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100844",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Volker, what's your opinion on ulimiting the memory/CPU time of `gcc` just in case we are running a broken compiler which either uses infinite memory or runs forever.



---

archive/issue_comments_100845.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIn principle we could add limits, but then its hard to say precisely what they ought to be. I've seen gcc use >1gb of ram and take quite a long time and still produce the correct output. We could use something like (total available ram)/(#parallel makes)-256MB but then thats hard to implement and assumes that all parallel makes use the same amount of ram. And detecting the overall amount of ram is again very system-dependent. I think that GCC hanging and/or eating all memory is a rather rare failure mode for gcc, so at this point we shouldn't spend that much effort on it.",
    "created_at": "2011-01-12T01:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100845",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:5" align="right">comment:5</div>

In principle we could add limits, but then its hard to say precisely what they ought to be. I've seen gcc use >1gb of ram and take quite a long time and still produce the correct output. We could use something like (total available ram)/(#parallel makes)-256MB but then thats hard to implement and assumes that all parallel makes use the same amount of ram. And detecting the overall amount of ram is again very system-dependent. I think that GCC hanging and/or eating all memory is a rather rare failure mode for gcc, so at this point we shouldn't spend that much effort on it.



---

archive/issue_comments_100846.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIt seems that pynac no longer compiles properly with the new version of your wrapper (it worked with some older version), see [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.2.test0/pynac-0.2.1.log](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.2.test0/pynac-0.2.1.log).\n\nJust try `sage -f pynac-0.2.1` and see whether you can reproduce this problem.",
    "created_at": "2011-01-18T14:53:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100846",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

It seems that pynac no longer compiles properly with the new version of your wrapper (it worked with some older version), see [http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.2.test0/pynac-0.2.1.log](http://sage.math.washington.edu/home/jdemeyer/release/sage-4.6.2.test0/pynac-0.2.1.log).

Just try `sage -f pynac-0.2.1` and see whether you can reproduce this problem.



---

archive/issue_events_139222.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-18T14:53:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139222"
}
```



---

archive/issue_events_139223.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-18T14:53:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139223"
}
```



---

archive/issue_comments_100847.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nFixed by the new spkg (same location, make sure to delete `$SAGE_ROOT/spkg/optional/gccwrapper-1.0.spkg` if you reinstall). I recompiled all spkgs (by erasing `$SAGE_ROOT/spkg/installed/*` without errors.\n\nTurns out that configure calls gcc with some invalid options to figure out the version, and then expects a certain kind of error. I changed the wrapper to pass a single argument `gcc -option` directly through.",
    "created_at": "2011-01-18T19:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100847",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

Fixed by the new spkg (same location, make sure to delete `$SAGE_ROOT/spkg/optional/gccwrapper-1.0.spkg` if you reinstall). I recompiled all spkgs (by erasing `$SAGE_ROOT/spkg/installed/*` without errors.

Turns out that configure calls gcc with some invalid options to figure out the version, and then expects a certain kind of error. I changed the wrapper to pass a single argument `gcc -option` directly through.



---

archive/issue_events_139224.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:29:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139224"
}
```



---

archive/issue_events_139225.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-19T22:29:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139225"
}
```



---

archive/issue_comments_100848.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWith the latest, I do indeed manage to compile Sage on `sage.math.washington.edu`.  I plan to test it on the buildbot one of the next days.",
    "created_at": "2011-01-19T22:29:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100848",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

With the latest, I do indeed manage to compile Sage on `sage.math.washington.edu`.  I plan to test it on the buildbot one of the next days.



---

archive/issue_comments_100849.json:
```json
{
    "body": "Changed keywords from **gcc wrapper rpath** to **gcc wrapper rpath gccwrapper spkg**",
    "created_at": "2011-01-19T22:29:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100849",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **gcc wrapper rpath** to **gcc wrapper rpath gccwrapper spkg**



---

archive/issue_comments_100850.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHow would this behave if you make a binary distribution of sage, and then move that to another system with gcc installed in a different location? Would (for example) loading cython files still work through the wrapper then?",
    "created_at": "2011-01-20T09:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100850",
    "user": "https://github.com/wjp"
}
```

<div id="comment:9" align="right">comment:9</div>

How would this behave if you make a binary distribution of sage, and then move that to another system with gcc installed in a different location? Would (for example) loading cython files still work through the wrapper then?



---

archive/issue_comments_100851.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nneeds_work given the buildbot tests.",
    "created_at": "2011-01-22T11:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100851",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

needs_work given the buildbot tests.



---

archive/issue_events_139226.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-22T11:18:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139226"
}
```



---

archive/issue_events_139227.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-22T11:18:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139227"
}
```



---

archive/issue_comments_100852.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWillem: A binary distribution should be compiled with the distribution's compiler, so we don't necessarily have to do anything as the compiler ought to be in the same place. But its probably better to either recompile the gcc wrapper on the new system or, if that fails, deactivate it (\"$SAGE_LOCAL/bin/wrapper off\"). We can work this out in a followup ticket where we also remove the `LD_LIBRARY_PATH` hacks.\n\nJeroen: I've updated the spkg to fix compilation on OSX. Turns out the updated ATLAS build script tripped over the wrapper on OSX. I guess I should have seen that coming as I wrote that script, but oh well... Investigating Solaris now.",
    "created_at": "2011-01-22T18:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100852",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

Willem: A binary distribution should be compiled with the distribution's compiler, so we don't necessarily have to do anything as the compiler ought to be in the same place. But its probably better to either recompile the gcc wrapper on the new system or, if that fails, deactivate it ("$SAGE_LOCAL/bin/wrapper off"). We can work this out in a followup ticket where we also remove the `LD_LIBRARY_PATH` hacks.

Jeroen: I've updated the spkg to fix compilation on OSX. Turns out the updated ATLAS build script tripped over the wrapper on OSX. I guess I should have seen that coming as I wrote that script, but oh well... Investigating Solaris now.



---

archive/issue_comments_100853.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe Solaris linker accepts `-R` but not `-rpath`, groan. The updated gccwrapper spkg fixes this. Compile proceeds past the previous error, but due to the amazing slowness it won't finish anytime soon... :-)",
    "created_at": "2011-01-22T20:29:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100853",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>

The Solaris linker accepts `-R` but not `-rpath`, groan. The updated gccwrapper spkg fixes this. Compile proceeds past the previous error, but due to the amazing slowness it won't finish anytime soon... :-)



---

archive/issue_comments_100854.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nBuilt successfully on t2!",
    "created_at": "2011-01-24T15:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100854",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

Built successfully on t2!



---

archive/issue_comments_100855.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI think this is a particularly bad idea. Also be aware that whilst Sage has only ever been built with gcc, there are advantages in building it with the Sun compiler. In fact, in the case of R, it will be necessary on Solaris x86 to build that component with the Sun compiler for a 64-bit build. The R manual states R has never been built 64-bit on Solaris x86 with the GNU compiler. \n\nWhat happens if the compiler is not gcc? \n\nSo please don't go making assumptions about compilers and linkers. Bear in mind Solaris system may have gcc configured to use either the GNU or Sun linker.  \n\nThis whole idea of the ticket gets a -1 from me. It will make further porting efforts more difficult. \n\nDave",
    "created_at": "2011-02-03T14:07:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100855",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:14" align="right">comment:14</div>

I think this is a particularly bad idea. Also be aware that whilst Sage has only ever been built with gcc, there are advantages in building it with the Sun compiler. In fact, in the case of R, it will be necessary on Solaris x86 to build that component with the Sun compiler for a 64-bit build. The R manual states R has never been built 64-bit on Solaris x86 with the GNU compiler. 

What happens if the compiler is not gcc? 

So please don't go making assumptions about compilers and linkers. Bear in mind Solaris system may have gcc configured to use either the GNU or Sun linker.  

This whole idea of the ticket gets a -1 from me. It will make further porting efforts more difficult. 

Dave



---

archive/issue_comments_100856.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI just see that the documentation say \n\n\"The cc wrapper actually calls gcc. This should already be the case as cc just installs as symlink cc -> gcc. But sometimes this link is dropped in manual gcc installs.\"\n\nHow about when gcc and cc and entirely different programs? \n\n```\ndrkirkby@hawk:~$ cc\nusage: cc [ options] files.  Use 'cc -flags' for details\ndrkirkby@hawk:~$ gcc\ngcc: no input files\ndrkirkby@hawk:~$ \n```\n\nSeriously, I would drop the whole idea. \n\nSorry I did not pick up on this ticket earlier. My dad died in mid January, so Sage has not been high on my priority list. \n\nDave",
    "created_at": "2011-02-03T14:16:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100856",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:15" align="right">comment:15</div>

I just see that the documentation say 

"The cc wrapper actually calls gcc. This should already be the case as cc just installs as symlink cc -> gcc. But sometimes this link is dropped in manual gcc installs."

How about when gcc and cc and entirely different programs? 

```
drkirkby@hawk:~$ cc
usage: cc [ options] files.  Use 'cc -flags' for details
drkirkby@hawk:~$ gcc
gcc: no input files
drkirkby@hawk:~$ 
```

Seriously, I would drop the whole idea. 

Sorry I did not pick up on this ticket earlier. My dad died in mid January, so Sage has not been high on my priority list. 

Dave



---

archive/issue_comments_100857.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI think your negative attitude towards this ticket is probably a misunderstanding. I believe that the gccwrapper does not only work with gcc (the name compiler-wrapper might have been a better choice).\n\nI think this can actually make porting a lot easier instead of harder. Because compiler-specific issues can be dealt with just once, namely in the gccwrapper. For example, most of the SAGE64-stuff could be handled by the wrapper, instead of the individual spkgs.",
    "created_at": "2011-02-03T14:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100857",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

I think your negative attitude towards this ticket is probably a misunderstanding. I believe that the gccwrapper does not only work with gcc (the name compiler-wrapper might have been a better choice).

I think this can actually make porting a lot easier instead of harder. Because compiler-specific issues can be dealt with just once, namely in the gccwrapper. For example, most of the SAGE64-stuff could be handled by the wrapper, instead of the individual spkgs.



---

archive/issue_comments_100858.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nA completely different issue: since there isn't really an upstream for this spkg, I think it would make a lot of sense to put the whole `src/` directory under revision control.  I believe this has been done also for `genus2reduction` which doesn't have an upstream either.",
    "created_at": "2011-02-03T14:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100858",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

A completely different issue: since there isn't really an upstream for this spkg, I think it would make a lot of sense to put the whole `src/` directory under revision control.  I believe this has been done also for `genus2reduction` which doesn't have an upstream either.



---

archive/issue_comments_100859.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nSorry Dave, I spoke too soon.  Reading the source I do indeed see\n\n```\n  switch (prog) {\n  case WRAPPED_GCC:        cmd = path(GCC_PATH_PREFIX)/\"gcc\";  break;\n  case WRAPPED_CC:         cmd = path(GCC_PATH_PREFIX)/\"gcc\";  break;\n  case WRAPPED_C99:        cmd = path(GCC_PATH_PREFIX)/\"c99\";  break;\n  case WRAPPED_C89:        cmd = path(GCC_PATH_PREFIX)/\"c89\";  break;\n  case WRAPPED_CPLUSPLUS:  cmd = path(GCC_PATH_PREFIX)/\"c++\";  break;\n  case WRAPPED_GPLUSPLUS:  cmd = path(GCC_PATH_PREFIX)/\"g++\";  break;\n  case WRAPPED_LD:         cmd = path(LD_PATH_PREFIX)/\"ld\";    break;\n  case WRAPPED_WRAPPER:\n  default:\n    assert(false); return;\n  }\n```\nwith a hardcoded `gcc` in there.\n\nI would use the autoconf-detected binaries for the compiler/linker there.  But the idea of this ticket certainly gets a +1 from me.",
    "created_at": "2011-02-03T14:29:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100859",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Sorry Dave, I spoke too soon.  Reading the source I do indeed see

```
  switch (prog) {
  case WRAPPED_GCC:        cmd = path(GCC_PATH_PREFIX)/"gcc";  break;
  case WRAPPED_CC:         cmd = path(GCC_PATH_PREFIX)/"gcc";  break;
  case WRAPPED_C99:        cmd = path(GCC_PATH_PREFIX)/"c99";  break;
  case WRAPPED_C89:        cmd = path(GCC_PATH_PREFIX)/"c89";  break;
  case WRAPPED_CPLUSPLUS:  cmd = path(GCC_PATH_PREFIX)/"c++";  break;
  case WRAPPED_GPLUSPLUS:  cmd = path(GCC_PATH_PREFIX)/"g++";  break;
  case WRAPPED_LD:         cmd = path(LD_PATH_PREFIX)/"ld";    break;
  case WRAPPED_WRAPPER:
  default:
    assert(false); return;
  }
```
with a hardcoded `gcc` in there.

I would use the autoconf-detected binaries for the compiler/linker there.  But the idea of this ticket certainly gets a +1 from me.



---

archive/issue_comments_100860.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nYou can simply not use the wrapper if you have any other compiler, and rpath/runpaths will remain broken as they are right now. In particular, any distribution that wants to include Sage would just use their own compiler without wrapper and install libraries in the library search path. And upgrade their compiler if it dies while compiling pari :-)\n\nI wrote autoconf macros to detect the linker used (Gnu/Sun/OSX), so it should work with either linker. Anything else is a bug that I'll be happy to fix.\n\nIn principle, other compilers could be supported by their own compiler wrapper. Since we currently can't use any other compiler, I haven't written any other wrapper. If the compiler/linker provides another way to set the rpath, then we don't need any wrapper of course.\n\nAnother possibility is to write a translator from the gcc compiler switches to some 3rd party compiler, and then use that other compiler without Sage knowing about it. I haven't tried this, but it might be easier than fixing all spkgs on rare hardware.\n\nThe point of translating cc->gcc is that this symlink was missing on one of the itanium machines on skynet (iras). I fixed that bug and checked that no other component of Sage tries to call cc. While thats clearly a broken gcc install, it arguably doesn't hurt to override it in the wrapper if you know that you are using gcc. Though you make a good case for not overriding cc at all, since it might be the Solaris compiler. One question is whether we can rely on the names of the compiler executables to be all different, or whether there are conflicts. I know that gcc and icc don't clash, but Solaris' cc is bound to be the same name as some other compiler?",
    "created_at": "2011-02-03T14:56:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100860",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

You can simply not use the wrapper if you have any other compiler, and rpath/runpaths will remain broken as they are right now. In particular, any distribution that wants to include Sage would just use their own compiler without wrapper and install libraries in the library search path. And upgrade their compiler if it dies while compiling pari :-)

I wrote autoconf macros to detect the linker used (Gnu/Sun/OSX), so it should work with either linker. Anything else is a bug that I'll be happy to fix.

In principle, other compilers could be supported by their own compiler wrapper. Since we currently can't use any other compiler, I haven't written any other wrapper. If the compiler/linker provides another way to set the rpath, then we don't need any wrapper of course.

Another possibility is to write a translator from the gcc compiler switches to some 3rd party compiler, and then use that other compiler without Sage knowing about it. I haven't tried this, but it might be easier than fixing all spkgs on rare hardware.

The point of translating cc->gcc is that this symlink was missing on one of the itanium machines on skynet (iras). I fixed that bug and checked that no other component of Sage tries to call cc. While thats clearly a broken gcc install, it arguably doesn't hurt to override it in the wrapper if you know that you are using gcc. Though you make a good case for not overriding cc at all, since it might be the Solaris compiler. One question is whether we can rely on the names of the compiler executables to be all different, or whether there are conflicts. I know that gcc and icc don't clash, but Solaris' cc is bound to be the same name as some other compiler?



---

archive/issue_comments_100861.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThere's a fair amount of Sage which will build with the Sun compiler, and I hope to increase that, so please don't do anything that will screw up if cc is not gcc. \n\nNote there are two shell scripts $SAGE_LOCAL/bin/testcc.sh and $SAGE_LOCAL/bin/testcxx.sh which actually check what the compilers are, and does this withougt making assumptions based on their name. They compile a simple program (written inline) which checks what preprocessor variables are defined. \n\nI certainly would not assume a failure to link cc to gcc was a bug on any machine. \n\nWith my fathers funeral in a few days, I'm not really in the mode for detailed analysis of this, but my initial feelings are I would leave well alone. \n\nDave",
    "created_at": "2011-02-03T15:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100861",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:20" align="right">comment:20</div>

There's a fair amount of Sage which will build with the Sun compiler, and I hope to increase that, so please don't do anything that will screw up if cc is not gcc. 

Note there are two shell scripts $SAGE_LOCAL/bin/testcc.sh and $SAGE_LOCAL/bin/testcxx.sh which actually check what the compilers are, and does this withougt making assumptions based on their name. They compile a simple program (written inline) which checks what preprocessor variables are defined. 

I certainly would not assume a failure to link cc to gcc was a bug on any machine. 

With my fathers funeral in a few days, I'm not really in the mode for detailed analysis of this, but my initial feelings are I would leave well alone. 

Dave



---

archive/issue_comments_100862.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nVolker: what do you think of my suggestion, to use the autoconf-detected C/C++ compiler instead of a hardcoded `gcc`?  The idea of having hardcoded compiler names gets -1 from me.",
    "created_at": "2011-02-03T15:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100862",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Volker: what do you think of my suggestion, to use the autoconf-detected C/C++ compiler instead of a hardcoded `gcc`?  The idea of having hardcoded compiler names gets -1 from me.



---

archive/issue_comments_100863.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI've renamed it to \"compilerwrapper\" to be more inclusive. Now it only installs the symlinks / translates options if the wrapper was built with gcc (and hence wraps gcc). If we ever add support for another compiler, it would then simply install its own (different) set of symlinks. I built the compilerwrapper spkg on mark/skynet with Sun Studio by setting CC=cc and CXX=CC and it works as expected (i.e. wraps nothing).",
    "created_at": "2011-02-03T18:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100863",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:22" align="right">comment:22</div>

I've renamed it to "compilerwrapper" to be more inclusive. Now it only installs the symlinks / translates options if the wrapper was built with gcc (and hence wraps gcc). If we ever add support for another compiler, it would then simply install its own (different) set of symlinks. I built the compilerwrapper spkg on mark/skynet with Sun Studio by setting CC=cc and CXX=CC and it works as expected (i.e. wraps nothing).



---

archive/issue_events_139228.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-03T18:28:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139228"
}
```



---

archive/issue_events_139229.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-03T18:28:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139229"
}
```



---

archive/issue_comments_100864.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,11 @@\n-This ticket aims to implement a gcc wrapper that will suitably modify gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at:\n+This ticket aims to implement a compiler wrapper that will suitably modify gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at:\n \n-https://bitbucket.org/vbraun/gcc-wrapper\n+https://bitbucket.org/vbraun/compilerwrapper\n \n and a spkg is here:\n \n-http://www.stp.dias.ie/~vbraun/Sage/spkg/gccwrapper-1.0.spkg\n+http://www.stp.dias.ie/~vbraun/Sage/spkg/compilerwrapper-1.0.spkg\n \n-Documentation is at \n-\n-http://www.stp.dias.ie/~vbraun/Sage/gccwrapper/gccwrapper.html\n-\n-The wrapper is implemented in pure C++ and does not depend on any Sage component.\n+The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.\n \n \n``````\n",
    "created_at": "2011-02-03T18:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100864",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,11 @@
-This ticket aims to implement a gcc wrapper that will suitably modify gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at:
+This ticket aims to implement a compiler wrapper that will suitably modify gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at:
 
-https://bitbucket.org/vbraun/gcc-wrapper
+https://bitbucket.org/vbraun/compilerwrapper
 
 and a spkg is here:
 
-http://www.stp.dias.ie/~vbraun/Sage/spkg/gccwrapper-1.0.spkg
+http://www.stp.dias.ie/~vbraun/Sage/spkg/compilerwrapper-1.0.spkg
 
-Documentation is at 
-
-http://www.stp.dias.ie/~vbraun/Sage/gccwrapper/gccwrapper.html
-
-The wrapper is implemented in pure C++ and does not depend on any Sage component.
+The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.
 
 
``````




---

archive/issue_comments_100865.json:
```json
{
    "body": "Changed keywords from **gcc wrapper rpath gccwrapper spkg** to **compiler gcc wrapper rpath spkg**",
    "created_at": "2011-02-03T18:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100865",
    "user": "https://github.com/vbraun"
}
```

Changed keywords from **gcc wrapper rpath gccwrapper spkg** to **compiler gcc wrapper rpath spkg**



---

archive/issue_events_139230.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-03T18:28:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "title_is": "compiler/binutils wrapper",
    "title_was": "gcc/binutils wrapper",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139230"
}
```



---

archive/issue_events_139231.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-03T18:28:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139231"
}
```



---

archive/issue_events_139232.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-03T18:28:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139232"
}
```



---

archive/issue_comments_100866.json:
```json
{
    "body": "Attachment: **[trac_10572_gccwrapper_root.patch.gz](https://github.com/sagemath/sage/files/ticket10572/trac_10572_gccwrapper_root.patch.gz)**\n\nPatch to SAGE_ROOT repo (use only this patch)",
    "created_at": "2011-05-29T00:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100866",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_10572_gccwrapper_root.patch.gz](https://github.com/sagemath/sage/files/ticket10572/trac_10572_gccwrapper_root.patch.gz)**

Patch to SAGE_ROOT repo (use only this patch)



---

archive/issue_comments_100867.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,8 +4,8 @@\n \n and a spkg is here:\n \n-http://www.stp.dias.ie/~vbraun/Sage/spkg/compilerwrapper-1.0.spkg\n+http://www.stp.dias.ie/~vbraun/Sage/spkg/compilerwrapper-1.1.spkg\n \n The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.\n \n-\n+Apply trac_10572_gccwrapper_root.patch to the sage root repository.\n``````\n",
    "created_at": "2011-05-29T00:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100867",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,8 +4,8 @@
 
 and a spkg is here:
 
-http://www.stp.dias.ie/~vbraun/Sage/spkg/compilerwrapper-1.0.spkg
+http://www.stp.dias.ie/~vbraun/Sage/spkg/compilerwrapper-1.1.spkg
 
 The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.
 
-
+Apply trac_10572_gccwrapper_root.patch to the sage root repository.
``````




---

archive/issue_comments_100868.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI have to say I am very supportive of the idea of using rpath. Shouldn't we also have a patch to sage_scripts to eliminate (or reduce if not possible to completely eliminate) LD_LIBRARY_PATH in sage-env? After all, that's the goal here.",
    "created_at": "2011-05-29T02:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100868",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:24" align="right">comment:24</div>

I have to say I am very supportive of the idea of using rpath. Shouldn't we also have a patch to sage_scripts to eliminate (or reduce if not possible to completely eliminate) LD_LIBRARY_PATH in sage-env? After all, that's the goal here.



---

archive/issue_comments_100869.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI'm still trying to solve one issue with the rpaths. The problem is that Sage does not distinguish build preparation (configure) from the actual build. If we set relative rpaths, then configure requires LD_LIBRARY_PATH set because the configure scripts will build and execute binaries in random directories in order to test prerequisites. If we had separate prepare/build phases, then we could run configure with absolute rpaths and then switch to relative rpaths for the final build.\n\nThe problem with LD_LIBRARY_PATH is, of course, that sometimes it screws up parts of the toolchain. We had that with GMP/MPIR before, and now PPL.",
    "created_at": "2011-05-29T03:05:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100869",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

I'm still trying to solve one issue with the rpaths. The problem is that Sage does not distinguish build preparation (configure) from the actual build. If we set relative rpaths, then configure requires LD_LIBRARY_PATH set because the configure scripts will build and execute binaries in random directories in order to test prerequisites. If we had separate prepare/build phases, then we could run configure with absolute rpaths and then switch to relative rpaths for the final build.

The problem with LD_LIBRARY_PATH is, of course, that sometimes it screws up parts of the toolchain. We had that with GMP/MPIR before, and now PPL.



---

archive/issue_comments_100870.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAnd someone had a problem building doc the other day because system gd was masked by sage's gd. There was a problem with building ecl which was fixed as a colateral of another problem. The list will only grow.",
    "created_at": "2011-05-29T03:52:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100870",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:26" align="right">comment:26</div>

And someone had a problem building doc the other day because system gd was masked by sage's gd. There was a problem with building ecl which was fixed as a colateral of another problem. The list will only grow.



---

archive/issue_comments_100871.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@vbraun](#comment:25):\n> The problem with LD_LIBRARY_PATH is, of course, that sometimes it screws up parts of the toolchain. We had that with GMP/MPIR before, and now PPL.\n\nSimple solution: Rename Sage's libraries, or put critical ones (like GMP, MPFR, MPC, PPL etc., also readline on some systems) into a different directory.",
    "created_at": "2011-08-27T14:15:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100871",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@vbraun](#comment:25):
> The problem with LD_LIBRARY_PATH is, of course, that sometimes it screws up parts of the toolchain. We had that with GMP/MPIR before, and now PPL.

Simple solution: Rename Sage's libraries, or put critical ones (like GMP, MPFR, MPC, PPL etc., also readline on some systems) into a different directory.



---

archive/issue_comments_100872.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nLeif, while you are at it rewriting all spkg's to work with the renamed libraries, could you also convert the custom hacked build scripts to autotools? ;-)",
    "created_at": "2011-08-27T17:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100872",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:29" align="right">comment:29</div>

Leif, while you are at it rewriting all spkg's to work with the renamed libraries, could you also convert the custom hacked build scripts to autotools? ;-)



---

archive/issue_comments_100873.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI believe https://github.com/sagemath/sage/issues/11391 is related to this issue.\nHas there been any progress on this issue? because currently sage 4.8 is unable to compile on my system due to ticket #11391.",
    "created_at": "2012-01-21T16:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100873",
    "user": "https://github.com/sagetrac-gostrc"
}
```

<div id="comment:30" align="right">comment:30</div>

I believe https://github.com/sagemath/sage/issues/11391 is related to this issue.
Has there been any progress on this issue? because currently sage 4.8 is unable to compile on my system due to ticket #11391.



---

archive/issue_comments_100874.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,8 +4,8 @@\n \n and a spkg is here:\n \n-http://www.stp.dias.ie/~vbraun/Sage/spkg/compilerwrapper-1.1.spkg\n+http://boxen.math.washington.edu/home/vbraun/spkg/compilerwrapper-1.2.spkg\n \n The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.\n \n-Apply trac_10572_gccwrapper_root.patch to the sage root repository.\n+Apply trac_10572_compilerwrapper_root.patch to the sage root repository.\n``````\n",
    "created_at": "2013-06-04T15:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100874",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,8 +4,8 @@
 
 and a spkg is here:
 
-http://www.stp.dias.ie/~vbraun/Sage/spkg/compilerwrapper-1.1.spkg
+http://boxen.math.washington.edu/home/vbraun/spkg/compilerwrapper-1.2.spkg
 
 The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.
 
-Apply trac_10572_gccwrapper_root.patch to the sage root repository.
+Apply trac_10572_compilerwrapper_root.patch to the sage root repository.
``````




---

archive/issue_comments_100875.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-06-04T15:52:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100875",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_100876.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nAttachment: **[trac_10572_compilerwrapper_root.patch.gz](https://github.com/sagemath/sage/files/ticket10572/trac_10572_compilerwrapper_root.patch.gz)**\n\nOk, maybe a new attempt is in order.\n\nI'll try to be more gradual. For now, keep `LD_LIBRARY_PATH` but use the compilerwrapper to rewrite rpaths. I added the feature to overwrite `LD_LIBRARY_PATH` with `SAGE_OLD_LD_LIBRARY_PATH` before calling gcc/ld, so at least the nasty library version clashes in the compiler are avoided.\n\nWe need to figure out what to do if sage builds its own gcc since only one gcc can live in `$SAGE_LOCAL/bin`. I would be in favor of compiling our own gcc with some pre/postfix as `$SAGE_LOCAL/bin/gcc-sage`. The compilerwrapper can then easily switch between this gcc and the host one, if desired. Thoughts?",
    "created_at": "2013-06-04T16:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100876",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:32" align="right">comment:32</div>

Attachment: **[trac_10572_compilerwrapper_root.patch.gz](https://github.com/sagemath/sage/files/ticket10572/trac_10572_compilerwrapper_root.patch.gz)**

Ok, maybe a new attempt is in order.

I'll try to be more gradual. For now, keep `LD_LIBRARY_PATH` but use the compilerwrapper to rewrite rpaths. I added the feature to overwrite `LD_LIBRARY_PATH` with `SAGE_OLD_LD_LIBRARY_PATH` before calling gcc/ld, so at least the nasty library version clashes in the compiler are avoided.

We need to figure out what to do if sage builds its own gcc since only one gcc can live in `$SAGE_LOCAL/bin`. I would be in favor of compiling our own gcc with some pre/postfix as `$SAGE_LOCAL/bin/gcc-sage`. The compilerwrapper can then easily switch between this gcc and the host one, if desired. Thoughts?



---

archive/issue_comments_100877.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nFirst, change the component to \"optional packages\"?\n\nJean-Pierre might have something to say as well, since it seems on Cygwin64 clashes of (system's) GCC's DLLs with Sage's (in `$SAGE_LOCAL/bin/` !) get more frequent (so I suggested to him to create wrapper scripts analogous to `sage-native-execute`, but also setting up / using \"`SAGE_ORIG_PATH`\", not just `*LIBRARY_PATH`).\n\n(And Cygwin doesn't support `RPATH` at all, does it?)",
    "created_at": "2013-06-04T16:26:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100877",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:33" align="right">comment:33</div>

First, change the component to "optional packages"?

Jean-Pierre might have something to say as well, since it seems on Cygwin64 clashes of (system's) GCC's DLLs with Sage's (in `$SAGE_LOCAL/bin/` !) get more frequent (so I suggested to him to create wrapper scripts analogous to `sage-native-execute`, but also setting up / using "`SAGE_ORIG_PATH`", not just `*LIBRARY_PATH`).

(And Cygwin doesn't support `RPATH` at all, does it?)



---

archive/issue_comments_100878.json:
```json
{
    "body": "Replying to [ticket:10572 vbraun]:\n> The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.\n\nThe main problem I see is that this requires a working C++ compiler even if we (just) want to bootstrap Sage's GCC (although GCC 4.8 and later require a C++ compiler to build anyway).",
    "created_at": "2013-06-04T16:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100878",
    "user": "https://github.com/nexttime"
}
```

Replying to [ticket:10572 vbraun]:
> The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.

The main problem I see is that this requires a working C++ compiler even if we (just) want to bootstrap Sage's GCC (although GCC 4.8 and later require a C++ compiler to build anyway).



---

archive/issue_comments_100879.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI don't think we'll ever bootstrap sage without a half-way working C++ compiler. As you said, gcc is now written in C++. At least the compilerwrapper doesn't need any optimizations, so even moderately broken compilers should be fine.\n\nApparently Cygwin inherits the DLL hell from Windows. Not sure what we can do about it except building our own cygwin base distro.",
    "created_at": "2013-06-04T17:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100879",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:35" align="right">comment:35</div>

I don't think we'll ever bootstrap sage without a half-way working C++ compiler. As you said, gcc is now written in C++. At least the compilerwrapper doesn't need any optimizations, so even moderately broken compilers should be fine.

Apparently Cygwin inherits the DLL hell from Windows. Not sure what we can do about it except building our own cygwin base distro.



---

archive/issue_comments_100880.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nOn second thought, it seems that PATH equals LD_LIBRARY_PATH on Cygwin. So we could just strip out Sage from `$PATH` before calling gcc. Would that suffice?",
    "created_at": "2013-06-04T17:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100880",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:36" align="right">comment:36</div>

On second thought, it seems that PATH equals LD_LIBRARY_PATH on Cygwin. So we could just strip out Sage from `$PATH` before calling gcc. Would that suffice?



---

archive/issue_comments_100881.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n`SPKG.txt` needs to get updated... ;-)\n\nIMHO also the ticket's description;  there are at least two rather orthogonal problems the compiler wrapper is supposed to fix:\n\n1. Clashes between system and Sage's libraries.\n\n2. Relocation issues, i.e., \"dead\" (hard-coded) `RPATH`s in binaries (shared libraries and executables) created by Sage, upon moving the installation (which includes installing a pre-built / binary distribution).\n\n3. (Even more unrelated to both of the above:)  Broken compiler versions / tool chains;  work around by messing with (e.g.) optimization flags, depending on the present compiler and its known issues.",
    "created_at": "2013-06-04T17:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100881",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:37" align="right">comment:37</div>

`SPKG.txt` needs to get updated... ;-)

IMHO also the ticket's description;  there are at least two rather orthogonal problems the compiler wrapper is supposed to fix:

1. Clashes between system and Sage's libraries.

2. Relocation issues, i.e., "dead" (hard-coded) `RPATH`s in binaries (shared libraries and executables) created by Sage, upon moving the installation (which includes installing a pre-built / binary distribution).

3. (Even more unrelated to both of the above:)  Broken compiler versions / tool chains;  work around by messing with (e.g.) optimization flags, depending on the present compiler and its known issues.



---

archive/issue_comments_100882.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,13 @@\n-This ticket aims to implement a compiler wrapper that will suitably modify gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at:\n+This ticket implements a wrapper for the compiler that lets us rewrite compiler options on the fly. The goal is to fix:\n \n-https://bitbucket.org/vbraun/compilerwrapper\n-\n-and a spkg is here:\n-\n-http://boxen.math.washington.edu/home/vbraun/spkg/compilerwrapper-1.2.spkg\n+1. Clashes between system and Sage's libraries due to LD_LIBRARY_PATH abuse.\n+2. Relocation issues, i.e., \"dead\" (hard-coded) RPATHs in binaries (shared libraries and executables) created by Sage, upon moving the installation (which includes installing a pre-built / binary distribution).\n+3. Broken compiler versions / tool chains; work around by messing with (e.g.) optimization flags, depending on the present compiler and its known issues.\n \n The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.\n \n+Code repository https://bitbucket.org/vbraun/compilerwrapper\n+\n+spkg is here: http://boxen.math.washington.edu/home/vbraun/spkg/compilerwrapper-1.2.spkg\n+\n Apply trac_10572_compilerwrapper_root.patch to the sage root repository.\n``````\n",
    "created_at": "2013-06-04T18:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100882",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,13 @@
-This ticket aims to implement a compiler wrapper that will suitably modify gcc/ld/... arguments before passing them on to the underlying compiler binaries. The most current version is at:
+This ticket implements a wrapper for the compiler that lets us rewrite compiler options on the fly. The goal is to fix:
 
-https://bitbucket.org/vbraun/compilerwrapper
-
-and a spkg is here:
-
-http://boxen.math.washington.edu/home/vbraun/spkg/compilerwrapper-1.2.spkg
+1. Clashes between system and Sage's libraries due to LD_LIBRARY_PATH abuse.
+2. Relocation issues, i.e., "dead" (hard-coded) RPATHs in binaries (shared libraries and executables) created by Sage, upon moving the installation (which includes installing a pre-built / binary distribution).
+3. Broken compiler versions / tool chains; work around by messing with (e.g.) optimization flags, depending on the present compiler and its known issues.
 
 The wrapper is implemented in pure C++ and does not depend on any Sage component. At the moment it only wraps gcc and does not do anything for other compilers.
 
+Code repository https://bitbucket.org/vbraun/compilerwrapper
+
+spkg is here: http://boxen.math.washington.edu/home/vbraun/spkg/compilerwrapper-1.2.spkg
+
 Apply trac_10572_compilerwrapper_root.patch to the sage root repository.
``````




---

archive/issue_comments_100883.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nLeif: I don't think there is any point in making this an optional spkg. If the wrapper not installed before you compile the first dynamically-linked binary then it is useless.\n\nUpdated the description.",
    "created_at": "2013-06-04T18:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100883",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:38" align="right">comment:38</div>

Leif: I don't think there is any point in making this an optional spkg. If the wrapper not installed before you compile the first dynamically-linked binary then it is useless.

Updated the description.



---

archive/issue_comments_100884.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@vbraun](#comment:36):\n> On second thought, it seems that PATH equals LD_LIBRARY_PATH on Cygwin. So we could just strip out Sage from `$PATH` before calling gcc. Would that suffice?\n\nOn Cygwin both have some use...\nBut mostly PATH is used in place of LD_LIBRARY_PATH indeed.",
    "created_at": "2013-06-08T16:35:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100884",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@vbraun](#comment:36):
> On second thought, it seems that PATH equals LD_LIBRARY_PATH on Cygwin. So we could just strip out Sage from `$PATH` before calling gcc. Would that suffice?

On Cygwin both have some use...
But mostly PATH is used in place of LD_LIBRARY_PATH indeed.



---

archive/issue_comments_100885.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nIt would surely be nice to have some variable to trigger the installation of this (hopefully standard) package, just like we do for Sage's GCC, and another one to trigger its actual use (if installed).\nI would be quite happy to still be able to mess with my compilers and not to have something getting in the way.",
    "created_at": "2013-06-08T16:45:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100885",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:40" align="right">comment:40</div>

It would surely be nice to have some variable to trigger the installation of this (hopefully standard) package, just like we do for Sage's GCC, and another one to trigger its actual use (if installed).
I would be quite happy to still be able to mess with my compilers and not to have something getting in the way.



---

archive/issue_comments_100886.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@jpflori](#comment:39):\n> Replying to [@vbraun](#comment:36):\n> > On second thought, it seems that PATH equals LD_LIBRARY_PATH on Cygwin. So we could just strip out Sage from `$PATH` before calling gcc. Would that suffice?\n\n> On Cygwin both have some use...\n> But mostly PATH is used in place of LD_LIBRARY_PATH indeed.\n\n(and for the usual usage of PATH on Linux of course.)",
    "created_at": "2013-06-08T16:47:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100886",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@jpflori](#comment:39):
> Replying to [@vbraun](#comment:36):
> > On second thought, it seems that PATH equals LD_LIBRARY_PATH on Cygwin. So we could just strip out Sage from `$PATH` before calling gcc. Would that suffice?

> On Cygwin both have some use...
> But mostly PATH is used in place of LD_LIBRARY_PATH indeed.

(and for the usual usage of PATH on Linux of course.)



---

archive/issue_comments_100887.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nOnce you have it installed you can user `wrapper on` / `wrapper off` to enable/disable it.",
    "created_at": "2013-06-08T16:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100887",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:42" align="right">comment:42</div>

Once you have it installed you can user `wrapper on` / `wrapper off` to enable/disable it.



---

archive/issue_comments_100888.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nApparently Cygwin uses LD_LIBRARY_PATH for dlopen() at runtime but **not** for loading shared libraries when the program starts. So its pretty much useless for us, right?",
    "created_at": "2013-06-08T16:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100888",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:43" align="right">comment:43</div>

Apparently Cygwin uses LD_LIBRARY_PATH for dlopen() at runtime but **not** for loading shared libraries when the program starts. So its pretty much useless for us, right?



---

archive/issue_comments_100889.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI had problems with that once because LD_LIBRARY_PATH was not set on Cygwin.\nI think it was when building or using the Python's ctypes module, see #14380.",
    "created_at": "2013-06-08T17:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100889",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:44" align="right">comment:44</div>

I had problems with that once because LD_LIBRARY_PATH was not set on Cygwin.
I think it was when building or using the Python's ctypes module, see #14380.



---

archive/issue_comments_100890.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@vbraun](#comment:42):\n> Once you have it installed you can user `wrapper on` / `wrapper off` to enable/disable it.\n\nThat's not very practical for example to prevent its use after typing \"make\"",
    "created_at": "2013-06-08T18:25:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100890",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@vbraun](#comment:42):
> Once you have it installed you can user `wrapper on` / `wrapper off` to enable/disable it.

That's not very practical for example to prevent its use after typing "make"



---

archive/issue_comments_100891.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nHow about if `SAGE_INSTALL_GCC=no` then don't install the wrapper, otherwise do install it. In particular, unset => install compiler wrapper by default, and gcc only if host gcc is too broken.",
    "created_at": "2013-06-08T18:40:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100891",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:46" align="right">comment:46</div>

How about if `SAGE_INSTALL_GCC=no` then don't install the wrapper, otherwise do install it. In particular, unset => install compiler wrapper by default, and gcc only if host gcc is too broken.



---

archive/issue_comments_100892.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nThat could do the trick though I would prefer to have dedicated options like SAGE_INSTALL_WRAPPER and SAGE_USE_WRAPPER both on by default andindependent of SAGE_INSTALL_GCC.",
    "created_at": "2013-06-08T18:47:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100892",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:47" align="right">comment:47</div>

That could do the trick though I would prefer to have dedicated options like SAGE_INSTALL_WRAPPER and SAGE_USE_WRAPPER both on by default andindependent of SAGE_INSTALL_GCC.



---

archive/issue_comments_100893.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nThats what I'm precisely trying to avoid, having millions of environment variables to configure everything under the sun is just crazyness. Its hard enough to remember whether its `SAGE_INSTALL_GCC` or `SAGE_GCC_INSTALL`. Also, whats the use case of installing gcc but not the wrapper, then we need further logic to prefix gcc if there is a wrapper and not prefix gcc if there is no wrapper. Which just means that it won't always work since nobody will test all combinations.",
    "created_at": "2013-06-08T19:05:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100893",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:48" align="right">comment:48</div>

Thats what I'm precisely trying to avoid, having millions of environment variables to configure everything under the sun is just crazyness. Its hard enough to remember whether its `SAGE_INSTALL_GCC` or `SAGE_GCC_INSTALL`. Also, whats the use case of installing gcc but not the wrapper, then we need further logic to prefix gcc if there is a wrapper and not prefix gcc if there is no wrapper. Which just means that it won't always work since nobody will test all combinations.



---

archive/issue_comments_100894.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nIt's nice to be able to test some crazy combination and having the possibility to do so by setting one or two envvars rather than hacking into the code.\n\nAnd SAGE_INSTALL_GCC will not treflect what it does anymore.\n\nFor the prefixed gcc issue, just prefix it all the time and if there is no wrapper installed then create symlinks.",
    "created_at": "2013-06-08T19:12:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100894",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:49" align="right">comment:49</div>

It's nice to be able to test some crazy combination and having the possibility to do so by setting one or two envvars rather than hacking into the code.

And SAGE_INSTALL_GCC will not treflect what it does anymore.

For the prefixed gcc issue, just prefix it all the time and if there is no wrapper installed then create symlinks.



---

archive/issue_comments_100895.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@jpflori](#comment:49):\n> It's nice to be able to test some crazy combination and having the possibility to do so by setting one or two envvars rather than hacking into the code.\n\nI disagree, its a drain on the development process to try to support nonsensical combinations without any benefit. Some user will fall into the spike-filled traps and then complain (rightfully) why some combination of envionment variables causes everything to crash and burn.\n \n> And SAGE_INSTALL_GCC will not treflect what it does anymore.\n\nWe should have called it `SAGE_INSTALL_GCC`. The compilerwrapper was also originally called gccwrapper until somebody on this ticket pointed out the stupidity of it.\n\n> For the prefixed gcc issue, just prefix it all the time and if there is no wrapper installed then create symlinks.\n\nThen, later, you install the compilerwrapper. Even later you disable the wrapper. Bang, your compiler is now gone. I'm sure this will be a crowd-pleaser.",
    "created_at": "2013-06-08T19:39:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100895",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@jpflori](#comment:49):
> It's nice to be able to test some crazy combination and having the possibility to do so by setting one or two envvars rather than hacking into the code.

I disagree, its a drain on the development process to try to support nonsensical combinations without any benefit. Some user will fall into the spike-filled traps and then complain (rightfully) why some combination of envionment variables causes everything to crash and burn.
 
> And SAGE_INSTALL_GCC will not treflect what it does anymore.

We should have called it `SAGE_INSTALL_GCC`. The compilerwrapper was also originally called gccwrapper until somebody on this ticket pointed out the stupidity of it.

> For the prefixed gcc issue, just prefix it all the time and if there is no wrapper installed then create symlinks.

Then, later, you install the compilerwrapper. Even later you disable the wrapper. Bang, your compiler is now gone. I'm sure this will be a crowd-pleaser.



---

archive/issue_comments_100896.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@vbraun](#comment:50):\n> Replying to [@jpflori](#comment:49):\n> > It's nice to be able to test some crazy combination and having the possibility to do so by setting one or two envvars rather than hacking into the code.\n\n> \n> I disagree, its a drain on the development process to try to support nonsensical combinations without any benefit. Some user will fall into the spike-filled traps and then complain (rightfully) why some combination of envionment variables causes everything to crash and burn.\n>  \n> > And SAGE_INSTALL_GCC will not treflect what it does anymore.\n\n> \n> We should have called it `SAGE_INSTALL_GCC`. The compilerwrapper was also originally called gccwrapper until somebody on this ticket pointed out the stupidity of it.\n> \n> > For the prefixed gcc issue, just prefix it all the time and if there is no wrapper installed then create symlinks.\n\n> \n> Then, later, you install the compilerwrapper. Even later you disable the wrapper. Bang, your compiler is now gone. I'm sure this will be a crowd-pleaser.\n\nIsn't that \"nonsensical\", cf. [comment:38]?",
    "created_at": "2013-06-08T19:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100896",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@vbraun](#comment:50):
> Replying to [@jpflori](#comment:49):
> > It's nice to be able to test some crazy combination and having the possibility to do so by setting one or two envvars rather than hacking into the code.

> 
> I disagree, its a drain on the development process to try to support nonsensical combinations without any benefit. Some user will fall into the spike-filled traps and then complain (rightfully) why some combination of envionment variables causes everything to crash and burn.
>  
> > And SAGE_INSTALL_GCC will not treflect what it does anymore.

> 
> We should have called it `SAGE_INSTALL_GCC`. The compilerwrapper was also originally called gccwrapper until somebody on this ticket pointed out the stupidity of it.
> 
> > For the prefixed gcc issue, just prefix it all the time and if there is no wrapper installed then create symlinks.

> 
> Then, later, you install the compilerwrapper. Even later you disable the wrapper. Bang, your compiler is now gone. I'm sure this will be a crowd-pleaser.

Isn't that "nonsensical", cf. [comment:38]?



---

archive/issue_comments_100897.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@vbraun](#comment:38):\n> If the wrapper not installed before you compile the first dynamically-linked binary then it is useless.\n\nIf / when GCC builds itself, it won't get used anyway (only during initial bootstrapping).",
    "created_at": "2013-06-08T20:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100897",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@vbraun](#comment:38):
> If the wrapper not installed before you compile the first dynamically-linked binary then it is useless.

If / when GCC builds itself, it won't get used anyway (only during initial bootstrapping).



---

archive/issue_comments_100898.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nWe certainly shouldn't use the same (and established) environment variable for different and unrelated purposes.",
    "created_at": "2013-06-08T20:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100898",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:53" align="right">comment:53</div>

We certainly shouldn't use the same (and established) environment variable for different and unrelated purposes.



---

archive/issue_comments_100899.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@vbraun](#comment:46):\n> How about if `SAGE_INSTALL_GCC=no` then don't install the wrapper, otherwise do install it. In particular, unset => install compiler wrapper by default, and gcc only if host gcc is too broken.\n\nOne use case of the compiler wrapper is to work around (system!) compiler bugs, so unconditionally not installing it if `SAGE_INSTALL_GCC=no` doesn't make much sense, at least if it's used to prevent installing Sage's GCC (which is the current and intended meaning).",
    "created_at": "2013-06-08T20:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100899",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@vbraun](#comment:46):
> How about if `SAGE_INSTALL_GCC=no` then don't install the wrapper, otherwise do install it. In particular, unset => install compiler wrapper by default, and gcc only if host gcc is too broken.

One use case of the compiler wrapper is to work around (system!) compiler bugs, so unconditionally not installing it if `SAGE_INSTALL_GCC=no` doesn't make much sense, at least if it's used to prevent installing Sage's GCC (which is the current and intended meaning).



---

archive/issue_comments_100900.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nIts true that gcc won't build itself with the wrapper, but then we build gcc right at the beginning before we build any troublesome libraries. And the first stage doesn't need optimizations, to even moderately broken compilers should be fine.\n\nWe definitely should think about using a special case from an already existing environment variable to avoid creating too many obscure configuration options that we can never actually test. JP wants a setting so that he can play with potentially broken compilers, and setting `SAGE_INSTALL_GCC=no` is what you logically would want to set in this use case.\n\nThe basic fact is that only one program can be installed as `$SAGE_LOCAL/bin/gcc` So you don't have 4 independent choices of sage-gcc yes/no and compilerwrapper yes/no.",
    "created_at": "2013-06-08T21:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100900",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:55" align="right">comment:55</div>

Its true that gcc won't build itself with the wrapper, but then we build gcc right at the beginning before we build any troublesome libraries. And the first stage doesn't need optimizations, to even moderately broken compilers should be fine.

We definitely should think about using a special case from an already existing environment variable to avoid creating too many obscure configuration options that we can never actually test. JP wants a setting so that he can play with potentially broken compilers, and setting `SAGE_INSTALL_GCC=no` is what you logically would want to set in this use case.

The basic fact is that only one program can be installed as `$SAGE_LOCAL/bin/gcc` So you don't have 4 independent choices of sage-gcc yes/no and compilerwrapper yes/no.



---

archive/issue_comments_100901.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@vbraun](#comment:55):\n> Its true that gcc won't build itself with the wrapper, but then we build gcc right at the beginning before we build any troublesome libraries. And the first stage doesn't need optimizations, to even moderately broken compilers should be fine.\n\nYou have to build the wrapper at the very beginning of the build process to be sure to avoid issues on Cygwin.\n> \n> We definitely should think about using a special case from an already existing environment variable to avoid creating too many obscure configuration options that we can never actually test. JP wants a setting so that he can play with potentially broken compilers, and setting `SAGE_INSTALL_GCC=no` is what you logically would want to set in this use case.\n> \n> The basic fact is that only one program can be installed as `$SAGE_LOCAL/bin/gcc` So you don't have 4 independent choices of sage-gcc yes/no and compilerwrapper yes/no.\n\n>",
    "created_at": "2013-06-08T21:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100901",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@vbraun](#comment:55):
> Its true that gcc won't build itself with the wrapper, but then we build gcc right at the beginning before we build any troublesome libraries. And the first stage doesn't need optimizations, to even moderately broken compilers should be fine.

You have to build the wrapper at the very beginning of the build process to be sure to avoid issues on Cygwin.
> 
> We definitely should think about using a special case from an already existing environment variable to avoid creating too many obscure configuration options that we can never actually test. JP wants a setting so that he can play with potentially broken compilers, and setting `SAGE_INSTALL_GCC=no` is what you logically would want to set in this use case.
> 
> The basic fact is that only one program can be installed as `$SAGE_LOCAL/bin/gcc` So you don't have 4 independent choices of sage-gcc yes/no and compilerwrapper yes/no.

>



---

archive/issue_comments_100902.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@jpflori](#comment:56):\n> You have to build the wrapper at the very beginning of the build process to be sure to avoid issues on Cygwin.\n\nAgreed. What I'm trying to say is: Despite the compiler wrapper being installed first, gcc will build itself internally without wrapper. But that is fine since gcc knows what it is doing (and we haven't thrown any bricks in its way yet via LD_LIBRARY_PATH)",
    "created_at": "2013-06-08T22:12:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100902",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@jpflori](#comment:56):
> You have to build the wrapper at the very beginning of the build process to be sure to avoid issues on Cygwin.

Agreed. What I'm trying to say is: Despite the compiler wrapper being installed first, gcc will build itself internally without wrapper. But that is fine since gcc knows what it is doing (and we haven't thrown any bricks in its way yet via LD_LIBRARY_PATH)



---

archive/issue_comments_100903.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nI've attached a patch to fix a little typo and take care of PATH as well, feel free to integrate it upstream.",
    "created_at": "2013-07-29T12:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100903",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:58" align="right">comment:58</div>

I've attached a patch to fix a little typo and take care of PATH as well, feel free to integrate it upstream.



---

archive/issue_comments_100904.json:
```json
{
    "body": "PATH",
    "created_at": "2013-07-29T12:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100904",
    "user": "https://github.com/jpflori"
}
```

PATH



---

archive/issue_comments_100905.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nAttachment: **[path.patch.gz](https://github.com/sagemath/sage/files/ticket10572/path.patch.gz)**\n\nDone, added to repo & spkg in the ticket.",
    "created_at": "2013-07-29T13:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100905",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:59" align="right">comment:59</div>

Attachment: **[path.patch.gz](https://github.com/sagemath/sage/files/ticket10572/path.patch.gz)**

Done, added to repo & spkg in the ticket.



---

archive/issue_comments_100906.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nThanks.\n\nIn fact we also need to patch the Sage repo to define SAGE_ORIG_PATH there IIRC.\nUnfortunately I don't have access to the disk where I developped this part right now.\nThe patch should be up later today.",
    "created_at": "2013-07-29T13:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100906",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:60" align="right">comment:60</div>

Thanks.

In fact we also need to patch the Sage repo to define SAGE_ORIG_PATH there IIRC.
Unfortunately I don't have access to the disk where I developped this part right now.
The patch should be up later today.



---

archive/issue_events_139233.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139233"
}
```



---

archive/issue_events_139234.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139234"
}
```



---

archive/issue_comments_100907.json:
```json
{
    "body": "Attachment: **[trac_10572-sage_orig_path.patch.gz](https://github.com/sagemath/sage/files/ticket10572/trac_10572-sage_orig_path.patch.gz)**\n\nCygwin path patch",
    "created_at": "2014-01-08T16:44:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100907",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_10572-sage_orig_path.patch.gz](https://github.com/sagemath/sage/files/ticket10572/trac_10572-sage_orig_path.patch.gz)**

Cygwin path patch



---

archive/issue_comments_100908.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nFinally added a needed patch for Cygwin which removes Sage stuff from PATH.",
    "created_at": "2014-01-08T16:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100908",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:62" align="right">comment:62</div>

Finally added a needed patch for Cygwin which removes Sage stuff from PATH.



---

archive/issue_events_139235.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139235"
}
```



---

archive/issue_events_139236.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139236"
}
```



---

archive/issue_comments_100909.json:
```json
{
    "body": "Changed author from **Volker Braun** to **Volker Braun, Jean-Pierre Flori**",
    "created_at": "2014-04-13T19:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100909",
    "user": "https://github.com/jpflori"
}
```

Changed author from **Volker Braun** to **Volker Braun, Jean-Pierre Flori**



---

archive/issue_comments_100910.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,6 +8,5 @@\n \n Code repository https://bitbucket.org/vbraun/compilerwrapper\n \n-spkg is here: http://boxen.math.washington.edu/home/vbraun/spkg/compilerwrapper-1.2.spkg\n-\n-Apply trac_10572_compilerwrapper_root.patch to the sage root repository.\n+Use tarball at:\n+* http://boxen.math.washington.edu/home/jpflori/upstream/compilerwrapper-1.2.tar.bz2\n``````\n",
    "created_at": "2014-04-13T19:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100910",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,6 +8,5 @@
 
 Code repository https://bitbucket.org/vbraun/compilerwrapper
 
-spkg is here: http://boxen.math.washington.edu/home/vbraun/spkg/compilerwrapper-1.2.spkg
-
-Apply trac_10572_compilerwrapper_root.patch to the sage root repository.
+Use tarball at:
+* http://boxen.math.washington.edu/home/jpflori/upstream/compilerwrapper-1.2.tar.bz2
``````




---

archive/issue_comments_100911.json:
```json
{
    "body": "Branch: **[u/jpflori/ticket/10572](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/10572)**",
    "created_at": "2014-04-13T19:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100911",
    "user": "https://github.com/jpflori"
}
```

Branch: **[u/jpflori/ticket/10572](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/10572)**



---

archive/issue_comments_100912.json:
```json
{
    "body": "Commit: **[`f9f826a`](https://github.com/sagemath/sagetrac-mirror/commit/f9f826ab1265d843db7d48f74dec831928ecdba8)**",
    "created_at": "2014-04-13T19:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100912",
    "user": "https://github.com/jpflori"
}
```

Commit: **[`f9f826a`](https://github.com/sagemath/sagetrac-mirror/commit/f9f826ab1265d843db7d48f74dec831928ecdba8)**



---

archive/issue_comments_100913.json:
```json
{
    "body": "Reviewer: **Jean-Pierre Flori**",
    "created_at": "2014-04-13T19:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100913",
    "user": "https://github.com/jpflori"
}
```

Reviewer: **Jean-Pierre Flori**



---

archive/issue_comments_100914.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nI've gitified the ticket without making it a standard package (basically, Volker's hg patch).\nI think should definitely make it optional at least.\n\nAnd I give positive review to what Volker done, except for maybe not making the package standard, at least now...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9f826ab1265d843db7d48f74dec831928ecdba8\">f9f826a</a></td><td><code>Gitify compiler/binutils wrapper.</code></td></tr></table>\n",
    "created_at": "2014-04-13T19:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100914",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:65" align="right">comment:65</div>

I've gitified the ticket without making it a standard package (basically, Volker's hg patch).
I think should definitely make it optional at least.

And I give positive review to what Volker done, except for maybe not making the package standard, at least now...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9f826ab1265d843db7d48f74dec831928ecdba8">f9f826a</a></td><td><code>Gitify compiler/binutils wrapper.</code></td></tr></table>




---

archive/issue_events_139237.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139237"
}
```



---

archive/issue_events_139238.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139238"
}
```



---

archive/issue_events_139239.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139239"
}
```



---

archive/issue_events_139240.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139240"
}
```



---

archive/issue_comments_100915.json:
```json
{
    "body": "Changed commit from **[`f9f826a`](https://github.com/sagemath/sagetrac-mirror/commit/f9f826ab1265d843db7d48f74dec831928ecdba8)** to **[`1df9ecd`](https://github.com/sagemath/sagetrac-mirror/commit/1df9ecd34079780609a95aa0b79168ed376d83da)**",
    "created_at": "2014-11-12T10:25:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100915",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f9f826a`](https://github.com/sagemath/sagetrac-mirror/commit/f9f826ab1265d843db7d48f74dec831928ecdba8)** to **[`1df9ecd`](https://github.com/sagemath/sagetrac-mirror/commit/1df9ecd34079780609a95aa0b79168ed376d83da)**



---

archive/issue_comments_100916.json:
```json
{
    "body": "<div id=\"comment:68\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95887868d4c8e7754450438cb43b3e7634c7b17c\">9588786</a></td><td><code>Merge remote-tracking branch 'trac/develop' into ticket/10572</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1df9ecd34079780609a95aa0b79168ed376d83da\">1df9ecd</a></td><td><code>Trivial scripts update for compilerwrapper.</code></td></tr></table>\n",
    "created_at": "2014-11-12T10:25:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100916",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:68"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95887868d4c8e7754450438cb43b3e7634c7b17c">9588786</a></td><td><code>Merge remote-tracking branch 'trac/develop' into ticket/10572</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1df9ecd34079780609a95aa0b79168ed376d83da">1df9ecd</a></td><td><code>Trivial scripts update for compilerwrapper.</code></td></tr></table>




---

archive/issue_comments_100917.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nVolker: Any thoughts on this ticket?\n\nI'll be tempted to positively review it as I've been using it quite often and would definitely need it if I use some of my time for the Cygwin's ports for the h2020 thing.",
    "created_at": "2014-11-12T10:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100917",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:69" align="right">comment:69</div>

Volker: Any thoughts on this ticket?

I'll be tempted to positively review it as I've been using it quite often and would definitely need it if I use some of my time for the Cygwin's ports for the h2020 thing.



---

archive/issue_events_139241.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2014-11-14T13:09:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139241"
}
```



---

archive/issue_events_139242.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2014-11-14T13:09:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139242"
}
```



---

archive/issue_comments_100918.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nThis still is useful for me and looks fine.\nlgtm",
    "created_at": "2014-11-14T13:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100918",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:70" align="right">comment:70</div>

This still is useful for me and looks fine.
lgtm



---

archive/issue_comments_100919.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nI think its good to have it as an optional/experimental package, let's see if it turns out to be useful.\n\nThe SPKG.txt is incorrect in that the upstream repo is git now, but that is trivial.\n\nI don't think its the final answer to our LD_LIBRARY_PATH / relocation woes, I'm working with the hashdist developers on a bullet-proof solution.",
    "created_at": "2014-11-14T13:20:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100919",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:71" align="right">comment:71</div>

I think its good to have it as an optional/experimental package, let's see if it turns out to be useful.

The SPKG.txt is incorrect in that the upstream repo is git now, but that is trivial.

I don't think its the final answer to our LD_LIBRARY_PATH / relocation woes, I'm working with the hashdist developers on a bullet-proof solution.



---

archive/issue_comments_100920.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [@vbraun](#comment:71):\n> I think its good to have it as an optional/experimental package, let's see if it turns out to be useful.\n> \n> The SPKG.txt is incorrect in that the upstream repo is git now, but that is trivial.\n> \n\nIs it? I actually had a look to check if you updated the code but did not even notice it was not bitbucket anymore... or just ended up on the old bitbucket repo, who knows.\n\n> I don't think its the final answer to our LD_LIBRARY_PATH / relocation woes, I'm working with the hashdist developers on a bullet-proof solution.\n\nSure, but at least it lets Sage build (quite) easily on platforms where PATH/LD_LIBRARY_PATH will always be a mess like Windows.",
    "created_at": "2014-11-14T13:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100920",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [@vbraun](#comment:71):
> I think its good to have it as an optional/experimental package, let's see if it turns out to be useful.
> 
> The SPKG.txt is incorrect in that the upstream repo is git now, but that is trivial.
> 

Is it? I actually had a look to check if you updated the code but did not even notice it was not bitbucket anymore... or just ended up on the old bitbucket repo, who knows.

> I don't think its the final answer to our LD_LIBRARY_PATH / relocation woes, I'm working with the hashdist developers on a bullet-proof solution.

Sure, but at least it lets Sage build (quite) easily on platforms where PATH/LD_LIBRARY_PATH will always be a mess like Windows.



---

archive/issue_comments_100921.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nIt is still on bitbucket, but bitbucket supports both hg and git nowadays...",
    "created_at": "2014-11-14T14:24:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100921",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:73" align="right">comment:73</div>

It is still on bitbucket, but bitbucket supports both hg and git nowadays...



---

archive/issue_events_139243.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-14T21:01:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139243"
}
```



---

archive/issue_events_139244.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "729ed2816596b9846f78c152b3846c9521ba8e80",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-11-14T21:01:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10572#event-139244"
}
```



---

archive/issue_comments_100922.json:
```json
{
    "body": "Changed branch from **[u/jpflori/ticket/10572](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/10572)** to **[`1df9ecd`](https://github.com/sagemath/sagetrac-mirror/commit/1df9ecd34079780609a95aa0b79168ed376d83da)**",
    "created_at": "2014-11-14T21:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10572#issuecomment-100922",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jpflori/ticket/10572](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/10572)** to **[`1df9ecd`](https://github.com/sagemath/sagetrac-mirror/commit/1df9ecd34079780609a95aa0b79168ed376d83da)**
