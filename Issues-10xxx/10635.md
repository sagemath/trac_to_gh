# Issue 10635: refactor polynomial_element.pyx factor function

archive/issues_010582.json:
```json
{
    "body": "The \"factor\" function in polynomial_element.pyx needs to be refactored, because it has to be modified every time a new interesting base ring gets added to Sage. \n\nInstead of importing a ton of different rings, the function should just call a method on the base ring, e.g., \n\n```\ndef _factor_univariate_polynomial(self, f):\n    ...\n```\nSince the code in factor is for generic polynomials, it doesn't use their internal representation, so this should be fine.   It just turns out that factoring algorithms depend a huge amount on the base ring, and polynomials get created over tons of different bases (but there are far less classes that derive from \"polynomial\"). \n\nI suggest for this ticket, at a minimum we add a quick \"hasattr\" check at the top of the current factor function, then leave the existing code.  Then new code can be written to use this.  In the near future somebody can move most of the imports and cases out the current factor function, so it becomes very short, and the code gets put in the right place. \n\nA major motivation for this is that people create their own new rings R in external code that depends on sage, and want to be able to factor polynomials over R.  They do *not* define a new class for polynomials over R.  It seems silly for them to have to patch the core sage library to get factorization functionality.\n\n---\n\nApply\n1. [attachment:trac_10635-new_version_with_tests.patch]\n2. [attachment:trac_10635-fix_doctest_error_due_to_noise.reviewer.patch]\nto the Sage library.\n\n\nAssignee: @aghitza\n\nKeywords: sd32\n\nResolution: fixed\n\nAuthor: Christopher Hall\n\nReviewer: Mariah Lenox, William Stein, Simon Spicer\n\nMerged: sage-4.7.2.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/10635\n\n",
    "closed_at": "2011-09-17T04:36:30Z",
    "created_at": "2011-01-16T20:21:10Z",
    "labels": [
        "component: basic arithmetic",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "refactor polynomial_element.pyx factor function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10635",
    "user": "https://github.com/williamstein"
}
```
The "factor" function in polynomial_element.pyx needs to be refactored, because it has to be modified every time a new interesting base ring gets added to Sage. 

Instead of importing a ton of different rings, the function should just call a method on the base ring, e.g., 

```
def _factor_univariate_polynomial(self, f):
    ...
```
Since the code in factor is for generic polynomials, it doesn't use their internal representation, so this should be fine.   It just turns out that factoring algorithms depend a huge amount on the base ring, and polynomials get created over tons of different bases (but there are far less classes that derive from "polynomial"). 

I suggest for this ticket, at a minimum we add a quick "hasattr" check at the top of the current factor function, then leave the existing code.  Then new code can be written to use this.  In the near future somebody can move most of the imports and cases out the current factor function, so it becomes very short, and the code gets put in the right place. 

A major motivation for this is that people create their own new rings R in external code that depends on sage, and want to be able to factor polynomials over R.  They do *not* define a new class for polynomials over R.  It seems silly for them to have to patch the core sage library to get factorization functionality.

---

Apply
1. [attachment:trac_10635-new_version_with_tests.patch]
2. [attachment:trac_10635-fix_doctest_error_due_to_noise.reviewer.patch]
to the Sage library.


Assignee: @aghitza

Keywords: sd32

Resolution: fixed

Author: Christopher Hall

Reviewer: Mariah Lenox, William Stein, Simon Spicer

Merged: sage-4.7.2.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/10635





---

archive/issue_comments_110463.json:
```json
{
    "body": "<a id='comment:1'></a>As someone interested in this change, let me chime in with a few suggestions of my own.\n\n(1) A similar refactoring should be done for roots().  It's true factor() can be used to find roots, but that's not necessarily the best approach.  This suggests the names ._univariate_polynomial_x for x=factor,roots,etc.\n\n(2) So-called 'modular' gcd algorithms give a real boost to rings where applicable, so it would be nice to let x=gcd in (1).\n\n(3) Consider whether options such as 'multiplicities=False' should really be options to .univariate_polynomial_factor() or whether they can be handled 'universally'.",
    "created_at": "2011-01-17T06:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110463",
    "user": "https://trac.sagemath.org/admin/accounts/users/cjh"
}
```

<a id='comment:1'></a>As someone interested in this change, let me chime in with a few suggestions of my own.

(1) A similar refactoring should be done for roots().  It's true factor() can be used to find roots, but that's not necessarily the best approach.  This suggests the names ._univariate_polynomial_x for x=factor,roots,etc.

(2) So-called 'modular' gcd algorithms give a real boost to rings where applicable, so it would be nice to let x=gcd in (1).

(3) Consider whether options such as 'multiplicities=False' should really be options to .univariate_polynomial_factor() or whether they can be handled 'universally'.



---

archive/issue_comments_110464.json:
```json
{
    "body": "Attachment [trac_10635_field_hooks.patch](tarball://root/attachments/some-uuid/ticket10635/trac_10635_field_hooks.patch) by cjh created at 2011-05-10 16:51:05\n\nPatch implementing desired changes",
    "created_at": "2011-05-10T16:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110464",
    "user": "https://trac.sagemath.org/admin/accounts/users/cjh"
}
```

Attachment [trac_10635_field_hooks.patch](tarball://root/attachments/some-uuid/ticket10635/trac_10635_field_hooks.patch) by cjh created at 2011-05-10 16:51:05

Patch implementing desired changes



---

archive/issue_comments_110465.json:
```json
{
    "body": "<a id='comment:2'></a>The patch addresses issue (1) and is for Sage 4.6.2.",
    "created_at": "2011-05-10T16:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110465",
    "user": "https://trac.sagemath.org/admin/accounts/users/cjh"
}
```

<a id='comment:2'></a>The patch addresses issue (1) and is for Sage 4.6.2.



---

archive/issue_comments_110466.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-10T16:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110466",
    "user": "https://trac.sagemath.org/admin/accounts/users/cjh"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_110467.json:
```json
{
    "body": "<a id='comment:3'></a>Patch applied to sage-4.7.1.alpha2, then did 'sage -b', then 'make testlong'.  All tests passed.  Positive review!\n\ncjh - you need to add your name to the author field.",
    "created_at": "2011-06-15T13:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110467",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:3'></a>Patch applied to sage-4.7.1.alpha2, then did 'sage -b', then 'make testlong'.  All tests passed.  Positive review!

cjh - you need to add your name to the author field.



---

archive/issue_comments_110468.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-06-15T13:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110468",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_110469.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-08-24T02:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110469",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_110470.json:
```json
{
    "body": "<a id='comment:5'></a>The patch should have an example that illustrates that each added capability actually works.   That could be a class created in a docstring, or a small demo class added to the source code with an example.",
    "created_at": "2011-08-24T02:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110470",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>The patch should have an example that illustrates that each added capability actually works.   That could be a class created in a docstring, or a small demo class added to the source code with an example.



---

archive/issue_comments_110471.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-24T02:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110471",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_110472.json:
```json
{
    "body": "Attachment [trac_10635-new_version_with_tests.patch](tarball://root/attachments/some-uuid/ticket10635/trac_10635-new_version_with_tests.patch) by @williamstein created at 2011-08-24 03:03:02\n\napply only this patch",
    "created_at": "2011-08-24T03:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110472",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_10635-new_version_with_tests.patch](tarball://root/attachments/some-uuid/ticket10635/trac_10635-new_version_with_tests.patch) by @williamstein created at 2011-08-24 03:03:02

apply only this patch



---

archive/issue_comments_110473.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-24T03:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110473",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110474.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-24T04:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110474",
    "user": "https://github.com/haikona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110475.json:
```json
{
    "body": "<a id='comment:8'></a>Yep, looks fine. Test pass, code works, couldn't even find a typo. Note that this latest patch only sets it up so that if a base ring has a native `_factor_univariate_polynomial()` or `_roots_univariate_polynomial()` method, then those will be used instead of the generic `factor()` and `roots()` method in polynomial_element.pyx.\n\nThe ring-specific functionality of these two methods still needs to be moved across to their respective files; to address this I've created patch #11731.",
    "created_at": "2011-08-24T04:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110475",
    "user": "https://github.com/haikona"
}
```

<a id='comment:8'></a>Yep, looks fine. Test pass, code works, couldn't even find a typo. Note that this latest patch only sets it up so that if a base ring has a native `_factor_univariate_polynomial()` or `_roots_univariate_polynomial()` method, then those will be used instead of the generic `factor()` and `roots()` method in polynomial_element.pyx.

The ring-specific functionality of these two methods still needs to be moved across to their respective files; to address this I've created patch #11731.



---

archive/issue_comments_110476.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd32\".",
    "created_at": "2011-08-24T23:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110476",
    "user": "https://github.com/williamstein"
}
```

Changing keywords from "" to "sd32".



---

archive/issue_events_027381.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T04:36:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10635#event-27381"
}
```



---

archive/issue_comments_110477.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-17T04:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110477",
    "user": "https://github.com/nexttime"
}
```

Resolution: fixed



---

archive/issue_comments_110478.json:
```json
{
    "body": "Reviewer patch to fix doctest error on some systems (e.g. x86). Apply on top of other patch.",
    "created_at": "2011-09-25T21:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110478",
    "user": "https://github.com/nexttime"
}
```

Reviewer patch to fix doctest error on some systems (e.g. x86). Apply on top of other patch.



---

archive/issue_comments_110479.json:
```json
{
    "body": "<a id='comment:12'></a>Attachment [trac_10635-fix_doctest_error_due_to_noise.reviewer.patch](tarball://root/attachments/some-uuid/ticket10635/trac_10635-fix_doctest_error_due_to_noise.reviewer.patch) by @nexttime created at 2011-09-25 21:29:15\n\nI've attached a reviewer patch fixing a doctest error in a factorization.\n\n(The order of the factors changes, depending on the sign of a \"zero\" term in the polynomial which is one factor. The example now looks a bit ugly, but I don't want to wait until we have `zero_at()` methods for all kinds of domains, and just tagging the whole doctest \"`# random`\" would also be odd, IMHO. Note that it previously didn't fail on *all* 32-bit systems, e.g. *not* 32-bit SPARC, and tagging the results \"`# 32-bit`\" and \"`# 64-bit`\" would have been inadequate anyway, since the machine word width is completely unrelated, i.e., that the test failed on x86 processors only is just a weird coincidence.)",
    "created_at": "2011-09-25T21:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110479",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>Attachment [trac_10635-fix_doctest_error_due_to_noise.reviewer.patch](tarball://root/attachments/some-uuid/ticket10635/trac_10635-fix_doctest_error_due_to_noise.reviewer.patch) by @nexttime created at 2011-09-25 21:29:15

I've attached a reviewer patch fixing a doctest error in a factorization.

(The order of the factors changes, depending on the sign of a "zero" term in the polynomial which is one factor. The example now looks a bit ugly, but I don't want to wait until we have `zero_at()` methods for all kinds of domains, and just tagging the whole doctest "`# random`" would also be odd, IMHO. Note that it previously didn't fail on *all* 32-bit systems, e.g. *not* 32-bit SPARC, and tagging the results "`# 32-bit`" and "`# 64-bit`" would have been inadequate anyway, since the machine word width is completely unrelated, i.e., that the test failed on x86 processors only is just a weird coincidence.)



---

archive/issue_comments_110480.json:
```json
{
    "body": "<a id='comment:13'></a>Factorization over function fields (provided by #9054) uses the function defined in this ticket (_factor_univariate_polynomial). However, in some cases it requires a parameter proof=False to work. So, the easy solution for #9054 was to add the default parameter proof=True to polynomial_element.factor() and pass it on to _factor_univariate_polynomial.\nSo, to make #9054 work with this ticket, should we just pass on all *args and **kwargs to _factor_univariate_polynomial? I do not understand what you mean by 'universally' but I guess it's related to this question.\n\nReplying to [comment:1 cjh]:\n> (3) Consider whether options such as 'multiplicities=False' should really be options to .univariate_polynomial_factor() or whether they can be handled 'universally'.",
    "created_at": "2011-11-29T15:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110480",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:13'></a>Factorization over function fields (provided by #9054) uses the function defined in this ticket (_factor_univariate_polynomial). However, in some cases it requires a parameter proof=False to work. So, the easy solution for #9054 was to add the default parameter proof=True to polynomial_element.factor() and pass it on to _factor_univariate_polynomial.
So, to make #9054 work with this ticket, should we just pass on all *args and **kwargs to _factor_univariate_polynomial? I do not understand what you mean by 'universally' but I guess it's related to this question.

Replying to [comment:1 cjh]:
> (3) Consider whether options such as 'multiplicities=False' should really be options to .univariate_polynomial_factor() or whether they can be handled 'universally'.



---

archive/issue_comments_110481.json:
```json
{
    "body": "<a id='comment:14'></a>I opened a ticket for the function field case: #12100",
    "created_at": "2011-11-29T16:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110481",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:14'></a>I opened a ticket for the function field case: #12100



---

archive/issue_comments_110482.json:
```json
{
    "body": "<a id='comment:15'></a>Sorry for the false alarm. I must have been working with an outdated version of #9054. Actually the proof parameter is passed on.\nAnyway, I'm thinking about doing parts of #11731, so I'd still like to know what you had in mind with the 'universally'.",
    "created_at": "2011-11-29T16:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10635#issuecomment-110482",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:15'></a>Sorry for the false alarm. I must have been working with an outdated version of #9054. Actually the proof parameter is passed on.
Anyway, I'm thinking about doing parts of #11731, so I'd still like to know what you had in mind with the 'universally'.
