# Issue 10436: #10303 gives problems with sage -ba-force

archive/issues_010383.json:
```json
{
    "body": "On a clean installation of Sage including #10303, I get\n\n```\n$ ./sage -ba-force\n*** TOUCHING ALL CYTHON (.pyx) FILES ***\nKeyError: 'SAGE64':\n  File \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.6.1.rc0/devel/sage-main/c_lib/SConstruct\", line 108:\n    if os.environ['SAGE64']==\"yes\":\n  File \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.6.1.rc0/local/lib/python/UserDict.py\", line 22:\n    raise KeyError(key)\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n```\n\nApart from this error message, `sage -ba-force` seems to work.\n\nAssignee: GeorgSWeber\n\nCC:  @nexttime\n\nKeywords: SAGE64\n\nReviewer: Jeroen Demeyer\n\nResolution: wontfix\n\nIssue created by migration from https://trac.sagemath.org/ticket/10436\n\n",
    "closed_at": "2014-01-04T02:40:04Z",
    "created_at": "2010-12-06T14:32:11Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "#10303 gives problems with sage -ba-force",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10436",
    "user": "https://github.com/jdemeyer"
}
```
On a clean installation of Sage including #10303, I get

```
$ ./sage -ba-force
*** TOUCHING ALL CYTHON (.pyx) FILES ***
KeyError: 'SAGE64':
  File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.6.1.rc0/devel/sage-main/c_lib/SConstruct", line 108:
    if os.environ['SAGE64']=="yes":
  File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.6.1.rc0/local/lib/python/UserDict.py", line 22:
    raise KeyError(key)

----------------------------------------------------------
sage: Building and installing modified Sage library files.
```

Apart from this error message, `sage -ba-force` seems to work.

Assignee: GeorgSWeber

CC:  @nexttime

Keywords: SAGE64

Reviewer: Jeroen Demeyer

Resolution: wontfix

Issue created by migration from https://trac.sagemath.org/ticket/10436





---

archive/issue_comments_111838.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -13,6 +13,8 @@\n sage: Building and installing modified Sage library files.\n ```\n \n+Apart from this error message, `sage -ba-force` seems to work.\n+\n Comment: 1\n \n Priority: blocker\n```\n",
    "created_at": "2010-12-06T14:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10436#issuecomment-111838",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -13,6 +13,8 @@
 sage: Building and installing modified Sage library files.
 ```
 
+Apart from this error message, `sage -ba-force` seems to work.
+
 Comment: 1
 
 Priority: blocker
```




---

archive/issue_comments_111839.json:
```json
{
    "body": "<a id='comment:2'></a>I think running sage-check-64 earlier in sage-build would fix it (if we keep #10303).  Something like this patch:\n\n```diff\ndiff -r 3d7bb3a7774e sage-build\n--- a/sage-build\n+++ b/sage-build\n@@ -82,6 +82,13 @@ if [ ! -d \"$SAGE_ROOT/devel/sage\" ]; the\n     exit 1\n fi\n \n+# Check whether this seems to a 64-bit build:\n+source \"$SAGE_LOCAL\"/bin/sage-check-64\n+\n+if [ $? -ne 0 ]; then\n+    exit 1\n+fi\n+\n if [ $DO_BUILD_ALL = 1 ]; then\n    CUR=`pwd`\n    cd \"$SAGE_ROOT/devel/sage/sage\"\n@@ -98,11 +105,4 @@ if [ $DO_BUILD_ALL = 1 ]; then\n    cd \"$CUR\"\n fi\n \n-# Check whether this seems to a 64-bit build:\n-source \"$SAGE_LOCAL\"/bin/sage-check-64\n-\n-if [ $? -ne 0 ]; then\n-    exit 1\n-fi\n-\n build \"sage\"\n```\nBut it's the end of the quarter here, I have final exams to prepare, etc., so I don't have any more time to work on this now.",
    "created_at": "2010-12-06T17:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10436#issuecomment-111839",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>I think running sage-check-64 earlier in sage-build would fix it (if we keep #10303).  Something like this patch:

```diff
diff -r 3d7bb3a7774e sage-build
--- a/sage-build
+++ b/sage-build
@@ -82,6 +82,13 @@ if [ ! -d "$SAGE_ROOT/devel/sage" ]; the
     exit 1
 fi
 
+# Check whether this seems to a 64-bit build:
+source "$SAGE_LOCAL"/bin/sage-check-64
+
+if [ $? -ne 0 ]; then
+    exit 1
+fi
+
 if [ $DO_BUILD_ALL = 1 ]; then
    CUR=`pwd`
    cd "$SAGE_ROOT/devel/sage/sage"
@@ -98,11 +105,4 @@ if [ $DO_BUILD_ALL = 1 ]; then
    cd "$CUR"
 fi
 
-# Check whether this seems to a 64-bit build:
-source "$SAGE_LOCAL"/bin/sage-check-64
-
-if [ $? -ne 0 ]; then
-    exit 1
-fi
-
 build "sage"
```
But it's the end of the quarter here, I have final exams to prepare, etc., so I don't have any more time to work on this now.



---

archive/issue_comments_111840.json:
```json
{
    "body": "<a id='comment:3'></a>I do **not** see this problem on a build where SAGE64 was not set. \n\n```\ndrkirkby@hawk:~/sage-4.6.1.alpha3$ ./sage -ba-force\n*** TOUCHING ALL CYTHON (.pyx) FILES ***\nscons: `install' is up to date.\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\n```\n\nThis was a 32-bit build on OpenSolaris 06/2009. \n\nWhat system was the problem noticed? Was SAGE64 set?",
    "created_at": "2010-12-06T18:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10436#issuecomment-111840",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:3'></a>I do **not** see this problem on a build where SAGE64 was not set. 

```
drkirkby@hawk:~/sage-4.6.1.alpha3$ ./sage -ba-force
*** TOUCHING ALL CYTHON (.pyx) FILES ***
scons: `install' is up to date.

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
```

This was a 32-bit build on OpenSolaris 06/2009. 

What system was the problem noticed? Was SAGE64 set?



---

archive/issue_comments_111841.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 drkirkby]:\n> What system was the problem noticed? Was SAGE64 set? \n\n\nThis was on `sage.math.washington.edu`, a Ubuntu Linux x86_64 system.  I did not set `SAGE64`.",
    "created_at": "2010-12-07T08:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10436#issuecomment-111841",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Replying to [comment:3 drkirkby]:
> What system was the problem noticed? Was SAGE64 set? 


This was on `sage.math.washington.edu`, a Ubuntu Linux x86_64 system.  I did not set `SAGE64`.



---

archive/issue_events_026728.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-12-16T09:14:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10436#event-26728"
}
```



---

archive/issue_events_026729.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10436#event-26729"
}
```



---

archive/issue_events_026730.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10436#event-26730"
}
```



---

archive/issue_comments_111842.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-29T23:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10436#issuecomment-111842",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_111843.json:
```json
{
    "body": "<a id='comment:9'></a>Ticket is irrelevant since #10303 was never merged.",
    "created_at": "2013-12-29T23:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10436#issuecomment-111843",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Ticket is irrelevant since #10303 was never merged.



---

archive/issue_events_026731.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-29T23:16:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10436#event-26731"
}
```



---

archive/issue_events_026732.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-29T23:16:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10436#event-26732"
}
```



---

archive/issue_comments_111844.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-29T23:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10436#issuecomment-111844",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_111845.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2014-01-04T02:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10436#issuecomment-111845",
    "user": "https://github.com/vbraun"
}
```

Resolution: wontfix



---

archive/issue_events_026733.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-04T02:40:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10436",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10436#event-26733"
}
```
