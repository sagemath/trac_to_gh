# Issue 10448: Extensions of ZZ are not unique parents

archive/issues_010395.json:
```json
{
    "assignees": [
        "https://github.com/loefflerd"
    ],
    "body": "With an unpatched sage-4.6, we have:\n\n```\nsage: R1 = ZZ.extension(x**2+1,'i')\nsage: R1 is ZZ.extension(x**2+1,'i')\nFalse\nsage: R1 is ZZ.extension(x**2+1,'i')\nFalse\n```\n\nI think that should be changed.\n\nKeywords: **uniqueness of parents**\n\nBranch/Commit: **[598334d](https://github.com/sagemath/sagetrac-mirror/commit/598334dc5cc01af4bc7a8707e8fc9d77298d9977)**\n\nReviewer: **Peter Bruin**\n\nAuthor: **Julian R\u00fcth**\n\nComponent: **number fields**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/10448_\n\n",
    "closed_at": "2014-06-02T12:54:46Z",
    "created_at": "2010-12-09T13:44:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Extensions of ZZ are not unique parents",
    "type": "issue",
    "updated_at": "2014-06-02T12:54:46Z",
    "url": "https://github.com/sagemath/sage/issues/10448",
    "user": "https://github.com/simon-king-jena"
}
```
With an unpatched sage-4.6, we have:

```
sage: R1 = ZZ.extension(x**2+1,'i')
sage: R1 is ZZ.extension(x**2+1,'i')
False
sage: R1 is ZZ.extension(x**2+1,'i')
False
```

I think that should be changed.

Keywords: **uniqueness of parents**

Branch/Commit: **[598334d](https://github.com/sagemath/sagetrac-mirror/commit/598334dc5cc01af4bc7a8707e8fc9d77298d9977)**

Reviewer: **Peter Bruin**

Author: **Julian Rüth**

Component: **number fields**

_Issue created by migration from https://trac.sagemath.org/ticket/10448_





---

archive/issue_events_137014.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:44:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137014"
}
```



---

archive/issue_events_137015.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:44:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137015"
}
```



---

archive/issue_events_137016.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:44:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137016"
}
```



---

archive/issue_events_137017.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:44:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137017"
}
```



---

archive/issue_events_137018.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-12-09T13:44:32Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "subject": "https://github.com/simon-king-jena",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137018"
}
```



---

archive/issue_events_137019.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:53:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137019"
}
```



---

archive/issue_events_137020.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:53:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137020"
}
```



---

archive/issue_events_137021.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:53:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "title_is": "Extensions of ZZ are not unique parents",
    "title_was": "Side-effect of EllipticCurve.torsion_group: Destroying uniqueness of parents",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137021"
}
```



---

archive/issue_events_137022.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-12-09T13:53:26Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "subject": "https://github.com/simon-king-jena",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137022"
}
```



---

archive/issue_events_137023.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-12-09T13:53:26Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "subject": "https://github.com/simon-king-jena",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137023"
}
```



---

archive/issue_events_137024.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:53:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137024"
}
```



---

archive/issue_events_137025.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T13:53:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137025"
}
```



---

archive/issue_comments_097952.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,20 +1,11 @@\n-We have\n+With an unpatched sage-4.6, we have:\n \n ```\n-sage: K.<i>=NumberField(x^2 + 1)\n-sage: R = ZZ.extension(x**2+1,'i')\n-sage: f1 = K.coerce_map_from(R)\n-sage: f1.domain() is R\n-True\n-sage: E = EllipticCurve(K,[0,0,0,1,0])\n-sage: E.torsion_subgroup()\n-Torsion Subgroup isomorphic to Z/2 + Z/2 associated to the Elliptic Curve defined by y^2 = x^3 + x over Number Field in i with defining polynomial x^2 + 1\n-sage: R = ZZ.extension(x**2+1,'i')\n-sage: f2 = K.coerce_map_from(R)\n-sage: f2.domain() is R\n+sage: R1 = ZZ.extension(x**2+1,'i')\n+sage: R1 is ZZ.extension(x**2+1,'i')\n False\n-sage: f2.domain() == R\n-True\n+sage: R1 is ZZ.extension(x**2+1,'i')\n+False\n ```\n \n-Hence, on the one hand, computing the torsion group destroys uniqueness of parents, and moreover, it makes the coerce map from an order to its ambient field have a domain that is not the same that is requested.\n+I think that should be changed.\n``````\n",
    "created_at": "2010-12-09T13:53:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97952",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,20 +1,11 @@
-We have
+With an unpatched sage-4.6, we have:
 
 ```
-sage: K.<i>=NumberField(x^2 + 1)
-sage: R = ZZ.extension(x**2+1,'i')
-sage: f1 = K.coerce_map_from(R)
-sage: f1.domain() is R
-True
-sage: E = EllipticCurve(K,[0,0,0,1,0])
-sage: E.torsion_subgroup()
-Torsion Subgroup isomorphic to Z/2 + Z/2 associated to the Elliptic Curve defined by y^2 = x^3 + x over Number Field in i with defining polynomial x^2 + 1
-sage: R = ZZ.extension(x**2+1,'i')
-sage: f2 = K.coerce_map_from(R)
-sage: f2.domain() is R
+sage: R1 = ZZ.extension(x**2+1,'i')
+sage: R1 is ZZ.extension(x**2+1,'i')
 False
-sage: f2.domain() == R
-True
+sage: R1 is ZZ.extension(x**2+1,'i')
+False
 ```
 
-Hence, on the one hand, computing the torsion group destroys uniqueness of parents, and moreover, it makes the coerce map from an order to its ambient field have a domain that is not the same that is requested.
+I think that should be changed.
``````




---

archive/issue_comments_097953.json:
```json
{
    "body": "Changed keywords from **torsion_group, uniqueness of parents, coerce map** to **uniqueness of parents**",
    "created_at": "2010-12-09T13:53:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97953",
    "user": "https://github.com/simon-king-jena"
}
```

Changed keywords from **torsion_group, uniqueness of parents, coerce map** to **uniqueness of parents**



---

archive/issue_comments_097954.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSorry for changing the original ticket completely: When I created it, I thought it was a side effect of torsion_subgroup. But in fact, the lacking uniqueness is an independent problem.",
    "created_at": "2010-12-09T13:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97954",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>

Sorry for changing the original ticket completely: When I created it, I thought it was a side effect of torsion_subgroup. But in fact, the lacking uniqueness is an independent problem.



---

archive/issue_events_137026.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T14:07:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137026"
}
```



---

archive/issue_comments_097955.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2010-12-09T14:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97955",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_097956.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nApparently it suffices to decorate the `order` method of number fields so that it is cached. I added a doctest. I did not do `sage -testall` yet, but I'll do now, and I think I can mark it as \"ready for review\".",
    "created_at": "2010-12-09T14:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97956",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">comment:3</div>

Apparently it suffices to decorate the `order` method of number fields so that it is cached. I added a doctest. I did not do `sage -testall` yet, but I'll do now, and I think I can mark it as "ready for review".



---

archive/issue_comments_097957.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt needs work: There is some code in heegner.py which calls `.order(...)` with a list, not a tuple. Hence, the `@cached_method` decorator complains.\n\nI'll change it and post a new patch as soon as all tests pass.",
    "created_at": "2010-12-09T16:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97957",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:4" align="right">comment:4</div>

It needs work: There is some code in heegner.py which calls `.order(...)` with a list, not a tuple. Hence, the `@cached_method` decorator complains.

I'll change it and post a new patch as soon as all tests pass.



---

archive/issue_events_137027.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T16:43:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137027"
}
```



---

archive/issue_events_137028.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T16:43:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137028"
}
```



---

archive/issue_comments_097958.json:
```json
{
    "body": "Work Issues: **use `order()` with tuples, not lists**",
    "created_at": "2010-12-09T16:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97958",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **use `order()` with tuples, not lists**



---

archive/issue_comments_097959.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe updated patch ensures that the new cached `order()` method is called with tuples, not lists. `sage -tp 4` passes for me. Ready for review!",
    "created_at": "2010-12-09T18:26:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97959",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

The updated patch ensures that the new cached `order()` method is called with tuples, not lists. `sage -tp 4` passes for me. Ready for review!



---

archive/issue_events_137029.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T18:26:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137029"
}
```



---

archive/issue_events_137030.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-09T18:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137030"
}
```



---

archive/issue_comments_097960.json:
```json
{
    "body": "Changed work issues from **use `order()` with tuples, not lists** to none",
    "created_at": "2010-12-09T18:26:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97960",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **use `order()` with tuples, not lists** to none



---

archive/issue_comments_097961.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI don't like this: it's something of a convention in Sage that functions creating an object given some generators tend to take lists, and forcing \"order\" to take only tuples breaks that, which is confusing for the user. I'd be much happier if this was implemented differently so `order` could take a list (e.g. by tuplifying its arguments and calling a second internal method, `_order_from_cache` or suchlike, which used the `@cached_method` machinery).\n\nOthers may disagree, so I'm leaving this at \"needs_review\".",
    "created_at": "2010-12-16T13:28:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97961",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:6" align="right">comment:6</div>

I don't like this: it's something of a convention in Sage that functions creating an object given some generators tend to take lists, and forcing "order" to take only tuples breaks that, which is confusing for the user. I'd be much happier if this was implemented differently so `order` could take a list (e.g. by tuplifying its arguments and calling a second internal method, `_order_from_cache` or suchlike, which used the `@cached_method` machinery).

Others may disagree, so I'm leaving this at "needs_review".



---

archive/issue_comments_097962.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThat was exactly my first thought as well, we should not require the list of generators to be a tuple. (As well as breaking convention, this will break people's existing code.) \n\nMuch better to just convert gens to a tuple in the called function.",
    "created_at": "2010-12-16T16:57:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97962",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:7" align="right">comment:7</div>

That was exactly my first thought as well, we should not require the list of generators to be a tuple. (As well as breaking convention, this will break people's existing code.) 

Much better to just convert gens to a tuple in the called function.



---

archive/issue_events_137031.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-12-16T16:57:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137031"
}
```



---

archive/issue_events_137032.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-12-16T16:57:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137032"
}
```



---

archive/issue_comments_097963.json:
```json
{
    "body": "Attachment: **[10448_unique_orders_in_numberfields.patch.gz](https://github.com/sagemath/sage/files/ticket10448/10448_unique_orders_in_numberfields.patch.gz)**\n\nMake orders in number fields unique",
    "created_at": "2010-12-16T20:50:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97963",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[10448_unique_orders_in_numberfields.patch.gz](https://github.com/sagemath/sage/files/ticket10448/10448_unique_orders_in_numberfields.patch.gz)**

Make orders in number fields unique



---

archive/issue_comments_097964.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nDear David, dear Robert\n\nReplying to [@robertwb](#comment:7):\n> That was exactly my first thought as well, we should not require the list of generators to be a tuple. (As well as breaking convention, this will break people's existing code.) \n> \n> Much better to just convert gens to a tuple in the called function. \n\nThere is a convenient way: Everything is based on the function `sage.rings.number_field.order.absolute_order_from_module_generators`. This function is not supposed to be called directly, if I understand correctly. Hence, it won't hurt to change the expected input of that function (or of `sage.rings.number_field.order.absolute_order_from_ring_generators`).\n\nMy solution is:\n* Prepend `sage.rings.number_field.order.absolute_order_from_module_generators` with `@cached_function`.\n* The generators must form a tuple, so, the internals of some methods need to be adapted.\n* In addition to the tuple of generators, I suggest that the field is passed as an argument as well.\n\nThe last point is for preventing coercion trouble: If there is a coercion from number field K to number field L and if only the tuple of generators would be cached, then orders in K would be identic to orders in L. Therefore, the field *must* be included in the cache data.\n\nAnyway. I reverted part of the doctests, so that we have tests where `K.order(...)` is called with a single element, with a list of elements, or with a tuple of elements. And of course we have a new test for the cache. Ready for review, I guess.",
    "created_at": "2010-12-16T21:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97964",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Dear David, dear Robert

Replying to [@robertwb](#comment:7):
> That was exactly my first thought as well, we should not require the list of generators to be a tuple. (As well as breaking convention, this will break people's existing code.) 
> 
> Much better to just convert gens to a tuple in the called function. 

There is a convenient way: Everything is based on the function `sage.rings.number_field.order.absolute_order_from_module_generators`. This function is not supposed to be called directly, if I understand correctly. Hence, it won't hurt to change the expected input of that function (or of `sage.rings.number_field.order.absolute_order_from_ring_generators`).

My solution is:
* Prepend `sage.rings.number_field.order.absolute_order_from_module_generators` with `@cached_function`.
* The generators must form a tuple, so, the internals of some methods need to be adapted.
* In addition to the tuple of generators, I suggest that the field is passed as an argument as well.

The last point is for preventing coercion trouble: If there is a coercion from number field K to number field L and if only the tuple of generators would be cached, then orders in K would be identic to orders in L. Therefore, the field *must* be included in the cache data.

Anyway. I reverted part of the doctests, so that we have tests where `K.order(...)` is called with a single element, with a list of elements, or with a tuple of elements. And of course we have a new test for the cache. Ready for review, I guess.



---

archive/issue_events_137033.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-16T21:01:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137033"
}
```



---

archive/issue_events_137034.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2010-12-16T21:01:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137034"
}
```



---

archive/issue_comments_097965.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI somewhat prefer using `sage.structure.factory.UniqueFactory` rather than `cached_function` for object creation.  The benefits are that you get better handling of duplicate keys, pickling and unpickling via the factory.  What you've implemented is certainly better than the status quo though, and I'd be up for giving it a positive review; I just wanted to bring up the `UniqueFactory` approach in case you felt motivated to do it.  :-)",
    "created_at": "2010-12-22T10:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97965",
    "user": "https://github.com/roed314"
}
```

<div id="comment:9" align="right">comment:9</div>

I somewhat prefer using `sage.structure.factory.UniqueFactory` rather than `cached_function` for object creation.  The benefits are that you get better handling of duplicate keys, pickling and unpickling via the factory.  What you've implemented is certainly better than the status quo though, and I'd be up for giving it a positive review; I just wanted to bring up the `UniqueFactory` approach in case you felt motivated to do it.  :-)



---

archive/issue_comments_097966.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@roed314](#comment:9):\n> I somewhat prefer using `sage.structure.factory.UniqueFactory` rather than `cached_function` for object creation.  The benefits are that you get better handling of duplicate keys, pickling and unpickling via the factory.\n\nThat would indeed be nice, but I currently don't have the time resources to implement it.",
    "created_at": "2011-01-18T06:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97966",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@roed314](#comment:9):
> I somewhat prefer using `sage.structure.factory.UniqueFactory` rather than `cached_function` for object creation.  The benefits are that you get better handling of duplicate keys, pickling and unpickling via the factory.

That would indeed be nice, but I currently don't have the time resources to implement it.



---

archive/issue_events_137035.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-01-20T11:27:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137035"
}
```



---

archive/issue_events_137036.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-01-20T11:27:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137036"
}
```



---

archive/issue_comments_097967.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThere is a risk of this breaking garbage collection of number fields. \n\nThe number field code is quite carefully written so that number fields are globally unique, but only weak references to them are cached, so the uniqueness doesn't mean they hang around in memory longer than they should. The patch here would have the disadvantage that as soon as one created any order in a number field, the order (and hence also its parent number field) would hang around for the rest of the Sage session, as an entry in the cache of `absolute_order_from_module_generators`. \n\n(Using `UniqueFactory` wouldn't solve this; it would cache weak references so that orders could still be garbage collected, but these weakrefs would be stored in a cache whose *keys* included the number field, so the number field still couldn't be garbage collected.)\n\nThe best solution I can think of would be to store orders in a cache which was itself an attribute of the parent number field. This could be implemented by making `order` tuplify its arguments and then call a second *method* `_order_from_cache`, implemented using `@cached_method` as usual. Then the second method's cache is then an attribute of the number field, and hence (a) there is no need to include the number field in the arguments, and (b) the number field and the orders can be garbage collected without problems. (This is what I suggested 5 weeks ago.)\n\nOn the other hand, this is all a bit theoretical, because of the issue at ticket #715: it's basically impossible to get rid of *any* parent object created in a Sage session, because the coercion model caches stuff all over the place. But I think we shouldn't compound the problem further here.",
    "created_at": "2011-01-20T11:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97967",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:11" align="right">comment:11</div>

There is a risk of this breaking garbage collection of number fields. 

The number field code is quite carefully written so that number fields are globally unique, but only weak references to them are cached, so the uniqueness doesn't mean they hang around in memory longer than they should. The patch here would have the disadvantage that as soon as one created any order in a number field, the order (and hence also its parent number field) would hang around for the rest of the Sage session, as an entry in the cache of `absolute_order_from_module_generators`. 

(Using `UniqueFactory` wouldn't solve this; it would cache weak references so that orders could still be garbage collected, but these weakrefs would be stored in a cache whose *keys* included the number field, so the number field still couldn't be garbage collected.)

The best solution I can think of would be to store orders in a cache which was itself an attribute of the parent number field. This could be implemented by making `order` tuplify its arguments and then call a second *method* `_order_from_cache`, implemented using `@cached_method` as usual. Then the second method's cache is then an attribute of the number field, and hence (a) there is no need to include the number field in the arguments, and (b) the number field and the orders can be garbage collected without problems. (This is what I suggested 5 weeks ago.)

On the other hand, this is all a bit theoretical, because of the issue at ticket #715: it's basically impossible to get rid of *any* parent object created in a Sage session, because the coercion model caches stuff all over the place. But I think we shouldn't compound the problem further here.



---

archive/issue_comments_097968.json:
```json
{
    "body": "Work Issues: **Breaks garbage collection**",
    "created_at": "2011-01-20T11:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97968",
    "user": "https://github.com/loefflerd"
}
```

Work Issues: **Breaks garbage collection**



---

archive/issue_comments_097969.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHi David,\n\nCurrently I try to produce a patch according to your suggestions. However:\n\nReplying to [@loefflerd](#comment:11):\n> There is a risk of this breaking garbage collection of number fields. \n> \n> The number field code is quite carefully written so that number fields are globally unique...\n\nThat's not true.\n\n```\nsage: K.<z7> = QuadraticField(7)\nsage: K is loads(dumps(K))\nFalse\n```\n\n> The best solution I can think of would be to store orders in a cache which was itself an attribute of the parent number field. This could be implemented by making `order` tuplify its arguments and then call a second *method* `_order_from_cache`, implemented using `@cached_method` as usual.\n\nDoing so, there is indeed uniqueness of orders, and that should also be useful for pickling. However, number fields are not unique parents, and so orders can only be unique in their number fields, but not globally.",
    "created_at": "2011-03-25T14:53:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97969",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

Hi David,

Currently I try to produce a patch according to your suggestions. However:

Replying to [@loefflerd](#comment:11):
> There is a risk of this breaking garbage collection of number fields. 
> 
> The number field code is quite carefully written so that number fields are globally unique...

That's not true.

```
sage: K.<z7> = QuadraticField(7)
sage: K is loads(dumps(K))
False
```

> The best solution I can think of would be to store orders in a cache which was itself an attribute of the parent number field. This could be implemented by making `order` tuplify its arguments and then call a second *method* `_order_from_cache`, implemented using `@cached_method` as usual.

Doing so, there is indeed uniqueness of orders, and that should also be useful for pickling. However, number fields are not unique parents, and so orders can only be unique in their number fields, but not globally.



---

archive/issue_events_137037.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137037"
}
```



---

archive/issue_events_137038.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137038"
}
```



---

archive/issue_events_137039.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137039"
}
```



---

archive/issue_events_137040.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137040"
}
```



---

archive/issue_comments_097970.json:
```json
{
    "body": "Branch: **[u/saraedum/ticket/10448](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/10448)**",
    "created_at": "2014-04-03T06:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97970",
    "user": "https://github.com/saraedum"
}
```

Branch: **[u/saraedum/ticket/10448](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/10448)**



---

archive/issue_comments_097971.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/598334dc5cc01af4bc7a8707e8fc9d77298d9977\">598334d</a></td><td><code>Improved caching for orders in number fields.</code></td></tr></table>\n",
    "created_at": "2014-04-03T07:01:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97971",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/598334dc5cc01af4bc7a8707e8fc9d77298d9977">598334d</a></td><td><code>Improved caching for orders in number fields.</code></td></tr></table>




---

archive/issue_comments_097972.json:
```json
{
    "body": "Commit: **[598334d](https://github.com/sagemath/sagetrac-mirror/commit/598334dc5cc01af4bc7a8707e8fc9d77298d9977)**",
    "created_at": "2014-04-03T07:01:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97972",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[598334d](https://github.com/sagemath/sagetrac-mirror/commit/598334dc5cc01af4bc7a8707e8fc9d77298d9977)**



---

archive/issue_events_137041.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-04-03T07:03:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137041"
}
```



---

archive/issue_events_137042.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-04-03T07:03:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137042"
}
```



---

archive/issue_events_137043.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137043"
}
```



---

archive/issue_events_137044.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137044"
}
```



---

archive/issue_comments_097973.json:
```json
{
    "body": "Reviewer: **Peter Bruin**",
    "created_at": "2014-05-20T17:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97973",
    "user": "https://github.com/pjbruin"
}
```

Reviewer: **Peter Bruin**



---

archive/issue_comments_097974.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nLooks good to me and passes all tests.  The \"work issues: breaks garbage collection\" isn't relevant anymore, is it?  And what about the \"Authors\" field?",
    "created_at": "2014-05-20T17:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97974",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:19" align="right">comment:19</div>

Looks good to me and passes all tests.  The "work issues: breaks garbage collection" isn't relevant anymore, is it?  And what about the "Authors" field?



---

archive/issue_comments_097975.json:
```json
{
    "body": "Changed work issues from **Breaks garbage collection** to none",
    "created_at": "2014-05-29T22:59:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97975",
    "user": "https://github.com/saraedum"
}
```

Changed work issues from **Breaks garbage collection** to none



---

archive/issue_comments_097976.json:
```json
{
    "body": "Changed author from **Simon King** to **Julian R\u00fcth**",
    "created_at": "2014-05-29T22:59:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97976",
    "user": "https://github.com/saraedum"
}
```

Changed author from **Simon King** to **Julian Rüth**



---

archive/issue_events_137045.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-29T23:06:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137045"
}
```



---

archive/issue_events_137046.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-29T23:06:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137046"
}
```



---

archive/issue_comments_097977.json:
```json
{
    "body": "Changed branch from **[u/saraedum/ticket/10448](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/10448)** to **[598334d](https://github.com/sagemath/sagetrac-mirror/commit/598334dc5cc01af4bc7a8707e8fc9d77298d9977)**",
    "created_at": "2014-06-02T12:54:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/10448#issuecomment-97977",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/saraedum/ticket/10448](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/10448)** to **[598334d](https://github.com/sagemath/sagetrac-mirror/commit/598334dc5cc01af4bc7a8707e8fc9d77298d9977)**



---

archive/issue_events_137047.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-02T12:54:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137047"
}
```



---

archive/issue_events_137048.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "abbc216dcc4a6621e976cdca76bba1005902cf27",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-06-02T12:54:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/10448",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/10448#event-137048"
}
```
