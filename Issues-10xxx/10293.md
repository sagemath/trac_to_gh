# Issue 10293: sage -startuptime is broken

archive/issues_010292.json:
```json
{
    "body": "Since sage-4.6.1.alpha2, `sage -startuptime` doesn't work anymore:\n\n```\n$ ./sage -startuptime\nTraceback (most recent call last):\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 46, in <module>\n    from sage.all import *\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/all.py\", line 99, in <module>\n    from sage.server.all     import *\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/server/all.py\", line 2, in <module>\n    from notebook.all import *\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/server/notebook/all.py\", line 22, in <module>\n    from sagenb.notebook.all import *\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/all.py\", line 16, in <module>\n    from notebook_object import notebook, inotebook\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/notebook_object.py\", line 17, in <module>\n    import notebook as _notebook\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/notebook.py\", line 39, in <module>\n    import css          # style\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/css.py\", line 17, in <module>\n    from sagenb.notebook.template import template\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/template.py\", line 18, in <module>\n    import jinja2\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/Jinja2-2.5.5-py2.6.egg/jinja2/__init__.py\", line 45, in <module>\n    from jinja2.bccache import BytecodeCache, FileSystemBytecodeCache, \\\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py\", line 35, in new_import\n    module = old_import(name, globals, locals, fromlist)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/Jinja2-2.5.5-py2.6.egg/jinja2/bccache.py\", line 31, in <module>\n    bc_magic = 'j2'.encode('ascii') + pickle.dumps(bc_version, 2)\n  File \"/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python/encodings/__init__.py\", line 100, in search_function\n    level=0)\nTypeError: new_import() got an unexpected keyword argument 'level'\n```\n\nFollow-up (adding doctest): #10300\n\nAssignee: @jasongrout\n\nKeywords: startuptime new_import exception\n\nResolution: fixed\n\nAuthor: Mike Hansen\n\nReviewer: Fran\u00e7ois Bissey\n\nMerged: sage-4.6.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/10293\n\n",
    "closed_at": "2010-11-21T08:56:36Z",
    "created_at": "2010-11-20T08:42:01Z",
    "labels": [
        "component: misc",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "sage -startuptime is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10293",
    "user": "https://github.com/jdemeyer"
}
```
Since sage-4.6.1.alpha2, `sage -startuptime` doesn't work anymore:

```
$ ./sage -startuptime
Traceback (most recent call last):
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 46, in <module>
    from sage.all import *
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/all.py", line 99, in <module>
    from sage.server.all     import *
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/server/all.py", line 2, in <module>
    from notebook.all import *
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/server/notebook/all.py", line 22, in <module>
    from sagenb.notebook.all import *
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/all.py", line 16, in <module>
    from notebook_object import notebook, inotebook
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/notebook_object.py", line 17, in <module>
    import notebook as _notebook
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/notebook.py", line 39, in <module>
    import css          # style
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/css.py", line 17, in <module>
    from sagenb.notebook.template import template
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/template.py", line 18, in <module>
    import jinja2
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/Jinja2-2.5.5-py2.6.egg/jinja2/__init__.py", line 45, in <module>
    from jinja2.bccache import BytecodeCache, FileSystemBytecodeCache, \
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/Jinja2-2.5.5-py2.6.egg/jinja2/bccache.py", line 31, in <module>
    bc_magic = 'j2'.encode('ascii') + pickle.dumps(bc_version, 2)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python/encodings/__init__.py", line 100, in search_function
    level=0)
TypeError: new_import() got an unexpected keyword argument 'level'
```

Follow-up (adding doctest): #10300

Assignee: @jasongrout

Keywords: startuptime new_import exception

Resolution: fixed

Author: Mike Hansen

Reviewer: Fran√ßois Bissey

Merged: sage-4.6.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/10293





---

archive/issue_comments_104946.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [trac_10293.patch](tarball://root/attachments/some-uuid/ticket10293/trac_10293.patch) by @mwhansen created at 2010-11-20 17:47:06\n\nThat should fix it.",
    "created_at": "2010-11-20T17:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104946",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:1'></a>Attachment [trac_10293.patch](tarball://root/attachments/some-uuid/ticket10293/trac_10293.patch) by @mwhansen created at 2010-11-20 17:47:06

That should fix it.



---

archive/issue_comments_104947.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-11-20T17:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104947",
    "user": "https://github.com/mwhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_104948.json:
```json
{
    "body": "<a id='comment:2'></a>The patch works for me. linux x86 (sage-on-gentoo really).",
    "created_at": "2010-11-20T21:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104948",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>The patch works for me. linux x86 (sage-on-gentoo really).



---

archive/issue_comments_104949.json:
```json
{
    "body": "<a id='comment:3'></a>I'm impressed.  A patch for a ticket that I did not announce for a Sage version which is not released :-)",
    "created_at": "2010-11-20T21:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104949",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>I'm impressed.  A patch for a ticket that I did not announce for a Sage version which is not released :-)



---

archive/issue_comments_104950.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 jdemeyer]:\n> I'm impressed.  A patch for a ticket that I did not announce for a Sage version which is not released :-)\n\n\nwell you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info.",
    "created_at": "2010-11-20T21:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104950",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>Replying to [comment:3 jdemeyer]:
> I'm impressed.  A patch for a ticket that I did not announce for a Sage version which is not released :-)


well you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info.



---

archive/issue_comments_104951.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 fbissey]:\n> well you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info. \n\n\nI have merged patch (I assume you are referring to #9418) in sage-4.6.1.alpha**2** which is not yet released.  In fact, I am changing it now by adding the patch on this ticket.",
    "created_at": "2010-11-20T21:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104951",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:4 fbissey]:
> well you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info. 


I have merged patch (I assume you are referring to #9418) in sage-4.6.1.alpha**2** which is not yet released.  In fact, I am changing it now by adding the patch on this ticket.



---

archive/issue_comments_104952.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 jdemeyer]:\n> Replying to [comment:4 fbissey]:\n> > well you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info. \n\n> \n> I have merged patch (I assume you are referring to #9418) in sage-4.6.1.alpha**2** which is not yet released.  In fact, I am changing it now by adding the patch on this ticket.\n\n\nThat's going off topic, but technically for sage-on-gentoo I don't really care\nthat you merged a package like patch. That 0 impact on us. Do something in sage,\nsage_scripts and so on and that will have an impact.\nIf you are including this in alpha2 I will just have to update the manifest.",
    "created_at": "2010-11-20T21:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104952",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>Replying to [comment:6 jdemeyer]:
> Replying to [comment:4 fbissey]:
> > well you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info. 

> 
> I have merged patch (I assume you are referring to #9418) in sage-4.6.1.alpha**2** which is not yet released.  In fact, I am changing it now by adding the patch on this ticket.


That's going off topic, but technically for sage-on-gentoo I don't really care
that you merged a package like patch. That 0 impact on us. Do something in sage,
sage_scripts and so on and that will have an impact.
If you are including this in alpha2 I will just have to update the manifest.



---

archive/issue_comments_104953.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-21T08:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104953",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_104954.json:
```json
{
    "body": "<a id='comment:8'></a>Tried the latest alpha2 with this ticket included, it still works so I am giving it a positive review.",
    "created_at": "2010-11-21T08:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104954",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>Tried the latest alpha2 with this ticket included, it still works so I am giving it a positive review.



---

archive/issue_comments_104955.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-11-21T08:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10293#issuecomment-104955",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_026474.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-21T08:56:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10293",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10293#event-26474"
}
```
