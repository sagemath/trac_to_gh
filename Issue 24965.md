# Issue 24965: Enable optional rollback functionality when upgrading packages

Issue created by migration from https://trac.sagemath.org/ticket/25202

Original creator: embray

Original creation time: 2018-04-18 08:59:16

With #25139 it becomes possible to fully uninstall all files associated with a package, which is done before upgrading that package to a new version.

This would just as easily allow creating a _backup_ of the package by moving its files to a temporary location rather than deleting them.  If the package upgrade fails, the old version could then be restored.

One could even imagine keeping backups that can be restored even after a seemingly successful upgrade (e.g. the upgrade succeeds building, but causes runtime regressions).  One could easily get carried away with something like this though and end up re-implementing [hashdist](https://github.com/hashdist/hashdist) (which honestly wouldn't be such a bad thing to have built into Sage...).

But to keep things focused I think this ticket should just consider rollback on build failures to start with.


---

Comment by jdemeyer created at 2018-07-13 14:19:01

Replying to [ticket:25202 embray]:
> One could easily get carried away with something like this though and end up re-implementing [hashdist](https://github.com/hashdist/hashdist) (which honestly wouldn't be such a bad thing to have built into Sage...).

Just FYI in case you didn't know: our release manager is one of the main contributors to hashdist. The project looks pretty dead though: the last commit on github was 2 years ago.


---

Comment by embray created at 2018-07-13 14:33:10

Replying to [comment:1 jdemeyer]:
> Replying to [ticket:25202 embray]:
> > One could easily get carried away with something like this though and end up re-implementing [hashdist](https://github.com/hashdist/hashdist) (which honestly wouldn't be such a bad thing to have built into Sage...).
> 
> Just FYI in case you didn't know: our release manager is one of the main contributors to hashdist. The project looks pretty dead though: the last commit on github was 2 years ago.

I know.  I tried using it a while ago to build Sage on Cygwin and had some problems due to a lack of Cygwin-specific patches for a number of dependencies that needed to be ported over.  Other than that, a few other details I had quibbles with, the way it works makes a lot of sense and I'm surprised Volker didn't push more to get Sage using it.  I would have...


---

Comment by embray created at 2018-12-28 14:10:15

Retargeting some of my tickets (somewhat optimistically for now).


---

Comment by embray created at 2019-03-25 10:44:36

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.
