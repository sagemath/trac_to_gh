# Issue 28219: py3: fix gapdir fallback

Issue created by migration from https://trac.sagemath.org/ticket/28456

Original creator: arojas

Original creation time: 2019-09-05 18:00:12

CC:  chapoton jhpalmieri




---

Comment by arojas created at 2019-09-05 18:04:32

Changing component from PLEASE CHANGE to python3.


---

Comment by arojas created at 2019-09-05 18:04:32

Fix `TypeError: 'filter' object is not subscriptable` when GAP_ROOT_DIR doesn't exist.

On sage-the-distro GAP_ROOT_DIR points to an existing dir, so this code path is not being doctested.
----
New commits:


---

Comment by arojas created at 2019-09-05 18:04:32

Changing status from new to needs_review.


---

Comment by arojas created at 2019-09-05 18:04:32

Changing type from PLEASE CHANGE to enhancement.


---

Comment by jhpalmieri created at 2019-09-05 18:36:52

Why not get rid of the `filter` command altogether? Use 

```
[x for x in gap_sh if x.strip().startswith('GAP_ROOT')][0]
```

instead? Or this should be faster since we can stop after the first match:

```
next(x for x in gap_sh if x.strip().startswith('GAP_ROOT'))
```

(taken from https://stackoverflow.com/questions/2361426/get-the-first-item-from-an-iterable-that-matches-a-condition)


---

Comment by git created at 2019-09-05 18:43:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2019-09-05 19:46:51

This looks good to me.


---

Comment by jhpalmieri created at 2019-09-05 19:46:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-09-09 21:28:45

Resolution: fixed
