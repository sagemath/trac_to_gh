# Issue 28219: py3: fix gapdir fallback

archive/issues_028219.json:
```json
{
    "body": "CC:  chapoton jhpalmieri\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28456\n\n",
    "created_at": "2019-09-05T18:00:12Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "py3: fix gapdir fallback",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28219",
    "user": "arojas"
}
```
CC:  chapoton jhpalmieri



Issue created by migration from https://trac.sagemath.org/ticket/28456





---

archive/issue_comments_398503.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to python3.",
    "created_at": "2019-09-05T18:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398503",
    "user": "arojas"
}
```

Changing component from PLEASE CHANGE to python3.



---

archive/issue_comments_398504.json:
```json
{
    "body": "Fix `TypeError: 'filter' object is not subscriptable` when GAP_ROOT_DIR doesn't exist.\n\nOn sage-the-distro GAP_ROOT_DIR points to an existing dir, so this code path is not being doctested.\n----\nNew commits:",
    "created_at": "2019-09-05T18:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398504",
    "user": "arojas"
}
```

Fix `TypeError: 'filter' object is not subscriptable` when GAP_ROOT_DIR doesn't exist.

On sage-the-distro GAP_ROOT_DIR points to an existing dir, so this code path is not being doctested.
----
New commits:



---

archive/issue_comments_398505.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-05T18:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398505",
    "user": "arojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_398506.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-09-05T18:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398506",
    "user": "arojas"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_398507.json:
```json
{
    "body": "Why not get rid of the `filter` command altogether? Use \n\n```\n[x for x in gap_sh if x.strip().startswith('GAP_ROOT')][0]\n```\n\ninstead? Or this should be faster since we can stop after the first match:\n\n```\nnext(x for x in gap_sh if x.strip().startswith('GAP_ROOT'))\n```\n\n(taken from https://stackoverflow.com/questions/2361426/get-the-first-item-from-an-iterable-that-matches-a-condition)",
    "created_at": "2019-09-05T18:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398507",
    "user": "jhpalmieri"
}
```

Why not get rid of the `filter` command altogether? Use 

```
[x for x in gap_sh if x.strip().startswith('GAP_ROOT')][0]
```

instead? Or this should be faster since we can stop after the first match:

```
next(x for x in gap_sh if x.strip().startswith('GAP_ROOT'))
```

(taken from https://stackoverflow.com/questions/2361426/get-the-first-item-from-an-iterable-that-matches-a-condition)



---

archive/issue_comments_398508.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-05T18:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398508",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398509.json:
```json
{
    "body": "This looks good to me.",
    "created_at": "2019-09-05T19:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398509",
    "user": "jhpalmieri"
}
```

This looks good to me.



---

archive/issue_comments_398510.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-05T19:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398510",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_398511.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-09-09T21:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28219#issuecomment-398511",
    "user": "vbraun"
}
```

Resolution: fixed
