# Issue 16024: Default behaviour of AdditiveAbelianGroup(a_tuple)

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2014-04-28 16:06:48

CC:  vbraun jhpalmieri simonking tscrim

This ticket follows the conversation on 
https://groups.google.com/forum/#!topic/sage-support/yexpjig9BSg


```
sage: H = AdditiveAbelianGroup([0,2])
sage: H((2,0))
(0, 0)
sage: H(vector((2,0)))
(2, 0)

sage: H((1,0)).order()
2
sage: H(vector((1,0))).order()
+Infinity
```


With this branch there is no need to wrap a tuple into a vector to avoid the "if isinstance(x,(tuple,list))" and what should be the default behaviour IS the default behaviour. And it barely breaks doctests once one replaced the old `[G([1,2])` by `G.linear_combination_of_smith_form_gens([1,2])`


---

Comment by ncohen created at 2014-04-28 16:12:04

New commits:


---

Comment by git created at 2014-04-28 16:42:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-04-28 16:42:28

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-04-28 16:48:59

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2014-04-28 16:48:59

You didn't implement `linear_combination_of_gens`, leaving no way to do that without tripping the warning. Also, you should obviously run the whole testsuite.


---

Comment by ncohen created at 2014-04-28 16:51:04

I do not think it is bad to always generate this warning, and I find `linear_combination_of_gens` far too extreme. I am pretty sure that nobody who really uses this only had inputs in smith form, or he would have given  up already. 

I am running all the tests right now (it found something in ellipti curves already) but it takes times.. And well, we used to have patchbots for this `:-P`

Nathann


---

Comment by ncohen created at 2014-04-28 16:57:27

by the way : anybody who used the syntax on purpose will move to `.linear_sum_of_smith_generators`, and those who wanted the normal sum wrapped everything with "vectors" and will not even see the warning `:-P`


---

Comment by git created at 2014-04-28 18:38:23

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-04-28 18:38:45

Now passes all tests except one, see discussion on the sage-support thread.

Nathann


---

Comment by git created at 2014-04-28 18:45:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-04-28 18:45:24

(all doctests pass !)


---

Comment by git created at 2014-04-28 18:46:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-04-28 18:46:44

Changing status from needs_work to needs_review.


---

Comment by nbruin created at 2014-04-28 19:02:48

The problem is not quite introduced by this change, but this change does make the problem a little more visible: Why are you singling out `Z/2Z x Z/3Z` as a group that can be explicitly represented and not
`Z^2/ span( [1,1],[-1,5])`, with generators the classes of the standard basis?


---

Comment by ncohen created at 2014-04-28 19:54:22

Yooooooooo !

> The problem is not quite introduced by this change, but this change does make the problem a little more visible: Why are you singling out `Z/2Z x Z/3Z` as a group that can be explicitly represented and not
> `Z^2/ span( [1,1],[-1,5])`, with generators the classes of the standard basis?

Do I misunderstand your question or are you saying that you would like to use any base you like instead of (1,0),(0,1), or the smith form ?

I just need this new form for a couple of things I am implementing... But I am afraid of having to touch these files myself, because I have a good idea of what I forgot about groups since I began a PhD in graph theory... and it scares me `:-D`

Nathann


---

Comment by nbruin created at 2014-04-29 00:17:19

Replying to [comment:14 ncohen]:
> Do I misunderstand your question or are you saying that you would like to use any base you like instead of (1,0),(0,1), or the smith form ?

Basically, yes. The problem is that presently, AdditiveAbelianGroup is a little too lax in what it accepts as "invariants". In the classification of (finite) abelian groups, the "invariants" `[a1,a2,...,ar]` are subject to the additional condition that `ai` divides `a(i+1)`. Otherwise they aren't really invariants.

If you're going to allow abelian groups to be specified in forms different from smith normal form, I think it's a little strange to just limit to these "diagonal" forms. In general, you specify a finitely generated abelian group using generators and relations, i.e., `ZZ^r` modulo some submodule. Since the underlying machinery is that of ZZ-modules anyway, why not do it properly?


---

Comment by ncohen created at 2014-04-29 06:55:25

Yoooooooooooo !

> If you're going to allow abelian groups to be specified in forms different from smith normal form, I think it's a little strange to just limit to these "diagonal" forms. In general, you specify a finitely generated abelian group using generators and relations, i.e., `ZZ^r` modulo some submodule. Since the underlying machinery is that of ZZ-modules anyway, why not do it properly?

Ahahaah. Very simple : I have no idea how. I already said that I didn't feel at ease editing group code, so if you want anything more general than what is in the branch, I'm sorry to say that you will have to write the code yourself `:-)`

And I agree with you that more bases should be allowed indeed.

Oh, and if you have any idea of how to make Sage see `G = GF(8,'x').cartesian_product(GF(5))` as a group, it would be cool by the way.


```
sage: G([1,1])+G([1,1])
TypeError: unsupported operand type(s) for +: 'CartesianProduct_with_category.element_class' and 'CartesianProduct_with_category.element_class'
```


God.. These things are SO broken :

```
sage: list(G)          
AttributeError: 'CartesianProduct_with_category' object has no attribute 'list'
```


Perhaps this is the problem :

```
sage: g=GF(8,'x')              
sage: g.category()             
Category of finite fields
sage: gg=g.cartesian_product(g)
sage: gg.category()            
Category of Cartesian products of monoids
```


This `gg` should be a product of groups I guess...

Nathann


---

Comment by git created at 2014-05-18 18:36:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-05-18 18:36:22

Fixed.

Nathann


---

Comment by rws created at 2014-05-19 06:03:24


```
sage -t --long src/sage/combinat/designs/database.py  # 4 doctests failed
sage -t --long src/sage/combinat/designs/orthogonal_arrays.py  # 2 doctests failed
```



---

Comment by rws created at 2014-05-19 06:03:24

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2014-05-19 07:59:21

Not on my computer.... Can you tell me which doctests fail ?

Nathann


---

Attachment

log of doctest fails


---

Comment by rws created at 2014-05-19 08:48:34

Log is attached. Hope you tested 6.3.beta1.


---

Comment by ncohen created at 2014-05-19 09:01:09

Sorry, the reason was more stupid than that : I had forgotten to recompile.

Btw, do you plan on reviewing all the tickets you set to `needs_work` ?

Nathann


---

Comment by ncohen created at 2014-05-19 09:01:09

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-05-19 09:01:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-05-19 09:06:20

Replying to [comment:24 ncohen]:
> Btw, do you plan on reviewing all the tickets you set to `needs_work` ?
No.


---

Comment by ncohen created at 2014-08-16 13:49:59

Yo Travis ! Now it is my turn `:-)`

Nathann


---

Comment by tscrim created at 2014-08-16 17:41:30

Hey Nathann,

I gave the `short_repr` more functional-type and cleaner (IMO) implementation. I've also made some lines shorter and made line breaks at more logical positions.

As for finding the orders of the original cyclic groups in `short_repr`, I think the current implementation is okay for now. You could make this data into a (cached) method, but IDK if this is worthwhile or useful for anyone. A "better" fix would be to pass this data from the factory function to the class, but you should deal with handling old pickles which don't (a priori) contain this part of the class's input.

So in the end, if you're okay with my changes, then positive review.
----
New commits:


---

Comment by ncohen created at 2014-08-16 19:11:14

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-08-16 19:11:14

Looks good ! Thank you for that. It is risky to touch combinat/designs/database.py these days but hopefully this won't conflict with anything as you only modify function at the middle of the code `:-P`

Thanks for your help !

Nathann


---

Comment by vbraun created at 2014-08-18 14:54:20

Resolution: fixed


---

Comment by jhpalmieri created at 2014-08-27 18:18:20

A question: with the old behavior, I could do

```
G = AdditiveAbelianGroup([0,0])
G(a)
```

and have it return something sensible (and the _same_ thing) whether `a` was a vector, a list, a tuple, or an element of `G`. This now gives a deprecation warning if `a` is a list or tuple. On the other hand

```
G.linear_combination_of_smith_form_gens(a)
```

gives an outright error if `a` is an element of `G`. Should I do

```
G(vector(a))
```

to recover this behavior?


---

Comment by vbraun created at 2014-08-27 18:32:13

I think you only got the _same_ thing by coincidence, the Smith form generators happened to be chosen equal to the given basis. But we didn't make any guarantees that this was so, and for more complicated groups you'd be in for a surprise.


---

Comment by jhpalmieri created at 2014-08-27 18:48:14

So if I'm working with free abelian groups, there is no way to guarantee that `G(a)` will return the same thing if `a` is the tuple (1,2), the list [1,2], the vector (1,2), or the group element (1,2)?


---

Comment by vbraun created at 2014-08-27 19:27:38

`G(vector(a))` should work, I think. Do you want linear combinations of Smith form generators or linear combinations of given generators (if the group doesn't happen to be free)?


---

Comment by jhpalmieri created at 2014-08-27 19:56:56

For my particular uses, I only want to work with free groups. If I happened to have a non-free group, I think I would want linear combinations of given generators.


---

Comment by rbeezer created at 2015-05-20 19:57:18

I bumped into this doctesting Judson's Abstract Algebra book.


```
G = AdditiveAbelianGroup([14])
b = G([2])
```


was fine for the novices, but `b = G(vector([2]))` looks more complicated than necessary.

Anybody on this ticket have a better idea?  I mean besides me ever getting my act together on #9773.


---

Comment by ncohen created at 2015-05-20 20:00:14

> was fine for the novices, but `b = G(vector([2]))` looks more complicated than necessary.

What do you mean? `G([2])` works in the latest release, and it will stay this way: we will only remove the *warning* in several months.

The meaning of the command changed, but the command itsels will remain available.

Nathann


---

Comment by rbeezer created at 2015-05-20 21:06:33

OK, I understood the warning to mean behavior was changing and students were going to need to do some sort of linear combination drill.  (Yes, I did skim through this ticket.)  And of course the warning gets in the way for doctesting, but I know how to work around that cleanly.

Thanks very much for the quick and helpful reply, Nathann.

Rob
