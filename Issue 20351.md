# Issue 20351: Add a method divides for MPolynomial_libsingular

Issue created by migration from https://trac.sagemath.org/ticket/20588

Original creator: bruno

Original creation time: 2016-05-11 12:45:36

Currently, the divisibility test for multivariate polynomials (using libSingular) is the generic one implemented in `src/sage/structure/element.pyx` and uses a test of the form `other%self == 0`. This can be fasten a lot using libSingular's `kNF` function, with the "laziness" attribute. Below is an example of timings, with the new code:


```python
sage: R.<x,y,z> = ZZ[]
sage: p = R.random_element(20, terms=30)
sage: q = prod(R.random_element(20, terms=30) for _ in range(5))
sage: r = p*q
sage: %time p.divides(r)
CPU times: user 1.26 s, sys: 23.7 ms, total: 1.29 s
Wall time: 1.29 s
True
sage: %time r%p == 0
CPU times: user 8min 41s, sys: 68 ms, total: 8min 41s
Wall time: 8min 41s
True
```



---

Comment by bruno created at 2016-05-11 12:54:55

Changing status from new to needs_review.


---

Comment by bruno created at 2016-05-11 12:54:55

New commits:


---

Comment by tscrim created at 2016-05-11 13:57:39

A few minor things:

```diff
     def divides(self, other):
         """
-        Return `True` if this polynomial divides `other`.
+        Return ``True`` if this polynomial divides ``other``.
 
         EXAMPLES::
 
             sage: R.<x,y,z> = QQ[]
             sage: p = 3*x*y + 2*y*z + x*z
             sage: q = x + y + z + 1
             sage: r = p * q
             sage: p.divides(r)
             True
             sage: q.divides(p)
             False
             sage: r.divides(0)
             True
             sage: R.zero().divides(r)
             False
             sage: R.zero().divides(0)
             True
         """
         if self.is_zero():
             return other.is_zero()
         cdef ideal *_I
         cdef MPolynomialRing_libsingular parent = self._parent
         cdef ring *r = self._parent_ring
         cdef poly *rem
 
-        if r!=currRing: rChangeCurrRing(r)
+        if r != currRing:
+            rChangeCurrRing(r)
 
         _I = idInit(1, 1)
         if not (isinstance(other,MPolynomial_libsingular) \
                and (<MPolynomial_libsingular>other)._parent is parent):
             try:
                 other = parent._coerce_c(other)
             except TypeError as msg:
                 id_Delete(&_I,r)
                 raise TypeError, msg
 
         _I.m[0] = p_Copy(self._poly, r)
 
-        if r!=currRing: rChangeCurrRing(r)
+        if r != currRing:
+            rChangeCurrRing(r)
         sig_on()
         rem = kNF(_I, NULL, (<MPolynomial_libsingular>other)._poly, 0, 1)
         sig_off()
         id_Delete(&_I, r)
         res = new_MP(parent, rem).is_zero()
         return res
```

Once you make those changes, you can set a positive review on my behalf.


---

Comment by git created at 2016-05-12 15:11:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2016-05-12 15:13:28

Changing status from needs_review to positive_review.


---

Comment by bruno created at 2016-05-12 15:13:28

Replying to [comment:4 tscrim]:
> A few minor things:
> [...]
> Once you make those changes, you can set a positive review on my behalf.

Done, thanks!


---

Comment by vbraun created at 2016-05-21 09:37:05

Resolution: fixed
