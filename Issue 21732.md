# Issue 21732: py3 get rid of cmp() in two pyx files in libs/singular

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2016-11-25 09:57:44

CC:  tscrim jdemeyer aapitzsch

step to py3


---

Comment by chapoton created at 2016-11-25 09:58:14

New commits:


---

Comment by git created at 2016-11-27 13:21:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-12-02 19:27:42

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-12-02 19:27:42

this seems to work, if the doctest failure in trace is not related.


---

Comment by tscrim created at 2016-12-03 03:09:03

I would expect this to have a problem with `!=` as it returns `NotImplemented` when they are different classes. In that case, I would expect it to return `False`.


---

Comment by chapoton created at 2016-12-03 09:32:19

I think that there is a general Python code that implies that two objects whose comparison returns NotImplemented are not equal. I may be wrong.


---

Comment by tscrim created at 2016-12-03 16:00:19

I thought what happens is that is tries to switch the arguments. What I suspect is that if both return `NotImplemented`, it falls back upon identity comparison. Yet, I think explicit is better than implicit and relying on (subtle) Python behavior is not good. We know they are not equal at that point, so let's return that.


---

Comment by chapoton created at 2016-12-03 17:57:38

I would say that the current code works correctly.

Note that richcmp is not only about equality or unequality, but also about comparison. And the only solution is to refuse to compare things when this is meaningless. If I have understood correctly, Python3 is much more restrictive on what it is allowed to compare.


---

Comment by tscrim created at 2016-12-03 18:40:45

However, for the case of inequality, we can do a valid comparison as we know at that point they are unequal. Python3 is more restrictive on inequalities, but this is not an inequality check.


---

Comment by jdemeyer created at 2016-12-04 08:37:56

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-12-04 08:42:18

This is very wrong:

```
            lx = <SingularFunction>self
            rx = <SingularFunction>other
}}}            
since those casts don't check that they make sense. You need a _checking_ cast
{{{
            lx = <SingularFunction?>self
            rx = <SingularFunction?>other
}}}
Also please add this doctest:
{{{
sage: groebner == None
}}}
With this current branch, this segfaults (because of the reason above).


---

Comment by git created at 2016-12-04 09:26:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-12-04 10:34:00

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-12-04 10:34:00

I have made Jeroen's suggested change.


---

Comment by chapoton created at 2016-12-06 16:32:43

*ping*


---

Comment by jdemeyer created at 2016-12-08 11:27:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-12-10 12:38:11

Resolution: fixed
