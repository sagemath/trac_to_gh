# Issue 30098: openblas: clear out .pc symlinks before installation

archive/issues_030098.json:
```json
{
    "body": "CC:  @yuan-zhou @jhpalmieri @dimpase @embray\n\nWhen switching from system BLAS to SPKG openblas, the following errors have been reported:\n\n```\nCopying package files from temporary location /Users/yzh/sagecopies/sage/worktree-2020/local/var/tmp/sage/build/openblas-0.3.9/inst to /Users/yzh/sagecopies/sage/worktree-2020/local\ncp: /Users/yzh/sagecopies/sage/worktree-2020/local/./lib/pkgconfig/cblas.pc: Permission denied\ncp: /Users/yzh/sagecopies/sage/worktree-2020/local/./lib/pkgconfig/blas.pc: Permission denied\ncp: /Users/yzh/sagecopies/sage/worktree-2020/local/./lib/pkgconfig/lapack.pc: Permission denied\n************************************************************************\nError copying files for openblas-0.3.9.\n```\n\n\nThe correct fix is described in #29585#comment:9\nand #29387 + #29386\n\n\nThis ticket is a quick workaround for Sage 9.2.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30335\n\n",
    "created_at": "2020-08-11T15:29:19Z",
    "labels": [
        "build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "openblas: clear out .pc symlinks before installation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30098",
    "user": "@mkoeppe"
}
```
CC:  @yuan-zhou @jhpalmieri @dimpase @embray

When switching from system BLAS to SPKG openblas, the following errors have been reported:

```
Copying package files from temporary location /Users/yzh/sagecopies/sage/worktree-2020/local/var/tmp/sage/build/openblas-0.3.9/inst to /Users/yzh/sagecopies/sage/worktree-2020/local
cp: /Users/yzh/sagecopies/sage/worktree-2020/local/./lib/pkgconfig/cblas.pc: Permission denied
cp: /Users/yzh/sagecopies/sage/worktree-2020/local/./lib/pkgconfig/blas.pc: Permission denied
cp: /Users/yzh/sagecopies/sage/worktree-2020/local/./lib/pkgconfig/lapack.pc: Permission denied
************************************************************************
Error copying files for openblas-0.3.9.
```


The correct fix is described in #29585#comment:9
and #29387 + #29386


This ticket is a quick workaround for Sage 9.2.



Issue created by migration from https://trac.sagemath.org/ticket/30335





---

archive/issue_comments_427950.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-08-11T16:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30098#issuecomment-427950",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_427951.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-11T16:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30098#issuecomment-427951",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_427952.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-11T16:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30098#issuecomment-427952",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_427953.json:
```json
{
    "body": "lgtm",
    "created_at": "2020-08-11T16:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30098#issuecomment-427953",
    "user": "@dimpase"
}
```

lgtm



---

archive/issue_comments_427954.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-08-11T17:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30098#issuecomment-427954",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_427955.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-14T22:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30098#issuecomment-427955",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_427956.json:
```json
{
    "body": "Ah, no, spkg-install scripts should **not** make changes to `$SAGE_LOCAL`.  If it's absolutely necessary to you can do that in an `spkg-preinst` script.",
    "created_at": "2020-08-31T15:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30098#issuecomment-427956",
    "user": "@embray"
}
```

Ah, no, spkg-install scripts should **not** make changes to `$SAGE_LOCAL`.  If it's absolutely necessary to you can do that in an `spkg-preinst` script.



---

archive/issue_comments_427957.json:
```json
{
    "body": "Follow-up: #30480",
    "created_at": "2020-08-31T16:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30098",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30098#issuecomment-427957",
    "user": "@mkoeppe"
}
```

Follow-up: #30480
