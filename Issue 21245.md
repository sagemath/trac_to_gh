# Issue 21245: disabling the MAPLE interface to linbox

Issue created by migration from https://trac.sagemath.org/ticket/21482

Original creator: dimpase

Original creation time: 2016-09-13 11:09:45

CC:  dcoudert

this is to address an issue [mentioned](https://trac.sagemath.org/ticket/17635#comment:215) on #17635. 


---

Comment by leif created at 2016-09-13 14:05:13

Ok, I'll create a branch, but I've also commented on #17635 on how my patch there could be tested until then...


---

Comment by leif created at 2016-09-13 14:08:25

Random comment:  It seems we should disable the use of "external" packages when building  bdists anyway, as these might not be present on target machines even with the same distro.


---

Comment by leif created at 2016-09-13 14:11:44

Replying to [comment:2 leif]:
> Ok, I'll create a branch, but I've also commented on #17635 on how my patch there could be tested until then...

P.S.:  TBH, I didn't create one yesterday also because I didn't recall into which beta #17635 finally got merged... ;-)  (Again, `sudo fill merged_field`.)


---

Comment by dimpase created at 2016-09-13 14:19:02

Changing status from new to needs_review.


---

Comment by dimpase created at 2016-09-13 14:19:02

here is the patch.
please test.
----
New commits:


---

Comment by leif created at 2016-09-13 14:19:42

P.P.S.:  There are IMHO a couple of issues related to this we should report and fix upstream, but on another ticket, as this is just for working around the current brokenness _in Sage_.

After all, I'm not patching `configure.ac`, just `configure`, which is also much easier to maintain.


---

Comment by dimpase created at 2016-09-13 14:21:59

somehow I managed to clear CC field while changing the ticket, sorry. Restored. Ready for review.


---

Comment by leif created at 2016-09-13 14:26:21

Replying to [comment:5 dimpase]:
> here is the patch.
> please test.
> ----
> New commits:
> ||[02bcc52](https://git.sagemath.org/sage.git/commit?id=02bcc52d7eacb53fa209261e6dc9092b39345240)||`patch from comment 231 of #17635`||

Well, that's a slightly different patch (to `configure`), also "disabling" `--with-default=yes` (to not say _break_ the latter...).


---

Comment by dimpase created at 2016-09-13 14:32:59

Replying to [comment:9 leif]:
> Replying to [comment:5 dimpase]:
> > here is the patch.
> > please test.
> > ----
> > New commits:
> > ||[02bcc52](https://git.sagemath.org/sage.git/commit?id=02bcc52d7eacb53fa209261e6dc9092b39345240)||`patch from comment 231 of #17635`||
> 
> Well, that's a slightly different patch (to `configure`), also "disabling" `--with-default=yes` (to not say _break_ the latter...).

it should do the same thing - I got lost in nested robot-written ifs there...


---

Comment by leif created at 2016-09-13 14:41:27

Replying to [comment:10 dimpase]:
> Replying to [comment:9 leif]:
> > Replying to [comment:5 dimpase]:
> > > here is the patch.
> > > please test.
> > > ----
> > > New commits:
> > > ||[02bcc52](https://git.sagemath.org/sage.git/commit?id=02bcc52d7eacb53fa209261e6dc9092b39345240)||`patch from comment 231 of #17635`||
> > 
> > Well, that's a slightly different patch (to `configure`), also "disabling" `--with-default=yes` (to not say _break_ the latter...).
> 
> it should do the same thing - I got lost in nested robot-written ifs there...

Well, what was the reason to change the patch to `configure` at all?

If someone now changes `spkg-install`, it's again broken.


---

Comment by leif created at 2016-09-13 14:44:46

By the way, `--with-maple=no` doesn't work as expected because we also pass `--with-all=...`, but I think I already mentioned that on #17635.


---

Comment by chapoton created at 2016-09-13 15:20:49

seems to work for me


---

Comment by cpernet created at 2016-09-13 15:28:44

The --with-all forces all --with-XXX to yes, therefore --with-maple was not working.

I suggest to simply change the `--with-all="$SAGE_LOCAL"` with `--with-default="$SAGE_LOCAL"`.

This seems to be a simpler/smaller fix and works on my box.
Let me know how it works on yours before I mess up with Dima's patch.

Clément


---

Comment by leif created at 2016-09-13 15:32:47

Replying to [comment:14 cpernet]:
> The --with-all forces all --with-XXX to yes, therefore --with-maple was not working.
> 
> I suggest to simply change the `--with-all="$SAGE_LOCAL"` with `--with-default="$SAGE_LOCAL"`.
> 
> This seems to be a simpler/smaller fix and works on my box.
> Let me know how it works on yours before I mess up with Dima's patch.
> 
> Clément

See my previous comments; IMHO there are things to get fixed _in other ways_ upstream (besides the compiler errors themselves), I'll probably post on a further ticket, since here we just want to fix the Sage build.


---

Comment by cpernet created at 2016-09-13 15:56:49

Replying to [comment:15 leif]:
> 
> IMHO there are things to get fixed _in other ways_ upstream

Of course. This is now [https://github.com/linbox-team/linbox/issues/38](https://github.com/linbox-team/linbox/issues/38)

> (besides the compiler errors themselves),

I'm not sure to have found which one you're referring to.

For me, the option `--with-all` is the bug here, as we definitely do not need/want LinBox to look for all of its possible dependencies.
The `--with-default` is the one we want, to specify the common folder where to find the dependencies that are turned on when found (namely fflas-ffpack, NTL, IML).

I see no point in adding a patch to the configure file.


---

Comment by dcoudert created at 2016-09-14 08:23:33

With this patch, I'm now able to compile 7.4-beta4. Thank you !

Should I set this ticket to positive review or you want to improve it first?


---

Attachment

Alternative fix


---

Comment by dimpase created at 2016-09-14 10:57:00

OK, Clement, why won't you take over and produce a git branch and a link to the updated linbox tarball?


---

Comment by cpernet created at 2016-09-14 11:11:20

Replying to [comment:18 dimpase]:
> OK, Clement, why won't you take over and produce a git branch and a link to the updated linbox tarball?

Sure, I'll do it. I just didn't want to step on your toes, since you already posted a branch.

No need to update the linbox tarball.


---

Comment by cpernet created at 2016-09-14 11:11:49

New commits:


---

Comment by cpernet created at 2016-09-14 11:13:01

`@`dcoudert can you confirm this new branch fixes your compilation error?


---

Comment by dcoudert created at 2016-09-14 13:32:12

I made a distclean before trying this patch and it's working !
Cool :)


---

Comment by dcoudert created at 2016-09-15 08:36:48

Can I set this ticket to positive review? or is it better to wait for feedback from others?


---

Comment by cpernet created at 2016-09-15 08:42:39

You can, as you could initially reproduce the bug and now say that it's fixed with this branch.


---

Comment by dcoudert created at 2016-09-16 06:53:08

This patch solves my compilation error with 7.4-beta4.
Thank you.
David.


---

Comment by dcoudert created at 2016-09-16 06:53:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-09-17 15:25:30

Resolution: fixed
