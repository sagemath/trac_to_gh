# Issue 19389: OpenSSL hack for El Capitan

Issue created by migration from https://trac.sagemath.org/ticket/19626

Original creator: vbraun

Original creation time: 2015-11-26 13:15:02

CC:  u/vbraun/openssl_hack_for_el_capitan




---

Comment by vbraun created at 2015-11-26 14:22:09

Changing type from PLEASE CHANGE to defect.


---

Comment by vbraun created at 2015-11-26 14:22:09

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-11-26 14:22:09

New commits:


---

Comment by vbraun created at 2015-11-26 14:22:09

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by jdemeyer created at 2015-11-26 15:36:55

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-11-26 15:36:55

I can't test this but if you say that it works, I believe you.

Please merge this in the same beta as #18542, otherwise you'll need to bump the version number of the package.


---

Comment by jhpalmieri created at 2015-11-26 17:11:47

It seems to work on OS X 10.10 (or at least when I build Python, it looks in the indicated place for the openssl headers), but I don't have access to my OS X 10.11 machine today.


---

Comment by dimpase created at 2015-11-26 18:06:33

Cool, after applying this patch on OSX 10.11 and rebuilding python I indeed can do

```
>> import ssl
```



---

Comment by vbraun created at 2015-11-26 18:23:46

Resolution: fixed


---

Comment by jhpalmieri created at 2015-11-26 20:40:41

Replying to [comment:5 dimpase]:
> Cool, after applying this patch on OSX 10.11 and rebuilding python I indeed can do
> {{{
> >> import ssl
> }}} 

Could you try building from scratch? When I rebuild Python everything works, but when I build from scratch, Python fails to build. This is on OS X 10.10:

```
Installing valgrind suppression file...
Testing importing of various modules...
ctypes module imported OK
math module imported OK
hashlib module imported OK
crypt module imported OK
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ImportError: No module named readline
readline module failed to import
socket module imported OK
Error: One or more modules failed to import.
```

Earlier in the log:

```
building 'readline' extension
gcc -fno-strict-aliasing -I/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdk/MacOSX.sdk/usr/include/ -DNDEBUG -g -fwrapv -O3 -Wall -I/Users/palmieri/Desktop/TEMP/sage/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/palmieri/Desktop/TEMP/sage/local/var/tmp/sage/build/python2-2.7.9/src/Include -I/Users/palmieri/Desktop/TEMP/sage/local/var/tmp/sage/build/python2-2.7.9/src -c /Users/palmieri/Desktop/TEMP/sage/local/var/tmp/sage/build/python2-2.7.9/src/Modules/readline.c -o build/temp.macosx-10.9-x86_64-2.7/Users/palmieri/Desktop/TEMP/sage/local/var/tmp/sage/build/python2-2.7.9/src/Modules/readline.o
Modules/readline.c: In function 'flex_complete':
Modules/readline.c:868:5: error: 'rl_completion_suppress_append' undeclared (first use in this function)
     rl_completion_suppress_append = 0;
     ^
Modules/readline.c:868:5: note: each undeclared identifier is reported only once for each function it appears in
Modules/readline.c: In function 'readline_until_enter_or_signal':
Modules/readline.c:988:5: error: 'rl_catch_signals' undeclared (first use in this function)
     rl_catch_signals = 0;
     ^

[snip]


Failed to build these modules:
_elementtree       _scproxy           pyexpat         
readline                                              
```

Could it be picking up the readline headers from the new include path?

I think this needs to be reopened, since it doesn't build from scratch successfully on OS X 10.10.


---

Comment by dimpase created at 2015-11-26 20:55:47

Replying to [comment:7 jhpalmieri]:
> Replying to [comment:5 dimpase]:
> > Cool, after applying this patch on OSX 10.11 and rebuilding python I indeed can do
> > {{{
> > >> import ssl
> > }}} 
> 
> Could you try building from scratch? When I rebuild Python everything works, but when I build from scratch, Python fails to build. 

presently it is building in my office, I'll only know the outcome in about 14 hours from now on.
In the worst case one can copy or link `...wift-migrator/sdk/MacOSX.sdk/usr/include/openssl/` somewhere, so that anything outside `openssl/` from there is not looked up...


---

Comment by vbraun created at 2015-11-26 22:02:33

Changing status from closed to new.


---

Comment by vbraun created at 2015-11-26 22:02:33

Resolution changed from fixed to 


---

Comment by vbraun created at 2015-11-26 22:26:34

New commits:


---

Comment by vbraun created at 2015-11-26 22:26:34

Changing status from new to needs_review.


---

Comment by git created at 2015-11-26 22:27:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-11-26 23:50:28

Rebuild from scratch works now


---

Comment by jhpalmieri created at 2015-11-27 00:19:07

Works for me, too.


---

Comment by vbraun created at 2015-11-27 08:38:43

Resolution: fixed
