# Issue 17117: change name of interval_iterator for posets

archive/issues_017117.json:
```json
{
    "body": "CC:  @jm58660\n\nKeywords: poset, interval\n\nThe current \"interval_iterator\" only iterates over strict intervals.\n\nThis is confusing and not coherent with the natural and well-established mathematical convention that includes all singletons [x,x] in the set of intervals.\n\nI propose to rename that method to \"strict_interval_iterator\", deprecate it and then maybe later redirect it to the current \"relations_iterator\", that does the job.\n\nI also introduce a new method \"interval_number\" that just counts the intervals.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17354\n\n",
    "created_at": "2014-11-16T20:35:58Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "change name of interval_iterator for posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17117",
    "user": "https://github.com/fchapoton"
}
```
CC:  @jm58660

Keywords: poset, interval

The current "interval_iterator" only iterates over strict intervals.

This is confusing and not coherent with the natural and well-established mathematical convention that includes all singletons [x,x] in the set of intervals.

I propose to rename that method to "strict_interval_iterator", deprecate it and then maybe later redirect it to the current "relations_iterator", that does the job.

I also introduce a new method "interval_number" that just counts the intervals.

Issue created by migration from https://trac.sagemath.org/ticket/17354





---

archive/issue_comments_227249.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-11-16T21:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227249",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_227250.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-16T21:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227250",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_227251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-16T21:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227252.json:
```json
{
    "body": "Don't you prefer to add a flag `strict=False` in the function ?.. The name `strict_interval_iterator` is not that natural to find when you do not know it exists..\n\nNathann",
    "created_at": "2014-11-17T15:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227252",
    "user": "https://github.com/nathanncohen"
}
```

Don't you prefer to add a flag `strict=False` in the function ?.. The name `strict_interval_iterator` is not that natural to find when you do not know it exists..

Nathann



---

archive/issue_comments_227253.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-17T16:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227254.json:
```json
{
    "body": "Isn't `relations_iterator()` already function you are looking for?\n\n(But of course this should be documented and docs linked to each other.)",
    "created_at": "2014-11-18T08:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227254",
    "user": "https://github.com/jm58660"
}
```

Isn't `relations_iterator()` already function you are looking for?

(But of course this should be documented and docs linked to each other.)



---

archive/issue_comments_227255.json:
```json
{
    "body": "If `lequal_matrix` has already been computed, then I guess that faster way to compute number of intervals is to sum up the elements of matrix.",
    "created_at": "2014-11-18T08:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227255",
    "user": "https://github.com/jm58660"
}
```

If `lequal_matrix` has already been computed, then I guess that faster way to compute number of intervals is to sum up the elements of matrix.



---

archive/issue_comments_227256.json:
```json
{
    "body": "Concerning speed: using\n\n```\ndef interval_number1(self):\n    return sum(sum(u for u in self.lequal_matrix()))\n```\nis much slower, even when the lequal matrix is precomputed.",
    "created_at": "2014-11-18T19:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227256",
    "user": "https://github.com/fchapoton"
}
```

Concerning speed: using

```
def interval_number1(self):
    return sum(sum(u for u in self.lequal_matrix()))
```
is much slower, even when the lequal matrix is precomputed.



---

archive/issue_comments_227257.json:
```json
{
    "body": "Is it the same if you call `P._hasse_diagram.lequal_matrix` instead ? The poset function creates a copy before returning it.\n\nNathann",
    "created_at": "2014-11-19T04:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227257",
    "user": "https://github.com/nathanncohen"
}
```

Is it the same if you call `P._hasse_diagram.lequal_matrix` instead ? The poset function creates a copy before returning it.

Nathann



---

archive/issue_comments_227258.json:
```json
{
    "body": "Yes, the same. Still slower by summing over the matrix.\n\nFor a poset with 429 elements, with lequal_matrix precomputed, first with `_hasse_diagram.lequal_matrix`:\n\n```\nsage: %timeit interval_number1(P)\n10 loops, best of 3: 84.3 ms per loop\n```\nthen with search in hasse diagram:\n\n```\nsage: %timeit interval_number(P)\n10 loops, best of 3: 40.3 ms per loop\n```",
    "created_at": "2014-11-19T19:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227258",
    "user": "https://github.com/fchapoton"
}
```

Yes, the same. Still slower by summing over the matrix.

For a poset with 429 elements, with lequal_matrix precomputed, first with `_hasse_diagram.lequal_matrix`:

```
sage: %timeit interval_number1(P)
10 loops, best of 3: 84.3 ms per loop
```
then with search in hasse diagram:

```
sage: %timeit interval_number(P)
10 loops, best of 3: 40.3 ms per loop
```



---

archive/issue_comments_227259.json:
```json
{
    "body": "Okayokay. Then BFS.\n\nI set this patch to `needs_work` as the naming problem has to be dealt with. Your `interval_iterator` is already named `relations_iterator` (you can add a 'strict' flag there too if you want), and you should probably rename your `iterval_number` to `relations_number`.\n\nBy the way perhaps you may want to change the code of `interval_iterator`. I don't quite see how it works but I would say that your code is faster.\n\nNathann",
    "created_at": "2014-11-20T04:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227259",
    "user": "https://github.com/nathanncohen"
}
```

Okayokay. Then BFS.

I set this patch to `needs_work` as the naming problem has to be dealt with. Your `interval_iterator` is already named `relations_iterator` (you can add a 'strict' flag there too if you want), and you should probably rename your `iterval_number` to `relations_number`.

By the way perhaps you may want to change the code of `interval_iterator`. I don't quite see how it works but I would say that your code is faster.

Nathann



---

archive/issue_comments_227260.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-20T04:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227260",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_227261.json:
```json
{
    "body": "Replying to [comment:10 chapoton]:\n\n> Yes, the same. Still slower by summing over the matrix.\n\n\nConfirmed with 1024-element Boolean lattice. We must make Nathann to optimize matrix code also, not only static graph backend. `:=)`. Actually I don't know if Sage has good support for matrices over booleans or plain ints. It seems unnecessary to have a matrix of `Integer`s when you only store zeros and ones.\n\nWhy you do `hd = self.hasse_diagram()`? Would be faster to say `hd = self._hasse_diagram`.",
    "created_at": "2014-11-20T11:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227261",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:10 chapoton]:

> Yes, the same. Still slower by summing over the matrix.


Confirmed with 1024-element Boolean lattice. We must make Nathann to optimize matrix code also, not only static graph backend. `:=)`. Actually I don't know if Sage has good support for matrices over booleans or plain ints. It seems unnecessary to have a matrix of `Integer`s when you only store zeros and ones.

Why you do `hd = self.hasse_diagram()`? Would be faster to say `hd = self._hasse_diagram`.



---

archive/issue_comments_227262.json:
```json
{
    "body": "Yo !\n\n> Confirmed with 1024-element Boolean lattice. We must make Nathann to optimize matrix code also, not only static graph backend. `:=)`. Actually I don't know if Sage has good support for matrices over booleans or plain ints. It seems unnecessary to have a matrix of `Integer`s when you only store zeros and ones.\n\n\nWell, I needed that at some point: sage/misc/binary_matrix.pxi\n\nNathann",
    "created_at": "2014-11-20T12:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227262",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> Confirmed with 1024-element Boolean lattice. We must make Nathann to optimize matrix code also, not only static graph backend. `:=)`. Actually I don't know if Sage has good support for matrices over booleans or plain ints. It seems unnecessary to have a matrix of `Integer`s when you only store zeros and ones.


Well, I needed that at some point: sage/misc/binary_matrix.pxi

Nathann



---

archive/issue_comments_227263.json:
```json
{
    "body": "Replying to [comment:13 ncohen]:\n\n> Well, I needed that at some point: sage/misc/binary_matrix.pxi\n\n\nA place for improvement in `hasse_diagram.py`?\n\n`_leq_matrix` is directly referenced only twice. I don't know if it would be faster to invert it for getting m\u00f6bius function matrix by converting it to scipy or numpy matrix. And at least memory would be saved if we save bits when we need bits and not integers. Actually we could have upper triangle of matrix to be lequal-matrix and lower triangle to be m\u00f6bius-matrix.\n\nAnd bit matrix could count ones by `POPCNT` instruction. `:=)`.\n\n...and sorry for off-topic.",
    "created_at": "2014-11-21T11:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227263",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:13 ncohen]:

> Well, I needed that at some point: sage/misc/binary_matrix.pxi


A place for improvement in `hasse_diagram.py`?

`_leq_matrix` is directly referenced only twice. I don't know if it would be faster to invert it for getting möbius function matrix by converting it to scipy or numpy matrix. And at least memory would be saved if we save bits when we need bits and not integers. Actually we could have upper triangle of matrix to be lequal-matrix and lower triangle to be möbius-matrix.

And bit matrix could count ones by `POPCNT` instruction. `:=)`.

...and sorry for off-topic.



---

archive/issue_comments_227264.json:
```json
{
    "body": "(answered by email as I have been told repeatedly to stop polluting threads)",
    "created_at": "2014-11-21T16:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227264",
    "user": "https://github.com/nathanncohen"
}
```

(answered by email as I have been told repeatedly to stop polluting threads)



---

archive/issue_comments_227265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-21T16:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227266.json:
```json
{
    "body": "Hello,\n\nI did some work, in particular using always 'relations_' instead of 'intervals_' (which are still there as simple aliases) and introducing an alternative algorithm in 'relations_iterator'. It indeed seems to be faster than the existing matrix search. Either it can be kept as the only algo, or we can propose the choice with the previous algorithm ?",
    "created_at": "2014-11-21T16:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227266",
    "user": "https://github.com/fchapoton"
}
```

Hello,

I did some work, in particular using always 'relations_' instead of 'intervals_' (which are still there as simple aliases) and introducing an alternative algorithm in 'relations_iterator'. It indeed seems to be faster than the existing matrix search. Either it can be kept as the only algo, or we can propose the choice with the previous algorithm ?



---

archive/issue_comments_227267.json:
```json
{
    "body": "Hello !\n\nRight now the code looks weird as you added a 'algorithm' flag without documentation. Also, it seems that one algorithm can only be used when strict is False, which is not really justified (enumerating all [x,x] intervals can be done manually).\n\nAnd I still do not see the point of this `chains().elements_of_depth_iterator(2)`.\n\nAbout keeping different algorithms: given that this algorithm is not very complicated I would personally keep only one (we don't need two to double-check the result) but it depends on the developper I guess, so do as you like. It just needs to be documented if you keep everything.\n\nAlso: is there any reason why you seem to avoid using the algorithm of `relations_numbers` in `relations_iterator` ?\n\nNathann",
    "created_at": "2014-11-21T17:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227267",
    "user": "https://github.com/nathanncohen"
}
```

Hello !

Right now the code looks weird as you added a 'algorithm' flag without documentation. Also, it seems that one algorithm can only be used when strict is False, which is not really justified (enumerating all [x,x] intervals can be done manually).

And I still do not see the point of this `chains().elements_of_depth_iterator(2)`.

About keeping different algorithms: given that this algorithm is not very complicated I would personally keep only one (we don't need two to double-check the result) but it depends on the developper I guess, so do as you like. It just needs to be documented if you keep everything.

Also: is there any reason why you seem to avoid using the algorithm of `relations_numbers` in `relations_iterator` ?

Nathann



---

archive/issue_comments_227268.json:
```json
{
    "body": "Correction: considering the code of `p.chains().elements_of_depth_iterator(2)` I don't think that we should call that. It works, but `depth=2` it is overkill.\n\nNathann",
    "created_at": "2014-11-21T17:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227268",
    "user": "https://github.com/nathanncohen"
}
```

Correction: considering the code of `p.chains().elements_of_depth_iterator(2)` I don't think that we should call that. It works, but `depth=2` it is overkill.

Nathann



---

archive/issue_comments_227269.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-21T19:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227270.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-21T19:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227270",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_227271.json:
```json
{
    "body": "Helloooooooo !\n\nWell, there was a couple of things I thought needed fixing:\n\n1) Adding the aliases in the index of functions\n\n2) Not build a list only to compute its length\n\nI also removed a comment in the doc about the ordering of the intervals which does not hold anymore.\n\nIf you agree with the commit at public/17354, you can change the ticket's status.\n\nThanks,\n\nNathann",
    "created_at": "2014-11-22T04:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227271",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooooo !

Well, there was a couple of things I thought needed fixing:

1) Adding the aliases in the index of functions

2) Not build a list only to compute its length

I also removed a comment in the doc about the ordering of the intervals which does not hold anymore.

If you agree with the commit at public/17354, you can change the ticket's status.

Thanks,

Nathann



---

archive/issue_comments_227272.json:
```json
{
    "body": "Your changes are ok. Thanks for the review. I put this into positive review.\n\n---\nNew commits:",
    "created_at": "2014-11-22T08:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227272",
    "user": "https://github.com/fchapoton"
}
```

Your changes are ok. Thanks for the review. I put this into positive review.

---
New commits:



---

archive/issue_comments_227273.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-22T08:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227273",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_227274.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-23T19:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17117#issuecomment-227274",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050061.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-23T19:59:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17117",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17117#event-50061"
}
```
