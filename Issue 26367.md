# Issue 26367: plot3d() broken

Issue created by migration from https://trac.sagemath.org/ticket/26604

Original creator: @robotdna

Original creation time: 2018-10-30 16:00:12

CC:  kcrisman embray tscrim

plot3d is broken and does not function. 

In Jupyter:

```
x,y,z,c=var('x y z c')

W = plot3d(sin(pi*((x)^2+(y)^2))/2,(x,-1,1),(y,-1,1), frame=False, color='purple', opacity=0.8)

show(W)
```


Gives me:


```
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-24-a4ff9ee1541f> in <module>()
----> 1 show(W)

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/rich_output/pretty_print.py in show(*args, **kwds)
    256         args[0].show()
    257         return
--> 258     pretty_print(*args, **kwds)

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/rich_output/pretty_print.py in pretty_print(*args, **kwds)
    227             pass
    228         elif len(args) == 1:
--> 229             dm.display_immediately(*args, **kwds)
    230         else:
    231             SequencePrettyPrinter(*args, **kwds).pretty_print()

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/rich_output/display_manager.py in display_immediately(self, obj, **rich_repr_kwds)
    841         """
    842         plain_text, rich_output = self._rich_output_formatter(obj, rich_repr_kwds)
--> 843         self._backend.display_immediately(plain_text, rich_output)
    844 
    845 

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/rich_output/backend_ipython.py in display_immediately(self, plain_text, rich_output)
    106             Example plain text output
    107         """
--> 108         formatted, metadata = self.displayhook(plain_text, rich_output)
    109         if not formatted:
    110             return

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/rich_output/backend_ipython.py in displayhook(self, plain_text, rich_output)
    540             from sage.repl.display.jsmol_iframe import JSMolHtml
    541             jsmol = JSMolHtml(rich_output, height=500)
--> 542             return ({u'text/html':  jsmol.iframe(),
    543                      u'text/plain': plain_text.text.get_unicode(),
    544             }, {})

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/display/jsmol_iframe.py in iframe(self)
    261             </iframe>
    262         """
--> 263         escaped_inner_html = self.inner_html().replace('"', '&quot;')
    264         iframe = IFRAME_TEMPLATE.format(
    265             script=self.js_script(),

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/display/jsmol_iframe.py in inner_html(self)
    237         """
    238         return INNER_HTML_TEMPLATE.format(
--> 239             script=self.js_script(),
    240             width=self._width,
    241             height=self._height,

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/display/jsmol_iframe.py in js_script(self)
    195         """
    196         script = [r"["]
--> 197         for line in self.script().splitlines():
    198             script += [r"  '{0}',".format(line)]
    199         script += [r"].join('\n');"]

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13467)()
   2314         if self.cache is None:
   2315             f = self.f
-> 2316             self.cache = f(self._instance)
   2317         return self.cache
   2318 

/home/duncan/anaconda3/lib/python3.6/site-packages/sage/repl/display/jsmol_iframe.py in script(self)
    162                         script += [
    163                             'pmesh {0} inline "'.format(bytes_to_str(obj)),
--> 164                             bytes_to_str(self._zip.open(meshfile).read()),
    165                             '"\n'
    166                         ]

/home/duncan/anaconda3/lib/python3.6/zipfile.py in open(self, name, mode, pwd, force_zip64)
   1350         else:
   1351             # Get info object for name
-> 1352             zinfo = self.getinfo(name)
   1353 
   1354         if mode == 'w':

/home/duncan/anaconda3/lib/python3.6/zipfile.py in getinfo(self, name)
   1279         if info is None:
   1280             raise KeyError(
-> 1281                 'There is no item named %r in the archive' % name)
   1282 
   1283         return info

KeyError: "There is no item named b'obj_1.pmesh' in the archive"


```


2d plots seem to function fine. 



---

Comment by jhpalmieri created at 2018-10-30 18:57:46

Changing component from graphics to python3.


---

Comment by jhpalmieri created at 2018-10-30 18:57:46

Changing priority from critical to major.


---

Comment by jhpalmieri created at 2018-10-30 18:57:46

Can you provide more information? Which OS, which version of Sage, etc.? For the record, it works for me with OS X, Sage 8.5.beta1.

Oh, I see, this is a Python 3 issue. Building Sage with Python 3 is experimental, and many things are still broken. Note also that even with Python 3, this works from the command line, so it is a combination of Python 3 + Jupyter which causes the problem.

Definitely a bug, but I don't think it is "critical".


---

Comment by chapoton created at 2018-12-16 10:25:04

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-12-16 10:25:04

fixed (this was easy)
----
New commits:


---

Comment by chapoton created at 2018-12-16 17:27:18

green bot, please review


---

Comment by tscrim created at 2018-12-17 02:02:14

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-12-17 02:02:14

LGTM.


---

Comment by vbraun created at 2018-12-23 23:40:52

Resolution: fixed


---

Comment by embray created at 2018-12-28 14:06:38

This tickets were closed as fixed after the Sage 8.5 release.
