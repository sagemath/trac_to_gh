# Issue 28531: another openblas build failure

Issue created by migration from https://trac.sagemath.org/ticket/28768

Original creator: zimmerma

Original creation time: 2019-11-19 10:03:30

CC:  dimpase slelievre

I get an error when compiling Sage 8.9 from source on my workstation (Intel(R) Core(TM) i5-4590 under Debian GNU/Linux bullseye/sid). The compilation of openblas fails (see attached file):

```
/usr/bin/ld: cannot find -l4
```



---

Attachment

Ticket retargeted after milestone closed


---

Comment by dimpase created at 2020-01-17 17:44:19

this looks very obscure.

How about using Sage 9.0 or even 9.1betas with openblas from the system?


---

Comment by embray created at 2020-01-17 17:49:30

Googling, and the only reference I can find to `-l4` would be if you passed the flag `-l4` to `make`, in which case if you got something like this it would be some kind of flag confusion.  I can't imagine otherwise what this would mean.


---

Comment by embray created at 2020-01-17 18:04:11

I'm also looking at the openblas build system and the spkg-install and I can't for the life of me figure out where this could be coming from.  Can you post your full environment?


---

Comment by embray created at 2020-01-17 18:09:15

Changing status from new to needs_info.


---

Comment by zimmerma created at 2020-01-17 19:24:24

Replying to [comment:5 embray]:
> I'm also looking at the openblas build system and the spkg-install and I can't for the life of me figure out where this could be coming from.  Can you post your full environment?

Erik, I guess you found it. I have in my environment:

```
export MAKEFLAGS="-j4 -l4"
```

which means to use 4 threads for `make`, but with a global limit of 4 for the cpu load.
I guess the `MAKEFLAGS` variable is used somewhere in the Sage and/or OpenBLAS makefile,
and not properly protected.

Paul


---

Comment by zimmerma created at 2020-01-17 21:06:25

I did extract the OpenBLAS-0.3.6 tarball shipped with Sage 8.9, did "make" in upstream/OpenBLAS-0.3.6, and the same issues appears:

```
gfortran -O2 -Wall -frecursive -m64  -mavx2  -o sblat1 sblat1.o ../libopenblas_haswellp-r0.3.6.a -lm -lpthread -lgfortran -lm -lpthread -lgfortran -L/usr/lib/gcc/x86_64-linux-gnu/9 -L/usr/lib/gcc/x86_64-linux-gnu/9/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/9/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/9/../../..  -l4 -lc  
/usr/bin/ld: cannot find -l4
```

Thus I believe the issue is due to upstream.


---

Comment by zimmerma created at 2020-01-19 07:41:14

I've reported the issue to the openblas developers. They say:

```
Thank you for the report.

I think we didn't test MAKEFLAGS="-j4 -l4" case.
```



---

Comment by mkoeppe created at 2020-04-30 00:28:46

We upgraded openblas to 0.3.9, is it fixed?


---

Comment by zimmerma created at 2020-04-30 06:24:13

the issue is still present with openblas 0.3.9 (downloaded from https://github.com/xianyi/OpenBLAS/releases).


---

Comment by zimmerma created at 2020-04-30 06:33:09

please can someone with a github account create the issue on
https://github.com/xianyi/OpenBLAS/issues ?


---

Comment by dimpase created at 2020-04-30 07:10:59

comment:9 says that a report has already been made - surely, if a github issue is to be filed, it would be useful to mention this.

With all respect, setting a gihub account takes a couple of minutes, what's the point of contacting them via an intermediary?  Is it forbidden in INRIA?


---

Comment by zimmerma created at 2020-04-30 07:16:46

it is just that I'm reluctant to open a github account for personal reasons. Indeed I reported the issue to Zhang Xianyi on January 17, and sent him a reminder today. His answer was that one could create an issue on github.


---

Comment by slelievre created at 2020-06-18 12:34:26

I opened a ticket at OpenBLAS on Paul's behalf.

- https://github.com/xianyi/OpenBLAS/issues/2673


---

Comment by zimmerma created at 2020-06-18 12:50:12

thank you Samuel!


---

Comment by slelievre created at 2020-06-20 10:50:06

Changing status from needs_info to needs_review.


---

Comment by slelievre created at 2020-06-20 10:50:06

There was already a relevant ticket and fix upstream:

- https://github.com/xianyi/OpenBLAS/issues/2616
- https://github.com/xianyi/OpenBLAS/issues/2617

The fix is part of OpenBLAS 0.3.10 released last week.

Paul confirmed to me he could no longer observe
the problem with OpenBLAS 0.3.10.

Upgrading to OpenBLAS 0.3.10 is now tracked at #29913.


---

Comment by dimpase created at 2020-06-20 13:34:28

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-06-22 18:46:33

Resolution: invalid
