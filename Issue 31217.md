# Issue 31217: Fix bug in WordMorphism.growing_letters() and periodic_points()

Issue created by migration from https://trac.sagemath.org/ticket/31454

Original creator: @mrejmon

Original creation time: 2021-03-05 15:37:18

CC:  slabbe slelievre

1)

```
sage: WordMorphism('a->a').is_growing('a')
True
```

should return `False`.

This happens due to the `if self.is_primitive(): return True` optimization. Easily fixable for example like this:

```diff
-       if self.is_primitive():
+       if self.is_primitive() and len(self._morph) > 1:
            return True
```

2)

```
sage: WordMorphism('a->a,b->bb').periodic_points()
Traceback (most recent call last):
...
ValueError: generator already executing
```

should return `[This is the Trac macro *word: bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb...* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#word: bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb...-macro)`.

I think this happens because `periodic_points()` doesn't check whether the letters are growing, so the following should fix it (assuming we only care about periodic points with infinite length):

```diff
        A = self.domain().alphabet()
        d = dict((letter,self(letter)[0]) for letter in A)
+       G = set(self.growing_letters())

        res = []
        parent = self.codomain().shift()
        for cycle in get_cycles(CallableDict(d),A):
+           if cycle[0] in G:
                P = PeriodicPointIterator(self, cycle)
                res.append([parent(P._cache[i]) for i in range(len(cycle))])
```


I added a branch with the proposed fixes.


---

Comment by @mrejmon created at 2021-03-05 15:38:22

Changing status from new to needs_review.


---

Comment by slabbe created at 2021-03-08 22:36:13

Thanks for proposing such fixes. I will take a look as soon as possible.


---

Comment by vdelecroix created at 2021-03-14 18:21:24

Martin. Your branch should include the two doctests that are in the ticket description. Since the sage doctests are run it will prevent the bug to occur again in the future.


---

Comment by git created at 2021-03-16 15:03:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mrejmon created at 2021-03-16 15:08:54

Replying to [comment:4 vdelecroix]:
> Martin. Your branch should include the two doctests that are in the ticket description. Since the sage doctests are run it will prevent the bug to occur again in the future.

Done.


---

Comment by vdelecroix created at 2021-03-16 17:51:00

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2021-03-16 17:51:00

thanks!


---

Comment by vbraun created at 2021-03-18 22:32:10

Resolution: fixed
