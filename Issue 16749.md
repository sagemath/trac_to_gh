# Issue 16749: Fix rational_preimages and all_rational_preimages to work over Number Fields

archive/issues_016749.json:
```json
{
    "body": "CC:  @bhutz\n\nFixing the checks at the start of the code to allow both functions to work over Number Fields\n\nIssue created by migration from https://trac.sagemath.org/ticket/16986\n\n",
    "created_at": "2014-09-15T15:11:22Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Fix rational_preimages and all_rational_preimages to work over Number Fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16749",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdefaria"
}
```
CC:  @bhutz

Fixing the checks at the start of the code to allow both functions to work over Number Fields

Issue created by migration from https://trac.sagemath.org/ticket/16986





---

archive/issue_comments_221099.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-15T16:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221099",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdefaria"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_221100.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-15T16:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221100",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdefaria"
}
```

New commits:



---

archive/issue_comments_221101.json:
```json
{
    "body": "The cases of number fields and finite fields work fine, but many other fields fail. Also there are some issues in the documentation:\n\n- The descriptions of both functions reference QQ only\n- The description of all_rational_preimages reference parallel (which it is not)\n- The text is after the :: in examples so is not formatted correctly\n- number field is 2 words and not capitalized\n\nFor functionality: here are some examples which fail. They fail in at least 3 distinct ways.\n\n\n```\nR.<t>=FunctionField(QQ)\nP.<x,y>=ProjectiveSpace(R,1)\nH=End(P)\nf=H([x^2-y^2,y^2])\nf.rational_preimages(P([0,1]))\n```\n\n\n\n```\nR.<t>=PolynomialRing(QQ)\nP.<x,y>=ProjectiveSpace(FractionField(R),1)\nH=End(P)\nf=H([x^2-y^2,y^2])\nf.rational_preimages(P([0,1]))\n```\n\n\n\n```\nR.<t>=PolynomialRing(QuadraticField(2))\nP.<x,y>=ProjectiveSpace(FractionField(R),1)\nH=End(P)\nf=H([x^2-y^2,y^2])\nf.rational_preimages(P([0,1]))\n```\n\n\n\n```\nP.<x,y>=ProjectiveSpace(Qp(3),1)\nH=End(P)\nf=H([x^2-y^2,y^2])\nf.rational_preimages(P([0,1]))\n```\n\n\n\n```\nP.<x,y>=ProjectiveSpace(CC,1)\nH=End(P)\nf=H([x^2-y^2,y^2])\nf.rational_preimages(P([0,1]))\n```\n",
    "created_at": "2014-09-20T13:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221101",
    "user": "https://github.com/bhutz"
}
```

The cases of number fields and finite fields work fine, but many other fields fail. Also there are some issues in the documentation:

- The descriptions of both functions reference QQ only
- The description of all_rational_preimages reference parallel (which it is not)
- The text is after the :: in examples so is not formatted correctly
- number field is 2 words and not capitalized

For functionality: here are some examples which fail. They fail in at least 3 distinct ways.


```
R.<t>=FunctionField(QQ)
P.<x,y>=ProjectiveSpace(R,1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



```
R.<t>=PolynomialRing(QQ)
P.<x,y>=ProjectiveSpace(FractionField(R),1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



```
R.<t>=PolynomialRing(QuadraticField(2))
P.<x,y>=ProjectiveSpace(FractionField(R),1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



```
P.<x,y>=ProjectiveSpace(Qp(3),1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



```
P.<x,y>=ProjectiveSpace(CC,1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```




---

archive/issue_comments_221102.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-20T13:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221102",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-29T17:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221104.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-29T17:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221104",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdefaria"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221105.json:
```json
{
    "body": "Doc test failures:\n\n\n```\nsage -t projective_morphism.py  # 6 doctests failed\n```\n",
    "created_at": "2014-09-30T17:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221105",
    "user": "https://github.com/bhutz"
}
```

Doc test failures:


```
sage -t projective_morphism.py  # 6 doctests failed
```




---

archive/issue_comments_221106.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-30T17:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221106",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221107.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-01T17:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221108.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-01T17:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221108",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdefaria"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221109.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-02T18:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221109",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221110.json:
```json
{
    "body": "The code snippents above are resolved now, but here are a couple more issues:\n\n- the docs are still wrong see comment 4 above\n\n- for subschemes the points being returned are in the ambient space and not the subscheme\n\n- the following two examples fail\n\n\n```\nP.<x,y>=ProjectiveSpace(CC,1)\nH=End(P)\nf=H([x^2-2*y^2,y^2])\nf.rational_preimages(P([0,1]))\n```\n\nThe previous example also fails for RR\n\n\n```\nz = var('z')\nK.<w>=NumberField(z^3+2)\nR.<z>=PolynomialRing(K)\nL.<v>=K.extension(z^2+z+1)\nP.<x,y>=ProjectiveSpace(L,1)\nH=End(P)\nf=H([x^3-2*y^3,v*y^3])\nf.rational_preimages(P([0,1]))\n```\n",
    "created_at": "2014-10-02T18:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221110",
    "user": "https://github.com/bhutz"
}
```

The code snippents above are resolved now, but here are a couple more issues:

- the docs are still wrong see comment 4 above

- for subschemes the points being returned are in the ambient space and not the subscheme

- the following two examples fail


```
P.<x,y>=ProjectiveSpace(CC,1)
H=End(P)
f=H([x^2-2*y^2,y^2])
f.rational_preimages(P([0,1]))
```

The previous example also fails for RR


```
z = var('z')
K.<w>=NumberField(z^3+2)
R.<z>=PolynomialRing(K)
L.<v>=K.extension(z^2+z+1)
P.<x,y>=ProjectiveSpace(L,1)
H=End(P)
f=H([x^3-2*y^3,v*y^3])
f.rational_preimages(P([0,1]))
```




---

archive/issue_comments_221111.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-15T16:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221112.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-15T17:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221113.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-15T17:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221114.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-15T17:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221114",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdefaria"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221115.json:
```json
{
    "body": "Fixed all of the problems found above, ran doc test, all docs passed on my end, setting to review",
    "created_at": "2014-10-15T17:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221115",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdefaria"
}
```

Fixed all of the problems found above, ran doc test, all docs passed on my end, setting to review



---

archive/issue_comments_221116.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-21T16:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221116",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221117.json:
```json
{
    "body": "Actually, this example is not fixed\n\n\n```\nP.<x,y>=ProjectiveSpace(CC,1)\nH=End(P)\nf=H([x^2-2*y^2,y^2])\nf.rational_preimages(P([0,1]))\n```\n\nbut the other one is.\n\nAlso some minor things:\n- Both docstrings still says requires QQ and endomorphism of projective space. Neither are still true.\n- There are two lines with terminating white space 2519, 2550.\n- Coordinates is spelled wrong on 2604.",
    "created_at": "2014-10-21T16:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221117",
    "user": "https://github.com/bhutz"
}
```

Actually, this example is not fixed


```
P.<x,y>=ProjectiveSpace(CC,1)
H=End(P)
f=H([x^2-2*y^2,y^2])
f.rational_preimages(P([0,1]))
```

but the other one is.

Also some minor things:
- Both docstrings still says requires QQ and endomorphism of projective space. Neither are still true.
- There are two lines with terminating white space 2519, 2550.
- Coordinates is spelled wrong on 2604.



---

archive/issue_comments_221118.json:
```json
{
    "body": "opps, my mistake, that example is fixed I just didn't get the latest commits on my last pull. There are still three minor issues:\n\n- line 2552 trailing white space\n- doc string references endomorphism of projective space, but since you're allowing subschemes, you just need 'an endomorphism'.\n- coordinates is spelled wrong line 2611",
    "created_at": "2014-10-22T18:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221118",
    "user": "https://github.com/bhutz"
}
```

opps, my mistake, that example is fixed I just didn't get the latest commits on my last pull. There are still three minor issues:

- line 2552 trailing white space
- doc string references endomorphism of projective space, but since you're allowing subschemes, you just need 'an endomorphism'.
- coordinates is spelled wrong line 2611



---

archive/issue_comments_221119.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-05T18:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221120.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-05T18:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221120",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdefaria"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221121.json:
```json
{
    "body": "this looks good now.",
    "created_at": "2014-11-06T19:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221121",
    "user": "https://github.com/bhutz"
}
```

this looks good now.



---

archive/issue_comments_221122.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-06T19:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221122",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_221123.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-15T16:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16749#issuecomment-221123",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
