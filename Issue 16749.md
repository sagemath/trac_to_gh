# Issue 16749: Fix rational_preimages and all_rational_preimages to work over Number Fields

Issue created by migration from Trac.

Original creator: jdefaria

Original creation time: 2014-09-15 15:11:22

CC:  bhutz

Fixing the checks at the start of the code to allow both functions to work over Number Fields


---

Comment by jdefaria created at 2014-09-15 16:22:38

Changing status from new to needs_review.


---

Comment by jdefaria created at 2014-09-15 16:22:38

New commits:


---

Comment by bhutz created at 2014-09-20 13:22:50

The cases of number fields and finite fields work fine, but many other fields fail. Also there are some issues in the documentation:

 - The descriptions of both functions reference QQ only
 - The description of all_rational_preimages reference parallel (which it is not)
 - The text is after the :: in examples so is not formatted correctly
 - number field is 2 words and not capitalized

For functionality: here are some examples which fail. They fail in at least 3 distinct ways.


```
R.<t>=FunctionField(QQ)
P.<x,y>=ProjectiveSpace(R,1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



```
R.<t>=PolynomialRing(QQ)
P.<x,y>=ProjectiveSpace(FractionField(R),1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



```
R.<t>=PolynomialRing(QuadraticField(2))
P.<x,y>=ProjectiveSpace(FractionField(R),1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



```
P.<x,y>=ProjectiveSpace(Qp(3),1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



```
P.<x,y>=ProjectiveSpace(CC,1)
H=End(P)
f=H([x^2-y^2,y^2])
f.rational_preimages(P([0,1]))
```



---

Comment by bhutz created at 2014-09-20 13:22:50

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-09-29 17:01:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdefaria created at 2014-09-29 17:02:21

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2014-09-30 17:33:58

Doc test failures:


```
sage -t projective_morphism.py  # 6 doctests failed
```



---

Comment by bhutz created at 2014-09-30 17:33:58

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-10-01 17:18:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdefaria created at 2014-10-01 17:19:45

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2014-10-02 18:18:04

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2014-10-02 18:18:04

The code snippents above are resolved now, but here are a couple more issues:

- the docs are still wrong see comment 4 above

- for subschemes the points being returned are in the ambient space and not the subscheme

- the following two examples fail


```
P.<x,y>=ProjectiveSpace(CC,1)
H=End(P)
f=H([x^2-2*y^2,y^2])
f.rational_preimages(P([0,1]))
```

The previous example also fails for RR


```
z = var('z')
K.<w>=NumberField(z^3+2)
R.<z>=PolynomialRing(K)
L.<v>=K.extension(z^2+z+1)
P.<x,y>=ProjectiveSpace(L,1)
H=End(P)
f=H([x^3-2*y^3,v*y^3])
f.rational_preimages(P([0,1]))
```



---

Comment by git created at 2014-10-15 16:20:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-10-15 17:18:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-10-15 17:30:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdefaria created at 2014-10-15 17:35:34

Changing status from needs_work to needs_review.


---

Comment by jdefaria created at 2014-10-15 17:35:34

Fixed all of the problems found above, ran doc test, all docs passed on my end, setting to review


---

Comment by bhutz created at 2014-10-21 16:42:05

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2014-10-21 16:42:05

Actually, this example is not fixed


```
P.<x,y>=ProjectiveSpace(CC,1)
H=End(P)
f=H([x^2-2*y^2,y^2])
f.rational_preimages(P([0,1]))
```

but the other one is.

Also some minor things:
- Both docstrings still says requires QQ and endomorphism of projective space. Neither are still true.
- There are two lines with terminating white space 2519, 2550.
- Coordinates is spelled wrong on 2604.


---

Comment by bhutz created at 2014-10-22 18:52:04

opps, my mistake, that example is fixed I just didn't get the latest commits on my last pull. There are still three minor issues:

- line 2552 trailing white space
- doc string references endomorphism of projective space, but since you're allowing subschemes, you just need 'an endomorphism'.
- coordinates is spelled wrong line 2611


---

Comment by git created at 2014-11-05 18:50:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdefaria created at 2014-11-05 18:51:16

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2014-11-06 19:31:25

this looks good now.


---

Comment by bhutz created at 2014-11-06 19:31:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-11-15 16:22:34

Resolution: fixed
