# Issue 15193: Enable cython caching

Issue created by migration from Trac.

Original creator: robertwb

Original creation time: 2013-11-17 06:30:56




---

Comment by robertwb created at 2013-11-17 06:47:24

New commits:


---

Comment by robertwb created at 2013-11-17 06:47:24

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-11-18 16:39:59

Dependency checking seems to work for me. If there is any problem left then I'm pretty sure we'll only be able to find it if we use this seriously. So I'm in favor of pushing this into the sage-git release....


---

Comment by vbraun created at 2013-11-18 16:39:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-11-27 01:56:56

Building Sage with a non-existing `DOT_SAGE` breaks because of this ticket. From the buildbot:

```
Compiling sage/ext/interpreters/wrapper_rdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_cdf.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_rr.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_py.pyx because it changed.
Compiling sage/ext/interpreters/wrapper_el.pyx because it changed.
Traceback (most recent call last):
  File "setup.py", line 531, in <module>
    force=force)
  File "/home/buildbot/build/sage/plantain/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 740, in cythonize
    os.mkdir(options.cache)
OSError: [Errno 2] No such file or directory: '/home/buildbot/build/sage/plantain/sage_git/dot_sage/cycache'
```



---

Comment by vbraun created at 2013-11-27 02:21:14

Hmm the commit field was not automatically updated?
----
New commits:


---

Comment by vbraun created at 2013-11-27 02:21:54

Changing status from positive_review to needs_review.


---

Comment by vbraun created at 2013-11-27 02:21:54

please review my change...


---

Comment by ohanar created at 2013-11-27 03:04:31

Why use a sage specific cycache directory? Why not something like `~/.cycache`? (IMHO, Cython should use a default directory if `Cython.Compiler.Main.default_options['cache'] is True`).

Also, I think it should be togglable by an environment variable, say `DISABLE_CYCACHE`, in case someone doesn't want to use (e.g. for testing purposes/cython development purposes).


---

Comment by vbraun created at 2013-11-27 03:10:38

The ccache spkg also uses `$DOT_SAGE/ccache`. 

With this patch you can disable caching by passing an invalid directory. Ugly but yet another undocumented environment variable isn't that great either.

Supporting boolean `Cython.Compiler.Main.default_options['cache']` and/or using `os.makedirs()` instead of `mkdir` are just Cython enhancement requests, maybe you want to post that to the Cython trac?


---

Comment by robertwb created at 2013-12-12 05:40:28

This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released.


---

Comment by robertwb created at 2013-12-12 05:40:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-12-16 14:08:13

Resolution: fixed


---

Comment by jdemeyer created at 2014-04-11 18:31:30

I assume the intent of this patch was to _always_ enable cycache by default? Because that's not what this patch does. It only works if the cycache directory already exists. Testing for the existence of `X/..` is (almost) equivalent to testing for the existence of `X`.


---

Comment by jdemeyer created at 2014-04-11 18:34:52

Replying to [comment:9 vbraun]:
> The ccache spkg also uses `$DOT_SAGE/ccache`.
That's not actually true. Sage doesn't set the `ccache` directory.


---

Comment by jdemeyer created at 2014-04-11 18:35:09

Replying to [comment:10 robertwb]:
> This is quite the ugly hack, but should work. We can roll this back once https://github.com/cython/cython/commit/b24ea416d3658546c919d3ab8ba54e94eed187ba is released. 
I guess this is in Sage now, right?


---

Comment by vbraun created at 2014-04-11 19:32:26

Yes, feel free to open a new ticket.


---

Comment by jdemeyer created at 2014-04-12 11:19:38

See #16148.
