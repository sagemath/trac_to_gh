# Issue 26682: Upgrade to Jupyter notebook 5.7.4

Issue created by migration from Trac.

Original creator: slelievre

Original creation time: 2018-12-20 08:47:46

CC:  arojas fbissey @bryangingechen @timokau infinity0 jdemeyer slelievre thansen egourgoulhon

Keywords: upgrade, jupyter, notebook

The latest Jupyter notebook releases contain some security fixes.

- [Release announcement: notebook 5.7.3 and 5.7.4](https://groups.google.com/d/msg/jupyter/vfBpHW2FsAo/rkHJc4zRDwAJ)

*Tarball*: https://files.pythonhosted.org/packages/6e/22/b5dcce67559d63d0f22e46d806305710808c698a1b91c07eb09e389785e0/notebook-5.7.4.tar.gz

Our previous upgrade was to notebook 5.7.1, in #26709, merged in Sage 8.5.beta5.


---

Comment by embray created at 2019-01-15 18:15:21

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by embray created at 2019-03-25 10:41:19

Moving all blocker/critical issues from 8.7 to 8.8.


---

Comment by slelievre created at 2019-04-14 01:28:25

New commits:


---

Comment by slelievre created at 2019-04-14 01:28:25

Changing status from new to needs_review.


---

Comment by embray created at 2019-04-24 14:33:40

Note, this would conflict slightly with #27715.  As this ticket came first I'd be happy to rebase onto it so long as do intend to move forward on this ticket (I don't see why we shouldn't, though I haven't tested it yet...)


---

Comment by embray created at 2019-07-03 11:37:56

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).


---

Comment by chapoton created at 2019-08-24 11:48:36

branch is red


---

Comment by chapoton created at 2019-08-24 11:48:44

Changing status from needs_review to needs_work.


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by slelievre created at 2020-07-19 08:02:23

Notebook 6.1.0 RC1 is out:

- https://discourse.jupyter.org/t/jupyter-notebook-6-1-0-rc1-is-available/4763

Notebook 5.7.10 would be the last py2-compatible release.

- https://pypi.org/project/notebook/5.7.10/


---

Comment by mkoeppe created at 2020-07-19 14:38:31

py2 compatibility is irrelevant now. Please see #29141 for discussion what we need to be compatible with


---

Comment by slelievre created at 2020-08-01 00:58:39

Notebook 6.1.0 released.

- [Release notes for Jupyter Notebook 6.1.0](https://jupyter-notebook.readthedocs.io/en/latest/changelog.html#release-6-1-0)


---

Comment by mkoeppe created at 2020-08-06 05:23:28

See also: #28313 "notebook-5.7.6 contains local files"


---

Comment by mkoeppe created at 2020-08-07 22:19:30


```
  [notebook-6.1.1]   Applying patches from ../patches...
  [notebook-6.1.1]   Applying ../patches/0001-Workaround-for-wrong-errno-on-socket-bind-permission.patch
  [notebook-6.1.1]   patching file notebook/notebookapp.py
  [notebook-6.1.1]   Hunk #1 FAILED at 1406.
```

It should be checked if this patch has been upstreamed
----
Last 10 new commits:


---

Comment by mkoeppe created at 2020-08-07 22:21:31

The patch was added for Cygwin in #27715 (Jupyter notebook can crash during startup if default port cannot be used)


---

Comment by git created at 2020-08-07 22:28:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-08-07 22:32:32

Builds OK for me on macOS.  I have not tested anything else because I do not use the jupyter notebook and cannot distinguish a working and a broken installation.


---

Comment by mkoeppe created at 2020-08-07 22:32:32

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-08-08 02:26:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-08 03:27:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @jcamp0x2a created at 2020-08-09 18:28:52

Hello! Saw your post on sage-devel and figured I'd take a shot at testing this.

I was able to get this branch to build just fine, but I ran into some missing run-time dependencies for `jsonschema`, namely: `attrs`, `importlib_metadata`, and `pyrsistent` (which then required `zipp`).

I've pushed a [commit](https://git.sagemath.org/sage.git/commit/?h=u/gh-jcamp0x2a/notebook-5.7.8&id=14149164c43758b8f2845630df96b89dbe1f1c79) with these packages added. This is the first time I've done any work with the SPKGs, and I'm not sure if I've followed the conventions correctly, so I didn't want to overwrite your branch in this ticket. For example, I wasn't sure how/whether to include these run-time dependencies in the `build/pkgs/{jsonschema|pyrsistent}/dependencies` files.

With these packages present, the Jupyter server starts up and notebooks can be opened, edited, and ran just fine. Threejs plots are working including the new animation stuff, but JSmol plots are not. Nor does MathJax function correctly. I see 404 status codes for `/nbextensions/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full,Safe&delayStartupUntil=configured` and `/nbextensions/jsmol/JSmol.min.js`, which are perhaps related to some of the other outstanding Jupyter tickets.


---

Comment by mkoeppe created at 2020-08-09 18:31:49

Thanks a lot! Please do update the branch, it will make it easier


---

Comment by mkoeppe created at 2020-08-09 18:34:03

Yes, runtime dependencies should be added in the `dependencies` file. We do not really distinguish build dependencies and runtime dependencies in the Sage distribution. (There is a notion of order-only dependencies, which are listed after the vertical-bar symbol (|), but it's OK to ignore.)


---

Comment by mkoeppe created at 2020-08-09 18:39:46

Replying to [comment:37 gh-jcamp0x2a]:
> I see 404 status codes for `/nbextensions/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full,Safe&delayStartupUntil=configured` and `/nbextensions/jsmol/JSmol.min.js`, which are perhaps related to some of the other outstanding Jupyter tickets.
OK, I forgot to push the merge with #30299 -- sorry about that


---

Comment by git created at 2020-08-09 18:40:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-09 18:40:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-08-09 18:41:17

I've merged your commit. Please test again...


---

Comment by mkoeppe created at 2020-08-09 18:56:25

A build test is running at https://github.com/mkoeppe/sage/actions/runs/201573039


---

Comment by @jcamp0x2a created at 2020-08-09 19:41:26

Replying to [comment:39 mkoeppe]:
> Yes, runtime dependencies should be added in the `dependencies` file. We do not really distinguish build dependencies and runtime dependencies in the Sage distribution. (There is a notion of order-only dependencies, which are listed after the vertical-bar symbol (|), but it's OK to ignore.)

Ok, I've added dependencies on `attrs`, `importlib_metadata`, and `pyrsistent` to `jsonschema` and a dependency on `zipp` to `importlib_metadata`. (I mispoke earlier that it was required by `pyrsistent`.) I will update the ticket with the branch.

Also, I want to mention that the latest version of `zipp` (3.1.0) did not build correctly in the Sage environment, and I didn't do much troubleshooting on it, falling back instead to the specific major and minor version called out by `importlib_metadata` (0.5, so I used 0.5.2). Just in case that comes up in the future.


---

Comment by @jcamp0x2a created at 2020-08-09 19:42:17

Replying to [comment:40 mkoeppe]:
> Replying to [comment:37 gh-jcamp0x2a]:
> > I see 404 status codes for `/nbextensions/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full,Safe&delayStartupUntil=configured` and `/nbextensions/jsmol/JSmol.min.js`, which are perhaps related to some of the other outstanding Jupyter tickets.
> OK, I forgot to push the merge with #30299 -- sorry about that

I've tested this again following your merge and both JSmol and MathJax are now working correctly.


---

Comment by mkoeppe created at 2020-08-09 19:56:42

Thanks very much! Looking great.

I have restarted the build tests, now at https://github.com/mkoeppe/sage/actions/runs/201611495


---

Comment by mkoeppe created at 2020-08-12 01:44:09

Clean tests for `slackware-14.2-standard` (https://github.com/mkoeppe/sage/runs/964353866), `gentoo-standard` (https://github.com/mkoeppe/sage/runs/964353835), `fedora-32-standard` (https://github.com/mkoeppe/sage/runs/964353804). (Tests on many other platforms did not go through because of current reliability issues of GH Action - unrelated to this ticket.)


---

Comment by mkoeppe created at 2020-08-12 17:23:42

Merged #25363 (and 9.2.beta8) to facilitate testing
----
New commits:


---

Comment by dimpase created at 2020-08-12 21:25:47

Great!


---

Comment by dimpase created at 2020-08-12 21:25:47

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-08-12 21:29:54

Thank you!


---

Comment by vbraun created at 2020-08-15 09:42:03

Resolution: fixed
