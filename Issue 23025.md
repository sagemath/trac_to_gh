# Issue 23025: Enable png support in giac

Issue created by migration from https://trac.sagemath.org/ticket/23262

Original creator: tmonteil

Original creation time: 2017-06-16 22:22:44

CC:  fbissey jpflori

In #22101, png support was removed from `giac` to fix a build issue. Let us try to re-enable it, with suggestions from #22280.



---

Comment by tmonteil created at 2017-06-19 12:31:11

As suggested in [/22280#comment:63] i (blindly) replaced 


```
AC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))
```


with 


```
AC_CHECK_HEADERS(png.h, AC_CHECK_LIBS(main,[png16,png14,png12,png]))
```


in `configure.ac` but i get an error:


```
[giac-1.2.3.25] configure.in:103: error: possibly undefined macro: AC_CHECK_LIBS
[giac-1.2.3.25]       If this token and others are legitimate, please use m4_pattern_allow.
[giac-1.2.3.25]       See the Autoconf documentation.
[giac-1.2.3.25] Makefile:364: recipe for target 'configure' failed
```


Trying to replace `AC_CHECK_LIBS` with `AC_CHECK_LIB` or `AC_SEARCH_LIBS` does not work either.


---

Comment by fbissey created at 2017-06-19 12:38:30

1) we are at 1.2.3-47 not 1.2.3-25.
2) Didn't read properly https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Libraries.html the other night, it should be AC_SEARCH_LIBS you are right.
3) hum this `configure.in` which is obsolete, not `configure.ac`, I wonder if it is important.

I'll have a go at patching in the morning if you don't have success by then.


---

Comment by tmonteil created at 2017-06-19 13:27:19

Replying to [comment:2 fbissey]:
> 1) we are at 1.2.3-47 not 1.2.3-25.
> 2) Didn't read properly https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Libraries.html the other night, it should be AC_SEARCH_LIBS you are right.
> 3) hum this `configure.in` which is obsolete, not `configure.ac`, I wonder if it is important.

OK, i updated to 1.2.3-47 and replaced with `AC_CHECK_LIBS` with `AC_SEARCH_LIBS` in the patch, but without success.

> I'll have a go at patching in the morning if you don't have success by then.

OK, do not hesitate to modify the branch, this stuff is beyond my competences.
----
New commits:


---

Comment by jpflori created at 2017-06-19 13:36:17

If this is an autotools based project, you'd have to run autoreconf to propagate th changes in `configure.in` into the actual `configure` script (or devise them by hand) and produce a "new" patch to be applied by `spkg-install`.


---

Comment by jpflori created at 2017-06-19 13:59:24

Working on this.


---

Comment by jpflori created at 2017-06-19 15:04:32

Changing status from new to needs_review.


---

Comment by jpflori created at 2017-06-19 15:04:32

New commits:


---

Comment by tmonteil created at 2017-06-19 15:30:03

Changing status from needs_review to needs_info.


---

Comment by tmonteil created at 2017-06-19 15:30:03

Thanks for the branch. Shouldn't the dependency be `libpng` instead of `png` ?


---

Comment by jpflori created at 2017-06-19 15:34:21

Yes you're right.


---

Comment by git created at 2017-06-21 10:12:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2017-06-21 10:26:19

Changing status from needs_info to needs_review.


---

Comment by tmonteil created at 2017-06-21 10:26:19

Replying to [comment:9 jpflori]:
> Yes you're right.

OK, i just merged with the lastest beta to ease compilation, and changed the dependency.

Since #22280 is not merged yet, i add it as a dependency.

For me it is good to go, in the sense that compilation and tests pass on 64bit and 32bit Linux machines. I am not able to check the contents of the patch however.

If you or Fran√ßois are OK with that i let you mark it positive review.


---

Comment by jpflori created at 2017-06-22 09:52:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-06-25 15:45:10

Resolution: fixed


---

Comment by tmonteil created at 2019-08-27 19:45:19

Changing keywords from "" to "sdl".
