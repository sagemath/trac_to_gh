# Issue 23025: Enable png support in giac

archive/issues_023025.json:
```json
{
    "body": "CC:  @kiwifb jpflori\n\nIn #22101, png support was removed from `giac` to fix a build issue. Let us try to re-enable it, with suggestions from #22280.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23262\n\n",
    "created_at": "2017-06-16T22:22:44Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Enable png support in giac",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23025",
    "user": "tmonteil"
}
```
CC:  @kiwifb jpflori

In #22101, png support was removed from `giac` to fix a build issue. Let us try to re-enable it, with suggestions from #22280.


Issue created by migration from https://trac.sagemath.org/ticket/23262





---

archive/issue_comments_322063.json:
```json
{
    "body": "As suggested in [/22280#comment:63] i (blindly) replaced \n\n\n```\nAC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))\n```\n\n\nwith \n\n\n```\nAC_CHECK_HEADERS(png.h, AC_CHECK_LIBS(main,[png16,png14,png12,png]))\n```\n\n\nin `configure.ac` but i get an error:\n\n\n```\n[giac-1.2.3.25] configure.in:103: error: possibly undefined macro: AC_CHECK_LIBS\n[giac-1.2.3.25]       If this token and others are legitimate, please use m4_pattern_allow.\n[giac-1.2.3.25]       See the Autoconf documentation.\n[giac-1.2.3.25] Makefile:364: recipe for target 'configure' failed\n```\n\n\nTrying to replace `AC_CHECK_LIBS` with `AC_CHECK_LIB` or `AC_SEARCH_LIBS` does not work either.",
    "created_at": "2017-06-19T12:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322063",
    "user": "tmonteil"
}
```

As suggested in [/22280#comment:63] i (blindly) replaced 


```
AC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))
```


with 


```
AC_CHECK_HEADERS(png.h, AC_CHECK_LIBS(main,[png16,png14,png12,png]))
```


in `configure.ac` but i get an error:


```
[giac-1.2.3.25] configure.in:103: error: possibly undefined macro: AC_CHECK_LIBS
[giac-1.2.3.25]       If this token and others are legitimate, please use m4_pattern_allow.
[giac-1.2.3.25]       See the Autoconf documentation.
[giac-1.2.3.25] Makefile:364: recipe for target 'configure' failed
```


Trying to replace `AC_CHECK_LIBS` with `AC_CHECK_LIB` or `AC_SEARCH_LIBS` does not work either.



---

archive/issue_comments_322064.json:
```json
{
    "body": "1) we are at 1.2.3-47 not 1.2.3-25.\n2) Didn't read properly https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Libraries.html the other night, it should be AC_SEARCH_LIBS you are right.\n3) hum this `configure.in` which is obsolete, not `configure.ac`, I wonder if it is important.\n\nI'll have a go at patching in the morning if you don't have success by then.",
    "created_at": "2017-06-19T12:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322064",
    "user": "@kiwifb"
}
```

1) we are at 1.2.3-47 not 1.2.3-25.
2) Didn't read properly https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Libraries.html the other night, it should be AC_SEARCH_LIBS you are right.
3) hum this `configure.in` which is obsolete, not `configure.ac`, I wonder if it is important.

I'll have a go at patching in the morning if you don't have success by then.



---

archive/issue_comments_322065.json:
```json
{
    "body": "Replying to [comment:2 fbissey]:\n> 1) we are at 1.2.3-47 not 1.2.3-25.\n> 2) Didn't read properly https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Libraries.html the other night, it should be AC_SEARCH_LIBS you are right.\n> 3) hum this `configure.in` which is obsolete, not `configure.ac`, I wonder if it is important.\n\nOK, i updated to 1.2.3-47 and replaced with `AC_CHECK_LIBS` with `AC_SEARCH_LIBS` in the patch, but without success.\n\n> I'll have a go at patching in the morning if you don't have success by then.\n\nOK, do not hesitate to modify the branch, this stuff is beyond my competences.\n----\nNew commits:",
    "created_at": "2017-06-19T13:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322065",
    "user": "tmonteil"
}
```

Replying to [comment:2 fbissey]:
> 1) we are at 1.2.3-47 not 1.2.3-25.
> 2) Didn't read properly https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Libraries.html the other night, it should be AC_SEARCH_LIBS you are right.
> 3) hum this `configure.in` which is obsolete, not `configure.ac`, I wonder if it is important.

OK, i updated to 1.2.3-47 and replaced with `AC_CHECK_LIBS` with `AC_SEARCH_LIBS` in the patch, but without success.

> I'll have a go at patching in the morning if you don't have success by then.

OK, do not hesitate to modify the branch, this stuff is beyond my competences.
----
New commits:



---

archive/issue_comments_322066.json:
```json
{
    "body": "If this is an autotools based project, you'd have to run autoreconf to propagate th changes in `configure.in` into the actual `configure` script (or devise them by hand) and produce a \"new\" patch to be applied by `spkg-install`.",
    "created_at": "2017-06-19T13:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322066",
    "user": "jpflori"
}
```

If this is an autotools based project, you'd have to run autoreconf to propagate th changes in `configure.in` into the actual `configure` script (or devise them by hand) and produce a "new" patch to be applied by `spkg-install`.



---

archive/issue_comments_322067.json:
```json
{
    "body": "Working on this.",
    "created_at": "2017-06-19T13:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322067",
    "user": "jpflori"
}
```

Working on this.



---

archive/issue_comments_322068.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-19T15:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322068",
    "user": "jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_322069.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-19T15:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322069",
    "user": "jpflori"
}
```

New commits:



---

archive/issue_comments_322070.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-06-19T15:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322070",
    "user": "tmonteil"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_322071.json:
```json
{
    "body": "Thanks for the branch. Shouldn't the dependency be `libpng` instead of `png` ?",
    "created_at": "2017-06-19T15:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322071",
    "user": "tmonteil"
}
```

Thanks for the branch. Shouldn't the dependency be `libpng` instead of `png` ?



---

archive/issue_comments_322072.json:
```json
{
    "body": "Yes you're right.",
    "created_at": "2017-06-19T15:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322072",
    "user": "jpflori"
}
```

Yes you're right.



---

archive/issue_comments_322073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-21T10:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322073",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_322074.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-06-21T10:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322074",
    "user": "tmonteil"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_322075.json:
```json
{
    "body": "Replying to [comment:9 jpflori]:\n> Yes you're right.\n\nOK, i just merged with the lastest beta to ease compilation, and changed the dependency.\n\nSince #22280 is not merged yet, i add it as a dependency.\n\nFor me it is good to go, in the sense that compilation and tests pass on 64bit and 32bit Linux machines. I am not able to check the contents of the patch however.\n\nIf you or Fran\u00e7ois are OK with that i let you mark it positive review.",
    "created_at": "2017-06-21T10:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322075",
    "user": "tmonteil"
}
```

Replying to [comment:9 jpflori]:
> Yes you're right.

OK, i just merged with the lastest beta to ease compilation, and changed the dependency.

Since #22280 is not merged yet, i add it as a dependency.

For me it is good to go, in the sense that compilation and tests pass on 64bit and 32bit Linux machines. I am not able to check the contents of the patch however.

If you or François are OK with that i let you mark it positive review.



---

archive/issue_comments_322076.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-22T09:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322076",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_322077.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-25T15:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322077",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_322078.json:
```json
{
    "body": "Changing keywords from \"\" to \"sdl\".",
    "created_at": "2019-08-27T19:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23025#issuecomment-322078",
    "user": "tmonteil"
}
```

Changing keywords from "" to "sdl".
