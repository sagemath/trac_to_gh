# Issue 19381: Update Valgrind to 3.11.0

Issue created by migration from Trac.

Original creator: jpflori

Original creation time: 2015-11-24 10:46:39

CC:  vbraun slelievre




---

Comment by mkoeppe created at 2016-07-26 06:51:37

Compile (on Mac OS X) fails as follows:

```
[valgrind-3.11.0] m_syscall.c:708:1: error: unknown type name '__private_extern__'
[valgrind-3.11.0]  __private_extern__ UWord 
[valgrind-3.11.0]  ^
[valgrind-3.11.0] m_syscall.c:709:1: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'do_syscall_unix_WRK'
[valgrind-3.11.0]  do_syscall_unix_WRK ( UWord a1, UWord a2, UWord a3, /* rdi, rsi, rdx */
[valgrind-3.11.0]  ^
[valgrind-3.11.0] m_syscall.c:732:1: error: unknown type name '__private_extern__'
[valgrind-3.11.0]  __private_extern__ UWord 
[valgrind-3.11.0]  ^
[valgrind-3.11.0] m_syscall.c:733:1: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'do_syscall_mach_WRK'
[valgrind-3.11.0]  do_syscall_mach_WRK ( UWord a1, UWord a2, UWord a3, /* rdi, rsi, rdx */
[valgrind-3.11.0]  ^
[valgrind-3.11.0] m_syscall.c: In function 'vgPlain_do_syscall':
[valgrind-3.11.0] m_syscall.c:1017:10: warning: implicit declaration of function 'do_syscall_unix_WRK' [-Wimplicit-function-declaration]
[valgrind-3.11.0]           wLO = do_syscall_unix_WRK(a1,a2,a3,a4,a5,a6,a7,a8,
[valgrind-3.11.0]           ^
[valgrind-3.11.0] m_syscall.c:1022:10: warning: implicit declaration of function 'do_syscall_mach_WRK' [-Wimplicit-function-declaration]
[valgrind-3.11.0]           wLO = do_syscall_mach_WRK(a1,a2,a3,a4,a5,a6,a7,a8, 
[valgrind-3.11.0]           ^
```

This appears to explain a solution: http://superuser.com/questions/630674/valgrind-installation-errors-on-osx-10-8
----
New commits:


---

Comment by jpflori created at 2016-11-15 12:04:26

3.12.0 is out now.


---

Comment by rws created at 2017-07-10 14:20:24

`sage --valgrind` crashes with a system valgrind both at 3.11.0 and 3.12.0, and current develop. It looks exactly like

https://bugs.kde.org/show_bug.cgi?id=360415

A self-compiled valgrind-3.13.0 does not do this anymore.


---

Comment by tmonteil created at 2017-08-27 21:42:05

On Debian stretch (32 bit arch), with our current version of valgrind, i get:


```
checking for the kernel version... unsupported (4.9.0-3-686)
configure: error: Valgrind works on kernels 2.4, 2.6
Error configuring Valgrind
```


So, it is really time to upgrade.


---

Comment by tmonteil created at 2017-08-28 12:07:27

On Debian stretch 64bit, with gdb packgage uninstalled, spkg-check gets stuck at:


```
[...]
[valgrind-3.13.0] ./gdbserver_tests/make_local_links /no/gdb/was/found/at/configure/time
[valgrind-3.13.0] gdbserver gdb tests suppressed as /no/gdb/was/found/at/configure/time is not executable
[valgrind-3.13.0] if /usr/bin/perl tests/vg_regtest gdbserver_tests memcheck cachegrind callgrind massif lackey none helgrind drd exp-sgcheck exp-bbv exp-dhat ; then \
[valgrind-3.13.0]    tests/post_regtest_checks /opt/sagemath/sage-source/local/var/tmp/sage/build/valgrind-3.13.0/src gdbserver_tests memcheck cachegrind callgrind massif lackey none helgrind drd exp-sgcheck exp-bbv exp-dhat; \
[valgrind-3.13.0] else \
[valgrind-3.13.0]    tests/post_regtest_checks /opt/sagemath/sage-source/local/var/tmp/sage/build/valgrind-3.13.0/src gdbserver_tests memcheck cachegrind callgrind massif lackey none helgrind drd exp-sgcheck exp-bbv exp-dhat; \
[valgrind-3.13.0]    false; \
[valgrind-3.13.0] fi
[valgrind-3.13.0] -- Running  tests in gdbserver_tests -----------------------------------
[valgrind-3.13.0] hginfo:          (skipping, prereq failed: test -e gdb.eval)
[valgrind-3.13.0] hgtls:           valgrind   --tool=helgrind --vgdb=yes --vgdb-error=0 --vgdb-prefix=./vgdb-prefix-hgtls -q  ./../none/tests/tls  (progB: ./gdb --quiet -l 60 --nx ../none/tests/tls)
```


With gdb installed, i get the following failure in self tests (see attachment).


---

Attachment

Valgrind 3.14.0 was released on 2018-10-09.

Tarball: https://sourceware.org/ftp/valgrind/valgrind-3.14.0.tar.bz2


---

Comment by SimonKing created at 2019-02-15 08:06:37

Changing status from new to needs_review.


---

Comment by SimonKing created at 2019-02-15 08:06:37

I upgraded to version 3.14. The package builds and I could use it via `sage --valgrind`. Starting a sage session, computing 2+2, and leaving, results in the following leak summary:

```
==15848== LEAK SUMMARY:
==15848==    definitely lost: 10,193 bytes in 5 blocks
==15848==    indirectly lost: 0 bytes in 0 blocks
==15848==      possibly lost: 39,322,259 bytes in 27,620 blocks
==15848==    still reachable: 2,116,195 bytes in 6,282 blocks
==15848==                       of which reachable via heuristic:
==15848==                         length64           : 227,192 bytes in 127 blocks
==15848==                         newarray           : 1,232 bytes in 77 blocks
==15848==         suppressed: 32 bytes in 1 blocks
==15848== Reachable blocks (those to which a pointer was found) are not shown.
==15848== To see them, rerun with: --leak-check=full --show-leak-kinds=all
==15848== 
==15848== For counts of detected and suppressed errors, rerun with: -v
==15848== ERROR SUMMARY: 3074 errors from 3074 contexts (suppressed: 44081 from 96)
```

----
New commits:


---

Comment by SimonKing created at 2019-02-15 08:09:48

Changing status from needs_review to positive_review.


---

Comment by SimonKing created at 2019-02-15 08:09:48

I guess for an experimental package, the fact that the package builds and can be used constitutes a positive review. Since I merely changed the checksum, I believe I am not author but reviewer.


---

Comment by slelievre created at 2019-02-15 08:28:30

Changing keywords from "" to "upgrade, valgrind".


---

Comment by vbraun created at 2019-02-18 19:28:57

Resolution: fixed
