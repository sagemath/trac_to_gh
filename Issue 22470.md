# Issue 22470: Remove CombinatorialFreeModule.__contains__

archive/issues_022470.json:
```json
{
    "body": "CC:  sage-combinat nthiery\n\n`Parent.__contains__` is implemented so that `x in R` is basically the same as `R(x)==x`.\n\nCombinatorialFreeModule overrides it, so that it becomes `x.parent()==R`. That notion of containment is totally against Sage's coercion framework and should finally (after 9 years) be removed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22707\n\n",
    "created_at": "2017-03-29T12:19:20Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "title": "Remove CombinatorialFreeModule.__contains__",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22470",
    "user": "SimonKing"
}
```
CC:  sage-combinat nthiery

`Parent.__contains__` is implemented so that `x in R` is basically the same as `R(x)==x`.

CombinatorialFreeModule overrides it, so that it becomes `x.parent()==R`. That notion of containment is totally against Sage's coercion framework and should finally (after 9 years) be removed.

Issue created by migration from https://trac.sagemath.org/ticket/22707





---

archive/issue_comments_313101.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-29T14:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-313101",
    "user": "SimonKing"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_313102.json:
```json
{
    "body": "I didn't run the tests yet...\n----\nNew commits:",
    "created_at": "2017-03-29T14:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-313102",
    "user": "SimonKing"
}
```

I didn't run the tests yet...
----
New commits:



---

archive/issue_comments_313103.json:
```json
{
    "body": "This broadens the result of `__contains__` by allowing things that *convert* into the CFM, so it is a behavior change. I'm not against this change, and I doubt anyone is actually using this distinction, but it is something to be aware of.\n\n```\nsage: F.<x,y> = FreeAlgebra(QQ)\nsage: R.<x,y> = FreeAlgebra(ZZ)\nsage: elt = 2*x + y\nsage: elt in F\nFalse\nsage: elt in R\nTrue\nsage: F(elt) == elt\nTrue\nsage: F(elt) in R\nFalse\n```\n\nAlso, in the cases of returning `False`, it is likely a slower check.",
    "created_at": "2017-03-29T15:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-313103",
    "user": "tscrim"
}
```

This broadens the result of `__contains__` by allowing things that *convert* into the CFM, so it is a behavior change. I'm not against this change, and I doubt anyone is actually using this distinction, but it is something to be aware of.

```
sage: F.<x,y> = FreeAlgebra(QQ)
sage: R.<x,y> = FreeAlgebra(ZZ)
sage: elt = 2*x + y
sage: elt in F
False
sage: elt in R
True
sage: F(elt) == elt
True
sage: F(elt) in R
False
```

Also, in the cases of returning `False`, it is likely a slower check.



---

archive/issue_comments_313104.json:
```json
{
    "body": "Hi Simon, Travis,\n\nHmm, the behaviour implemented in `Parent` is tricky and questionable.\nGenerally speaking, anything involving mathematical equality is\nintrinsically a potential can of worm; see e.g.\nhttps://wiki.sagemath.org/EqualityCoercion.\n\nLet's take an example:\n\n\n```\nsage: S = SymmetricFunctions(QQ)\nsage: S.inject_shorthands()\nsage: f = s[3]; f\ns[3]\nsage: f.parent()\nSymmetric Functions over Rational Field in the Schur basis\nsage: e\nSymmetric Functions over Rational Field in the elementary basis\nsage: f in e\nFalse\nsage: e(s[3])\ne[1, 1, 1] - 2*e[2, 1] + e[3]\n```\n\n\nAs a user, I might not expect `s` to be in `e`: it's certainly a\nsymmetric function, but not one expressed in the e basis. There is a\ncanonical coercion between the two, but it is nowhere trivial.\n\nWell, maybe I just have to accept that there is no perfect answer and\nconsistency should just be the priority. I don't remember: did we\nspecify explicitly somewhere what the semantic of contains should be,\nand how it should behave w.r.t. coercion?\n\nIn summary, like for equality, I am not comfortable with having\ncoercion involved, but maybe that's ok. On the other hand conversion\ncertainly should not be involved, as there is nothing canonical with\nthem. Maybe that's more or less taken care of by the equality test of\nR(x)=x.",
    "created_at": "2017-03-29T16:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-313104",
    "user": "nthiery"
}
```

Hi Simon, Travis,

Hmm, the behaviour implemented in `Parent` is tricky and questionable.
Generally speaking, anything involving mathematical equality is
intrinsically a potential can of worm; see e.g.
https://wiki.sagemath.org/EqualityCoercion.

Let's take an example:


```
sage: S = SymmetricFunctions(QQ)
sage: S.inject_shorthands()
sage: f = s[3]; f
s[3]
sage: f.parent()
Symmetric Functions over Rational Field in the Schur basis
sage: e
Symmetric Functions over Rational Field in the elementary basis
sage: f in e
False
sage: e(s[3])
e[1, 1, 1] - 2*e[2, 1] + e[3]
```


As a user, I might not expect `s` to be in `e`: it's certainly a
symmetric function, but not one expressed in the e basis. There is a
canonical coercion between the two, but it is nowhere trivial.

Well, maybe I just have to accept that there is no perfect answer and
consistency should just be the priority. I don't remember: did we
specify explicitly somewhere what the semantic of contains should be,
and how it should behave w.r.t. coercion?

In summary, like for equality, I am not comfortable with having
coercion involved, but maybe that's ok. On the other hand conversion
certainly should not be involved, as there is nothing canonical with
them. Maybe that's more or less taken care of by the equality test of
R(x)=x.



---

archive/issue_comments_313105.json:
```json
{
    "body": "does not apply",
    "created_at": "2018-03-11T17:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-313105",
    "user": "chapoton"
}
```

does not apply



---

archive/issue_comments_313106.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-11T17:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-313106",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.
