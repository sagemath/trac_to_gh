# Issue 22470: Remove CombinatorialFreeModule.__contains__

Issue created by migration from Trac.

Original creator: SimonKing

Original creation time: 2017-03-29 12:19:20

CC:  sage-combinat nthiery

`Parent.__contains__` is implemented so that `x in R` is basically the same as `R(x)==x`.

CombinatorialFreeModule overrides it, so that it becomes `x.parent()==R`. That notion of containment is totally against Sage's coercion framework and should finally (after 9 years) be removed.


---

Comment by SimonKing created at 2017-03-29 14:09:17

Changing status from new to needs_review.


---

Comment by SimonKing created at 2017-03-29 14:09:17

I didn't run the tests yet...
----
New commits:


---

Comment by tscrim created at 2017-03-29 15:19:39

This broadens the result of `__contains__` by allowing things that _convert_ into the CFM, so it is a behavior change. I'm not against this change, and I doubt anyone is actually using this distinction, but it is something to be aware of.

```
sage: F.<x,y> = FreeAlgebra(QQ)
sage: R.<x,y> = FreeAlgebra(ZZ)
sage: elt = 2*x + y
sage: elt in F
False
sage: elt in R
True
sage: F(elt) == elt
True
sage: F(elt) in R
False
```

Also, in the cases of returning `False`, it is likely a slower check.


---

Comment by nthiery created at 2017-03-29 16:32:02

Hi Simon, Travis,

Hmm, the behaviour implemented in `Parent` is tricky and questionable.
Generally speaking, anything involving mathematical equality is
intrinsically a potential can of worm; see e.g.
https://wiki.sagemath.org/EqualityCoercion.

Let's take an example:


```
sage: S = SymmetricFunctions(QQ)
sage: S.inject_shorthands()
sage: f = s[3]; f
s[3]
sage: f.parent()
Symmetric Functions over Rational Field in the Schur basis
sage: e
Symmetric Functions over Rational Field in the elementary basis
sage: f in e
False
sage: e(s[3])
e[1, 1, 1] - 2*e[2, 1] + e[3]
```


As a user, I might not expect `s` to be in `e`: it's certainly a
symmetric function, but not one expressed in the e basis. There is a
canonical coercion between the two, but it is nowhere trivial.

Well, maybe I just have to accept that there is no perfect answer and
consistency should just be the priority. I don't remember: did we
specify explicitly somewhere what the semantic of contains should be,
and how it should behave w.r.t. coercion?

In summary, like for equality, I am not comfortable with having
coercion involved, but maybe that's ok. On the other hand conversion
certainly should not be involved, as there is nothing canonical with
them. Maybe that's more or less taken care of by the equality test of
R(x)=x.


---

Comment by chapoton created at 2018-03-11 17:15:11

does not apply


---

Comment by chapoton created at 2018-03-11 17:15:11

Changing status from needs_review to needs_work.
