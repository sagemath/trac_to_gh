# Issue 32542: RealDoubleFieldElement without GSL: Add missing methods

Issue created by migration from https://trac.sagemath.org/ticket/32779

Original creator: mkoeppe

Original creation time: 2021-10-27 00:27:05

CC:  tmonteil

Follow-up on #32677: Observed in the context of #32432 (*sagemath-polyhedra*):

```
   AttributeError: 'sage.rings.real_double.RealDoubleElement' object has no attribute 'sin'
   AttributeError: 'sage.rings.real_double.RealDoubleElement' object has no attribute '_pow_'
```


In this ticket, we provide simple implementations for these methods (whose implementation using GSL was moved to a subclass in #32677)


---

Comment by git created at 2021-10-27 02:29:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-28 05:37:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-28 06:09:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-10-30 16:57:16

Changing status from new to needs_review.


---

Comment by dimpase created at 2021-12-03 18:12:58

I get

```
$ ./sage -tp src/sage/rings/real_double.pyx
Running doctests with ID 2021-12-03-18-09-42-15c43c30.
Git branch: wipprimec
Using --optional=build,dochtml,e_antic,gentoo,normaliz,pip,pynormaliz,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg
Doctesting 1 file using 4 threads.
sage -t --warn-long 58.0 --random-seed=69902574013687066773814734789326488934 src/sage/rings/real_double.pyx
**********************************************************************
File "src/sage/rings/real_double.pyx", line 2081, in sage.rings.real_double.RealDoubleElement._pow_
Failed example:
    RealDoubleElement._pow_(RDF(0), RDF(-1))
Expected:
    Traceback (most recent call last):
    ...
    ZeroDivisionError: 0.0 cannot be raised to a negative power
Got:
    +infinity
**********************************************************************
File "src/sage/rings/real_double.pyx", line 2089, in sage.rings.real_double.RealDoubleElement._pow_
Failed example:
    RealDoubleElement._pow_(RDF(-1), RDF(0.5))
Expected:
    Traceback (most recent call last):
    ...
    ValueError: negative number cannot be raised to a fractional power
Got:
    NaN
**********************************************************************
File "src/sage/rings/real_double.pyx", line 2104, in sage.rings.real_double.RealDoubleElement.cos
Failed example:
    RealDoubleElement.cos(t)
Expected:
    6.123233995736757e-17
Got:
    6.123233995736766e-17
**********************************************************************
File "src/sage/rings/real_double.pyx", line 2132, in sage.rings.real_double.RealDoubleElement.tan
Failed example:
    RealDoubleElement.tan(q)
Expected:
    0.5773502691896256
Got:
    0.5773502691896257
**********************************************************************
3 items had failures:
   2 of  12 in sage.rings.real_double.RealDoubleElement._pow_
   1 of   4 in sage.rings.real_double.RealDoubleElement.cos
   1 of   6 in sage.rings.real_double.RealDoubleElement.tan
    [373 tests, 4 failures, 0.26 s]
----------------------------------------------------------------------
sage -t --warn-long 58.0 --random-seed=69902574013687066773814734789326488934 src/sage/rings/real_double.pyx  # 4 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
Pytest is not installed, skip checking tests that rely on it.
```


two of these are trivial numerical noise, but the other two return NaNs/infinites, not throwing exceptions any more. Is this what we need?


---

Comment by dimpase created at 2021-12-03 18:12:58

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-12-04 01:13:29

`RDF` is not terribly consistent regarding exceptions vs. infinities/NaNs. For example:

```
sage: RDF(1.0)/RDF(0.0)
+infinity
sage: RDF(0.0)/RDF(0.0)
NaN
```



---

Comment by mkoeppe created at 2021-12-04 01:19:38

The code that raises these exceptions seems to come from #24247.


---

Comment by mkoeppe created at 2021-12-04 01:34:26

I've opened #32963 for this
