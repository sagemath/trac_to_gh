# Issue 28788: numpy: site.cfg needs a [DEFAULT] section

Issue created by migration from https://trac.sagemath.org/ticket/29025

Original creator: mkoeppe

Original creation time: 2020-01-16 02:57:57

CC:  dimpase jhpalmieri fbissey slelievre tscrim isuruf saraedum

numpy 1.16.1 seems to ignore the [ALL] section in this configuration file, but it respects the [DEFAULT] section.
 
Needed for #29013.


---

Comment by mkoeppe created at 2020-01-16 03:03:32

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-01-16 03:03:32

New commits:


---

Comment by fbissey created at 2020-01-16 03:20:41

This is weird. The documentation in numpy and everywhere talks about `[ALL]` and I cannot find anything about `[DEFAULT]` in the code. Is a different python library used to parse `site.cfg` and could it have changed its behavior without numpy catching it?


---

Comment by mkoeppe created at 2020-01-16 14:04:45

The file is apparently read by `ConfigParser`. https://docs.python.org/2/library/configparser.html
This page mentions the `DEFAULT` section.


---

Comment by mkoeppe created at 2020-01-16 14:05:52

The relevant numpy seems to be https://github.com/numpy/numpy/blob/558080ef33de051c52bd1214c372380680cb6800/numpy/distutils/system_info.py

It does not specifically have either `ALL` or `DEFAULT`.


---

Comment by mkoeppe created at 2020-01-16 14:12:27

My guess is that `site.cfg.example` is outdated.


---

Comment by mkoeppe created at 2020-01-16 14:14:14

There's an upstream issue: https://github.com/numpy/numpy/issues/1349


---

Comment by mkoeppe created at 2020-01-16 15:43:51

conda-forge uses [DEFAULT] as well: https://github.com/conda-forge/numpy-feedstock/blob/master/recipe/build.sh


---

Comment by mkoeppe created at 2020-01-16 16:03:13

It looks like in upstream numpy, configuration by `site.cfg` is not tested at all. Most of the continuous integration scripts install numpy using `pip` -- and of course, supplying the `site.cfg` does not work at all if one tries to install the package with pip.


---

Comment by mkoeppe created at 2020-01-16 16:11:53

Also https://github.com/numpy/numpy/issues/14286


---

Comment by mkoeppe created at 2020-01-16 16:20:30

I've reported it upstream in https://github.com/numpy/numpy/issues/14286#issuecomment-575228219


---

Comment by mkoeppe created at 2020-01-16 16:31:05

Needs review.


---

Comment by dimpase created at 2020-01-16 16:44:58

lgtm


---

Comment by dimpase created at 2020-01-16 16:44:58

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-01-16 17:03:48

Thanks!


---

Comment by vbraun created at 2020-01-20 21:17:54

Resolution: fixed


---

Comment by dimpase created at 2020-01-25 11:59:11

unfortunately `[DEFAULT]` section seems to override the other ones, so e.g. it gets impossible to use OpenBLAS from the system. I missed that when testing.


---

Comment by mkoeppe created at 2020-01-25 13:37:17

Follow-up = #29051.
