# Issue 25082: gcc, curl, git tarballs not included by sage --sdist

Issue created by migration from https://trac.sagemath.org/ticket/25319

Original creator: jhpalmieri

Original creation time: 2018-05-09 20:27:18

CC:  vbraun embray

It seems that packages that are not built on a system because of a configure check are not included in the upstream directory when running `sage --sdist`. This will often include `gcc`, `curl`, `git`, `gfortran` (which is the same tarball as `gcc`).


---

Comment by vbraun created at 2018-05-10 07:24:30

Related, it would be nice if `sage -sdist` wouldn't rely on configure at all. Right now, sdist basically requires you to configure / build Sage before making a tarball which is an annoyance for release management. As we see on this ticket, it is also error prone.


---

Comment by jdemeyer created at 2018-06-07 12:52:34

It's this change from #21524:

```diff
@@ -58,11 +58,11 @@ all-sage: \
 # option to make forces all targets to be built unconditionally)
 download-for-sdist: base
        env SAGE_INSTALL_FETCH_ONLY=yes $(MAKE) -B SAGERUNTIME= \
-               $(SDIST_PACKAGES)
+               $(SDIST_PACKAGE_INSTS)
 
```


Just reverting that should fix the problem.


---

Comment by git created at 2018-06-07 13:07:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-06-07 13:27:12

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-06-07 13:29:34

Replying to [comment:1 vbraun]:
> Related, it would be nice if `sage -sdist` wouldn't rely on configure at all.

Seriously, what is wrong with requiring `./configure`? Every autotools package depends on `./configure` before you can do anything. It only takes a few seconds...

> Right now, sdist basically requires you to configure / build Sage before making a tarball

configuring yes, but not building!

I just did

```
make distclean && ./configure && ./sage --sdist
```

and it worked.


---

Comment by jhpalmieri created at 2018-06-07 16:15:09

I am happy to give this a positive review, but maybe first someone (embray?) should explain the purpose of the change from #21524 that we are reverting.


---

Comment by jhpalmieri created at 2018-06-12 17:29:58

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2018-06-12 17:29:58

Okay, let's move on.


---

Comment by vbraun created at 2018-06-14 07:41:19

Resolution: fixed


---

Comment by embray created at 2018-06-14 15:05:15

Replying to [comment:6 jdemeyer]:
> Replying to [comment:1 vbraun]:
> > Related, it would be nice if `sage -sdist` wouldn't rely on configure at all.
> 
> Seriously, what is wrong with requiring `./configure`? Every autotools package depends on `./configure` before you can do anything. It only takes a few seconds...

I agree with Jeroen :)

> > Right now, sdist basically requires you to configure / build Sage before making a tarball
> 
> configuring yes, but not building!
> 
> I just did
> {{{
> make distclean && ./configure && ./sage --sdist
> }}}
> and it worked.

+1

I didn't even know what `sage --sdist` is supposed to do though.  Is that documented somewhere?


---

Comment by jhpalmieri created at 2018-06-14 15:20:28

Replying to [comment:10 embray]:
> I didn't even know what `sage --sdist` is supposed to do though.  Is that documented somewhere?

The description of command-line options available from `sage --advanced` (and also in the [reference manual](http://doc.sagemath.org/html/en/reference/repl/options.html#command-line-options-for-sage)) says

```
  -sdist              -- build a source distribution of Sage
```

That's the extent of the documentation, I think.


---

Comment by embray created at 2018-06-20 13:50:05

It's not really clear what's meant by that.
