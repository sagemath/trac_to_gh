# Issue 32827: Segmentation fault in face iterator

archive/issues_032590.json:
```json
{
    "body": "A patchbots is reporting consistent segmentation faults with combinatorial polyhedron:\n\nE.g.\n\nhttps://patchbot.sagemath.org/log/32788/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-30%2023:39:45\n\nhttps://patchbot.sagemath.org/log/32777/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc3/2021-11-04%2016:33:47\n\n**CC:**  tmonteil @tscrim @vbraun\n\n**Branch:** [cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5](https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5)\n\n**Reviewer:** Matthias Koeppe, Thierry Monteil\n\n**Author:** Jonathan Kliem\n\nIssue created by migration from https://trac.sagemath.org/ticket/32827\n\n",
    "closed_at": "2021-12-23T20:26:40Z",
    "created_at": "2021-11-05T07:14:03Z",
    "labels": [
        "component: geometry",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Segmentation fault in face iterator",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32827",
    "user": "https://github.com/kliem"
}
```
A patchbots is reporting consistent segmentation faults with combinatorial polyhedron:

E.g.

https://patchbot.sagemath.org/log/32788/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-30%2023:39:45

https://patchbot.sagemath.org/log/32777/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc3/2021-11-04%2016:33:47

**CC:**  tmonteil @tscrim @vbraun

**Branch:** [cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5](https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5)

**Reviewer:** Matthias Koeppe, Thierry Monteil

**Author:** Jonathan Kliem

Issue created by migration from https://trac.sagemath.org/ticket/32827





---

archive/issue_comments_532497.json:
```json
{
    "body": "<a id='comment:1'></a>\n`@`tmonteil:\n\nCould you perhaps inspect that bot and the sage version, if it is still running. It could be a bug with #32666 or a bug that shows now, because something is compiled differently, due to code change.\n\nEither way, it would greatly help, if you could inspect a few things:\n\nDoes this work:\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: Asso.vertex_adjacency_matrix()\n[0 1 0 0 0 1 0 0 1 0 0 0 0 0]\n[1 0 1 0 0 0 0 1 0 0 0 0 0 0]\n[0 1 0 1 0 1 0 0 0 0 0 0 0 0]\n[0 0 1 0 1 0 0 0 0 0 0 1 0 0]\n[0 0 0 1 0 0 0 1 0 0 0 0 1 0]\n[1 0 1 0 0 0 0 0 0 0 0 0 0 1]\n[0 0 0 0 0 0 0 1 1 0 1 0 0 0]\n[0 1 0 0 1 0 1 0 0 0 0 0 0 0]\n[1 0 0 0 0 0 1 0 0 1 0 0 0 0]\n[0 0 0 0 0 0 0 0 1 0 1 0 0 1]\n[0 0 0 0 0 0 1 0 0 1 0 0 1 0]\n[0 0 0 1 0 0 0 0 0 0 0 0 1 1]\n[0 0 0 0 1 0 0 0 0 0 1 1 0 0]\n[0 0 0 0 0 1 0 0 0 1 0 1 0 0]\n```\n\nI guess not.\n\nNow, the combinatorial polyhedron is probably still obtained fine:\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\n```\n\nOnce you have it, there are a number of things to test:\n\n```\nsage: C.edges()\n```\n\n```\nsage: for f in C.face_iter():\n....:     print(f)\n```\n\nSame for `C.face_iter(dual=True)`, `C.face_iter(0)`, `C.face_iter(0, dual=True)`.\n\nIt should help a lot in catching that bug, seeing exactly when there is a segmentation fault.\n\nPlease do not recompile, as the bug might hide then. But I don't know.",
    "created_at": "2021-11-05T07:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532497",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>
`@`tmonteil:

Could you perhaps inspect that bot and the sage version, if it is still running. It could be a bug with #32666 or a bug that shows now, because something is compiled differently, due to code change.

Either way, it would greatly help, if you could inspect a few things:

Does this work:

```
sage: Asso = polytopes.associahedron(['A',3])
sage: Asso.vertex_adjacency_matrix()
[0 1 0 0 0 1 0 0 1 0 0 0 0 0]
[1 0 1 0 0 0 0 1 0 0 0 0 0 0]
[0 1 0 1 0 1 0 0 0 0 0 0 0 0]
[0 0 1 0 1 0 0 0 0 0 0 1 0 0]
[0 0 0 1 0 0 0 1 0 0 0 0 1 0]
[1 0 1 0 0 0 0 0 0 0 0 0 0 1]
[0 0 0 0 0 0 0 1 1 0 1 0 0 0]
[0 1 0 0 1 0 1 0 0 0 0 0 0 0]
[1 0 0 0 0 0 1 0 0 1 0 0 0 0]
[0 0 0 0 0 0 0 0 1 0 1 0 0 1]
[0 0 0 0 0 0 1 0 0 1 0 0 1 0]
[0 0 0 1 0 0 0 0 0 0 0 0 1 1]
[0 0 0 0 1 0 0 0 0 0 1 1 0 0]
[0 0 0 0 0 1 0 0 0 1 0 1 0 0]
```

I guess not.

Now, the combinatorial polyhedron is probably still obtained fine:

```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
```

Once you have it, there are a number of things to test:

```
sage: C.edges()
```

```
sage: for f in C.face_iter():
....:     print(f)
```

Same for `C.face_iter(dual=True)`, `C.face_iter(0)`, `C.face_iter(0, dual=True)`.

It should help a lot in catching that bug, seeing exactly when there is a segmentation fault.

Please do not recompile, as the bug might hide then. But I don't know.



---

archive/issue_comments_532498.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n-Some patchbots are reporting consistent segmentation faults with combinatorial polyhedron:\n+A patchbots is reporting consistent segmentation faults with combinatorial polyhedron:\n \n E.g.\n \n https://patchbot.sagemath.org/log/32788/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-30%2023:39:45\n \n-\n+https://patchbot.sagemath.org/log/32777/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc3/2021-11-04%2016:33:47\n``````\n",
    "created_at": "2021-11-05T07:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532498",
    "user": "https://github.com/kliem"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
-Some patchbots are reporting consistent segmentation faults with combinatorial polyhedron:
+A patchbots is reporting consistent segmentation faults with combinatorial polyhedron:
 
 E.g.
 
 https://patchbot.sagemath.org/log/32788/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-30%2023:39:45
 
-
+https://patchbot.sagemath.org/log/32777/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc3/2021-11-04%2016:33:47
``````




---

archive/issue_comments_532499.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [gh-kliem](#comment%3A1):\n> `@`tmonteil:\n> \n> Could you perhaps inspect that bot and the sage version, if it is still running. It could be a bug with #32666 or a bug that shows now, because something is compiled differently, due to code change.\n> \n> Either way, it would greatly help, if you could inspect a few things:\n> \n> Does this work:\n\n\nOn the current state of `tmonteil-lxc1`, wich is a merge between `9.5.beta5` and the branch of #32320 i do not have any error.\n\nOn `tmonteil-lxc3`, which is a merge between `9.5.beta5` and the branch of #31635, i have:\n\n> ```\n> sage: Asso = polytopes.associahedron(['A',3])\n> sage: Asso.vertex_adjacency_matrix()\n> [0 1 0 0 0 1 0 0 1 0 0 0 0 0]\n> [1 0 1 0 0 0 0 1 0 0 0 0 0 0]\n> [0 1 0 1 0 1 0 0 0 0 0 0 0 0]\n> [0 0 1 0 1 0 0 0 0 0 0 1 0 0]\n> [0 0 0 1 0 0 0 1 0 0 0 0 1 0]\n> [1 0 1 0 0 0 0 0 0 0 0 0 0 1]\n> [0 0 0 0 0 0 0 1 1 0 1 0 0 0]\n> [0 1 0 0 1 0 1 0 0 0 0 0 0 0]\n> [1 0 0 0 0 0 1 0 0 1 0 0 0 0]\n> [0 0 0 0 0 0 0 0 1 0 1 0 0 1]\n> [0 0 0 0 0 0 1 0 0 1 0 0 1 0]\n> [0 0 0 1 0 0 0 0 0 0 0 0 1 1]\n> [0 0 0 0 1 0 0 0 0 0 1 1 0 0]\n> [0 0 0 0 0 1 0 0 0 1 0 1 0 0]\n> ```\n> \n> I guess not.\n\n\n\nIndeed:\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: Asso.vertex_adjacency_matrix()\n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f2d6c21947b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f2d6c21f2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f2d6c21fff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f2d6fc47730]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xe4d0)[0x7f2d112f54d0]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x14466)[0x7f2d112fb466]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1d3d2)[0x7f2d113723d2]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1f1d7)[0x7f2d113741d7]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x49d7b)[0x7f2d1139ed7b]\npython3(_PyMethodDef_RawFastCallDict+0x22a)[0x5d8c6a]\npython3[0x4d743e]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x134cd)[0x7f2d6cdb64cd]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x287eb)[0x7f2d6cdcb7eb]\npython3(_PyObject_FastCallKeywords+0x4eb)[0x5da01b]\npython3[0x54b3c1]\npython3(_PyEval_EvalFrameDefault+0x441d)[0x5524cd]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x10c13)[0x7f2d6cdb3c13]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x10dba)[0x7f2d6cdb3dba]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x287d0)[0x7f2d6cdcb7d0]\npython3(_PyObject_FastCallKeywords+0x4eb)[0x5da01b]\npython3[0x54b3c1]\npython3(_PyEval_EvalFrameDefault+0x441d)[0x5524cd]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f2d6f6ae09b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1024695.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n\n\n> Now, the combinatorial polyhedron is probably still obtained fine:\n> \n> ```\n> sage: Asso = polytopes.associahedron(['A',3])\n> sage: C = Asso.combinatorial_polyhedron()\n> ```\n> \n> Once you have it, there are a number of things to test:\n> \n> ```\n> sage: C.edges()\n> ```\n\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: C.edges()\n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f4e6052547b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f4e6052b2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f4e6052bff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f4e63513730]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xe4d0)[0x7f4e04bc24d0]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x14466)[0x7f4e04bc8466]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1d3d2)[0x7f4e04c3f3d2]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1f1d7)[0x7f4e04c411d7]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x4d73d)[0x7f4e04c6f73d]\npython3(_PyMethodDescr_FastCallKeywords+0x3c4)[0x4d7914]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f4e62f7a09b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1024859.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n\n\n> ```\n> sage: for f in C.face_iter():\n> ....:     print(f)\n> ```\n\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: for f in C.face_iter():\n....:     print(f)\n....: \n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f31646b547b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f31646bb2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f31646bbff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f31676a3730]\n/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7f3167242b0d]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7f3108d8b05a]\npython3[0x599551]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7f3108d529ac]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7f3108d5b948]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7f3108d602ef]\npython3(_PyEval_EvalFrameDefault+0x8cd)[0x54e97d]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f316710a09b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1025024.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n\n\n> Same for `C.face_iter(dual=True)`,\n\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: for f in C.face_iter(dual=True):\n....:     print(f)\n....: \n------------------------------------------------------------------------\nSegmentation fault\n```\n\n> `C.face_iter(0)`,\n\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: for f in C.face_iter(0):\n....:     print(f)\n....: \nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\n```\n\n> `C.face_iter(0, dual=True)`.\n\n\n\n```\nsage: for f in C.face_iter(0, dual=True):\n....:     print(f)\n....: \n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f6886f5547b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f6886f5b2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f6886f5bff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f688a983730]\n/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7f688a522b0d]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7f682c06a05a]\npython3[0x599551]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7f682c0319ac]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7f682c03a948]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7f682c03f2ef]\npython3(_PyEval_EvalFrameDefault+0x8cd)[0x54e97d]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f688a3ea09b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1025356.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n\n> It should help a lot in catching that bug, seeing exactly when there is a segmentation fault.\n> \n> Please do not recompile, as the bug might hide then. But I don't know.\n",
    "created_at": "2021-11-05T13:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532499",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:2'></a>
Replying to [gh-kliem](#comment%3A1):
> `@`tmonteil:
> 
> Could you perhaps inspect that bot and the sage version, if it is still running. It could be a bug with #32666 or a bug that shows now, because something is compiled differently, due to code change.
> 
> Either way, it would greatly help, if you could inspect a few things:
> 
> Does this work:


On the current state of `tmonteil-lxc1`, wich is a merge between `9.5.beta5` and the branch of #32320 i do not have any error.

On `tmonteil-lxc3`, which is a merge between `9.5.beta5` and the branch of #31635, i have:

> ```
> sage: Asso = polytopes.associahedron(['A',3])
> sage: Asso.vertex_adjacency_matrix()
> [0 1 0 0 0 1 0 0 1 0 0 0 0 0]
> [1 0 1 0 0 0 0 1 0 0 0 0 0 0]
> [0 1 0 1 0 1 0 0 0 0 0 0 0 0]
> [0 0 1 0 1 0 0 0 0 0 0 1 0 0]
> [0 0 0 1 0 0 0 1 0 0 0 0 1 0]
> [1 0 1 0 0 0 0 0 0 0 0 0 0 1]
> [0 0 0 0 0 0 0 1 1 0 1 0 0 0]
> [0 1 0 0 1 0 1 0 0 0 0 0 0 0]
> [1 0 0 0 0 0 1 0 0 1 0 0 0 0]
> [0 0 0 0 0 0 0 0 1 0 1 0 0 1]
> [0 0 0 0 0 0 1 0 0 1 0 0 1 0]
> [0 0 0 1 0 0 0 0 0 0 0 0 1 1]
> [0 0 0 0 1 0 0 0 0 0 1 1 0 0]
> [0 0 0 0 0 1 0 0 0 1 0 1 0 0]
> ```
> 
> I guess not.



Indeed:

```
sage: Asso = polytopes.associahedron(['A',3])
sage: Asso.vertex_adjacency_matrix()
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f2d6c21947b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f2d6c21f2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f2d6c21fff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f2d6fc47730]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xe4d0)[0x7f2d112f54d0]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x14466)[0x7f2d112fb466]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1d3d2)[0x7f2d113723d2]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1f1d7)[0x7f2d113741d7]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x49d7b)[0x7f2d1139ed7b]
python3(_PyMethodDef_RawFastCallDict+0x22a)[0x5d8c6a]
python3[0x4d743e]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x134cd)[0x7f2d6cdb64cd]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x287eb)[0x7f2d6cdcb7eb]
python3(_PyObject_FastCallKeywords+0x4eb)[0x5da01b]
python3[0x54b3c1]
python3(_PyEval_EvalFrameDefault+0x441d)[0x5524cd]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x10c13)[0x7f2d6cdb3c13]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x10dba)[0x7f2d6cdb3dba]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x287d0)[0x7f2d6cdcb7d0]
python3(_PyObject_FastCallKeywords+0x4eb)[0x5da01b]
python3[0x54b3c1]
python3(_PyEval_EvalFrameDefault+0x441d)[0x5524cd]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f2d6f6ae09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1024695.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```


> Now, the combinatorial polyhedron is probably still obtained fine:
> 
> ```
> sage: Asso = polytopes.associahedron(['A',3])
> sage: C = Asso.combinatorial_polyhedron()
> ```
> 
> Once you have it, there are a number of things to test:
> 
> ```
> sage: C.edges()
> ```



```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: C.edges()
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f4e6052547b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f4e6052b2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f4e6052bff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f4e63513730]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xe4d0)[0x7f4e04bc24d0]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x14466)[0x7f4e04bc8466]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1d3d2)[0x7f4e04c3f3d2]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1f1d7)[0x7f4e04c411d7]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x4d73d)[0x7f4e04c6f73d]
python3(_PyMethodDescr_FastCallKeywords+0x3c4)[0x4d7914]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f4e62f7a09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1024859.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```


> ```
> sage: for f in C.face_iter():
> ....:     print(f)
> ```



```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: for f in C.face_iter():
....:     print(f)
....: 
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f31646b547b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f31646bb2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f31646bbff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f31676a3730]
/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7f3167242b0d]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7f3108d8b05a]
python3[0x599551]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7f3108d529ac]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7f3108d5b948]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7f3108d602ef]
python3(_PyEval_EvalFrameDefault+0x8cd)[0x54e97d]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f316710a09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1025024.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```


> Same for `C.face_iter(dual=True)`,



```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: for f in C.face_iter(dual=True):
....:     print(f)
....: 
------------------------------------------------------------------------
Segmentation fault
```

> `C.face_iter(0)`,



```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: for f in C.face_iter(0):
....:     print(f)
....: 
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
```

> `C.face_iter(0, dual=True)`.



```
sage: for f in C.face_iter(0, dual=True):
....:     print(f)
....: 
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f6886f5547b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f6886f5b2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f6886f5bff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f688a983730]
/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7f688a522b0d]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7f682c06a05a]
python3[0x599551]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7f682c0319ac]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7f682c03a948]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7f682c03f2ef]
python3(_PyEval_EvalFrameDefault+0x8cd)[0x54e97d]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f688a3ea09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1025356.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```

> It should help a lot in catching that bug, seeing exactly when there is a segmentation fault.
> 
> Please do not recompile, as the bug might hide then. But I don't know.




---

archive/issue_comments_532500.json:
```json
{
    "body": "<a id='comment:3'></a>\nThank you.\n\nThat is even worse than I thought, but on the upside this might make debugging easier.\n\nHow about:\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: C.face_iter()\nIterator over the proper faces of a 3-dimensional combinatorial polyhedron\n```\n\nIf this works:\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: it = C.face_iter()\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport FaceIterator\n....: def foo(FaceIterator it):\n....:     cdef int d = it.next_dimension()\n....:     while d < it.structure.dimension:\n....:         print(d)\n....:         print(it.n_atom_rep())\n....:         a = it.set_atom_rep()\n....:         print([it.structure.atom_rep[i] for i in range(a)])\n....:         b = it.set_coatom_rep()\n....:         print([it.structure.coatom_rep[i] for i in range(b)])\n....:         d = it.next_dimension()\n....: ''')\nsage: foo(it)\n```",
    "created_at": "2021-11-05T13:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532500",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
Thank you.

That is even worse than I thought, but on the upside this might make debugging easier.

How about:

```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: C.face_iter()
Iterator over the proper faces of a 3-dimensional combinatorial polyhedron
```

If this works:

```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: it = C.face_iter()
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport FaceIterator
....: def foo(FaceIterator it):
....:     cdef int d = it.next_dimension()
....:     while d < it.structure.dimension:
....:         print(d)
....:         print(it.n_atom_rep())
....:         a = it.set_atom_rep()
....:         print([it.structure.atom_rep[i] for i in range(a)])
....:         b = it.set_coatom_rep()
....:         print([it.structure.coatom_rep[i] for i in range(b)])
....:         d = it.next_dimension()
....: ''')
sage: foo(it)
```



---

archive/issue_comments_532501.json:
```json
{
    "body": "<a id='comment:4'></a>\nOn both machines, i got: \n\n```\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: C = Asso.combinatorial_polyhedron()\n....: sage: C.face_iter()\nIterator over the proper faces of a 3-dimensional combinatorial polyhedron\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: C = Asso.combinatorial_polyhedron()\n....: sage: it = C.face_iter()\n....: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport FaceIterator\n....: ....: def foo(FaceIterator it):\n....: ....:     cdef int d = it.next_dimension()\n....: ....:     while d < it.structure.dimension:\n....: ....:         print(d)\n....: ....:         print(it.n_atom_rep())\n....: ....:         a = it.set_atom_rep()\n....: ....:         print([it.structure.atom_rep[i] for i in range(a)])\n....: ....:         b = it.set_coatom_rep()\n....: ....:         print([it.structure.coatom_rep[i] for i in range(b)])\n....: ....:         d = it.next_dimension()\n....: ....: ''')\n....: sage: foo(it)\n2\n5\n[0, 5, 8, 9, 13]\n[8]\n2\n4\n[6, 8, 9, 10]\n[7]\n2\n5\n[4, 6, 7, 10, 12]\n[6]\n2\n4\n[3, 4, 11, 12]\n[5]\n\n\n\n\n2\n5\n[9, 10, 11, 12, 13]\n[3]\n2\n5\n[2, 3, 5, 11, 13]\n[2]\n2\n4\n[0, 1, 2, 5]\n[1]\n2\n5\n[1, 2, 3, 4, 7]\n[0]\n1\n2\n[8, 9]\n[7, 8]\n1\n2\n[0, 8]\n[4, 8]\n1\n2\n[9, 13]\n[3, 8]\n1\n2\n[5, 13]\n[2, 8]\n1\n2\n[0, 5]\n[1, 8]\n0\n1\n[8]\n[4, 7, 8]\n0\n1\n[9]\n[3, 7, 8]\n0\n1\n[0]\n[1, 4, 8]\n0\n1\n[13]\n[2, 3, 8]\n0\n1\n[5]\n[1, 2, 8]\n1\n2\n[6, 10]\n[6, 7]\n1\n2\n[6, 8]\n[4, 7]\n1\n2\n[9, 10]\n[3, 7]\n0\n1\n[6]\n[4, 6, 7]\n0\n1\n[10]\n[3, 6, 7]\n1\n2\n[4, 12]\n[5, 6]\n1\n2\n[6, 7]\n[4, 6]\n1\n2\n[10, 12]\n[3, 6]\n1\n2\n[4, 7]\n[0, 6]\n0\n1\n[12]\n[3, 5, 6]\n0\n1\n[4]\n[0, 5, 6]\n0\n1\n[7]\n[0, 4, 6]\n1\n2\n[11, 12]\n[3, 5]\n1\n2\n[3, 11]\n[2, 5]\n1\n2\n[3, 4]\n[0, 5]\n0\n1\n[11]\n[2, 3, 5]\n0\n1\n[3]\n[0, 2, 5]\n1\n2\n[0, 1]\n[1, 4]\n1\n2\n[1, 7]\n[0, 4]\n0\n1\n[1]\n[0, 1, 4]\n1\n2\n[11, 13]\n[2, 3]\n1\n2\n[2, 5]\n[1, 2]\n1\n2\n[2, 3]\n[0, 2]\n0\n1\n[2]\n[0, 1, 2]\n1\n2\n[1, 2]\n[0, 1]\n```",
    "created_at": "2021-11-05T14:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532501",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:4'></a>
On both machines, i got: 

```
sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: C = Asso.combinatorial_polyhedron()
....: sage: C.face_iter()
Iterator over the proper faces of a 3-dimensional combinatorial polyhedron
sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: C = Asso.combinatorial_polyhedron()
....: sage: it = C.face_iter()
....: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport FaceIterator
....: ....: def foo(FaceIterator it):
....: ....:     cdef int d = it.next_dimension()
....: ....:     while d < it.structure.dimension:
....: ....:         print(d)
....: ....:         print(it.n_atom_rep())
....: ....:         a = it.set_atom_rep()
....: ....:         print([it.structure.atom_rep[i] for i in range(a)])
....: ....:         b = it.set_coatom_rep()
....: ....:         print([it.structure.coatom_rep[i] for i in range(b)])
....: ....:         d = it.next_dimension()
....: ....: ''')
....: sage: foo(it)
2
5
[0, 5, 8, 9, 13]
[8]
2
4
[6, 8, 9, 10]
[7]
2
5
[4, 6, 7, 10, 12]
[6]
2
4
[3, 4, 11, 12]
[5]




2
5
[9, 10, 11, 12, 13]
[3]
2
5
[2, 3, 5, 11, 13]
[2]
2
4
[0, 1, 2, 5]
[1]
2
5
[1, 2, 3, 4, 7]
[0]
1
2
[8, 9]
[7, 8]
1
2
[0, 8]
[4, 8]
1
2
[9, 13]
[3, 8]
1
2
[5, 13]
[2, 8]
1
2
[0, 5]
[1, 8]
0
1
[8]
[4, 7, 8]
0
1
[9]
[3, 7, 8]
0
1
[0]
[1, 4, 8]
0
1
[13]
[2, 3, 8]
0
1
[5]
[1, 2, 8]
1
2
[6, 10]
[6, 7]
1
2
[6, 8]
[4, 7]
1
2
[9, 10]
[3, 7]
0
1
[6]
[4, 6, 7]
0
1
[10]
[3, 6, 7]
1
2
[4, 12]
[5, 6]
1
2
[6, 7]
[4, 6]
1
2
[10, 12]
[3, 6]
1
2
[4, 7]
[0, 6]
0
1
[12]
[3, 5, 6]
0
1
[4]
[0, 5, 6]
0
1
[7]
[0, 4, 6]
1
2
[11, 12]
[3, 5]
1
2
[3, 11]
[2, 5]
1
2
[3, 4]
[0, 5]
0
1
[11]
[2, 3, 5]
0
1
[3]
[0, 2, 5]
1
2
[0, 1]
[1, 4]
1
2
[1, 7]
[0, 4]
0
1
[1]
[0, 1, 4]
1
2
[11, 13]
[2, 3]
1
2
[2, 5]
[1, 2]
1
2
[2, 3]
[0, 2]
0
1
[2]
[0, 1, 2]
1
2
[1, 2]
[0, 1]
```



---

archive/issue_comments_532502.json:
```json
{
    "body": "<a id='comment:5'></a>\nThank you. Apparently the face iterator works and something with `CombinatorialFace` is failing.\n\nCan you please try the following:\n\n```\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: \n....: cdef class foo:\n....:     cdef face_t face\n....:     cdef MemoryAllocator mem\n....:     \n....:     def __cinit__(self):\n....:         self.mem = MemoryAllocator()\n....:         face_init(self.face, 9, 14, self.mem)\n....:         \n....:     def test(self):\n....:         cdef face_t new_face\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_init(new_face, 9, 14, mem)\n....:         print('b')\n....:         face_copy(self.face, new_face)\n....:         \n....:     def test2(self):\n....:         cdef face_list_t faces\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_list_init(faces, 9, 9, 14, mem)\n....:         cdef face_t new_face\n....:         for i in range(9):\n....:             print(i)\n....:             new_face[0] = faces.faces[i][0]\n....:             print(i, 'b')\n....:             face_copy(self.face, new_face)\n....: ''')\nsage: a = foo()\nsage: a.test()\nsage: a.test2()\n```",
    "created_at": "2021-11-05T15:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532502",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>
Thank you. Apparently the face iterator works and something with `CombinatorialFace` is failing.

Can you please try the following:

```
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: 
....: cdef class foo:
....:     cdef face_t face
....:     cdef MemoryAllocator mem
....:     
....:     def __cinit__(self):
....:         self.mem = MemoryAllocator()
....:         face_init(self.face, 9, 14, self.mem)
....:         
....:     def test(self):
....:         cdef face_t new_face
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_init(new_face, 9, 14, mem)
....:         print('b')
....:         face_copy(self.face, new_face)
....:         
....:     def test2(self):
....:         cdef face_list_t faces
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_list_init(faces, 9, 9, 14, mem)
....:         cdef face_t new_face
....:         for i in range(9):
....:             print(i)
....:             new_face[0] = faces.faces[i][0]
....:             print(i, 'b')
....:             face_copy(self.face, new_face)
....: ''')
sage: a = foo()
sage: a.test()
sage: a.test2()
```



---

archive/issue_comments_532503.json:
```json
{
    "body": "<a id='comment:6'></a>\nI got : \n\n```\nsage: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: ....: \n....: ....: cdef class foo:\n....: ....:     cdef face_t face\n....: ....:     cdef MemoryAllocator mem\n....: ....:     \n....: ....:     def __cinit__(self):\n....: ....:         self.mem = MemoryAllocator()\n....: ....:         face_init(self.face, 9, 14, self.mem)\n....: ....:         \n....: ....:     def test(self):\n....: ....:         cdef face_t new_face\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_init(new_face, 9, 14, mem)\n....: ....:         print('b')\n....: ....:         face_copy(self.face, new_face)\n....: ....:         \n....: ....:     def test2(self):\n....: ....:         cdef face_list_t faces\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_list_init(faces, 9, 9, 14, mem)\n....: ....:         cdef face_t new_face\n....: ....:         for i in range(9):\n....: ....:             print(i)\n....: ....:             new_face[0] = faces.faces[i][0]\n....: ....:             print(i, 'b')\n....: ....:             face_copy(self.face, new_face)\n....: ....: ''')\n....: sage: a = foo()\n....: sage: a.test()\n....: sage: a.test2()\n....: \na\nb\na\n0\n0 b\n1\n1 b\n2\n2 b\n3\n3 b\n4\n4 b\n5\n5 b\n6\n6 b\n7\n7 b\n8\n8 b\n```",
    "created_at": "2021-11-05T16:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532503",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:6'></a>
I got : 

```
sage: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: ....: 
....: ....: cdef class foo:
....: ....:     cdef face_t face
....: ....:     cdef MemoryAllocator mem
....: ....:     
....: ....:     def __cinit__(self):
....: ....:         self.mem = MemoryAllocator()
....: ....:         face_init(self.face, 9, 14, self.mem)
....: ....:         
....: ....:     def test(self):
....: ....:         cdef face_t new_face
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_init(new_face, 9, 14, mem)
....: ....:         print('b')
....: ....:         face_copy(self.face, new_face)
....: ....:         
....: ....:     def test2(self):
....: ....:         cdef face_list_t faces
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_list_init(faces, 9, 9, 14, mem)
....: ....:         cdef face_t new_face
....: ....:         for i in range(9):
....: ....:             print(i)
....: ....:             new_face[0] = faces.faces[i][0]
....: ....:             print(i, 'b')
....: ....:             face_copy(self.face, new_face)
....: ....: ''')
....: sage: a = foo()
....: sage: a.test()
....: sage: a.test2()
....: 
a
b
a
0
0 b
1
1 b
2
2 b
3
3 b
4
4 b
5
5 b
6
6 b
7
7 b
8
8 b
```



---

archive/issue_comments_532504.json:
```json
{
    "body": "<a id='comment:7'></a>\nOk, thanks. Sorry this is taking so long.\n\nThe only thing that I can think of right now, is that one needs to be careful with `__cinit__` and `__init__`.\n\nCan you please try:\n\n```\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: \n....: cdef class foo:\n....:     cdef face_t face\n....:     cdef MemoryAllocator mem\n....:     \n....:     def __init__(self):\n....:         self.mem = MemoryAllocator()\n....:         face_init(self.face, 9, 14, self.mem)\n....:         \n....:     def test(self):\n....:         cdef face_t new_face\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_init(new_face, 9, 14, mem)\n....:         print('b')\n....:         face_copy(self.face, new_face)\n....:         \n....:     def test2(self):\n....:         cdef face_list_t faces\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_list_init(faces, 9, 9, 14, mem)\n....:         cdef face_t new_face\n....:         for i in range(9):\n....:             print(i)\n....:             new_face[0] = faces.faces[i][0]\n....:             print(i, 'b')\n....:             face_copy(self.face, new_face)\n....: ''')\nsage: a = foo()\nsage: a.test()\nsage: a.test2()\n```\n\nAlso just to confirm:\n\n```\nsage: sage: Asso = polytopes.associahedron(['A',3])\nsage: it = Asso.face_generator()\nsage: f = next(it)\nsage: f\nA 3-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 14 vertices\nsage: f = next(it)\nsage: f\nA -1-dimensional face of a Polyhedron in QQ^3\nsage: f = next(it)\nsage: f\nA 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 5 vertices\n```\n\nAnd:\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: it = C.face_iter()\nsage: f = next(it)\nsage: f\nA 2-dimensional face of a 3-dimensional combinatorial polyhedron\nsage: f = next(it)\nsage: f\nA 2-dimensional face of a 3-dimensional combinatorial polyhedron\n```\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: it = C.face_iter()\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: def foo(FaceIterator_base it):\n....:     it.next_dimension()\n....:     print('a')\n....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)\n....:     print('b')\n....:     face.__init__(it)\n....:     print('c')\n....:     return face\n....: ''')\nsage: foo(it)\na\nb\nc\nA 2-dimensional face of a 3-dimensional combinatorial polyhedron\n```\n\n\n\nThere is definitely a problem with init and cinit as the following shoud not lead to a segmentationfault (but does and also for me):\n\n```\nsage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace\nsage: face = CombinatorialFace.__new__(CombinatorialFace)\nsage: face.ambient_H_indices()\n```\n\nI don't know if this is the issue. I can try to fix this `__init__` and `__cinit__` things and see if this solves something.",
    "created_at": "2021-11-05T18:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532504",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>
Ok, thanks. Sorry this is taking so long.

The only thing that I can think of right now, is that one needs to be careful with `__cinit__` and `__init__`.

Can you please try:

```
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: 
....: cdef class foo:
....:     cdef face_t face
....:     cdef MemoryAllocator mem
....:     
....:     def __init__(self):
....:         self.mem = MemoryAllocator()
....:         face_init(self.face, 9, 14, self.mem)
....:         
....:     def test(self):
....:         cdef face_t new_face
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_init(new_face, 9, 14, mem)
....:         print('b')
....:         face_copy(self.face, new_face)
....:         
....:     def test2(self):
....:         cdef face_list_t faces
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_list_init(faces, 9, 9, 14, mem)
....:         cdef face_t new_face
....:         for i in range(9):
....:             print(i)
....:             new_face[0] = faces.faces[i][0]
....:             print(i, 'b')
....:             face_copy(self.face, new_face)
....: ''')
sage: a = foo()
sage: a.test()
sage: a.test2()
```

Also just to confirm:

```
sage: sage: Asso = polytopes.associahedron(['A',3])
sage: it = Asso.face_generator()
sage: f = next(it)
sage: f
A 3-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 14 vertices
sage: f = next(it)
sage: f
A -1-dimensional face of a Polyhedron in QQ^3
sage: f = next(it)
sage: f
A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 5 vertices
```

And:

```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: it = C.face_iter()
sage: f = next(it)
sage: f
A 2-dimensional face of a 3-dimensional combinatorial polyhedron
sage: f = next(it)
sage: f
A 2-dimensional face of a 3-dimensional combinatorial polyhedron
```

```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: it = C.face_iter()
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: def foo(FaceIterator_base it):
....:     it.next_dimension()
....:     print('a')
....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)
....:     print('b')
....:     face.__init__(it)
....:     print('c')
....:     return face
....: ''')
sage: foo(it)
a
b
c
A 2-dimensional face of a 3-dimensional combinatorial polyhedron
```



There is definitely a problem with init and cinit as the following shoud not lead to a segmentationfault (but does and also for me):

```
sage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace
sage: face = CombinatorialFace.__new__(CombinatorialFace)
sage: face.ambient_H_indices()
```

I don't know if this is the issue. I can try to fix this `__init__` and `__cinit__` things and see if this solves something.



---

archive/issue_comments_532505.json:
```json
{
    "body": "<a id='comment:8'></a>\nHere is a raw log, the problem are on `tmonteil-lxc3`, not `tmonteil-lxc1`, sorry for the confusion:\n\n```\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: ....: \n....: ....: cdef class foo:\n....: ....:     cdef face_t face\n....: ....:     cdef MemoryAllocator mem\n....: ....:     \n....: ....:     def __init__(self):\n....: ....:         self.mem = MemoryAllocator()\n....: ....:         face_init(self.face, 9, 14, self.mem)\n....: ....:         \n....: ....:     def test(self):\n....: ....:         cdef face_t new_face\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_init(new_face, 9, 14, mem)\n....: ....:         print('b')\n....: ....:         face_copy(self.face, new_face)\n....: ....:         \n....: ....:     def test2(self):\n....: ....:         cdef face_list_t faces\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_list_init(faces, 9, 9, 14, mem)\n....: ....:         cdef face_t new_face\n....: ....:         for i in range(9):\n....: ....:             print(i)\n....: ....:             new_face[0] = faces.faces[i][0]\n....: ....:             print(i, 'b')\n....: ....:             face_copy(self.face, new_face)\n....: ....: ''')\n....: sage: a = foo()\n....: sage: a.test()\n....: sage: a.test2()\na\nb\na\n0\n0 b\n1\n1 b\n2\n2 b\n3\n3 b\n4\n4 b\n5\n5 b\n6\n6 b\n7\n7 b\n8\n8 b\nsage: sage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: it = Asso.face_generator()\n....: sage: f = next(it)\n....: sage: f\nA 3-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 14 vertices\nsage: sage: f = next(it)\n....: sage: f\nA -1-dimensional face of a Polyhedron in QQ^3\nsage: sage: f = next(it)\n....: sage: f\n------------------------------------------------------------------------\nSegmentation fault\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: C = Asso.combinatorial_polyhedron()\n....: sage: it = C.face_iter()\n....: sage: f = next(it)\n....: sage: f\n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7fc34e97b47b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7fc34e9812d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7fc34e981ff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7fc3523a9730]\n/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7fc351f48b0d]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7fc2f3a8605a]\npython3[0x599551]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7fc2f3a4d9ac]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7fc2f3a56948]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7fc2f3a5b2ef]\npython3[0x556216]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n[1 0 1 0 0 0 0 1 0 0 0 0 0 0]\n[0 1 0 1 0 1 0 0 0 0 0 0 0 0]\n[0 0 1 0 1 0 0 0 0 0 0 1 0 0]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7fc351e1009b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1027349.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: C = Asso.combinatorial_polyhedron()\n....: sage: it = C.face_iter()\n....: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: ....: def foo(FaceIterator_base it):\n....: ....:     it.next_dimension()\n....: ....:     print('a')\n....: ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)\n....: ....:     print('b')\n....: ....:     face.__init__(it)\n....: ....:     print('c')\n....: ....:     return face\n....: ....: ''')\n....: sage: foo(it)\na\nb\n------------------------------------------------------------------------\nSegmentation fault\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace\n....: sage: face = CombinatorialFace.__new__(CombinatorialFace)\n....: sage: face.ambient_H_indices()\n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f644a84747b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f644a84d2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f644a84dff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f644e275730]\n------------------------------------------------------------------------\nAttaching gdb to process id 1027750.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n\n```",
    "created_at": "2021-11-05T19:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532505",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:8'></a>
Here is a raw log, the problem are on `tmonteil-lxc3`, not `tmonteil-lxc1`, sorry for the confusion:

```
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.5.beta5, Release Date: 2021-10-28               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: ....: 
....: ....: cdef class foo:
....: ....:     cdef face_t face
....: ....:     cdef MemoryAllocator mem
....: ....:     
....: ....:     def __init__(self):
....: ....:         self.mem = MemoryAllocator()
....: ....:         face_init(self.face, 9, 14, self.mem)
....: ....:         
....: ....:     def test(self):
....: ....:         cdef face_t new_face
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_init(new_face, 9, 14, mem)
....: ....:         print('b')
....: ....:         face_copy(self.face, new_face)
....: ....:         
....: ....:     def test2(self):
....: ....:         cdef face_list_t faces
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_list_init(faces, 9, 9, 14, mem)
....: ....:         cdef face_t new_face
....: ....:         for i in range(9):
....: ....:             print(i)
....: ....:             new_face[0] = faces.faces[i][0]
....: ....:             print(i, 'b')
....: ....:             face_copy(self.face, new_face)
....: ....: ''')
....: sage: a = foo()
....: sage: a.test()
....: sage: a.test2()
a
b
a
0
0 b
1
1 b
2
2 b
3
3 b
4
4 b
5
5 b
6
6 b
7
7 b
8
8 b
sage: sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: it = Asso.face_generator()
....: sage: f = next(it)
....: sage: f
A 3-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 14 vertices
sage: sage: f = next(it)
....: sage: f
A -1-dimensional face of a Polyhedron in QQ^3
sage: sage: f = next(it)
....: sage: f
------------------------------------------------------------------------
Segmentation fault
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.5.beta5, Release Date: 2021-10-28               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: C = Asso.combinatorial_polyhedron()
....: sage: it = C.face_iter()
....: sage: f = next(it)
....: sage: f
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7fc34e97b47b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7fc34e9812d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7fc34e981ff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7fc3523a9730]
/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7fc351f48b0d]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7fc2f3a8605a]
python3[0x599551]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7fc2f3a4d9ac]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7fc2f3a56948]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7fc2f3a5b2ef]
python3[0x556216]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
[1 0 1 0 0 0 0 1 0 0 0 0 0 0]
[0 1 0 1 0 1 0 0 0 0 0 0 0 0]
[0 0 1 0 1 0 0 0 0 0 0 1 0 0]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7fc351e1009b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1027349.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.5.beta5, Release Date: 2021-10-28               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: C = Asso.combinatorial_polyhedron()
....: sage: it = C.face_iter()
....: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: ....: def foo(FaceIterator_base it):
....: ....:     it.next_dimension()
....: ....:     print('a')
....: ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)
....: ....:     print('b')
....: ....:     face.__init__(it)
....: ....:     print('c')
....: ....:     return face
....: ....: ''')
....: sage: foo(it)
a
b
------------------------------------------------------------------------
Segmentation fault
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.5.beta5, Release Date: 2021-10-28               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: sage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace
....: sage: face = CombinatorialFace.__new__(CombinatorialFace)
....: sage: face.ambient_H_indices()
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f644a84747b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f644a84d2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f644a84dff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f644e275730]
------------------------------------------------------------------------
Attaching gdb to process id 1027750.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault

```



---

archive/issue_comments_532506.json:
```json
{
    "body": "<a id='comment:9'></a>\nI edited [comment:2](#comment%3A2) to fix the typo between lxc1 and lxc3, the relative tickets are correct.",
    "created_at": "2021-11-05T19:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532506",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:9'></a>
I edited [comment:2](#comment%3A2) to fix the typo between lxc1 and lxc3, the relative tickets are correct.



---

archive/issue_comments_532507.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks for all your help.\n\nI will make a branch, where I put things in `__cinit__` that belong there. I hope that helps.\n\nIn the meantime can you yet run the following:\n\n```\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: \n....: cdef class foo:\n....:     cdef face_t face\n....:     cdef MemoryAllocator mem\n....:     \n....:     def __init__(self):\n....:         self.mem = MemoryAllocator()\n....:         face_init(self.face, 9, 14, self.mem)\n....:         \n....:     def test(self):\n....:         cdef face_t new_face\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_init(new_face, 9, 14, mem)\n....:         print('b')\n....:         face_copy(self.face, new_face)\n....:         \n....:     def test2(self):\n....:         cdef face_list_t faces\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_list_init(faces, 9, 9, 14, mem)\n....:         cdef face_t new_face\n....:         for i in range(9):\n....:             print(i)\n....:             new_face[0] = faces.faces[i][0]\n....:             print(i, 'b')\n....:             face_copy(self.face, new_face)\n....: ''')\nsage: a = foo()\nsage: a.test()\nsage: a.test2()\nsage: a = foo.__new__(foo)\nsage: a.__init__()\nsage: a.test()\nsage: a.test2()\n```\n\nIt's different from the above, as it now uses incorrectly `__init__` instead of `__cinit__` as done throughout the module `combinatorial_polyhedron`.",
    "created_at": "2021-11-05T20:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532507",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>
Thanks for all your help.

I will make a branch, where I put things in `__cinit__` that belong there. I hope that helps.

In the meantime can you yet run the following:

```
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: 
....: cdef class foo:
....:     cdef face_t face
....:     cdef MemoryAllocator mem
....:     
....:     def __init__(self):
....:         self.mem = MemoryAllocator()
....:         face_init(self.face, 9, 14, self.mem)
....:         
....:     def test(self):
....:         cdef face_t new_face
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_init(new_face, 9, 14, mem)
....:         print('b')
....:         face_copy(self.face, new_face)
....:         
....:     def test2(self):
....:         cdef face_list_t faces
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_list_init(faces, 9, 9, 14, mem)
....:         cdef face_t new_face
....:         for i in range(9):
....:             print(i)
....:             new_face[0] = faces.faces[i][0]
....:             print(i, 'b')
....:             face_copy(self.face, new_face)
....: ''')
sage: a = foo()
sage: a.test()
sage: a.test2()
sage: a = foo.__new__(foo)
sage: a.__init__()
sage: a.test()
sage: a.test2()
```

It's different from the above, as it now uses incorrectly `__init__` instead of `__cinit__` as done throughout the module `combinatorial_polyhedron`.



---

archive/issue_comments_532508.json:
```json
{
    "body": "<a id='comment:11'></a>\nHere it is:\n\n```\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: ....: \n....: ....: cdef class foo:\n....: ....:     cdef face_t face\n....: ....:     cdef MemoryAllocator mem\n....: ....:     \n....: ....:     def __init__(self):\n....: ....:         self.mem = MemoryAllocator()\n....: ....:         face_init(self.face, 9, 14, self.mem)\n....: ....:         \n....: ....:     def test(self):\n....: ....:         cdef face_t new_face\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_init(new_face, 9, 14, mem)\n....: ....:         print('b')\n....: ....:         face_copy(self.face, new_face)\n....: ....:         \n....: ....:     def test2(self):\n....: ....:         cdef face_list_t faces\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_list_init(faces, 9, 9, 14, mem)\n....: ....:         cdef face_t new_face\n....: ....:         for i in range(9):\n....: ....:             print(i)\n....: ....:             new_face[0] = faces.faces[i][0]\n....: ....:             print(i, 'b')\n....: ....:             face_copy(self.face, new_face)\n....: ....: ''')\n....: sage: a = foo()\n....: sage: a.test()\n....: sage: a.test2()\n....: sage: a = foo.__new__(foo)\n....: sage: a.__init__()\n....: sage: a.test()\n....: sage: a.test2()\na\nb\na\n0\n0 b\n1\n1 b\n2\n2 b\n3\n3 b\n4\n4 b\n5\n5 b\n6\n6 b\n7\n7 b\n8\n8 b\na\nb\na\n0\n0 b\n1\n1 b\n2\n2 b\n3\n3 b\n4\n4 b\n5\n5 b\n6\n6 b\n7\n7 b\n8\n8 b\n```",
    "created_at": "2021-11-05T21:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532508",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:11'></a>
Here it is:

```
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.5.beta5, Release Date: 2021-10-28               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: ....: 
....: ....: cdef class foo:
....: ....:     cdef face_t face
....: ....:     cdef MemoryAllocator mem
....: ....:     
....: ....:     def __init__(self):
....: ....:         self.mem = MemoryAllocator()
....: ....:         face_init(self.face, 9, 14, self.mem)
....: ....:         
....: ....:     def test(self):
....: ....:         cdef face_t new_face
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_init(new_face, 9, 14, mem)
....: ....:         print('b')
....: ....:         face_copy(self.face, new_face)
....: ....:         
....: ....:     def test2(self):
....: ....:         cdef face_list_t faces
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_list_init(faces, 9, 9, 14, mem)
....: ....:         cdef face_t new_face
....: ....:         for i in range(9):
....: ....:             print(i)
....: ....:             new_face[0] = faces.faces[i][0]
....: ....:             print(i, 'b')
....: ....:             face_copy(self.face, new_face)
....: ....: ''')
....: sage: a = foo()
....: sage: a.test()
....: sage: a.test2()
....: sage: a = foo.__new__(foo)
....: sage: a.__init__()
....: sage: a.test()
....: sage: a.test2()
a
b
a
0
0 b
1
1 b
2
2 b
3
3 b
4
4 b
5
5 b
6
6 b
7
7 b
8
8 b
a
b
a
0
0 b
1
1 b
2
2 b
3
3 b
4
4 b
5
5 b
6
6 b
7
7 b
8
8 b
```



---

archive/issue_comments_532509.json:
```json
{
    "body": "**Branch:** [u/gh-kliem/cinit_in_combinatorial_polyhedron](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/cinit_in_combinatorial_polyhedron)",
    "created_at": "2021-11-06T20:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532509",
    "user": "https://github.com/kliem"
}
```

**Branch:** [u/gh-kliem/cinit_in_combinatorial_polyhedron](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/cinit_in_combinatorial_polyhedron)



---

archive/issue_comments_532510.json:
```json
{
    "body": "**Commit:** [5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab](https://github.com/sagemath/sagetrac-mirror/commit/5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab)",
    "created_at": "2021-11-06T20:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532510",
    "user": "https://github.com/kliem"
}
```

**Commit:** [5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab](https://github.com/sagemath/sagetrac-mirror/commit/5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab)



---

archive/issue_comments_532511.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe attached branch uses `__cinit__` to avoid having undefined objects around.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab\">5a8ffc3</a></td><td><code>use `__cinit__` in combinatorial_polyhedron to avoid crashing of sage</code></td></tr></table>\n",
    "created_at": "2021-11-06T20:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532511",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'></a>
The attached branch uses `__cinit__` to avoid having undefined objects around.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab">5a8ffc3</a></td><td><code>use `__cinit__` in combinatorial_polyhedron to avoid crashing of sage</code></td></tr></table>




---

archive/issue_comments_532512.json:
```json
{
    "body": "**Author:** Jonathan Kliem",
    "created_at": "2021-11-06T20:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532512",
    "user": "https://github.com/kliem"
}
```

**Author:** Jonathan Kliem



---

archive/issue_comments_532513.json:
```json
{
    "body": "<a id='comment:13'></a>\nDoes this help.\n\nIf not, if not or if it is not clear, if it helps, I can also do this in a seperate ticket.",
    "created_at": "2021-11-08T07:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532513",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>
Does this help.

If not, if not or if it is not clear, if it helps, I can also do this in a seperate ticket.



---

archive/issue_events_294467.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-11-08T07:29:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294467"
}
```



---

archive/issue_events_294468.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-29T00:29:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294468"
}
```



---

archive/issue_events_294469.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-29T00:29:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294469"
}
```



---

archive/issue_comments_532514.json:
```json
{
    "body": "<a id='comment:15'></a>\nPatchbot shows failures:\n\n```\nsage -t --long --random-seed=116540483811314252179005456955637850102 src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\", line 324, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__cinit__\nFailed example:\n    C.f_vector()\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate ... bytes\nGot:\n    (1)\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\", line 328, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__cinit__\nFailed example:\n    C.face_lattice()\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate ... bytes\nGot:\n    Finite lattice containing 1 elements\n**********************************************************************\n```",
    "created_at": "2021-11-29T00:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532514",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Patchbot shows failures:

```
sage -t --long --random-seed=116540483811314252179005456955637850102 src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx
**********************************************************************
File "src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx", line 324, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__cinit__
Failed example:
    C.f_vector()
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate ... bytes
Got:
    (1)
**********************************************************************
File "src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx", line 328, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__cinit__
Failed example:
    C.face_lattice()
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate ... bytes
Got:
    Finite lattice containing 1 elements
**********************************************************************
```



---

archive/issue_comments_532515.json:
```json
{
    "body": "<a id='comment:16'></a>\nI don't see this failures when trying out the ticket on macOS.",
    "created_at": "2021-11-29T00:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532515",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
I don't see this failures when trying out the ticket on macOS.



---

archive/issue_events_294470.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-29T00:30:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294470"
}
```



---

archive/issue_events_294471.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-29T00:30:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294471"
}
```



---

archive/issue_comments_532516.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5086615d6fd9c0f1107c1cc5ae4958b7aee1e233\">5086615</a></td><td><code>Merge branch 'u/gh-kliem/cinit_in_combinatorial_polyhedron' of git://trac.sagemath.org/sage into u/gh-kliem/cinit_in_combinatorial_polyhedron2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77ffa8277fcb7875762271a0dff355824fc3cedd\">77ffa82</a></td><td><code>more robust failure when not initializing combinatorial polyhedron</code></td></tr></table>\n",
    "created_at": "2021-11-29T08:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5086615d6fd9c0f1107c1cc5ae4958b7aee1e233">5086615</a></td><td><code>Merge branch 'u/gh-kliem/cinit_in_combinatorial_polyhedron' of git://trac.sagemath.org/sage into u/gh-kliem/cinit_in_combinatorial_polyhedron2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77ffa8277fcb7875762271a0dff355824fc3cedd">77ffa82</a></td><td><code>more robust failure when not initializing combinatorial polyhedron</code></td></tr></table>




---

archive/issue_comments_532517.json:
```json
{
    "body": "**Changing commit** from \"[5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab](https://github.com/sagemath/sagetrac-mirror/commit/5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab)\" to \"[77ffa8277fcb7875762271a0dff355824fc3cedd](https://github.com/sagemath/sagetrac-mirror/commit/77ffa8277fcb7875762271a0dff355824fc3cedd)\".",
    "created_at": "2021-11-29T08:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab](https://github.com/sagemath/sagetrac-mirror/commit/5a8ffc3baa471a8dd9ac4dd5478a6ea1400337ab)" to "[77ffa8277fcb7875762271a0dff355824fc3cedd](https://github.com/sagemath/sagetrac-mirror/commit/77ffa8277fcb7875762271a0dff355824fc3cedd)".



---

archive/issue_events_294472.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-11-29T08:24:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294472"
}
```



---

archive/issue_events_294473.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-11-29T08:24:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294473"
}
```



---

archive/issue_comments_532518.json:
```json
{
    "body": "<a id='comment:20'></a>\nThe combinatorial what? I think you are missing `polyhedron` in the error message.",
    "created_at": "2021-11-29T09:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532518",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
The combinatorial what? I think you are missing `polyhedron` in the error message.



---

archive/issue_comments_532519.json:
```json
{
    "body": "**Changing commit** from \"[77ffa8277fcb7875762271a0dff355824fc3cedd](https://github.com/sagemath/sagetrac-mirror/commit/77ffa8277fcb7875762271a0dff355824fc3cedd)\" to \"[e15fe96020fa9ed3cb8d92310357f741dc9fd2f0](https://github.com/sagemath/sagetrac-mirror/commit/e15fe96020fa9ed3cb8d92310357f741dc9fd2f0)\".",
    "created_at": "2021-11-29T10:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532519",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[77ffa8277fcb7875762271a0dff355824fc3cedd](https://github.com/sagemath/sagetrac-mirror/commit/77ffa8277fcb7875762271a0dff355824fc3cedd)" to "[e15fe96020fa9ed3cb8d92310357f741dc9fd2f0](https://github.com/sagemath/sagetrac-mirror/commit/e15fe96020fa9ed3cb8d92310357f741dc9fd2f0)".



---

archive/issue_comments_532520.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e15fe96020fa9ed3cb8d92310357f741dc9fd2f0\">e15fe96</a></td><td><code>fix error message</code></td></tr></table>\n",
    "created_at": "2021-11-29T10:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e15fe96020fa9ed3cb8d92310357f741dc9fd2f0">e15fe96</a></td><td><code>fix error message</code></td></tr></table>




---

archive/issue_comments_532521.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe",
    "created_at": "2021-11-29T20:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532521",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe



---

archive/issue_events_294474.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-29T20:03:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294474"
}
```



---

archive/issue_events_294475.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-29T20:03:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294475"
}
```



---

archive/issue_comments_532522.json:
```json
{
    "body": "<a id='comment:23'></a>\nThank you.",
    "created_at": "2021-11-30T06:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532522",
    "user": "https://github.com/kliem"
}
```

<a id='comment:23'></a>
Thank you.



---

archive/issue_events_294476.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/tmonteil",
    "created_at": "2021-11-30T10:23:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294476"
}
```



---

archive/issue_events_294477.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/tmonteil",
    "created_at": "2021-11-30T10:23:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294477"
}
```



---

archive/issue_comments_532523.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe\" to \"Matthias Koeppe, Thierry Monteil\".",
    "created_at": "2021-11-30T10:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532523",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing reviewer** from "Matthias Koeppe" to "Matthias Koeppe, Thierry Monteil".



---

archive/issue_comments_532524.json:
```json
{
    "body": "<a id='comment:24'></a>\nI rebuilt on the same machine `tmonteil-lxc3` with the new branch, many things were recompiled (so the problem might have disapeared for another reason).\n\nThe doctests of `src/sage/geometry/polyhedron/` pass, and all the previous tests that you let me try in that ticket now pass, except the following two:\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\n....: C = Asso.combinatorial_polyhedron()\n....: it = C.face_iter()\n....: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: def foo(FaceIterator_base it):\n....:     it.next_dimension()\n....:     print('a')  \n....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)\n....:     print('b')  \n....:     face.__init__(it)\n....:     print('c')  \n....:     return face \n....: ''')\n....: foo(it)\n....: \na\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-4ddddb9717bb> in <module>\n     13     return face\n     14 ''')\n---> 15 foo(it)\n\n~/.sage/temp/tmonteil-lxc3/1115495/spyx/_home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx/_home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx_0.pyx in _home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx_0.foo()\n      4     it.next_dimension()\n      5     print('a')\n----> 6     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)\n      7     print('b')\n      8     face.__init__(it)\n\n~/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.pyx in sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face.CombinatorialFace.__cinit__ (build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.c:4022)()\n    141         11\n    142     \"\"\"\n--> 143     def __cinit__(self, data, dimension=None, index=None):\n    144         r\"\"\"\n    145         Initialize :class:`CombinatorialFace`.\n\nTypeError: __cinit__() takes at least 1 positional argument (0 given)\n```\n\n\n```\nsage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace\n....: face = CombinatorialFace.__new__(CombinatorialFace)\n....: face.ambient_H_indices()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-d41a0d4cfa81> in <module>\n      1 from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace\n----> 2 face = CombinatorialFace.__new__(CombinatorialFace)\n      3 face.ambient_H_indices()\n\n~/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.pyx in sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face.CombinatorialFace.__cinit__ (build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.c:4022)()\n    141         11\n    142     \"\"\"\n--> 143     def __cinit__(self, data, dimension=None, index=None):\n    144         r\"\"\"\n    145         Initialize :class:`CombinatorialFace`.\n\nTypeError: __cinit__() takes at least 1 positional argument (0 given)\n```\n\n\nAs they involve a new `__cinit__` method, it might be intended, is it OK ?",
    "created_at": "2021-11-30T10:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532524",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:24'></a>
I rebuilt on the same machine `tmonteil-lxc3` with the new branch, many things were recompiled (so the problem might have disapeared for another reason).

The doctests of `src/sage/geometry/polyhedron/` pass, and all the previous tests that you let me try in that ticket now pass, except the following two:

```
sage: Asso = polytopes.associahedron(['A',3])
....: C = Asso.combinatorial_polyhedron()
....: it = C.face_iter()
....: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: def foo(FaceIterator_base it):
....:     it.next_dimension()
....:     print('a')  
....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)
....:     print('b')  
....:     face.__init__(it)
....:     print('c')  
....:     return face 
....: ''')
....: foo(it)
....: 
a
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-4ddddb9717bb> in <module>
     13     return face
     14 ''')
---> 15 foo(it)

~/.sage/temp/tmonteil-lxc3/1115495/spyx/_home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx/_home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx_0.pyx in _home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx_0.foo()
      4     it.next_dimension()
      5     print('a')
----> 6     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)
      7     print('b')
      8     face.__init__(it)

~/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.pyx in sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face.CombinatorialFace.__cinit__ (build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.c:4022)()
    141         11
    142     """
--> 143     def __cinit__(self, data, dimension=None, index=None):
    144         r"""
    145         Initialize :class:`CombinatorialFace`.

TypeError: __cinit__() takes at least 1 positional argument (0 given)
```


```
sage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace
....: face = CombinatorialFace.__new__(CombinatorialFace)
....: face.ambient_H_indices()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-d41a0d4cfa81> in <module>
      1 from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace
----> 2 face = CombinatorialFace.__new__(CombinatorialFace)
      3 face.ambient_H_indices()

~/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.pyx in sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face.CombinatorialFace.__cinit__ (build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.c:4022)()
    141         11
    142     """
--> 143     def __cinit__(self, data, dimension=None, index=None):
    144         r"""
    145         Initialize :class:`CombinatorialFace`.

TypeError: __cinit__() takes at least 1 positional argument (0 given)
```


As they involve a new `__cinit__` method, it might be intended, is it OK ?



---

archive/issue_comments_532525.json:
```json
{
    "body": "<a id='comment:25'></a>\nYes, this is intended. `CombinatorialFace` cannot be initialized without a `face_t`.\n\n`face_t` can be provided either by `FaceIterator` or by `PolyhedronFaceLattice`.\n\nYou need to run\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\n....: C = Asso.combinatorial_polyhedron()\n....: it = C.face_iter()\n....: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: def foo(FaceIterator_base it):\n....:     it.next_dimension()\n....:     print('a')  \n....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)\n....:     print('b')  \n....:     face.__init__(it)\n....:     print('c')  \n....:     return face \n....: ''')\n....: foo(it)\n```\nnow. (Actually, you can also skip the `__init__` completely).",
    "created_at": "2021-11-30T10:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532525",
    "user": "https://github.com/kliem"
}
```

<a id='comment:25'></a>
Yes, this is intended. `CombinatorialFace` cannot be initialized without a `face_t`.

`face_t` can be provided either by `FaceIterator` or by `PolyhedronFaceLattice`.

You need to run

```
sage: Asso = polytopes.associahedron(['A',3])
....: C = Asso.combinatorial_polyhedron()
....: it = C.face_iter()
....: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: def foo(FaceIterator_base it):
....:     it.next_dimension()
....:     print('a')  
....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)
....:     print('b')  
....:     face.__init__(it)
....:     print('c')  
....:     return face 
....: ''')
....: foo(it)
```
now. (Actually, you can also skip the `__init__` completely).



---

archive/issue_comments_532526.json:
```json
{
    "body": "<a id='comment:26'></a>\nGreat to hear that it works for now. Thanks for checking.",
    "created_at": "2021-11-30T10:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532526",
    "user": "https://github.com/kliem"
}
```

<a id='comment:26'></a>
Great to hear that it works for now. Thanks for checking.



---

archive/issue_events_294478.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-11-30T10:44:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294478"
}
```



---

archive/issue_events_294479.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-11-30T10:44:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294479"
}
```



---

archive/issue_comments_532527.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [gh-kliem](#comment%3A25):\n> Yes, this is intended. `CombinatorialFace` cannot be initialized without a `face_t`.\n> \n> `face_t` can be provided either by `FaceIterator` or by `PolyhedronFaceLattice`.\n> \n> You need to run\n> \n> ```\n> sage: Asso = polytopes.associahedron(['A',3])\n> ....: C = Asso.combinatorial_polyhedron()\n> ....: it = C.face_iter()\n> ....: cython('''\n> ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n> ....: def foo(FaceIterator_base it):\n> ....:     it.next_dimension()\n> ....:     print('a')  \n> ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)\n> ....:     print('b')  \n> ....:     face.__init__(it)\n> ....:     print('c')  \n> ....:     return face \n> ....: ''')\n> ....: foo(it)\n> ```\n> now. (Actually, you can also skip the `__init__` completely).\n\n\nGreat, i got:\n\n```\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: ....: C = Asso.combinatorial_polyhedron()\n....: ....: it = C.face_iter()\n....: ....: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: ....: def foo(FaceIterator_base it):\n....: ....:     it.next_dimension()\n....: ....:     print('a')  \n....: ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)\n....: ....:     print('b')  \n....: ....:     face.__init__(it)\n....: ....:     print('c')  \n....: ....:     return face \n....: ....: ''')\n....: ....: foo(it)\na\nb\nc\nA 2-dimensional face of a 3-dimensional combinatorial polyhedron\n```",
    "created_at": "2021-11-30T10:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532527",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:27'></a>
Replying to [gh-kliem](#comment%3A25):
> Yes, this is intended. `CombinatorialFace` cannot be initialized without a `face_t`.
> 
> `face_t` can be provided either by `FaceIterator` or by `PolyhedronFaceLattice`.
> 
> You need to run
> 
> ```
> sage: Asso = polytopes.associahedron(['A',3])
> ....: C = Asso.combinatorial_polyhedron()
> ....: it = C.face_iter()
> ....: cython('''
> ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
> ....: def foo(FaceIterator_base it):
> ....:     it.next_dimension()
> ....:     print('a')  
> ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)
> ....:     print('b')  
> ....:     face.__init__(it)
> ....:     print('c')  
> ....:     return face 
> ....: ''')
> ....: foo(it)
> ```
> now. (Actually, you can also skip the `__init__` completely).


Great, i got:

```
sage: sage: Asso = polytopes.associahedron(['A',3])
....: ....: C = Asso.combinatorial_polyhedron()
....: ....: it = C.face_iter()
....: ....: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: ....: def foo(FaceIterator_base it):
....: ....:     it.next_dimension()
....: ....:     print('a')  
....: ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)
....: ....:     print('b')  
....: ....:     face.__init__(it)
....: ....:     print('c')  
....: ....:     return face 
....: ....: ''')
....: ....: foo(it)
a
b
c
A 2-dimensional face of a 3-dimensional combinatorial polyhedron
```



---

archive/issue_comments_532528.json:
```json
{
    "body": "<a id='comment:28'></a>\nSegfaults on 32-bit\n\n```\nsage: for _ in range(10):\n    points = tuple(tuple(randint(-1000,1000) for _ in range(10))\n                   for _ in range(randint(3,15)))\n    P = Polyhedron(vertices=points)\n    inc = P.incidence_matrix()\n    mod_inc = inc.delete_columns([i for i,V in enumerate(P.Hrepresentation()) if V.is_equation()])\n    facets = incidence_matrix_to_bit_rep_of_facets(mod_inc)\n    vertices = incidence_matrix_to_bit_rep_of_Vrep(mod_inc)\n    d1 = P.dimension()\n    if d1 == 0:\n        continue\n    d2 = facets.compute_dimension()\n    d3 = vertices.compute_dimension()\n    if not d1 == d2 == d3:\n        print('calculation_dimension() seems to be incorrect') ## line 235 ##\nfree(): invalid size\n------------------------------------------------------------------------\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x5e62)[0xf67ace62]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x5f06)[0xf67acf06]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x88fe)[0xf67af8fe]\nlinux-gate.so.1(__kernel_sigreturn+0x0)[0xf7efa570]\nlinux-gate.so.1(__kernel_vsyscall+0x9)[0xf7efa559]\n/lib/i386-linux-gnu/libc.so.6(gsignal+0xc2)[0xf79b5e02]\n/lib/i386-linux-gnu/libc.so.6(abort+0x129)[0xf799e306]\n/lib/i386-linux-gnu/libc.so.6(+0x7899c)[0xf79f999c]\n/lib/i386-linux-gnu/libc.so.6(+0x80a5d)[0xf7a01a5d]\n/lib/i386-linux-gnu/libc.so.6(+0x81bef)[0xf7a02bef]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/ext/memory.cpython-39-i386-linux-gnu.so(+0x37b4)[0xafaf97b4]\n/var/lib/buildbot/worker/sage_git/build/local/lib/libgmp.so.10(__gmpz_clear+0x2a)[0xf6fecd0a]\n/var/lib/buildbot/worker/sage_git/build/local/lib/libppl.so.14(_ZN23Parma_Polyhedra_Library7CO_Tree7destroyEv+0x40)[0xa58e6290]\n/var/lib/buildbot/worker/sage_git/build/local/lib/libppl.so.14(_ZN23Parma_Polyhedra_Library22Linear_Expression_ImplINS_10Sparse_RowEED0Ev+0x28)[0xa585a5b8]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/ppl/linear_algebra.cpython-39-i386-linux-gnu.so(+0xfca8)[0xa5948ca8]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x5c90f)[0xf7bcc90f]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(PyNumber_InPlaceAdd+0x61)[0xf7bcf311]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/ppl/linear_algebra.cpython-39-i386-linux-gnu.so(+0xbddc)[0xa5944ddc]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0xce637)[0xf7c3e637]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyObject_MakeTpCall+0xa4)[0xf7be89a4]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x7900)[0xf7bac170]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x140fcf)[0xf7cb0fcf]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyFunction_Vectorcall+0xde)[0xf7be864e]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x5bd6)[0xf7baa446]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x140fcf)[0xf7cb0fcf]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyFunction_Vectorcall+0xde)[0xf7be864e]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x7af84)[0xf7beaf84]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(PyVectorcall_Call+0xa9)[0xf7be8369]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyObject_Call+0xe9)[0xf7be84b9]\n```",
    "created_at": "2021-12-10T20:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532528",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>
Segfaults on 32-bit

```
sage: for _ in range(10):
    points = tuple(tuple(randint(-1000,1000) for _ in range(10))
                   for _ in range(randint(3,15)))
    P = Polyhedron(vertices=points)
    inc = P.incidence_matrix()
    mod_inc = inc.delete_columns([i for i,V in enumerate(P.Hrepresentation()) if V.is_equation()])
    facets = incidence_matrix_to_bit_rep_of_facets(mod_inc)
    vertices = incidence_matrix_to_bit_rep_of_Vrep(mod_inc)
    d1 = P.dimension()
    if d1 == 0:
        continue
    d2 = facets.compute_dimension()
    d3 = vertices.compute_dimension()
    if not d1 == d2 == d3:
        print('calculation_dimension() seems to be incorrect') ## line 235 ##
free(): invalid size
------------------------------------------------------------------------
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x5e62)[0xf67ace62]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x5f06)[0xf67acf06]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x88fe)[0xf67af8fe]
linux-gate.so.1(__kernel_sigreturn+0x0)[0xf7efa570]
linux-gate.so.1(__kernel_vsyscall+0x9)[0xf7efa559]
/lib/i386-linux-gnu/libc.so.6(gsignal+0xc2)[0xf79b5e02]
/lib/i386-linux-gnu/libc.so.6(abort+0x129)[0xf799e306]
/lib/i386-linux-gnu/libc.so.6(+0x7899c)[0xf79f999c]
/lib/i386-linux-gnu/libc.so.6(+0x80a5d)[0xf7a01a5d]
/lib/i386-linux-gnu/libc.so.6(+0x81bef)[0xf7a02bef]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/ext/memory.cpython-39-i386-linux-gnu.so(+0x37b4)[0xafaf97b4]
/var/lib/buildbot/worker/sage_git/build/local/lib/libgmp.so.10(__gmpz_clear+0x2a)[0xf6fecd0a]
/var/lib/buildbot/worker/sage_git/build/local/lib/libppl.so.14(_ZN23Parma_Polyhedra_Library7CO_Tree7destroyEv+0x40)[0xa58e6290]
/var/lib/buildbot/worker/sage_git/build/local/lib/libppl.so.14(_ZN23Parma_Polyhedra_Library22Linear_Expression_ImplINS_10Sparse_RowEED0Ev+0x28)[0xa585a5b8]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/ppl/linear_algebra.cpython-39-i386-linux-gnu.so(+0xfca8)[0xa5948ca8]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x5c90f)[0xf7bcc90f]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(PyNumber_InPlaceAdd+0x61)[0xf7bcf311]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/ppl/linear_algebra.cpython-39-i386-linux-gnu.so(+0xbddc)[0xa5944ddc]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0xce637)[0xf7c3e637]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyObject_MakeTpCall+0xa4)[0xf7be89a4]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x7900)[0xf7bac170]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x140fcf)[0xf7cb0fcf]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyFunction_Vectorcall+0xde)[0xf7be864e]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x5bd6)[0xf7baa446]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x140fcf)[0xf7cb0fcf]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyFunction_Vectorcall+0xde)[0xf7be864e]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x7af84)[0xf7beaf84]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(PyVectorcall_Call+0xa9)[0xf7be8369]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyObject_Call+0xe9)[0xf7be84b9]
```



---

archive/issue_events_294480.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-10T20:26:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294480"
}
```



---

archive/issue_events_294481.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-10T20:26:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294481"
}
```



---

archive/issue_comments_532529.json:
```json
{
    "body": "<a id='comment:29'></a>\nI wonder if initializing `MemoryAllocator` with:\n\n```\n    self.mem = MemoryAllocator()\n```\n\nin `__init__` might a problem and if it would be better to use `__new__`?",
    "created_at": "2021-12-12T07:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532529",
    "user": "https://github.com/kliem"
}
```

<a id='comment:29'></a>
I wonder if initializing `MemoryAllocator` with:

```
    self.mem = MemoryAllocator()
```

in `__init__` might a problem and if it would be better to use `__new__`?



---

archive/issue_comments_532530.json:
```json
{
    "body": "<a id='comment:30'></a>\nOne thing that I found is the following:\n\nhttps://gmplib.org/list-archives/gmp-bugs/2020-September/004888.html\n\nIn `bitset_intrinsics.h` I silently assume that `sizeof(mp_limb_t)` and `GMP_LIMB_BITS` are consistent. It would definitely be safer to just use `sizeof(mp_limb_t)` to compute `LIMBS_PER_64`.",
    "created_at": "2021-12-12T09:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532530",
    "user": "https://github.com/kliem"
}
```

<a id='comment:30'></a>
One thing that I found is the following:

https://gmplib.org/list-archives/gmp-bugs/2020-September/004888.html

In `bitset_intrinsics.h` I silently assume that `sizeof(mp_limb_t)` and `GMP_LIMB_BITS` are consistent. It would definitely be safer to just use `sizeof(mp_limb_t)` to compute `LIMBS_PER_64`.



---

archive/issue_comments_532531.json:
```json
{
    "body": "<a id='comment:31'></a>\nA small issue (I think) in method `_compute_edges_or_ridges` of `base.pyx`:\n\n```diff\n-        cdef size_t **edges = <size_t**> mem.malloc(sizeof(size_t**))\n+        cdef size_t **edges = <size_t**> mem.malloc(sizeof(size_t*))\n```",
    "created_at": "2021-12-12T10:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532531",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:31'></a>
A small issue (I think) in method `_compute_edges_or_ridges` of `base.pyx`:

```diff
-        cdef size_t **edges = <size_t**> mem.malloc(sizeof(size_t**))
+        cdef size_t **edges = <size_t**> mem.malloc(sizeof(size_t*))
```



---

archive/issue_comments_532532.json:
```json
{
    "body": "<a id='comment:32'></a>\nThere seem to be multiple memory access issues here, my suggestion is to get comfortable with valgrind. Finding these things is generally pretty easy with it.",
    "created_at": "2021-12-12T10:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532532",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:32'></a>
There seem to be multiple memory access issues here, my suggestion is to get comfortable with valgrind. Finding these things is generally pretty easy with it.



---

archive/issue_comments_532533.json:
```json
{
    "body": "<a id='comment:33'></a>\nApparently, there is at least a bug in memory allocator.\n\nRunning the test suite, I get\n\n```\n==66729==  Address 0x6e7f020 is 528 bytes inside a block of size 800 free'd\n==66729==    at 0x483CABF: free (vg_replace_malloc.c:530)\n==66729==    by 0x5C01888: sig_free (memory_allocator.c:2764)\n==66729==    by 0x5C01888: __pyx_pf_16memory_allocator_16memory_allocator_15MemoryAllocator_2__dealloc__ (memory_allocator.c:2078)\n==66729==    by 0x5C01888: __pyx_pw_16memory_allocator_16memory_allocator_15MemoryAllocator_3__dealloc__ (memory_allocator.c:2044)\n==66729==    by 0x5C01888: __pyx_tp_dealloc_16memory_allocator_16memory_allocator_MemoryAllocator (memory_allocator.c:3652)\n==66729==    by 0x4859D9C: _Py_DECREF (object.h:478)\n==66729==    by 0x4859D9C: __pyx_tp_dealloc_16memory_allocator_4test_TestMemoryAllocator (test.c:3615)\n==66729==    by 0x5CF74A: PyDict_Clear (in /usr/bin/python3.8)\n==66729==    by 0x6A9C09: ??? (in /usr/bin/python3.8)\n==66729==    by 0x5045DA: ??? (in /usr/bin/python3.8)\n==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66729==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66729==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66729==  Block was alloc'd at\n==66729==    at 0x483B873: malloc (vg_replace_malloc.c:299)\n==66729==    by 0x5C03224: sig_malloc (memory_allocator.c:2580)\n==66729==    by 0x5C03224: __pyx_f_16memory_allocator_6memory_check_allocarray (memory_allocator.c:2956)\n==66729==    by 0x5C03224: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_allocarray (memory_allocator.c:1831)\n==66729==    by 0x4861189: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_aligned_allocarray (test.c:3572)\n==66729==    by 0x4861189: __pyx_pf_16memory_allocator_4test_19TestMemoryAllocator_16aligned_allocarray (test.c:2394)\n==66729==    by 0x4861189: __pyx_pw_16memory_allocator_4test_19TestMemoryAllocator_17aligned_allocarray (test.c:2363)\n==66729==    by 0x503EA8: ??? (in /usr/bin/python3.8)\n==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66729==    by 0x68D5B6: PyEval_EvalCode (in /usr/bin/python3.8)\n==66729==    by 0x600F53: ??? (in /usr/bin/python3.8)\n==66729==    by 0x5C552F: ??? (in /usr/bin/python3.8)\n==66729==    by 0x56BDDC: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66729==    by 0x5F6165: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n```\n\nAnd it is not deterministic:\n\n```\n==66727==  Address 0x6e7e020 is 96 bytes inside a block of size 1,600 free'd\n==66727==    at 0x483CABF: free (vg_replace_malloc.c:530)\n==66727==    by 0x5C01888: sig_free (memory_allocator.c:2764)\n==66727==    by 0x5C01888: __pyx_pf_16memory_allocator_16memory_allocator_15MemoryAllocator_2__dealloc__ (memory_allocator.c:2078)\n==66727==    by 0x5C01888: __pyx_pw_16memory_allocator_16memory_allocator_15MemoryAllocator_3__dealloc__ (memory_allocator.c:2044)\n==66727==    by 0x5C01888: __pyx_tp_dealloc_16memory_allocator_16memory_allocator_MemoryAllocator (memory_allocator.c:3652)\n==66727==    by 0x4859D9C: _Py_DECREF (object.h:478)\n==66727==    by 0x4859D9C: __pyx_tp_dealloc_16memory_allocator_4test_TestMemoryAllocator (test.c:3615)\n==66727==    by 0x5CF74A: PyDict_Clear (in /usr/bin/python3.8)\n==66727==    by 0x6A9C09: ??? (in /usr/bin/python3.8)\n==66727==    by 0x5045DA: ??? (in /usr/bin/python3.8)\n==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66727==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66727==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66727==  Block was alloc'd at\n==66727==    at 0x483DE1A: calloc (vg_replace_malloc.c:752)\n==66727==    by 0x5C03798: sig_calloc (memory_allocator.c:2704)\n==66727==    by 0x5C03798: __pyx_f_16memory_allocator_6memory_check_calloc (memory_allocator.c:3540)\n==66727==    by 0x5C03798: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_calloc (memory_allocator.c:1748)\n==66727==    by 0x48620F9: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_aligned_calloc (test.c:3514)\n==66727==    by 0x48620F9: __pyx_pf_16memory_allocator_4test_19TestMemoryAllocator_14aligned_calloc (test.c:2260)\n==66727==    by 0x48620F9: __pyx_pw_16memory_allocator_4test_19TestMemoryAllocator_15aligned_calloc (test.c:2229)\n==66727==    by 0x503EA8: ??? (in /usr/bin/python3.8)\n==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66727==    by 0x68D5B6: PyEval_EvalCode (in /usr/bin/python3.8)\n==66727==    by 0x600F53: ??? (in /usr/bin/python3.8)\n==66727==    by 0x5C552F: ??? (in /usr/bin/python3.8)\n==66727==    by 0x56BDDC: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66727==    by 0x5F6165: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n```\n\nAt a first glance it looks like its trying to free the aligned memory instead of the memory that was actually allocated.",
    "created_at": "2021-12-12T12:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532533",
    "user": "https://github.com/kliem"
}
```

<a id='comment:33'></a>
Apparently, there is at least a bug in memory allocator.

Running the test suite, I get

```
==66729==  Address 0x6e7f020 is 528 bytes inside a block of size 800 free'd
==66729==    at 0x483CABF: free (vg_replace_malloc.c:530)
==66729==    by 0x5C01888: sig_free (memory_allocator.c:2764)
==66729==    by 0x5C01888: __pyx_pf_16memory_allocator_16memory_allocator_15MemoryAllocator_2__dealloc__ (memory_allocator.c:2078)
==66729==    by 0x5C01888: __pyx_pw_16memory_allocator_16memory_allocator_15MemoryAllocator_3__dealloc__ (memory_allocator.c:2044)
==66729==    by 0x5C01888: __pyx_tp_dealloc_16memory_allocator_16memory_allocator_MemoryAllocator (memory_allocator.c:3652)
==66729==    by 0x4859D9C: _Py_DECREF (object.h:478)
==66729==    by 0x4859D9C: __pyx_tp_dealloc_16memory_allocator_4test_TestMemoryAllocator (test.c:3615)
==66729==    by 0x5CF74A: PyDict_Clear (in /usr/bin/python3.8)
==66729==    by 0x6A9C09: ??? (in /usr/bin/python3.8)
==66729==    by 0x5045DA: ??? (in /usr/bin/python3.8)
==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66729==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66729==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66729==  Block was alloc'd at
==66729==    at 0x483B873: malloc (vg_replace_malloc.c:299)
==66729==    by 0x5C03224: sig_malloc (memory_allocator.c:2580)
==66729==    by 0x5C03224: __pyx_f_16memory_allocator_6memory_check_allocarray (memory_allocator.c:2956)
==66729==    by 0x5C03224: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_allocarray (memory_allocator.c:1831)
==66729==    by 0x4861189: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_aligned_allocarray (test.c:3572)
==66729==    by 0x4861189: __pyx_pf_16memory_allocator_4test_19TestMemoryAllocator_16aligned_allocarray (test.c:2394)
==66729==    by 0x4861189: __pyx_pw_16memory_allocator_4test_19TestMemoryAllocator_17aligned_allocarray (test.c:2363)
==66729==    by 0x503EA8: ??? (in /usr/bin/python3.8)
==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66729==    by 0x68D5B6: PyEval_EvalCode (in /usr/bin/python3.8)
==66729==    by 0x600F53: ??? (in /usr/bin/python3.8)
==66729==    by 0x5C552F: ??? (in /usr/bin/python3.8)
==66729==    by 0x56BDDC: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66729==    by 0x5F6165: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
```

And it is not deterministic:

```
==66727==  Address 0x6e7e020 is 96 bytes inside a block of size 1,600 free'd
==66727==    at 0x483CABF: free (vg_replace_malloc.c:530)
==66727==    by 0x5C01888: sig_free (memory_allocator.c:2764)
==66727==    by 0x5C01888: __pyx_pf_16memory_allocator_16memory_allocator_15MemoryAllocator_2__dealloc__ (memory_allocator.c:2078)
==66727==    by 0x5C01888: __pyx_pw_16memory_allocator_16memory_allocator_15MemoryAllocator_3__dealloc__ (memory_allocator.c:2044)
==66727==    by 0x5C01888: __pyx_tp_dealloc_16memory_allocator_16memory_allocator_MemoryAllocator (memory_allocator.c:3652)
==66727==    by 0x4859D9C: _Py_DECREF (object.h:478)
==66727==    by 0x4859D9C: __pyx_tp_dealloc_16memory_allocator_4test_TestMemoryAllocator (test.c:3615)
==66727==    by 0x5CF74A: PyDict_Clear (in /usr/bin/python3.8)
==66727==    by 0x6A9C09: ??? (in /usr/bin/python3.8)
==66727==    by 0x5045DA: ??? (in /usr/bin/python3.8)
==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66727==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66727==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66727==  Block was alloc'd at
==66727==    at 0x483DE1A: calloc (vg_replace_malloc.c:752)
==66727==    by 0x5C03798: sig_calloc (memory_allocator.c:2704)
==66727==    by 0x5C03798: __pyx_f_16memory_allocator_6memory_check_calloc (memory_allocator.c:3540)
==66727==    by 0x5C03798: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_calloc (memory_allocator.c:1748)
==66727==    by 0x48620F9: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_aligned_calloc (test.c:3514)
==66727==    by 0x48620F9: __pyx_pf_16memory_allocator_4test_19TestMemoryAllocator_14aligned_calloc (test.c:2260)
==66727==    by 0x48620F9: __pyx_pw_16memory_allocator_4test_19TestMemoryAllocator_15aligned_calloc (test.c:2229)
==66727==    by 0x503EA8: ??? (in /usr/bin/python3.8)
==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66727==    by 0x68D5B6: PyEval_EvalCode (in /usr/bin/python3.8)
==66727==    by 0x600F53: ??? (in /usr/bin/python3.8)
==66727==    by 0x5C552F: ??? (in /usr/bin/python3.8)
==66727==    by 0x56BDDC: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66727==    by 0x5F6165: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
```

At a first glance it looks like its trying to free the aligned memory instead of the memory that was actually allocated.



---

archive/issue_comments_532534.json:
```json
{
    "body": "<a id='comment:34'></a>\nthere was a bug fixed in #32590, that is merged in 9.5.beta4",
    "created_at": "2021-12-12T13:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532534",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>
there was a bug fixed in #32590, that is merged in 9.5.beta4



---

archive/issue_comments_532535.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [vbraun](#comment%3A34):\n> there was a bug fixed in #32590, that is merged in 9.5.beta4\n\n\nThanks for the reminder. Unfortunatly, this was only a test suite bug.",
    "created_at": "2021-12-12T13:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532535",
    "user": "https://github.com/kliem"
}
```

<a id='comment:35'></a>
Replying to [vbraun](#comment%3A34):
> there was a bug fixed in #32590, that is merged in 9.5.beta4


Thanks for the reminder. Unfortunatly, this was only a test suite bug.



---

archive/issue_comments_532536.json:
```json
{
    "body": "<a id='comment:36'></a>\nMy guess is that `528 bytes inside a block of size 800` is too far in for this to be an alignment calculation bug.",
    "created_at": "2021-12-12T14:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532536",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>
My guess is that `528 bytes inside a block of size 800` is too far in for this to be an alignment calculation bug.



---

archive/issue_comments_532537.json:
```json
{
    "body": "<a id='comment:37'></a>\nWell, the problem only appeared for me when running the test suite on sage's memory_allocator. Not for the memory allocator installed through systems python.\n\nNow, I just ran `make memory_allocator-clean` and I don't get those errors anymore. I'm rerunning sage and will see, if it completely went away.",
    "created_at": "2021-12-13T08:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532537",
    "user": "https://github.com/kliem"
}
```

<a id='comment:37'></a>
Well, the problem only appeared for me when running the test suite on sage's memory_allocator. Not for the memory allocator installed through systems python.

Now, I just ran `make memory_allocator-clean` and I don't get those errors anymore. I'm rerunning sage and will see, if it completely went away.



---

archive/issue_comments_532538.json:
```json
{
    "body": "<a id='comment:38'></a>\nYes, the problem went away. There are various possible conclusions here:\n\n- I don't know how to use valgrind. Very likely. Using `sage --valgrind` seems to be completely useless. Instead I just installed `valgrind` in the system and run\n\n```\nvalgrind --tool=memcheck --leak-check=full --show-leak-kinds=all python3 foo.py\n```\n  within the sage shell on various test files. This gives lots and lots of errors. Among them those errors listed above. But they seem to be gone now.\n  If I just run\n\n```\n   valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all sage -t --long $SAGE_SRC/sage/geometry/polyhedron/combinatorial_polyhedron/\n```\n  I don't get useful output at all.\n- This problem actually goes away by running `make memory-allocator_clean` for whatever reason.\n- This problem is elsewhere. E.g. ticket:32827#comment:30, but possibly somewhere else as well.",
    "created_at": "2021-12-13T09:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532538",
    "user": "https://github.com/kliem"
}
```

<a id='comment:38'></a>
Yes, the problem went away. There are various possible conclusions here:

- I don't know how to use valgrind. Very likely. Using `sage --valgrind` seems to be completely useless. Instead I just installed `valgrind` in the system and run

```
valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all python3 foo.py
```
  within the sage shell on various test files. This gives lots and lots of errors. Among them those errors listed above. But they seem to be gone now.
  If I just run

```
   valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all sage -t --long $SAGE_SRC/sage/geometry/polyhedron/combinatorial_polyhedron/
```
  I don't get useful output at all.
- This problem actually goes away by running `make memory-allocator_clean` for whatever reason.
- This problem is elsewhere. E.g. ticket:32827#comment:30, but possibly somewhere else as well.



---

archive/issue_comments_532539.json:
```json
{
    "body": "<a id='comment:39'></a>\nCan we split the ticket in two tickets :\n\n- about moving `__init__` to `__cinit__` (current branch)\n- about memory allocator\n\nIf this is doable and the current branch can be merged soon, i will be able to restart my patchbots.",
    "created_at": "2021-12-13T14:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532539",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:39'></a>
Can we split the ticket in two tickets :

- about moving `__init__` to `__cinit__` (current branch)
- about memory allocator

If this is doable and the current branch can be merged soon, i will be able to restart my patchbots.



---

archive/issue_comments_532540.json:
```json
{
    "body": "<a id='comment:40'></a>\nI'm not sure that Volker will accept such a split. From what I understand from ticket:32827#comment:28 he rejected the proposed changes not because they do not fix it, but because they lead to a new failure.\n\nWhat might not work is passing `MemoryAllocator` as an argument to functions for it to allocate memory. But I don't know. I could remove the usage of `MemoryAllocator` from bitsets alltogether and hope that this fixes something.\n\nAnother thing that should be fixed is the following: Currently `face_list_t` is only one type and depending on the context it is a shallow copy or not. This is not good practice. Instead one could use `fused_types` again to have a shallow list and a deep list. Depending on the type of the destination `face_list_copy` would then just to the correct thing and same with `face_list_init`.",
    "created_at": "2021-12-14T12:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532540",
    "user": "https://github.com/kliem"
}
```

<a id='comment:40'></a>
I'm not sure that Volker will accept such a split. From what I understand from ticket:32827#comment:28 he rejected the proposed changes not because they do not fix it, but because they lead to a new failure.

What might not work is passing `MemoryAllocator` as an argument to functions for it to allocate memory. But I don't know. I could remove the usage of `MemoryAllocator` from bitsets alltogether and hope that this fixes something.

Another thing that should be fixed is the following: Currently `face_list_t` is only one type and depending on the context it is a shallow copy or not. This is not good practice. Instead one could use `fused_types` again to have a shallow list and a deep list. Depending on the type of the destination `face_list_copy` would then just to the correct thing and same with `face_list_init`.



---

archive/issue_comments_532541.json:
```json
{
    "body": "<a id='comment:41'></a>\nI don't have a full understanding of the code, but it's surprising to see methods with `MemoryAllocator` as parameter and also the use of tuple `_mem_tuple` to store several memory allocators. Is it really better this way ? Does it help reducing memory consumption significantly ?",
    "created_at": "2021-12-14T12:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532541",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:41'></a>
I don't have a full understanding of the code, but it's surprising to see methods with `MemoryAllocator` as parameter and also the use of tuple `_mem_tuple` to store several memory allocators. Is it really better this way ? Does it help reducing memory consumption significantly ?



---

archive/issue_comments_532542.json:
```json
{
    "body": "<a id='comment:42'></a>\nNo, its purpose was not to reduce memory consumption, but to make it easier to take care of the resources. Apparently it is not working.",
    "created_at": "2021-12-14T12:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532542",
    "user": "https://github.com/kliem"
}
```

<a id='comment:42'></a>
No, its purpose was not to reduce memory consumption, but to make it easier to take care of the resources. Apparently it is not working.



---

archive/issue_comments_532543.json:
```json
{
    "body": "<a id='comment:43'></a>\nOK, i will keep `tmonteil-lxc1` and `tmonteil-lxc3` patchbots in their current state until this ticket is merged.",
    "created_at": "2021-12-14T12:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532543",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:43'></a>
OK, i will keep `tmonteil-lxc1` and `tmonteil-lxc3` patchbots in their current state until this ticket is merged.



---

archive/issue_comments_532544.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [gh-kliem](#comment%3A42):\n> No, its purpose was not to reduce memory consumption, but to make it easier to take care of the resources. Apparently it is not working.\n\n\nThen you can have a single memory allocator for the class, except for methods where allocated objects are local.",
    "created_at": "2021-12-14T12:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532544",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:44'></a>
Replying to [gh-kliem](#comment%3A42):
> No, its purpose was not to reduce memory consumption, but to make it easier to take care of the resources. Apparently it is not working.


Then you can have a single memory allocator for the class, except for methods where allocated objects are local.



---

archive/issue_comments_532545.json:
```json
{
    "body": "<a id='comment:45'></a>\nThis would still involve some work regarding interrupts. Currently I use the tuple to only keep the memory after success.",
    "created_at": "2021-12-14T13:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532545",
    "user": "https://github.com/kliem"
}
```

<a id='comment:45'></a>
This would still involve some work regarding interrupts. Currently I use the tuple to only keep the memory after success.



---

archive/issue_comments_532546.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-kliem/cinit_in_combinatorial_polyhedron](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/cinit_in_combinatorial_polyhedron)\" to \"[u/gh-kliem/faces_without_memory_allocator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/faces_without_memory_allocator)\".",
    "created_at": "2021-12-15T14:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532546",
    "user": "https://github.com/kliem"
}
```

**Changing branch** from "[u/gh-kliem/cinit_in_combinatorial_polyhedron](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/cinit_in_combinatorial_polyhedron)" to "[u/gh-kliem/faces_without_memory_allocator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/faces_without_memory_allocator)".



---

archive/issue_events_294482.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-12-15T14:35:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294482"
}
```



---

archive/issue_events_294483.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-12-15T14:35:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294483"
}
```



---

archive/issue_comments_532547.json:
```json
{
    "body": "<a id='comment:46'></a>\nOk, new try. I completely removed the usage of `MemoryAllocator` as argument, hoping that this solves our problem.\n\nA future change would be to distinguish between `deep_face_list_t` and `shallow_face_list_t` (or similar). This would further clean up code. However, I hope it works now.\n\n(It requires slightly more memory now to run the face iterator, as the coatoms are deep copied now, such that all of `FaceIterator.new_faces[i]` are of the same type, namely deeply allocated face lists.)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5dbf58d8d53d4f143be6d22f3f2a56dd2647b117\">5dbf58d</a></td><td><code>do not use memory allocator for combinatorial face</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2a72f2275c37599e688f05ba775b00ff06fa3fd\">d2a72f2</a></td><td><code>do not use memory allocator in ListOfFaces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b1fad762e3741f961f0bab51a427286942976fe\">4b1fad7</a></td><td><code>remove memory allocator from polyhedron_face_lattice</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/497f998a791978081e1ee46ac16e605a9f12a809\">497f998</a></td><td><code>Merge branch 'u/gh-kliem/cinit_in_combinatorial_polyhedron' of git://trac.sagemath.org/sage into u/gh-kliem/faces_without_memory_allocator</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b17ce7bf8ba840bcaa3df7286e61def5493892b\">4b17ce7</a></td><td><code>remove MemoryAllocator from FaceIterator</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b51d3b00227cc31398a67c17768dbe85431028f\">9b51d3b</a></td><td><code>remove MemoryAllocator as function argument in base</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d2333d1d79ee6ac696d34dd4c52e33308b7de09\">1d2333d</a></td><td><code>remove `with_allocator` variants for allocating bitsets</code></td></tr></table>\n",
    "created_at": "2021-12-15T14:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532547",
    "user": "https://github.com/kliem"
}
```

<a id='comment:46'></a>
Ok, new try. I completely removed the usage of `MemoryAllocator` as argument, hoping that this solves our problem.

A future change would be to distinguish between `deep_face_list_t` and `shallow_face_list_t` (or similar). This would further clean up code. However, I hope it works now.

(It requires slightly more memory now to run the face iterator, as the coatoms are deep copied now, such that all of `FaceIterator.new_faces[i]` are of the same type, namely deeply allocated face lists.)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5dbf58d8d53d4f143be6d22f3f2a56dd2647b117">5dbf58d</a></td><td><code>do not use memory allocator for combinatorial face</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2a72f2275c37599e688f05ba775b00ff06fa3fd">d2a72f2</a></td><td><code>do not use memory allocator in ListOfFaces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b1fad762e3741f961f0bab51a427286942976fe">4b1fad7</a></td><td><code>remove memory allocator from polyhedron_face_lattice</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/497f998a791978081e1ee46ac16e605a9f12a809">497f998</a></td><td><code>Merge branch 'u/gh-kliem/cinit_in_combinatorial_polyhedron' of git://trac.sagemath.org/sage into u/gh-kliem/faces_without_memory_allocator</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b17ce7bf8ba840bcaa3df7286e61def5493892b">4b17ce7</a></td><td><code>remove MemoryAllocator from FaceIterator</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b51d3b00227cc31398a67c17768dbe85431028f">9b51d3b</a></td><td><code>remove MemoryAllocator as function argument in base</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d2333d1d79ee6ac696d34dd4c52e33308b7de09">1d2333d</a></td><td><code>remove `with_allocator` variants for allocating bitsets</code></td></tr></table>




---

archive/issue_comments_532548.json:
```json
{
    "body": "**Changing commit** from \"[e15fe96020fa9ed3cb8d92310357f741dc9fd2f0](https://github.com/sagemath/sagetrac-mirror/commit/e15fe96020fa9ed3cb8d92310357f741dc9fd2f0)\" to \"[1d2333d1d79ee6ac696d34dd4c52e33308b7de09](https://github.com/sagemath/sagetrac-mirror/commit/1d2333d1d79ee6ac696d34dd4c52e33308b7de09)\".",
    "created_at": "2021-12-15T14:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532548",
    "user": "https://github.com/kliem"
}
```

**Changing commit** from "[e15fe96020fa9ed3cb8d92310357f741dc9fd2f0](https://github.com/sagemath/sagetrac-mirror/commit/e15fe96020fa9ed3cb8d92310357f741dc9fd2f0)" to "[1d2333d1d79ee6ac696d34dd4c52e33308b7de09](https://github.com/sagemath/sagetrac-mirror/commit/1d2333d1d79ee6ac696d34dd4c52e33308b7de09)".



---

archive/issue_comments_532549.json:
```json
{
    "body": "<a id='comment:47'></a>\nSo the patchbot seems somewhat happy and complains about coverage.\n\nI will add doctests for `__dealloc__` illustrating that an error during initialization does not result in segmentation fault.\n\nAlso I will remove the hacks that tell us how far initialization worked out. This can be seen be properly setting values to zero.",
    "created_at": "2021-12-16T15:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532549",
    "user": "https://github.com/kliem"
}
```

<a id='comment:47'></a>
So the patchbot seems somewhat happy and complains about coverage.

I will add doctests for `__dealloc__` illustrating that an error during initialization does not result in segmentation fault.

Also I will remove the hacks that tell us how far initialization worked out. This can be seen be properly setting values to zero.



---

archive/issue_events_294484.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-12-16T15:25:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294484"
}
```



---

archive/issue_events_294485.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-12-16T15:25:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294485"
}
```



---

archive/issue_comments_532550.json:
```json
{
    "body": "**Changing commit** from \"[1d2333d1d79ee6ac696d34dd4c52e33308b7de09](https://github.com/sagemath/sagetrac-mirror/commit/1d2333d1d79ee6ac696d34dd4c52e33308b7de09)\" to \"[cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5](https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5)\".",
    "created_at": "2021-12-16T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1d2333d1d79ee6ac696d34dd4c52e33308b7de09](https://github.com/sagemath/sagetrac-mirror/commit/1d2333d1d79ee6ac696d34dd4c52e33308b7de09)" to "[cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5](https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5)".



---

archive/issue_comments_532551.json:
```json
{
    "body": "<a id='comment:48'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4db1326fa78bcf092bcc824c9855eac80681012\">a4db132</a></td><td><code>ensure that we do not free non-initialized faces in face_list</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7671c7121d14106a1d592453e1eece9550cdcd12\">7671c71</a></td><td><code>remove hack from base.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c93835c8930aa4dcba85d68cdc9ac8bd22a408d\">0c93835</a></td><td><code>remove slicing from face_list_shallow_copy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7c3e317101b1dc646f28882198410e31d16eac9\">c7c3e31</a></td><td><code>remove hack in combinatorial_face</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38b8d6b9086086993f86bbd03a05af1977f26424\">38b8d6b</a></td><td><code>use that cython sets all values to zero before calling __cinit__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e6f2004ad8e862ef3bde326c81b56889b5a07c1\">5e6f200</a></td><td><code>type and fix deletion of faces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/753db88c0d9663287aa802b6831c7417ca6b0620\">753db88</a></td><td><code>remove hack in list of faces</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8afbc90050a209f50cabac67a40ead9501ecd76\">c8afbc9</a></td><td><code>remove hack from face lattice</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5\">cdafc5c</a></td><td><code>remove hack from face_iterator</code></td></tr></table>\n",
    "created_at": "2021-12-16T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4db1326fa78bcf092bcc824c9855eac80681012">a4db132</a></td><td><code>ensure that we do not free non-initialized faces in face_list</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7671c7121d14106a1d592453e1eece9550cdcd12">7671c71</a></td><td><code>remove hack from base.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c93835c8930aa4dcba85d68cdc9ac8bd22a408d">0c93835</a></td><td><code>remove slicing from face_list_shallow_copy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7c3e317101b1dc646f28882198410e31d16eac9">c7c3e31</a></td><td><code>remove hack in combinatorial_face</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38b8d6b9086086993f86bbd03a05af1977f26424">38b8d6b</a></td><td><code>use that cython sets all values to zero before calling __cinit__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e6f2004ad8e862ef3bde326c81b56889b5a07c1">5e6f200</a></td><td><code>type and fix deletion of faces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/753db88c0d9663287aa802b6831c7417ca6b0620">753db88</a></td><td><code>remove hack in list of faces</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8afbc90050a209f50cabac67a40ead9501ecd76">c8afbc9</a></td><td><code>remove hack from face lattice</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5">cdafc5c</a></td><td><code>remove hack from face_iterator</code></td></tr></table>




---

archive/issue_comments_532552.json:
```json
{
    "body": "<a id='comment:49'></a>\nShould be cleaner now.",
    "created_at": "2021-12-16T18:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532552",
    "user": "https://github.com/kliem"
}
```

<a id='comment:49'></a>
Should be cleaner now.



---

archive/issue_events_294486.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-12-16T18:26:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294486"
}
```



---

archive/issue_events_294487.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-12-16T18:26:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294487"
}
```



---

archive/issue_comments_532553.json:
```json
{
    "body": "<a id='comment:50'></a>\nOne bot is happy and just reports to random failures:\n- ticket:32782#comment:10\n- #33039",
    "created_at": "2021-12-17T15:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532553",
    "user": "https://github.com/kliem"
}
```

<a id='comment:50'></a>
One bot is happy and just reports to random failures:
- ticket:32782#comment:10
- #33039



---

archive/issue_comments_532554.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe, Thierry Monteil\" to \"Matthias Koeppe, Thierry Monteil, https://github.com/kliem/sage/pull/50/checks\".",
    "created_at": "2021-12-17T15:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532554",
    "user": "https://github.com/kliem"
}
```

**Changing reviewer** from "Matthias Koeppe, Thierry Monteil" to "Matthias Koeppe, Thierry Monteil, https://github.com/kliem/sage/pull/50/checks".



---

archive/issue_comments_532555.json:
```json
{
    "body": "<a id='comment:52'></a>\nWith the last branch, on `tmonteil-lxc3`, the doctests of `src/sage/geometry/polyhedron/` pass, and all the previous tests that you let me try in that ticket that do not involve `MemoryAllocator` pass as well.",
    "created_at": "2021-12-18T00:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532555",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:52'></a>
With the last branch, on `tmonteil-lxc3`, the doctests of `src/sage/geometry/polyhedron/` pass, and all the previous tests that you let me try in that ticket that do not involve `MemoryAllocator` pass as well.



---

archive/issue_comments_532556.json:
```json
{
    "body": "<a id='comment:53'></a>\nThe tests on GH Actions that have completed so far also look good.",
    "created_at": "2021-12-18T04:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532556",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>
The tests on GH Actions that have completed so far also look good.



---

archive/issue_comments_532557.json:
```json
{
    "body": "**Changing reviewer** from \"Matthias Koeppe, Thierry Monteil, https://github.com/kliem/sage/pull/50/checks\" to \"Matthias Koeppe, Thierry Monteil\".",
    "created_at": "2021-12-18T04:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532557",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Matthias Koeppe, Thierry Monteil, https://github.com/kliem/sage/pull/50/checks" to "Matthias Koeppe, Thierry Monteil".



---

archive/issue_events_294488.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T04:00:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294488"
}
```



---

archive/issue_events_294489.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T04:00:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294489"
}
```



---

archive/issue_comments_532558.json:
```json
{
    "body": "<a id='comment:54'></a>\nThank you.",
    "created_at": "2021-12-18T09:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532558",
    "user": "https://github.com/kliem"
}
```

<a id='comment:54'></a>
Thank you.



---

archive/issue_comments_532559.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-kliem/faces_without_memory_allocator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/faces_without_memory_allocator)\" to \"[cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5](https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5)\".",
    "created_at": "2021-12-23T20:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532559",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-kliem/faces_without_memory_allocator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/faces_without_memory_allocator)" to "[cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5](https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5)".



---

archive/issue_events_294490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-23T20:26:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294490"
}
```



---

archive/issue_events_294491.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-23T20:26:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32827#event-294491"
}
```



---

archive/issue_comments_532560.json:
```json
{
    "body": "<a id='comment:56'></a>\nThis is still borked on 32-bit, I've made #33073 as a follow-up.",
    "created_at": "2021-12-23T20:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532560",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:56'></a>
This is still borked on 32-bit, I've made #33073 as a follow-up.



---

archive/issue_comments_532561.json:
```json
{
    "body": "**Changing commit** from \"[cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5](https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5)\" to \"\".",
    "created_at": "2021-12-23T20:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32827",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32827#issuecomment-532561",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5](https://github.com/sagemath/sagetrac-mirror/commit/cdafc5ca84ab0387f9cf9e628d48fbc3964e81c5)" to "".
