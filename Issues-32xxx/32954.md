# Issue 32954: sage.libs.singular: On cygwin, do not try to reload the singular library

archive/issues_032717.json:
```json
{
    "body": "CC:  @orlitzky @slel @dimpase\n\n(split out from #32789)\n\n#29024 broke Cygwin.  With singular from SPKG (as the cygwin-provided Singular is too old and is correctly rejected), as reported in https://groups.google.com/g/sage-release/c/FXpakLURP_0/m/La20cB4rBgAJ:\n\n```\n  [sagemath_doc_html-none]     File \"sage/libs/singular/singular.pyx\", line 1555, in init sage.libs.singular.singular (build/cythonized/sage/libs/singular/singular.cpp:15622)\n  [sagemath_doc_html-none]     File \"sage/libs/singular/singular.pyx\", line 1530, in sage.libs.singular.singular.init_libsingular (build/cythonized/sage/libs/singular/singular.cpp:12925)\n  [sagemath_doc_html-none]   ImportError: cannot load Singular library from /home/s/sage9n/local/bin/libSingular.dll (b'No such file or directory')\n  [sagemath_doc_html-none]   Error: './sage --docbuild --all-documents' failed\n```\n\nOn the cygwin platform, there is no need to make library symbols global.\n\nThis sidesteps the issue of determining the correct DLL file name in #32789.\n\nThe branch is on top of other Cygwin fixes for convenience of testing.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32954\n\n",
    "closed_at": "2021-12-12T15:09:21Z",
    "created_at": "2021-12-01T17:47:28Z",
    "labels": [
        "component: porting: cygwin",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "sage.libs.singular: On cygwin, do not try to reload the singular library",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32954",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @orlitzky @slel @dimpase

(split out from #32789)

#29024 broke Cygwin.  With singular from SPKG (as the cygwin-provided Singular is too old and is correctly rejected), as reported in https://groups.google.com/g/sage-release/c/FXpakLURP_0/m/La20cB4rBgAJ:

```
  [sagemath_doc_html-none]     File "sage/libs/singular/singular.pyx", line 1555, in init sage.libs.singular.singular (build/cythonized/sage/libs/singular/singular.cpp:15622)
  [sagemath_doc_html-none]     File "sage/libs/singular/singular.pyx", line 1530, in sage.libs.singular.singular.init_libsingular (build/cythonized/sage/libs/singular/singular.cpp:12925)
  [sagemath_doc_html-none]   ImportError: cannot load Singular library from /home/s/sage9n/local/bin/libSingular.dll (b'No such file or directory')
  [sagemath_doc_html-none]   Error: './sage --docbuild --all-documents' failed
```

On the cygwin platform, there is no need to make library symbols global.

This sidesteps the issue of determining the correct DLL file name in #32789.

The branch is on top of other Cygwin fixes for convenience of testing.


Issue created by migration from https://trac.sagemath.org/ticket/32954





---

archive/issue_comments_466112.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-01T17:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466112",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_466113.json:
```json
{
    "body": "Can you also remove the two cygwin-specific cases in spkg-configure.m4?",
    "created_at": "2021-12-01T18:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466113",
    "user": "https://github.com/orlitzky"
}
```

Can you also remove the two cygwin-specific cases in spkg-configure.m4?



---

archive/issue_comments_466114.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-01T18:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466114",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466115.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-01T23:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466115",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_466116.json:
```json
{
    "body": "I wonder what, if anything, goes wrong on Linux/OSX if we skip the `dlopen()`. There isn't much of an explanation in the code. Maybe the whole thing is some crazy corner case.",
    "created_at": "2021-12-01T23:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466116",
    "user": "https://github.com/orlitzky"
}
```

I wonder what, if anything, goes wrong on Linux/OSX if we skip the `dlopen()`. There isn't much of an explanation in the code. Maybe the whole thing is some crazy corner case.



---

archive/issue_comments_466117.json:
```json
{
    "body": "Thanks.",
    "created_at": "2021-12-01T23:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466117",
    "user": "https://github.com/mkoeppe"
}
```

Thanks.



---

archive/issue_comments_466118.json:
```json
{
    "body": "With this branch, the sagemath_doc_html-none\nbuild failure no longer seems to involve Singular.\n\n```\n$ make -s V=0 ptestlong\n...\n[sagemath_doc_html-none] installing. Log file: /home/s/sage9m/logs/pkgs/sagemath_doc_html-none.log\n  [sagemath_doc_html-none] error installing, exit status 2. End of log file:\n  [sagemath_doc_html-none]   [reference]     sat: 0 todos, 8 index, 4 citations, 7 modules\n  [sagemath_doc_html-none]   [reference]     schemes: 5 todos, 53 index, 0 citations, 52 modules\n  [sagemath_doc_html-none]   [reference]     semirings: 0 todos, 3 index, 0 citations, 2 modules\n  [sagemath_doc_html-none]   [reference]     sets: 4 todos, 19 index, 0 citations, 18 modules\n  [sagemath_doc_html-none]   [reference]     spkg: 0 todos, 341 index, 0 citations, 0 modules\n  [sagemath_doc_html-none]   [reference]     stats: 0 todos, 11 index, 0 citations, 10 modules\n  [sagemath_doc_html-none]   [reference]     structure: 7 todos, 32 index, 0 citations, 31 modules\n  [sagemath_doc_html-none]   [reference]     tensor_free_modules: 2 todos, 19 index, 0 citations, 15 modules\n  [sagemath_doc_html-none]   [reference]     topology: 0 todos, 14 index, 0 citations, 13 modules\n  [sagemath_doc_html-none]   [reference]     valuations: 1 todos, 14 index, 0 citations, 13 modules\n  [sagemath_doc_html-none]   [reference] ... done (358 todos, 2093 index, 1442 citations, 1730 modules)\n  [sagemath_doc_html-none]   [reference] WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/combinat/environment.pickle\n  [sagemath_doc_html-none]   [reference] WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/manifolds/environment.pickle\n  [sagemath_doc_html-none]   [reference] preparing documents... skipping loading of indexes... done\n  [sagemath_doc_html-none]   [reference] /home/s/sage9m/src/doc/en/reference/index.rst:85: WARNING: unknown document: combinat/index\n  [sagemath_doc_html-none]   [reference] /home/s/sage9m/src/doc/en/reference/index.rst:102: WARNING: unknown document: manifolds/index\n  [sagemath_doc_html-none]   [reference] The inventory files are in local/share/doc/sage/inventory/en/reference.\n  [sagemath_doc_html-none]   Error building the documentation.\n  [sagemath_doc_html-none]   Traceback (most recent call last):\n  [sagemath_doc_html-none]     File \"/usr/lib/python3.8/runpy.py\", line 194, in _run_module_as_main\n  [sagemath_doc_html-none]       return _run_code(code, main_globals, None,\n  [sagemath_doc_html-none]     File \"/usr/lib/python3.8/runpy.py\", line 87, in _run_code\n  [sagemath_doc_html-none]       exec(code, run_globals)\n  [sagemath_doc_html-none]     File \"/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__main__.py\", line 2, in <module>\n  [sagemath_doc_html-none]       main()\n  [sagemath_doc_html-none]     File \"/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__init__.py\", line 1815, in main\n  [sagemath_doc_html-none]       builder()\n  [sagemath_doc_html-none]     File \"/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__init__.py\", line 133, in f\n  [sagemath_doc_html-none]       runsphinx()\n  [sagemath_doc_html-none]     File \"/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/sphinxbuild.py\", line 323, in runsphinx\n  [sagemath_doc_html-none]       sys.stderr.raise_errors()\n  [sagemath_doc_html-none]     File \"/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/sphinxbuild.py\", line 258, in raise_errors\n  [sagemath_doc_html-none]       raise OSError(self._error)\n  [sagemath_doc_html-none]   OSError: WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/combinat/environment.pickle\n  [sagemath_doc_html-none]\n  [sagemath_doc_html-none]       Note: incremental documentation builds sometimes cause spurious\n  [sagemath_doc_html-none]       error messages. To be certain that these are real errors, run\n  [sagemath_doc_html-none]       \"make doc-clean\" first and try again.\n  [sagemath_doc_html-none]   make[6]: *** [Makefile:20: doc-inventory--reference_top] Error 1\n  [sagemath_doc_html-none]   make[5]: *** [Makefile:38: doc-inventory-reference] Error 2\n  [sagemath_doc_html-none] Full log file: /home/s/sage9m/logs/pkgs/sagemath_doc_html-none.log\nmake[4]: *** [Makefile:2789: sagemath_doc_html-SAGE_DOCS-no-deps] Error 2\nmake[3]: *** [Makefile:2789: /home/s/sage9m/local/var/lib/sage/installed/sagemath_doc_html-none] Error 2\nmake[2]: *** [Makefile:2332: all-start] Error 2\n\nreal    670m5.381s\nuser    1085m16.267s\nsys     293m31.592s\n***************************************************************\nError building Sage.\n\nThe following package(s) may have failed to build (not necessarily\nduring this run of 'make all-start'):\n\nIt is safe to delete any log files and build directories, but they\ncontain information that is helpful for debugging build problems.\nWARNING: If you now run 'make' again, the build directory of the\nsame version of the package will, by default, be deleted. Set the\nenvironment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.\n\nmake[1]: *** [Makefile:39: all-start] Error 1\nmake: *** [Makefile:13: all] Error 2\n```",
    "created_at": "2021-12-02T19:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466118",
    "user": "https://github.com/slel"
}
```

With this branch, the sagemath_doc_html-none
build failure no longer seems to involve Singular.

```
$ make -s V=0 ptestlong
...
[sagemath_doc_html-none] installing. Log file: /home/s/sage9m/logs/pkgs/sagemath_doc_html-none.log
  [sagemath_doc_html-none] error installing, exit status 2. End of log file:
  [sagemath_doc_html-none]   [reference]     sat: 0 todos, 8 index, 4 citations, 7 modules
  [sagemath_doc_html-none]   [reference]     schemes: 5 todos, 53 index, 0 citations, 52 modules
  [sagemath_doc_html-none]   [reference]     semirings: 0 todos, 3 index, 0 citations, 2 modules
  [sagemath_doc_html-none]   [reference]     sets: 4 todos, 19 index, 0 citations, 18 modules
  [sagemath_doc_html-none]   [reference]     spkg: 0 todos, 341 index, 0 citations, 0 modules
  [sagemath_doc_html-none]   [reference]     stats: 0 todos, 11 index, 0 citations, 10 modules
  [sagemath_doc_html-none]   [reference]     structure: 7 todos, 32 index, 0 citations, 31 modules
  [sagemath_doc_html-none]   [reference]     tensor_free_modules: 2 todos, 19 index, 0 citations, 15 modules
  [sagemath_doc_html-none]   [reference]     topology: 0 todos, 14 index, 0 citations, 13 modules
  [sagemath_doc_html-none]   [reference]     valuations: 1 todos, 14 index, 0 citations, 13 modules
  [sagemath_doc_html-none]   [reference] ... done (358 todos, 2093 index, 1442 citations, 1730 modules)
  [sagemath_doc_html-none]   [reference] WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/combinat/environment.pickle
  [sagemath_doc_html-none]   [reference] WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/manifolds/environment.pickle
  [sagemath_doc_html-none]   [reference] preparing documents... skipping loading of indexes... done
  [sagemath_doc_html-none]   [reference] /home/s/sage9m/src/doc/en/reference/index.rst:85: WARNING: unknown document: combinat/index
  [sagemath_doc_html-none]   [reference] /home/s/sage9m/src/doc/en/reference/index.rst:102: WARNING: unknown document: manifolds/index
  [sagemath_doc_html-none]   [reference] The inventory files are in local/share/doc/sage/inventory/en/reference.
  [sagemath_doc_html-none]   Error building the documentation.
  [sagemath_doc_html-none]   Traceback (most recent call last):
  [sagemath_doc_html-none]     File "/usr/lib/python3.8/runpy.py", line 194, in _run_module_as_main
  [sagemath_doc_html-none]       return _run_code(code, main_globals, None,
  [sagemath_doc_html-none]     File "/usr/lib/python3.8/runpy.py", line 87, in _run_code
  [sagemath_doc_html-none]       exec(code, run_globals)
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__main__.py", line 2, in <module>
  [sagemath_doc_html-none]       main()
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__init__.py", line 1815, in main
  [sagemath_doc_html-none]       builder()
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__init__.py", line 133, in f
  [sagemath_doc_html-none]       runsphinx()
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/sphinxbuild.py", line 323, in runsphinx
  [sagemath_doc_html-none]       sys.stderr.raise_errors()
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/sphinxbuild.py", line 258, in raise_errors
  [sagemath_doc_html-none]       raise OSError(self._error)
  [sagemath_doc_html-none]   OSError: WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/combinat/environment.pickle
  [sagemath_doc_html-none]
  [sagemath_doc_html-none]       Note: incremental documentation builds sometimes cause spurious
  [sagemath_doc_html-none]       error messages. To be certain that these are real errors, run
  [sagemath_doc_html-none]       "make doc-clean" first and try again.
  [sagemath_doc_html-none]   make[6]: *** [Makefile:20: doc-inventory--reference_top] Error 1
  [sagemath_doc_html-none]   make[5]: *** [Makefile:38: doc-inventory-reference] Error 2
  [sagemath_doc_html-none] Full log file: /home/s/sage9m/logs/pkgs/sagemath_doc_html-none.log
make[4]: *** [Makefile:2789: sagemath_doc_html-SAGE_DOCS-no-deps] Error 2
make[3]: *** [Makefile:2789: /home/s/sage9m/local/var/lib/sage/installed/sagemath_doc_html-none] Error 2
make[2]: *** [Makefile:2332: all-start] Error 2

real    670m5.381s
user    1085m16.267s
sys     293m31.592s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make all-start'):

It is safe to delete any log files and build directories, but they
contain information that is helpful for debugging build problems.
WARNING: If you now run 'make' again, the build directory of the
same version of the package will, by default, be deleted. Set the
environment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.

make[1]: *** [Makefile:39: all-start] Error 1
make: *** [Makefile:13: all] Error 2
```



---

archive/issue_comments_466119.json:
```json
{
    "body": "Yes, there are some other issues on Cygwin that now become visible. The actual error is further up in the log file `sagemath_doc_html-none.log`",
    "created_at": "2021-12-02T19:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466119",
    "user": "https://github.com/mkoeppe"
}
```

Yes, there are some other issues on Cygwin that now become visible. The actual error is further up in the log file `sagemath_doc_html-none.log`



---

archive/issue_comments_466120.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32954#issuecomment-466120",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_087069.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-12T15:09:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32954",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32954#event-87069"
}
```
