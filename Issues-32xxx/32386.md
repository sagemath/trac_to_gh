# Issue 32386: Merge pynac sources as src/sage/symbolic/ginac

archive/issues_032149.json:
```json
{
    "assignees": [],
    "body": "Pynac has a compile-time dependency on the Python library but is not installed using Python package infrastructure. This is problematic because Python users cannot install it using standard Python tools - for example for testing different Python versions.\n\nPynac has no other uses than as the core of the symbolic expressions facility of Sage; and cannot even be tested without Sage.\n\nWe merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC. (The existing !Python/Cython symbolics code in `sage.symbolic`, `sage.calculus`, `sage.functions` is about 60kLOC.)\n\nThe Pynac sources are compiled like other C++ sources that are already in the Sage source tree. They are linked into a single Python extension module, `sage.symbolic.expression`. All other extension modules that used to link to pynac (`sage.libs.pynac.pynac`, `sage.symbolic.function`, `sage.symbolic.series` etc.) are \n- either refactored so that they only `import` helper functions provided by `sage.symbolic.expression` instead of having to `cimport` Pynac functions directly (see #32391, #32407)\n- or merged into the extension module `sage.symbolic.expression` (via Cython `include` statements, not by copy-paste of source code, to keep the diff small)\n\nThis solves the same issues that #30534 tried to address, which ran into unresolved technical difficulties.\n\nIt will also make it easier for Sage developers to make changes to Pynac and the related symbolic implementation.\n\nFollow-up: #32387 Remove pynac spkg\n\n\nDepends on #32391\nDepends on #32407\nDepends on #32461\n\nCC:  @kliem @kiwifb @antonio-rojas @DaveWitteMorris @slel @dimpase @tscrim @egourgoulhon @nbruin\n\nBranch: **[`0d0b58f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Matthias Koeppe, Jonathan Kliem**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32386_\n\n",
    "closed_at": "2021-09-15T22:06:00Z",
    "created_at": "2021-08-16T17:27:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Merge pynac sources as src/sage/symbolic/ginac",
    "type": "issue",
    "updated_at": "2021-09-28T19:38:43Z",
    "url": "https://github.com/sagemath/sage/issues/32386",
    "user": "https://github.com/mkoeppe"
}
```
Pynac has a compile-time dependency on the Python library but is not installed using Python package infrastructure. This is problematic because Python users cannot install it using standard Python tools - for example for testing different Python versions.

Pynac has no other uses than as the core of the symbolic expressions facility of Sage; and cannot even be tested without Sage.

We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC. (The existing !Python/Cython symbolics code in `sage.symbolic`, `sage.calculus`, `sage.functions` is about 60kLOC.)

The Pynac sources are compiled like other C++ sources that are already in the Sage source tree. They are linked into a single Python extension module, `sage.symbolic.expression`. All other extension modules that used to link to pynac (`sage.libs.pynac.pynac`, `sage.symbolic.function`, `sage.symbolic.series` etc.) are 
- either refactored so that they only `import` helper functions provided by `sage.symbolic.expression` instead of having to `cimport` Pynac functions directly (see #32391, #32407)
- or merged into the extension module `sage.symbolic.expression` (via Cython `include` statements, not by copy-paste of source code, to keep the diff small)

This solves the same issues that #30534 tried to address, which ran into unresolved technical difficulties.

It will also make it easier for Sage developers to make changes to Pynac and the related symbolic implementation.

Follow-up: #32387 Remove pynac spkg


Depends on #32391
Depends on #32407
Depends on #32461

CC:  @kliem @kiwifb @antonio-rojas @DaveWitteMorris @slel @dimpase @tscrim @egourgoulhon @nbruin

Branch: **[`0d0b58f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c)**

Reviewer: **Dima Pasechnik**

Author: **Matthias Koeppe, Jonathan Kliem**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/32386_





---

archive/issue_events_443487.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-16T17:27:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443487"
}
```



---

archive/issue_events_443488.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-16T17:27:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443488"
}
```



---

archive/issue_events_443489.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-16T17:27:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443489"
}
```



---

archive/issue_events_443490.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-16T17:27:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443490"
}
```



---

archive/issue_events_443491.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-16T17:29:42Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "title_is": "Merge pynac as src/sage/symbolic/ginac",
    "title_was": "Merge pynac as src/sage/symbolics/ginac",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443491"
}
```



---

archive/issue_comments_521876.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n Pynac has no other uses than as the core of the symbolic expressions facility of Sage; and cannot even be tested without Sage.\n \n-We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolics/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC.\n+We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC.\n \n This will solve the same issues that #30534 tried to address, which ran into unresolved technical difficulties.\n \n``````\n",
    "created_at": "2021-08-16T17:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521876",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 Pynac has no other uses than as the core of the symbolic expressions facility of Sage; and cannot even be tested without Sage.
 
-We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolics/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC.
+We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC.
 
 This will solve the same issues that #30534 tried to address, which ran into unresolved technical difficulties.
 
``````




---

archive/issue_comments_521877.json:
```json
{
    "body": "Branch: **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-16T18:15:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521877",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521878.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI ran `git filter-branch -f --tree-filter 'rm -f Makefile.am; mkdir -p src/sage/symbolic/ginac; mv *.* src/sage/symbolic/ginac/; :' -- --all` on pynac 0.7.29 and merged it here, thus preserving the relevant history\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3bb79f5091e83ed2deaeda9e9a987bdd5ef6362\"><code>f3bb79f</code></a></td><td><code>Merge pull request #374 from slel/fix-exp-inv-hyp</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a99791b4f688cbc5823cbd8a056639be7135b48f\"><code>a99791b</code></a></td><td><code>apply patches from #31479 and #31554</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91cb6facf1b5400012ab58fd979d774f5404e1d8\"><code>91cb6fa</code></a></td><td><code>apply trac 31869 fix pynac integer_content</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d96393c301bf5017c25ec2a730b3a07fd7e98f65\"><code>d96393c</code></a></td><td><code>apply trac 30688 patch infinite loop in pynac</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80269c5c31192031523a33caaaefe711b665325f\"><code>80269c5</code></a></td><td><code>apply trac 31645 handling of constant term in series</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4caca2e1b843d3f1cec4b3c52fe52775a51a1855\"><code>4caca2e</code></a></td><td><code>apply trac 31530 patch pynac power::subs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cba9038d840ea2fb4340ecb571b45a414aea497c\"><code>cba9038</code></a></td><td><code>trac 31585 32-bit overflow</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8acb54803fc18bec2a1e6d81090b8555161661be\"><code>8acb548</code></a></td><td><code>also fix /=</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2040c84015675749e0eaf626367cb05377ae086\"><code>f2040c8</code></a></td><td><code>ginac/numeric.cpp: Only use builtin for smull_overflow if supported by the compiler</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e43830d72c9a45a60f9959fe8a0bbb43f8d39256\"><code>e43830d</code></a></td><td><code>Merge remote-tracking branch 'pynac-filtered/master' into t/32386/merge_pynac_as_src_sage_symbolic_ginac</code></td></tr></table>\n",
    "created_at": "2021-08-16T18:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521878",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

I ran `git filter-branch -f --tree-filter 'rm -f Makefile.am; mkdir -p src/sage/symbolic/ginac; mv *.* src/sage/symbolic/ginac/; :' -- --all` on pynac 0.7.29 and merged it here, thus preserving the relevant history

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3bb79f5091e83ed2deaeda9e9a987bdd5ef6362"><code>f3bb79f</code></a></td><td><code>Merge pull request #374 from slel/fix-exp-inv-hyp</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a99791b4f688cbc5823cbd8a056639be7135b48f"><code>a99791b</code></a></td><td><code>apply patches from #31479 and #31554</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91cb6facf1b5400012ab58fd979d774f5404e1d8"><code>91cb6fa</code></a></td><td><code>apply trac 31869 fix pynac integer_content</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d96393c301bf5017c25ec2a730b3a07fd7e98f65"><code>d96393c</code></a></td><td><code>apply trac 30688 patch infinite loop in pynac</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80269c5c31192031523a33caaaefe711b665325f"><code>80269c5</code></a></td><td><code>apply trac 31645 handling of constant term in series</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4caca2e1b843d3f1cec4b3c52fe52775a51a1855"><code>4caca2e</code></a></td><td><code>apply trac 31530 patch pynac power::subs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cba9038d840ea2fb4340ecb571b45a414aea497c"><code>cba9038</code></a></td><td><code>trac 31585 32-bit overflow</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8acb54803fc18bec2a1e6d81090b8555161661be"><code>8acb548</code></a></td><td><code>also fix /=</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2040c84015675749e0eaf626367cb05377ae086"><code>f2040c8</code></a></td><td><code>ginac/numeric.cpp: Only use builtin for smull_overflow if supported by the compiler</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e43830d72c9a45a60f9959fe8a0bbb43f8d39256"><code>e43830d</code></a></td><td><code>Merge remote-tracking branch 'pynac-filtered/master' into t/32386/merge_pynac_as_src_sage_symbolic_ginac</code></td></tr></table>




---

archive/issue_comments_521879.json:
```json
{
    "body": "Commit: **[`e43830d`](https://github.com/sagemath/sagetrac-mirror/commit/e43830d72c9a45a60f9959fe8a0bbb43f8d39256)**",
    "created_at": "2021-08-16T18:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521879",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`e43830d`](https://github.com/sagemath/sagetrac-mirror/commit/e43830d72c9a45a60f9959fe8a0bbb43f8d39256)**



---

archive/issue_comments_521880.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2bbf412594790a63b81855f9f5d467c98e4b3a54\"><code>2bbf412</code></a></td><td><code>build/pkgs/pynac: Remove</code></td></tr></table>\n",
    "created_at": "2021-08-16T18:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521880",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2bbf412594790a63b81855f9f5d467c98e4b3a54"><code>2bbf412</code></a></td><td><code>build/pkgs/pynac: Remove</code></td></tr></table>




---

archive/issue_comments_521881.json:
```json
{
    "body": "Changed commit from **[`e43830d`](https://github.com/sagemath/sagetrac-mirror/commit/e43830d72c9a45a60f9959fe8a0bbb43f8d39256)** to **[`2bbf412`](https://github.com/sagemath/sagetrac-mirror/commit/2bbf412594790a63b81855f9f5d467c98e4b3a54)**",
    "created_at": "2021-08-16T18:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521881",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e43830d`](https://github.com/sagemath/sagetrac-mirror/commit/e43830d72c9a45a60f9959fe8a0bbb43f8d39256)** to **[`2bbf412`](https://github.com/sagemath/sagetrac-mirror/commit/2bbf412594790a63b81855f9f5d467c98e4b3a54)**



---

archive/issue_comments_521882.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNext: Move stuff from `sage.libs.pynac` to `sage.symbolic.ginac`, leaving some deprecated reimports behind. \n\nHelp from Cython experts very welcome...",
    "created_at": "2021-08-16T18:32:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521882",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Next: Move stuff from `sage.libs.pynac` to `sage.symbolic.ginac`, leaving some deprecated reimports behind. 

Help from Cython experts very welcome...



---

archive/issue_comments_521883.json:
```json
{
    "body": "Changed commit from **[`2bbf412`](https://github.com/sagemath/sagetrac-mirror/commit/2bbf412594790a63b81855f9f5d467c98e4b3a54)** to **[`e693827`](https://github.com/sagemath/sagetrac-mirror/commit/e693827e4e554469a35b62ba0c9e68f2a24d3503)**",
    "created_at": "2021-08-16T19:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521883",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2bbf412`](https://github.com/sagemath/sagetrac-mirror/commit/2bbf412594790a63b81855f9f5d467c98e4b3a54)** to **[`e693827`](https://github.com/sagemath/sagetrac-mirror/commit/e693827e4e554469a35b62ba0c9e68f2a24d3503)**



---

archive/issue_comments_521884.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e693827e4e554469a35b62ba0c9e68f2a24d3503\"><code>e693827</code></a></td><td><code>Move stuff from sage.libs.pynac to sage.symbolic.ginac, leaving some deprecated reimports behind</code></td></tr></table>\n",
    "created_at": "2021-08-16T19:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521884",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e693827e4e554469a35b62ba0c9e68f2a24d3503"><code>e693827</code></a></td><td><code>Move stuff from sage.libs.pynac to sage.symbolic.ginac, leaving some deprecated reimports behind</code></td></tr></table>




---

archive/issue_comments_521885.json:
```json
{
    "body": "Changed commit from **[`e693827`](https://github.com/sagemath/sagetrac-mirror/commit/e693827e4e554469a35b62ba0c9e68f2a24d3503)** to **[`0581bac`](https://github.com/sagemath/sagetrac-mirror/commit/0581bac4e5cae56162ef7ff2bb55081434054414)**",
    "created_at": "2021-08-16T19:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521885",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e693827`](https://github.com/sagemath/sagetrac-mirror/commit/e693827e4e554469a35b62ba0c9e68f2a24d3503)** to **[`0581bac`](https://github.com/sagemath/sagetrac-mirror/commit/0581bac4e5cae56162ef7ff2bb55081434054414)**



---

archive/issue_comments_521886.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bfc24f9f91043a0066b412c2e3dd1c2cab7d2de\"><code>0bfc24f</code></a></td><td><code>src/sage/symbolic/ginac/version.h.in: Remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0581bac4e5cae56162ef7ff2bb55081434054414\"><code>0581bac</code></a></td><td><code>src/sage/symbolic/ginac/pynac-config.h: New</code></td></tr></table>\n",
    "created_at": "2021-08-16T19:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521886",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bfc24f9f91043a0066b412c2e3dd1c2cab7d2de"><code>0bfc24f</code></a></td><td><code>src/sage/symbolic/ginac/version.h.in: Remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0581bac4e5cae56162ef7ff2bb55081434054414"><code>0581bac</code></a></td><td><code>src/sage/symbolic/ginac/pynac-config.h: New</code></td></tr></table>




---

archive/issue_comments_521887.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis version compiles OK",
    "created_at": "2021-08-16T19:31:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521887",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

This version compiles OK



---

archive/issue_events_443492.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-16T19:32:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "title_is": "Merge pynac sources as src/sage/symbolic/ginac",
    "title_was": "Merge pynac as src/sage/symbolic/ginac",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443492"
}
```



---

archive/issue_comments_521888.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-08-16T19:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521888",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_521889.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/496102dbdf8ac4c03c7ce417e267ef4d64b023f2\"><code>496102d</code></a></td><td><code>src/sage/symbolic/ginac/utils.h, pynac-config.h: Eliminate use of PYNAC_SIZEOF_LONG, PYNAC_SIZEOF_LONG_LONG</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc29c1de46013777a5e4e2b592b9e0e0cf3e21d0\"><code>fc29c1d</code></a></td><td><code>src/sage/symbolic/pynac.pyx, pynac.pxd: Fixup distutils: sources</code></td></tr></table>\n",
    "created_at": "2021-08-16T20:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521889",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/496102dbdf8ac4c03c7ce417e267ef4d64b023f2"><code>496102d</code></a></td><td><code>src/sage/symbolic/ginac/utils.h, pynac-config.h: Eliminate use of PYNAC_SIZEOF_LONG, PYNAC_SIZEOF_LONG_LONG</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc29c1de46013777a5e4e2b592b9e0e0cf3e21d0"><code>fc29c1d</code></a></td><td><code>src/sage/symbolic/pynac.pyx, pynac.pxd: Fixup distutils: sources</code></td></tr></table>




---

archive/issue_comments_521890.json:
```json
{
    "body": "Changed commit from **[`0581bac`](https://github.com/sagemath/sagetrac-mirror/commit/0581bac4e5cae56162ef7ff2bb55081434054414)** to **[`fc29c1d`](https://github.com/sagemath/sagetrac-mirror/commit/fc29c1de46013777a5e4e2b592b9e0e0cf3e21d0)**",
    "created_at": "2021-08-16T20:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521890",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0581bac`](https://github.com/sagemath/sagetrac-mirror/commit/0581bac4e5cae56162ef7ff2bb55081434054414)** to **[`fc29c1d`](https://github.com/sagemath/sagetrac-mirror/commit/fc29c1de46013777a5e4e2b592b9e0e0cf3e21d0)**



---

archive/issue_comments_521891.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8223127e18030e663830e60b04c61f8d8f737f2d\"><code>8223127</code></a></td><td><code>src/sage/symbolic/ginac/utils.h: Fixup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/add5e891706dd779b6129cea0e8dc175c3c48054\"><code>add5e89</code></a></td><td><code>src/sage/symbolic/ginac/utils.cpp: Fixup removal of version.h</code></td></tr></table>\n",
    "created_at": "2021-08-16T20:11:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521891",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8223127e18030e663830e60b04c61f8d8f737f2d"><code>8223127</code></a></td><td><code>src/sage/symbolic/ginac/utils.h: Fixup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/add5e891706dd779b6129cea0e8dc175c3c48054"><code>add5e89</code></a></td><td><code>src/sage/symbolic/ginac/utils.cpp: Fixup removal of version.h</code></td></tr></table>




---

archive/issue_comments_521892.json:
```json
{
    "body": "Changed commit from **[`fc29c1d`](https://github.com/sagemath/sagetrac-mirror/commit/fc29c1de46013777a5e4e2b592b9e0e0cf3e21d0)** to **[`add5e89`](https://github.com/sagemath/sagetrac-mirror/commit/add5e891706dd779b6129cea0e8dc175c3c48054)**",
    "created_at": "2021-08-16T20:11:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521892",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fc29c1d`](https://github.com/sagemath/sagetrac-mirror/commit/fc29c1de46013777a5e4e2b592b9e0e0cf3e21d0)** to **[`add5e89`](https://github.com/sagemath/sagetrac-mirror/commit/add5e891706dd779b6129cea0e8dc175c3c48054)**



---

archive/issue_events_443493.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-16T20:17:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443493"
}
```



---

archive/issue_comments_521893.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n Pynac has no other uses than as the core of the symbolic expressions facility of Sage; and cannot even be tested without Sage.\n \n-We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC.\n+We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC. (The existing Python/Cython symbolics code in `sage.symbolic`, `sage.calculus`, `sage.functions` is about 60kLOC.)\n \n This will solve the same issues that #30534 tried to address, which ran into unresolved technical difficulties.\n \n``````\n",
    "created_at": "2021-08-16T20:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521893",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 Pynac has no other uses than as the core of the symbolic expressions facility of Sage; and cannot even be tested without Sage.
 
-We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC.
+We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC. (The existing Python/Cython symbolics code in `sage.symbolic`, `sage.calculus`, `sage.functions` is about 60kLOC.)
 
 This will solve the same issues that #30534 tried to address, which ran into unresolved technical difficulties.
 
``````




---

archive/issue_comments_521894.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThis mostly works but I'm getting a few timeouts/crashes that I'm not sure about\n\n```\nsage -t --random-seed=0 src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out\nsage -t --random-seed=0 src/sage/manifolds/differentiable/degenerate_submanifold.py  # 1 doctest failed\nsage -t --random-seed=0 src/sage/manifolds/differentiable/tensorfield.py  # Timed out\nsage -t --random-seed=0 src/sage/plot/plot3d/parametric_plot3d.py  # Timed out\nsage -t --random-seed=0 src/sage/plot/plot3d/plot3d.py  # Timed out\nsage -t --random-seed=0 src/sage/plot/plot3d/base.pyx  # Timed out\nsage -t --random-seed=0 src/sage/plot/plot3d/implicit_plot3d.py  # Timed out\nsage -t --random-seed=0 src/sage/symbolic/relation.py  # Timed out\nsage -t --random-seed=0 src/sage/symbolic/expression.pyx  # Killed due to illegal instruction\nsage -t --random-seed=0 src/sage/symbolic/pynac_constant.pyx  # 18 doctests failed\n```",
    "created_at": "2021-08-16T21:06:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521894",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

This mostly works but I'm getting a few timeouts/crashes that I'm not sure about

```
sage -t --random-seed=0 src/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out
sage -t --random-seed=0 src/sage/manifolds/differentiable/degenerate_submanifold.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/manifolds/differentiable/tensorfield.py  # Timed out
sage -t --random-seed=0 src/sage/plot/plot3d/parametric_plot3d.py  # Timed out
sage -t --random-seed=0 src/sage/plot/plot3d/plot3d.py  # Timed out
sage -t --random-seed=0 src/sage/plot/plot3d/base.pyx  # Timed out
sage -t --random-seed=0 src/sage/plot/plot3d/implicit_plot3d.py  # Timed out
sage -t --random-seed=0 src/sage/symbolic/relation.py  # Timed out
sage -t --random-seed=0 src/sage/symbolic/expression.pyx  # Killed due to illegal instruction
sage -t --random-seed=0 src/sage/symbolic/pynac_constant.pyx  # 18 doctests failed
```



---

archive/issue_comments_521895.json:
```json
{
    "body": "Changed commit from **[`add5e89`](https://github.com/sagemath/sagetrac-mirror/commit/add5e891706dd779b6129cea0e8dc175c3c48054)** to **[`d9a1420`](https://github.com/sagemath/sagetrac-mirror/commit/d9a14207300cc7baece7289cf309e7db1bfdebe1)**",
    "created_at": "2021-08-16T21:13:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521895",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`add5e89`](https://github.com/sagemath/sagetrac-mirror/commit/add5e891706dd779b6129cea0e8dc175c3c48054)** to **[`d9a1420`](https://github.com/sagemath/sagetrac-mirror/commit/d9a14207300cc7baece7289cf309e7db1bfdebe1)**



---

archive/issue_comments_521896.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9a14207300cc7baece7289cf309e7db1bfdebe1\"><code>d9a1420</code></a></td><td><code>src/sage/symbolic/pynac_constant.pyx: Fix imports in doctests</code></td></tr></table>\n",
    "created_at": "2021-08-16T21:13:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521896",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9a14207300cc7baece7289cf309e7db1bfdebe1"><code>d9a1420</code></a></td><td><code>src/sage/symbolic/pynac_constant.pyx: Fix imports in doctests</code></td></tr></table>




---

archive/issue_comments_521897.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe crash is from this doctest:\n\n```\n>>> m = var('m')\n>>> assume(m, 'integer')\n>>> (I**m).real_part()\n```\nwhich seems to lead to an infinite recursion through `GiNaC::power::real_part()`",
    "created_at": "2021-08-16T21:39:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521897",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

The crash is from this doctest:

```
>>> m = var('m')
>>> assume(m, 'integer')
>>> (I**m).real_part()
```
which seems to lead to an infinite recursion through `GiNaC::power::real_part()`



---

archive/issue_comments_521898.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOh, this is #28357 and I forgot to apply `realpartloop.patch`",
    "created_at": "2021-08-16T21:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521898",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Oh, this is #28357 and I forgot to apply `realpartloop.patch`



---

archive/issue_comments_521899.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc0d5f379151013fdcfd942fc0fea030feb11456\"><code>bc0d5f3</code></a></td><td><code>Trac #28357: patch power::real_part</code></td></tr></table>\n",
    "created_at": "2021-08-16T21:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521899",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc0d5f379151013fdcfd942fc0fea030feb11456"><code>bc0d5f3</code></a></td><td><code>Trac #28357: patch power::real_part</code></td></tr></table>




---

archive/issue_comments_521900.json:
```json
{
    "body": "Changed commit from **[`d9a1420`](https://github.com/sagemath/sagetrac-mirror/commit/d9a14207300cc7baece7289cf309e7db1bfdebe1)** to **[`bc0d5f3`](https://github.com/sagemath/sagetrac-mirror/commit/bc0d5f379151013fdcfd942fc0fea030feb11456)**",
    "created_at": "2021-08-16T21:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521900",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d9a1420`](https://github.com/sagemath/sagetrac-mirror/commit/d9a14207300cc7baece7289cf309e7db1bfdebe1)** to **[`bc0d5f3`](https://github.com/sagemath/sagetrac-mirror/commit/bc0d5f379151013fdcfd942fc0fea030feb11456)**



---

archive/issue_comments_521901.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReady for testing and review. (I think the patchbot will not run because `build/pkgs/pynac/` is removed by the ticket.)",
    "created_at": "2021-08-16T22:11:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521901",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Ready for testing and review. (I think the patchbot will not run because `build/pkgs/pynac/` is removed by the ticket.)



---

archive/issue_comments_521902.json:
```json
{
    "body": "Changed commit from **[`bc0d5f3`](https://github.com/sagemath/sagetrac-mirror/commit/bc0d5f379151013fdcfd942fc0fea030feb11456)** to **[`881e21b`](https://github.com/sagemath/sagetrac-mirror/commit/881e21ba0f445e4e257c72c4415894023cab7826)**",
    "created_at": "2021-08-16T22:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521902",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bc0d5f3`](https://github.com/sagemath/sagetrac-mirror/commit/bc0d5f379151013fdcfd942fc0fea030feb11456)** to **[`881e21b`](https://github.com/sagemath/sagetrac-mirror/commit/881e21ba0f445e4e257c72c4415894023cab7826)**



---

archive/issue_comments_521903.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/881e21ba0f445e4e257c72c4415894023cab7826\"><code>881e21b</code></a></td><td><code>.gitignore: Unignore ginac cpp sources</code></td></tr></table>\n",
    "created_at": "2021-08-16T22:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521903",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/881e21ba0f445e4e257c72c4415894023cab7826"><code>881e21b</code></a></td><td><code>.gitignore: Unignore ginac cpp sources</code></td></tr></table>




---

archive/issue_comments_521904.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@mkoeppe](#comment:19):\n> Ready for testing and review. (I think the patchbot will not run because `build/pkgs/pynac/` is removed by the ticket.)\n\nThat's a bit inconvenient. Such a massive change needs all the bot runs it can get.",
    "created_at": "2021-08-16T22:20:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521904",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@mkoeppe](#comment:19):
> Ready for testing and review. (I think the patchbot will not run because `build/pkgs/pynac/` is removed by the ticket.)

That's a bit inconvenient. Such a massive change needs all the bot runs it can get.



---

archive/issue_comments_521905.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI can of course move the pynac removal to a follow-up ticket",
    "created_at": "2021-08-16T22:28:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521905",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

I can of course move the pynac removal to a follow-up ticket



---

archive/issue_comments_521906.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c1fd8d21947f72684ba4b963db683db5cd6ce07\"><code>8c1fd8d</code></a></td><td><code>.gitignore: Unignore ginac cpp sources</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8c3f53fb8203ba1aab19cfda0fb078d0843e426\"><code>c8c3f53</code></a></td><td><code>Trac #28357: patch power::real_part</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1177244cf20d76b2d3aaa8d673a9cc3e3ebd2a9\"><code>e117724</code></a></td><td><code>Move stuff from sage.libs.pynac to sage.symbolic.ginac, leaving some deprecated reimports behind</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e166523e4afb34e42e3c02bc75325f1e0a40937a\"><code>e166523</code></a></td><td><code>src/sage/symbolic/ginac/version.h.in: Remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e428de14e6009c8204f0347733bc0245f50bf62\"><code>3e428de</code></a></td><td><code>src/sage/symbolic/ginac/pynac-config.h: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dec1c4052644d6a311856418e92d16130f73e9cc\"><code>dec1c40</code></a></td><td><code>src/sage/symbolic/ginac/utils.h, pynac-config.h: Eliminate use of PYNAC_SIZEOF_LONG, PYNAC_SIZEOF_LONG_LONG</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17d6d2d5e8cb021481d4a4b1d483d924097e504b\"><code>17d6d2d</code></a></td><td><code>src/sage/symbolic/pynac_constant.pyx: Fix imports in doctests</code></td></tr></table>\n",
    "created_at": "2021-08-16T22:32:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521906",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c1fd8d21947f72684ba4b963db683db5cd6ce07"><code>8c1fd8d</code></a></td><td><code>.gitignore: Unignore ginac cpp sources</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8c3f53fb8203ba1aab19cfda0fb078d0843e426"><code>c8c3f53</code></a></td><td><code>Trac #28357: patch power::real_part</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1177244cf20d76b2d3aaa8d673a9cc3e3ebd2a9"><code>e117724</code></a></td><td><code>Move stuff from sage.libs.pynac to sage.symbolic.ginac, leaving some deprecated reimports behind</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e166523e4afb34e42e3c02bc75325f1e0a40937a"><code>e166523</code></a></td><td><code>src/sage/symbolic/ginac/version.h.in: Remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e428de14e6009c8204f0347733bc0245f50bf62"><code>3e428de</code></a></td><td><code>src/sage/symbolic/ginac/pynac-config.h: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dec1c4052644d6a311856418e92d16130f73e9cc"><code>dec1c40</code></a></td><td><code>src/sage/symbolic/ginac/utils.h, pynac-config.h: Eliminate use of PYNAC_SIZEOF_LONG, PYNAC_SIZEOF_LONG_LONG</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17d6d2d5e8cb021481d4a4b1d483d924097e504b"><code>17d6d2d</code></a></td><td><code>src/sage/symbolic/pynac_constant.pyx: Fix imports in doctests</code></td></tr></table>




---

archive/issue_comments_521907.json:
```json
{
    "body": "Changed commit from **[`881e21b`](https://github.com/sagemath/sagetrac-mirror/commit/881e21ba0f445e4e257c72c4415894023cab7826)** to **[`17d6d2d`](https://github.com/sagemath/sagetrac-mirror/commit/17d6d2d5e8cb021481d4a4b1d483d924097e504b)**",
    "created_at": "2021-08-16T22:32:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521907",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`881e21b`](https://github.com/sagemath/sagetrac-mirror/commit/881e21ba0f445e4e257c72c4415894023cab7826)** to **[`17d6d2d`](https://github.com/sagemath/sagetrac-mirror/commit/17d6d2d5e8cb021481d4a4b1d483d924097e504b)**



---

archive/issue_comments_521908.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,5 +8,5 @@\n \n It will also make it easier for Sage developers to make changes to Pynac.\n \n+Follow-up: #32387 Remove pynac spkg\n \n-\n``````\n",
    "created_at": "2021-08-16T22:33:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521908",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,5 +8,5 @@
 
 It will also make it easier for Sage developers to make changes to Pynac.
 
+Follow-up: #32387 Remove pynac spkg
 
-
``````




---

archive/issue_comments_521909.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nMy previous tests were on macOS. On Linux this fails with \n\n```\n  File \"sage/symbolic/pynac.pyx\", line 1, in init sage.symbolic.pynac (build/cythonized/sage/symbolic/pynac.cpp:31348)\nImportError: /home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/symbolic/expression.cpython-37m-x86_64-linux-gnu.so: undefined symbol: _ZTIN5GiNaC5basicE\n```\n(as reported by a patchbot; also verified using `tox -e docker-ubuntu-focal-standard`)",
    "created_at": "2021-08-17T00:16:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521909",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

My previous tests were on macOS. On Linux this fails with 

```
  File "sage/symbolic/pynac.pyx", line 1, in init sage.symbolic.pynac (build/cythonized/sage/symbolic/pynac.cpp:31348)
ImportError: /home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/symbolic/expression.cpython-37m-x86_64-linux-gnu.so: undefined symbol: _ZTIN5GiNaC5basicE
```
(as reported by a patchbot; also verified using `tox -e docker-ubuntu-focal-standard`)



---

archive/issue_events_443494.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-17T00:16:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443494"
}
```



---

archive/issue_events_443495.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-17T00:16:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443495"
}
```



---

archive/issue_comments_521910.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e17a4b47fdd1209ebe4046bbab20e1631810779\"><code>9e17a4b</code></a></td><td><code>src/sage/symbolic/pynac_wrap.h: Clean up #include</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3355234a8d74da9413d18c44dd987897d05ed0fe\"><code>3355234</code></a></td><td><code>Replace 'from sage.symbolic.pynac cimport *' by more specific cimports</code></td></tr></table>\n",
    "created_at": "2021-08-17T01:42:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521910",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e17a4b47fdd1209ebe4046bbab20e1631810779"><code>9e17a4b</code></a></td><td><code>src/sage/symbolic/pynac_wrap.h: Clean up #include</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3355234a8d74da9413d18c44dd987897d05ed0fe"><code>3355234</code></a></td><td><code>Replace 'from sage.symbolic.pynac cimport *' by more specific cimports</code></td></tr></table>




---

archive/issue_comments_521911.json:
```json
{
    "body": "Changed commit from **[`17d6d2d`](https://github.com/sagemath/sagetrac-mirror/commit/17d6d2d5e8cb021481d4a4b1d483d924097e504b)** to **[`3355234`](https://github.com/sagemath/sagetrac-mirror/commit/3355234a8d74da9413d18c44dd987897d05ed0fe)**",
    "created_at": "2021-08-17T01:42:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521911",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`17d6d2d`](https://github.com/sagemath/sagetrac-mirror/commit/17d6d2d5e8cb021481d4a4b1d483d924097e504b)** to **[`3355234`](https://github.com/sagemath/sagetrac-mirror/commit/3355234a8d74da9413d18c44dd987897d05ed0fe)**



---

archive/issue_comments_521912.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThis problem with linking can likely be solved by merging all *.pyx files that `cimport` from `sage.symbolic.pynac` into one (taking care of the ones in `ring.pyx` by refactoring)\n\n```\n$ git grep pynac.*cimport\nsrc/sage/symbolic/comparison.pyx:from sage.symbolic.pynac cimport (\nsrc/sage/symbolic/expression.pxd:from sage.symbolic.pynac cimport GEx\nsrc/sage/symbolic/expression.pyx:from sage.symbolic.pynac cimport *\nsrc/sage/symbolic/function.pyx:from sage.symbolic.pynac cimport (\nsrc/sage/symbolic/getitem.pyx:from sage.symbolic.pynac cimport GEx\nsrc/sage/symbolic/pynac.pyx:from .pynac_constant cimport PynacConstant\nsrc/sage/symbolic/pynac_constant.pxd:from .pynac cimport GConstant\nsrc/sage/symbolic/pynac_constant.pyx:from .pynac cimport (\nsrc/sage/symbolic/ring.pyx:from sage.symbolic.pynac cimport (GEx, GExprSeq, GExVector, GSymbol,\nsrc/sage/symbolic/series.pyx:from sage.symbolic.pynac cimport GEx, g_is_a_terminating_series, g_series_var, series_to_poly\nsrc/sage/symbolic/substitution_map.pxd:from sage.symbolic.pynac cimport GExMap\nsrc/sage/symbolic/substitution_map.pyx:from sage.symbolic.pynac cimport make_pair, GEx, GExPair\n```\nI don't know if there's a better solution.",
    "created_at": "2021-08-17T01:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521912",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

This problem with linking can likely be solved by merging all *.pyx files that `cimport` from `sage.symbolic.pynac` into one (taking care of the ones in `ring.pyx` by refactoring)

```
$ git grep pynac.*cimport
src/sage/symbolic/comparison.pyx:from sage.symbolic.pynac cimport (
src/sage/symbolic/expression.pxd:from sage.symbolic.pynac cimport GEx
src/sage/symbolic/expression.pyx:from sage.symbolic.pynac cimport *
src/sage/symbolic/function.pyx:from sage.symbolic.pynac cimport (
src/sage/symbolic/getitem.pyx:from sage.symbolic.pynac cimport GEx
src/sage/symbolic/pynac.pyx:from .pynac_constant cimport PynacConstant
src/sage/symbolic/pynac_constant.pxd:from .pynac cimport GConstant
src/sage/symbolic/pynac_constant.pyx:from .pynac cimport (
src/sage/symbolic/ring.pyx:from sage.symbolic.pynac cimport (GEx, GExprSeq, GExVector, GSymbol,
src/sage/symbolic/series.pyx:from sage.symbolic.pynac cimport GEx, g_is_a_terminating_series, g_series_var, series_to_poly
src/sage/symbolic/substitution_map.pxd:from sage.symbolic.pynac cimport GExMap
src/sage/symbolic/substitution_map.pyx:from sage.symbolic.pynac cimport make_pair, GEx, GExPair
```
I don't know if there's a better solution.



---

archive/issue_comments_521913.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI will take a look, if I can resolve this.",
    "created_at": "2021-08-17T07:56:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521913",
    "user": "https://github.com/kliem"
}
```

<div id="comment:28" align="right">comment:28</div>

I will take a look, if I can resolve this.



---

archive/issue_comments_521914.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01dfef3756a4da5fc01355f10954dea69fbf01f6\"><code>01dfef3</code></a></td><td><code>missing headers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04397d2e547f0a81c727165d9e9fee0d54b3ee6d\"><code>04397d2</code></a></td><td><code>add missing singular libraries</code></td></tr></table>\n",
    "created_at": "2021-08-17T10:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521914",
    "user": "https://github.com/kliem"
}
```

<div id="comment:29"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01dfef3756a4da5fc01355f10954dea69fbf01f6"><code>01dfef3</code></a></td><td><code>missing headers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04397d2e547f0a81c727165d9e9fee0d54b3ee6d"><code>04397d2</code></a></td><td><code>add missing singular libraries</code></td></tr></table>




---

archive/issue_comments_521915.json:
```json
{
    "body": "Changed commit from **[`3355234`](https://github.com/sagemath/sagetrac-mirror/commit/3355234a8d74da9413d18c44dd987897d05ed0fe)** to **[`04397d2`](https://github.com/sagemath/sagetrac-mirror/commit/04397d2e547f0a81c727165d9e9fee0d54b3ee6d)**",
    "created_at": "2021-08-17T10:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521915",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`3355234`](https://github.com/sagemath/sagetrac-mirror/commit/3355234a8d74da9413d18c44dd987897d05ed0fe)** to **[`04397d2`](https://github.com/sagemath/sagetrac-mirror/commit/04397d2e547f0a81c727165d9e9fee0d54b3ee6d)**



---

archive/issue_comments_521916.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-17T10:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521916",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521917.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6\"><code>70bcddf</code></a></td><td><code>simpler inclusion of headers</code></td></tr></table>\n",
    "created_at": "2021-08-17T13:40:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521917",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6"><code>70bcddf</code></a></td><td><code>simpler inclusion of headers</code></td></tr></table>




---

archive/issue_comments_521918.json:
```json
{
    "body": "Changed commit from **[`04397d2`](https://github.com/sagemath/sagetrac-mirror/commit/04397d2e547f0a81c727165d9e9fee0d54b3ee6d)** to **[`70bcddf`](https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6)**",
    "created_at": "2021-08-17T13:40:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521918",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`04397d2`](https://github.com/sagemath/sagetrac-mirror/commit/04397d2e547f0a81c727165d9e9fee0d54b3ee6d)** to **[`70bcddf`](https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6)**



---

archive/issue_comments_521919.json:
```json
{
    "body": "Changed commit from **[`70bcddf`](https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6)** to **[`7ce050f`](https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf)**",
    "created_at": "2021-08-17T15:04:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521919",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`70bcddf`](https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6)** to **[`7ce050f`](https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf)**



---

archive/issue_comments_521920.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf\"><code>7ce050f</code></a></td><td><code>somewhat fix doctest</code></td></tr></table>\n",
    "created_at": "2021-08-17T15:04:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521920",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf"><code>7ce050f</code></a></td><td><code>somewhat fix doctest</code></td></tr></table>




---

archive/issue_comments_521921.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI basically have this working by specifying:\n\n```diff\ndiff --git a/src/sage/symbolic/series.pyx b/src/sage/symbolic/series.pyx\nindex 0e395ae4b4..d93cccc50b 100644\n--- a/src/sage/symbolic/series.pyx\n+++ b/src/sage/symbolic/series.pyx\n@@ -1,3 +1,4 @@\n+# distutils: extra_link_args = /srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/symbolic/pynac.cpython-37m-x86_64-linux-gnu.so\n \"\"\"\n Symbolic Series\n```\n\nto all of those files (and the one doctest in `sage/symbolic/pynac.pxd` that raises an `ImportError` currently).\n\nSo this is basically working, but the correct linking is missing.\n\nWe could create an extra file `sage/symbolic/linked_pynac.pxd`, which just consists of\n\n```\n# distutils: extra_link_args = ...\nfrom sage.symbolic/pynac cimport *\n```\n\nthen there is no need to specify this extra distutils thing in every file that cimports pynac.",
    "created_at": "2021-08-17T15:11:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521921",
    "user": "https://github.com/kliem"
}
```

<div id="comment:32" align="right">comment:32</div>

I basically have this working by specifying:

```diff
diff --git a/src/sage/symbolic/series.pyx b/src/sage/symbolic/series.pyx
index 0e395ae4b4..d93cccc50b 100644
--- a/src/sage/symbolic/series.pyx
+++ b/src/sage/symbolic/series.pyx
@@ -1,3 +1,4 @@
+# distutils: extra_link_args = /srv/public/kliem/sage/local/lib/python3.7/site-packages/sage/symbolic/pynac.cpython-37m-x86_64-linux-gnu.so
 """
 Symbolic Series
```

to all of those files (and the one doctest in `sage/symbolic/pynac.pxd` that raises an `ImportError` currently).

So this is basically working, but the correct linking is missing.

We could create an extra file `sage/symbolic/linked_pynac.pxd`, which just consists of

```
# distutils: extra_link_args = ...
from sage.symbolic/pynac cimport *
```

then there is no need to specify this extra distutils thing in every file that cimports pynac.



---

archive/issue_comments_521922.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nOnce more thing: The headers in `pkgs/sagemath-standard/build/cythonized/` are not cleaned up. Can this be fixed somehow or is this just going to stay this way? (This is probably the reason, why you did not notice the missing headers that were fixed in ||[01dfef3](https://github.com/sagemath/sagetrac-mirror/commit/01dfef3756a4da5fc01355f10954dea69fbf01f6)||`missing headers`||",
    "created_at": "2021-08-17T15:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521922",
    "user": "https://github.com/kliem"
}
```

<div id="comment:33" align="right">comment:33</div>

Once more thing: The headers in `pkgs/sagemath-standard/build/cythonized/` are not cleaned up. Can this be fixed somehow or is this just going to stay this way? (This is probably the reason, why you did not notice the missing headers that were fixed in ||[01dfef3](https://github.com/sagemath/sagetrac-mirror/commit/01dfef3756a4da5fc01355f10954dea69fbf01f6)||`missing headers`||



---

archive/issue_comments_521923.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI don't like the change https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6 (simpler inclusion of headers); putting stuff in the include search path can lead to shadowing headers of other libraries",
    "created_at": "2021-08-17T17:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521923",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

I don't like the change https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6 (simpler inclusion of headers); putting stuff in the include search path can lead to shadowing headers of other libraries



---

archive/issue_comments_521924.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThanks for the investigation and fixes.\n\nI think I would be reluctant to use the `extra_link_args` workaround -- it will requires changes to the build system because now building one extension module would depend on another extension module.\n\nIn any case, I'd think that your successful experiment indicates the approach of merging everything that needs to `cimport` stuff from ginac/ into one extension module would work.",
    "created_at": "2021-08-17T17:54:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521924",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Thanks for the investigation and fixes.

I think I would be reluctant to use the `extra_link_args` workaround -- it will requires changes to the build system because now building one extension module would depend on another extension module.

In any case, I'd think that your successful experiment indicates the approach of merging everything that needs to `cimport` stuff from ginac/ into one extension module would work.



---

archive/issue_comments_521925.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@kliem](#comment:33):\n> Once more thing: The headers in `pkgs/sagemath-standard/build/cythonized/` are not cleaned up. \n\nDo we already have a ticket for this? If not, please open one\n\nHowever, I think we should move away from the custom build system of Sage. I have opened #32390 for the next step in this.",
    "created_at": "2021-08-17T18:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521925",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@kliem](#comment:33):
> Once more thing: The headers in `pkgs/sagemath-standard/build/cythonized/` are not cleaned up. 

Do we already have a ticket for this? If not, please open one

However, I think we should move away from the custom build system of Sage. I have opened #32390 for the next step in this.



---

archive/issue_comments_521926.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@mkoeppe](#comment:27):\n> This problem with linking can likely be solved by merging all *.pyx files that `cimport` from `sage.symbolic.pynac` into one (taking care of the ones in `ring.pyx` by refactoring)\n\nFor cleaning up `ring.pyx`, I have opened #32391.",
    "created_at": "2021-08-17T18:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521926",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@mkoeppe](#comment:27):
> This problem with linking can likely be solved by merging all *.pyx files that `cimport` from `sage.symbolic.pynac` into one (taking care of the ones in `ring.pyx` by refactoring)

For cleaning up `ring.pyx`, I have opened #32391.



---

archive/issue_comments_521927.json:
```json
{
    "body": "Dependencies: **#32391**",
    "created_at": "2021-08-17T18:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521927",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#32391**



---

archive/issue_comments_521928.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@mkoeppe](#comment:37):\n> Replying to [@mkoeppe](#comment:27):\n> > This problem with linking can likely be solved by merging all *.pyx files that `cimport` from `sage.symbolic.pynac` into one (taking care of the ones in `ring.pyx` by refactoring)\n\n> \n> For cleaning up `ring.pyx`, I have opened #32391.\n\nWe would still lose ability to use it directly in cython at all. E.g. the doctest in `pynac.pxd` would fail.\n\nAt the moment, I'm building this branch with `./configure --enable-editable` and will report whether this resolves anything.",
    "created_at": "2021-08-17T18:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521928",
    "user": "https://github.com/kliem"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@mkoeppe](#comment:37):
> Replying to [@mkoeppe](#comment:27):
> > This problem with linking can likely be solved by merging all *.pyx files that `cimport` from `sage.symbolic.pynac` into one (taking care of the ones in `ring.pyx` by refactoring)

> 
> For cleaning up `ring.pyx`, I have opened #32391.

We would still lose ability to use it directly in cython at all. E.g. the doctest in `pynac.pxd` would fail.

At the moment, I'm building this branch with `./configure --enable-editable` and will report whether this resolves anything.



---

archive/issue_comments_521929.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@mkoeppe](#comment:34):\n> I don't like the change https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6 (simpler inclusion of headers); putting stuff in the include search path can lead to shadowing headers of other libraries\n\n`from ... cimport ...` should usually just work out of the box. But of course one can also spell out all those header (e.g. with a cython alias).\n\nThen again, if we decide to put it all into one large `pyx` and not cimport things from `ginac` directly, the commit isn't necessary at all.",
    "created_at": "2021-08-17T18:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521929",
    "user": "https://github.com/kliem"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@mkoeppe](#comment:34):
> I don't like the change https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6 (simpler inclusion of headers); putting stuff in the include search path can lead to shadowing headers of other libraries

`from ... cimport ...` should usually just work out of the box. But of course one can also spell out all those header (e.g. with a cython alias).

Then again, if we decide to put it all into one large `pyx` and not cimport things from `ginac` directly, the commit isn't necessary at all.



---

archive/issue_comments_521930.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@kliem](#comment:38):\n> Replying to [@mkoeppe](#comment:37):\n> > Replying to [@mkoeppe](#comment:27):\n> > > This problem with linking can likely be solved by merging all *.pyx files that `cimport` from `sage.symbolic.pynac` into one (taking care of the ones in `ring.pyx` by refactoring)\n\n> > \n> > For cleaning up `ring.pyx`, I have opened #32391.\n\n> \n> We would still lose ability to use it directly in cython at all. E.g. the doctest in `pynac.pxd` would fail.\n\nI wouldn't be too concerned about this. I'd be surprised if there's any user code in the wild that does that; and if at all necessary, it can be mitigated by adding some missing methods at a higher level.",
    "created_at": "2021-08-17T19:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521930",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@kliem](#comment:38):
> Replying to [@mkoeppe](#comment:37):
> > Replying to [@mkoeppe](#comment:27):
> > > This problem with linking can likely be solved by merging all *.pyx files that `cimport` from `sage.symbolic.pynac` into one (taking care of the ones in `ring.pyx` by refactoring)

> > 
> > For cleaning up `ring.pyx`, I have opened #32391.

> 
> We would still lose ability to use it directly in cython at all. E.g. the doctest in `pynac.pxd` would fail.

I wouldn't be too concerned about this. I'd be surprised if there's any user code in the wild that does that; and if at all necessary, it can be mitigated by adding some missing methods at a higher level.



---

archive/issue_comments_521931.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nOk, same problem with `./configure --enable-editable`.\n\nBtw, this is exactly our problem and there is no proper solution to it. So instead of adding a custom one, I agree that it would be easier, to move all the `cdef extern from ...` into one large `pyx` and only `cimport` the cython wrappers. This is the way, your meant to do it anyway.",
    "created_at": "2021-08-17T19:03:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521931",
    "user": "https://github.com/kliem"
}
```

<div id="comment:41" align="right">comment:41</div>

Ok, same problem with `./configure --enable-editable`.

Btw, this is exactly our problem and there is no proper solution to it. So instead of adding a custom one, I agree that it would be easier, to move all the `cdef extern from ...` into one large `pyx` and only `cimport` the cython wrappers. This is the way, your meant to do it anyway.



---

archive/issue_comments_521932.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nA simple way of doing this might be to rename files like `series.pxd` to `series.pxi` and `series.pyx` to `series_impl.pxi` and then to `include` them into the target extension module (`pynac.pxd`, `pynac.pyx`?)",
    "created_at": "2021-08-17T19:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521932",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

A simple way of doing this might be to rename files like `series.pxd` to `series.pxi` and `series.pyx` to `series_impl.pxi` and then to `include` them into the target extension module (`pynac.pxd`, `pynac.pyx`?)



---

archive/issue_comments_521933.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nUsing `pxi` is outdated, I was told. But maybe using something outdated is more desirable than having huge files.",
    "created_at": "2021-08-17T19:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521933",
    "user": "https://github.com/kliem"
}
```

<div id="comment:43" align="right">comment:43</div>

Using `pxi` is outdated, I was told. But maybe using something outdated is more desirable than having huge files.



---

archive/issue_comments_521934.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThat's probably just from the warning at https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html?highlight=include#the-include-statement-and-include-files; but if I'm not mistaken, this just refers to a particular use case of \"pxi\" that was superseded by \"pxd\". I don't see any indication that the mechanism of `include` is intended to be removed in Cython.",
    "created_at": "2021-08-17T19:25:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521934",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

That's probably just from the warning at https://cython.readthedocs.io/en/latest/src/userguide/language_basics.html?highlight=include#the-include-statement-and-include-files; but if I'm not mistaken, this just refers to a particular use case of "pxi" that was superseded by "pxd". I don't see any indication that the mechanism of `include` is intended to be removed in Cython.



---

archive/issue_comments_521935.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-17T20:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521935",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521936.json:
```json
{
    "body": "Changed commit from **[`7ce050f`](https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf)** to **[`188714b`](https://github.com/sagemath/sagetrac-mirror/commit/188714b3bb4f953e1fb56c2841899e1e946d5900)**",
    "created_at": "2021-08-17T20:04:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521936",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`7ce050f`](https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf)** to **[`188714b`](https://github.com/sagemath/sagetrac-mirror/commit/188714b3bb4f953e1fb56c2841899e1e946d5900)**



---

archive/issue_comments_521937.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nIt would look like this (currently does not compile because I haven't done the changes to `ring.pyx`)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f76b222a2bccd440922e9f3a777fcf7effe5e17\"><code>1f76b22</code></a></td><td><code>missing headers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff21838dcdd034ec94e24259f547c3b2752911f6\"><code>ff21838</code></a></td><td><code>add missing singular libraries</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/188714b3bb4f953e1fb56c2841899e1e946d5900\"><code>188714b</code></a></td><td><code>sage.symbolic: Change extension modules cimporting from pynac to pxi files included in sage.symbolic.pynac</code></td></tr></table>\n",
    "created_at": "2021-08-17T20:04:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521937",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

It would look like this (currently does not compile because I haven't done the changes to `ring.pyx`)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f76b222a2bccd440922e9f3a777fcf7effe5e17"><code>1f76b22</code></a></td><td><code>missing headers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff21838dcdd034ec94e24259f547c3b2752911f6"><code>ff21838</code></a></td><td><code>add missing singular libraries</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/188714b3bb4f953e1fb56c2841899e1e946d5900"><code>188714b</code></a></td><td><code>sage.symbolic: Change extension modules cimporting from pynac to pxi files included in sage.symbolic.pynac</code></td></tr></table>




---

archive/issue_comments_521938.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\n(cherry-picked some of your changes onto this branch)",
    "created_at": "2021-08-17T20:06:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521938",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

(cherry-picked some of your changes onto this branch)



---

archive/issue_comments_521939.json:
```json
{
    "body": "Changed commit from **[`188714b`](https://github.com/sagemath/sagetrac-mirror/commit/188714b3bb4f953e1fb56c2841899e1e946d5900)** to **[`57ff18a`](https://github.com/sagemath/sagetrac-mirror/commit/57ff18ac158d3c2541332652314aab9cdfa9d900)**",
    "created_at": "2021-08-17T21:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521939",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`188714b`](https://github.com/sagemath/sagetrac-mirror/commit/188714b3bb4f953e1fb56c2841899e1e946d5900)** to **[`57ff18a`](https://github.com/sagemath/sagetrac-mirror/commit/57ff18ac158d3c2541332652314aab9cdfa9d900)**



---

archive/issue_comments_521940.json:
```json
{
    "body": "<div id=\"comment:48\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57ff18ac158d3c2541332652314aab9cdfa9d900\"><code>57ff18a</code></a></td><td><code>Make sage.symbolic.expression the extension module that includes pynac</code></td></tr></table>\n",
    "created_at": "2021-08-17T21:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521940",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57ff18ac158d3c2541332652314aab9cdfa9d900"><code>57ff18a</code></a></td><td><code>Make sage.symbolic.expression the extension module that includes pynac</code></td></tr></table>




---

archive/issue_comments_521941.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nor perhaps better like this.",
    "created_at": "2021-08-17T21:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521941",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">comment:49</div>

or perhaps better like this.



---

archive/issue_comments_521942.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a2ada278e567b7fafd06ce97cad895e1f323f95\"><code>6a2ada2</code></a></td><td><code>src/sage/symbolic/expression.pyx: Move 'distutils: sources' here</code></td></tr></table>\n",
    "created_at": "2021-08-18T00:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521942",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a2ada278e567b7fafd06ce97cad895e1f323f95"><code>6a2ada2</code></a></td><td><code>src/sage/symbolic/expression.pyx: Move 'distutils: sources' here</code></td></tr></table>




---

archive/issue_comments_521943.json:
```json
{
    "body": "Changed commit from **[`57ff18a`](https://github.com/sagemath/sagetrac-mirror/commit/57ff18ac158d3c2541332652314aab9cdfa9d900)** to **[`6a2ada2`](https://github.com/sagemath/sagetrac-mirror/commit/6a2ada278e567b7fafd06ce97cad895e1f323f95)**",
    "created_at": "2021-08-18T00:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521943",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`57ff18a`](https://github.com/sagemath/sagetrac-mirror/commit/57ff18ac158d3c2541332652314aab9cdfa9d900)** to **[`6a2ada2`](https://github.com/sagemath/sagetrac-mirror/commit/6a2ada278e567b7fafd06ce97cad895e1f323f95)**



---

archive/issue_comments_521944.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nForgive me for asking a na\u00efve question, but isn't this going against the modularization you are trying to have Sage do? I fully understand the reason for bringing it in (which should make it easier to bug-fix), but doesn't this make Sage more monolithic?",
    "created_at": "2021-08-18T04:19:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521944",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:51" align="right">comment:51</div>

Forgive me for asking a naïve question, but isn't this going against the modularization you are trying to have Sage do? I fully understand the reason for bringing it in (which should make it easier to bug-fix), but doesn't this make Sage more monolithic?



---

archive/issue_comments_521945.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@tscrim](#comment:51):\n> isn't this going against the modularization you are trying to have Sage do? I fully understand the reason for bringing it in (which should make it easier to bug-fix), but doesn't this make Sage more monolithic?\n\nThis is a natural question. \n\nThe pynac library just does not make sense as a module. It is the basis of the implementation of SR elements and as such there is no way to build Sage symbolics without it. \n\nIn the modularization plan of #29705, we would instead create a distribution package `sagemath-symbolics`, containing the integrated pynac from the present ticket and most of `sage.symbolic`, `sage.calculus`, `sage.functions`, and parts of `sage.interfaces`. This will make sense as a module because there are many parts of Sage that (fortunately!) do not depend at all on Sage symbolics, or only depend on it for some smaller features. For example, `sage.graphs` has 0 imports from `sage.symbolic`, `sage.combinat` just a handful, etc.",
    "created_at": "2021-08-18T17:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521945",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@tscrim](#comment:51):
> isn't this going against the modularization you are trying to have Sage do? I fully understand the reason for bringing it in (which should make it easier to bug-fix), but doesn't this make Sage more monolithic?

This is a natural question. 

The pynac library just does not make sense as a module. It is the basis of the implementation of SR elements and as such there is no way to build Sage symbolics without it. 

In the modularization plan of #29705, we would instead create a distribution package `sagemath-symbolics`, containing the integrated pynac from the present ticket and most of `sage.symbolic`, `sage.calculus`, `sage.functions`, and parts of `sage.interfaces`. This will make sense as a module because there are many parts of Sage that (fortunately!) do not depend at all on Sage symbolics, or only depend on it for some smaller features. For example, `sage.graphs` has 0 imports from `sage.symbolic`, `sage.combinat` just a handful, etc.



---

archive/issue_comments_521946.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nThank you for the explanation. So wouldn't it make sense to instead take the symbolics stuff out from Sage in one go rather than this two step process of add in pynac just to remove it later? Or is this just meant to be a stop-gap until it comes time to split everything?",
    "created_at": "2021-08-22T02:06:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521946",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:53" align="right">comment:53</div>

Thank you for the explanation. So wouldn't it make sense to instead take the symbolics stuff out from Sage in one go rather than this two step process of add in pynac just to remove it later? Or is this just meant to be a stop-gap until it comes time to split everything?



---

archive/issue_comments_521947.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@tscrim](#comment:53):\n> So wouldn't it make sense to instead take the symbolics stuff out from Sage in one go rather than this two step process of add in pynac just to remove it later? Or is this just meant to be a stop-gap until it comes time to split everything?\n\nThe modularization plan does not involve \"taking ... stuff out from Sage\" at all. It will all remain in the same git repository, and also `src/sage` will remain monolithic.\n\nModularization is achieved by preparing sub-distributions defined using one of several possible mechanisms. Take a look at `sagemath-objects` from #29865 (https://pypi.org/project/sagemath-objects/), for example: It defines a sub-distribution using a `MANIFEST` file. Via the Python 3 \"native namespace packages\" mechanism, (after some work in #31420, #28925), these distributions can be installed cleanly next to each other and provide the shared `sage.*` namespace.",
    "created_at": "2021-08-22T02:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521947",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@tscrim](#comment:53):
> So wouldn't it make sense to instead take the symbolics stuff out from Sage in one go rather than this two step process of add in pynac just to remove it later? Or is this just meant to be a stop-gap until it comes time to split everything?

The modularization plan does not involve "taking ... stuff out from Sage" at all. It will all remain in the same git repository, and also `src/sage` will remain monolithic.

Modularization is achieved by preparing sub-distributions defined using one of several possible mechanisms. Take a look at `sagemath-objects` from #29865 (https://pypi.org/project/sagemath-objects/), for example: It defines a sub-distribution using a `MANIFEST` file. Via the Python 3 "native namespace packages" mechanism, (after some work in #31420, #28925), these distributions can be installed cleanly next to each other and provide the shared `sage.*` namespace.



---

archive/issue_comments_521948.json:
```json
{
    "body": "Changed dependencies from **#32391** to **#32391, #32407**",
    "created_at": "2021-08-22T04:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521948",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#32391** to **#32391, #32407**



---

archive/issue_comments_521949.json:
```json
{
    "body": "Changed commit from **[`6a2ada2`](https://github.com/sagemath/sagetrac-mirror/commit/6a2ada278e567b7fafd06ce97cad895e1f323f95)** to **[`759aa5d`](https://github.com/sagemath/sagetrac-mirror/commit/759aa5d012d2ee2924456cb8df33514e351d2ffb)**",
    "created_at": "2021-08-22T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521949",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6a2ada2`](https://github.com/sagemath/sagetrac-mirror/commit/6a2ada278e567b7fafd06ce97cad895e1f323f95)** to **[`759aa5d`](https://github.com/sagemath/sagetrac-mirror/commit/759aa5d012d2ee2924456cb8df33514e351d2ffb)**



---

archive/issue_comments_521950.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef222579fae43a764bb65be8e8fc301be5c7cc35\"><code>ef22257</code></a></td><td><code>src/sage/symbolic/function.pyx: Undo rename</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ac54dfcb7d1ea7c4bc8cefabf93d18970c20bdb\"><code>4ac54df</code></a></td><td><code>src/sage/symbolic/function.pyx: Replace cimport * by more specific cimport</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f49aee1af2c5effbb4d916f56cbae216045230f\"><code>6f49aee</code></a></td><td><code>sage.symbolic.function.Function.__call__: Refactor through new helper function sage.symbolic.expression.call_by_ginac_serial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f92b908d3ba7086a2559810595ac958d57367a9\"><code>2f92b90</code></a></td><td><code>sage.symbolic.function.Function._register_function: Refactor through new function sage.symbolic.expression.register_or_update_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e81e6c71e7797b45ae8e96cec3bc9a9daac78475\"><code>e81e6c7</code></a></td><td><code>sage.symbolic.function.GinacFunction._register_function: Refactor through sage.symbolic.expression.register_or_update_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d397ef1ada43b7f7884c29ab8235dcaf5d53fdab\"><code>d397ef1</code></a></td><td><code>sage.symbolic.function: Remove unused imports, cimports</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c43dbe157de2231d77edf97a7e46babc4952822\"><code>1c43dbe</code></a></td><td><code>sage.symbolic.function.{GinacFunction,BuiltinFunction}._is_registered: Refactor through new function sage.symbolic.expression.find_registered_function; remove last pynac import</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d4fe5fec91a2da1f9504b5869167bcb3634379f\"><code>9d4fe5f</code></a></td><td><code>sage.symbolic.function: Remove unused cimport</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a9fdc750bc49f5e54cd04bdd0589bff32bb5b42\"><code>9a9fdc7</code></a></td><td><code>Merge #32407</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/759aa5d012d2ee2924456cb8df33514e351d2ffb\"><code>759aa5d</code></a></td><td><code>sage.symbolic.expression: Finish merging code using pynac into this one DSO</code></td></tr></table>\n",
    "created_at": "2021-08-22T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521950",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef222579fae43a764bb65be8e8fc301be5c7cc35"><code>ef22257</code></a></td><td><code>src/sage/symbolic/function.pyx: Undo rename</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ac54dfcb7d1ea7c4bc8cefabf93d18970c20bdb"><code>4ac54df</code></a></td><td><code>src/sage/symbolic/function.pyx: Replace cimport * by more specific cimport</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f49aee1af2c5effbb4d916f56cbae216045230f"><code>6f49aee</code></a></td><td><code>sage.symbolic.function.Function.__call__: Refactor through new helper function sage.symbolic.expression.call_by_ginac_serial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f92b908d3ba7086a2559810595ac958d57367a9"><code>2f92b90</code></a></td><td><code>sage.symbolic.function.Function._register_function: Refactor through new function sage.symbolic.expression.register_or_update_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e81e6c71e7797b45ae8e96cec3bc9a9daac78475"><code>e81e6c7</code></a></td><td><code>sage.symbolic.function.GinacFunction._register_function: Refactor through sage.symbolic.expression.register_or_update_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d397ef1ada43b7f7884c29ab8235dcaf5d53fdab"><code>d397ef1</code></a></td><td><code>sage.symbolic.function: Remove unused imports, cimports</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c43dbe157de2231d77edf97a7e46babc4952822"><code>1c43dbe</code></a></td><td><code>sage.symbolic.function.{GinacFunction,BuiltinFunction}._is_registered: Refactor through new function sage.symbolic.expression.find_registered_function; remove last pynac import</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d4fe5fec91a2da1f9504b5869167bcb3634379f"><code>9d4fe5f</code></a></td><td><code>sage.symbolic.function: Remove unused cimport</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a9fdc750bc49f5e54cd04bdd0589bff32bb5b42"><code>9a9fdc7</code></a></td><td><code>Merge #32407</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/759aa5d012d2ee2924456cb8df33514e351d2ffb"><code>759aa5d</code></a></td><td><code>sage.symbolic.expression: Finish merging code using pynac into this one DSO</code></td></tr></table>




---

archive/issue_comments_521951.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nIt remains to remove the import cycle `sage.symbolic.ring` -> `sage.symbolic.expression` -> `sage.symbolic.function` -> `sage.symbolic.ring`",
    "created_at": "2021-08-22T22:34:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521951",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">comment:57</div>

It remains to remove the import cycle `sage.symbolic.ring` -> `sage.symbolic.expression` -> `sage.symbolic.function` -> `sage.symbolic.ring`



---

archive/issue_comments_521952.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nAh, okay, I was thinking the modularization meant splitting Sage up into different subprojects that would have a main link that would be the actual Sage. However, it is a little different than that. I don't completely understand how all of this works and some of the benefits, but it doesn't seem to be as fragmented as I was thinking. Thank you.",
    "created_at": "2021-08-23T00:31:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521952",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:58" align="right">comment:58</div>

Ah, okay, I was thinking the modularization meant splitting Sage up into different subprojects that would have a main link that would be the actual Sage. However, it is a little different than that. I don't completely understand how all of this works and some of the benefits, but it doesn't seem to be as fragmented as I was thinking. Thank you.



---

archive/issue_comments_521953.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6400149f26eba95779bac6d9cc79704a761c07c\"><code>b640014</code></a></td><td><code>Replace import from sage.symbolic.pynac by sage.symbolic.expression</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46c4a6b0b6815076d8f0f5925459bb221f2c408b\"><code>46c4a6b</code></a></td><td><code>sage.symbolic.function: Move sfunction_serial_dict, get_sfunction_from_serial to .expression, refactor</code></td></tr></table>\n",
    "created_at": "2021-08-23T00:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521953",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6400149f26eba95779bac6d9cc79704a761c07c"><code>b640014</code></a></td><td><code>Replace import from sage.symbolic.pynac by sage.symbolic.expression</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46c4a6b0b6815076d8f0f5925459bb221f2c408b"><code>46c4a6b</code></a></td><td><code>sage.symbolic.function: Move sfunction_serial_dict, get_sfunction_from_serial to .expression, refactor</code></td></tr></table>




---

archive/issue_comments_521954.json:
```json
{
    "body": "Changed commit from **[`759aa5d`](https://github.com/sagemath/sagetrac-mirror/commit/759aa5d012d2ee2924456cb8df33514e351d2ffb)** to **[`46c4a6b`](https://github.com/sagemath/sagetrac-mirror/commit/46c4a6b0b6815076d8f0f5925459bb221f2c408b)**",
    "created_at": "2021-08-23T00:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521954",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`759aa5d`](https://github.com/sagemath/sagetrac-mirror/commit/759aa5d012d2ee2924456cb8df33514e351d2ffb)** to **[`46c4a6b`](https://github.com/sagemath/sagetrac-mirror/commit/46c4a6b0b6815076d8f0f5925459bb221f2c408b)**



---

archive/issue_comments_521955.json:
```json
{
    "body": "Changed commit from **[`46c4a6b`](https://github.com/sagemath/sagetrac-mirror/commit/46c4a6b0b6815076d8f0f5925459bb221f2c408b)** to **[`903792a`](https://github.com/sagemath/sagetrac-mirror/commit/903792a901e783b70244efa2f8ed6cb4f1eaf454)**",
    "created_at": "2021-08-23T00:53:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521955",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`46c4a6b`](https://github.com/sagemath/sagetrac-mirror/commit/46c4a6b0b6815076d8f0f5925459bb221f2c408b)** to **[`903792a`](https://github.com/sagemath/sagetrac-mirror/commit/903792a901e783b70244efa2f8ed6cb4f1eaf454)**



---

archive/issue_comments_521956.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/903792a901e783b70244efa2f8ed6cb4f1eaf454\"><code>903792a</code></a></td><td><code>src/sage/symbolic/pynac_constant.py: New</code></td></tr></table>\n",
    "created_at": "2021-08-23T00:53:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521956",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/903792a901e783b70244efa2f8ed6cb4f1eaf454"><code>903792a</code></a></td><td><code>src/sage/symbolic/pynac_constant.py: New</code></td></tr></table>




---

archive/issue_comments_521957.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,11 +2,15 @@\n \n Pynac has no other uses than as the core of the symbolic expressions facility of Sage; and cannot even be tested without Sage.\n \n-We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC. (The existing Python/Cython symbolics code in `sage.symbolic`, `sage.calculus`, `sage.functions` is about 60kLOC.)\n+We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC. (The existing !Python/Cython symbolics code in `sage.symbolic`, `sage.calculus`, `sage.functions` is about 60kLOC.)\n \n-This will solve the same issues that #30534 tried to address, which ran into unresolved technical difficulties.\n+The Pynac sources are compiled like other C++ sources that are already in the Sage source tree. They are linked into a single Python extension module, `sage.symbolic.expression`. All other extension modules that used to link to pynac (`sage.libs.pynac.pynac`, `sage.symbolic.function`, `sage.symbolic.series` etc.) are \n+- either refactored so that they only `import` helper functions provided by `sage.symbolic.expression` instead of having to `cimport` Pynac functions directly (see #32391, #32407)\n+- or merged into the extension module `sage.symbolic.expression` (via Cython `include` statements, not by copy-paste of source code, to keep the diff small)\n \n-It will also make it easier for Sage developers to make changes to Pynac.\n+This solves the same issues that #30534 tried to address, which ran into unresolved technical difficulties.\n+\n+It will also make it easier for Sage developers to make changes to Pynac and the related symbolic implementation.\n \n Follow-up: #32387 Remove pynac spkg\n \n``````\n",
    "created_at": "2021-08-23T01:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521957",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,11 +2,15 @@
 
 Pynac has no other uses than as the core of the symbolic expressions facility of Sage; and cannot even be tested without Sage.
 
-We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC. (The existing Python/Cython symbolics code in `sage.symbolic`, `sage.calculus`, `sage.functions` is about 60kLOC.)
+We merge Pynac (i.e., the directory https://github.com/pynac/pynac/tree/master/ginac) into the Sage library as `src/sage/symbolic/ginac`. It is not a very big package - one flat directory with 100 *.h and *.cpp files, a total of 50kLOC. (The existing !Python/Cython symbolics code in `sage.symbolic`, `sage.calculus`, `sage.functions` is about 60kLOC.)
 
-This will solve the same issues that #30534 tried to address, which ran into unresolved technical difficulties.
+The Pynac sources are compiled like other C++ sources that are already in the Sage source tree. They are linked into a single Python extension module, `sage.symbolic.expression`. All other extension modules that used to link to pynac (`sage.libs.pynac.pynac`, `sage.symbolic.function`, `sage.symbolic.series` etc.) are 
+- either refactored so that they only `import` helper functions provided by `sage.symbolic.expression` instead of having to `cimport` Pynac functions directly (see #32391, #32407)
+- or merged into the extension module `sage.symbolic.expression` (via Cython `include` statements, not by copy-paste of source code, to keep the diff small)
 
-It will also make it easier for Sage developers to make changes to Pynac.
+This solves the same issues that #30534 tried to address, which ran into unresolved technical difficulties.
+
+It will also make it easier for Sage developers to make changes to Pynac and the related symbolic implementation.
 
 Follow-up: #32387 Remove pynac spkg
 
``````




---

archive/issue_comments_521958.json:
```json
{
    "body": "<div id=\"comment:62\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f56aa26d702555868d3ba6d9b9338fc19aac390\"><code>9f56aa2</code></a></td><td><code>sage.symbolic.ring: cimport the helper functions from sage.symbolic.expression (safe because expression.pxd no longer declares the Expression class)</code></td></tr></table>\n",
    "created_at": "2021-08-23T01:33:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521958",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:62"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f56aa26d702555868d3ba6d9b9338fc19aac390"><code>9f56aa2</code></a></td><td><code>sage.symbolic.ring: cimport the helper functions from sage.symbolic.expression (safe because expression.pxd no longer declares the Expression class)</code></td></tr></table>




---

archive/issue_comments_521959.json:
```json
{
    "body": "Changed commit from **[`903792a`](https://github.com/sagemath/sagetrac-mirror/commit/903792a901e783b70244efa2f8ed6cb4f1eaf454)** to **[`9f56aa2`](https://github.com/sagemath/sagetrac-mirror/commit/9f56aa26d702555868d3ba6d9b9338fc19aac390)**",
    "created_at": "2021-08-23T01:33:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521959",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`903792a`](https://github.com/sagemath/sagetrac-mirror/commit/903792a901e783b70244efa2f8ed6cb4f1eaf454)** to **[`9f56aa2`](https://github.com/sagemath/sagetrac-mirror/commit/9f56aa26d702555868d3ba6d9b9338fc19aac390)**



---

archive/issue_comments_521960.json:
```json
{
    "body": "Changed commit from **[`9f56aa2`](https://github.com/sagemath/sagetrac-mirror/commit/9f56aa26d702555868d3ba6d9b9338fc19aac390)** to **[`3153781`](https://github.com/sagemath/sagetrac-mirror/commit/3153781f5e6c02b9a1a0cef9f8295f206a702162)**",
    "created_at": "2021-08-23T02:02:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521960",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9f56aa2`](https://github.com/sagemath/sagetrac-mirror/commit/9f56aa26d702555868d3ba6d9b9338fc19aac390)** to **[`3153781`](https://github.com/sagemath/sagetrac-mirror/commit/3153781f5e6c02b9a1a0cef9f8295f206a702162)**



---

archive/issue_comments_521961.json:
```json
{
    "body": "<div id=\"comment:63\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3153781f5e6c02b9a1a0cef9f8295f206a702162\"><code>3153781</code></a></td><td><code>WIP: Try to break import cycle</code></td></tr></table>\n",
    "created_at": "2021-08-23T02:02:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521961",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:63"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3153781f5e6c02b9a1a0cef9f8295f206a702162"><code>3153781</code></a></td><td><code>WIP: Try to break import cycle</code></td></tr></table>




---

archive/issue_comments_521962.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nStill struggling with an import cycle `sage.symbolic.ring` -> `sage.symbolic.expression` -> `sage.symbolic.ring`",
    "created_at": "2021-08-23T02:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521962",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:64" align="right">comment:64</div>

Still struggling with an import cycle `sage.symbolic.ring` -> `sage.symbolic.expression` -> `sage.symbolic.ring`



---

archive/issue_comments_521963.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nHelp welcome",
    "created_at": "2021-08-23T02:05:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521963",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:65" align="right">comment:65</div>

Help welcome



---

archive/issue_comments_521964.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nI recall that `i`, a.k.a. `I`, is really close the the center of the import troubles.",
    "created_at": "2021-08-23T07:08:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521964",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:66" align="right">comment:66</div>

I recall that `i`, a.k.a. `I`, is really close the the center of the import troubles.



---

archive/issue_comments_521965.json:
```json
{
    "body": "Changed commit from **[`3153781`](https://github.com/sagemath/sagetrac-mirror/commit/3153781f5e6c02b9a1a0cef9f8295f206a702162)** to **[`7ce050f`](https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf)**",
    "created_at": "2021-08-23T10:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521965",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`3153781`](https://github.com/sagemath/sagetrac-mirror/commit/3153781f5e6c02b9a1a0cef9f8295f206a702162)** to **[`7ce050f`](https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf)**



---

archive/issue_comments_521966.json:
```json
{
    "body": "<div id=\"comment:67\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01dfef3756a4da5fc01355f10954dea69fbf01f6\"><code>01dfef3</code></a></td><td><code>missing headers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04397d2e547f0a81c727165d9e9fee0d54b3ee6d\"><code>04397d2</code></a></td><td><code>add missing singular libraries</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6\"><code>70bcddf</code></a></td><td><code>simpler inclusion of headers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf\"><code>7ce050f</code></a></td><td><code>somewhat fix doctest</code></td></tr></table>\n",
    "created_at": "2021-08-23T10:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521966",
    "user": "https://github.com/kliem"
}
```

<div id="comment:67"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01dfef3756a4da5fc01355f10954dea69fbf01f6"><code>01dfef3</code></a></td><td><code>missing headers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04397d2e547f0a81c727165d9e9fee0d54b3ee6d"><code>04397d2</code></a></td><td><code>add missing singular libraries</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70bcddf168950f477c2b56fca725e668a1236fb6"><code>70bcddf</code></a></td><td><code>simpler inclusion of headers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf"><code>7ce050f</code></a></td><td><code>somewhat fix doctest</code></td></tr></table>




---

archive/issue_comments_521967.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-23T10:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521967",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521968.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, Jonathan Kliem**",
    "created_at": "2021-08-23T10:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521968",
    "user": "https://github.com/kliem"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, Jonathan Kliem**



---

archive/issue_comments_521969.json:
```json
{
    "body": "Changed commit from **[`7ce050f`](https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf)** to **[`48267a7`](https://github.com/sagemath/sagetrac-mirror/commit/48267a7cc19287bd9523370ea9ebbda6d3f1085b)**",
    "created_at": "2021-08-23T10:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521969",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7ce050f`](https://github.com/sagemath/sagetrac-mirror/commit/7ce050fdea338610b91680584c0db59e54d4c5cf)** to **[`48267a7`](https://github.com/sagemath/sagetrac-mirror/commit/48267a7cc19287bd9523370ea9ebbda6d3f1085b)**



---

archive/issue_comments_521970.json:
```json
{
    "body": "<div id=\"comment:68\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a9fdc750bc49f5e54cd04bdd0589bff32bb5b42\"><code>9a9fdc7</code></a></td><td><code>Merge #32407</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/759aa5d012d2ee2924456cb8df33514e351d2ffb\"><code>759aa5d</code></a></td><td><code>sage.symbolic.expression: Finish merging code using pynac into this one DSO</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6400149f26eba95779bac6d9cc79704a761c07c\"><code>b640014</code></a></td><td><code>Replace import from sage.symbolic.pynac by sage.symbolic.expression</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46c4a6b0b6815076d8f0f5925459bb221f2c408b\"><code>46c4a6b</code></a></td><td><code>sage.symbolic.function: Move sfunction_serial_dict, get_sfunction_from_serial to .expression, refactor</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/903792a901e783b70244efa2f8ed6cb4f1eaf454\"><code>903792a</code></a></td><td><code>src/sage/symbolic/pynac_constant.py: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f56aa26d702555868d3ba6d9b9338fc19aac390\"><code>9f56aa2</code></a></td><td><code>sage.symbolic.ring: cimport the helper functions from sage.symbolic.expression (safe because expression.pxd no longer declares the Expression class)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3153781f5e6c02b9a1a0cef9f8295f206a702162\"><code>3153781</code></a></td><td><code>WIP: Try to break import cycle</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a56c69dd376731943b5edd9050adbe853f7c8efc\"><code>a56c69d</code></a></td><td><code>fix startup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b557c68dd722ae8063334b23a595f9b1482a5d7\"><code>5b557c6</code></a></td><td><code>deprecation warnings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48267a7cc19287bd9523370ea9ebbda6d3f1085b\"><code>48267a7</code></a></td><td><code>fix doctests</code></td></tr></table>\n",
    "created_at": "2021-08-23T10:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521970",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:68"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a9fdc750bc49f5e54cd04bdd0589bff32bb5b42"><code>9a9fdc7</code></a></td><td><code>Merge #32407</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/759aa5d012d2ee2924456cb8df33514e351d2ffb"><code>759aa5d</code></a></td><td><code>sage.symbolic.expression: Finish merging code using pynac into this one DSO</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6400149f26eba95779bac6d9cc79704a761c07c"><code>b640014</code></a></td><td><code>Replace import from sage.symbolic.pynac by sage.symbolic.expression</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46c4a6b0b6815076d8f0f5925459bb221f2c408b"><code>46c4a6b</code></a></td><td><code>sage.symbolic.function: Move sfunction_serial_dict, get_sfunction_from_serial to .expression, refactor</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/903792a901e783b70244efa2f8ed6cb4f1eaf454"><code>903792a</code></a></td><td><code>src/sage/symbolic/pynac_constant.py: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f56aa26d702555868d3ba6d9b9338fc19aac390"><code>9f56aa2</code></a></td><td><code>sage.symbolic.ring: cimport the helper functions from sage.symbolic.expression (safe because expression.pxd no longer declares the Expression class)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3153781f5e6c02b9a1a0cef9f8295f206a702162"><code>3153781</code></a></td><td><code>WIP: Try to break import cycle</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a56c69dd376731943b5edd9050adbe853f7c8efc"><code>a56c69d</code></a></td><td><code>fix startup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b557c68dd722ae8063334b23a595f9b1482a5d7"><code>5b557c6</code></a></td><td><code>deprecation warnings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48267a7cc19287bd9523370ea9ebbda6d3f1085b"><code>48267a7</code></a></td><td><code>fix doctests</code></td></tr></table>




---

archive/issue_events_443496.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-08-23T10:56:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443496"
}
```



---

archive/issue_events_443497.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-08-23T10:56:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443497"
}
```



---

archive/issue_comments_521971.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nSeems to work now.",
    "created_at": "2021-08-23T10:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521971",
    "user": "https://github.com/kliem"
}
```

<div id="comment:69" align="right">comment:69</div>

Seems to work now.



---

archive/issue_comments_521972.json:
```json
{
    "body": "Changed commit from **[`48267a7`](https://github.com/sagemath/sagetrac-mirror/commit/48267a7cc19287bd9523370ea9ebbda6d3f1085b)** to **[`5776163`](https://github.com/sagemath/sagetrac-mirror/commit/5776163f25a6a26bb0063b56ad01517907c00b3a)**",
    "created_at": "2021-08-23T15:19:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521972",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`48267a7`](https://github.com/sagemath/sagetrac-mirror/commit/48267a7cc19287bd9523370ea9ebbda6d3f1085b)** to **[`5776163`](https://github.com/sagemath/sagetrac-mirror/commit/5776163f25a6a26bb0063b56ad01517907c00b3a)**



---

archive/issue_comments_521973.json:
```json
{
    "body": "<div id=\"comment:70\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5776163f25a6a26bb0063b56ad01517907c00b3a\"><code>5776163</code></a></td><td><code>wrong import</code></td></tr></table>\n",
    "created_at": "2021-08-23T15:19:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521973",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:70"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5776163f25a6a26bb0063b56ad01517907c00b3a"><code>5776163</code></a></td><td><code>wrong import</code></td></tr></table>




---

archive/issue_comments_521974.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nCool, thanks very much!!",
    "created_at": "2021-08-23T16:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521974",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Cool, thanks very much!!



---

archive/issue_comments_521975.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nI'm getting\n\n```\nsage -t --random-seed=0 src/sage/functions/prime_pi.pyx\n**********************************************************************\nFile \"src/sage/functions/prime_pi.pyx\", line 17, in sage.functions.prime_pi\nFailed example:\n    loads(dumps(z)) == z\nExpected:\n    True\nGot:\n    False\n```",
    "created_at": "2021-08-23T16:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521975",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:72" align="right">comment:72</div>

I'm getting

```
sage -t --random-seed=0 src/sage/functions/prime_pi.pyx
**********************************************************************
File "src/sage/functions/prime_pi.pyx", line 17, in sage.functions.prime_pi
Failed example:
    loads(dumps(z)) == z
Expected:
    True
Got:
    False
```



---

archive/issue_comments_521976.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nIt will also need to be checked that the deferred imports (such as those introduced in my commit 3153781) do not lead to speed regressions",
    "created_at": "2021-08-23T16:38:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521976",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:73" align="right">comment:73</div>

It will also need to be checked that the deferred imports (such as those introduced in my commit 3153781) do not lead to speed regressions



---

archive/issue_comments_521977.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nAlso I don't think we need `src/sage/symbolic/pynac.py` -- the module `sage.symbolic.pynac` only had a short-lived existence here in this branch.\nDid you mean to add these `lazy_import` to `src/sage/libs/pynac/pynac.py`?",
    "created_at": "2021-08-23T16:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521977",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:74" align="right">comment:74</div>

Also I don't think we need `src/sage/symbolic/pynac.py` -- the module `sage.symbolic.pynac` only had a short-lived existence here in this branch.
Did you mean to add these `lazy_import` to `src/sage/libs/pynac/pynac.py`?



---

archive/issue_comments_521978.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-23T17:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521978",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521979.json:
```json
{
    "body": "Changed commit from **[`5776163`](https://github.com/sagemath/sagetrac-mirror/commit/5776163f25a6a26bb0063b56ad01517907c00b3a)** to **[`a27d820`](https://github.com/sagemath/sagetrac-mirror/commit/a27d820bb00ddcd82353eec55eab8920920068b7)**",
    "created_at": "2021-08-23T17:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521979",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`5776163`](https://github.com/sagemath/sagetrac-mirror/commit/5776163f25a6a26bb0063b56ad01517907c00b3a)** to **[`a27d820`](https://github.com/sagemath/sagetrac-mirror/commit/a27d820bb00ddcd82353eec55eab8920920068b7)**



---

archive/issue_comments_521980.json:
```json
{
    "body": "<div id=\"comment:76\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c12e71e5c52fc773fa0e8beda90df200f4fb0583\"><code>c12e71e</code></a></td><td><code>moved imports to libs/pynac/pynac.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b898086efb19438f7c313267c8f78158d13c0cdb\"><code>b898086</code></a></td><td><code>fix serial getting of BuiltinFunction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e1715067e422bc924a7bf8c632502c50e7760e0\"><code>7e17150</code></a></td><td><code>fixed import in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ec43a22f87ab7aadbf4de31ff0e6af6bb1d5495\"><code>4ec43a2</code></a></td><td><code>src/sage/symbolic/ginac/README.md: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a27d820bb00ddcd82353eec55eab8920920068b7\"><code>a27d820</code></a></td><td><code>Merge branch 'u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac' of git://trac.sagemath.org/sage into u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac</code></td></tr></table>\n",
    "created_at": "2021-08-23T17:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521980",
    "user": "https://github.com/kliem"
}
```

<div id="comment:76"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c12e71e5c52fc773fa0e8beda90df200f4fb0583"><code>c12e71e</code></a></td><td><code>moved imports to libs/pynac/pynac.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b898086efb19438f7c313267c8f78158d13c0cdb"><code>b898086</code></a></td><td><code>fix serial getting of BuiltinFunction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e1715067e422bc924a7bf8c632502c50e7760e0"><code>7e17150</code></a></td><td><code>fixed import in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ec43a22f87ab7aadbf4de31ff0e6af6bb1d5495"><code>4ec43a2</code></a></td><td><code>src/sage/symbolic/ginac/README.md: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a27d820bb00ddcd82353eec55eab8920920068b7"><code>a27d820</code></a></td><td><code>Merge branch 'u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac' of git://trac.sagemath.org/sage into u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac</code></td></tr></table>




---

archive/issue_comments_521981.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-23T17:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521981",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521982.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@mkoeppe](#comment:72):\n> I'm getting\n> \n> ```\n> sage -t --random-seed=0 src/sage/functions/prime_pi.pyx\n> **********************************************************************\n> File \"src/sage/functions/prime_pi.pyx\", line 17, in sage.functions.prime_pi\n> Failed example:\n>     loads(dumps(z)) == z\n> Expected:\n>     True\n> Got:\n>     False\n> ```\n\nFixed.",
    "created_at": "2021-08-23T17:54:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521982",
    "user": "https://github.com/kliem"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@mkoeppe](#comment:72):
> I'm getting
> 
> ```
> sage -t --random-seed=0 src/sage/functions/prime_pi.pyx
> **********************************************************************
> File "src/sage/functions/prime_pi.pyx", line 17, in sage.functions.prime_pi
> Failed example:
>     loads(dumps(z)) == z
> Expected:
>     True
> Got:
>     False
> ```

Fixed.



---

archive/issue_comments_521983.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-23T18:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521983",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521984.json:
```json
{
    "body": "Changed commit from **[`a27d820`](https://github.com/sagemath/sagetrac-mirror/commit/a27d820bb00ddcd82353eec55eab8920920068b7)** to **[`2d21534`](https://github.com/sagemath/sagetrac-mirror/commit/2d2153446fc3bb4d2d17d32cc770c0efc5121ecf)**",
    "created_at": "2021-08-23T18:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521984",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a27d820`](https://github.com/sagemath/sagetrac-mirror/commit/a27d820bb00ddcd82353eec55eab8920920068b7)** to **[`2d21534`](https://github.com/sagemath/sagetrac-mirror/commit/2d2153446fc3bb4d2d17d32cc770c0efc5121ecf)**



---

archive/issue_comments_521985.json:
```json
{
    "body": "<div id=\"comment:79\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d2153446fc3bb4d2d17d32cc770c0efc5121ecf\"><code>2d21534</code></a></td><td><code>src/sage/symbolic/expression.pyx: Update copyright according to 'git blame -w --date=format:%Y src/sage/symbolic/expression.pyx | sort -k2'</code></td></tr></table>\n",
    "created_at": "2021-08-23T18:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521985",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d2153446fc3bb4d2d17d32cc770c0efc5121ecf"><code>2d21534</code></a></td><td><code>src/sage/symbolic/expression.pyx: Update copyright according to 'git blame -w --date=format:%Y src/sage/symbolic/expression.pyx | sort -k2'</code></td></tr></table>




---

archive/issue_comments_521986.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nIf we want to deprecate these reimports like you do here...\n\n```\n+++ b/src/sage/symbolic/series.py\n@@ -0,0 +1,2 @@\n+from sage.misc.lazy_import import lazy_import\n+lazy_import('sage.symbolic.expression', 'SymbolicSeries', deprecation=32386)\n```\n... then we should probably also do this in `substitution_map.py` (and perhaps other places).",
    "created_at": "2021-08-23T18:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521986",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:80" align="right">comment:80</div>

If we want to deprecate these reimports like you do here...

```
+++ b/src/sage/symbolic/series.py
@@ -0,0 +1,2 @@
+from sage.misc.lazy_import import lazy_import
+lazy_import('sage.symbolic.expression', 'SymbolicSeries', deprecation=32386)
```
... then we should probably also do this in `substitution_map.py` (and perhaps other places).



---

archive/issue_comments_521987.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nI tried to get all places. I didn't do `substitution_map.py` because, you had already added the reimport.\n\nI did those lazy imports here, so that people importing python functions from places where they used to be, get a proper deprecation warning:\n\nhttps://github.com/sagemath/sagetrac-mirror/commit/5b557c68dd722ae8063334b23a595f9b1482a5d7",
    "created_at": "2021-08-23T19:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521987",
    "user": "https://github.com/kliem"
}
```

<div id="comment:81" align="right">comment:81</div>

I tried to get all places. I didn't do `substitution_map.py` because, you had already added the reimport.

I did those lazy imports here, so that people importing python functions from places where they used to be, get a proper deprecation warning:

https://github.com/sagemath/sagetrac-mirror/commit/5b557c68dd722ae8063334b23a595f9b1482a5d7



---

archive/issue_comments_521988.json:
```json
{
    "body": "Changed commit from **[`2d21534`](https://github.com/sagemath/sagetrac-mirror/commit/2d2153446fc3bb4d2d17d32cc770c0efc5121ecf)** to **[`03a4b83`](https://github.com/sagemath/sagetrac-mirror/commit/03a4b83be3c6379679cb1b138ee440f60db2710c)**",
    "created_at": "2021-08-23T19:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521988",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2d21534`](https://github.com/sagemath/sagetrac-mirror/commit/2d2153446fc3bb4d2d17d32cc770c0efc5121ecf)** to **[`03a4b83`](https://github.com/sagemath/sagetrac-mirror/commit/03a4b83be3c6379679cb1b138ee440f60db2710c)**



---

archive/issue_comments_521989.json:
```json
{
    "body": "<div id=\"comment:82\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03a4b83be3c6379679cb1b138ee440f60db2710c\"><code>03a4b83</code></a></td><td><code>src/sage/symbolic/function.pyx: Update copyright according to 'git blame -w --date=format:%Y src/sage/symbolic/function.pyx | sort -k2'</code></td></tr></table>\n",
    "created_at": "2021-08-23T19:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521989",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:82"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03a4b83be3c6379679cb1b138ee440f60db2710c"><code>03a4b83</code></a></td><td><code>src/sage/symbolic/function.pyx: Update copyright according to 'git blame -w --date=format:%Y src/sage/symbolic/function.pyx | sort -k2'</code></td></tr></table>




---

archive/issue_comments_521990.json:
```json
{
    "body": "Changed commit from **[`03a4b83`](https://github.com/sagemath/sagetrac-mirror/commit/03a4b83be3c6379679cb1b138ee440f60db2710c)** to **[`53453b4`](https://github.com/sagemath/sagetrac-mirror/commit/53453b4d897219e536450651225fb2d2a0b71e92)**",
    "created_at": "2021-08-23T22:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521990",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`03a4b83`](https://github.com/sagemath/sagetrac-mirror/commit/03a4b83be3c6379679cb1b138ee440f60db2710c)** to **[`53453b4`](https://github.com/sagemath/sagetrac-mirror/commit/53453b4d897219e536450651225fb2d2a0b71e92)**



---

archive/issue_comments_521991.json:
```json
{
    "body": "<div id=\"comment:83\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53453b4d897219e536450651225fb2d2a0b71e92\"><code>53453b4</code></a></td><td><code>src/sage/symbolic/*_impl.pxi: Update copyright according to git blame</code></td></tr></table>\n",
    "created_at": "2021-08-23T22:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521991",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:83"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53453b4d897219e536450651225fb2d2a0b71e92"><code>53453b4</code></a></td><td><code>src/sage/symbolic/*_impl.pxi: Update copyright according to git blame</code></td></tr></table>




---

archive/issue_comments_521992.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nReplying to [@mkoeppe](#comment:73):\n> It will also need to be checked that the deferred imports (such as those introduced in my commit 3153781) do not lead to speed regressions\n\nA quick comparison using `./sage -tp --long src/sage/symbolic/ src/sage/functions/ src/sage/calculus/ src/sage/manifolds/` shows a serious slowdown around +30% with this branch",
    "created_at": "2021-08-24T00:42:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521992",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:84" align="right">comment:84</div>

Replying to [@mkoeppe](#comment:73):
> It will also need to be checked that the deferred imports (such as those introduced in my commit 3153781) do not lead to speed regressions

A quick comparison using `./sage -tp --long src/sage/symbolic/ src/sage/functions/ src/sage/calculus/ src/sage/manifolds/` shows a serious slowdown around +30% with this branch



---

archive/issue_events_443498.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-24T00:42:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443498"
}
```



---

archive/issue_events_443499.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-24T00:42:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443499"
}
```



---

archive/issue_comments_521993.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nI cannot reproduce these timings any more; perhaps this was just from CPU throttling.",
    "created_at": "2021-08-24T03:52:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521993",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">comment:85</div>

I cannot reproduce these timings any more; perhaps this was just from CPU throttling.



---

archive/issue_events_443500.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-24T03:53:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443500"
}
```



---

archive/issue_events_443501.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-24T03:53:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443501"
}
```



---

archive/issue_comments_521994.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-24T11:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521994",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521995.json:
```json
{
    "body": "<div id=\"comment:87\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e79cc47188db3896891d951f63973994d64251be\"><code>e79cc47</code></a></td><td><code>sporadic failing tests</code></td></tr></table>\n",
    "created_at": "2021-08-24T11:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521995",
    "user": "https://github.com/kliem"
}
```

<div id="comment:87"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e79cc47188db3896891d951f63973994d64251be"><code>e79cc47</code></a></td><td><code>sporadic failing tests</code></td></tr></table>




---

archive/issue_comments_521996.json:
```json
{
    "body": "Changed commit from **[`53453b4`](https://github.com/sagemath/sagetrac-mirror/commit/53453b4d897219e536450651225fb2d2a0b71e92)** to **[`e79cc47`](https://github.com/sagemath/sagetrac-mirror/commit/e79cc47188db3896891d951f63973994d64251be)**",
    "created_at": "2021-08-24T11:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521996",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`53453b4`](https://github.com/sagemath/sagetrac-mirror/commit/53453b4d897219e536450651225fb2d2a0b71e92)** to **[`e79cc47`](https://github.com/sagemath/sagetrac-mirror/commit/e79cc47188db3896891d951f63973994d64251be)**



---

archive/issue_comments_521997.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-24T17:40:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521997",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_521998.json:
```json
{
    "body": "<div id=\"comment:89\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac9c9594cc1d0e12cb91214a9be3d8c1ec293e4d\"><code>ac9c959</code></a></td><td><code>sage.symbolic.pynac_constant: Use lazy_import with deprecation</code></td></tr></table>\n",
    "created_at": "2021-08-24T18:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521998",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:89"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac9c9594cc1d0e12cb91214a9be3d8c1ec293e4d"><code>ac9c959</code></a></td><td><code>sage.symbolic.pynac_constant: Use lazy_import with deprecation</code></td></tr></table>




---

archive/issue_comments_521999.json:
```json
{
    "body": "Changed commit from **[`e79cc47`](https://github.com/sagemath/sagetrac-mirror/commit/e79cc47188db3896891d951f63973994d64251be)** to **[`ac9c959`](https://github.com/sagemath/sagetrac-mirror/commit/ac9c9594cc1d0e12cb91214a9be3d8c1ec293e4d)**",
    "created_at": "2021-08-24T18:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-521999",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e79cc47`](https://github.com/sagemath/sagetrac-mirror/commit/e79cc47188db3896891d951f63973994d64251be)** to **[`ac9c959`](https://github.com/sagemath/sagetrac-mirror/commit/ac9c9594cc1d0e12cb91214a9be3d8c1ec293e4d)**



---

archive/issue_comments_522000.json:
```json
{
    "body": "<div id=\"comment:90\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d680c35562f8925640e24fd421fd9ddf348dd301\"><code>d680c35</code></a></td><td><code>sage.symbolic.expression.call_registered_function: Rename from call_by_ginac_serial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f761d88643c2ff64913ec3a7a836f3d292eecf1\"><code>1f761d8</code></a></td><td><code>src/sage/symbolic/pynac_function_impl.pxi: Split out from src/sage/symbolic/expression.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47adbccd75968e5e40f36dbbed0aa57e4918043e\"><code>47adbcc</code></a></td><td><code>src/sage/symbolic/pynac_function_impl.pxi: Add doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d07a025f6c71f5d6ef94bfc49c86cb07dd9d59c\"><code>1d07a02</code></a></td><td><code>Merge #32407</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9c8637392c1a811b53b4d9ae21799d02b38a8c8\"><code>e9c8637</code></a></td><td><code>get_sfunction_from_hash: Add doctest</code></td></tr></table>\n",
    "created_at": "2021-08-24T21:05:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522000",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:90"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d680c35562f8925640e24fd421fd9ddf348dd301"><code>d680c35</code></a></td><td><code>sage.symbolic.expression.call_registered_function: Rename from call_by_ginac_serial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f761d88643c2ff64913ec3a7a836f3d292eecf1"><code>1f761d8</code></a></td><td><code>src/sage/symbolic/pynac_function_impl.pxi: Split out from src/sage/symbolic/expression.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47adbccd75968e5e40f36dbbed0aa57e4918043e"><code>47adbcc</code></a></td><td><code>src/sage/symbolic/pynac_function_impl.pxi: Add doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d07a025f6c71f5d6ef94bfc49c86cb07dd9d59c"><code>1d07a02</code></a></td><td><code>Merge #32407</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9c8637392c1a811b53b4d9ae21799d02b38a8c8"><code>e9c8637</code></a></td><td><code>get_sfunction_from_hash: Add doctest</code></td></tr></table>




---

archive/issue_comments_522001.json:
```json
{
    "body": "Changed commit from **[`ac9c959`](https://github.com/sagemath/sagetrac-mirror/commit/ac9c9594cc1d0e12cb91214a9be3d8c1ec293e4d)** to **[`e9c8637`](https://github.com/sagemath/sagetrac-mirror/commit/e9c8637392c1a811b53b4d9ae21799d02b38a8c8)**",
    "created_at": "2021-08-24T21:05:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522001",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ac9c959`](https://github.com/sagemath/sagetrac-mirror/commit/ac9c9594cc1d0e12cb91214a9be3d8c1ec293e4d)** to **[`e9c8637`](https://github.com/sagemath/sagetrac-mirror/commit/e9c8637392c1a811b53b4d9ae21799d02b38a8c8)**



---

archive/issue_comments_522002.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nIf I understand well, that means that when sage 9.5 enters Debian pynac can be let go.\n\nIs that right?\n\n(Asking as the one responsible for pynac in Debian: [package tracker](https://tracker.debian.org/pkg/pynac))",
    "created_at": "2021-08-25T06:56:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522002",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:91" align="right">comment:91</div>

If I understand well, that means that when sage 9.5 enters Debian pynac can be let go.

Is that right?

(Asking as the one responsible for pynac in Debian: [package tracker](https://tracker.debian.org/pkg/pynac))



---

archive/issue_comments_522003.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nReplying to [@SnarkBoojum](#comment:91):\n> If I understand well, that means that when sage 9.5 enters Debian pynac can be let go.\n> \n> Is that right?\n> \n> (Asking as the one responsible for pynac in Debian: [package tracker](https://tracker.debian.org/pkg/pynac))\n\nYes, you understand well.",
    "created_at": "2021-08-25T08:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522003",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:92" align="right">comment:92</div>

Replying to [@SnarkBoojum](#comment:91):
> If I understand well, that means that when sage 9.5 enters Debian pynac can be let go.
> 
> Is that right?
> 
> (Asking as the one responsible for pynac in Debian: [package tracker](https://tracker.debian.org/pkg/pynac))

Yes, you understand well.



---

archive/issue_comments_522004.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\n\n```\nsage -t --long --random-seed=0 src/sage/misc/sageinspect.py\n**********************************************************************\nFile \"src/sage/misc/sageinspect.py\", line 2263, in sage.misc.sageinspect.sage_getsourcelines\nFailed example:\n    lines, lineno = sage_getsourcelines(x); lines[0:2]\nExpected:\n    ['cdef class Expression(CommutativeRingElement):\\n',\n     '    cpdef object pyobject(self):\\n']\nGot:\n    ['cdef class Expression(CommutativeRingElement):\\n', '\\n']\n```",
    "created_at": "2021-08-25T15:57:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522004",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:93" align="right">comment:93</div>


```
sage -t --long --random-seed=0 src/sage/misc/sageinspect.py
**********************************************************************
File "src/sage/misc/sageinspect.py", line 2263, in sage.misc.sageinspect.sage_getsourcelines
Failed example:
    lines, lineno = sage_getsourcelines(x); lines[0:2]
Expected:
    ['cdef class Expression(CommutativeRingElement):\n',
     '    cpdef object pyobject(self):\n']
Got:
    ['cdef class Expression(CommutativeRingElement):\n', '\n']
```



---

archive/issue_comments_522005.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-25T17:25:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522005",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_522006.json:
```json
{
    "body": "Changed commit from **[`e9c8637`](https://github.com/sagemath/sagetrac-mirror/commit/e9c8637392c1a811b53b4d9ae21799d02b38a8c8)** to **[`712f926`](https://github.com/sagemath/sagetrac-mirror/commit/712f9261c25496053ae203ec6b12b6410560f01c)**",
    "created_at": "2021-08-25T17:25:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522006",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`e9c8637`](https://github.com/sagemath/sagetrac-mirror/commit/e9c8637392c1a811b53b4d9ae21799d02b38a8c8)** to **[`712f926`](https://github.com/sagemath/sagetrac-mirror/commit/712f9261c25496053ae203ec6b12b6410560f01c)**



---

archive/issue_comments_522007.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nFixed that test in `sageinspect.py`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/712f9261c25496053ae203ec6b12b6410560f01c\"><code>712f926</code></a></td><td><code>fix doctest getting source code</code></td></tr></table>\n",
    "created_at": "2021-08-25T17:25:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522007",
    "user": "https://github.com/kliem"
}
```

<div id="comment:94" align="right">comment:94</div>

Fixed that test in `sageinspect.py`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/712f9261c25496053ae203ec6b12b6410560f01c"><code>712f926</code></a></td><td><code>fix doctest getting source code</code></td></tr></table>




---

archive/issue_comments_522008.json:
```json
{
    "body": "<div id=\"comment:95\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97060e941a2eeae71fbb7a740a0f44c0c3233d75\"><code>97060e9</code></a></td><td><code>fix docbuild</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d062ed36ce07dde3c9ba0b3ae7e39e825a6a1b2\"><code>5d062ed</code></a></td><td><code>one more doctest</code></td></tr></table>\n",
    "created_at": "2021-08-25T21:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522008",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:95"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97060e941a2eeae71fbb7a740a0f44c0c3233d75"><code>97060e9</code></a></td><td><code>fix docbuild</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d062ed36ce07dde3c9ba0b3ae7e39e825a6a1b2"><code>5d062ed</code></a></td><td><code>one more doctest</code></td></tr></table>




---

archive/issue_comments_522009.json:
```json
{
    "body": "Changed commit from **[`712f926`](https://github.com/sagemath/sagetrac-mirror/commit/712f9261c25496053ae203ec6b12b6410560f01c)** to **[`5d062ed`](https://github.com/sagemath/sagetrac-mirror/commit/5d062ed36ce07dde3c9ba0b3ae7e39e825a6a1b2)**",
    "created_at": "2021-08-25T21:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522009",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`712f926`](https://github.com/sagemath/sagetrac-mirror/commit/712f9261c25496053ae203ec6b12b6410560f01c)** to **[`5d062ed`](https://github.com/sagemath/sagetrac-mirror/commit/5d062ed36ce07dde3c9ba0b3ae7e39e825a6a1b2)**



---

archive/issue_comments_522010.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nCoverage is still an issue, e.g. `new_Expression_from_pyobject` doesn't even have a docstring.",
    "created_at": "2021-08-25T21:27:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522010",
    "user": "https://github.com/kliem"
}
```

<div id="comment:96" align="right">comment:96</div>

Coverage is still an issue, e.g. `new_Expression_from_pyobject` doesn't even have a docstring.



---

archive/issue_comments_522011.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**",
    "created_at": "2021-08-25T23:04:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522011",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/merge_pynac_as_src_sage_symbolic_ginac)** to **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)**



---

archive/issue_comments_522012.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nI've solved this by consolidating two similar functions into one \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f1ac2e8a415de7612f3b9c5ad82165761b61fad\"><code>3f1ac2e</code></a></td><td><code>sage.symbolic.expression: Merge new_Expression_from_pyobject and new_Expression_force_pyobject</code></td></tr></table>\n",
    "created_at": "2021-08-25T23:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522012",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:98" align="right">comment:98</div>

I've solved this by consolidating two similar functions into one 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f1ac2e8a415de7612f3b9c5ad82165761b61fad"><code>3f1ac2e</code></a></td><td><code>sage.symbolic.expression: Merge new_Expression_from_pyobject and new_Expression_force_pyobject</code></td></tr></table>




---

archive/issue_comments_522013.json:
```json
{
    "body": "Changed commit from **[`5d062ed`](https://github.com/sagemath/sagetrac-mirror/commit/5d062ed36ce07dde3c9ba0b3ae7e39e825a6a1b2)** to **[`3f1ac2e`](https://github.com/sagemath/sagetrac-mirror/commit/3f1ac2e8a415de7612f3b9c5ad82165761b61fad)**",
    "created_at": "2021-08-25T23:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522013",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`5d062ed`](https://github.com/sagemath/sagetrac-mirror/commit/5d062ed36ce07dde3c9ba0b3ae7e39e825a6a1b2)** to **[`3f1ac2e`](https://github.com/sagemath/sagetrac-mirror/commit/3f1ac2e8a415de7612f3b9c5ad82165761b61fad)**



---

archive/issue_comments_522014.json:
```json
{
    "body": "Reviewer: **https://github.com/mkoeppe/sage/actions/runs/1168763794, https://github.com/mkoeppe/sage/actions/runs/1168763799, ...**",
    "created_at": "2021-08-26T01:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522014",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **https://github.com/mkoeppe/sage/actions/runs/1168763794, https://github.com/mkoeppe/sage/actions/runs/1168763799, ...**



---

archive/issue_comments_522015.json:
```json
{
    "body": "Changed commit from **[`3f1ac2e`](https://github.com/sagemath/sagetrac-mirror/commit/3f1ac2e8a415de7612f3b9c5ad82165761b61fad)** to **[`0643756`](https://github.com/sagemath/sagetrac-mirror/commit/0643756930700a165b83987dc9d51e6105e2945a)**",
    "created_at": "2021-08-26T18:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522015",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3f1ac2e`](https://github.com/sagemath/sagetrac-mirror/commit/3f1ac2e8a415de7612f3b9c5ad82165761b61fad)** to **[`0643756`](https://github.com/sagemath/sagetrac-mirror/commit/0643756930700a165b83987dc9d51e6105e2945a)**



---

archive/issue_comments_522016.json:
```json
{
    "body": "<div id=\"comment:0\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0643756930700a165b83987dc9d51e6105e2945a\"><code>0643756</code></a></td><td><code>new_Expression_from_pyobject: Add output for new doctests</code></td></tr></table>\n",
    "created_at": "2021-08-26T18:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522016",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:0"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0643756930700a165b83987dc9d51e6105e2945a"><code>0643756</code></a></td><td><code>new_Expression_from_pyobject: Add output for new doctests</code></td></tr></table>




---

archive/issue_comments_522017.json:
```json
{
    "body": "Changed commit from **[`0643756`](https://github.com/sagemath/sagetrac-mirror/commit/0643756930700a165b83987dc9d51e6105e2945a)** to **[`327ca5f`](https://github.com/sagemath/sagetrac-mirror/commit/327ca5f3f5ca2c28d0c66685a2b528c88c10d265)**",
    "created_at": "2021-08-26T19:37:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522017",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0643756`](https://github.com/sagemath/sagetrac-mirror/commit/0643756930700a165b83987dc9d51e6105e2945a)** to **[`327ca5f`](https://github.com/sagemath/sagetrac-mirror/commit/327ca5f3f5ca2c28d0c66685a2b528c88c10d265)**



---

archive/issue_comments_522018.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f1e5bea8523d42b8daa0f2c21123cfd3cc2fe17\"><code>7f1e5be</code></a></td><td><code>src/sage/symbolic/pynac_function_impl.pxi: Remove unused import in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06e8c31893082088270d595460935163b92010c7\"><code>06e8c31</code></a></td><td><code>src/sage/symbolic/pynac_function_impl.pxi: Fix doc markup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/327ca5f3f5ca2c28d0c66685a2b528c88c10d265\"><code>327ca5f</code></a></td><td><code>Merge #32407</code></td></tr></table>\n",
    "created_at": "2021-08-26T19:37:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522018",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f1e5bea8523d42b8daa0f2c21123cfd3cc2fe17"><code>7f1e5be</code></a></td><td><code>src/sage/symbolic/pynac_function_impl.pxi: Remove unused import in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06e8c31893082088270d595460935163b92010c7"><code>06e8c31</code></a></td><td><code>src/sage/symbolic/pynac_function_impl.pxi: Fix doc markup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/327ca5f3f5ca2c28d0c66685a2b528c88c10d265"><code>327ca5f</code></a></td><td><code>Merge #32407</code></td></tr></table>




---

archive/issue_comments_522019.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe portability tests on GH Actions ran through successfully. \n\nReady for review",
    "created_at": "2021-08-27T23:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522019",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

The portability tests on GH Actions ran through successfully. 

Ready for review



---

archive/issue_comments_522020.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nthere is a failing test:\n\n```\ne023915d474 (Markus Wageringel   2021-06-15 19:54:54 +0200 340)     sage: result = integral(sinh(x^2+sqrt(x-1)),x)  # long time (15s on sage.math, 2012)\ne023915d474 (Markus Wageringel   2021-06-15 19:54:54 +0200 341)     ...\ne023915d474 (Markus Wageringel   2021-06-15 19:54:54 +0200 342)     sage: result\nd0c52e4aa36 (Jean-Pierre Flori   2013-05-27 15:36:24 +0200 343)     integrate(sinh(x^2 + sqrt(x - 1)), x)\n```\nline 342 needs `# long time` tag.",
    "created_at": "2021-09-03T16:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522020",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

there is a failing test:

```
e023915d474 (Markus Wageringel   2021-06-15 19:54:54 +0200 340)     sage: result = integral(sinh(x^2+sqrt(x-1)),x)  # long time (15s on sage.math, 2012)
e023915d474 (Markus Wageringel   2021-06-15 19:54:54 +0200 341)     ...
e023915d474 (Markus Wageringel   2021-06-15 19:54:54 +0200 342)     sage: result
d0c52e4aa36 (Jean-Pierre Flori   2013-05-27 15:36:24 +0200 343)     integrate(sinh(x^2 + sqrt(x - 1)), x)
```
line 342 needs `# long time` tag.



---

archive/issue_comments_522021.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nUnrelated to this ticket but yes",
    "created_at": "2021-09-03T17:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522021",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Unrelated to this ticket but yes



---

archive/issue_comments_522022.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nopened #32461 for this",
    "created_at": "2021-09-03T17:24:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522022",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

opened #32461 for this



---

archive/issue_events_443502.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-09-03T19:29:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443502"
}
```



---

archive/issue_events_443503.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-09-03T19:29:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443503"
}
```



---

archive/issue_comments_522023.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1168763794, https://github.com/mkoeppe/sage/actions/runs/1168763799, ...** to **Dima Pasechnik**",
    "created_at": "2021-09-03T19:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522023",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/1168763794, https://github.com/mkoeppe/sage/actions/runs/1168763799, ...** to **Dima Pasechnik**



---

archive/issue_comments_522024.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nlgtm",
    "created_at": "2021-09-03T19:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522024",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

lgtm



---

archive/issue_comments_522025.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThank you!",
    "created_at": "2021-09-03T19:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522025",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Thank you!



---

archive/issue_comments_522026.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nshould #32461  be a dependency here?",
    "created_at": "2021-09-04T08:45:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522026",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

should #32461  be a dependency here?



---

archive/issue_comments_522027.json:
```json
{
    "body": "Changed dependencies from **#32391, #32407** to **#32391, #32407, #32461**",
    "created_at": "2021-09-04T16:18:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522027",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#32391, #32407** to **#32391, #32407, #32461**



---

archive/issue_comments_522028.json:
```json
{
    "body": "Changed commit from **[`327ca5f`](https://github.com/sagemath/sagetrac-mirror/commit/327ca5f3f5ca2c28d0c66685a2b528c88c10d265)** to **[`0d0b58f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c)**",
    "created_at": "2021-09-13T23:39:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522028",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`327ca5f`](https://github.com/sagemath/sagetrac-mirror/commit/327ca5f3f5ca2c28d0c66685a2b528c88c10d265)** to **[`0d0b58f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c)**



---

archive/issue_events_443504.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-09-13T23:39:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443504"
}
```



---

archive/issue_events_443505.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2021-09-13T23:39:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443505"
}
```



---

archive/issue_comments_522029.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c\"><code>0d0b58f</code></a></td><td><code>Merge tag '9.5.beta1' into t/32386/merge_pynac_as_src_sage_symbolic_ginac</code></td></tr></table>\n",
    "created_at": "2021-09-13T23:39:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522029",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c"><code>0d0b58f</code></a></td><td><code>Merge tag '9.5.beta1' into t/32386/merge_pynac_as_src_sage_symbolic_ginac</code></td></tr></table>




---

archive/issue_events_443506.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-13T23:40:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443506"
}
```



---

archive/issue_events_443507.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-13T23:40:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443507"
}
```



---

archive/issue_events_443508.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-15T22:06:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443508"
}
```



---

archive/issue_events_443509.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "95fbd7cb875701c201879f7a6faa3f7a9a9c0b30",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-09-15T22:06:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32386#event-443509"
}
```



---

archive/issue_comments_522030.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[`0d0b58f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c)**",
    "created_at": "2021-09-15T22:06:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522030",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/merge_pynac_as_src_sage_symbolic_ginac)** to **[`0d0b58f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c)**



---

archive/issue_comments_522031.json:
```json
{
    "body": "Changed commit from **[`0d0b58f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c)** to none",
    "created_at": "2021-09-28T19:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522031",
    "user": "https://github.com/egourgoulhon"
}
```

Changed commit from **[`0d0b58f`](https://github.com/sagemath/sagetrac-mirror/commit/0d0b58f65c0ca01d51756798d6910efb5f26f47c)** to none



---

archive/issue_comments_522032.json:
```json
{
    "body": "<div id=\"comment:114\" align=\"right\">comment:114</div>\n\nReplying to [@mkoeppe](#comment:73):\n> It will also need to be checked that the deferred imports (such as those introduced in my commit 3153781) do not lead to speed regressions\n\nFWIW, the change performed here did not introduced any speed regression in the rather demanding [Kerr spacetime notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_Kerr.ipynb), which involves parallelized (8 threads) heavy symbolic computations. On the contrary, it seems there is some little speed up :-) On my i7-8665U laptop:\n- Sage 9.4: 461 s \n- Sage 9.5.beta2: 449 s",
    "created_at": "2021-09-28T19:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522032",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:114" align="right">comment:114</div>

Replying to [@mkoeppe](#comment:73):
> It will also need to be checked that the deferred imports (such as those introduced in my commit 3153781) do not lead to speed regressions

FWIW, the change performed here did not introduced any speed regression in the rather demanding [Kerr spacetime notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_Kerr.ipynb), which involves parallelized (8 threads) heavy symbolic computations. On the contrary, it seems there is some little speed up :-) On my i7-8665U laptop:
- Sage 9.4: 461 s 
- Sage 9.5.beta2: 449 s



---

archive/issue_comments_522033.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks for testing!",
    "created_at": "2021-09-28T19:38:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32386#issuecomment-522033",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks for testing!
