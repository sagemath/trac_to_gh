# Issue 32229: Asymptotic Ring BTerms: fix conversion

archive/issues_031992.json:
```json
{
    "body": "\n\nCC:  @cheuberg @behackl @thhagelmayer\n\nBranch/Commit: b29460f0a2bf90d646a15383a7e6d62309d9a9ba\n\nReviewer: Benjamin Hackl, Thomas Hagelmayer\n\nAuthor: Daniel Krenn\n\nDependencies: #31933, #32215\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32229\n\n",
    "closed_at": "2021-12-19T11:47:51Z",
    "created_at": "2021-07-18T11:15:40Z",
    "labels": [
        "component: asymptotic expansions",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Asymptotic Ring BTerms: fix conversion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32229",
    "user": "https://github.com/dkrenn"
}
```


CC:  @cheuberg @behackl @thhagelmayer

Branch/Commit: b29460f0a2bf90d646a15383a7e6d62309d9a9ba

Reviewer: Benjamin Hackl, Thomas Hagelmayer

Author: Daniel Krenn

Dependencies: #31933, #32215

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32229





---

archive/issue_comments_641691.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dkrenn/bterms_conversion\"",
    "created_at": "2021-07-18T11:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641691",
    "user": "https://github.com/dkrenn"
}
```

Changing branch from "" to "u/dkrenn/bterms_conversion"



---

archive/issue_comments_641692.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-18T14:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641692",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_641693.json:
```json
{
    "body": "Changing commit from \"\" to \"2660d4c5760dc4ce95a6adc0c3408b74d0a1e8d4\"",
    "created_at": "2021-07-18T14:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641693",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "2660d4c5760dc4ce95a6adc0c3408b74d0a1e8d4"



---

archive/issue_comments_641694.json:
```json
{
    "body": "<a id='comment:3'></a>5 failing doctests:\n\n1. `FutureWarning` (2 failing doctests), see review item 67 of #31933\n\n2. Negative coefficients in `BTerm`s (2 failing doctests). How to solve this? Is (simply) taking absolute values an option?\n\n3. Positional argument in failing doctests, see review item 73 of #31933.",
    "created_at": "2021-07-18T14:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641694",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:3'></a>5 failing doctests:

1. `FutureWarning` (2 failing doctests), see review item 67 of #31933

2. Negative coefficients in `BTerm`s (2 failing doctests). How to solve this? Is (simply) taking absolute values an option?

3. Positional argument in failing doctests, see review item 73 of #31933.



---

archive/issue_comments_641695.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-18T14:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641695",
    "user": "https://github.com/dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_641696.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-18T14:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641696",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_641697.json:
```json
{
    "body": "Changing author from \"\" to \"Daniel Krenn\"",
    "created_at": "2021-07-18T14:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641697",
    "user": "https://github.com/dkrenn"
}
```

Changing author from "" to "Daniel Krenn"



---

archive/issue_comments_641698.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2021-07-18T14:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641698",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_641699.json:
```json
{
    "body": "<a id='comment:7'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641699",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_085389.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32229#event-85389"
}
```



---

archive/issue_comments_641700.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [dkrenn](#comment%3A3):\n> 2. Negative coefficients in `BTerm`s (2 failing doctests). How to solve this? Is (simply) taking absolute values an option?\n\n\nI think that negative coefficients should be forbidden for B-Terms.",
    "created_at": "2021-08-02T19:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641700",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:8'></a>Replying to [dkrenn](#comment%3A3):
> 2. Negative coefficients in `BTerm`s (2 failing doctests). How to solve this? Is (simply) taking absolute values an option?


I think that negative coefficients should be forbidden for B-Terms.



---

archive/issue_comments_641701.json:
```json
{
    "body": "Changing branch from \"u/dkrenn/bterms_conversion\" to \"u/gh-thhagelmayer/bterms_conversion\"",
    "created_at": "2021-08-07T18:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641701",
    "user": "https://github.com/thhagelmayer"
}
```

Changing branch from "u/dkrenn/bterms_conversion" to "u/gh-thhagelmayer/bterms_conversion"



---

archive/issue_comments_641702.json:
```json
{
    "body": "<a id='comment:10'></a>I merged tickets #32215 and #31933 which bumped the sage version to beta4. I also fixed the doctests which were failing after the merge.\n\n---\nLast 10 new commits:",
    "created_at": "2021-08-07T18:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641702",
    "user": "https://github.com/thhagelmayer"
}
```

<a id='comment:10'></a>I merged tickets #32215 and #31933 which bumped the sage version to beta4. I also fixed the doctests which were failing after the merge.

---
Last 10 new commits:



---

archive/issue_comments_641703.json:
```json
{
    "body": "Changing commit from \"2660d4c5760dc4ce95a6adc0c3408b74d0a1e8d4\" to \"9e5b3fbdae06cd9ff787866df3ada169cbdb88d6\"",
    "created_at": "2021-08-07T18:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641703",
    "user": "https://github.com/thhagelmayer"
}
```

Changing commit from "2660d4c5760dc4ce95a6adc0c3408b74d0a1e8d4" to "9e5b3fbdae06cd9ff787866df3ada169cbdb88d6"



---

archive/issue_comments_641704.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Benjamin Hackl\"",
    "created_at": "2021-08-18T18:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641704",
    "user": "https://github.com/behackl"
}
```

Changing reviewer from "" to "Benjamin Hackl"



---

archive/issue_comments_641705.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [dkrenn](#comment%3A3):\n> 5 failing doctests:\n> \n> 1. `FutureWarning` (2 failing doctests), see review item 67 of #31933\n> \n> 2. Negative coefficients in `BTerm`s (2 failing doctests). How to solve this? Is (simply) taking absolute values an option?\n> \n> 3. Positional argument in failing doctests, see review item 73 of #31933.\n\n\nI believe that 1 and 3 are resolved in the meantime. Regarding 2 I also believe that upon creation of B-Terms, we should take the absolute value of the specified coefficient. That should be relatively easy to take care of; do we just need to adapt `BTerm.__init__`, or other places like `BTermMonoid._convert_construction_` (as indicated by the added TODO) as well?\n\nEDIT: forgot to say: I've reviewed the code here, the implementation looks good to me (and the fact that #32278 works as intended is also a good indicator of the code here doing what it should).",
    "created_at": "2021-08-18T18:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641705",
    "user": "https://github.com/behackl"
}
```

<a id='comment:11'></a>Replying to [dkrenn](#comment%3A3):
> 5 failing doctests:
> 
> 1. `FutureWarning` (2 failing doctests), see review item 67 of #31933
> 
> 2. Negative coefficients in `BTerm`s (2 failing doctests). How to solve this? Is (simply) taking absolute values an option?
> 
> 3. Positional argument in failing doctests, see review item 73 of #31933.


I believe that 1 and 3 are resolved in the meantime. Regarding 2 I also believe that upon creation of B-Terms, we should take the absolute value of the specified coefficient. That should be relatively easy to take care of; do we just need to adapt `BTerm.__init__`, or other places like `BTermMonoid._convert_construction_` (as indicated by the added TODO) as well?

EDIT: forgot to say: I've reviewed the code here, the implementation looks good to me (and the fact that #32278 works as intended is also a good indicator of the code here doing what it should).



---

archive/issue_comments_641706.json:
```json
{
    "body": "Changing reviewer from \"Benjamin Hackl\" to \"Benjamin Hackl, Thomas Hagelmayer\"",
    "created_at": "2021-08-19T16:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641706",
    "user": "https://github.com/thhagelmayer"
}
```

Changing reviewer from "Benjamin Hackl" to "Benjamin Hackl, Thomas Hagelmayer"



---

archive/issue_comments_641707.json:
```json
{
    "body": "<a id='comment:12'></a>I have reviewed the code and it looks good to me as well.",
    "created_at": "2021-08-19T16:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641707",
    "user": "https://github.com/thhagelmayer"
}
```

<a id='comment:12'></a>I have reviewed the code and it looks good to me as well.



---

archive/issue_comments_641708.json:
```json
{
    "body": "Changing branch from \"u/gh-thhagelmayer/bterms_conversion\" to \"u/behackl/bterms_conversion\"",
    "created_at": "2021-08-20T09:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641708",
    "user": "https://github.com/behackl"
}
```

Changing branch from "u/gh-thhagelmayer/bterms_conversion" to "u/behackl/bterms_conversion"



---

archive/issue_comments_641709.json:
```json
{
    "body": "Changing commit from \"9e5b3fbdae06cd9ff787866df3ada169cbdb88d6\" to \"84ad7a3efb761d10cbc0b02c4dd8145e8c991f04\"",
    "created_at": "2021-08-20T09:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641709",
    "user": "https://github.com/behackl"
}
```

Changing commit from "9e5b3fbdae06cd9ff787866df3ada169cbdb88d6" to "84ad7a3efb761d10cbc0b02c4dd8145e8c991f04"



---

archive/issue_comments_641710.json:
```json
{
    "body": "<a id='comment:14'></a>I've merged the latest versions of #31933 and #32215, and then added another commit ensuring that we take the absolute value of the passed coefficient when constructing a BTerm. Needs review.\n\n---\nLast 10 new commits:",
    "created_at": "2021-08-20T09:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641710",
    "user": "https://github.com/behackl"
}
```

<a id='comment:14'></a>I've merged the latest versions of #31933 and #32215, and then added another commit ensuring that we take the absolute value of the passed coefficient when constructing a BTerm. Needs review.

---
Last 10 new commits:



---

archive/issue_comments_641711.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2021-08-20T09:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641711",
    "user": "https://github.com/behackl"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_641712.json:
```json
{
    "body": "<a id='comment:15'></a>I looked at the new changes. Looks good to me.",
    "created_at": "2021-08-20T16:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641712",
    "user": "https://github.com/thhagelmayer"
}
```

<a id='comment:15'></a>I looked at the new changes. Looks good to me.



---

archive/issue_comments_641713.json:
```json
{
    "body": "<a id='comment:16'></a>I have just started playing with BTerms. They are a nice addition, thank you all for your work!\n\nThe way the validity condition gets lost here looks like a bug to me:\n\n```\nsage: n = SR.var('n')\nsage: Asy = AsymptoticRing('QQ^n * n^ZZ', QQ)\nsage: ET = Asy.term_monoid('exact')\nsage: BT = Asy.term_monoid('B')\n/home/marc/co/sage/local/lib/python3.9/site-packages/sage/structure/unique_representation.py:1007: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.\nSee https://trac.sagemath.org/31922 for details.\n  instance = typecall(cls, *args, **options)\nsage: bt = Asy(BT(n, valid_from={'n': 10})); bt\nB(1.000000000000000*n, n >= 10)\nsage: Asy(ET(2^n))*bt\nB(1.000000000000000*2^n*n, n >= 0)\n```\n(This is with 9.5.beta0 + branch from this ticket.)\nBut maybe I am misunderstanding how BTerms are supposed to behave?",
    "created_at": "2021-09-02T12:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641713",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:16'></a>I have just started playing with BTerms. They are a nice addition, thank you all for your work!

The way the validity condition gets lost here looks like a bug to me:

```
sage: n = SR.var('n')
sage: Asy = AsymptoticRing('QQ^n * n^ZZ', QQ)
sage: ET = Asy.term_monoid('exact')
sage: BT = Asy.term_monoid('B')
/home/marc/co/sage/local/lib/python3.9/site-packages/sage/structure/unique_representation.py:1007: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
See https://trac.sagemath.org/31922 for details.
  instance = typecall(cls, *args, **options)
sage: bt = Asy(BT(n, valid_from={'n': 10})); bt
B(1.000000000000000*n, n >= 10)
sage: Asy(ET(2^n))*bt
B(1.000000000000000*2^n*n, n >= 0)
```
(This is with 9.5.beta0 + branch from this ticket.)
But maybe I am misunderstanding how BTerms are supposed to behave?



---

archive/issue_comments_641714.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [mmezzarobba](#comment%3A16):\n> I have just started playing with BTerms. They are a nice addition, thank you all for your work!\n> \n> The way the validity condition gets lost here looks like a bug to me:\n> \n> ```\n> sage: n = SR.var('n')\n> sage: Asy = AsymptoticRing('QQ^n * n^ZZ', QQ)\n> sage: ET = Asy.term_monoid('exact')\n> sage: BT = Asy.term_monoid('B')\n> /home/marc/co/sage/local/lib/python3.9/site-packages/sage/structure/unique_representation.py:1007: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.\n> See https://trac.sagemath.org/31922 for details.\n>   instance = typecall(cls, *args, **options)\n> sage: bt = Asy(BT(n, valid_from={'n': 10})); bt\n> B(1.000000000000000*n, n >= 10)\n> sage: Asy(ET(2^n))*bt\n> B(1.000000000000000*2^n*n, n >= 0)\n> ```\n> (This is with 9.5.beta0 + branch from this ticket.)\n> But maybe I am misunderstanding how BTerms are supposed to behave?\n\n\nIndeed this is wrong. When I remember correctly, at the moment only polynomial terms are fully implemented (by #31933) and I would expect a `NotImplementedError` for the above.",
    "created_at": "2021-09-02T12:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641714",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:17'></a>Replying to [mmezzarobba](#comment%3A16):
> I have just started playing with BTerms. They are a nice addition, thank you all for your work!
> 
> The way the validity condition gets lost here looks like a bug to me:
> 
> ```
> sage: n = SR.var('n')
> sage: Asy = AsymptoticRing('QQ^n * n^ZZ', QQ)
> sage: ET = Asy.term_monoid('exact')
> sage: BT = Asy.term_monoid('B')
> /home/marc/co/sage/local/lib/python3.9/site-packages/sage/structure/unique_representation.py:1007: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
> See https://trac.sagemath.org/31922 for details.
>   instance = typecall(cls, *args, **options)
> sage: bt = Asy(BT(n, valid_from={'n': 10})); bt
> B(1.000000000000000*n, n >= 10)
> sage: Asy(ET(2^n))*bt
> B(1.000000000000000*2^n*n, n >= 0)
> ```
> (This is with 9.5.beta0 + branch from this ticket.)
> But maybe I am misunderstanding how BTerms are supposed to behave?


Indeed this is wrong. When I remember correctly, at the moment only polynomial terms are fully implemented (by #31933) and I would expect a `NotImplementedError` for the above.



---

archive/issue_comments_641715.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-09-02T12:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641715",
    "user": "https://github.com/behackl"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_641716.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [mmezzarobba](#comment%3A16):\n> I have just started playing with BTerms. They are a nice addition, thank you all for your work!\n> \n> The way the validity condition gets lost here looks like a bug to me:\n> \n> ```\n> sage: n = SR.var('n')\n> sage: Asy = AsymptoticRing('QQ^n * n^ZZ', QQ)\n> sage: ET = Asy.term_monoid('exact')\n> sage: BT = Asy.term_monoid('B')\n> /home/marc/co/sage/local/lib/python3.9/site-packages/sage/structure/unique_representation.py:1007: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.\n> See https://trac.sagemath.org/31922 for details.\n>   instance = typecall(cls, *args, **options)\n> sage: bt = Asy(BT(n, valid_from={'n': 10})); bt\n> B(1.000000000000000*n, n >= 10)\n> sage: Asy(ET(2^n))*bt\n> B(1.000000000000000*2^n*n, n >= 0)\n> ```\n> (This is with 9.5.beta0 + branch from this ticket.)\n> But maybe I am misunderstanding how BTerms are supposed to behave?\n\n\nHey! You are definitely right, multiplying BTerms apparently has some problems, I can reproduce it even in a simpler setting:\n\n```\nsage: AR.<n> = AsymptoticRing('n^QQ', QQ)\nsage: AR.B(42*n, valid_from=3) * AR.B(n, valid_from=5)                                                                                                                                                         \nB(42*n^2, n >= 0)\nsage: AR.B(42*n, valid_from=3) * n                                                                                                                                                                             \nB(42*n^2, n >= 0)\n```\n\nI'll investigate where things go wrong. Thanks for checking it out!",
    "created_at": "2021-09-02T12:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641716",
    "user": "https://github.com/behackl"
}
```

<a id='comment:18'></a>Replying to [mmezzarobba](#comment%3A16):
> I have just started playing with BTerms. They are a nice addition, thank you all for your work!
> 
> The way the validity condition gets lost here looks like a bug to me:
> 
> ```
> sage: n = SR.var('n')
> sage: Asy = AsymptoticRing('QQ^n * n^ZZ', QQ)
> sage: ET = Asy.term_monoid('exact')
> sage: BT = Asy.term_monoid('B')
> /home/marc/co/sage/local/lib/python3.9/site-packages/sage/structure/unique_representation.py:1007: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
> See https://trac.sagemath.org/31922 for details.
>   instance = typecall(cls, *args, **options)
> sage: bt = Asy(BT(n, valid_from={'n': 10})); bt
> B(1.000000000000000*n, n >= 10)
> sage: Asy(ET(2^n))*bt
> B(1.000000000000000*2^n*n, n >= 0)
> ```
> (This is with 9.5.beta0 + branch from this ticket.)
> But maybe I am misunderstanding how BTerms are supposed to behave?


Hey! You are definitely right, multiplying BTerms apparently has some problems, I can reproduce it even in a simpler setting:

```
sage: AR.<n> = AsymptoticRing('n^QQ', QQ)
sage: AR.B(42*n, valid_from=3) * AR.B(n, valid_from=5)                                                                                                                                                         
B(42*n^2, n >= 0)
sage: AR.B(42*n, valid_from=3) * n                                                                                                                                                                             
B(42*n^2, n >= 0)
```

I'll investigate where things go wrong. Thanks for checking it out!



---

archive/issue_comments_641717.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-02T16:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_641718.json:
```json
{
    "body": "Changing commit from \"84ad7a3efb761d10cbc0b02c4dd8145e8c991f04\" to \"ffdfd69f79010eaa5d59b0981676662c6967f438\"",
    "created_at": "2021-09-02T16:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "84ad7a3efb761d10cbc0b02c4dd8145e8c991f04" to "ffdfd69f79010eaa5d59b0981676662c6967f438"



---

archive/issue_comments_641719.json:
```json
{
    "body": "<a id='comment:20'></a>Curiously, we simply had not implemented multiplication of `BTerms` so far. Now multiplication should respect the bounds; and I've also fixed  `BTermMonoid`s not coercing into `OTermMonoid`s.",
    "created_at": "2021-09-02T16:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641719",
    "user": "https://github.com/behackl"
}
```

<a id='comment:20'></a>Curiously, we simply had not implemented multiplication of `BTerms` so far. Now multiplication should respect the bounds; and I've also fixed  `BTermMonoid`s not coercing into `OTermMonoid`s.



---

archive/issue_comments_641720.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-02T16:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641720",
    "user": "https://github.com/behackl"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_641721.json:
```json
{
    "body": "<a id='comment:21'></a>Also, I would expect absorption into B-terms to ignore non-growth factors in the absorbed term (and B-term creation to remove non-growth factors, like it replaces the coefficient by its absolute value); this does not seem to be the case. (Not sure if this is something for this ticket, nor if I have already reported it!)",
    "created_at": "2021-09-10T09:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641721",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:21'></a>Also, I would expect absorption into B-terms to ignore non-growth factors in the absorbed term (and B-term creation to remove non-growth factors, like it replaces the coefficient by its absolute value); this does not seem to be the case. (Not sure if this is something for this ticket, nor if I have already reported it!)



---

archive/issue_comments_641722.json:
```json
{
    "body": "<a id='comment:22'></a>I have opened #32692 for the point about non-growth factors raised in my last previous comment.\n\nThere are several comments above along the lines of \"I have reviewed the code up to this point at it looks good to me\". _I_ have reviewed the two commits made in response to my comment, and they look good to me, but I am reluctant to set the ticket to positive review without input from people actually working on asymptotic expansions `:-)`.\n\nWhat do you think? It there a reason to delay this ticket any longer?",
    "created_at": "2021-10-14T12:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641722",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:22'></a>I have opened #32692 for the point about non-growth factors raised in my last previous comment.

There are several comments above along the lines of "I have reviewed the code up to this point at it looks good to me". _I_ have reviewed the two commits made in response to my comment, and they look good to me, but I am reluctant to set the ticket to positive review without input from people actually working on asymptotic expansions `:-)`.

What do you think? It there a reason to delay this ticket any longer?



---

archive/issue_comments_641723.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [mmezzarobba](#comment%3A22):\n> What do you think? It there a reason to delay this ticket any longer?\n\nSorry for the inconvenience, there is no reason to delay this ticket.\n\nI have reviewed the implementation of multiplication for `BTerms`. LGTM.",
    "created_at": "2021-10-14T14:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641723",
    "user": "https://github.com/thhagelmayer"
}
```

<a id='comment:23'></a>Replying to [mmezzarobba](#comment%3A22):
> What do you think? It there a reason to delay this ticket any longer?

Sorry for the inconvenience, there is no reason to delay this ticket.

I have reviewed the implementation of multiplication for `BTerms`. LGTM.



---

archive/issue_comments_641724.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-14T14:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641724",
    "user": "https://github.com/thhagelmayer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_641725.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [gh-thhagelmayer](#comment%3A23):\n> Sorry for the inconvenience, there is no reason to delay this ticket.\n\n\nNo problem at all--and thank you!",
    "created_at": "2021-10-14T15:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641725",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:24'></a>Replying to [gh-thhagelmayer](#comment%3A23):
> Sorry for the inconvenience, there is no reason to delay this ticket.


No problem at all--and thank you!



---

archive/issue_comments_641726.json:
```json
{
    "body": "<a id='comment:25'></a>Merge conflict",
    "created_at": "2021-12-05T11:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641726",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>Merge conflict



---

archive/issue_comments_641727.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-05T11:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641727",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_641728.json:
```json
{
    "body": "Changing commit from \"ffdfd69f79010eaa5d59b0981676662c6967f438\" to \"b29460f0a2bf90d646a15383a7e6d62309d9a9ba\"",
    "created_at": "2021-12-08T11:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ffdfd69f79010eaa5d59b0981676662c6967f438" to "b29460f0a2bf90d646a15383a7e6d62309d9a9ba"



---

archive/issue_comments_641729.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-08T11:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_641730.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-12-08T14:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641730",
    "user": "https://github.com/behackl"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_641731.json:
```json
{
    "body": "<a id='comment:27'></a>Resolved conflict and tested locally, should be good now.",
    "created_at": "2021-12-08T14:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641731",
    "user": "https://github.com/behackl"
}
```

<a id='comment:27'></a>Resolved conflict and tested locally, should be good now.



---

archive/issue_events_085390.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-19T11:47:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32229#event-85390"
}
```



---

archive/issue_comments_641732.json:
```json
{
    "body": "Changing branch from \"u/behackl/bterms_conversion\" to \"b29460f0a2bf90d646a15383a7e6d62309d9a9ba\"",
    "created_at": "2021-12-19T11:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641732",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/behackl/bterms_conversion" to "b29460f0a2bf90d646a15383a7e6d62309d9a9ba"



---

archive/issue_comments_641733.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-19T11:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32229",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32229#issuecomment-641733",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
