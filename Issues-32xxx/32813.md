# Issue 32813: improved error message 'unknown file extension' provided by sage -t

archive/issues_032576.json:
```json
{
    "body": "CC:  @tobiasdiez\n\nAs reported on [sage-devel](https://groups.google.com/g/sage-devel/c/Jki-RKOaLmY/m/VPwhGAC4AAAJ), with\n\n```\n$ sage -v\nSageMath version 9.5.beta5, Release Date: 2021-10-28\n```\n\nThis works okay:\n\n```\n$ sage -t src/sage/rings/integer.pyx\nsage -t --random-seed=71352052423083427285276605183088217936 src/sage/rings/integer.pyx\n    [1145 tests, 3.32 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\n\nBut the following does not work anymore:\n\n```\n$ sage -t src/sage/rings/integer.pyx --log=a.log\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/src/bin/sage-runtests\", line 151, in <module>\n    err = DC.run()\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py\", line 1251, in run\n    self.expand_files_into_sources()\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py\", line 835, in expand_files_into_sources\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py\", line 835, in <listcomp>\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/sources.py\", line 527, in __init__\n    raise ValueError(\"unknown file extension %r\"%ext)\nValueError: unknown file extension '.log'\n```\n\nIndeed, since #32332, \"**all arguments must go before the file name now**\".\n\nThe current error message fails to indicate the user how to fix the problem. The current ticket aims at improving the error message.\n\nWith the current branch, the error message is now:\n\n```\n$ sage -t src/sage/rings/integer.pyx --log=a.log\n[...]\nValueError: unknown extension for the file to test (=--log=a.log),\nvalid extensions are: .py, .pyx, .pxd, .pxi, .sage, .spyx, .tex, .rst\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/32813\n\n",
    "closed_at": "2021-11-14T17:05:33Z",
    "created_at": "2021-11-02T14:26:40Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "improved error message 'unknown file extension' provided by sage -t",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32813",
    "user": "https://github.com/seblabbe"
}
```
CC:  @tobiasdiez

As reported on [sage-devel](https://groups.google.com/g/sage-devel/c/Jki-RKOaLmY/m/VPwhGAC4AAAJ), with

```
$ sage -v
SageMath version 9.5.beta5, Release Date: 2021-10-28
```

This works okay:

```
$ sage -t src/sage/rings/integer.pyx
sage -t --random-seed=71352052423083427285276605183088217936 src/sage/rings/integer.pyx
    [1145 tests, 3.32 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```

But the following does not work anymore:

```
$ sage -t src/sage/rings/integer.pyx --log=a.log
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/src/bin/sage-runtests", line 151, in <module>
    err = DC.run()
  File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py", line 1251, in run
    self.expand_files_into_sources()
  File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py", line 835, in expand_files_into_sources
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py", line 835, in <listcomp>
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/sources.py", line 527, in __init__
    raise ValueError("unknown file extension %r"%ext)
ValueError: unknown file extension '.log'
```

Indeed, since #32332, "**all arguments must go before the file name now**".

The current error message fails to indicate the user how to fix the problem. The current ticket aims at improving the error message.

With the current branch, the error message is now:

```
$ sage -t src/sage/rings/integer.pyx --log=a.log
[...]
ValueError: unknown extension for the file to test (=--log=a.log),
valid extensions are: .py, .pyx, .pxd, .pxi, .sage, .spyx, .tex, .rst
```

Issue created by migration from https://trac.sagemath.org/ticket/32813





---

archive/issue_comments_464116.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-11-02T14:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464116",
    "user": "https://github.com/seblabbe"
}
```

New commits:



---

archive/issue_comments_464117.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-02T14:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464117",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_464118.json:
```json
{
    "body": "You may want to fix also here the annoying issue that appears after a successful doctest:\n\n```\nTraceback (most recent call last):\n  File \"/home/chapoton/sage/src/bin/sage-runtests\", line 159, in <module>\n    exit_code_pytest = pytest.main(pytest_options + args)\nTypeError: can only concatenate list (not \"Namespace\") to list\n```\nI have not idea how to fix that, and what this line is supposed to achieve. Pytest experts should explain.",
    "created_at": "2021-11-02T16:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464118",
    "user": "https://github.com/fchapoton"
}
```

You may want to fix also here the annoying issue that appears after a successful doctest:

```
Traceback (most recent call last):
  File "/home/chapoton/sage/src/bin/sage-runtests", line 159, in <module>
    exit_code_pytest = pytest.main(pytest_options + args)
TypeError: can only concatenate list (not "Namespace") to list
```
I have not idea how to fix that, and what this line is supposed to achieve. Pytest experts should explain.



---

archive/issue_comments_464119.json:
```json
{
    "body": "see also #31924",
    "created_at": "2021-11-02T17:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464119",
    "user": "https://github.com/fchapoton"
}
```

see also #31924



---

archive/issue_comments_464120.json:
```json
{
    "body": "Replying to [comment:2 chapoton]:\n> You may want to fix also here the annoying issue that appears after a successful doctest:\n> \n> ```\n> Traceback (most recent call last):\n>   File \"/home/chapoton/sage/src/bin/sage-runtests\", line 159, in <module>\n>     exit_code_pytest = pytest.main(pytest_options + args)\n> TypeError: can only concatenate list (not \"Namespace\") to list\n> ```\n> I have not idea how to fix that, and what this line is supposed to achieve. Pytest experts should explain.\n\n\nI do not have such failure on my side. Only the line:\n\n```\nPytest is not installed, skip checking tests that rely on it.\n```\nHow can I reproduce the typeerror you mention?",
    "created_at": "2021-11-02T19:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464120",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:2 chapoton]:
> You may want to fix also here the annoying issue that appears after a successful doctest:
> 
> ```
> Traceback (most recent call last):
>   File "/home/chapoton/sage/src/bin/sage-runtests", line 159, in <module>
>     exit_code_pytest = pytest.main(pytest_options + args)
> TypeError: can only concatenate list (not "Namespace") to list
> ```
> I have not idea how to fix that, and what this line is supposed to achieve. Pytest experts should explain.


I do not have such failure on my side. Only the line:

```
Pytest is not installed, skip checking tests that rely on it.
```
How can I reproduce the typeerror you mention?



---

archive/issue_comments_464121.json:
```json
{
    "body": "Ah, alors ca doit venir du fait que j'ai install\u00e9 pytest.\n\n`pip install pytest`\n\nDans la ligne\n\n```\nexit_code_pytest = pytest.main(pytest_options + args)\n```\nil faut remplacer args (une sorte de dictionnaire, en fait un `NameSpace`) par sa partie \"nom de fichiers\".\n\nEDIT: `args.filenames`",
    "created_at": "2021-11-02T19:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464121",
    "user": "https://github.com/fchapoton"
}
```

Ah, alors ca doit venir du fait que j'ai installÃ© pytest.

`pip install pytest`

Dans la ligne

```
exit_code_pytest = pytest.main(pytest_options + args)
```
il faut remplacer args (une sorte de dictionnaire, en fait un `NameSpace`) par sa partie "nom de fichiers".

EDIT: `args.filenames`



---

archive/issue_comments_464122.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-03T11:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464123.json:
```json
{
    "body": "Inspired by the description of #31352, I did one more commit to also provide the filename in the error message, not only the wrong extension.",
    "created_at": "2021-11-03T11:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464123",
    "user": "https://github.com/seblabbe"
}
```

Inspired by the description of #31352, I did one more commit to also provide the filename in the error message, not only the wrong extension.



---

archive/issue_comments_464124.json:
```json
{
    "body": "Replying to [comment:6 chapoton]:\n> Dans la ligne\n> \n> ```\n> exit_code_pytest = pytest.main(pytest_options + args)\n> ```\n> il faut remplacer args (une sorte de dictionnaire, en fait un `NameSpace`) par sa partie \"nom de fichiers\".\n> \n> EDIT: `args.filenames`\n\n\nI prefer to do it in another ticket: see #32818 (needs review).",
    "created_at": "2021-11-03T11:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464124",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:6 chapoton]:
> Dans la ligne
> 
> ```
> exit_code_pytest = pytest.main(pytest_options + args)
> ```
> il faut remplacer args (une sorte de dictionnaire, en fait un `NameSpace`) par sa partie "nom de fichiers".
> 
> EDIT: `args.filenames`


I prefer to do it in another ticket: see #32818 (needs review).



---

archive/issue_comments_464125.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-03T15:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464125",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464126.json:
```json
{
    "body": "ok, alors allons-y",
    "created_at": "2021-11-03T15:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464126",
    "user": "https://github.com/fchapoton"
}
```

ok, alors allons-y



---

archive/issue_comments_464127.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-11-14T17:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32813#issuecomment-464127",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086800.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-14T17:05:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32813",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32813#event-86800"
}
```
