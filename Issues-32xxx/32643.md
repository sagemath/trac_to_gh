# Issue 32643: fix a problem in is_connected

archive/issues_032406.json:
```json
{
    "body": "\n\nCC:  @dcoudert @kliem\n\nBranch/Commit: c616d52bfeda725ca1d6ae4231489e8d4ce0cd60\n\nReviewer: David Coudert\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32643\n\n",
    "closed_at": "2021-10-19T20:31:50Z",
    "created_at": "2021-10-06T12:53:07Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "fix a problem in is_connected",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32643",
    "user": "https://github.com/fchapoton"
}
```


CC:  @dcoudert @kliem

Branch/Commit: c616d52bfeda725ca1d6ae4231489e8d4ce0cd60

Reviewer: David Coudert

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32643





---

archive/issue_comments_461720.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-06T12:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461720",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_461721.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2021-10-06T12:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461721",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_461722.json:
```json
{
    "body": "<a id='comment:2'></a>I'm not sure it's the right way to fix the issue. Several backends (`CGraphBackend`, `StaticSparseCGraph`, etc.) have a method `num_edges` (and also `num_verts`), but I'm a bit lost in the inclusion of classes. May be we should instead add missing instances of `num_edges` and `num_verts`.",
    "created_at": "2021-10-06T15:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461722",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:2'></a>I'm not sure it's the right way to fix the issue. Several backends (`CGraphBackend`, `StaticSparseCGraph`, etc.) have a method `num_edges` (and also `num_verts`), but I'm a bit lost in the inclusion of classes. May be we should instead add missing instances of `num_edges` and `num_verts`.



---

archive/issue_comments_461723.json:
```json
{
    "body": "<a id='comment:3'></a>well, doctests do pass...",
    "created_at": "2021-10-06T15:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461723",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>well, doctests do pass...



---

archive/issue_comments_461724.json:
```json
{
    "body": "<a id='comment:4'></a>The problem is that we are trying to access `num_edges` in `CGraph` or a derived class and this just does not exist.\n\n`num_edges` of `CGraphBackend` is not what we want, I would say. Way too slow for a quick sanity check.\nLocks good so far.\nMaybe we could improve the sanity check for the undirected case:\n\n```\nif (self._directed and cg.num_arcs < cg.num_verts - 1) or (not self._directed and cg.num_arcs / 2 < cg.num_verts - 1):\n```",
    "created_at": "2021-10-06T18:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461724",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>The problem is that we are trying to access `num_edges` in `CGraph` or a derived class and this just does not exist.

`num_edges` of `CGraphBackend` is not what we want, I would say. Way too slow for a quick sanity check.
Locks good so far.
Maybe we could improve the sanity check for the undirected case:

```
if (self._directed and cg.num_arcs < cg.num_verts - 1) or (not self._directed and cg.num_arcs / 2 < cg.num_verts - 1):
```



---

archive/issue_comments_461725.json:
```json
{
    "body": "<a id='comment:5'></a>are you sure that there are two arcs for every edge in the undirected case ?",
    "created_at": "2021-10-07T06:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461725",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>are you sure that there are two arcs for every edge in the undirected case ?



---

archive/issue_comments_461726.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-07T07:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461726",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_461727.json:
```json
{
    "body": "<a id='comment:6'></a>You are right, the safest test is what you proposed. So let us go with this solution, and if we have a smarter solution for undirected graphs later, we can open another ticket.",
    "created_at": "2021-10-07T07:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461727",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>You are right, the safest test is what you proposed. So let us go with this solution, and if we have a smarter solution for undirected graphs later, we can open another ticket.



---

archive/issue_comments_461728.json:
```json
{
    "body": "<a id='comment:7'></a>From `c_graph.pyx`:\n\n```\n2342     cpdef add_edge(self, object u, object v, object l, bint directed):\n...\n2440         if not directed and self._directed and v_int != u_int:\n2441             cg.add_arc_label_unsafe(v_int, u_int, l_int)\n```\n\nBut this is also how `num_edges` works. I guess it is better and safer to call `self.num_edges(self._directed)`. It's rather quick actually.",
    "created_at": "2021-10-07T07:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461728",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>From `c_graph.pyx`:

```
2342     cpdef add_edge(self, object u, object v, object l, bint directed):
...
2440         if not directed and self._directed and v_int != u_int:
2441             cg.add_arc_label_unsafe(v_int, u_int, l_int)
```

But this is also how `num_edges` works. I guess it is better and safer to call `self.num_edges(self._directed)`. It's rather quick actually.



---

archive/issue_comments_461729.json:
```json
{
    "body": "<a id='comment:8'></a>so backs to needs work ?",
    "created_at": "2021-10-07T07:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461729",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>so backs to needs work ?



---

archive/issue_comments_461730.json:
```json
{
    "body": "<a id='comment:9'></a>The current fix is:\n\n```diff\n-        if cg.num_edges() < cg.num_verts - 1:\n+        if cg.num_arcs < cg.num_verts - 1:\n```\n\nI would propose instead\n\n```diff\n-        if cg.num_edges() < cg.num_verts - 1:\n+        if self.num_edges(self._directed) < cg.num_verts - 1:\n```\n\nBoth seems to work fine. The later one should help to detect a bit more cases.\nHowever, its not super important, as graphs with fewer edges than vertices minus 1 fail quickly anyway.",
    "created_at": "2021-10-07T07:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461730",
    "user": "https://github.com/kliem"
}
```

<a id='comment:9'></a>The current fix is:

```diff
-        if cg.num_edges() < cg.num_verts - 1:
+        if cg.num_arcs < cg.num_verts - 1:
```

I would propose instead

```diff
-        if cg.num_edges() < cg.num_verts - 1:
+        if self.num_edges(self._directed) < cg.num_verts - 1:
```

Both seems to work fine. The later one should help to detect a bit more cases.
However, its not super important, as graphs with fewer edges than vertices minus 1 fail quickly anyway.



---

archive/issue_comments_461731.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32643#issuecomment-461731",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086468.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-19T20:31:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32643",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32643#event-86468"
}
```
