# Issue 32414: Meta-ticket: New modules providing abstract base classes to enable modularization

archive/issues_032177.json:
```json
{
    "body": "`git grep 'import.* is_[A-Z]'` (or `git grep 'import.*is_[A-Z]' | grep -E -v 'is_(Ring|Matrix)[^A-Z]'  | grep -v 'sage:'`) reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\nThis pattern is an obstacle to modularization.\n\nThe ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard:\nThe module providing the class must be installed so that the import does not fail.\n\nThis can of course be worked around by `try... except` around `import`, as done for example in #32455, but we should avoid cluttering the code with this type of workaround.\n\nInstead we propose to create stub classes (abstract base classes) in `sage.structure.element`, `sage.structure.parent`, and/or `sage.PAC.KAGE.abc`, and make the actual implementation classes subclasses (mostly, unique direct subclasses). This pattern already exists in the Sage code for a few existing classes:\n- `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)\n- `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n\nWe add the following new classes:\n- #32566/#32610/#32612: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n\n- #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n\n- #32660: Add `sage.rings.abc.AlgebraicField` etc., deprecate `is_AlgebraicField`\n\n- #32750: `sage.rings.abc`: Add `pAdicRing`, `pAdicField`; deprecate `is_pAdic...`\n\n- #32638/#32665: in `sage.structure.element`, a class `Expression`\n  - the existing class `sage.symbolic.expression.Expression` will be its only subclass\n  - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n\n- #32637: in `sage.geometry.abc`, a class `Polyhedron`\n  - `Polyhedron_base` will be its only direct subclass\n\n- #32709: `sage.structure.element`: Add ABCs `Polynomial`, `MPolynomial` for `isinstance` testing\n\n- #34804 Deprecate `sage.interfaces` `is_...Element` functions\n\n- #32664 Deprecate `is_FiniteField`, make `sage.rings.finite_rings` a namespace package\n\n\nTechnical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)\n\nAs of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** #32637 adds doctests to document and enforce this design. Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.\n\nTickets not needed for modularization, but removing `is_` functions in favor of `isinstance` for uniformity of the codebase:\n- #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`\n- #34307 Deprecate `is_Polyhedron`, `is_Cone`, `is_LatticePolytope`\n\n\n\n**CC:**  @tscrim @fchapoton @kliem\n\nIssue created by migration from https://trac.sagemath.org/ticket/32414\n\n",
    "created_at": "2021-08-24T18:41:40Z",
    "labels": [
        "component: refactoring",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: New modules providing abstract base classes to enable modularization",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32414",
    "user": "https://github.com/mkoeppe"
}
```
`git grep 'import.* is_[A-Z]'` (or `git grep 'import.*is_[A-Z]' | grep -E -v 'is_(Ring|Matrix)[^A-Z]'  | grep -v 'sage:'`) reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
This pattern is an obstacle to modularization.

The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard:
The module providing the class must be installed so that the import does not fail.

This can of course be worked around by `try... except` around `import`, as done for example in #32455, but we should avoid cluttering the code with this type of workaround.

Instead we propose to create stub classes (abstract base classes) in `sage.structure.element`, `sage.structure.parent`, and/or `sage.PAC.KAGE.abc`, and make the actual implementation classes subclasses (mostly, unique direct subclasses). This pattern already exists in the Sage code for a few existing classes:
- `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)
- `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)

We add the following new classes:
- #32566/#32610/#32612: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.

- #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`

- #32660: Add `sage.rings.abc.AlgebraicField` etc., deprecate `is_AlgebraicField`

- #32750: `sage.rings.abc`: Add `pAdicRing`, `pAdicField`; deprecate `is_pAdic...`

- #32638/#32665: in `sage.structure.element`, a class `Expression`
  - the existing class `sage.symbolic.expression.Expression` will be its only subclass
  - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)

- #32637: in `sage.geometry.abc`, a class `Polyhedron`
  - `Polyhedron_base` will be its only direct subclass

- #32709: `sage.structure.element`: Add ABCs `Polynomial`, `MPolynomial` for `isinstance` testing

- #34804 Deprecate `sage.interfaces` `is_...Element` functions

- #32664 Deprecate `is_FiniteField`, make `sage.rings.finite_rings` a namespace package


Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)

As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** #32637 adds doctests to document and enforce this design. Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.

Tickets not needed for modularization, but removing `is_` functions in favor of `isinstance` for uniformity of the codebase:
- #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`
- #34307 Deprecate `is_Polyhedron`, `is_Cone`, `is_LatticePolytope`



**CC:**  @tscrim @fchapoton @kliem

Issue created by migration from https://trac.sagemath.org/ticket/32414





---

archive/issue_comments_526893.json:
```json
{
    "body": "<a id='comment:1'></a>\nI find this in general bothering that there are tons of modules etc. being imported (even at startup), just because some `isinstance` check.\n\n- The best I can come up with for the second is the following:\n\n```\n_Polyhedron_base = None\n\nclass _dummy:\n    pass\n\ndef is_polyhedron(P):\n    global _Polyhedron_base\n    if _Polyhedron_base is not None:\n        return isinstance(P, _Polyhedron_base)\n    try:\n        from sage.geometry.polyhedron.base import Polyhedron_base\n        _Polyhedron_base = Polyhedron_base\n        return isinstance(P, Polyhedron_base)\n    except ImportError:\n        _Polyhedron_base = _dummy\n        return False\n```\n\n  Apparently its a slow down of about 50 percent, when the import is found, otherwise much more.\n\n- The first thing is even faster (`isinstance(P, Polyhedron_containment_check)` is about 75 percent of `isinstance(P, Polyhedron_base)`), but I don't know how much another stupid inheritance slows down the actual class.\n\n  I would prefer a unique name scheme that can be used throughout sage. `_base` is already in use. Could as well be the original class name with a leading underscore to discourage people to use it for anything else, e.g. `_Polyhedron_base`, `_Expression`.",
    "created_at": "2021-08-24T21:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526893",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>
I find this in general bothering that there are tons of modules etc. being imported (even at startup), just because some `isinstance` check.

- The best I can come up with for the second is the following:

```
_Polyhedron_base = None

class _dummy:
    pass

def is_polyhedron(P):
    global _Polyhedron_base
    if _Polyhedron_base is not None:
        return isinstance(P, _Polyhedron_base)
    try:
        from sage.geometry.polyhedron.base import Polyhedron_base
        _Polyhedron_base = Polyhedron_base
        return isinstance(P, Polyhedron_base)
    except ImportError:
        _Polyhedron_base = _dummy
        return False
```

  Apparently its a slow down of about 50 percent, when the import is found, otherwise much more.

- The first thing is even faster (`isinstance(P, Polyhedron_containment_check)` is about 75 percent of `isinstance(P, Polyhedron_base)`), but I don't know how much another stupid inheritance slows down the actual class.

  I would prefer a unique name scheme that can be used throughout sage. `_base` is already in use. Could as well be the original class name with a leading underscore to discourage people to use it for anything else, e.g. `_Polyhedron_base`, `_Expression`.



---

archive/issue_comments_526894.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,11 +1,13 @@\n `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\n \n-This pattern is an obstacle to modularization. (The recent trend to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n+This pattern is an obstacle to modularization. (The ongoing effort (#12824, ..., #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n \n We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.\n \n Possible implementation strategies:\n - Introduce stub classes, make the actual implementation classes subclasses. For example, define class `Expression_base`; make `Expression` a subclass; `is_Expression(x)` tests `isinstance(x, Expression_base`\n+  - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)\n+\n - `try: import ... except ImportError: return False`\n \n \n``````\n",
    "created_at": "2021-08-24T22:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526894",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,11 +1,13 @@
 `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
 
-This pattern is an obstacle to modularization. (The recent trend to replace this pattern by importing the class and `isinstance` does not help in this regard.)
+This pattern is an obstacle to modularization. (The ongoing effort (#12824, ..., #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)
 
 We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.
 
 Possible implementation strategies:
 - Introduce stub classes, make the actual implementation classes subclasses. For example, define class `Expression_base`; make `Expression` a subclass; `is_Expression(x)` tests `isinstance(x, Expression_base`
+  - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)
+
 - `try: import ... except ImportError: return False`
 
 
``````




---

archive/issue_comments_526895.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,12 +1,13 @@\n `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\n \n-This pattern is an obstacle to modularization. (The ongoing effort (#12824, ..., #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n+This pattern is an obstacle to modularization. (The ongoing effort (#12824, ..., #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n \n We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.\n \n Possible implementation strategies:\n - Introduce stub classes, make the actual implementation classes subclasses. For example, define class `Expression_base`; make `Expression` a subclass; `is_Expression(x)` tests `isinstance(x, Expression_base`\n   - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)\n+  - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n \n - `try: import ... except ImportError: return False`\n \n``````\n",
    "created_at": "2021-08-24T22:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526895",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,12 +1,13 @@
 `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
 
-This pattern is an obstacle to modularization. (The ongoing effort (#12824, ..., #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)
+This pattern is an obstacle to modularization. (The ongoing effort (#12824, ..., #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)
 
 We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.
 
 Possible implementation strategies:
 - Introduce stub classes, make the actual implementation classes subclasses. For example, define class `Expression_base`; make `Expression` a subclass; `is_Expression(x)` tests `isinstance(x, Expression_base`
   - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)
+  - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
 
 - `try: import ... except ImportError: return False`
 
``````




---

archive/issue_comments_526896.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\n \n-This pattern is an obstacle to modularization. (The ongoing effort (#12824, ..., #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n+This pattern is an obstacle to modularization. (The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, ..., #24443, #28470, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n \n We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.\n \n``````\n",
    "created_at": "2021-08-24T22:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526896",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
 
-This pattern is an obstacle to modularization. (The ongoing effort (#12824, ..., #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)
+This pattern is an obstacle to modularization. (The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, ..., #24443, #28470, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)
 
 We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.
 
``````




---

archive/issue_comments_526897.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\n \n-This pattern is an obstacle to modularization. (The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, ..., #24443, #28470, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n+This pattern is an obstacle to modularization. (The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n \n We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.\n \n``````\n",
    "created_at": "2021-08-24T22:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526897",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
 
-This pattern is an obstacle to modularization. (The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, ..., #24443, #28470, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)
+This pattern is an obstacle to modularization. (The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)
 
 We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.
 
``````




---

archive/issue_comments_526898.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks for these thoughts and experiments. I also prefer the approach using new base classes; and also I have learned more about the multiyear effort to get rid of `is_...` methods. I have updated the ticket description accordingly",
    "created_at": "2021-08-24T23:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526898",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Thanks for these thoughts and experiments. I also prefer the approach using new base classes; and also I have learned more about the multiyear effort to get rid of `is_...` methods. I have updated the ticket description accordingly



---

archive/issue_comments_526899.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,14 +1,19 @@\n `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\n \n-This pattern is an obstacle to modularization. (The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)\n+This pattern is an obstacle to modularization.\n \n-We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.\n-\n-Possible implementation strategies:\n-- Introduce stub classes, make the actual implementation classes subclasses. For example, define class `Expression_base`; make `Expression` a subclass; `is_Expression(x)` tests `isinstance(x, Expression_base`\n-  - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)\n-  - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n-\n-- `try: import ... except ImportError: return False`\n+The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.\n \n \n+We propose to create stub classes in `sage.structure.element`, `sage.structure.parent` or in similar basic required modules, and make the actual implementation classes subclasses. This is already done for a few existing classes:\n+- `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)\n+- `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n+\n+We add the following new stub classes:\n+- in `sage.structure.element`, a class `Expression`\n+  - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n+  - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n+\n+- in `sage.structure.element`, a class `Polyhedron`\n+  - `Polyhedron_base` will be its only subclass\n+\n``````\n",
    "created_at": "2021-08-24T23:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526899",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,14 +1,19 @@
 `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
 
-This pattern is an obstacle to modularization. (The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.)
+This pattern is an obstacle to modularization.
 
-We propose to move `is_...` methods into separate Python/Cython modules that can be imported even if the underlying implementation is not present.  For example, if `sagemath-symbolics` is not present, then `is_Expression` should just return `False` for every input.
-
-Possible implementation strategies:
-- Introduce stub classes, make the actual implementation classes subclasses. For example, define class `Expression_base`; make `Expression` a subclass; `is_Expression(x)` tests `isinstance(x, Expression_base`
-  - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)
-  - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
-
-- `try: import ... except ImportError: return False`
+The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.
 
 
+We propose to create stub classes in `sage.structure.element`, `sage.structure.parent` or in similar basic required modules, and make the actual implementation classes subclasses. This is already done for a few existing classes:
+- `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)
+- `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
+
+We add the following new stub classes:
+- in `sage.structure.element`, a class `Expression`
+  - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
+  - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
+
+- in `sage.structure.element`, a class `Polyhedron`
+  - `Polyhedron_base` will be its only subclass
+
``````




---

archive/issue_events_296148.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-24T23:08:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "rename": {
        "from": "Move is_... functions to separate modules to enable modularization",
        "to": "Replace some is_... functions by isinstance with new base classes to enable modularization"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32414#event-296148"
}
```



---

archive/issue_comments_526900.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,4 +16,4 @@\n \n - in `sage.structure.element`, a class `Polyhedron`\n   - `Polyhedron_base` will be its only subclass\n-\n+  - `Polyhedron.__new__` delegates to what is now `sage.geometry.polyhedron.constructor.Polyhedron`\n``````\n",
    "created_at": "2021-08-24T23:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526900",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,4 +16,4 @@
 
 - in `sage.structure.element`, a class `Polyhedron`
   - `Polyhedron_base` will be its only subclass
-
+  - `Polyhedron.__new__` delegates to what is now `sage.geometry.polyhedron.constructor.Polyhedron`
``````




---

archive/issue_comments_526901.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/replace_some_is_____functions_by_isinstance_with_new_base_classes_to_enable_modularization](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/replace_some_is_____functions_by_isinstance_with_new_base_classes_to_enable_modularization)",
    "created_at": "2021-08-25T01:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526901",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/replace_some_is_____functions_by_isinstance_with_new_base_classes_to_enable_modularization](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/replace_some_is_____functions_by_isinstance_with_new_base_classes_to_enable_modularization)



---

archive/issue_comments_526902.json:
```json
{
    "body": "**Commit:** [f7f15a7a973cbd025d373a6eb63a8e341347fc37](https://github.com/sagemath/sagetrac-mirror/commit/f7f15a7a973cbd025d373a6eb63a8e341347fc37)",
    "created_at": "2021-08-25T01:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526902",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [f7f15a7a973cbd025d373a6eb63a8e341347fc37](https://github.com/sagemath/sagetrac-mirror/commit/f7f15a7a973cbd025d373a6eb63a8e341347fc37)



---

archive/issue_comments_526903.json:
```json
{
    "body": "<a id='comment:10'></a>\nHere's an attempt for `Polyhedron`. Still need to do some trick to make the constructor's docstring available\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f0345b6331c8c5c9b4903241df525bed19fa2c8\">4f0345b</a></td><td><code>sage.structure.element.Polyhedron: New base class / constructor</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7f15a7a973cbd025d373a6eb63a8e341347fc37\">f7f15a7</a></td><td><code>is_Polyhedron: Deprecate</code></td></tr></table>\n",
    "created_at": "2021-08-25T01:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Here's an attempt for `Polyhedron`. Still need to do some trick to make the constructor's docstring available

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f0345b6331c8c5c9b4903241df525bed19fa2c8">4f0345b</a></td><td><code>sage.structure.element.Polyhedron: New base class / constructor</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7f15a7a973cbd025d373a6eb63a8e341347fc37">f7f15a7</a></td><td><code>is_Polyhedron: Deprecate</code></td></tr></table>




---

archive/issue_comments_526904.json:
```json
{
    "body": "**Author:** Matthias Koeppe, ...",
    "created_at": "2021-08-25T21:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526904",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe, ...



---

archive/issue_comments_526905.json:
```json
{
    "body": "<a id='comment:12'></a>\nFor getting the docstring I have tried to make `__doc__` a property, but this approach does not seem to work for Cython classes...",
    "created_at": "2021-08-29T01:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526905",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
For getting the docstring I have tried to make `__doc__` a property, but this approach does not seem to work for Cython classes...



---

archive/issue_comments_526906.json:
```json
{
    "body": "**Changing commit** from \"[f7f15a7a973cbd025d373a6eb63a8e341347fc37](https://github.com/sagemath/sagetrac-mirror/commit/f7f15a7a973cbd025d373a6eb63a8e341347fc37)\" to \"[9552be948c0b50d3e84499abdfd57d8ea1a7d872](https://github.com/sagemath/sagetrac-mirror/commit/9552be948c0b50d3e84499abdfd57d8ea1a7d872)\".",
    "created_at": "2021-08-29T01:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526906",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f7f15a7a973cbd025d373a6eb63a8e341347fc37](https://github.com/sagemath/sagetrac-mirror/commit/f7f15a7a973cbd025d373a6eb63a8e341347fc37)" to "[9552be948c0b50d3e84499abdfd57d8ea1a7d872](https://github.com/sagemath/sagetrac-mirror/commit/9552be948c0b50d3e84499abdfd57d8ea1a7d872)".



---

archive/issue_comments_526907.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9552be948c0b50d3e84499abdfd57d8ea1a7d872\">9552be9</a></td><td><code>WIP: Try to make `__doc__` a class property</code></td></tr></table>\n",
    "created_at": "2021-08-29T01:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526907",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9552be948c0b50d3e84499abdfd57d8ea1a7d872">9552be9</a></td><td><code>WIP: Try to make `__doc__` a class property</code></td></tr></table>




---

archive/issue_comments_526908.json:
```json
{
    "body": "<a id='comment:14'></a>\nI think I'll need some help from Cython experts here...",
    "created_at": "2021-09-03T19:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526908",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
I think I'll need some help from Cython experts here...



---

archive/issue_comments_526909.json:
```json
{
    "body": "<a id='comment:15'></a>\nI think you're running into the fact that the Python special double underscore methods are handled in a special way. I don't know too much about how that's done, but that that is my recollection.",
    "created_at": "2021-09-03T21:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526909",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
I think you're running into the fact that the Python special double underscore methods are handled in a special way. I don't know too much about how that's done, but that that is my recollection.



---

archive/issue_comments_526910.json:
```json
{
    "body": "<a id='comment:16'></a>\nA different approach would be to keep the base class / constructor in `sage.geometry.polyhedron.constructor` (similar to the branch of #26366) and to assign this module to the distribution `sagemath-categories`.",
    "created_at": "2021-09-08T03:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526910",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
A different approach would be to keep the base class / constructor in `sage.geometry.polyhedron.constructor` (similar to the branch of #26366) and to assign this module to the distribution `sagemath-categories`.



---

archive/issue_comments_526911.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,10 +10,10 @@\n - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n \n We add the following new stub classes:\n-- in `sage.structure.element`, a class `Expression`\n+- in `sage.structure.element` (or `sage.symbolic.constructor`?), a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n \n-- in `sage.structure.element`, a class `Polyhedron`\n+- in `sage.structure.element` (or `sage.geometry.polyhedron.constructor`?), a class `Polyhedron`\n   - `Polyhedron_base` will be its only subclass\n   - `Polyhedron.__new__` delegates to what is now `sage.geometry.polyhedron.constructor.Polyhedron`\n``````\n",
    "created_at": "2021-09-08T03:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526911",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,10 +10,10 @@
 - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
 
 We add the following new stub classes:
-- in `sage.structure.element`, a class `Expression`
+- in `sage.structure.element` (or `sage.symbolic.constructor`?), a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
 
-- in `sage.structure.element`, a class `Polyhedron`
+- in `sage.structure.element` (or `sage.geometry.polyhedron.constructor`?), a class `Polyhedron`
   - `Polyhedron_base` will be its only subclass
   - `Polyhedron.__new__` delegates to what is now `sage.geometry.polyhedron.constructor.Polyhedron`
``````




---

archive/issue_comments_526912.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,10 +10,13 @@\n - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n \n We add the following new stub classes:\n-- in `sage.structure.element` (or `sage.symbolic.constructor`?), a class `Expression`\n+- in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n \n-- in `sage.structure.element` (or `sage.geometry.polyhedron.constructor`?), a class `Polyhedron`\n-  - `Polyhedron_base` will be its only subclass\n-  - `Polyhedron.__new__` delegates to what is now `sage.geometry.polyhedron.constructor.Polyhedron`\n+- in `sage.geometry.polyhedron.abc`, a class `Polyhedron`\n+  - `Polyhedron_base` will be its only direct subclass\n+\n+- #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n+\n+\n``````\n",
    "created_at": "2021-09-26T06:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526912",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,10 +10,13 @@
 - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
 
 We add the following new stub classes:
-- in `sage.structure.element` (or `sage.symbolic.constructor`?), a class `Expression`
+- in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
 
-- in `sage.structure.element` (or `sage.geometry.polyhedron.constructor`?), a class `Polyhedron`
-  - `Polyhedron_base` will be its only subclass
-  - `Polyhedron.__new__` delegates to what is now `sage.geometry.polyhedron.constructor.Polyhedron`
+- in `sage.geometry.polyhedron.abc`, a class `Polyhedron`
+  - `Polyhedron_base` will be its only direct subclass
+
+- #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
+
+
``````




---

archive/issue_comments_526913.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.\n \n \n-We propose to create stub classes in `sage.structure.element`, `sage.structure.parent` or in similar basic required modules, and make the actual implementation classes subclasses. This is already done for a few existing classes:\n+We propose to create stub classes in `sage.structure.element`, `sage.structure.parent`, and/or `sage.PAC.KAGE.abc`, and make the actual implementation classes subclasses (mostly, unique direct subclasses). This is already done for a few existing classes:\n - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)\n - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n \n``````\n",
    "created_at": "2021-09-26T16:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526913",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.
 
 
-We propose to create stub classes in `sage.structure.element`, `sage.structure.parent` or in similar basic required modules, and make the actual implementation classes subclasses. This is already done for a few existing classes:
+We propose to create stub classes in `sage.structure.element`, `sage.structure.parent`, and/or `sage.PAC.KAGE.abc`, and make the actual implementation classes subclasses (mostly, unique direct subclasses). This is already done for a few existing classes:
 - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)
 - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
 
``````




---

archive/issue_comments_526914.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,16 @@\n `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\n-\n This pattern is an obstacle to modularization.\n \n-The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.\n+The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard:\n+The module providing the class must be installed so that the import does not fail.\n \n+This can of course be worked around by `try... except` around `import`, as done for example in #32455, but we should avoid cluttering the code with this type of workaround.\n \n-We propose to create stub classes in `sage.structure.element`, `sage.structure.parent`, and/or `sage.PAC.KAGE.abc`, and make the actual implementation classes subclasses (mostly, unique direct subclasses). This is already done for a few existing classes:\n+Instead we propose to create stub classes (abstract base classes) in `sage.structure.element`, `sage.structure.parent`, and/or `sage.PAC.KAGE.abc`, and make the actual implementation classes subclasses (mostly, unique direct subclasses). This pattern already exists in the Sage code for a few existing classes:\n - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)\n - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n \n-We add the following new stub classes:\n+We add the following new classes:\n - in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n@@ -19,4 +20,7 @@\n \n - #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n \n+Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)\n \n+As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.\n+\n``````\n",
    "created_at": "2021-09-26T17:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526914",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,16 @@
 `git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
-
 This pattern is an obstacle to modularization.
 
-The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard.
+The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard:
+The module providing the class must be installed so that the import does not fail.
 
+This can of course be worked around by `try... except` around `import`, as done for example in #32455, but we should avoid cluttering the code with this type of workaround.
 
-We propose to create stub classes in `sage.structure.element`, `sage.structure.parent`, and/or `sage.PAC.KAGE.abc`, and make the actual implementation classes subclasses (mostly, unique direct subclasses). This is already done for a few existing classes:
+Instead we propose to create stub classes (abstract base classes) in `sage.structure.element`, `sage.structure.parent`, and/or `sage.PAC.KAGE.abc`, and make the actual implementation classes subclasses (mostly, unique direct subclasses). This pattern already exists in the Sage code for a few existing classes:
 - `sage.structure.element` defines a base class `Matrix` (for purposes of the coercion system) and a function `is_Matrix` (see #32347)
 - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
 
-We add the following new stub classes:
+We add the following new classes:
 - in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
@@ -19,4 +20,7 @@
 
 - #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
 
+Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)
 
+As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.
+
``````




---

archive/issue_comments_526915.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/replace_some_is_____functions_by_isinstance_with_new_base_classes_to_enable_modularization](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/replace_some_is_____functions_by_isinstance_with_new_base_classes_to_enable_modularization)\" to \"\".",
    "created_at": "2021-09-26T17:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526915",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/mkoeppe/replace_some_is_____functions_by_isinstance_with_new_base_classes_to_enable_modularization](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/replace_some_is_____functions_by_isinstance_with_new_base_classes_to_enable_modularization)" to "".



---

archive/issue_comments_526916.json:
```json
{
    "body": "**Changing commit** from \"[9552be948c0b50d3e84499abdfd57d8ea1a7d872](https://github.com/sagemath/sagetrac-mirror/commit/9552be948c0b50d3e84499abdfd57d8ea1a7d872)\" to \"\".",
    "created_at": "2021-09-26T17:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526916",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[9552be948c0b50d3e84499abdfd57d8ea1a7d872](https://github.com/sagemath/sagetrac-mirror/commit/9552be948c0b50d3e84499abdfd57d8ea1a7d872)" to "".



---

archive/issue_events_296149.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-26T17:11:28Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "rename": {
        "from": "Replace some is_... functions by isinstance with new base classes to enable modularization",
        "to": "Meta-ticket: New modules providing abstract base classes to enable modularization"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32414#event-296149"
}
```



---

archive/issue_comments_526917.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe, ...\" to \"\".",
    "created_at": "2021-09-26T17:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526917",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe, ..." to "".



---

archive/issue_comments_526918.json:
```json
{
    "body": "<a id='comment:21'></a>\nRevised the description - no longer attempt for the abc and the constructor to be the same object. This removes all of the technical difficulties discussed above.",
    "created_at": "2021-09-26T17:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526918",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Revised the description - no longer attempt for the abc and the constructor to be the same object. This removes all of the technical difficulties discussed above.



---

archive/issue_comments_526919.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-`git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\n+`git grep 'import.* is_[A-Z]'` (or `git grep 'import.*is_[A-Z]' | grep -E -v 'is_(Ring|Matrix)[^A-Z]'  | grep -v 'sage:'`) reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.\n This pattern is an obstacle to modularization.\n \n The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard:\n``````\n",
    "created_at": "2021-09-30T18:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526919",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-`git grep 'import.* is_[A-Z]'` reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
+`git grep 'import.* is_[A-Z]'` (or `git grep 'import.*is_[A-Z]' | grep -E -v 'is_(Ring|Matrix)[^A-Z]'  | grep -v 'sage:'`) reveals a common pattern in our code: We import a module just to check whether a user-provided object belongs to a class defined by that module.
 This pattern is an obstacle to modularization.
 
 The ongoing effort (#12824, https://groups.google.com/g/sage-devel/c/wEzb0awmyN0, #13370, #14329, #15076, #15098, #15333, #18173, #24443, #24525, #27593, #28470, #32347) to replace this pattern by importing the class and `isinstance` does not help in this regard:
``````




---

archive/issue_comments_526920.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,15 +11,15 @@\n - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n \n We add the following new classes:\n-- in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n+- #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n+\n+- #32599: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n \n - in `sage.geometry.polyhedron.abc`, a class `Polyhedron`\n   - `Polyhedron_base` will be its only direct subclass\n \n-- #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n-\n Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)\n \n As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.\n``````\n",
    "created_at": "2021-09-30T23:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526920",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,15 +11,15 @@
 - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
 
 We add the following new classes:
-- in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
+- #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
+
+- #32599: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
 
 - in `sage.geometry.polyhedron.abc`, a class `Polyhedron`
   - `Polyhedron_base` will be its only direct subclass
 
-- #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
-
 Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)
 
 As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.
``````




---

archive/issue_comments_526921.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,6 +13,8 @@\n We add the following new classes:\n - #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n \n+- #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n+\n - #32599: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n``````\n",
    "created_at": "2021-10-01T04:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526921",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,6 +13,8 @@
 We add the following new classes:
 - #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
 
+- #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`
+
 - #32599: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
``````




---

archive/issue_comments_526922.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n \n - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n \n-- #32599: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n+- in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n \n``````\n",
    "created_at": "2021-10-02T16:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526922",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,7 +15,7 @@
 
 - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`
 
-- #32599: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
+- in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
 
``````




---

archive/issue_comments_526923.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,7 +11,7 @@\n - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n \n We add the following new classes:\n-- #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n+- #32566/#32610: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n \n - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n \n``````\n",
    "created_at": "2021-10-02T20:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526923",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,7 +11,7 @@
 - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
 
 We add the following new classes:
-- #32566: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
+- #32566/#32610: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
 
 - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`
 
``````




---

archive/issue_comments_526924.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,7 +11,7 @@\n - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)\n \n We add the following new classes:\n-- #32566/#32610: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n+- #32566/#32610/#32612: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.\n \n - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n \n``````\n",
    "created_at": "2021-10-04T01:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526924",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,7 +11,7 @@
 - `sage.structure.parent` defines a base class `Set_generic`; using it with `isinstance` has replaced use of the earlier `is_Set` function (#24443, #28470)
 
 We add the following new classes:
-- #32566/#32610: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
+- #32566/#32610/#32612: `sage.rings.abc` defines base class `RealDoubleField` for `sage.rings.real_double.RealDoubleField_class` etc.
 
 - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`
 
``````




---

archive/issue_comments_526925.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n \n-- in `sage.geometry.polyhedron.abc`, a class `Polyhedron`\n+- #32637: in `sage.geometry.abc`, a class `Polyhedron`\n   - `Polyhedron_base` will be its only direct subclass\n \n Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)\n``````\n",
    "created_at": "2021-10-05T17:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526925",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
 
-- in `sage.geometry.polyhedron.abc`, a class `Polyhedron`
+- #32637: in `sage.geometry.abc`, a class `Polyhedron`
   - `Polyhedron_base` will be its only direct subclass
 
 Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)
``````




---

archive/issue_comments_526926.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n \n - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n \n-- in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n+- #32638: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n \n``````\n",
    "created_at": "2021-10-05T17:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526926",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,7 +15,7 @@
 
 - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`
 
-- in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
+- #32638: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
 
``````




---

archive/issue_comments_526927.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,8 +15,8 @@\n \n - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n \n-- #32638: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`\n-  - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass\n+- #32638: in `sage.structure.element`, a class `Expression`\n+  - the existing class `sage.symbolic.expression.Expression` will be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n \n - #32637: in `sage.geometry.abc`, a class `Polyhedron`\n``````\n",
    "created_at": "2021-10-06T00:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526927",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,8 +15,8 @@
 
 - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`
 
-- #32638: in `sage.structure.element` (or `sage.symbolic.abc`?), a class `Expression`
-  - the existing class `sage.symbolic.expression.Expression` will be renamed to `Expression_pynac` and be its only subclass
+- #32638: in `sage.structure.element`, a class `Expression`
+  - the existing class `sage.symbolic.expression.Expression` will be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
 
 - #32637: in `sage.geometry.abc`, a class `Polyhedron`
``````




---

archive/issue_comments_526928.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,6 +15,10 @@\n \n - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`\n \n+- #32660: Add `sage.rings.abc.AlgebraicField` etc., deprecate `is_AlgebraicField`\n+\n+- #32664: Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`\n+\n - #32638: in `sage.structure.element`, a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n``````\n",
    "created_at": "2021-10-10T19:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526928",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,6 +15,10 @@
 
 - #32606: Replace `is_IntegerModRing` by `isinstance` with new class `sage.rings.abc.IntegerModRing`
 
+- #32660: Add `sage.rings.abc.AlgebraicField` etc., deprecate `is_AlgebraicField`
+
+- #32664: Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`
+
 - #32638: in `sage.structure.element`, a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
``````




---

archive/issue_comments_526929.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n \n - #32664: Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`\n \n-- #32638: in `sage.structure.element`, a class `Expression`\n+- #32638/#32665: in `sage.structure.element`, a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n \n``````\n",
    "created_at": "2021-10-17T02:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526929",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
 
 - #32664: Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`
 
-- #32638: in `sage.structure.element`, a class `Expression`
+- #32638/#32665: in `sage.structure.element`, a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
 
``````




---

archive/issue_comments_526930.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -26,6 +26,8 @@\n - #32637: in `sage.geometry.abc`, a class `Polyhedron`\n   - `Polyhedron_base` will be its only direct subclass\n \n+- #32709: `sage.structure.element`: Add ABCs `Polynomial`, `MPolynomial` for `isinstance` testing\n+\n Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)\n \n As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.\n``````\n",
    "created_at": "2021-10-17T21:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526930",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -26,6 +26,8 @@
 - #32637: in `sage.geometry.abc`, a class `Polyhedron`
   - `Polyhedron_base` will be its only direct subclass
 
+- #32709: `sage.structure.element`: Add ABCs `Polynomial`, `MPolynomial` for `isinstance` testing
+
 Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)
 
 As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.
``````




---

archive/issue_comments_526931.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -30,5 +30,6 @@\n \n Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)\n \n-As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.\n+As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** #32637 adds doctests to document and enforce this design. Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.\n \n+\n``````\n",
    "created_at": "2021-10-18T19:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526931",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -30,5 +30,6 @@
 
 Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)
 
-As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.
+As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** #32637 adds doctests to document and enforce this design. Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.
 
+
``````




---

archive/issue_comments_526932.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -32,4 +32,7 @@\n \n As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** #32637 adds doctests to document and enforce this design. Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.\n \n+Tickets not needed for modularization, but removing `is_` functions in favor of `isinstance` for uniformity of the codebase:\n+- #32664 Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`\n+- #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`\n \n``````\n",
    "created_at": "2021-10-22T20:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526932",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -32,4 +32,7 @@
 
 As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** #32637 adds doctests to document and enforce this design. Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.
 
+Tickets not needed for modularization, but removing `is_` functions in favor of `isinstance` for uniformity of the codebase:
+- #32664 Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`
+- #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`
 
``````




---

archive/issue_comments_526933.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,8 +17,6 @@\n \n - #32660: Add `sage.rings.abc.AlgebraicField` etc., deprecate `is_AlgebraicField`\n \n-- #32664: Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`\n-\n - #32638/#32665: in `sage.structure.element`, a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n``````\n",
    "created_at": "2021-10-22T20:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526933",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,8 +17,6 @@
 
 - #32660: Add `sage.rings.abc.AlgebraicField` etc., deprecate `is_AlgebraicField`
 
-- #32664: Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`
-
 - #32638/#32665: in `sage.structure.element`, a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
``````




---

archive/issue_comments_526934.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,6 +17,8 @@\n \n - #32660: Add `sage.rings.abc.AlgebraicField` etc., deprecate `is_AlgebraicField`\n \n+- #32750: `sage.rings.abc`: Add `pAdicRing`, `pAdicField`; deprecate `is_pAdic...`\n+\n - #32638/#32665: in `sage.structure.element`, a class `Expression`\n   - the existing class `sage.symbolic.expression.Expression` will be its only subclass\n   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)\n``````\n",
    "created_at": "2021-10-24T01:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526934",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,6 +17,8 @@
 
 - #32660: Add `sage.rings.abc.AlgebraicField` etc., deprecate `is_AlgebraicField`
 
+- #32750: `sage.rings.abc`: Add `pAdicRing`, `pAdicField`; deprecate `is_pAdic...`
+
 - #32638/#32665: in `sage.structure.element`, a class `Expression`
   - the existing class `sage.symbolic.expression.Expression` will be its only subclass
   - deprecate `is_Expression`, `is_SymbolicEquation`, `is_CallableSymbolicExpression`, `is_SymbolicVariable`; replace uses by `isinstance(x, Expression)` and a method call (may need a new method `is_callable`)
``````




---

archive/issue_events_296150.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32414#event-296150"
}
```



---

archive/issue_events_296151.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32414#event-296151"
}
```



---

archive/issue_events_296152.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32414#event-296152"
}
```



---

archive/issue_events_296153.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32414#event-296153"
}
```



---

archive/issue_comments_526935.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -35,4 +35,5 @@\n Tickets not needed for modularization, but removing `is_` functions in favor of `isinstance` for uniformity of the codebase:\n - #32664 Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`\n - #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`\n+- #34307 Deprecate `is_Polyhedron`, `is_Cone`, `is_LatticePolytope`\n \n``````\n",
    "created_at": "2022-08-08T15:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526935",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -35,4 +35,5 @@
 Tickets not needed for modularization, but removing `is_` functions in favor of `isinstance` for uniformity of the codebase:
 - #32664 Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`
 - #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`
+- #34307 Deprecate `is_Polyhedron`, `is_Cone`, `is_LatticePolytope`
 
``````




---

archive/issue_events_296154.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32414#event-296154"
}
```



---

archive/issue_events_296155.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32414#event-296155"
}
```



---

archive/issue_comments_526936.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -36,4 +36,6 @@\n - #32664 Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`\n - #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`\n - #34307 Deprecate `is_Polyhedron`, `is_Cone`, `is_LatticePolytope`\n+- #34804 Deprecate `sage.interfaces` `is_...Element` functions\n \n+\n``````\n",
    "created_at": "2022-11-28T19:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526936",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -36,4 +36,6 @@
 - #32664 Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`
 - #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`
 - #34307 Deprecate `is_Polyhedron`, `is_Cone`, `is_LatticePolytope`
+- #34804 Deprecate `sage.interfaces` `is_...Element` functions
 
+
``````




---

archive/issue_comments_526937.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -28,14 +28,17 @@\n \n - #32709: `sage.structure.element`: Add ABCs `Polynomial`, `MPolynomial` for `isinstance` testing\n \n+- #34804 Deprecate `sage.interfaces` `is_...Element` functions\n+\n+- #32664 Deprecate `is_FiniteField`, make `sage.rings.finite_rings` a namespace package\n+\n+\n Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)\n \n As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** #32637 adds doctests to document and enforce this design. Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.\n \n Tickets not needed for modularization, but removing `is_` functions in favor of `isinstance` for uniformity of the codebase:\n-- #32664 Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`\n - #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`\n - #34307 Deprecate `is_Polyhedron`, `is_Cone`, `is_LatticePolytope`\n-- #34804 Deprecate `sage.interfaces` `is_...Element` functions\n \n \n``````\n",
    "created_at": "2022-12-05T22:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32414#issuecomment-526937",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -28,14 +28,17 @@
 
 - #32709: `sage.structure.element`: Add ABCs `Polynomial`, `MPolynomial` for `isinstance` testing
 
+- #34804 Deprecate `sage.interfaces` `is_...Element` functions
+
+- #32664 Deprecate `is_FiniteField`, make `sage.rings.finite_rings` a namespace package
+
+
 Technical limitation: If a `sage.PAC.KAGE.abc` module is intended to provide the new classes, then `sage.PAC.KAGE` must be prepared to become a native namespace package. (See Meta-ticket #32501: Clear out `__init__.py` files in preparation for namespace packages)
 
 As of this ticket, **each of the new abstract base classes is intended to have a unique direct implementation subclass.** #32637 adds doctests to document and enforce this design. Attempting to define new hierarchies of abstract base classes is beyond the scope of this ticket. Also, the new classes do not define any methods.
 
 Tickets not needed for modularization, but removing `is_` functions in favor of `isinstance` for uniformity of the codebase:
-- #32664 Add `sage.rings.abc.FiniteField`, deprecate `is_FiniteField`
 - #32738 Deprecate `is_Algebra`, `is_FreeAlgebra`, `is_QuaternionAlgebra`, `is_SymmetricFunctionAlgebra`
 - #34307 Deprecate `is_Polyhedron`, `is_Cone`, `is_LatticePolytope`
-- #34804 Deprecate `sage.interfaces` `is_...Element` functions
 
 
``````

