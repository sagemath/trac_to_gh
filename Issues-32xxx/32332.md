# Issue 32332: using argparse in sage-runtests script

archive/issues_032095.json:
```json
{
    "body": "instead of the deprecated optparse\n\nThis was rather simple, but needs testing.\n\nalso full flake8 cleanup for the modified file\n\nCC:  @tscrim @slel @kliem @antonio-rojas\n\nReviewer: Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nBranch: c87148b86fe0de11be68a0f01917e45b705e4c83\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32332\n\n",
    "closed_at": "2021-10-09T11:09:57Z",
    "created_at": "2021-08-04T07:54:04Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "using argparse in sage-runtests script",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32332",
    "user": "https://github.com/fchapoton"
}
```
instead of the deprecated optparse

This was rather simple, but needs testing.

also full flake8 cleanup for the modified file

CC:  @tscrim @slel @kliem @antonio-rojas

Reviewer: Travis Scrimshaw

Author: Frédéric Chapoton

Branch: c87148b86fe0de11be68a0f01917e45b705e4c83

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32332





---

archive/issue_comments_457823.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-04T07:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457823",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_457824.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2021-08-04T07:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457824",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_457825.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-04T08:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457826.json:
```json
{
    "body": "<a id='comment:4'></a>LGTM as far as I can tell. A good ticket for the initial 9.5.beta0 release.",
    "created_at": "2021-08-05T05:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457826",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>LGTM as far as I can tell. A good ticket for the initial 9.5.beta0 release.



---

archive/issue_events_085767.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-08-05T05:06:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32332#event-85767"
}
```



---

archive/issue_comments_457827.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-05T05:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457827",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_457828.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-09-05T22:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457828",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_457829.json:
```json
{
    "body": "<a id='comment:5'></a>\n```\nmake ptestlong\n[...]\nmake[1]: Leaving directory '/home/release/Sage'\n./sage -t -p --all --long --logfile=logs/ptestlong.log\nusage: sage -t [options] filenames\nsage-runtests: error: argument -p/--nthreads: expected one argument\nmake: *** [Makefile:201: ptestlong] Error 2\n```",
    "created_at": "2021-09-05T22:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457829",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
```
make ptestlong
[...]
make[1]: Leaving directory '/home/release/Sage'
./sage -t -p --all --long --logfile=logs/ptestlong.log
usage: sage -t [options] filenames
sage-runtests: error: argument -p/--nthreads: expected one argument
make: *** [Makefile:201: ptestlong] Error 2
```



---

archive/issue_comments_457830.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-06T07:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457831.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-06T07:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457832.json:
```json
{
    "body": "<a id='comment:8'></a>ok, should be better now. I fixed the behaviour of -p and --logfile.",
    "created_at": "2021-09-06T07:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457832",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>ok, should be better now. I fixed the behaviour of -p and --logfile.



---

archive/issue_comments_457833.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-06T07:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457833",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_457834.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-06T07:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457835.json:
```json
{
    "body": "<a id='comment:10'></a>There are still issues:\n\n```\n$ ./sage -btp src/sage/combinat/partition.py\n...\nsage-runtests: error: argument -p/--nthreads: invalid int value: 'src/sage/combinat/partition.py'\n$ ./sage -tp src/sage/combinat/partition.py \nusage: sage -t [options] filenames\nsage-runtests: error: argument -p/--nthreads: invalid int value: 'src/sage/combinat/partition.py'\n```\nI at least use these shortcuts a lot, but I guess that is not a strict requirement to have them fixed. It would just mean a lot of relearning for me.\n\nThese both continue to not work (so they don't need to be fixed)\n\n```\n$ ./sage -btp8 src/sage/combinat/partition.py \nError: unknown option: -btp8\n$ ./sage -tp8 src/sage/combinat/partition.py \nError: unknown option: -tp8\n```\nbut this now works (before it didn't):\n\n```\n$ ./sage -t -p8 src/sage/combinat/partition.py\n```",
    "created_at": "2021-09-10T02:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457835",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>There are still issues:

```
$ ./sage -btp src/sage/combinat/partition.py
...
sage-runtests: error: argument -p/--nthreads: invalid int value: 'src/sage/combinat/partition.py'
$ ./sage -tp src/sage/combinat/partition.py 
usage: sage -t [options] filenames
sage-runtests: error: argument -p/--nthreads: invalid int value: 'src/sage/combinat/partition.py'
```
I at least use these shortcuts a lot, but I guess that is not a strict requirement to have them fixed. It would just mean a lot of relearning for me.

These both continue to not work (so they don't need to be fixed)

```
$ ./sage -btp8 src/sage/combinat/partition.py 
Error: unknown option: -btp8
$ ./sage -tp8 src/sage/combinat/partition.py 
Error: unknown option: -tp8
```
but this now works (before it didn't):

```
$ ./sage -t -p8 src/sage/combinat/partition.py
```



---

archive/issue_comments_457836.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-09-10T02:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457836",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_457837.json:
```json
{
    "body": "<a id='comment:11'></a>This may be difficult to fix. What's the point of tp alone, given that the default value for nthreads is 1 ? This amounts to say, parallel, but not parallel.\n\nNote that\n`./sage -tp 8 src/sage/combinat/partition.py`\nworks fine, and same for btp.\n\nThere is an inherent ambiguity in the options\n\n```\n-p filename.py\n```\nthat argparse cannot really handle, if I understand correctly.",
    "created_at": "2021-09-10T11:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457837",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>This may be difficult to fix. What's the point of tp alone, given that the default value for nthreads is 1 ? This amounts to say, parallel, but not parallel.

Note that
`./sage -tp 8 src/sage/combinat/partition.py`
works fine, and same for btp.

There is an inherent ambiguity in the options

```
-p filename.py
```
that argparse cannot really handle, if I understand correctly.



---

archive/issue_comments_457838.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-10T12:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457839.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 chapoton]:\n> This may be difficult to fix. What's the point of tp alone, given that the default value for nthreads is 1 ? This amounts to say, parallel, but not parallel.\n\n\nFrom what I can tell, it does run it in parallel.",
    "created_at": "2021-09-10T21:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457839",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Replying to [comment:11 chapoton]:
> This may be difficult to fix. What's the point of tp alone, given that the default value for nthreads is 1 ? This amounts to say, parallel, but not parallel.


From what I can tell, it does run it in parallel.



---

archive/issue_comments_457840.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-09-11T07:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_457841.json:
```json
{
    "body": "<a id='comment:15'></a>Now the behaviour is\n\n```\nno option -p   =>   nthreads = 1\n-p             =>   nthreads = 0\n-p k           =>   nthreads = k\n```\n\nBut I still do not see how to fix your concern.",
    "created_at": "2021-09-11T07:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457841",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>Now the behaviour is

```
no option -p   =>   nthreads = 1
-p             =>   nthreads = 0
-p k           =>   nthreads = k
```

But I still do not see how to fix your concern.



---

archive/issue_comments_457842.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-11T07:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457843.json:
```json
{
    "body": "<a id='comment:17'></a>I would see a solution to avoid breaking `sage -tp file.py`\n\nbut at the prize of breaking\n\n`sage -tp 4 [...]`\n\nThe idea is to always add the argument 0 to `-p` when using `-tp` or `-btp`.\n\nSo what would you prefer ?\n\nPeople would still be able to use\n\n```\nsage -t -p 4 [...]\n```",
    "created_at": "2021-09-11T08:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457843",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>I would see a solution to avoid breaking `sage -tp file.py`

but at the prize of breaking

`sage -tp 4 [...]`

The idea is to always add the argument 0 to `-p` when using `-tp` or `-btp`.

So what would you prefer ?

People would still be able to use

```
sage -t -p 4 [...]
```



---

archive/issue_comments_457844.json:
```json
{
    "body": "<a id='comment:18'></a>We have the same issue with other options\n\n```\n~/sage$ sage -t --short src/sage/combinat/partition.py \neither use --new or --all or some filenames\n~/sage$ sage -t --warn-long src/sage/combinat/partition.py \neither use --new or --all or some filenames\n```\nA workaround seems to be\n\n```\n~/sage$ sage -t --warn-long -- src/sage/combinat/partition.py \n```",
    "created_at": "2021-09-11T09:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457844",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>We have the same issue with other options

```
~/sage$ sage -t --short src/sage/combinat/partition.py 
either use --new or --all or some filenames
~/sage$ sage -t --warn-long src/sage/combinat/partition.py 
either use --new or --all or some filenames
```
A workaround seems to be

```
~/sage$ sage -t --warn-long -- src/sage/combinat/partition.py 
```



---

archive/issue_comments_457845.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-11T10:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457845",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457846.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-09-11T10:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_457847.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-11T10:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457847",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_457848.json:
```json
{
    "body": "<a id='comment:21'></a>I think I have found a solution. Maybe not perfect.",
    "created_at": "2021-09-11T10:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457848",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>I think I have found a solution. Maybe not perfect.



---

archive/issue_comments_457849.json:
```json
{
    "body": "<a id='comment:22'></a>If we have to make a choice, I personally would prefer `-tp` and `-btp` to work, but that is because it is what I most frequently use. Does your solution keep both input formats?\n\nWhat about `.pyx` (and probably `.pxd` and `.pxi`) files? I think those also need to be added to the list.",
    "created_at": "2021-09-11T10:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457849",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>If we have to make a choice, I personally would prefer `-tp` and `-btp` to work, but that is because it is what I most frequently use. Does your solution keep both input formats?

What about `.pyx` (and probably `.pxd` and `.pxi`) files? I think those also need to be added to the list.



---

archive/issue_comments_457850.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-11T11:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457850",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457851.json:
```json
{
    "body": "<a id='comment:24'></a>Thanks for the suggestion about pyx. I have added that.\n\nI think everything works smoothly now.\n\nWhat would still fail would be something like\n\n```\nsage -tp src/sage/combinat/\n```\nwhich can easily be obtained as\n\n```\nsage -tp 0 src/sage/combinat\n```",
    "created_at": "2021-09-11T11:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457851",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>Thanks for the suggestion about pyx. I have added that.

I think everything works smoothly now.

What would still fail would be something like

```
sage -tp src/sage/combinat/
```
which can easily be obtained as

```
sage -tp 0 src/sage/combinat
```



---

archive/issue_comments_457852.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 chapoton]:\n> What would still fail would be something like\n> \n> ```\n> sage -tp src/sage/combinat/\n> ```\n> which can easily be obtained as\n> \n> ```\n> sage -tp 0 src/sage/combinat\n> ```\n\n\n-1 on making such incompatible changes, it will be annoying to developers",
    "created_at": "2021-09-11T21:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457852",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Replying to [comment:24 chapoton]:
> What would still fail would be something like
> 
> ```
> sage -tp src/sage/combinat/
> ```
> which can easily be obtained as
> 
> ```
> sage -tp 0 src/sage/combinat
> ```


-1 on making such incompatible changes, it will be annoying to developers



---

archive/issue_comments_457853.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-12T07:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457854.json:
```json
{
    "body": "<a id='comment:27'></a>Here is a new proposal. I tried to keep things simple.",
    "created_at": "2021-09-12T07:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457854",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>Here is a new proposal. I tried to keep things simple.



---

archive/issue_comments_457855.json:
```json
{
    "body": "<a id='comment:28'></a>Thank you. We are getting close.\n\n```\n$ ./sage -tp --warn-long src/sage/rings/function_field/function_field.py\n```\nworks, but this does not (although it used to)\n\n```\n$ ./sage -tp src/sage/rings/function_field/function_field.py --warn-long\ntoo few successful tests, not using stored timings\nRunning doctests with ID 2021-09-13-14-49-55-02c83a90.\nGit branch: u/chapoton/32332\nUsing --optional=bliss,build,debian,dochtml,dot2tex,e_antic,libnauty,ninja_build,normaliz,pip,sage,sage_spkg\nTraceback (most recent call last):\n  File \"/home/uqtscrim/sage-build/src/bin/sage-runtests\", line 149, in <module>\n    err = DC.run()\n  File \"/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 1204, in run\n    self.expand_files_into_sources()\n  File \"/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 788, in expand_files_into_sources\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 788, in <listcomp>\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/sources.py\", line 527, in __init__\n    raise ValueError(\"unknown file extension %r\"%ext)\nValueError: unknown file extension ''\n```\nAlthough I could very easily argue that this is not supported behavior, so it might be more luck than anything it worked before. This is a very minor point and not something I would withhold a positive review for.",
    "created_at": "2021-09-13T04:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457855",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>Thank you. We are getting close.

```
$ ./sage -tp --warn-long src/sage/rings/function_field/function_field.py
```
works, but this does not (although it used to)

```
$ ./sage -tp src/sage/rings/function_field/function_field.py --warn-long
too few successful tests, not using stored timings
Running doctests with ID 2021-09-13-14-49-55-02c83a90.
Git branch: u/chapoton/32332
Using --optional=bliss,build,debian,dochtml,dot2tex,e_antic,libnauty,ninja_build,normaliz,pip,sage,sage_spkg
Traceback (most recent call last):
  File "/home/uqtscrim/sage-build/src/bin/sage-runtests", line 149, in <module>
    err = DC.run()
  File "/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/control.py", line 1204, in run
    self.expand_files_into_sources()
  File "/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/control.py", line 788, in expand_files_into_sources
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/control.py", line 788, in <listcomp>
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/sources.py", line 527, in __init__
    raise ValueError("unknown file extension %r"%ext)
ValueError: unknown file extension ''
```
Although I could very easily argue that this is not supported behavior, so it might be more luck than anything it worked before. This is a very minor point and not something I would withhold a positive review for.



---

archive/issue_comments_457856.json:
```json
{
    "body": "<a id='comment:29'></a>I do not think that we should allow options after the filenames.\n\nThe usage is \"options then filenames\", and that's all.",
    "created_at": "2021-09-13T07:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457856",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>I do not think that we should allow options after the filenames.

The usage is "options then filenames", and that's all.



---

archive/issue_comments_457857.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-14T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457858.json:
```json
{
    "body": "<a id='comment:31'></a>Okay, then let's not (unofficially) support that input format anymore.\n\nShouldn't `--short` take floating points? Granted, I find it unlikely that someone will want to do something in `321.0123` seconds, but perhaps for one file they don't want whole seconds? The output for `--short` has also become a lot more verbose. (Not that that is a bad thing, it is just a change in behavior.)\n\nAnyways, this should hopefully be the last of it. The sooner we can get this merged and out for people to test it more in the wild, the better we can pick up other changes in behavior (that people care about).",
    "created_at": "2021-09-15T01:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457858",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>Okay, then let's not (unofficially) support that input format anymore.

Shouldn't `--short` take floating points? Granted, I find it unlikely that someone will want to do something in `321.0123` seconds, but perhaps for one file they don't want whole seconds? The output for `--short` has also become a lot more verbose. (Not that that is a bad thing, it is just a change in behavior.)

Anyways, this should hopefully be the last of it. The sooner we can get this merged and out for people to test it more in the wild, the better we can pick up other changes in behavior (that people care about).



---

archive/issue_comments_457859.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-15T07:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457860.json:
```json
{
    "body": "<a id='comment:33'></a>ok, short was indeed broken by the change of default value. Repaired now.\n\nShort was taking integers and will still take integers. I would prefer not to change that.",
    "created_at": "2021-09-15T07:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457860",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>ok, short was indeed broken by the change of default value. Repaired now.

Short was taking integers and will still take integers. I would prefer not to change that.



---

archive/issue_comments_457861.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-15T09:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457861",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_457862.json:
```json
{
    "body": "<a id='comment:34'></a>Okay, thank you. Let's get this tested by the rest of the developers.",
    "created_at": "2021-09-15T09:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457862",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'></a>Okay, thank you. Let's get this tested by the rest of the developers.



---

archive/issue_comments_457863.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-09-19T22:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457863",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_457864.json:
```json
{
    "body": "<a id='comment:35'></a>\n```\nsage -t --long --warn-long 44.9 --random-seed=0 src/sage/doctest/test.py  # 21 doctests failed\nsage -t --long --warn-long 44.9 --random-seed=0 src/sage/doctest/forker.py  # 11 doctests failed\nsage -t --long --warn-long 44.9 --random-seed=0 src/sage/doctest/control.py  # Bad exit: 1 after testing finished\n```",
    "created_at": "2021-09-19T22:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457864",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>
```
sage -t --long --warn-long 44.9 --random-seed=0 src/sage/doctest/test.py  # 21 doctests failed
sage -t --long --warn-long 44.9 --random-seed=0 src/sage/doctest/forker.py  # 11 doctests failed
sage -t --long --warn-long 44.9 --random-seed=0 src/sage/doctest/control.py  # Bad exit: 1 after testing finished
```



---

archive/issue_comments_457865.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-20T08:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457866.json:
```json
{
    "body": "<a id='comment:37'></a>damn. I have fixed a few things again.",
    "created_at": "2021-09-20T08:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457866",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'></a>damn. I have fixed a few things again.



---

archive/issue_comments_457867.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-20T08:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457867",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_457868.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-21T08:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457868",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_457869.json:
```json
{
    "body": "<a id='comment:38'></a>Green bot and passes locally.",
    "created_at": "2021-09-21T08:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457869",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>Green bot and passes locally.



---

archive/issue_events_085768.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-09T11:09:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32332#event-85768"
}
```



---

archive/issue_comments_457870.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-09T11:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457870",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_457871.json:
```json
{
    "body": "<a id='comment:40'></a>This breaks running `sage -t file --optional=foo` for me, regardless of the optional tags I specify\n\n```\n> sage -t /usr/lib/python3.9/site-packages/sage/sets/integer_range.py --optional=sage\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-10-12-12-41-27-6d41dc7c.\nUsing --optional=dochtml,pip,sage\nTraceback (most recent call last):\n  File \"/usr/bin/sage-runtests\", line 151, in <module>\n    err = DC.run()\n  File \"/usr/lib/python3.9/site-packages/sage/doctest/control.py\", line 1210, in run\n    self.expand_files_into_sources()\n  File \"/usr/lib/python3.9/site-packages/sage/doctest/control.py\", line 794, in expand_files_into_sources\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/usr/lib/python3.9/site-packages/sage/doctest/control.py\", line 794, in <listcomp>\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/usr/lib/python3.9/site-packages/sage/doctest/sources.py\", line 527, in __init__\n    raise ValueError(\"unknown file extension %r\"%ext)\nValueError: unknown file extension ''\n```",
    "created_at": "2021-10-12T10:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457871",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:40'></a>This breaks running `sage -t file --optional=foo` for me, regardless of the optional tags I specify

```
> sage -t /usr/lib/python3.9/site-packages/sage/sets/integer_range.py --optional=sage
too many failed tests, not using stored timings
Running doctests with ID 2021-10-12-12-41-27-6d41dc7c.
Using --optional=dochtml,pip,sage
Traceback (most recent call last):
  File "/usr/bin/sage-runtests", line 151, in <module>
    err = DC.run()
  File "/usr/lib/python3.9/site-packages/sage/doctest/control.py", line 1210, in run
    self.expand_files_into_sources()
  File "/usr/lib/python3.9/site-packages/sage/doctest/control.py", line 794, in expand_files_into_sources
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/usr/lib/python3.9/site-packages/sage/doctest/control.py", line 794, in <listcomp>
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/usr/lib/python3.9/site-packages/sage/doctest/sources.py", line 527, in __init__
    raise ValueError("unknown file extension %r"%ext)
ValueError: unknown file extension ''
```



---

archive/issue_comments_457872.json:
```json
{
    "body": "<a id='comment:42'></a>Nevermind, I see this is intentional (re comment 29)",
    "created_at": "2021-10-12T10:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32332",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32332#issuecomment-457872",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:42'></a>Nevermind, I see this is intentional (re comment 29)
