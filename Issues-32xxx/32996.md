# Issue 32996: Investigate pari-2.13.3 doctest failure

archive/issues_032759.json:
```json
{
    "assignees": [],
    "body": "With earlier versions of pari, this worked:\n\n```\nsage: from sage.lfunctions.pari import lfun_number_field, LFunction\nsage: L = LFunction(lfun_number_field(K))\nsage: L(0)\n0.000000000000000\n```\n\nHowever with pari-2.13.3, it throws a warning:\n\n```\nFile \"src/sage/lfunctions/pari.py\", line 318, in sage.lfunctions.pari.lfun_number_field\nFailed example:\n    L(0)\nExpected:\n    0.000000000000000\nGot:\n      ***   Warning: normalizing a series with 0 leading term.\n    0.000000000000000\n**********************************************************************\n```\n\nAn ellipsis was added in #32797 to keep the test suite passing, but no warning is thrown when performing the same computation in gp:\n\n```\n$ gp -q\n? L = lfuncreate(x^2 - 2);\n? lfun(L,0)\n0\n```\n\nI think we should investigate why our interface to the function throws a warning.\n\n_Issue created by migration from https://trac.sagemath.org/ticket/32996_\n\n",
    "closed_at": "2021-12-13T17:46:18Z",
    "created_at": "2021-12-08T23:42:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Investigate pari-2.13.3 doctest failure",
    "type": "issue",
    "updated_at": "2021-12-13T17:46:18Z",
    "url": "https://github.com/sagemath/sage/issues/32996",
    "user": "https://github.com/orlitzky"
}
```
With earlier versions of pari, this worked:

```
sage: from sage.lfunctions.pari import lfun_number_field, LFunction
sage: L = LFunction(lfun_number_field(K))
sage: L(0)
0.000000000000000
```

However with pari-2.13.3, it throws a warning:

```
File "src/sage/lfunctions/pari.py", line 318, in sage.lfunctions.pari.lfun_number_field
Failed example:
    L(0)
Expected:
    0.000000000000000
Got:
      ***   Warning: normalizing a series with 0 leading term.
    0.000000000000000
**********************************************************************
```

An ellipsis was added in #32797 to keep the test suite passing, but no warning is thrown when performing the same computation in gp:

```
$ gp -q
? L = lfuncreate(x^2 - 2);
? lfun(L,0)
0
```

I think we should investigate why our interface to the function throws a warning.

_Issue created by migration from https://trac.sagemath.org/ticket/32996_





---

archive/issue_events_435785.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-08T23:42:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435785"
}
```



---

archive/issue_events_435786.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-08T23:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435786"
}
```



---

archive/issue_events_435787.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-08T23:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435787"
}
```



---

archive/issue_events_435788.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-08T23:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435788"
}
```



---

archive/issue_comments_535868.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nHm, maybe this should not be papered over in the doctest:\n\n```\n$ gp -q\n? L = lfuncreate(x^2 - 2);\n? lfun(L,0)\n0\n```",
    "created_at": "2021-12-09T00:06:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32996#issuecomment-535868",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:1" align="right">Comment 1</div>

Hm, maybe this should not be papered over in the doctest:

```
$ gp -q
? L = lfuncreate(x^2 - 2);
? lfun(L,0)
0
```



---

archive/issue_comments_535869.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nsee #32797",
    "created_at": "2021-12-09T09:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32996#issuecomment-535869",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">Comment 2</div>

see #32797



---

archive/issue_events_435789.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-09T13:06:25Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "title_is": "Investigate pari-2.13.3 doctest failure",
    "title_was": "fix doctest for pari-2.13.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435789"
}
```



---

archive/issue_comments_535870.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,15 @@\n+With earlier versions of pari, this worked:\n \n ```\n-sage -t --warn-long 10.0 --random-seed=290970252982663646623464893986173482302 src/sage/lfunctions/pari.py\n-**********************************************************************\n+sage: from sage.lfunctions.pari import lfun_number_field, LFunction\n+sage: L = LFunction(lfun_number_field(K))\n+sage: L(0)\n+0.000000000000000\n+```\n+\n+However with pari-2.13.3, it throws a warning:\n+\n+```\n File \"src/sage/lfunctions/pari.py\", line 318, in sage.lfunctions.pari.lfun_number_field\n Failed example:\n     L(0)\n@@ -12,3 +20,14 @@\n     0.000000000000000\n **********************************************************************\n ```\n+\n+An ellipsis was added in #32797 to keep the test suite passing, but no warning is thrown when performing the same computation in gp:\n+\n+```\n+$ gp -q\n+? L = lfuncreate(x^2 - 2);\n+? lfun(L,0)\n+0\n+```\n+\n+I think we should investigate why our interface to the function throws a warning.\n``````\n",
    "created_at": "2021-12-09T13:06:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32996#issuecomment-535870",
    "user": "https://github.com/orlitzky"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,15 @@
+With earlier versions of pari, this worked:
 
 ```
-sage -t --warn-long 10.0 --random-seed=290970252982663646623464893986173482302 src/sage/lfunctions/pari.py
-**********************************************************************
+sage: from sage.lfunctions.pari import lfun_number_field, LFunction
+sage: L = LFunction(lfun_number_field(K))
+sage: L(0)
+0.000000000000000
+```
+
+However with pari-2.13.3, it throws a warning:
+
+```
 File "src/sage/lfunctions/pari.py", line 318, in sage.lfunctions.pari.lfun_number_field
 Failed example:
     L(0)
@@ -12,3 +20,14 @@
     0.000000000000000
 **********************************************************************
 ```
+
+An ellipsis was added in #32797 to keep the test suite passing, but no warning is thrown when performing the same computation in gp:
+
+```
+$ gp -q
+? L = lfuncreate(x^2 - 2);
+? lfun(L,0)
+0
+```
+
+I think we should investigate why our interface to the function throws a warning.
``````




---

archive/issue_comments_535871.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nsage converts 0 to floating point before passing it to pari:\n\n```\n> gp -q\n? L = lfuncreate(x^2 - 2);\n? lfun(L,0)\n0\n? lfun(L,0.0)\n  *** lfun: Warning: normalizing a series with 0 leading term.\n0\n```",
    "created_at": "2021-12-09T14:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32996#issuecomment-535871",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:4" align="right">Comment 4</div>

sage converts 0 to floating point before passing it to pari:

```
> gp -q
? L = lfuncreate(x^2 - 2);
? lfun(L,0)
0
? lfun(L,0.0)
  *** lfun: Warning: normalizing a series with 0 leading term.
0
```



---

archive/issue_comments_535872.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nThanks, I reported upstream at https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2329",
    "created_at": "2021-12-10T01:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32996#issuecomment-535872",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:5" align="right">Comment 5</div>

Thanks, I reported upstream at https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2329



---

archive/issue_events_435790.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-13T15:12:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435790"
}
```



---

archive/issue_events_435791.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-13T15:12:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435791"
}
```



---

archive/issue_events_435792.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-13T15:12:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435792"
}
```



---

archive/issue_comments_535873.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nThe warning is gone in pari/gp git HEAD. Of course we can keep the `...` to support pari-2.13.3 from the system.",
    "created_at": "2021-12-13T15:12:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32996#issuecomment-535873",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:6" align="right">Comment 6</div>

The warning is gone in pari/gp git HEAD. Of course we can keep the `...` to support pari-2.13.3 from the system.



---

archive/issue_events_435793.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-12-13T15:12:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435793"
}
```



---

archive/issue_events_435794.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-12-13T17:46:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435794"
}
```



---

archive/issue_events_435795.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-12-13T17:46:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32996",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32996#event-435795"
}
```
