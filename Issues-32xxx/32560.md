# Issue 32560: Add auto_scaling option to threejs plots

archive/issues_032323.json:
```json
{
    "body": "Up to Sage 9.5.beta4, `threejs_template.html` can\nautomatically scale down the z-axis if the last entry\nof `aspect_ratio` is set to `1` (whether because\nthe user did not specify a value, or because the user\nspecified a value identical to the default value)\nand the plot extends a lot more in the z direction\nthan in the x and y directions.\n\nFor instance, the following example\n\n```\nsage: cubes = sum([cube((0, 0, i)) for i in range(0, 6)])\nsage: cubes.show(aspect_ratio=[1, 1, 1])\n```\nshows a stack of cubes squeezed along the z-axis,\nrather than a stack of undistorted cubes.\n\nThis behavior is unexpected after explicitly\nsetting the aspect ratio.\n\nIn the file `threejs_template.html`,\nthe lines responsible for this behavior are:\n\n```\n    var autoAspect = 2.5;\n    if ( zRange > autoAspect * rRange && a[2] === 1 ) a[2] = autoAspect * rRange / zRange;\n```\n\nThat automatic scaling down was introduced in #12402.\nQuoting from that ticket:\n> There is already automatic scaling in the z-direction\n> to avoid the tall thin box that appears in the current\n> version on the cell server (and SMC), but that can\n> easily be overridden.\n\n\nIt is worth mentioning that one way to overwrite\nthis behavior is to do:\n\n```\nsage: plot.show(aspect_ratio=[1, 1, 0.99999])\n```\n\nThis ticket fixes this behavior and introduces\na new threejs-specific plot option.\n\nThe new option is called  `auto_scaling`\n(default: [False, False, False]) and takes\na list or a tuple of three booleans;\nset to `True` to automatically scale down\nthe corresponding direction if it is too large.\n\n\nCC:  @slel @egourgoulhon @paulmasson\n\nKeywords: threejs, aspect_ratio\n\nBranch/Commit: 89f101edbae884df2d4e41016e0ea7ca3f8befed\n\nReviewer: Matthias Koeppe\n\nAuthor: Laith Rastanawi\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32560\n\n",
    "closed_at": "2022-03-12T15:10:57Z",
    "created_at": "2021-09-25T15:27:25Z",
    "labels": [
        "component: graphics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Add auto_scaling option to threejs plots",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32560",
    "user": "https://github.com/LaisRast"
}
```
Up to Sage 9.5.beta4, `threejs_template.html` can
automatically scale down the z-axis if the last entry
of `aspect_ratio` is set to `1` (whether because
the user did not specify a value, or because the user
specified a value identical to the default value)
and the plot extends a lot more in the z direction
than in the x and y directions.

For instance, the following example

```
sage: cubes = sum([cube((0, 0, i)) for i in range(0, 6)])
sage: cubes.show(aspect_ratio=[1, 1, 1])
```
shows a stack of cubes squeezed along the z-axis,
rather than a stack of undistorted cubes.

This behavior is unexpected after explicitly
setting the aspect ratio.

In the file `threejs_template.html`,
the lines responsible for this behavior are:

```
    var autoAspect = 2.5;
    if ( zRange > autoAspect * rRange && a[2] === 1 ) a[2] = autoAspect * rRange / zRange;
```

That automatic scaling down was introduced in #12402.
Quoting from that ticket:
> There is already automatic scaling in the z-direction
> to avoid the tall thin box that appears in the current
> version on the cell server (and SMC), but that can
> easily be overridden.


It is worth mentioning that one way to overwrite
this behavior is to do:

```
sage: plot.show(aspect_ratio=[1, 1, 0.99999])
```

This ticket fixes this behavior and introduces
a new threejs-specific plot option.

The new option is called  `auto_scaling`
(default: [False, False, False]) and takes
a list or a tuple of three booleans;
set to `True` to automatically scale down
the corresponding direction if it is too large.


CC:  @slel @egourgoulhon @paulmasson

Keywords: threejs, aspect_ratio

Branch/Commit: 89f101edbae884df2d4e41016e0ea7ca3f8befed

Reviewer: Matthias Koeppe

Author: Laith Rastanawi

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32560





---

archive/issue_comments_460788.json:
```json
{
    "body": "<a id='comment:1'></a>This example shows the distortion in a more conspicuous way:\n\n```\nsage: plot = sum([cube((0,0,i)) for i in range(0,10,2)])\n....: plot.show(aspect_ratio=[1,1,1])\n```\nApparently this automatic distortion was inserted as a hack to deal with some specific example that looked bad? It should be removed!\n\nIf such an automatic scaling feature is at all desired, it should be triggered by something like\n*aspect_ratio=[1,1,\"automatic\"]*",
    "created_at": "2021-10-04T11:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460788",
    "user": "https://github.com/guenterrote"
}
```

<a id='comment:1'></a>This example shows the distortion in a more conspicuous way:

```
sage: plot = sum([cube((0,0,i)) for i in range(0,10,2)])
....: plot.show(aspect_ratio=[1,1,1])
```
Apparently this automatic distortion was inserted as a hack to deal with some specific example that looked bad? It should be removed!

If such an automatic scaling feature is at all desired, it should be triggered by something like
*aspect_ratio=[1,1,"automatic"]*



---

archive/issue_comments_460789.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2021-10-07T12:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460789",
    "user": "https://github.com/guenterrote"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_460790.json:
```json
{
    "body": "<a id='comment:3'></a>It turns out this behavior is documented.\nIn the current version of `reference/plot3d/threejs.html` (see page https://doc.sagemath.org/html/en/reference/plot3d/threejs.html) it says\n> aspect_ratio \u2013 (default: [1,1,1]) list or tuple of three numeric values; z-aspect is automatically reduced when large but can be overridden\n\n\nHowever, I still believe it should not be the default behavior.\nFollowing G\u00fcnter's suggestion, we can do\n\n```diff\n    var autoAspect = 2.5;\n-    if ( zRange > autoAspect * rRange && a[2] === 1 ) a[2] = autoAspect * rRange / zRange;\n+    if ( zRange > autoAspect * rRange && a[2] === \"automatic\" ) a[2] = autoAspect * rRange / zRange;\n\n```",
    "created_at": "2021-10-07T13:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460790",
    "user": "https://github.com/LaisRast"
}
```

<a id='comment:3'></a>It turns out this behavior is documented.
In the current version of `reference/plot3d/threejs.html` (see page https://doc.sagemath.org/html/en/reference/plot3d/threejs.html) it says
> aspect_ratio – (default: [1,1,1]) list or tuple of three numeric values; z-aspect is automatically reduced when large but can be overridden


However, I still believe it should not be the default behavior.
Following Günter's suggestion, we can do

```diff
    var autoAspect = 2.5;
-    if ( zRange > autoAspect * rRange && a[2] === 1 ) a[2] = autoAspect * rRange / zRange;
+    if ( zRange > autoAspect * rRange && a[2] === "automatic" ) a[2] = autoAspect * rRange / zRange;

```



---

archive/issue_comments_460791.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-14T14:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460791",
    "user": "https://github.com/LaisRast"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_460792.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-14T15:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460793.json:
```json
{
    "body": "<a id='comment:10'></a>Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460793",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_086325.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32560#event-86325"
}
```



---

archive/issue_comments_460794.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-08T20:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460794",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_460795.json:
```json
{
    "body": "<a id='comment:12'></a>This is a nice improvement.",
    "created_at": "2022-03-08T20:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460795",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>This is a nice improvement.



---

archive/issue_comments_460796.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-12T15:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32560#issuecomment-460796",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086326.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-12T15:10:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32560",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32560#event-86326"
}
```
