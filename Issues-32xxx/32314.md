# Issue 32314: passing a generator to gcd() fails

archive/issues_032077.json:
```json
{
    "body": "The following use of `gcd()` fails:\n\n```\nsage: gcd(x for x in [123,456,789])\n# ...\nTypeError: object of type 'generator' has no len()\n```\n\nAt the same time, `lcm()` works fine with generators:\n\n```\nsage: lcm(x for x in [123,456,789])\n4917048\n```\n\nThe proposed fix is to make sure we consume the generator only once in `gcd()` and pass it to `GCD_list()` as a list.\n\nKeywords: gcd, generator, list\n\nBranch/Commit: e6a3c5dfeca8e37ce61efe25dbb3473475ba912c\n\nReviewer: Kwankyu Lee\n\nAuthor: Lorenz Panny\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32314\n\n",
    "closed_at": "2021-10-19T20:30:47Z",
    "created_at": "2021-07-30T15:08:58Z",
    "labels": [
        "component: basic arithmetic",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "passing a generator to gcd() fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32314",
    "user": "https://github.com/yyyyx4"
}
```
The following use of `gcd()` fails:

```
sage: gcd(x for x in [123,456,789])
# ...
TypeError: object of type 'generator' has no len()
```

At the same time, `lcm()` works fine with generators:

```
sage: lcm(x for x in [123,456,789])
4917048
```

The proposed fix is to make sure we consume the generator only once in `gcd()` and pass it to `GCD_list()` as a list.

Keywords: gcd, generator, list

Branch/Commit: e6a3c5dfeca8e37ce61efe25dbb3473475ba912c

Reviewer: Kwankyu Lee

Author: Lorenz Panny

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32314





---

archive/issue_comments_643165.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-30T15:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643165",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_643166.json:
```json
{
    "body": "<a id='comment:2'></a>It seems this \n\n```diff\n     if seq.universe() is ZZ:\n-        return GCD_list(a)\n+        return GCD_list(seq)\n     else:\n         return __GCD_sequence(seq, **kwargs)\n```\nis enough to fix the bug, and enforcing the type in `GCD_list()` is not necessary. Is it?",
    "created_at": "2021-08-06T02:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643166",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:2'></a>It seems this 

```diff
     if seq.universe() is ZZ:
-        return GCD_list(a)
+        return GCD_list(seq)
     else:
         return __GCD_sequence(seq, **kwargs)
```
is enough to fix the bug, and enforcing the type in `GCD_list()` is not necessary. Is it?



---

archive/issue_comments_643167.json:
```json
{
    "body": "<a id='comment:3'></a>You're right. I moved the `list` cast in `GCD_list` to an earlier time because `GCD_list` was also failing on generators due to the `len()` call, but that could be considered intended. I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).",
    "created_at": "2021-08-06T03:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643167",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:3'></a>You're right. I moved the `list` cast in `GCD_list` to an earlier time because `GCD_list` was also failing on generators due to the `len()` call, but that could be considered intended. I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).



---

archive/issue_comments_643168.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [lorenz](#comment%3A3):\n> I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).\n\n\nI prefer it because of the performance degradation.",
    "created_at": "2021-08-06T10:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643168",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:4'></a>Replying to [lorenz](#comment%3A3):
> I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).


I prefer it because of the performance degradation.



---

archive/issue_comments_643169.json:
```json
{
    "body": "Changing commit from \"231862dc186b620cf0f00f7397cf0141b455d682\" to \"e6a3c5dfeca8e37ce61efe25dbb3473475ba912c\"",
    "created_at": "2021-08-06T11:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "231862dc186b620cf0f00f7397cf0141b455d682" to "e6a3c5dfeca8e37ce61efe25dbb3473475ba912c"



---

archive/issue_comments_643170.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-06T11:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643170",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_643171.json:
```json
{
    "body": "<a id='comment:6'></a>Done.",
    "created_at": "2021-08-06T11:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643171",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:6'></a>Done.



---

archive/issue_comments_643172.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,4 @@\n 4917048\n ```\n \n-The proposed fix is to make sure we consume the generator only once in `gcd()`, and enforce the type in `GCD_list()` before `len()` is called.\n+The proposed fix is to make sure we consume the generator only once in `gcd()` and pass it to `GCD_list()` as a list.\n``````\n",
    "created_at": "2021-08-06T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643172",
    "user": "https://github.com/yyyyx4"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,4 @@
 4917048
 ```
 
-The proposed fix is to make sure we consume the generator only once in `gcd()`, and enforce the type in `GCD_list()` before `len()` is called.
+The proposed fix is to make sure we consume the generator only once in `gcd()` and pass it to `GCD_list()` as a list.
``````




---

archive/issue_comments_643173.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-07T02:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643173",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_643174.json:
```json
{
    "body": "<a id='comment:8'></a>LGTM",
    "created_at": "2021-08-07T02:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643174",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:8'></a>LGTM



---

archive/issue_comments_643175.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Kwankyu Lee\"",
    "created_at": "2021-08-07T02:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643175",
    "user": "https://github.com/kwankyu"
}
```

Changing reviewer from "" to "Kwankyu Lee"



---

archive/issue_comments_643176.json:
```json
{
    "body": "<a id='comment:9'></a>what about the necessary new doctest ?",
    "created_at": "2021-08-07T06:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643176",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>what about the necessary new doctest ?



---

archive/issue_comments_643177.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [chapoton](#comment%3A9):\n> what about the necessary new doctest ?\n\n\nFeel free to set it back to needs work if you think a doctest is required.",
    "created_at": "2021-08-07T08:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643177",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:10'></a>Replying to [chapoton](#comment%3A9):
> what about the necessary new doctest ?


Feel free to set it back to needs work if you think a doctest is required.



---

archive/issue_events_085701.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32314#event-85701"
}
```



---

archive/issue_comments_643178.json:
```json
{
    "body": "Changing branch from \"public/fix_gcd_on_generators\" to \"e6a3c5dfeca8e37ce61efe25dbb3473475ba912c\"",
    "created_at": "2021-10-19T20:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643178",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/fix_gcd_on_generators" to "e6a3c5dfeca8e37ce61efe25dbb3473475ba912c"



---

archive/issue_events_085702.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-19T20:30:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32314#event-85702"
}
```



---

archive/issue_comments_643179.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32314#issuecomment-643179",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
