# Issue 32874: New option "./configure --enable-wheels"

archive/issues_032637.json:
```json
{
    "assignees": [],
    "body": "When `./configure --disable-editable` is in use (the default before #32406), the Sage library is installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the \"cleaner\").\n\nProblem 1: The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)\n\nProblem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if [make wheels](https://trac.sagemath.org/wiki/ReleaseTours/sage-9.7#Editableinstallationisnowthedefault) is used explicitly). Such wheels can be useful for making separate venvs.\n\nIn this ticket:\n- We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). \n- If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages. This enables modularized builds (#34587).\n- If disabled, there is no change.\n\nA trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\nThis ticket brings a number of speed improvements to mitigate this.\n\n\n**CC:**  @jhpalmieri\n\n**Branch:** [25898ba992588a8dc2df07e40c12a4dcee9909f3](https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3)\n\n**Reviewer:** Kwankyu Lee\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/32874\n\n",
    "closed_at": "2022-10-16T22:16:00Z",
    "created_at": "2021-11-15T02:28:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "New option \"./configure --enable-wheels\"",
    "type": "issue",
    "updated_at": "2022-10-17T22:27:19Z",
    "url": "https://github.com/sagemath/sage/issues/32874",
    "user": "https://github.com/mkoeppe"
}
```
When `./configure --disable-editable` is in use (the default before #32406), the Sage library is installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the "cleaner").

Problem 1: The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)

Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if [make wheels](https://trac.sagemath.org/wiki/ReleaseTours/sage-9.7#Editableinstallationisnowthedefault) is used explicitly). Such wheels can be useful for making separate venvs.

In this ticket:
- We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). 
- If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages. This enables modularized builds (#34587).
- If disabled, there is no change.

A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
This ticket brings a number of speed improvements to mitigate this.


**CC:**  @jhpalmieri

**Branch:** [25898ba992588a8dc2df07e40c12a4dcee9909f3](https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3)

**Reviewer:** Kwankyu Lee

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/32874





---

archive/issue_events_398608.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-15T02:28:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398608"
}
```



---

archive/issue_events_398609.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-15T02:28:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "08517b",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398609"
}
```



---

archive/issue_events_398610.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-15T02:28:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398610"
}
```



---

archive/issue_comments_533349.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/remove_use_of__setup_py_install__for_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/remove_use_of__setup_py_install__for_sagelib)",
    "created_at": "2021-11-15T02:45:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533349",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/remove_use_of__setup_py_install__for_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/remove_use_of__setup_py_install__for_sagelib)



---

archive/issue_comments_533350.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,8 @@\n+When `./configure --enable-editable` has not been used, the Sage library is currently installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the \"cleaner\").\n \n+This is incompatible with namespace packages. (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)\n+\n+In this ticket, we change the installation procedure to go through wheel building and installation.  This makes a trivial `./sage -b` much slower (from 10s to 40s).\n+\n+Developers can switch to using `./configure --enable-editable`, for which a trivial `./sage -b` takes 17s. (#32406 proposes to make this the default.)\n+\n``````\n",
    "created_at": "2021-11-15T03:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533350",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,8 @@
+When `./configure --enable-editable` has not been used, the Sage library is currently installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the "cleaner").
 
+This is incompatible with namespace packages. (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)
+
+In this ticket, we change the installation procedure to go through wheel building and installation.  This makes a trivial `./sage -b` much slower (from 10s to 40s).
+
+Developers can switch to using `./configure --enable-editable`, for which a trivial `./sage -b` takes 17s. (#32406 proposes to make this the default.)
+
``````




---

archive/issue_events_398611.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-15T03:12:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398611"
}
```



---

archive/issue_events_398612.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-15T03:12:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398612"
}
```



---

archive/issue_comments_533351.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9b1dba57d85ea7d6f68471024406a939579b5bb\">b9b1dba</a></td><td><code>Enable editable mode also for other sage packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a257621c3b3aa7e4d245a691dffbc67e6e45f08b\">a257621</a></td><td><code>Add error handling</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89bc3ee10b6fd07e21d461c2681aeab65f785174\">89bc3ee</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/inplace_ext</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bd6ce4f39bb8e3a94ba59eaf064044a1e02b9ee\">7bd6ce4</a></td><td><code>Partly revert \"Enable editable mode also for other sage packages\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ef9c1d457b3f30604bfb29657c123a749fe48c7\">3ef9c1d</a></td><td><code>Merge #32713</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50dd26ce3572afe8cdd2eb5bc2b28253497043da\">50dd26c</a></td><td><code>build/pkgs/sagelib/spkg-install: Use helper function sdh_pip_editable_install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5c40a85f8361bb85104846d69b31667bcd732bb\">b5c40a8</a></td><td><code>build/pkgs/sagelib/spkg-install: In non-editable mode, Use sdh_pip_install instead of 'setup.py install'</code></td></tr></table>\n",
    "created_at": "2021-11-15T03:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533351",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>**Comment 2:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9b1dba57d85ea7d6f68471024406a939579b5bb">b9b1dba</a></td><td><code>Enable editable mode also for other sage packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a257621c3b3aa7e4d245a691dffbc67e6e45f08b">a257621</a></td><td><code>Add error handling</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89bc3ee10b6fd07e21d461c2681aeab65f785174">89bc3ee</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/inplace_ext</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bd6ce4f39bb8e3a94ba59eaf064044a1e02b9ee">7bd6ce4</a></td><td><code>Partly revert "Enable editable mode also for other sage packages"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ef9c1d457b3f30604bfb29657c123a749fe48c7">3ef9c1d</a></td><td><code>Merge #32713</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50dd26ce3572afe8cdd2eb5bc2b28253497043da">50dd26c</a></td><td><code>build/pkgs/sagelib/spkg-install: Use helper function sdh_pip_editable_install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5c40a85f8361bb85104846d69b31667bcd732bb">b5c40a8</a></td><td><code>build/pkgs/sagelib/spkg-install: In non-editable mode, Use sdh_pip_install instead of 'setup.py install'</code></td></tr></table>




---

archive/issue_comments_533352.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-11-15T03:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533352",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_533353.json:
```json
{
    "body": "**Commit:** [b5c40a85f8361bb85104846d69b31667bcd732bb](https://github.com/sagemath/sagetrac-mirror/commit/b5c40a85f8361bb85104846d69b31667bcd732bb)",
    "created_at": "2021-11-15T03:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533353",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [b5c40a85f8361bb85104846d69b31667bcd732bb](https://github.com/sagemath/sagetrac-mirror/commit/b5c40a85f8361bb85104846d69b31667bcd732bb)



---

archive/issue_comments_533354.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,3 +6,5 @@\n \n Developers can switch to using `./configure --enable-editable`, for which a trivial `./sage -b` takes 17s. (#32406 proposes to make this the default.)\n \n+\n+An alternative solution: #32927.\n``````\n",
    "created_at": "2021-11-27T21:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533354",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,3 +6,5 @@
 
 Developers can switch to using `./configure --enable-editable`, for which a trivial `./sage -b` takes 17s. (#32406 proposes to make this the default.)
 
+
+An alternative solution: #32927.
``````




---

archive/issue_events_398613.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398613"
}
```



---

archive/issue_events_398614.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398614"
}
```



---

archive/issue_comments_533355.json:
```json
{
    "body": "**Changing dependencies** from \"#32713\" to \"#32406\".",
    "created_at": "2022-05-12T02:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533355",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32713" to "#32406".



---

archive/issue_comments_533356.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8619b2928acb518db7056933fa68ff6f2ff4ac64\">8619b29</a></td><td><code>configure.ac: Make --enable-editable the default</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6513b6b9cb35df25b9ad536dff99cb6d74b0c62d\">6513b6b</a></td><td><code>README.md: Explain configure --disable-editable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff8710efc1b6a1088444e77c40d006c746e3f906\">ff8710e</a></td><td><code>docker/Dockerfile: Use configure --disable-editable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7221a76614e788bb6432dae23aefba44004fcd1f\">7221a76</a></td><td><code>src/setup.py: Do not run find_namespace_packages for 'setup.py dist_info'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a911e0fbe1f8117cd63e3f67753fdf421592f30b\">a911e0f</a></td><td><code>src/MANIFEST.in: prune sage_docbuild, doc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edfa3b45f2d7d80136a51325aaa984200646040e\">edfa3b4</a></td><td><code>build/pkgs/sagelib/spkg-install: Use helper function sdh_pip_editable_install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7ea602848be0393501db739443258942d624732\">f7ea602</a></td><td><code>build/pkgs/sagelib/spkg-install: In non-editable mode, Use sdh_pip_install instead of 'setup.py install'</code></td></tr></table>\n",
    "created_at": "2022-07-22T19:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533356",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>**Comment 6:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8619b2928acb518db7056933fa68ff6f2ff4ac64">8619b29</a></td><td><code>configure.ac: Make --enable-editable the default</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6513b6b9cb35df25b9ad536dff99cb6d74b0c62d">6513b6b</a></td><td><code>README.md: Explain configure --disable-editable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff8710efc1b6a1088444e77c40d006c746e3f906">ff8710e</a></td><td><code>docker/Dockerfile: Use configure --disable-editable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7221a76614e788bb6432dae23aefba44004fcd1f">7221a76</a></td><td><code>src/setup.py: Do not run find_namespace_packages for 'setup.py dist_info'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a911e0fbe1f8117cd63e3f67753fdf421592f30b">a911e0f</a></td><td><code>src/MANIFEST.in: prune sage_docbuild, doc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edfa3b45f2d7d80136a51325aaa984200646040e">edfa3b4</a></td><td><code>build/pkgs/sagelib/spkg-install: Use helper function sdh_pip_editable_install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7ea602848be0393501db739443258942d624732">f7ea602</a></td><td><code>build/pkgs/sagelib/spkg-install: In non-editable mode, Use sdh_pip_install instead of 'setup.py install'</code></td></tr></table>




---

archive/issue_comments_533357.json:
```json
{
    "body": "**Changing commit** from \"[b5c40a85f8361bb85104846d69b31667bcd732bb](https://github.com/sagemath/sagetrac-mirror/commit/b5c40a85f8361bb85104846d69b31667bcd732bb)\" to \"[f7ea602848be0393501db739443258942d624732](https://github.com/sagemath/sagetrac-mirror/commit/f7ea602848be0393501db739443258942d624732)\".",
    "created_at": "2022-07-22T19:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533357",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[b5c40a85f8361bb85104846d69b31667bcd732bb](https://github.com/sagemath/sagetrac-mirror/commit/b5c40a85f8361bb85104846d69b31667bcd732bb)" to "[f7ea602848be0393501db739443258942d624732](https://github.com/sagemath/sagetrac-mirror/commit/f7ea602848be0393501db739443258942d624732)".



---

archive/issue_events_398615.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-22T19:13:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "rename": {
        "from": "Remove use of \"setup.py install\" for sagelib",
        "to": "Remove use of \"setup.py install\" for sagelib when `./configure --disable-editable` is in use"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398615"
}
```



---

archive/issue_comments_533358.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,9 @@\n-When `./configure --enable-editable` has not been used, the Sage library is currently installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the \"cleaner\").\n+When `./configure --disable-editable` is in use (the default before #32406), the Sage library is installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the \"cleaner\").\n \n-This is incompatible with namespace packages. (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)\n+The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)\n \n-In this ticket, we change the installation procedure to go through wheel building and installation.  This makes a trivial `./sage -b` much slower (from 10s to 40s).\n+In this ticket, we change the installation procedure to go through wheel building and installation - like we do with all other Python packages.  \n \n-Developers can switch to using `./configure --enable-editable`, for which a trivial `./sage -b` takes 17s. (#32406 proposes to make this the default.)\n+However, this makes a trivial `./sage -b` much slower (from 10s to 40s). This should be acceptable because after #32406, the primary use case of `./configure --disable-editable` is for fixed installations in an installation prefix, not for development.\n \n \n-An alternative solution: #32927.\n``````\n",
    "created_at": "2022-07-22T19:13:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533358",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,9 @@
-When `./configure --enable-editable` has not been used, the Sage library is currently installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the "cleaner").
+When `./configure --disable-editable` is in use (the default before #32406), the Sage library is installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the "cleaner").
 
-This is incompatible with namespace packages. (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)
+The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)
 
-In this ticket, we change the installation procedure to go through wheel building and installation.  This makes a trivial `./sage -b` much slower (from 10s to 40s).
+In this ticket, we change the installation procedure to go through wheel building and installation - like we do with all other Python packages.  
 
-Developers can switch to using `./configure --enable-editable`, for which a trivial `./sage -b` takes 17s. (#32406 proposes to make this the default.)
+However, this makes a trivial `./sage -b` much slower (from 10s to 40s). This should be acceptable because after #32406, the primary use case of `./configure --disable-editable` is for fixed installations in an installation prefix, not for development.
 
 
-An alternative solution: #32927.
``````




---

archive/issue_events_398616.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-22T19:14:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398616"
}
```



---

archive/issue_events_398617.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-22T19:34:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398617"
}
```



---

archive/issue_events_398618.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-22T19:34:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398618"
}
```



---

archive/issue_comments_533359.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\n\n```\n[sagelib-9.7.beta5] sage-flock: error: argument LOCK: can't create '/doesnotexist/var/lock': [Errno 30] Read-only file system: '/doesnotexist'\n```",
    "created_at": "2022-07-22T19:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533359",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>**Comment 10:**</a>

```
[sagelib-9.7.beta5] sage-flock: error: argument LOCK: can't create '/doesnotexist/var/lock': [Errno 30] Read-only file system: '/doesnotexist'
```



---

archive/issue_comments_533360.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df1e7ebbc0a4a496464e814b3aa73c31f80414c1\">df1e7eb</a></td><td><code>build/bin/sage-pip-install: Put lock file in SAGE_VENV, not SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f35896242990aec334927add68d0c6b12bdc73bf\">f358962</a></td><td><code>build/pkgs/sagelib/spkg-install: No need to set env var PYTHON</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c761788401bf725e3f13515d6633b34ecfe1ba3e\">c761788</a></td><td><code>build/bin/sage-pip-uninstall: Put lock file in SAGE_VENV, not SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99d4129fe7275d6ac37069823f52d4e9847b75c5\">99d4129</a></td><td><code>build/pkgs/sagelib/spkg-install [SAGE_EDITABLE=no]: Use --no-build-isolation</code></td></tr></table>\n",
    "created_at": "2022-07-22T21:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533360",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>**Comment 11:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df1e7ebbc0a4a496464e814b3aa73c31f80414c1">df1e7eb</a></td><td><code>build/bin/sage-pip-install: Put lock file in SAGE_VENV, not SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f35896242990aec334927add68d0c6b12bdc73bf">f358962</a></td><td><code>build/pkgs/sagelib/spkg-install: No need to set env var PYTHON</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c761788401bf725e3f13515d6633b34ecfe1ba3e">c761788</a></td><td><code>build/bin/sage-pip-uninstall: Put lock file in SAGE_VENV, not SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99d4129fe7275d6ac37069823f52d4e9847b75c5">99d4129</a></td><td><code>build/pkgs/sagelib/spkg-install [SAGE_EDITABLE=no]: Use --no-build-isolation</code></td></tr></table>




---

archive/issue_comments_533361.json:
```json
{
    "body": "**Changing commit** from \"[f7ea602848be0393501db739443258942d624732](https://github.com/sagemath/sagetrac-mirror/commit/f7ea602848be0393501db739443258942d624732)\" to \"[99d4129fe7275d6ac37069823f52d4e9847b75c5](https://github.com/sagemath/sagetrac-mirror/commit/99d4129fe7275d6ac37069823f52d4e9847b75c5)\".",
    "created_at": "2022-07-22T21:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533361",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f7ea602848be0393501db739443258942d624732](https://github.com/sagemath/sagetrac-mirror/commit/f7ea602848be0393501db739443258942d624732)" to "[99d4129fe7275d6ac37069823f52d4e9847b75c5](https://github.com/sagemath/sagetrac-mirror/commit/99d4129fe7275d6ac37069823f52d4e9847b75c5)".



---

archive/issue_comments_533362.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,6 +4,6 @@\n \n In this ticket, we change the installation procedure to go through wheel building and installation - like we do with all other Python packages.  \n \n-However, this makes a trivial `./sage -b` much slower (from 10s to 40s). This should be acceptable because after #32406, the primary use case of `./configure --disable-editable` is for fixed installations in an installation prefix, not for development.\n+However, this makes a trivial `./sage -b` much slower (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s). This should be acceptable because after #32406, the primary use case of `./configure --disable-editable` is for fixed installations in an installation prefix, not for development.\n \n \n``````\n",
    "created_at": "2022-07-22T21:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533362",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,6 +4,6 @@
 
 In this ticket, we change the installation procedure to go through wheel building and installation - like we do with all other Python packages.  
 
-However, this makes a trivial `./sage -b` much slower (from 10s to 40s). This should be acceptable because after #32406, the primary use case of `./configure --disable-editable` is for fixed installations in an installation prefix, not for development.
+However, this makes a trivial `./sage -b` much slower (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s). This should be acceptable because after #32406, the primary use case of `./configure --disable-editable` is for fixed installations in an installation prefix, not for development.
 
 
``````




---

archive/issue_events_398619.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-23T08:08:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398619"
}
```



---

archive/issue_events_398620.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-07-23T08:08:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398620"
}
```



---

archive/issue_comments_533363.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07f5cde1e083e8f441ed066b5c0c602b04c602df\">07f5cde</a></td><td><code>build/pkgs/sagelib/spkg-install: Use helper function sdh_pip_editable_install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cdf86e498c09e3da729806176965646b4e50157\">3cdf86e</a></td><td><code>build/pkgs/sagelib/spkg-install: In non-editable mode, Use sdh_pip_install instead of 'setup.py install'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/459ee2fc38ab5c4d170f0afd0c19b1e2abf7b2ae\">459ee2f</a></td><td><code>build/bin/sage-pip-install: Put lock file in SAGE_VENV, not SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3de2608b5321fd72f49b0e96da56de46ed9fe0b8\">3de2608</a></td><td><code>build/pkgs/sagelib/spkg-install: No need to set env var PYTHON</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6eae68bf71f8524212e84a96345aebcac2cfb7b\">e6eae68</a></td><td><code>build/bin/sage-pip-uninstall: Put lock file in SAGE_VENV, not SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e829b089e366aaf57edecc2f4575debe872cd550\">e829b08</a></td><td><code>build/pkgs/sagelib/spkg-install [SAGE_EDITABLE=no]: Use --no-build-isolation</code></td></tr></table>\n",
    "created_at": "2022-09-26T05:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533363",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>**Comment 14:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07f5cde1e083e8f441ed066b5c0c602b04c602df">07f5cde</a></td><td><code>build/pkgs/sagelib/spkg-install: Use helper function sdh_pip_editable_install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cdf86e498c09e3da729806176965646b4e50157">3cdf86e</a></td><td><code>build/pkgs/sagelib/spkg-install: In non-editable mode, Use sdh_pip_install instead of 'setup.py install'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/459ee2fc38ab5c4d170f0afd0c19b1e2abf7b2ae">459ee2f</a></td><td><code>build/bin/sage-pip-install: Put lock file in SAGE_VENV, not SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3de2608b5321fd72f49b0e96da56de46ed9fe0b8">3de2608</a></td><td><code>build/pkgs/sagelib/spkg-install: No need to set env var PYTHON</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6eae68bf71f8524212e84a96345aebcac2cfb7b">e6eae68</a></td><td><code>build/bin/sage-pip-uninstall: Put lock file in SAGE_VENV, not SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e829b089e366aaf57edecc2f4575debe872cd550">e829b08</a></td><td><code>build/pkgs/sagelib/spkg-install [SAGE_EDITABLE=no]: Use --no-build-isolation</code></td></tr></table>




---

archive/issue_comments_533364.json:
```json
{
    "body": "**Changing commit** from \"[99d4129fe7275d6ac37069823f52d4e9847b75c5](https://github.com/sagemath/sagetrac-mirror/commit/99d4129fe7275d6ac37069823f52d4e9847b75c5)\" to \"[e829b089e366aaf57edecc2f4575debe872cd550](https://github.com/sagemath/sagetrac-mirror/commit/e829b089e366aaf57edecc2f4575debe872cd550)\".",
    "created_at": "2022-09-26T05:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533364",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[99d4129fe7275d6ac37069823f52d4e9847b75c5](https://github.com/sagemath/sagetrac-mirror/commit/99d4129fe7275d6ac37069823f52d4e9847b75c5)" to "[e829b089e366aaf57edecc2f4575debe872cd550](https://github.com/sagemath/sagetrac-mirror/commit/e829b089e366aaf57edecc2f4575debe872cd550)".



---

archive/issue_comments_533365.json:
```json
{
    "body": "**Changing dependencies** from \"#32406\" to \"\".",
    "created_at": "2022-09-26T05:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533365",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32406" to "".



---

archive/issue_comments_533366.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31bda8ee142c00c1333266d315f0f194ee3b4790\">31bda8e</a></td><td><code>src/sage_setup/command/sage_install.py: Do not attempt to clean the install directory</code></td></tr></table>\n",
    "created_at": "2022-09-26T05:52:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533366",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>**Comment 16:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31bda8ee142c00c1333266d315f0f194ee3b4790">31bda8e</a></td><td><code>src/sage_setup/command/sage_install.py: Do not attempt to clean the install directory</code></td></tr></table>




---

archive/issue_comments_533367.json:
```json
{
    "body": "**Changing commit** from \"[e829b089e366aaf57edecc2f4575debe872cd550](https://github.com/sagemath/sagetrac-mirror/commit/e829b089e366aaf57edecc2f4575debe872cd550)\" to \"[31bda8ee142c00c1333266d315f0f194ee3b4790](https://github.com/sagemath/sagetrac-mirror/commit/31bda8ee142c00c1333266d315f0f194ee3b4790)\".",
    "created_at": "2022-09-26T05:52:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533367",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e829b089e366aaf57edecc2f4575debe872cd550](https://github.com/sagemath/sagetrac-mirror/commit/e829b089e366aaf57edecc2f4575debe872cd550)" to "[31bda8ee142c00c1333266d315f0f194ee3b4790](https://github.com/sagemath/sagetrac-mirror/commit/31bda8ee142c00c1333266d315f0f194ee3b4790)".



---

archive/issue_events_398621.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-26T05:53:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398621"
}
```



---

archive/issue_events_398622.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-26T05:53:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398622"
}
```



---

archive/issue_comments_533368.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nSo with this patch, in `--disable-editable` mode, why `sage -b` gets so slow? Doesn't it do incremental build? \n\nWith this patch, in `--enable-editable` mode, `sage -b` does not get slower?\n\nCould we be sure that developers do not use `--disable-editable` for development? If there are, you are going to persuade them not to use it for development?",
    "created_at": "2022-09-29T08:44:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533368",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:18'>**Comment 18:**</a>
So with this patch, in `--disable-editable` mode, why `sage -b` gets so slow? Doesn't it do incremental build? 

With this patch, in `--enable-editable` mode, `sage -b` does not get slower?

Could we be sure that developers do not use `--disable-editable` for development? If there are, you are going to persuade them not to use it for development?



---

archive/issue_comments_533369.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nReplying to [Kwankyu Lee](#comment%3A18):\n> So with this patch, in `--disable-editable` mode, why `sage -b` gets so slow? Doesn't it do incremental build? \n\nThe build is still incremental, but it's packing everything in a wheel (90 MB) and unpacking the wheel when installing it, which I think accounts for the slowdown. But I have not really attempted to run this with a profiler or anything.\n\n> With this patch, in `--enable-editable` mode, `sage -b` does not get slower?\n\nNo, there's no change to that mode.\n\n> Could we be sure that developers do not use `--disable-editable` for development? \n\nHard to be sure.",
    "created_at": "2022-09-30T03:39:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533369",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>**Comment 19:**</a>
Replying to [Kwankyu Lee](#comment%3A18):
> So with this patch, in `--disable-editable` mode, why `sage -b` gets so slow? Doesn't it do incremental build? 

The build is still incremental, but it's packing everything in a wheel (90 MB) and unpacking the wheel when installing it, which I think accounts for the slowdown. But I have not really attempted to run this with a profiler or anything.

> With this patch, in `--enable-editable` mode, `sage -b` does not get slower?

No, there's no change to that mode.

> Could we be sure that developers do not use `--disable-editable` for development? 

Hard to be sure.



---

archive/issue_comments_533370.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e97c237a829c94711abb068a2e7aab6071a0272e\">e97c237</a></td><td><code>Merge tag '9.8.beta1' into t/32874/remove_use_of__setup_py_install__for_sagelib</code></td></tr></table>\n",
    "created_at": "2022-09-30T03:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533370",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>**Comment 20:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e97c237a829c94711abb068a2e7aab6071a0272e">e97c237</a></td><td><code>Merge tag '9.8.beta1' into t/32874/remove_use_of__setup_py_install__for_sagelib</code></td></tr></table>




---

archive/issue_comments_533371.json:
```json
{
    "body": "**Changing commit** from \"[31bda8ee142c00c1333266d315f0f194ee3b4790](https://github.com/sagemath/sagetrac-mirror/commit/31bda8ee142c00c1333266d315f0f194ee3b4790)\" to \"[e97c237a829c94711abb068a2e7aab6071a0272e](https://github.com/sagemath/sagetrac-mirror/commit/e97c237a829c94711abb068a2e7aab6071a0272e)\".",
    "created_at": "2022-09-30T03:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533371",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[31bda8ee142c00c1333266d315f0f194ee3b4790](https://github.com/sagemath/sagetrac-mirror/commit/31bda8ee142c00c1333266d315f0f194ee3b4790)" to "[e97c237a829c94711abb068a2e7aab6071a0272e](https://github.com/sagemath/sagetrac-mirror/commit/e97c237a829c94711abb068a2e7aab6071a0272e)".



---

archive/issue_comments_533372.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nSome more timings to see where the total of 60 seconds is spent in a trivial `./sage -b`:\n\n- To uninstall the previous installation of sagelib takes about 3 seconds (timed with `./sage -sh -c 'time pip uninstall --yes sagemath-standard`')\n\n- To install the wheel takes about 10 seconds (timed with `./sage -sh -c 'time pip install venv/var/lib/sage/wheels/sagemath_standard-9.8b1-cp310-cp310-macosx_12_0_x86_64.whl'`)",
    "created_at": "2022-09-30T05:08:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533372",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>**Comment 21:**</a>
Some more timings to see where the total of 60 seconds is spent in a trivial `./sage -b`:

- To uninstall the previous installation of sagelib takes about 3 seconds (timed with `./sage -sh -c 'time pip uninstall --yes sagemath-standard`')

- To install the wheel takes about 10 seconds (timed with `./sage -sh -c 'time pip install venv/var/lib/sage/wheels/sagemath_standard-9.8b1-cp310-cp310-macosx_12_0_x86_64.whl'`)



---

archive/issue_comments_533373.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3d8c51602e649ba8868d5490cba2b79e64e731e\">a3d8c51</a></td><td><code>sage_setup.find.find_python_sources: Do not recurse into subdirectories that are not packages/namespace packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40f882609af08b2a158c96ffed49205a708c3ea4\">40f8826</a></td><td><code>sage_setup.find: Refactor through new class sage.misc.package_dir.SourceDistributionFilter</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf6e54c5fa0dd65e9328186ccb95bae21ea84f45\">bf6e54c</a></td><td><code>src/sage_setup/find.py, src/sage_setup/clean.py, src/sage/misc/package_dir.py: Update copyright according to \"git blame -w --date=format:%Y FILE | sort -k2\"</code></td></tr></table>\n",
    "created_at": "2022-09-30T21:11:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533373",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>**Comment 22:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3d8c51602e649ba8868d5490cba2b79e64e731e">a3d8c51</a></td><td><code>sage_setup.find.find_python_sources: Do not recurse into subdirectories that are not packages/namespace packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40f882609af08b2a158c96ffed49205a708c3ea4">40f8826</a></td><td><code>sage_setup.find: Refactor through new class sage.misc.package_dir.SourceDistributionFilter</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf6e54c5fa0dd65e9328186ccb95bae21ea84f45">bf6e54c</a></td><td><code>src/sage_setup/find.py, src/sage_setup/clean.py, src/sage/misc/package_dir.py: Update copyright according to "git blame -w --date=format:%Y FILE | sort -k2"</code></td></tr></table>




---

archive/issue_comments_533374.json:
```json
{
    "body": "**Changing commit** from \"[e97c237a829c94711abb068a2e7aab6071a0272e](https://github.com/sagemath/sagetrac-mirror/commit/e97c237a829c94711abb068a2e7aab6071a0272e)\" to \"[bf6e54c5fa0dd65e9328186ccb95bae21ea84f45](https://github.com/sagemath/sagetrac-mirror/commit/bf6e54c5fa0dd65e9328186ccb95bae21ea84f45)\".",
    "created_at": "2022-09-30T21:11:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533374",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e97c237a829c94711abb068a2e7aab6071a0272e](https://github.com/sagemath/sagetrac-mirror/commit/e97c237a829c94711abb068a2e7aab6071a0272e)" to "[bf6e54c5fa0dd65e9328186ccb95bae21ea84f45](https://github.com/sagemath/sagetrac-mirror/commit/bf6e54c5fa0dd65e9328186ccb95bae21ea84f45)".



---

archive/issue_comments_533375.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c98f0ef26bae0aafae07015bdadf04abf9f12e8\">7c98f0e</a></td><td><code>pkgs/sagemath-standard/setup.py: Do not run source file discovery on 'setup.py distinfo'</code></td></tr></table>\n",
    "created_at": "2022-09-30T21:19:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533375",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>**Comment 23:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c98f0ef26bae0aafae07015bdadf04abf9f12e8">7c98f0e</a></td><td><code>pkgs/sagemath-standard/setup.py: Do not run source file discovery on 'setup.py distinfo'</code></td></tr></table>




---

archive/issue_comments_533376.json:
```json
{
    "body": "**Changing commit** from \"[bf6e54c5fa0dd65e9328186ccb95bae21ea84f45](https://github.com/sagemath/sagetrac-mirror/commit/bf6e54c5fa0dd65e9328186ccb95bae21ea84f45)\" to \"[7c98f0ef26bae0aafae07015bdadf04abf9f12e8](https://github.com/sagemath/sagetrac-mirror/commit/7c98f0ef26bae0aafae07015bdadf04abf9f12e8)\".",
    "created_at": "2022-09-30T21:19:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533376",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bf6e54c5fa0dd65e9328186ccb95bae21ea84f45](https://github.com/sagemath/sagetrac-mirror/commit/bf6e54c5fa0dd65e9328186ccb95bae21ea84f45)" to "[7c98f0ef26bae0aafae07015bdadf04abf9f12e8](https://github.com/sagemath/sagetrac-mirror/commit/7c98f0ef26bae0aafae07015bdadf04abf9f12e8)".



---

archive/issue_comments_533377.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nThe last commit shaves off about 5 seconds.",
    "created_at": "2022-09-30T21:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533377",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>**Comment 24:**</a>
The last commit shaves off about 5 seconds.



---

archive/issue_comments_533378.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nThe wheel-building part itself is about 31 seconds\n\n```\n(sage-buildsh) mkoeppe@egret:~/s/sage/sage-rebasing/worktree-rebase/pkgs/sagemath-standard$ time python3 setup.py bdist_wheel\n23.91s user 6.71s system 99% cpu 30.793 total\n```",
    "created_at": "2022-09-30T23:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533378",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'>**Comment 25:**</a>
The wheel-building part itself is about 31 seconds

```
(sage-buildsh) mkoeppe@egret:~/s/sage/sage-rebasing/worktree-rebase/pkgs/sagemath-standard$ time python3 setup.py bdist_wheel
23.91s user 6.71s system 99% cpu 30.793 total
```



---

archive/issue_comments_533379.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nHere's the result of pasting the top of `pkgs/sagemath-standard/setup.py` in `sage -ipython` and then running `%prun setup(packages = python_packages, cmdclass = cmdclass,  ext_modules = cython_modules)`\n\n```\n         21884054 function calls (20880049 primitive calls) in 34.998 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n     4737   10.807    0.002   10.807    0.002 {method 'compress' of 'zlib.Compress' objects}\n   567281    2.715    0.000    2.715    0.000 {built-in method posix.stat}\n  1485393    2.480    0.000    3.887    0.000 posixpath.py:71(join)\n    64029    1.027    0.000    1.027    0.000 {method 'read' of '_io.BufferedReader' objects}\n    56924    0.893    0.000    0.893    0.000 {built-in method posix.getcwd}\n    19375    0.843    0.000    0.858    0.000 {built-in method io.open}\n     4736    0.837    0.000    0.837    0.000 {built-in method _hashlib.openssl_sha256}\n    25992    0.581    0.000    0.581    0.000 {method 'write' of '_io.BufferedWriter' objects}\n    88515    0.506    0.000    0.742    0.000 posixpath.py:337(normpath)\n   208247    0.501    0.000    4.150    0.000 Utils.py:149(contains_init)\n     4737    0.471    0.000    0.471    0.000 {method 'flush' of 'zlib.Compress' objects}\n961672/52290    0.470    0.000    8.841    0.000 Utils.py:38(wrapper)\n  1948728    0.441    0.000    0.441    0.000 {method 'startswith' of 'str' objects}\n  1643384    0.438    0.000    0.665    0.000 posixpath.py:41(_get_sep)\n     4762    0.373    0.000    0.373    0.000 {built-in method posix.unlink}\n      143    0.348    0.002    0.348    0.002 {built-in method posix.waitpid}\n   984573    0.345    0.000    0.345    0.000 {method 'get' of 'dict' objects}\n   497648    0.339    0.000    2.592    0.000 genericpath.py:16(exists)\n     4750    0.339    0.000    0.339    0.000 {method 'close' of '_io.BufferedWriter' objects}\n     1853    0.337    0.000    0.565    0.000 Dependencies.py:308(strip_string_literals)\n      141    0.337    0.002    0.337    0.002 {method 'poll' of 'select.poll' objects}\n  2083096    0.295    0.000    0.297    0.000 {built-in method builtins.isinstance}\n  1683819    0.293    0.000    0.293    0.000 {method 'endswith' of 'str' objects}\n    81972    0.271    0.000    0.271    0.000 {built-in method posix.lstat}\n     8433    0.246    0.000    7.077    0.001 Main.py:787(search_include_directories)\n   399961    0.241    0.000    0.241    0.000 {method 'match' of 're.Pattern' objects}\n     3118    0.219    0.000    0.236    0.000 {method 'read' of '_io.TextIOWrapper' objects}\n     1200    0.218    0.000    1.459    0.001 Dependencies.py:480(parse_dependencies)\n  1921596    0.197    0.000    0.197    0.000 {built-in method posix.fspath}\n      355    0.185    0.001    0.185    0.001 {built-in method posix.read}\n   253507    0.171    0.000    0.171    0.000 {method 'find' of 'str' objects}\n   219811    0.160    0.000    1.225    0.000 Utils.py:165(path_exists)\n      142    0.160    0.001    0.160    0.001 {built-in method _posixsubprocess.fork_exec}\n    37898    0.152    0.000    0.152    0.000 {method 'write' of '_io.BufferedRandom' objects}\n10971/5491    0.150    0.000    0.649    0.000 posixpath.py:400(_joinrealpath)\n    26680    0.144    0.000    1.897    0.000 posixpath.py:465(relpath)\n    37406    0.143    0.000    4.785    0.000 Utils.py:138(check_package_dir)\n  1363000    0.143    0.000    0.143    0.000 {method 'append' of 'list' objects}\n    75046    0.133    0.000    1.938    0.000 posixpath.py:376(abspath)\n     4756    0.128    0.000    0.128    0.000 {built-in method posix.utime}\n        1    0.117    0.117   13.865   13.865 wheelfile.py:120(write_files)\n    53941    0.110    0.000    0.145    0.000 {built-in method builtins.next}\n     8373    0.102    0.000    2.423    0.000 file_util.py:70(copy_file)\n   183237    0.097    0.000    0.097    0.000 {method 'split' of 'str' objects}\n   183237    0.097    0.000    0.097    0.000 {method 'split' of 'str' objects}\n    11009    0.096    0.000    0.521    0.000 tarfile.py:1054(frombuf)\n   143104    0.092    0.000    0.146    0.000 tarfile.py:164(nts)\n     4885    0.089    0.000    0.089    0.000 {built-in method posix.chmod}\n     4455    0.086    0.000    0.086    0.000 {built-in method posix.scandir}\n       93    0.078    0.001    0.141    0.002 Code.py:273(load_utilities_from_file)\n    22240    0.076    0.000    0.076    0.000 {built-in method builtins.sum}\n    88064    0.075    0.000    0.173    0.000 tarfile.py:172(nti)\n4383/4372    0.075    0.000    0.097    0.000 {built-in method builtins.__build_class__}\n    39067    0.075    0.000    0.348    0.000 tarfile.py:553(__read)\n    90395    0.071    0.000    0.137    0.000 posixpath.py:60(isabs)\n    26680    0.066    0.000    0.101    0.000 genericpath.py:69(commonprefix)\n    33569    0.065    0.000    0.065    0.000 {built-in method __new__ of type object at 0x103f489f0}\n17411/3144    0.065    0.000    0.266    0.000 os.py:344(_walk)\n    14213    0.064    0.000    0.064    0.000 {method 'seek' of '_io.BufferedRandom' objects}\n     4747    0.062    0.000    1.738    0.000 file_util.py:14(_copy_file_contents)\n    22016    0.060    0.000    0.060    0.000 {built-in method _struct.unpack_from}\n313225/313193    0.059    0.000    0.061    0.000 {built-in method builtins.getattr}\n     4737    0.057    0.000    0.697    0.000 zipfile.py:1142(close)\n145319/145148    0.056    0.000    0.057    0.000 {method 'join' of 'str' objects}\n    24132    0.056    0.000    0.076    0.000 glob.py:128(_iterdir)\n      442    0.053    0.000    0.053    0.000 {built-in method marshal.loads}\n    25789    0.052    0.000    0.079    0.000 posixpath.py:100(split)\n   189632    0.052    0.000    0.052    0.000 {built-in method builtins.min}\n      744    0.051    0.000    0.058    0.000 intrinsic.py:52(__init__)\n    12933    0.050    0.000    0.747    0.000 {method '__exit__' of '_io._IOBase' objects}\n    21222    0.050    0.000    0.050    0.000 {method 'search' of 're.Pattern' objects}\n     9474    0.046    0.000    0.080    0.000 zipfile.py:409(FileHeader)\n      499    0.045    0.000    0.045    0.000 {built-in method posix.listdir}\n       14    0.045    0.003    0.229    0.016 egg_info.py:477(<listcomp>)\n      142    0.044    0.000    0.570    0.004 subprocess.py:756(__init__)\n    15541    0.041    0.000    0.065    0.000 posixpath.py:150(dirname)\n        7    0.041    0.006    0.086    0.012 egg_info.py:413(_remove_files)\n     4736    0.040    0.000   13.143    0.003 wheelfile.py:142(write)\n      139    0.040    0.000    0.041    0.000 warnings.py:458(__enter__)\n315793/313610    0.039    0.000    0.040    0.000 {built-in method builtins.len}\n36421/19887    0.039    0.000    7.654    0.000 Utils.py:48(wrapper)\n      142    0.038    0.000    0.503    0.004 subprocess.py:1685(_execute_child)\n     4737    0.037    0.000   12.771    0.003 wheelfile.py:152(writestr)\n    230/2    0.036    0.000    2.478    1.239 dir_util.py:107(copy_tree)\n    11009    0.035    0.000    1.085    0.000 tarfile.py:2329(next)\n     4737    0.034    0.000   11.852    0.003 zipfile.py:1776(writestr)\n       43    0.034    0.001    0.034    0.001 {built-in method _imp.create_dynamic}\n    87871    0.033    0.000    0.042    0.000 {built-in method builtins.max}\n    10500    0.033    0.000    7.281    0.001 Dependencies.py:572(find_pxd)\n    26262    0.033    0.000    0.058    0.000 posixpath.py:140(basename)\n    29932    0.032    0.000    0.217    0.000 genericpath.py:27(isfile)\n        2    0.032    0.016    1.543    0.771 filelist.py:302(findall)\n   106344    0.032    0.000    0.032    0.000 {method 'rfind' of 'str' objects}\n    39067    0.030    0.000    0.407    0.000 tarfile.py:519(read)\n    11008    0.030    0.000    0.165    0.000 tarfile.py:222(calc_chksums)\n   152480    0.030    0.000    0.030    0.000 {method 'decode' of 'bytes' objects}\n    24048    0.030    0.000    0.185    0.000 egg_info.py:509(_safe_path)\n   143104    0.029    0.000    0.029    0.000 {method 'find' of 'bytes' objects}\n     4886    0.028    0.000    0.028    0.000 {method 'close' of '_io.BufferedReader' objects}\n     4737    0.028    0.000    0.127    0.000 zipfile.py:1576(_open_to_write)\n       70    0.027    0.000    0.425    0.006 subprocess.py:1950(_communicate)\n     4737    0.027    0.000    0.027    0.000 {built-in method zlib.crc32}\n     4737    0.027    0.000   10.958    0.002 zipfile.py:1123(write)\n    19639    0.026    0.000    7.160    0.000 Main.py:241(find_pxd_file)\n    26680    0.026    0.000    0.026    0.000 posixpath.py:488(<listcomp>)\n    10431    0.026    0.000    0.077    0.000 <frozen importlib._bootstrap_external>:380(cache_from_source)\n    39067    0.024    0.000    0.372    0.000 tarfile.py:526(_read)\n    11007    0.024    0.000    0.061    0.000 tarfile.py:1151(_proc_builtin)\n    19674    0.024    0.000    7.131    0.000 Main.py:288(search_include_directories)\n20696/7591    0.024    0.000    0.040    0.000 signature.py:5(type_dependencies)\n     4737    0.023    0.000    0.023    0.000 {built-in method zlib.compressobj}\n      442    0.023    0.000    0.023    0.000 {built-in method io.open_code}\n     1949    0.022    0.000    0.022    0.000 {built-in method posix.mkdir}\n    26680    0.022    0.000    0.022    0.000 posixpath.py:487(<listcomp>)\n    88965    0.022    0.000    0.022    0.000 {method 'partition' of 'str' objects}\n11009/11008    0.021    0.000    0.655    0.000 tarfile.py:1117(fromtarfile)\n    17120    0.021    0.000    0.157    0.000 genericpath.py:39(isdir)\n     6047    0.020    0.000    0.022    0.000 Dependencies.py:258(merge)\n12094/1068    0.020    0.000    9.012    0.008 Dependencies.py:697(transitive_merge_helper)\n        1    0.020    0.020    1.000    1.000 file_finder.py:6(scm_find_files)\n     1068    0.020    0.000    0.106    0.000 macosx_libfile.py:305(read_mach_header)\n    14228    0.020    0.000    0.026    0.000 genericpath.py:121(_splitext)\n      792    0.019    0.000    0.540    0.001 build_py.py:220(find_package_modules)\n     9384    0.019    0.000    0.362    0.000 tarfile.py:506(seek)\n       64    0.018    0.000    0.678    0.011 pkgconfig.py:106(_query)\n    239/2    0.018    0.000    0.434    0.217 shutil.py:626(_rmtree_safe_fd)\n     1214    0.018    0.000    0.370    0.000 Utils.py:239(open_source_file)\n     8688    0.018    0.000    0.032    0.000 os.py:674(__getitem__)\n       66    0.018    0.000    0.631    0.010 subprocess.py:337(call)\n     6623    0.017    0.000    0.044    0.000 _collections_abc.py:816(get)\n     2268    0.017    0.000    0.039    0.000 Dependencies.py:226(__init__)\n     8355    0.017    0.000    0.118    0.000 dep_util.py:11(newer)\n     4291    0.017    0.000    0.318    0.000 {built-in method builtins.sorted}\n```",
    "created_at": "2022-09-30T23:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533379",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'>**Comment 26:**</a>
Here's the result of pasting the top of `pkgs/sagemath-standard/setup.py` in `sage -ipython` and then running `%prun setup(packages = python_packages, cmdclass = cmdclass,  ext_modules = cython_modules)`

```
         21884054 function calls (20880049 primitive calls) in 34.998 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     4737   10.807    0.002   10.807    0.002 {method 'compress' of 'zlib.Compress' objects}
   567281    2.715    0.000    2.715    0.000 {built-in method posix.stat}
  1485393    2.480    0.000    3.887    0.000 posixpath.py:71(join)
    64029    1.027    0.000    1.027    0.000 {method 'read' of '_io.BufferedReader' objects}
    56924    0.893    0.000    0.893    0.000 {built-in method posix.getcwd}
    19375    0.843    0.000    0.858    0.000 {built-in method io.open}
     4736    0.837    0.000    0.837    0.000 {built-in method _hashlib.openssl_sha256}
    25992    0.581    0.000    0.581    0.000 {method 'write' of '_io.BufferedWriter' objects}
    88515    0.506    0.000    0.742    0.000 posixpath.py:337(normpath)
   208247    0.501    0.000    4.150    0.000 Utils.py:149(contains_init)
     4737    0.471    0.000    0.471    0.000 {method 'flush' of 'zlib.Compress' objects}
961672/52290    0.470    0.000    8.841    0.000 Utils.py:38(wrapper)
  1948728    0.441    0.000    0.441    0.000 {method 'startswith' of 'str' objects}
  1643384    0.438    0.000    0.665    0.000 posixpath.py:41(_get_sep)
     4762    0.373    0.000    0.373    0.000 {built-in method posix.unlink}
      143    0.348    0.002    0.348    0.002 {built-in method posix.waitpid}
   984573    0.345    0.000    0.345    0.000 {method 'get' of 'dict' objects}
   497648    0.339    0.000    2.592    0.000 genericpath.py:16(exists)
     4750    0.339    0.000    0.339    0.000 {method 'close' of '_io.BufferedWriter' objects}
     1853    0.337    0.000    0.565    0.000 Dependencies.py:308(strip_string_literals)
      141    0.337    0.002    0.337    0.002 {method 'poll' of 'select.poll' objects}
  2083096    0.295    0.000    0.297    0.000 {built-in method builtins.isinstance}
  1683819    0.293    0.000    0.293    0.000 {method 'endswith' of 'str' objects}
    81972    0.271    0.000    0.271    0.000 {built-in method posix.lstat}
     8433    0.246    0.000    7.077    0.001 Main.py:787(search_include_directories)
   399961    0.241    0.000    0.241    0.000 {method 'match' of 're.Pattern' objects}
     3118    0.219    0.000    0.236    0.000 {method 'read' of '_io.TextIOWrapper' objects}
     1200    0.218    0.000    1.459    0.001 Dependencies.py:480(parse_dependencies)
  1921596    0.197    0.000    0.197    0.000 {built-in method posix.fspath}
      355    0.185    0.001    0.185    0.001 {built-in method posix.read}
   253507    0.171    0.000    0.171    0.000 {method 'find' of 'str' objects}
   219811    0.160    0.000    1.225    0.000 Utils.py:165(path_exists)
      142    0.160    0.001    0.160    0.001 {built-in method _posixsubprocess.fork_exec}
    37898    0.152    0.000    0.152    0.000 {method 'write' of '_io.BufferedRandom' objects}
10971/5491    0.150    0.000    0.649    0.000 posixpath.py:400(_joinrealpath)
    26680    0.144    0.000    1.897    0.000 posixpath.py:465(relpath)
    37406    0.143    0.000    4.785    0.000 Utils.py:138(check_package_dir)
  1363000    0.143    0.000    0.143    0.000 {method 'append' of 'list' objects}
    75046    0.133    0.000    1.938    0.000 posixpath.py:376(abspath)
     4756    0.128    0.000    0.128    0.000 {built-in method posix.utime}
        1    0.117    0.117   13.865   13.865 wheelfile.py:120(write_files)
    53941    0.110    0.000    0.145    0.000 {built-in method builtins.next}
     8373    0.102    0.000    2.423    0.000 file_util.py:70(copy_file)
   183237    0.097    0.000    0.097    0.000 {method 'split' of 'str' objects}
   183237    0.097    0.000    0.097    0.000 {method 'split' of 'str' objects}
    11009    0.096    0.000    0.521    0.000 tarfile.py:1054(frombuf)
   143104    0.092    0.000    0.146    0.000 tarfile.py:164(nts)
     4885    0.089    0.000    0.089    0.000 {built-in method posix.chmod}
     4455    0.086    0.000    0.086    0.000 {built-in method posix.scandir}
       93    0.078    0.001    0.141    0.002 Code.py:273(load_utilities_from_file)
    22240    0.076    0.000    0.076    0.000 {built-in method builtins.sum}
    88064    0.075    0.000    0.173    0.000 tarfile.py:172(nti)
4383/4372    0.075    0.000    0.097    0.000 {built-in method builtins.__build_class__}
    39067    0.075    0.000    0.348    0.000 tarfile.py:553(__read)
    90395    0.071    0.000    0.137    0.000 posixpath.py:60(isabs)
    26680    0.066    0.000    0.101    0.000 genericpath.py:69(commonprefix)
    33569    0.065    0.000    0.065    0.000 {built-in method __new__ of type object at 0x103f489f0}
17411/3144    0.065    0.000    0.266    0.000 os.py:344(_walk)
    14213    0.064    0.000    0.064    0.000 {method 'seek' of '_io.BufferedRandom' objects}
     4747    0.062    0.000    1.738    0.000 file_util.py:14(_copy_file_contents)
    22016    0.060    0.000    0.060    0.000 {built-in method _struct.unpack_from}
313225/313193    0.059    0.000    0.061    0.000 {built-in method builtins.getattr}
     4737    0.057    0.000    0.697    0.000 zipfile.py:1142(close)
145319/145148    0.056    0.000    0.057    0.000 {method 'join' of 'str' objects}
    24132    0.056    0.000    0.076    0.000 glob.py:128(_iterdir)
      442    0.053    0.000    0.053    0.000 {built-in method marshal.loads}
    25789    0.052    0.000    0.079    0.000 posixpath.py:100(split)
   189632    0.052    0.000    0.052    0.000 {built-in method builtins.min}
      744    0.051    0.000    0.058    0.000 intrinsic.py:52(__init__)
    12933    0.050    0.000    0.747    0.000 {method '__exit__' of '_io._IOBase' objects}
    21222    0.050    0.000    0.050    0.000 {method 'search' of 're.Pattern' objects}
     9474    0.046    0.000    0.080    0.000 zipfile.py:409(FileHeader)
      499    0.045    0.000    0.045    0.000 {built-in method posix.listdir}
       14    0.045    0.003    0.229    0.016 egg_info.py:477(<listcomp>)
      142    0.044    0.000    0.570    0.004 subprocess.py:756(__init__)
    15541    0.041    0.000    0.065    0.000 posixpath.py:150(dirname)
        7    0.041    0.006    0.086    0.012 egg_info.py:413(_remove_files)
     4736    0.040    0.000   13.143    0.003 wheelfile.py:142(write)
      139    0.040    0.000    0.041    0.000 warnings.py:458(__enter__)
315793/313610    0.039    0.000    0.040    0.000 {built-in method builtins.len}
36421/19887    0.039    0.000    7.654    0.000 Utils.py:48(wrapper)
      142    0.038    0.000    0.503    0.004 subprocess.py:1685(_execute_child)
     4737    0.037    0.000   12.771    0.003 wheelfile.py:152(writestr)
    230/2    0.036    0.000    2.478    1.239 dir_util.py:107(copy_tree)
    11009    0.035    0.000    1.085    0.000 tarfile.py:2329(next)
     4737    0.034    0.000   11.852    0.003 zipfile.py:1776(writestr)
       43    0.034    0.001    0.034    0.001 {built-in method _imp.create_dynamic}
    87871    0.033    0.000    0.042    0.000 {built-in method builtins.max}
    10500    0.033    0.000    7.281    0.001 Dependencies.py:572(find_pxd)
    26262    0.033    0.000    0.058    0.000 posixpath.py:140(basename)
    29932    0.032    0.000    0.217    0.000 genericpath.py:27(isfile)
        2    0.032    0.016    1.543    0.771 filelist.py:302(findall)
   106344    0.032    0.000    0.032    0.000 {method 'rfind' of 'str' objects}
    39067    0.030    0.000    0.407    0.000 tarfile.py:519(read)
    11008    0.030    0.000    0.165    0.000 tarfile.py:222(calc_chksums)
   152480    0.030    0.000    0.030    0.000 {method 'decode' of 'bytes' objects}
    24048    0.030    0.000    0.185    0.000 egg_info.py:509(_safe_path)
   143104    0.029    0.000    0.029    0.000 {method 'find' of 'bytes' objects}
     4886    0.028    0.000    0.028    0.000 {method 'close' of '_io.BufferedReader' objects}
     4737    0.028    0.000    0.127    0.000 zipfile.py:1576(_open_to_write)
       70    0.027    0.000    0.425    0.006 subprocess.py:1950(_communicate)
     4737    0.027    0.000    0.027    0.000 {built-in method zlib.crc32}
     4737    0.027    0.000   10.958    0.002 zipfile.py:1123(write)
    19639    0.026    0.000    7.160    0.000 Main.py:241(find_pxd_file)
    26680    0.026    0.000    0.026    0.000 posixpath.py:488(<listcomp>)
    10431    0.026    0.000    0.077    0.000 <frozen importlib._bootstrap_external>:380(cache_from_source)
    39067    0.024    0.000    0.372    0.000 tarfile.py:526(_read)
    11007    0.024    0.000    0.061    0.000 tarfile.py:1151(_proc_builtin)
    19674    0.024    0.000    7.131    0.000 Main.py:288(search_include_directories)
20696/7591    0.024    0.000    0.040    0.000 signature.py:5(type_dependencies)
     4737    0.023    0.000    0.023    0.000 {built-in method zlib.compressobj}
      442    0.023    0.000    0.023    0.000 {built-in method io.open_code}
     1949    0.022    0.000    0.022    0.000 {built-in method posix.mkdir}
    26680    0.022    0.000    0.022    0.000 posixpath.py:487(<listcomp>)
    88965    0.022    0.000    0.022    0.000 {method 'partition' of 'str' objects}
11009/11008    0.021    0.000    0.655    0.000 tarfile.py:1117(fromtarfile)
    17120    0.021    0.000    0.157    0.000 genericpath.py:39(isdir)
     6047    0.020    0.000    0.022    0.000 Dependencies.py:258(merge)
12094/1068    0.020    0.000    9.012    0.008 Dependencies.py:697(transitive_merge_helper)
        1    0.020    0.020    1.000    1.000 file_finder.py:6(scm_find_files)
     1068    0.020    0.000    0.106    0.000 macosx_libfile.py:305(read_mach_header)
    14228    0.020    0.000    0.026    0.000 genericpath.py:121(_splitext)
      792    0.019    0.000    0.540    0.001 build_py.py:220(find_package_modules)
     9384    0.019    0.000    0.362    0.000 tarfile.py:506(seek)
       64    0.018    0.000    0.678    0.011 pkgconfig.py:106(_query)
    239/2    0.018    0.000    0.434    0.217 shutil.py:626(_rmtree_safe_fd)
     1214    0.018    0.000    0.370    0.000 Utils.py:239(open_source_file)
     8688    0.018    0.000    0.032    0.000 os.py:674(__getitem__)
       66    0.018    0.000    0.631    0.010 subprocess.py:337(call)
     6623    0.017    0.000    0.044    0.000 _collections_abc.py:816(get)
     2268    0.017    0.000    0.039    0.000 Dependencies.py:226(__init__)
     8355    0.017    0.000    0.118    0.000 dep_util.py:11(newer)
     4291    0.017    0.000    0.318    0.000 {built-in method builtins.sorted}
```



---

archive/issue_comments_533380.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nMost of the time is spent in \n- Cython's dependency tracking `search_include_directories` (https://github.com/cython/cython/blob/0.29.x/Cython/Compiler/Main.py), `transitive_merge_helper` (https://github.com/cython/cython/blob/0.29.x/Cython/Build/Dependencies.py)  (about 16 seconds)\n- compressed wheel file writing (about 13 seconds)\n\nOur setup.py also spends about 5 seconds in Python package/module discovery.\n\nIt would be worth checking if we can use an on-disk cache to speed up dependency tracking and package/module discovery.",
    "created_at": "2022-10-01T00:48:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533380",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'>**Comment 27:**</a>
Most of the time is spent in 
- Cython's dependency tracking `search_include_directories` (https://github.com/cython/cython/blob/0.29.x/Cython/Compiler/Main.py), `transitive_merge_helper` (https://github.com/cython/cython/blob/0.29.x/Cython/Build/Dependencies.py)  (about 16 seconds)
- compressed wheel file writing (about 13 seconds)

Our setup.py also spends about 5 seconds in Python package/module discovery.

It would be worth checking if we can use an on-disk cache to speed up dependency tracking and package/module discovery.



---

archive/issue_comments_533381.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nRelated: https://github.com/cython/cython/pull/4949 (`cython --depfile`), https://github.com/mesonbuild/meson/issues/9049 (Cython dep handling), https://github.com/scipy/scipy/blob/main/tools/cythonize.py, https://github.com/scipy/scipy/blob/main/scipy/linalg/meson.build",
    "created_at": "2022-10-01T00:59:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533381",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'>**Comment 28:**</a>
Related: https://github.com/cython/cython/pull/4949 (`cython --depfile`), https://github.com/mesonbuild/meson/issues/9049 (Cython dep handling), https://github.com/scipy/scipy/blob/main/tools/cythonize.py, https://github.com/scipy/scipy/blob/main/scipy/linalg/meson.build



---

archive/issue_comments_533382.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3d5c3e5d199cac9241494cfceeafc69094a2238\">a3d5c3e</a></td><td><code>sage.misc.package_dir.cython_namespace_package_support: Use Cython.Utils.cached_function</code></td></tr></table>\n",
    "created_at": "2022-10-01T01:09:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533382",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>**Comment 29:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3d5c3e5d199cac9241494cfceeafc69094a2238">a3d5c3e</a></td><td><code>sage.misc.package_dir.cython_namespace_package_support: Use Cython.Utils.cached_function</code></td></tr></table>




---

archive/issue_comments_533383.json:
```json
{
    "body": "**Changing commit** from \"[7c98f0ef26bae0aafae07015bdadf04abf9f12e8](https://github.com/sagemath/sagetrac-mirror/commit/7c98f0ef26bae0aafae07015bdadf04abf9f12e8)\" to \"[a3d5c3e5d199cac9241494cfceeafc69094a2238](https://github.com/sagemath/sagetrac-mirror/commit/a3d5c3e5d199cac9241494cfceeafc69094a2238)\".",
    "created_at": "2022-10-01T01:09:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533383",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[7c98f0ef26bae0aafae07015bdadf04abf9f12e8](https://github.com/sagemath/sagetrac-mirror/commit/7c98f0ef26bae0aafae07015bdadf04abf9f12e8)" to "[a3d5c3e5d199cac9241494cfceeafc69094a2238](https://github.com/sagemath/sagetrac-mirror/commit/a3d5c3e5d199cac9241494cfceeafc69094a2238)".



---

archive/issue_comments_533384.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nThis one simple trick shaves off 13 seconds",
    "created_at": "2022-10-01T01:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533384",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'>**Comment 30:**</a>
This one simple trick shaves off 13 seconds



---

archive/issue_comments_533385.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\n\n```\n         21787023 function calls (20782202 primitive calls) in 30.557 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n     4737   10.194    0.002   10.194    0.002 {method 'compress' of 'zlib.Compress' objects}\n   564497    2.160    0.000    2.160    0.000 {built-in method posix.stat}\n  1480789    2.063    0.000    3.314    0.000 posixpath.py:71(join)\n    55724    0.769    0.000    0.769    0.000 {built-in method posix.getcwd}\n     4736    0.762    0.000    0.762    0.000 {built-in method _hashlib.openssl_sha256}\n    19375    0.736    0.000    0.748    0.000 {built-in method io.open}\n    64029    0.599    0.000    0.599    0.000 {method 'read' of '_io.BufferedReader' objects}\n    25992    0.479    0.000    0.479    0.000 {method 'write' of '_io.BufferedWriter' objects}\n  1937517    0.447    0.000    0.447    0.000 {method 'startswith' of 'str' objects}\n    87416    0.443    0.000    0.651    0.000 posixpath.py:337(normpath)\n     4737    0.429    0.000    0.429    0.000 {method 'flush' of 'zlib.Compress' objects}\n     4762    0.414    0.000    0.414    0.000 {built-in method posix.unlink}\n   208247    0.408    0.000    3.368    0.000 Utils.py:149(contains_init)\n963346/52290    0.398    0.000    6.816    0.000 Utils.py:38(wrapper)\n  1637573    0.371    0.000    0.558    0.000 posixpath.py:41(_get_sep)\n      143    0.341    0.002    0.341    0.002 {built-in method posix.waitpid}\n      140    0.330    0.002    0.330    0.002 {method 'poll' of 'select.poll' objects}\n     4750    0.292    0.000    0.292    0.000 {method 'close' of '_io.BufferedWriter' objects}\n   986247    0.283    0.000    0.283    0.000 {method 'get' of 'dict' objects}\n   495577    0.282    0.000    2.057    0.000 genericpath.py:16(exists)\n     1853    0.266    0.000    0.461    0.000 Dependencies.py:308(strip_string_literals)\n    81972    0.259    0.000    0.259    0.000 {built-in method posix.lstat}\n  2073736    0.245    0.000    0.248    0.000 {built-in method builtins.isinstance}\n  1676002    0.244    0.000    0.244    0.000 {method 'endswith' of 'str' objects}\n     8433    0.203    0.000    5.744    0.001 Main.py:787(search_include_directories)\n   390060    0.188    0.000    0.188    0.000 {method 'match' of 're.Pattern' objects}\n     1200    0.171    0.000    0.795    0.001 Dependencies.py:480(parse_dependencies)\n  1912273    0.169    0.000    0.169    0.000 {built-in method posix.fspath}\n      356    0.166    0.000    0.166    0.000 {built-in method posix.read}\n      142    0.157    0.001    0.157    0.001 {built-in method _posixsubprocess.fork_exec}\n   253507    0.151    0.000    0.151    0.000 {method 'find' of 'str' objects}\n10971/5491    0.144    0.000    0.621    0.000 posixpath.py:400(_joinrealpath)\n   219873    0.131    0.000    0.930    0.000 Utils.py:165(path_exists)\n    26080    0.129    0.000    1.684    0.000 posixpath.py:465(relpath)\n  1349185    0.126    0.000    0.126    0.000 {method 'append' of 'list' objects}\n    37406    0.119    0.000    3.900    0.000 Utils.py:138(check_package_dir)\n    73846    0.118    0.000    1.705    0.000 posixpath.py:376(abspath)\n        1    0.099    0.099   12.917   12.917 wheelfile.py:120(write_files)\n    53113    0.096    0.000    0.128    0.000 {built-in method builtins.next}\n     4756    0.094    0.000    0.094    0.000 {built-in method posix.utime}\n    37898    0.092    0.000    0.092    0.000 {method 'write' of '_io.BufferedRandom' objects}\n    11009    0.089    0.000    0.472    0.000 tarfile.py:1054(frombuf)\n     8373    0.088    0.000    2.092    0.000 file_util.py:70(copy_file)\n   180938    0.084    0.000    0.084    0.000 {method 'split' of 'str' objects}\n   143104    0.082    0.000    0.130    0.000 tarfile.py:164(nts)\n     4885    0.078    0.000    0.078    0.000 {built-in method posix.chmod}\n     4329    0.075    0.000    0.075    0.000 {built-in method posix.scandir}\n    39067    0.074    0.000    0.352    0.000 tarfile.py:553(__read)\n      442    0.073    0.000    0.073    0.000 {built-in method marshal.loads}\n    88064    0.069    0.000    0.158    0.000 tarfile.py:172(nti)\n4383/4372    0.067    0.000    0.082    0.000 {built-in method builtins.__build_class__}\n    22240    0.066    0.000    0.066    0.000 {built-in method builtins.sum}\n    89195    0.062    0.000    0.122    0.000 posixpath.py:60(isabs)\n       93    0.062    0.001    0.103    0.001 Code.py:273(load_utilities_from_file)\n    14213    0.060    0.000    0.060    0.000 {method 'seek' of '_io.BufferedRandom' objects}\n    26080    0.059    0.000    0.088    0.000 genericpath.py:69(commonprefix)\n16444/3031    0.058    0.000    0.233    0.000 os.py:344(_walk)\n    33569    0.056    0.000    0.056    0.000 {built-in method __new__ of type object at 0x109d009f0}\n      790    0.056    0.000    0.056    0.000 functools.py:65(wraps)\n    22016    0.055    0.000    0.055    0.000 {built-in method _struct.unpack_from}\n     4747    0.054    0.000    1.499    0.000 file_util.py:14(_copy_file_contents)\n313287/313255    0.051    0.000    0.053    0.000 {built-in method builtins.getattr}\n     4737    0.051    0.000    0.629    0.000 zipfile.py:1142(close)\n144220/144049    0.047    0.000    0.048    0.000 {method 'join' of 'str' objects}\n    25782    0.045    0.000    0.068    0.000 posixpath.py:100(split)\n    12933    0.041    0.000    0.670    0.000 {method '__exit__' of '_io._IOBase' objects}\n   189025    0.041    0.000    0.041    0.000 {built-in method builtins.min}\n     9474    0.041    0.000    0.071    0.000 zipfile.py:409(FileHeader)\n        7    0.040    0.006    0.076    0.011 egg_info.py:413(_remove_files)\n    22618    0.040    0.000    0.057    0.000 glob.py:128(_iterdir)\n      142    0.039    0.000    0.469    0.003 subprocess.py:1685(_execute_child)\n    21183    0.038    0.000    0.038    0.000 {method 'search' of 're.Pattern' objects}\n     4736    0.036    0.000   12.267    0.003 wheelfile.py:142(write)\n314554/312374    0.035    0.000    0.036    0.000 {built-in method builtins.len}\n    15541    0.035    0.000    0.056    0.000 posixpath.py:150(dirname)\n       43    0.035    0.001    0.035    0.001 {built-in method _imp.create_dynamic}\n       14    0.034    0.002    0.176    0.013 egg_info.py:477(<listcomp>)\n     4737    0.033    0.000   11.929    0.003 wheelfile.py:152(writestr)\n    230/2    0.032    0.000    2.142    1.071 dir_util.py:107(copy_tree)\n    11009    0.032    0.000    1.025    0.000 tarfile.py:2329(next)\n      142    0.031    0.000    0.526    0.004 subprocess.py:756(__init__)\n     4737    0.031    0.000   11.095    0.002 zipfile.py:1776(writestr)\n36421/19887    0.030    0.000    6.168    0.000 Utils.py:48(wrapper)\n    39067    0.029    0.000    0.408    0.000 tarfile.py:519(read)\n    26262    0.029    0.000    0.051    0.000 posixpath.py:140(basename)\n        2    0.029    0.014    1.346    0.673 filelist.py:302(findall)\n    87271    0.029    0.000    0.036    0.000 {built-in method builtins.max}\n    29332    0.028    0.000    0.192    0.000 genericpath.py:27(isfile)\n    11008    0.028    0.000    0.149    0.000 tarfile.py:222(calc_chksums)\n     1955    0.028    0.000    0.028    0.000 {built-in method posix.mkdir}\n   152480    0.027    0.000    0.027    0.000 {method 'decode' of 'bytes' objects}\n   106337    0.027    0.000    0.027    0.000 {method 'rfind' of 'str' objects}\n      499    0.027    0.000    0.027    0.000 {built-in method posix.listdir}\n     4886    0.026    0.000    0.026    0.000 {method 'close' of '_io.BufferedReader' objects}\n       66    0.026    0.000    0.614    0.009 subprocess.py:337(call)\n   143104    0.025    0.000    0.025    0.000 {method 'find' of 'bytes' objects}\n    10500    0.025    0.000    5.883    0.001 Dependencies.py:572(find_pxd)\n    24048    0.025    0.000    0.152    0.000 egg_info.py:509(_safe_path)\n      139    0.024    0.000    0.025    0.000 warnings.py:458(__enter__)\n     4737    0.024    0.000    0.024    0.000 {built-in method zlib.crc32}\n     4737    0.024    0.000    0.114    0.000 zipfile.py:1576(_open_to_write)\n    26080    0.023    0.000    0.023    0.000 posixpath.py:488(<listcomp>)\n     4737    0.023    0.000   10.287    0.002 zipfile.py:1123(write)\n     8688    0.023    0.000    0.037    0.000 os.py:674(__getitem__)\n    39067    0.022    0.000    0.375    0.000 tarfile.py:526(_read)\n    10431    0.022    0.000    0.068    0.000 <frozen importlib._bootstrap_external>:380(cache_from_source)\n    11007    0.022    0.000    0.055    0.000 tarfile.py:1151(_proc_builtin)\n     4737    0.021    0.000    0.021    0.000 {built-in method zlib.compressobj}\n     3118    0.021    0.000    0.032    0.000 {method 'read' of '_io.TextIOWrapper' objects}\n    88965    0.021    0.000    0.021    0.000 {method 'partition' of 'str' objects}\n    19639    0.020    0.000    5.809    0.000 Main.py:241(find_pxd_file)\n    239/2    0.020    0.000    0.481    0.240 shutil.py:626(_rmtree_safe_fd)\n11009/11008    0.020    0.000    0.597    0.000 tarfile.py:1117(fromtarfile)\n    26080    0.019    0.000    0.019    0.000 posixpath.py:487(<listcomp>)\n    17120    0.019    0.000    0.141    0.000 genericpath.py:39(isdir)\n       70    0.019    0.000    0.408    0.006 subprocess.py:1950(_communicate)\n    19674    0.019    0.000    5.786    0.000 Main.py:288(search_include_directories)\n        1    0.019    0.019    0.949    0.949 file_finder.py:6(scm_find_files)\n     1068    0.018    0.000    0.099    0.000 macosx_libfile.py:305(read_mach_header)\n     9384    0.018    0.000    0.365    0.000 tarfile.py:506(seek)\n      130    0.018    0.000    1.309    0.010 pkgconfig.py:88(_wrapper)\n       64    0.017    0.000    0.660    0.010 pkgconfig.py:106(_query)\n      792    0.017    0.000    0.456    0.001 build_py.py:220(find_package_modules)\n    14228    0.017    0.000    0.022    0.000 genericpath.py:121(_splitext)\n      442    0.017    0.000    0.017    0.000 {built-in method io.open_code}\n20696/7591    0.017    0.000    0.029    0.000 signature.py:5(type_dependencies)\n        1    0.016    0.016    0.025    0.025 zipfile.py:1843(_write_end_record)\n12094/1068    0.016    0.000    6.872    0.006 Dependencies.py:697(transitive_merge_helper)\n     6047    0.016    0.000    0.017    0.000 Dependencies.py:258(merge)\n       72    0.016    0.000    0.460    0.006 subprocess.py:1108(communicate)\n     8355    0.015    0.000    0.107    0.000 dep_util.py:11(newer)\n     4737    0.014    0.000    0.014    0.000 {built-in method time.gmtime}\n    11007    0.014    0.000    0.019    0.000 tarfile.py:1365(_apply_pax_info)\n     4695    0.014    0.000    0.056    0.000 find.py:393(add)\n    52176    0.014    0.000    0.014    0.000 {method 'encode' of 'str' objects}\n    39207    0.014    0.000    0.014    0.000 {method 'join' of 'bytes' objects}\n     5483    0.014    0.000    0.014    0.000 {built-in method posix.readlink}\n     4291    0.013    0.000    0.253    0.000 {built-in method builtins.sorted}\n     4737    0.013    0.000    0.016    0.000 zipfile.py:344(__init__)\n    23103    0.013    0.000    0.013    0.000 {method 'replace' of 'str' objects}\n    14217    0.013    0.000    0.013    0.000 {built-in method _struct.pack}\n    14228    0.012    0.000    0.037    0.000 posixpath.py:117(splitext)\n    81433    0.012    0.000    0.012    0.000 {method 'rstrip' of 'str' objects}\n     1411    0.012    0.000    5.921    0.004 Dependencies.py:596(cimported_files)\n     4737    0.012    0.000    0.051    0.000 wheelfile.py:35(get_zipinfo_datetime)\n    15780    0.012    0.000    0.141    0.000 filelist.py:269(<genexpr>)\n    13119    0.012    0.000    0.015    0.000 sre_parse.py:1066(expand_template)\n  4212/91    0.012    0.000    0.045    0.000 core.py:776(_parseNoCache)\n      142    0.012    0.000    0.031    0.000 subprocess.py:1225(_close_pipe_fds)\n     4975    0.012    0.000    0.012    0.000 {built-in method posix.fstat}\n     4737    0.011    0.000    0.139    0.000 wheelfile.py:93(open)\n    11008    0.011    0.000    0.011    0.000 tarfile.py:750(__init__)\n   100970    0.011    0.000    0.011    0.000 {method 'strip' of 'str' objects}\n     2268    0.011    0.000    0.026    0.000 Dependencies.py:226(__init__)\n      239    0.011    0.000    0.011    0.000 {built-in method posix.rmdir}\n     3064    0.011    0.000    0.065    0.000 clean.py:25(_remove)\n     9476    0.011    0.000    0.011    0.000 {method 'tell' of '_io.BufferedRandom' objects}\n     4737    0.010    0.000    0.125    0.000 zipfile.py:1478(open)\n        1    0.010    0.010    1.109    1.109 file_finder_git.py:51(_git_interpret_archive)\n      140    0.010    0.000    0.014    0.000 warnings.py:165(simplefilter)\n    13153    0.010    0.000    0.014    0.000 <frozen importlib._bootstrap_external>:128(<listcomp>)\n     6623    0.010    0.000    0.042    0.000 _collections_abc.py:816(get)\n      279    0.010    0.000    0.359    0.001 subprocess.py:1202(wait)\n     1067    0.010    0.000    0.030    0.000 fnmatch.py:54(filter)\n    13153    0.010    0.000    0.027    0.000 <frozen importlib._bootstrap_external>:126(_path_join)\n    12816    0.010    0.000    0.016    0.000 macosx_libfile.py:246(read_data)\n        1    0.010    0.010    0.012    0.012 {method 'writerows' of '_csv.writer' objects}\n     1214    0.010    0.000    0.076    0.000 Utils.py:239(open_source_file)\n    11009    0.009    0.000    0.009    0.000 {method 'count' of 'bytes' objects}\n    10431    0.009    0.000    0.022    0.000 <frozen importlib._bootstrap_external>:132(_path_split)\n     7116    0.009    0.000    0.018    0.000 __init__.py:108(read)\n     2566    0.009    0.000    0.099    0.000 __init__.py:919(read_text)\n    11396    0.009    0.000    0.009    0.000 {method 'copy' of 'dict' objects}\n     3617    0.009    0.000    0.140    0.000 Dependencies.py:454(resolve_depend)\n        1    0.009    0.009    7.112    7.112 Dependencies.py:749(create_extension_list)\n    11775    0.009    0.000    0.142    0.000 glob.py:53(_iglob)\n11008/11007    0.009    0.000    0.066    0.000 tarfile.py:1138(_proc_member)\n    11748    0.009    0.000    0.009    0.000 {method 'tell' of '_io.BufferedReader' objects}\n    81425    0.008    0.000    0.008    0.000 {built-in method _stat.S_ISLNK}\n     5491    0.008    0.000    0.689    0.000 posixpath.py:391(realpath)\n     2779    0.008    0.000    0.012    0.000 pathlib.py:56(parse_parts)\n     9797    0.008    0.000    0.012    0.000 log.py:45(info)\n     5535    0.008    0.000    0.137    0.000 {method 'extend' of 'list' objects}\n    24048    0.008    0.000    0.013    0.000 unicode_utils.py:37(try_encode)\n    14211    0.008    0.000    0.012    0.000 zipfile.py:455(_encodeFilenameFlags)\n     5487    0.008    0.000    0.054    0.000 file_finder.py:28(_link_not_in_scm)\n       66    0.008    0.000    0.627    0.010 pkgconfig.py:116(exists)\n      279    0.008    0.000    0.349    0.001 subprocess.py:1909(_wait)\n      140    0.008    0.000    0.338    0.002 selectors.py:403(select)\n     8696    0.007    0.000    0.012    0.000 os.py:754(encode)\n        2    0.007    0.004    1.357    0.679 env.py:415(cython_aliases)\n        2    0.007    0.004    0.197    0.098 macosx_libfile.py:359(calculate_macosx_platform_tag)\n    28422    0.007    0.000    0.007    0.000 zipfile.py:1116(_fileobj)\n    28458    0.007    0.000    0.010    0.000 unicode_utils.py:18(filesys_decode)\n     4737    0.007    0.000    0.009    0.000 zipfile.py:1704(_writecheck)\n     3269    0.007    0.000    0.007    0.000 {built-in method _codecs.utf_8_decode}\n    13603    0.007    0.000    0.007    0.000 re.py:324(_subx)\n    43/34    0.007    0.000    0.044    0.001 {built-in method _imp.exec_dynamic}\n  441/145    0.007    0.000    0.018    0.000 sre_parse.py:494(_parse)\n     1067    0.007    0.000    0.065    0.000 glob.py:162(_listdir)\n    23054    0.007    0.000    0.009    0.000 posixpath.py:52(normcase)\n     8928    0.007    0.000    0.007    0.000 filelist.py:44(debug_print)\n      151    0.007    0.000    0.009    0.000 contextlib.py:496(callback)\n      142    0.007    0.000    0.008    0.000 subprocess.py:1586(_get_handles)\n       64    0.007    0.000    0.007    0.000 shlex.py:21(__init__)\n     2233    0.007    0.000    0.010    0.000 tokenize.py:431(_tokenize)\n     5112    0.007    0.000    0.011    0.000 pathlib.py:621(__str__)\n     7116    0.007    0.000    0.046    0.000 __init__.py:102(<genexpr>)\n      534    0.007    0.000    0.102    0.000 sage_build_ext.py:90(prepare_extension)\n    22617    0.007    0.000    0.010    0.000 glob.py:96(<genexpr>)\n 7390/355    0.006    0.000    0.039    0.000 signature.py:100(extract_combiner)\n    24550    0.006    0.000    0.006    0.000 {method 'union' of 'set' objects}\n      534    0.006    0.000    0.172    0.000 sage_build_cython.py:254(create_extension)\n     4737    0.006    0.000    0.032    0.000 zipfile.py:1106(__init__)\n     2785    0.006    0.000    0.071    0.000 dir_util.py:15(mkpath)\n      656    0.006    0.000    0.037    0.000 <frozen importlib._bootstrap_external>:1536(find_spec)\n        1    0.006    0.006    7.412    7.412 Dependencies.py:881(cythonize)\n     7093    0.006    0.000    0.044    0.000 posixpath.py:164(islink)\n    52846    0.006    0.000    0.006    0.000 {method 'is_dir' of 'posix.DirEntry' objects}\n     4736    0.006    0.000    0.006    0.000 {method 'digest' of '_hashlib.HASH' objects}\n     2779    0.006    0.000    0.019    0.000 pathlib.py:569(_parse_args)\n      142    0.006    0.000    0.006    0.000 subprocess.py:246(_cleanup)\n     2350    0.006    0.000    0.142    0.000 build_py.py:337(build_module)\n     4550    0.006    0.000    0.009    0.000 _collections.py:28(parse)\n     9566    0.006    0.000    0.008    0.000 tarfile.py:1396(_block)\n     4336    0.006    0.000    0.840    0.000 Dependencies.py:522(parse_dependencies)\n      534    0.006    0.000    0.008    0.000 Dependencies.py:278(subs)\n     3500    0.006    0.000    0.098    0.000 Dependencies.py:981(copy_to_build_dir)\n    25802    0.006    0.000    0.006    0.000 {method 'seek' of '_io.BufferedReader' objects}\n     3201    0.005    0.000    0.008    0.000 gast.py:17(create_node)\n      534    0.005    0.000    0.042    0.000 dep_util.py:56(newer_group)\n1459/1411    0.005    0.000    0.219    0.000 Dependencies.py:545(cimports_externs_incdirs)\n10318/10316    0.005    0.000    0.005    0.000 {method 'format' of 'str' objects}\n      138    0.005    0.000    0.050    0.000 os.py:619(get_exec_path)\n     7116    0.005    0.000    0.058    0.000 __init__.py:381(<genexpr>)\n     4736    0.005    0.000    0.020    0.000 util.py:26(urlsafe_b64encode)\n      142    0.005    0.000    0.006    0.000 contextlib.py:533(__exit__)\n     2136    0.005    0.000    0.013    0.000 macosx_libfile.py:223(get_base_class_and_magic_number)\n    20862    0.005    0.000    0.007    0.000 <frozen importlib._bootstrap_external>:134(<genexpr>)\n        1    0.005    0.005    0.054    0.054 filelist.py:61(sort)\n```\n\nSome interesting ones:\n\n```\n        1    0.000    0.000    4.102    4.102 egg_info.py:309(find_sources)\n        1    0.000    0.000    1.648    1.648 sdist.py:349(read_template)\n        1    0.000    0.000    4.151    4.151 install_scripts.py:18(run)\n        1    0.010    0.010    1.109    1.109 file_finder_git.py:51(_git_interpret_archive)\n        1    0.000    0.000    1.346    1.346 filelist.py:41(findall)\n```",
    "created_at": "2022-10-01T01:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533385",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'>**Comment 31:**</a>

```
         21787023 function calls (20782202 primitive calls) in 30.557 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     4737   10.194    0.002   10.194    0.002 {method 'compress' of 'zlib.Compress' objects}
   564497    2.160    0.000    2.160    0.000 {built-in method posix.stat}
  1480789    2.063    0.000    3.314    0.000 posixpath.py:71(join)
    55724    0.769    0.000    0.769    0.000 {built-in method posix.getcwd}
     4736    0.762    0.000    0.762    0.000 {built-in method _hashlib.openssl_sha256}
    19375    0.736    0.000    0.748    0.000 {built-in method io.open}
    64029    0.599    0.000    0.599    0.000 {method 'read' of '_io.BufferedReader' objects}
    25992    0.479    0.000    0.479    0.000 {method 'write' of '_io.BufferedWriter' objects}
  1937517    0.447    0.000    0.447    0.000 {method 'startswith' of 'str' objects}
    87416    0.443    0.000    0.651    0.000 posixpath.py:337(normpath)
     4737    0.429    0.000    0.429    0.000 {method 'flush' of 'zlib.Compress' objects}
     4762    0.414    0.000    0.414    0.000 {built-in method posix.unlink}
   208247    0.408    0.000    3.368    0.000 Utils.py:149(contains_init)
963346/52290    0.398    0.000    6.816    0.000 Utils.py:38(wrapper)
  1637573    0.371    0.000    0.558    0.000 posixpath.py:41(_get_sep)
      143    0.341    0.002    0.341    0.002 {built-in method posix.waitpid}
      140    0.330    0.002    0.330    0.002 {method 'poll' of 'select.poll' objects}
     4750    0.292    0.000    0.292    0.000 {method 'close' of '_io.BufferedWriter' objects}
   986247    0.283    0.000    0.283    0.000 {method 'get' of 'dict' objects}
   495577    0.282    0.000    2.057    0.000 genericpath.py:16(exists)
     1853    0.266    0.000    0.461    0.000 Dependencies.py:308(strip_string_literals)
    81972    0.259    0.000    0.259    0.000 {built-in method posix.lstat}
  2073736    0.245    0.000    0.248    0.000 {built-in method builtins.isinstance}
  1676002    0.244    0.000    0.244    0.000 {method 'endswith' of 'str' objects}
     8433    0.203    0.000    5.744    0.001 Main.py:787(search_include_directories)
   390060    0.188    0.000    0.188    0.000 {method 'match' of 're.Pattern' objects}
     1200    0.171    0.000    0.795    0.001 Dependencies.py:480(parse_dependencies)
  1912273    0.169    0.000    0.169    0.000 {built-in method posix.fspath}
      356    0.166    0.000    0.166    0.000 {built-in method posix.read}
      142    0.157    0.001    0.157    0.001 {built-in method _posixsubprocess.fork_exec}
   253507    0.151    0.000    0.151    0.000 {method 'find' of 'str' objects}
10971/5491    0.144    0.000    0.621    0.000 posixpath.py:400(_joinrealpath)
   219873    0.131    0.000    0.930    0.000 Utils.py:165(path_exists)
    26080    0.129    0.000    1.684    0.000 posixpath.py:465(relpath)
  1349185    0.126    0.000    0.126    0.000 {method 'append' of 'list' objects}
    37406    0.119    0.000    3.900    0.000 Utils.py:138(check_package_dir)
    73846    0.118    0.000    1.705    0.000 posixpath.py:376(abspath)
        1    0.099    0.099   12.917   12.917 wheelfile.py:120(write_files)
    53113    0.096    0.000    0.128    0.000 {built-in method builtins.next}
     4756    0.094    0.000    0.094    0.000 {built-in method posix.utime}
    37898    0.092    0.000    0.092    0.000 {method 'write' of '_io.BufferedRandom' objects}
    11009    0.089    0.000    0.472    0.000 tarfile.py:1054(frombuf)
     8373    0.088    0.000    2.092    0.000 file_util.py:70(copy_file)
   180938    0.084    0.000    0.084    0.000 {method 'split' of 'str' objects}
   143104    0.082    0.000    0.130    0.000 tarfile.py:164(nts)
     4885    0.078    0.000    0.078    0.000 {built-in method posix.chmod}
     4329    0.075    0.000    0.075    0.000 {built-in method posix.scandir}
    39067    0.074    0.000    0.352    0.000 tarfile.py:553(__read)
      442    0.073    0.000    0.073    0.000 {built-in method marshal.loads}
    88064    0.069    0.000    0.158    0.000 tarfile.py:172(nti)
4383/4372    0.067    0.000    0.082    0.000 {built-in method builtins.__build_class__}
    22240    0.066    0.000    0.066    0.000 {built-in method builtins.sum}
    89195    0.062    0.000    0.122    0.000 posixpath.py:60(isabs)
       93    0.062    0.001    0.103    0.001 Code.py:273(load_utilities_from_file)
    14213    0.060    0.000    0.060    0.000 {method 'seek' of '_io.BufferedRandom' objects}
    26080    0.059    0.000    0.088    0.000 genericpath.py:69(commonprefix)
16444/3031    0.058    0.000    0.233    0.000 os.py:344(_walk)
    33569    0.056    0.000    0.056    0.000 {built-in method __new__ of type object at 0x109d009f0}
      790    0.056    0.000    0.056    0.000 functools.py:65(wraps)
    22016    0.055    0.000    0.055    0.000 {built-in method _struct.unpack_from}
     4747    0.054    0.000    1.499    0.000 file_util.py:14(_copy_file_contents)
313287/313255    0.051    0.000    0.053    0.000 {built-in method builtins.getattr}
     4737    0.051    0.000    0.629    0.000 zipfile.py:1142(close)
144220/144049    0.047    0.000    0.048    0.000 {method 'join' of 'str' objects}
    25782    0.045    0.000    0.068    0.000 posixpath.py:100(split)
    12933    0.041    0.000    0.670    0.000 {method '__exit__' of '_io._IOBase' objects}
   189025    0.041    0.000    0.041    0.000 {built-in method builtins.min}
     9474    0.041    0.000    0.071    0.000 zipfile.py:409(FileHeader)
        7    0.040    0.006    0.076    0.011 egg_info.py:413(_remove_files)
    22618    0.040    0.000    0.057    0.000 glob.py:128(_iterdir)
      142    0.039    0.000    0.469    0.003 subprocess.py:1685(_execute_child)
    21183    0.038    0.000    0.038    0.000 {method 'search' of 're.Pattern' objects}
     4736    0.036    0.000   12.267    0.003 wheelfile.py:142(write)
314554/312374    0.035    0.000    0.036    0.000 {built-in method builtins.len}
    15541    0.035    0.000    0.056    0.000 posixpath.py:150(dirname)
       43    0.035    0.001    0.035    0.001 {built-in method _imp.create_dynamic}
       14    0.034    0.002    0.176    0.013 egg_info.py:477(<listcomp>)
     4737    0.033    0.000   11.929    0.003 wheelfile.py:152(writestr)
    230/2    0.032    0.000    2.142    1.071 dir_util.py:107(copy_tree)
    11009    0.032    0.000    1.025    0.000 tarfile.py:2329(next)
      142    0.031    0.000    0.526    0.004 subprocess.py:756(__init__)
     4737    0.031    0.000   11.095    0.002 zipfile.py:1776(writestr)
36421/19887    0.030    0.000    6.168    0.000 Utils.py:48(wrapper)
    39067    0.029    0.000    0.408    0.000 tarfile.py:519(read)
    26262    0.029    0.000    0.051    0.000 posixpath.py:140(basename)
        2    0.029    0.014    1.346    0.673 filelist.py:302(findall)
    87271    0.029    0.000    0.036    0.000 {built-in method builtins.max}
    29332    0.028    0.000    0.192    0.000 genericpath.py:27(isfile)
    11008    0.028    0.000    0.149    0.000 tarfile.py:222(calc_chksums)
     1955    0.028    0.000    0.028    0.000 {built-in method posix.mkdir}
   152480    0.027    0.000    0.027    0.000 {method 'decode' of 'bytes' objects}
   106337    0.027    0.000    0.027    0.000 {method 'rfind' of 'str' objects}
      499    0.027    0.000    0.027    0.000 {built-in method posix.listdir}
     4886    0.026    0.000    0.026    0.000 {method 'close' of '_io.BufferedReader' objects}
       66    0.026    0.000    0.614    0.009 subprocess.py:337(call)
   143104    0.025    0.000    0.025    0.000 {method 'find' of 'bytes' objects}
    10500    0.025    0.000    5.883    0.001 Dependencies.py:572(find_pxd)
    24048    0.025    0.000    0.152    0.000 egg_info.py:509(_safe_path)
      139    0.024    0.000    0.025    0.000 warnings.py:458(__enter__)
     4737    0.024    0.000    0.024    0.000 {built-in method zlib.crc32}
     4737    0.024    0.000    0.114    0.000 zipfile.py:1576(_open_to_write)
    26080    0.023    0.000    0.023    0.000 posixpath.py:488(<listcomp>)
     4737    0.023    0.000   10.287    0.002 zipfile.py:1123(write)
     8688    0.023    0.000    0.037    0.000 os.py:674(__getitem__)
    39067    0.022    0.000    0.375    0.000 tarfile.py:526(_read)
    10431    0.022    0.000    0.068    0.000 <frozen importlib._bootstrap_external>:380(cache_from_source)
    11007    0.022    0.000    0.055    0.000 tarfile.py:1151(_proc_builtin)
     4737    0.021    0.000    0.021    0.000 {built-in method zlib.compressobj}
     3118    0.021    0.000    0.032    0.000 {method 'read' of '_io.TextIOWrapper' objects}
    88965    0.021    0.000    0.021    0.000 {method 'partition' of 'str' objects}
    19639    0.020    0.000    5.809    0.000 Main.py:241(find_pxd_file)
    239/2    0.020    0.000    0.481    0.240 shutil.py:626(_rmtree_safe_fd)
11009/11008    0.020    0.000    0.597    0.000 tarfile.py:1117(fromtarfile)
    26080    0.019    0.000    0.019    0.000 posixpath.py:487(<listcomp>)
    17120    0.019    0.000    0.141    0.000 genericpath.py:39(isdir)
       70    0.019    0.000    0.408    0.006 subprocess.py:1950(_communicate)
    19674    0.019    0.000    5.786    0.000 Main.py:288(search_include_directories)
        1    0.019    0.019    0.949    0.949 file_finder.py:6(scm_find_files)
     1068    0.018    0.000    0.099    0.000 macosx_libfile.py:305(read_mach_header)
     9384    0.018    0.000    0.365    0.000 tarfile.py:506(seek)
      130    0.018    0.000    1.309    0.010 pkgconfig.py:88(_wrapper)
       64    0.017    0.000    0.660    0.010 pkgconfig.py:106(_query)
      792    0.017    0.000    0.456    0.001 build_py.py:220(find_package_modules)
    14228    0.017    0.000    0.022    0.000 genericpath.py:121(_splitext)
      442    0.017    0.000    0.017    0.000 {built-in method io.open_code}
20696/7591    0.017    0.000    0.029    0.000 signature.py:5(type_dependencies)
        1    0.016    0.016    0.025    0.025 zipfile.py:1843(_write_end_record)
12094/1068    0.016    0.000    6.872    0.006 Dependencies.py:697(transitive_merge_helper)
     6047    0.016    0.000    0.017    0.000 Dependencies.py:258(merge)
       72    0.016    0.000    0.460    0.006 subprocess.py:1108(communicate)
     8355    0.015    0.000    0.107    0.000 dep_util.py:11(newer)
     4737    0.014    0.000    0.014    0.000 {built-in method time.gmtime}
    11007    0.014    0.000    0.019    0.000 tarfile.py:1365(_apply_pax_info)
     4695    0.014    0.000    0.056    0.000 find.py:393(add)
    52176    0.014    0.000    0.014    0.000 {method 'encode' of 'str' objects}
    39207    0.014    0.000    0.014    0.000 {method 'join' of 'bytes' objects}
     5483    0.014    0.000    0.014    0.000 {built-in method posix.readlink}
     4291    0.013    0.000    0.253    0.000 {built-in method builtins.sorted}
     4737    0.013    0.000    0.016    0.000 zipfile.py:344(__init__)
    23103    0.013    0.000    0.013    0.000 {method 'replace' of 'str' objects}
    14217    0.013    0.000    0.013    0.000 {built-in method _struct.pack}
    14228    0.012    0.000    0.037    0.000 posixpath.py:117(splitext)
    81433    0.012    0.000    0.012    0.000 {method 'rstrip' of 'str' objects}
     1411    0.012    0.000    5.921    0.004 Dependencies.py:596(cimported_files)
     4737    0.012    0.000    0.051    0.000 wheelfile.py:35(get_zipinfo_datetime)
    15780    0.012    0.000    0.141    0.000 filelist.py:269(<genexpr>)
    13119    0.012    0.000    0.015    0.000 sre_parse.py:1066(expand_template)
  4212/91    0.012    0.000    0.045    0.000 core.py:776(_parseNoCache)
      142    0.012    0.000    0.031    0.000 subprocess.py:1225(_close_pipe_fds)
     4975    0.012    0.000    0.012    0.000 {built-in method posix.fstat}
     4737    0.011    0.000    0.139    0.000 wheelfile.py:93(open)
    11008    0.011    0.000    0.011    0.000 tarfile.py:750(__init__)
   100970    0.011    0.000    0.011    0.000 {method 'strip' of 'str' objects}
     2268    0.011    0.000    0.026    0.000 Dependencies.py:226(__init__)
      239    0.011    0.000    0.011    0.000 {built-in method posix.rmdir}
     3064    0.011    0.000    0.065    0.000 clean.py:25(_remove)
     9476    0.011    0.000    0.011    0.000 {method 'tell' of '_io.BufferedRandom' objects}
     4737    0.010    0.000    0.125    0.000 zipfile.py:1478(open)
        1    0.010    0.010    1.109    1.109 file_finder_git.py:51(_git_interpret_archive)
      140    0.010    0.000    0.014    0.000 warnings.py:165(simplefilter)
    13153    0.010    0.000    0.014    0.000 <frozen importlib._bootstrap_external>:128(<listcomp>)
     6623    0.010    0.000    0.042    0.000 _collections_abc.py:816(get)
      279    0.010    0.000    0.359    0.001 subprocess.py:1202(wait)
     1067    0.010    0.000    0.030    0.000 fnmatch.py:54(filter)
    13153    0.010    0.000    0.027    0.000 <frozen importlib._bootstrap_external>:126(_path_join)
    12816    0.010    0.000    0.016    0.000 macosx_libfile.py:246(read_data)
        1    0.010    0.010    0.012    0.012 {method 'writerows' of '_csv.writer' objects}
     1214    0.010    0.000    0.076    0.000 Utils.py:239(open_source_file)
    11009    0.009    0.000    0.009    0.000 {method 'count' of 'bytes' objects}
    10431    0.009    0.000    0.022    0.000 <frozen importlib._bootstrap_external>:132(_path_split)
     7116    0.009    0.000    0.018    0.000 __init__.py:108(read)
     2566    0.009    0.000    0.099    0.000 __init__.py:919(read_text)
    11396    0.009    0.000    0.009    0.000 {method 'copy' of 'dict' objects}
     3617    0.009    0.000    0.140    0.000 Dependencies.py:454(resolve_depend)
        1    0.009    0.009    7.112    7.112 Dependencies.py:749(create_extension_list)
    11775    0.009    0.000    0.142    0.000 glob.py:53(_iglob)
11008/11007    0.009    0.000    0.066    0.000 tarfile.py:1138(_proc_member)
    11748    0.009    0.000    0.009    0.000 {method 'tell' of '_io.BufferedReader' objects}
    81425    0.008    0.000    0.008    0.000 {built-in method _stat.S_ISLNK}
     5491    0.008    0.000    0.689    0.000 posixpath.py:391(realpath)
     2779    0.008    0.000    0.012    0.000 pathlib.py:56(parse_parts)
     9797    0.008    0.000    0.012    0.000 log.py:45(info)
     5535    0.008    0.000    0.137    0.000 {method 'extend' of 'list' objects}
    24048    0.008    0.000    0.013    0.000 unicode_utils.py:37(try_encode)
    14211    0.008    0.000    0.012    0.000 zipfile.py:455(_encodeFilenameFlags)
     5487    0.008    0.000    0.054    0.000 file_finder.py:28(_link_not_in_scm)
       66    0.008    0.000    0.627    0.010 pkgconfig.py:116(exists)
      279    0.008    0.000    0.349    0.001 subprocess.py:1909(_wait)
      140    0.008    0.000    0.338    0.002 selectors.py:403(select)
     8696    0.007    0.000    0.012    0.000 os.py:754(encode)
        2    0.007    0.004    1.357    0.679 env.py:415(cython_aliases)
        2    0.007    0.004    0.197    0.098 macosx_libfile.py:359(calculate_macosx_platform_tag)
    28422    0.007    0.000    0.007    0.000 zipfile.py:1116(_fileobj)
    28458    0.007    0.000    0.010    0.000 unicode_utils.py:18(filesys_decode)
     4737    0.007    0.000    0.009    0.000 zipfile.py:1704(_writecheck)
     3269    0.007    0.000    0.007    0.000 {built-in method _codecs.utf_8_decode}
    13603    0.007    0.000    0.007    0.000 re.py:324(_subx)
    43/34    0.007    0.000    0.044    0.001 {built-in method _imp.exec_dynamic}
  441/145    0.007    0.000    0.018    0.000 sre_parse.py:494(_parse)
     1067    0.007    0.000    0.065    0.000 glob.py:162(_listdir)
    23054    0.007    0.000    0.009    0.000 posixpath.py:52(normcase)
     8928    0.007    0.000    0.007    0.000 filelist.py:44(debug_print)
      151    0.007    0.000    0.009    0.000 contextlib.py:496(callback)
      142    0.007    0.000    0.008    0.000 subprocess.py:1586(_get_handles)
       64    0.007    0.000    0.007    0.000 shlex.py:21(__init__)
     2233    0.007    0.000    0.010    0.000 tokenize.py:431(_tokenize)
     5112    0.007    0.000    0.011    0.000 pathlib.py:621(__str__)
     7116    0.007    0.000    0.046    0.000 __init__.py:102(<genexpr>)
      534    0.007    0.000    0.102    0.000 sage_build_ext.py:90(prepare_extension)
    22617    0.007    0.000    0.010    0.000 glob.py:96(<genexpr>)
 7390/355    0.006    0.000    0.039    0.000 signature.py:100(extract_combiner)
    24550    0.006    0.000    0.006    0.000 {method 'union' of 'set' objects}
      534    0.006    0.000    0.172    0.000 sage_build_cython.py:254(create_extension)
     4737    0.006    0.000    0.032    0.000 zipfile.py:1106(__init__)
     2785    0.006    0.000    0.071    0.000 dir_util.py:15(mkpath)
      656    0.006    0.000    0.037    0.000 <frozen importlib._bootstrap_external>:1536(find_spec)
        1    0.006    0.006    7.412    7.412 Dependencies.py:881(cythonize)
     7093    0.006    0.000    0.044    0.000 posixpath.py:164(islink)
    52846    0.006    0.000    0.006    0.000 {method 'is_dir' of 'posix.DirEntry' objects}
     4736    0.006    0.000    0.006    0.000 {method 'digest' of '_hashlib.HASH' objects}
     2779    0.006    0.000    0.019    0.000 pathlib.py:569(_parse_args)
      142    0.006    0.000    0.006    0.000 subprocess.py:246(_cleanup)
     2350    0.006    0.000    0.142    0.000 build_py.py:337(build_module)
     4550    0.006    0.000    0.009    0.000 _collections.py:28(parse)
     9566    0.006    0.000    0.008    0.000 tarfile.py:1396(_block)
     4336    0.006    0.000    0.840    0.000 Dependencies.py:522(parse_dependencies)
      534    0.006    0.000    0.008    0.000 Dependencies.py:278(subs)
     3500    0.006    0.000    0.098    0.000 Dependencies.py:981(copy_to_build_dir)
    25802    0.006    0.000    0.006    0.000 {method 'seek' of '_io.BufferedReader' objects}
     3201    0.005    0.000    0.008    0.000 gast.py:17(create_node)
      534    0.005    0.000    0.042    0.000 dep_util.py:56(newer_group)
1459/1411    0.005    0.000    0.219    0.000 Dependencies.py:545(cimports_externs_incdirs)
10318/10316    0.005    0.000    0.005    0.000 {method 'format' of 'str' objects}
      138    0.005    0.000    0.050    0.000 os.py:619(get_exec_path)
     7116    0.005    0.000    0.058    0.000 __init__.py:381(<genexpr>)
     4736    0.005    0.000    0.020    0.000 util.py:26(urlsafe_b64encode)
      142    0.005    0.000    0.006    0.000 contextlib.py:533(__exit__)
     2136    0.005    0.000    0.013    0.000 macosx_libfile.py:223(get_base_class_and_magic_number)
    20862    0.005    0.000    0.007    0.000 <frozen importlib._bootstrap_external>:134(<genexpr>)
        1    0.005    0.005    0.054    0.054 filelist.py:61(sort)
```

Some interesting ones:

```
        1    0.000    0.000    4.102    4.102 egg_info.py:309(find_sources)
        1    0.000    0.000    1.648    1.648 sdist.py:349(read_template)
        1    0.000    0.000    4.151    4.151 install_scripts.py:18(run)
        1    0.010    0.010    1.109    1.109 file_finder_git.py:51(_git_interpret_archive)
        1    0.000    0.000    1.346    1.346 filelist.py:41(findall)
```



---

archive/issue_comments_533386.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\n`file_finder_git` leaks in because `setuptools_scm` is installed in `site-packages`. https://github.com/pypa/setuptools_scm/issues/561, https://github.com/pypa/setuptools/issues/2652\n\nWorkaround: https://github.com/pypa/setuptools_scm/issues/190#issuecomment-351181286",
    "created_at": "2022-10-01T02:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533386",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'>**Comment 32:**</a>
`file_finder_git` leaks in because `setuptools_scm` is installed in `site-packages`. https://github.com/pypa/setuptools_scm/issues/561, https://github.com/pypa/setuptools/issues/2652

Workaround: https://github.com/pypa/setuptools_scm/issues/190#issuecomment-351181286



---

archive/issue_comments_533387.json:
```json
{
    "body": "**Changing commit** from \"[a3d5c3e5d199cac9241494cfceeafc69094a2238](https://github.com/sagemath/sagetrac-mirror/commit/a3d5c3e5d199cac9241494cfceeafc69094a2238)\" to \"[dcb5c79d765690074cad194610edbd9233c97ac5](https://github.com/sagemath/sagetrac-mirror/commit/dcb5c79d765690074cad194610edbd9233c97ac5)\".",
    "created_at": "2022-10-01T03:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533387",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a3d5c3e5d199cac9241494cfceeafc69094a2238](https://github.com/sagemath/sagetrac-mirror/commit/a3d5c3e5d199cac9241494cfceeafc69094a2238)" to "[dcb5c79d765690074cad194610edbd9233c97ac5](https://github.com/sagemath/sagetrac-mirror/commit/dcb5c79d765690074cad194610edbd9233c97ac5)".



---

archive/issue_comments_533388.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcb5c79d765690074cad194610edbd9233c97ac5\">dcb5c79</a></td><td><code>pkgs/sagemath-standard/setup.py: Disable setuptools_scm file-finder</code></td></tr></table>\n",
    "created_at": "2022-10-01T03:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533388",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:33'>**Comment 33:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcb5c79d765690074cad194610edbd9233c97ac5">dcb5c79</a></td><td><code>pkgs/sagemath-standard/setup.py: Disable setuptools_scm file-finder</code></td></tr></table>




---

archive/issue_comments_533389.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62be88a03834466a309745e184fdeb244f4b60fd\">62be88a</a></td><td><code>src/MANIFEST.in: Do not use global-include</code></td></tr></table>\n",
    "created_at": "2022-10-01T04:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533389",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:34'>**Comment 34:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62be88a03834466a309745e184fdeb244f4b60fd">62be88a</a></td><td><code>src/MANIFEST.in: Do not use global-include</code></td></tr></table>




---

archive/issue_comments_533390.json:
```json
{
    "body": "**Changing commit** from \"[dcb5c79d765690074cad194610edbd9233c97ac5](https://github.com/sagemath/sagetrac-mirror/commit/dcb5c79d765690074cad194610edbd9233c97ac5)\" to \"[62be88a03834466a309745e184fdeb244f4b60fd](https://github.com/sagemath/sagetrac-mirror/commit/62be88a03834466a309745e184fdeb244f4b60fd)\".",
    "created_at": "2022-10-01T04:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533390",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[dcb5c79d765690074cad194610edbd9233c97ac5](https://github.com/sagemath/sagetrac-mirror/commit/dcb5c79d765690074cad194610edbd9233c97ac5)" to "[62be88a03834466a309745e184fdeb244f4b60fd](https://github.com/sagemath/sagetrac-mirror/commit/62be88a03834466a309745e184fdeb244f4b60fd)".



---

archive/issue_comments_533391.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\n\n```\nsage -t --random-seed=307782328559689550615012446878769850043 sage_setup/clean.py\n**********************************************************************\nFile \"sage_setup/clean.py\", line 98, in sage_setup.clean._find_stale_files\nFailed example:\n    for f in stale_iter:\n        if f.endswith(skip_extensions): continue\n        if '/ext_data/' in f: continue\n        print('Found stale file: ' + f)\nExpected nothing\nGot:\n    Found stale file: sage/libs/linkages/padics/__init__.py\n    Found stale file: sage/libs/linkages/padics/relaxed/__init__.py\n    Found stale file: sage/tests/books/judson-abstract-algebra/struct-sage.py\n    Found stale file: sage/tests/books/judson-abstract-algebra/actions-sage.py\n    Found stale file: sage/tests/books/judson-abstract-algebra/normal-sage.py\n    Found stale file: sage/tests/books/judson-abstract-algebra/boolean-sage.py\n...\n```",
    "created_at": "2022-10-01T19:59:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533391",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'>**Comment 35:**</a>

```
sage -t --random-seed=307782328559689550615012446878769850043 sage_setup/clean.py
**********************************************************************
File "sage_setup/clean.py", line 98, in sage_setup.clean._find_stale_files
Failed example:
    for f in stale_iter:
        if f.endswith(skip_extensions): continue
        if '/ext_data/' in f: continue
        print('Found stale file: ' + f)
Expected nothing
Got:
    Found stale file: sage/libs/linkages/padics/__init__.py
    Found stale file: sage/libs/linkages/padics/relaxed/__init__.py
    Found stale file: sage/tests/books/judson-abstract-algebra/struct-sage.py
    Found stale file: sage/tests/books/judson-abstract-algebra/actions-sage.py
    Found stale file: sage/tests/books/judson-abstract-algebra/normal-sage.py
    Found stale file: sage/tests/books/judson-abstract-algebra/boolean-sage.py
...
```



---

archive/issue_events_398623.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-01T19:59:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398623"
}
```



---

archive/issue_events_398624.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-01T19:59:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398624"
}
```



---

archive/issue_comments_533392.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nI cannot reproduce the failure.\n\nWhat does it mean? Those files are not stale files. As far as I understand, there can be no stale files in the wheel install. So the failure just indicates that `find_python_sources` is buggy?",
    "created_at": "2022-10-02T15:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533392",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:36'>**Comment 36:**</a>
I cannot reproduce the failure.

What does it mean? Those files are not stale files. As far as I understand, there can be no stale files in the wheel install. So the failure just indicates that `find_python_sources` is buggy?



---

archive/issue_comments_533393.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nThis branch removes cleaning of the installation directory (site-packages) but keeps the cleaning of the build directory:\n\n```\n--- a/src/sage_setup/command/sage_install.py\n+++ b/src/sage_setup/command/sage_install.py\n@@ -93,9 +93,8 @@ class sage_clean(install):\n         nobase_data_files = [(src_dir, [os.path.join(src_dir, filename) for filename in filenames])\n                              for package, src_dir, build_dir, filenames in cmd_build_py.data_files]\n \n-        # Clean install directory (usually, purelib and platlib are the same)\n-        # and build directory.\n-        output_dirs = [self.install_purelib, self.install_platlib, self.build_lib]\n+        # Clean build directory.\n+        output_dirs = [self.build_lib]\n         from sage_setup.clean import clean_install_dir\n         for output_dir in set(output_dirs):\n             log.info('- cleaning {0}'.format(output_dir))\n```\nSo there is still a notion of stale files. \n\nYou are right that this doctest (in `_find_stale_files`) is outdated. It tests SAGE_LIB, i.e., the installation directory. \n\nI agree that this points to a bug in `find_python_sources` in this branch. I'll investigate",
    "created_at": "2022-10-02T19:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533393",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'>**Comment 37:**</a>
This branch removes cleaning of the installation directory (site-packages) but keeps the cleaning of the build directory:

```
--- a/src/sage_setup/command/sage_install.py
+++ b/src/sage_setup/command/sage_install.py
@@ -93,9 +93,8 @@ class sage_clean(install):
         nobase_data_files = [(src_dir, [os.path.join(src_dir, filename) for filename in filenames])
                              for package, src_dir, build_dir, filenames in cmd_build_py.data_files]
 
-        # Clean install directory (usually, purelib and platlib are the same)
-        # and build directory.
-        output_dirs = [self.install_purelib, self.install_platlib, self.build_lib]
+        # Clean build directory.
+        output_dirs = [self.build_lib]
         from sage_setup.clean import clean_install_dir
         for output_dir in set(output_dirs):
             log.info('- cleaning {0}'.format(output_dir))
```
So there is still a notion of stale files. 

You are right that this doctest (in `_find_stale_files`) is outdated. It tests SAGE_LIB, i.e., the installation directory. 

I agree that this points to a bug in `find_python_sources` in this branch. I'll investigate



---

archive/issue_comments_533394.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nThese files from [comment:35](#comment%3A35) are definitely in the wheel.",
    "created_at": "2022-10-02T20:04:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533394",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'>**Comment 38:**</a>
These files from [comment:35](#comment%3A35) are definitely in the wheel.



---

archive/issue_comments_533395.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nI can reproduce the failure locally with `./configure --enable-editable`.",
    "created_at": "2022-10-02T20:23:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533395",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'>**Comment 39:**</a>
I can reproduce the failure locally with `./configure --enable-editable`.



---

archive/issue_comments_533396.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nIn this mode, of course `SAGE_LIB` is the same as `SAGE_SRC`, which makes that whole doctest meaningless",
    "created_at": "2022-10-02T20:26:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533396",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'>**Comment 40:**</a>
In this mode, of course `SAGE_LIB` is the same as `SAGE_SRC`, which makes that whole doctest meaningless



---

archive/issue_comments_533397.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\n`src/sage/tests/books` is not a package (no `__init__.py`) or namespace package according to our convention (no `all*.py` file). So it's correct that it does not show up in `find_python_sources`.\n\nI'll just remove the outdated doctest.",
    "created_at": "2022-10-02T20:31:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533397",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'>**Comment 41:**</a>
`src/sage/tests/books` is not a package (no `__init__.py`) or namespace package according to our convention (no `all*.py` file). So it's correct that it does not show up in `find_python_sources`.

I'll just remove the outdated doctest.



---

archive/issue_comments_533398.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef\">ab5f37e</a></td><td><code>/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/src/sage/libs/linkages/__init__.py: New</code></td></tr></table>\n",
    "created_at": "2022-10-02T20:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533398",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:42'>**Comment 42:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef">ab5f37e</a></td><td><code>/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/src/sage/libs/linkages/__init__.py: New</code></td></tr></table>




---

archive/issue_comments_533399.json:
```json
{
    "body": "**Changing commit** from \"[62be88a03834466a309745e184fdeb244f4b60fd](https://github.com/sagemath/sagetrac-mirror/commit/62be88a03834466a309745e184fdeb244f4b60fd)\" to \"[ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef](https://github.com/sagemath/sagetrac-mirror/commit/ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef)\".",
    "created_at": "2022-10-02T20:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533399",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[62be88a03834466a309745e184fdeb244f4b60fd](https://github.com/sagemath/sagetrac-mirror/commit/62be88a03834466a309745e184fdeb244f4b60fd)" to "[ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef](https://github.com/sagemath/sagetrac-mirror/commit/ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef)".



---

archive/issue_comments_533400.json:
```json
{
    "body": "<a id='comment:43'>**Comment 43:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15ef369eebada723851cd5ab32c9553f6c7b11c9\">15ef369</a></td><td><code>src/sage_setup/clean.py: Update _find_stale_files doctest to use importlib.metadata.files('sagemath-standard')</code></td></tr></table>\n",
    "created_at": "2022-10-02T21:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533400",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:43'>**Comment 43:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15ef369eebada723851cd5ab32c9553f6c7b11c9">15ef369</a></td><td><code>src/sage_setup/clean.py: Update _find_stale_files doctest to use importlib.metadata.files('sagemath-standard')</code></td></tr></table>




---

archive/issue_comments_533401.json:
```json
{
    "body": "**Changing commit** from \"[ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef](https://github.com/sagemath/sagetrac-mirror/commit/ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef)\" to \"[15ef369eebada723851cd5ab32c9553f6c7b11c9](https://github.com/sagemath/sagetrac-mirror/commit/15ef369eebada723851cd5ab32c9553f6c7b11c9)\".",
    "created_at": "2022-10-02T21:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533401",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef](https://github.com/sagemath/sagetrac-mirror/commit/ab5f37e0dc6589cc60ac9776aa68c7feaa0c9eef)" to "[15ef369eebada723851cd5ab32c9553f6c7b11c9](https://github.com/sagemath/sagetrac-mirror/commit/15ef369eebada723851cd5ab32c9553f6c7b11c9)".



---

archive/issue_comments_533402.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\nI found a better solution. Passes all tests for me now.",
    "created_at": "2022-10-02T21:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533402",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'>**Comment 44:**</a>
I found a better solution. Passes all tests for me now.



---

archive/issue_events_398625.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-02T21:41:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398625"
}
```



---

archive/issue_events_398626.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-02T21:41:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398626"
}
```



---

archive/issue_comments_533403.json:
```json
{
    "body": "<a id='comment:46'>**Comment 46:**</a>\nReplying to [Matthias K\u00f6ppe](#comment%3A27):\n> It would be worth checking if we can use an on-disk cache to speed up dependency tracking and package/module discovery.\n\nI've opened #34630 (Switch sagelib's build system from setuptools to meson-python / ninja) for this",
    "created_at": "2022-10-02T22:05:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533403",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'>**Comment 46:**</a>
Replying to [Matthias Köppe](#comment%3A27):
> It would be worth checking if we can use an on-disk cache to speed up dependency tracking and package/module discovery.

I've opened #34630 (Switch sagelib's build system from setuptools to meson-python / ninja) for this



---

archive/issue_comments_533404.json:
```json
{
    "body": "<a id='comment:47'>**Comment 47:**</a>\nOn my machine, `sage -b` for a trivial change spends 50% more time in `disable-editable` mode (about 45 seconds) than in `enable-editable` mode (about 30 seconds).\n\nPersonally I am okay with this as I use the default `enable-editable` mode. \n\nFor people using `disable-editable` mode for development, it may be painful to accept 50% more build time for trivial changes. \n\nI think we should warn developers in sage-devel for this change and establish `enable-editable` as the recommended mode for sage development.",
    "created_at": "2022-10-03T00:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533404",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:47'>**Comment 47:**</a>
On my machine, `sage -b` for a trivial change spends 50% more time in `disable-editable` mode (about 45 seconds) than in `enable-editable` mode (about 30 seconds).

Personally I am okay with this as I use the default `enable-editable` mode. 

For people using `disable-editable` mode for development, it may be painful to accept 50% more build time for trivial changes. 

I think we should warn developers in sage-devel for this change and establish `enable-editable` as the recommended mode for sage development.



---

archive/issue_events_398627.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-03T01:42:33Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "rename": {
        "from": "Remove use of \"setup.py install\" for sagelib when `./configure --disable-editable` is in use",
        "to": "New option \"./configure --enable-sage-wheels\", replace installation-dir cleaner"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398627"
}
```



---

archive/issue_comments_533405.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nI'll make this change depend on a configure option for now. (See changed ticket description.)",
    "created_at": "2022-10-03T01:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533405",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'>**Comment 48:**</a>
I'll make this change depend on a configure option for now. (See changed ticket description.)



---

archive/issue_comments_533406.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,15 @@\n When `./configure --disable-editable` is in use (the default before #32406), the Sage library is installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the \"cleaner\").\n \n-The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)\n+Problem 1: The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)\n \n-In this ticket, we change the installation procedure to go through wheel building and installation - like we do with all other Python packages.  \n+Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if `make wheels` is used explicitly). Such wheels can be useful for making separate venvs.\n \n-However, this makes a trivial `./sage -b` much slower (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s). This should be acceptable because after #32406, the primary use case of `./configure --disable-editable` is for fixed installations in an installation prefix, not for development.\n+In this ticket:\n+- We create a new option `./configure --enable-sage-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). \n+- We remove the use of the installation-dir cleaner.\n+- If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.\n+- If disabled, the only change is that we uninstall sagelib before installing it.\n \n+A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-sage-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n+This ticket brings a number of speed improvements to mitigate this.\n \n``````\n",
    "created_at": "2022-10-03T01:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533406",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,15 @@
 When `./configure --disable-editable` is in use (the default before #32406), the Sage library is installed using its custom incremental implementation of `setup.py install` -- which installs its files in `site-packages` and then removes the files that it does not know about (the "cleaner").
 
-The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)
+Problem 1: The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)
 
-In this ticket, we change the installation procedure to go through wheel building and installation - like we do with all other Python packages.  
+Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if `make wheels` is used explicitly). Such wheels can be useful for making separate venvs.
 
-However, this makes a trivial `./sage -b` much slower (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s). This should be acceptable because after #32406, the primary use case of `./configure --disable-editable` is for fixed installations in an installation prefix, not for development.
+In this ticket:
+- We create a new option `./configure --enable-sage-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). 
+- We remove the use of the installation-dir cleaner.
+- If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.
+- If disabled, the only change is that we uninstall sagelib before installing it.
 
+A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-sage-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
+This ticket brings a number of speed improvements to mitigate this.
 
``````




---

archive/issue_comments_533407.json:
```json
{
    "body": "**Changing commit** from \"[15ef369eebada723851cd5ab32c9553f6c7b11c9](https://github.com/sagemath/sagetrac-mirror/commit/15ef369eebada723851cd5ab32c9553f6c7b11c9)\" to \"[bb0c3ec19839770d83e9761e4093daf659ca4bb7](https://github.com/sagemath/sagetrac-mirror/commit/bb0c3ec19839770d83e9761e4093daf659ca4bb7)\".",
    "created_at": "2022-10-03T01:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533407",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[15ef369eebada723851cd5ab32c9553f6c7b11c9](https://github.com/sagemath/sagetrac-mirror/commit/15ef369eebada723851cd5ab32c9553f6c7b11c9)" to "[bb0c3ec19839770d83e9761e4093daf659ca4bb7](https://github.com/sagemath/sagetrac-mirror/commit/bb0c3ec19839770d83e9761e4093daf659ca4bb7)".



---

archive/issue_comments_533408.json:
```json
{
    "body": "<a id='comment:49'>**Comment 49:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb0c3ec19839770d83e9761e4093daf659ca4bb7\">bb0c3ec</a></td><td><code>configure.ac (--enable-wheels): New</code></td></tr></table>\n",
    "created_at": "2022-10-03T01:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533408",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:49'>**Comment 49:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb0c3ec19839770d83e9761e4093daf659ca4bb7">bb0c3ec</a></td><td><code>configure.ac (--enable-wheels): New</code></td></tr></table>




---

archive/issue_events_398628.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-03T01:45:57Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "rename": {
        "from": "New option \"./configure --enable-sage-wheels\", replace installation-dir cleaner",
        "to": "New option \"./configure --enable-wheels\", replace installation-dir cleaner"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398628"
}
```



---

archive/issue_comments_533409.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,11 +5,11 @@\n Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if `make wheels` is used explicitly). Such wheels can be useful for making separate venvs.\n \n In this ticket:\n-- We create a new option `./configure --enable-sage-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). \n+- We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). \n - We remove the use of the installation-dir cleaner.\n - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.\n - If disabled, the only change is that we uninstall sagelib before installing it.\n \n-A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-sage-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n+A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n This ticket brings a number of speed improvements to mitigate this.\n \n``````\n",
    "created_at": "2022-10-03T01:45:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533409",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,11 +5,11 @@
 Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if `make wheels` is used explicitly). Such wheels can be useful for making separate venvs.
 
 In this ticket:
-- We create a new option `./configure --enable-sage-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). 
+- We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). 
 - We remove the use of the installation-dir cleaner.
 - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.
 - If disabled, the only change is that we uninstall sagelib before installing it.
 
-A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-sage-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
+A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
 This ticket brings a number of speed improvements to mitigate this.
 
``````




---

archive/issue_comments_533410.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n - We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). \n - We remove the use of the installation-dir cleaner.\n - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.\n-- If disabled, the only change is that we uninstall sagelib before installing it.\n+- If disabled, the only change is that we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).\n \n A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n This ticket brings a number of speed improvements to mitigate this.\n``````\n",
    "created_at": "2022-10-03T01:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533410",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 - We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). 
 - We remove the use of the installation-dir cleaner.
 - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.
-- If disabled, the only change is that we uninstall sagelib before installing it.
+- If disabled, the only change is that we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).
 
 A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
 This ticket brings a number of speed improvements to mitigate this.
``````




---

archive/issue_comments_533411.json:
```json
{
    "body": "<a id='comment:52'>**Comment 52:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ff338beaa5d6296792a8f3a011e338c05695f8f\">6ff338b</a></td><td><code>configure.ac: Improve docstring</code></td></tr></table>\n",
    "created_at": "2022-10-03T01:48:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533411",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:52'>**Comment 52:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ff338beaa5d6296792a8f3a011e338c05695f8f">6ff338b</a></td><td><code>configure.ac: Improve docstring</code></td></tr></table>




---

archive/issue_comments_533412.json:
```json
{
    "body": "**Changing commit** from \"[bb0c3ec19839770d83e9761e4093daf659ca4bb7](https://github.com/sagemath/sagetrac-mirror/commit/bb0c3ec19839770d83e9761e4093daf659ca4bb7)\" to \"[6ff338beaa5d6296792a8f3a011e338c05695f8f](https://github.com/sagemath/sagetrac-mirror/commit/6ff338beaa5d6296792a8f3a011e338c05695f8f)\".",
    "created_at": "2022-10-03T01:48:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533412",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bb0c3ec19839770d83e9761e4093daf659ca4bb7](https://github.com/sagemath/sagetrac-mirror/commit/bb0c3ec19839770d83e9761e4093daf659ca4bb7)" to "[6ff338beaa5d6296792a8f3a011e338c05695f8f](https://github.com/sagemath/sagetrac-mirror/commit/6ff338beaa5d6296792a8f3a011e338c05695f8f)".



---

archive/issue_comments_533413.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,6 +10,6 @@\n - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.\n - If disabled, the only change is that we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).\n \n-A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n+A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n This ticket brings a number of speed improvements to mitigate this.\n \n``````\n",
    "created_at": "2022-10-03T01:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533413",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,6 +10,6 @@
 - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.
 - If disabled, the only change is that we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).
 
-A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disabled-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
+A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
 This ticket brings a number of speed improvements to mitigate this.
 
``````




---

archive/issue_comments_533414.json:
```json
{
    "body": "**Changing commit** from \"[6ff338beaa5d6296792a8f3a011e338c05695f8f](https://github.com/sagemath/sagetrac-mirror/commit/6ff338beaa5d6296792a8f3a011e338c05695f8f)\" to \"[c6acede3a7e7301992f52bf055cb59d9e97e1da4](https://github.com/sagemath/sagetrac-mirror/commit/c6acede3a7e7301992f52bf055cb59d9e97e1da4)\".",
    "created_at": "2022-10-03T02:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533414",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[6ff338beaa5d6296792a8f3a011e338c05695f8f](https://github.com/sagemath/sagetrac-mirror/commit/6ff338beaa5d6296792a8f3a011e338c05695f8f)" to "[c6acede3a7e7301992f52bf055cb59d9e97e1da4](https://github.com/sagemath/sagetrac-mirror/commit/c6acede3a7e7301992f52bf055cb59d9e97e1da4)".



---

archive/issue_comments_533415.json:
```json
{
    "body": "<a id='comment:54'>**Comment 54:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6acede3a7e7301992f52bf055cb59d9e97e1da4\">c6acede</a></td><td><code>build/pkgs/{sage_conf,sage_docbuild,sage_setup,sage_sws2rst}/spkg-install: Handle SAGE_WHEELS</code></td></tr></table>\n",
    "created_at": "2022-10-03T02:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533415",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:54'>**Comment 54:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6acede3a7e7301992f52bf055cb59d9e97e1da4">c6acede</a></td><td><code>build/pkgs/{sage_conf,sage_docbuild,sage_setup,sage_sws2rst}/spkg-install: Handle SAGE_WHEELS</code></td></tr></table>




---

archive/issue_comments_533416.json:
```json
{
    "body": "**Changing commit** from \"[c6acede3a7e7301992f52bf055cb59d9e97e1da4](https://github.com/sagemath/sagetrac-mirror/commit/c6acede3a7e7301992f52bf055cb59d9e97e1da4)\" to \"[82d4c872ba108d0c6f7b94f93582d0c9ebba1973](https://github.com/sagemath/sagetrac-mirror/commit/82d4c872ba108d0c6f7b94f93582d0c9ebba1973)\".",
    "created_at": "2022-10-03T02:13:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533416",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c6acede3a7e7301992f52bf055cb59d9e97e1da4](https://github.com/sagemath/sagetrac-mirror/commit/c6acede3a7e7301992f52bf055cb59d9e97e1da4)" to "[82d4c872ba108d0c6f7b94f93582d0c9ebba1973](https://github.com/sagemath/sagetrac-mirror/commit/82d4c872ba108d0c6f7b94f93582d0c9ebba1973)".



---

archive/issue_comments_533417.json:
```json
{
    "body": "<a id='comment:55'>**Comment 55:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82d4c872ba108d0c6f7b94f93582d0c9ebba1973\">82d4c87</a></td><td><code>build/pkgs/sagelib/spkg-install: Only uninstall old sagelib after successful build</code></td></tr></table>\n",
    "created_at": "2022-10-03T02:13:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533417",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:55'>**Comment 55:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82d4c872ba108d0c6f7b94f93582d0c9ebba1973">82d4c87</a></td><td><code>build/pkgs/sagelib/spkg-install: Only uninstall old sagelib after successful build</code></td></tr></table>




---

archive/issue_comments_533418.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n - We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). \n - We remove the use of the installation-dir cleaner.\n - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.\n-- If disabled, the only change is that we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).\n+- If disabled, the only change is that after a successful build, we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).\n \n A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n This ticket brings a number of speed improvements to mitigate this.\n``````\n",
    "created_at": "2022-10-03T02:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533418",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 - We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). 
 - We remove the use of the installation-dir cleaner.
 - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.
-- If disabled, the only change is that we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).
+- If disabled, the only change is that after a successful build, we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).
 
 A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
 This ticket brings a number of speed improvements to mitigate this.
``````




---

archive/issue_comments_533419.json:
```json
{
    "body": "<a id='comment:57'>**Comment 57:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e6cd7dd2295437877c1f4ab31a16e6ad431eb24\">6e6cd7d</a></td><td><code>src/sage/misc/package_dir.py: Fix docstring markup</code></td></tr></table>\n",
    "created_at": "2022-10-03T02:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533419",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:57'>**Comment 57:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e6cd7dd2295437877c1f4ab31a16e6ad431eb24">6e6cd7d</a></td><td><code>src/sage/misc/package_dir.py: Fix docstring markup</code></td></tr></table>




---

archive/issue_comments_533420.json:
```json
{
    "body": "**Changing commit** from \"[82d4c872ba108d0c6f7b94f93582d0c9ebba1973](https://github.com/sagemath/sagetrac-mirror/commit/82d4c872ba108d0c6f7b94f93582d0c9ebba1973)\" to \"[6e6cd7dd2295437877c1f4ab31a16e6ad431eb24](https://github.com/sagemath/sagetrac-mirror/commit/6e6cd7dd2295437877c1f4ab31a16e6ad431eb24)\".",
    "created_at": "2022-10-03T02:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533420",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[82d4c872ba108d0c6f7b94f93582d0c9ebba1973](https://github.com/sagemath/sagetrac-mirror/commit/82d4c872ba108d0c6f7b94f93582d0c9ebba1973)" to "[6e6cd7dd2295437877c1f4ab31a16e6ad431eb24](https://github.com/sagemath/sagetrac-mirror/commit/6e6cd7dd2295437877c1f4ab31a16e6ad431eb24)".



---

archive/issue_comments_533421.json:
```json
{
    "body": "**Changing commit** from \"[6e6cd7dd2295437877c1f4ab31a16e6ad431eb24](https://github.com/sagemath/sagetrac-mirror/commit/6e6cd7dd2295437877c1f4ab31a16e6ad431eb24)\" to \"[e9ef5e520166269683fcb7105d58e8fc731817db](https://github.com/sagemath/sagetrac-mirror/commit/e9ef5e520166269683fcb7105d58e8fc731817db)\".",
    "created_at": "2022-10-03T05:21:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533421",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[6e6cd7dd2295437877c1f4ab31a16e6ad431eb24](https://github.com/sagemath/sagetrac-mirror/commit/6e6cd7dd2295437877c1f4ab31a16e6ad431eb24)" to "[e9ef5e520166269683fcb7105d58e8fc731817db](https://github.com/sagemath/sagetrac-mirror/commit/e9ef5e520166269683fcb7105d58e8fc731817db)".



---

archive/issue_comments_533422.json:
```json
{
    "body": "<a id='comment:58'>**Comment 58:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63745240270f72b10bd2a35bd7d16263b823a7aa\">6374524</a></td><td><code>pkgs/sagemath-standard/setup.py: Disable setuptools_scm file-finder</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7c4e665e8056b2bc50ed98974cf7a04898ff74c\">a7c4e66</a></td><td><code>src/MANIFEST.in: Do not use global-include</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f7747cfa7d87f824f14384f25529ebe2ca9722e\">3f7747c</a></td><td><code>/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/src/sage/libs/linkages/__init__.py: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e66952eee9fccd547d4b70e458e2581a56471029\">e66952e</a></td><td><code>src/sage_setup/clean.py: Update _find_stale_files doctest to use importlib.metadata.files('sagemath-standard')</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19171cf9f0b76acd086185527ae4406d3d66464c\">19171cf</a></td><td><code>configure.ac (--enable-wheels): New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/adb1848846214df82f773d4a511a650be86925f9\">adb1848</a></td><td><code>configure.ac: Improve docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb3caa998a55dcb7f2b5198ca9675c9e8aac7675\">cb3caa9</a></td><td><code>build/pkgs/{sage_conf,sage_docbuild,sage_setup,sage_sws2rst}/spkg-install: Handle SAGE_WHEELS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e13d1cef71a72dde3786bcf4050d0b6dc95d1d6\">7e13d1c</a></td><td><code>build/pkgs/sagelib/spkg-install: Only uninstall old sagelib after successful build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a5ed7716ac130e11ca742880050b84dfbcca696\">6a5ed77</a></td><td><code>src/sage/misc/package_dir.py: Fix docstring markup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9ef5e520166269683fcb7105d58e8fc731817db\">e9ef5e5</a></td><td><code>is_package_or_sage_namespace_package_dir: Add option distribution_filter</code></td></tr></table>\n",
    "created_at": "2022-10-03T05:21:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533422",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:58'>**Comment 58:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63745240270f72b10bd2a35bd7d16263b823a7aa">6374524</a></td><td><code>pkgs/sagemath-standard/setup.py: Disable setuptools_scm file-finder</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7c4e665e8056b2bc50ed98974cf7a04898ff74c">a7c4e66</a></td><td><code>src/MANIFEST.in: Do not use global-include</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f7747cfa7d87f824f14384f25529ebe2ca9722e">3f7747c</a></td><td><code>/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/src/sage/libs/linkages/__init__.py: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e66952eee9fccd547d4b70e458e2581a56471029">e66952e</a></td><td><code>src/sage_setup/clean.py: Update _find_stale_files doctest to use importlib.metadata.files('sagemath-standard')</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19171cf9f0b76acd086185527ae4406d3d66464c">19171cf</a></td><td><code>configure.ac (--enable-wheels): New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/adb1848846214df82f773d4a511a650be86925f9">adb1848</a></td><td><code>configure.ac: Improve docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb3caa998a55dcb7f2b5198ca9675c9e8aac7675">cb3caa9</a></td><td><code>build/pkgs/{sage_conf,sage_docbuild,sage_setup,sage_sws2rst}/spkg-install: Handle SAGE_WHEELS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e13d1cef71a72dde3786bcf4050d0b6dc95d1d6">7e13d1c</a></td><td><code>build/pkgs/sagelib/spkg-install: Only uninstall old sagelib after successful build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a5ed7716ac130e11ca742880050b84dfbcca696">6a5ed77</a></td><td><code>src/sage/misc/package_dir.py: Fix docstring markup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9ef5e520166269683fcb7105d58e8fc731817db">e9ef5e5</a></td><td><code>is_package_or_sage_namespace_package_dir: Add option distribution_filter</code></td></tr></table>




---

archive/issue_comments_533423.json:
```json
{
    "body": "<a id='comment:59'>**Comment 59:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e91a0bd93e030b6878cc6d7376bcc23d2a087e73\">e91a0bd</a></td><td><code>pkgs/sagemath-standard/setup.py: Disable setuptools_scm file-finder</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2fbdc84a1ebcce0d13d91eee17621e95176a369\">e2fbdc8</a></td><td><code>src/MANIFEST.in: Do not use global-include</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef46de5226647ef30e7128d3c6a8b8f4b152eb5b\">ef46de5</a></td><td><code>/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/src/sage/libs/linkages/__init__.py: New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67ff94529f5110e6148053cc4a940aad0fed373b\">67ff945</a></td><td><code>src/sage_setup/clean.py: Update _find_stale_files doctest to use importlib.metadata.files('sagemath-standard')</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a683934893dbed93451c6ef3b58722bb14f4c850\">a683934</a></td><td><code>configure.ac (--enable-wheels): New</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2d1576d13e1bd6299466172eecb9baecfdd9723\">f2d1576</a></td><td><code>configure.ac: Improve docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05b44d76ecee64468ca1ee79d5b0559fc28c26d5\">05b44d7</a></td><td><code>build/pkgs/{sage_conf,sage_docbuild,sage_setup,sage_sws2rst}/spkg-install: Handle SAGE_WHEELS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dde4bdb9c4553d9c25246a45d98a784e1c1cd8b3\">dde4bdb</a></td><td><code>src/sage/misc/package_dir.py: Fix docstring markup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffe67e8c6ad0efd6481aabec24dd0a4a1d603426\">ffe67e8</a></td><td><code>is_package_or_sage_namespace_package_dir: Add option distribution_filter</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11507a5f7e598035b4be6c00e89919190b271dc4\">11507a5</a></td><td><code>build/pkgs/sagelib/spkg-install: No need to uninstall before installing - cleaner is back in</code></td></tr></table>\n",
    "created_at": "2022-10-03T05:27:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533423",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:59'>**Comment 59:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e91a0bd93e030b6878cc6d7376bcc23d2a087e73">e91a0bd</a></td><td><code>pkgs/sagemath-standard/setup.py: Disable setuptools_scm file-finder</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2fbdc84a1ebcce0d13d91eee17621e95176a369">e2fbdc8</a></td><td><code>src/MANIFEST.in: Do not use global-include</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef46de5226647ef30e7128d3c6a8b8f4b152eb5b">ef46de5</a></td><td><code>/Users/mkoeppe/s/sage/sage-rebasing/worktree-rebase/src/sage/libs/linkages/__init__.py: New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67ff94529f5110e6148053cc4a940aad0fed373b">67ff945</a></td><td><code>src/sage_setup/clean.py: Update _find_stale_files doctest to use importlib.metadata.files('sagemath-standard')</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a683934893dbed93451c6ef3b58722bb14f4c850">a683934</a></td><td><code>configure.ac (--enable-wheels): New</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2d1576d13e1bd6299466172eecb9baecfdd9723">f2d1576</a></td><td><code>configure.ac: Improve docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05b44d76ecee64468ca1ee79d5b0559fc28c26d5">05b44d7</a></td><td><code>build/pkgs/{sage_conf,sage_docbuild,sage_setup,sage_sws2rst}/spkg-install: Handle SAGE_WHEELS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dde4bdb9c4553d9c25246a45d98a784e1c1cd8b3">dde4bdb</a></td><td><code>src/sage/misc/package_dir.py: Fix docstring markup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffe67e8c6ad0efd6481aabec24dd0a4a1d603426">ffe67e8</a></td><td><code>is_package_or_sage_namespace_package_dir: Add option distribution_filter</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11507a5f7e598035b4be6c00e89919190b271dc4">11507a5</a></td><td><code>build/pkgs/sagelib/spkg-install: No need to uninstall before installing - cleaner is back in</code></td></tr></table>




---

archive/issue_comments_533424.json:
```json
{
    "body": "**Changing commit** from \"[e9ef5e520166269683fcb7105d58e8fc731817db](https://github.com/sagemath/sagetrac-mirror/commit/e9ef5e520166269683fcb7105d58e8fc731817db)\" to \"[11507a5f7e598035b4be6c00e89919190b271dc4](https://github.com/sagemath/sagetrac-mirror/commit/11507a5f7e598035b4be6c00e89919190b271dc4)\".",
    "created_at": "2022-10-03T05:27:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533424",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e9ef5e520166269683fcb7105d58e8fc731817db](https://github.com/sagemath/sagetrac-mirror/commit/e9ef5e520166269683fcb7105d58e8fc731817db)" to "[11507a5f7e598035b4be6c00e89919190b271dc4](https://github.com/sagemath/sagetrac-mirror/commit/11507a5f7e598035b4be6c00e89919190b271dc4)".



---

archive/issue_comments_533425.json:
```json
{
    "body": "<a id='comment:60'>**Comment 60:**</a>\nReduced the scope of the ticket to make it easier to review.\n\nI'm postponing the changes to the cleaner to another ticket.",
    "created_at": "2022-10-03T05:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533425",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'>**Comment 60:**</a>
Reduced the scope of the ticket to make it easier to review.

I'm postponing the changes to the cleaner to another ticket.



---

archive/issue_comments_533426.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,9 +6,8 @@\n \n In this ticket:\n - We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). \n-- We remove the use of the installation-dir cleaner.\n - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.\n-- If disabled, the only change is that after a successful build, we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).\n+- If disabled, there is no change.\n \n A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n This ticket brings a number of speed improvements to mitigate this.\n``````\n",
    "created_at": "2022-10-03T05:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533426",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,9 +6,8 @@
 
 In this ticket:
 - We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). 
-- We remove the use of the installation-dir cleaner.
 - If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.
-- If disabled, the only change is that after a successful build, we uninstall sagelib before installing it (that's the replacement for the installation-dir cleaner).
+- If disabled, there is no change.
 
 A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
 This ticket brings a number of speed improvements to mitigate this.
``````




---

archive/issue_events_398629.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-10-03T05:29:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "rename": {
        "from": "New option \"./configure --enable-wheels\", replace installation-dir cleaner",
        "to": "New option \"./configure --enable-wheels\""
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398629"
}
```



---

archive/issue_comments_533427.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,11 +2,11 @@\n \n Problem 1: The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)\n \n-Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if `make wheels` is used explicitly). Such wheels can be useful for making separate venvs.\n+Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if [make wheels](https://trac.sagemath.org/wiki/ReleaseTours/sage-9.7#Editableinstallationisnowthedefault) is used explicitly). Such wheels can be useful for making separate venvs.\n \n In this ticket:\n - We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). \n-- If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.\n+- If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages. This enables modularized builds (#34587).\n - If disabled, there is no change.\n \n A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).\n``````\n",
    "created_at": "2022-10-03T05:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533427",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,11 +2,11 @@
 
 Problem 1: The cleaner is incompatible with namespace packages and trying to fix it would lead to complicated and awkward code (#32927). (Besides, `setup.py install` is deprecated since https://setuptools.pypa.io/en/latest/history.html#v58-3-0)
 
-Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if `make wheels` is used explicitly). Such wheels can be useful for making separate venvs.
+Problem 2: Because of the direct installation, we do not have wheels for sagemath-standard available (even if [make wheels](https://trac.sagemath.org/wiki/ReleaseTours/sage-9.7#Editableinstallationisnowthedefault) is used explicitly). Such wheels can be useful for making separate venvs.
 
 In this ticket:
 - We create a new option `./configure --enable-wheels` (which can be used both with `./configure --enable-editable` and `./configure --disable-editable`). 
-- If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages.
+- If enabled, installation of sagelib will go through wheel building and installation - like we do with all other Python packages. This enables modularized builds (#34587).
 - If disabled, there is no change.
 
 A trivial `./sage -b` is much slower with `./configure --disable-editable --enable-wheels` compared to `./configure --disable-editable` (from 28s as per timings in [#32406 comment:21](https://github.com/sagemath/sage/issues/32406#comment:21) to 70s).
``````




---

archive/issue_comments_533428.json:
```json
{
    "body": "<a id='comment:63'>**Comment 63:**</a>\n`./configure --enable-wheels` doesn't seem to work for me, even after `./bootstrap` (is this necessary?)",
    "created_at": "2022-10-03T11:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533428",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:63'>**Comment 63:**</a>
`./configure --enable-wheels` doesn't seem to work for me, even after `./bootstrap` (is this necessary?)



---

archive/issue_comments_533429.json:
```json
{
    "body": "<a id='comment:64'>**Comment 64:**</a>\nReplying to [Kwankyu Lee](#comment%3A63):\n> `./configure --enable-wheels` doesn't seem to work for me, even after `./bootstrap` (is this necessary?)\n\n`sage -b` after `./configure --disable-editable` does not install wheel. `sage -b` just takes 20 seconds.",
    "created_at": "2022-10-03T11:45:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533429",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:64'>**Comment 64:**</a>
Replying to [Kwankyu Lee](#comment%3A63):
> `./configure --enable-wheels` doesn't seem to work for me, even after `./bootstrap` (is this necessary?)

`sage -b` after `./configure --disable-editable` does not install wheel. `sage -b` just takes 20 seconds.



---

archive/issue_comments_533430.json:
```json
{
    "body": "<a id='comment:65'>**Comment 65:**</a>\nYes, there are 4 modes of operation now, all combinations of `--{en,dis}able-editable` and `--{en,dis}able-wheels` should work",
    "created_at": "2022-10-03T16:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533430",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'>**Comment 65:**</a>
Yes, there are 4 modes of operation now, all combinations of `--{en,dis}able-editable` and `--{en,dis}able-wheels` should work



---

archive/issue_comments_533431.json:
```json
{
    "body": "<a id='comment:66'>**Comment 66:**</a>\nWhat doesn't work is to configure those options separately: `./configure --enable-wheels` and then `./configure --disable-editable`. I guess this is normal.\n\nYes, `./configure --disable-editable --enable-wheels` does build the wheel :)",
    "created_at": "2022-10-04T04:00:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533431",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:66'>**Comment 66:**</a>
What doesn't work is to configure those options separately: `./configure --enable-wheels` and then `./configure --disable-editable`. I guess this is normal.

Yes, `./configure --disable-editable --enable-wheels` does build the wheel :)



---

archive/issue_comments_533432.json:
```json
{
    "body": "<a id='comment:67'>**Comment 67:**</a>\nTo add options to the previous list of configure options, there's unfortunately no shorter idiom than \n\n```\neval ./configure $(./config.status --config) NEW-OPTIONS...\n```",
    "created_at": "2022-10-04T04:03:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533432",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:67'>**Comment 67:**</a>
To add options to the previous list of configure options, there's unfortunately no shorter idiom than 

```
eval ./configure $(./config.status --config) NEW-OPTIONS...
```



---

archive/issue_comments_533433.json:
```json
{
    "body": "<a id='comment:68'>**Comment 68:**</a>\nMaking `--enable-wheels` default eventually is necessary for sagelib modularization. Right?",
    "created_at": "2022-10-04T04:13:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533433",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:68'>**Comment 68:**</a>
Making `--enable-wheels` default eventually is necessary for sagelib modularization. Right?



---

archive/issue_comments_533434.json:
```json
{
    "body": "<a id='comment:69'>**Comment 69:**</a>\nI'd say it will be necessary as soon as the first external packages arrive that declare a dependency on a modularized distribution rather than on `sagemath-standard`.\n\nUntil then we can get away with keeping both `--enable-editable` and `--disable-editable --disable-wheels` monolithic; and we can use `--disable-editable --enable-wheels` for working on the details of the modularized distributions.",
    "created_at": "2022-10-04T04:21:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533434",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'>**Comment 69:**</a>
I'd say it will be necessary as soon as the first external packages arrive that declare a dependency on a modularized distribution rather than on `sagemath-standard`.

Until then we can get away with keeping both `--enable-editable` and `--disable-editable --disable-wheels` monolithic; and we can use `--disable-editable --enable-wheels` for working on the details of the modularized distributions.



---

archive/issue_comments_533435.json:
```json
{
    "body": "<a id='comment:70'>**Comment 70:**</a>\n(see ticket description of #34587)",
    "created_at": "2022-10-04T04:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533435",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'>**Comment 70:**</a>
(see ticket description of #34587)



---

archive/issue_comments_533436.json:
```json
{
    "body": "<a id='comment:71'>**Comment 71:**</a>\nQuestions on changes in `src/MANIFEST.in`:\n\n1. Is this line `include MANIFEST.in` necessary? Perhaps because `src/MANIFEST.in` is a symlink?\n\n2. How was this list made ? Could the hard-coded list be still valid in future?      \n\n```\ninclude sage/modular/arithgroup/farey_symbol.h\ninclude sage/cpython/debugimpl.c\ninclude sage/graphs/base/boost_interface.cpp\ninclude sage/graphs/cliquer/cl.c\ninclude sage/graphs/graph_decompositions/sage_tdlib.cpp\ninclude sage/libs/eclib/wrap.cpp\ninclude sage/libs/linkages/padics/relaxed/flint_helper.c\ninclude sage/misc/inherit_comparison_impl.c\ninclude sage/modular/arithgroup/farey.cpp\ninclude sage/modular/arithgroup/sl2z.cpp\ninclude sage/rings/bernmm/bern_modp.cpp\ninclude sage/rings/bernmm/bern_modp_util.cpp\ninclude sage/rings/bernmm/bern_rat.cpp\ninclude sage/rings/bernmm/bernmm-test.cpp\ninclude sage/rings/padics/transcendantal.c\ninclude sage/rings/polynomial/weil/power_sums.c\ninclude sage/schemes/hyperelliptic_curves/hypellfrob/hypellfrob.cpp\ninclude sage/schemes/hyperelliptic_curves/hypellfrob/recurrences_ntl.cpp\ninclude sage/schemes/hyperelliptic_curves/hypellfrob/recurrences_zn_poly.cpp\ninclude sage/stats/distributions/dgs_bern.c\ninclude sage/stats/distributions/dgs_gauss_dp.c\ninclude sage/stats/distributions/dgs_gauss_mp.c\ninclude sage/symbolic/ginac/*.cpp   \n```",
    "created_at": "2022-10-04T05:45:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533436",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:71'>**Comment 71:**</a>
Questions on changes in `src/MANIFEST.in`:

1. Is this line `include MANIFEST.in` necessary? Perhaps because `src/MANIFEST.in` is a symlink?

2. How was this list made ? Could the hard-coded list be still valid in future?      

```
include sage/modular/arithgroup/farey_symbol.h
include sage/cpython/debugimpl.c
include sage/graphs/base/boost_interface.cpp
include sage/graphs/cliquer/cl.c
include sage/graphs/graph_decompositions/sage_tdlib.cpp
include sage/libs/eclib/wrap.cpp
include sage/libs/linkages/padics/relaxed/flint_helper.c
include sage/misc/inherit_comparison_impl.c
include sage/modular/arithgroup/farey.cpp
include sage/modular/arithgroup/sl2z.cpp
include sage/rings/bernmm/bern_modp.cpp
include sage/rings/bernmm/bern_modp_util.cpp
include sage/rings/bernmm/bern_rat.cpp
include sage/rings/bernmm/bernmm-test.cpp
include sage/rings/padics/transcendantal.c
include sage/rings/polynomial/weil/power_sums.c
include sage/schemes/hyperelliptic_curves/hypellfrob/hypellfrob.cpp
include sage/schemes/hyperelliptic_curves/hypellfrob/recurrences_ntl.cpp
include sage/schemes/hyperelliptic_curves/hypellfrob/recurrences_zn_poly.cpp
include sage/stats/distributions/dgs_bern.c
include sage/stats/distributions/dgs_gauss_dp.c
include sage/stats/distributions/dgs_gauss_mp.c
include sage/symbolic/ginac/*.cpp   
```



---

archive/issue_comments_533437.json:
```json
{
    "body": "**Reviewer:** Kwankyu Lee",
    "created_at": "2022-10-04T05:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533437",
    "user": "https://github.com/kwankyu"
}
```

**Reviewer:** Kwankyu Lee



---

archive/issue_comments_533438.json:
```json
{
    "body": "**Changing commit** from \"[11507a5f7e598035b4be6c00e89919190b271dc4](https://github.com/sagemath/sagetrac-mirror/commit/11507a5f7e598035b4be6c00e89919190b271dc4)\" to \"[974c7fd8aa4dce5b2376ad430d1e0769d91b7912](https://github.com/sagemath/sagetrac-mirror/commit/974c7fd8aa4dce5b2376ad430d1e0769d91b7912)\".",
    "created_at": "2022-10-04T18:15:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533438",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[11507a5f7e598035b4be6c00e89919190b271dc4](https://github.com/sagemath/sagetrac-mirror/commit/11507a5f7e598035b4be6c00e89919190b271dc4)" to "[974c7fd8aa4dce5b2376ad430d1e0769d91b7912](https://github.com/sagemath/sagetrac-mirror/commit/974c7fd8aa4dce5b2376ad430d1e0769d91b7912)".



---

archive/issue_comments_533439.json:
```json
{
    "body": "<a id='comment:73'>**Comment 73:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/974c7fd8aa4dce5b2376ad430d1e0769d91b7912\">974c7fd</a></td><td><code>src/MANIFEST.in: Remove redundant entries for MANIFEST.in, pyproject.toml</code></td></tr></table>\n",
    "created_at": "2022-10-04T18:15:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533439",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:73'>**Comment 73:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/974c7fd8aa4dce5b2376ad430d1e0769d91b7912">974c7fd</a></td><td><code>src/MANIFEST.in: Remove redundant entries for MANIFEST.in, pyproject.toml</code></td></tr></table>




---

archive/issue_comments_533440.json:
```json
{
    "body": "<a id='comment:74'>**Comment 74:**</a>\nReplying to [Kwankyu Lee](#comment%3A71):\n> Questions on changes in `src/MANIFEST.in`:\n> \n> 1. Is this line `include MANIFEST.in` necessary? Perhaps because `src/MANIFEST.in` is a symlink?\n\nNo, not necessary any more; it probably was necessary with prehistoric versions of setuptools.",
    "created_at": "2022-10-04T18:16:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533440",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'>**Comment 74:**</a>
Replying to [Kwankyu Lee](#comment%3A71):
> Questions on changes in `src/MANIFEST.in`:
> 
> 1. Is this line `include MANIFEST.in` necessary? Perhaps because `src/MANIFEST.in` is a symlink?

No, not necessary any more; it probably was necessary with prehistoric versions of setuptools.



---

archive/issue_comments_533441.json:
```json
{
    "body": "<a id='comment:75'>**Comment 75:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3\">25898ba</a></td><td><code>src/MANIFEST.in: Exclude generated file farey_symbol.h; add comments</code></td></tr></table>\n",
    "created_at": "2022-10-04T18:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533441",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:75'>**Comment 75:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3">25898ba</a></td><td><code>src/MANIFEST.in: Exclude generated file farey_symbol.h; add comments</code></td></tr></table>




---

archive/issue_comments_533442.json:
```json
{
    "body": "**Changing commit** from \"[974c7fd8aa4dce5b2376ad430d1e0769d91b7912](https://github.com/sagemath/sagetrac-mirror/commit/974c7fd8aa4dce5b2376ad430d1e0769d91b7912)\" to \"[25898ba992588a8dc2df07e40c12a4dcee9909f3](https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3)\".",
    "created_at": "2022-10-04T18:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533442",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[974c7fd8aa4dce5b2376ad430d1e0769d91b7912](https://github.com/sagemath/sagetrac-mirror/commit/974c7fd8aa4dce5b2376ad430d1e0769d91b7912)" to "[25898ba992588a8dc2df07e40c12a4dcee9909f3](https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3)".



---

archive/issue_comments_533443.json:
```json
{
    "body": "<a id='comment:76'>**Comment 76:**</a>\nReplying to [Kwankyu Lee](#comment%3A71):\n> 2. How was this list made ?\n\nI've added a comment (and fixed a mistake that I had made along the way).",
    "created_at": "2022-10-04T18:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533443",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'>**Comment 76:**</a>
Replying to [Kwankyu Lee](#comment%3A71):
> 2. How was this list made ?

I've added a comment (and fixed a mistake that I had made along the way).



---

archive/issue_events_398630.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-10-04T23:27:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398630"
}
```



---

archive/issue_events_398631.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-10-04T23:27:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398631"
}
```



---

archive/issue_comments_533444.json:
```json
{
    "body": "<a id='comment:77'>**Comment 77:**</a>\nThanks. \n\nIt works well and looks good to me.",
    "created_at": "2022-10-04T23:27:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533444",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:77'>**Comment 77:**</a>
Thanks. 

It works well and looks good to me.



---

archive/issue_comments_533445.json:
```json
{
    "body": "<a id='comment:78'>**Comment 78:**</a>\nThank you!",
    "created_at": "2022-10-04T23:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533445",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'>**Comment 78:**</a>
Thank you!



---

archive/issue_events_398632.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-10-16T22:16:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398632"
}
```



---

archive/issue_events_398633.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a9abd3b2da40a60e1a76ab35411769bd0a91ccf0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-10-16T22:16:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/32874#event-398633"
}
```



---

archive/issue_comments_533446.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/remove_use_of__setup_py_install__for_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/remove_use_of__setup_py_install__for_sagelib)\" to \"[25898ba992588a8dc2df07e40c12a4dcee9909f3](https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3)\".",
    "created_at": "2022-10-16T22:16:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533446",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/remove_use_of__setup_py_install__for_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/remove_use_of__setup_py_install__for_sagelib)" to "[25898ba992588a8dc2df07e40c12a4dcee9909f3](https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3)".



---

archive/issue_comments_533447.json:
```json
{
    "body": "**Changing commit** from \"[25898ba992588a8dc2df07e40c12a4dcee9909f3](https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3)\" to \"\".",
    "created_at": "2022-10-17T20:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533447",
    "user": "https://github.com/antonio-rojas"
}
```

**Changing commit** from "[25898ba992588a8dc2df07e40c12a4dcee9909f3](https://github.com/sagemath/sagetrac-mirror/commit/25898ba992588a8dc2df07e40c12a4dcee9909f3)" to "".



---

archive/issue_comments_533448.json:
```json
{
    "body": "<a id='comment:80'>**Comment 80:**</a>\nThis makes tests depend on `sage_setup`, so one gets failures when testing an installed sage\n\n```\nsage -t --long --random-seed=334405888414880658562662015982432628863 /usr/lib/python3.10/site-packages/sage/misc/package_dir.py\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/misc/package_dir.py\", line 108, in sage.misc.package_dir.read_distribution\nFailed example:\n    from sage_setup.find import read_distribution\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package_dir.read_distribution[1]>\", line 1, in <module>\n        from sage_setup.find import read_distribution\n    ModuleNotFoundError: No module named 'sage_setup'\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/misc/package_dir.py\", line 109, in sage.misc.package_dir.read_distribution\nFailed example:\n    read_distribution(os.path.join(SAGE_SRC, 'sage', 'graphs', 'graph_decompositions', 'tdlib.pyx'))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package_dir.read_distribution[2]>\", line 1, in <module>\n        read_distribution(os.path.join(SAGE_SRC, 'sage', 'graphs', 'graph_decompositions', 'tdlib.pyx'))\n    NameError: name 'read_distribution' is not defined\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/misc/package_dir.py\", line 111, in sage.misc.package_dir.read_distribution\nFailed example:\n    read_distribution(os.path.join(SAGE_SRC, 'sage', 'graphs', 'graph_decompositions', 'modular_decomposition.py'))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package_dir.read_distribution[3]>\", line 1, in <module>\n        read_distribution(os.path.join(SAGE_SRC, 'sage', 'graphs', 'graph_decompositions', 'modular_decomposition.py'))\n    NameError: name 'read_distribution' is not defined\n**********************************************************************\n```",
    "created_at": "2022-10-17T20:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533448",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:80'>**Comment 80:**</a>
This makes tests depend on `sage_setup`, so one gets failures when testing an installed sage

```
sage -t --long --random-seed=334405888414880658562662015982432628863 /usr/lib/python3.10/site-packages/sage/misc/package_dir.py
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/misc/package_dir.py", line 108, in sage.misc.package_dir.read_distribution
Failed example:
    from sage_setup.find import read_distribution
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package_dir.read_distribution[1]>", line 1, in <module>
        from sage_setup.find import read_distribution
    ModuleNotFoundError: No module named 'sage_setup'
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/misc/package_dir.py", line 109, in sage.misc.package_dir.read_distribution
Failed example:
    read_distribution(os.path.join(SAGE_SRC, 'sage', 'graphs', 'graph_decompositions', 'tdlib.pyx'))
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package_dir.read_distribution[2]>", line 1, in <module>
        read_distribution(os.path.join(SAGE_SRC, 'sage', 'graphs', 'graph_decompositions', 'tdlib.pyx'))
    NameError: name 'read_distribution' is not defined
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/misc/package_dir.py", line 111, in sage.misc.package_dir.read_distribution
Failed example:
    read_distribution(os.path.join(SAGE_SRC, 'sage', 'graphs', 'graph_decompositions', 'modular_decomposition.py'))
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package_dir.read_distribution[3]>", line 1, in <module>
        read_distribution(os.path.join(SAGE_SRC, 'sage', 'graphs', 'graph_decompositions', 'modular_decomposition.py'))
    NameError: name 'read_distribution' is not defined
**********************************************************************
```



---

archive/issue_comments_533449.json:
```json
{
    "body": "<a id='comment:81'>**Comment 81:**</a>\nI've opened #34674 for this",
    "created_at": "2022-10-17T20:54:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533449",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'>**Comment 81:**</a>
I've opened #34674 for this



---

archive/issue_comments_533450.json:
```json
{
    "body": "<a id='comment:82'>**Comment 82:**</a>\nA question to educate myself: In what environment, `sage_setup` module is not available? Is this a linux package?",
    "created_at": "2022-10-17T22:17:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533450",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:82'>**Comment 82:**</a>
A question to educate myself: In what environment, `sage_setup` module is not available? Is this a linux package?



---

archive/issue_comments_533451.json:
```json
{
    "body": "<a id='comment:83'>**Comment 83:**</a>\nIn distribution packaging (Antonio does the packaging for Arch Linux), `sage_setup` is typically not available at runtime.",
    "created_at": "2022-10-17T22:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533451",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:83'>**Comment 83:**</a>
In distribution packaging (Antonio does the packaging for Arch Linux), `sage_setup` is typically not available at runtime.



---

archive/issue_comments_533452.json:
```json
{
    "body": "<a id='comment:84'>**Comment 84:**</a>\nOkay. Thanks.",
    "created_at": "2022-10-17T22:27:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/32874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/32874#issuecomment-533452",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:84'>**Comment 84:**</a>
Okay. Thanks.
