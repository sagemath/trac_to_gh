# Issue 32753: Prefer Linux package manager over linuxbrew; add nix detection

archive/issues_032516.json:
```json
{
    "body": "If brew is installed on Linux, Sagemath thinks this is the primary package manager and, e.g., `configure` suggests to run `brew ...` to install new packages. However, linuxbrew is untested as a platform for Sage, and so this is not a good idea.\n\nWe change `build/bin/sage-guess-package-system` so that `brew` is only tested after the Linux package managers. \n\nWe also add a detection for `nix-env`.\n\n\n\nCC:  @mkoeppe @collares @jplab\n\nBranch: [u/mkoeppe/prefer_linux_package_manager_over_linuxbrew](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/prefer_linux_package_manager_over_linuxbrew)\n\nAuthor: Matthias Koeppe\n\nStatus: needs_review\n\nCommit: 9af33a1b8678fc351413a1fa67daceb7b9439161\n\nIssue created by migration from https://trac.sagemath.org/ticket/32753\n\n",
    "created_at": "2021-10-24T12:38:14Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Prefer Linux package manager over linuxbrew; add nix detection",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32753",
    "user": "https://github.com/tobiasdiez"
}
```
If brew is installed on Linux, Sagemath thinks this is the primary package manager and, e.g., `configure` suggests to run `brew ...` to install new packages. However, linuxbrew is untested as a platform for Sage, and so this is not a good idea.

We change `build/bin/sage-guess-package-system` so that `brew` is only tested after the Linux package managers. 

We also add a detection for `nix-env`.



CC:  @mkoeppe @collares @jplab

Branch: [u/mkoeppe/prefer_linux_package_manager_over_linuxbrew](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/prefer_linux_package_manager_over_linuxbrew)

Author: Matthias Koeppe

Status: needs_review

Commit: 9af33a1b8678fc351413a1fa67daceb7b9439161

Issue created by migration from https://trac.sagemath.org/ticket/32753





---

archive/issue_events_097500.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32753#event-97500"
}
```



---

archive/issue_comments_652900.json:
```json
{
    "body": "<a id='comment:2'></a>\nI now see this in our gitpod.",
    "created_at": "2022-02-14T10:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652900",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
I now see this in our gitpod.



---

archive/issue_comments_652901.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/prefer_linux_package_manager_over_linuxbrew\"",
    "created_at": "2022-02-15T19:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652901",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/prefer_linux_package_manager_over_linuxbrew"



---

archive/issue_comments_652902.json:
```json
{
    "body": "Changing commit from \"\" to \"90f7ced00b74cca051c167c271a9a49155ad0710\"",
    "created_at": "2022-02-15T19:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652902",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "90f7ced00b74cca051c167c271a9a49155ad0710"



---

archive/issue_comments_652903.json:
```json
{
    "body": "<a id='comment:4'></a>\nFor `nix`, do we need to check whether a nix environment is active, like we do for `conda`?\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|\n|[04f9749](https://github.com/sagemath/sagetrac-mirror/commit/04f97495a22c057fdb91f972022b3947ead90367)|`build/bin/sage-guess-package-system: check linuxbrew after linux package managers because it is untested`|\n|[90f7ced](https://github.com/sagemath/sagetrac-mirror/commit/90f7ced00b74cca051c167c271a9a49155ad0710)|`build/bin/sage-guess-package-system: Check for nix`|",
    "created_at": "2022-02-15T19:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
For `nix`, do we need to check whether a nix environment is active, like we do for `conda`?

---
New commits:
|                                                                                                                                          |                                                                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
|[04f9749](https://github.com/sagemath/sagetrac-mirror/commit/04f97495a22c057fdb91f972022b3947ead90367)|`build/bin/sage-guess-package-system: check linuxbrew after linux package managers because it is untested`|
|[90f7ced](https://github.com/sagemath/sagetrac-mirror/commit/90f7ced00b74cca051c167c271a9a49155ad0710)|`build/bin/sage-guess-package-system: Check for nix`|



---

archive/issue_comments_652904.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n-If brew is installed on Linux, Sagemath thinks this is the primary package manager and, e.g., configure suggests to run brew xyz to install new packages.\n+If brew is installed on Linux, Sagemath thinks this is the primary package manager and, e.g., `configure` suggests to run `brew ...` to install new packages. However, linuxbrew is untested as a platform for Sage, and so this is not a good idea.\n \n-Probably build/bin/sage-guess-package-system should be changed so that brew is only tested after the Linux package managers. \n+We change `build/bin/sage-guess-package-system` so that `brew` is only tested after the Linux package managers. \n+\n+We also add a detection for `nix-env`.\n+\n+\n``````\n",
    "created_at": "2022-02-15T19:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652904",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
-If brew is installed on Linux, Sagemath thinks this is the primary package manager and, e.g., configure suggests to run brew xyz to install new packages.
+If brew is installed on Linux, Sagemath thinks this is the primary package manager and, e.g., `configure` suggests to run `brew ...` to install new packages. However, linuxbrew is untested as a platform for Sage, and so this is not a good idea.
 
-Probably build/bin/sage-guess-package-system should be changed so that brew is only tested after the Linux package managers. 
+We change `build/bin/sage-guess-package-system` so that `brew` is only tested after the Linux package managers. 
+
+We also add a detection for `nix-env`.
+
+
``````




---

archive/issue_comments_652905.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-15T19:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652905",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_652906.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2022-02-15T19:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652906",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_events_097501.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "rename": {
        "from": "Prefer Linux package manager over linuxbrew",
        "to": "Prefer Linux package manager over linuxbrew; add nix detection"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32753#event-97501"
}
```



---

archive/issue_comments_652907.json:
```json
{
    "body": "<a id='comment:5'></a>\nTo be honest with you, I have never used `nix-env` (the manual offers a declarative path and a `nix-env` path, and strongly suggests `nix-env` is the worst of the two alternatives). I think supporting `nix-env` is valid, but given my lack of experience with it I am not sure what the workflow would be in this case. You can certainly install packages with `nix-env` in your \"default profile\", and the executables would be in `PATH` without having to activate an environment.\n\nPeople who follow the declarative approach and want to build Sage from source would bypass `nix-env` and  write a derivation (a declarative recipe, basically) to pull in the required dependencies, and then pass this to `nix-shell` to obtain an ephemeral `virtualenv`-like environment with those deps available. Or, instead of writing the derivation themselves, they could also use Nixpkgs's Sage derivation to get the same build environment we use. Either way, they would be able to build Sage from Git sources using Nix packages for the dependencies, but `nix-env` would be none the wiser.\n\nIt would be useful to know a few things so I can understand how this fits into the Nix model: Is it just for printing a command to install dependencies? Or does it query installed packages as well? What happens if Singular (say) just exists on `PATH` but `nix-env` doesn't report it as installed? Pointing me to the relevant source file would be enough, no need to answer in detail. Thanks!",
    "created_at": "2022-02-15T20:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652907",
    "user": "https://github.com/collares"
}
```

<a id='comment:5'></a>
To be honest with you, I have never used `nix-env` (the manual offers a declarative path and a `nix-env` path, and strongly suggests `nix-env` is the worst of the two alternatives). I think supporting `nix-env` is valid, but given my lack of experience with it I am not sure what the workflow would be in this case. You can certainly install packages with `nix-env` in your "default profile", and the executables would be in `PATH` without having to activate an environment.

People who follow the declarative approach and want to build Sage from source would bypass `nix-env` and  write a derivation (a declarative recipe, basically) to pull in the required dependencies, and then pass this to `nix-shell` to obtain an ephemeral `virtualenv`-like environment with those deps available. Or, instead of writing the derivation themselves, they could also use Nixpkgs's Sage derivation to get the same build environment we use. Either way, they would be able to build Sage from Git sources using Nix packages for the dependencies, but `nix-env` would be none the wiser.

It would be useful to know a few things so I can understand how this fits into the Nix model: Is it just for printing a command to install dependencies? Or does it query installed packages as well? What happens if Singular (say) just exists on `PATH` but `nix-env` doesn't report it as installed? Pointing me to the relevant source file would be enough, no need to answer in detail. Thanks!



---

archive/issue_comments_652908.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [gh-collares](#comment%3A5):\n> People who follow the declarative approach and want to build Sage from source would bypass `nix-env` and  write a derivation (a declarative recipe, basically) to pull in the required dependencies, and then pass this to `nix-shell` to obtain an ephemeral `virtualenv`-like environment with those deps available. Or, instead of writing the derivation themselves, they could also use Nixpkgs's Sage derivation to get the same build environment we use. \n\n\nIt would be great to have instructions how to do Sage development using nixpkgs in our installation manual. \n\nOther than figuring out how to provision a nix environment with packages on top of the `nixos/nix` Docker image (so I can say `tox -e docker-nixos-standard`), I have no experience with nix.\n\nBy the way, I am getting the error:\n\n```\nStep 6/46 : RUN  nix-env --install  gd iml m4ri gfan singular mpfi cmake symmetrica flintqs freetype cddlib libbraiding brial ppl sympow zn_poly readline R sqlite tachyon giac m4rie blas lapack ntl glpk fflas-ffpack libmpc gsl boost nauty binutils gnumake gnum4 perl python3 gnutar bc gcc bash flint arb pari cliquer libhomfly openssl gengetopt planarity lrcalc palp ecm givaro ecl eclib lcalc rankwidth qhull gettext autoconf automake libtool pkg-config\n ---> Running in 0dcbda1f2003\nerror: selector 'libhomfly' matches no derivations\n```\nso it may be that some work on the `nix.txt` files is needed.",
    "created_at": "2022-02-15T20:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652908",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Replying to [gh-collares](#comment%3A5):
> People who follow the declarative approach and want to build Sage from source would bypass `nix-env` and  write a derivation (a declarative recipe, basically) to pull in the required dependencies, and then pass this to `nix-shell` to obtain an ephemeral `virtualenv`-like environment with those deps available. Or, instead of writing the derivation themselves, they could also use Nixpkgs's Sage derivation to get the same build environment we use. 


It would be great to have instructions how to do Sage development using nixpkgs in our installation manual. 

Other than figuring out how to provision a nix environment with packages on top of the `nixos/nix` Docker image (so I can say `tox -e docker-nixos-standard`), I have no experience with nix.

By the way, I am getting the error:

```
Step 6/46 : RUN  nix-env --install  gd iml m4ri gfan singular mpfi cmake symmetrica flintqs freetype cddlib libbraiding brial ppl sympow zn_poly readline R sqlite tachyon giac m4rie blas lapack ntl glpk fflas-ffpack libmpc gsl boost nauty binutils gnumake gnum4 perl python3 gnutar bc gcc bash flint arb pari cliquer libhomfly openssl gengetopt planarity lrcalc palp ecm givaro ecl eclib lcalc rankwidth qhull gettext autoconf automake libtool pkg-config
 ---> Running in 0dcbda1f2003
error: selector 'libhomfly' matches no derivations
```
so it may be that some work on the `nix.txt` files is needed.



---

archive/issue_comments_652909.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [gh-collares](#comment%3A5):\n> It would be useful to know a few things so I can understand how this fits into the Nix model: Is it just for printing a command to install dependencies? \n\n\nYes, it's for the system package advice that is printed at the end of a `configure` run.\n\nThe code for this is in `build/bin/sage-print-system-package-command`.",
    "created_at": "2022-02-15T20:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652909",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Replying to [gh-collares](#comment%3A5):
> It would be useful to know a few things so I can understand how this fits into the Nix model: Is it just for printing a command to install dependencies? 


Yes, it's for the system package advice that is printed at the end of a `configure` run.

The code for this is in `build/bin/sage-print-system-package-command`.



---

archive/issue_comments_652910.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [gh-collares](#comment%3A5):\n> What happens if Singular (say) just exists on `PATH` \n\n\n`configure` only checks what is available in `PATH`.\n\nFor packages where we don't find a system package in this way, if there is system package information in `build/pkgs/*/nix.txt` for the package, we issue the system package advice. No package manager queries are done -- this is all left to the user.\n\n(This is a design principle for this code -- it does not attempt to take care of system package installation tasks for the user; instead it only informs/educates the user about possible commands.)",
    "created_at": "2022-02-15T20:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652910",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Replying to [gh-collares](#comment%3A5):
> What happens if Singular (say) just exists on `PATH` 


`configure` only checks what is available in `PATH`.

For packages where we don't find a system package in this way, if there is system package information in `build/pkgs/*/nix.txt` for the package, we issue the system package advice. No package manager queries are done -- this is all left to the user.

(This is a design principle for this code -- it does not attempt to take care of system package installation tasks for the user; instead it only informs/educates the user about possible commands.)



---

archive/issue_comments_652911.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks for the information, this is very helpful! So, yeah, I think recommending `nix-env` is fine, since people who use the declarative approach can just copy and paste the list of packages into their derivations.\n\nAs for the libhomfly error: The preferred way to install packages using `nix-env` is `nix-env -f '<nixpkgs>' -iA m4ri libhomfly` (say). The `-A` flag specifies a saner way of finding the relevant package; in this case, the `-A`-less version caught a typo in the Nix package. I've submitted a PR to fix it in Nixpkgs, but ideally the `nix-env` invocation would be switched to something like the command I mentioned above.\n\nI will try to write some docs for Sage development with nixpkgs as part of the Sage 9.6 release.",
    "created_at": "2022-02-15T20:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652911",
    "user": "https://github.com/collares"
}
```

<a id='comment:9'></a>
Thanks for the information, this is very helpful! So, yeah, I think recommending `nix-env` is fine, since people who use the declarative approach can just copy and paste the list of packages into their derivations.

As for the libhomfly error: The preferred way to install packages using `nix-env` is `nix-env -f '<nixpkgs>' -iA m4ri libhomfly` (say). The `-A` flag specifies a saner way of finding the relevant package; in this case, the `-A`-less version caught a typo in the Nix package. I've submitted a PR to fix it in Nixpkgs, but ideally the `nix-env` invocation would be switched to something like the command I mentioned above.

I will try to write some docs for Sage development with nixpkgs as part of the Sage 9.6 release.



---

archive/issue_comments_652912.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|\n|[e288628](https://github.com/sagemath/sagetrac-mirror/commit/e28862883054256363cae86d6c4dfaad0fb844ca)|`build/bin/sage-print-system-package-command (nix): Use nix-env --install --attr`|",
    "created_at": "2022-02-15T20:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652912",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
|[e288628](https://github.com/sagemath/sagetrac-mirror/commit/e28862883054256363cae86d6c4dfaad0fb844ca)|`build/bin/sage-print-system-package-command (nix): Use nix-env --install --attr`|



---

archive/issue_comments_652913.json:
```json
{
    "body": "Changing commit from \"90f7ced00b74cca051c167c271a9a49155ad0710\" to \"e28862883054256363cae86d6c4dfaad0fb844ca\"",
    "created_at": "2022-02-15T20:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "90f7ced00b74cca051c167c271a9a49155ad0710" to "e28862883054256363cae86d6c4dfaad0fb844ca"



---

archive/issue_comments_652914.json:
```json
{
    "body": "<a id='comment:11'></a>\nNot sure what the `-f '<nixpkgs>'` is - is there something I need to add?",
    "created_at": "2022-02-15T20:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652914",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Not sure what the `-f '<nixpkgs>'` is - is there something I need to add?



---

archive/issue_comments_652915.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [gh-collares](#comment%3A9):\n> The `-A` flag specifies a saner way of finding the relevant package\n\n\nThanks, this helped!",
    "created_at": "2022-02-15T20:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652915",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Replying to [gh-collares](#comment%3A9):
> The `-A` flag specifies a saner way of finding the relevant package


Thanks, this helped!



---

archive/issue_comments_652916.json:
```json
{
    "body": "<a id='comment:13'></a>\n`configure` now gives the following advice:\n\n```\nchecking for the package system in use... nix\nconfigure:\n\n    hint: installing the following system packages, if not\n    already present, is recommended and may avoid having to\n    build them (though some may have to be built anyway):\n\n      $ nix-env --install --attr ecl eclib fflas-ffpack giac givaro gsl iml lcalc libhomfly blas lapack palp pari R\n\nconfigure:\n\n    hint: installing the following system packages, if not\n    already present, may provide additional optional features:\n\n      $ nix-env --install --attr ffmpeg graphviz imagemagick texinfo graphviz libxml2 lrs pdf2svg polymake\n\n```",
    "created_at": "2022-02-15T21:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652916",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
`configure` now gives the following advice:

```
checking for the package system in use... nix
configure:

    hint: installing the following system packages, if not
    already present, is recommended and may avoid having to
    build them (though some may have to be built anyway):

      $ nix-env --install --attr ecl eclib fflas-ffpack giac givaro gsl iml lcalc libhomfly blas lapack palp pari R

configure:

    hint: installing the following system packages, if not
    already present, may provide additional optional features:

      $ nix-env --install --attr ffmpeg graphviz imagemagick texinfo graphviz libxml2 lrs pdf2svg polymake

```



---

archive/issue_comments_652917.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis is perfect, many thanks! I don't know why I needed the `-f <nixpkgs>` here, perhaps because I am on NixOS? It's best to leave it out if it works outside NixOS.",
    "created_at": "2022-02-15T21:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652917",
    "user": "https://github.com/collares"
}
```

<a id='comment:14'></a>
This is perfect, many thanks! I don't know why I needed the `-f <nixpkgs>` here, perhaps because I am on NixOS? It's best to leave it out if it works outside NixOS.



---

archive/issue_comments_652918.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|\n|[3d96dc5](https://github.com/sagemath/sagetrac-mirror/commit/3d96dc560bd838feda56b26ccc48bf90cd641fd2)|`build/bin/sage-print-system-package-command, build/bin/write-dockerfile.sh: Use nix-env -f '<nixpkgs>' --install --attr`|",
    "created_at": "2022-02-15T21:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652918",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
|[3d96dc5](https://github.com/sagemath/sagetrac-mirror/commit/3d96dc560bd838feda56b26ccc48bf90cd641fd2)|`build/bin/sage-print-system-package-command, build/bin/write-dockerfile.sh: Use nix-env -f '<nixpkgs>' --install --attr`|



---

archive/issue_comments_652919.json:
```json
{
    "body": "Changing commit from \"e28862883054256363cae86d6c4dfaad0fb844ca\" to \"3d96dc560bd838feda56b26ccc48bf90cd641fd2\"",
    "created_at": "2022-02-15T21:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652919",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e28862883054256363cae86d6c4dfaad0fb844ca" to "3d96dc560bd838feda56b26ccc48bf90cd641fd2"



---

archive/issue_comments_652920.json:
```json
{
    "body": "<a id='comment:16'></a>\nOK, looks like I do need this switch",
    "created_at": "2022-02-15T21:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652920",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
OK, looks like I do need this switch



---

archive/issue_comments_652921.json:
```json
{
    "body": "Changing commit from \"3d96dc560bd838feda56b26ccc48bf90cd641fd2\" to \"b07fece963b3a656f1a1be10635f8c24416edf04\"",
    "created_at": "2022-02-15T21:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3d96dc560bd838feda56b26ccc48bf90cd641fd2" to "b07fece963b3a656f1a1be10635f8c24416edf04"



---

archive/issue_comments_652922.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[b07fece](https://github.com/sagemath/sagetrac-mirror/commit/b07fece963b3a656f1a1be10635f8c24416edf04)|`build/pkgs/gfortran/distros/nix.txt: New`|",
    "created_at": "2022-02-15T21:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652922",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[b07fece](https://github.com/sagemath/sagetrac-mirror/commit/b07fece963b3a656f1a1be10635f8c24416edf04)|`build/pkgs/gfortran/distros/nix.txt: New`|



---

archive/issue_comments_652923.json:
```json
{
    "body": "<a id='comment:18'></a>\nNow I am getting\n\n```\nbuilding '/nix/store/r2w1z0912rilh4l1yyg9jv3d66bnjk99-user-environment.drv'...\nerror: packages '/nix/store/9iry5bm9cxdbspap6qi835g67kvdninx-boost-1.77.0/lib/libboost_thread.so' and '/nix/store/6x1m911w8378qbxjf9pcli9hijrqx1km-nix-2.6.0/lib/libboost_thread.so' have the same priority 5; use 'nix-env --set-flag priority NUMBER INSTALLED_PKGNAME' to change the priority of one of the conflicting packages (0 being the highest priority)\nerror: builder for '/nix/store/r2w1z0912rilh4l1yyg9jv3d66bnjk99-user-environment.drv' failed with exit code 1\nThe command '/bin/sh -c nix-env -f '<nixpkgs>' --install --attr  gd iml m4ri gfan gfortran singular mpfi cmake symmetrica flintqs freetype cddlib libbraiding brial ppl sympow zn_poly readline R sqlite tachyon giac m4rie blas lapack ntl glpk fflas-ffpack libmpc gsl boost nauty binutils gnumake gnum4 perl python3 gnutar bc gcc bash flint arb pari cliquer libhomfly openssl gengetopt planarity lrcalc palp ecm givaro ecl eclib lcalc libatomic_ops rankwidth qhull gettext autoconf automake libtool pkg-config' returned a non-zero code: 100\n```",
    "created_at": "2022-02-15T21:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652923",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Now I am getting

```
building '/nix/store/r2w1z0912rilh4l1yyg9jv3d66bnjk99-user-environment.drv'...
error: packages '/nix/store/9iry5bm9cxdbspap6qi835g67kvdninx-boost-1.77.0/lib/libboost_thread.so' and '/nix/store/6x1m911w8378qbxjf9pcli9hijrqx1km-nix-2.6.0/lib/libboost_thread.so' have the same priority 5; use 'nix-env --set-flag priority NUMBER INSTALLED_PKGNAME' to change the priority of one of the conflicting packages (0 being the highest priority)
error: builder for '/nix/store/r2w1z0912rilh4l1yyg9jv3d66bnjk99-user-environment.drv' failed with exit code 1
The command '/bin/sh -c nix-env -f '<nixpkgs>' --install --attr  gd iml m4ri gfan gfortran singular mpfi cmake symmetrica flintqs freetype cddlib libbraiding brial ppl sympow zn_poly readline R sqlite tachyon giac m4rie blas lapack ntl glpk fflas-ffpack libmpc gsl boost nauty binutils gnumake gnum4 perl python3 gnutar bc gcc bash flint arb pari cliquer libhomfly openssl gengetopt planarity lrcalc palp ecm givaro ecl eclib lcalc libatomic_ops rankwidth qhull gettext autoconf automake libtool pkg-config' returned a non-zero code: 100
```



---

archive/issue_comments_652924.json:
```json
{
    "body": "<a id='comment:19'></a>\nI've never seen this error and I am not exactly sure how to fix it. Can we just remove Boost's `nix.txt`, as a workaround? Hopefully there are no other conflicts like this.",
    "created_at": "2022-02-15T21:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652924",
    "user": "https://github.com/collares"
}
```

<a id='comment:19'></a>
I've never seen this error and I am not exactly sure how to fix it. Can we just remove Boost's `nix.txt`, as a workaround? Hopefully there are no other conflicts like this.



---

archive/issue_comments_652925.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[9af33a1](https://github.com/sagemath/sagetrac-mirror/commit/9af33a1b8678fc351413a1fa67daceb7b9439161)|`build/pkgs/boost_cropped/distros/nix.txt: Remove`|",
    "created_at": "2022-02-15T21:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652925",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[9af33a1](https://github.com/sagemath/sagetrac-mirror/commit/9af33a1b8678fc351413a1fa67daceb7b9439161)|`build/pkgs/boost_cropped/distros/nix.txt: Remove`|



---

archive/issue_comments_652926.json:
```json
{
    "body": "Changing commit from \"b07fece963b3a656f1a1be10635f8c24416edf04\" to \"9af33a1b8678fc351413a1fa67daceb7b9439161\"",
    "created_at": "2022-02-15T21:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b07fece963b3a656f1a1be10635f8c24416edf04" to "9af33a1b8678fc351413a1fa67daceb7b9439161"



---

archive/issue_comments_652927.json:
```json
{
    "body": "<a id='comment:21'></a>\nThat worked, thanks. Next error:\n\n```\nbuilding '/nix/store/4vmcjc3jqzvzsy1mvydsl6k5glbbvvvm-user-environment.drv'...\nerror: packages '/nix/store/cm5d8zx8jf24f6vjxzdx9by3k6rn5zd2-gfortran-wrapper-9.3.0-man/share/man/man7/fsf-funding.7.gz' and '/nix/store/310zm0mxwmk7ynsk0qjb7hiaf734s8p8-gcc-wrapper-10.3.0-man/share/man/man7/fsf-funding.7.gz' have the same priority 10; use 'nix-env --set-flag priority NUMBER INSTALLED_PKGNAME' to change the priority of one of the conflicting packages (0 being the highest priority)\nerror: builder for '/nix/store/4vmcjc3jqzvzsy1mvydsl6k5glbbvvvm-user-environment.drv' failed with exit code 1\nThe command '/bin/sh -c nix-env -f '<nixpkgs>' --install --attr  gd iml m4ri gfan gfortran singular mpfi cmake symmetrica flintqs freetype cddlib libbraiding brial ppl sympow zn_poly readline R sqlite tachyon giac m4rie blas lapack ntl glpk fflas-ffpack libmpc gsl nauty binutils gnumake gnum4 perl python3 gnutar bc gcc bash flint arb pari cliquer libhomfly openssl gengetopt planarity lrcalc palp ecm givaro ecl eclib lcalc libatomic_ops rankwidth qhull gettext autoconf automake libtool pkg-config' returned a non-zero code: 100\n```",
    "created_at": "2022-02-15T21:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652927",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
That worked, thanks. Next error:

```
building '/nix/store/4vmcjc3jqzvzsy1mvydsl6k5glbbvvvm-user-environment.drv'...
error: packages '/nix/store/cm5d8zx8jf24f6vjxzdx9by3k6rn5zd2-gfortran-wrapper-9.3.0-man/share/man/man7/fsf-funding.7.gz' and '/nix/store/310zm0mxwmk7ynsk0qjb7hiaf734s8p8-gcc-wrapper-10.3.0-man/share/man/man7/fsf-funding.7.gz' have the same priority 10; use 'nix-env --set-flag priority NUMBER INSTALLED_PKGNAME' to change the priority of one of the conflicting packages (0 being the highest priority)
error: builder for '/nix/store/4vmcjc3jqzvzsy1mvydsl6k5glbbvvvm-user-environment.drv' failed with exit code 1
The command '/bin/sh -c nix-env -f '<nixpkgs>' --install --attr  gd iml m4ri gfan gfortran singular mpfi cmake symmetrica flintqs freetype cddlib libbraiding brial ppl sympow zn_poly readline R sqlite tachyon giac m4rie blas lapack ntl glpk fflas-ffpack libmpc gsl nauty binutils gnumake gnum4 perl python3 gnutar bc gcc bash flint arb pari cliquer libhomfly openssl gengetopt planarity lrcalc palp ecm givaro ecl eclib lcalc libatomic_ops rankwidth qhull gettext autoconf automake libtool pkg-config' returned a non-zero code: 100
```



---

archive/issue_comments_652928.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-02-16T02:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652928",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_events_097502.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32753#event-97502"
}
```



---

archive/issue_events_097503.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32753#event-97503"
}
```



---

archive/issue_comments_652929.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-05-04T19:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652929",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_652930.json:
```json
{
    "body": "<a id='comment:24'></a>\nPerhaps good enough for merging?",
    "created_at": "2022-05-04T19:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32753#issuecomment-652930",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Perhaps good enough for merging?



---

archive/issue_events_097504.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32753#event-97504"
}
```



---

archive/issue_events_097505.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32753",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32753#event-97505"
}
```
