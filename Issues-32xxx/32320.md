# Issue 32320: Ideal() with fraction-field elements is a small footgun

archive/issues_032083.json:
```json
{
    "body": "I occasionally find myself trying to solve polynomial systems arising from rational equations:\n\n```\nsage: R.<x,y> = GF(31337)[]\nsage: xx = (x*y+y*x) / (1+23*x^2*y^2)\nsage: yy = (y^2-x^2) / (1+23*x^2*y^2)\nsage: Ideal([xx-1, yy-0]) == 1\nTrue\n```\nOne might conclude at this point that the equation has no solutions.\n\nThis is of course nonsense: `xx` and `yy` are elements of the *fraction field* of `R`, so every ideal is either `(0)` or `(1)`, and what we should have written is `Ideal([f.numerator() for f in (xx-1, yy-0)])`. Realizing that this is what's happening may cost the user precious seconds, minutes, or even hours.\n\nThis patch adds a warning to the `Ideal()` function when the automatically inferred base ring is a field, except when the constructed ideal is an instance of `Ideal_fractional`.\n\nThe warning is only triggered when the base ring is not given explicitly: For example, writing `a*R` or `R.ideal(...)` or even `Ideal(R, ...)` will never print the warning, but `Ideal(1/2)` will.\n\nI couldn't really think of any cases where users would actually *want* to create ideals in fields (outside of basic educational examples), since they're all trivial. Does anyone know situations where this warning would be annoying?\n\n**Keywords:** fields, fraction fields, ideals\n\n**Branch/Commit:** [bc6fdeb65596c5cb5f407210be0b437c638dd429](https://github.com/sagemath/sagetrac-mirror/commit/bc6fdeb65596c5cb5f407210be0b437c638dd429)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Lorenz Panny\n\n**Dependencies:** #32380\n\nIssue created by migration from https://trac.sagemath.org/ticket/32320\n\n",
    "closed_at": "2021-11-18T23:37:55Z",
    "created_at": "2021-08-01T05:37:51Z",
    "labels": [
        "component: algebra",
        "trivial",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Ideal() with fraction-field elements is a small footgun",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32320",
    "user": "https://github.com/yyyyx4"
}
```
I occasionally find myself trying to solve polynomial systems arising from rational equations:

```
sage: R.<x,y> = GF(31337)[]
sage: xx = (x*y+y*x) / (1+23*x^2*y^2)
sage: yy = (y^2-x^2) / (1+23*x^2*y^2)
sage: Ideal([xx-1, yy-0]) == 1
True
```
One might conclude at this point that the equation has no solutions.

This is of course nonsense: `xx` and `yy` are elements of the *fraction field* of `R`, so every ideal is either `(0)` or `(1)`, and what we should have written is `Ideal([f.numerator() for f in (xx-1, yy-0)])`. Realizing that this is what's happening may cost the user precious seconds, minutes, or even hours.

This patch adds a warning to the `Ideal()` function when the automatically inferred base ring is a field, except when the constructed ideal is an instance of `Ideal_fractional`.

The warning is only triggered when the base ring is not given explicitly: For example, writing `a*R` or `R.ideal(...)` or even `Ideal(R, ...)` will never print the warning, but `Ideal(1/2)` will.

I couldn't really think of any cases where users would actually *want* to create ideals in fields (outside of basic educational examples), since they're all trivial. Does anyone know situations where this warning would be annoying?

**Keywords:** fields, fraction fields, ideals

**Branch/Commit:** [bc6fdeb65596c5cb5f407210be0b437c638dd429](https://github.com/sagemath/sagetrac-mirror/commit/bc6fdeb65596c5cb5f407210be0b437c638dd429)

**Reviewer:** Travis Scrimshaw

**Author:** Lorenz Panny

**Dependencies:** #32380

Issue created by migration from https://trac.sagemath.org/ticket/32320





---

archive/issue_comments_614124.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-08-01T05:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614124",
    "user": "https://github.com/yyyyx4"
}
```

**Changing status** from new to needs_review.



---

archive/issue_events_096752.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-10T17:30:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32320#event-96752"
}
```



---

archive/issue_comments_614125.json:
```json
{
    "body": "<a id='comment:3'></a>\nActually, do we even need the second check? It isn't used in this function.",
    "created_at": "2021-08-15T00:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614125",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Actually, do we even need the second check? It isn't used in this function.



---

archive/issue_comments_614126.json:
```json
{
    "body": "<a id='comment:4'></a>\nYou mean the `fractional_ideal` check? The point was to not print the warning in situations where `.ideal()` has been redefined to do fractional ideals (see for instance ticket:7596#comment:13). It's quite a hack.",
    "created_at": "2021-08-15T06:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614126",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:4'></a>
You mean the `fractional_ideal` check? The point was to not print the warning in situations where `.ideal()` has been redefined to do fractional ideals (see for instance ticket:7596#comment:13). It's quite a hack.



---

archive/issue_comments_614127.json:
```json
{
    "body": "<a id='comment:5'></a>\nThen shouldn't we also check that ideal is fractional_ideal? Otherwise these could be independent (perhaps because of a bug).",
    "created_at": "2021-08-15T08:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614127",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
Then shouldn't we also check that ideal is fractional_ideal? Otherwise these could be independent (perhaps because of a bug).



---

archive/issue_comments_614128.json:
```json
{
    "body": "**Changing commit** from \"[d677a53ea96a20dc332c00d1469b3ebf39521892](https://github.com/sagemath/sagetrac-mirror/commit/d677a53ea96a20dc332c00d1469b3ebf39521892)\" to \"[5f69b30a313e9be643d1d6c935d54a4440584b8b](https://github.com/sagemath/sagetrac-mirror/commit/5f69b30a313e9be643d1d6c935d54a4440584b8b)\".",
    "created_at": "2021-08-15T09:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d677a53ea96a20dc332c00d1469b3ebf39521892](https://github.com/sagemath/sagetrac-mirror/commit/d677a53ea96a20dc332c00d1469b3ebf39521892)" to "[5f69b30a313e9be643d1d6c935d54a4440584b8b](https://github.com/sagemath/sagetrac-mirror/commit/5f69b30a313e9be643d1d6c935d54a4440584b8b)".



---

archive/issue_comments_614129.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f69b30a313e9be643d1d6c935d54a4440584b8b\">5f69b30</a></td><td><code>do not warn when the constructed ideal is a fractional ideal</code></td></tr></table>\n",
    "created_at": "2021-08-15T09:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f69b30a313e9be643d1d6c935d54a4440584b8b">5f69b30</a></td><td><code>do not warn when the constructed ideal is a fractional ideal</code></td></tr></table>




---

archive/issue_comments_614130.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b\">fb94cd6</a></td><td><code>only import the warnings module when needed</code></td></tr></table>\n",
    "created_at": "2021-08-15T09:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b">fb94cd6</a></td><td><code>only import the warnings module when needed</code></td></tr></table>




---

archive/issue_comments_614131.json:
```json
{
    "body": "**Changing commit** from \"[5f69b30a313e9be643d1d6c935d54a4440584b8b](https://github.com/sagemath/sagetrac-mirror/commit/5f69b30a313e9be643d1d6c935d54a4440584b8b)\" to \"[fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b](https://github.com/sagemath/sagetrac-mirror/commit/fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b)\".",
    "created_at": "2021-08-15T09:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5f69b30a313e9be643d1d6c935d54a4440584b8b](https://github.com/sagemath/sagetrac-mirror/commit/5f69b30a313e9be643d1d6c935d54a4440584b8b)" to "[fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b](https://github.com/sagemath/sagetrac-mirror/commit/fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b)".



---

archive/issue_comments_614132.json:
```json
{
    "body": "**Changing commit** from \"[fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b](https://github.com/sagemath/sagetrac-mirror/commit/fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b)\" to \"[bc6fdeb65596c5cb5f407210be0b437c638dd429](https://github.com/sagemath/sagetrac-mirror/commit/bc6fdeb65596c5cb5f407210be0b437c638dd429)\".",
    "created_at": "2021-08-15T09:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614132",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b](https://github.com/sagemath/sagetrac-mirror/commit/fb94cd6635a3f2a3dcd50eaebf9403bb561ec79b)" to "[bc6fdeb65596c5cb5f407210be0b437c638dd429](https://github.com/sagemath/sagetrac-mirror/commit/bc6fdeb65596c5cb5f407210be0b437c638dd429)".



---

archive/issue_comments_614133.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc6fdeb65596c5cb5f407210be0b437c638dd429\">bc6fdeb</a></td><td><code>oops, fix trac number in comment</code></td></tr></table>\n",
    "created_at": "2021-08-15T09:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc6fdeb65596c5cb5f407210be0b437c638dd429">bc6fdeb</a></td><td><code>oops, fix trac number in comment</code></td></tr></table>




---

archive/issue_comments_614134.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [tscrim](#comment%3A5):\n> Then shouldn't we also check that ideal is fractional_ideal?\n\n\nGood point, this is a much better way of doing it. It's totally broken without #32380 though.",
    "created_at": "2021-08-15T09:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614134",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:9'></a>
Replying to [tscrim](#comment%3A5):
> Then shouldn't we also check that ideal is fractional_ideal?


Good point, this is a much better way of doing it. It's totally broken without #32380 though.



---

archive/issue_comments_614135.json:
```json
{
    "body": "**Dependencies:** #32380",
    "created_at": "2021-08-15T09:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614135",
    "user": "https://github.com/yyyyx4"
}
```

**Dependencies:** #32380



---

archive/issue_comments_614136.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,7 +11,7 @@\n \n This is of course nonsense: `xx` and `yy` are elements of the *fraction field* of `R`, so every ideal is either `(0)` or `(1)`, and what we should have written is `Ideal([f.numerator() for f in (xx-1, yy-0)])`. Realizing that this is what's happening may cost the user precious seconds, minutes, or even hours.\n \n-This patch adds a warning to the `Ideal()` function when the automatically inferred base ring is a field, with the exception of fields that have a `fractional_ideal` method. The latter exception in particular applies to number fields, where the `.ideal()` method is redefined to construct a fractional ideal instead, hence there is a bigger chance that the user actually meant to use `Ideal()` with field elements.\n+This patch adds a warning to the `Ideal()` function when the automatically inferred base ring is a field, except when the constructed ideal is an instance of `Ideal_fractional`.\n \n The warning is only triggered when the base ring is not given explicitly: For example, writing `a*R` or `R.ideal(...)` or even `Ideal(R, ...)` will never print the warning, but `Ideal(1/2)` will.\n \n``````\n",
    "created_at": "2021-08-15T09:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614136",
    "user": "https://github.com/yyyyx4"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,7 +11,7 @@
 
 This is of course nonsense: `xx` and `yy` are elements of the *fraction field* of `R`, so every ideal is either `(0)` or `(1)`, and what we should have written is `Ideal([f.numerator() for f in (xx-1, yy-0)])`. Realizing that this is what's happening may cost the user precious seconds, minutes, or even hours.
 
-This patch adds a warning to the `Ideal()` function when the automatically inferred base ring is a field, with the exception of fields that have a `fractional_ideal` method. The latter exception in particular applies to number fields, where the `.ideal()` method is redefined to construct a fractional ideal instead, hence there is a bigger chance that the user actually meant to use `Ideal()` with field elements.
+This patch adds a warning to the `Ideal()` function when the automatically inferred base ring is a field, except when the constructed ideal is an instance of `Ideal_fractional`.
 
 The warning is only triggered when the base ring is not given explicitly: For example, writing `a*R` or `R.ideal(...)` or even `Ideal(R, ...)` will never print the warning, but `Ideal(1/2)` will.
 
``````




---

archive/issue_comments_614137.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-08-16T00:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614137",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_614138.json:
```json
{
    "body": "<a id='comment:11'></a>\nThank you. LGTM.",
    "created_at": "2021-08-16T00:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614138",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Thank you. LGTM.



---

archive/issue_comments_614139.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2021-08-16T00:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614139",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_614140.json:
```json
{
    "body": "**Changing branch** from \"[public/warn_when_creating_ideals_in_inferred_fields](https://github.com/sagemath/sagetrac-mirror/tree/public/warn_when_creating_ideals_in_inferred_fields)\" to \"[bc6fdeb65596c5cb5f407210be0b437c638dd429](https://github.com/sagemath/sagetrac-mirror/commit/bc6fdeb65596c5cb5f407210be0b437c638dd429)\".",
    "created_at": "2021-11-18T23:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32320#issuecomment-614140",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/warn_when_creating_ideals_in_inferred_fields](https://github.com/sagemath/sagetrac-mirror/tree/public/warn_when_creating_ideals_in_inferred_fields)" to "[bc6fdeb65596c5cb5f407210be0b437c638dd429](https://github.com/sagemath/sagetrac-mirror/commit/bc6fdeb65596c5cb5f407210be0b437c638dd429)".



---

archive/issue_events_096753.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-18T23:37:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32320",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32320#event-96753"
}
```
