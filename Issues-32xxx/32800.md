# Issue 32800: Meta-ticket: Remove use of SAGE_LIB and SAGE_EXTCODE variables

archive/issues_032800.json:
```json
{
    "body": "CC:  @tornaria\n\nPortions of namespace packages can be installed in separate locations. \n\nHence, the variable `sage.env.SAGE_LIB` is no longer meaningful.\n\nInstead, we should make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.\n\n- Use of `SAGE_LIB` in `src/sage/misc/lazy_import_cache.py` can possibly be removed after #33308\n\n- #33407 `sage -t --all-installed`\n- #33821 Remove use of `SAGE_LIB` in `sage.misc`\n- #33137 `sage.env.sage_include_directories`: Don't use `distutils` and `SAGE_LIB`\n\n`SAGE_EXTCODE` should be replaced by using `importlib.resources` (more precisely, the backport package `importlib-resources`). Version 5.9.0 can do `as_file` with directories (https://importlib-resources.readthedocs.io/en/latest/history.html#v5-9-0)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33037\n\n",
    "created_at": "2021-12-17T07:18:57Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Remove use of SAGE_LIB and SAGE_EXTCODE variables",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32800",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tornaria

Portions of namespace packages can be installed in separate locations. 

Hence, the variable `sage.env.SAGE_LIB` is no longer meaningful.

Instead, we should make use of the `__path__` attribute of packages, https://python.readthedocs.io/en/stable/reference/import.html#module-path, which in the case of namespace packages is an iterable.

- Use of `SAGE_LIB` in `src/sage/misc/lazy_import_cache.py` can possibly be removed after #33308

- #33407 `sage -t --all-installed`
- #33821 Remove use of `SAGE_LIB` in `sage.misc`
- #33137 `sage.env.sage_include_directories`: Don't use `distutils` and `SAGE_LIB`

`SAGE_EXTCODE` should be replaced by using `importlib.resources` (more precisely, the backport package `importlib-resources`). Version 5.9.0 can do `as_file` with directories (https://importlib-resources.readthedocs.io/en/latest/history.html#v5-9-0)


Issue created by migration from https://trac.sagemath.org/ticket/33037





---

archive/issue_comments_467167.json:
```json
{
    "body": "This could have some interesting consequences. At the moment `SAGE_SRC` default to `SAGE_LIB` if `SAGE_ROOT` is undefined. The most interesting thing about this behavior is that you can run the test suite on an installed version of sage without having the source. There may be other interesting things about using cython from inside sage witht the sage install rather than the source.\n\nSo those things may have to be thought about while removing that variable.",
    "created_at": "2021-12-17T09:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32800#issuecomment-467167",
    "user": "https://github.com/kiwifb"
}
```

This could have some interesting consequences. At the moment `SAGE_SRC` default to `SAGE_LIB` if `SAGE_ROOT` is undefined. The most interesting thing about this behavior is that you can run the test suite on an installed version of sage without having the source. There may be other interesting things about using cython from inside sage witht the sage install rather than the source.

So those things may have to be thought about while removing that variable.



---

archive/issue_comments_467168.json:
```json
{
    "body": "It should also depend on the work on extcode, from `env.py`\n\n```\nSAGE_EXTCODE = var(\"SAGE_EXTCODE\", join(SAGE_LIB, \"sage\", \"ext_data\"))\n```",
    "created_at": "2021-12-17T09:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32800#issuecomment-467168",
    "user": "https://github.com/kiwifb"
}
```

It should also depend on the work on extcode, from `env.py`

```
SAGE_EXTCODE = var("SAGE_EXTCODE", join(SAGE_LIB, "sage", "ext_data"))
```



---

archive/issue_comments_467169.json:
```json
{
    "body": "Replying to [comment:3 fbissey]:\n> It should also depend on the work on extcode, from `env.py`\n> \n> ```\n> SAGE_EXTCODE = var(\"SAGE_EXTCODE\", join(SAGE_LIB, \"sage\", \"ext_data\"))\n> ```\n\nYes, I've added #31306 as a dependency.",
    "created_at": "2021-12-17T16:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32800#issuecomment-467169",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:3 fbissey]:
> It should also depend on the work on extcode, from `env.py`
> 
> ```
> SAGE_EXTCODE = var("SAGE_EXTCODE", join(SAGE_LIB, "sage", "ext_data"))
> ```

Yes, I've added #31306 as a dependency.



---

archive/issue_events_087295.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32800",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32800#event-87295"
}
```



---

archive/issue_events_087296.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32800",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32800#event-87296"
}
```



---

archive/issue_events_087297.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32800",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32800#event-87297"
}
```
