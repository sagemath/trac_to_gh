# Issue 32352: Efficient algorithm to compute products in the C' basis of an Iwahori-Hecke algebra

archive/issues_032115.json:
```json
{
    "body": "> **(Update after review completed)** The `Cp_Coxeter3` class mentioned below was eventually merged into the `Cp` class, and the `Cp_Coxeter3.product_on_basis` method is moved into the latter. \n\n\nThis ticket introduces, in the class `IwahoriHeckeAlgebra.Cp_Coxeter3`, an alternative implementation of the Kazhdan--Lusztig C'-basis in an Iwahori--Hecke algebra. This new implementation is to be contrasted with the existing implementation of the same C'-basis via the class `IwahoriHeckeAlgebra.Cp`. The latter class computes products in the C'-basis indirectly by converting elements to the T-basis, performing multiplication there, and converting back, while the main feature of our new class is the direct computation of products in the C'-basis. By delegating some computations to the optional package coxeter3, the new class is able to compute products in the C'-basis more quickly, including some products that take prohibitively long in the existing `Cp` class. For example, the following calculation takes 5 seconds in `Cp` but is instant in `Cp_Coxeter3`:\n\n```python\nsage: R.<v> = LaurentPolynomialRing(ZZ)                     # optional - coxeter3\nsage: W = CoxeterGroup('H4', implementation='coxeter3')     # optional - coxeter3\nsage: H = IwahoriHeckeAlgebra(W, v**2)                      # optional - coxeter3\nsage: Cp = H.Cp(); CpC = H.Cp_Coxeter3()                    # optional - coxeter3\nsage: Cp[3,4,3]*Cp[3,4,3,4]*Cp[1,2,3,4]                     # long time (5 seconds) # optional - coxeter3\n(v^-2+2+v^2)*Cp[4,3,4,3,4,1,2,3,4]\n+ (v^-2+2+v^2)*Cp[4,3,4,3,4,1,2]\n+ (v^-1+v)*Cp[3,4,1,2,3,4]\n+ (v^-3+3*v^-1+3*v+v^3)*Cp[4,3,4,3,4,1]\n+ (v^-1+v)*Cp[3,4,1,2]\nsage: CpC[3,4,3]*CpC[3,4,3,4]*CpC[1,2,3,4]                  # optional - coxeter3\n(v^-2+2+v^2)*CpC[4,3,4,3,4,1,2,3,4]\n+ (v^-2+2+v^2)*CpC[4,3,4,3,4,1,2]\n+ (v^-1+v)*CpC[3,4,1,2,3,4]\n+ (v^-3+3*v^-1+3*v+v^3)*CpC[4,3,4,3,4,1]\n+ (v^-1+v)*CpC[3,4,1,2]\n```\n\nThe following computation also seems infeasible in the existing `Cp` basis (it did not terminate in any reasonable time), but it is again instant in `Cp_Coxeter3`:\n\n```python\nsage: W = CoxeterGroup('A9', implementation='coxeter3')     # optional - coxeter3\nsage: H = IwahoriHeckeAlgebra(W, v**2)                      # optional - coxeter3\nsage: CpC = H.Cp_Coxeter3()                                 # optional - coxeter3\nsage: CpC[1,2,1,8,9,8]*CpC[1,2,3,7,8,9]                     # optional - coxeter3\n(v^-2+2+v^2)*CpC[1,2,1,3,7,8,7,9,8,7]\n+ (v^-2+2+v^2)*CpC[1,2,1,3,8,9,8,7]\n+ (v^-3+3*v^-1+3*v+v^3)*CpC[1,2,1,3,8,9,8]\n```\n \nThe main function for the class `IwahoriHeckeAlgebra.Cp_Coxeter3` is `IwahoriHeckeAlgebra.Cp_Coxeter3.product_on_basis`. Explanations of the relevant algorithms and detailed examples (including more previously infeasible computations) are given in the documentation for this function and the class. We also handle conversions between the C'-basis (implemented in `Cp_Coxeter3`) and other bases of the Iwahori--Hecke algebra, by building on existing conversions involving the `Cp` implementation of the same C'-basis in a trivial way.\n\nThe product computations introduced in this ticket can potentially be used to calculate the left, right, or two-sided Kazhdan-Lusztig cell containing arbitrary Coxeter group elements, which can in turn be used to determine all cells in any finite Coxeter group. We have included functions in `sage/categories/coxeter_groups.py` that can calculate the cells containing an element or compute all cells within a finite Coxeter group. Some example computations are given below.\n\n\n```python\nsage: W = CoxeterGroup('B3', implementation='coxeter3')     # optional - coxeter3\nsage: s1,s2,s3 = W.simple_reflections()                     # optional - coxeter3\nsage: W.kazhdan_lusztig_cell(s1*s2*s1)                      # optional - coxeter3\n{[2, 1, 2], [2, 3, 2, 1, 2], [3, 2, 1, 2]}\nsage: W.kazhdan_lusztig_cell(s3, side='right')              # optional - coxeter3\n{[3], [3, 2], [3, 2, 1], [3, 2, 3]}\nsage: W.kazhdan_lusztig_cell(s3, side='two-sided')          # optional - coxeter3\n{[1], [1, 2], [1, 2, 3], [1, 2, 3, 2], [1, 2, 3, 2, 1], [2], [2, 1],\n [2, 3], [2, 3, 2], [2, 3, 2, 1], [3], [3, 2], [3, 2, 1], [3, 2, 3]}\n```\n\nCC:  @tscrim @AndrewAtLarge\n\nKeywords: Coxeter systems,Coxeter groups,Iwahori-Hecke algebra,Kazhdan-Lusztig cells,Kazhdan-Lusztig basis\n\nReviewer: Travis Scrimshaw\n\nAuthor: Chase Meadors, Tianyuan Xu\n\nBranch: 901699badeb305cdfbbfd52cc8427a3ea53512b8\n\nDependencies: #32266\n\nCommit: 901699badeb305cdfbbfd52cc8427a3ea53512b8\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32352\n\n",
    "closed_at": "2021-10-19T20:30:43Z",
    "created_at": "2021-08-09T22:37:49Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Efficient algorithm to compute products in the C' basis of an Iwahori-Hecke algebra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32352",
    "user": "https://github.com/cemulate"
}
```
> **(Update after review completed)** The `Cp_Coxeter3` class mentioned below was eventually merged into the `Cp` class, and the `Cp_Coxeter3.product_on_basis` method is moved into the latter. 


This ticket introduces, in the class `IwahoriHeckeAlgebra.Cp_Coxeter3`, an alternative implementation of the Kazhdan--Lusztig C'-basis in an Iwahori--Hecke algebra. This new implementation is to be contrasted with the existing implementation of the same C'-basis via the class `IwahoriHeckeAlgebra.Cp`. The latter class computes products in the C'-basis indirectly by converting elements to the T-basis, performing multiplication there, and converting back, while the main feature of our new class is the direct computation of products in the C'-basis. By delegating some computations to the optional package coxeter3, the new class is able to compute products in the C'-basis more quickly, including some products that take prohibitively long in the existing `Cp` class. For example, the following calculation takes 5 seconds in `Cp` but is instant in `Cp_Coxeter3`:

```python
sage: R.<v> = LaurentPolynomialRing(ZZ)                     # optional - coxeter3
sage: W = CoxeterGroup('H4', implementation='coxeter3')     # optional - coxeter3
sage: H = IwahoriHeckeAlgebra(W, v**2)                      # optional - coxeter3
sage: Cp = H.Cp(); CpC = H.Cp_Coxeter3()                    # optional - coxeter3
sage: Cp[3,4,3]*Cp[3,4,3,4]*Cp[1,2,3,4]                     # long time (5 seconds) # optional - coxeter3
(v^-2+2+v^2)*Cp[4,3,4,3,4,1,2,3,4]
+ (v^-2+2+v^2)*Cp[4,3,4,3,4,1,2]
+ (v^-1+v)*Cp[3,4,1,2,3,4]
+ (v^-3+3*v^-1+3*v+v^3)*Cp[4,3,4,3,4,1]
+ (v^-1+v)*Cp[3,4,1,2]
sage: CpC[3,4,3]*CpC[3,4,3,4]*CpC[1,2,3,4]                  # optional - coxeter3
(v^-2+2+v^2)*CpC[4,3,4,3,4,1,2,3,4]
+ (v^-2+2+v^2)*CpC[4,3,4,3,4,1,2]
+ (v^-1+v)*CpC[3,4,1,2,3,4]
+ (v^-3+3*v^-1+3*v+v^3)*CpC[4,3,4,3,4,1]
+ (v^-1+v)*CpC[3,4,1,2]
```

The following computation also seems infeasible in the existing `Cp` basis (it did not terminate in any reasonable time), but it is again instant in `Cp_Coxeter3`:

```python
sage: W = CoxeterGroup('A9', implementation='coxeter3')     # optional - coxeter3
sage: H = IwahoriHeckeAlgebra(W, v**2)                      # optional - coxeter3
sage: CpC = H.Cp_Coxeter3()                                 # optional - coxeter3
sage: CpC[1,2,1,8,9,8]*CpC[1,2,3,7,8,9]                     # optional - coxeter3
(v^-2+2+v^2)*CpC[1,2,1,3,7,8,7,9,8,7]
+ (v^-2+2+v^2)*CpC[1,2,1,3,8,9,8,7]
+ (v^-3+3*v^-1+3*v+v^3)*CpC[1,2,1,3,8,9,8]
```
 
The main function for the class `IwahoriHeckeAlgebra.Cp_Coxeter3` is `IwahoriHeckeAlgebra.Cp_Coxeter3.product_on_basis`. Explanations of the relevant algorithms and detailed examples (including more previously infeasible computations) are given in the documentation for this function and the class. We also handle conversions between the C'-basis (implemented in `Cp_Coxeter3`) and other bases of the Iwahori--Hecke algebra, by building on existing conversions involving the `Cp` implementation of the same C'-basis in a trivial way.

The product computations introduced in this ticket can potentially be used to calculate the left, right, or two-sided Kazhdan-Lusztig cell containing arbitrary Coxeter group elements, which can in turn be used to determine all cells in any finite Coxeter group. We have included functions in `sage/categories/coxeter_groups.py` that can calculate the cells containing an element or compute all cells within a finite Coxeter group. Some example computations are given below.


```python
sage: W = CoxeterGroup('B3', implementation='coxeter3')     # optional - coxeter3
sage: s1,s2,s3 = W.simple_reflections()                     # optional - coxeter3
sage: W.kazhdan_lusztig_cell(s1*s2*s1)                      # optional - coxeter3
{[2, 1, 2], [2, 3, 2, 1, 2], [3, 2, 1, 2]}
sage: W.kazhdan_lusztig_cell(s3, side='right')              # optional - coxeter3
{[3], [3, 2], [3, 2, 1], [3, 2, 3]}
sage: W.kazhdan_lusztig_cell(s3, side='two-sided')          # optional - coxeter3
{[1], [1, 2], [1, 2, 3], [1, 2, 3, 2], [1, 2, 3, 2, 1], [2], [2, 1],
 [2, 3], [2, 3, 2], [2, 3, 2, 1], [3], [3, 2], [3, 2, 1], [3, 2, 3]}
```

CC:  @tscrim @AndrewAtLarge

Keywords: Coxeter systems,Coxeter groups,Iwahori-Hecke algebra,Kazhdan-Lusztig cells,Kazhdan-Lusztig basis

Reviewer: Travis Scrimshaw

Author: Chase Meadors, Tianyuan Xu

Branch: 901699badeb305cdfbbfd52cc8427a3ea53512b8

Dependencies: #32266

Commit: 901699badeb305cdfbbfd52cc8427a3ea53512b8

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32352





---

archive/issue_comments_458052.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-08-09T22:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458052",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_458053.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-10T01:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458053",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458054.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-10T01:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_085836.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-11T22:19:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32352#event-85836"
}
```



---

archive/issue_comments_458055.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-11T23:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458055",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458056.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T00:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458056",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458057.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-12T17:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458057",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458058.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-12T17:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458058",
    "user": "https://github.com/cemulate"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_458059.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-08-14T23:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458059",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_458060.json:
```json
{
    "body": "<a id='comment:26'></a>I made some changes to improve the speed by creating fewer transient objects and using more efficient code paths. I also tweaked the doctests so that everything is tested on systems without coxeter3 and all tests pass both with and without coxeter3. I also tweaked the documentation accordingly and hid the internal computational methods. If my changes are good, then positive review.",
    "created_at": "2021-08-16T01:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458060",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>I made some changes to improve the speed by creating fewer transient objects and using more efficient code paths. I also tweaked the doctests so that everything is tested on systems without coxeter3 and all tests pass both with and without coxeter3. I also tweaked the documentation accordingly and hid the internal computational methods. If my changes are good, then positive review.



---

archive/issue_comments_458061.json:
```json
{
    "body": "<a id='comment:27'></a>Last 10 new commits:",
    "created_at": "2021-08-16T01:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458061",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>Last 10 new commits:



---

archive/issue_comments_458062.json:
```json
{
    "body": "<a id='comment:28'></a>Everything looks good! Thanks!\n\nWe've set the ticket to positive review.",
    "created_at": "2021-08-16T06:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458062",
    "user": "https://github.com/cemulate"
}
```

<a id='comment:28'></a>Everything looks good! Thanks!

We've set the ticket to positive review.



---

archive/issue_comments_458063.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-16T06:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458063",
    "user": "https://github.com/cemulate"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_458064.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-08-16T23:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458064",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_458065.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-08-16T23:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458065",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_458066.json:
```json
{
    "body": "<a id='comment:33'></a>(After `make` finished I discovered a couple docstring errors)",
    "created_at": "2021-08-16T23:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458066",
    "user": "https://github.com/cemulate"
}
```

<a id='comment:33'></a>(After `make` finished I discovered a couple docstring errors)



---

archive/issue_comments_458067.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-16T23:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458067",
    "user": "https://github.com/cemulate"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_085837.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-19T20:30:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32352#event-85837"
}
```



---

archive/issue_comments_458068.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32352#issuecomment-458068",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
