# Issue 32918: configure: Also check installation records in SAGE_VENV/var/lib/sage/installed

archive/issues_032681.json:
```json
{
    "body": "For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.\n\nWe fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.\nWith this ticket, `./bootstrap && make pynormaliz && ./config.status --recheck` should show \n\n```\npynormaliz-2.14:                             optional, will be installed as an SPKG\n```\n\n\n\nCC:  @orlitzky @jhpalmieri @dimpase\n\nBranch/Commit: 9eca9ae7dd39cf5a104a5005dfe406ac958f842d\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32918\n\n",
    "closed_at": "2021-12-12T15:09:14Z",
    "created_at": "2021-11-21T05:54:10Z",
    "labels": [
        "component: build: configure",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "configure: Also check installation records in SAGE_VENV/var/lib/sage/installed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32918",
    "user": "https://github.com/mkoeppe"
}
```
For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.

We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.
With this ticket, `./bootstrap && make pynormaliz && ./config.status --recheck` should show 

```
pynormaliz-2.14:                             optional, will be installed as an SPKG
```



CC:  @orlitzky @jhpalmieri @dimpase

Branch/Commit: 9eca9ae7dd39cf5a104a5005dfe406ac958f842d

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32918





---

archive/issue_comments_656415.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/configure__also_check_installation_records_in_sage_venv_var_lib_sage_installed\"",
    "created_at": "2021-11-21T06:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656415",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/configure__also_check_installation_records_in_sage_venv_var_lib_sage_installed"



---

archive/issue_comments_656416.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n+... to fix the regression that new versions of optional Python packages are no longer automatically installed.\n+\n+Tricky: SAGE_VENV is only resolved when `python3/spkg-configure.m4` runs\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-11-23T06:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656416",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
+... to fix the regression that new versions of optional Python packages are no longer automatically installed.
+
+Tricky: SAGE_VENV is only resolved when `python3/spkg-configure.m4` runs
 
 
 Comment: 1
``````




---

archive/issue_comments_656417.json:
```json
{
    "body": "Changing commit from \"\" to \"dfa672544bb71b34c8e719028764a74167179324\"",
    "created_at": "2021-11-23T06:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656417",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "dfa672544bb71b34c8e719028764a74167179324"



---

archive/issue_comments_656418.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-11-23T06:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656418",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_656419.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.\n+\n+We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.\n+\n+Tricky: SAGE_VENV is only resolved when `python3/spkg-configure.m4` runs\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-11-23T07:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656419",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
+For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.
+
+We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.
+
+Tricky: SAGE_VENV is only resolved when `python3/spkg-configure.m4` runs
 
 
 Comment: 1
``````




---

archive/issue_comments_656420.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-11-23T07:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656420",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_656421.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-23T08:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656421",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_656422.json:
```json
{
    "body": "Changing commit from \"dfa672544bb71b34c8e719028764a74167179324\" to \"9eca9ae7dd39cf5a104a5005dfe406ac958f842d\"",
    "created_at": "2021-11-23T08:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dfa672544bb71b34c8e719028764a74167179324" to "9eca9ae7dd39cf5a104a5005dfe406ac958f842d"



---

archive/issue_comments_656423.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n+For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.\n+\n+We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.\n+With this ticket, `make pynormaliz && ./config.status --recheck` should show \n+\n+```\n+pynormaliz-2.14:                             optional, will be installed as an SPKG\n+```\n+\n+(Tricky: SAGE_VENV is only resolved when `python3/spkg-configure.m4` runs)\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-11-23T08:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656423",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,13 @@
+For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.
+
+We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.
+With this ticket, `make pynormaliz && ./config.status --recheck` should show 
+
+```
+pynormaliz-2.14:                             optional, will be installed as an SPKG
+```
+
+(Tricky: SAGE_VENV is only resolved when `python3/spkg-configure.m4` runs)
 
 
 Comment: 1
``````




---

archive/issue_comments_656424.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-23T08:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656424",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_656425.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-11-23T08:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656425",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_656426.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.\n+\n+We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.\n+With this ticket, `make pynormaliz && ./config.status --recheck` should show \n+\n+```\n+pynormaliz-2.14:                             optional, will be installed as an SPKG\n+```\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-11-23T08:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656426",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,12 @@
+For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.
+
+We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.
+With this ticket, `make pynormaliz && ./config.status --recheck` should show 
+
+```
+pynormaliz-2.14:                             optional, will be installed as an SPKG
+```
+
 
 
 Comment: 1
``````




---

archive/issue_comments_656427.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.\n+\n+We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.\n+With this ticket, `./bootstrap && make pynormaliz && ./config.status --recheck` should show \n+\n+```\n+pynormaliz-2.14:                             optional, will be installed as an SPKG\n+```\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-11-23T08:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656427",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,12 @@
+For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.
+
+We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.
+With this ticket, `./bootstrap && make pynormaliz && ./config.status --recheck` should show 
+
+```
+pynormaliz-2.14:                             optional, will be installed as an SPKG
+```
+
 
 
 Comment: 1
``````




---

archive/issue_comments_656428.json:
```json
{
    "body": "<a id='comment:10'></a>Doctest failures are unrelated",
    "created_at": "2021-11-24T04:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656428",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Doctest failures are unrelated



---

archive/issue_comments_656429.json:
```json
{
    "body": "<a id='comment:12'></a>For me, it does\n\n```\n./config.status --recheck | grep pyno\npynormaliz-2.14:                             optional, use \"./configure --enable-pynormaliz\" to install\n```\nbefore, and after merging.",
    "created_at": "2021-12-03T12:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656429",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>For me, it does

```
./config.status --recheck | grep pyno
pynormaliz-2.14:                             optional, use "./configure --enable-pynormaliz" to install
```
before, and after merging.



---

archive/issue_comments_656430.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2021-12-03T17:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656430",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_656431.json:
```json
{
    "body": "<a id='comment:13'></a>but indeed, if I now run `/configure --enable-pynormaliz` then I get\n\n```\npynormaliz-2.14:                             optional, will be installed as an SPKG\n```\nas promised. LGTM",
    "created_at": "2021-12-03T17:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656431",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>but indeed, if I now run `/configure --enable-pynormaliz` then I get

```
pynormaliz-2.14:                             optional, will be installed as an SPKG
```
as promised. LGTM



---

archive/issue_comments_656432.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-03T17:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656432",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_656433.json:
```json
{
    "body": "<a id='comment:14'></a>This ticket was supposed to make it work even if `--enable-pynormaliz` was NOT given but for the case of re-running `configure` after `pynormaliz` has been installed using `make pynormaliz` or `sage -i pynormaliz`.",
    "created_at": "2021-12-03T18:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656433",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>This ticket was supposed to make it work even if `--enable-pynormaliz` was NOT given but for the case of re-running `configure` after `pynormaliz` has been installed using `make pynormaliz` or `sage -i pynormaliz`.



---

archive/issue_comments_656434.json:
```json
{
    "body": "<a id='comment:15'></a>It worked properly for me when I ran `make benzene`.",
    "created_at": "2021-12-04T00:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656434",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>It worked properly for me when I ran `make benzene`.



---

archive/issue_events_086993.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-12T15:09:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32918#event-86993"
}
```



---

archive/issue_comments_656435.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656435",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_656436.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/configure__also_check_installation_records_in_sage_venv_var_lib_sage_installed\" to \"9eca9ae7dd39cf5a104a5005dfe406ac958f842d\"",
    "created_at": "2021-12-12T15:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-656436",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/configure__also_check_installation_records_in_sage_venv_var_lib_sage_installed" to "9eca9ae7dd39cf5a104a5005dfe406ac958f842d"
