# Issue 32918: configure: Also check installation records in SAGE_VENV/var/lib/sage/installed

archive/issues_032681.json:
```json
{
    "body": "For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.\n\nWe fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.\nWith this ticket, `./bootstrap && make pynormaliz && ./config.status --recheck` should show \n\n```\npynormaliz-2.14:                             optional, will be installed as an SPKG\n```\n\n\n\nCC:  @orlitzky @jhpalmieri @dimpase\n\nBranch/Commit: 9eca9ae7dd39cf5a104a5005dfe406ac958f842d\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32918\n\n",
    "closed_at": "2021-12-12T15:09:14Z",
    "created_at": "2021-11-21T05:54:10Z",
    "labels": [
        "component: build: configure",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "configure: Also check installation records in SAGE_VENV/var/lib/sage/installed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32918",
    "user": "https://github.com/mkoeppe"
}
```
For optional Python packages installed using `sage -i SPKG` or `make SPKG` but not enabled using `configure --enable-SPKG`, #29013/#32442 broke automatic rebuilds.

We fix this by checking installation records in `SAGE_VENV/var/lib/sage/installed` for Python packages.
With this ticket, `./bootstrap && make pynormaliz && ./config.status --recheck` should show 

```
pynormaliz-2.14:                             optional, will be installed as an SPKG
```



CC:  @orlitzky @jhpalmieri @dimpase

Branch/Commit: 9eca9ae7dd39cf5a104a5005dfe406ac958f842d

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32918





---

archive/issue_comments_465705.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2021-11-23T06:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465705",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_465706.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-11-23T07:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465706",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_465707.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-23T08:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465708.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-23T08:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465708",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_465709.json:
```json
{
    "body": "<a id='comment:10'></a>Doctest failures are unrelated",
    "created_at": "2021-11-24T04:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465709",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Doctest failures are unrelated



---

archive/issue_comments_465710.json:
```json
{
    "body": "<a id='comment:12'></a>For me, it does\n\n```\n./config.status --recheck | grep pyno\npynormaliz-2.14:                             optional, use \"./configure --enable-pynormaliz\" to install\n```\nbefore, and after merging.",
    "created_at": "2021-12-03T12:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465710",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>For me, it does

```
./config.status --recheck | grep pyno
pynormaliz-2.14:                             optional, use "./configure --enable-pynormaliz" to install
```
before, and after merging.



---

archive/issue_comments_465711.json:
```json
{
    "body": "<a id='comment:13'></a>but indeed, if I now run `/configure --enable-pynormaliz` then I get\n\n```\npynormaliz-2.14:                             optional, will be installed as an SPKG\n```\nas promised. LGTM",
    "created_at": "2021-12-03T17:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465711",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>but indeed, if I now run `/configure --enable-pynormaliz` then I get

```
pynormaliz-2.14:                             optional, will be installed as an SPKG
```
as promised. LGTM



---

archive/issue_comments_465712.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-03T17:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465712",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_465713.json:
```json
{
    "body": "<a id='comment:14'></a>This ticket was supposed to make it work even if `--enable-pynormaliz` was NOT given but for the case of re-running `configure` after `pynormaliz` has been installed using `make pynormaliz` or `sage -i pynormaliz`.",
    "created_at": "2021-12-03T18:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465713",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>This ticket was supposed to make it work even if `--enable-pynormaliz` was NOT given but for the case of re-running `configure` after `pynormaliz` has been installed using `make pynormaliz` or `sage -i pynormaliz`.



---

archive/issue_comments_465714.json:
```json
{
    "body": "<a id='comment:15'></a>It worked properly for me when I ran `make benzene`.",
    "created_at": "2021-12-04T00:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465714",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>It worked properly for me when I ran `make benzene`.



---

archive/issue_events_086993.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-12T15:09:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32918#event-86993"
}
```



---

archive/issue_comments_465715.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32918",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32918#issuecomment-465715",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
