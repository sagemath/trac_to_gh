# Issue 32946: "sage --docbuild DOC html" is broken

archive/issues_032709.json:
```json
{
    "body": "If I do `make doc-clean && make doc` and then for example `sage --docbuild tutorial html`, first it successfully builds the html tutorial, but then it fails because it tries to build the PDF documentation. I also don't know where it is building the PDF docs, because `local/share/docs/sage/latex` does not exist.\n\n```\n% ./sage --docbuild tutorial html  \n[tutorial ] building [html]: targets for 23 source files that are out of date\n[tutorial ] updating environment: [extensions changed ('2')] 23 added, 0 changed, 0 removed\n[tutorial ] Merging environment/index files...\n[tutorial ] ... done (0 todos, 23 index, 17 citations, 0 modules)\n[tutorial ] WARNING: display latex 'V=\\\\QQ^3': latex exited with error\n[tutorial ] [stdout]\n[tutorial ] This is pdfTeX, Version 3.141592653-2.6-1.40.23 (TeX Live 2022/dev) (preloaded format=latex)\n[tutorial ]  restricted \\write18 enabled.\n[tutorial ] entering extended mode\n[tutorial ] (./math.tex\n[tutorial ] LaTeX2e <2021-06-01> patch level 1\n[tutorial ] L3 programming layer <2021-10-18>\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/base/article.cls\n[tutorial ] Document Class: article 2021/02/12 v1.4n Standard LaTeX document class\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/base/size12.clo))\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/base/inputenc.sty)\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amsmath.sty\n[tutorial ] For additional information on amsmath, use the `?' option.\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amstext.sty\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amsgen.sty))\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amsbsy.sty)\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amsopn.sty))\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amscls/amsthm.sty)\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsfonts/amssymb.sty\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsfonts/amsfonts.sty))\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/anyfontsize/anyfontsize.sty)\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/tools/bm.sty)\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/l3backend/l3backend-dvips.def)\n[tutorial ] No file math.aux.\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsfonts/umsa.fd)\n[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsfonts/umsb.fd)\n[tutorial ] ! Undefined control sequence.\n[tutorial ] l.13 \\fontsize{12}{14}\\selectfont $V=\\QQ\n[tutorial ]                                         ^3$\n[tutorial ] [1] (./math.aux) )\n[tutorial ] (see the transcript file for additional information)\n[tutorial ] Output written on math.dvi (1 page, 336 bytes).\n[tutorial ] Transcript written on math.log.\n[tutorial ] WARNING: display latex '\\\\QQ^3': latex exited with error\n[tutorial ] [stdout]\n...\n```\nand then it tries to build math.dvi half a dozen times more, failing each time.\n\nBranch/Commit: ef2b25b2ecfa1fd5850087d9c354c404d617efd0\n\nReviewer: John Palmieri, Eric Gourgoulhon\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32946\n\n",
    "closed_at": "2021-12-12T15:09:23Z",
    "created_at": "2021-11-28T22:03:46Z",
    "labels": [
        "component: documentation",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "\"sage --docbuild DOC html\" is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32946",
    "user": "https://github.com/jhpalmieri"
}
```
If I do `make doc-clean && make doc` and then for example `sage --docbuild tutorial html`, first it successfully builds the html tutorial, but then it fails because it tries to build the PDF documentation. I also don't know where it is building the PDF docs, because `local/share/docs/sage/latex` does not exist.

```
% ./sage --docbuild tutorial html  
[tutorial ] building [html]: targets for 23 source files that are out of date
[tutorial ] updating environment: [extensions changed ('2')] 23 added, 0 changed, 0 removed
[tutorial ] Merging environment/index files...
[tutorial ] ... done (0 todos, 23 index, 17 citations, 0 modules)
[tutorial ] WARNING: display latex 'V=\\QQ^3': latex exited with error
[tutorial ] [stdout]
[tutorial ] This is pdfTeX, Version 3.141592653-2.6-1.40.23 (TeX Live 2022/dev) (preloaded format=latex)
[tutorial ]  restricted \write18 enabled.
[tutorial ] entering extended mode
[tutorial ] (./math.tex
[tutorial ] LaTeX2e <2021-06-01> patch level 1
[tutorial ] L3 programming layer <2021-10-18>
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/base/article.cls
[tutorial ] Document Class: article 2021/02/12 v1.4n Standard LaTeX document class
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/base/size12.clo))
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/base/inputenc.sty)
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amsmath.sty
[tutorial ] For additional information on amsmath, use the `?' option.
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amstext.sty
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amsgen.sty))
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amsbsy.sty)
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsmath/amsopn.sty))
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amscls/amsthm.sty)
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsfonts/amssymb.sty
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsfonts/amsfonts.sty))
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/anyfontsize/anyfontsize.sty)
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/tools/bm.sty)
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/l3backend/l3backend-dvips.def)
[tutorial ] No file math.aux.
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsfonts/umsa.fd)
[tutorial ] (/usr/local/texlive/2021/texmf-dist/tex/latex/amsfonts/umsb.fd)
[tutorial ] ! Undefined control sequence.
[tutorial ] l.13 \fontsize{12}{14}\selectfont $V=\QQ
[tutorial ]                                         ^3$
[tutorial ] [1] (./math.aux) )
[tutorial ] (see the transcript file for additional information)
[tutorial ] Output written on math.dvi (1 page, 336 bytes).
[tutorial ] Transcript written on math.log.
[tutorial ] WARNING: display latex '\\QQ^3': latex exited with error
[tutorial ] [stdout]
...
```
and then it tries to build math.dvi half a dozen times more, failing each time.

Branch/Commit: ef2b25b2ecfa1fd5850087d9c354c404d617efd0

Reviewer: John Palmieri, Eric Gourgoulhon

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32946





---

archive/issue_comments_466019.json:
```json
{
    "body": "<a id='comment:1'></a>I think these failures are actually coming from building images for formulas.",
    "created_at": "2021-11-29T00:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466019",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>I think these failures are actually coming from building images for formulas.



---

archive/issue_comments_466020.json:
```json
{
    "body": "<a id='comment:2'></a>Looks like I broke this in #31356 by removing the setting of `SAGE_DOC_MATHJAX` from `src/bin/sage-env`.",
    "created_at": "2021-11-29T00:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466020",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Looks like I broke this in #31356 by removing the setting of `SAGE_DOC_MATHJAX` from `src/bin/sage-env`.



---

archive/issue_comments_466021.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-11-29T00:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466021",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_466022.json:
```json
{
    "body": "<a id='comment:4'></a>As non-mathjax builds are clearly broken, how about we just remove this whole setting?",
    "created_at": "2021-11-29T00:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466022",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>As non-mathjax builds are clearly broken, how about we just remove this whole setting?



---

archive/issue_comments_466023.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2021-11-29T00:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466023",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_466024.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-29T01:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466024",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_466025.json:
```json
{
    "body": "<a id='comment:8'></a>Good diagnosis, this fixes the problem for me. Should there be a deprecation warning for the `--mathjax/-j` option for docbuilding so that we can eventually delete it?",
    "created_at": "2021-11-29T04:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466025",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>Good diagnosis, this fixes the problem for me. Should there be a deprecation warning for the `--mathjax/-j` option for docbuilding so that we can eventually delete it?



---

archive/issue_comments_466026.json:
```json
{
    "body": "<a id='comment:9'></a>I don't think there's a need to deprecate it. At some point we may want to explore using https://pypi.org/project/sphinxcontrib-katex/ instead of mathjax, and then command line options of this type will be needed again",
    "created_at": "2021-11-29T05:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466026",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>I don't think there's a need to deprecate it. At some point we may want to explore using https://pypi.org/project/sphinxcontrib-katex/ instead of mathjax, and then command line options of this type will be needed again



---

archive/issue_comments_466027.json:
```json
{
    "body": "<a id='comment:10'></a>Thanks for dealing with this. Actually, I was about to post a message on sage-devel for I noticed two days ago that `sage -docbuild reference/manifolds html` fails with\n\n```\nOSError: WARNING: display latex 'K=\\\\RR': latex exited with error\n```\nwhile `sage -docbuild reference/manifolds pdf` succeeds, as well as `make` in generating the html doc. \nFor the moment I cannot pull the ticket branch (*), but as soon as I can do it, I'll test the fix. \n\n(*) the command `git pull trac u/mkoeppe/_sage___docbuild_doc_html__is_broken` hangs. Could this be an issue with trac.sagemath.doc this morning?",
    "created_at": "2021-11-29T09:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466027",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:10'></a>Thanks for dealing with this. Actually, I was about to post a message on sage-devel for I noticed two days ago that `sage -docbuild reference/manifolds html` fails with

```
OSError: WARNING: display latex 'K=\\RR': latex exited with error
```
while `sage -docbuild reference/manifolds pdf` succeeds, as well as `make` in generating the html doc. 
For the moment I cannot pull the ticket branch (*), but as soon as I can do it, I'll test the fix. 

(*) the command `git pull trac u/mkoeppe/_sage___docbuild_doc_html__is_broken` hangs. Could this be an issue with trac.sagemath.doc this morning?



---

archive/issue_comments_466028.json:
```json
{
    "body": "<a id='comment:11'></a>The trac server finally responded (after ~ 10 minutes!) and I confirm that this ticket fixes the issue with `sage -docbuild ... html`.",
    "created_at": "2021-11-29T10:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466028",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:11'></a>The trac server finally responded (after ~ 10 minutes!) and I confirm that this ticket fixes the issue with `sage -docbuild ... html`.



---

archive/issue_comments_466029.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-29T20:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466029",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_466030.json:
```json
{
    "body": "<a id='comment:12'></a>Great, let's merge it!",
    "created_at": "2021-11-29T20:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466030",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>Great, let's merge it!



---

archive/issue_comments_466031.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks for reviewing!",
    "created_at": "2021-11-29T20:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466031",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Thanks for reviewing!



---

archive/issue_comments_466032.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32946#issuecomment-466032",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_087060.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-12T15:09:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32946",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32946#event-87060"
}
```
