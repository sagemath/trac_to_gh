# Issue 32789: Fix spkg-configure.m4 for singular

archive/issues_032552.json:
```json
{
    "body": "Follow-up from #29024. This time with testing on more than 1 platform.\n\nOn Debian 11 (a.k.a. bullseye, stable) Singular's libs have different names, and are failing to be picked up: they all are installed in `/usr/lib/x86_64-linux-gnu/` and we have the following: I add Sage's names next to their\n\n```\nDebian                             Sage\n\nlibsingular-factory.so             libfactory.so\nlibsingular-gfan.so                ???\nlibsingular-omalloc.so             libomalloc.so\nlibsingular-polys.so               libpolys.so\nlibsingular-resources.so           libsingular_resources.so\nlibsingular-Singular.so            libSingular.so            \n```\n\nWhile it's not hard to test for `libsingular-Singular.so` in place of `libSingular.so`, it's some more work to use it.\n\nLibrary names may be obtained from `$ pkg-config --libs-only-l singular`, which on Debian produces\n\n```\n-lsingular-Singular -ldl -lsingular-polys -lntl -lgmp -ldl -lsingular-factory -lntl -lgmp -lsingular-omalloc -lsingular-resources\n```\n\n\n\nCC:  @dimpase @kiwifb @slel @isuruf @orlitzky @tobiasdiez @tobihan\n\nBranch/Commit: c0ceaf51d8ee6c7a55e60f6f9db2c92ca01245a2\n\nUpstream: Reported upstream. No feedback yet.\n\nReviewer: Matthias Koeppe\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32789\n\n",
    "closed_at": "2022-02-20T13:27:51Z",
    "created_at": "2021-10-29T02:38:28Z",
    "labels": [
        "component: build: configure",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Fix spkg-configure.m4 for singular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32789",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #29024. This time with testing on more than 1 platform.

On Debian 11 (a.k.a. bullseye, stable) Singular's libs have different names, and are failing to be picked up: they all are installed in `/usr/lib/x86_64-linux-gnu/` and we have the following: I add Sage's names next to their

```
Debian                             Sage

libsingular-factory.so             libfactory.so
libsingular-gfan.so                ???
libsingular-omalloc.so             libomalloc.so
libsingular-polys.so               libpolys.so
libsingular-resources.so           libsingular_resources.so
libsingular-Singular.so            libSingular.so            
```

While it's not hard to test for `libsingular-Singular.so` in place of `libSingular.so`, it's some more work to use it.

Library names may be obtained from `$ pkg-config --libs-only-l singular`, which on Debian produces

```
-lsingular-Singular -ldl -lsingular-polys -lntl -lgmp -ldl -lsingular-factory -lntl -lgmp -lsingular-omalloc -lsingular-resources
```



CC:  @dimpase @kiwifb @slel @isuruf @orlitzky @tobiasdiez @tobihan

Branch/Commit: c0ceaf51d8ee6c7a55e60f6f9db2c92ca01245a2

Upstream: Reported upstream. No feedback yet.

Reviewer: Matthias Koeppe

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32789





---

archive/issue_comments_463851.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-11-28T03:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463851",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_463852.json:
```json
{
    "body": "<a id='comment:4'></a>We already tried to fix the path to libSingular on cygwin once. Where does it really live?",
    "created_at": "2021-11-28T13:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463852",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:4'></a>We already tried to fix the path to libSingular on cygwin once. Where does it really live?



---

archive/issue_comments_463853.json:
```json
{
    "body": "<a id='comment:5'></a>We have a GH Actions workflow for Cygwin that allows you to download logs and the installation in `SAGE_LOCAL` for inspection, see for example https://github.com/sagemath/sage/actions/runs/1478855916",
    "created_at": "2021-11-28T19:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463853",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>We have a GH Actions workflow for Cygwin that allows you to download logs and the installation in `SAGE_LOCAL` for inspection, see for example https://github.com/sagemath/sage/actions/runs/1478855916



---

archive/issue_comments_463854.json:
```json
{
    "body": "<a id='comment:6'></a>Happy to run any commands under Cygwin too.",
    "created_at": "2021-11-29T18:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463854",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'></a>Happy to run any commands under Cygwin too.



---

archive/issue_comments_463855.json:
```json
{
    "body": "<a id='comment:7'></a>From https://github.com/mkoeppe/sage/suites/4487559073/artifacts/119913634:\nThe following DLLs are installed in `SAGE_LOCAL/bin`:\n\n```\ncygfactory-4-2-1.dll\ncygomalloc-0-9-6.dll\ncygpolys-4-2-1.dll\ncygsingular_resources-4-2-1.dll\ncygSingular-4-2-1.dll\n```",
    "created_at": "2021-11-29T19:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463855",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>From https://github.com/mkoeppe/sage/suites/4487559073/artifacts/119913634:
The following DLLs are installed in `SAGE_LOCAL/bin`:

```
cygfactory-4-2-1.dll
cygomalloc-0-9-6.dll
cygpolys-4-2-1.dll
cygsingular_resources-4-2-1.dll
cygSingular-4-2-1.dll
```



---

archive/issue_comments_463856.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:\n> {{{\n> cygSingular-4-2-1.dll\n> }}}\n\n\nIs there a symlink from `cygSingular.dll` to that file?",
    "created_at": "2021-11-29T20:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463856",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:
> {{{
> cygSingular-4-2-1.dll
> }}}


Is there a symlink from `cygSingular.dll` to that file?



---

archive/issue_comments_463857.json:
```json
{
    "body": "<a id='comment:9'></a>No",
    "created_at": "2021-11-29T20:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463857",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>No



---

archive/issue_comments_463858.json:
```json
{
    "body": "<a id='comment:10'></a>There is also a file `SAGE_LOCAL/lib/libSingular.dll.a`, which is used by the linker, and probably contains the information about the name of the actual DLL somehow.",
    "created_at": "2021-11-29T20:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463858",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>There is also a file `SAGE_LOCAL/lib/libSingular.dll.a`, which is used by the linker, and probably contains the information about the name of the actual DLL somehow.



---

archive/issue_comments_463859.json:
```json
{
    "body": "<a id='comment:11'></a>Apparently https://sourceware.org/binutils/docs/binutils/dlltool.html can be used for reading this info.\n\n`@`slelievre, could you run `dlltool --identify local/lib/libSingular.dll.a` please?",
    "created_at": "2021-11-29T20:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463859",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Apparently https://sourceware.org/binutils/docs/binutils/dlltool.html can be used for reading this info.

`@`slelievre, could you run `dlltool --identify local/lib/libSingular.dll.a` please?



---

archive/issue_comments_463860.json:
```json
{
    "body": "<a id='comment:12'></a>The SPKG won't be installed yet, so we can't read `local/lib/libSingular.dll.a` to obtain the necessary path during `./configure.` For the SPKG, we could hard-code the value as a last resort. Their library versioning scheme also corresponds to `package-version.txt`, but I doubt that's reliable.\n\nDetecting the system copy should be relatively easy in comparison. Unless there's a way to install multiple copies into the system libdir, we can use `find` to pick out what is hopefully the only copy of `cygSingular*.dll` during `./configure`.",
    "created_at": "2021-11-29T20:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463860",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:12'></a>The SPKG won't be installed yet, so we can't read `local/lib/libSingular.dll.a` to obtain the necessary path during `./configure.` For the SPKG, we could hard-code the value as a last resort. Their library versioning scheme also corresponds to `package-version.txt`, but I doubt that's reliable.

Detecting the system copy should be relatively easy in comparison. Unless there's a way to install multiple copies into the system libdir, we can use `find` to pick out what is hopefully the only copy of `cygSingular*.dll` during `./configure`.



---

archive/issue_comments_463861.json:
```json
{
    "body": "<a id='comment:13'></a>It would probably be a good idea to first test whether this whole symbol visibility issue is even a thing on Cygwin.",
    "created_at": "2021-11-29T20:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463861",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>It would probably be a good idea to first test whether this whole symbol visibility issue is even a thing on Cygwin.



---

archive/issue_comments_463862.json:
```json
{
    "body": "<a id='comment:15'></a>New commits:",
    "created_at": "2021-11-29T21:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463862",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>New commits:



---

archive/issue_comments_463863.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-11-29T21:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_463864.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-29T21:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463865.json:
```json
{
    "body": "<a id='comment:18'></a>I've put this on top of other Cygwin fixes for convenience of testing",
    "created_at": "2021-11-29T21:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463865",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>I've put this on top of other Cygwin fixes for convenience of testing



---

archive/issue_comments_463866.json:
```json
{
    "body": "<a id='comment:20'></a>Hm, the test with `CYGWIN_VERSION` does not seem to have worked\nhttps://github.com/sagemath/sagetrac-mirror/runs/4371131888?check_suite_focus=true",
    "created_at": "2021-11-30T21:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463866",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Hm, the test with `CYGWIN_VERSION` does not seem to have worked
https://github.com/sagemath/sagetrac-mirror/runs/4371131888?check_suite_focus=true



---

archive/issue_comments_463867.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-30T21:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463868.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-30T22:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463869.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2021-12-01T17:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463869",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_463870.json:
```json
{
    "body": "<a id='comment:24'></a>I've split out the cygwin issue to #32954, ready for review",
    "created_at": "2021-12-01T17:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463870",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>I've split out the cygwin issue to #32954, ready for review



---

archive/issue_comments_463871.json:
```json
{
    "body": "<a id='comment:25'></a>Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here",
    "created_at": "2021-12-23T19:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463871",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here



---

archive/issue_events_086754.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-23T19:51:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32789#event-86754"
}
```



---

archive/issue_comments_463872.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:25 mkoeppe]:\n> Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here\n\n\nI didn't get that. Is there something that needs to be changed in a Debian package?",
    "created_at": "2021-12-24T12:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463872",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:26'></a>Replying to [comment:25 mkoeppe]:
> Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here


I didn't get that. Is there something that needs to be changed in a Debian package?



---

archive/issue_comments_463873.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 thansen]:\n> Replying to [comment:25 mkoeppe]:\n> > Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here\n\n> \n> I didn't get that. Is there something that needs to be changed in a Debian package?\n\n\nYes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)",
    "created_at": "2021-12-25T19:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463873",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Replying to [comment:26 thansen]:
> Replying to [comment:25 mkoeppe]:
> > Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here

> 
> I didn't get that. Is there something that needs to be changed in a Debian package?


Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)



---

archive/issue_comments_463874.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:27 mkoeppe]:\n> Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)\n\n\nOk, done.",
    "created_at": "2021-12-29T13:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463874",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:28'></a>Replying to [comment:27 mkoeppe]:
> Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)


Ok, done.



---

archive/issue_comments_463875.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 thansen]:\n> Replying to [comment:27 mkoeppe]:\n> > Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)\n\n> \n> Ok, done.\n\n\nGreat. `tox -e docker-ubuntu-jammy-standard -- config.status` now gives:\n\n```\nChecking whether SageMath should install SPKG singular...\nchecking whether any of gmp ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no\nchecking for Singular... /usr/bin/Singular\nchecking for Singular >= 4.1.1... yes\nchecking if we can dlopen(/usr/lib/x86_64-linux-gnu/libSingular.so)... no\nconfigure: no suitable system package found for SPKG singular\n```\n\nSo it makes sense now to work on the present ticket.",
    "created_at": "2021-12-30T01:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463875",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Replying to [comment:28 thansen]:
> Replying to [comment:27 mkoeppe]:
> > Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)

> 
> Ok, done.


Great. `tox -e docker-ubuntu-jammy-standard -- config.status` now gives:

```
Checking whether SageMath should install SPKG singular...
checking whether any of gmp ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no
checking for Singular... /usr/bin/Singular
checking for Singular >= 4.1.1... yes
checking if we can dlopen(/usr/lib/x86_64-linux-gnu/libSingular.so)... no
configure: no suitable system package found for SPKG singular
```

So it makes sense now to work on the present ticket.



---

archive/issue_comments_463876.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-01-26T16:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463876",
    "user": "https://github.com/slel"
}
```

Changing priority from major to critical.



---

archive/issue_comments_463877.json:
```json
{
    "body": "<a id='comment:30'></a>Changing to critical in view of #33139.",
    "created_at": "2022-01-26T16:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463877",
    "user": "https://github.com/slel"
}
```

<a id='comment:30'></a>Changing to critical in view of #33139.



---

archive/issue_comments_463878.json:
```json
{
    "body": "<a id='comment:31'></a>What does this have to do with a docbuild failure?",
    "created_at": "2022-01-26T16:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463878",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:31'></a>What does this have to do with a docbuild failure?



---

archive/issue_comments_463879.json:
```json
{
    "body": "<a id='comment:32'></a>Right, the link with singular was ruled out\nin ticket:32954#comment:8.\n\nSorry for the noise.",
    "created_at": "2022-01-26T20:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463879",
    "user": "https://github.com/slel"
}
```

<a id='comment:32'></a>Right, the link with singular was ruled out
in ticket:32954#comment:8.

Sorry for the noise.



---

archive/issue_comments_463880.json:
```json
{
    "body": "<a id='comment:33'></a>still testing. the library on Debian is recognised, at least.\n\n---\nNew commits:",
    "created_at": "2022-02-11T12:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463880",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>still testing. the library on Debian is recognised, at least.

---
New commits:



---

archive/issue_comments_463881.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-11T17:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463881",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463882.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-11T17:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463882",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_463883.json:
```json
{
    "body": "<a id='comment:35'></a>Needs review. I suppose allowing Singular 4.1.1 was to be bumped up, as 4.1.1 doesn't actually have `polylib.lib` (it's called `poly.lib` there, but it's anyway too old, I think).",
    "created_at": "2022-02-11T17:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463883",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>Needs review. I suppose allowing Singular 4.1.1 was to be bumped up, as 4.1.1 doesn't actually have `polylib.lib` (it's called `poly.lib` there, but it's anyway too old, I think).



---

archive/issue_comments_463884.json:
```json
{
    "body": "<a id='comment:36'></a>I actually checked that the branch allows using system Singular 4.1.1 on Debian 11, but then the result has test failures due to that `polylib.lib` absense.",
    "created_at": "2022-02-11T18:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463884",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>I actually checked that the branch allows using system Singular 4.1.1 on Debian 11, but then the result has test failures due to that `polylib.lib` absense.



---

archive/issue_comments_463885.json:
```json
{
    "body": "<a id='comment:37'></a>OK, this still correctly rejects singular on all ubuntu releases earlier than `jammy`.",
    "created_at": "2022-02-11T19:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463885",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>OK, this still correctly rejects singular on all ubuntu releases earlier than `jammy`.



---

archive/issue_comments_463886.json:
```json
{
    "body": "<a id='comment:38'></a>With `TARGETS_PRE=build-local tox -e docker-ubuntu-jammy-standard -- build ptest` I see the following failures:\n\n```\nsage -t --random-seed=75077202530737540355693167266645487963 src/sage/interfaces/singular.py\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2243, in sage.interfaces.singular.SingularFunction._instancedoc_\nFailed example:\n    'groebner' in singular.groebner.__doc__\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.SingularFunction._instancedoc_[0]>\", line 1, in <module>\n        'groebner' in singular.groebner.__doc__\n      File \"sage/docs/instancedoc.pyx\", line 211, in sage.docs.instancedoc.InstanceDocDescriptor.__get__ (build/cythonized/sage/docs/instancedoc.c:1878)\n        return self.instancedoc(obj)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2247, in _instancedoc_\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2283, in sage.interfaces.singular.SingularFunctionElement._instancedoc_\nFailed example:\n    'matrix_expression' in A.nrows.__doc__\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.SingularFunctionElement._instancedoc_[2]>\", line 1, in <module>\n        'matrix_expression' in A.nrows.__doc__\n      File \"sage/docs/instancedoc.pyx\", line 211, in sage.docs.instancedoc.InstanceDocDescriptor.__get__ (build/cythonized/sage/docs/instancedoc.c:1878)\n        return self.instancedoc(obj)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2287, in _instancedoc_\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2319, in sage.interfaces.singular.generate_docstring_dictionary\nFailed example:\n    generate_docstring_dictionary()\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.generate_docstring_dictionary[1]>\", line 1, in <module>\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2371, in sage.interfaces.singular.get_docstring\nFailed example:\n    'groebner' in get_docstring('groebner')\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.get_docstring[1]>\", line 1, in <module>\n        'groebner' in get_docstring('groebner')\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2378, in get_docstring\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2373, in sage.interfaces.singular.get_docstring\nFailed example:\n    'standard.lib' in get_docstring('groebner')\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.get_docstring[2]>\", line 1, in <module>\n        'standard.lib' in get_docstring('groebner')\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2378, in get_docstring\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\n\nsage -t --random-seed=75077202530737540355693167266645487963 src/sage/libs/singular/singular.pyx\n**********************************************************************\nFile \"src/sage/libs/singular/singular.pyx\", line 1583, in sage.libs.singular.singular.get_resource\nFailed example:\n    get_resource('i')            # SINGULAR_INFO_FILE\nExpected:\n    '.../singular...'\nGot:\n    <BLANKLINE>\n**********************************************************************\n```\nand similar",
    "created_at": "2022-02-11T22:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463886",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>With `TARGETS_PRE=build-local tox -e docker-ubuntu-jammy-standard -- build ptest` I see the following failures:

```
sage -t --random-seed=75077202530737540355693167266645487963 src/sage/interfaces/singular.py
**********************************************************************
File "src/sage/interfaces/singular.py", line 2243, in sage.interfaces.singular.SingularFunction._instancedoc_
Failed example:
    'groebner' in singular.groebner.__doc__
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.SingularFunction._instancedoc_[0]>", line 1, in <module>
        'groebner' in singular.groebner.__doc__
      File "sage/docs/instancedoc.pyx", line 211, in sage.docs.instancedoc.InstanceDocDescriptor.__get__ (build/cythonized/sage/docs/instancedoc.c:1878)
        return self.instancedoc(obj)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2247, in _instancedoc_
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "src/sage/interfaces/singular.py", line 2283, in sage.interfaces.singular.SingularFunctionElement._instancedoc_
Failed example:
    'matrix_expression' in A.nrows.__doc__
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.SingularFunctionElement._instancedoc_[2]>", line 1, in <module>
        'matrix_expression' in A.nrows.__doc__
      File "sage/docs/instancedoc.pyx", line 211, in sage.docs.instancedoc.InstanceDocDescriptor.__get__ (build/cythonized/sage/docs/instancedoc.c:1878)
        return self.instancedoc(obj)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2287, in _instancedoc_
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "src/sage/interfaces/singular.py", line 2319, in sage.interfaces.singular.generate_docstring_dictionary
Failed example:
    generate_docstring_dictionary()
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.generate_docstring_dictionary[1]>", line 1, in <module>
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "src/sage/interfaces/singular.py", line 2371, in sage.interfaces.singular.get_docstring
Failed example:
    'groebner' in get_docstring('groebner')
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.get_docstring[1]>", line 1, in <module>
        'groebner' in get_docstring('groebner')
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2378, in get_docstring
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "src/sage/interfaces/singular.py", line 2373, in sage.interfaces.singular.get_docstring
Failed example:
    'standard.lib' in get_docstring('groebner')
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.get_docstring[2]>", line 1, in <module>
        'standard.lib' in get_docstring('groebner')
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2378, in get_docstring
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************

sage -t --random-seed=75077202530737540355693167266645487963 src/sage/libs/singular/singular.pyx
**********************************************************************
File "src/sage/libs/singular/singular.pyx", line 1583, in sage.libs.singular.singular.get_resource
Failed example:
    get_resource('i')            # SINGULAR_INFO_FILE
Expected:
    '.../singular...'
Got:
    <BLANKLINE>
**********************************************************************
```
and similar



---

archive/issue_comments_463887.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-11T22:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463887",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_463888.json:
```json
{
    "body": "<a id='comment:39'></a>this appears to be fixed by \n\n```\nexport SINGULAR_INFO_FILE=/usr/share/doc/singular/singular.hlp\n```\nbefore starting Sage. After this, instead of\n\n```\nsage: from sage.libs.singular.singular import get_resource\nsage: get_resource('i')\n// ** Could not get 'InfoFile'.\n// ** Either set environment variable 'SINGULAR_INFO_FILE' to 'InfoFile',\n// ** or make sure that 'InfoFile' is at \"/usr/bin/../share/info/singular.hlp\"\n```\none gets, as it should be:\n\n```\nsage: from sage.libs.singular.singular import get_resource\nsage: get_resource('i')\n'/usr/share/doc/singular/singular.hlp'\n```\nThe latter needs `singular-doc` installed, so it must be added to\n`build/pkgs/singular/distros/debian.txt`.",
    "created_at": "2022-02-12T10:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463888",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>this appears to be fixed by 

```
export SINGULAR_INFO_FILE=/usr/share/doc/singular/singular.hlp
```
before starting Sage. After this, instead of

```
sage: from sage.libs.singular.singular import get_resource
sage: get_resource('i')
// ** Could not get 'InfoFile'.
// ** Either set environment variable 'SINGULAR_INFO_FILE' to 'InfoFile',
// ** or make sure that 'InfoFile' is at "/usr/bin/../share/info/singular.hlp"
```
one gets, as it should be:

```
sage: from sage.libs.singular.singular import get_resource
sage: get_resource('i')
'/usr/share/doc/singular/singular.hlp'
```
The latter needs `singular-doc` installed, so it must be added to
`build/pkgs/singular/distros/debian.txt`.



---

archive/issue_comments_463889.json:
```json
{
    "body": "<a id='comment:41'></a>Should be fixed by\n\n```diff\n--- a/src/sage/libs/singular/singular.pyx\n+++ b/src/sage/libs/singular/singular.pyx\n@@ -1587,5 +1587,8 @@ def get_resource(id):\n     \"\"\"\n     cdef char *result = feGetResource(<char>ord(id))\n     if result == NULL:\n-        return None\n+        os.environ['SINGULAR_INFO_FILE']='/usr/share/doc/singular/singular.hlp'\n+        result = feGetResource(<char>ord(id))\n+        if result == NULL:\n+            return None\n     return bytes_to_str(result)\n```",
    "created_at": "2022-02-12T10:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463889",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'></a>Should be fixed by

```diff
--- a/src/sage/libs/singular/singular.pyx
+++ b/src/sage/libs/singular/singular.pyx
@@ -1587,5 +1587,8 @@ def get_resource(id):
     """
     cdef char *result = feGetResource(<char>ord(id))
     if result == NULL:
-        return None
+        os.environ['SINGULAR_INFO_FILE']='/usr/share/doc/singular/singular.hlp'
+        result = feGetResource(<char>ord(id))
+        if result == NULL:
+            return None
     return bytes_to_str(result)
```



---

archive/issue_comments_463890.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-12T11:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463891.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-12T11:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463891",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_463892.json:
```json
{
    "body": "<a id='comment:44'></a>All !Debian/Ubuntu Singular 4.2.1 packages are  broken, some of them do not install the needed .hlp file at all.",
    "created_at": "2022-02-12T16:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463892",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>All !Debian/Ubuntu Singular 4.2.1 packages are  broken, some of them do not install the needed .hlp file at all.



---

archive/issue_comments_463893.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:42 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                                     |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n> |[cb82ed0](https://git.sagemath.org/sage.git/commit/?id=cb82ed03d722e8e1e1a8fb6e8a0320c28f8a3ea7)|`make singular.hlp known to Sage for Debian Singular`|\n\n\nI don't think we should have this in our code",
    "created_at": "2022-02-12T16:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463893",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>Replying to [comment:42 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                                     |
> |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
> |[cb82ed0](https://git.sagemath.org/sage.git/commit/?id=cb82ed03d722e8e1e1a8fb6e8a0320c28f8a3ea7)|`make singular.hlp known to Sage for Debian Singular`|


I don't think we should have this in our code



---

archive/issue_comments_463894.json:
```json
{
    "body": "<a id='comment:46'></a>Probably best to wait until there's a suitable version packaged",
    "created_at": "2022-02-12T16:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463894",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>Probably best to wait until there's a suitable version packaged



---

archive/issue_comments_463895.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-02-12T16:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463895",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_463896.json:
```json
{
    "body": "<a id='comment:47'></a>indeed, there are no packages that work for us atm.",
    "created_at": "2022-02-12T19:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463896",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'></a>indeed, there are no packages that work for us atm.



---

archive/issue_comments_463897.json:
```json
{
    "body": "<a id='comment:48'></a>It seems that actually something either goes wrong with dpkg in Ubuntu Jammy, or something is wrong in my Docker setup, but\ninstalling singular-doc Ubuntu package results in many (most) missing files.\nIn particular the crucial file \"singular.info\" is missing.",
    "created_at": "2022-02-12T23:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463897",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>It seems that actually something either goes wrong with dpkg in Ubuntu Jammy, or something is wrong in my Docker setup, but
installing singular-doc Ubuntu package results in many (most) missing files.
In particular the crucial file "singular.info" is missing.



---

archive/issue_comments_463898.json:
```json
{
    "body": "<a id='comment:50'></a>Disturbingly, while on my Jammy Docker installing singular-doc leads to missing files,\ninstalling the same package on another (\"real\") Ubuntu system works.\nSo this might be Docker-specific :-(",
    "created_at": "2022-02-12T23:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463898",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>Disturbingly, while on my Jammy Docker installing singular-doc leads to missing files,
installing the same package on another ("real") Ubuntu system works.
So this might be Docker-specific :-(



---

archive/issue_comments_463899.json:
```json
{
    "body": "<a id='comment:51'></a>You can use `docker system prune --all` to get rid of bad stuff in the cache",
    "created_at": "2022-02-13T00:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463899",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>You can use `docker system prune --all` to get rid of bad stuff in the cache



---

archive/issue_comments_463900.json:
```json
{
    "body": "<a id='comment:52'></a>cache? No, it's worse, it's `dpkg -i` which does not do the job. \n\nIf I take the same .deb file, unpack it using `ar x` and manually install `data.tar.zst` using tar (one might have to install `zstd` first, to do un-compression), *all* the files from the package get installed.",
    "created_at": "2022-02-13T00:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463900",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:52'></a>cache? No, it's worse, it's `dpkg -i` which does not do the job. 

If I take the same .deb file, unpack it using `ar x` and manually install `data.tar.zst` using tar (one might have to install `zstd` first, to do un-compression), *all* the files from the package get installed.



---

archive/issue_comments_463901.json:
```json
{
    "body": "<a id='comment:53'></a>Further inspection shows that the problem is in the official !Ubuntu/Jammy Docker image. Both official Ubuntu's and Debian \n`singular-doc_4.2.1-p3+ds-1_all.deb` files exhibit the same error (apt used dpkg to install files .deb files, and the same error shows up if installation is done by `dpkg -i singular-doc_4.2.1-p3+ds-1_all.deb`).\n\nCould you check it's not only my Docker that plays up here? Steps to reproduce: \n\n* launch official Jammy image\n\n* get shell prompt there\n\n* run \n\n```\napt install singular-doc\ndpkg -V singular-doc\n```\n\nThe latter command should not output anything - but for me it outputs a log of missing files.\n\n\n\nIn !Debian/Bookworm image, which carries the same singular-doc version, everything is fine.\n\nPS. It would be good to check on a non-Docker installation of Jammy, too.",
    "created_at": "2022-02-13T08:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463901",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:53'></a>Further inspection shows that the problem is in the official !Ubuntu/Jammy Docker image. Both official Ubuntu's and Debian 
`singular-doc_4.2.1-p3+ds-1_all.deb` files exhibit the same error (apt used dpkg to install files .deb files, and the same error shows up if installation is done by `dpkg -i singular-doc_4.2.1-p3+ds-1_all.deb`).

Could you check it's not only my Docker that plays up here? Steps to reproduce: 

* launch official Jammy image

* get shell prompt there

* run 

```
apt install singular-doc
dpkg -V singular-doc
```

The latter command should not output anything - but for me it outputs a log of missing files.



In !Debian/Bookworm image, which carries the same singular-doc version, everything is fine.

PS. It would be good to check on a non-Docker installation of Jammy, too.



---

archive/issue_comments_463902.json:
```json
{
    "body": "<a id='comment:54'></a>We can go forward with this ticker (at least in Debian unstable it will be working) - but we will want a test to check that Singular docs work out of the box.\nOn a working system\n\n```\n# echo \"help;\" | Singular | grep error\n```\ndoes not return anything. On a broken one, one sees\n\n```\n# echo \"help;\" | Singular | grep error\n   ? No functioning help browser available.\n   ? error occurred in or before STDIN line 1: `help;`\n```",
    "created_at": "2022-02-13T08:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463902",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:54'></a>We can go forward with this ticker (at least in Debian unstable it will be working) - but we will want a test to check that Singular docs work out of the box.
On a working system

```
# echo "help;" | Singular | grep error
```
does not return anything. On a broken one, one sees

```
# echo "help;" | Singular | grep error
   ? No functioning help browser available.
   ? error occurred in or before STDIN line 1: `help;`
```



---

archive/issue_comments_463903.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:45 mkoeppe]:\n> Replying to [comment:42 git]:\n> > Branch pushed to git repo; I updated commit sha1. New commits:\n> > |                                                                                                                                           |                                                     |\n> > |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n> > |[cb82ed0](https://git.sagemath.org/sage.git/commit/?id=cb82ed03d722e8e1e1a8fb6e8a0320c28f8a3ea7)|`make singular.hlp known to Sage for Debian Singular`|\n\n> \n> I don't think we should have this in our code\n\n\nindeed, I'll remove it.",
    "created_at": "2022-02-13T08:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463903",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:55'></a>Replying to [comment:45 mkoeppe]:
> Replying to [comment:42 git]:
> > Branch pushed to git repo; I updated commit sha1. New commits:
> > |                                                                                                                                           |                                                     |
> > |-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
> > |[cb82ed0](https://git.sagemath.org/sage.git/commit/?id=cb82ed03d722e8e1e1a8fb6e8a0320c28f8a3ea7)|`make singular.hlp known to Sage for Debian Singular`|

> 
> I don't think we should have this in our code


indeed, I'll remove it.



---

archive/issue_comments_463904.json:
```json
{
    "body": "<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-13T10:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_463905.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-02-13T10:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463905",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_463906.json:
```json
{
    "body": "<a id='comment:58'></a>this should pick up system Singular on Debian/bookworm and sid.\n(and reject broken one on Jammy)",
    "created_at": "2022-02-13T10:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463906",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:58'></a>this should pick up system Singular on Debian/bookworm and sid.
(and reject broken one on Jammy)



---

archive/issue_comments_463907.json:
```json
{
    "body": "<a id='comment:59'></a>By the way, I see the same Jammy failure with singular-doc in Podman running on Fedora, as I see with Docker on macOS.\nSo it really points at a faulty image. Or it's fault in OS itself, for this one needs a non-!Docker/Podman test.",
    "created_at": "2022-02-13T11:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463907",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:59'></a>By the way, I see the same Jammy failure with singular-doc in Podman running on Fedora, as I see with Docker on macOS.
So it really points at a faulty image. Or it's fault in OS itself, for this one needs a non-!Docker/Podman test.



---

archive/issue_comments_463908.json:
```json
{
    "body": "<a id='comment:60'></a>Everything is fine in Jammy run in an lxc container, so that's really !Docker/Podman.\nI filed https://github.com/tianon/docker-brew-ubuntu-core/issues/230",
    "created_at": "2022-02-13T12:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463908",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:60'></a>Everything is fine in Jammy run in an lxc container, so that's really !Docker/Podman.
I filed https://github.com/tianon/docker-brew-ubuntu-core/issues/230



---

archive/issue_comments_463909.json:
```json
{
    "body": "<a id='comment:61'></a>I'm told it's Jammy Ubuntu feature, not a bug, here:\nhttps://bugs.launchpad.net/ubuntu/+source/dpkg/+bug/1960749",
    "created_at": "2022-02-13T20:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463909",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:61'></a>I'm told it's Jammy Ubuntu feature, not a bug, here:
https://bugs.launchpad.net/ubuntu/+source/dpkg/+bug/1960749



---

archive/issue_comments_463910.json:
```json
{
    "body": "<a id='comment:62'></a>Bizarre, so this means we need to add a test for the availability of the info file to `spkg-configure.m4`.",
    "created_at": "2022-02-13T20:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463910",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>Bizarre, so this means we need to add a test for the availability of the info file to `spkg-configure.m4`.



---

archive/issue_comments_463911.json:
```json
{
    "body": "<a id='comment:63'></a>Oh, I see you already did this in 45f1b19",
    "created_at": "2022-02-13T20:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463911",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>Oh, I see you already did this in 45f1b19



---

archive/issue_comments_463912.json:
```json
{
    "body": "<a id='comment:64'></a>https://askubuntu.com/questions/1173337/how-to-prevent-system-from-being-minimized",
    "created_at": "2022-02-13T20:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463912",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>https://askubuntu.com/questions/1173337/how-to-prevent-system-from-being-minimized



---

archive/issue_comments_463913.json:
```json
{
    "body": "<a id='comment:65'></a>We can certainly add this step to `build/bin/write-dockerfile.sh` for Debian/Ubuntu",
    "created_at": "2022-02-13T20:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463913",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:65'></a>We can certainly add this step to `build/bin/write-dockerfile.sh` for Debian/Ubuntu



---

archive/issue_comments_463914.json:
```json
{
    "body": "<a id='comment:66'></a>Using their `unminimize` command, I see\n\n```\nReinstalling packages with system documentation in /usr/share/doc/ ..\ndpkg-query: error: --search needs at least one file name pattern argument\n\nUse --help for help about querying packages.\n```\nClearly commercial-grade work there",
    "created_at": "2022-02-13T20:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463914",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>Using their `unminimize` command, I see

```
Reinstalling packages with system documentation in /usr/share/doc/ ..
dpkg-query: error: --search needs at least one file name pattern argument

Use --help for help about querying packages.
```
Clearly commercial-grade work there



---

archive/issue_comments_463915.json:
```json
{
    "body": "<a id='comment:68'></a>It might be quicker just to remove the `exclude` policy - this won't trigger reinstallation of all the packages already there. \n\n---\nNew commits:",
    "created_at": "2022-02-13T21:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463915",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:68'></a>It might be quicker just to remove the `exclude` policy - this won't trigger reinstallation of all the packages already there. 

---
New commits:



---

archive/issue_comments_463916.json:
```json
{
    "body": "<a id='comment:69'></a>Fine with me, go ahead",
    "created_at": "2022-02-13T21:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463916",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>Fine with me, go ahead



---

archive/issue_comments_463917.json:
```json
{
    "body": "<a id='comment:70'></a>Replying to [comment:69 mkoeppe]:\n> Fine with me, go ahead\n\nYour branch is actually good (I was worried that images will get much bigger, but I haven't noticed this at all).\nWhat worries me is what happens if `unminimize` is not even present, wouldn't it trigger an error?",
    "created_at": "2022-02-14T10:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463917",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:70'></a>Replying to [comment:69 mkoeppe]:
> Fine with me, go ahead

Your branch is actually good (I was worried that images will get much bigger, but I haven't noticed this at all).
What worries me is what happens if `unminimize` is not even present, wouldn't it trigger an error?



---

archive/issue_comments_463918.json:
```json
{
    "body": "<a id='comment:71'></a>OK, it's ignored if missing. No problem then.\nI actually tested this branch in a Ubuntu Jammy Docker, all good (with system Singular).",
    "created_at": "2022-02-14T10:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463918",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:71'></a>OK, it's ignored if missing. No problem then.
I actually tested this branch in a Ubuntu Jammy Docker, all good (with system Singular).



---

archive/issue_comments_463919.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:66 mkoeppe]:\n> Clearly commercial-grade work there\n\n\nI heard stories from a long-term Canonical insider, such as : \"Boss: We're closing down project X, you're fired. \nProgrammer: But, but, I'm also doing projects Y, Z, ...?! Boss: Uhm, OK. You can stay then.\"",
    "created_at": "2022-02-14T11:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463919",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:72'></a>Replying to [comment:66 mkoeppe]:
> Clearly commercial-grade work there


I heard stories from a long-term Canonical insider, such as : "Boss: We're closing down project X, you're fired. 
Programmer: But, but, I'm also doing projects Y, Z, ...?! Boss: Uhm, OK. You can stay then."



---

archive/issue_comments_463920.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-14T22:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463920",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_463921.json:
```json
{
    "body": "<a id='comment:74'></a>Thanks!",
    "created_at": "2022-02-15T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463921",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:74'></a>Thanks!



---

archive/issue_comments_463922.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-20T13:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32789#issuecomment-463922",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086755.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-20T13:27:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32789",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32789#event-86755"
}
```
