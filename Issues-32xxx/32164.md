# Issue 32164: more typing annotations in combinat folder

archive/issues_031927.json:
```json
{
    "body": "Add minimal typing annotations in the files\n\n```\nsrc/sage/combinat/dyck_word.py\nsrc/sage/combinat/e_one_star.py\nsrc/sage/combinat/non_decreasing_parking_function.py\nsrc/sage/combinat/tamari_lattices.py\n```\n\nCC:  @tobiasdiez @tscrim\n\nBranch/Commit: 79b205373300669adfa8b9e891d1080391878108\n\nReviewer: Matthias Koeppe\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32164\n\n",
    "closed_at": "2021-07-24T15:28:02Z",
    "created_at": "2021-07-08T16:13:36Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "more typing annotations in combinat folder",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32164",
    "user": "https://github.com/fchapoton"
}
```
Add minimal typing annotations in the files

```
src/sage/combinat/dyck_word.py
src/sage/combinat/e_one_star.py
src/sage/combinat/non_decreasing_parking_function.py
src/sage/combinat/tamari_lattices.py
```

CC:  @tobiasdiez @tscrim

Branch/Commit: 79b205373300669adfa8b9e891d1080391878108

Reviewer: Matthias Koeppe

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32164





---

archive/issue_comments_640404.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-08T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640404",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_640405.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/32164\"",
    "created_at": "2021-07-08T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640405",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/32164"



---

archive/issue_comments_640406.json:
```json
{
    "body": "Changing commit from \"\" to \"8907bef91be430a0763db3a2648656351d50c315\"",
    "created_at": "2021-07-08T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640406",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "8907bef91be430a0763db3a2648656351d50c315"



---

archive/issue_comments_640407.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[8907bef](https://github.com/sagemath/sagetrac-mirror/commit/8907bef91be430a0763db3a2648656351d50c315)|`adding typing annotations in some combinat/ files`|",
    "created_at": "2021-07-08T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640407",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[8907bef](https://github.com/sagemath/sagetrac-mirror/commit/8907bef91be430a0763db3a2648656351d50c315)|`adding typing annotations in some combinat/ files`|



---

archive/issue_comments_640408.json:
```json
{
    "body": "<a id='comment:2'></a>\n\n```\n             heights[i + 1] = height\n         return tuple(heights)\n \n-    def associated_parenthesis(self, pos):\n+    def associated_parenthesis(self, pos) -> Union[int, None]:\n         r\"\"\"\n         Report the position for the parenthesis in ``self`` that matches the\n         one at position ``pos``.\n```\nI'm really only guessing here, but I think `Optional[int]` may be more idiomatic",
    "created_at": "2021-07-08T16:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640408",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>

```
             heights[i + 1] = height
         return tuple(heights)
 
-    def associated_parenthesis(self, pos):
+    def associated_parenthesis(self, pos) -> Union[int, None]:
         r"""
         Report the position for the parenthesis in ``self`` that matches the
         one at position ``pos``.
```
I'm really only guessing here, but I think `Optional[int]` may be more idiomatic



---

archive/issue_comments_640409.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt seems that the best syntax is `int | None` starting from python 3.10 :\n\nhttps://stackoverflow.com/questions/51710037/how-should-i-use-the-optional-type-hint",
    "created_at": "2021-07-09T11:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640409",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
It seems that the best syntax is `int | None` starting from python 3.10 :

https://stackoverflow.com/questions/51710037/how-should-i-use-the-optional-type-hint



---

archive/issue_comments_640410.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks for the pointer; it will be a while though until we can use features introduced in 3.10.\n\nI'm not sure if I would agree with the API change here. This is a getter/setter-style method; I don't know if making a change just to be able to add a type decoration is justified:\n\n```\n-    def color(self, color=None):\n+    def color(self, color=None) -> Color:\n         r\"\"\"\n         Return or change the color of the face.\n \n         INPUT:\n \n         - ``color`` - string, rgb tuple, color (optional, default: ``None``)\n           the new color to assign to the face. If ``None``, it returns the\n           color of the face.\n \n         OUTPUT:\n \n-            color\n+        color\n \n         EXAMPLES::\n \n             sage: from sage.combinat.e_one_star import Face\n             sage: f = Face((0,2,0), 3)\n             sage: f.color()\n             RGB color (0.0, 0.0, 1.0)\n             sage: f.color('red')\n-            sage: f.color()\n             RGB color (1.0, 0.0, 0.0)\n-\n         \"\"\"\n-        if color is None:\n-            return self._color\n-        else:\n+        if color is not None:\n             self._color = Color(color)\n+        return self._color\n```",
    "created_at": "2021-07-09T21:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640410",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Thanks for the pointer; it will be a while though until we can use features introduced in 3.10.

I'm not sure if I would agree with the API change here. This is a getter/setter-style method; I don't know if making a change just to be able to add a type decoration is justified:

```
-    def color(self, color=None):
+    def color(self, color=None) -> Color:
         r"""
         Return or change the color of the face.
 
         INPUT:
 
         - ``color`` - string, rgb tuple, color (optional, default: ``None``)
           the new color to assign to the face. If ``None``, it returns the
           color of the face.
 
         OUTPUT:
 
-            color
+        color
 
         EXAMPLES::
 
             sage: from sage.combinat.e_one_star import Face
             sage: f = Face((0,2,0), 3)
             sage: f.color()
             RGB color (0.0, 0.0, 1.0)
             sage: f.color('red')
-            sage: f.color()
             RGB color (1.0, 0.0, 0.0)
-
         """
-        if color is None:
-            return self._color
-        else:
+        if color is not None:
             self._color = Color(color)
+        return self._color
```



---

archive/issue_comments_640411.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe or syntax `int | None` should be possible already in 3.7 with the future import.\n\nFor the color function, if the change to always return something is not intended, this kind of situation is usually resolved by specifying overloads (https://docs.python.org/3/library/typing.html#typing.overload), i.e something like\n\n```\n@overload\ndef color(self, color: None) -> Color:\n    ...\n@overload\ndef color(self, color: Color) -> None:\n    ...\ndef color(self, color):\n   implementation\n```",
    "created_at": "2021-07-09T22:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640411",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>
The or syntax `int | None` should be possible already in 3.7 with the future import.

For the color function, if the change to always return something is not intended, this kind of situation is usually resolved by specifying overloads (https://docs.python.org/3/library/typing.html#typing.overload), i.e something like

```
@overload
def color(self, color: None) -> Color:
    ...
@overload
def color(self, color: Color) -> None:
    ...
def color(self, color):
   implementation
```



---

archive/issue_comments_640412.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[79b2053](https://github.com/sagemath/sagetrac-mirror/commit/79b205373300669adfa8b9e891d1080391878108)|`annotations details in e_one_star`|",
    "created_at": "2021-07-11T06:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[79b2053](https://github.com/sagemath/sagetrac-mirror/commit/79b205373300669adfa8b9e891d1080391878108)|`annotations details in e_one_star`|



---

archive/issue_comments_640413.json:
```json
{
    "body": "Changing commit from \"8907bef91be430a0763db3a2648656351d50c315\" to \"79b205373300669adfa8b9e891d1080391878108\"",
    "created_at": "2021-07-11T06:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8907bef91be430a0763db3a2648656351d50c315" to "79b205373300669adfa8b9e891d1080391878108"



---

archive/issue_comments_640414.json:
```json
{
    "body": "<a id='comment:7'></a>\nI have undone the change to `color` and removed its annotation.\n\nI also used the new syntax for union annotation elsewhere in the same file.",
    "created_at": "2021-07-11T06:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640414",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
I have undone the change to `color` and removed its annotation.

I also used the new syntax for union annotation elsewhere in the same file.



---

archive/issue_comments_640415.json:
```json
{
    "body": "<a id='comment:8'></a>\nLGTM and also passes tests also on Python 3.7.11.",
    "created_at": "2021-07-11T21:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640415",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
LGTM and also passes tests also on Python 3.7.11.



---

archive/issue_comments_640416.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-11T21:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640416",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_640417.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2021-07-11T21:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640417",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_events_095817.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-24T15:28:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32164#event-95817"
}
```



---

archive/issue_comments_640418.json:
```json
{
    "body": "Changing branch from \"u/chapoton/32164\" to \"79b205373300669adfa8b9e891d1080391878108\"",
    "created_at": "2021-07-24T15:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640418",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/32164" to "79b205373300669adfa8b9e891d1080391878108"



---

archive/issue_comments_640419.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-24T15:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-640419",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
