# Issue 32642: enumeration of linear intervals in posets

archive/issues_032405.json:
```json
{
    "body": "as one useful tool to have\n\nCC:  @tscrim @slel\n\nBranch/Commit: f4e0d26d4eb193da548044d51badaf349d1860dc\n\nReviewer: Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32642\n\n",
    "closed_at": "2021-10-19T20:31:52Z",
    "created_at": "2021-10-06T07:51:25Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "enumeration of linear intervals in posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32642",
    "user": "https://github.com/fchapoton"
}
```
as one useful tool to have

CC:  @tscrim @slel

Branch/Commit: f4e0d26d4eb193da548044d51badaf349d1860dc

Reviewer: Travis Scrimshaw

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32642





---

archive/issue_comments_642225.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[7b33047](https://github.com/sagemath/sagetrac-mirror/commit/7b33047a8b777f6b22772405040224fefe2017b5)|`enumeration of linear intervals in posets`|",
    "created_at": "2021-10-06T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642225",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[7b33047](https://github.com/sagemath/sagetrac-mirror/commit/7b33047a8b777f6b22772405040224fefe2017b5)|`enumeration of linear intervals in posets`|



---

archive/issue_comments_642226.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/32642\"",
    "created_at": "2021-10-06T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642226",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/32642"



---

archive/issue_comments_642227.json:
```json
{
    "body": "Changing commit from \"\" to \"7b33047a8b777f6b22772405040224fefe2017b5\"",
    "created_at": "2021-10-06T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642227",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "7b33047a8b777f6b22772405040224fefe2017b5"



---

archive/issue_comments_642228.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-06T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642228",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_642229.json:
```json
{
    "body": "Changing commit from \"7b33047a8b777f6b22772405040224fefe2017b5\" to \"5a9ca1efca281c47c4345b2007147cb6cd6f93fc\"",
    "created_at": "2021-10-06T07:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7b33047a8b777f6b22772405040224fefe2017b5" to "5a9ca1efca281c47c4345b2007147cb6cd6f93fc"



---

archive/issue_comments_642230.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[5a9ca1e](https://github.com/sagemath/sagetrac-mirror/commit/5a9ca1efca281c47c4345b2007147cb6cd6f93fc)|`enumeration of linear intervals in posets`|",
    "created_at": "2021-10-06T07:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642230",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[5a9ca1e](https://github.com/sagemath/sagetrac-mirror/commit/5a9ca1efca281c47c4345b2007147cb6cd6f93fc)|`enumeration of linear intervals in posets`|



---

archive/issue_comments_642231.json:
```json
{
    "body": "<a id='comment:3'></a>\ngreen bot. Slightly interesting ticket, maybe, for once.",
    "created_at": "2021-10-06T11:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642231",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
green bot. Slightly interesting ticket, maybe, for once.



---

archive/issue_comments_642232.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt seems like you are implementing a na\u00efve version of `all_paths_iterator()` for `is_linear_interval`. I would probably implement it as\n\n```python\ndef is_linear_interval(self, t_min, t_max):\n    # We have the leq matrix, so checking comparisons is fast\n    if self.is_lequal == self._alternate_is_lequal:\n        if not self.is_lequal(t_min, t_max):  # very quick check\n            return False\n        t = t_max\n        while t != t_min:\n            found = False\n            for u in self.neighbor_in_iterator(t):\n                if self.is_lequal(t_min, u):\n                    if not found:\n                        found = True\n                        t = u\n                    else:\n                        return False\n        return True\n    it = self.all_paths_iterator(t_min, t_max)\n    try:\n        next(it)\n    except StopIteration:  # not comparable\n        return False\n    try:\n        next(it)\n    except StopIteration:  # one path\n        return True\n    return False\n```\nI suspect the na\u00efve version you have is faster when the comparisons are fast, but not when we have to check for paths in the Hasse diagram digraph (the default/generic `is_lequal`).",
    "created_at": "2021-10-06T22:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642232",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
It seems like you are implementing a naïve version of `all_paths_iterator()` for `is_linear_interval`. I would probably implement it as

```python
def is_linear_interval(self, t_min, t_max):
    # We have the leq matrix, so checking comparisons is fast
    if self.is_lequal == self._alternate_is_lequal:
        if not self.is_lequal(t_min, t_max):  # very quick check
            return False
        t = t_max
        while t != t_min:
            found = False
            for u in self.neighbor_in_iterator(t):
                if self.is_lequal(t_min, u):
                    if not found:
                        found = True
                        t = u
                    else:
                        return False
        return True
    it = self.all_paths_iterator(t_min, t_max)
    try:
        next(it)
    except StopIteration:  # not comparable
        return False
    try:
        next(it)
    except StopIteration:  # one path
        return True
    return False
```
I suspect the naïve version you have is faster when the comparisons are fast, but not when we have to check for paths in the Hasse diagram digraph (the default/generic `is_lequal`).



---

archive/issue_comments_642233.json:
```json
{
    "body": "<a id='comment:5'></a>\nAlso, do we want to also expose `is_linear_interval` in the frontend?",
    "created_at": "2021-10-06T22:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642233",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
Also, do we want to also expose `is_linear_interval` in the frontend?



---

archive/issue_comments_642234.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|\n|[f4e0d26](https://github.com/sagemath/sagetrac-mirror/commit/f4e0d26d4eb193da548044d51badaf349d1860dc)|`is_linear_interval, in frontend, and another algo in backend`|",
    "created_at": "2021-10-07T07:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
|[f4e0d26](https://github.com/sagemath/sagetrac-mirror/commit/f4e0d26d4eb193da548044d51badaf349d1860dc)|`is_linear_interval, in frontend, and another algo in backend`|



---

archive/issue_comments_642235.json:
```json
{
    "body": "Changing commit from \"5a9ca1efca281c47c4345b2007147cb6cd6f93fc\" to \"f4e0d26d4eb193da548044d51badaf349d1860dc\"",
    "created_at": "2021-10-07T07:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5a9ca1efca281c47c4345b2007147cb6cd6f93fc" to "f4e0d26d4eb193da548044d51badaf349d1860dc"



---

archive/issue_comments_642236.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks for the suggestions.\n\nI have used the presence of `_leq_storage` as the check for fast comparison, as this is what is used by `_alternate_is_lequal`. Maybe at some point one should always compute this data when creating a poset ?",
    "created_at": "2021-10-07T07:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642236",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
Thanks for the suggestions.

I have used the presence of `_leq_storage` as the check for fast comparison, as this is what is used by `_alternate_is_lequal`. Maybe at some point one should always compute this data when creating a poset ?



---

archive/issue_comments_642237.json:
```json
{
    "body": "<a id='comment:8'></a>\nThank you. LGTM.",
    "created_at": "2021-10-07T23:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642237",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Thank you. LGTM.



---

archive/issue_comments_642238.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-07T23:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642238",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_642239.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2021-10-07T23:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642239",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_642240.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642240",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_105151.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-19T20:31:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32642#event-105151"
}
```



---

archive/issue_comments_642241.json:
```json
{
    "body": "Changing branch from \"u/chapoton/32642\" to \"f4e0d26d4eb193da548044d51badaf349d1860dc\"",
    "created_at": "2021-10-19T20:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32642#issuecomment-642241",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/32642" to "f4e0d26d4eb193da548044d51badaf349d1860dc"
