# Issue 32036: sage.env: Remove direct uses of SAGE_LOCAL from the Sage library

archive/issues_031799.json:
```json
{
    "body": "(from #31338#comment:13)\n\nThese changes are preparation for modularization and is also intended  to make downstream packaging easier.\n\n\n\n\nCC:  @kiwifb @antonio-rojas @dimpase @videlec @jhpalmieri\n\nBranch/Commit: 985af6e8dccf44a02ba494b0e573aa0856b52cd3\n\nReviewer: Dima Pasechnik, Fran\u00e7ois Bissey\n\nAuthor: Matthias Koeppe, Fran\u00e7ois Bissey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32036\n\n",
    "closed_at": "2021-07-09T20:23:30Z",
    "created_at": "2021-06-23T00:15:50Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "sage.env: Remove direct uses of SAGE_LOCAL from the Sage library",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32036",
    "user": "https://github.com/mkoeppe"
}
```
(from #31338#comment:13)

These changes are preparation for modularization and is also intended  to make downstream packaging easier.




CC:  @kiwifb @antonio-rojas @dimpase @videlec @jhpalmieri

Branch/Commit: 985af6e8dccf44a02ba494b0e573aa0856b52cd3

Reviewer: Dima Pasechnik, François Bissey

Author: Matthias Koeppe, François Bissey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32036





---

archive/issue_comments_485069.json:
```json
{
    "body": "<a id='comment:1'></a>There are a few remaining uses of `SAGE_SHARE` in `src/sage` that will have to be eliminated though.",
    "created_at": "2021-06-23T00:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485069",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>There are a few remaining uses of `SAGE_SHARE` in `src/sage` that will have to be eliminated though.



---

archive/issue_comments_485070.json:
```json
{
    "body": "<a id='comment:2'></a>(see #30819 `sage.databases`: Use `sage.feature` to define database file system location)",
    "created_at": "2021-06-23T00:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485070",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>(see #30819 `sage.databases`: Use `sage.feature` to define database file system location)



---

archive/issue_comments_485071.json:
```json
{
    "body": "<a id='comment:3'></a>Perhaps now is also the time that we do #30914 (Meta-ticket: Create upstream repositories, pip-installable packages for database packages)?",
    "created_at": "2021-06-23T00:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485071",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Perhaps now is also the time that we do #30914 (Meta-ticket: Create upstream repositories, pip-installable packages for database packages)?



---

archive/issue_comments_485072.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 mkoeppe]:\n> Perhaps now is also the time that we do #30914 (Meta-ticket: Create upstream repositories, pip-installable packages for database packages)?\n\n\nThat would be timely if we could.\n\nOther issue about `sage_setup/setenv.py` I tried to replace `if SAGE_LOCAL:` by `if SAGE_ROOT:` since it is set to `None` for me in distro. But I still got the linking noise which means that it still accepted that as a positive. So a better test may be needed.",
    "created_at": "2021-06-23T00:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485072",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>Replying to [comment:3 mkoeppe]:
> Perhaps now is also the time that we do #30914 (Meta-ticket: Create upstream repositories, pip-installable packages for database packages)?


That would be timely if we could.

Other issue about `sage_setup/setenv.py` I tried to replace `if SAGE_LOCAL:` by `if SAGE_ROOT:` since it is set to `None` for me in distro. But I still got the linking noise which means that it still accepted that as a positive. So a better test may be needed.



---

archive/issue_comments_485073.json:
```json
{
    "body": "<a id='comment:5'></a>No, `SAGE_ROOT` is not the right choice there.",
    "created_at": "2021-06-23T00:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485073",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>No, `SAGE_ROOT` is not the right choice there.



---

archive/issue_comments_485074.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 fbissey]:\n> Other issue about `sage_setup/setenv.py` I tried to replace `if SAGE_LOCAL:` by `if SAGE_ROOT:` since it is set to `None` for me in distro. But I still got the linking noise which means that it still accepted that as a positive. So a better test may be needed.\n\n\nScratch that, I think I did myself in at build time for some reasons (which I have top check).",
    "created_at": "2021-06-23T00:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485074",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>Replying to [comment:4 fbissey]:
> Other issue about `sage_setup/setenv.py` I tried to replace `if SAGE_LOCAL:` by `if SAGE_ROOT:` since it is set to `None` for me in distro. But I still got the linking noise which means that it still accepted that as a positive. So a better test may be needed.


Scratch that, I think I did myself in at build time for some reasons (which I have top check).



---

archive/issue_comments_485075.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-23T18:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485075",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_485076.json:
```json
{
    "body": "<a id='comment:8'></a>New commits:",
    "created_at": "2021-06-23T18:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485076",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>New commits:



---

archive/issue_comments_485077.json:
```json
{
    "body": "<a id='comment:9'></a>\n```\n> sage\nTraceback (most recent call last):\n  File \"/usr/bin/sage-ipython\", line 9, in <module>\n    from sage.misc.banner import banner\n  File \"/usr/lib/python3.9/site-packages/sage/misc/banner.py\", line 16, in <module>\n    from sage.env import (SAGE_VERSION, SAGE_VERSION_BANNER, SAGE_BANNER)\n  File \"/usr/lib/python3.9/site-packages/sage/env.py\", line 314, in <module>\n    SINGULAR_SO = var(\"SINGULAR_SO\", _get_shared_lib_path(\"Singular\", \"singular-Singular\"))\n  File \"/usr/lib/python3.9/site-packages/sage/env.py\", line 291, in _get_shared_lib_path\n    search_directories = [Path(SAGE_LOCAL) / 'lib']\n  File \"/usr/lib/python3.9/pathlib.py\", line 1072, in __new__\n    self = cls._from_parts(args, init=False)\n  File \"/usr/lib/python3.9/pathlib.py\", line 697, in _from_parts\n    drv, root, parts = self._parse_args(args)\n  File \"/usr/lib/python3.9/pathlib.py\", line 681, in _parse_args\n    a = os.fspath(a)\nTypeError: expected str, bytes or os.PathLike object, not NoneType\n```",
    "created_at": "2021-06-23T18:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485077",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:9'></a>
```
> sage
Traceback (most recent call last):
  File "/usr/bin/sage-ipython", line 9, in <module>
    from sage.misc.banner import banner
  File "/usr/lib/python3.9/site-packages/sage/misc/banner.py", line 16, in <module>
    from sage.env import (SAGE_VERSION, SAGE_VERSION_BANNER, SAGE_BANNER)
  File "/usr/lib/python3.9/site-packages/sage/env.py", line 314, in <module>
    SINGULAR_SO = var("SINGULAR_SO", _get_shared_lib_path("Singular", "singular-Singular"))
  File "/usr/lib/python3.9/site-packages/sage/env.py", line 291, in _get_shared_lib_path
    search_directories = [Path(SAGE_LOCAL) / 'lib']
  File "/usr/lib/python3.9/pathlib.py", line 1072, in __new__
    self = cls._from_parts(args, init=False)
  File "/usr/lib/python3.9/pathlib.py", line 697, in _from_parts
    drv, root, parts = self._parse_args(args)
  File "/usr/lib/python3.9/pathlib.py", line 681, in _parse_args
    a = os.fspath(a)
TypeError: expected str, bytes or os.PathLike object, not NoneType
```



---

archive/issue_comments_485078.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T21:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485079.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks for catching this!",
    "created_at": "2021-06-23T21:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485079",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Thanks for catching this!



---

archive/issue_comments_485080.json:
```json
{
    "body": "<a id='comment:12'></a>Next issue:\n\n```\n/usr/lib/python3.9/site-packages/sage/interfaces/gap_workspace.py in gap_workspace_file(system='gap', name='workspace', dir='/home/antonio/.sage/gap')\n     [...]\n     57         sage: assert name1 == name2\n     58     \"\"\"\n     59     if dir is None:\n     60         dir = os.path.join(DOT_SAGE, 'gap')\n     61 \n---> 62     h = hashlib.sha1(SAGE_LOCAL.encode('utf-8')).hexdigest()\n        h = undefined\n        global hashlib.sha1 = <built-in function openssl_sha1>\n        global SAGE_LOCAL.encode.hexdigest = undefined\n     63     return os.path.join(dir, '%s-%s-%s' % (system, name, h))\n     64 \n     65 \nAttributeError: 'NoneType' object has no attribute 'encode'\n```\nand, after bypassing it\n\n```\n/usr/lib/python3.9/site-packages/sage/interfaces/lie.py in __init__(self=LiE Interpreter, maxread=None, script_subdirectory=None, logfile=None, server=None)\n    [...]\n    329                         # it to be very obfuscated that would be better.   Even\n    330                         # better is to use sequence numbers.\n    331                         prompt = '> ',\n    332 \n    333                         # This is the command that starts up your program\n--> 334                         command = \"bash \"+ SAGE_LOCAL + \"/bin/lie\",\n        global command = undefined\n        global SAGE_LOCAL = None\n    335 \n    336                         server=server,\n    337                         script_subdirectory = script_subdirectory,\n    338 \n\nTypeError: can only concatenate str (not \"NoneType\") to str\n```",
    "created_at": "2021-06-23T21:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485080",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:12'></a>Next issue:

```
/usr/lib/python3.9/site-packages/sage/interfaces/gap_workspace.py in gap_workspace_file(system='gap', name='workspace', dir='/home/antonio/.sage/gap')
     [...]
     57         sage: assert name1 == name2
     58     """
     59     if dir is None:
     60         dir = os.path.join(DOT_SAGE, 'gap')
     61 
---> 62     h = hashlib.sha1(SAGE_LOCAL.encode('utf-8')).hexdigest()
        h = undefined
        global hashlib.sha1 = <built-in function openssl_sha1>
        global SAGE_LOCAL.encode.hexdigest = undefined
     63     return os.path.join(dir, '%s-%s-%s' % (system, name, h))
     64 
     65 
AttributeError: 'NoneType' object has no attribute 'encode'
```
and, after bypassing it

```
/usr/lib/python3.9/site-packages/sage/interfaces/lie.py in __init__(self=LiE Interpreter, maxread=None, script_subdirectory=None, logfile=None, server=None)
    [...]
    329                         # it to be very obfuscated that would be better.   Even
    330                         # better is to use sequence numbers.
    331                         prompt = '> ',
    332 
    333                         # This is the command that starts up your program
--> 334                         command = "bash "+ SAGE_LOCAL + "/bin/lie",
        global command = undefined
        global SAGE_LOCAL = None
    335 
    336                         server=server,
    337                         script_subdirectory = script_subdirectory,
    338 

TypeError: can only concatenate str (not "NoneType") to str
```



---

archive/issue_comments_485081.json:
```json
{
    "body": "<a id='comment:13'></a>Excluding `env.py` for a minute those are the instances of `SAGE_LOCAL` still existing under in the sagelib tree from a simple grep command\n\n```\nsrc/sage/all.py:from sage.env import SAGE_ROOT, SAGE_SRC, SAGE_DOC_SRC, SAGE_LOCAL, DOT_SAGE, SAGE_ENV\nsrc/sage/all.py:        sage: started_file = os.path.join(SAGE_LOCAL, 'etc', 'sage-started.txt')\nsrc/sage/all.py:    started_file = os.path.join(SAGE_LOCAL, 'etc', 'sage-started.txt')\nsrc/sage/calculus/desolvers.py:                          os.path.join('$SAGE_LOCAL','lib','libTIDES.a') + ' $LDFLAGS '\nsrc/sage/calculus/desolvers.py:                          + os.path.join('-L$SAGE_LOCAL','lib ') +' -lm  -O2 ' +\nsrc/sage/calculus/desolvers.py:                          os.path.join('-I$SAGE_LOCAL','include '),\nsrc/sage/calculus/desolvers.py:                          os.path.join('$SAGE_LOCAL','lib','libTIDES.a') + ' $LDFLAGS '\nsrc/sage/calculus/desolvers.py:                          + os.path.join('-L$SAGE_LOCAL','lib ') + '-lmpfr -lgmp -lm  -O2 -w ' +\nsrc/sage/calculus/desolvers.py:                          os.path.join('-I$SAGE_LOCAL','include ') ,\nsrc/sage/doctest/control.py:        # only have the SAGE_LOCAL install tree but not SAGE_ROOT\nsrc/sage/doctest/control.py:            # only have the SAGE_LOCAL install tree but not SAGE_ROOT\nsrc/sage/interfaces/qepcad.py:    sage: with open(os.path.join(SAGE_LOCAL, 'default.qepcadrc')) as f:  # optional - qepcad\nsrc/sage/interfaces/qepcad.py:from sage.env import SAGE_LOCAL\nsrc/sage/interfaces/qepcad.py:        sage: s == 'env qe=%s qepcad '%SAGE_LOCAL\nsrc/sage/interfaces/qepcad.py:        sage: s == 'env qe=%s qepcad +N8000000'%SAGE_LOCAL\nsrc/sage/interfaces/qepcad.py:    return \"env qe=%s qepcad %s\"%(SAGE_LOCAL, memcells_arg)\nsrc/sage/interfaces/qepcad.py:    with open(os.path.join(SAGE_LOCAL, 'bin', 'qepcad.help')) as help:\nsrc/sage/interfaces/giac.py:    $SAGE_LOCAL/share/giac/doc/en/cascmd_local/index.html\nsrc/sage/interfaces/giac.py:If you got giac from the spkg then ``$PREFIX`` is ``$SAGE_LOCAL``\nsrc/sage/interfaces/gap_workspace.py:from sage.env import DOT_SAGE, SAGE_LOCAL\nsrc/sage/interfaces/gap_workspace.py:    h = hashlib.sha1(SAGE_LOCAL.encode('utf-8')).hexdigest()\nsrc/sage/interfaces/lie.py:from sage.env import DOT_SAGE, SAGE_LOCAL\nsrc/sage/interfaces/lie.py:                        command = \"bash \"+ SAGE_LOCAL + \"/bin/lie\",\nsrc/sage/interfaces/lie.py:            filename = SAGE_LOCAL + \"/lib/LiE/\" + f\nsrc/sage/interfaces/lie.py:    f = open(os.path.join(SAGE_LOCAL, 'lib', 'LiE', 'INFO.0'))\nsrc/sage/interfaces/maxima.py:from sage.env import DOT_SAGE, SAGE_LOCAL, MAXIMA\nsrc/sage/interfaces/mathematica.py:##            it in <SAGE_LOCAL>/bin/ is an easy way to ensure this).\nsrc/sage/libs/gap/util.pyx:    SAGE_LOCAL = sage.env.SAGE_LOCAL\nsrc/sage/libs/gap/util.pyx:    with open(os.path.join(SAGE_LOCAL, 'bin', 'gap')) as f:\nsrc/sage/libs/gap/util.pyx:    gapdir = gapdir.replace('$SAGE_LOCAL', SAGE_LOCAL)\nsrc/sage/libs/giac/giac.pyx:      - or in :doc:`$SAGE_LOCAL/share/giac/doc/en/cascmd_en/index.html`\nsrc/sage/misc/sage_ostools.pyx:        sage: have_program('there_is_not_a_program_with_this_name', os.path.join(SAGE_LOCAL, 'bin'))\nsrc/sage/misc/citation.pyx:from sage.env import SAGE_LOCAL\nsrc/sage/misc/citation.pyx:    strings = [a[0].replace(SAGE_LOCAL, \"\") + \" \" + a[2]\nsrc/sage/misc/cython.py:from sage.env import (SAGE_LOCAL, cython_aliases,\nsrc/sage/misc/cython.py:    standard_libdirs = [os.path.join(SAGE_LOCAL, \"lib\")] + aliases[\"CBLAS_LIBDIR\"] + aliases[\"NTL_LIBDIR\"]\nsrc/sage/misc/compat.py:from sage.env import SAGE_LOCAL\nsrc/sage/misc/compat.py:        for libdir in [os.path.join(SAGE_LOCAL, 'lib'),\nsrc/sage/misc/compat.py:        sage_local_lib = os.path.join(SAGE_LOCAL, 'lib')\nsrc/sage/misc/compat.py:    lib_dirs = (LDPATH_STR.split(':') if LDPATH_STR else []) + [os.path.join(SAGE_LOCAL, 'lib')]\nsrc/sage/misc/edit_module.py:    'SAGE_LOCAL/lib/python.../site-packages', it replaces this by\nsrc/sage/misc/dist.py:    from sage.env import SAGE_LOCAL\nsrc/sage/misc/dist.py:    SAGE_BIN = os.path.join(SAGE_LOCAL, 'bin')\nsrc/sage/misc/dist.py:    # SAGE_LOCAL/bin from PATH so that we can later check whether\nsrc/sage/plot/plot3d/base.pyx:from sage.env import SAGE_LOCAL\nsrc/sage/repl/interpreter.py:``$SAGE_LOCAL/bin/sage-ipython`` script to start the Sage\nsrc/sage/sandpiles/sandpile.py:from sage.env import SAGE_LOCAL\nsrc/sage/sandpiles/sandpile.py:path_to_zsolve = os.path.join(SAGE_LOCAL, 'bin', 'zsolve')\n```\n\n* `sage-started` could be eliminated without regrets (personal opinion). \n* The stuff in `calculus/desolvers.py` should be carefully reviewed - can we still use that stuff and if yes, how? \n* `qepcad.py` is long time serial offender. \n* `gap_workspace.py` needs to be looked at. \n* `lie.py` probably should have specific variable, distro may put the stuff somewhere else (Gentoo does). \n* `SAGE_LOCAL` is imported in `maxima.py` and `plot/plot3d/base.pyx` but appear to be unused - expunge. \n* `libs/gap/util.pyx` would need to be reworked. \n* `cython.py` need to be looked at.\n* What is happening with `SAGE_LOCAL` in `misc/compat.py`.\n* `citations.pyx` seem to rely on it.\n* `sandpiles/sandpile.py` features should be used.",
    "created_at": "2021-06-23T21:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485081",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>Excluding `env.py` for a minute those are the instances of `SAGE_LOCAL` still existing under in the sagelib tree from a simple grep command

```
src/sage/all.py:from sage.env import SAGE_ROOT, SAGE_SRC, SAGE_DOC_SRC, SAGE_LOCAL, DOT_SAGE, SAGE_ENV
src/sage/all.py:        sage: started_file = os.path.join(SAGE_LOCAL, 'etc', 'sage-started.txt')
src/sage/all.py:    started_file = os.path.join(SAGE_LOCAL, 'etc', 'sage-started.txt')
src/sage/calculus/desolvers.py:                          os.path.join('$SAGE_LOCAL','lib','libTIDES.a') + ' $LDFLAGS '
src/sage/calculus/desolvers.py:                          + os.path.join('-L$SAGE_LOCAL','lib ') +' -lm  -O2 ' +
src/sage/calculus/desolvers.py:                          os.path.join('-I$SAGE_LOCAL','include '),
src/sage/calculus/desolvers.py:                          os.path.join('$SAGE_LOCAL','lib','libTIDES.a') + ' $LDFLAGS '
src/sage/calculus/desolvers.py:                          + os.path.join('-L$SAGE_LOCAL','lib ') + '-lmpfr -lgmp -lm  -O2 -w ' +
src/sage/calculus/desolvers.py:                          os.path.join('-I$SAGE_LOCAL','include ') ,
src/sage/doctest/control.py:        # only have the SAGE_LOCAL install tree but not SAGE_ROOT
src/sage/doctest/control.py:            # only have the SAGE_LOCAL install tree but not SAGE_ROOT
src/sage/interfaces/qepcad.py:    sage: with open(os.path.join(SAGE_LOCAL, 'default.qepcadrc')) as f:  # optional - qepcad
src/sage/interfaces/qepcad.py:from sage.env import SAGE_LOCAL
src/sage/interfaces/qepcad.py:        sage: s == 'env qe=%s qepcad '%SAGE_LOCAL
src/sage/interfaces/qepcad.py:        sage: s == 'env qe=%s qepcad +N8000000'%SAGE_LOCAL
src/sage/interfaces/qepcad.py:    return "env qe=%s qepcad %s"%(SAGE_LOCAL, memcells_arg)
src/sage/interfaces/qepcad.py:    with open(os.path.join(SAGE_LOCAL, 'bin', 'qepcad.help')) as help:
src/sage/interfaces/giac.py:    $SAGE_LOCAL/share/giac/doc/en/cascmd_local/index.html
src/sage/interfaces/giac.py:If you got giac from the spkg then ``$PREFIX`` is ``$SAGE_LOCAL``
src/sage/interfaces/gap_workspace.py:from sage.env import DOT_SAGE, SAGE_LOCAL
src/sage/interfaces/gap_workspace.py:    h = hashlib.sha1(SAGE_LOCAL.encode('utf-8')).hexdigest()
src/sage/interfaces/lie.py:from sage.env import DOT_SAGE, SAGE_LOCAL
src/sage/interfaces/lie.py:                        command = "bash "+ SAGE_LOCAL + "/bin/lie",
src/sage/interfaces/lie.py:            filename = SAGE_LOCAL + "/lib/LiE/" + f
src/sage/interfaces/lie.py:    f = open(os.path.join(SAGE_LOCAL, 'lib', 'LiE', 'INFO.0'))
src/sage/interfaces/maxima.py:from sage.env import DOT_SAGE, SAGE_LOCAL, MAXIMA
src/sage/interfaces/mathematica.py:##            it in <SAGE_LOCAL>/bin/ is an easy way to ensure this).
src/sage/libs/gap/util.pyx:    SAGE_LOCAL = sage.env.SAGE_LOCAL
src/sage/libs/gap/util.pyx:    with open(os.path.join(SAGE_LOCAL, 'bin', 'gap')) as f:
src/sage/libs/gap/util.pyx:    gapdir = gapdir.replace('$SAGE_LOCAL', SAGE_LOCAL)
src/sage/libs/giac/giac.pyx:      - or in :doc:`$SAGE_LOCAL/share/giac/doc/en/cascmd_en/index.html`
src/sage/misc/sage_ostools.pyx:        sage: have_program('there_is_not_a_program_with_this_name', os.path.join(SAGE_LOCAL, 'bin'))
src/sage/misc/citation.pyx:from sage.env import SAGE_LOCAL
src/sage/misc/citation.pyx:    strings = [a[0].replace(SAGE_LOCAL, "") + " " + a[2]
src/sage/misc/cython.py:from sage.env import (SAGE_LOCAL, cython_aliases,
src/sage/misc/cython.py:    standard_libdirs = [os.path.join(SAGE_LOCAL, "lib")] + aliases["CBLAS_LIBDIR"] + aliases["NTL_LIBDIR"]
src/sage/misc/compat.py:from sage.env import SAGE_LOCAL
src/sage/misc/compat.py:        for libdir in [os.path.join(SAGE_LOCAL, 'lib'),
src/sage/misc/compat.py:        sage_local_lib = os.path.join(SAGE_LOCAL, 'lib')
src/sage/misc/compat.py:    lib_dirs = (LDPATH_STR.split(':') if LDPATH_STR else []) + [os.path.join(SAGE_LOCAL, 'lib')]
src/sage/misc/edit_module.py:    'SAGE_LOCAL/lib/python.../site-packages', it replaces this by
src/sage/misc/dist.py:    from sage.env import SAGE_LOCAL
src/sage/misc/dist.py:    SAGE_BIN = os.path.join(SAGE_LOCAL, 'bin')
src/sage/misc/dist.py:    # SAGE_LOCAL/bin from PATH so that we can later check whether
src/sage/plot/plot3d/base.pyx:from sage.env import SAGE_LOCAL
src/sage/repl/interpreter.py:``$SAGE_LOCAL/bin/sage-ipython`` script to start the Sage
src/sage/sandpiles/sandpile.py:from sage.env import SAGE_LOCAL
src/sage/sandpiles/sandpile.py:path_to_zsolve = os.path.join(SAGE_LOCAL, 'bin', 'zsolve')
```

* `sage-started` could be eliminated without regrets (personal opinion). 
* The stuff in `calculus/desolvers.py` should be carefully reviewed - can we still use that stuff and if yes, how? 
* `qepcad.py` is long time serial offender. 
* `gap_workspace.py` needs to be looked at. 
* `lie.py` probably should have specific variable, distro may put the stuff somewhere else (Gentoo does). 
* `SAGE_LOCAL` is imported in `maxima.py` and `plot/plot3d/base.pyx` but appear to be unused - expunge. 
* `libs/gap/util.pyx` would need to be reworked. 
* `cython.py` need to be looked at.
* What is happening with `SAGE_LOCAL` in `misc/compat.py`.
* `citations.pyx` seem to rely on it.
* `sandpiles/sandpile.py` features should be used.



---

archive/issue_comments_485082.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T21:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485082",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485083.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T21:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485084.json:
```json
{
    "body": "<a id='comment:16'></a>Perhaps someone who knows more about GAP workspaces can comment whether this change makes sense.",
    "created_at": "2021-06-23T21:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485084",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Perhaps someone who knows more about GAP workspaces can comment whether this change makes sense.



---

archive/issue_comments_485085.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T21:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485085",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485086.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:13 fbissey]:\n>  * `lie.py` probably should have specific variable, distro may put the stuff somewhere else (Gentoo does). \n\n\nI agree.\n\nCould someone on such a distro take care of lie.py please?\n\nThere's no package for homebrew and our SPKG does not compile",
    "created_at": "2021-06-23T22:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485086",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Replying to [comment:13 fbissey]:
>  * `lie.py` probably should have specific variable, distro may put the stuff somewhere else (Gentoo does). 


I agree.

Could someone on such a distro take care of lie.py please?

There's no package for homebrew and our SPKG does not compile



---

archive/issue_comments_485087.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T22:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485087",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485088.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 mkoeppe]:\n> Replying to [comment:13 fbissey]:\n> >  * `lie.py` probably should have specific variable, distro may put the stuff somewhere else (Gentoo does). \n \n> \n> I agree.\n> \n> Could someone on such a distro take care of lie.py please?\n> \n\n\nI will.",
    "created_at": "2021-06-23T22:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485088",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>Replying to [comment:18 mkoeppe]:
> Replying to [comment:13 fbissey]:
> >  * `lie.py` probably should have specific variable, distro may put the stuff somewhere else (Gentoo does). 
 
> 
> I agree.
> 
> Could someone on such a distro take care of lie.py please?
> 


I will.



---

archive/issue_comments_485089.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T22:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485090.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T22:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485091.json:
```json
{
    "body": "<a id='comment:23'></a>I am a bit confused by what `dist.py` does. If it is doing an installation task, should it live in `sage_setup`?",
    "created_at": "2021-06-23T22:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485091",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>I am a bit confused by what `dist.py` does. If it is doing an installation task, should it live in `sage_setup`?



---

archive/issue_comments_485092.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T22:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485093.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:23 fbissey]:\n> I am a bit confused by what `dist.py` does. If it is doing an installation task, should it live in `sage_setup`?\n\n\nIt's an optional installation step, which hopefully can be removed at some point (#30207)",
    "created_at": "2021-06-23T22:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485093",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Replying to [comment:23 fbissey]:
> I am a bit confused by what `dist.py` does. If it is doing an installation task, should it live in `sage_setup`?


It's an optional installation step, which hopefully can be removed at some point (#30207)



---

archive/issue_comments_485094.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:13 fbissey]:\n>  * `sage-started` could be eliminated without regrets (personal opinion). \n\n\nI'll remove it (a previous discussion in #26116 also indicated that there is no need for it any more).",
    "created_at": "2021-06-23T22:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485094",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Replying to [comment:13 fbissey]:
>  * `sage-started` could be eliminated without regrets (personal opinion). 


I'll remove it (a previous discussion in #26116 also indicated that there is no need for it any more).



---

archive/issue_comments_485095.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T22:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485095",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485096.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T23:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485097.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:13 fbissey]:\n>  * The stuff in `calculus/desolvers.py` should be carefully reviewed - can we still use that stuff and if yes, how? \n\n\nNo need to do this on this ticket -- SAGE_LOCAL is only used as an environment variable in a shell command line there, not as a Python variable",
    "created_at": "2021-06-23T23:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485097",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>Replying to [comment:13 fbissey]:
>  * The stuff in `calculus/desolvers.py` should be carefully reviewed - can we still use that stuff and if yes, how? 


No need to do this on this ticket -- SAGE_LOCAL is only used as an environment variable in a shell command line there, not as a Python variable



---

archive/issue_comments_485098.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T23:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485098",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485099.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-23T23:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485099",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485100.json:
```json
{
    "body": "<a id='comment:33'></a>For the remaining items we have separate open tickets listed in #30818",
    "created_at": "2021-06-23T23:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485100",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>For the remaining items we have separate open tickets listed in #30818



---

archive/issue_comments_485101.json:
```json
{
    "body": "<a id='comment:34'></a>Should I still provide a commit for `lie` here or add a new ticket in #30818?",
    "created_at": "2021-06-23T23:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485101",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>Should I still provide a commit for `lie` here or add a new ticket in #30818?



---

archive/issue_comments_485102.json:
```json
{
    "body": "<a id='comment:35'></a>Here is fine, I think",
    "created_at": "2021-06-23T23:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485102",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Here is fine, I think



---

archive/issue_comments_485103.json:
```json
{
    "body": "<a id='comment:36'></a>And here is the LiE stuff. \n\n---\nNew commits:",
    "created_at": "2021-06-24T01:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485103",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>And here is the LiE stuff. 

---
New commits:



---

archive/issue_comments_485104.json:
```json
{
    "body": "<a id='comment:37'></a>\n```\n+LIE_INFO_DIR = var(\"LIE_INFO_DIR\", join(SAGE_LOCAL, \"lib\". \"LiE\"))\n```\ntypo - there should be a comma",
    "created_at": "2021-06-24T01:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485104",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
```
+LIE_INFO_DIR = var("LIE_INFO_DIR", join(SAGE_LOCAL, "lib". "LiE"))
```
typo - there should be a comma



---

archive/issue_comments_485105.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T01:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485106.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:37 mkoeppe]:\n> {{{\n> +LIE_INFO_DIR = var(\"LIE_INFO_DIR\", join(SAGE_LOCAL, \"lib\". \"LiE\"))\n> }}}\n> typo - there should be a comma\n\n\nThanks. I will add that all this work will actually further reduce some patching currently occurring in sage-on-gentoo. Which is a good thing^(TM).",
    "created_at": "2021-06-24T01:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485106",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>Replying to [comment:37 mkoeppe]:
> {{{
> +LIE_INFO_DIR = var("LIE_INFO_DIR", join(SAGE_LOCAL, "lib". "LiE"))
> }}}
> typo - there should be a comma


Thanks. I will add that all this work will actually further reduce some patching currently occurring in sage-on-gentoo. Which is a good thing^(TM).



---

archive/issue_comments_485107.json:
```json
{
    "body": "<a id='comment:40'></a>Still crashing at startup with the current branch, this should probably depend on #30819\n\n```\n/usr/lib/python3.9/site-packages/sage/databases/conway.py in <module>\n     21 \n     22 from sage.env import CONWAY_POLYNOMIALS_DATA_DIR\n     23 \n---> 24 _CONWAYDATA = os.path.join(CONWAY_POLYNOMIALS_DATA_DIR, 'conway_polynomials.p')\n        global _CONWAYDATA = undefined\n        global os.path.join = <function join at 0x7fa811ace8b0>\n        global CONWAY_POLYNOMIALS_DATA_DIR = None\n     25 _conwaydict = None\n     26 \n     27 class DictInMapping(Mapping):\n\n/usr/lib/python3.9/posixpath.py in join(a=None, *p=('conway_polynomials.p',))\n     73     If any component is an absolute path, all previous path components\n     74     will be discarded.  An empty last part will result in a path that\n     75     ends with a separator.\"\"\"\n---> 76     a = os.fspath(a)\n        a = None\n        global os.fspath = <built-in function fspath>\n     77     sep = _get_sep(a)\n     78     path = a\n     79     try:\n\nTypeError: expected str, bytes or os.PathLike object, not NoneType\n```",
    "created_at": "2021-06-24T06:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485107",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:40'></a>Still crashing at startup with the current branch, this should probably depend on #30819

```
/usr/lib/python3.9/site-packages/sage/databases/conway.py in <module>
     21 
     22 from sage.env import CONWAY_POLYNOMIALS_DATA_DIR
     23 
---> 24 _CONWAYDATA = os.path.join(CONWAY_POLYNOMIALS_DATA_DIR, 'conway_polynomials.p')
        global _CONWAYDATA = undefined
        global os.path.join = <function join at 0x7fa811ace8b0>
        global CONWAY_POLYNOMIALS_DATA_DIR = None
     25 _conwaydict = None
     26 
     27 class DictInMapping(Mapping):

/usr/lib/python3.9/posixpath.py in join(a=None, *p=('conway_polynomials.p',))
     73     If any component is an absolute path, all previous path components
     74     will be discarded.  An empty last part will result in a path that
     75     ends with a separator."""
---> 76     a = os.fspath(a)
        a = None
        global os.fspath = <built-in function fspath>
     77     sep = _get_sep(a)
     78     path = a
     79     try:

TypeError: expected str, bytes or os.PathLike object, not NoneType
```



---

archive/issue_comments_485108.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:36 fbissey]:\n> And here is the LiE stuff. \n\n\n`LIE_INFO_DIR = var(\"LIE_INFO_DIR\", join(SAGE_LOCAL, \"lib\", \"LiE\"))`\n\nThis will still break if neither SAGE_LOCAL nor LIE_INFO_DIR are set. Shouldn't it use features too? (or, at the very least, provide a fallback based on `sysconfig.get_config_var('LIBDIR')`)",
    "created_at": "2021-06-24T06:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485108",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:41'></a>Replying to [comment:36 fbissey]:
> And here is the LiE stuff. 


`LIE_INFO_DIR = var("LIE_INFO_DIR", join(SAGE_LOCAL, "lib", "LiE"))`

This will still break if neither SAGE_LOCAL nor LIE_INFO_DIR are set. Shouldn't it use features too? (or, at the very least, provide a fallback based on `sysconfig.get_config_var('LIBDIR')`)



---

archive/issue_comments_485109.json:
```json
{
    "body": "<a id='comment:42'></a>`CONWAY_POLYNOMIALS_DATA_DIR` can just be set to the correct location in `sage_conf`",
    "created_at": "2021-06-24T06:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485109",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>`CONWAY_POLYNOMIALS_DATA_DIR` can just be set to the correct location in `sage_conf`



---

archive/issue_comments_485110.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:41 arojas]:\n> Replying to [comment:36 fbissey]:\n> > And here is the LiE stuff. \n\n> \n> `LIE_INFO_DIR = var(\"LIE_INFO_DIR\", join(SAGE_LOCAL, \"lib\", \"LiE\"))`\n> \n> This will still break if neither SAGE_LOCAL nor LIE_INFO_DIR are set. Shouldn't it use features too? (or, at the very least, provide a fallback based on `sysconfig.get_config_var('LIBDIR')`)\n\n\nLiE is an optional package. So, it won't break unless you try to use it. Upstream is actually not installing stuff properly, we shouldn't be looking up info files under `lib` of any kind.\n\nUsing feature is certainly possible and it should start with detecting the executable. The rest is to consult the doc from inside sage and it really should be at the distribution's discretion because it is arbitrary and not something the program itself knows anything about.",
    "created_at": "2021-06-24T08:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485110",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>Replying to [comment:41 arojas]:
> Replying to [comment:36 fbissey]:
> > And here is the LiE stuff. 

> 
> `LIE_INFO_DIR = var("LIE_INFO_DIR", join(SAGE_LOCAL, "lib", "LiE"))`
> 
> This will still break if neither SAGE_LOCAL nor LIE_INFO_DIR are set. Shouldn't it use features too? (or, at the very least, provide a fallback based on `sysconfig.get_config_var('LIBDIR')`)


LiE is an optional package. So, it won't break unless you try to use it. Upstream is actually not installing stuff properly, we shouldn't be looking up info files under `lib` of any kind.

Using feature is certainly possible and it should start with detecting the executable. The rest is to consult the doc from inside sage and it really should be at the distribution's discretion because it is arbitrary and not something the program itself knows anything about.



---

archive/issue_comments_485111.json:
```json
{
    "body": "<a id='comment:44'></a>I have opened #32055 for the task of adding an `spkg-configure.m4` for `lie`. I don't think a fallback is needed",
    "created_at": "2021-06-24T15:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485111",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>I have opened #32055 for the task of adding an `spkg-configure.m4` for `lie`. I don't think a fallback is needed



---

archive/issue_comments_485112.json:
```json
{
    "body": "<a id='comment:45'></a>I'll add a feature `DatabaseConwayPolynomials`",
    "created_at": "2021-06-24T15:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485112",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>I'll add a feature `DatabaseConwayPolynomials`



---

archive/issue_comments_485113.json:
```json
{
    "body": "<a id='comment:46'></a>I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?",
    "created_at": "2021-06-24T15:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485113",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:46'></a>I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?



---

archive/issue_comments_485114.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:42 mkoeppe]:\n> `CONWAY_POLYNOMIALS_DATA_DIR` can just be set to the correct location in `sage_conf`\n\n\nI think I'm missing something here, when was `sage_conf` made mandatory even for distro installs? The description says \"This default is no longer necessary because sage_conf is now a requirement\" but to me it looks the other way around: `sage_conf` is required because this ticket purposely breaks setups without it.",
    "created_at": "2021-06-24T15:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485114",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:48'></a>Replying to [comment:42 mkoeppe]:
> `CONWAY_POLYNOMIALS_DATA_DIR` can just be set to the correct location in `sage_conf`


I think I'm missing something here, when was `sage_conf` made mandatory even for distro installs? The description says "This default is no longer necessary because sage_conf is now a requirement" but to me it looks the other way around: `sage_conf` is required because this ticket purposely breaks setups without it.



---

archive/issue_comments_485115.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:47 mkoeppe]:\n\nSorry, I think my comment reverted your branch change",
    "created_at": "2021-06-24T15:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485115",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:49'></a>Replying to [comment:47 mkoeppe]:

Sorry, I think my comment reverted your branch change



---

archive/issue_comments_485116.json:
```json
{
    "body": "<a id='comment:50'></a>Last 10 new commits:",
    "created_at": "2021-06-24T17:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485116",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>Last 10 new commits:



---

archive/issue_comments_485117.json:
```json
{
    "body": "<a id='comment:51'></a>Replying to [comment:46 dimpase]:\n> I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?\n\n\nNo idea, I got this information from https://repology.org/project/lie/versions",
    "created_at": "2021-06-24T17:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485117",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>Replying to [comment:46 dimpase]:
> I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?


No idea, I got this information from https://repology.org/project/lie/versions



---

archive/issue_comments_485118.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:45 mkoeppe]:\n> I'll add a feature `DatabaseConwayPolynomials`\n\n\nThanks. Unfortunately this doesn't help since the search patch is still defined in terms of `CONWAY_POLYNOMIALS_DATA_DIR` without a fallback.\n\nI'm really strugging to understand the purpose of this change. Currently we have a long list of sane defaults in `env.py` which made everything work nicely out of the box. After this, if I understand correctly, are we expected to maintain a per-distro list of environment variables which essentially duplicates the list in `env.py`? This seems a big regression to me.",
    "created_at": "2021-06-24T19:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485118",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:52'></a>Replying to [comment:45 mkoeppe]:
> I'll add a feature `DatabaseConwayPolynomials`


Thanks. Unfortunately this doesn't help since the search patch is still defined in terms of `CONWAY_POLYNOMIALS_DATA_DIR` without a fallback.

I'm really strugging to understand the purpose of this change. Currently we have a long list of sane defaults in `env.py` which made everything work nicely out of the box. After this, if I understand correctly, are we expected to maintain a per-distro list of environment variables which essentially duplicates the list in `env.py`? This seems a big regression to me.



---

archive/issue_comments_485119.json:
```json
{
    "body": "<a id='comment:53'></a>Do you set `SAGE_LOCAL` in your distribution packaging?",
    "created_at": "2021-06-24T19:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485119",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>Do you set `SAGE_LOCAL` in your distribution packaging?



---

archive/issue_comments_485120.json:
```json
{
    "body": "<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T19:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485121.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:53 mkoeppe]:\n> Do you set `SAGE_LOCAL` in your distribution packaging?\n\n\nNo, I don't set any env variable at all. Before this change, it was set to `/usr` in `env.py` via `SAGE_LOCAL \u2192 SAGE_ENV \u2192 os.path.abspath(sys.prefix)`, which in turn made all other variables which depend on it point to the correct paths.",
    "created_at": "2021-06-24T20:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485121",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:55'></a>Replying to [comment:53 mkoeppe]:
> Do you set `SAGE_LOCAL` in your distribution packaging?


No, I don't set any env variable at all. Before this change, it was set to `/usr` in `env.py` via `SAGE_LOCAL → SAGE_ENV → os.path.abspath(sys.prefix)`, which in turn made all other variables which depend on it point to the correct paths.



---

archive/issue_comments_485122.json:
```json
{
    "body": "<a id='comment:56'></a>Replying to [comment:51 mkoeppe]:\n> Replying to [comment:46 dimpase]:\n> > I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?\n\n> \n> No idea, I got this information from https://repology.org/project/lie/versions\n\n\nIt is not in the main tree, but it has been in the science overlay for a while. However, if you want one that will definitely work, you'll have to go with my sage-on-gentoo overlay. I updated it yesterday when I found that tarball has changed location.",
    "created_at": "2021-06-24T20:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485122",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:56'></a>Replying to [comment:51 mkoeppe]:
> Replying to [comment:46 dimpase]:
> > I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?

> 
> No idea, I got this information from https://repology.org/project/lie/versions


It is not in the main tree, but it has been in the science overlay for a while. However, if you want one that will definitely work, you'll have to go with my sage-on-gentoo overlay. I updated it yesterday when I found that tarball has changed location.



---

archive/issue_comments_485123.json:
```json
{
    "body": "<a id='comment:57'></a>About `sage_conf`. I will want some small change to make it easier for distro, in a separate ticket of course, but my audience is here for now.\n\nCurrently `sage_conf` is a very customised python package in the sage tree that requires the top configure to be run for the variables to be setup to the proper values. Matthias encourage distro to write their own version of `sage_conf`. After giving it some thoughts, considering the way things works from source in Gentoo, writing a full blown python package that passes QA is too much of a hassle. This is not a place where we can just take a file and just install it in the right place(s) [OK, if you really insist we can abuse the system in such a way]. There are other issue like versioning that would need sorting. I don't want to maintain such a package. \n\nBut I still want to use `sage_conf` as it means that I don't to have patch `env.py` anymore. So, I write a small `sage_conf.py` file with my stuff, I install it alongside `env.py` and I change the import to be from `sage.sage_conf` instead of just `sage_conf`. What I would like to happen is for that option to be available out of the box in sage. Try `sage_conf` first and if it isn't present, try `sage.sage_conf`. The file is maintained alongside sage which means I don't have to worry about versioning amongst other things.",
    "created_at": "2021-06-24T20:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485123",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:57'></a>About `sage_conf`. I will want some small change to make it easier for distro, in a separate ticket of course, but my audience is here for now.

Currently `sage_conf` is a very customised python package in the sage tree that requires the top configure to be run for the variables to be setup to the proper values. Matthias encourage distro to write their own version of `sage_conf`. After giving it some thoughts, considering the way things works from source in Gentoo, writing a full blown python package that passes QA is too much of a hassle. This is not a place where we can just take a file and just install it in the right place(s) [OK, if you really insist we can abuse the system in such a way]. There are other issue like versioning that would need sorting. I don't want to maintain such a package. 

But I still want to use `sage_conf` as it means that I don't to have patch `env.py` anymore. So, I write a small `sage_conf.py` file with my stuff, I install it alongside `env.py` and I change the import to be from `sage.sage_conf` instead of just `sage_conf`. What I would like to happen is for that option to be available out of the box in sage. Try `sage_conf` first and if it isn't present, try `sage.sage_conf`. The file is maintained alongside sage which means I don't have to worry about versioning amongst other things.



---

archive/issue_comments_485124.json:
```json
{
    "body": "<a id='comment:58'></a>Replying to [comment:57 fbissey]:\n> I change the import to be from `sage.sage_conf` instead of just `sage_conf`. What I would like to happen is for that option to be available out of the box in sage. Try `sage_conf` first and if it isn't present, try `sage.sage_conf`.\n\n\nThat's terrible because then people who want to install the Sage library from source will not be able to use your distribution's `sage_conf`.",
    "created_at": "2021-06-24T21:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485124",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>Replying to [comment:57 fbissey]:
> I change the import to be from `sage.sage_conf` instead of just `sage_conf`. What I would like to happen is for that option to be available out of the box in sage. Try `sage_conf` first and if it isn't present, try `sage.sage_conf`.


That's terrible because then people who want to install the Sage library from source will not be able to use your distribution's `sage_conf`.



---

archive/issue_comments_485125.json:
```json
{
    "body": "<a id='comment:59'></a>Replying to [comment:57 fbissey]:\n> Currently `sage_conf` is a very customised python package in the sage tree that requires the top configure to be run for the variables to be setup to the proper values. Matthias encourage distro to write their own version of `sage_conf`. After giving it some thoughts, considering the way things works from source in Gentoo, writing a full blown python package that passes QA is too much of a hassle. \n\n\nThen just pass it off as a patched version of the upstream sage_conf package.",
    "created_at": "2021-06-24T21:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485125",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>Replying to [comment:57 fbissey]:
> Currently `sage_conf` is a very customised python package in the sage tree that requires the top configure to be run for the variables to be setup to the proper values. Matthias encourage distro to write their own version of `sage_conf`. After giving it some thoughts, considering the way things works from source in Gentoo, writing a full blown python package that passes QA is too much of a hassle. 


Then just pass it off as a patched version of the upstream sage_conf package.



---

archive/issue_comments_485126.json:
```json
{
    "body": "<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-06-24T21:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_485127.json:
```json
{
    "body": "<a id='comment:61'></a>I have removed the initial commit, so the fallback is back. The other changes made here have independent value, so let's get them in.",
    "created_at": "2021-06-24T21:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'></a>I have removed the initial commit, so the fallback is back. The other changes made here have independent value, so let's get them in.



---

archive/issue_comments_485128.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n (from #31338#comment:13)\n \n-This default is no longer necessary because `sage_conf` is now a requirement; and should be removed.\n+These changes are preparation for modularization and is also intended  to make downstream packaging easier.\n+\n+\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2021-06-24T21:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485128",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
 (from #31338#comment:13)
 
-This default is no longer necessary because `sage_conf` is now a requirement; and should be removed.
+These changes are preparation for modularization and is also intended  to make downstream packaging easier.
+
+
+
 
 Comment: 1
 
``````




---

archive/issue_comments_485129.json:
```json
{
    "body": "<a id='comment:63'></a>I honestly don't think they should use my distro's `sage_conf`. At least not in the current state. But it is an interesting prospect.\n\nIn the current state, I certainly don't want to use a patched version of your stuff. It has to become a proper pypi package first. Passing it off would be the same as writing one myself. I decided that I should draw some lines in the sand as to what I should do. I decided I should say \"no\" more often because I have already too much stuff to do, and in the current state that would clearly go there.\n\n---\nLast 10 new commits:",
    "created_at": "2021-06-24T21:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485129",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:63'></a>I honestly don't think they should use my distro's `sage_conf`. At least not in the current state. But it is an interesting prospect.

In the current state, I certainly don't want to use a patched version of your stuff. It has to become a proper pypi package first. Passing it off would be the same as writing one myself. I decided that I should draw some lines in the sand as to what I should do. I decided I should say "no" more often because I have already too much stuff to do, and in the current state that would clearly go there.

---
Last 10 new commits:



---

archive/issue_comments_485130.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+(from #31338#comment:13)\n+\n+This default is no longer necessary because `sage_conf` is now a requirement; and should be removed.\n+\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-06-24T21:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485130",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
+(from #31338#comment:13)
+
+This default is no longer necessary because `sage_conf` is now a requirement; and should be removed.
+
+
 
 
 Comment: 1
``````




---

archive/issue_comments_485131.json:
```json
{
    "body": "<a id='comment:64'></a>Restoring your changes.",
    "created_at": "2021-06-24T21:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485131",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:64'></a>Restoring your changes.



---

archive/issue_comments_485132.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+(from #31338#comment:13)\n+\n+These changes are preparation for modularization and is also intended  to make downstream packaging easier.\n+\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2021-06-24T21:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485132",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
+(from #31338#comment:13)
+
+These changes are preparation for modularization and is also intended  to make downstream packaging easier.
+
+
 
 
 Comment: 1
``````




---

archive/issue_comments_485133.json:
```json
{
    "body": "<a id='comment:66'></a>I am otherwise quite happy with the state of the ticket. I would have prefered the initial commit to stay in but we can do that later.",
    "created_at": "2021-06-24T21:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485133",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:66'></a>I am otherwise quite happy with the state of the ticket. I would have prefered the initial commit to stay in but we can do that later.



---

archive/issue_comments_485134.json:
```json
{
    "body": "<a id='comment:68'></a>Replying to [comment:56 fbissey]:\n> Replying to [comment:51 mkoeppe]:\n> > Replying to [comment:46 dimpase]:\n> > > I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?\n\n> > \n> > No idea, I got this information from https://repology.org/project/lie/versions\n\n> \n> It is not in the main tree, but it has been in the science overlay for a while. However, if you want one that will definitely work, you'll have to go with my sage-on-gentoo overlay. I updated it yesterday when I found that tarball has changed location.\n\n\nI was able to install lie on Gentoo by doing\n\n```\nlayman --add science\nemerge --ask lie\n```\nShould we add\n\n```\nemerge --ask app-portage/layman\nlayman --add science\n```\nto whatever the current place for these per-system advice is (it was moved around...)",
    "created_at": "2021-06-25T09:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485134",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:68'></a>Replying to [comment:56 fbissey]:
> Replying to [comment:51 mkoeppe]:
> > Replying to [comment:46 dimpase]:
> > > I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?

> > 
> > No idea, I got this information from https://repology.org/project/lie/versions

> 
> It is not in the main tree, but it has been in the science overlay for a while. However, if you want one that will definitely work, you'll have to go with my sage-on-gentoo overlay. I updated it yesterday when I found that tarball has changed location.


I was able to install lie on Gentoo by doing

```
layman --add science
emerge --ask lie
```
Should we add

```
emerge --ask app-portage/layman
layman --add science
```
to whatever the current place for these per-system advice is (it was moved around...)



---

archive/issue_comments_485135.json:
```json
{
    "body": "<a id='comment:69'></a>Replying to [comment:68 dimpase]:\n> Replying to [comment:56 fbissey]:\n> > Replying to [comment:51 mkoeppe]:\n> > > Replying to [comment:46 dimpase]:\n> > > > I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?\n\n> > > \n> > > No idea, I got this information from https://repology.org/project/lie/versions\n\n> > \n> > It is not in the main tree, but it has been in the science overlay for a while. However, if you want one that will definitely work, you'll have to go with my sage-on-gentoo overlay. I updated it yesterday when I found that tarball has changed location.\n\n> \n> I was able to install lie on Gentoo by doing\n> \n> ```\n> layman --add science\n> emerge --ask lie\n> ```\n> Should we add\n> \n> ```\n> emerge --ask app-portage/layman\n> layman --add science\n> ```\n> to whatever the current place for these per-system advice is (it was moved around...)\n\n\nUsing layman is so outdated - even I moved on (last month :) ). Seriously, it is deprecated.\n\n```\nemerge eselect-repository \neselect repository enable science \nemaint sync -r science \n```\nor `emerge --sync`, all the repos managed that way will get pulled by `emerge --sync` or equivalent like `eix-sync`.",
    "created_at": "2021-06-25T10:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485135",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:69'></a>Replying to [comment:68 dimpase]:
> Replying to [comment:56 fbissey]:
> > Replying to [comment:51 mkoeppe]:
> > > Replying to [comment:46 dimpase]:
> > > > I don't get sci-mathematics/lie on my Gentoo box, is it not yet in Gentoo?

> > > 
> > > No idea, I got this information from https://repology.org/project/lie/versions

> > 
> > It is not in the main tree, but it has been in the science overlay for a while. However, if you want one that will definitely work, you'll have to go with my sage-on-gentoo overlay. I updated it yesterday when I found that tarball has changed location.

> 
> I was able to install lie on Gentoo by doing
> 
> ```
> layman --add science
> emerge --ask lie
> ```
> Should we add
> 
> ```
> emerge --ask app-portage/layman
> layman --add science
> ```
> to whatever the current place for these per-system advice is (it was moved around...)


Using layman is so outdated - even I moved on (last month :) ). Seriously, it is deprecated.

```
emerge eselect-repository 
eselect repository enable science 
emaint sync -r science 
```
or `emerge --sync`, all the repos managed that way will get pulled by `emerge --sync` or equivalent like `eix-sync`.



---

archive/issue_comments_485136.json:
```json
{
    "body": "<a id='comment:70'></a>OK",
    "created_at": "2021-06-25T19:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485136",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:70'></a>OK



---

archive/issue_comments_485137.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-25T19:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485137",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_485138.json:
```json
{
    "body": "<a id='comment:71'></a>Thanks!",
    "created_at": "2021-06-25T19:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485138",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>Thanks!



---

archive/issue_comments_485139.json:
```json
{
    "body": "<a id='comment:72'></a>On OSX:\n\n```\n**********************************************************************\nFile \"src/sage/misc/compat.py\", line 97, in sage.misc.compat\nFailed example:\n    find_library('Singular')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.compat[1]>\", line 1, in <module>\n        find_library('Singular')\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/sage/misc/compat.py\", line 102, in find_library\n        result = _find_library(name)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/sage/misc/compat.py\", line 66, in _find_library\n        os.environ['DYLD_LIBRARY_PATH'] = sage_local_lib\n    NameError: name 'sage_local_lib' is not defined\n**********************************************************************\n```",
    "created_at": "2021-07-06T06:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485139",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:72'></a>On OSX:

```
**********************************************************************
File "src/sage/misc/compat.py", line 97, in sage.misc.compat
Failed example:
    find_library('Singular')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.compat[1]>", line 1, in <module>
        find_library('Singular')
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/sage/misc/compat.py", line 102, in find_library
        result = _find_library(name)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/sage/misc/compat.py", line 66, in _find_library
        os.environ['DYLD_LIBRARY_PATH'] = sage_local_lib
    NameError: name 'sage_local_lib' is not defined
**********************************************************************
```



---

archive/issue_comments_485140.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-06T06:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485140",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_485141.json:
```json
{
    "body": "<a id='comment:74'></a>I see, we forgot to replace `sage_local_lib` which was defined as `os.path.join(SAGE_LOCAL, 'lib')` by expressions based on the new `libdir` in the darwin section. That was a bit careless of me not to notice.",
    "created_at": "2021-07-06T08:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485141",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:74'></a>I see, we forgot to replace `sage_local_lib` which was defined as `os.path.join(SAGE_LOCAL, 'lib')` by expressions based on the new `libdir` in the darwin section. That was a bit careless of me not to notice.



---

archive/issue_comments_485142.json:
```json
{
    "body": "<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T13:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485142",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485143.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-06T13:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485143",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_485144.json:
```json
{
    "body": "<a id='comment:76'></a>Yes, looks like I fell asleep in the middle of rewriting this function.",
    "created_at": "2021-07-06T13:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485144",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'></a>Yes, looks like I fell asleep in the middle of rewriting this function.



---

archive/issue_comments_485145.json:
```json
{
    "body": "<a id='comment:77'></a>Replying to [comment:76 mkoeppe]:\n> Yes, looks like I fell asleep in the middle of rewriting this function.\n\n\nThe new code should do the trick. I must say that when we were working on this originally, it felt like you were in my time zone. So, I guess falling asleep would have been fair.",
    "created_at": "2021-07-06T21:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485145",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:77'></a>Replying to [comment:76 mkoeppe]:
> Yes, looks like I fell asleep in the middle of rewriting this function.


The new code should do the trick. I must say that when we were working on this originally, it felt like you were in my time zone. So, I guess falling asleep would have been fair.



---

archive/issue_comments_485146.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-06T21:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485146",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_485147.json:
```json
{
    "body": "<a id='comment:78'></a>Thanks!",
    "created_at": "2021-07-06T21:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485147",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'></a>Thanks!



---

archive/issue_comments_485148.json:
```json
{
    "body": "<a id='comment:79'></a>I must say, this is not as useful without setting `SAGE_LOCAL` to `None` in distro like Gentoo. I just found out I cannot stop patching `misc/cython.py` to replace `lib` by `lib64` because it otherwise leaks \n\n```\n    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.so when searching for -lm\n    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.a when searching for -lm\n    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libpthread.so when searching for -lpthread\n    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libpthread.a when searching for -lpthread\n    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.so when searching for -lc\n    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.a when searching for -lc\n```\nin a good number of doctests. This wouldn't happen with `SAGE_LOCAL` being `None` when tested in `cython.py`.\n\nAs an aside, I tried to fix it by adding a line `SAGE_LOCAL = None` in `sage_conf`, which seemed to be the obvious fix. But it didn't work, it still reports `SAGE_LOCAL` as `/usr`. What am I doing wrong?",
    "created_at": "2021-07-08T02:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485148",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:79'></a>I must say, this is not as useful without setting `SAGE_LOCAL` to `None` in distro like Gentoo. I just found out I cannot stop patching `misc/cython.py` to replace `lib` by `lib64` because it otherwise leaks 

```
    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.so when searching for -lm
    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.a when searching for -lm
    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libpthread.so when searching for -lpthread
    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libpthread.a when searching for -lpthread
    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.so when searching for -lc
    /usr/lib/gcc/x86_64-pc-linux-gnu/10.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.a when searching for -lc
```
in a good number of doctests. This wouldn't happen with `SAGE_LOCAL` being `None` when tested in `cython.py`.

As an aside, I tried to fix it by adding a line `SAGE_LOCAL = None` in `sage_conf`, which seemed to be the obvious fix. But it didn't work, it still reports `SAGE_LOCAL` as `/usr`. What am I doing wrong?



---

archive/issue_comments_485149.json:
```json
{
    "body": "<a id='comment:80'></a>Didn't we take care of this in #32057?",
    "created_at": "2021-07-08T02:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485149",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'></a>Didn't we take care of this in #32057?



---

archive/issue_comments_485150.json:
```json
{
    "body": "<a id='comment:81'></a>Replying to [comment:80 mkoeppe]:\n> Didn't we take care of this in #32057?\n\n\n#32057 helps with build time but not runtime - as it should, `sage_setup` is for building stuff. I get those as soon as cython.py is called to compile something at runtime. I have had the little patch for it for awhile. But https://git.sagemath.org/sage.git/commit/?id=cd4ccd3adf78e216fbb62bd340238e9c0f25e998 along with https://git.sagemath.org/sage.git/commit?id=95deabddc3d3c32d8f0362cfcf9e08f2e3b28205 made the patch irrelevant. Unfortunately, we reversed the last one for Antonio who still relies on `SAGE_LOCAL` being set.",
    "created_at": "2021-07-08T03:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485150",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:81'></a>Replying to [comment:80 mkoeppe]:
> Didn't we take care of this in #32057?


#32057 helps with build time but not runtime - as it should, `sage_setup` is for building stuff. I get those as soon as cython.py is called to compile something at runtime. I have had the little patch for it for awhile. But https://git.sagemath.org/sage.git/commit/?id=cd4ccd3adf78e216fbb62bd340238e9c0f25e998 along with https://git.sagemath.org/sage.git/commit?id=95deabddc3d3c32d8f0362cfcf9e08f2e3b28205 made the patch irrelevant. Unfortunately, we reversed the last one for Antonio who still relies on `SAGE_LOCAL` being set.



---

archive/issue_comments_485151.json:
```json
{
    "body": "<a id='comment:82'></a>Right, thanks. So, as discussed in #31338#comment:18, we're back to having to solve the same problem as #31578.",
    "created_at": "2021-07-08T04:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485151",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:82'></a>Right, thanks. So, as discussed in #31338#comment:18, we're back to having to solve the same problem as #31578.



---

archive/issue_comments_485152.json:
```json
{
    "body": "<a id='comment:83'></a>That complaint of mine was about build time. We had the runtime issue forever, it is just the opportunity to squash it is gone again :(\n\nBut what I want to know and I'll dig is why setting `SAGE_LOCAL` to `None` is `sage_conf` doesn't work. That would be the ideal fix, while keeping it the way it is for Antonio.",
    "created_at": "2021-07-08T04:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485152",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:83'></a>That complaint of mine was about build time. We had the runtime issue forever, it is just the opportunity to squash it is gone again :(

But what I want to know and I'll dig is why setting `SAGE_LOCAL` to `None` is `sage_conf` doesn't work. That would be the ideal fix, while keeping it the way it is for Antonio.



---

archive/issue_comments_485153.json:
```json
{
    "body": "<a id='comment:84'></a>I think I will just adopt the commit you removed for Antonio. `sage_conf` is not really designed to set a variable to `None`, that cannot work and it is even probably undesirable.",
    "created_at": "2021-07-08T23:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485153",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:84'></a>I think I will just adopt the commit you removed for Antonio. `sage_conf` is not really designed to set a variable to `None`, that cannot work and it is even probably undesirable.



---

archive/issue_comments_485154.json:
```json
{
    "body": "<a id='comment:85'></a>Replying to [comment:84 fbissey]:\n> I think I will just adopt the commit you removed for Antonio. `sage_conf` is not really designed to set a variable to `None`, that cannot work and it is even probably undesirable.\n\n\nInterestingly, adopting it broke docbuilding. So, there is probably more work to do on that subject in a follow up ticket.",
    "created_at": "2021-07-09T01:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485154",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:85'></a>Replying to [comment:84 fbissey]:
> I think I will just adopt the commit you removed for Antonio. `sage_conf` is not really designed to set a variable to `None`, that cannot work and it is even probably undesirable.


Interestingly, adopting it broke docbuilding. So, there is probably more work to do on that subject in a follow up ticket.



---

archive/issue_comments_485155.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-09T20:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32036#issuecomment-485155",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_084778.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-09T20:23:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32036",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32036#event-84778"
}
```
