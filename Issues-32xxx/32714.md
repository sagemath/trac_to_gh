# Issue 32714: WSL: Add how to handle strange permission error

archive/issues_032477.json:
```json
{
    "body": "On WSL you sometimes hit a strange \"Permission denied\" error while building other packages (always during copying of the dist-info file). There are some discussions online (like https://github.com/pypa/packaging-problems/issues/258) and a few workarounds. The only thing that worked for me is no use a folder under the sage directory for building by setting `SAGE_BUILD_DIR`. So I've added this to the documentation in case someone else also encounters this error.\n\nBy the way, is it by design that the other sage packages like sage_conf ignore `SAGE_BUILD_DIR`? Same question for the docbuild.\n\nCC:  @mkoeppe\n\nBranch/Commit: a74251f1289c2f5583a1b2d8034c9b76d8e161d8\n\nReviewer: Matthias Koeppe\n\nAuthor: Tobias Diez\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/32714\n\n",
    "closed_at": "2021-12-19T11:47:38Z",
    "created_at": "2021-10-18T20:39:43Z",
    "labels": [
        "component: documentation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "WSL: Add how to handle strange permission error",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32714",
    "user": "https://github.com/tobiasdiez"
}
```
On WSL you sometimes hit a strange "Permission denied" error while building other packages (always during copying of the dist-info file). There are some discussions online (like https://github.com/pypa/packaging-problems/issues/258) and a few workarounds. The only thing that worked for me is no use a folder under the sage directory for building by setting `SAGE_BUILD_DIR`. So I've added this to the documentation in case someone else also encounters this error.

By the way, is it by design that the other sage packages like sage_conf ignore `SAGE_BUILD_DIR`? Same question for the docbuild.

CC:  @mkoeppe

Branch/Commit: a74251f1289c2f5583a1b2d8034c9b76d8e161d8

Reviewer: Matthias Koeppe

Author: Tobias Diez

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/32714





---

archive/issue_comments_462726.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-18T20:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462726",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462727.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-18T20:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462727",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462728.json:
```json
{
    "body": "<a id='comment:4'></a>It would be more idiomatic to use just `SAGE_BUILD_DIR=\"~/tmp/sage\" make`, not `eval SAGE_BUILD_DIR=\"~/tmp/sage\" make`",
    "created_at": "2021-10-18T20:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462728",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>It would be more idiomatic to use just `SAGE_BUILD_DIR="~/tmp/sage" make`, not `eval SAGE_BUILD_DIR="~/tmp/sage" make`



---

archive/issue_comments_462729.json:
```json
{
    "body": "<a id='comment:5'></a>Is your Sage source tree somewhere in `/mnt/c`?",
    "created_at": "2021-10-18T20:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462729",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Is your Sage source tree somewhere in `/mnt/c`?



---

archive/issue_comments_462730.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 mkoeppe]:\n> It would be more idiomatic to use just `SAGE_BUILD_DIR=\"~/tmp/sage\" make`, not `eval SAGE_BUILD_DIR=\"~/tmp/sage\" make`\n> \n\n\nI think I tried this first and ended up with a `~` folder in the root sage project folder.",
    "created_at": "2021-10-18T23:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462730",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'></a>Replying to [comment:4 mkoeppe]:
> It would be more idiomatic to use just `SAGE_BUILD_DIR="~/tmp/sage" make`, not `eval SAGE_BUILD_DIR="~/tmp/sage" make`
> 


I think I tried this first and ended up with a `~` folder in the root sage project folder.



---

archive/issue_comments_462731.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 mkoeppe]:\n> Is your Sage source tree somewhere in `/mnt/c`?\n\n\nYes, the source files are in the Windows file system (as I want to use git etc from Windows). I know it's not ideal and might switch to the linux file system in the future. But apart from this permission error everything is working.",
    "created_at": "2021-10-18T23:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462731",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:7'></a>Replying to [comment:5 mkoeppe]:
> Is your Sage source tree somewhere in `/mnt/c`?


Yes, the source files are in the Windows file system (as I want to use git etc from Windows). I know it's not ideal and might switch to the linux file system in the future. But apart from this permission error everything is working.



---

archive/issue_comments_462732.json:
```json
{
    "body": "<a id='comment:8'></a>Perhaps then better advice to give to the user would be to use `configure --prefix=/SOME/LINUX/DIRECTORY`? That would solve the problem too and is easier to explain.",
    "created_at": "2021-10-19T04:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462732",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Perhaps then better advice to give to the user would be to use `configure --prefix=/SOME/LINUX/DIRECTORY`? That would solve the problem too and is easier to explain.



---

archive/issue_comments_462733.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-26T13:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462733",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462734.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:8 mkoeppe]:\n> Perhaps then better advice to give to the user would be to use `configure --prefix=/SOME/LINUX/DIRECTORY`? That would solve the problem too and is easier to explain.\n\n\nGood suggestion! I tried it and confirmed it worked as well. Changed the docs accordingly now.\n\nsage-conf etc are still not working, since they seem to respect neither prefix nor build dir. But that's something for another ticket.",
    "created_at": "2021-10-26T13:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462734",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:10'></a>Replying to [comment:8 mkoeppe]:
> Perhaps then better advice to give to the user would be to use `configure --prefix=/SOME/LINUX/DIRECTORY`? That would solve the problem too and is easier to explain.


Good suggestion! I tried it and confirmed it worked as well. Changed the docs accordingly now.

sage-conf etc are still not working, since they seem to respect neither prefix nor build dir. But that's something for another ticket.



---

archive/issue_comments_462735.json:
```json
{
    "body": "<a id='comment:11'></a>`--prefix` is not some kind of temporary directory. It is the installation prefix. See `README.md`",
    "created_at": "2021-10-26T18:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462735",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>`--prefix` is not some kind of temporary directory. It is the installation prefix. See `README.md`



---

archive/issue_comments_462736.json:
```json
{
    "body": "<a id='comment:12'></a>I know, but aren't these build artifacts some kind of semi-temporary files that can \"easily\" be recreated in case they got deleted? I'm not familiar with the linux conventions, what would be a good folder? `/var/tmp`?",
    "created_at": "2021-10-26T20:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462736",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:12'></a>I know, but aren't these build artifacts some kind of semi-temporary files that can "easily" be recreated in case they got deleted? I'm not familiar with the linux conventions, what would be a good folder? `/var/tmp`?



---

archive/issue_comments_462737.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 gh-tobiasdiez]:\n> I know, but aren't these build artifacts some kind of semi-temporary files that can \"easily\" be recreated in case they got deleted?\n\n\nNo. `--prefix` sets the `SAGE_LOCAL` directory. You can delete everything but this directory and have a working Sage.\n\nIts subdirectory, `SAGE_LOCAL/var/tmp/sage/build` is used for temporary files during the build.\n\nWhat I am saying is, we should give users on WSL the advice to create the installation hierarchy (`SAGE_LOCAL`) in a WSL directory, not a /mnt directory.\nThis should be general advice for from source installs in WSL; not troubleshooting advice (\"how to fix a problem\").",
    "created_at": "2021-10-26T20:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462737",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Replying to [comment:12 gh-tobiasdiez]:
> I know, but aren't these build artifacts some kind of semi-temporary files that can "easily" be recreated in case they got deleted?


No. `--prefix` sets the `SAGE_LOCAL` directory. You can delete everything but this directory and have a working Sage.

Its subdirectory, `SAGE_LOCAL/var/tmp/sage/build` is used for temporary files during the build.

What I am saying is, we should give users on WSL the advice to create the installation hierarchy (`SAGE_LOCAL`) in a WSL directory, not a /mnt directory.
This should be general advice for from source installs in WSL; not troubleshooting advice ("how to fix a problem").



---

archive/issue_comments_462738.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 mkoeppe]:\n> Replying to [comment:12 gh-tobiasdiez]:\n> > I know, but aren't these build artifacts some kind of semi-temporary files that can \"easily\" be recreated in case they got deleted?\n\n> \n> No. `--prefix` sets the `SAGE_LOCAL` directory. You can delete everything but this directory and have a working Sage.\n\n\nI understood this, but thought I edited the \"developer\" guide where you would treat this as only as a semi-temporary build output and not as a valid installation that you try to keep. Will change that later.",
    "created_at": "2021-10-26T21:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462738",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:14'></a>Replying to [comment:13 mkoeppe]:
> Replying to [comment:12 gh-tobiasdiez]:
> > I know, but aren't these build artifacts some kind of semi-temporary files that can "easily" be recreated in case they got deleted?

> 
> No. `--prefix` sets the `SAGE_LOCAL` directory. You can delete everything but this directory and have a working Sage.


I understood this, but thought I edited the "developer" guide where you would treat this as only as a semi-temporary build output and not as a valid installation that you try to keep. Will change that later.



---

archive/issue_comments_462739.json:
```json
{
    "body": "<a id='comment:15'></a>Everything is sort of temporary, of course. But in a Unix context, `/tmp` is a directory that one can expect to be emptied at a reboot; and `/var/tmp` is a directory that will be emptied periodically, at the discretion of a system administrator or scripts. Neither of these two fits a typical use case of what a developers does with `--prefix`.",
    "created_at": "2021-10-27T00:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462739",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Everything is sort of temporary, of course. But in a Unix context, `/tmp` is a directory that one can expect to be emptied at a reboot; and `/var/tmp` is a directory that will be emptied periodically, at the discretion of a system administrator or scripts. Neither of these two fits a typical use case of what a developers does with `--prefix`.



---

archive/issue_comments_462740.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-10-28T06:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462740",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_462741.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-26T15:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462741",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462742.json:
```json
{
    "body": "<a id='comment:18'></a>I've now added a recommendation to put the source files in the linux file system so that the error doesn't occur in the first place. However, WSL has a few limitations and performance problems if you try to access files across the Windows <> Linux bridge; thus in some cases you might still prefer to put the files under the windows file system. In this case the workaround is still necessary. \n\nAlso I've changed the workaround back to use use `SAGE_BUILD_DIR` as setting the prefix slowed down the build process considerably and had other issues.",
    "created_at": "2021-11-26T15:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462742",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:18'></a>I've now added a recommendation to put the source files in the linux file system so that the error doesn't occur in the first place. However, WSL has a few limitations and performance problems if you try to access files across the Windows <> Linux bridge; thus in some cases you might still prefer to put the files under the windows file system. In this case the workaround is still necessary. 

Also I've changed the workaround back to use use `SAGE_BUILD_DIR` as setting the prefix slowed down the build process considerably and had other issues.



---

archive/issue_comments_462743.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-26T15:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462743",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_462744.json:
```json
{
    "body": "<a id='comment:19'></a>The rst markup doesn't look quite right, have you built the HTML doc?",
    "created_at": "2021-11-26T21:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462744",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>The rst markup doesn't look quite right, have you built the HTML doc?



---

archive/issue_comments_462745.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-28T15:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462746.json:
```json
{
    "body": "<a id='comment:21'></a>Sorry, still living to much in a markdown world. Should be fine now.",
    "created_at": "2021-11-28T15:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462746",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:21'></a>Sorry, still living to much in a markdown world. Should be fine now.



---

archive/issue_comments_462747.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-29T01:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462747",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462748.json:
```json
{
    "body": "<a id='comment:23'></a>Thanks",
    "created_at": "2021-11-29T08:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462748",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:23'></a>Thanks



---

archive/issue_events_086614.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-19T11:47:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32714#event-86614"
}
```



---

archive/issue_comments_462749.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-19T11:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32714#issuecomment-462749",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
